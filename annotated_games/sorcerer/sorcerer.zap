	.INSERT "sorcerer/sorcerer_freq"
	.INSERT "sorcerer/sorcerer_data"

	.FUNCT PARSER,PTR=P-LEXSTART,WRD,VAL=0,VERB=0,OF-FLAG=0,OWINNER,OMERGED,LEN,DIR=0,NW=0,LW=0,CNT=-1
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	ZERO? P-OFLAG \?L6
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
?L6:	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'OWINNER,WINNER
	SET 'OMERGED,P-MERGED
	SET 'P-ADVERB,0
	SET 'P-MERGED,0
	SET 'P-END-ON-PREP,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	ZERO? QUOTE-FLAG \?L9
	EQUAL? WINNER,PLAYER /?L9
	SET 'WINNER,PLAYER
	CALL META-LOC,PLAYER >HERE
	CALL LIT?,HERE >LIT
?L9:	SET 'PERFORMING-SPELL,0
	ZERO? RESERVE-PTR /?L12
	SET 'PTR,RESERVE-PTR
	CALL STUFF,RESERVE-LEXV,P-LEXV
	ZERO? SUPER-BRIEF \?L14
	EQUAL? PLAYER,WINNER \?L14
	CRLF
?L14:	SET 'RESERVE-PTR,0
	SET 'P-CONT,0
	JUMP ?L21
?L12:	ZERO? P-CONT /?L17
	SET 'PTR,P-CONT
	ZERO? SUPER-BRIEF \?L18
	EQUAL? PLAYER,WINNER \?L18
	EQUAL? PRSA,V?SAY /?L18
	CRLF
?L18:	SET 'P-CONT,0
	JUMP ?L21
?L17:	SET 'WINNER,PLAYER
	SET 'QUOTE-FLAG,0
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L22
	LOC WINNER >HERE
?L22:	CALL LIT?,HERE >LIT
	ZERO? SUPER-BRIEF \?L25
	CRLF
?L25:	PRINTI ">"
	READ P-INBUF,P-LEXV
?L21:	GETB P-LEXV,P-LEXWORDS >P-LEN
	ZERO? P-LEN \?L30
	PRINTI "I beg your pardon?"
	CRLF
	RFALSE
?L30:	GET P-LEXV,PTR >WRD
	EQUAL? WRD,W?OOPS \?L35
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA \?L37
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L37:	GRTR? P-LEN,1 /?L40
	PRINTI "I can't help your clumsiness."
	CRLF
	RFALSE
?L40:	GET OOPS-TABLE,O-PTR >STACK
	ZERO? STACK /?L44
	GRTR? P-LEN,2 \?L49
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$QUOTE \?L45
	PRINTI "Sorry, you can't correct mistakes in quoted text."
	CRLF
	RFALSE
?L45:	GRTR? P-LEN,2 \?L49
	PRINTI "Warning: only the first word after OOPS is used."
	CRLF
?L49:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	GET OOPS-TABLE,O-PTR >STACK
	PUT AGAIN-LEXV,STACK,STACK
	SET 'WINNER,OWINNER
	GET OOPS-TABLE,O-PTR >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,3 >STACK
	MUL PTR,P-LEXELEN >STACK
	ADD STACK,7 >STACK
	GETB P-LEXV,STACK >STACK
	MUL PTR,P-LEXELEN >STACK
	ADD STACK,6 >STACK
	GETB P-LEXV,STACK >STACK
	CALL INBUF-ADD,STACK,STACK,STACK
	CALL STUFF,AGAIN-LEXV,P-LEXV
	GETB P-LEXV,P-LEXWORDS >P-LEN
	GET OOPS-TABLE,O-START >PTR
	CALL INBUF-STUFF,OOPS-INBUF,P-INBUF
	JUMP ?L56
?L44:	PUT OOPS-TABLE,O-END,0
	PRINTI "There was no word to replace!"
	CRLF
	RFALSE
?L35:	EQUAL? WRD,W?AGAIN,W?G /?L57
	SET 'P-NUMBER,0
?L57:	PUT OOPS-TABLE,O-END,0
?L56:	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?AGAIN,W?G \?L60
	GETB OOPS-INBUF,1 >STACK
	ZERO? STACK \?L62
	PRINTI "Beg pardon?"
	CRLF
	RFALSE
?L62:	ZERO? P-OFLAG /?L66
	PRINTI "It's difficult to repeat fragments."
	CRLF
	RFALSE
?L66:	ZERO? P-WON \?L69
	PRINTI "That would just repeat a mistake."
	CRLF
	RFALSE
?L69:	GRTR? P-LEN,1 \?L72
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA,W?THEN /?L75
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?AND \?L73
?L75:	ADD PTR,4 >PTR
	GETB P-LEXV,P-LEXWORDS >STACK
	SUB STACK,2 >STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
	JUMP ?L79
?L73:	PRINTI "I couldn't understand that sentence."
	CRLF
	RFALSE
?L72:	ADD PTR,P-LEXELEN >PTR
	GETB P-LEXV,P-LEXWORDS >STACK
	DEC 'STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
?L79:	GETB P-LEXV,P-LEXWORDS >STACK
	GRTR? STACK,0 \?L80
	CALL STUFF,P-LEXV,RESERVE-LEXV
	SET 'RESERVE-PTR,PTR
	JUMP ?L82
?L80:	SET 'RESERVE-PTR,0
?L82:	SET 'WINNER,OWINNER
	SET 'P-MERGED,OMERGED
	CALL INBUF-STUFF,OOPS-INBUF,P-INBUF
	CALL STUFF,AGAIN-LEXV,P-LEXV
	SET 'CNT,-1
	SET 'DIR,AGAIN-DIR
?L83:	IGRTR? 'CNT,P-ITBLLEN /?L90
	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L83
?L60:	CALL STUFF,P-LEXV,AGAIN-LEXV
	CALL INBUF-STUFF,P-INBUF,OOPS-INBUF
	PUT OOPS-TABLE,O-START,PTR
	MUL 4,P-LEN >STACK
	PUT OOPS-TABLE,O-LENGTH,STACK
	GETB P-LEXV,P-LEXWORDS >STACK
	MUL P-LEXELEN,STACK >STACK
	ADD PTR,STACK >STACK
	MUL 2,STACK >LEN
	SUB LEN,2 >STACK
	GETB P-LEXV,STACK >STACK
	SUB LEN,1 >STACK
	GETB P-LEXV,STACK >STACK
	ADD STACK,STACK >STACK
	PUT OOPS-TABLE,O-END,STACK
	SET 'RESERVE-PTR,0
	SET 'LEN,P-LEN
	SET 'P-DIR,0
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
?L89:	DLESS? 'P-LEN,0 \?L91
	SET 'QUOTE-FLAG,0
	JUMP ?L90
?L91:	GET P-LEXV,PTR >WRD
	ZERO? WRD \?L94
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L93
?L94:	ZERO? P-LEN \?L95
	SET 'NW,0
	JUMP ?L97
?L95:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L97:	EQUAL? WRD,W?TO \?L98
	EQUAL? VERB,ACT?TELL \?L98
	SET 'WRD,W?$QUOTE
	JUMP ?L103
?L98:	EQUAL? WRD,W?THEN \?L103
	GRTR? P-LEN,0 \?L103
	ZERO? VERB \?L103
	ZERO? QUOTE-FLAG \?L103
	EQUAL? LW,0,W?$PERIOD \?L101
	SET 'WRD,W?THE
	JUMP ?L103
?L101:	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WRD,W?$QUOTE
?L103:	EQUAL? WRD,W?THEN,W?$PERIOD,W?$QUOTE \?L105
	EQUAL? WRD,W?$QUOTE \?L111
	ZERO? QUOTE-FLAG /?L109
	SET 'QUOTE-FLAG,0
	JUMP ?L111
?L109:	SET 'QUOTE-FLAG,1
?L111:	ZERO? P-LEN /?L113
	ADD PTR,P-LEXELEN >P-CONT
?L113:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L90
?L105:	CALL WT?,WRD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L115
	EQUAL? VERB,0,ACT?WALK \?L115
	EQUAL? LEN,1 /?L116
	EQUAL? LEN,2 \?L117
	EQUAL? VERB,ACT?WALK /?L116
?L117:	EQUAL? NW,W?THEN,W?$PERIOD,W?$QUOTE \?L118
	LESS? LEN,2 \?L116
?L118:	ZERO? QUOTE-FLAG /?L119
	EQUAL? LEN,2 \?L119
	EQUAL? NW,W?$QUOTE /?L116
?L119:	GRTR? LEN,2 \?L115
	EQUAL? NW,W?$COMMA,W?AND \?L115
?L116:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L120
	ADD PTR,P-LEXELEN >STACK
	PUT P-LEXV,STACK,W?THEN
?L120:	GRTR? LEN,2 /?L156
	SET 'QUOTE-FLAG,0
	JUMP ?L90
?L115:	CALL WT?,WRD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L126
	ZERO? VERB \?L126
	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WRD
	MUL PTR,2 >STACK
	ADD STACK,2 >CNT
	GETB P-LEXV,CNT >STACK
	PUTB P-VTBL,2,STACK
	ADD CNT,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L156
?L126:	CALL WT?,WRD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L128
	EQUAL? WRD,W?ALL,W?ONE,W?BOTH /?L129
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L129
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L127
?L129:	SET 'VAL,0
?L128:	GRTR? P-LEN,1 \?L130
	EQUAL? NW,W?OF \?L130
	ZERO? VAL \?L166
	EQUAL? WRD,W?ALL,W?ONE,W?A /?L130
	SET 'OF-FLAG,1
	JUMP ?L156
?L130:	ZERO? VAL /?L132
?L166:	ZERO? P-LEN /?L133
	EQUAL? NW,W?THEN,W?$PERIOD \?L132
?L133:	SET 'P-END-ON-PREP,1
	LESS? P-NCN,2 \?L156
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WRD
	JUMP ?L156
?L132:	EQUAL? P-NCN,2 \?L137
	PRINTI "There were too many nouns in that sentence."
	CRLF
	RFALSE
?L137:	INC 'P-NCN
	SET 'P-ACT,VERB
	CALL CLAUSE,PTR,VAL,WRD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L156
	SET 'QUOTE-FLAG,0
	JUMP ?L90
?L127:	EQUAL? WRD,W?OF \?L146
	ZERO? OF-FLAG /?L149
	EQUAL? NW,W?$PERIOD,W?THEN \?L147
?L149:	CALL CANT-USE,PTR
	RFALSE
?L147:	SET 'OF-FLAG,0
	JUMP ?L156
?L146:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L156
	EQUAL? VERB,ACT?TELL \?L152
	CALL WT?,WRD,PS?VERB,P1?VERB >STACK
	ZERO? STACK /?L152
	EQUAL? WINNER,PLAYER \?L152
	PRINTI "Please consult your manual for the correct way to talk to other people or creatures."
	CRLF
	RFALSE
?L152:	CALL CANT-USE,PTR
	RFALSE
?L93:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L156:	SET 'LW,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L89
?L90:	PUT OOPS-TABLE,O-PTR,0
	ZERO? DIR /?L157
	SET 'PRSA,V?WALK
	CALL NULL-F
	SET 'PRSO,DIR
	SET 'P-OFLAG,0
	SET 'P-WALK-DIR,DIR
	SET 'AGAIN-DIR,DIR
	RETURN AGAIN-DIR
?L157:	ZERO? P-OFLAG /?L160
	CALL ORPHAN-MERGE
?L160:	SET 'P-WALK-DIR,0
	SET 'AGAIN-DIR,0
	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT STUFF,SRC,DEST,MAX=29,PTR=P-LEXSTART,CTR=1,BPTR
	GETB SRC,0 >STACK
	PUTB DEST,0,STACK
	GETB SRC,1 >STACK
	PUTB DEST,1,STACK
?L1:	GET SRC,PTR >STACK
	PUT DEST,PTR,STACK
	MUL PTR,2 >STACK
	ADD STACK,2 >BPTR
	GETB SRC,BPTR >STACK
	PUTB DEST,BPTR,STACK
	MUL PTR,2 >STACK
	ADD STACK,3 >BPTR
	GETB SRC,BPTR >STACK
	PUTB DEST,BPTR,STACK
	ADD PTR,P-LEXELEN >PTR
	IGRTR? 'CTR,MAX \?L1
	RTRUE

	.FUNCT INBUF-STUFF,SRC,DEST,CNT
	GETB SRC,0 >STACK
	SUB STACK,1 >CNT
?L1:	GETB SRC,CNT >STACK
	PUTB DEST,CNT,STACK
	DLESS? 'CNT,0 \?L1
	RTRUE

	.FUNCT INBUF-ADD,LEN,BEG,SLOT,DBEG,CTR=0,TMP,?TMP
	GET OOPS-TABLE,O-END >TMP
	ZERO? TMP /?L1
	SET 'DBEG,TMP
	JUMP ?L3
?L1:	GET OOPS-TABLE,O-LENGTH >TMP
	GETB AGAIN-LEXV,TMP >?TMP
	ADD TMP,1 >STACK
	GETB AGAIN-LEXV,STACK >STACK
	ADD ?TMP,STACK >DBEG
?L3:	ADD DBEG,LEN >STACK
	PUT OOPS-TABLE,O-END,STACK
?L4:	ADD BEG,CTR >STACK
	GETB P-INBUF,STACK >STACK
	ADD DBEG,CTR >STACK
	PUTB OOPS-INBUF,STACK,STACK
	INC 'CTR
	EQUAL? CTR,LEN \?L4
	PUTB AGAIN-LEXV,SLOT,DBEG
	SUB SLOT,1 >STACK
	PUTB AGAIN-LEXV,STACK,LEN
	RTRUE

	.FUNCT WT?,PTR,BIT,B1=5,OFFS=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L6
	INC 'OFFS
?L6:	GETB PTR,OFFS >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WRD,OFF,NUM,ANDFLG=0,FIRST??=1,NW,LW=0
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L1
	ADD P-PREP1,OFF >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'P-LEN
?L3:	ZERO? P-LEN \?L4
	DEC 'P-NCN
	RETURN -1
?L4:	ADD P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L7
	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
?L7:	DLESS? 'P-LEN,0 \?L12
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L12:	GET P-LEXV,PTR >WRD
	ZERO? WRD \?L17
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L15
?L17:	ZERO? P-LEN \?L18
	SET 'NW,0
	JUMP ?L20
?L18:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L20:	EQUAL? WRD,W?AND,W?$COMMA \?L21
	SET 'ANDFLG,1
	JUMP ?L42
?L21:	EQUAL? WRD,W?ALL,W?ONE,W?BOTH \?L23
	EQUAL? NW,W?OF \?L42
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L42
?L23:	EQUAL? WRD,W?THEN,W?$PERIOD /?L28
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L27
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK /?L27
	ZERO? FIRST?? \?L27
?L28:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L27:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L29
	GRTR? P-LEN,0 \?L30
	EQUAL? NW,W?OF \?L30
	EQUAL? WRD,W?ALL,W?ONE \?L42
?L30:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L32
	ZERO? NW /?L32
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L42
?L32:	ZERO? ANDFLG \?L33
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L33
	EQUAL? NW,W?$COMMA /?L33
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L33:	SET 'ANDFLG,0
	JUMP ?L42
?L29:	ZERO? P-MERGED \?L36
	ZERO? P-OFLAG \?L36
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK /?L35
?L36:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L42
	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L42
?L35:	ZERO? ANDFLG /?L38
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK /?L39
	CALL WT?,WRD,PS?DIRECTION >STACK
	ZERO? STACK \?L39
	CALL WT?,WRD,PS?VERB >STACK
	ZERO? STACK /?L38
?L39:	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	PUT P-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L42
?L38:	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK \?L42
	CALL CANT-USE,PTR
	RFALSE
?L15:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L42:	SET 'LW,WRD
	SET 'FIRST??,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0,TIM=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L1:	DLESS? 'CNT,0 /?L2
	GETB P-INBUF,BPTR >CHR
	EQUAL? CHR,58 \?L6
	SET 'TIM,SUM
	SET 'SUM,0
	JUMP ?L10
?L6:	GRTR? SUM,10000 /FALSE
	LESS? CHR,58 \FALSE
	GRTR? CHR,47 \FALSE
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
?L10:	INC 'BPTR
	JUMP ?L1
?L2:	PUT P-LEXV,PTR,W?INTNUM
	GRTR? SUM,1000 /FALSE
	ZERO? TIM /?L13
	LESS? TIM,8 \?L14
	ADD TIM,12 >TIM
	JUMP ?L16
?L14:	GRTR? TIM,23 /FALSE
?L16:	MUL TIM,60 >STACK
	ADD SUM,STACK >SUM
?L13:	SET 'P-NUMBER,SUM
	RETURN W?INTNUM

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,WRD,?TMP
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >WRD
	CALL WT?,WRD,PS?VERB,P1?VERB >?TMP
	GET P-OTBL,P-VERB >STACK
	EQUAL? ?TMP,STACK /?L3
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK /?L1
?L3:	SET 'ADJ,1
	JUMP ?L4
?L1:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L4
	ZERO? P-NCN \?L4
	PUT P-ITBL,P-VERB,0
	PUT P-ITBL,P-VERBN,0
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
	SET 'P-NCN,1
?L4:	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L6
	ZERO? ADJ \?L6
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L6:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L9
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP1 >STACK
	EQUAL? TEMP,STACK /?L12
	ZERO? TEMP \FALSE
?L12:	ZERO? ADJ /?L13
	ADD P-LEXV,2 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L15
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L15:	ZERO? P-NCN \?L21
	SET 'P-NCN,1
	JUMP ?L21
?L13:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
?L21:	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L42
?L9:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L23
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP2 >STACK
	EQUAL? TEMP,STACK /?L26
	ZERO? TEMP \FALSE
?L26:	ZERO? ADJ /?L29
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L29
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L29:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L42
?L23:	ZERO? P-ACLAUSE /?L42
	EQUAL? P-NCN,1 /?L35
	ZERO? ADJ \?L35
	SET 'P-ACLAUSE,0
	RFALSE
?L35:	GET P-ITBL,P-NC1 >BEG
	ZERO? ADJ /?L38
	ADD P-LEXV,2 >BEG
	SET 'ADJ,0
?L38:	GET P-ITBL,P-NC1L >END
?L41:	GET BEG,0 >WRD
	EQUAL? BEG,END \?L43
	ZERO? ADJ /?L45
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L42
?L45:	SET 'P-ACLAUSE,0
	RFALSE
?L43:	ZERO? ADJ \?L48
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE /?L49
	EQUAL? WRD,W?ALL,W?ONE \?L48
?L49:	SET 'ADJ,WRD
	JUMP ?L51
?L48:	EQUAL? WRD,W?ONE \?L50
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L42
?L50:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT \?L51
	EQUAL? WRD,P-ANAM \?L52
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L42
?L52:	CALL NCLAUSE-WIN
	JUMP ?L42
?L51:	ADD BEG,P-WORDLEN >BEG
	ZERO? END \?L41
	SET 'END,BEG
	SET 'P-NCN,1
	SUB BEG,4 >STACK
	PUT P-ITBL,P-NC1,STACK
	PUT P-ITBL,P-NC1L,BEG
	JUMP ?L41
?L42:	GET P-OVTBL,0 >STACK
	PUT P-VTBL,0,STACK
	GETB P-OVTBL,2 >STACK
	PUTB P-VTBL,2,STACK
	GETB P-OVTBL,3 >STACK
	PUTB P-VTBL,3,STACK
	PUT P-OTBL,P-VERBN,P-VTBL
	PUTB P-VTBL,2,0
?L60:	IGRTR? 'CNT,P-ITBLLEN \?L62
	SET 'P-MERGED,1
	RTRUE
?L62:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L60

	.FUNCT ACLAUSE-WIN,ADJ
	GET P-OTBL,P-VERB >STACK
	PUT P-ITBL,P-VERB,STACK
	PUT P-CCTBL,CC-SBPTR,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-SEPTR,STACK
	PUT P-CCTBL,CC-DBPTR,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-DEPTR,STACK
	CALL CLAUSE-COPY,P-OTBL,P-OTBL,ADJ
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'P-NCN,2
?L1:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT NCLAUSE-WIN
	PUT P-CCTBL,CC-SBPTR,P-NC1
	PUT P-CCTBL,CC-SEPTR,P-NC1L
	PUT P-CCTBL,CC-DBPTR,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-DEPTR,STACK
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'P-NCN,2
?L1:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,?TMP
	PUT OOPS-TABLE,O-PTR,PTR
	EQUAL? PRSA,V?SAY \?L1
	PRINTI "Nothing happens."
	CRLF
	RFALSE
?L1:	PRINTI "I don't know the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI """."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT CANT-USE,PTR,BUF,?TMP
	EQUAL? PRSA,V?SAY \?L1
	PRINTI "Nothing happens."
	CRLF
	RFALSE
?L1:	PRINTI "You used the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI """ in a way that I don't understand."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB,TMP
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	PRINTI "There was no verb in that sentence!"
	CRLF
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L6:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	GRTR? P-NCN,NUM /?L15
	LESS? NUM,1 /?L10
	ZERO? P-NCN \?L10
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L11
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L10
?L11:	SET 'DRIVE1,SYN
	JUMP ?L15
?L10:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L15
	EQUAL? NUM,2 \?L13
	EQUAL? P-NCN,1 \?L13
	SET 'DRIVE2,SYN
	JUMP ?L15
?L13:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L15
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L15:	DLESS? 'LEN,1 \?L18
	ZERO? DRIVE1 \?L53
	ZERO? DRIVE2 \?L7
	PRINTI "That sentence isn't one I recognize."
	CRLF
	RFALSE
?L18:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L6
?L7:	ZERO? DRIVE1 /?L27
?L53:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L27
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L27:	ZERO? DRIVE2 /?L29
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L29
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L29:	EQUAL? VERB,ACT?FIND \?L30
	PRINTI "That question can't be answered."
	CRLF
	RFALSE
?L30:	EQUAL? WINNER,PLAYER /?L33
	CALL CANT-ORPHAN >STACK
	RSTACK
?L33:	CALL ORPHAN,DRIVE1,DRIVE2
	PRINTI "What do you want to "
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L37
	PRINTI "tell"
	JUMP ?L42
?L37:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L41
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L42
?L41:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L42:	ZERO? DRIVE2 /?L43
	PRINTI " "
	CALL THING-PRINT,1,1
?L43:	SET 'P-OFLAG,1
	ZERO? DRIVE1 /?L48
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L50
?L48:	GETB DRIVE2,P-SPREP2 >STACK
?L50:	CALL PREP-PRINT,STACK
	PRINTI "?"
	CRLF
	RFALSE

	.FUNCT CANT-ORPHAN
	PRINTI """I don't understand! What are you referring to?"""
	CRLF
	RFALSE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	ZERO? P-MERGED \?L1
	PUT P-OCLAUSE,P-MATCHLEN,0
?L1:	GET P-VTBL,0 >STACK
	PUT P-OVTBL,0,STACK
	GETB P-VTBL,2 >STACK
	PUTB P-OVTBL,2,STACK
	GETB P-VTBL,3 >STACK
	PUTB P-OVTBL,3,STACK
?L4:	IGRTR? 'CNT,P-ITBLLEN /?L5
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L4
?L5:	EQUAL? P-NCN,2 \?L9
	PUT P-CCTBL,CC-SBPTR,P-NC2
	PUT P-CCTBL,CC-SEPTR,P-NC2L
	PUT P-CCTBL,CC-DBPTR,P-NC2
	PUT P-CCTBL,CC-DEPTR,P-NC2L
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L9:	LESS? P-NCN,1 /?L12
	PUT P-CCTBL,CC-SBPTR,P-NC1
	PUT P-CCTBL,CC-SEPTR,P-NC1L
	PUT P-CCTBL,CC-DBPTR,P-NC1
	PUT P-CCTBL,CC-DEPTR,P-NC1L
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L12:	ZERO? D1 /?L15
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L15:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT THING-PRINT,PRSO?,THE?=0,BEG,END
	ZERO? PRSO? /?L1
	GET P-ITBL,P-NC1 >BEG
	GET P-ITBL,P-NC1L >END
	JUMP ?L3
?L1:	GET P-ITBL,P-NC2 >BEG
	GET P-ITBL,P-NC2L >END
?L3:	CALL BUFFER-PRINT,BEG,END,THE? >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=1,WRD,FIRST??=1,PN=0,Q?=0
?L1:	EQUAL? BEG,END /TRUE
	GET BEG,0 >WRD
	EQUAL? WRD,W?$COMMA \?L6
	PRINTI ", "
	JUMP ?L11
?L6:	ZERO? NOSP /?L10
	SET 'NOSP,0
	JUMP ?L11
?L10:	PRINTI " "
?L11:	EQUAL? WRD,W?$PERIOD,W?$COMMA \?L14
	SET 'NOSP,1
	JUMP ?L18
?L14:	EQUAL? WRD,W?ME \?L16
	PRINTD ME
	SET 'PN,1
	JUMP ?L18
?L16:	EQUAL? WRD,W?INTNUM \?L17
	PRINTN P-NUMBER
	SET 'PN,1
	JUMP ?L18
?L17:	ZERO? FIRST?? /?L19
	ZERO? PN \?L19
	ZERO? CP /?L19
	PRINTI "the "
?L19:	ZERO? P-OFLAG \?L26
	ZERO? P-MERGED /?L24
?L26:	PRINTB WRD
	JUMP ?L28
?L24:	EQUAL? WRD,W?IT \?L27
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L27
	PRINTD P-IT-OBJECT
	JUMP ?L28
?L27:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L28:	SET 'FIRST??,0
?L18:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT PREP-PRINT,PREP,WRD
	ZERO? PREP /FALSE
	PRINTI " "
	EQUAL? PREP,PR?THROUGH \?L5
	PRINTI "through"
	RTRUE
?L5:	CALL PREP-FIND,PREP >WRD
	PRINTB WRD
	RTRUE

	.FUNCT CLAUSE-COPY,SRC,DEST,INSRT=0,BEG,END
	GET P-CCTBL,CC-SBPTR >STACK
	GET SRC,STACK >BEG
	GET P-CCTBL,CC-SEPTR >STACK
	GET SRC,STACK >END
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	GET P-CCTBL,CC-DBPTR >STACK
	PUT DEST,STACK,STACK
?L1:	EQUAL? BEG,END \?L3
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	GET P-CCTBL,CC-DEPTR >STACK
	PUT DEST,STACK,STACK
	RTRUE
?L3:	ZERO? INSRT /?L6
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L6
	CALL CLAUSE-ADD,INSRT
?L6:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CLAUSE-ADD,WRD,PTR
	GET P-OCLAUSE,P-MATCHLEN >STACK
	ADD STACK,2 >PTR
	SUB PTR,1 >STACK
	PUT P-OCLAUSE,STACK,WRD
	PUT P-OCLAUSE,PTR,0
	PUT P-OCLAUSE,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-FIND,PREP,CNT=0,SIZE
	GET PREPOSITIONS,0 >STACK
	MUL STACK,2 >SIZE
?L1:	IGRTR? 'CNT,SIZE /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L1
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ
	EQUAL? GBIT,RLANDBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	PRINTI "("
	ZERO? PREP /?L10
	ZERO? P-END-ON-PREP \?L10
	CALL PREP-FIND,PREP >PREP
	PRINTB PREP
	EQUAL? PREP,W?OUT \?L12
	PRINTI " of"
?L12:	PRINTI " "
	EQUAL? OBJ,HANDS \?L19
	PRINTI "your hands"
	JUMP ?L23
?L19:	PRINTI "the "
	PRINTD OBJ
?L23:	PRINTI ")"
	CRLF
	RETURN OBJ
?L10:	PRINTD OBJ
	PRINTI ")"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,OPTR,IPTR,L
	PUT P-BUTS,P-MATCHLEN,0
	GET P-ITBL,P-NC2 >IPTR
	ZERO? IPTR /?L3
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,IPTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
?L3:	GET P-ITBL,P-NC1 >OPTR
	ZERO? OPTR /?L8
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,OPTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
?L8:	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSO,P-MATCHLEN >L
	ZERO? OPTR /?L13
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L13:	ZERO? IPTR /TRUE
	ZERO? OPTR /?L18
	GET P-PRSO,P-MATCHLEN >STACK
	EQUAL? L,STACK \TRUE
?L18:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,BUT=0,LEN,WV,WRD,NW,WAS-ALL=0
	SET 'P-AND,0
	EQUAL? P-GETFLAGS,P-ALL \?L1
	SET 'WAS-ALL,1
?L1:	SET 'P-GETFLAGS,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WRD
?L4:	EQUAL? PTR,EPTR \?L6
?L57:	ZERO? BUT /?L9
	PUSH BUT
	JUMP ?L8
?L9:	PUSH TBL
?L8:	CALL GET-OBJECT,STACK >WV
	ZERO? WAS-ALL /?L10
	SET 'P-GETFLAGS,P-ALL
?L10:	RETURN WV
?L6:	ADD PTR,P-WORDLEN >STACK
	EQUAL? EPTR,STACK \?L14
	SET 'NW,0
	JUMP ?L16
?L14:	GET PTR,P-LEXELEN >NW
?L16:	EQUAL? WRD,W?ALL,W?BOTH \?L17
	SET 'P-GETFLAGS,P-ALL
	EQUAL? NW,W?OF \?L52
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L52
?L17:	EQUAL? WRD,W?BUT,W?EXCEPT \?L22
	ZERO? BUT /?L26
	PUSH BUT
	JUMP ?L25
?L26:	PUSH TBL
?L25:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,P-BUTS
	PUT BUT,P-MATCHLEN,0
	JUMP ?L52
?L22:	EQUAL? WRD,W?A,W?ONE \?L27
	ZERO? P-ADJ \?L28
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L52
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L52
?L28:	SET 'P-NAM,P-ONEOBJ
	ZERO? BUT /?L37
	PUSH BUT
	JUMP ?L36
?L37:	PUSH TBL
?L36:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L52
?L27:	EQUAL? WRD,W?AND,W?$COMMA \?L40
	EQUAL? NW,W?AND,W?$COMMA /?L40
	SET 'P-AND,1
	ZERO? BUT /?L44
	PUSH BUT
	JUMP ?L43
?L44:	PUSH TBL
?L43:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L52
?L40:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L52
	EQUAL? WRD,W?AND,W?$COMMA /?L52
	EQUAL? WRD,W?OF \?L47
	ZERO? P-GETFLAGS \?L52
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L52
?L47:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L51
	CALL ADJ-CHECK,WRD >STACK
	ZERO? STACK /?L51
	SET 'P-ADJ,WV
	SET 'P-ADJN,WRD
	JUMP ?L52
?L51:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L52
	SET 'P-NAM,WRD
	SET 'P-ONEOBJ,WRD
?L52:	EQUAL? PTR,EPTR /?L57
	ADD PTR,P-WORDLEN >PTR
	SET 'WRD,NW
	JUMP ?L4

	.FUNCT ADJ-CHECK,WRD
	ZERO? P-ADJ /TRUE
	EQUAL? WRD,W?ENCHAN,W?SPELL,W?CASTLE /FALSE
	EQUAL? WRD,W?RIVER /FALSE
	ZERO? P-ADJ /TRUE
	EQUAL? P-ADJ,A?UPPER,A?LOWER \TRUE
	RFALSE

	.FUNCT GET-OBJECT,TBL,VRB=1,BITS,LEN,XBITS,TLEN,GCHECK=0,OLEN=0,OBJ
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	ZERO? P-NAM \?L11
	ZERO? P-ADJ /?L8
	CALL WT?,P-ADJN,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L6
	SET 'P-NAM,P-ADJN
	SET 'P-ADJ,0
	JUMP ?L8
?L6:	CALL NULL-F >STACK
	ZERO? STACK /?L8
?L8:	ZERO? P-NAM \?L11
	ZERO? P-ADJ \?L11
	EQUAL? P-GETFLAGS,P-ALL /?L81
	ZERO? P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	PRINTI "There seems to be a noun missing in that sentence!"
	CRLF
	RFALSE
?L11:	EQUAL? P-GETFLAGS,P-ALL \?L21
?L81:	ZERO? P-SLOCBITS \?L19
?L21:	SET 'P-SLOCBITS,-1
?L19:	SET 'P-TABLE,TBL
?L23:	ZERO? GCHECK /?L25
	CALL GLOBAL-CHECK,TBL
	JUMP ?L32
?L25:	ZERO? LIT \?L30
	ZERO? BLORTED /?L28
?L30:	FCLEAR PLAYER,TRANSBIT
	CALL DO-SL,HERE,SOG,SIR
	FSET PLAYER,TRANSBIT
?L28:	CALL DO-SL,PLAYER,SH,SC
	GET TBL,0 >STACK
	EQUAL? STACK,TLEN \?L32
	ZERO? P-ADJ /?L34
	EQUAL? P-NAM,W?SPELL,0 \?L34
	SET 'P-NAM,P-ADJN
?L34:	CALL SPELL-CHECK,TBL,P-NAM
?L32:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL /?L52
	BTST P-GETFLAGS,P-ONE \?L40
	ZERO? LEN /?L40
	EQUAL? LEN,1 /?L41
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "(How about the "
	GET TBL,1 >STACK
	PRINTD STACK
	PRINTI "?)"
	CRLF
?L41:	PUT TBL,P-MATCHLEN,1
	JUMP ?L52
?L40:	GRTR? LEN,1 /?L49
	ZERO? LEN \?L79
	EQUAL? P-SLOCBITS,-1 /?L52
?L49:	EQUAL? P-SLOCBITS,-1 \?L50
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L23
?L50:	ZERO? LEN \?L53
	SET 'LEN,OLEN
?L53:	EQUAL? WINNER,PLAYER /?L56
	CALL CANT-ORPHAN
	RFALSE
?L56:	ZERO? VRB /?L62
	ZERO? P-NAM /?L58
	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L59
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L61
?L59:	SET 'P-ACLAUSE,P-NC2
?L61:	SET 'P-AADJ,P-ADJ
	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L62
?L58:	ZERO? VRB /?L62
	PRINTI "There seems to be a noun missing in that sentence!"
	CRLF
?L62:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L52:	ZERO? LEN \?L79
	ZERO? GCHECK /?L67
	ZERO? VRB /?L75
	SET 'P-SLOCBITS,XBITS
	ZERO? LIT \?L74
	ZERO? BLORTED \?L74
	EQUAL? PRSA,V?WHAT,V?WHERE,V?TELL /?L74
	EQUAL? PRSA,V?FROTZ,V?WHO \?L71
?L74:	CALL OBJ-FOUND,NOT-HERE-OBJECT,TBL
	SET 'P-XNAM,P-NAM
	SET 'P-XADJ,P-ADJ
	SET 'P-XADJN,P-ADJN
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	RTRUE
?L71:	PRINTI "It's too dark to see!"
	CRLF
?L75:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L67:	ZERO? LEN \?L79
	SET 'GCHECK,1
	JUMP ?L23
?L79:	SET 'P-SLOCBITS,XBITS
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE

	.FUNCT MOBY-FIND,TBL,FOO,LEN
	SET 'P-MOBY-FLAG,1
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	SET 'P-NAM,P-XNAM
	SET 'P-ADJ,P-XADJ
	PUT TBL,P-MATCHLEN,0
	FIRST? ROOMS >FOO \?L3
?L4:	CALL SEARCH-LIST,FOO,TBL,P-SRCALL
	NEXT? FOO >FOO /?L4
?L3:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L8
	CALL DO-SL,LOCAL-GLOBALS,1,1
?L8:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L11
	CALL DO-SL,ROOMS,1,1
?L11:	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L14
	GET TBL,1 >P-MOBY-FOUND
?L14:	SET 'P-MOBY-FLAG,0
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RETURN LEN

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	SET 'RLEN,LEN
	PRINTI "Which "
	ZERO? P-OFLAG \?L5
	ZERO? P-MERGED \?L5
	ZERO? P-AND /?L3
?L5:	ZERO? P-NAM /?L6
	PUSH P-NAM
	JUMP ?L9
?L6:	ZERO? P-ADJ /?L8
	PUSH P-ADJN
	JUMP ?L9
?L8:	PUSH W?ONE
?L9:	PRINTB STACK
	JUMP ?L10
?L3:	EQUAL? TBL,P-PRSO /?L11
	PUSH 0
	JUMP ?L12
?L11:	PUSH 1
?L12:	CALL THING-PRINT,STACK
?L10:	PRINTI " do you mean, "
?L15:	INC 'TLEN
	GET TBL,TLEN >OBJ
	PRINTI "the "
	PRINTD OBJ
	EQUAL? LEN,2 \?L19
	EQUAL? RLEN,2 /?L21
	PRINTI ","
?L21:	PRINTI " or "
	JUMP ?L28
?L19:	GRTR? LEN,2 \?L28
	PRINTI ", "
?L28:	DLESS? 'LEN,1 \?L15
	PRINTR "?"

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS,FOO
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETPT HERE,P?PSEUDO >RMG
	ZERO? RMG /?L15
	PTSIZE RMG >STACK
	DIV STACK,4 >STACK
	SUB STACK,1 >RMGL
	SET 'CNT,0
?L14:	MUL CNT,2 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L16
	SET 'LAST-PSEUDO-LOC,HERE
	MUL CNT,2 >STACK
	INC 'STACK
	GET RMG,STACK >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	GETPT PSEUDO-OBJECT,P?ACTION >STACK
	SUB STACK,5 >FOO
	GET P-NAM,0 >STACK
	PUT FOO,0,STACK
	GET P-NAM,1 >STACK
	PUT FOO,1,STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L15
?L16:	IGRTR? 'CNT,RMGL \?L14
?L15:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	RETURN P-SLOCBITS

	.FUNCT DO-SL,OBJ,BIT1,BIT2,BTS
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL,FLS,NOBJ
	FIRST? OBJ >OBJ \FALSE
?L3:	EQUAL? LVL,P-SRCBOT /?L5
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L5
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	EQUAL? LVL,P-SRCTOP \?L10
	FSET? OBJ,SEARCHBIT /?L10
	FSET? OBJ,SURFACEBIT \?L11
?L10:	FIRST? OBJ >NOBJ \?L11
	FSET? OBJ,OPENBIT /?L13
	FSET? OBJ,TRANSBIT /?L13
	ZERO? P-MOBY-FLAG /?L11
?L13:	FSET? OBJ,SURFACEBIT \?L14
	PUSH P-SRCALL
	JUMP ?L17
?L14:	FSET? OBJ,SEARCHBIT \?L16
	PUSH P-SRCALL
	JUMP ?L17
?L16:	PUSH P-SRCTOP
?L17:	CALL SEARCH-LIST,OBJ,TBL,STACK >FLS
?L11:	NEXT? OBJ >OBJ /?L3
	RTRUE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,IBITS,PTR,OBJ,TAKEN
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST IBITS,SHAVE /?L3
	BTST IBITS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L15
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK \?L11
	PRINTI "I don't see what you're referring to."
	CRLF
	RFALSE
?L11:	SET 'OBJ,P-IT-OBJECT
?L15:	CALL HELD?,OBJ >STACK
	ZERO? STACK \?L3
	EQUAL? OBJ,HANDS,ME /?L3
	SET 'PRSO,OBJ
	FSET? OBJ,TRYTAKEBIT \?L19
	SET 'TAKEN,1
	JUMP ?L23
?L19:	EQUAL? WINNER,PLAYER /?L21
	SET 'TAKEN,0
	JUMP ?L23
?L21:	BTST IBITS,STAKE \?L22
	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \?L22
	SET 'TAKEN,0
	JUMP ?L23
?L22:	SET 'TAKEN,1
?L23:	ZERO? TAKEN /?L51
	BTST IBITS,SHAVE \?L24
	EQUAL? WINNER,PLAYER \?L24
	EQUAL? OBJ,NOT-HERE-OBJECT \?L26
	PRINTI "You don't have that!"
	CRLF
	RFALSE
?L26:	PRINTI "You don't have "
	GET TBL,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L33
	PRINTI "all those things"
	JUMP ?L40
?L33:	EQUAL? OBJ,NOT-HERE-OBJECT \?L37
	PRINTI "that"
	JUMP ?L40
?L37:	PRINTI "the "
	PRINTD OBJ
	CALL THIS-IS-IT,OBJ
?L40:	PRINTI "."
	CRLF
	RFALSE
?L24:	ZERO? TAKEN \?L3
?L51:	EQUAL? WINNER,PLAYER \?L3
	PRINTI "(Taken)"
	CRLF
	JUMP ?L3

	.FUNCT MANY-CHECK,LOSS=0,TMP
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	PRINTI "You can't use multiple "
	EQUAL? LOSS,2 \?L9
	PRINTI "in"
?L9:	PRINTI "direct objects with """
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L16
	PRINTI "tell"
	JUMP ?L22
?L16:	ZERO? P-OFLAG \?L21
	ZERO? P-MERGED /?L20
?L21:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L22
?L20:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L22:	PRINTI """."
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK \?L9
	MUL CNT,2 >STACK
	ADD TBL,STACK >STACK
	RSTACK
?L9:	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT LIT?,RM,RMBIT=1,OHERE,LIT?1=0
	ZERO? ALWAYS-LIT /?L1
	EQUAL? WINNER,PLAYER /TRUE
?L1:	SET 'P-GWIMBIT,ONBIT
	SET 'OHERE,HERE
	SET 'HERE,RM
	ZERO? RMBIT /?L4
	FSET? RM,ONBIT \?L4
	SET 'LIT?1,1
	JUMP ?L14
?L4:	CALL NULL-F >STACK
	ZERO? STACK \TRUE
	PUT P-MERGE,P-MATCHLEN,0
	SET 'P-TABLE,P-MERGE
	SET 'P-SLOCBITS,-1
	EQUAL? OHERE,RM \?L10
	CALL DO-SL,WINNER,1,1
	EQUAL? WINNER,PLAYER /?L10
	IN? PLAYER,RM \?L10
	CALL DO-SL,PLAYER,1,1
?L10:	CALL DO-SL,RM,1,1
	GET P-TABLE,P-MATCHLEN >STACK
	GRTR? STACK,0 \?L14
	SET 'LIT?1,1
?L14:	SET 'HERE,OHERE
	SET 'P-GWIMBIT,0
	RETURN LIT?1

	.FUNCT THIS-IT?,OBJ,TBL,SYNS
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	ZERO? P-ADJ /?L4
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DEC 'STACK
	CALL ZMEMQB,P-ADJ,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L4:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT ACCESSIBLE?,OBJ,L,?TMP
	LOC OBJ >L
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? OBJ,PSEUDO-OBJECT \?L3
	EQUAL? LAST-PSEUDO-LOC,HERE \FALSE
	RTRUE
?L3:	ZERO? L /FALSE
	EQUAL? L,GLOBAL-OBJECTS /TRUE
	EQUAL? L,LOCAL-GLOBALS \?L9
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	ZERO? STACK \TRUE
?L9:	CALL META-LOC,OBJ >?TMP
	LOC WINNER >STACK
	EQUAL? ?TMP,HERE,STACK \FALSE
	LOC WINNER >STACK
	EQUAL? L,WINNER,HERE,STACK /TRUE
	FSET? L,OPENBIT \FALSE
	CALL ACCESSIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT META-LOC,OBJ
?L1:	ZERO? OBJ /FALSE
	IN? OBJ,GLOBAL-OBJECTS \?L5
	RETURN GLOBAL-OBJECTS
?L5:	IN? OBJ,ROOMS \?L7
	RETURN OBJ
?L7:	LOC OBJ >OBJ
	JUMP ?L1

	.FUNCT NOT-HERE-OBJECT-F,TBL,PRSO?=1,OBJ,X=0
	EQUAL? PRSO,NOT-HERE-OBJECT \?L5
	EQUAL? PRSI,NOT-HERE-OBJECT \?L1
	PRINTR "Those things aren't here!"
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L5
	SET 'TBL,P-PRSO
	JUMP ?L6
?L5:	SET 'TBL,P-PRSI
	SET 'PRSO?,0
?L6:	ZERO? PRSO? /?L7
	EQUAL? PRSA,V?FIND,V?FOLLOW,V?AIMFIZ /?L11
	EQUAL? PRSA,V?WHAT,V?WHERE,V?WHO /?L11
	EQUAL? PRSA,V?WAIT-FOR,V?SEND,V?WALK-TO /?L11
	EQUAL? PRSA,V?RESEARCH \?L29
?L11:	SET 'X,1
	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT /?L29
	RTRUE
?L7:	EQUAL? PRSA,V?AIMFIZ-TO \?L23
	EQUAL? PRSO,ME /?L22
?L23:	EQUAL? PRSA,V?CAST \?L29
	EQUAL? PRSO,AIMFIZ-SPELL \?L29
?L22:	SET 'X,1
	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT \TRUE
?L29:	ZERO? X /?L31
	PRINTI "You'll have to be more specific, I'm afraid."
	CRLF
	JUMP ?L46
?L31:	EQUAL? WINNER,PROTAGONIST \?L35
	PRINTI "You can't see "
	EQUAL? P-XNAM,W?BELBOZ,W?HELIST,W?KRILL /?L41
	EQUAL? P-XNAM,W?FROBAR,W?JEEARR,W?FLATHE /?L41
	EQUAL? P-XNAM,W?DUNCAN,W?ENTHAR,W?THOLL /?L41
	EQUAL? P-XNAM,W?GURTH,W?MIZNIA,W?ACCARD /?L41
	EQUAL? P-XNAM,W?BORPHE,W?ANTHAR,W?MITHIC /?L41
	EQUAL? P-XNAM,W?GALEPA,W?MAREIL,W?THRIFF /?L41
	EQUAL? P-XNAM,W?ORKAN,W?BARBEL,W?CHEVAU /?L41
	PRINTI "any "
?L41:	CALL NOT-HERE-PRINT,PRSO?
	PRINTI " here!"
	CRLF
	JUMP ?L46
?L35:	PRINTI "Looking confused,"
	CALL ARTICLE,WINNER,1
	PRINTI " says, ""I don't see any "
	CALL NOT-HERE-PRINT,PRSO?
	PRINTI " here!"""
	CRLF
?L46:	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RTRUE

	.FUNCT FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ
	CALL MOBY-FIND,TBL >M-F
	EQUAL? 1,M-F \?L1
	ZERO? PRSO? /?L3
	SET 'PRSO,P-MOBY-FOUND
	RFALSE
?L3:	SET 'PRSI,P-MOBY-FOUND
	RFALSE
?L1:	ZERO? PRSO? \?L6
	PRINTI "You wouldn't find any "
	CALL NOT-HERE-PRINT,PRSO?
	PRINTR " there."
?L6:	RETURN NOT-HERE-OBJECT

	.FUNCT NOT-HERE-PRINT,PRSO?
	EQUAL? P-XNAM,W?BELBOZ \?L1
	PRINTI "Belboz"
	RTRUE
?L1:	EQUAL? P-XNAM,W?THOLL \?L5
	PRINTI "Tholl"
	RTRUE
?L5:	EQUAL? P-XNAM,W?GURTH,W?MIZNIA,W?ACCARD /?L9
	EQUAL? P-XNAM,W?BORPHE,W?ANTHAR,W?MITHIC /?L9
	EQUAL? P-XNAM,W?GALEPA,W?MAREIL,W?THRIFF \?L8
?L9:	PRINTI "that place"
	RTRUE
?L8:	EQUAL? P-XNAM,W?HELIST,W?FROBAR,W?ORKAN /?L13
	EQUAL? P-XNAM,W?BARBEL,W?CHEVAU \?L12
?L13:	PRINTI "that person"
	RTRUE
?L12:	EQUAL? P-XNAM,W?JEEARR \?L16
	PRINTI "Jeearr"
	RTRUE
?L16:	EQUAL? P-XNAM,W?KRILL \?L19
	PRINTI "Krill"
	RTRUE
?L19:	EQUAL? P-XNAM,W?FLATHE \?L22
	PRINTI "Flathead"
	RTRUE
?L22:	EQUAL? P-XNAM,W?DUNCAN,W?ENTHAR \?L25
	PRINTI "that King"
	RTRUE
?L25:	ZERO? P-OFLAG /?L28
	ZERO? P-XADJ /?L29
	PRINTB P-XADJN
?L29:	ZERO? P-XNAM /FALSE
	PRINTB P-XNAM
	RTRUE
?L28:	ZERO? PRSO? /?L35
	GET P-ITBL,P-NC1L >STACK
	GET P-ITBL,P-NC1 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK
?L35:	GET P-ITBL,P-NC2L >STACK
	GET P-ITBL,P-NC2 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK

	.FUNCT GROUND-F
	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-ON,V?CLIMB-UP /?L3
	EQUAL? PRSA,V?BOARD \?L1
?L3:	CALL V-SIT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L4
	EQUAL? HERE,LAGOON \?L4
	PRINTR "Through the water you can see sandy ground below."
?L4:	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE,V?LOOK-UNDER \?L7
	EQUAL? HERE,GLASS-MAZE \?L7
	CALL PERFORM,V?EXAMINE,MAZE
	RTRUE
?L7:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	PRINTR "You've never mastered an X-ray vision spell."

	.FUNCT ROAD-F
	EQUAL? PRSA,V?FOLLOW \FALSE
	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT CORRIDOR-F
	EQUAL? PRSA,V?WALK-TO,V?THROUGH \FALSE
	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT WALLS-F
	EQUAL? PRSA,V?READ \?L1
	EQUAL? HERE,CHAMBER-OF-THE-CIRCLE \?L1
	CALL PRINT-ID,STR?4
	CALL PERFORM,V?READ,TENETS
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	EQUAL? HERE,HALL-OF-CARVINGS \?L3
	ZERO? DRAGON-MOVED \?L3
	PRINTR "A dragon carving adorns the far wall."
?L3:	EQUAL? HERE,SLIMY-ROOM \?L6
	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTR "The walls are covered with moss and stuff."
?L6:	EQUAL? HERE,GLASS-MAZE \FALSE
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	CALL PERFORM,V?EXAMINE,MAZE
	RTRUE

	.FUNCT CEILING-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,SLANTED-ROOM \?L3
	PRINTR "The ceiling is slanted, making the room trapezoidal in shape."
?L3:	EQUAL? HERE,PIT-OF-BONES \?L7
	PRINTR "There's an opening in the ceiling."
?L7:	EQUAL? HERE,CHAMBER-OF-THE-CIRCLE \FALSE
	PRINTR "Other than its shape, there's nothing of interest."
?L1:	EQUAL? HERE,GLASS-MAZE \?L14
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L14
	CALL PERFORM,V?EXAMINE,MAZE
	RTRUE
?L14:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	CALL PERFORM,V?LOOK
	RTRUE

	.FUNCT STAIRS-F
	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-UP \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLIMB-DOWN \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT BAT-F
	ZERO? FWEEPED /?L1
	EQUAL? PRSO,BAT \?L3
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,ME,PRSI
	RTRUE
?L3:	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,ME
	RTRUE
?L1:	EQUAL? PRSA,V?RESEARCH /?L6
	CALL YOU-CANT-SEE-ANY,STR?5 >STACK
	RSTACK
?L6:	PRINTR "The entry about bats is long and uninteresting."

	.FUNCT ME-F,OLIT
	EQUAL? PRSA,V?TELL \?L1
	PRINTI "Talking to yourself is said to be a sign of impending mental collapse."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LISTEN \?L5
	PRINTR "Yes?"
?L5:	EQUAL? PRSA,V?ALARM \?L8
	ZERO? SLEEPING /?L9
	PRINTI "As you wake up, Frobar sticks his head in the door and invites you shopping. When you return late that evening, you find the Guild Hall sacked, and many fellow Enchanters slaughtered. Servants of evil, teeth smeared with blood, fall upon you as well. A menacing voice echoes about the room. ""Pathetic Enchanters ... Who can save you now?""

Some days it just doesn't pay to wake up."
	CALL FINISH >STACK
	RSTACK
?L9:	PRINTR "You are obviously awake already."
?L8:	EQUAL? PRSA,V?RESEARCH \?L16
	PRINTR "You find several sentences mentioning your heroic defeat of the warlock Krill."
?L16:	EQUAL? PRSA,V?AIMFIZ \?L19
	PRINTI "You are suddenly "
	ZERO? FLYING /?L22
	PRINTI "floating"
	JUMP ?L26
?L22:	PRINTI "standing"
?L26:	PRINTR " right next to your former location! Wow!!"
?L19:	EQUAL? PRSA,V?VARDIK \?L31
	SET 'VARDIKED,1
	CALL QUEUE,I-UNVARDIK,12 >STACK
	PUT STACK,0,1
	PRINTR "A feeling of warmth and protection fills your mind."
?L31:	EQUAL? PRSA,V?YOMIN \?L34
	PRINTR "You sense a mind concentrating on casting the yomin spell."
?L34:	EQUAL? PRSA,V?GASPAR \?L37
	SET 'RESURRECTION-ROOM,HERE
	PRINTR "A sense of peace of mind passes over you."
?L37:	EQUAL? PRSA,V?GOLMAC \?L40
	ZERO? GOLMACKED /?L41
	CALL POOF
?L41:	SET 'GOLMACKED,1
	FCLEAR KEROSENE-LAMP,OPENBIT
	MOVE VARDIK-SCROLL,KEROSENE-LAMP
	MOVE GOLMAC-SCROLL,SLANTED-ROOM
	FCLEAR GOLMAC-SCROLL,ONBIT
	MOVE ROPE,SHAFT-BOTTOM
	MOVE BEAM,COAL-MINE-1
	SET 'ROPE-PLACED,0
	SET 'ROPE-TO-BEAM,0
	SET 'CURRENT-SETTING,0
	FCLEAR ROPE,TOUCHBIT
	FCLEAR DIAL-DOOR,OPENBIT
	SET 'DIAL-OPEN,0
	PRINTI "You are surrounded by a puff of smoke, and feel disoriented for a moment. When the smoke clears, nothing seems to have changed"
	EQUAL? HERE,SLANTED-ROOM \?L46
	PRINTI ", except that the kerosene lamp is now closed"
?L46:	PRINTR "."
?L40:	EQUAL? PRSA,V?LOWER-INTO \?L53
	EQUAL? PRSI,LOWER-CHUTE,UPPER-CHUTE \?L53
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L53:	EQUAL? PRSA,V?EXAMINE \?L54
	ZERO? FWEEPED /?L55
	PRINTR "You're batty! (And a rather large one, at that.)"
?L55:	FSET? PROTAGONIST,ONBIT \FALSE
	PRINTR "You seem to have been frotzed."
?L54:	EQUAL? PRSA,V?FROTZ \?L63
	FSET? PROTAGONIST,ONBIT /?L63
	ZERO? SLEEPING /?L64
	CALL V-SWANZO >STACK
	RSTACK
?L64:	SET 'OLIT,LIT
	SET 'ALWAYS-LIT,1
	FSET ME,ONBIT
	FSET PROTAGONIST,ONBIT
	FSET YOUNGER-SELF,ONBIT
	PRINTI "You are bathed in a sickly yellow light, bright enough to read by."
	CRLF
	CALL LIT?,HERE >LIT
	ZERO? OLIT \TRUE
	ZERO? LIT /TRUE
	CRLF
	CALL V-LOOK
	RTRUE
?L63:	EQUAL? PRSA,V?GIVE \?L72
	EQUAL? PRSI,ME \?L72
	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L73
	PRINTR "You already have it."
?L73:	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L72:	EQUAL? PRSA,V?ATTACK,V?MUNG,V?KILL \?L78
	CALL PRINT-ID,STR?6
	CALL JIGS-UP,STR?7 >STACK
	RSTACK
?L78:	EQUAL? PRSA,V?FIND \FALSE
	PRINTR "You're right here!"

	.FUNCT GRUE-F
	EQUAL? HERE,GRUE-LAIR \?L1
	CALL THIS-IS-IT,MUTATED-GRUES
?L1:	EQUAL? PRSA,V?RAISE,V?RUB,V?EXAMINE /?L6
	EQUAL? PRSA,V?TAKE,V?KICK,V?LOWER /?L6
	EQUAL? PRSA,V?LOOK-UNDER \?L4
?L6:	PRINTR "You can't see any grue here (thankfully)."
?L4:	EQUAL? PRSA,V?WHERE \?L9
	PRINTR "There is no grue here, but I'm sure there is at least one lurking in the darkness nearby. I'd stay near a light source if I were you!"
?L9:	EQUAL? PRSA,V?LISTEN \?L12
	PRINTR "It makes no sound but is always lurking in the darkness nearby."
?L12:	EQUAL? PRSA,V?FROTZ \?L15
	EQUAL? HERE,GRUE-LAIR \?L16
	PRINTI "There is a flash of light from nearby!"
	CRLF
	ZERO? LIT \?L20
	SET 'LIT,1
	CALL V-LOOK
?L20:	FSET HERE,ONBIT
	RTRUE
?L16:	ZERO? LIT /?L23
	PRINTR "There aren't any grues here -- it's light!"
?L23:	PRINTI "There's a flash of light nearby, and you glimpse a horrible, multi-fanged creature, a look of sheer terror on its face. It charges away, gurgling in agony, tearing at its glowing fur."
	CRLF
	CALL PRINT-ID,STR?8 >STACK
	RSTACK
?L15:	EQUAL? PRSA,V?RESEARCH \FALSE
	CALL PERFORM,V?RESEARCH,LOBBY
	RTRUE

	.FUNCT WATER-F
	EQUAL? PRSA,V?DRINK-FROM,V?DRINK \?L1
	PRINTR "It's dangerous to drink untested water!"
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L5
	CALL MAKE-OUT >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?FILL \?L6
	FSET? PRSO,VIALBIT \?L6
	PRINTR "A vial nymph appears to warn that water can destroy the delicate magic properties of potion vials. It wags a finger at you before vanishing."
?L6:	EQUAL? WATER,PRSI \?L9
	EQUAL? HERE,STAGNANT-POOL,HIDDEN-CAVE /?L9
	CALL WATER-IS-PRSI >STACK
	RSTACK
?L9:	EQUAL? HERE,COVE,LAGOON,LAGOON-FLOOR \?L10
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,LAGOON-OBJECT,PRSI
	RTRUE
?L10:	EQUAL? HERE,OCEAN-NORTH,OCEAN-SOUTH,MOUTH-OF-RIVER \?L11
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,OCEAN,PRSI
	RTRUE
?L11:	EQUAL? HERE,DRAWBRIDGE \?L12
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,MOAT,PRSI
	RTRUE
?L12:	EQUAL? HERE,RIVER-BANK \?L13
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,RIVER,PRSI
	RTRUE
?L13:	EQUAL? HERE,FLUME \?L14
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,FLUME-OBJECT,PRSI
	RTRUE
?L14:	EQUAL? HERE,STAGNANT-POOL \?L15
	EQUAL? PRSA,V?THROUGH \?L16
	CALL DO-WALK,P?NW >STACK
	RSTACK
?L16:	EQUAL? PRSA,V?PULVER \FALSE
	CALL PRINT-ID,STR?9
	CALL JIGS-UP,STR?10 >STACK
	RSTACK
?L15:	EQUAL? HERE,HIDDEN-CAVE \?L20
	ZERO? RIVER-EVAPORATED /?L21
	CALL YOU-CANT-SEE-ANY,STR?11 >STACK
	RSTACK
?L21:	EQUAL? PRSA,V?PULVER \?L23
	PRINTR "The water recedes for a moment, then swirls back."
?L23:	EQUAL? PRSA,V?THROUGH \FALSE
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L20:	EQUAL? HERE,RIVER-BED,TOP-OF-FALLS,STAGNANT-POOL \FALSE
	PRINTR "Hardly enough water here to get a good pulveration going."

	.FUNCT WATER-IS-PRSI
	EQUAL? HERE,COVE,LAGOON,LAGOON-FLOOR \?L1
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,LAGOON-OBJECT
	RTRUE
?L1:	EQUAL? HERE,OCEAN-NORTH,OCEAN-SOUTH,MOUTH-OF-RIVER \?L3
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,OCEAN
	RTRUE
?L3:	EQUAL? HERE,DRAWBRIDGE \?L4
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,MOAT
	RTRUE
?L4:	EQUAL? HERE,RIVER-BANK \?L5
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,RIVER
	RTRUE
?L5:	EQUAL? HERE,FLUME \FALSE
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,FLUME-OBJECT
	RTRUE

	.FUNCT SKY-F,EL
	EQUAL? PRSA,V?EXAMINE \FALSE
	FSET? HERE,INSIDEBIT \?L3
	PRINTR "That would be difficult from here."
?L3:	EQUAL? HERE,LAGOON-FLOOR \FALSE
	PRINTR "The sky is blurry but visible."

	.FUNCT BELBOZ-F
	EQUAL? PRSA,V?ASK-FOR,V?ASK-ABOUT,V?TELL /?L3
	EQUAL? PRSA,V?GIVE \?L1
?L3:	PRINTI "Belboz is in some sort of trance."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?WHO \?L6
	PRINTR "Belboz, your friend and mentor, is the head of the Circle of Enchanters. Recently, he has been acting oddly and seems to have been avoiding you."
?L6:	EQUAL? PRSA,V?ALARM \?L9
	CALL INT,I-BELBOZ-AWAKES >STACK
	PUT STACK,0,0
	CALL I-BELBOZ-AWAKES >STACK
	RSTACK
?L9:	EQUAL? PRSA,V?RESEARCH \?L10
	PRINTR "There is a small entry about Belboz, mentioning that he is the Guildmaster of the Accardi Chapter of the Guild of Enchanters, and has served three terms as kingdomwide Secretary of the Guild."
?L10:	EQUAL? PRSA,V?FIND,V?WHERE \?L13
	IN? BELBOZ,HERE /?L13
	PRINTR "You last saw Belboz a few days ago. You can't begin to guess where he is now."
?L13:	EQUAL? PRSA,V?GASPAR \?L16
	SET 'BELBOZ-GASPARED,1
	RFALSE
?L16:	EQUAL? PRSA,V?AIMFIZ \?L17
	CALL AIMFIZ-BELBOZ-JEEARR
	CALL GOTO,TWISTED-FOREST
	ADD SCORE,20 >SCORE
	CALL INT,I-PARROT >STACK
	PUT STACK,0,0
	CALL QUEUE,I-HELLHOUND,-1 >STACK
	PUT STACK,0,1
	RTRUE
?L17:	EQUAL? PRSA,V?YOMIN \?L18
	PRINTR "You get a horrifying glimpse of a monstrous creature intertwined throughout Belboz's mind. You concentrate, attempting to translate this image into visual terms, and imagine a giant spider with millions of legs, wrapped around and feasting upon the body and spirit of Belboz. The image fades, and you stagger backwards."
?L18:	EQUAL? PRSA,V?KILL \?L21
	EQUAL? PRSI,KNIFE \?L21
	CALL PRINT-ID,STR?12
	CALL KILL-BELBOZ >STACK
	RSTACK
?L21:	EQUAL? PRSA,V?SWANZO \FALSE
	CALL SWANZO-BELBOZ >STACK
	RSTACK

	.FUNCT AIMFIZ-BELBOZ-JEEARR
	PRINTI "After a momentary dizziness, you realize that your location has changed, although "
	PRINTD PRSO
	PRINTI " is not in sight..."
	CRLF
	CRLF
	RTRUE

	.FUNCT GLOBAL-ROOM-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE,V?LOOK \?L1
	CALL V-LOOK
	RTRUE
?L1:	EQUAL? PRSA,V?EXIT,V?DROP,V?THROUGH \?L3
	CALL V-WALK-AROUND >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?WALK-AROUND \FALSE
	PRINTR "Walking around the room reveals nothing new. If you want to move elsewhere, simply indicate the desired direction."

	.FUNCT ARCHWAY-F
	EQUAL? PRSA,V?CROSS,V?THROUGH \?L1
	CALL V-WALK-AROUND >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL MAKE-OUT >STACK
	RSTACK

	.FUNCT HOLE-F
	EQUAL? HERE,HOLLOW \?L1
	SET 'PERFORMING-SPELL,1
	EQUAL? HOLE,PRSO \?L3
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,BRICK-STRUCTURE,PRSI
	RTRUE
?L3:	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,BRICK-STRUCTURE
	RTRUE
?L1:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-FOO,V?THROUGH /?L7
	EQUAL? PRSA,V?CLIMB-DOWN \?L6
?L7:	EQUAL? HERE,FOREST-EDGE \?L8
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L8:	EQUAL? HERE,SLIMY-ROOM \?L10
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L10:	EQUAL? HERE,HIDDEN-CAVE \?L11
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L11:	EQUAL? HERE,PIT-OF-BONES \?L12
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L12:	EQUAL? HERE,DUNGEON \?L13
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L13:	EQUAL? HERE,LOBBY \FALSE
	CALL V-WALK-AROUND >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL MAKE-OUT >STACK
	RSTACK

	.FUNCT FOREST-F
	EQUAL? PRSA,V?MEEF \?L1
	PRINTR "You're too late -- this forest dried up eons ago."
?L1:	EQUAL? PRSA,V?THROUGH \FALSE
	EQUAL? HERE,MINE-FIELD,FOREST-EDGE \?L6
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L6:	EQUAL? HERE,TWISTED-FOREST,TREE-BRANCH \?L8
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L8:	CALL CANT-ENTER,FOREST >STACK
	RSTACK

	.FUNCT CASTLE-F
	EQUAL? PRSA,V?RESEARCH \?L1
	PRINTR "Egreth was the castle of King Duncanthrax."
?L1:	EQUAL? PRSA,V?THROUGH \FALSE
	EQUAL? HERE,DRAWBRIDGE,RUINS \?L6
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L6:	CALL LOOK-AROUND-YOU >STACK
	RSTACK

	.FUNCT CAVE-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,MOUTH-OF-RIVER,GRUE-LAIR \?L3
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L3:	EQUAL? HERE,RIVER-BED \?L5
	CALL DO-WALK,P?NE >STACK
	RSTACK
?L5:	EQUAL? HERE,PIT-OF-BONES \?L6
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L6:	EQUAL? HERE,BELBOZ-HIDEOUT \?L7
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L7:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL MAKE-OUT >STACK
	RSTACK

	.FUNCT HELISTAR-F
	EQUAL? PRSA,V?WHO \?L1
	PRINTR "Helistar is an old and powerful member of the Circle. Although a skilled and experienced magic-user, she is humorless to the point of being grim. Despite this personality flaw, Helistar is the most likely candidate to become the next Guildmaster of the Circle."
?L1:	EQUAL? PRSA,V?WHERE \?L5
	PRINTR "Helistar has gone on her annual two-week vacation. She usually goes to the southlands, Gurth and Mithicus."
?L5:	EQUAL? PRSA,V?AIMFIZ \FALSE
	CALL AIMFIZ-LOSE
	CALL PICK-ONE,HELISTARISMS >STACK
	PRINT STACK
	CALL PRINT-ID,STR?13
	CALL JIGS-UP,STR?14 >STACK
	RSTACK

	.FUNCT FROBAR-F
	EQUAL? PRSA,V?WHO \?L1
	PRINTR "Frobar is the most loyal and hard-working member of the Guild. However, he is somewhat dull and lacks imagination. It is doubtful that he would ever succeed Belboz as head of the Circle."
?L1:	EQUAL? PRSA,V?WHERE \?L5
	PRINTR "Perhaps he's gone into town to perform some errands."
?L5:	EQUAL? PRSA,V?AIMFIZ \FALSE
	CALL AIMFIZ-LOSE
	CALL PICK-ONE,FROBARISMS >STACK
	PRINT STACK
	CALL PRINT-ID,STR?15
	CALL JIGS-UP,STR?14 >STACK
	RSTACK

	.FUNCT AIMFIZ-LOSE
	PRINTI "When you recover from a brief dizziness, you notice "
	PRINTD PRSO
	PRINTI " nearby, looking surprised to see you. A moment later, you realize that "
	PRINTD PRSO
	PRINTI " is "
	RTRUE

	.FUNCT IMPLEMENTOR-F
	EQUAL? PRSA,V?AIMFIZ \?L1
	CALL PRINT-ID,STR?16
	CALL JIGS-UP,STR?17 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "Possibly the largest entry in the volume, detailing the facts and the myths about the man known as the Bearded Oracle of Yonkers."

	.FUNCT JEEARR-F
	EQUAL? PRSA,V?RESEARCH \?L1
	PRINTR "There's a long write-up in the mythology section. The evil force called Jeearr once spread pestilence and terror across many lands. Only the combined magic of many kings and wizards stopped him, even as he was preparing his final assault. He was imprisoned in the void beyond our world, his jailors warning future generations that his exile might not be permanent."
?L1:	EQUAL? PRSA,V?SWANZO \?L5
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,BELBOZ
	RTRUE
?L5:	EQUAL? PRSA,V?AIMFIZ \FALSE
	CALL AIMFIZ-BELBOZ-JEEARR
	CALL GOTO,TWISTED-FOREST
	ADD SCORE,20 >SCORE
	CALL INT,I-PARROT >STACK
	PUT STACK,0,0
	CALL QUEUE,I-HELLHOUND,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT SPELL-BOOK-F,F
	FIRST? SPELL-BOOK >F /?L1
?L1:	EQUAL? PRSA,V?EXAMINE \?L2
	PRINTI "This is the spell book given to you by Belboz after your original book was lost during your battle with Krill. "
	FSET? SPELL-BOOK,MUNGBIT \?L6
	CALL BOOK-DAMP >STACK
	RSTACK
?L6:	PRINTR "There are several spells written in the book, with marginal notes about their effects and how to cast them."
?L2:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L11
	PRINTR "Thanks to its magic properties, the spell book is always open to the right place at the right time, but it is also always closed. This innovation eliminates tedious leafing and hunting for spells in tight situations. Many wizardly lives have been saved by this advance in magical technology."
?L11:	EQUAL? PRSA,V?LOOK-INSIDE,V?READ \FALSE
	FSET? SPELL-BOOK,MUNGBIT \?L15
	CALL BOOK-DAMP
	RTRUE
?L15:	ZERO? LIT \?L17
	ZERO? BLORTED \?L17
	PRINTI "Though it is dark, the magic writing of your spells casts enough light that you can read them."
	CRLF
?L17:	CRLF
	PRINTI "My Spell Book"
	CRLF
	CRLF
	ZERO? F /TRUE
?L25:	PRINTI "The "
	PRINTD F
	PRINTI " ("
	GETP F,P?TEXT >STACK
	PRINT STACK
	PRINTI ")."
	CRLF
	NEXT? F >F /?L25
	RTRUE

	.FUNCT I-FLY
	SET 'FLYING,0
	CRLF
	EQUAL? HERE,GLASS-MAZE \?L1
	CALL NO-FLOOR? >STACK
	ZERO? STACK /?L1
	CALL PRINT-ID,STR?18
	CALL JIGS-UP,STR?19
	JUMP ?L5
?L1:	EQUAL? HERE,TREE-BRANCH \?L3
	CALL SETTLE-ONTO-BRANCH
	JUMP ?L5
?L3:	EQUAL? HERE,LAGOON \?L4
	CALL SPLASH-INTO-WATER
	JUMP ?L5
?L4:	PRINTI "You settle gently to the ground."
	CRLF
?L5:	GRTR? AWAKE,8 \FALSE
	CALL I-TIRED >STACK
	RSTACK

	.FUNCT SCROLL-F,SPELL
	EQUAL? PRSA,V?TAKE \?L1
	FIRST? PRSO >SPELL /?L3
?L3:	FSET SPELL,TOUCHBIT
	FCLEAR PRSO,TRYTAKEBIT
	EQUAL? PRSO,SWANZO-SCROLL \?L4
	ZERO? MAZE-CROSSED \?L4
	FSET PRSO,TOUCHBIT
	SET 'MAZE-CROSSED,1
	CALL REARRANGE-MAZE-TABLE
	MOVE PRSO,PROTAGONIST
	PRINTR "As you take the scroll, a deep and evil laugh rumbles around the hollow. You hear a sliding, grinding noise and turn just in time to catch a flicker of light from within the glass maze, indicating that its transparent panels have shifted around."
?L4:	EQUAL? PRSO,FWEEP-SCROLL \FALSE
	FCLEAR PRSO,TRYTAKEBIT
	FCLEAR BAT-GUANO,NDESCBIT
	RFALSE
?L1:	FIRST? PRSO >STACK /?L10
	FIRST? PRSI >STACK /?L10
	PRINTR "Bug #72"
?L10:	EQUAL? PRSA,V?GNUSTO \?L13
	FIRST? PRSO >SPELL /?L14
?L14:	CALL PERFORM,V?GNUSTO,SPELL
	RTRUE
?L13:	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	FSET? PRSO,MUNGBIT \?L16
	PRINTR "The scroll is wet and the spell illegible."
?L16:	FIRST? PRSO >SPELL /?L21
?L21:	PRINTI "The scroll reads """
	PRINTD SPELL
	PRINTI ": "
	GETP SPELL,P?TEXT >STACK
	PRINT STACK
	PRINTI """."
	EQUAL? SPELL,AIMFIZ-SPELL,YONK-SPELL \?L24
	PRINTI " The spell seems very long and extremely complicated."
?L24:	CRLF
	RTRUE

	.FUNCT ALWAYS-MEMORIZED,SPELL
	EQUAL? SPELL,GNUSTO-SPELL,FROTZ-SPELL,REZROV-SPELL \FALSE
	RTRUE

	.FUNCT SPELL-F,MEM?,FORGET=0
	EQUAL? PRSA,V?RESEARCH \?L1
	PRINTI "A spell produced by "
	CALL PICK-ONE,MANUFACTURERS >STACK
	PRINT STACK
	PRINTR "."
?L1:	EQUAL? PRSA,V?READ \?L5
	IN? PRSO,SPELL-BOOK /?L6
	LOC PRSO >STACK
	IN? STACK,PROTAGONIST /?L6
	PRINTR "You can't do that without having the spell in your book or on a scroll in your hand."
?L6:	LOC PRSO >STACK
	FSET? STACK,MUNGBIT \?L10
	CALL PERFORM,V?READ,SPELL-BOOK
	CALL THIS-IS-IT,PRSO
	RTRUE
?L10:	PRINTI "The spell reads """
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	PRINTR """."
?L5:	EQUAL? PRSA,V?LEARN \?L18
	CALL ALWAYS-MEMORIZED,PRSO >STACK
	ZERO? STACK /?L19
	PRINTR "You already know that spell by heart."
?L19:	IN? PRSO,SPELL-BOOK /?L23
	LOC PRSO >STACK
	IN? STACK,PROTAGONIST \?L24
	PRINTR "You can't memorize a spell until you've written it into your spell book."
?L24:	CALL V-LEARN >STACK
	RSTACK
?L23:	IN? SPELL-BOOK,PROTAGONIST /?L29
	PRINTR "You don't have your spell book. How do you expect to learn a spell without a spell book?"
?L29:	ZERO? LIT \?L32
	ZERO? BLORTED \?L32
	PRINTR "You can't learn it in the dark."
?L32:	FSET? SPELL-BOOK,MUNGBIT \?L35
	CALL PERFORM,V?READ,SPELL-BOOK
	CALL THIS-IS-IT,PRSO
	RTRUE
?L35:	GETP PRSO,P?COUNT >MEM?
	ZERO? SPELL-ROOM \?L37
	EQUAL? SPELL-MAX,1 \?L39
	PRINTR "You can't concentrate well enough to learn the spell."
?L39:	EQUAL? MEM?,SPELL-MAX \?L43
	PRINTR "You try and try, but you just can't memorize those complex syllables again. They slip playfully out of your memory as soon as you cram them in."
?L43:	CALL FORGET-SPELL,PRSO
	INC 'MEM?
	PUTP PRSO,P?COUNT,MEM?
	SET 'FORGET,1
	JUMP ?L47
?L37:	DEC 'SPELL-ROOM
	INC 'MEM?
	PUTP PRSO,P?COUNT,MEM?
?L47:	PRINTI "Using your best study habits, you learn the "
	PRINTD PRSO
	GRTR? MEM?,1 \?L50
	PRINTI " yet another time"
?L50:	PRINTI "."
	CRLF
	ZERO? FORGET /TRUE
	PRINTR "You have so much buzzing around in your head, though, that it's likely that something may have been forgotten in the shuffle."
?L18:	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK \?L62
	EQUAL? PRSA,V?CAST /?L62
	PRINTR "You can't see that spell here!"
?L62:	EQUAL? PRSA,V?THROW,V?DROP,V?TAKE \FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT FORGET-SPELL,SPL,NSPL,F,CNT,TBL,NUM=0,SP=0
	FIRST? SPELL-BOOK >F /?L1
?L1:	SET 'TBL,FORGET-TBL
	ZERO? F /?L3
?L4:	GETP F,P?COUNT >CNT
	GRTR? CNT,0 \?L8
?L7:	SET 'SP,F
	PUT TBL,1,F
	INC 'NUM
	ADD TBL,2 >TBL
	DLESS? 'CNT,1 \?L7
?L8:	NEXT? F >F /?L4
?L3:	GRTR? NUM,0 \?L14
	GETP SP,P?COUNT >STACK
	EQUAL? STACK,NUM \?L14
	SUB NUM,1 >STACK
	PUTP SP,P?COUNT,STACK
	RTRUE
?L14:	PUT FORGET-TBL,0,NUM
	ZERO? NUM /TRUE
?L17:	CALL PICK-ONE,FORGET-TBL >NSPL
	EQUAL? NSPL,SPL /?L17
	GETP NSPL,P?COUNT >STACK
	DEC 'STACK
	PUTP NSPL,P?COUNT,STACK
	RTRUE

	.FUNCT FORGET-ALL,F
	SET 'SPELL-ROOM,SPELL-MAX
	FIRST? SPELL-BOOK >F \TRUE
?L4:	PUTP F,P?COUNT,0
	NEXT? F >F /?L4
	RTRUE

	.FUNCT WEAR-OFF-SPELLS
	SET 'UNDER-INFLUENCE,0
	SET 'FLYING,0
	SET 'FWEEPED,0
	SET 'VARDIKED,0
	SET 'VILSTUED,0
	SET 'BLORTED,0
	SET 'FOOBLED,0
	CALL INT,I-FLY >STACK
	PUT STACK,0,0
	CALL INT,I-UNFWEEP >STACK
	PUT STACK,0,0
	CALL INT,I-UNVARDIK >STACK
	PUT STACK,0,0
	CALL INT,I-BREATHE >STACK
	PUT STACK,0,0
	CALL INT,I-UNBLORT >STACK
	PUT STACK,0,0
	CALL INT,I-UNFOOBLE >STACK
	PUT STACK,0,0
	SET 'GNOME-SLEEPING,1
	CALL INT,I-GNOME >STACK
	PUT STACK,0,0
	MOVE PARK-GNOME,DIAL
	CALL INT,I-PARK-GNOME >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT READ-ABOUT-POTIONS,NUM,MAKER
	GET POTION-MAKERS,NUM >MAKER
	PRINTI "A potion made by "
	PRINT MAKER
	PRINTR "."

	.FUNCT POTION-POUR,VIAL
	CALL HELD?,VIAL >STACK
	ZERO? STACK \?L1
	CALL THIS-IS-IT,VIAL
	PRINT YNH
	CALL ARTICLE,VIAL,1
	PRINTR "."
?L1:	MOVE PRSO,DIAL
	PRINTI "The potion evaporates before it even reaches"
	ZERO? PRSI /?L10
	CALL ARTICLE,PRSI,1
	PRINTR "."
?L10:	PRINTR " the ground."

	.FUNCT TWO-POTIONS
	PRINTI "Uh oh. The "
	PRINTD PRSO
	PRINTI " seems to be having an unpleasant reaction with the "
	PRINTD UNDER-INFLUENCE
	PRINTI ". "
	CALL PICK-ONE,POTION-REACTIONS >STACK
	PRINT STACK
	CALL PRINT-ID,STR?20
	CALL JIGS-UP,STR?14 >STACK
	RSTACK

	.FUNCT GLOBAL-SLEEP-F
	EQUAL? PRSA,V?TAKE,V?WALK-TO \?L1
	IN? PROTAGONIST,YOUR-QUARTERS \?L3
	MOVE PROTAGONIST,BED
?L3:	CALL PERFORM,V?SLEEP
	RTRUE
?L1:	EQUAL? PRSA,V?FIND \FALSE
	PRINTR "Sleep anywhere."

	.FUNCT I-TIRED,FORG=0
	IN? PROTAGONIST,BED \?L1
	CRLF
	PRINTI "The bed is comfortable and you are becoming tired."
	CRLF
	CALL PRINT-ID,STR?21
	INC 'AWAKE
	CALL V-SLEEP,1
	RETURN 2
?L1:	GRTR? LOAD-ALLOWED,10 \?L8
	SUB LOAD-ALLOWED,10 >LOAD-ALLOWED
?L8:	GRTR? FUMBLE-NUMBER,1 \?L11
	DEC 'FUMBLE-NUMBER
?L11:	GRTR? SPELL-MAX,1 \?L19
	DEC 'SPELL-MAX
	ZERO? SPELL-ROOM /?L42
	DEC 'SPELL-ROOM
	ZERO? SPELL-ROOM \?L19
?L42:	SET 'FORG,1
?L19:	CALL QUEUE,I-TIRED,8 >STACK
	PUT STACK,0,1
	IGRTR? 'AWAKE,8 \?L23
	ZERO? FLYING /?L25
	CALL QUEUE,I-TIRED,14 >STACK
	PUT STACK,0,1
	RFALSE
?L25:	CRLF
	PRINTI "You drop in your tracks from exhaustion."
	CRLF
	CRLF
	CALL PRINT-ID,STR?22
	CALL V-SLEEP
	RETURN 2
?L23:	CRLF
	PRINTI "You are "
	GET TIRED-TELL,AWAKE >STACK
	PRINT STACK
	ZERO? FORG /?L35
	PRINTI " and the spells you've memorized are becoming confused"
?L35:	PRINTR "."

	.FUNCT I-HUNGER
	ZERO? BERZIOED /?L1
	SET 'HUNGER-LEVEL,0
	RANDOM 80 >STACK
	ADD 580,STACK >STACK
	CALL QUEUE,I-HUNGER,STACK >STACK
	PUT STACK,0,1
	RFALSE
?L1:	EQUAL? HUNGER-LEVEL,6 \?L3
	SET 'THIRST-LEVEL,6
	CALL I-THIRST >STACK
	RSTACK
?L3:	CALL QUEUE,I-HUNGER,11 >STACK
	PUT STACK,0,1
	CALL HUNGER-THIRST-WARNING,HUNGER-LEVEL,1
	INC 'HUNGER-LEVEL
	RETURN HUNGER-LEVEL

	.FUNCT I-THIRST
	ZERO? BERZIOED /?L1
	SET 'THIRST-LEVEL,0
	RANDOM 100 >STACK
	ADD 540,STACK >STACK
	CALL QUEUE,I-THIRST,STACK >STACK
	PUT STACK,0,1
	RFALSE
?L1:	EQUAL? THIRST-LEVEL,6 \?L3
	CRLF
	CALL PRINT-ID,STR?23
	CALL JIGS-UP,STR?24,1 >STACK
	RSTACK
?L3:	CALL QUEUE,I-THIRST,9 >STACK
	PUT STACK,0,1
	CALL HUNGER-THIRST-WARNING,THIRST-LEVEL
	INC 'THIRST-LEVEL
	RETURN THIRST-LEVEL

	.FUNCT HUNGER-THIRST-WARNING,LEVEL,HUNGRY=0
	CRLF
	PRINTI "You are now "
	GET HUNGER-THIRST-TABLE,LEVEL >STACK
	PRINT STACK
	ZERO? HUNGRY /?L3
	PRINTI " hungry"
	CALL PRINT-ID,STR?25
	JUMP ?L7
?L3:	PRINTI " thirsty"
	CALL PRINT-ID,STR?26
?L7:	PRINTR "."

	.FUNCT SPELL-CHECK,TBL,WRD,OBJ=0
	EQUAL? WRD,W?GNUSTO \?L1
	SET 'OBJ,GNUSTO-SPELL
	JUMP ?L17
?L1:	EQUAL? WRD,W?FROTZ \?L3
	SET 'OBJ,FROTZ-SPELL
	JUMP ?L17
?L3:	EQUAL? WRD,W?REZROV \?L4
	SET 'OBJ,REZROV-SPELL
	JUMP ?L17
?L4:	EQUAL? WRD,W?IZYUK \?L5
	SET 'OBJ,IZYUK-SPELL
	JUMP ?L17
?L5:	EQUAL? WRD,W?AIMFIZ \?L6
	SET 'OBJ,AIMFIZ-SPELL
	JUMP ?L17
?L6:	EQUAL? WRD,W?FWEEP \?L7
	SET 'OBJ,FWEEP-SPELL
	JUMP ?L17
?L7:	EQUAL? WRD,W?SWANZO \?L8
	SET 'OBJ,SWANZO-SPELL
	JUMP ?L17
?L8:	EQUAL? WRD,W?GOLMAC \?L9
	SET 'OBJ,GOLMAC-SPELL
	JUMP ?L17
?L9:	EQUAL? WRD,W?VARDIK \?L10
	SET 'OBJ,VARDIK-SPELL
	JUMP ?L17
?L10:	EQUAL? WRD,W?PULVER \?L11
	SET 'OBJ,PULVER-SPELL
	JUMP ?L17
?L11:	EQUAL? WRD,W?MEEF \?L12
	SET 'OBJ,MEEF-SPELL
	JUMP ?L17
?L12:	EQUAL? WRD,W?VEZZA \?L13
	SET 'OBJ,VEZZA-SPELL
	JUMP ?L17
?L13:	EQUAL? WRD,W?GASPAR \?L14
	SET 'OBJ,GASPAR-SPELL
	JUMP ?L17
?L14:	EQUAL? WRD,W?YOMIN \?L15
	SET 'OBJ,YOMIN-SPELL
	JUMP ?L17
?L15:	EQUAL? WRD,W?YONK \?L16
	SET 'OBJ,YONK-SPELL
	JUMP ?L17
?L16:	EQUAL? WRD,W?MALYON \?L17
	SET 'OBJ,MALYON-SPELL
?L17:	ZERO? OBJ /TRUE
	CALL OBJ-FOUND,OBJ,TBL
	RTRUE

	.FUNCT V-VERBOSE
	SET 'VERBOSE,1
	SET 'SUPER-BRIEF,0
	PRINTI "Maximum verbosity."
	CRLF
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT V-BRIEF
	SET 'VERBOSE,0
	SET 'SUPER-BRIEF,0
	PRINTR "Brief descriptions."

	.FUNCT V-SUPER-BRIEF
	SET 'SUPER-BRIEF,1
	PRINTR "Superbrief descriptions."

	.FUNCT V-DIAGNOSE,BOTH=0
	LESS? AWAKE,0 \?L1
	PRINTI "You are wide awake"
	JUMP ?L5
?L1:	PRINTI "You are "
	GET TIRED-TELL,AWAKE >STACK
	PRINT STACK
?L5:	PRINTI ", and you are in good health."
	GRTR? HUNGER-LEVEL,0 /?L12
	GRTR? THIRST-LEVEL,0 \?L10
?L12:	PRINTI " You feel "
	GRTR? HUNGER-LEVEL,0 \?L15
	SET 'BOTH,1
	GET HUNGER-THIRST-TABLE,HUNGER-LEVEL >STACK
	PRINT STACK
	PRINTI " hungry"
?L15:	GRTR? THIRST-LEVEL,0 \?L22
	ZERO? BOTH /?L24
	PRINTI ", and "
?L24:	GET HUNGER-THIRST-TABLE,THIRST-LEVEL >STACK
	PRINT STACK
	PRINTI " thirsty"
?L22:	PRINTI "."
?L10:	ZERO? BITTEN /?L37
	PRINTI " You have a small bite on your hand which doesn't seem too serious."
?L37:	CRLF
	RTRUE

	.FUNCT V-INVENTORY
	FIRST? PROTAGONIST >STACK \?L1
	CALL PRINT-CONT,PROTAGONIST >STACK
	RSTACK
?L1:	PRINTI "You are empty-"
	ZERO? FWEEPED /?L6
	PRINTI "taloned"
	JUMP ?L10
?L6:	PRINTI "handed"
?L10:	PRINTR "."

	.FUNCT V-QUIT
	CALL V-SCORE
	CALL DO-YOU-WISH,STR?27
	CALL YES? >STACK
	ZERO? STACK /?L1
	QUIT
?L1:	PRINTR "Ok."

	.FUNCT V-RESTART
	CALL V-SCORE
	CALL DO-YOU-WISH,STR?28
	CALL YES? >STACK
	ZERO? STACK /FALSE
	PRINTI "Restarting."
	CRLF
	RESTART

	.FUNCT DO-YOU-WISH,STRING
	CRLF
	PRINTI "Do you wish to "
	PRINT STRING
	PRINTI "? (Y is affirmative): "
	RTRUE

	.FUNCT FINISH,REPEATING=0
	CRLF
	ZERO? REPEATING \?L1
	CALL V-SCORE
	CRLF
?L1:	PRINTI "[EVENT: GAME OVER]Would you like to restart the game from the beginning, restore a saved game position, or end this session of the game? (Type RESTART, RESTORE, or QUIT):

>"
	PUTB P-INBUF,0,10
	READ P-INBUF,P-LEXV
	PUTB P-INBUF,0,60
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?RESTAR \?L6
	RESTART
?L6:	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?RESTOR \?L10
	CALL V-RESTORE
	CALL FINISH,1 >STACK
	RSTACK
?L10:	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?QUIT,W?Q \?L11
	QUIT
?L11:	CALL FINISH,1 >STACK
	RSTACK

	.FUNCT YES?
?L0:	PRINTI ">"
	PUTB P-INBUF,0,10
	READ P-INBUF,P-LEXV
	PUTB P-INBUF,0,60
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?YES,W?Y /TRUE
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?NO,W?N /FALSE
	PRINTI "Please type YES or NO."
	CRLF
	CRLF
	JUMP ?L0

	.FUNCT V-RESTORE
	RESTORE /FALSE
	PRINTR "Failed."

	.FUNCT V-SAVE
	SAVE \?L1
	PRINTR "Ok."
?L1:	PRINTR "Failed."

	.FUNCT V-SCORE
	ZERO? POOFED /?L1
	PRINTI "If you still existed, your score would be "
	JUMP ?L5
?L1:	PRINTI "Your score is "
?L5:	PRINTN SCORE
	PRINTI " of a possible 400, in "
	PRINTN MOVES
	PRINTI " move"
	EQUAL? MOVES,1 /?L10
	PRINTI "s"
?L10:	PRINTI ". This puts you in the class of "
	LESS? SCORE,0 \?L17
	PRINTI "Menace to Society"
	JUMP ?L21
?L17:	DIV SCORE,50 >STACK
	GET RANKINGS,STACK >STACK
	PRINT STACK
?L21:	PRINTR "."

	.FUNCT V-SCRIPT
	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	PRINTI "Here begins"
	PRINT COPR-NOTICE
	CRLF
	CALL V-VERSION >STACK
	RSTACK

	.FUNCT V-UNSCRIPT
	PRINTI "Here ends"
	PRINT COPR-NOTICE
	CRLF
	CALL V-VERSION
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT V-VERSION,CNT=17
	PRINTI "SORCERER
Infocom interactive fiction - a fantasy story
Copyright (c) 1984 by Infocom, Inc. All rights reserved.
SORCERER is a trademark of Infocom, Inc.
Release "
	GET 0,1 >STACK
	BAND STACK,2047 >STACK
	PRINTN STACK
	PRINTI " / Serial number "
?L5:	IGRTR? 'CNT,23 /?L6
	GETB 0,CNT >STACK
	PRINTC STACK
	JUMP ?L5
?L6:	CRLF
	RTRUE

	.FUNCT V-$0024VERIFY
	EQUAL? PRSO,INTNUM \?L1
	EQUAL? P-NUMBER,502 \?L1
	PRINTN SERIAL
	CRLF
	RTRUE
?L1:	PRINTI "Performing the VERIFY spell..."
	CRLF
	VERIFY \?L8
	PRINTR "Good."
?L8:	CRLF
	PRINTR "** Bad **"

	.FUNCT V-$0024COMMAND
	DIRIN 1
	RTRUE

	.FUNCT V-$0024RANDOM
	EQUAL? PRSO,INTNUM /?L1
	PRINTR "Illegal call to #RANDOM."
?L1:	SUB 0,P-NUMBER >STACK
	RANDOM STACK >STACK
	RTRUE

	.FUNCT V-$0024RECORD
	DIROUT D-RECORD-ON
	RTRUE

	.FUNCT V-$0024UNRECORD
	DIROUT D-RECORD-OFF
	RTRUE

	.FUNCT V-ALARM
	EQUAL? PRSO,ROOMS \?L1
	CALL PERFORM,V?ALARM,ME
	RTRUE
?L1:	PRINTI "I don't think that"
	CALL ARTICLE,PRSO,1
	PRINTR " is sleeping."

	.FUNCT V-ANSWER
	PRINTI "Nobody seems to be awaiting your answer."
	CRLF
	CALL STOP >STACK
	RSTACK

	.FUNCT V-ASK-ABOUT
	EQUAL? PRSO,ME \?L1
	CALL PERFORM,V?TELL,ME
	RTRUE
?L1:	FSET? PRSO,ACTORBIT \?L3
	PRINTI "After a moment's thought,"
	CALL ARTICLE,PRSO,1
	PRINTI " denies any knowledge of"
	CALL ARTICLE,PRSI,1
	PRINTI "."
	EQUAL? PRSO,PRSI \?L10
	PRINTI " (Rather disingenuous, if you ask me.)"
?L10:	CRLF
	RTRUE
?L3:	CALL PERFORM,V?TELL,PRSO
	RTRUE

	.FUNCT V-ASK-FOR
	EQUAL? PRSO,YOUNGER-SELF \?L1
	EQUAL? PRSI,SPELL-BOOK \?L1
	CALL SPELL-BOOK-PASS-OFF-CHECK >STACK
	ZERO? STACK \TRUE
?L1:	PRINTI "Unsurprisingly,"
	CALL ARTICLE,PRSO,1
	PRINTR " is not likely to oblige."

	.FUNCT V-ATTACK
	CALL IKILL,STR?29 >STACK
	RSTACK

	.FUNCT V-BITE,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?30,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?31,STACK
	CALL HACK-HACK,STR?32 >STACK
	RSTACK

	.FUNCT PRE-BOARD,AV
	LOC PROTAGONIST >AV
	FSET? PRSO,VEHBIT \?L1
	ZERO? FLYING /?L3
	CALL WHILE-FLYING
	RETURN 2
?L3:	FSET? AV,VEHBIT \FALSE
	PRINTI "You are already in"
	CALL ARTICLE,PRSO,1
	PRINTI "!"
	CRLF
	RETURN 2
?L1:	PRINTI "You can't get into"
	CALL ARTICLE,PRSO,1
	PRINTI "!"
	CRLF
	RETURN 2

	.FUNCT V-BOARD
	MOVE PROTAGONIST,PRSO
	PRINTI "You are now in"
	CALL ARTICLE,PRSO,1
	PRINTI "."
	CRLF
	GETP PRSO,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	RSTACK

	.FUNCT V-BURN
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?33,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?34,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?35,STACK
	ZERO? PRSI \?L1
	PRINTR "Your blazing gaze is insufficient."
?L1:	CALL WITH??? >STACK
	RSTACK

	.FUNCT V-CHASTISE
	PRINTR "Use prepositions to indicate precisely what you want to do: LOOK AT the object, LOOK INSIDE it, LOOK UNDER it, etc."

	.FUNCT V-CLIMB-DOWN
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L1:	CALL V-DEFLATE >STACK
	RSTACK

	.FUNCT V-CLIMB-FOO
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	CALL V-DEFLATE >STACK
	RSTACK

	.FUNCT V-CLIMB-ON
	FSET? PRSO,VEHBIT \?L1
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L1:	PRINTI "You can't climb onto"
	CALL ARTICLE,PRSO,1
	PRINTR "."

	.FUNCT V-CLIMB-OVER
	PRINTR "You can't do that."

	.FUNCT V-CLIMB-UP
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	CALL V-DEFLATE >STACK
	RSTACK

	.FUNCT V-CLOSE
	FSET? PRSO,SCROLLBIT \?L1
	CALL TELL-ME-HOW >STACK
	RSTACK
?L1:	FSET? PRSO,ACTORBIT \?L3
	PRINTR "Huh?"
?L3:	FSET? PRSO,SURFACEBIT \?L6
	PRINTI "There's no way to close"
	CALL ARTICLE,PRSO
	PRINTR "."
?L6:	FSET? PRSO,DOORBIT \?L11
	FSET? PRSO,OPENBIT \?L12
	PRINTI "Okay,"
	CALL ARTICLE,PRSO,1
	PRINTI " is now closed."
	CRLF
	FCLEAR PRSO,OPENBIT
	RTRUE
?L12:	CALL ALREADY-CLOSED >STACK
	RSTACK
?L11:	FSET? PRSO,CONTBIT /?L20
	EQUAL? PRSO,JOURNAL \?L19
?L20:	FSET? PRSO,OPENBIT \?L21
	FCLEAR PRSO,OPENBIT
	PRINTI "Closed."
	CALL LIT?,HERE >LIT
	ZERO? LIT \?L25
	ZERO? BLORTED \?L25
	PRINTI " "
	CALL NOW-BLACK
?L25:	CRLF
	RTRUE
?L21:	CALL ALREADY-CLOSED >STACK
	RSTACK
?L19:	CALL TELL-ME-HOW >STACK
	RSTACK

	.FUNCT V-COMBO
	IN? YOUNGER-SELF,HERE \?L1
	EQUAL? PRSO,INTNUM \?L1
	PRINTR "Don't tell me. Talk to your confused twin over there."
?L1:	PRINTR "What are you talking about?"

	.FUNCT V-COMPARE
	CALL V-SIT >STACK
	RSTACK

	.FUNCT V-COUNT
	PRINTR "You have lost your mind."

	.FUNCT V-CROSS
	PRINTR "You can't cross that!"

	.FUNCT V-CURSE
	PRINTI "Such language from an Enchanter!"
	CRLF
	CALL PRINT-ID,STR?36 >STACK
	RSTACK

	.FUNCT V-CUT
	FSET? PRSO,ACTORBIT \?L1
	CALL PERFORM,V?KILL,PRSO,PRSI
	RTRUE
?L1:	FSET? PRSO,SCROLLBIT \?L3
	FSET? PRSI,WEAPONBIT \?L9
	MOVE PRSO,DIAL
	PRINTI "Your skillful"
	PRINTD PRSI
	PRINTI "smanship slices"
	CALL ARTICLE,PRSO,1
	PRINTI " into slivers, which vanish."
	CRLF
	CALL PRINT-ID,STR?37 >STACK
	RSTACK
?L3:	FSET? PRSI,WEAPONBIT /?L8
?L9:	PRINTI "I doubt that the ""cutting edge"" of"
	CALL ARTICLE,PRSI
	PRINTR " is adequate."
?L8:	PRINTI "Strange concept, cutting"
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?38,STACK
	CALL ARTICLE,PRSO,1
	PRINTR "...."

	.FUNCT V-DEFLATE
	PRINTR "Bizarre."

	.FUNCT V-DIG
	ZERO? FLYING /?L1
	CALL WHILE-FLYING >STACK
	RSTACK
?L1:	CALL V-SIT >STACK
	RSTACK

	.FUNCT V-DISEMBARK
	LOC PROTAGONIST >STACK
	EQUAL? STACK,PRSO /?L1
	CALL LOOK-AROUND-YOU
	RETURN 2
?L1:	PRINTI "You are now on your feet."
	CRLF
	MOVE PROTAGONIST,HERE
	RTRUE

	.FUNCT V-DRINK,S
	PRINTR "You can't drink that!"

	.FUNCT V-DRINK-FROM,X
	EQUAL? PRSO,WATER \?L1
	CALL PERFORM,V?DRINK,PRSO
	RTRUE
?L1:	FSET? PRSO,VIALBIT \?L3
	FSET? PRSO,OPENBIT \?L4
	FIRST? PRSO >STACK \?L6
	FIRST? PRSO >X /?L8
?L8:	CALL PERFORM,V?DRINK,X
	RTRUE
?L6:	PRINTR "The vial is empty."
?L4:	PRINTR "The vial is closed!"
?L3:	PRINTR "How peculiar!"

	.FUNCT V-DROP
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	EQUAL? HERE,COAL-BIN-ROOM,DIAL-ROOM \?L3
	GETP PRSO,P?SIZE >STACK
	LESS? STACK,20 \?L3
	CALL BURIED-IN-COAL,STR?39 >STACK
	RSTACK
?L3:	EQUAL? HERE,HAUNTED-HOUSE \?L6
	MOVE PRSO,DIAL
?L6:	PRINTR "Dropped."

	.FUNCT V-EAT
	PRINTI "Did they teach you to eat that in survival school?"
	CRLF
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?40,STACK >STACK
	RSTACK

	.FUNCT V-ENTER,VEHICLE
	CALL FIND-IN,HERE,VEHBIT >VEHICLE
	ZERO? VEHICLE /?L1
	CALL PERFORM,V?BOARD,VEHICLE
	RTRUE
?L1:	CALL DO-WALK,P?IN >STACK
	RSTACK

	.FUNCT PRE-EXAMINE
	ZERO? LIT \FALSE
	ZERO? BLORTED \FALSE
	CALL TOO-DARK >STACK
	RSTACK

	.FUNCT V-EXAMINE
	GETP PRSO,P?TEXT >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?READ,PRSO
	RTRUE
?L1:	FSET? PRSO,DOORBIT \?L3
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L3:	FSET? PRSO,CONTBIT \?L4
	FSET? PRSO,OPENBIT \?L5
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L5:	PRINTR "It's closed."
?L4:	FSET? PRSO,ONBIT \?L10
	PRINTI "Someone must have cast the frotz spell on"
	CALL ARTICLE,PRSO,1
	PRINTR ", because it is glowing brightly."
?L10:	PRINTI "You see nothing special about"
	CALL ARTICLE,PRSO,1
	PRINTR "."

	.FUNCT V-EXIT
	FSET? PRSO,VEHBIT \?L1
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L1:	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-EXORCISE
	PRINTR "You can't do that with mere words!"

	.FUNCT V-FILL
	ZERO? PRSI \?L1
	CALL GLOBAL-IN?,WATER,HERE >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?FILL,PRSO,WATER
	RTRUE
?L3:	PRINTR "There's nothing to fill it with."
?L1:	PRINTR "Huh?"

	.FUNCT V-FIND,WHERE=0,L
	LOC PRSO >L
	EQUAL? PRSO,HANDS \?L1
	PRINTR "Within six feet of your head, assuming you haven't left that somewhere."
?L1:	EQUAL? PRSO,ME \?L5
	PRINTR "You're around here somewhere..."
?L5:	IN? PRSO,PROTAGONIST \?L8
	PRINTR "You have it!"
?L8:	IN? PRSO,HERE /?L12
	EQUAL? PRSO,PSEUDO-OBJECT \?L11
?L12:	FSET? PRSO,ACTORBIT \?L13
	PRINTI "He's"
	JUMP ?L17
?L13:	PRINTI "It's"
?L17:	PRINTR " right in front of you."
?L11:	IN? PRSO,LOCAL-GLOBALS \?L22
	PRINTR "You're the magician!"
?L22:	FSET? L,ACTORBIT \?L25
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L25
	PRINTI "As far as you can tell,"
	CALL ARTICLE,L,1
	PRINTR " has it."
?L25:	FSET? L,CONTBIT \?L30
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L30
	PRINTI "It's in"
	CALL ARTICLE,L,1
	PRINTR "."
?L30:	ZERO? WHERE /?L35
	PRINTR "Beats me."
?L35:	PRINTR "You'll have to do that yourself."

	.FUNCT V-FIRST-LOOK
	CALL DESCRIBE-ROOM >STACK
	ZERO? STACK /FALSE
	ZERO? SUPER-BRIEF \FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT V-FLY
	ZERO? PRSO /?L3
	EQUAL? PRSO,ME \?L1
?L3:	ZERO? FLYING /?L4
	PRINTR "You are!"
?L4:	PRINTR "Perhaps a spell would be useful..."
?L1:	EQUAL? PRSO,P-DIRECTION \?L11
	CALL PERFORM,V?WALK,PRSO
	RTRUE
?L11:	PRINTI "You can't make"
	CALL ARTICLE,PRSO,1
	PRINTR " fly!"

	.FUNCT V-FOLLOW
	IN? PRSO,HERE \?L1
	PRINTI "But"
	CALL ARTICLE,PRSO,1
	PRINTR " is right here!"
?L1:	EQUAL? PRSO,TURRET \?L7
	ZERO? MAILMAN-FOLLOW /?L7
	CALL DO-WALK,P?SOUTH >STACK
	RSTACK
?L7:	CALL V-SIT >STACK
	RSTACK

	.FUNCT V-FORGET
	PRINTR "You might also try not thinking about a purple hippopotamus!"

	.FUNCT PRE-GIVE
	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L1
	PRINTR "That's easy for you to say since you don't even have it."
?L1:	FSET? PRSO,SPELLBIT \FALSE
	PRINTR "The spell is permanently inscribed in your spell book!"

	.FUNCT V-GIVE
	FSET? PRSI,ACTORBIT /?L1
	PRINTI "You can't give"
	CALL ARTICLE,PRSO
	PRINTI " to"
	CALL ARTICLE,PRSI
	PRINTR "!"
?L1:	PRINTI "Politely,"
	CALL ARTICLE,PRSI,1
	PRINTR " refuses your offer."

	.FUNCT V-HELLO
	ZERO? PRSO /?L1
	FSET? PRSO,ACTORBIT \?L3
	PRINTI "Silently,"
	CALL ARTICLE,PRSO,1
	PRINTR " bows his head to you in greeting."
?L3:	PRINTI "Only schizophrenics say ""Hello"" to"
	CALL ARTICLE,PRSO
	PRINTR "."
?L1:	CALL PICK-ONE,HELLOS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-HELP
	PRINTR "If you're really stuck, maps and InvisiClues hint booklets are available. If you have misplaced the order form that came in your package, send us a  note at:
  P.O. Box 620
  Garden City, NY 11530
  Dept. Z5
and we'll be happy to send you an order form."

	.FUNCT V-HIDE
	ZERO? PRSO \?L1
	PRINTI "There's no place to hide here."
	CRLF
	RETURN 2
?L1:	ZERO? PRSI /?L13
	FSET? PRSI,ACTORBIT \?L7
	PRINTI "Why hide it when"
	CALL ARTICLE,PRSI,1
	PRINTR " isn't interested in it."
?L7:	ZERO? PRSI \FALSE
?L13:	PRINTR "From what? From whom? Why?"

	.FUNCT V-INFLATE
	PRINTR "How can you inflate that?"

	.FUNCT V-KICK,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?41,STACK
	CALL HACK-HACK,STR?42 >STACK
	RSTACK

	.FUNCT V-KILL
	CALL IKILL,STR?43 >STACK
	RSTACK

	.FUNCT IKILL,STR
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?44,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?45,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?46,STACK
	ZERO? PRSO \?L1
	PRINTI "There is nothing here to "
	PRINT STR
	PRINTI "."
	CRLF
	JUMP ?L5
?L1:	ZERO? PRSI \?L5
	CALL HELD?,KNIFE >STACK
	ZERO? STACK /?L5
	SET 'PRSI,KNIFE
	PRINTI "(with the "
	PRINTD PRSI
	PRINTI ")"
	CRLF
	CALL PERFORM,V?KILL,PRSO,PRSI
	RTRUE
?L5:	FSET? PRSO,ACTORBIT /?L9
	EQUAL? PRSO,BOA,HELLHOUND,DORN-BEAST /?L9
	PRINTI "I've known strange people, but fighting"
	CALL ARTICLE,PRSO
	PRINTR "?"
?L9:	ZERO? PRSI /?L16
	EQUAL? PRSI,HANDS \?L15
?L16:	PRINTI "Trying to "
	PRINT STR
	CALL ARTICLE,PRSO
	PRINTR " with your bare hands is suicidal."
?L15:	IN? PRSI,PROTAGONIST /?L21
	PRINTI "You aren't even holding"
	CALL ARTICLE,PRSI,1
	PRINTR "."
?L21:	FSET? PRSI,WEAPONBIT /?L26
	PRINTI "Trying to "
	PRINT STR
	CALL ARTICLE,PRSO,1
	PRINTI " with"
	CALL ARTICLE,PRSI
	PRINTR " is suicidal."
?L26:	PRINTR "You'd never survive the attack."

	.FUNCT V-KNOCK
	FSET? PRSO,DOORBIT \?L1
	PRINTI "Nobody's home."
	CRLF
	CALL PRINT-ID,STR?47 >STACK
	RSTACK
?L1:	PRINTI "Why knock on"
	CALL ARTICLE,PRSO
	PRINTR "?"

	.FUNCT V-KISS
	PRINTI "I'd sooner kiss a pig."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?48,STACK >STACK
	RSTACK

	.FUNCT V-LAMP-OFF
	FSET? PRSO,LIGHTBIT \?L1
	FSET? PRSO,ONBIT /?L3
	PRINTR "It is already off."
?L3:	FCLEAR PRSO,ONBIT
	ZERO? LIT /?L8
	CALL LIT?,HERE >LIT
?L8:	PRINTI "Okay,"
	CALL ARTICLE,PRSO,1
	PRINTI " is now off."
	CRLF
	CALL LIT?,HERE >LIT
	ZERO? LIT \TRUE
	ZERO? BLORTED \TRUE
	CALL NOW-BLACK
	CRLF
	RTRUE
?L1:	FSET? PRSO,ONBIT \?L18
	PRINTR "How? It's glowing by magic."
?L18:	PRINTR "You can't turn that off."

	.FUNCT V-LAMP-ON
	FSET? PRSO,LIGHTBIT \?L1
	FSET? PRSO,ONBIT \?L3
	PRINTR "It is already on."
?L3:	FSET PRSO,ONBIT
	PRINTI "Okay,"
	CALL ARTICLE,PRSO,1
	PRINTI " is now on."
	CRLF
	ZERO? LIT \TRUE
	ZERO? BLORTED \TRUE
	CALL LIT?,HERE >LIT
	CRLF
	CALL V-LOOK
	RTRUE
?L1:	PRINTR "You can't turn that on."

	.FUNCT V-LAND
	ZERO? FLYING /?L1
	PRINTR "You'll have to wait for the spell to wear off."
?L1:	CALL LOOK-AROUND-YOU >STACK
	RSTACK

	.FUNCT V-LAUNCH
	FSET? PRSO,VEHBIT \?L1
	PRINTR "You can't launch that by saying ""launch""!"
?L1:	PRINTR "Huh?"

	.FUNCT V-LEAN-ON
	PRINTR "Are you so very tired, then?"

	.FUNCT V-LEAP
	ZERO? FLYING /?L1
	CALL WHILE-FLYING >STACK
	RSTACK
?L1:	ZERO? PRSO /?L3
	IN? PRSO,HERE \?L4
	CALL V-SKIP >STACK
	RSTACK
?L4:	PRINTR "That would be a good trick."
?L3:	EQUAL? HERE,RIVER-BANK,DRAWBRIDGE,TOP-OF-FALLS /?L10
	EQUAL? HERE,TURRET,EDGE-OF-CHASM,BARE-PASSAGE /?L10
	EQUAL? HERE,TREE-BRANCH,GUN-EMPLACEMENT /?L10
	ZERO? RIDE-IN-PROGRESS /?L9
?L10:	CALL PRINT-ID,STR?49
	CALL JIGS-UP,STR?50 >STACK
	RSTACK
?L9:	EQUAL? HERE,LAGOON,DRAWBRIDGE /?L12
	EQUAL? HERE,COAL-BIN-ROOM,TOP-OF-CHUTE \?L11
?L12:	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L11:	CALL V-SKIP >STACK
	RSTACK

	.FUNCT V-LEAVE
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-LIE-DOWN
	CALL PERFORM,V?SLEEP
	RTRUE

	.FUNCT V-LISTEN
	PRINTI "At the moment,"
	CALL ARTICLE,PRSO,1
	PRINTR " makes no sound."

	.FUNCT V-LOCK
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-LOOK
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /FALSE
	CALL DESCRIBE-OBJECTS,1 >STACK
	RSTACK

	.FUNCT V-LOOK-BEHIND
	PRINTI "There is nothing behind"
	CALL ARTICLE,PRSO,1
	PRINTR "."

	.FUNCT V-LOOK-DOWN
	ZERO? LIT \?L1
	ZERO? BLORTED \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	EQUAL? PRSO,ROOMS \?L3
	CALL PERFORM,V?EXAMINE,GROUND
	RTRUE
?L3:	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE

	.FUNCT V-LOOK-INSIDE
	FSET? PRSO,ACTORBIT \?L1
	PRINTR "There is nothing special to be seen."
?L1:	FSET? PRSO,SURFACEBIT \?L5
	FIRST? PRSO >STACK \?L6
	CALL PRINT-CONT,PRSO >STACK
	RSTACK
?L6:	PRINTI "There is nothing on"
	CALL ARTICLE,PRSO,1
	PRINTR "."
?L5:	FSET? PRSO,DOORBIT \?L13
	PRINTI "All you can tell is that"
	FSET? PRSO,OPENBIT \?L16
	CALL ARTICLE,PRSO,1
	PRINTR " is open."
?L16:	CALL ARTICLE,PRSO,1
	PRINTR " is closed."
?L13:	FSET? PRSO,SCROLLBIT \?L23
	CALL PERFORM,V?READ,PRSO
	RTRUE
?L23:	FSET? PRSO,CONTBIT \?L24
	LOC PROTAGONIST >STACK
	EQUAL? PRSO,STACK \?L25
	MOVE PROTAGONIST,ROOMS
	FIRST? PRSO >STACK \?L27
	CALL PRINT-CONT,PRSO
	JUMP ?L29
?L27:	PRINTI "It's empty (not counting you)."
	CRLF
?L29:	MOVE PROTAGONIST,PRSO
	RTRUE
?L25:	CALL SEE-INSIDE?,PRSO >STACK
	ZERO? STACK /?L32
	FIRST? PRSO >STACK \?L33
	CALL PRINT-CONT,PRSO >STACK
	RSTACK
?L33:	PRINTR "It's empty."
?L32:	FSET? PRSO,OPENBIT /?L38
	FIRST? PRSO >STACK \?L38
	CALL PERFORM,V?OPEN,PRSO
	RTRUE
?L38:	PRINTI "It seems that"
	CALL ARTICLE,PRSO,1
	PRINTR " is closed."
?L24:	PRINTI "You can't look inside"
	CALL ARTICLE,PRSO
	PRINTR "."

	.FUNCT V-LOOK-UNDER
	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L1
	PRINTI "You're "
	FSET? PRSO,WEARBIT \?L5
	PRINTI "wear"
	JUMP ?L9
?L5:	PRINTI "hold"
?L9:	PRINTR "ing it!"
?L1:	PRINTI "There is nothing but "
	EQUAL? HERE,LAGOON-FLOOR \?L17
	PRINTI "sand"
	JUMP ?L21
?L17:	PRINTI "dust"
?L21:	PRINTR " there."

	.FUNCT V-LOWER
	CALL V-RAISE >STACK
	RSTACK

	.FUNCT V-LOWER-INTO
	CALL V-RAISE >STACK
	RSTACK

	.FUNCT V-MELT
	PRINTI "I'm not sure that"
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?51,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?52,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?53,STACK
	CALL ARTICLE,PRSO
	PRINTR " can be melted."

	.FUNCT V-MOVE
	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L1
	PRINTR "Why juggle objects?"
?L1:	FSET? PRSO,TAKEBIT \?L5
	PRINTI "Moving"
	CALL ARTICLE,PRSO,1
	PRINTR " reveals nothing."
?L5:	PRINTI "You can't move"
	CALL ARTICLE,PRSO,1
	PRINTR "."

	.FUNCT V-MUNG
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?54,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?55,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?56,STACK
	CALL HACK-HACK,STR?57 >STACK
	RSTACK

	.FUNCT PRE-OPEN
	ZERO? FWEEPED /FALSE
	CALL BATTY >STACK
	RSTACK

	.FUNCT V-OPEN,F,STR
	FSET? PRSO,SCROLLBIT \?L1
	CALL TELL-ME-HOW >STACK
	RSTACK
?L1:	EQUAL? PRSO,ACTORBIT \?L3
	PRINTR "Huh?"
?L3:	FSET? PRSO,VIALBIT \?L6
	EQUAL? HERE,LAGOON,LAGOON-FLOOR \?L6
	FIRST? PRSO >STACK \?L6
	FIRST? PRSO >STACK /?L7
?L7:	REMOVE STACK
	PRINTR "As you open the vial it fills with water, washing away the potion. A moment later a fish swims by, acting very strangely."
?L6:	FSET? PRSO,DOORBIT \?L10
	FSET? PRSO,OPENBIT \?L11
	CALL ALREADY-OPEN >STACK
	RSTACK
?L11:	FSET PRSO,OPENBIT
	PRINTI "Okay,"
	CALL ARTICLE,PRSO,1
	PRINTR " is now open."
?L10:	FSET? PRSO,CONTBIT \?L18
	FSET? PRSO,OPENBIT \?L19
	CALL ALREADY-OPEN >STACK
	RSTACK
?L19:	FSET PRSO,OPENBIT
	FSET PRSO,TOUCHBIT
	FIRST? PRSO >STACK \?L24
	FSET? PRSO,TRANSBIT \?L22
?L24:	PRINTR "Opened."
?L22:	PRINTI "Opening"
	CALL ARTICLE,PRSO,1
	PRINTI " reveals "
	CALL PRINT-CONTENTS,PRSO
	PRINTR "."
?L18:	CALL TELL-ME-HOW >STACK
	RSTACK

	.FUNCT V-PAY
	ZERO? PRSI \?L11
	EQUAL? PRSO,ZORKMID \?L3
	CALL FIND-IN,HERE,ACTORBIT >PRSI
	ZERO? PRSI /?L5
	CALL PERFORM,V?GIVE,PRSO,PRSI
	RTRUE
?L5:	PRINTR "There's no one here to pay."
?L3:	CALL HELD?,ZORKMID >STACK
	ZERO? STACK /?L10
	SET 'PRSI,ZORKMID
	JUMP ?L11
?L10:	PRINTR "Pay with what?"
?L11:	EQUAL? PRSI,ZORKMID \?L15
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE
?L15:	CALL WITH??? >STACK
	RSTACK

	.FUNCT V-PICK
	PRINTR "You can't pick that!"

	.FUNCT V-PLAY
	PRINTR "How peculiar!"

	.FUNCT V-PLUG
	PRINTR "This has no effect."

	.FUNCT V-POINT
	PRINTR "It's usually impolite to point."

	.FUNCT V-POUR
	PRINTR "You can't pour that!"

	.FUNCT V-PUMP
	PRINTR "It's not clear how."

	.FUNCT V-PUSH
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?58,STACK
	CALL HACK-HACK,STR?59 >STACK
	RSTACK

	.FUNCT V-PUSH-TO
	PRINTR "You can't push things to that."

	.FUNCT PRE-PUT
	IN? PRSO,GLOBAL-OBJECTS /?L3
	FSET? PRSO,TAKEBIT /FALSE
?L3:	PRINTR "Nice try."

	.FUNCT V-PUT,?TMP
	FSET? PRSI,OPENBIT /?L5
	FSET? PRSI,DOORBIT /?L1
	FSET? PRSI,CONTBIT /?L1
	FSET? PRSI,SURFACEBIT /?L1
	FSET? PRSI,VEHBIT /?L1
	PRINTR "You can't do that."
?L1:	FSET? PRSI,OPENBIT /?L5
	FSET? PRSI,SURFACEBIT /?L5
	CALL THIS-IS-IT,PRSI
	PRINTI "Inspection reveals that"
	CALL ARTICLE,PRSI,1
	PRINTR " isn't open."
?L5:	EQUAL? PRSI,PRSO \?L10
	PRINTR "How can you do that?"
?L10:	IN? PRSO,PRSI \?L13
	PRINTI "I think"
	CALL ARTICLE,PRSO,1
	PRINTI " is already in"
	CALL ARTICLE,PRSI,1
	PRINTR "."
?L13:	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \?L20
	PRINTR "There's no room."
?L20:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L23
	CALL ITAKE >STACK
	EQUAL? STACK,M-FATAL,0 /TRUE
?L23:	MOVE PRSO,PRSI
	FSET PRSO,TOUCHBIT
	PRINTR "Done."

	.FUNCT V-PUT-BEHIND
	PRINTR "That hiding place is too obvious."

	.FUNCT V-PUT-ON
	EQUAL? PRSI,ME \?L1
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L1:	FSET? PRSI,SURFACEBIT \?L3
	CALL V-PUT >STACK
	RSTACK
?L3:	PRINTI "There's no good surface on"
	CALL ARTICLE,PRSI,1
	PRINTR "."

	.FUNCT V-PUT-UNDER
	PRINTR "You can't put anything under that."

	.FUNCT V-RAPE
	PRINTI "What a (ahem!) strange idea."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?60,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?61,STACK >STACK
	RSTACK

	.FUNCT V-RAISE
	CALL HACK-HACK,STR?62 >STACK
	RSTACK

	.FUNCT V-REACH-IN,OBJ
	FSET? PRSO,CONTBIT \?L3
	FSET? PRSO,ACTORBIT \?L1
?L3:	PRINTR "What a maroon!"
?L1:	FSET? PRSO,OPENBIT /?L6
	PRINTR "It's not open."
?L6:	FIRST? PRSO >OBJ \?L10
	FSET? OBJ,INVISIBLE /?L10
	FSET? OBJ,TAKEBIT /?L9
?L10:	PRINTR "It's empty."
?L9:	PRINTI "You reach into"
	CALL ARTICLE,PRSO,1
	PRINTR " and feel something."

	.FUNCT PRE-READ
	ZERO? FWEEPED /?L1
	CALL BATTY >STACK
	RSTACK
?L1:	EQUAL? PRSO,SPELL-BOOK /FALSE
	FSET? PRSO,SPELLBIT \?L4
	IN? PRSO,SPELL-BOOK /FALSE
?L4:	ZERO? LIT \?L5
	ZERO? BLORTED \?L5
	PRINTR "It is impossible to read in the dark."
?L5:	ZERO? PRSI /FALSE
	FSET? PRSI,TRANSBIT /FALSE
	PRINTI "How does one look through"
	CALL ARTICLE,PRSI
	PRINTR "?"

	.FUNCT V-READ
	FSET? PRSO,READBIT /?L3
	FSET? PRSO,SPELLBIT \?L1
?L3:	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	PRINTI "How can you read"
	CALL ARTICLE,PRSO
	PRINTR "?"

	.FUNCT V-REPLY
	PRINTI "It is hardly likely that"
	CALL ARTICLE,PRSO,1
	PRINTI " is interested."
	CRLF
	CALL STOP >STACK
	RSTACK

	.FUNCT PRE-RESEARCH
	ZERO? PRSI \?L1
	EQUAL? HERE,LIBRARY \?L1
	SET 'PRSI,ENCYCLOPEDIA
?L1:	EQUAL? PRSO,ROOMS \?L4
	ZERO? LIT \?L6
	ZERO? BLORTED \?L6
	CALL TOO-DARK
	RTRUE
?L6:	EQUAL? HERE,GLASS-MAZE \?L9
	CALL PERFORM,V?EXAMINE,MAZE
	RTRUE
?L9:	FSET? HERE,INSIDEBIT \?L11
	CALL PERFORM,V?EXAMINE,CEILING
	RTRUE
?L11:	CALL PERFORM,V?EXAMINE,SKY
	RTRUE
?L4:	ZERO? PRSI \?L13
	EQUAL? PRSO,LOWER-CHUTE,UPPER-CHUTE,STAIRS /?L14
	EQUAL? PRSO,CHIMNEY,FIREPLACE,FLAG-POLE /?L14
	EQUAL? PRSO,PSEUDO-OBJECT,ZORKMID-TREE,TREE \?L13
?L14:	CALL MAKE-OUT >STACK
	RSTACK
?L13:	ZERO? LIT \?L15
	ZERO? BLORTED \?L15
	CALL PERFORM,V?READ,ENCYCLOPEDIA
	RTRUE
?L15:	ZERO? PRSI \?L16
	PRINTR "There's no encyclopedia here to look it up in."
?L16:	EQUAL? PRSI,ENCYCLOPEDIA /?L19
	PRINTI "You can't read about things in"
	CALL ARTICLE,PRSI
	PRINTR "."
?L19:	SET 'VOLUME-USED,1
	RFALSE

	.FUNCT V-RESEARCH
	EQUAL? PRSO,LOBBY,CELLAR,STORE-ROOM \?L1
	PRINTR "The spot where the entry should be is blank, as though the text were magically excised or transported to some other location."
?L1:	EQUAL? PRSO,COAL-MINE-1 \?L5
	PRINTR "Entharion the Wise united many warring tribes to form the kingdom of Quendor. He ruled from Largoneth Castle, near the ancient cities of Galepath and Mareilon. Our current calendar dates from the first year of his reign."
?L5:	EQUAL? PRSO,COAL-MINE-2 \?L8
	PRINTR "Duncanthrax was King of Quendor from 659 GUE through 688 GUE. Known as the ""Bellicose King"", he extended Quendor's domain, even conquering lands across the Great Sea (thus forming what his great-great-grandson, Dimwit Flathead, named the Great Underground Empire). Duncanthrax was quite eccentric, and his castle, Egreth, was reputed to be located in the most dangerous and deadly territory in the known lands."
?L8:	EQUAL? PRSO,COAL-MINE-3 \?L11
	PRINTR "Lord Dimwit Flathead the Excessive, a descendant of King Duncanthrax, ruled the Great Underground Empire from 770 GUE until 789 GUE. His accomplishments, achieved by overtaxing the kingdom, include Flood Control Dam #3 and the Royal Museum. Extremely vain, he renamed the Great Sea the Flathead Ocean, and preferred to spend his time in the strange lands that lay across it."
?L11:	EQUAL? PRSO,SLANTED-ROOM \?L14
	PRINTR "The Wizard of Frobozz was once a member of the influential Accardi chapter of the Enchanter's Guild. He was exiled by Dimwit Flathead after accidentally turning Flathead's castle into a mountain of fudge."
?L14:	EQUAL? PRSO,OCEAN-NORTH \?L17
	PRINTR "Flood Control Dam #3, a great engineering feat, is the source of the Frigid River."
?L17:	EQUAL? PRSO,OCEAN-SOUTH \?L20
	PRINTR "The article describes the exhibits of the Royal Museum, which included the crown jewels and a sandstone & marble maze."
?L20:	EQUAL? PRSO,SHAFT-BOTTOM \?L23
	PRINTR "Largoneth was the castle of Entharion the Wise."
?L23:	EQUAL? PRSO,END-OF-HIGHWAY \?L26
	PRINTR "A short article calls it an ancient city of Quendor."
?L26:	EQUAL? PRSO,STONE-HUT \?L29
	PRINTR "The entry says ""See GREAT UNDERGROUND EMPIRE."""
?L29:	EQUAL? PRSO,ENTRANCE-HALL \?L32
	PRINTR "Formerly known as Quendor, the Great Underground Empire reached its height under King Duncanthrax, began declining under the excessive rule of Dimwit Flathead, and finally fell in 883 GUE. The area is now called the Land of Frobozz, after its largest province."
?L32:	EQUAL? PRSO,CRATER \?L35
	PRINTR "The entry says ""See FLATHEAD OCEAN."""
?L35:	EQUAL? PRSO,EDGE-OF-CHASM \?L38
	PRINTR "The tiniest of articles mentions that Accardi-By-The-Sea is a village in the Land of Frobozz."
?L38:	EQUAL? PRSO,BELBOZ-HIDEOUT \?L41
	PRINTR "Miznia is a province in the southlands, mostly jungle."
?L41:	EQUAL? PRSO,SOOTY-ROOM \?L44
	PRINTR "The Frigid River, the mightiest in the Great Underground Empire, runs from Flood Control Dam #3 to Aragain Falls."
?L44:	EQUAL? PRSO,DIAL-ROOM \?L47
	PRINTR "According to this article, Aragain Falls is the most breathtaking and awesome waterfall in the known lands. It lies at the end of the Frigid River, and was a favorite honeymoon spot during the 8th and 9th centuries."
?L47:	EQUAL? PRSO,BARE-PASSAGE \?L50
	PRINTR "Amathradonis was a terrible giant who terrorized Accardi-By-The-Sea for many centuries. He was finally vanquished by Belboz the Necromancer in 952 GUE."
?L50:	EQUAL? PRSO,ELBOW-ROOM \?L53
	PRINTR "Nymphs are tiny, magical beings. They are known for their exuberance, fondness for practical jokes, and willingness to perform small tasks. The leading temporary nymph services agency is the venerable firm Nymph-O-Mania."
?L53:	EQUAL? PRSO,HALLWAY-2 \?L56
	PRINTR "Zork is a classic folk myth about a treasure-hunting adventurer who became a master of magic. It has been translated into novels, theatricals, giant wall murals ... almost every imaginable medium."
?L56:	EQUAL? PRSO,TREE-ROOM \?L59
	PRINTR "The encyclopedia describes it as one of the southlands, known for its fine artisans, and a popular vacation spot."
?L59:	EQUAL? PRSO,HOLLOW \?L62
	PRINTR "Antharia an island in the Flathead Ocean, is very prosperous thanks to its rich marble quarries."
?L62:	EQUAL? PRSO,WINDING-TUNNEL \?L65
	PRINTR "A leading manufacturer of magic scrolls and potions."
?L65:	EQUAL? PRSO,BEND \?L68
	PRINTR "The Kovalli Desert lies beyond the mountains that formed the western boundary of ancient Quendor. It is an uncrossable wasteland, believed to stretch to the edge of the world."
?L68:	EQUAL? PRSO,FOREST-EDGE \?L71
	PRINTR "Lonely Mountain is a towering peak to the west of Largoneth Castle."
?L71:	EQUAL? PRSO,SLIMY-ROOM \?L74
	PRINTR "A long article tells that Krill was a powerful warlock who plotted to overthrow the Circle of Enchanters and enslave this corner of the kingdom. He almost achieved his goal, but was vanquished by a young Enchanter."
?L74:	EQUAL? PRSO,RIVER-BED \?L77
	PRINTR "The article points out that the Servants Guild is not the most respected of trade guilds."
?L77:	EQUAL? PRSO,STAGNANT-POOL \?L80
	PRINTR "It is a corrupt and simplified form of Double Fannucci, popular in taverns, and frequently played for stakes."
?L80:	EQUAL? PRSO,RUINS \?L83
	PRINTR "A complex, thinking man's version of Gabber Tumper, and probably the most popular game in the world."
?L83:	EQUAL? PRSO,TOP-OF-FALLS \?L86
	PRINTR "The capital and biggest city in Frobozz, and the center of the spell scroll and infotater industries. The port of Borphee is the busiest on the Flathead Ocean."
?L86:	EQUAL? PRSO,TURRET \?L89
	PRINTR "The Messengers Guild is among the oldest guilds, and its members are incredibly dedicated. Their motto is ""Not even really bad precipitation or very early nightfall will prevent us from completing our route."""
?L89:	EQUAL? PRSO,DUNGEON \?L92
	PRINTR "Temporal travel technology, though in existence for many centuries, is still considered to be experimental by the magic industry. Several government agencies are currently looking into its potential long-term effects."
?L92:	EQUAL? PRSO,HIGHWAY \?L95
	PRINTR "The Enchanter's Guild can date its roots to the reign of Entharion, over 900 years ago. Chapters are usually located in small villages, since the bustle of city life interferes with an Enchanter's work (""Excuse me, I locked my keys in my house. Could you please rezrov my door?""). The most influential chapter is Accardi Chapter, home of the Circle of Enchanters."
?L95:	EQUAL? PRSO,STORE \?L98
	PRINTR "Gnomes are a race of short, furry people known for their greed and business acumen. They are often employed as toll and fare collectors, bank tellers, ticket sellers, and presidents of small software firms."
?L98:	EQUAL? PRSO,SHAFT-TOP \?L101
	PRINTR "Trolls are a race of ferocious, semi-intelligent creatures. They are often employed as security guards and bouncers."
?L101:	EQUAL? PRSO,YOUR-QUARTERS \?L104
	PRINTR "The leading supplier of designer spell books."
?L104:	EQUAL? PRSO,FROBAR-QUARTERS \?L107
	PRINTR "The head of one chapter of the Enchanters Guild."
?L107:	EQUAL? PRSO,HELISTAR-QUARTERS \?L110
	PRINTR "A village in the northlands."
?L110:	EQUAL? PRSO,SERVANT-QUARTERS \?L113
	PRINTR "According to this article, there are two meanings for Sorcerer. In general, it refers to a powerful magic-user. More specifically, the term is used by the Enchanters Guild to denote a senior member of the Circle."
?L113:	EQUAL? PRSO,APPRENTICE-QUARTERS \?L116
	PRINTR "A famous chasm near Accardi-By-The-Sea."
?L116:	EQUAL? PRSO,OUTSIDE-GLASS-DOOR \?L119
	PRINTR "The most prestigious engineering school in the land."
?L119:	PRINTI "You look in the encyclopedia but find no entry about"
	CALL ARTICLE,PRSO,1
	PRINTR "."

	.FUNCT V-RUB
	CALL HACK-HACK,STR?63 >STACK
	RSTACK

	.FUNCT V-SAY,V
	CALL FIND-IN,HERE,ACTORBIT >V
	ZERO? V /?L1
	PRINTI "You must address"
	CALL ARTICLE,V,1
	PRINTI " directly."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	GET P-LEXV,P-CONT >STACK
	EQUAL? STACK,W?HELLO \?L7
	SET 'QUOTE-FLAG,0
	RTRUE
?L7:	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	CALL PERFORM,V?TELL,ME
	RTRUE

	.FUNCT V-SEARCH
	ZERO? FWEEPED /?L1
	CALL BATTY >STACK
	RSTACK
?L1:	PRINTR "You find nothing unusual."

	.FUNCT V-SEND
	FSET? PRSO,ACTORBIT \?L1
	PRINTI "Why would you send for"
	CALL ARTICLE,PRSO,1
	PRINTR "?"
?L1:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-SGIVE
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT V-SHAKE
	FSET? PRSO,ACTORBIT \?L1
	PRINTR "Be real."
?L1:	FSET? PRSO,TAKEBIT /?L5
	PRINTR "You can't take it; thus, you can't shake it!"
?L5:	PRINTR "There's no point in shaking that."

	.FUNCT V-SHARPEN
	PRINTR "You'll never sharpen anything with that!"

	.FUNCT V-SHOOT
	PRINTI "Don't bother applying for a job as an armaments expert."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?64,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?65,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?66,STACK >STACK
	RSTACK

	.FUNCT V-SHOW
	PRINTI "I doubt"
	CALL ARTICLE,PRSI,1
	PRINTR " is interested."

	.FUNCT V-SIT
	PRINTR "That would be a waste of time."

	.FUNCT V-SKIP
	PRINTR "Wasn't that fun?"

	.FUNCT V-SLEEP,TOLD?=0
	ZERO? FLYING /?L1
	PRINTR "You'd better settle down before thinking about settling down."
?L1:	EQUAL? AWAKE,-1 \?L5
	PRINTR "You settle down to sleep, but you really aren't tired, so you thrash around for a while and then give up."
?L5:	INC 'REAL-SPELL-MAX
	SET 'SPELL-MAX,REAL-SPELL-MAX
	SET 'SPELL-ROOM,SPELL-MAX
	ADD MOVES,50 >MOVES
	SET 'LAST-SLEPT,MOVES
	SET 'LOAD-ALLOWED,LOAD-MAX
	SET 'FUMBLE-NUMBER,7
	CALL QUEUE,I-TIRED,80 >STACK
	PUT STACK,0,1
	SET 'AWAKE,-1
	CALL FORGET-ALL
	CALL WEAR-OFF-SPELLS
	FSET? TWISTED-FOREST,TOUCHBIT /?L9
	PRINTI "You drift off to sleep and dream of the distant Kovalli Desert. Waves of heat from the sand make breathing hard, and the bright sunlight burns against your eyelids. Suddenly you awake -- the Guild Hall is on fire! Through the thick smoke, you see Belboz standing before you. But no, this could not be Belboz, his face an unrecognizable mask of hatred, his outstretched arms dripping with blood.

He who is not Belboz speaks, in a voice filled with malevolence. ""So, you are the young Enchanter that Belboz thinks so highly of. That senile wizard thought you would be the one to rescue him from my clutches. I wonder why I bothered to come at all -- an insect like you poses no threat! Still..."" He gestures and your surroundings change."
	CRLF
	CRLF
	CALL ROB,PROTAGONIST
	CALL INT,I-TIRED >STACK
	PUT STACK,0,0
	CALL INT,I-HUNGER >STACK
	PUT STACK,0,0
	CALL INT,I-THIRST >STACK
	PUT STACK,0,0
	CALL WEAR-OFF-SPELLS
	CALL GOTO,CHAMBER-OF-LIVING-DEATH
	RTRUE
?L9:	EQUAL? HERE,RIVER-BED,STAGNANT-POOL,TOP-OF-FALLS \?L14
	CALL JIGS-UP,STR?67
	RTRUE
?L14:	CALL IN-COAL-MINE? >STACK
	ZERO? STACK /?L17
	ZERO? VILSTUED /?L17
	CALL PRINT-ID,STR?68
	CALL JIGS-UP,STR?69
	RTRUE
?L17:	CALL IN-COAL-MINE? >STACK
	ZERO? STACK /?L20
	CALL PRINT-ID,STR?70
	CALL JIGS-UP,STR?71
	RTRUE
?L20:	EQUAL? HERE,TWISTED-FOREST \?L23
	CALL PRINT-ID,STR?72
	CALL JIGS-UP,STR?73
	RTRUE
?L23:	EQUAL? HERE,TREE-BRANCH \?L26
	CALL PRINT-ID,STR?74
	CALL JIGS-UP,STR?75
	RTRUE
?L26:	EQUAL? HERE,SNAKE-PIT \?L29
	CALL PRINT-ID,STR?76
	CALL JIGS-UP,STR?77
	RTRUE
?L29:	EQUAL? HERE,MINE-FIELD \?L32
	CALL PRINT-ID,STR?78
	CALL JIGS-UP,STR?79
	RTRUE
?L32:	EQUAL? HERE,MEADOW \?L35
	CALL PRINT-ID,STR?80
	CALL JIGS-UP,STR?81
	RTRUE
?L35:	EQUAL? HERE,DRAWBRIDGE \?L38
	PRINTI "You are rudely awakened by the collapse of the rotting drawbridge. "
	CALL DO-WALK,P?DOWN
	RTRUE
?L38:	EQUAL? HERE,RIVER-BANK \?L43
	CALL PRINT-ID,STR?82
	CALL JIGS-UP,STR?83
	RTRUE
?L43:	EQUAL? HERE,HOLLOW \?L46
	CALL PRINT-ID,STR?84
	CALL JIGS-UP,STR?85
	RTRUE
?L46:	EQUAL? HERE,LAGOON,LAGOON-FLOOR \?L49
	CALL PRINT-ID,STR?86
	CALL JIGS-UP,STR?87
	RTRUE
?L49:	EQUAL? HERE,BELBOZ-HIDEOUT \?L52
	PRINTI "An unknown amount of time later you awake and look around. "
	CALL I-BELBOZ-AWAKES
	RTRUE
?L52:	IN? PROTAGONIST,BED \?L57
	ZERO? TOLD? \?L57
	PRINTI "You're not all that tired, but the bed is very comfortable."
	CRLF
	CALL PRINT-ID,STR?88
	JUMP ?L64
?L57:	ZERO? RIDE-IN-PROGRESS /?L61
	CALL END-RIDE
	PRINTI "Hard to believe that you could fall asleep during such an exciting ride, but you are pretty tired."
	CRLF
	JUMP ?L64
?L61:	PRINTI "Ah, sleep! It's been a long day and rest will do you good. You spread your cloak on the floor and drift off, renewing your powers and refreshing your mind. Time passes as you snore blissfully."
	CRLF
	CALL PRINT-ID,STR?89
?L64:	CRLF
	MOVE PROTAGONIST,HERE
	RANDOM 100 >STACK
	LESS? 50,STACK /?L67
	PRINTR "You sleep uneventfully, awake refreshed, and rise to your feet."
?L67:	CALL PICK-ONE,DREAMS >STACK
	PRINT STACK
	PRINTR " You awaken and stand."

	.FUNCT V-SMELL
	PRINTI "It smells just like"
	CALL ARTICLE,PRSO
	PRINTR "."

	.FUNCT V-SPAY
	CALL PERFORM,V?PAY,PRSI,PRSO
	RTRUE

	.FUNCT V-SPIN
	PRINTR "You can't spin that!"

	.FUNCT V-SPRAY
	ZERO? PRSI \?L1
	EQUAL? PRSO,GRUE-REPELLENT \?L3
	PRINTR "Specify who or what you want to spray."
?L3:	CALL HELD?,GRUE-REPELLENT >STACK
	ZERO? STACK /?L7
	CALL PERFORM,V?SPRAY,GRUE-REPELLENT,PRSO
	RTRUE
?L7:	PRINTR "You don't have anything that sprays!"
?L1:	CALL V-SQUEEZE >STACK
	RSTACK

	.FUNCT V-SQUEEZE
	PRINTR "How singularly useless."

	.FUNCT PRE-SSHOW
	CALL PERFORM,V?SHOW,PRSI,PRSO
	RTRUE

	.FUNCT V-SSHOW
	CALL V-SGIVE >STACK
	RSTACK

	.FUNCT V-SSPRAY
	CALL PERFORM,V?SPRAY,PRSI,PRSO
	RTRUE

	.FUNCT V-STAND
	LOC PROTAGONIST >STACK
	FSET? STACK,VEHBIT \?L1
	LOC PROTAGONIST >STACK
	CALL PERFORM,V?DISEMBARK,STACK
	RTRUE
?L1:	ZERO? FLYING /?L3
	CALL WHILE-FLYING >STACK
	RSTACK
?L3:	PRINTR "You are already standing."

	.FUNCT V-STAND-ON
	CALL V-SIT >STACK
	RSTACK

	.FUNCT V-STRIKE
	CALL PERFORM,V?ATTACK,PRSO
	RTRUE

	.FUNCT V-SWING
	ZERO? PRSI \?L1
	PRINTR "Whoosh!"
?L1:	CALL PERFORM,V?ATTACK,PRSI,PRSO
	RTRUE

	.FUNCT V-SWIM
	ZERO? PRSO /?L1
	CALL PERFORM,V?THROUGH,PRSO
	RTRUE
?L1:	EQUAL? HERE,LAGOON,LAGOON-FLOOR \?L3
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L3:	EQUAL? HERE,COVE,OCEAN-NORTH,OCEAN-SOUTH \?L4
	CALL PERFORM,V?THROUGH,LAGOON-OBJECT
	RTRUE
?L4:	EQUAL? HERE,RIVER-BANK \?L5
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L5:	EQUAL? HERE,MOUTH-OF-RIVER \?L6
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L6:	EQUAL? HERE,HIDDEN-CAVE \?L7
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L7:	EQUAL? HERE,DRAWBRIDGE \?L8
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L8:	EQUAL? HERE,STAGNANT-POOL \?L9
	CALL DO-WALK,P?NW >STACK
	RSTACK
?L9:	PRINTR "There's nothing to swim in!"

	.FUNCT PRE-TAKE,L
	LOC PRSO >L
	ZERO? FWEEPED /?L1
	CALL BATTY >STACK
	RSTACK
?L1:	IN? PRSO,PROTAGONIST \?L3
	FSET? PRSO,WEARBIT \?L4
	PRINTR "You are already wearing it."
?L4:	PRINTR "You already have it."
?L3:	FSET? PRSO,SPELLBIT \?L11
	ZERO? L /?L12
	FSET? L,SCROLLBIT \?L11
	CALL ACCESSIBLE?,L >STACK
	ZERO? STACK /?L11
	CALL PERFORM,V?TAKE,L
	RTRUE
?L11:	ZERO? L /?L12
	FSET? L,CONTBIT \?L12
	FSET? L,OPENBIT /?L12
	PRINTR "You can't reach that."
?L12:	ZERO? PRSI /?L15
	EQUAL? PRSO,ME \?L16
	CALL PERFORM,V?DROP,PRSI
	RTRUE
?L16:	EQUAL? PRSI,L,BELBOZ-DESK /?L18
	PRINTI "But"
	CALL ARTICLE,PRSO,1
	PRINTI " isn't in"
	CALL ARTICLE,PRSI,1
	PRINTR "."
?L18:	SET 'PRSI,0
	RFALSE
?L15:	LOC PROTAGONIST >STACK
	EQUAL? PRSO,STACK \FALSE
	PRINTR "You are in it!"

	.FUNCT V-TAKE
	CALL ITAKE >STACK
	EQUAL? STACK,1 \FALSE
	CALL IS-THEFT? >STACK
	CALL PRINT-ID,STR?90,STACK
	FSET? PRSO,WEARBIT \?L3
	PRINTI "You are now wearing"
	CALL ARTICLE,PRSO,1
	PRINTR "."
?L3:	ZERO? FLYING /?L9
	PRINTR "You swoop low and pick it up."
?L9:	EQUAL? PRSO,ROPE \?L13
	ZERO? ROPE-PLACED \?L15
	ZERO? ROPE-IN-LOWER-CHUTE /?L13
?L15:	SET 'ROPE-PLACED,0
	SET 'ROPE-IN-LOWER-CHUTE,0
	FCLEAR BEAM,TRYTAKEBIT
	FCLEAR ROPE,TRYTAKEBIT
?L13:	PRINTR "Taken."

	.FUNCT V-TAKE-OFF
	LOC PROTAGONIST >STACK
	EQUAL? PRSO,STACK \?L1
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L1:	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L3
	FSET? PRSO,WEARBIT \?L3
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L3:	PRINTR "You're not wearing that!"

	.FUNCT V-TELL
	FSET? PRSO,ACTORBIT \?L1
	ZERO? P-CONT /?L3
	SET 'WINNER,PRSO
	LOC WINNER >HERE
	RETURN HERE
?L3:	EQUAL? PRSO,GNOME \?L5
	ZERO? GNOME-SLEEPING /?L5
	CALL POOR-LISTENERS >STACK
	RSTACK
?L5:	PRINTI "Hmmm..."
	CALL ARTICLE,PRSO,1
	PRINTR " looks at you expectantly, as though he thought you were about to talk."
?L1:	EQUAL? PRSO,PARROT \?L11
	PRINTI "Although the parrot is a marvelous imitator of human speech, it is incapable of understanding or initiating any."
	CRLF
	CALL STOP >STACK
	RSTACK
?L11:	PRINTI "You can't talk to"
	CALL ARTICLE,PRSO
	PRINTI "!"
	CRLF
	CALL STOP >STACK
	RSTACK

	.FUNCT V-THANK
	FSET? PRSO,ACTORBIT \?L1
	PRINTI "You do so, but"
	CALL ARTICLE,PRSO,1
	PRINTR " seems less than overjoyed."
?L1:	PRINTR "The Circle will revoke your certificate if you keep this up."

	.FUNCT V-THROUGH
	FSET? PRSO,DOORBIT \?L1
	CALL OTHER-SIDE,PRSO >STACK
	CALL DO-WALK,STACK
	RTRUE
?L1:	FSET? PRSO,VEHBIT \?L3
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L3:	FSET? PRSO,TAKEBIT /?L4
	PRINTI "You hit your head against"
	CALL ARTICLE,PRSO,1
	PRINTR " as you attempt this feat."
?L4:	IN? PRSO,PROTAGONIST \?L9
	PRINTR "That would involve quite a contortion!"
?L9:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-THROW
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	EQUAL? HERE,COAL-BIN-ROOM,DIAL-ROOM \?L3
	GETP PRSO,P?SIZE >STACK
	LESS? STACK,20 \?L3
	CALL BURIED-IN-COAL,STR?91 >STACK
	RSTACK
?L3:	EQUAL? HERE,HAUNTED-HOUSE \?L6
	MOVE PRSO,DIAL
?L6:	PRINTR "Thrown."

	.FUNCT V-THROW-OFF
	PRINTR "You can't throw anything off that!"

	.FUNCT V-TIE
	PRINTI "You can't tie"
	CALL ARTICLE,PRSO,1
	PRINTR " to that."

	.FUNCT V-TIE-UP
	PRINTR "You could certainly never tie it with that!"

	.FUNCT V-TIME,X
	SUB MOVES,LAST-SLEPT >X
	PRINTI "It's "
	LESS? X,15 \?L3
	PRINTI "early morning"
	JUMP ?L19
?L3:	LESS? X,30 \?L7
	PRINTI "mid-morning"
	JUMP ?L19
?L7:	LESS? X,50 \?L10
	PRINTI "mid-day"
	JUMP ?L19
?L10:	LESS? X,65 \?L13
	PRINTI "late afternoon"
	JUMP ?L19
?L13:	LESS? X,80 \?L16
	PRINTI "early evening"
	JUMP ?L19
?L16:	PRINTI "late evening"
?L19:	PRINTR "."

	.FUNCT V-TORTURE
	EQUAL? HERE,TORTURE-CHAMBER /?L1
	PRINTR "There are no torture devices here!"
?L1:	EQUAL? PRSO,ME \?L5
	CALL PRINT-ID,STR?92
	CALL JIGS-UP,STR?93 >STACK
	RSTACK
?L5:	PRINTI "Despite your best effort,"
	CALL ARTICLE,PRSO,1
	PRINTI " fails to divulge any useful information."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?94,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?95,STACK >STACK
	RSTACK

	.FUNCT V-TURN
	PRINTR "This has no effect."

	.FUNCT V-UNLOCK
	CALL V-LOCK >STACK
	RSTACK

	.FUNCT V-UNTIE
	PRINTR "This cannot be tied, so it cannot be untied!"

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	ZERO? P-WALK-DIR \?L1
	CALL PERFORM,V?WALK-TO,PRSO
	RTRUE
?L1:	GETPT HERE,PRSO >PT
	ZERO? PT /?L3
	PTSIZE PT >PTS
	EQUAL? PTS,UEXIT \?L4
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L4:	EQUAL? PTS,NEXIT \?L6
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L6:	EQUAL? PTS,FEXIT \?L11
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L12
	CALL GOTO,RM >STACK
	RSTACK
?L12:	EQUAL? HERE,GLASS-MAZE,PARK-ENTRANCE /FALSE
	RETURN 2
?L11:	EQUAL? PTS,CEXIT \?L21
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L22
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L22:	GET PT,CEXITSTR >STR
	ZERO? STR /?L24
	PRINT STR
	CRLF
	RETURN 2
?L24:	CALL CANT-GO
	RETURN 2
?L21:	EQUAL? PTS,DEXIT \FALSE
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L33
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L33:	GET PT,DEXITSTR >STR
	ZERO? STR /?L35
	PRINT STR
	CRLF
	CALL THIS-IS-IT,OBJ
	RETURN 2
?L35:	PRINTI "The "
	PRINTD OBJ
	PRINTI " is closed."
	CRLF
	CALL THIS-IS-IT,OBJ
	RETURN 2
?L3:	ZERO? FLYING /?L46
	EQUAL? PRSO,P?UP \?L46
	PRINTI "You're already flying as high as you can."
	CRLF
	RETURN 2
?L46:	CALL CANT-GO
	RETURN 2

	.FUNCT V-WALK-AROUND
	PRINTR "Please use compass directions for movement."

	.FUNCT V-WALK-TO
	IN? PRSO,HERE /?L3
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK /?L1
?L3:	PRINTR "It's here!"
?L1:	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT V-WAIT,NUM=3
	PRINTI "Time passes..."
	CRLF
?L3:	DLESS? 'NUM,0 /?L4
	CALL CLOCKER >STACK
	ZERO? STACK /?L3
?L4:	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT

	.FUNCT V-WAIT-FOR
	LOC PRSO >STACK
	EQUAL? STACK,HERE,PROTAGONIST \?L1
	PRINTR "It's already here!"
?L1:	PRINTR "You will probably be waiting quite a while."

	.FUNCT V-WAVE
	CALL HACK-HACK,STR?96 >STACK
	RSTACK

	.FUNCT V-WAVE-AT
	PRINTI "Despite your friendly nature,"
	CALL PRINT-ID,STR?97
	CALL ARTICLE,PRSO,1
	PRINTR " isn't likely to respond."

	.FUNCT V-WAX
	ZERO? PRSI \?L3
	CALL VISIBLE?,WAXER >STACK
	ZERO? STACK /?L1
	SET 'PRSI,WAXER
	JUMP ?L3
?L1:	ZERO? PRSI \?L3
	PRINTR "With what?"
?L3:	EQUAL? PRSI,WAXER \?L7
	EQUAL? PRSO,GROUND \?L7
	CALL PERFORM,V?LAMP-ON,WAXER
	RTRUE
?L7:	CALL WITH??? >STACK
	RSTACK

	.FUNCT V-WEAR
	FSET? PRSO,WEARBIT /?L1
	PRINTI "You can't wear"
	CALL ARTICLE,PRSO,1
	PRINTR "."
?L1:	CALL PERFORM,V?TAKE,PRSO
	RTRUE

	.FUNCT V-WHAT
	PRINTR "Try reading an encyclopedia."

	.FUNCT V-WHERE
	EQUAL? PRSO,RIVER-BED \?L1
	PRINTR "Out doing their daily errands, probably."
?L1:	CALL V-FIND,1 >STACK
	RSTACK

	.FUNCT V-WHO
	FSET? PRSO,ACTORBIT \?L1
	CALL PERFORM,V?WHAT,PRSO
	RTRUE
?L1:	EQUAL? PRSO,COAL-MINE-1,COAL-MINE-2,COAL-MINE-3 /?L4
	EQUAL? PRSO,SLANTED-ROOM,BARE-PASSAGE,SLIMY-ROOM /?L4
	EQUAL? PRSO,RIVER-BED,TURRET,FROBAR-QUARTERS \?L3
?L4:	CALL PERFORM,V?WHAT,PRSO
	RTRUE
?L3:	PRINTR "That's not a person!"

	.FUNCT V-YELL
	PRINTI "Aarrrrrgggggggghhhhhhhhhhh!"
	CRLF
	EQUAL? HERE,TOLL-GATE \FALSE
	ZERO? GNOME-SLEEPING /FALSE
	ZERO? LIT \?L5
	ZERO? BLORTED /FALSE
?L5:	CRLF
	CALL PRINT-ID,STR?98
	CALL PERFORM,V?ALARM,GNOME
	RTRUE

	.FUNCT PRE-CAST,SPELL,SCROLL
	ZERO? PERFORMING-SPELL /?L1
	SET 'PERFORMING-SPELL,0
	RFALSE
?L1:	EQUAL? PRSA,V?GNUSTO \?L4
	SET 'SPELL,GNUSTO-SPELL
	JUMP ?L5
?L4:	EQUAL? PRSA,V?FROTZ \?L6
	SET 'SPELL,FROTZ-SPELL
	JUMP ?L5
?L6:	EQUAL? PRSA,V?REZROV \?L7
	SET 'SPELL,REZROV-SPELL
	JUMP ?L5
?L7:	EQUAL? PRSA,V?IZYUK \?L8
	SET 'SPELL,IZYUK-SPELL
	JUMP ?L5
?L8:	EQUAL? PRSA,V?AIMFIZ \?L9
	SET 'SPELL,AIMFIZ-SPELL
	JUMP ?L5
?L9:	EQUAL? PRSA,V?FWEEP \?L10
	SET 'SPELL,FWEEP-SPELL
	JUMP ?L5
?L10:	EQUAL? PRSA,V?SWANZO \?L11
	SET 'SPELL,SWANZO-SPELL
	JUMP ?L5
?L11:	EQUAL? PRSA,V?GOLMAC \?L12
	SET 'SPELL,GOLMAC-SPELL
	JUMP ?L5
?L12:	EQUAL? PRSA,V?VARDIK \?L13
	SET 'SPELL,VARDIK-SPELL
	JUMP ?L5
?L13:	EQUAL? PRSA,V?PULVER \?L14
	SET 'SPELL,PULVER-SPELL
	JUMP ?L5
?L14:	EQUAL? PRSA,V?MEEF \?L15
	SET 'SPELL,MEEF-SPELL
	JUMP ?L5
?L15:	EQUAL? PRSA,V?VEZZA \?L16
	SET 'SPELL,VEZZA-SPELL
	JUMP ?L5
?L16:	EQUAL? PRSA,V?GASPAR \?L17
	SET 'SPELL,GASPAR-SPELL
	JUMP ?L5
?L17:	EQUAL? PRSA,V?YOMIN \?L18
	SET 'SPELL,YOMIN-SPELL
	JUMP ?L5
?L18:	EQUAL? PRSA,V?YONK \?L19
	SET 'SPELL,YONK-SPELL
	JUMP ?L5
?L19:	EQUAL? PRSA,V?MALYON \?L20
	SET 'SPELL,MALYON-SPELL
	JUMP ?L5
?L20:	SET 'SPELL,0
?L5:	EQUAL? SPELL,PRSO /?L24
	LOC SPELL >STACK
	EQUAL? STACK,PRSO \?L22
	LOC SPELL >STACK
	EQUAL? STACK,SPELL-BOOK /?L22
?L24:	PRINTR "As you must remember from Thaumaturgy 101, you cannot cast a spell upon itself, or upon the scroll it is written on."
?L22:	LOC SPELL >STACK
	FSET? STACK,MUNGBIT \?L27
	CALL ALWAYS-MEMORIZED,SPELL >STACK
	ZERO? STACK \?L27
	GETP SPELL,P?COUNT >STACK
	ZERO? STACK \?L27
	PRINTR "The spell is no longer readable."
?L27:	LOC SPELL >STACK
	FSET? STACK,SCROLLBIT \?L42
	LOC SPELL >SCROLL
	IN? SCROLL,PROTAGONIST \?L31
	EQUAL? SPELL,YONK-SPELL \?L33
	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK /FALSE
?L33:	MOVE SCROLL,DIAL
	PRINTI "As you cast the spell, the "
	PRINTD SCROLL
	PRINTI " vanishes!"
	CRLF
	CRLF
	PUTP SPELL,P?COUNT,1
	JUMP ?L42
?L31:	FSET? SPELL,TOUCHBIT /?L39
	IN? SCROLL,HERE \?L38
?L39:	PRINTI "You don't have the "
	PRINTD SPELL
	PRINTR " memorized, nor do you have the scroll on which it is written."
?L38:	PRINTI "The "
	PRINTD SPELL
	PRINTR " is not committed to memory, and you haven't seen any scroll on which it is written."
?L42:	ZERO? FWEEPED /?L46
	PRINTI "When you attempt to incant the "
	PRINTD SPELL
	PRINTR ", all that comes out is a high-pitched squeak!"
?L46:	CALL ALWAYS-MEMORIZED,SPELL >STACK
	ZERO? STACK \FALSE
	GETP SPELL,P?COUNT >STACK
	ZERO? STACK \?L51
	CALL THIS-IS-IT,SPELL
	PRINTI "You don't have the "
	PRINTD SPELL
	PRINTR " committed to memory!"
?L51:	GETP SPELL,P?COUNT >STACK
	DEC 'STACK
	PUTP SPELL,P?COUNT,STACK
	INC 'SPELL-ROOM
	RFALSE

	.FUNCT V-CAST,VRB
	FSET? PRSO,SPELLBIT /?L1
	PRINTI "You might as well be casting with a fly rod, as to try to cast"
	CALL ARTICLE,PRSO
	PRINTR "."
?L1:	EQUAL? PRSO,GNUSTO-SPELL \?L8
	SET 'VRB,V?GNUSTO
	JUMP ?L25
?L8:	EQUAL? PRSO,FROTZ-SPELL \?L10
	SET 'VRB,V?FROTZ
	JUMP ?L25
?L10:	EQUAL? PRSO,REZROV-SPELL \?L11
	SET 'VRB,V?REZROV
	JUMP ?L25
?L11:	EQUAL? PRSO,IZYUK-SPELL \?L12
	SET 'VRB,V?IZYUK
	JUMP ?L25
?L12:	EQUAL? PRSO,AIMFIZ-SPELL \?L13
	SET 'VRB,V?AIMFIZ
	JUMP ?L25
?L13:	EQUAL? PRSO,FWEEP-SPELL \?L14
	SET 'VRB,V?FWEEP
	JUMP ?L25
?L14:	EQUAL? PRSO,SWANZO-SPELL \?L15
	SET 'VRB,V?SWANZO
	JUMP ?L25
?L15:	EQUAL? PRSO,GOLMAC-SPELL \?L16
	SET 'VRB,V?GOLMAC
	JUMP ?L25
?L16:	EQUAL? PRSO,VARDIK-SPELL \?L17
	SET 'VRB,V?VARDIK
	JUMP ?L25
?L17:	EQUAL? PRSO,PULVER-SPELL \?L18
	SET 'VRB,V?PULVER
	JUMP ?L25
?L18:	EQUAL? PRSO,MEEF-SPELL \?L19
	SET 'VRB,V?MEEF
	JUMP ?L25
?L19:	EQUAL? PRSO,VEZZA-SPELL \?L20
	SET 'VRB,V?VEZZA
	JUMP ?L25
?L20:	EQUAL? PRSO,GASPAR-SPELL \?L21
	SET 'VRB,V?GASPAR
	JUMP ?L25
?L21:	EQUAL? PRSO,YOMIN-SPELL \?L22
	SET 'VRB,V?YOMIN
	JUMP ?L25
?L22:	EQUAL? PRSO,YONK-SPELL \?L23
	SET 'VRB,V?YONK
	JUMP ?L25
?L23:	EQUAL? PRSO,MALYON-SPELL \?L24
	SET 'VRB,V?MALYON
	JUMP ?L25
?L24:	PRINTR "Bug #90"
?L25:	ZERO? PRSI \?L28
	PRINTR "You might as well be casting it away as not cast it on something."
?L28:	CALL PERFORM,VRB,PRSI
	RTRUE

	.FUNCT V-SPELLS,CNT,S,ANY=0,OS=0,TMP
	GET ALL-SPELLS,0 >CNT
	PRINTI "The gnusto, rezrov, and frotz spells are yours forever. Other than that, you have "
?L3:	ZERO? CNT \?L5
	ZERO? OS /?L7
	CALL SPELL-PRINT,OS,ANY,1
	SET 'ANY,1
?L7:	ZERO? ANY \?L10
	PRINTR "no spells memorized."
?L10:	PRINTR " committed to memory."
?L5:	GET ALL-SPELLS,CNT >STACK
	CALL SPELL-TIMES,STACK >TMP
	ZERO? TMP /?L18
	ZERO? OS /?L20
	CALL SPELL-PRINT,OS,ANY
	SET 'ANY,1
?L20:	SET 'OS,TMP
?L18:	DEC 'CNT
	JUMP ?L3

	.FUNCT SPELL-PRINT,S,ANY,PAND?=0,X
	ZERO? ANY /?L7
	ZERO? PAND? /?L3
	PRINTI " and "
	JUMP ?L7
?L3:	PRINTI ", "
?L7:	PRINTI "the "
	PRINTD S
	PRINTI " "
	GETP S,P?COUNT >STACK
	SUB STACK,1 >X
	GRTR? X,4 \?L13
	SET 'X,4
?L13:	GET COUNTERS,X >STACK
	PRINT STACK
	RETURN S

	.FUNCT SPELL-TIMES,S
	GETP S,P?COUNT >STACK
	GRTR? STACK,0 \FALSE
	IN? S,SPELL-BOOK \?L3
	RETURN S
?L3:	EQUAL? S,AIMFIZ-SPELL \?L5
	IN? AIMFIZ-SPELL,AIMFIZ-SCROLL /?L5
	RETURN S
?L5:	EQUAL? S,YONK-SPELL \FALSE
	IN? YONK-SPELL,YONK-SCROLL /FALSE
	RETURN S

	.FUNCT V-LEARN
	PRINTR "You don't have that spell, if indeed that is a spell."

	.FUNCT V-AIMFIZ
	EQUAL? PRSO,COAL-MINE-1,COAL-MINE-2,COAL-MINE-3 \?L1
	CALL PRINT-ID,STR?99
	CALL JIGS-UP,STR?100 >STACK
	RSTACK
?L1:	EQUAL? PRSO,SLANTED-ROOM \?L3
	CALL PRINT-ID,STR?101
	CALL JIGS-UP,STR?102 >STACK
	RSTACK
?L3:	EQUAL? PRSO,SLIMY-ROOM \?L4
	PRINTI "You join Krill in oblivion."
	CRLF
	CALL PRINT-ID,STR?103
	CALL FINISH >STACK
	RSTACK
?L4:	EQUAL? PRSO,RIVER-BED \?L7
	CALL PRINT-ID,STR?104
	CALL JIGS-UP,STR?105 >STACK
	RSTACK
?L7:	EQUAL? PRSO,TURRET \?L8
	CALL PRINT-ID,STR?106
	CALL JIGS-UP,STR?107 >STACK
	RSTACK
?L8:	EQUAL? PRSO,FROBAR-QUARTERS \?L9
	CALL PRINT-ID,STR?108
	CALL JIGS-UP,STR?109 >STACK
	RSTACK
?L9:	EQUAL? PRSO,SERVANT-QUARTERS \?L10
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,V?AIMFIZ,ME
	RTRUE
?L10:	CALL V-SWANZO >STACK
	RSTACK

	.FUNCT V-AIMFIZ-TO
	EQUAL? PRSO,ME /?L1
	PRINTR "This spell only has an effect on the caster."
?L1:	PRINTI "You should just say ""aimfiz "
	PRINTD PRSI
	PRINTR """."

	.FUNCT V-GASPAR
	ZERO? PRSO \?L1
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,V?GASPAR,ME
	RTRUE
?L1:	PRINTI "How nice --"
	CALL ARTICLE,PRSO,1
	PRINTI " is now provided for in the event of "
	FSET? PRSO,ACTORBIT \?L8
	PRINTI "his"
	JUMP ?L12
?L8:	PRINTI "its"
?L12:	PRINTR " death."

	.FUNCT V-GNUSTO,SCROLL
	IN? SPELL-BOOK,PROTAGONIST /?L1
	PRINTR "The spell quests around in your hands, looking for your spell book, and not finding it, fades reluctantly."
?L1:	FSET? PRSO,SPELLBIT /?L5
	PRINTI "You can't inscribe"
	CALL ARTICLE,PRSO
	PRINTR " in your spell book!"
?L5:	IN? PRSO,SPELL-BOOK \?L10
	PRINTR "You already have that spell inscribed in your book!"
?L10:	LOC PRSO >STACK
	FSET? STACK,MUNGBIT \?L13
	PRINTR "The spell no longer readable."
?L13:	LOC PRSO >SCROLL
	FSET? SCROLL,SCROLLBIT \?L17
	CALL HELD?,SCROLL >STACK
	ZERO? STACK /?L17
	EQUAL? PRSO,AIMFIZ-SPELL,YONK-SPELL \?L19
	PRINT BOOK-GLOWS
	PRINTI "In a spectacular effort of magic, the powers of the gnusto spell attempt to copy the "
	PRINTD PRSO
	PRINTI " into your book, but the spell is too long, too complicated, and too powerful. The glow fades, but fortunately the "
	PRINTD SCROLL
	PRINTR " remains intact."
?L19:	MOVE SCROLL,DIAL
	MOVE PRSO,SPELL-BOOK
	PUTP PRSO,P?COUNT,0
	PRINT BOOK-GLOWS
	PRINTI "Slowly, ornately, the words of the "
	PRINTD PRSO
	PRINTI " are inscribed, glowing even more brightly than the book itself. The book's brightness fades, "
	FSET? SPELL-BOOK,MUNGBIT \?L26
	PRINTI "and the spell is now illegible in the damp, ruined book. T"
	JUMP ?L30
?L26:	PRINTI "but the spell remains! However, t"
?L30:	PRINTR "he scroll on which it was written vanishes as the last word is copied."
?L17:	PRINTR "You must have a legible spell scroll in your hands before the gnusto spell will work on it."

	.FUNCT V-FROTZ,OLIT
	SET 'OLIT,LIT
	FSET? PRSO,ONBIT \?L1
	PRINTI "Have you forgotten that you already frotzed"
	CALL ARTICLE,PRSO,1
	PRINTR "?"
?L1:	FSET? PRSO,TAKEBIT /?L8
	FSET? PRSO,ACTORBIT \?L7
?L8:	FSET PRSO,ONBIT
	EQUAL? PRSO,BAT-GUANO,FWEEP-SCROLL /?L9
	FSET PRSO,TOUCHBIT
?L9:	PRINTI "There is an almost blinding flash of light as"
	CALL ARTICLE,PRSO,1
	PRINTI " begins to glow! It slowly fades to a less painful level, but"
	CALL ARTICLE,PRSO,1
	PRINTI " is now quite usable as a light source."
	EQUAL? PRSO,PARK-GNOME /?L20
	EQUAL? PRSO,GNOME \?L18
	ZERO? GNOME-SLEEPING \?L18
?L20:	CALL PRINT-ID,STR?110
	CALL JIGS-UP,STR?111
	RTRUE
?L18:	CRLF
	CALL LIT?,HERE >LIT
	ZERO? OLIT \TRUE
	ZERO? LIT /TRUE
	CRLF
	CALL V-LOOK
	RTRUE
?L7:	CALL V-SWANZO >STACK
	RSTACK

	.FUNCT V-FWEEP,X,N
	ZERO? PRSO /?L3
	EQUAL? PRSO,ME \?L1
?L3:	ZERO? RIDE-IN-PROGRESS /?L4
	CALL FLY-DURING-RIDE
	RTRUE
?L4:	EQUAL? HERE,LAGOON,LAGOON-FLOOR \?L6
	CALL PRINT-ID,STR?112
	CALL JIGS-UP,STR?113
	RTRUE
?L6:	SET 'FWEEPED,1
	SET 'FLYING,1
	CALL QUEUE,I-UNFWEEP,15 >STACK
	PUT STACK,0,1
	CALL INT,I-FLY >STACK
	PUT STACK,0,0
	FIRST? PROTAGONIST >X /?L8
?L8:	PRINTI "With keen disappointment, you note that nothing has changed. Then, you slowly realize that you are black, have two wing-like appendages, and are flying a few feet above the ground."
	ZERO? X /?L11
	PRINTI " Understandably, you dropped everything you were carrying."
?L11:	EQUAL? HERE,GLASS-MAZE \?L16
	CALL RADAR-VIEW
?L16:	CRLF
?L19:	ZERO? X /TRUE
	NEXT? X >N /?L23
?L23:	MOVE X,HERE
	SET 'X,N
	JUMP ?L19
?L1:	PRINTR "The fweep spell can be cast only on yourself."

	.FUNCT V-IZYUK
	ZERO? FLYING /?L1
	EQUAL? PRSO,ME \?L1
	PRINTR "You are already flying."
?L1:	ZERO? PRSO /?L6
	EQUAL? PRSO,ME \?L5
?L6:	ZERO? RIDE-IN-PROGRESS /?L7
	CALL FLY-DURING-RIDE
	RTRUE
?L7:	EQUAL? HERE,LAGOON-FLOOR \?L10
	PRINTI "Gloooop! "
?L10:	PRINTI "You are now floating serenely in midair."
	CRLF
	EQUAL? HERE,LAGOON-FLOOR \?L17
	CALL DO-WALK,P?UP
?L17:	SET 'FLYING,1
	CALL QUEUE,I-FLY,3 >STACK
	PUT STACK,0,1
	MOVE PROTAGONIST,HERE
	RTRUE
?L5:	EQUAL? PRSO,FLAG \?L20
	CALL V-FLY >STACK
	RSTACK
?L20:	CALL PERFORM,V?FLY,PRSO
	RTRUE

	.FUNCT FLY-DURING-RIDE
	PRINTI "You fly out of the "
	EQUAL? HERE,FLUME \?L3
	PRINTI "log boat"
	JUMP ?L7
?L3:	PRINTI "car"
?L7:	PRINTI ", and immediately splat into one of the structural cross-beams of the "
	EQUAL? HERE,FLUME \?L12
	PRINTI "flume"
	JUMP ?L16
?L12:	PRINTI "roller coaster"
?L16:	CALL PRINT-ID,STR?114
	CALL JIGS-UP,STR?14 >STACK
	RSTACK

	.FUNCT V-MALYON
	FSET? PRSO,ACTORBIT \?L1
	PRINTI "Wow! It looks like"
	CALL ARTICLE,PRSO,1
	PRINTR " is now alive! What a magician you are!"
?L1:	FSET? PRSO,TAKEBIT \?L7
	PRINTI "As you complete the spell,"
	CALL ARTICLE,PRSO,1
	PRINTI " comes alive! It blinks, dances a little jig, and a moment later returns to normal."
	CRLF
	CALL PRINT-ID,STR?115 >STACK
	RSTACK
?L7:	CALL V-SWANZO >STACK
	RSTACK

	.FUNCT V-MEEF
	CALL V-SWANZO >STACK
	RSTACK

	.FUNCT V-PULVER
	EQUAL? PRSO,FOOBLE-POTION,FLAXO-POTION,BLORT-POTION /?L3
	EQUAL? PRSO,VILSTU-POTION,BERZIO-POTION \?L1
?L3:	MOVE PRSO,DIAL
	PRINTR "The potion vanishes."
?L1:	PRINTI "After completing the spell,"
	CALL ARTICLE,PRSO,1
	PRINTR " remains unchanged. It must not be a liquid."

	.FUNCT V-REZROV
	FSET? PRSO,CONTBIT /?L3
	FSET? PRSO,DOORBIT \?L1
?L3:	FSET? PRSO,OPENBIT \?L4
	CALL ALREADY-OPEN >STACK
	RSTACK
?L4:	FSET? PRSO,SCROLLBIT /?L6
	PRINTI "Silently,"
	CALL ARTICLE,PRSO,1
	PRINTI " swings open"
	FIRST? PRSO >STACK \?L11
	PRINTI ", revealing "
	CALL PRINT-CONTENTS,PRSO
?L11:	PRINTI ". Like swatting a fly with a sledge hammer, if you ask me."
	CRLF
	FSET PRSO,OPENBIT
	RTRUE
?L6:	CALL V-SWANZO >STACK
	RSTACK
?L1:	CALL V-SWANZO >STACK
	RSTACK

	.FUNCT V-SWANZO
	PRINTI "Although you complete the spell, nothing seems to have happened"
	EQUAL? PRSA,V?AIMFIZ \?L3
	PRINTI ". Perhaps this spell only works on people"
?L3:	PRINTR "."

	.FUNCT V-GOLMAC
	FSET? PRSO,ACTORBIT \?L1
	EQUAL? PRSO,BELBOZ,JEEARR /?L1
	MOVE PRSO,DIAL
	PRINTI "With a puff of smoke,"
	CALL ARTICLE,PRSO,1
	PRINTR " vanishes!"
?L1:	PRINTI "There is a puff of smoke, but when it clears"
	CALL ARTICLE,PRSO,1
	PRINTR " is still there."

	.FUNCT V-VARDIK
	PRINTI "The mind of"
	CALL ARTICLE,PRSO,1
	FSET? PRSO,ACTORBIT /?L3
	PRINTI " (if it has one)"
?L3:	PRINTR " is now shielded against evil spirits."

	.FUNCT V-VEZZA,VISION
	ZERO? PRSO /?L3
	EQUAL? PRSO,ME \?L1
?L3:	PRINTI "You see "
?L6:	RANDOM 10 >STACK
	GET VEZZAS,STACK >VISION
	ZERO? VISION /?L6
	PRINT VISION
	PRINTR " A moment later, the vision fades."
?L1:	PRINTI "Thanks to you,"
	CALL ARTICLE,PRSO,1
	PRINTI " is given a brilliant but momentary glimpse of "
	FSET? PRSO,ACTORBIT \?L20
	PRINTI "his"
	JUMP ?L24
?L20:	PRINTI "its"
?L24:	PRINTR " own future."

	.FUNCT V-YOMIN
	PRINTI "I'm afraid"
	CALL ARTICLE,PRSO,1
	PRINTR " doesn't have much of a mind for you to read."

	.FUNCT V-YONK
	FSET? PRSO,SPELLBIT /?L1
	PRINTR "Nothing happens. I think this spell is meant to be cast on other spells..."
?L1:	PRINTI "The words of the spell glow brightly for a moment."
	CRLF
	EQUAL? PRSO,MALYON-SPELL \FALSE
	SET 'MALYON-YONKED,1
	RETURN MALYON-YONKED

	.FUNCT ITAKE,VB=1,CNT,OBJ,?TMP
	ZERO? FWEEPED /?L1
	ZERO? VB /FALSE
	CALL BATTY
	RFALSE
?L1:	FSET? PRSO,TAKEBIT /?L6
	ZERO? VB /FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RFALSE
?L6:	IN? PRSO,YOUNGER-SELF \?L52
	EQUAL? PRSO,SPELL-BOOK \?L12
	CALL SPELL-BOOK-PASS-OFF-CHECK >STACK
	ZERO? STACK /?L12
	RETURN 2
?L12:	IN? PRSO,YOUNGER-SELF /?L16
?L52:	IN? PRSO,OLDER-SELF \?L15
?L16:	PRINTI "Your twin refuses to part with"
	CALL ARTICLE,PRSO,1
	PRINTI "."
	CRLF
	RETURN 2
?L15:	LOC PRSO >STACK
	IN? STACK,PROTAGONIST /?L23
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,PROTAGONIST >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,LOAD-ALLOWED \?L23
	ZERO? VB /?L24
	FIRST? PROTAGONIST >STACK \?L26
	PRINTI "Your load is too heavy"
	JUMP ?L30
?L26:	PRINTI "It's a little too heavy"
?L30:	LESS? LOAD-ALLOWED,LOAD-MAX \?L33
	PRINTI ", especially in light of your exhaustion"
?L33:	PRINTI "."
	CRLF
?L24:	RETURN 2
?L23:	CALL CCOUNT,PROTAGONIST >CNT
	GRTR? CNT,FUMBLE-NUMBER \?L43
	ZERO? VB /?L44
	PRINTI "You're holding too many things already."
	CRLF
?L44:	RETURN 2
?L43:	MOVE PRSO,PROTAGONIST
	CALL SCORE-OBJECT
	FSET PRSO,TOUCHBIT
	RTRUE

	.FUNCT SCORE-OBJECT
	EQUAL? PRSO,SWANZO-SCROLL \?L1
	EQUAL? HERE,STONE-HUT \?L1
	ADD SCORE,SWANZO-POINT >SCORE
	SET 'SWANZO-POINT,0
	RETURN SWANZO-POINT
?L1:	EQUAL? PRSO,VARDIK-SCROLL \?L3
	FSET? VARDIK-SCROLL,TOUCHBIT /?L3
	ADD SCORE,25 >SCORE
	RETURN SCORE
?L3:	EQUAL? PRSO,VILSTU-VIAL \?L4
	FSET? VILSTU-VIAL,TOUCHBIT /?L4
	ADD SCORE,10 >SCORE
	RETURN SCORE
?L4:	EQUAL? PRSO,MEEF-SCROLL \?L5
	FSET? MEEF-SCROLL,TOUCHBIT /?L5
	ADD SCORE,10 >SCORE
	RETURN SCORE
?L5:	EQUAL? PRSO,YONK-SCROLL \FALSE
	FSET? YONK-SCROLL,TOUCHBIT /FALSE
	ADD SCORE,10 >SCORE
	RETURN SCORE

	.FUNCT IDROP
	EQUAL? PRSO,HANDS \?L1
	CALL V-LOCK
	RFALSE
?L1:	IN? PRSO,PROTAGONIST /?L8
	LOC PRSO >STACK
	IN? STACK,PROTAGONIST /?L3
	PRINTI "You're not carrying"
	CALL ARTICLE,PRSO,1
	PRINTI "."
	CRLF
	RFALSE
?L3:	IN? PRSO,PROTAGONIST /?L8
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L8
	PRINTI "Impossible since"
	CALL ARTICLE,PRSO,1
	PRINTI " is closed."
	CRLF
	RFALSE
?L8:	EQUAL? HERE,TREE-BRANCH \?L13
	MOVE PRSO,TWISTED-FOREST
	RTRUE
?L13:	EQUAL? HERE,LAGOON \?L14
	MOVE PRSO,LAGOON-FLOOR
	RTRUE
?L14:	EQUAL? HERE,GLASS-MAZE \?L15
	CALL NO-FLOOR? >STACK
	ZERO? STACK /?L15
	CALL DROP-IN-MAZE
	MOVE PRSO,DIAL
	PRINTR "It drops into the shimmering light below you. A moment later, you hear a gentle thud."
?L15:	LOC PROTAGONIST >STACK
	MOVE PRSO,STACK
	RTRUE

	.FUNCT CCOUNT,OBJ,CNT=0,X
	FIRST? OBJ >X \?L4
?L3:	FSET? X,WEARBIT /?L5
	INC 'CNT
?L5:	NEXT? X >X /?L3
?L4:	RETURN CNT

	.FUNCT WEIGHT,OBJ,CONT,WT=0
	FIRST? OBJ >CONT \?L4
?L3:	EQUAL? OBJ,PLAYER \?L5
	FSET? CONT,WEARBIT \?L5
	INC 'WT
	JUMP ?L7
?L5:	CALL WEIGHT,CONT >STACK
	ADD WT,STACK >WT
?L7:	NEXT? CONT >CONT /?L3
?L4:	GETP OBJ,P?SIZE >STACK
	ADD WT,STACK >STACK
	RSTACK

	.FUNCT DESCRIBE-ROOM,LOOK?=0,V?,STR,AV
	SET 'V?,LOOK?
	ZERO? V? \?L1
	SET 'V?,VERBOSE
?L1:	ZERO? LIT \?L3
	ZERO? BLORTED \?L3
	PRINTI "It is pitch black"
	ZERO? FWEEPED /?L7
	PRINTI ", and your bat sonar-sense isn't much help in this terrain"
?L7:	PRINTI "."
	EQUAL? HERE,GRUE-LAIR \?L14
	PRINTI " Gurgling noises come from every direction!"
	JUMP ?L18
?L14:	ZERO? SPRAYED? \?L18
	PRINTI " Dangerous creatures, such as grues, probably abound in the darkness."
?L18:	CRLF
	RFALSE
?L3:	FSET? HERE,TOUCHBIT /?L23
	FSET HERE,TOUCHBIT
	SET 'V?,1
?L23:	IN? HERE,ROOMS \?L35
	PRINTD HERE
	ZERO? FLYING /?L30
	PRINTI " (you are flying)"
?L30:	LOC PROTAGONIST >STACK
	FSET? STACK,VEHBIT /?L35
	CRLF
?L35:	ZERO? LOOK? \?L41
	ZERO? SUPER-BRIEF /?L41
	EQUAL? HERE,GLASS-MAZE \TRUE
?L41:	LOC PROTAGONIST >AV
	FSET? AV,VEHBIT \?L42
	PRINTI ", in the "
	PRINTD AV
	CRLF
?L42:	ZERO? V? /?L49
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \TRUE
	ZERO? V? /?L49
	GETP HERE,P?LDESC >STR
	ZERO? STR /?L49
	PRINT STR
	CRLF
	JUMP ?L52
?L49:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-FLASH >STACK
?L52:	EQUAL? HERE,AV /TRUE
	FSET? AV,VEHBIT \TRUE
	GETP AV,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	RTRUE

	.FUNCT DESCRIBE-OBJECTS,V?=0
	ZERO? LIT \?L3
	ZERO? BLORTED /?L1
?L3:	FIRST? HERE >STACK \FALSE
	ZERO? V? \?L6
	SET 'V?,VERBOSE
?L6:	CALL PRINT-CONT,HERE,V?,-1 >STACK
	RSTACK
?L1:	CALL TOO-DARK >STACK
	RSTACK

	.FUNCT DESCRIBE-OBJECT,OBJ,V?,LEVEL,STR=0,AV
	SET 'DESC-OBJECT,OBJ
	ZERO? LEVEL \?L8
	GETP OBJ,P?DESCFCN >STACK
	CALL STACK,M-OBJDESC >STACK
	ZERO? STACK \TRUE
	ZERO? LEVEL \?L8
	FSET? OBJ,TOUCHBIT /?L5
	GETP OBJ,P?FDESC >STR
	ZERO? STR \?L4
?L5:	GETP OBJ,P?LDESC >STR
	ZERO? STR /?L3
?L4:	PRINT STR
	JUMP ?L18
?L3:	ZERO? LEVEL \?L8
	EQUAL? OBJ,OLDER-SELF \?L9
	ZERO? OLDER-INTRODUCED /TRUE
?L9:	PRINTI "There is"
	CALL ARTICLE,OBJ
	PRINTI " here"
	CALL PARANTHETICAL-NOTES,OBJ
	PRINTI "."
	JUMP ?L18
?L8:	GET INDENTS,LEVEL >STACK
	PRINT STACK
	CALL SPACELESS-ARTICLE,OBJ
	CALL PARANTHETICAL-NOTES,OBJ
?L18:	ZERO? LEVEL \?L21
	LOC PROTAGONIST >AV
	ZERO? AV /?L21
	FSET? AV,VEHBIT \?L21
	PRINTI " (outside the "
	PRINTD AV
	PRINTI ")"
?L21:	CRLF
	CALL SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /FALSE
	FIRST? OBJ >STACK \FALSE
	CALL PRINT-CONT,OBJ,V?,LEVEL >STACK
	RSTACK

	.FUNCT PARANTHETICAL-NOTES,OBJ
	EQUAL? OBJ,ROPE \?L1
	ZERO? ROPE-TO-BEAM /?L1
	PRINTI " (tied to the beam)"
	RTRUE
?L1:	FSET? OBJ,WEARBIT \?L5
	IN? OBJ,PROTAGONIST \?L5
	PRINTI " (being worn"
	FSET? OBJ,ONBIT \?L8
	PRINTI " and providing light)"
	RTRUE
?L8:	PRINTI ")"
	RTRUE
?L5:	FSET? OBJ,ONBIT \FALSE
	PRINTI " (providing light)"
	RTRUE

	.FUNCT PRINT-CONT,OBJ,V?=0,LEVEL=0,Y,1ST?,AV,STR,PV?=0,INV?=0
	FIRST? OBJ >Y \TRUE
	LOC PROTAGONIST >STACK
	FSET? STACK,VEHBIT \?L4
	LOC PROTAGONIST >AV
	JUMP ?L6
?L4:	SET 'AV,0
?L6:	SET '1ST?,1
	LOC OBJ >STACK
	EQUAL? PROTAGONIST,OBJ,STACK \?L7
	SET 'INV?,1
	JUMP ?L11
?L7:	ZERO? Y \?L12
?L58:	ZERO? 1ST? \?L14
	PUSH 1
	JUMP ?L11
?L14:	PUSH 0
	JUMP ?L11
?L12:	EQUAL? Y,AV \?L16
	SET 'PV?,1
	JUMP ?L24
?L16:	EQUAL? Y,PROTAGONIST /?L24
	FSET? Y,INVISIBLE /?L24
	FSET? Y,TOUCHBIT /?L24
	GETP Y,P?FDESC >STR
	ZERO? STR /?L24
	FSET? Y,NDESCBIT /?L19
	PRINT STR
	CRLF
?L19:	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L24
	LOC Y >STACK
	GETP STACK,P?DESCFCN >STACK
	ZERO? STACK \?L24
	FIRST? Y >STACK \?L24
	CALL PRINT-CONT,Y,V?,0
?L24:	NEXT? Y >Y /?L12
	JUMP ?L58
?L11:	FIRST? OBJ >Y /?L32
?L57:	ZERO? PV? /?L34
	ZERO? AV /?L34
	FIRST? AV >STACK \?L34
	CALL PRINT-CONT,AV,V?,LEVEL
?L34:	ZERO? 1ST? \FALSE
	RTRUE
?L32:	EQUAL? Y,AV,PROTAGONIST /?L53
	FSET? Y,INVISIBLE /?L53
	ZERO? INV? \?L41
	FSET? Y,TOUCHBIT /?L41
	GETP Y,P?FDESC >STACK
	ZERO? STACK \?L53
?L41:	FSET? Y,NDESCBIT /?L42
	ZERO? 1ST? /?L44
	CALL FIRSTER,OBJ,LEVEL >STACK
	ZERO? STACK /?L48
	LESS? LEVEL,0 \?L48
	SET 'LEVEL,0
?L48:	INC 'LEVEL
	SET '1ST?,0
?L44:	CALL DESCRIBE-OBJECT,Y,V?,LEVEL
	JUMP ?L53
?L42:	FIRST? Y >STACK \?L53
	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L53
	CALL PRINT-CONT,Y,V?,LEVEL
?L53:	NEXT? Y >Y /?L32
	JUMP ?L57

	.FUNCT PRINT-CONTENTS,OBJ,F,N,1ST?=1,IT?=0,TWO?=0
	FIRST? OBJ >F \FALSE
?L3:	NEXT? F >N /?L5
?L5:	ZERO? 1ST? /?L6
	SET '1ST?,0
	JUMP ?L11
?L6:	PRINTI ", "
	ZERO? N \?L11
	PRINTI "and "
?L11:	CALL SPACELESS-ARTICLE,F
	ZERO? IT? \?L16
	ZERO? TWO? \?L16
	SET 'IT?,F
	JUMP ?L18
?L16:	SET 'TWO?,1
	SET 'IT?,0
?L18:	SET 'F,N
	ZERO? F \?L3
	ZERO? IT? /TRUE
	ZERO? TWO? \TRUE
	CALL THIS-IS-IT,IT?
	RTRUE

	.FUNCT FIRSTER,OBJ,LEVEL
	EQUAL? OBJ,PROTAGONIST \?L1
	PRINTR "You are carrying:"
?L1:	IN? OBJ,ROOMS /FALSE
	GRTR? LEVEL,0 \?L6
	GET INDENTS,LEVEL >STACK
	PRINT STACK
?L6:	FSET? OBJ,SURFACEBIT \?L11
	PRINTI "Sitting on the "
	PRINTD OBJ
	PRINTR " is:"
?L11:	FSET? OBJ,ACTORBIT \?L15
	PRINTI "It looks like"
	CALL ARTICLE,OBJ,1
	PRINTR " is holding:"
?L15:	PRINTI "The "
	PRINTD OBJ
	PRINTR " contains:"

	.FUNCT GOTO,RM,V?=1,OLIT,OHERE
	SET 'OHERE,HERE
	SET 'OLIT,LIT
	MOVE PROTAGONIST,RM
	SET 'HERE,RM
	CALL LIT?,HERE >LIT
	ZERO? OLIT \?L1
	ZERO? LIT \?L1
	ZERO? SPRAYED? \?L1
	ZERO? RESURRECTING \?L1
	EQUAL? HERE,HAUNTED-HOUSE /?L1
	IN? GRUE-SUIT,PROTAGONIST /?L1
	RANDOM 100 >STACK
	LESS? 80,STACK /?L1
	CALL PRINT-ID,STR?116
	ZERO? BLORTED /?L3
	CALL JIGS-UP,STR?117
	RTRUE
?L3:	CALL JIGS-UP,STR?118
	RTRUE
?L1:	SET 'RESURRECTING,0
	CALL ROPE-BEAM-CHECK,1
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	EQUAL? HERE,RM \TRUE
	ZERO? V? /TRUE
	CALL V-FIRST-LOOK
	RTRUE

	.FUNCT ROPE-BEAM-CHECK,PRINT=0
	CALL HELD?,BEAM >STACK
	ZERO? STACK /?L1
	CALL HELD?,ROPE >STACK
	ZERO? STACK \?L1
	ZERO? ROPE-TO-BEAM /?L1
	MOVE ROPE,PROTAGONIST
	SET 'ROPE-PLACED,0
	SET 'ROPE-IN-LOWER-CHUTE,0
	FCLEAR BEAM,TRYTAKEBIT
	FCLEAR ROPE,TRYTAKEBIT
	ZERO? PRINT /FALSE
	PRINTR "(taking the rope first)"
?L1:	CALL HELD?,ROPE >STACK
	ZERO? STACK /FALSE
	CALL HELD?,BEAM >STACK
	ZERO? STACK \FALSE
	ZERO? ROPE-TO-BEAM /FALSE
	MOVE BEAM,PROTAGONIST
	ZERO? PRINT /FALSE
	PRINTR "(taking the beam of wood first)"

	.FUNCT JIGS-UP,DESC,STARVED=0
	ZERO? DESC /?L1
	PRINT DESC
	CRLF
?L1:	CALL FORGET-ALL
	CALL KILL-INTERRUPTS
	ZERO? SLEEPING /?L6
	CRLF
	PRINTI "...and a moment later you wake up in a cold sweat and realize you've been dreaming."
	CRLF
	SET 'SLEEPING,0
	FCLEAR TWISTED-FOREST,TOUCHBIT
	FCLEAR TREE-BRANCH,TOUCHBIT
	FCLEAR FOREST-EDGE,TOUCHBIT
	FCLEAR MINE-FIELD,TOUCHBIT
	FCLEAR SNAKE-PIT,TOUCHBIT
	FCLEAR MEADOW,TOUCHBIT
	FCLEAR RIVER-BANK,TOUCHBIT
	FCLEAR FORT-ENTRANCE,TOUCHBIT
	FCLEAR DRAWBRIDGE,TOUCHBIT
	FCLEAR RUINS,TOUCHBIT
	CALL QUEUE,I-PARROT,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-MAILMAN,25 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-TIRED,80 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-HUNGER,21 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-THIRST,18 >STACK
	PUT STACK,0,1
	SET 'LAST-SLEPT,MOVES
	RANDOM 12 >CODE-NUMBER
	MUL CODE-NUMBER,6 >CURRENT-TLOC
	GET NEXT-CODE-TABLE,CURRENT-TLOC >NEXT-NUMBER
	ADD SCORE,5 >SCORE
	MOVE SPELL-BOOK,PROTAGONIST
	SET 'HERE,YOUR-QUARTERS
	MOVE PROTAGONIST,BED
	CRLF
	CALL V-VERSION
	CRLF
	SET 'PRSO,0
	SET 'LIT,0
	PRINTR "Your frotz spell seems to have worn off during the night, and it is now pitch black."
?L6:	PRINTI " 
   ****  You have died  ****

"
	ZERO? RESURRECTION-ROOM /?L15
	IN? SWANZO-SCROLL,PROTAGONIST \?L17
	ZERO? SWANZO-POINT /?L17
	MOVE SWANZO-SCROLL,HOLLOW
	FCLEAR SWANZO-SCROLL,TOUCHBIT
?L17:	CALL ROPE-BEAM-CHECK
	CALL RANDOMIZE-OBJECTS
	CALL WEAR-OFF-SPELLS
	PRINTI "Your guardian angel, draped in white, appears floating in the nothingness before you. ""Gotten in a bit of a scrape, eh?"" he asks, writing frantically in a notebook. ""I'd love to chat, but we're so busy this month."" "
	EQUAL? RESURRECTION-ROOM,GLASS-MAZE \?L22
	PRINTI "The angel looks pained. ""I hate resurrections in these stupid glass mazes! I can never tell one room from the next."" A moment later, you appear in the maze. Unfortunately, this is one of the floor-less rooms. This time, your demise is permanent."
	CRLF
	CALL FINISH
	JUMP ?L32
?L22:	EQUAL? RESURRECTION-ROOM,RIVER-BED,STAGNANT-POOL,TOP-OF-FALLS \?L26
	ZERO? RIVER-EVAPORATED \?L26
	PRINTI "A moment later you find yourself at the bottom of a river, between a whirpool, some sharp rocks, and a school of river sharks. This time, your death is terminal."
	CRLF
	CALL FINISH
	JUMP ?L32
?L26:	CALL IN-GUILD-HALL?,RESURRECTION-ROOM >STACK
	ZERO? STACK /?L29
	FSET? TWISTED-FOREST,TOUCHBIT \?L29
	PRINTI "A look of consternation crosses the angel's face. ""According to the records, you're to be resurrected in your local Guild Hall. But that's quite far, and I've had a rough day. How about Egreth Castle instead, hmmm?"" Being disembodied, you find it difficult to object, and a moment later you are among the..."
	SET 'RESURRECTION-ROOM,RUINS
	JUMP ?L32
?L29:	PRINTI "The angel twitches his nose, and the nothingness is replaced by..."
?L32:	CRLF
	CRLF
	SET 'RESURRECTING,1
	CALL GOTO,RESURRECTION-ROOM
	EQUAL? RESURRECTION-ROOM,HOLLOW \?L37
	SET 'ROOM-NUMBER,24
	ZERO? SPLATTERED \?L37
	SET 'DORN-BEAST-WARNING,0
	SET 'DORN-BEAST-ROOM,0
	SET 'LAST-DORN-ROOM,0
	CALL QUEUE,I-DORN-BEAST,2 >STACK
	PUT STACK,0,1
?L37:	ZERO? STARVED /?L41
	PRINTI "Unfortunately, you are still long overdue for a meal and immediately drop dead again."
	CRLF
	CALL FINISH
?L41:	CALL IN-COAL-MINE? >STACK
	ZERO? STACK /?L46
	CALL QUEUE,I-SUFFOCATE,2 >STACK
	PUT STACK,0,1
	PRINTI "The air here is almost unbreathable."
	CRLF
?L46:	SET 'RESURRECTION-ROOM,0
	SET 'P-CONT,0
	RETURN 2
?L15:	PRINTI "Unfortunately, you made no provisions for your untimely death."
	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT RANDOMIZE-OBJECTS,F,N
	FIRST? PROTAGONIST >F /?L14
	RTRUE
?L1:	ZERO? F /TRUE
?L14:	NEXT? F >N /?L6
?L6:	FSET? F,SCROLLBIT \?L11
	EQUAL? HERE,HAUNTED-HOUSE,COAL-BIN-ROOM,DIAL-ROOM \?L9
	MOVE F,DIAL
	JUMP ?L11
?L9:	MOVE F,HERE
?L11:	SET 'F,N
	JUMP ?L1

	.FUNCT KILL-INTERRUPTS
	CALL INT,I-WAKE-UP >STACK
	PUT STACK,0,0
	CALL INT,I-HELLHOUND >STACK
	PUT STACK,0,0
	SET 'HELLHOUND-WARNING,0
	CALL INT,I-BOA >STACK
	PUT STACK,0,0
	SET 'BOA-WARNING,0
	CALL INT,I-LOCUSTS >STACK
	PUT STACK,0,0
	SET 'LOCUST-WARNING,0
	CALL INT,I-SUFFOCATE >STACK
	PUT STACK,0,0
	CALL INT,I-FLUME-TRIP >STACK
	PUT STACK,0,0
	CALL END-RIDE
	SET 'ROOM-NUMBER,13
	SET 'DORN-BEAST-ROOM,0
	SET 'LAST-DORN-ROOM,0
	CALL INT,I-DORN-BEAST >STACK
	PUT STACK,0,0
	SET 'DORN-BEAST-WARNING,0
	FCLEAR DORN-BEAST,NDESCBIT
	MOVE DORN-BEAST,DIAL
	SET 'FWEEPED,0
	SET 'SUFFOCATE-WARNING,0
	CALL INT,I-UNFWEEP >STACK
	PUT STACK,0,0
	CALL INT,I-BELBOZ-AWAKES >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT THIS-IS-IT,OBJ
	SET 'P-IT-OBJECT,OBJ
	RETURN P-IT-OBJECT

	.FUNCT VISIBLE?,OBJ,L
	LOC OBJ >L
	CALL ACCESSIBLE?,OBJ >STACK
	ZERO? STACK \TRUE
	CALL SEE-INSIDE?,L >STACK
	ZERO? STACK /FALSE
	CALL VISIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT OTHER-SIDE,DOBJ,P=0,TEE
?L1:	NEXTP HERE,P >P
	LESS? P,P?OUT /FALSE
	GETPT HERE,P >TEE
	PTSIZE TEE >STACK
	EQUAL? STACK,DEXIT \?L1
	GETB TEE,DEXITOBJ >STACK
	EQUAL? STACK,DOBJ \?L1
	RETURN P

	.FUNCT NOTHING-HELD?,X,N
	FIRST? PROTAGONIST >X \TRUE
?L11:	FSET? X,WEARBIT \FALSE
	NEXT? X >X /?L11
	RTRUE

	.FUNCT HELD?,OBJ
	ZERO? OBJ /FALSE
	IN? OBJ,PROTAGONIST /TRUE
	IN? OBJ,ROOMS /FALSE
	IN? OBJ,GLOBAL-OBJECTS /FALSE
	LOC OBJ >STACK
	CALL HELD?,STACK >STACK
	RSTACK

	.FUNCT SEE-INSIDE?,OBJ
	FSET? OBJ,INVISIBLE /FALSE
	FSET? OBJ,TRANSBIT /TRUE
	FSET? OBJ,OPENBIT /TRUE
	RFALSE

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,TEE
	GETPT OBJ2,P?GLOBAL >TEE
	ZERO? TEE /FALSE
	PTSIZE TEE >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,TEE,STACK >STACK
	RSTACK

	.FUNCT FIND-IN,WHERE,WHAT,W
	FIRST? WHERE >W \FALSE
?L2:	FSET? W,WHAT \?L7
	RETURN W
?L7:	NEXT? W >W /?L2
	RFALSE

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR >STACK
	RSTACK

	.FUNCT ROB,WHO,N,X
	FIRST? WHO >X /?L4
	RTRUE
?L1:	ZERO? X /TRUE
?L4:	NEXT? X >N /?L7
?L7:	MOVE X,DIAL
	SET 'X,N
	JUMP ?L1

	.FUNCT STOP
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RETURN 2

	.FUNCT HACK-HACK,STR
	PRINT STR
	CALL ARTICLE,PRSO,1
	CALL PICK-ONE,HO-HUM >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT OPEN-CLOSE
	EQUAL? PRSA,V?OPEN \?L1
	FSET? PRSO,OPENBIT \?L1
	CALL ALREADY-OPEN
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? PRSO,OPENBIT /FALSE
	CALL ALREADY-CLOSED
	RTRUE

	.FUNCT SPACELESS-ARTICLE,OBJ,THE=0
	FSET? OBJ,NARTICLEBIT /?L9
	ZERO? THE /?L3
	PRINTI "the "
	JUMP ?L9
?L3:	FSET? OBJ,VOWELBIT \?L6
	PRINTI "an "
	JUMP ?L9
?L6:	PRINTI "a "
?L9:	PRINTD OBJ
	RTRUE

	.FUNCT ARTICLE,OBJ,THE=0
	PRINTI " "
	ZERO? THE /?L3
	CALL SPACELESS-ARTICLE,OBJ,1 >STACK
	RSTACK
?L3:	CALL SPACELESS-ARTICLE,OBJ >STACK
	RSTACK

	.FUNCT CANT-ENTER,LOC,LEAVE=0
	PRINTI "You can't "
	ZERO? LEAVE /?L3
	PRINTI "leave"
	JUMP ?L7
?L3:	PRINTI "enter"
?L7:	CALL ARTICLE,LOC,1
	PRINTR " from here."

	.FUNCT YOU-CANT-SEE-ANY,STRING
	PRINTI "You can't see any "
	PRINT STRING
	PRINTR " here!"

	.FUNCT WITH???
	PRINTI "With"
	CALL ARTICLE,PRSI
	PRINTR "??!?"

	.FUNCT TELL-ME-HOW
	PRINTI "You must tell me how to do that to"
	CALL ARTICLE,PRSO
	PRINTR "."

	.FUNCT NOT-GOING-ANYWHERE,VEHICLE
	PRINTI "You're not going anywhere until you get out of the "
	PRINTD VEHICLE
	PRINTR "."

	.FUNCT SPLASH
	PRINTI "With a splash,"
	CALL ARTICLE,PRSO,1
	PRINTR " plunges into the water."

	.FUNCT BURIED-IN-COAL,STRING
	MOVE PRSO,DIAL
	PRINTI "When you "
	PRINT STRING
	CALL ARTICLE,PRSO,1
	PRINTR " it falls between the lumps of coal and is buried."

	.FUNCT LOOK-AROUND-YOU
	PRINTR "Look around you."

	.FUNCT BATTY
	PRINTR "You're batty!"

	.FUNCT TOO-DARK
	PRINTI "It's too dark to see"
	ZERO? FWEEPED /?L3
	PRINTR ", and your bat sonar-sense isn't of much help, either."
?L3:	PRINTR "!"

	.FUNCT WHILE-FLYING
	PRINTR "While flying?"

	.FUNCT CANT-GO
	PRINTR "You can't go that way."

	.FUNCT NOW-BLACK
	PRINTR "It is now pitch black."

	.FUNCT ALREADY-OPEN
	PRINTR "It is already open."

	.FUNCT ALREADY-CLOSED
	PRINTR "It is already closed."

	.FUNCT MAKE-OUT
	PRINTR "You can't make out anything."

	.FUNCT BOOK-DAMP
	PRINTR "The book is damp and the writing unreadable."

	.FUNCT REFERRING
	PRINTR "I don't see what you're referring to."

	.FUNCT POOR-LISTENERS
	PRINTR "Sleeping gnomes make poor listeners."

	.FUNCT SETTLE-ONTO-BRANCH
	PRINTR "You settle onto the branch."

	.FUNCT SPLASH-INTO-WATER
	PRINTR "You splash down into the water."

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	PRINTD OBJ
	RTRUE

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-THEFT?
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,BALL,KNIFE,PARROT /TRUE
	EQUAL? PRSO,MAGIC-AMULET,TINY-BOX,JOURNAL /TRUE
	EQUAL? PRSO,WHEEL,WALL-HANGING,MORGIA-PLANT /TRUE
	EQUAL? PRSO,GASPAR-SCROLL,MEEF-SCROLL \FALSE
	RTRUE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,AIMFIZ-SCROLL,ARCHWAY,BALL /TRUE
	EQUAL? PRSO,BANKS,BAT,BAT-GUANO /TRUE
	EQUAL? PRSO,BEACH,BEAM,BELBOZ /TRUE
	EQUAL? PRSO,BELBOZ-DESK,BERZIO-POTION,BERZIO-VIAL /TRUE
	EQUAL? PRSO,BLACK-BUTTON,BLACK-DOOR,BLORT-POTION /TRUE
	EQUAL? PRSO,BLORT-VIAL,BOOTH,BOZBARLAND /TRUE
	EQUAL? PRSO,BRASS-LANTERN,BRICK-STRUCTURE,BRIDGE /TRUE
	EQUAL? PRSO,CALENDAR,CANNON,CAR /TRUE
	EQUAL? PRSO,CASTLE,CAVE,CEILING /TRUE
	EQUAL? PRSO,CHAMBER-DOOR,CHIMNEY,COAL /TRUE
	EQUAL? PRSO,COAL-BIN,CORRIDOR,CRATE /TRUE
	EQUAL? PRSO,DESK-DRAWER,DIAL,DIAL-DOOR /TRUE
	EQUAL? PRSO,DRAGON,ENCYCLOPEDIA,FIREPLACE /TRUE
	EQUAL? PRSO,FLAG,FLAG-POLE,FLAXO-POTION /TRUE
	EQUAL? PRSO,FLAXO-VIAL,FLUME-OBJECT,FOOBLE-POTION /TRUE
	EQUAL? PRSO,FOOBLE-VIAL,FOREST,FORT /TRUE
	EQUAL? PRSO,FROBAR-NOTE,FWEEP-SCROLL,GASPAR-SCROLL /TRUE
	EQUAL? PRSO,GATE,GOLMAC-SCROLL,GRAY-BUTTON /TRUE
	EQUAL? PRSO,GRUE-REPELLENT,GRUE-SUIT,HOVEL /TRUE
	EQUAL? PRSO,JOURNAL,KEROSENE-LAMP,KEY /TRUE
	EQUAL? PRSO,KNIFE,LOG-BOAT,LOWER-CHUTE /TRUE
	EQUAL? PRSO,MACHINERY,MAGAZINE,MAGIC-AMULET /TRUE
	EQUAL? PRSO,MAILBOX,MALYON-SCROLL,MATCHBOOK /TRUE
	EQUAL? PRSO,MAZE,MEADOW-OBJECT,MEEF-SCROLL /TRUE
	EQUAL? PRSO,MORGIA-PLANT,MOSS,PURPLE-BUTTON /TRUE
	EQUAL? PRSO,RED-BUTTON,ROAD,ROPE /TRUE
	EQUAL? PRSO,SIGNPOST,SILVER-DOOR,SLOT-MACHINE /TRUE
	EQUAL? PRSO,SPENSEWEEDS,STAIRS,STATUE /TRUE
	EQUAL? PRSO,SWANZO-SCROLL,TENETS,TINY-BOX /TRUE
	EQUAL? PRSO,TORTURE-DEVICES,TREE,TRUNK /TRUE
	EQUAL? PRSO,UNDERGROWTH,UPPER-CHUTE,VARDIK-SCROLL /TRUE
	EQUAL? PRSO,VILSTU-POTION,VILSTU-VIAL,VINES /TRUE
	EQUAL? PRSO,WALL-HANGING,WALLS,WATER /TRUE
	EQUAL? PRSO,WATERFALL,WAXER,WHEEL /TRUE
	EQUAL? PRSO,WHITE-BUTTON,WHITE-DOOR,YIPPLES /TRUE
	EQUAL? PRSO,YONK-SCROLL,ZORKMID,ZORKMID-TREE \FALSE
	RTRUE

	.FUNCT IS-PERSON?
	EQUAL? PRSO,YOUNGER-SELF,IMPLEMENTOR,GNOME /TRUE
	EQUAL? PRSO,FROBAR,HAWKER,HELISTAR /TRUE
	EQUAL? PRSO,OLDER-SELF,PARK-GNOME \FALSE
	RTRUE

	.FUNCT IS-ANIMAL?
	EQUAL? PRSO,MUTATED-GRUES,HELLHOUND,BOA /TRUE
	EQUAL? PRSO,DORN-BEAST,GRUE,JEEARR /TRUE
	EQUAL? PRSO,PARROT,PLAGUE-OF-LOCUSTS,RABBITS /TRUE
	EQUAL? PRSO,TROGLODYTE,VIPERS \FALSE
	RTRUE

	.FUNCT IS-SELF?
	EQUAL? PRSO,ME \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? PRSO,HANDS \FALSE
	RTRUE

	.FUNCT IS-SELF-OR-PART-OF-SELF?,?TMP
	CALL IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-PART-OF-SELF? >STACK
	RSTACK

	.FUNCT IS-YOUR-PROPERTY?
	EQUAL? PRSO,BED,SPELL-BOOK \FALSE
	RTRUE

	.FUNCT DANGEROUS-DRINK?
	EQUAL? PRSO,OCEAN \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?
	CALL IS-PART-OF-SELF? >STACK
	ZERO? STACK \?L2
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	ZERO? STACK /FALSE
?L2:	EQUAL? PRSO,BERZIO-POTION \TRUE
	RFALSE

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-ANIMAL? >STACK
	RSTACK

	.FUNCT PICK-ONE,FROB
	GET FROB,0 >STACK
	RANDOM STACK >STACK
	GET FROB,STACK >STACK
	RSTACK

	.FUNCT FIXED-FONT-ON
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT FIXED-FONT-OFF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT GO
START::
?L0:	PUTB P-LEXV,0,59
	CALL QUEUE,I-WAKE-UP,7 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-HELLHOUND,-1 >STACK
	PUT STACK,0,1
	SET 'LIT,1
	SET 'WINNER,PROTAGONIST
	SET 'PLAYER,WINNER
	SET 'HERE,TWISTED-FOREST
	MOVE WINNER,HERE
	CALL THIS-IS-IT,HELLHOUND
	PUTB P-INBUF,0,60
	PRINTI "You are in a strange location, but you cannot remember how you got here. Everything is hazy, as though viewed through a gauze..."
	CRLF
	CRLF
	CALL V-LOOK
	CALL I-HELLHOUND
	CALL MAIN-LOOP
	JUMP ?L0

	.FUNCT MAIN-LOOP,TRASH
?L1:	CALL MAIN-LOOP-1 >TRASH
	JUMP ?L1

	.FUNCT MAIN-LOOP-1,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP
	SET 'LAST-USED-PRSO,0
	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	CALL PARSER >P-WON
	ZERO? P-WON /?L1
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	ZERO? P-IT-OBJECT /?L3
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L3
	SET 'TMP,0
?L5:	IGRTR? 'CNT,ICNT /?L6
	GET P-PRSI,CNT >STACK
	EQUAL? STACK,IT \?L5
	PUT P-PRSI,CNT,P-IT-OBJECT
	SET 'TMP,1
?L6:	ZERO? TMP \?L16
	SET 'CNT,0
?L15:	IGRTR? 'CNT,OCNT /?L16
	GET P-PRSO,CNT >STACK
	EQUAL? STACK,IT \?L15
	PUT P-PRSO,CNT,P-IT-OBJECT
?L16:	SET 'CNT,0
?L3:	ZERO? OCNT \?L25
	SET 'NUM,OCNT
	JUMP ?L32
?L25:	GRTR? OCNT,1 \?L27
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L28
	SET 'OBJ,0
	JUMP ?L30
?L28:	GET P-PRSI,1 >OBJ
?L30:	SET 'NUM,OCNT
	JUMP ?L32
?L27:	GRTR? ICNT,1 \?L31
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L32
?L31:	SET 'NUM,1
?L32:	ZERO? OBJ \?L33
	EQUAL? ICNT,1 \?L33
	GET P-PRSI,1 >OBJ
?L33:	EQUAL? PRSA,V?WALK \?L36
	CALL PERFORM,PRSA,PRSO >V
	JUMP ?L60
?L36:	ZERO? NUM \?L38
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	ZERO? STACK \?L39
	CALL PERFORM,PRSA >V
	SET 'PRSO,0
	JUMP ?L60
?L39:	ZERO? LIT \?L41
	ZERO? BLORTED \?L41
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	CALL TOO-DARK
	JUMP ?L60
?L41:	EQUAL? HERE,CHAMBER-OF-LIVING-DEATH,HALL-OF-ETERNAL-PAIN \?L42
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	CALL AGONY
	JUMP ?L60
?L42:	PRINTI "There isn't anything to "
	GET P-ITBL,P-VERBN >TMP
	EQUAL? PRSA,V?TELL \?L46
	PRINTI "talk to"
	JUMP ?L52
?L46:	ZERO? P-OFLAG \?L51
	ZERO? P-MERGED /?L50
?L51:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L52
?L50:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L52:	PRINTI "!"
	CRLF
	SET 'V,0
	JUMP ?L60
?L38:	SET 'P-NOT-HERE,0
	SET 'P-MULT,0
	GRTR? NUM,1 \?L56
	SET 'P-MULT,1
?L56:	SET 'TMP,0
?L59:	IGRTR? 'CNT,NUM \?L61
	GRTR? P-NOT-HERE,0 \?L63
	PRINTI "The "
	EQUAL? P-NOT-HERE,NUM /?L67
	PRINTI "other "
?L67:	PRINTI "object"
	EQUAL? P-NOT-HERE,1 /?L74
	PRINTI "s"
?L74:	PRINTI " that you mentioned "
	EQUAL? P-NOT-HERE,1 /?L81
	PRINTI "are"
	JUMP ?L85
?L81:	PRINTI "is"
?L85:	PRINTI "n't here."
	CRLF
	JUMP ?L60
?L63:	ZERO? TMP \?L60
	CALL REFERRING
	JUMP ?L60
?L61:	ZERO? PTBL /?L93
	GET P-PRSO,CNT >OBJ1
	JUMP ?L95
?L93:	GET P-PRSI,CNT >OBJ1
?L95:	ZERO? PTBL /?L96
	SET 'PRSO,OBJ1
	JUMP ?L98
?L96:	SET 'PRSO,OBJ
?L98:	ZERO? PTBL /?L99
	SET 'PRSI,OBJ
	JUMP ?L101
?L99:	SET 'PRSI,OBJ1
?L101:	GRTR? NUM,1 /?L104
	GET P-ITBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL \?L113
?L104:	EQUAL? OBJ1,NOT-HERE-OBJECT \?L105
	INC 'P-NOT-HERE
	JUMP ?L59
?L105:	EQUAL? P-GETFLAGS,P-ALL \?L107
	EQUAL? PRSA,V?TAKE \?L110
	LOC OBJ1 >STACK
	EQUAL? STACK,WINNER,HERE,OBJ /?L109
	LOC OBJ1 >STACK
	FSET? STACK,SURFACEBIT /?L109
	LOC OBJ1 >STACK
	EQUAL? STACK,FIREPLACE \?L59
?L109:	FSET? OBJ1,TAKEBIT /?L107
	FSET? OBJ1,TRYTAKEBIT \?L59
?L107:	EQUAL? PRSA,V?TAKE \?L110
	ZERO? PRSI /?L110
	GET P-ITBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL \?L110
	IN? PRSO,PRSI /?L110
	CALL DESK-KLUDGE >STACK
	ZERO? STACK \?L59
?L110:	EQUAL? P-GETFLAGS,P-ALL \?L111
	EQUAL? PRSA,V?DROP \?L111
	IN? OBJ1,WINNER /?L111
	IN? P-IT-OBJECT,WINNER \?L59
?L111:	CALL VISIBLE?,OBJ1 >STACK
	ZERO? STACK /?L59
	EQUAL? OBJ1,IT \?L114
	PRINTD P-IT-OBJECT
	JUMP ?L116
?L114:	PRINTD OBJ1
?L116:	PRINTI ": "
?L113:	SET 'TMP,1
	CALL PERFORM,PRSA,PRSO,PRSI >V
	SET 'LAST-USED-PRSO,PRSO
	EQUAL? V,M-FATAL \?L59
?L60:	EQUAL? V,M-FATAL /?L141
	EQUAL? PRSA,V?SUPER-BRIEF,V?BRIEF,V?TELL /?L128
	EQUAL? PRSA,V?VERSION,V?SAVE,V?VERBOSE /?L128
	EQUAL? PRSA,V?UNSCRIPT,V?SCRIPT,V?RESTORE /?L128
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-END >V
?L128:	EQUAL? V,M-FATAL \?L133
?L141:	SET 'P-CONT,0
	JUMP ?L133
?L1:	SET 'P-CONT,0
?L133:	ZERO? P-WON /FALSE
	EQUAL? PRSA,V?SUPER-BRIEF,V?BRIEF,V?TELL /TRUE
	EQUAL? PRSA,V?VERSION,V?SAVE,V?VERBOSE /TRUE
	EQUAL? PRSA,V?RESTART,V?QUIT,V?TIME /TRUE
	EQUAL? PRSA,V?UNSCRIPT,V?SCRIPT,V?SCORE /TRUE
	EQUAL? PRSA,V?$0024COMMAND,V?$0024RANDOM,V?RESTORE /TRUE
	EQUAL? PRSA,V?$0024UNRECORD,V?$0024RECORD /TRUE
	CALL CLOCKER >V
	RETURN V

	.FUNCT DESK-KLUDGE
	EQUAL? PRSI,BELBOZ-DESK \TRUE
	IN? PRSO,DESK-DRAWER \TRUE
	RFALSE

	.FUNCT FAKE-ORPHAN,TMP
	CALL ORPHAN,P-SYNTAX,0
	PRINTI "Be specific: what object do you want to "
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L3
	PRINTI "tell"
	JUMP ?L8
?L3:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L7
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L8
?L7:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L8:	SET 'P-OFLAG,1
	SET 'P-WON,0
	GETB P-SYNTAX,P-SPREP1 >STACK
	CALL PREP-PRINT,STACK
	PRINTR "?"

	.FUNCT PERFORM,A,O=0,I=0,V,OA,OO,OI
	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	SET 'PRSA,A
	EQUAL? IT,I,O \?L1
	ZERO? I \?L3
	CALL FAKE-ORPHAN
	RETURN 2
?L3:	CALL REFERRING
	RETURN 2
?L1:	SET 'PRSO,O
	ZERO? PRSO /?L9
	EQUAL? PRSA,V?WALK /?L9
	EQUAL? PRSO,NOT-HERE-OBJECT /?L9
	CALL THIS-IS-IT,PRSO
?L9:	SET 'PRSI,I
	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \?L12
	CALL D-APPLY,STR?119,NOT-HERE-OBJECT-F >V
	ZERO? V /?L12
	SET 'P-WON,0
	JUMP ?L22
?L12:	SET 'O,PRSO
	SET 'I,PRSI
	GETP WINNER,P?ACTION >STACK
	CALL D-APPLY,STR?120,STACK >V
	ZERO? V \?L22
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL D-APPLY,STR?121,STACK,M-BEG >V
	ZERO? V \?L22
	GET PREACTIONS,A >STACK
	CALL D-APPLY,STR?122,STACK >V
	ZERO? V \?L22
	ZERO? I /?L19
	GETP I,P?ACTION >STACK
	CALL D-APPLY,STR?123,STACK >V
	ZERO? V \?L22
?L19:	ZERO? O /?L21
	EQUAL? A,V?WALK /?L20
	LOC O >STACK
	ZERO? STACK /?L20
	LOC O >STACK
	GETP STACK,P?CONTFCN >STACK
	ZERO? STACK /?L20
	LOC O >STACK
	GETP STACK,P?CONTFCN >STACK
	CALL D-APPLY,STR?124,STACK >V
	ZERO? V \?L22
?L20:	ZERO? O /?L21
	EQUAL? A,V?WALK /?L21
	GETP O,P?ACTION >STACK
	CALL D-APPLY,STR?125,STACK >V
	ZERO? V \?L22
?L21:	GET ACTIONS,A >STACK
	CALL D-APPLY,0,STACK >V
	ZERO? V /?L22
?L22:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT D-APPLY,STR,FCN,FOO=0,RES
	ZERO? FCN /FALSE
	ZERO? FOO /?L4
	CALL FCN,FOO >RES
	RETURN RES
?L4:	CALL FCN >RES
	RETURN RES

	.FUNCT QUEUE,RTN,TICK,CINT
	CALL INT,RTN >CINT
	PUT CINT,C-TICK,TICK
	RETURN CINT

	.FUNCT INT,RTN,DEMON=0,E,C,INT?1
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	SUB C-INTS,C-INTLEN >C-INTS
	ZERO? DEMON /?L5
	SUB C-DEMONS,C-INTLEN >C-DEMONS
?L5:	ADD C-TABLE,C-INTS >INT?1
	PUT INT?1,C-RTN,RTN
	RETURN INT?1
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L7
	RETURN C
?L7:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT CLOCKER,C,E,TICK,FLG=0
	ZERO? CLOCK-WAIT /?L1
	SET 'CLOCK-WAIT,0
	RFALSE
?L1:	ZERO? P-WON /?L4
	PUSH C-INTS
	JUMP ?L6
?L4:	PUSH C-DEMONS
?L6:	ADD C-TABLE,STACK >C
	ADD C-TABLE,C-TABLELEN >E
?L7:	EQUAL? C,E \?L9
	INC 'MOVES
	RETURN FLG
?L9:	GET C,C-ENABLED? >STACK
	ZERO? STACK /?L15
	GET C,C-TICK >TICK
	ZERO? TICK /?L15
	SUB TICK,1 >STACK
	PUT C,C-TICK,STACK
	GRTR? TICK,1 /?L15
	GET C,C-RTN >STACK
	CALL STACK >STACK
	ZERO? STACK /?L15
	SET 'FLG,1
?L15:	ADD C,C-INTLEN >C
	JUMP ?L7

	.FUNCT NULL-F
	RFALSE

	.FUNCT BED-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?WALK \?L3
	CALL NOT-GOING-ANYWHERE,BED >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?TAKE \FALSE
	CALL HELD?,PRSO >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSO,GLOBAL-SLEEP,GRUE,ME /FALSE
	EQUAL? PRSO,BED /FALSE
	IN? PRSO,BED /FALSE
	PRINTR "You can't reach it from the bed."
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L13
	PRINTR "Huh?"
?L13:	EQUAL? PRSA,V?WALK-TO \?L16
	CALL PERFORM,V?WALK-TO,GLOBAL-SLEEP
	RTRUE
?L16:	EQUAL? PRSA,V?LIE-DOWN,V?CLIMB-ON \FALSE
	CALL PERFORM,V?BOARD,PRSO
	RTRUE

	.FUNCT GLOBAL-BED-F
	EQUAL? GLOBAL-BED,PRSO \?L1
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,BED,PRSI
	RTRUE
?L1:	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,BED
	RTRUE

	.FUNCT BELBOZ-QUARTERS-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The personal chamber of Belboz, who presides over the Circle of Enchanters, is appointed with a beautiful woven wall hanging"
	IN? MORGIA-PLANT,HERE \?L5
	PRINTI ", an exotic morgia plant,"
?L5:	PRINTR " and a wide darkwood desk crafted by the artisans of Gurth. The hallway lies to the east."

	.FUNCT PERCH-PSEUDO
	EQUAL? PRSA,V?CLIMB-ON \FALSE
	PRINTR "I'd recommend a good doctor, but we need the eggs."

	.FUNCT PARROT-F
	EQUAL? PRSA,V?TAKE \FALSE
	PRINTI "The parrot hops to the other end of the perch."
	CRLF
	CALL PRINT-ID,STR?126 >STACK
	RSTACK

	.FUNCT I-PARROT
	IN? PARROT,HERE \FALSE
	RANDOM 100 >STACK
	LESS? 40,STACK /FALSE
	CRLF
	PRINTI """Squawk! "
	CALL PICK-ONE,PARROTISMS >STACK
	PRINT STACK
	PRINTR " Squawk!"""

	.FUNCT BELBOZ-DESK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The desk has one drawer which is "
	FSET? DESK-DRAWER,OPENBIT \?L5
	PRINTI "open"
	JUMP ?L9
?L5:	PRINTI "closed"
?L9:	PRINTI "."
	CRLF
	FIRST? PRSO >STACK \TRUE
	RFALSE
?L1:	EQUAL? PRSA,V?SEARCH \?L17
	FSET? DESK-DRAWER,OPENBIT /?L17
	FIRST? DESK-DRAWER >STACK \?L17
	PRINTI "You open the desk drawer and find "
	CALL PRINT-CONTENTS,DESK-DRAWER
	FSET DESK-DRAWER,OPENBIT
	PRINTR "."
?L17:	EQUAL? PRSA,V?REZROV,V?OPEN,V?CLOSE /?L23
	EQUAL? PRSA,V?LOOK-INSIDE,V?REACH-IN \?L22
?L23:	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,DESK-DRAWER
	RTRUE
?L22:	EQUAL? PRSA,V?TAKE \?L24
	EQUAL? BELBOZ-DESK,PRSI \?L24
	FIRST? DESK-DRAWER >STACK \?L24
	CALL PERFORM,V?TAKE,PRSO,DESK-DRAWER
	FIRST? BELBOZ-DESK >STACK \TRUE
	RFALSE
?L24:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,BELBOZ-DESK \FALSE
	CALL PERFORM,V?PUT,PRSO,DESK-DRAWER
	RTRUE

	.FUNCT TINY-BOX-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "There is writing on the lid of the box."
	CRLF
	CALL PERFORM,V?READ,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
""    MAGIC AMULET

The closer this amulet is to
its owner, the brighter it may
glow. Ideal for leaving with
your loved ones if you go on
a long and hazardous journey.

This amulet is sensitized to
-> BELBOZ THE NECROMANCER

Another fine product of the
Frobozz Magic Amulet Company."""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT MAGIC-AMULET-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "A blue jewel hangs from a long golden chain. The jewel is "
	CALL AMULET-GLOWS
	PRINTR "."
?L1:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "The Amulet of Aggthora was a legendary jewel renowned for its powers of augury."

	.FUNCT AMULET-DESCFCN,RARG
	PRINTI "There is an amulet here. The amulet's jewel is "
	CALL AMULET-GLOWS
	PRINTR "."

	.FUNCT AMULET-GLOWS
	CALL IN-GUILD-HALL? >STACK
	ZERO? STACK /?L1
	PRINTI "dark"
	RTRUE
?L1:	CALL IN-MAZE-AREA? >STACK
	ZERO? STACK /?L5
	PRINTI "glowing"
	RTRUE
?L5:	CALL IN-CRATER-AREA? >STACK
	ZERO? STACK /?L8
	PRINTI "glowing brightly"
	RTRUE
?L8:	CALL IN-COAL-MINE? >STACK
	ZERO? STACK /?L11
	PRINTI "glowing very brightly"
	RTRUE
?L11:	CALL IN-END-GAME? >STACK
	ZERO? STACK /?L14
	PRINTI "pulsing with flashes of brilliant light"
	RTRUE
?L14:	PRINTI "glowing dimly"
	RTRUE

	.FUNCT IN-GUILD-HALL?,X=0
	ZERO? X \?L1
	SET 'X,HERE
?L1:	EQUAL? X,HALLWAY-1,HALLWAY-2,CHAMBER-OF-THE-CIRCLE /TRUE
	EQUAL? X,YOUR-QUARTERS,BELBOZ-QUARTERS,LOBBY /TRUE
	EQUAL? X,FROBAR-QUARTERS,HELISTAR-QUARTERS,STORE-ROOM /TRUE
	EQUAL? X,LIBRARY,CELLAR /TRUE
	EQUAL? X,APPRENTICE-QUARTERS,SERVANT-QUARTERS \FALSE
	RTRUE

	.FUNCT IN-COAL-MINE?
	EQUAL? HERE,COAL-BIN-ROOM,DIAL-ROOM,SHAFT-BOTTOM /TRUE
	EQUAL? HERE,SHAFT-TOP,TOP-OF-CHUTE,SLANTED-ROOM /TRUE
	EQUAL? HERE,COAL-MINE-1,COAL-MINE-2,COAL-MINE-3 \FALSE
	RTRUE

	.FUNCT IN-MAZE-AREA?
	EQUAL? HERE,TOLL-GATE,END-OF-HIGHWAY,HOLLOW /TRUE
	EQUAL? HERE,OUTSIDE-GLASS-DOOR,GLASS-MAZE,STORE /TRUE
	EQUAL? HERE,ENTRANCE-HALL,STONE-HUT,OUTSIDE-STORE \FALSE
	RTRUE

	.FUNCT IN-CRATER-AREA?
	EQUAL? HERE,HIGHWAY,BEND,EDGE-OF-CRATER /TRUE
	EQUAL? HERE,CRATER,WINDING-TUNNEL,HALL-OF-CARVINGS /TRUE
	EQUAL? HERE,EDGE-OF-CHASM,BARE-PASSAGE,SOOTY-ROOM /TRUE
	EQUAL? HERE,ELBOW-ROOM,TREE-ROOM,PARK-ENTRANCE /TRUE
	EQUAL? HERE,EAST-END-OF-MIDWAY,FLUME,HAUNTED-HOUSE /TRUE
	EQUAL? HERE,WEST-END-OF-MIDWAY,ROLLER-COASTER,ARCADE /TRUE
	EQUAL? HERE,CASINO \FALSE
	RTRUE

	.FUNCT IN-END-GAME?
	EQUAL? HERE,OCEAN-NORTH,OCEAN-SOUTH,BELBOZ-HIDEOUT /TRUE
	EQUAL? HERE,MOUTH-OF-RIVER,GRUE-LAIR,MAMMOTH-CAVERN /TRUE
	EQUAL? HERE,CHAMBER-OF-LIVING-DEATH,COVE,LAGOON-FLOOR /TRUE
	EQUAL? HERE,HALL-OF-ETERNAL-PAIN,LAGOON \FALSE
	RTRUE

	.FUNCT JOURNAL-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE,V?READ \?L1
	FSET? JOURNAL,OPENBIT \?L3
	PRINTI "You skim through the pages of the journal, a combination diary and notebook. Most of the notations, written in Belboz's familiar flowing script, deal with meetings of the Circle and business of the Guild.

There is one interesting entry toward the end of the book. Belboz refers to an ancient and evil force known simply as Jeearr, a demon whose powers could endanger the Circle and possibly the entire kingdom. He has decided to conduct some dangerous exploratory experiments, operating alone to shield the Circle from the perils involved.

The last three entries are strange and frightening -- written in a hand quite different from that of Belboz, and in a language totally unfamiliar to you.

On the inside cover is an inscription, written in a light script, which reads ""Current code: "
	GET CODE-TABLE,CODE-NUMBER >STACK
	PRINT STACK
	PRINTR """."
?L3:	PRINTR "It's closed and sealed with a lock."
?L1:	EQUAL? PRSA,V?REZROV,V?UNLOCK,V?OPEN \FALSE
	FSET? JOURNAL,OPENBIT \?L11
	PRINTR "The journal is already open!"
?L11:	EQUAL? PRSA,V?REZROV \?L15
	PRINTR "The journal seems to bear a spell protecting it against the simple rezrov spell."
?L15:	ZERO? PRSI \?L25
	IN? KEY,PROTAGONIST \?L21
	SET 'PRSI,KEY
	PRINTI "(with the key)"
	CRLF
	JUMP ?L25
?L21:	SET 'PRSI,HANDS
?L25:	EQUAL? PRSI,KEY \?L27
	FSET JOURNAL,OPENBIT
	PRINTR "The journal springs open."
?L27:	PRINTI "You can't unlock it with"
	CALL ARTICLE,PRSI
	PRINTR "."

	.FUNCT WHEEL-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "Like most infotaters, this one has several windows and a rotating data wheel. It is leather-bound and beautifully illustrated. "
	CALL INFOTATER-NOTE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?READ \?L5
	PRINTI "The infotater has entries on a dozen native beasts. "
	CALL INFOTATER-NOTE >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?SPIN,V?TURN \?L8
	PRINTR "Refer to the infotater in your SORCERER package."
?L8:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "The infotater, which popular legends say was invented by Entharion the Wise, is the best way to store data ever discovered."

	.FUNCT INFOTATER-NOTE
	PRINTR "(NOTE: This is the infotater included in your game package.)"

	.FUNCT WALL-HANGING-F
	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-BEHIND,V?MOVE /?L3
	EQUAL? PRSA,V?RAISE,V?SHAKE,V?RUB \?L1
?L3:	FSET? KEY,TOUCHBIT /?L4
	MOVE KEY,HERE
	CALL THIS-IS-IT,KEY
	FSET KEY,TOUCHBIT
	ADD SCORE,15 >SCORE
	PRINTR "As you move the tapestry, a key falls out from behind it and lands on the floor."
?L4:	PRINTR "Nope, no more keys."
?L1:	EQUAL? PRSA,V?UNTIE,V?TAKE \?L11
	PRINTI "It looks too well fastened to remove from the wall."
	CRLF
	CALL PRINT-ID,STR?127 >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It is a beautiful piece of local handiwork, given to Belboz by the grateful townspeople after his (admittedly showy) pyrotechnical destruction of the evil giant Amathradonis. The hanging is affixed to the wall at its upper corners."

	.FUNCT MORGIA-PLANT-F
	EQUAL? PRSA,V?MEEF \?L1
	MOVE MORGIA-PLANT,DIAL
	PRINTI "The morgia plant, particularly susceptible to the meef spell, shrivels up and vanishes."
	CRLF
	CALL PRINT-ID,STR?128 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?TAKE \?L5
	PRINTI "The plant is so heavy you succeed only in budging it a few inches."
	CRLF
	CALL PRINT-ID,STR?129 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?EAT \?L8
	PRINTI "Morgias taste terrible; besides, Belboz wouldn't like someone munching on his favorite plant."
	CRLF
	CALL PRINT-ID,STR?130 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "A beautiful and exotic plant, the morgia is well-known for its susceptibility to magic spells."

	.FUNCT HALLWAY-1-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	CALL HALLWAY-DESC
	PRINTI "A heavy wooden door, currently "
	FSET? CHAMBER-DOOR,OPENBIT \?L5
	PRINTI "open"
	JUMP ?L9
?L5:	PRINTI "closed"
?L9:	PRINTR ", leads north."

	.FUNCT HALLWAY-2-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	CALL HALLWAY-DESC
	PRINTR "A large marble archway to the south leads into an open area."

	.FUNCT HALLWAY-DESC
	PRINTI "Rooms lie to the east and west from this north-south corridor. "
	RTRUE

	.FUNCT CHAMBER-OF-THE-CIRCLE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The meeting place of the Circle of Enchanters is a large, round room with a high domed ceiling. A table occupies the center of the room. Engraved on the wall is a list of tenets, the Guild's code of honor. The only door, at the southernmost point of the perimeter, is "
	FSET? CHAMBER-DOOR,OPENBIT \?L5
	PRINTI "open"
	JUMP ?L9
?L5:	PRINTI "closed"
?L9:	PRINTR "."

	.FUNCT TABLE-PSEUDO
	EQUAL? PRSA,V?CLIMB-ON,V?PUT-ON \?L1
	SET 'TABLE-WARNING,1
	PRINTI "A warning nymph appears, floating over the table. ""The servants just finished waxing the table, and it's still wet."" With a sly grin, the nymph vanishes."
	CRLF
	CALL PRINT-ID,STR?131 >STACK
	RSTACK
?L1:	ZERO? TABLE-WARNING /FALSE
	EQUAL? PRSA,V?PULVER \FALSE
	PRINTI "That would cause the wax to dry dull and yellowish!"
	CRLF
	CALL PRINT-ID,STR?132 >STACK
	RSTACK

	.FUNCT MARBLE-PSEUDO
	RFALSE

	.FUNCT I-MAILMAN
	MOVE MAGAZINE,MAILBOX
	FCLEAR MAILBOX,OPENBIT
	IN? MATCHBOOK,MAILBOX \?L1
	MOVE VILSTU-VIAL,MAILBOX
	MOVE MATCHBOOK,DIAL
?L1:	EQUAL? HERE,LOBBY \?L4
	SET 'MAILMAN-FOLLOW,1
	CALL QUEUE,I-MAILMAN-FOLLOW,1 >STACK
	PUT STACK,0,1
	CRLF
	PRINTR "A member of the Messengers Guild walks up and puts something in the receptacle. He closes it, and rings the doorbell. Noticing you, he gives a friendly wave before departing."
?L4:	CALL IN-GUILD-HALL? >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTR "The Guild Hall doorbell chimes."

	.FUNCT I-MAILMAN-FOLLOW
	SET 'MAILMAN-FOLLOW,0
	RFALSE

	.FUNCT MAGAZINE-F
	EQUAL? PRSA,V?READ,V?LOOK-INSIDE,V?OPEN \FALSE
	PRINTI "This month's cover story is about Belboz! Other stories relate the explosion of spell scroll manufacturers, and the coming shakedown in the magic potion industry. The address label on the cover reads:

"
	CALL FIXED-FONT-ON
	PRINTI "    ""Z5 ACCAR256 4-964
    Hall of the Guild of Enchanters
    Village of Accardi-By-The-Sea
    Land of Frobozz"""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT VILSTU-VIAL-F
	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
       ""VILSTU POTION
(obviate need for breathing)"""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT VILSTU-POTION-F
	EQUAL? PRSA,V?DRINK,V?EAT \?L1
	IN? VILSTU-VIAL,PROTAGONIST /?L1
	CALL POTION-POUR,VILSTU-VIAL >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?RESEARCH \?L3
	CALL READ-ABOUT-POTIONS,3 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?DRINK,V?EAT \?L4
	MOVE VILSTU-POTION,DIAL
	ZERO? UNDER-INFLUENCE /?L5
	CALL TWO-POTIONS
	RTRUE
?L5:	SET 'UNDER-INFLUENCE,VILSTU-POTION
	CALL QUEUE,I-BREATHE,19 >STACK
	PUT STACK,0,1
	SET 'VILSTUED,1
	EQUAL? HERE,COAL-BIN-ROOM,DIAL-ROOM \?L8
	CALL INT,I-SUFFOCATE >STACK
	PUT STACK,0,0
	CALL QUEUE,I-OLDER-SELF,1 >STACK
	PUT STACK,0,1
?L8:	PRINTR "The orange potion tasted like pepper, and made your nose tingle."
?L4:	EQUAL? PRSA,V?DROP \?L13
	CALL PERFORM,V?POUR,PRSO,PRSI
	RTRUE
?L13:	EQUAL? PRSA,V?POUR \FALSE
	EQUAL? PRSO,VILSTU-POTION \FALSE
	CALL POTION-POUR,VILSTU-VIAL >STACK
	RSTACK

	.FUNCT I-BREATHE
	INC 'BREATH-SHORTAGE
	EQUAL? UNDER-INFLUENCE,VILSTU-POTION \?L1
	SET 'UNDER-INFLUENCE,0
?L1:	EQUAL? BREATH-SHORTAGE,1 \?L4
	CALL QUEUE,I-BREATHE,4 >STACK
	PUT STACK,0,1
	CRLF
	PRINTI "You feel the vilstu potion beginning to wear off"
	CALL IN-COAL-MINE? >STACK
	ZERO? STACK /?L8
	PRINTI ", and the air here seems pretty unbreathable"
?L8:	PRINTR "."
?L4:	EQUAL? BREATH-SHORTAGE,2 \?L15
	CALL QUEUE,I-BREATHE,6 >STACK
	PUT STACK,0,1
	CRLF
	PRINTI "The vilstu potion has almost completely worn off now"
	CALL IN-COAL-MINE? >STACK
	ZERO? STACK /?L18
	PRINTI ", and I doubt you could survive here without it"
?L18:	PRINTR "."
?L15:	SET 'VILSTUED,0
	EQUAL? HERE,LAGOON-FLOOR \?L26
	CALL QUEUE,I-DROWN,-1 >STACK
	PUT STACK,0,1
?L26:	CRLF
	PRINTI "You feel the final effects of the vilstu potion vanish"
	CALL IN-COAL-MINE? >STACK
	ZERO? STACK /?L31
	CALL PRINT-ID,STR?133
	CALL JIGS-UP,STR?134 >STACK
	RSTACK
?L31:	SET 'AWAKE,8
	SET 'LOAD-ALLOWED,20
	SET 'FUMBLE-NUMBER,1
	CALL QUEUE,I-TIRED,8 >STACK
	PUT STACK,0,1
	PRINTR ", leaving you totally exhausted (an unfortunate side effect)."

	.FUNCT STAND-PSEUDO
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "A volume lies open on the stand."

	.FUNCT ENCYCLOPEDIA-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The volume lies open to "
	ZERO? VOLUME-USED /?L5
	PRINTR "a random entry."
?L5:	PRINTI "an entry about the Glass Maze of King Duncanthrax. "
	CALL PERFORM,V?RESEARCH,MAZE
	CRLF
	PRINTR "You could probably read about all sorts of other interesting people, places, and things by looking them up in the encyclopedia."
?L1:	EQUAL? PRSA,V?OPEN \?L14
	PRINTR "It is."
?L14:	EQUAL? PRSA,V?CLOSE \?L17
	PRINTR "Why bother?"
?L17:	EQUAL? PRSA,V?TAKE \?L20
	PRINTI "A library nymph appears, sitting on your wrist. ""Sorry, but the encyclopedia is never to be removed from the stand."" Kicking you gently in the thumb, the nymph vanishes."
	CRLF
	CALL PRINT-ID,STR?135 >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL PERFORM,V?READ,PRSO
	RTRUE

	.FUNCT BERZIO-VIAL-F
	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
        ""BERZIO POTION
(obviate need for food or drink)"""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT BERZIO-POTION-F
	EQUAL? PRSA,V?DRINK,V?EAT \?L1
	IN? BERZIO-VIAL,PROTAGONIST /?L1
	CALL POTION-POUR,BERZIO-VIAL >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?RESEARCH \?L3
	CALL READ-ABOUT-POTIONS,1 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?DRINK,V?EAT \?L4
	MOVE BERZIO-POTION,DIAL
	SET 'BERZIOED,1
	CALL QUEUE,I-UNBERZIO,100 >STACK
	PUT STACK,0,1
	ADD SCORE,10 >SCORE
	PRINTI "The potion was completely tasteless."
	GRTR? HUNGER-LEVEL,0 /?L9
	GRTR? THIRST-LEVEL,0 \?L7
?L9:	PRINTI " You no longer feel hungry and thirsty, though."
?L7:	SET 'HUNGER-LEVEL,0
	SET 'THIRST-LEVEL,0
	CRLF
	RTRUE
?L4:	EQUAL? PRSA,V?DROP \?L13
	CALL PERFORM,V?POUR,PRSO,PRSI
	RTRUE
?L13:	EQUAL? PRSA,V?POUR \FALSE
	EQUAL? PRSO,BERZIO-POTION \FALSE
	CALL POTION-POUR,BERZIO-VIAL >STACK
	RSTACK

	.FUNCT I-UNBERZIO
	SET 'BERZIOED,0
	RFALSE

	.FUNCT MATCHBOOK-F
	EQUAL? PRSA,V?CLOSE \?L1
	PRINTR "Why bother?"
?L1:	EQUAL? PRSA,V?COUNT,V?EXAMINE,V?OPEN /?L6
	EQUAL? PRSA,V?STRIKE \?L5
?L6:	PRINTR "The matches are all gone, but there is some printing on the inner cover."
?L5:	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI """Amazing Vilstu Potion!

Get by without breathing! Amaze your
friends! Be the first person on the
block to own some!

Order today by dropping this in any
mailbox. Our shipping department will
use the latest in temporal travel
techniques to insure that your potion
arrives the same day you order it!
(Orders received before noon will
arrive the day before you order)."""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT CALENDAR-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?OPEN \FALSE
	CALL PERFORM,V?READ,CALENDAR
	RTRUE

	.FUNCT COBWEB-PSEUDO
	RFALSE

	.FUNCT TRUNK-F
	EQUAL? PRSA,V?TAKE \?L1
	EQUAL? PRSO,TRUNK \?L1
	PRINTI "It's too heavy to even budge."
	CRLF
	CALL PRINT-ID,STR?136 >STACK
	RSTACK
?L1:	FSET? TRUNK,OPENBIT /FALSE
	EQUAL? PRSA,V?OPEN \?L6
	PRINTR "The lid won't budge."
?L6:	EQUAL? PRSA,V?UNLOCK \?L10
	PRINTR "Perhaps the buttons..."
?L10:	EQUAL? PRSA,V?REZROV \FALSE
	PRINTR "The lid bulges outward for a moment."

	.FUNCT BUTTON-F
	EQUAL? PRSA,V?LOOK-UNDER \?L1
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?PUSH \FALSE
	PRINTI "There is a click from the lid of the trunk"
	EQUAL? PRSO,BLACK-BUTTON \?L11
	EQUAL? NEXT-NUMBER,1 /?L10
?L11:	EQUAL? PRSO,GRAY-BUTTON \?L12
	EQUAL? NEXT-NUMBER,2 /?L10
?L12:	EQUAL? PRSO,RED-BUTTON \?L13
	EQUAL? NEXT-NUMBER,3 /?L10
?L13:	EQUAL? PRSO,PURPLE-BUTTON \?L14
	EQUAL? NEXT-NUMBER,4 /?L10
?L14:	EQUAL? PRSO,WHITE-BUTTON \?L8
	EQUAL? NEXT-NUMBER,5 \?L8
?L10:	INC 'CURRENT-TLOC
	GET NEXT-CODE-TABLE,CURRENT-TLOC >NEXT-NUMBER
	ZERO? NEXT-NUMBER \?L20
	ZERO? TRUNK-SCREWED \?L20
	FSET TRUNK,OPENBIT
	ADD SCORE,25 >SCORE
	PRINTI ". A moment later, the lid of the trunk swings slowly open, revealing "
	CALL PRINT-CONTENTS,TRUNK
	JUMP ?L20
?L8:	SET 'TRUNK-SCREWED,1
?L20:	PRINTR "."

	.FUNCT I-WAKE-UP
	CALL PRINT-ID,STR?137
	CALL JIGS-UP,STR?138 >STACK
	RSTACK

	.FUNCT TREE-F
	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-FOO \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLIMB-DOWN \?L3
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?LOOK-UNDER \?L4
	CALL PERFORM,V?EXAMINE,GROUND
	RTRUE
?L4:	EQUAL? PRSA,V?MEEF \FALSE
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,V?MEEF,FOREST
	RTRUE

	.FUNCT HELLHOUND-F
	EQUAL? PRSA,V?RESEARCH \FALSE
	CALL PERFORM,V?RESEARCH,LOBBY
	RTRUE

	.FUNCT I-HELLHOUND
	EQUAL? HERE,TWISTED-FOREST \?L1
	ZERO? HELLHOUND-WARNING /?L3
	CALL PRINT-ID,STR?139
	CALL JIGS-UP,STR?140 >STACK
	RSTACK
?L3:	SET 'HELLHOUND-WARNING,1
	CRLF
	PRINTR "A hellhound is racing straight toward you, its open jaws displaying rows of razor-sharp teeth."
?L1:	EQUAL? HERE,TREE-BRANCH \?L8
	PRINTI "The hellhound leaps madly about the base of the tree, gnashing its jaws."
	CRLF
	CALL PRINT-ID,STR?141 >STACK
	RSTACK
?L8:	MOVE HELLHOUND,DIAL
	CALL INT,I-HELLHOUND >STACK
	PUT STACK,0,0
	PRINTR "The hellhound stops at the edge of the forest and bellows. After a moment, it turns and slinks into the trees."

	.FUNCT TREE-BRANCH-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are "
	ZERO? FLYING /?L5
	PRINTI "flying near"
	JUMP ?L9
?L5:	PRINTI "on"
?L9:	PRINTR " a large gnarled branch of an old and twisted tree."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL QUEUE,I-BOA,-1 >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT TREE-UP-F
	PRINTI "You can't "
	ZERO? FLYING /?L3
	PRINTI "fly"
	JUMP ?L7
?L3:	PRINTI "climb"
?L7:	PRINTI " any higher."
	CRLF
	RFALSE

	.FUNCT BOA-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "Your average giant carnivorous snake -- except that this one has three heads and an appetite to match."

	.FUNCT I-BOA
	EQUAL? HERE,TREE-BRANCH \?L1
	ZERO? FLYING \FALSE
	ZERO? BOA-WARNING /?L5
	CALL PRINT-ID,STR?142
	CALL JIGS-UP,STR?143 >STACK
	RSTACK
?L5:	SET 'BOA-WARNING,1
	CRLF
	PRINTR "A giant boa constrictor is slithering along the branch toward you!"
?L1:	SET 'BOA-WARNING,0
	CALL INT,I-BOA >STACK
	PUT STACK,0,0
	RFALSE

	.FUNCT FENCE-PSEUDO
	EQUAL? PRSA,V?LEAP,V?CLIMB-FOO,V?CLIMB-OVER \FALSE
	PRINTI "It's too tall."
	CRLF
	CALL PRINT-ID,STR?144 >STACK
	RSTACK

	.FUNCT SIGNPOST-F
	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
""  *** !!! >>> WARNING <<< !!! ***
     This path is protected by a
          Magic Mine Field
          installed by the
   Frobozz Magic Mine Field Company"
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT MINE-FIELD-EXIT-F
	EQUAL? PRSO,P?SOUTH \?L1
	RANDOM 100 >STACK
	LESS? 50,STACK /?L1
	RETURN FOREST-EDGE
?L1:	ZERO? FLYING /?L4
	PRINTI "Unfortunately, one of the properties of magic mine fields is their ability to blow you up even if you're floating above them. "
?L4:	CALL PRINT-ID,STR?145
	CALL JIGS-UP,STR?146
	RFALSE

	.FUNCT SNAKE-PIT-PSEUDO
	EQUAL? PRSA,V?THROUGH \FALSE
	CALL LOOK-AROUND-YOU >STACK
	RSTACK

	.FUNCT CRACK-PSEUDO
	EQUAL? PRSA,V?THROUGH \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT SNAKE-PIT-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	RANDOM 3 >STACK
	INC 'STACK
	CALL QUEUE,I-SNAKE-PIT,STACK >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT I-SNAKE-PIT
	EQUAL? HERE,SNAKE-PIT \?L1
	CALL PRINT-ID,STR?147
	CALL JIGS-UP,STR?148 >STACK
	RSTACK
?L1:	CALL INT,I-SNAKE-PIT >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT MOSS-F
	EQUAL? PRSA,V?MEEF \?L1
	PRINTI "A few patches of the moss and lichens become brown and dry."
	CRLF
	CALL PRINT-ID,STR?149 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EAT \FALSE
	CALL PRINT-ID,STR?150
	CALL JIGS-UP,STR?151 >STACK
	RSTACK

	.FUNCT MEADOW-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	CALL QUEUE,I-LOCUSTS,-1 >STACK
	PUT STACK,0,1
	RFALSE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in the center of a "
	IN? MEADOW-OBJECT,HERE \?L6
	PRINTI "rolling meadow of tall grass"
	JUMP ?L10
?L6:	PRINTI "barren field"
?L10:	PRINTR ". To the east is the turret of a ruined castle, and from the northeast comes the sound of rushing water."

	.FUNCT MEADOW-OBJECT-F
	EQUAL? HERE,MEADOW /?L1
	EQUAL? PRSA,V?MEEF,V?RUB \?L1
	PRINTR "The meadow is too far away."
?L1:	EQUAL? PRSA,V?MEEF \FALSE
	MOVE MEADOW-OBJECT,DIAL
	PRINTR "The grass vanishes as far as the eye can see."

	.FUNCT PLAGUE-OF-LOCUSTS-F
	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	CALL PERFORM,V?EXAMINE,MEADOW-OBJECT
	RTRUE

	.FUNCT I-LOCUSTS
	EQUAL? HERE,MEADOW /?L1
	CALL INT,I-LOCUSTS >STACK
	PUT STACK,0,0
	SET 'LOCUST-WARNING,0
	RFALSE
?L1:	ZERO? LOCUST-WARNING \?L3
	INC 'LOCUST-WARNING
	CRLF
	PRINTR "A swarm of bloodsucking locusts appears on the horizon."
?L3:	EQUAL? LOCUST-WARNING,1 \?L6
	INC 'LOCUST-WARNING
	CRLF
	PRINTR "The locusts are much closer now, blotting out the sun like a black storm cloud."
?L6:	SET 'LOCUST-WARNING,0
	CALL PRINT-ID,STR?152
	CALL JIGS-UP,STR?153 >STACK
	RSTACK

	.FUNCT RIVER-BANK-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are on a muddy bank "
	ZERO? RIVER-EVAPORATED /?L5
	PRINTI "above a dried-up river bed"
	JUMP ?L9
?L5:	PRINTI "of a fast-moving river, full of sharp rocks and foaming rapids, flowing to the southwest. The ground is soft and eroded, and continually threatens to dump you into the turbulent waters"
?L9:	PRINTR ". A field lies to the southwest, and a trail leads southeast along the bank."
?L1:	EQUAL? RARG,M-END \FALSE
	LESS? BANK-COUNTER,3 \?L15
	INC 'BANK-COUNTER
	RFALSE
?L15:	ZERO? RIVER-EVAPORATED \FALSE
	ZERO? FLYING \FALSE
	RANDOM 100 >STACK
	LESS? 75,STACK /FALSE
	CALL PRINT-ID,STR?154
	CALL JIGS-UP,STR?155 >STACK
	RSTACK

	.FUNCT ROCK-PSEUDO
	EQUAL? PRSA,V?CROSS \FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT RIVER-ENTER-F
	ZERO? RIVER-EVAPORATED /?L1
	RETURN RIVER-BED
?L1:	ZERO? FLYING /?L3
	CALL PRINT-ID,STR?156
	CALL JIGS-UP,STR?157
	RFALSE
?L3:	PRINTI "You'd never survive the rapids."
	CRLF
	RFALSE

	.FUNCT RIVER-F
	EQUAL? HERE,GUN-EMPLACEMENT,TURRET \?L1
	PRINTR "The river lies far below."
?L1:	ZERO? RIVER-EVAPORATED /?L5
	PRINTR "River? What river?"
?L5:	EQUAL? PRSA,V?DRINK-FROM,V?DRINK \?L8
	CALL PERFORM,V?DRINK,WATER
	RTRUE
?L8:	EQUAL? PRSA,V?PULVER \?L9
	EQUAL? HERE,RIVER-BANK \?L10
	SET 'RIVER-EVAPORATED,1
	CALL QUEUE,I-TRICKLE,3 >STACK
	PUT STACK,0,1
	PRINTI "The river dries up, leaving only a few puddles between the rocks! It's now safe to climb down into the river bed."
	CRLF
	CALL PRINT-ID,STR?158 >STACK
	RSTACK
?L10:	PRINTR "The water level drops several feet, but quickly surges back."
?L9:	EQUAL? PRSA,V?EXAMINE \?L17
	PRINTR "The river flows quickly by below you."
?L17:	EQUAL? PRSA,V?PUT \?L20
	EQUAL? RIVER,PRSI \?L20
	MOVE PRSO,DIAL
	CALL SPLASH >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?THROUGH \FALSE
	CALL DO-WALK,P?NORTH >STACK
	RSTACK

	.FUNCT I-TRICKLE
	CALL QUEUE,I-FLOOD,2 >STACK
	PUT STACK,0,1
	EQUAL? HERE,RIVER-BANK,RIVER-BED /?L3
	EQUAL? HERE,STAGNANT-POOL,TOP-OF-FALLS \FALSE
?L3:	CRLF
	PRINTR "A trickle of water begins flowing down the center of the river bed."

	.FUNCT I-FLOOD
	SET 'RIVER-EVAPORATED,0
	CALL FLOOD-LOOP,RIVER-BED
	CALL FLOOD-LOOP,STAGNANT-POOL
	CALL FLOOD-LOOP,TOP-OF-FALLS
	CRLF
	EQUAL? HERE,STAGNANT-POOL,RIVER-BED,TOP-OF-FALLS \?L1
	CALL PRINT-ID,STR?159
	CALL JIGS-UP,STR?160 >STACK
	RSTACK
?L1:	EQUAL? HERE,RIVER-BANK \?L3
	PRINTR "A wall of water rushes down the river bed as the river returns with a vengeance."
?L3:	EQUAL? HERE,HIDDEN-CAVE \FALSE
	PRINTR "There is a roar of water from outside the cave. The lower part of the cave, near the mouth, fills with a pool of swirling water!"

	.FUNCT FLOOD-LOOP,LOC,X,N
	FIRST? LOC >X \TRUE
?L2:	NEXT? X >N /?L7
?L7:	EQUAL? X,PROTAGONIST /?L8
	MOVE X,DIAL
?L8:	ZERO? N /TRUE
	SET 'X,N
	JUMP ?L2

	.FUNCT UNDERGROWTH-F
	EQUAL? PRSA,V?MEEF \FALSE
	PRINTI "The nearest part of the undergrowth withers away ... revealing more undergrowth."
	CRLF
	CALL PRINT-ID,STR?161 >STACK
	RSTACK

	.FUNCT BANKS-F
	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-DOWN,V?CLIMB-UP \FALSE
	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT RIVER-BED-OBJECT-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,RIVER-BANK \?L3
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L3:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXIT,V?DROP \FALSE
	EQUAL? HERE,RIVER-BANK \?L7
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L7:	CALL DO-WALK,P?UP >STACK
	RSTACK

	.FUNCT RIVER-BED-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUT VEZZAS,1,0
	RFALSE

	.FUNCT PUDDLE-PSEUDO
	EQUAL? PRSA,V?THROUGH \?L1
	PRINTR "The puddles are very shallow."
?L1:	EQUAL? PRSA,V?PULVER \FALSE
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,V?PULVER,WATER
	RTRUE

	.FUNCT FISH-PSEUDO
	EQUAL? PRSA,V?TAKE \FALSE
	PRINTI "They squirm from your grasp."
	CRLF
	CALL PRINT-ID,STR?162 >STACK
	RSTACK

	.FUNCT TENTACLE-DEATH
	ZERO? FLYING /?L1
	PRINTI "You fly over the surface of the pool."
	JUMP ?L5
?L1:	PRINTI "You wade into the stagnant pool."
?L5:	CALL PRINT-ID,STR?163
	CALL JIGS-UP,STR?164
	RFALSE

	.FUNCT RIVER-EXIT-F
	PRINTI "The banks are too "
	ZERO? FLYING /?L3
	PRINTI "high to fly over."
	CRLF
	RFALSE
?L3:	PRINTI "steep to climb."
	CRLF
	RFALSE

	.FUNCT WATERFALL-EXIT-F
	ZERO? FLYING /?L1
	PRINTI "That would be foolhardy, as flying spells are of limited duration."
	CRLF
	RFALSE
?L1:	PRINTI "That would involve quite a plunge."
	CRLF
	RFALSE

	.FUNCT TOP-OF-CLIFF-PSEUDO
	EQUAL? PRSA,V?CLIMB-DOWN \?L1
	PRINTR "Impossible."
?L1:	EQUAL? PRSA,V?LEAP \FALSE
	CALL PRINT-ID,STR?165
	CALL JIGS-UP,STR?166 >STACK
	RSTACK

	.FUNCT HAZE-PSEUDO
	EQUAL? PRSA,V?RUB \FALSE
	PRINTR "From here?"

	.FUNCT WATERFALL-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's no Aragain Falls, but it's pretty impressive."
?L1:	EQUAL? PRSA,V?LEAP \?L5
	EQUAL? HERE,TOP-OF-FALLS \?L5
	SET 'PRSO,0
	CALL PERFORM,V?LEAP
	RTRUE
?L5:	EQUAL? HERE,MOUTH-OF-RIVER,TURRET \FALSE
	EQUAL? PRSA,V?SMELL,V?RUB,V?LEAP /?L7
	EQUAL? PRSA,V?LISTEN \FALSE
?L7:	PRINTR "From here?"

	.FUNCT HIDDEN-CAVE-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	FSET? HIDDEN-CAVE,TOUCHBIT /?L1
	ADD SCORE,20 >SCORE
	RETURN SCORE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a hollow area under the northeast bank of the river. The floor rises away from the mouth of the cave, which is at its southwest end. "
	ZERO? RIVER-EVAPORATED \?L6
	PRINTI "The mouth is filled with a pool of swirling water. "
?L6:	PRINTR "A dark hole leads downward at the far end of the cave."

	.FUNCT BAT-GUANO-F
	EQUAL? PRSA,V?TAKE \FALSE
	FSET? FWEEP-SCROLL,TOUCHBIT /FALSE
	FSET FWEEP-SCROLL,TOUCHBIT
	FSET BAT-GUANO,TOUCHBIT
	FCLEAR BAT-GUANO,TRYTAKEBIT
	FCLEAR BAT-GUANO,NDESCBIT
	MOVE BAT-GUANO,PROTAGONIST
	PRINTR "As you take the guano, the soiled scroll falls to the ground."

	.FUNCT BLORT-VIAL-F
	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
        ""BLORT POTION
(ability to see in dark places)"""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT BLORT-POTION-F
	EQUAL? PRSA,V?DRINK,V?EAT \?L1
	CALL HELD?,BLORT-VIAL >STACK
	ZERO? STACK \?L1
	CALL POTION-POUR,BLORT-VIAL >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?RESEARCH \?L3
	CALL READ-ABOUT-POTIONS,1 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?DRINK,V?EAT \?L4
	MOVE BLORT-POTION,DIAL
	ZERO? UNDER-INFLUENCE /?L5
	CALL TWO-POTIONS
	RTRUE
?L5:	CALL QUEUE,I-UNBLORT,24 >STACK
	PUT STACK,0,1
	SET 'BLORTED,1
	SET 'UNDER-INFLUENCE,BLORT-POTION
	PRINTR "The amber potion tasted like chives, and made your eyes tingle."
?L4:	EQUAL? PRSA,V?DROP \?L10
	CALL PERFORM,V?POUR,PRSO,PRSI
	RTRUE
?L10:	EQUAL? PRSA,V?POUR \FALSE
	EQUAL? PRSO,BLORT-POTION \FALSE
	CALL POTION-POUR,BLORT-VIAL >STACK
	RSTACK

	.FUNCT I-UNBLORT
	SET 'BLORTED,0
	EQUAL? UNDER-INFLUENCE,BLORT-POTION \?L1
	SET 'UNDER-INFLUENCE,0
?L1:	CRLF
	PRINTI "Your eyes tingle for a moment."
	ZERO? LIT \?L6
	PRINTI " You can no longer see anything around you!"
?L6:	CRLF
	RTRUE

	.FUNCT I-UNFWEEP
	SET 'FWEEPED,0
	SET 'FLYING,0
	CRLF
	PRINTI "After a moment of futilely flapping your arms, you realize that the fweep spell has worn off. "
	EQUAL? HERE,GLASS-MAZE \?L3
	CALL NO-FLOOR? >STACK
	ZERO? STACK /?L3
	CALL PRINT-ID,STR?167
	CALL JIGS-UP,STR?168
	JUMP ?L7
?L3:	EQUAL? HERE,TREE-BRANCH \?L5
	CALL SETTLE-ONTO-BRANCH
	JUMP ?L7
?L5:	EQUAL? HERE,LAGOON \?L6
	CALL SPLASH-INTO-WATER
	JUMP ?L7
?L6:	PRINTI "You fall several feet to the ground."
	CRLF
?L7:	GRTR? AWAKE,8 \FALSE
	CALL I-TIRED >STACK
	RSTACK

	.FUNCT DRAWBRIDGE-F,RARG
	EQUAL? RARG,M-END \?L1
	ZERO? FLYING \?L1
	ZERO? DRAWBRIDGE-MOVE /?L3
	RANDOM 100 >STACK
	LESS? 40,STACK /?L5
	PRINTI "With a scream of splintering wood, part of the drawbridge collapses and spills you into the moat. "
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L5:	PRINTR "The bridge continues to creak."
?L3:	SET 'DRAWBRIDGE-MOVE,1
	RFALSE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are "
	ZERO? FLYING /?L16
	PRINTI "floating over"
	JUMP ?L20
?L16:	PRINTI "standing on"
?L20:	PRINTI " the drawbridge of a ruined castle which lies to your east. The wood of the bridge looks severely rotted"
	ZERO? FLYING /?L25
	PRINTI ". The moat is"
	JUMP ?L29
?L25:	PRINTI " and creaks ominously beneath you. The moat, although an easy dive from here, looks dangerous,"
?L29:	PRINTR " full of sinister shapes beneath the surface of the water. To the west is a wide field."

	.FUNCT DRAWBRIDGE-EXIT-F
	CALL PRINT-ID,STR?169
	CALL JIGS-UP,STR?170
	RFALSE

	.FUNCT MOAT-F
	EQUAL? PRSA,V?PULVER \?L1
	PRINTI "The moat dries up, leaving vicious-looking creatures flopping around in puddles. Immediately, the castle's automatic moat-filler turns on, and refills the moat."
	CRLF
	CALL PRINT-ID,STR?171 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?DRINK-FROM,V?DRINK \?L5
	CALL PERFORM,V?DRINK,WATER
	RTRUE
?L5:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTR "The water is murky, and lily pads cover most of the surface. Dark shapes swim about below the surface."
?L6:	EQUAL? PRSA,V?THROUGH,V?LEAP \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT BRIDGE-F
	EQUAL? PRSA,V?LOOK-UNDER \?L1
	CALL PERFORM,V?EXAMINE,MOAT
	RTRUE
?L1:	EQUAL? PRSA,V?LISTEN \FALSE
	PRINTR "Creak, creak."

	.FUNCT TURRET-PSEUDO
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,RUINS \?L3
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L3:	EQUAL? HERE,MEADOW \?L5
	CALL CANT-ENTER,IT >STACK
	RSTACK
?L5:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXIT,V?DROP \?L7
	EQUAL? HERE,TURRET \?L8
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L8:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?LEAP \FALSE
	EQUAL? HERE,TURRET \FALSE
	SET 'PRSO,0
	CALL PERFORM,V?LEAP
	RTRUE

	.FUNCT TORTURE-DEVICES-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "All the usual torture devices are here, all quite mean and deadly looking."

	.FUNCT FLAXO-VIAL-F
	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
   ""FLAXO POTION
(exquisite torture)"""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT FLAXO-POTION-F
	EQUAL? PRSA,V?DRINK,V?EAT \?L1
	CALL HELD?,FLAXO-VIAL >STACK
	ZERO? STACK \?L1
	CALL POTION-POUR,FLAXO-VIAL >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?RESEARCH \?L3
	CALL READ-ABOUT-POTIONS,2 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?DRINK,V?EAT \?L4
	MOVE FLAXO-POTION,DIAL
	PRINTI "The potion tastes like a combination of anchovies, prune juice, and garlic powder. As you finish swallowing the potion, a well-muscled troll saunters in"
	EQUAL? HERE,TORTURE-CHAMBER \?L7
	PRINTI " and straps you to a torture device"
?L7:	PRINTR ". He whacks your head with a wooden two-by-four, grunting ""You are playing Sorcerer. It was written by S. Eric Meretzky. You will have fun and enjoy yourself."" He repeats this action 999 more times, then vanishes without a trace."
?L4:	EQUAL? PRSA,V?DROP \?L14
	CALL PERFORM,V?POUR,PRSO,PRSI
	RTRUE
?L14:	EQUAL? PRSA,V?POUR \FALSE
	EQUAL? PRSO,FLAXO-POTION \FALSE
	CALL POTION-POUR,FLAXO-VIAL >STACK
	RSTACK

	.FUNCT PIT-OF-BONES-EXIT-F
	ZERO? FLYING /?L1
	PRINTI "You can't fly high enough to reach the hole."
	CRLF
	RFALSE
?L1:	PRINTI "The hole is too high to reach."
	CRLF
	RFALSE

	.FUNCT BONES-PSEUDO
	EQUAL? PRSA,V?DIG,V?SEARCH,V?TAKE \?L1
	PRINTR "They're at the bottom of the pit."
?L1:	EQUAL? PRSA,V?MALYON \FALSE
	CALL PRINT-ID,STR?172
	CALL JIGS-UP,STR?173 >STACK
	RSTACK

	.FUNCT PIT-PSEUDO
	EQUAL? PRSA,V?THROUGH,V?LEAP \?L1
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "Bones. Lots of bones."

	.FUNCT TOLL-GATE-CROSSING-F
	FSET? GATE,OPENBIT \?L1
	RETURN OUTSIDE-STORE
?L1:	ZERO? FLYING /?L3
	CALL PERFORM,V?CLIMB-OVER,GATE
	RFALSE
?L3:	PRINTI "A sturdy toll gate blocks the highway."
	CRLF
	RFALSE

	.FUNCT GATE-F
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	CALL OPEN-CLOSE >STACK
	ZERO? STACK \TRUE
	PRINTR "Only the gnome can do that."
?L1:	EQUAL? PRSA,V?REZROV \?L8
	FSET? GATE,OPENBIT /FALSE
	ZERO? GNOME-SLEEPING /?L11
	SET 'GNOME-SLEEPING,0
	CALL QUEUE,I-GNOME,2 >STACK
	PUT STACK,0,1
	PRINTI "The gate flies open, waking the gnome, who leaps up and slams it closed again. ""Hey! This is a toll gate! Nobody gets through here without paying the one zorkmid toll. Not nobody, not no how."""
	CRLF
	CALL PRINT-ID,STR?174 >STACK
	RSTACK
?L11:	SET 'GNOME-SLEEPING,1
	CALL PRINT-ID,STR?175
	CALL JIGS-UP,STR?176 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-OVER \FALSE
	PRINTR "The gate extends to the roof of the tunnel, and there are pointed nasties all over it."

	.FUNCT BOOTH-F
	EQUAL? PRSA,V?THROUGH \?L1
	FSET? GATE,OPENBIT \?L3
	CALL PRINT-ID,STR?177
	CALL JIGS-UP,STR?178 >STACK
	RSTACK
?L3:	PRINTR "The booth is on the other side of the toll gate."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	FSET? GATE,OPENBIT \?L9
	PRINTR "It's dark inside the toll booth."
?L9:	CALL PERFORM,V?THROUGH,BOOTH
	RTRUE

	.FUNCT GNOME-DESCFCN,RARG
	ZERO? GNOME-SLEEPING /?L1
	PRINTR "A fat old gnome with a long white beard is sleeping soundly just outside the toll booth. His loud snores echo around the caverns."
?L1:	PRINTR "A chubby gnome stands behind the toll gate, grinning broadly."

	.FUNCT GNOME-F
	EQUAL? GNOME,WINNER \?L1
	ZERO? GNOME-SLEEPING /?L3
	CALL POOR-LISTENERS
	CALL STOP >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?OPEN \?L5
	EQUAL? PRSO,GATE \?L5
	PRINTR """You'll have to pay the toll first,"" explains the gnome cheerfully, ""and the toll is one zorkmid."""
?L5:	PRINTI """Conversing with customers is disallowed by union rules."""
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?KICK,V?SHAKE \?L11
	ZERO? GNOME-SLEEPING /?L11
	CALL PERFORM,V?ALARM,GNOME
	RTRUE
?L11:	EQUAL? PRSA,V?LISTEN \?L12
	ZERO? GNOME-SLEEPING /?L12
	PRINTR "The gnome snores loudly."
?L12:	EQUAL? PRSA,V?ALARM \?L15
	ZERO? GNOME-SLEEPING \?L16
	PRINTR "He's awake!"
?L16:	FSET? GATE,OPENBIT \?L20
	PRINTR "The gnome opens one eye and looks at you. ""You again! Just go through. Let me sleep."" He begins snoring again."
?L20:	ZERO? GNOME-ANNOYED /?L23
	CALL PRINT-ID,STR?179
	CALL JIGS-UP,STR?180 >STACK
	RSTACK
?L23:	SET 'GNOME-SLEEPING,0
	CALL QUEUE,I-GNOME,2 >STACK
	PUT STACK,0,1
	PRINTR "The gnome stirs a bit and opens one eye, which wanders around until it notices you. He jumps to his feet. ""One zorkmid, please,"" he yells with a smile."
?L15:	EQUAL? PRSA,V?ASK-FOR,V?ASK-ABOUT,V?GIVE \?L27
	ZERO? GNOME-SLEEPING /?L27
	PRINTR "The gnome is asleep, remember?"
?L27:	FSET? GATE,OPENBIT \?L30
	EQUAL? PRSA,V?REACH-IN,V?LOOK-INSIDE,V?SEARCH /?L31
	EQUAL? PRSA,V?PICK \?L30
?L31:	ZERO? COIN-STOLEN \?L30
	ZERO? FWEEPED \?L30
	SET 'COIN-STOLEN,1
	MOVE ZORKMID,PROTAGONIST
	PRINTR "You carefully search the sleeping gnome, and take the zorkmid coin you find in his pocket!"
?L30:	EQUAL? PRSA,V?GIVE \?L34
	EQUAL? PRSO,ZORKMID \?L34
	FSET? ZORKMID,ONBIT \?L35
	CALL GNOME-REFUSES
	RTRUE
?L35:	FSET GATE,OPENBIT
	SET 'GNOME-SLEEPING,1
	MOVE ZORKMID,DIAL
	CALL INT,I-GNOME >STACK
	PUT STACK,0,0
	ADD SCORE,20 >SCORE
	PRINTR "The gnome pockets the coin and opens the gate. Before you can take a step the gnome falls asleep again."
?L34:	EQUAL? PRSA,V?YOMIN \FALSE
	ZERO? GNOME-SLEEPING /?L41
	PRINTR "The thoughts of the sleeping gnome are focused on certain activities involving female gnomes. Embarrassed, you withdraw."
?L41:	PRINTR "The thoughts of the gnome seem evenly divided between getting money from you and getting back to sleep."

	.FUNCT GNOME-REFUSES
	PRINTR "The gnome refuses, saying ""That coin is giving off light, and is therefore not legal tender."""

	.FUNCT I-GNOME
	CALL QUEUE,I-GNOME,-1 >STACK
	PUT STACK,0,1
	EQUAL? HERE,TOLL-GATE \?L1
	INC 'PATIENCE-COUNTER
	EQUAL? PATIENCE-COUNTER,5 \?L3
	SET 'GNOME-SLEEPING,1
	CALL INT,I-GNOME >STACK
	PUT STACK,0,0
	SET 'GNOME-ANNOYED,1
	CRLF
	PRINTR """Thanks for nothing, chum,"" growls the gnome as he resumes his nap."
?L3:	CRLF
	PRINTR """Well?"" asks the gnome, tapping impatiently. ""You've interrupted my nap. Are you going to pay the toll, or not?"""
?L1:	SET 'GNOME-SLEEPING,1
	SET 'PATIENCE-COUNTER,3
	CALL INT,I-GNOME >STACK
	PUT STACK,0,0
	RFALSE

	.FUNCT SIGN-PSEUDO
	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
""ZEKE'S APPLIANCE STORE

 Official outlet for all
Frobozz Magic Appliances"""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT STORE-PSEUDO
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,STORE \?L3
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L3:	CALL DO-WALK,P?SOUTH >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?DROP,V?EXIT \?L6
	EQUAL? HERE,STORE \?L7
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L7:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	EQUAL? HERE,STORE \?L11
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L11:	CALL MAKE-OUT >STACK
	RSTACK

	.FUNCT WAXER-F
	EQUAL? PRSA,V?LAMP-ON \?L1
	CALL HELD?,WAXER >STACK
	ZERO? STACK /?L3
	PRINTR "Better put it down, first."
?L3:	ZERO? FWEEPED /?L7
	CALL BATTY >STACK
	RSTACK
?L7:	EQUAL? HERE,LAGOON,LAGOON-FLOOR \?L8
	CALL PRINT-ID,STR?181
	CALL JIGS-UP,STR?182 >STACK
	RSTACK
?L8:	EQUAL? HERE,MINE-FIELD \?L9
	SET 'FLYING,0
	MOVE WAXER,DIAL
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L9:	PRINTI "The waxer whirrs about the "
	LOC PROTAGONIST >STACK
	FSET? STACK,VEHBIT \?L13
	PRINTI "vehicle"
	JUMP ?L17
?L13:	PRINTI "room"
?L17:	PRINTR " for a minute, polishing the floor."
?L1:	EQUAL? PRSA,V?LAMP-OFF \FALSE
	PRINTR "It is."

	.FUNCT CRATER-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are "
	ZERO? FLYING /?L5
	PRINTI "floating near"
	JUMP ?L9
?L5:	PRINTI "standing in"
?L9:	PRINTR " the center of an enormous crater, strewn with debris. Several points around the perimeter look climbable."

	.FUNCT CRATER-OUT-F
	CALL V-WALK-AROUND
	RFALSE

	.FUNCT CRATER-EXIT-F
	ZERO? FLYING /?L1
	PRINTI "As you try to fly over the rim here, a heavy gust of wind blows you back."
	CRLF
	RFALSE
?L1:	PRINTI "You attempt to climb the rim here, but the rubble is loose and you slide back down."
	CRLF
	RFALSE

	.FUNCT CRATER-PSEUDO
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,CRATER \?L3
	PRINTR "Where do you think you are?"
?L3:	EQUAL? HERE,EDGE-OF-CRATER \?L7
	CALL DO-WALK,P?SW >STACK
	RSTACK
?L7:	EQUAL? HERE,EDGE-OF-CHASM \?L8
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L8:	EQUAL? HERE,SLIMY-ROOM \?L9
	CALL DO-WALK,P?SOUTH >STACK
	RSTACK
?L9:	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLIMB-FOO \?L11
	CALL V-WALK-AROUND >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?DISEMBARK,V?EXIT,V?LEAVE \FALSE
	EQUAL? HERE,CRATER \?L13
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L13:	CALL LOOK-AROUND-YOU >STACK
	RSTACK

	.FUNCT CHASM-EXIT-F
	ZERO? FLYING /?L1
	PRINTI "You fly easily across the chasm..."
	CRLF
	CRLF
	EQUAL? HERE,BARE-PASSAGE \?L5
	RETURN EDGE-OF-CHASM
?L5:	RETURN BARE-PASSAGE
?L1:	PRINTI "If you really want to jump across the chasm, just say so."
	CRLF
	RFALSE

	.FUNCT CHASM-PSEUDO
	EQUAL? PRSA,V?LEAP \FALSE
	RANDOM 100 >STACK
	LESS? 75,STACK /?L3
	CALL PRINT-ID,STR?183
	CALL JIGS-UP,STR?184 >STACK
	RSTACK
?L3:	EQUAL? HERE,EDGE-OF-CHASM \?L6
	CALL GOTO,BARE-PASSAGE >STACK
	RSTACK
?L6:	CALL GOTO,EDGE-OF-CHASM >STACK
	RSTACK

	.FUNCT TREE-ROOM-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUT VEZZAS,3,0
	RFALSE

	.FUNCT ZORKMID-TREE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It is laden with zorkmids, glinting in the light."
?L1:	EQUAL? PRSA,V?REZROV \?L5
	CALL V-SWANZO >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-FOO \FALSE
	PRINTR "The branches don't look sturdy enough."

	.FUNCT ZORKMID-F
	EQUAL? PRSA,V?PICK \?L1
	FSET? PRSO,TRYTAKEBIT \?L1
	EQUAL? ZORKMID,PRSO \?L1
	CALL PERFORM,V?TAKE,PRSO,PRSI
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L3
	FSET? PRSO,TRYTAKEBIT \?L3
	FCLEAR PRSO,TRYTAKEBIT
	FCLEAR PRSO,NDESCBIT
	MOVE ZORKMID-TREE,DIAL
	MOVE ZORKMID,PROTAGONIST
	ADD SCORE,15 >SCORE
	PRINTR "As you pluck the first zorkmid, the tree shimmers and vanishes! (I guess it was just an illusion.) You are left holding a solitary zorkmid coin."
?L3:	EQUAL? PRSA,V?EXAMINE,V?COUNT \?L6
	IN? ZORKMID-TREE,HERE \?L6
	PRINTR "There are countless coins, hanging from every branch of the tree."
?L6:	EQUAL? PRSA,V?EXAMINE \?L9
	PRINTR "The coin pictures a man with an incredibly flat head, wearing a gaudy crown."
?L9:	EQUAL? PRSA,V?BITE \?L12
	PRINTR "Yep, it's real."
?L12:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTI "An article in the monetary section explains that the zorkmid was the unit of currency of the Great Underground Empire, and is still used in most parts of the kingdom today. A picture of a zorkmid coin is included. "
	CALL PERFORM,V?EXAMINE,ZORKMID
	RTRUE

	.FUNCT HALL-OF-CARVINGS-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You have entered a large room whose walls are covered with intricate carvings. "
	ZERO? DRAGON-MOVED /?L5
	PRINTI "A passage has been recently opened to the south, and is only partially blocked by a huge stone dragon, poised in the midst of an attack."
	JUMP ?L9
?L5:	PRINTI "The largest and most striking carving, on the southern wall, is of a huge sleeping dragon!"
?L9:	PRINTR " A winding tunnel leads north."

	.FUNCT DRAGON-F
	EQUAL? PRSA,V?MALYON \FALSE
	ZERO? MALYON-YONKED /?L3
	ZERO? DRAGON-MOVED /?L5
	CALL PRINT-ID,STR?185
	CALL JIGS-UP,STR?186 >STACK
	RSTACK
?L5:	SET 'DRAGON-MOVED,1
	PRINTR "The dragon is suddenly imbued with life and begins to move. It shakes itself loose from the wall, which crumbles down upon the dragon, revealing a southward passage! The dragon howls with pain and anger. Spotting you, the dragon rears back its head, smoke billowing from its nostrils. Then, just as it seems that you will be barbecued, the dragon reverts to stone!"
?L3:	PRINTR "The dragon seems to shiver for a moment, but that is all."

	.FUNCT FORT-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,PARADE-GROUND,GUN-EMPLACEMENT /?L5
	EQUAL? HERE,BARRACKS,ARMORY \?L3
?L5:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L3:	EQUAL? HERE,FORT-ENTRANCE \?L6
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L6:	CALL CANT-ENTER,FORT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXIT,V?DROP \?L8
	EQUAL? HERE,PARADE-GROUND \?L9
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L9:	EQUAL? HERE,GUN-EMPLACEMENT,BARRACKS,ARMORY \?L11
	CALL CANT-ENTER,FORT,1 >STACK
	RSTACK
?L11:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "Fort Griffspotter once guarded the lands near Egreth Castle from attack by sea."

	.FUNCT PARADE-GROUND-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	PUT VEZZAS,2,0
	RFALSE
?L1:	EQUAL? RARG,M-END \FALSE
	ZERO? SLEEPING /FALSE
	CALL INT,I-WAKE-UP >STACK
	PUT STACK,0,0
	CALL I-WAKE-UP >STACK
	RSTACK

	.FUNCT ROPE-PSEUDO
	EQUAL? PRSA,V?MOVE \?L1
	CALL PERFORM,V?LOWER,FLAG
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "The rope is attached to the pole and can't possibly be removed."

	.FUNCT FLAG-POLE-F
	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-FOO,V?CLIMB-ON \?L1
	PRINTR "That sort of thing went out of fashion years ago."
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "A rope runs up the side of the pole."

	.FUNCT FLAG-DESCFCN,RARG
	ZERO? FLAG-RAISED /?L1
	PRINTR "A tattered flag, apparently that of ancient Quendor, still flies atop a mighty flagpole in the center of the field."
?L1:	PRINTR "A flag displaying the brown and gold of ancient Quendor is lying here."

	.FUNCT FLAG-F
	EQUAL? PRSA,V?FLY \?L1
	CALL PERFORM,V?RAISE,FLAG
	RTRUE
?L1:	ZERO? FLAG-RAISED /?L4
	EQUAL? PRSA,V?RAISE \?L6
	PRINTR "It's already at the top of the pole."
?L6:	EQUAL? PRSA,V?LOWER \?L10
	SET 'FLAG-RAISED,0
	FCLEAR FLAG,TRYTAKEBIT
	FCLEAR FLAG-POLE,NDESCBIT
	PRINTR "The flag is lowered to the ground."
?L10:	EQUAL? PRSA,V?EXAMINE \?L13
	PRINTR "You can't see it very well from here -- the flagpole is very tall."
?L13:	EQUAL? PRSA,V?TAKE,V?WAVE,V?SHAKE /?L17
	EQUAL? PRSA,V?EAT,V?RUB,V?MOVE /?L17
	EQUAL? PRSA,V?LOOK-INSIDE,V?DRINK \?L16
?L17:	PRINTI "The flag is "
	ZERO? FLYING /?L20
	PRINTI "still "
?L20:	PRINTR "way above you at the top of the flagpole!"
?L16:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	CALL PERFORM,V?EXAMINE,FLAG-POLE
	RTRUE
?L4:	EQUAL? PRSA,V?RAISE \?L30
	EQUAL? HERE,PARADE-GROUND \?L32
	FSET FLAG,TRYTAKEBIT
	MOVE FLAG,HERE
	FSET FLAG-POLE,NDESCBIT
	SET 'FLAG-RAISED,1
	PRINTR "The flag is raised to the top of the pole."
?L32:	PRINTR "There's no flagpole in sight."
?L30:	EQUAL? PRSA,V?LOWER \?L39
	PRINTR "You've already done that."
?L39:	EQUAL? PRSA,V?WAVE \?L42
	PRINTR "How patriotic!"
?L42:	EQUAL? PRSA,V?WEAR \?L45
	PRINTR "Who do you think you are, Abbie Hoffman?"
?L45:	EQUAL? PRSA,V?SHAKE,V?LOOK-INSIDE,V?EXAMINE /?L49
	EQUAL? PRSA,V?SEARCH,V?RUB \?L48
?L49:	ZERO? FOOBLE-FOUND \?L48
	SET 'FOOBLE-FOUND,1
	MOVE FOOBLE-VIAL,HERE
	CALL THIS-IS-IT,FOOBLE-VIAL
	PRINTR "As you fiddle with the flag, an aqua vial drops from a hidden pocket and falls to the ground."
?L48:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "The tattered flag displays the brown and gold of ancient Quendor."

	.FUNCT FOOBLE-VIAL-F
	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
        ""FOOBLE POTION
(increase muscular coordination)"""
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT FOOBLE-POTION-F
	EQUAL? PRSA,V?DRINK,V?EAT \?L1
	CALL HELD?,FOOBLE-VIAL >STACK
	ZERO? STACK \?L1
	CALL POTION-POUR,FOOBLE-VIAL >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?RESEARCH \?L3
	CALL READ-ABOUT-POTIONS,2 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?DRINK,V?EAT \?L4
	MOVE FOOBLE-POTION,DIAL
	ZERO? UNDER-INFLUENCE /?L5
	CALL TWO-POTIONS
	RTRUE
?L5:	SET 'UNDER-INFLUENCE,FOOBLE-POTION
	CALL QUEUE,I-UNFOOBLE,17 >STACK
	PUT STACK,0,1
	SET 'FOOBLED,1
	PRINTR "The aqua potion tasted like lime jelly, and sent vibrations through your muscles."
?L4:	EQUAL? PRSA,V?DROP \?L10
	CALL PERFORM,V?POUR,PRSO,PRSI
	RTRUE
?L10:	EQUAL? PRSA,V?POUR \FALSE
	EQUAL? PRSO,FOOBLE-POTION \FALSE
	CALL POTION-POUR,FOOBLE-VIAL >STACK
	RSTACK

	.FUNCT I-UNFOOBLE
	SET 'FOOBLED,0
	EQUAL? UNDER-INFLUENCE,FOOBLE-POTION \?L1
	SET 'UNDER-INFLUENCE,0
?L1:	CRLF
	PRINTR "Your muscles feel limp for a moment."

	.FUNCT BARRACKS-PSEUDO
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,GLOBAL-ROOM,PRSI
	RTRUE

	.FUNCT EMPLACEMENT-EXIT-F
	ZERO? FLYING /?L1
	PRINTI "The updrafts from the "
	EQUAL? PRSO,P?NORTH \?L5
	PRINTI "river"
	JUMP ?L12
?L5:	PRINTI "ocean"
	JUMP ?L12
?L1:	PRINTI "The plunge"
?L12:	PRINTI " would kill you."
	CRLF
	RFALSE

	.FUNCT CANNON-F
	EQUAL? PRSA,V?LAMP-ON,V?SHOOT \?L1
	PRINTR "This cannon probably hasn't worked for centuries!"
?L1:	EQUAL? PRSA,V?CLOSE \?L5
	CALL V-DEFLATE >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?SEARCH,V?REACH-IN \?L6
	FSET? YIPPLES,INVISIBLE \?L6
	SET 'BITTEN,1
	CALL QUEUE,I-BITE-HEAL,20 >STACK
	PUT STACK,0,1
	PRINTR "Something bites your hand!"
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \?L9
	FSET? YIPPLES,INVISIBLE \?L9
	FCLEAR YIPPLES,INVISIBLE
	PRINTR "Lying at the bottom of the barrel is a pile of identical scrolls!"
?L9:	EQUAL? PRSA,V?EXAMINE \?L12
	PRINTR "The barrel is wide enough to hold the hugest of cannonballs, but it isn't very deep."
?L12:	EQUAL? PRSA,V?SEARCH,V?REACH-IN \?L15
	IN? YIPPLES,CANNON \?L15
	CALL PERFORM,V?TAKE,YIPPLES
	RTRUE
?L15:	EQUAL? PRSA,V?PUT \?L16
	IN? YIPPLES,CANNON \?L16
	EQUAL? BAT-GUANO,PRSO \?L16
	MOVE YIPPLES,DIAL
	MOVE YONK-SCROLL,CANNON
	CALL THIS-IS-IT,YONK-SCROLL
	MOVE BAT-GUANO,CANNON
	PRINTI "When you drop the guano into the barrel, "
	FSET? YIPPLES,INVISIBLE \?L19
	PRINTI "dozens of scrolls pour out and literally run off"
	JUMP ?L23
?L19:	PRINTI "the scrolls sprout feet and spill out of the cannon, dashing away"
?L23:	PRINTI " in every direction! A single ordinary scroll is left sitting at the bottom of the barrel."
	CRLF
	CALL PRINT-ID,STR?187
	FCLEAR YIPPLES,INVISIBLE
	RTRUE
?L16:	EQUAL? PRSA,V?THROUGH \FALSE
	ZERO? FWEEPED /FALSE
	PRINTR "Your wingspan is too large."

	.FUNCT YIPPLES-F
	EQUAL? PRSA,V?TAKE \?L1
	SET 'BITTEN,1
	CALL QUEUE,I-BITE-HEAL,20 >STACK
	PUT STACK,0,1
	PRINTI "As you reach into the cannon, something bites you painfully on the hand!"
	CRLF
	CALL PRINT-ID,STR?188 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "Every scroll is virtually identical."

	.FUNCT I-BITE-HEAL
	SET 'BITTEN,0
	RFALSE

	.FUNCT BOZBARLAND-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,PARK-ENTRANCE \?L3
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L3:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?DROP,V?EXIT \?L6
	EQUAL? HERE,EAST-END-OF-MIDWAY \?L7
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L7:	EQUAL? HERE,PARK-ENTRANCE \?L9
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L9:	CALL CANT-ENTER,BOZBARLAND,1 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "Bozbarland was a magical futuristic fantasy amusement park, oft referred to as the entertainment capital of the Great Underground Empire. The lower classes usually called it simply Zorky Park."

	.FUNCT PARK-SIGN-PSEUDO
	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "
$$$$$ WELCOME TO BOZBARLAND $$$$$
    The Entertainment Capital
          of the Empire"
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT AMUSEMENT-PARK-ENTER-F
	ZERO? PARK-FEE-PAID /?L1
	RETURN EAST-END-OF-MIDWAY
?L1:	IN? PARK-GNOME,HERE \?L3
	PRINTI "As you bounce off the barrier, the gnome admonishes, ""Tsk, tsk ... you can't enter without paying your zorkmid!"""
	CRLF
	RFALSE
?L3:	MOVE PARK-GNOME,HERE
	CALL QUEUE,I-PARK-GNOME,6 >STACK
	PUT STACK,0,1
	PRINTI "You bounce off an invisible barrier. A moment later a gnome appears, dressed in a gaudy plaid outfit. ""Admission to the park is only one zorkmid. What a bargain, chum, eh?"""
	CRLF
	RFALSE

	.FUNCT I-PARK-GNOME
	MOVE PARK-GNOME,DIAL
	EQUAL? HERE,PARK-ENTRANCE \FALSE
	CRLF
	PRINTR """Well, I can't wait all day, buddy,"" growls the gnome before vanishing."

	.FUNCT PARK-GNOME-F
	EQUAL? PRSA,V?TELL \?L1
	PRINTI """Listen, fella, I was in the middle of something important and I don't have time to gab. Gonna pay the admission fee, or not?"""
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?YOMIN \?L5
	PRINTR "The gnome is thinking about the poker game you interrupted."
?L5:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,PARK-GNOME \FALSE
	EQUAL? PRSO,ZORKMID \FALSE
	FSET? ZORKMID,ONBIT \?L9
	CALL GNOME-REFUSES
	RTRUE
?L9:	MOVE ZORKMID,DIAL
	MOVE PARK-GNOME,DIAL
	CALL PRINT-ID,STR?189
	SET 'PARK-FEE-PAID,1
	CALL INT,I-PARK-GNOME >STACK
	PUT STACK,0,0
	PRINTR """Okay, you can go through now, bub. Enjoy your trip to Bozbarland."" The gnome vanishes as suddenly as he appeared."

	.FUNCT MIDWAY-PSEUDO
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,FLUME,ARCADE \?L3
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L3:	EQUAL? HERE,ROLLER-COASTER,HAUNTED-HOUSE \?L5
	CALL DO-WALK,P?SOUTH >STACK
	RSTACK
?L5:	EQUAL? HERE,CASINO \?L6
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L6:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXIT,V?DROP \FALSE
	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT EAST-END-OF-MIDWAY-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUT VEZZAS,4,0
	RFALSE

	.FUNCT HAUNTED-HOUSE-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	ZERO? LIT /?L3
	PRINTI "Something about this place seems to soak up all light, so that it"
	JUMP ?L10
?L3:	ZERO? BLORTED /?L7
	PRINTI "Despite the effects of the blort potion, this place "
	JUMP ?L10
?L7:	PRINTI "It"
?L10:	PRINTR " is quite dark. You can see vague shapes swaying about in the darkness."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL QUEUE,I-HAUNT,1 >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT I-HAUNT
	CALL QUEUE,I-HAUNT,-1 >STACK
	PUT STACK,0,1
	EQUAL? HERE,HAUNTED-HOUSE /?L1
	CALL INT,I-HAUNT >STACK
	PUT STACK,0,0
	RFALSE
?L1:	RANDOM 100 >STACK
	LESS? 65,STACK /FALSE
	CRLF
	CALL PICK-ONE,HAUNT-TABLE >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT START-RIDE,LOC,X,N
	SET 'RIDE-IN-PROGRESS,1
	FIRST? LOC >X /?L1
?L1:	NEXT? X >N /?L4
?L4:	EQUAL? X,PROTAGONIST,CAR,LOG-BOAT /?L5
	FSET X,INVISIBLE
?L5:	ZERO? N /TRUE
	SET 'X,N
	JUMP ?L1

	.FUNCT END-RIDE,X,N
	SET 'RIDE-IN-PROGRESS,0
	SET 'RIDE-COUNTER,0
	CALL INT,I-FLUME-TRIP >STACK
	PUT STACK,0,0
	CALL INT,I-ROLLER-COASTER-TRIP >STACK
	PUT STACK,0,0
	FIRST? FLUME >X /?L1
?L1:	NEXT? X >N /?L4
?L4:	FCLEAR X,INVISIBLE
	ZERO? N /?L3
	SET 'X,N
	JUMP ?L1
?L3:	FIRST? ROLLER-COASTER >X /?L8
?L8:	NEXT? X >N /?L11
?L11:	FCLEAR X,INVISIBLE
	ZERO? N /TRUE
	SET 'X,N
	JUMP ?L8

	.FUNCT SITS-AT-PLATFORM,VEHICLE
	PRINTI " A "
	PRINTD VEHICLE
	PRINTI " sits at the platform, beckoning you to enter."
	RTRUE

	.FUNCT PARK-NYMPH,VEHICLE
	PRINTI "An amusement park nymph appears for a moment, warning you not to leave the "
	PRINTD VEHICLE
	PRINTR " during the course of the ride."

	.FUNCT PLAQUE
	PRINTI " A small plaque hangs nearby. The midway is visible to the "
	RTRUE

	.FUNCT PLAQUE-PSEUDO
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINTI """Constructed by the Frobozz Magic "
	EQUAL? HERE,FLUME \?L5
	PRINTI "Flume"
	JUMP ?L9
?L5:	PRINTI "Roller Coaster"
?L9:	PRINTR " Company."""

	.FUNCT FLUME-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	ZERO? RIDE-IN-PROGRESS \TRUE
	PRINTI "You are at the boarding platform of a fast-moving flume, flowing off beyond your view."
	CALL PLAQUE
	PRINTI "north."
	IN? PROTAGONIST,LOG-BOAT /?L10
	CALL SITS-AT-PLATFORM,LOG-BOAT
?L10:	CRLF
	RTRUE

	.FUNCT FLUME-OBJECT-F
	EQUAL? PRSA,V?PULVER \?L1
	PRINTI "In order to prevent damage to public life and property, flumes are protected against this sort of prank."
	CRLF
	CALL PRINT-ID,STR?190 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?BOARD \?L5
	CALL PERFORM,V?BOARD,LOG-BOAT
	RTRUE
?L5:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "Flumes are artifical water channels, usually with boat rides. The boat is typically a hollowed-out log. The largest flume of this kind is in Bozbarland."

	.FUNCT LOG-BOAT-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?WALK \?L1
	CALL NOT-GOING-ANYWHERE,LOG-BOAT >STACK
	RSTACK
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L4
	PRINTR "Huh?"
?L4:	EQUAL? PRSA,V?CLIMB-ON,V?ENTER,V?THROUGH \?L7
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L7:	EQUAL? PRSA,V?STAND,V?DISEMBARK,V?DROP /?L9
	EQUAL? PRSA,V?EXIT \?L8
?L9:	ZERO? RIDE-IN-PROGRESS /?L8
	CALL END-RIDE
	CALL PRINT-ID,STR?191
	CALL JIGS-UP,STR?192 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?BOARD \FALSE
	ZERO? RIDE-IN-PROGRESS \FALSE
	CALL START-RIDE,FLUME
	MOVE PROTAGONIST,LOG-BOAT
	CALL QUEUE,I-FLUME-TRIP,2 >STACK
	PUT STACK,0,1
	PRINTI "As you enter the log boat, it lurches away from the platform and is carried swiftly away by the current of the flume. "
	CALL PARK-NYMPH,LOG-BOAT >STACK
	RSTACK

	.FUNCT I-FLUME-TRIP
	CALL QUEUE,I-FLUME-TRIP,-1 >STACK
	PUT STACK,0,1
	INC 'RIDE-COUNTER
	ZERO? RIDE-IN-PROGRESS \?L1
	CALL INT,I-FLUME-TRIP >STACK
	PUT STACK,0,0
	SET 'RIDE-COUNTER,0
	RFALSE
?L1:	CRLF
	EQUAL? RIDE-COUNTER,1 \?L4
	PRINTR "The flume is wide here, and straight as an arrow. The ride is quite relaxing."
?L4:	EQUAL? RIDE-COUNTER,2 \?L8
	PRINTR "You enter a stretch of sharp, winding curves! Spray dashes your face as you are tossed about the log boat!"
?L8:	EQUAL? RIDE-COUNTER,3 \?L11
	PRINTR "The twists and turns are left behind as you approach the mouth of a dark tunnel."
?L11:	EQUAL? RIDE-COUNTER,4 \?L14
	ZERO? LIT \?L17
	ZERO? BLORTED /?L15
?L17:	PRINTR "The flume winds through a tunnel whose walls are black as coal. You pass an opening which provides a brief glimpse of troglodytes digging and hauling coal."
?L15:	PRINTR "It is pitch black. The roar of the flume's current echoes about the tunnel. A spot of light is visible ahead."
?L14:	EQUAL? RIDE-COUNTER,5 \?L23
	PRINTR "The log boat leaves the tunnel and passes through a series of rapids, shooting straight toward jagged rocks and then veering away at the last moment!"
?L23:	EQUAL? RIDE-COUNTER,6 \?L26
	PRINTR "Magically, the flume flows uphill here! The current slows as the boat climbs and climbs..."
?L26:	EQUAL? RIDE-COUNTER,7 \?L29
	PRINTR "You reach the crest of the flume's final drop. You can see swirling white water below!"
?L29:	EQUAL? RIDE-COUNTER,8 \?L32
	PRINTR "The log boat plunges down into the swirling waters at the base of the slope! Huge splashes of water spray off in every direction, but amazingly you stay dry!"
?L32:	EQUAL? RIDE-COUNTER,9 \FALSE
	CALL END-RIDE
	CALL INT,I-FLUME-TRIP >STACK
	PUT STACK,0,0
	PRINTR "The boat floats serenely around a final turn and pulls up to the boarding platform."

	.FUNCT ROLLER-COASTER-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	ZERO? RIDE-IN-PROGRESS \TRUE
	PRINTI "You are at the boarding platform of a huge roller coaster, sprawling above and around you in every direction."
	CALL PLAQUE
	PRINTI "south."
	IN? PROTAGONIST,CAR /?L10
	CALL SITS-AT-PLATFORM,CAR
?L10:	CRLF
	RTRUE

	.FUNCT CAR-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?WALK \?L1
	CALL NOT-GOING-ANYWHERE,CAR >STACK
	RSTACK
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L4
	PRINTR "Huh?"
?L4:	EQUAL? PRSA,V?CLIMB-ON,V?ENTER,V?THROUGH \?L7
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L7:	EQUAL? PRSA,V?STAND,V?DISEMBARK,V?DROP /?L9
	EQUAL? PRSA,V?EXIT \?L8
?L9:	ZERO? RIDE-IN-PROGRESS /?L8
	CALL END-RIDE
	CALL PRINT-ID,STR?193
	CALL JIGS-UP,STR?194 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?EXIT,V?DROP \?L10
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L10:	EQUAL? PRSA,V?BOARD \FALSE
	ZERO? RIDE-IN-PROGRESS \FALSE
	CALL START-RIDE,ROLLER-COASTER
	MOVE PROTAGONIST,CAR
	CALL QUEUE,I-ROLLER-COASTER-TRIP,2 >STACK
	PUT STACK,0,1
	PRINTI "As you enter the car, it rolls away from the platform in a gentle curve. "
	CALL PARK-NYMPH,CAR >STACK
	RSTACK

	.FUNCT I-ROLLER-COASTER-TRIP
	CALL QUEUE,I-ROLLER-COASTER-TRIP,-1 >STACK
	PUT STACK,0,1
	INC 'RIDE-COUNTER
	ZERO? RIDE-IN-PROGRESS \?L1
	CALL INT,I-ROLLER-COASTER-TRIP >STACK
	PUT STACK,0,0
	CALL END-RIDE
	RFALSE
?L1:	CRLF
	EQUAL? RIDE-COUNTER,1 \?L4
	PRINTR "The car, propelled by some unseen force, rolls up a huge incline. The crest grows tantalizingly closer."
?L4:	EQUAL? RIDE-COUNTER,2 \?L8
	PRINTR "You reach the crest, the highest point of the roller coaster! The park is laid out beneath you like a map; the lights of the midway, the booths of the arcade, the sparkling blue ribbon of water that must be the flume. In the distance is a wide crater. The sounds and smells of the park seem distant, and time feels suspended for a moment."
?L8:	EQUAL? RIDE-COUNTER,3 \?L11
	PRINTR "The breath is swept from your lungs as the car begins diving, seemingly straight downward. You rise from the seat as the ground rushes closer! At the last moment, the car swings upward, and your stomach settles in your ankles."
?L11:	EQUAL? RIDE-COUNTER,4 \?L14
	PRINTR "The car zips through a series of wild turns and sharp drops. Wooden roller coaster supports whiz past, inches from your head!"
?L14:	EQUAL? RIDE-COUNTER,5 \?L17
	PRINTR "This section of track is shaped like a corkscrew, and as the car hurtles forward it turns upside down almost every second. It is impossible to tell up from down, as the ground seems to spin around you."
?L17:	EQUAL? RIDE-COUNTER,6 \?L20
	PRINTR "The car shoots into a rapid climb, which gets progressively slower and steeper. Your heart beats wildly as the track begins to swing back above you, and you realize that you are entering a giant loop!"
?L20:	EQUAL? RIDE-COUNTER,7 \?L23
	PRINTR "As you reach the highest point of the loop, you hang completely upside-down for a brief moment. The blood rushes to your head as the ground suspended ""above"" you like a canopy. Then, you hurtle down the far side of the loop with breakneck speed!"
?L23:	EQUAL? RIDE-COUNTER,8 \?L26
	PRINTI "The roller coaster speeds out of the loop and into a tunnel"
	ZERO? LIT \?L31
	ZERO? BLORTED /?L29
?L31:	PRINTI ", which seems to run through the middle of a haunted house! Wispy ghosts and ghoulish skeletons brush past you"
	JUMP ?L34
?L29:	PRINTI ". You shiver as horrible slimy things brush across your face"
?L34:	PRINTR "."
?L26:	EQUAL? RIDE-COUNTER,9 \FALSE
	CALL END-RIDE
	CALL INT,I-ROLLER-COASTER-TRIP >STACK
	PUT STACK,0,0
	PRINTR "The car zooms out into daylight, and glides to a stop at the boarding platform."

	.FUNCT ARCADE-F,RARG
	EQUAL? RARG,M-END \FALSE
	ZERO? HAWKER-SUBDUED \FALSE
	IN? BALL,HAWKER \FALSE
	PRINTR """C'mon, pal!"" cries the hawker from the game booth. ""Try your luck!"" He holds the ball out toward you."

	.FUNCT ARCADE-EXIT-F
	CALL HELD?,BALL >STACK
	ZERO? STACK /?L1
	PRINTI "The hawker yells after you, ""Hey buddy, come back with that ball!"""
	CRLF
	CRLF
	CALL PRINT-ID,STR?195
?L1:	RETURN WEST-END-OF-MIDWAY

	.FUNCT BOOTH-PSEUDO
	EQUAL? PRSA,V?THROUGH \FALSE
	PRINTR "The hawker pushes you away."

	.FUNCT HAWKER-F
	EQUAL? HAWKER,WINNER \?L1
	EQUAL? PRSO,BALL \?L3
	EQUAL? PRSI,ME \?L3
	EQUAL? PRSA,V?GIVE \?L3
	SET 'WINNER,PROTAGONIST
	CALL PERFORM,V?TAKE,BALL
	RTRUE
?L3:	PRINTI """No time to gab, kid."
	ZERO? HAWKER-SUBDUED \?L8
	PRINTI " C'mon and give it a try. One hit wins!"
?L8:	PRINTI """"
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?YOMIN \?L15
	PRINTR "The hawker is thinking about finding a good stogie, whatever that is."
?L15:	EQUAL? PRSA,V?AIMFIZ \FALSE
	CALL PRINT-ID,STR?196
	CALL JIGS-UP,STR?197 >STACK
	RSTACK

	.FUNCT BALL-F
	EQUAL? PRSA,V?TAKE \?L1
	FCLEAR BALL,NDESCBIT
	FCLEAR BALL,TRYTAKEBIT
	RFALSE
?L1:	EQUAL? PRSA,V?ATTACK \?L3
	EQUAL? PRSO,RABBITS \?L3
	CALL PRINT-ID,STR?198
	CALL PERFORM,V?THROW,BALL,RABBITS
	RTRUE
?L3:	EQUAL? PRSA,V?THROW \FALSE
	EQUAL? PRSI,RABBITS \FALSE
	CALL HELD?,BALL >STACK
	ZERO? STACK /FALSE
	ZERO? FOOBLED /?L5
	MOVE MALYON-SCROLL,PROTAGONIST
	ADD SCORE,10 >SCORE
	SET 'HAWKER-SUBDUED,1
	MOVE BALL,DIAL
	PRINTR "A tremendous pitch sends a bunny spinning. ""What an arm, kid, what an arm!"" cries the hawker. He hands you a glittering scroll from the shelf of prizes. ""Here's your prize, now scram."""
?L5:	MOVE BALL,HAWKER
	FSET BALL,NDESCBIT
	FSET BALL,TRYTAKEBIT
	CALL PICK-ONE,MISSES >STACK
	PRINT STACK
	PRINTR " This game is harder than it looks. The hawker, leering, retrieves the ball."

	.FUNCT RABBITS-F
	EQUAL? PRSA,V?MALYON \FALSE
	PRINTI "The bunnies hop away and the startled hawker scrambles after them. He returns a moment later, holding the again inanimate bunnies, and gives you a nasty glare."
	CRLF
	CALL PRINT-ID,STR?199 >STACK
	RSTACK

	.FUNCT CASINO-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	ZERO? JACKPOT-DUMPED /FALSE
	SET 'JACKPOT-DUMPED,0
	PRINTI "You enter just as a group of casino nymphs finish cleaning up the last of the zorkmid coins."
	CRLF
	CRLF
	RTRUE

	.FUNCT LEVER-PSEUDO,A,B,C
	EQUAL? PRSA,V?PUSH,V?MOVE \FALSE
	ZERO? FWEEPED /?L3
	CALL BATTY >STACK
	RSTACK
?L3:	ZERO? SLOT-MACHINE-BROKEN /?L5
	PRINTR "The machine rattles loudly and makes a few feeble pings."
?L5:	RANDOM 100 >STACK
	LESS? 25,STACK /?L9
	GET SLOT-MACHINE-TABLE,1 >A
	JUMP ?L13
?L9:	RANDOM 100 >STACK
	LESS? 33,STACK /?L11
	GET SLOT-MACHINE-TABLE,2 >A
	JUMP ?L13
?L11:	RANDOM 100 >STACK
	LESS? 50,STACK /?L12
	GET SLOT-MACHINE-TABLE,3 >A
	JUMP ?L13
?L12:	GET SLOT-MACHINE-TABLE,4 >A
?L13:	RANDOM 100 >STACK
	LESS? 25,STACK /?L14
	GET SLOT-MACHINE-TABLE,1 >B
	JUMP ?L18
?L14:	RANDOM 100 >STACK
	LESS? 33,STACK /?L16
	GET SLOT-MACHINE-TABLE,2 >B
	JUMP ?L18
?L16:	RANDOM 100 >STACK
	LESS? 50,STACK /?L17
	GET SLOT-MACHINE-TABLE,3 >B
	JUMP ?L18
?L17:	GET SLOT-MACHINE-TABLE,4 >B
?L18:	RANDOM 100 >STACK
	LESS? 25,STACK /?L19
	GET SLOT-MACHINE-TABLE,1 >C
	JUMP ?L23
?L19:	RANDOM 100 >STACK
	LESS? 33,STACK /?L21
	GET SLOT-MACHINE-TABLE,2 >C
	JUMP ?L23
?L21:	RANDOM 100 >STACK
	LESS? 50,STACK /?L22
	GET SLOT-MACHINE-TABLE,3 >C
	JUMP ?L23
?L22:	GET SLOT-MACHINE-TABLE,4 >C
?L23:	PRINTI "Ping!
A "
	PRINT A
	PRINTI " appears in the first section of the display.
Ping!
A "
	PRINT B
	PRINTI " appears in the second section of the display.
Ping!
A "
	PRINT C
	PRINTI " appears in the third section of the display."
	CRLF
	EQUAL? A,B \TRUE
	EQUAL? A,C \TRUE
	GET SLOT-MACHINE-TABLE,1 >STACK
	EQUAL? A,STACK \?L28
	SET 'JACKPOT-DUMPED,1
	CALL PRINT-ID,STR?200
	CALL JIGS-UP,STR?201 >STACK
	RSTACK
?L28:	MOVE ZORKMID,HERE
	SET 'SLOT-MACHINE-BROKEN,1
	PRINTR "Ping! Ping! Ping!
A zorkmid coin drops out of the machine and lands at your feet."

	.FUNCT MAZE-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,OUTSIDE-GLASS-DOOR \?L3
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L3:	EQUAL? HERE,HOLLOW \?L5
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L5:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXIT,V?DROP \?L7
	EQUAL? HERE,GLASS-MAZE \?L8
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L8:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L11
	PRINTR "You see nothing but reflected light in all directions."
?L11:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "According to the article, Duncanthrax built the Glass Maze on a whim, to amuse his friends and torture his enemies. A labyrinth of 27 cubicles, it was full of devilish pitfalls and was located near his castle, Egreth."

	.FUNCT HOVEL-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,END-OF-HIGHWAY \?L3
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L3:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXIT,V?DROP \?L6
	EQUAL? HERE,STONE-HUT \?L7
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L7:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	EQUAL? HERE,STONE-HUT \?L11
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L11:	CALL MAKE-OUT >STACK
	RSTACK

	.FUNCT CHIMNEY-EXIT-F
	ZERO? FWEEPED /?L1
	PRINTI "Too narrow even for bats."
	CRLF
	RFALSE
?L1:	PRINTI "Where did you get the bizarre notion that you might fit up a chimney?"
	CRLF
	RFALSE

	.FUNCT FIREPLACE-F
	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL V-DEFLATE >STACK
	RSTACK

	.FUNCT STATUE-F
	EQUAL? PRSA,V?MALYON \?L1
	PRINTI "The statue transforms into a living figure, probably a King if the royal attire is any clue. The King seems angry, and quickly settles his wrathful gaze on you. He bellows ""Guards! Throw this trespasser into the glass maze! Guards! ... GUARDS!!!"" When the guards fail to respond, the King becomes livid, his voice rises to an incoherent squeak, and flecks of foam spit from the corners of his mouth. Finally, eyes bulging with rage, he storms out of the room."
	CRLF
	FSET STATUE,TOUCHBIT
	SET 'STATUE-FOLLOW,1
	CALL QUEUE,I-STATUE-UNFOLLOW,1 >STACK
	PUT STACK,0,1
	EQUAL? HERE,ENTRANCE-HALL,OUTSIDE-STORE \?L5
	RANDOM 100 >STACK
	LESS? 50,STACK /?L7
	MOVE STATUE,HIGHWAY
	RTRUE
?L7:	MOVE STATUE,BEND
	RTRUE
?L5:	RANDOM 100 >STACK
	LESS? 50,STACK /?L11
	MOVE STATUE,ENTRANCE-HALL
	RTRUE
?L11:	MOVE STATUE,OUTSIDE-STORE
	RTRUE
?L1:	EQUAL? PRSA,V?FOLLOW \FALSE
	ZERO? STATUE-FOLLOW /FALSE
	PRINTR "The King moved too quickly to follow."

	.FUNCT I-STATUE-UNFOLLOW
	SET 'STATUE-FOLLOW,0
	RFALSE

	.FUNCT NO-FLOOR?
	ZERO? MAZE-CROSSED /?L5
	GET POST-DOWN-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK /FALSE
	ZERO? MAZE-CROSSED \TRUE
?L5:	GET PRE-DOWN-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT GLASS-MAZE-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	CALL TABLE-TO-MAZE,ROOM-NUMBER
	FCLEAR GLASS-MAZE,TOUCHBIT
	PUT VEZZAS,5,0
	RTRUE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are inside a huge cubical maze, shimmering with light from an unseen source above."
	ZERO? FWEEPED \?L6
	PRINTI " It is impossible to tell if the walls and ceilings around you are glass surfaces or openings."
?L6:	ZERO? FLYING \?L16
	CALL NO-FLOOR? >STACK
	ZERO? STACK /?L11
	EQUAL? ROOM-NUMBER,13 \?L11
	PRINTI " "
	CALL PLUMMET
	RTRUE
?L11:	ZERO? FLYING \?L16
	CALL NO-FLOOR? >STACK
	ZERO? STACK \?L16
	PRINTI " Since you are standing on something, the floor must be solid, but it is virtually invisible and you feel as though you were walking on air."
?L16:	ZERO? FWEEPED /?L21
	CALL RADAR-VIEW
?L21:	CRLF
	RTRUE

	.FUNCT RADAR-VIEW,X,COUNT,LUP,LDOWN,NORTH,SOUTH,EAST,WEST
	SET 'X,0
	SET 'LUP,0
	SET 'LDOWN,0
	SET 'NORTH,0
	SET 'SOUTH,0
	SET 'EAST,0
	SET 'WEST,0
	SET 'COUNT,0
	PRINTI " Thanks to your sonar-like bat senses, you can tell that there are surfaces "
	ZERO? MAZE-CROSSED /?L113
	GET POST-UP-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK /?L5
	ZERO? MAZE-CROSSED \?L114
?L113:	GET PRE-UP-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L3
?L5:	SET 'LUP,1
	INC 'COUNT
?L3:	ZERO? MAZE-CROSSED /?L115
?L114:	GET POST-DOWN-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK /?L10
	ZERO? MAZE-CROSSED \?L116
?L115:	GET PRE-DOWN-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L8
?L10:	SET 'LDOWN,1
	INC 'COUNT
?L8:	ZERO? MAZE-CROSSED /?L117
?L116:	GET POST-NORTH-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK /?L15
	ZERO? MAZE-CROSSED \?L118
?L117:	GET PRE-NORTH-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L13
?L15:	SET 'NORTH,1
	INC 'COUNT
?L13:	ZERO? MAZE-CROSSED /?L119
?L118:	GET POST-SOUTH-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK /?L20
	ZERO? MAZE-CROSSED \?L120
?L119:	GET PRE-SOUTH-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L18
?L20:	SET 'SOUTH,1
	INC 'COUNT
?L18:	ZERO? MAZE-CROSSED /?L121
?L120:	GET POST-EAST-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK /?L25
	ZERO? MAZE-CROSSED \?L122
?L121:	GET PRE-EAST-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L23
?L25:	SET 'EAST,1
	INC 'COUNT
?L23:	ZERO? MAZE-CROSSED /?L123
?L122:	GET POST-WEST-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK /?L30
	ZERO? MAZE-CROSSED \?L28
?L123:	GET PRE-WEST-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L28
?L30:	SET 'WEST,1
	INC 'COUNT
?L28:	ZERO? LUP /?L33
	EQUAL? COUNT,1 \?L35
	PRINTI " and "
	JUMP ?L39
?L35:	ZERO? X /?L39
	PRINTI ", "
?L39:	SET 'X,1
	DEC 'COUNT
	PRINTI "above you"
?L33:	ZERO? LDOWN /?L46
	EQUAL? COUNT,1 \?L48
	PRINTI " and "
	JUMP ?L52
?L48:	ZERO? X /?L52
	PRINTI ", "
?L52:	SET 'X,1
	DEC 'COUNT
	PRINTI "below you"
?L46:	ZERO? NORTH /?L59
	EQUAL? COUNT,1 \?L61
	PRINTI " and "
	JUMP ?L65
?L61:	ZERO? X /?L65
	PRINTI ", "
?L65:	SET 'X,1
	DEC 'COUNT
	PRINTI "to the north"
?L59:	ZERO? SOUTH /?L72
	EQUAL? COUNT,1 \?L74
	PRINTI " and "
	JUMP ?L78
?L74:	ZERO? X /?L78
	PRINTI ", "
?L78:	SET 'X,1
	DEC 'COUNT
	PRINTI "to the south"
?L72:	ZERO? EAST /?L85
	EQUAL? COUNT,1 \?L87
	PRINTI " and "
	JUMP ?L91
?L87:	ZERO? X /?L91
	PRINTI ", "
?L91:	SET 'X,1
	DEC 'COUNT
	PRINTI "to the east"
?L85:	ZERO? WEST /?L98
	EQUAL? COUNT,1 \?L100
	PRINTI " and "
	JUMP ?L104
?L100:	ZERO? X /?L104
	PRINTI ", "
?L104:	SET 'X,1
	DEC 'COUNT
	PRINTI "to the west"
?L98:	PRINTI "."
	RTRUE

	.FUNCT MAZE-EXIT-F
	ZERO? MAZE-CROSSED /?L1
	CALL MAZE-TO-TABLE,ROOM-NUMBER
	EQUAL? PRSO,P?UP \?L3
	ZERO? FLYING \?L5
	CALL CANT-JUMP
	CALL TABLE-TO-MAZE,ROOM-NUMBER
	RFALSE
?L5:	GET POST-UP-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L8
	CALL HIT-WALL
	RFALSE
?L8:	GET POST-UP-EXITS,ROOM-NUMBER >ROOM-NUMBER
	JUMP ?L37
?L3:	EQUAL? PRSO,P?DOWN \?L11
	ZERO? FLYING \?L12
	CALL SOLID-FLOOR
	CALL TABLE-TO-MAZE,ROOM-NUMBER
	RFALSE
?L12:	GET POST-DOWN-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L15
	CALL HIT-WALL
	RFALSE
?L15:	GET POST-DOWN-EXITS,ROOM-NUMBER >ROOM-NUMBER
	JUMP ?L37
?L11:	EQUAL? PRSO,P?NORTH \?L18
	GET POST-NORTH-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L19
	CALL HIT-WALL
	RFALSE
?L19:	GET POST-NORTH-EXITS,ROOM-NUMBER >ROOM-NUMBER
	JUMP ?L37
?L18:	EQUAL? PRSO,P?SOUTH \?L22
	GET POST-SOUTH-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L23
	CALL HIT-WALL
	RFALSE
?L23:	GET POST-SOUTH-EXITS,ROOM-NUMBER >ROOM-NUMBER
	JUMP ?L37
?L22:	EQUAL? PRSO,P?EAST \?L26
	GET POST-EAST-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L27
	CALL HIT-WALL
	RFALSE
?L27:	GET POST-EAST-EXITS,ROOM-NUMBER >ROOM-NUMBER
	EQUAL? ROOM-NUMBER,30 \?L37
	SET 'ROOM-NUMBER,24
	RETURN HOLLOW
?L26:	EQUAL? PRSO,P?WEST \?L37
	GET POST-WEST-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L34
	CALL HIT-WALL
	RFALSE
?L34:	GET POST-WEST-EXITS,ROOM-NUMBER >ROOM-NUMBER
	EQUAL? ROOM-NUMBER,40 \?L37
	SET 'ROOM-NUMBER,13
	RETURN OUTSIDE-GLASS-DOOR
?L37:	CALL TABLE-TO-MAZE,ROOM-NUMBER
	CALL V-LOOK
	CALL PLUMMET
	RFALSE
?L1:	CALL MAZE-TO-TABLE,ROOM-NUMBER
	EQUAL? PRSO,P?UP \?L42
	ZERO? FLYING \?L44
	CALL CANT-JUMP
	CALL TABLE-TO-MAZE,ROOM-NUMBER
	RFALSE
?L44:	GET PRE-UP-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L47
	CALL HIT-WALL
	RFALSE
?L47:	GET PRE-UP-EXITS,ROOM-NUMBER >ROOM-NUMBER
	JUMP ?L76
?L42:	EQUAL? PRSO,P?DOWN \?L50
	ZERO? FLYING \?L51
	CALL SOLID-FLOOR
	CALL TABLE-TO-MAZE,ROOM-NUMBER
	RFALSE
?L51:	GET PRE-DOWN-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L54
	CALL HIT-WALL
	RFALSE
?L54:	GET PRE-DOWN-EXITS,ROOM-NUMBER >ROOM-NUMBER
	JUMP ?L76
?L50:	EQUAL? PRSO,P?NORTH \?L57
	GET PRE-NORTH-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L58
	CALL HIT-WALL
	RFALSE
?L58:	GET PRE-NORTH-EXITS,ROOM-NUMBER >ROOM-NUMBER
	JUMP ?L76
?L57:	EQUAL? PRSO,P?SOUTH \?L61
	GET PRE-SOUTH-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L62
	CALL HIT-WALL
	RFALSE
?L62:	GET PRE-SOUTH-EXITS,ROOM-NUMBER >ROOM-NUMBER
	JUMP ?L76
?L61:	EQUAL? PRSO,P?EAST \?L65
	GET PRE-EAST-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L66
	CALL HIT-WALL
	RFALSE
?L66:	GET PRE-EAST-EXITS,ROOM-NUMBER >ROOM-NUMBER
	EQUAL? ROOM-NUMBER,30 \?L76
	ADD SCORE,HOLLOW-POINT >SCORE
	SET 'HOLLOW-POINT,0
	SET 'ROOM-NUMBER,24
	RETURN HOLLOW
?L65:	EQUAL? PRSO,P?WEST \?L76
	GET PRE-WEST-EXITS,ROOM-NUMBER >STACK
	ZERO? STACK \?L73
	CALL HIT-WALL
	RFALSE
?L73:	GET PRE-WEST-EXITS,ROOM-NUMBER >ROOM-NUMBER
	EQUAL? ROOM-NUMBER,40 \?L76
	SET 'ROOM-NUMBER,13
	RETURN OUTSIDE-GLASS-DOOR
?L76:	CALL TABLE-TO-MAZE,ROOM-NUMBER
	CALL V-LOOK
	CALL PLUMMET
	RFALSE

	.FUNCT HIT-WALL
	PRINTI "BONK! You "
	ZERO? FLYING /?L3
	PRINTI "fly"
	JUMP ?L7
?L3:	PRINTI "walk"
?L7:	PRINTR " right into an almost invisible wall of glass -- a stunning blow!"

	.FUNCT CANT-JUMP
	PRINTR "You can't possibly jump that high."

	.FUNCT SOLID-FLOOR
	PRINTR "Fortunately, the floor is solid."

	.FUNCT PLUMMET
	ZERO? FLYING \FALSE
	CALL NO-FLOOR? >STACK
	ZERO? STACK /FALSE
	CALL JIGS-UP,STR?202
	RFALSE

	.FUNCT MAZE-TO-TABLE,LOC,CNT=0,F,N
	FIRST? GLASS-MAZE >F /?L18
	RTRUE
?L1:	ZERO? F /TRUE
?L18:	NEXT? F >N /?L7
?L7:	EQUAL? F,WINNER /?L13
	FSET? F,TAKEBIT /?L11
	EQUAL? F,DORN-BEAST-CORPSE \?L13
?L11:	GET MAZE-TABLE,CNT >STACK
	ZERO? STACK \?L14
	PUT MAZE-TABLE,CNT,LOC
	ADD CNT,1 >STACK
	PUT MAZE-TABLE,STACK,F
	ADD CNT,2 >CNT
	MOVE F,DIAL
	JUMP ?L13
?L14:	ADD CNT,2 >CNT
	JUMP ?L11
?L13:	SET 'F,N
	JUMP ?L1

	.FUNCT TABLE-TO-MAZE,LOC,TABLE,CNT=0
	SET 'TABLE,MAZE-TABLE
?L1:	LESS? CNT,MAZE-TABLE-LENGTH \TRUE
	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,LOC \?L5
	PUT MAZE-TABLE,CNT,0
	ADD CNT,1 >STACK
	GET MAZE-TABLE,STACK >STACK
	MOVE STACK,GLASS-MAZE
?L5:	ADD CNT,2 >CNT
	JUMP ?L1

	.FUNCT DROP-IN-MAZE,CNT=0,NEW-ROOM=0
	ZERO? MAZE-CROSSED /?L1
	EQUAL? ROOM-NUMBER,12 \?L3
	SET 'NEW-ROOM,3
	JUMP ?L20
?L3:	EQUAL? ROOM-NUMBER,13 \?L5
	SET 'NEW-ROOM,4
	JUMP ?L20
?L5:	EQUAL? ROOM-NUMBER,16 \?L6
	SET 'NEW-ROOM,7
	JUMP ?L20
?L6:	EQUAL? ROOM-NUMBER,18 \?L7
	SET 'NEW-ROOM,9
	JUMP ?L20
?L7:	EQUAL? ROOM-NUMBER,19 \?L8
	SET 'NEW-ROOM,10
	JUMP ?L20
?L8:	EQUAL? ROOM-NUMBER,20 \?L9
	SET 'NEW-ROOM,11
	JUMP ?L20
?L9:	EQUAL? ROOM-NUMBER,25 \?L10
	SET 'NEW-ROOM,7
	JUMP ?L20
?L10:	EQUAL? ROOM-NUMBER,27 \?L20
	SET 'NEW-ROOM,9
	JUMP ?L20
?L1:	EQUAL? ROOM-NUMBER,10 \?L14
	SET 'NEW-ROOM,1
	JUMP ?L20
?L14:	EQUAL? ROOM-NUMBER,12 \?L16
	SET 'NEW-ROOM,3
	JUMP ?L20
?L16:	EQUAL? ROOM-NUMBER,16 \?L17
	SET 'NEW-ROOM,7
	JUMP ?L20
?L17:	EQUAL? ROOM-NUMBER,20 \?L18
	SET 'NEW-ROOM,11
	JUMP ?L20
?L18:	EQUAL? ROOM-NUMBER,21 \?L19
	SET 'NEW-ROOM,3
	JUMP ?L20
?L19:	EQUAL? ROOM-NUMBER,26 \?L20
	SET 'NEW-ROOM,17
?L20:	ZERO? NEW-ROOM \?L22
	PRINTR "Bug #14"
?L22:	GET MAZE-TABLE,CNT >STACK
	ZERO? STACK \?L29
	PUT MAZE-TABLE,CNT,NEW-ROOM
	ADD CNT,1 >STACK
	PUT MAZE-TABLE,STACK,PRSO
	ADD CNT,2 >CNT
	RTRUE
?L29:	ADD CNT,2 >CNT
	JUMP ?L22

	.FUNCT REARRANGE-MAZE-TABLE,CNT=0
?L1:	LESS? CNT,MAZE-TABLE-LENGTH \TRUE
	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,12 \?L5
	PUT MAZE-TABLE,CNT,3
	JUMP ?L12
?L5:	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,13 \?L6
	PUT MAZE-TABLE,CNT,4
	JUMP ?L12
?L6:	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,16 \?L7
	PUT MAZE-TABLE,CNT,7
	JUMP ?L12
?L7:	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,18 \?L8
	PUT MAZE-TABLE,CNT,9
	JUMP ?L12
?L8:	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,19 \?L9
	PUT MAZE-TABLE,CNT,10
	JUMP ?L12
?L9:	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,20 \?L10
	PUT MAZE-TABLE,CNT,11
	JUMP ?L12
?L10:	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,25 \?L11
	PUT MAZE-TABLE,CNT,7
	JUMP ?L12
?L11:	GET MAZE-TABLE,CNT >STACK
	EQUAL? STACK,27 \?L12
	PUT MAZE-TABLE,CNT,9
?L12:	ADD CNT,2 >CNT
	JUMP ?L1

	.FUNCT HOLLOW-F,RARG
	EQUAL? RARG,M-END \FALSE
	CALL HELD?,SPELL-BOOK >STACK
	ZERO? STACK /FALSE
	MOVE SPELL-BOOK,DIAL
	PRINTR """Caw! Caw!"" A giant bird of prey with a fondness for gnusto-receptive paper swoops down and flies off with your spell book."

	.FUNCT CHIMNEY-F
	EQUAL? HERE,HOLLOW \FALSE
	EQUAL? PRSO,CHIMNEY \?L3
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,BRICK-STRUCTURE,PRSI
	RTRUE
?L3:	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,BRICK-STRUCTURE
	RTRUE

	.FUNCT BRICK-STRUCTURE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The structure is about two feet on each side, and extends up from the ground about three feet. Except for a large quantity of soot around the opening, it looks a lot like a small, rectangular well."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L5
	PRINTR "The opening is dark and you can only see a few feet into it."
?L5:	EQUAL? PRSA,V?CLIMB-DOWN,V?ENTER \?L8
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?PUT \?L9
	EQUAL? PRSI,BRICK-STRUCTURE \?L9
	MOVE PRSO,FIREPLACE
	EQUAL? PRSO,SWANZO-SCROLL \?L10
	CALL QUEUE,I-DORN-BEAST,2 >STACK
	PUT STACK,0,1
?L10:	PRINTI "The "
	PRINTD PRSO
	PRINTR " disappears into the shaft."
?L9:	EQUAL? PRSA,V?REACH-IN \?L15
	PRINTR "The shaft extends beyond your reach."
?L15:	EQUAL? PRSA,V?THROUGH \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT DORN-BEAST-F
	EQUAL? PRSA,V?RESEARCH \FALSE
	CALL PERFORM,V?RESEARCH,LOBBY
	RTRUE

	.FUNCT CORPSE-F
	EQUAL? PRSA,V?MALYON \FALSE
	CALL JIGS-UP,STR?203 >STACK
	RSTACK

	.FUNCT I-DORN-BEAST
	CALL QUEUE,I-DORN-BEAST,-1 >STACK
	PUT STACK,0,1
	EQUAL? HERE,HOLLOW \?L1
	ZERO? DORN-BEAST-WARNING /?L3
	CALL DORN-DEATH >STACK
	RSTACK
?L3:	MOVE DORN-BEAST,HERE
	SET 'DORN-BEAST-WARNING,1
	CRLF
	PRINTR "With a loud roar, a dreadfully huge dorn beast emerges from the shadows at the base of the cliff and gallops toward you."
?L1:	FSET DORN-BEAST,NDESCBIT
	ZERO? DORN-BEAST-WARNING \?L9
	SET 'DORN-BEAST-WARNING,1
	CRLF
	PRINTR "From outside the maze, you hear the bellowing of a ferocious dorn beast!"
?L9:	EQUAL? ROOM-NUMBER,DORN-BEAST-ROOM,LAST-DORN-ROOM \?L13
	CRLF
	CALL DORN-DEATH >STACK
	RSTACK
?L13:	CRLF
	PRINTI "The dorn beast rushes after you. Its ear-splitting bellowing resounds throughout the glass maze."
	EQUAL? ROOM-NUMBER,27 \?L17
	SET 'SPLATTERED,1
	CALL INT,I-DORN-BEAST >STACK
	PUT STACK,0,0
	MOVE DORN-BEAST,DIAL
	PUT MAZE-TABLE,38,9
	PUT MAZE-TABLE,39,DORN-BEAST-CORPSE
	PRINTR " Suddenly, the dorn-beast realizes that it is galloping through midair, and gives a surprisingly high-pitched squeal. It claws frantically at thin air, trying desperately to invent dorn beast flight. You happily notice that dorn beasts do not so much fly as plummet."
?L17:	SET 'LAST-DORN-ROOM,DORN-BEAST-ROOM
	SET 'DORN-BEAST-ROOM,ROOM-NUMBER
	MOVE DORN-BEAST,HERE
	CRLF
	RTRUE

	.FUNCT DORN-DEATH
	CALL JIGS-UP,STR?204 >STACK
	RSTACK

	.FUNCT COAL-F
	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "Such menial tasks are best left to troglodytes."

	.FUNCT SOOTY-ROOM-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FSET? SOOTY-ROOM,TOUCHBIT /FALSE
	ADD SCORE,20 >SCORE
	RETURN SCORE

	.FUNCT SOOTY-ROOM-EXIT-F
	FSET? COAL-BIN-ROOM,TOUCHBIT \?L1
	PRINTI "That passage is now completely blocked by a cave-in."
	CRLF
	RFALSE
?L1:	RETURN COAL-BIN-ROOM

	.FUNCT TIMBER-PSEUDO
	EQUAL? PRSA,V?MOVE \FALSE
	CALL PRINT-ID,STR?205
	CALL JIGS-UP,STR?206 >STACK
	RSTACK

	.FUNCT COAL-BIN-ROOM-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	FSET? HERE,TOUCHBIT /?L3
	RANDOM 873 >COMBO
	PUT VEZZAS,5,0
	PRINTI "There is a rumbling noise behind you as the ceiling of the tunnel collapses, blocking your retreat! The air smells strongly of coal gas. "
	ZERO? VILSTUED /?L7
	CALL QUEUE,I-OLDER-SELF,2 >STACK
	PUT STACK,0,1
	PRINTI "Good thing you took that vilstu potion"
	JUMP ?L11
?L7:	CALL QUEUE,I-SUFFOCATE,2 >STACK
	PUT STACK,0,1
	PRINTI "You won't survive long in this atmosphere"
?L11:	PRINTI "."
	CRLF
	CRLF
	RTRUE
?L3:	ZERO? GOLMACKED /FALSE
	CALL QUEUE,I-YOUNGER-SELF,-1 >STACK
	PUT STACK,0,1
	MOVE YOUNGER-SELF,HERE
	ZERO? YOUNGER-HAS-SPELL-BOOK /?L17
	IN? SPELL-BOOK,LAGOON-FLOOR \?L19
	SET 'BOOK-BELONGS-IN-LAGOON,1
?L19:	MOVE SPELL-BOOK,YOUNGER-SELF
	FSET SPELL-BOOK,TRYTAKEBIT
?L17:	CALL LIT?,HERE >LIT
	RETURN LIT
?L1:	EQUAL? RARG,M-END \FALSE
	RANDOM 100 >STACK
	LESS? 35,STACK /FALSE
	CRLF
	PRINTR "A few lumps of coal spill from the coal chute."

	.FUNCT I-SUFFOCATE
	CRLF
	ZERO? SUFFOCATE-WARNING /?L1
	CALL PRINT-ID,STR?207
	CALL JIGS-UP,STR?208 >STACK
	RSTACK
?L1:	SET 'SUFFOCATE-WARNING,1
	CALL QUEUE,I-SUFFOCATE,2 >STACK
	PUT STACK,0,1
	PRINTR "You are about to pass out from the bad air."

	.FUNCT COAL-BIN-F
	EQUAL? PRSA,V?LOOK-INSIDE \?L1
	PRINTR "It's full of coal."
?L1:	EQUAL? PRSA,V?DIG,V?SEARCH \FALSE
	PRINTR "You find nothing of interest."

	.FUNCT UPPER-CHUTE-F
	EQUAL? PRSA,V?LEAP,V?THROUGH \?L1
	EQUAL? HERE,TOP-OF-CHUTE,SLANTED-ROOM \?L3
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L3:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-UP \?L6
	EQUAL? HERE,TOP-OF-CHUTE \?L7
	CALL BOTTOM-TOP-OF-CHUTE,1 >STACK
	RSTACK
?L7:	CALL DO-WALK,P?UP >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?CLIMB-DOWN \?L10
	EQUAL? HERE,COAL-BIN-ROOM \?L11
	CALL BOTTOM-TOP-OF-CHUTE >STACK
	RSTACK
?L11:	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?LOWER-INTO,V?PUT \?L14
	EQUAL? PRSI,UPPER-CHUTE \?L14
	EQUAL? HERE,TOP-OF-CHUTE,SLANTED-ROOM \?L15
	EQUAL? PRSO,BEAM \?L17
	ZERO? ROPE-TO-BEAM /?L17
	MOVE ROPE,COAL-BIN-ROOM
	MOVE BEAM,COAL-BIN-ROOM
	SET 'ROPE-PLACED,0
	FCLEAR BEAM,TRYTAKEBIT
	FCLEAR ROPE,TRYTAKEBIT
	CALL BEAM-AND-ROPE >STACK
	RSTACK
?L17:	EQUAL? PRSO,ROPE \?L19
	ZERO? ROPE-TO-BEAM /?L19
	CALL DROP-BEAM-FIRST >STACK
	ZERO? STACK \TRUE
	SET 'ROPE-PLACED,1
	FSET BEAM,TRYTAKEBIT
	FSET ROPE,TRYTAKEBIT
	MOVE ROPE,HERE
	CALL ROPE-HANGS >STACK
	RSTACK
?L19:	GETP PRSO,P?SIZE >STACK
	LESS? STACK,20 \?L24
	MOVE PRSO,DIAL
	JUMP ?L26
?L24:	MOVE PRSO,COAL-BIN-ROOM
?L26:	CALL DISAPPEARS-DOWN-CHUTE >STACK
	RSTACK
?L15:	EQUAL? HERE,COAL-BIN-ROOM \FALSE
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL PERFORM,V?RESEARCH,UPPER-CHUTE
	RTRUE

	.FUNCT LOWER-CHUTE-F
	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-UP \?L1
	EQUAL? HERE,COAL-BIN-ROOM \?L3
	CALL BOTTOM-TOP-OF-CHUTE,1 >STACK
	RSTACK
?L3:	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LEAP,V?THROUGH,V?CLIMB-DOWN \?L6
	EQUAL? HERE,COVE \?L7
	CALL BOTTOM-TOP-OF-CHUTE >STACK
	RSTACK
?L7:	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?LOWER-INTO,V?PUT \?L10
	EQUAL? PRSI,LOWER-CHUTE \?L10
	EQUAL? HERE,COAL-BIN-ROOM \FALSE
	EQUAL? PRSO,BEAM \?L13
	ZERO? ROPE-TO-BEAM /?L13
	MOVE ROPE,LAGOON-FLOOR
	MOVE BEAM,LAGOON-FLOOR
	SET 'ROPE-IN-LOWER-CHUTE,0
	FCLEAR ROPE,TRYTAKEBIT
	CALL BEAM-AND-ROPE >STACK
	RSTACK
?L13:	EQUAL? PRSO,ROPE \?L15
	ZERO? ROPE-TO-BEAM /?L15
	CALL DROP-BEAM-FIRST >STACK
	ZERO? STACK \TRUE
	SET 'ROPE-IN-LOWER-CHUTE,1
	FSET ROPE,TRYTAKEBIT
	MOVE ROPE,HERE
	CALL ROPE-HANGS >STACK
	RSTACK
?L15:	MOVE PRSO,LAGOON-FLOOR
	FSET? PRSO,SCROLLBIT /?L22
	EQUAL? PRSO,SPELL-BOOK \?L20
?L22:	FSET PRSO,MUNGBIT
?L20:	CALL DISAPPEARS-DOWN-CHUTE >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL PERFORM,V?RESEARCH,LOWER-CHUTE
	RTRUE

	.FUNCT DROP-BEAM-FIRST
	CALL HELD?,BEAM >STACK
	ZERO? STACK /FALSE
	PRINTR "You'll have to drop the beam before doing that."

	.FUNCT BEAM-AND-ROPE
	PRINTR "The beam and rope both slide into the chute."

	.FUNCT ROPE-HANGS
	PRINTR "The rope hangs from the beam, into the chute."

	.FUNCT DISAPPEARS-DOWN-CHUTE
	PRINTI "The "
	PRINTD PRSO
	PRINTR " disappears into the chute."

	.FUNCT OLDER-SELF-F
	EQUAL? WINNER,OLDER-SELF \?L1
	PRINTI "Your older self ignores your words."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	PRINT OLDER-INTRO
	PRINTR " The stranger is carrying a smelly scroll."
?L5:	EQUAL? PRSA,V?GIVE \?L8
	EQUAL? PRSO,SPELL-BOOK \?L8
	MOVE SPELL-BOOK,OLDER-SELF
	FSET SPELL-BOOK,TRYTAKEBIT
	PRINTR "Your older self accepts the spell book gratefully."
?L8:	EQUAL? PRSA,V?FOLLOW \?L11
	ZERO? TWIN-FOLLOW /?L11
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?AIMFIZ \?L12
	CALL V-SWANZO >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?YOMIN \FALSE
	PRINTR "The thoughts of your older self center on attempting to breathe."

	.FUNCT I-OLDER-SELF
	CALL QUEUE,I-OLDER-SELF,-1 >STACK
	PUT STACK,0,1
	INC 'OLDER-COUNTER
	EQUAL? OLDER-COUNTER,1 \?L1
	MOVE OLDER-SELF,COAL-BIN-ROOM
	CALL HELD?,SPELL-BOOK >STACK
	ZERO? STACK /?L3
	SET 'YOUNGER-HAS-SPELL-BOOK,1
?L3:	EQUAL? HERE,COAL-BIN-ROOM \?L6
	CRLF
	PRINTI "Someone slides out of the coal chute, and lands near the bin. "
	PRINT OLDER-INTRO
	CRLF
	SET 'OLDER-INTRODUCED,1
	RETURN OLDER-INTRODUCED
?L6:	EQUAL? HERE,DIAL-ROOM \?L12
	CRLF
	PRINTR "You here a commotion from the room to the west."
?L12:	CALL INT,I-OLDER-SELF >STACK
	PUT STACK,0,0
	RFALSE
?L1:	EQUAL? OLDER-COUNTER,2 \?L16
	CALL DATA-TO-TABLE,MOVE-ONE-TABLE
	EQUAL? HERE,COAL-BIN-ROOM \?L17
	CRLF
	ZERO? OLDER-INTRODUCED \?L19
	SET 'OLDER-INTRODUCED,1
	PRINTI "Someone is standing near the coal bin. "
	PRINT OLDER-INTRO
	CRLF
	CRLF
?L19:	SET 'COMBO-DISCOVERED,1
	CALL OLDER-TELLS-COMBO
	IN? SPELL-BOOK,OLDER-SELF /?L24
	PRINTI " Your older self then looks at you, almost expectantly."
?L24:	CRLF
	RTRUE
?L17:	CRLF
	PRINTR "From the next room you glimpse someone gasping for air."
?L16:	EQUAL? OLDER-COUNTER,3 \?L32
	CALL DATA-TO-TABLE,MOVE-TWO-TABLE
	EQUAL? HERE,COAL-BIN-ROOM \?L33
	ZERO? OLDER-INTRODUCED \?L35
	SET 'OLDER-INTRODUCED,1
	CRLF
	PRINTI "Someone is standing near the coal bin. "
	PRINT OLDER-INTRO
	CRLF
?L35:	IN? SPELL-BOOK,OLDER-SELF \?L40
	MOVE SPELL-BOOK,YOUNGER-SELF
	FSET SPELL-BOOK,TRYTAKEBIT
	MOVE OLDER-SELF,DIAL
	MOVE VARDIK-SCROLL,DIAL
	SET 'TWIN-FOLLOW,1
	CALL QUEUE,I-TWIN-UNFOLLOW,1 >STACK
	PUT STACK,0,1
	CRLF
	PRINTR "Your look-alike dives into the lower chute and slides out of view."
?L40:	ZERO? COMBO-DISCOVERED \?L44
	CRLF
	CALL OLDER-TELLS-COMBO
	CRLF
	RTRUE
?L44:	CRLF
	PRINTR """Give me...the spell book,"" croaks your older self."
?L33:	MOVE OLDER-SELF,DIAL
	MOVE VARDIK-SCROLL,DIAL
	CRLF
	PRINTR "Someone in the coal bin room dives into the lower chute."
?L32:	CALL DATA-TO-TABLE,MOVE-THREE-TABLE
	CALL INT,I-OLDER-SELF >STACK
	PUT STACK,0,0
	EQUAL? HERE,COAL-BIN-ROOM \?L52
	IN? OLDER-SELF,HERE \?L52
	CRLF
	PRINTI "Your older self dives into the lower chute."
	CRLF
?L52:	MOVE OLDER-SELF,DIAL
	MOVE VARDIK-SCROLL,DIAL
	RTRUE

	.FUNCT OLDER-TELLS-COMBO
	PRINTI "Your disheveled ""twin"" is having difficulty breathing, but gasps, ""The combination is "
	PRINTN COMBO
	PRINTI "."""
	RTRUE

	.FUNCT I-TWIN-UNFOLLOW
	SET 'TWIN-FOLLOW,0
	RFALSE

	.FUNCT DATA-TO-TABLE,TABLE
	PUT TABLE,1,PRSA
	PUT TABLE,2,PRSO
	PUT TABLE,3,PRSI
	RTRUE

	.FUNCT YOUNGER-SELF-F
	EQUAL? YOUNGER-SELF,WINNER \?L1
	EQUAL? PRSA,V?COMBO \?L3
	EQUAL? PRSO,INTNUM \?L3
	EQUAL? P-NUMBER,COMBO \?L5
	SET 'COMBO-REVEALED,1
?L5:	PRINTR "Your younger self seems surprised by your statement."
?L3:	EQUAL? PRSA,V?GIVE \?L10
	EQUAL? PRSO,SPELL-BOOK \?L10
	EQUAL? PRSI,ME \?L10
	CALL SPELL-BOOK-PASS-OFF-CHECK >STACK
	ZERO? STACK \TRUE
?L10:	PRINTI "Your younger self seems confused, and doesn't respond."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?YOMIN \?L14
	PRINTR "The thoughts of your younger self are confused, and seem to center on whether or not to perform a SAVE."
?L14:	EQUAL? PRSA,V?AIMFIZ \?L17
	CALL V-SWANZO >STACK
	RSTACK
?L17:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "It's almost like looking in a mirror. Your younger self looks confused"
	IN? SPELL-BOOK,YOUNGER-SELF \?L21
	PRINTI ", and is carrying a spell book"
?L21:	PRINTR "."

	.FUNCT YOUNGER-SELF-DESCFCN,TABLE
	LESS? YOUNGER-COUNTER,3 \?L1
	SET 'TABLE,MOVE-ONE-TABLE
	JUMP ?L4
?L1:	EQUAL? YOUNGER-COUNTER,3 \?L3
	SET 'TABLE,MOVE-TWO-TABLE
	JUMP ?L4
?L3:	SET 'TABLE,MOVE-THREE-TABLE
?L4:	FSET? YOUNGER-SELF,TOUCHBIT \?L5
	PRINTI "Your younger self is here"
	ZERO? YOUNGER-HAS-SPELL-BOOK /?L9
	PRINTR ", holding your spell book."
?L9:	PRINTR "."
?L5:	FSET YOUNGER-SELF,TOUCHBIT
	PRINTI "Standing here, looking quite confused, is someone who could only be your younger self -- an exact duplicate of you, but cleaner and breathing with considerably less difficulty. You remember seeing this scene from another viewpoint just a short while ago."
	ZERO? YOUNGER-HAS-SPELL-BOOK /?L19
	PRINTI " Among the items carried by your ""twin"" is your spell book."
?L19:	CRLF
	RTRUE

	.FUNCT SPELL-BOOK-PASS-OFF-CHECK,TABLE
	EQUAL? YOUNGER-COUNTER,1 \?L1
	SET 'TABLE,MOVE-ONE-TABLE
	JUMP ?L5
?L1:	EQUAL? YOUNGER-COUNTER,2 \?L3
	SET 'TABLE,MOVE-TWO-TABLE
	JUMP ?L5
?L3:	EQUAL? YOUNGER-COUNTER,3 \FALSE
	SET 'TABLE,MOVE-THREE-TABLE
?L5:	GET TABLE,2 >STACK
	EQUAL? STACK,SPELL-BOOK \?L9
	GET TABLE,3 >STACK
	EQUAL? STACK,OLDER-SELF \?L9
	GET TABLE,1 >STACK
	EQUAL? STACK,V?GIVE /TRUE
?L9:	GET TABLE,2 >STACK
	EQUAL? STACK,OLDER-SELF \FALSE
	GET TABLE,3 >STACK
	EQUAL? STACK,SPELL-BOOK \FALSE
	GET TABLE,1 >STACK
	EQUAL? STACK,V?SGIVE \FALSE
	RTRUE

	.FUNCT I-YOUNGER-SELF
	INC 'YOUNGER-COUNTER
	IN? YOUNGER-SELF,HERE \FALSE
	ZERO? LIT \?L3
	ZERO? BLORTED /FALSE
?L3:	EQUAL? YOUNGER-COUNTER,2 \?L4
	CALL YOUNGER-ACTIONS,MOVE-ONE-TABLE >STACK
	RSTACK
?L4:	EQUAL? YOUNGER-COUNTER,3 \?L5
	CALL YOUNGER-ACTIONS,MOVE-TWO-TABLE >STACK
	RSTACK
?L5:	EQUAL? YOUNGER-COUNTER,4 \FALSE
	CALL YOUNGER-ACTIONS,MOVE-THREE-TABLE >STACK
	RSTACK

	.FUNCT YOUNGER-ACTIONS,TABLE
	GET TABLE,2 >STACK
	ZERO? STACK \?L1
	PUT TABLE,2,NOT-HERE-OBJECT
?L1:	GET TABLE,3 >STACK
	ZERO? STACK \?L4
	PUT TABLE,3,NOT-HERE-OBJECT
?L4:	GET TABLE,2 >STACK
	EQUAL? STACK,OLDER-SELF \?L7
	PUT TABLE,2,YOU-OBJECT
	JUMP ?L9
?L7:	GET TABLE,2 >STACK
	EQUAL? STACK,ME \?L9
	PUT TABLE,2,YOUNGER-SELF
?L9:	GET TABLE,3 >STACK
	EQUAL? STACK,OLDER-SELF \?L11
	PUT TABLE,3,YOU-OBJECT
	JUMP ?L13
?L11:	GET TABLE,3 >STACK
	EQUAL? STACK,ME \?L13
	PUT TABLE,3,YOUNGER-SELF
?L13:	CRLF
	PRINTI "Your younger self "
	GET TABLE,2 >STACK
	EQUAL? STACK,SPELL-BOOK \?L20
	GET TABLE,3 >STACK
	EQUAL? STACK,YOU-OBJECT \?L20
	GET TABLE,1 >STACK
	EQUAL? STACK,V?GIVE /?L19
?L20:	GET TABLE,2 >STACK
	EQUAL? STACK,YOU-OBJECT \?L17
	GET TABLE,3 >STACK
	EQUAL? STACK,SPELL-BOOK \?L17
	GET TABLE,1 >STACK
	EQUAL? STACK,V?SGIVE \?L17
?L19:	MOVE SPELL-BOOK,PROTAGONIST
	FCLEAR SPELL-BOOK,TRYTAKEBIT
	PRINTR "hands you your spell book!"
?L17:	GET TABLE,1 >STACK
	EQUAL? STACK,V?VERBOSE,V?BRIEF,V?SUPER-BRIEF /?L24
	GET TABLE,1 >STACK
	EQUAL? STACK,V?SCORE,V?SCRIPT,V?UNSCRIPT \?L23
?L24:	PRINTR "is performing a spell of high technology."
?L23:	GET TABLE,1 >STACK
	EQUAL? STACK,V?ANSWER,V?REPLY,V?CURSE /?L28
	GET TABLE,1 >STACK
	EQUAL? STACK,V?HELLO,V?TELL,V?ASK-FOR /?L28
	GET TABLE,1 >STACK
	EQUAL? STACK,V?SAY,V?THANK,V?YELL /?L28
	GET TABLE,1 >STACK
	EQUAL? STACK,V?ASK-ABOUT \?L27
?L28:	PRINTR "is attempting to talk."
?L27:	GET TABLE,1 >STACK
	EQUAL? STACK,V?CAST,V?GNUSTO,V?FROTZ /?L32
	GET TABLE,1 >STACK
	EQUAL? STACK,V?REZROV,V?IZYUK,V?FWEEP /?L32
	GET TABLE,1 >STACK
	EQUAL? STACK,V?AIMFIZ,V?SWANZO,V?VARDIK /?L32
	GET TABLE,1 >STACK
	EQUAL? STACK,V?MEEF,V?PULVER,V?GOLMAC /?L32
	GET TABLE,1 >STACK
	EQUAL? STACK,V?YOMIN,V?VEZZA,V?GASPAR /?L32
	GET TABLE,1 >STACK
	EQUAL? STACK,V?YONK,V?MALYON \?L31
?L32:	PRINTR "is casting a familiar spell."
?L31:	GET TABLE,1 >STACK
	EQUAL? STACK,V?INVENTORY \?L35
	PRINTR "is doing an inventory."
?L35:	GET TABLE,1 >STACK
	EQUAL? STACK,V?DIAGNOSE \?L38
	PRINTR "is checking for wounds."
?L38:	GET TABLE,1 >STACK
	EQUAL? STACK,V?WAIT \?L41
	PRINTR "is doing absolutely nothing."
?L41:	GET TABLE,1 >STACK
	EQUAL? STACK,V?SLEEP \?L44
	PRINTR "is trying to fall asleep!"
?L44:	GET TABLE,1 >STACK
	EQUAL? STACK,V?LEARN \?L47
	PRINTR "is studying a spell book."
?L47:	GET TABLE,1 >STACK
	EQUAL? STACK,V?SPELLS \?L50
	PRINTR "seems lost in thought."
?L50:	GET TABLE,1 >STACK
	EQUAL? STACK,V?LOOK \?L53
	PRINTR "is looking around."
?L53:	GET TABLE,1 >STACK
	EQUAL? STACK,V?LEAP,V?SKIP \?L56
	PRINTR "is hopping around like a crazed rabbit."
?L56:	GET TABLE,1 >STACK
	EQUAL? STACK,V?WALK,V?WALK-AROUND,V?WALK-TO \?L59
	PRINTR "is moving around."
?L59:	GET TABLE,1 >STACK
	EQUAL? STACK,V?GIVE \?L62
	PRINTI "is trying to give"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTI " to"
	GET TABLE,3 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L62:	GET TABLE,1 >STACK
	EQUAL? STACK,V?SHOW \?L69
	PRINTI "is trying to show"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTI " to"
	GET TABLE,3 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L69:	GET TABLE,1 >STACK
	EQUAL? STACK,V?RAISE,V?LOWER,V?RUB /?L77
	GET TABLE,1 >STACK
	EQUAL? STACK,V?MOVE,V?SHAKE,V?PUSH /?L77
	GET TABLE,1 >STACK
	EQUAL? STACK,V?KICK,V?PUT-ON,V?PUSH-TO /?L77
	GET TABLE,1 >STACK
	EQUAL? STACK,V?PUT,V?PUT-UNDER,V?PUT-BEHIND \?L76
?L77:	GET TABLE,1 >STACK
	EQUAL? STACK,V?PUT \?L78
	GET TABLE,2 >STACK
	EQUAL? STACK,SPELL-BOOK \?L78
	GET TABLE,3 >STACK
	EQUAL? STACK,LOWER-CHUTE \?L78
	MOVE SPELL-BOOK,DIAL
?L78:	PRINTI "is attempting to move"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L76:	GET TABLE,1 >STACK
	EQUAL? STACK,V?EXAMINE,V?LOOK-INSIDE /?L86
	GET TABLE,1 >STACK
	EQUAL? STACK,V?LOOK-BEHIND,V?LOOK-UNDER \?L85
?L86:	PRINTI "is examining"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L85:	GET TABLE,1 >STACK
	EQUAL? STACK,V?BOARD,V?ENTER,V?THROUGH \?L91
	PRINTI "is trying to get into"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L91:	GET TABLE,1 >STACK
	EQUAL? STACK,V?THROW,V?THROW-OFF \?L96
	PRINTI "is performing aeronautical experiments with"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L96:	GET TABLE,1 >STACK
	EQUAL? STACK,V?WHAT,V?WHERE,V?WHO \?L101
	PRINTI "is asking about"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR ", addressing the question to no one in particular."
?L101:	GET TABLE,1 >STACK
	EQUAL? STACK,V?ATTACK,V?KILL,V?MUNG \?L106
	PRINTI "is attacking"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK,1
	PRINTR "."
?L106:	GET TABLE,1 >STACK
	EQUAL? STACK,V?EAT,V?DRINK \?L111
	PRINTI "is attempting to ingest"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L111:	GET TABLE,1 >STACK
	EQUAL? STACK,V?CLIMB-ON,V?CLIMB-UP,V?CLIMB-FOO /?L117
	GET TABLE,1 >STACK
	EQUAL? STACK,V?CLIMB-DOWN,V?CLIMB-OVER \?L116
?L117:	PRINTI "is climbing"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK,1
	PRINTR "."
?L116:	GET TABLE,1 >STACK
	EQUAL? STACK,V?READ \?L122
	PRINTI "is reading"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L122:	GET TABLE,1 >STACK
	EQUAL? STACK,V?SMELL \?L127
	PRINTI "is smelling"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L127:	GET TABLE,1 >STACK
	EQUAL? STACK,V?LISTEN \?L132
	PRINTI "seems to be listening to"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L132:	GET TABLE,1 >STACK
	EQUAL? STACK,V?KISS \?L137
	PRINTI "tries to kiss"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L137:	GET TABLE,1 >STACK
	EQUAL? STACK,V?OPEN \?L142
	PRINTI "is trying to open"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L142:	GET TABLE,1 >STACK
	EQUAL? STACK,V?CLOSE \?L147
	PRINTI "is closing"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L147:	GET TABLE,1 >STACK
	EQUAL? STACK,V?EXIT,V?DISEMBARK \?L152
	PRINTI "is trying to leave"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L152:	GET TABLE,1 >STACK
	EQUAL? STACK,V?TAKE \?L157
	PRINTI "is reaching for"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L157:	GET TABLE,1 >STACK
	EQUAL? STACK,V?DROP \?L162
	PRINTI "is dropping"
	GET TABLE,2 >STACK
	CALL ARTICLE,STACK
	PRINTR "."
?L162:	PRINTR "is doing something."

	.FUNCT LAMP-PSEUDO
	EQUAL? PRSA,V?TAKE \FALSE
	CALL PERFORM,V?TAKE,KEROSENE-LAMP
	RTRUE

	.FUNCT DIAL-DOOR-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? DIAL-DOOR,OPENBIT /?L1
	ZERO? DIAL-OPEN /?L3
	FSET DIAL-DOOR,OPENBIT
	ADD SCORE,COAL-DOOR-POINT >SCORE
	SET 'COAL-DOOR-POINT,0
	PRINTR "The door opens easily."
?L3:	PRINTR "The door won't budge."
?L1:	EQUAL? PRSA,V?EXAMINE \?L10
	CALL PERFORM,V?EXAMINE,DIAL
	RTRUE
?L10:	EQUAL? PRSA,V?REZROV \FALSE
	CALL PRINT-ID,STR?209
	CALL JIGS-UP,STR?210 >STACK
	RSTACK

	.FUNCT DIAL-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTI "Set in the door is a large circular dial which can be set to any number up to 873. It is currently set to "
	PRINTN CURRENT-SETTING
	PRINTR "."
?L1:	EQUAL? PRSA,V?TURN \FALSE
	ZERO? FWEEPED /?L6
	CALL BATTY >STACK
	RSTACK
?L6:	ZERO? PRSI /?L9
	EQUAL? PRSI,INTNUM /?L8
?L9:	PRINTR "You must say what number to turn it to."
?L8:	EQUAL? CURRENT-SETTING,P-NUMBER \?L12
	PRINTI "The dial is already set to "
	PRINTN CURRENT-SETTING
	PRINTR "."
?L12:	SET 'CURRENT-SETTING,P-NUMBER
	PRINTI "The dial is now set to "
	PRINTN CURRENT-SETTING
	PRINTI "."
	EQUAL? CURRENT-SETTING,COMBO \?L18
	PRINTI " You hear a click from inside the door."
	SET 'DIAL-OPEN,1
?L18:	CRLF
	RTRUE

	.FUNCT ROPE-F
	EQUAL? PRSA,V?PUT \?L1
	CALL ACCESSIBLE?,ROPE >STACK
	ZERO? STACK /FALSE
?L1:	EQUAL? PRSA,V?TIE \?L13
	EQUAL? PRSI,BEAM \?L3
	PRINTI "The rope is "
	ZERO? ROPE-TO-BEAM /?L6
	PRINTI "already "
?L6:	PRINTI "tied securely to the center of the beam."
	CRLF
	SET 'ROPE-TO-BEAM,1
	RETURN ROPE-TO-BEAM
?L3:	EQUAL? PRSA,V?TIE \?L13
	EQUAL? PRSI,COAL-BIN \?L13
	PRINTR "The bin is too large."
?L13:	EQUAL? PRSA,V?UNTIE \?L16
	ZERO? ROPE-TO-BEAM /?L16
	SET 'ROPE-TO-BEAM,0
	PRINTR "The rope is untied."
?L16:	EQUAL? PRSA,V?CLIMB-DOWN \?L19
	ZERO? ROPE-PLACED \?L20
	ZERO? ROPE-IN-LOWER-CHUTE \?L20
	PRINTR "It would be hard to climb down the rope in its current state."
?L20:	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?CLIMB-UP \?L25
	PRINTR "Do you also charm snakes?"
?L25:	EQUAL? PRSA,V?EXAMINE \FALSE
	ZERO? ROPE-PLACED \?L31
	ZERO? ROPE-IN-LOWER-CHUTE /?L29
?L31:	PRINTR "The rope is tied to the beam and hangs into the chute."
?L29:	ZERO? ROPE-TO-BEAM /FALSE
	PRINTR "It is tied to the center of the timber."

	.FUNCT SHAFT-BOTTOM-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FSET? VARDIK-SCROLL,TOUCHBIT \FALSE
	SET 'BREATH-SHORTAGE,3
	CALL I-BREATHE >STACK
	RSTACK

	.FUNCT SHAFT-PSEUDO
	EQUAL? PRSA,V?CLIMB-DOWN \?L1
	EQUAL? HERE,SHAFT-TOP \?L3
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L3:	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-FOO \?L6
	EQUAL? HERE,SHAFT-TOP \?L7
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L7:	CALL DO-WALK,P?UP >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?PUT-ON \?L10
	EQUAL? PRSO,BEAM \?L10
	PRINTR "The shaft is too wide."
?L10:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? HERE,SHAFT-TOP \FALSE
	EQUAL? PRSO,ROPE \?L14
	ZERO? ROPE-TO-BEAM /?L14
	PRINTR "The rope now dangles into the shaft."
?L14:	MOVE PRSO,SHAFT-BOTTOM
	PRINTR "It disappears into the shaft. A moment later comes a distant thud."

	.FUNCT BEAM-F
	EQUAL? PRSA,V?PUT-ON \?L1
	EQUAL? PRSI,UPPER-CHUTE,LOWER-CHUTE \?L1
	MOVE BEAM,HERE
	PRINTR "The beam is now lying across the mouth of the chute."
?L1:	EQUAL? PRSA,V?TAKE \?L5
	ZERO? ROPE-PLACED /?L5
	PRINTR "You'd have to take the rope out of the chute first."
?L5:	EQUAL? PRSA,V?EXAMINE \FALSE
	ZERO? ROPE-PLACED /?L9
	PRINTR "A rope hangs from the beam, into the chute."
?L9:	ZERO? ROPE-TO-BEAM /FALSE
	PRINTR "A rope is tied to the beam."

	.FUNCT TOP-OF-CHUTE-F,RARG
	EQUAL? RARG,M-END \FALSE
	IN? TROGLODYTE,HERE /FALSE
	ZERO? LIT \?L3
	ZERO? BLORTED /FALSE
?L3:	RANDOM 100 >STACK
	LESS? 30,STACK /FALSE
	MOVE TROGLODYTE,HERE
	CALL QUEUE,I-TROGLODYTE,2 >STACK
	PUT STACK,0,1
	CRLF
	PRINTR "A troglodyte trundles in and dumps a load of coal into the chute."

	.FUNCT I-TROGLODYTE
	MOVE TROGLODYTE,DIAL
	EQUAL? HERE,TOP-OF-CHUTE \FALSE
	SET 'TROG-FOLLOW,1
	CALL QUEUE,I-TROG-UNFOLLOW,1 >STACK
	PUT STACK,0,1
	CRLF
	PRINTR "The troglodyte trundles off into the coal mine."

	.FUNCT I-TROG-UNFOLLOW
	SET 'TROG-FOLLOW,0
	RFALSE

	.FUNCT TROGLODYTE-F
	EQUAL? WINNER,TROGLODYTE \?L1
	PRINTI "The troglodyte ignores you."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?FOLLOW \?L5
	ZERO? TROG-FOLLOW /?L5
	PRINTR "You didn't notice which passage it took."
?L5:	EQUAL? PRSA,V?YOMIN \?L8
	PRINTR "The troglodyte is worried about filling his coal quotas."
?L8:	EQUAL? PRSA,V?RESEARCH \FALSE
	PRINTR "Semi-intelligent subterranean beasts frequently used to dig and haul coal."

	.FUNCT CHUTE-EXIT-F
	ZERO? ROPE-PLACED /?L1
	PRINTI "You climb carefully down the rope, which is slippery with coal dust, "
	GRTR? AWAKE,0 \?L5
	PRINTI "but because of your fatigue you lose your grip."
	CALL ORANGE-FLASH
	CRLF
	CRLF
	RETURN COAL-BIN-ROOM
?L5:	CALL NOTHING-HELD? >STACK
	ZERO? STACK \?L9
	PRINTI "but because of your load you are unable to maintain your grip."
	CALL ORANGE-FLASH
	CRLF
	CRLF
	RETURN COAL-BIN-ROOM
?L9:	PRINTI "and soon reach a small opening off the chute. You clamber inside..."
	CRLF
	CRLF
	ADD SCORE,20 >SCORE
	FCLEAR VARDIK-SPELL,INVISIBLE
	RETURN SLANTED-ROOM
?L1:	CALL ROPE-BEAM-CHECK,1
	PRINTI "Wheee!!! "
	CALL ORANGE-FLASH
	PRINTI " You land beside an enormous bin of coal."
	CRLF
	CRLF
	RETURN COAL-BIN-ROOM

	.FUNCT ORANGE-FLASH
	PRINTI " As you "
	ZERO? FLYING /?L3
	PRINTI "float"
	JUMP ?L7
?L3:	PRINTI "whiz"
?L7:	PRINTI " down the chute, you notice a flash of orange light spilling from an opening onto the chute."
	RTRUE

	.FUNCT SLANTED-ROOM-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUT VEZZAS,6,0
	RTRUE

	.FUNCT SLANTED-ROOM-EXIT-F
	IN? GOLMAC-SCROLL,PROTAGONIST /?L7
	ZERO? GOLMACKED \?L1
	CALL POOF
	RFALSE
?L1:	IN? GOLMAC-SCROLL,PROTAGONIST \?L3
?L7:	ZERO? GOLMACKED /?L3
	CALL POOF
	RFALSE
?L3:	PRINTI "Wheeee!!!"
	CRLF
	CRLF
	RETURN COAL-BIN-ROOM

	.FUNCT KEROSENE-LAMP-DESCFCN,RARG
	PRINTI "Mounted securely to the wall is a kerosene lamp, filling the room with a serene orange glow. "
	FSET? KEROSENE-LAMP,OPENBIT \?L3
	PRINTI "A small compartment at its base is open."
?L3:	CRLF
	RTRUE

	.FUNCT KEROSENE-LAMP-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The lamp has a glass bowl where the flame burns. Below is a small metal door, perhaps a compartment for storing extra wicks or kerosene."
?L1:	EQUAL? PRSA,V?TAKE \?L5
	PRINTR "It's mounted securely to the wall."
?L5:	EQUAL? PRSA,V?LAMP-OFF \FALSE
	PRINTR "You can't spare the breath to blow out the lamp."

	.FUNCT CHUTE-ENTER-F
	ZERO? FLYING /?L1
	PRINTI "The chute is too narrow to fly up."
	JUMP ?L5
?L1:	PRINTI "The chute is too steep and slippery."
?L5:	CRLF
	RFALSE

	.FUNCT BOTTOM-TOP-OF-CHUTE,TOP=0
	PRINTI "You're already at the "
	ZERO? TOP /?L3
	PRINTI "top"
	JUMP ?L7
?L3:	PRINTI "bottom"
?L7:	PRINTR " of the chute."

	.FUNCT COVE-F,RARG,X=0
	EQUAL? RARG,M-ENTER \FALSE
	FSET? COVE,TOUCHBIT /FALSE
	ZERO? BOOK-BELONGS-IN-LAGOON /?L3
	MOVE SPELL-BOOK,LAGOON-FLOOR
?L3:	PUT VEZZAS,6,0
	ADD SCORE,20 >SCORE
	CALL INT,I-SUFFOCATE >STACK
	PUT STACK,0,0
	CALL INT,I-YOUNGER-SELF >STACK
	PUT STACK,0,0
	CALL INT,I-OLDER-SELF >STACK
	PUT STACK,0,0
	ZERO? GOLMACKED /?L30
	ZERO? COMBO-REVEALED \?L6
	CALL POOF
	JUMP ?L21
?L6:	ZERO? GOLMACKED \?L21
?L30:	CALL HELD?,ROPE >STACK
	ZERO? STACK /?L9
	MOVE ROPE,DIAL
	SET 'X,1
?L9:	CALL HELD?,BEAM >STACK
	ZERO? STACK /?L12
	MOVE BEAM,DIAL
	SET 'X,1
?L12:	CALL HELD?,VARDIK-SCROLL >STACK
	ZERO? STACK /?L15
	MOVE VARDIK-SCROLL,DIAL
	SET 'X,1
?L15:	CALL HELD?,GOLMAC-SCROLL >STACK
	ZERO? STACK /?L18
	MOVE GOLMAC-SCROLL,DIAL
	SET 'X,1
?L18:	ZERO? X /?L21
	PRINTI "As you slide down the chute, some of your possessions suddenly vanish! "
?L21:	PRINTI "You fly out of the chute and land just at the edge of some water..."
	CRLF
	CRLF
	RTRUE

	.FUNCT POOF
	SET 'POOFED,1
	PRINTI "Suddenly, without the slightest fanfare, you cease to exist!"
	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT OCEAN-SHORE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are "
	ZERO? FLYING /?L5
	PRINTI "floating above"
	JUMP ?L9
?L5:	PRINTI "standing on"
?L9:	PRINTI " the western shore of the mighty Flathead Ocean. According to legends you read at the University, the eastern shore of this ocean is a strange land of magical beings and priceless treasures. "
	EQUAL? HERE,OCEAN-NORTH \?L14
	PRINTR "You could go north along the shore; the edge of a small cove lies to the southwest."
?L14:	PRINTR "The beach to the south is blocked by a tall cliff; a lagoon shore lies to the northwest."

	.FUNCT OCEAN-F,X=0
	EQUAL? HERE,GUN-EMPLACEMENT,TURRET,TOP-OF-FALLS \?L1
	PRINTR "The ocean lies far below you."
?L1:	EQUAL? PRSA,V?PULVER \?L5
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,V?PULVER,LAGOON-OBJECT
	RTRUE
?L5:	EQUAL? PRSA,V?DRINK-FROM,V?DRINK \?L6
	CALL PERFORM,V?DRINK,WATER
	RTRUE
?L6:	EQUAL? PRSA,V?EXAMINE \?L7
	PRINTR "It streches east as far as the eye can see."
?L7:	EQUAL? PRSA,V?RESEARCH \?L10
	PRINTR "The Flathead Ocean, called the Great Sea by the ancients, has a very unusual feature -- its western shore basks in the sunlight while its eastern shore lies far underground."
?L10:	EQUAL? PRSA,V?PUT \?L13
	EQUAL? OCEAN,PRSI \?L13
	MOVE PRSO,DIAL
	CALL SPLASH >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?THROUGH \FALSE
	CALL PRINT-ID,STR?211
	CALL JIGS-UP,STR?212 >STACK
	RSTACK

	.FUNCT CLIFF-PSEUDO
	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-UP \FALSE
	ZERO? FLYING /?L3
	PRINTR "The cliff is too high to fly over."
?L3:	PRINTR "The cliff is unclimbable."

	.FUNCT LAGOON-OBJECT-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,LAGOON,LAGOON-FLOOR \?L3
	CALL LOOK-AROUND-YOU >STACK
	RSTACK
?L3:	CALL GOTO,LAGOON >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUT \?L6
	EQUAL? HERE,LAGOON-FLOOR /?L6
	EQUAL? PRSI,LAGOON-OBJECT \?L6
	MOVE PRSO,LAGOON-FLOOR
	FSET? PRSO,SCROLLBIT /?L9
	EQUAL? PRSO,SPELL-BOOK \?L7
?L9:	FSET PRSO,MUNGBIT
?L7:	CALL SPLASH >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?EXAMINE \?L11
	PRINTR "The water looks calm and hospitable."
?L11:	EQUAL? PRSA,V?DRINK-FROM,V?DRINK \?L14
	CALL PERFORM,V?DRINK,WATER
	RTRUE
?L14:	EQUAL? PRSA,V?PULVER \FALSE
	PRINTR "The water level seems to drop an inch or two, for a moment."

	.FUNCT LAGOON-F,RARG,X
	EQUAL? RARG,M-ENTER \?L1
	FIRST? PROTAGONIST >X \TRUE
?L27:	FSET? X,SCROLLBIT /?L10
	EQUAL? X,SPELL-BOOK \?L8
?L10:	FSET X,MUNGBIT
?L8:	NEXT? X >X /?L27
	RTRUE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are "
	ZERO? FLYING /?L17
	PRINTI "flying over"
	JUMP ?L21
?L17:	PRINTI "swimming on"
?L21:	PRINTR " the surface of a calm lagoon, whose sandy floor is visible below. A curved beach surrounds this inlet on its western side."

	.FUNCT LAGOON-FLOOR-ENTER-F
	ZERO? FLYING /?L1
	CALL WHILE-FLYING
	RFALSE
?L1:	RETURN LAGOON-FLOOR

	.FUNCT SAND-PSEUDO
	EQUAL? PSEUDO-OBJECT,PRSO \?L1
	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,GROUND,PRSI
	RTRUE
?L1:	SET 'PERFORMING-SPELL,1
	CALL PERFORM,PRSA,PRSO,GROUND
	RTRUE

	.FUNCT LAGOON-FLOOR-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	CALL QUEUE,I-DROWN,-1 >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT I-DROWN
	EQUAL? HERE,LAGOON-FLOOR \?L1
	ZERO? VILSTUED \FALSE
	INC 'UNDERWATER-COUNTER
	EQUAL? UNDERWATER-COUNTER,3 \?L6
	CRLF
	PRINTR "You won't be able to hold your breath much longer."
?L6:	EQUAL? UNDERWATER-COUNTER,4 \?L10
	CRLF
	PRINTR "Better get some fresh air soon!"
?L10:	EQUAL? UNDERWATER-COUNTER,5 \FALSE
	SET 'UNDERWATER-COUNTER,0
	CRLF
	CALL PRINT-ID,STR?213
	CALL JIGS-UP,STR?214 >STACK
	RSTACK
?L1:	SET 'UNDERWATER-COUNTER,0
	CALL INT,I-DROWN >STACK
	PUT STACK,0,0
	RFALSE

	.FUNCT CORAL-PSEUDO
	EQUAL? PRSA,V?EXAMINE \FALSE
	IN? HERE,SPENSEWEEDS \FALSE
	PRINTR "The coral is covered by swaying spenseweeds."

	.FUNCT SPENSEWEEDS-F
	EQUAL? PRSA,V?MEEF \?L1
	MOVE SPENSEWEEDS,DIAL
	MOVE CRATE,HERE
	CALL THIS-IS-IT,CRATE
	PRINTR "The spenseweeds wilt away, revealing a wooden crate labelled with black lettering."
?L1:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	PRINTR "That's difficult -- they're well rooted in the coral."

	.FUNCT CRATE-F
	EQUAL? PRSA,V?REZROV,V?OPEN \?L1
	ZERO? CRATE-POINT \?L1
	SET 'CRATE-POINT,1
	ADD SCORE,15 >SCORE
	RFALSE
?L1:	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI "Stencilled diagonally across the crate:

    GRUE PROTECTION KIT

Below, in much smaller letters:

    FROM:
    Frobozz Magic Grue Accessories Co.

    TO:
    Aragain Brothers Circus
    Attn: Grue Trainer"
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT BRASS-LANTERN-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "It is a battery-powered lantern like those used by adventurers and explorers. It is currently "
	FSET? BRASS-LANTERN,ONBIT \?L5
	PRINTI "on"
	JUMP ?L9
?L5:	PRINTI "off"
?L9:	PRINTR "."

	.FUNCT GRUE-REPELLENT-F
	EQUAL? PRSA,V?SHAKE \?L1
	ZERO? SPRAY-USED? /?L3
	PRINTR "The can seems empty."
?L3:	PRINTR "There is a sloshing sound from inside."
?L1:	EQUAL? PRSA,V?PUT-ON,V?SPRAY \FALSE
	EQUAL? PRSO,GRUE-REPELLENT \FALSE
	ZERO? SPRAY-USED? /?L11
	PRINTR "The repellent is all gone."
?L11:	ZERO? PRSI \?L15
	SET 'SPRAY-USED?,1
	PRINTR "The spray stinks amazingly for a few moments, then drifts away."
?L15:	EQUAL? PRSI,ME \?L19
	CALL QUEUE,I-SPRAY,5 >STACK
	PUT STACK,0,1
	SET 'SPRAYED?,1
?L19:	SET 'SPRAY-USED?,1
	PRINTR "The spray smells like a mixture of old socks and burning rubber. If I were a grue I'd sure stay clear!"

	.FUNCT I-SPRAY
	SET 'SPRAYED?,0
	CRLF
	PRINTR "That horrible smell is much less pungent now."

	.FUNCT MOUTH-OF-RIVER-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "A mighty river spills into the ocean here. Looking up the river valley, you see a tall waterfall. Atop a cliff, high above you, is the rampart of a fortress. A cave entrance "
	IN? VINES,HERE \?L5
	PRINTI "at the base of the cliff to the west is blocked by writhing green vines"
	JUMP ?L9
?L5:	PRINTI "lies to the west"
?L9:	PRINTR "."
?L1:	EQUAL? RARG,M-END \FALSE
	IN? VINES,HERE \FALSE
	RANDOM 100 >STACK
	LESS? 15,STACK /FALSE
	CRLF
	PRINTI "Suddenly you realize that, without really thinking about it, you were "
	ZERO? FLYING /?L17
	PRINTI "flying"
	JUMP ?L21
?L17:	PRINTI "walking"
?L21:	PRINTR " toward the wriggling vines. As you stop, a feeling of annoyance seems to radiate from the plants."

	.FUNCT VINES-F
	EQUAL? PRSA,V?MEEF \?L1
	MOVE VINES,DIAL
	PRINTI "You can almost feel a wave of pain from the vines as they shrivel away."
	CRLF
	CALL PRINT-ID,STR?215 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?KILL,V?ATTACK \?L5
	CALL PRINT-ID,STR?216
	CALL JIGS-UP,STR?217 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?BITE,V?KICK,V?THROUGH /?L7
	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-UP,V?TAKE /?L7
	EQUAL? PRSA,V?RUB,V?MOVE,V?PUSH \FALSE
?L7:	CALL DO-WALK,P?WEST >STACK
	RSTACK

	.FUNCT VINES-EXIT-F
	IN? VINES,HERE \?L1
	CALL PRINT-ID,STR?218
	CALL JIGS-UP,STR?219
	RFALSE
?L1:	RETURN GRUE-LAIR

	.FUNCT GRUE-LAIR-F,RARG
	ZERO? SPRAYED? \FALSE
	EQUAL? RARG,M-END \FALSE
	IN? GRUE-SUIT,PROTAGONIST /FALSE
	ZERO? LIT \?L5
	ZERO? BLORTED /?L3
?L5:	CALL PRINT-ID,STR?220
	CALL JIGS-UP,STR?221 >STACK
	RSTACK
?L3:	CALL PRINT-ID,STR?222
	CALL JIGS-UP,STR?223 >STACK
	RSTACK

	.FUNCT MUTATED-GRUES-F
	EQUAL? PRSA,V?FROTZ \?L1
	PRINTR "One of the grues gives off a flash of light but, strangely, it doesn't seem to notice or care."
?L1:	EQUAL? PRSA,V?RESEARCH \FALSE
	CALL PERFORM,V?RESEARCH,GRUE
	RTRUE

	.FUNCT MUTATED-GRUES-DESCFCN,RARG
	ZERO? LIT \?L3
	ZERO? BLORTED /?L1
?L3:	ZERO? SPRAYED? /?L4
	CALL LIT-MESSAGE
	PRINTI "They stagger about the room, covering their noses and making horrid gurgling noises."
	CRLF
	CALL PRINT-ID,STR?224 >STACK
	RSTACK
?L4:	IN? GRUE-SUIT,PROTAGONIST \?L8
	CALL LIT-MESSAGE
	PRINTR "They seem to be ignoring you, aside from a few suspicious gurgles in your direction."
?L8:	CALL LIT-MESSAGE
	PRINTR "Baring tremendous fangs, they form a circle around you..."
?L1:	PRINTR "There are terrifying gurgling noises from the darkness!"

	.FUNCT LIT-MESSAGE
	PRINTI "A pack of grues fills the room! "
	ZERO? LIT /FALSE
	PRINTI "The grues, contrary to all conventional wisdom, aren't bothered by your light in the least. They must be mutated grues, no longer fearing light! "
	RTRUE

	.FUNCT MAMMOTH-CAVERN-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	ADD SCORE,CAVERN-POINT >SCORE
	SET 'CAVERN-POINT,0
	PUT VEZZAS,7,0
	RTRUE

	.FUNCT MACHINERY-F
	EQUAL? PRSA,V?LAMP-ON,V?MUNG \?L1
	CALL PRINT-ID,STR?225
	CALL JIGS-UP,STR?226 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	PRINTR "You notice, on one machine, a tiny plaque which reads:

FROBOZZ MAGIC MUTATED GRUE BREEDER CO."

	.FUNCT CHAMBER-OF-LIVING-DEATH-F,RARG
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?VERSION,V?SAVE,V?QUIT /?L1
	EQUAL? PRSA,V?RESTART,V?RESTORE,V?SUPER-BRIEF /?L1
	EQUAL? PRSA,V?VERBOSE,V?BRIEF,V?UNSCRIPT /?L1
	EQUAL? PRSA,V?SCRIPT /?L1
	CALL AGONY
	RTRUE
?L1:	EQUAL? RARG,M-END \FALSE
	PRINTR "Hideous parasites descend upon you and tear the flesh from your bones, gnaw the eyes from your sockets, and feast upon your very brain tissue. Amazingly, you do not die, and your body regenerates itself as you await the next attack..."

	.FUNCT PARASITES-PSEUDO
	RFALSE

	.FUNCT HALL-OF-ETERNAL-DEATH-F,RARG
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?VERSION,V?SAVE,V?QUIT /?L1
	EQUAL? PRSA,V?RESTART,V?RESTORE,V?SUPER-BRIEF /?L1
	EQUAL? PRSA,V?VERBOSE,V?BRIEF,V?UNSCRIPT /?L1
	EQUAL? PRSA,V?SCRIPT /?L1
	CALL AGONY
	RTRUE
?L1:	EQUAL? RARG,M-END \FALSE
	PRINTR "Disembodied forces suck the very thoughts from your mind, savoring each moment and growing stronger. Every second is an agonizing torment, as though thousands of raging fires were exploding in your skull, filling you with a pain greater than you could ever imagine."

	.FUNCT FORCE-PSEUDO
	RFALSE

	.FUNCT AGONY
	PRINTR "Your agony is too great to concentrate on such an action."

	.FUNCT BLACK-DOOR-F
	EQUAL? PRSA,V?REZROV,V?OPEN \FALSE
	PRINTI "As the door opens, hundreds of slime-covered tentacles stream out and drag you across the threshold..."
	CRLF
	CRLF
	CALL PRINT-ID,STR?227
	CALL ROB,PROTAGONIST
	CALL INT,I-TIRED >STACK
	PUT STACK,0,0
	CALL INT,I-THIRST >STACK
	PUT STACK,0,0
	CALL INT,I-HUNGER >STACK
	PUT STACK,0,0
	CALL WEAR-OFF-SPELLS
	CALL GOTO,CHAMBER-OF-LIVING-DEATH >STACK
	RSTACK

	.FUNCT SILVER-DOOR-F
	EQUAL? PRSA,V?REZROV,V?OPEN \FALSE
	PRINTI "The door blows open, knocking you to the ground. You are pulled through the open doorway by an unseen force..."
	CRLF
	CRLF
	CALL PRINT-ID,STR?228
	CALL ROB,PROTAGONIST
	CALL INT,I-TIRED >STACK
	PUT STACK,0,0
	CALL INT,I-HUNGER >STACK
	PUT STACK,0,0
	CALL INT,I-THIRST >STACK
	PUT STACK,0,0
	CALL WEAR-OFF-SPELLS
	CALL GOTO,HALL-OF-ETERNAL-PAIN >STACK
	RSTACK

	.FUNCT WHITE-DOOR-F
	EQUAL? PRSA,V?REZROV,V?OPEN \FALSE
	EQUAL? HERE,BELBOZ-HIDEOUT \?L3
	CALL DO-WALK,P?EAST
	RTRUE
?L3:	ADD SCORE,WHITE-DOOR-SCORE >SCORE
	SET 'WHITE-DOOR-SCORE,0
	PRINTI "The door creaks slowly open. Within, you see someone lying as though asleep. You feel yourself drawn into the room..."
	CRLF
	CRLF
	CALL QUEUE,I-BELBOZ-AWAKES,8 >STACK
	PUT STACK,0,1
	CALL GOTO,BELBOZ-HIDEOUT >STACK
	RSTACK

	.FUNCT I-UNVARDIK
	SET 'VARDIKED,0
	CRLF
	PRINTR "Your head feels numb for a moment, and your mind feels suddenly open and unprotected."

	.FUNCT KILL-BELBOZ
	ZERO? BELBOZ-GASPARED /?L1
	SET 'BELBOZ-GASPARED,0
	PRINTI "As you stab Belboz, an apparition rises from his body. Floating above him like a cloud of fog, it howls with laughter. A moment later, gaspar begins to heal the wounds, and the spirit flows back into the body."
	CRLF
	CRLF
	CALL I-BELBOZ-AWAKES >STACK
	RSTACK
?L1:	PRINTI "You stab the knife time and again into Belboz, who writhes in pain, eyes bulging outward. Sickened and dizzy, you stagger back."
	CRLF
	CRLF
	CALL PRINT-ID,STR?229
	SET 'BELBOZ-DEAD,1
	CALL SWANZO-BELBOZ >STACK
	RSTACK

	.FUNCT SWANZO-BELBOZ
	PRINTI "A wispy translucent shape rises from the "
	ZERO? BELBOZ-DEAD /?L3
	PRINTI "corpse"
	JUMP ?L7
?L3:	PRINTI "body"
?L7:	PRINTI " of Belboz. It speaks in a voice so deep that your whole body seems to hear it. ""Foolish Charlatan! I am forced to flee that weak, old body -- I shall take your own, instead! Already I have sucked all knowledge, all secrets from that ancient Enchanter. Now begins an epoch of evil transcending even your worst nightmares; a reign of terror that will last a thousand thousand years!"" The shape blows toward you on a cold wind."
	CRLF
	CRLF
	ZERO? VARDIKED /?L12
	PRINTI "Jeearr surrounds you like a cloud and begins to contract. Suddenly, it strikes your invisible protection and recoils as if burned. ""No!"" it cries. ""Such a guileless Enchanter developing a mind shield?"" The cloud is thinner, the voice fainter. ""It cannot be! I cannot survive ... without a host."" The demon roils in agony, then thins and dissipates. There is a final scream of pain, then silence."
	CRLF
	CRLF
	ZERO? BELBOZ-DEAD /?L16
	PRINTI "Jeearr is vanquished; the kingdom is saved. But you - you are stranded in a land unknown, and your closest friend, the greatest Enchanter of his age, lies dead by your own hand. Kneeling by his blood-soaked corpse, you beg for another chance..."
	CRLF
	CALL FINISH >STACK
	RSTACK
?L16:	PRINTI "Belboz moans softly, and begins stirring. He sees you and rises, instantly alert. After posing a few well-chosen questions, he casts a brief but unfamiliar spell.

An instant later, "
	IN? GRUE-SUIT,PROTAGONIST \?L23
	PRINTI "your grue suit has vanished and "
?L23:	PRINTI "you are standing in the Chamber of the Circle. The Circle of Enchanters is assembled. Belboz speaks. ""Once again, this young Enchanter has done a matchless service to the Guild and to the entire kingdom, displaying resourcefulness and imagination worthy of the greatest of Enchanters. I grow old, and must soon step down as Head of the Circle. But let it be known that a successor has been found."""
	CRLF
	CRLF
	ADD SCORE,25 >SCORE
	SET 'HERE,CHAMBER-OF-THE-CIRCLE
	CALL V-SCORE
	USL
	CRLF
	PRINTI "Here ends the second chapter of the Enchanter saga, in which, by virtue of your skills, you have been appointed as the next leader of the Circle of Enchanters. The final adventure awaits you as the Enchanter series concludes."
	CRLF
	IN? MORGIA-PLANT,BELBOZ-QUARTERS /?L32
	CRLF
	PRINTI "You hear a distant bellow. ""What happened to my morgia plant?"""
	CRLF
?L32:	CALL FINISH,1 >STACK
	RSTACK
?L12:	PRINTI "You feel an overwhelming sense of oppression as the demon seizes control of your mind and body. The monster reaches into the recesses of your mind, adding your hard-earned magic powers to its own. As it settles comfortably into your skull, the demon grants you a vision of the future. You see the enslaved people of the land toiling to erect great idols to Jeearr. Parents offer up their own children upon these altars, as the rivers of the land fill with blood. And YOU embody Jeearr; you are cursed by ten thousand generations of victims; your face adorns the idols. And worst of all, you remain awake and aware, a witness to horror, never sleeping, and never, ever to escape."
	CRLF
	SET 'SCORE,-99
	CALL FINISH >STACK
	RSTACK

	.FUNCT I-BELBOZ-AWAKES
	EQUAL? HERE,BELBOZ-HIDEOUT \FALSE
	CRLF
	PRINTI "Suddenly, Belboz's eyes flicker and he leaps to his feet. His face is unrecognizable, a twisted mask of hatred. ""Meddlesome Enchanter! I should have killed you all before I left! But better late than never..."" Lightning bolts flash toward you from his fingers, but rather than dying, you find yourself in the..."
	CRLF
	CRLF
	CALL ROB,PROTAGONIST
	CALL INT,I-TIRED >STACK
	PUT STACK,0,0
	CALL INT,I-THIRST >STACK
	PUT STACK,0,0
	CALL INT,I-HUNGER >STACK
	PUT STACK,0,0
	CALL WEAR-OFF-SPELLS
	CALL GOTO,HALL-OF-ETERNAL-PAIN >STACK
	RSTACK

	.INSERT "sorcerer/sorcerer_str"
	.END
