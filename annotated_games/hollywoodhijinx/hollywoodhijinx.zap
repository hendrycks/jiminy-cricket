	.INSERT "hollywoodhijinx/hollywoodhijinx_freq"
	.INSERT "hollywoodhijinx/hollywoodhijinx_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	CALL DPRINT,OBJ
	RTRUE

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-THEFT?
	RFALSE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,ATTIC-CD,ATTIC-DOOR,BAG /TRUE
	EQUAL? PRSO,BATH-MAT,BAZOOKA,BED /TRUE
	EQUAL? PRSO,BLACK-BUTTON,BLUE-BUTTON,BLUE-CANDLE /TRUE
	EQUAL? PRSO,BLUE-CARD,BLUE-FEET,BLUE-WAX /TRUE
	EQUAL? PRSO,BRICK,BS-SAFE,BUCK /TRUE
	EQUAL? PRSO,BUCKET,CANNON,CANNON-BALL /TRUE
	EQUAL? PRSO,CARD,CEILING,CELLAR-CD /TRUE
	EQUAL? PRSO,CHAIN,CHIMNEY,CHUTE /TRUE
	EQUAL? PRSO,CLIPPERS,CLOSET-REF,CLUB /TRUE
	EQUAL? PRSO,COMPUTER,CORPSE-LINE,CRAWL-SPACE-DOOR /TRUE
	EQUAL? PRSO,DINING-ROOM-TABLE,DISPLAY-LIGHTS,DOG /TRUE
	EQUAL? PRSO,DOOR-BELL,FILM,FILM-PROJECTOR /TRUE
	EQUAL? PRSO,FILM-PROJECTOR-LENS,FINCH,FIRE-HYDRANT /TRUE
	EQUAL? PRSO,FIREPLACE-GLOBAL,FLASHLIGHT,FOYER-CD /TRUE
	EQUAL? PRSO,FOYER-STAIRS,FUSE,GARDEN /TRUE
	EQUAL? PRSO,GARDEN-WALLS,GRATER,GREEN-BUTTON /TRUE
	EQUAL? PRSO,GREEN-CARD,GREEN-MATCH,GUN /TRUE
	EQUAL? PRSO,HANDLES,HANDS,HATCH /TRUE
	EQUAL? PRSO,HEDGE-MAZE-OBJ,HOOKS,HOPPER /TRUE
	EQUAL? PRSO,HORIZONTAL-MAP,HOUSE,INDIGO-CARD /TRUE
	EQUAL? PRSO,LADDER,LEFT-END,LENS-CAP /TRUE
	EQUAL? PRSO,LETTER,LIGHTS,MAILBOX /TRUE
	EQUAL? PRSO,MANTLE,MASK,MATCHBOX /TRUE
	EQUAL? PRSO,MONUMENT,MOP,NEWEL /TRUE
	EQUAL? PRSO,NEWSLETTER,NOTE,OAK-DOOR /TRUE
	EQUAL? PRSO,ORANGE-CARD,ORCHIDS,PARKING-METER /TRUE
	EQUAL? PRSO,PATIO-DOOR,PEG-0,PEG-1 /TRUE
	EQUAL? PRSO,PEG-2,PEG-3,PEG-5 /TRUE
	EQUAL? PRSO,PEGS,PENGUIN,PERSIAN-RUG /TRUE
	EQUAL? PRSO,PHONE,PHOTO,PIANO /TRUE
	EQUAL? PRSO,PILE-OF-BALLS,PIPE,PLANE /TRUE
	EQUAL? PRSO,PLANK,PLAQUE,PORTRAIT /TRUE
	EQUAL? PRSO,PROJECTION-SCREEN,RED-BUTTON,RED-CANDLE /TRUE
	EQUAL? PRSO,RED-CARD,RED-FEET,RED-MATCH /TRUE
	EQUAL? PRSO,RED-WAX,RESET-BUTTON,RIGHT-END /TRUE
	EQUAL? PRSO,RING,ROPE,ROUND-POST /TRUE
	EQUAL? PRSO,RUBBER-STAMP,SACK,SACK-WINDOW /TRUE
	EQUAL? PRSO,SAND,SAW,SAWHORSE /TRUE
	EQUAL? PRSO,SEAT,SHEARS,SHOVEL /TRUE
	EQUAL? PRSO,SKIS,SLIDE,SLIDE-PROJECTOR /TRUE
	EQUAL? PRSO,SLIDE-PROJECTOR-LENS,SOFA,SQUARE-POST /TRUE
	EQUAL? PRSO,STAIRS,STICK,SWORD /TRUE
	EQUAL? PRSO,TANK,TOILET,TOKYO /TRUE
	EQUAL? PRSO,TOUPEE,TRUNK,UPSTAIRS-CD /TRUE
	EQUAL? PRSO,VERTICAL-MAP,VIOLET-CARD,WALL-SAFE /TRUE
	EQUAL? PRSO,WALLS,WHITE-BUTTON,WHITE-CANDLE /TRUE
	EQUAL? PRSO,WHITE-FEET,WHITE-WAX,WINDOW /TRUE
	EQUAL? PRSO,YELLOW-CARD /TRUE
	CALL IS-STRUCTURE? >STACK
	RSTACK

	.FUNCT IS-STRUCTURE?
	EQUAL? PRSO,ATTIC,BEDROOM-1,BEDROOM-2 /TRUE
	EQUAL? PRSO,BEDROOM-3,BOAT-DOCK,BOMB-SHELTER /TRUE
	EQUAL? PRSO,CELLAR,CHIMNEY-1,CHIMNEY-2 /TRUE
	EQUAL? PRSO,CHIMNEY-3,CLIFF,CLOSET /TRUE
	EQUAL? PRSO,DINING-ROOM,EAST-GARDEN,FIREPLACE /TRUE
	EQUAL? PRSO,FIRST-SECRET-ROOM,FOYER,FRONT-PORCH /TRUE
	EQUAL? PRSO,GAME-ROOM,HEDGE-MAZE,INLET /TRUE
	EQUAL? PRSO,KITCHEN,LADIES-ROOM,LIVING-ROOM /TRUE
	EQUAL? PRSO,LOWER-BEACH-STAIRS,MENS-ROOM,NORTH-GARDEN /TRUE
	EQUAL? PRSO,NORTHEAST-JUNCTION,NORTHWEST-JUNCTION,PARLOR /TRUE
	EQUAL? PRSO,PATIO,PROJECTION-BOOTH,PROP-VAULT /TRUE
	EQUAL? PRSO,SCREENING-ROOM,SHORT-HALL,TOP-LANDING /TRUE
	EQUAL? PRSO,UPPER-BEACH-STAIRS,UPSTAIRS-BATHROOM,UPSTAIRS-HALL-EAST /TRUE
	EQUAL? PRSO,UPSTAIRS-HALL-MIDDLE,UPSTAIRS-HALL-WEST \FALSE
	RTRUE

	.FUNCT IS-PERSON?
	EQUAL? PRSO,AUNT,HERMAN,HER /TRUE
	EQUAL? PRSO,HIM \FALSE
	RTRUE

	.FUNCT IS-SELF?
	EQUAL? PRSO,ME,PLAYER \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? PRSO,YOUR-FEET \FALSE
	RTRUE

	.FUNCT IS-SELF-OR-PART-OF-SELF?,?TMP
	CALL IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-PART-OF-SELF? >STACK
	RSTACK

	.FUNCT DANGEROUS-DRINK?
	EQUAL? PRSO,RED-WAX,WHITE-WAX \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?,?TMP
	CALL IS-PART-OF-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-OBJECT-OR-PROPERTY? >STACK
	RSTACK

	.FUNCT APRINT,OBJ
	FSET? OBJ,NARTICLEBIT \?L1
	PRINTI " "
	JUMP ?L4
?L1:	FSET? OBJ,VOWELBIT \?L3
	PRINTI " an "
	JUMP ?L4
?L3:	PRINTI " a "
?L4:	CALL DPRINT,OBJ >STACK
	RSTACK

	.FUNCT TPRINT,OBJ
	FSET? OBJ,NARTICLEBIT \?L1
	PRINTI " "
	JUMP ?L3
?L1:	PRINTI " the "
?L3:	CALL DPRINT,OBJ >STACK
	RSTACK

	.FUNCT ARPRINT,OBJ
	CALL APRINT,OBJ
	PRINTR "."

	.FUNCT TRPRINT,OBJ
	CALL TPRINT,OBJ
	PRINTR "."

	.FUNCT DPRINT,OBJ
	GETP OBJ,P?SDESC >STACK
	ZERO? STACK /?L1
	GETP OBJ,P?SDESC >STACK
	PRINT STACK
	RTRUE
?L1:	PRINTD OBJ
	RTRUE

	.FUNCT ULTIMATELY-IN?,OBJ,C=0
	ZERO? C \?L1
	SET 'C,WINNER
?L1:	ZERO? OBJ /FALSE
	IN? OBJ,C /TRUE
	IN? OBJ,ROOMS /FALSE
	LOC OBJ >STACK
	CALL ULTIMATELY-IN?,STACK,C >STACK
	RSTACK

	.FUNCT GO
START::
?L0:	SET 'LIT,1
	SET 'WINNER,PLAYER
	GETB 0,56 >STACK
	EQUAL? STACK,P-PLAYER \?L4
	GETB 0,57 >STACK
	EQUAL? STACK,P-WINNER /?L3
?L4:	GETB 0,56 >STACK
	EQUAL? STACK,84 \?L1
	GETB 0,57 >STACK
	EQUAL? STACK,79 \?L1
	GETB 0,58 >STACK
	EQUAL? STACK,77 \?L1
	GETB 0,59 >STACK
	EQUAL? STACK,65 \?L1
	GETB 0,60 >STACK
	EQUAL? STACK,83 \?L1
?L3:	SET 'P-VMERGE,PLAYER
?L1:	CALL QUEUE,I-SANDS-OF-TIME,599
	CALL QUEUE,I-SUNRISE,547
	SET 'P-NMERGE,P-DEBUG
	SET 'WHICH-END-IS-UP,RIGHT-END
	SET 'CLOSET-FLOOR,FOYER
	MOVE PLAYER,SOUTH-JUNCTION
	SET 'HERE,SOUTH-JUNCTION
	CALL QUEUE,I-NOISE,10
	CALL RESET-THEM
	PRINTI "As night falls the black limousine turns off the highway. It has all happened so fast, you think to yourself. Your Aunt passing away without any warning, the funeral this afternoon, and now this unusual stipulation in her will. The limo pulls up to the front of the house. ""This is the end of the line,"" says the attorney, and you step out of the back of the limo. ""Remember, your Aunt Hildegarde's will stated you will inherit her entire fortune -- if you can find the ten 'treasures' in one night.""

He hands you a photo of Uncle Buddy and a letter, saying, ""Her will instructed that I give you this photo, with the poem, to point you in the right direction. Also this letter, and here, you'll need this."" He gives you a flashlight. ""Meet me at 9 a.m. in the living room with all the 'treasures' and you'll inherit her entire estate,"" he says as the limo pulls away and disappears into the night's darkness."
	CRLF
	CALL V-VERSION
	CRLF
	CALL V-LOOK
	CALL DO-MAIN-LOOP
	JUMP ?L0

	.FUNCT RESET-THEM
	CALL PCLEAR
	SET 'P-HIM-OBJECT,NOT-HERE-OBJECT
	SET 'P-HER-OBJECT,NOT-HERE-OBJECT
	SET 'P-THEM-OBJECT,NOT-HERE-OBJECT
	RETURN P-THEM-OBJECT

	.FUNCT PCLEAR
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RETURN 2

	.FUNCT DO-MAIN-LOOP,X
?L1:	CALL MAIN-LOOP >X
	JUMP ?L1

	.FUNCT MAIN-LOOP,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP,X
	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	EQUAL? QCONTEXT-ROOM,HERE /?L1
	SET 'QCONTEXT,0
?L1:	CALL PARSER >P-WON
	ZERO? P-WON /?L4
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	ZERO? P-IT-OBJECT /?L6
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L6
	SET 'TMP,0
?L8:	IGRTR? 'CNT,ICNT /?L9
	GET P-PRSI,CNT >STACK
	EQUAL? STACK,IT \?L8
	PUT P-PRSI,CNT,P-IT-OBJECT
	SET 'TMP,1
?L9:	ZERO? TMP \?L19
	SET 'CNT,0
?L18:	IGRTR? 'CNT,OCNT /?L19
	GET P-PRSO,CNT >STACK
	EQUAL? STACK,IT \?L18
	PUT P-PRSO,CNT,P-IT-OBJECT
?L19:	SET 'CNT,0
?L6:	ZERO? OCNT \?L28
	SET 'NUM,OCNT
	JUMP ?L35
?L28:	GRTR? OCNT,1 \?L30
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L31
	SET 'OBJ,0
	JUMP ?L33
?L31:	GET P-PRSI,1 >OBJ
?L33:	SET 'NUM,OCNT
	JUMP ?L35
?L30:	GRTR? ICNT,1 \?L34
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L35
?L34:	SET 'NUM,1
?L35:	ZERO? OBJ \?L36
	EQUAL? ICNT,1 \?L36
	GET P-PRSI,1 >OBJ
?L36:	EQUAL? PRSA,V?WALK \?L39
	CALL PERFORM,PRSA,PRSO >V
	JUMP ?L53
?L39:	ZERO? NUM \?L41
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	ZERO? STACK \?L42
	CALL PERFORM,PRSA >V
	SET 'PRSO,0
	JUMP ?L53
?L42:	ZERO? LIT \?L44
	CALL PCLEAR
	CALL TOO-DARK
	JUMP ?L53
?L44:	CALL PCLEAR
	PRINTI "[There isn't anything to "
	GET P-ITBL,P-VERBN >TMP
	EQUAL? PRSA,V?TELL \?L46
	PRINTI "talk to"
	JUMP ?L50
?L46:	ZERO? P-MERGED \?L49
	ZERO? P-OFLAG /?L48
?L49:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L50
?L48:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK >V
?L50:	PRINTI "!]"
	CRLF
	SET 'V,0
	JUMP ?L53
?L41:	SET 'X,0
	SET 'TMP,0
?L52:	IGRTR? 'CNT,NUM \?L54
	GRTR? X,0 \?L56
	PRINTI "[The "
	EQUAL? X,NUM /?L58
	PRINTI "other "
?L58:	PRINTI "object"
	EQUAL? X,1 /?L61
	PRINTI "s"
?L61:	PRINTI " that you mentioned "
	EQUAL? X,1 /?L64
	PRINTI "are"
	JUMP ?L66
?L64:	PRINTI "is"
?L66:	PRINTI "n't here!]"
	CRLF
	JUMP ?L53
?L56:	ZERO? TMP \?L53
	CALL REFERRING
	JUMP ?L53
?L54:	ZERO? PTBL /?L70
	GET P-PRSO,CNT >OBJ1
	JUMP ?L72
?L70:	GET P-PRSI,CNT >OBJ1
?L72:	GRTR? NUM,1 /?L75
	GET P-ITBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL,W?EVERYTHING \?L81
?L75:	EQUAL? OBJ1,NOT-HERE-OBJECT \?L76
	INC 'X
	JUMP ?L52
?L76:	EQUAL? P-GETFLAGS,P-ALL \?L78
	CALL DONT-ALL?,OBJ1,OBJ >STACK
	ZERO? STACK \?L52
?L78:	CALL ACCESSIBLE?,OBJ1 >STACK
	ZERO? STACK /?L52
	EQUAL? OBJ1,PLAYER /?L52
	EQUAL? OBJ1,IT \?L82
	FSET? P-IT-OBJECT,NARTICLEBIT /?L84
	PRINTI "The "
?L84:	CALL DPRINT,P-IT-OBJECT
	JUMP ?L87
?L82:	FSET? OBJ1,NARTICLEBIT /?L88
	PRINTI "The "
?L88:	CALL DPRINT,OBJ1
?L87:	PRINTI ": "
?L81:	SET 'TMP,1
	ZERO? PTBL /?L92
	PUSH OBJ1
	JUMP ?L94
?L92:	PUSH OBJ
?L94:	CALL QCONTEXT-CHECK,STACK >V
	ZERO? PTBL /?L95
	SET 'PRSO,OBJ1
	JUMP ?L97
?L95:	SET 'PRSO,OBJ
?L97:	ZERO? PTBL /?L98
	SET 'PRSI,OBJ
	JUMP ?L100
?L98:	SET 'PRSI,OBJ1
?L100:	CALL PERFORM,PRSA,PRSO,PRSI >V
	EQUAL? V,M-FATAL \?L52
?L53:	EQUAL? V,M-FATAL \?L107
	SET 'P-CONT,0
	JUMP ?L107
?L4:	SET 'P-CONT,0
?L107:	ZERO? P-WON /?L112
	CALL GAME-VERB? >STACK
	ZERO? STACK \?L112
	CALL CLOCKER >V
?L112:	SET 'PRSA,0
	SET 'PRSO,0
	SET 'PRSI,0
	RETURN PRSI

	.FUNCT DONT-ALL?,O,I,L
	LOC O >L
	EQUAL? O,I /TRUE
	EQUAL? PRSA,V?TAKE \?L3
	ZERO? I /?L25
	CALL ULTIMATELY-IN?,O,I >STACK
	ZERO? STACK /TRUE
	ZERO? I \?L6
?L25:	CALL ULTIMATELY-IN?,O >STACK
	ZERO? STACK \TRUE
?L6:	FSET? O,TAKEBIT /?L7
	FSET? O,TRYTAKEBIT \TRUE
?L7:	ZERO? I /?L8
	EQUAL? L,I \TRUE
	CALL SEE-INSIDE?,I >STACK
	ZERO? STACK /TRUE
	RFALSE
?L8:	CALL META-LOC,O >STACK
	EQUAL? STACK,PLAYER /FALSE
	EQUAL? L,HERE /FALSE
	FSET? L,SURFACEBIT /FALSE
	FSET? L,ACTORBIT \TRUE
	RFALSE
?L3:	EQUAL? PRSA,V?PUT-ON,V?PUT,V?DROP /?L19
	EQUAL? PRSA,V?THROW \FALSE
?L19:	FSET? O,TAKEBIT \TRUE
	EQUAL? L,PLAYER,WINNER \TRUE
	RFALSE

	.FUNCT GAME-VERB?,V=0
	ZERO? V \?L1
	SET 'V,PRSA
?L1:	EQUAL? V,V?BRIEF,V?SCORE,V?VERBOSE /TRUE
	EQUAL? V,V?QUIT,V?RESTART,V?RESTORE /TRUE
	EQUAL? V,V?SAVE,V?SCRIPT,V?SUPER-BRIEF /TRUE
	EQUAL? V,V?TELL,V?UNSCRIPT,V?VERSION /TRUE
	EQUAL? V,V?TIME \FALSE
	RTRUE

	.FUNCT QCONTEXT-CHECK,PRSO?1,OTHER,WHO=0,N=0
	EQUAL? PRSA,V?HELP /?L3
	EQUAL? PRSA,V?TELL \FALSE
	EQUAL? PRSO?1,PLAYER \FALSE
?L3:	FIRST? HERE >OTHER \?L6
?L7:	FSET? OTHER,ACTORBIT \?L9
	EQUAL? OTHER,PLAYER /?L9
	INC 'N
	SET 'WHO,OTHER
?L9:	NEXT? OTHER >OTHER /?L7
?L6:	EQUAL? 1,N \?L12
	ZERO? QCONTEXT \?L12
	CALL SAID-TO,WHO
?L12:	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /FALSE
	EQUAL? WINNER,PLAYER \FALSE
	SET 'WINNER,QCONTEXT
	CALL SPOKEN-TO,QCONTEXT >STACK
	RSTACK

	.FUNCT SAID-TO,WHO
	SET 'QCONTEXT,WHO
	LOC WHO >QCONTEXT-ROOM
	RETURN QCONTEXT-ROOM

	.FUNCT SPOKEN-TO,WHO
	CALL PCLEAR
	PRINTI "[spoken to"
	CALL TPRINT,WHO
	PRINTR "]"

	.FUNCT QCONTEXT-GOOD?,?TMP
	ZERO? QCONTEXT /FALSE
	FSET? QCONTEXT,ACTORBIT \FALSE
	EQUAL? HERE,QCONTEXT-ROOM \FALSE
	SET '?TMP,HERE
	CALL META-LOC,QCONTEXT >STACK
	EQUAL? ?TMP,STACK /TRUE
	RFALSE

	.FUNCT ACCESSIBLE?,OBJ
	FSET? OBJ,INVISIBLE /FALSE
	CALL META-LOC,OBJ >STACK
	EQUAL? STACK,WINNER,HERE,GLOBAL-OBJECTS /TRUE
	CALL VISIBLE?,OBJ >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT VISIBLE?,OBJ,L
	LOC OBJ >L
	ZERO? L /FALSE
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? L,GLOBAL-OBJECTS /FALSE
	EQUAL? L,PLAYER,HERE,WINNER /TRUE
	EQUAL? L,LOCAL-GLOBALS \?L6
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	ZERO? STACK \TRUE
?L6:	CALL SEE-INSIDE?,L >STACK
	ZERO? STACK /FALSE
	CALL VISIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT SEE-INSIDE?,CONTAINER
	ZERO? P-MOBY-FLAG \TRUE
	FSET? CONTAINER,SURFACEBIT /TRUE
	FSET? CONTAINER,CONTBIT \?L4
	FSET? CONTAINER,OPENBIT /TRUE
	FSET? CONTAINER,TRANSBIT \FALSE
	RTRUE
?L4:	FSET? CONTAINER,ACTORBIT \FALSE
	EQUAL? CONTAINER,PLAYER /FALSE
	RTRUE

	.FUNCT META-LOC,OBJ
?L1:	ZERO? OBJ /FALSE
	IN? OBJ,GLOBAL-OBJECTS \?L5
	RETURN GLOBAL-OBJECTS
?L5:	IN? OBJ,ROOMS \?L6
	RETURN OBJ
?L6:	LOC OBJ >OBJ
	JUMP ?L1

	.FUNCT DEQUEUE,RTN
	CALL QUEUED?,RTN >RTN
	ZERO? RTN /FALSE
	PUT RTN,C-RTN,0
	RTRUE

	.FUNCT QUEUE,RTN,TICK,C,E,INT=0
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	ZERO? INT /?L5
	SET 'C,INT
	JUMP ?L7
?L5:	SUB C-INTS,C-INTLEN >C-INTS
	ADD C-TABLE,C-INTS >INT
?L7:	PUT INT,C-RTN,RTN
	JUMP ?L2
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L8
	SET 'INT,C
	JUMP ?L2
?L8:	GET C,C-RTN >STACK
	ZERO? STACK \?L9
	SET 'INT,C
?L9:	ADD C,C-INTLEN >C
	JUMP ?L1
?L2:	GRTR? INT,CLOCK-HAND \?L11
	ADD TICK,3 >STACK
	SUB 0,STACK >TICK
?L11:	PUT INT,C-TICK,TICK
	RETURN INT

	.FUNCT QUEUED?,RTN,C,E
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E /FALSE
	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L8
	GET C,C-TICK >STACK
	ZERO? STACK /FALSE
	RETURN C
?L8:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT CLOCKER,E,TICK,RTN,FLG=0,Q?=0,OWINNER
	ZERO? CLOCK-WAIT /?L1
	SET 'CLOCK-WAIT,0
	RFALSE
?L1:	ADD C-TABLE,C-INTS >CLOCK-HAND
	ADD C-TABLE,C-TABLELEN >E
	SET 'OWINNER,WINNER
	SET 'WINNER,PLAYER
?L4:	EQUAL? CLOCK-HAND,E \?L6
	INC 'MOVES
	SET 'WINNER,OWINNER
	RETURN FLG
?L6:	GET CLOCK-HAND,C-RTN >STACK
	ZERO? STACK /?L26
	GET CLOCK-HAND,C-TICK >TICK
	LESS? TICK,-1 \?L9
	SUB 0,TICK >STACK
	SUB STACK,3 >STACK
	PUT CLOCK-HAND,C-TICK,STACK
	SET 'Q?,CLOCK-HAND
	JUMP ?L26
?L9:	ZERO? TICK /?L26
	GRTR? TICK,0 \?L12
	DEC 'TICK
	PUT CLOCK-HAND,C-TICK,TICK
?L12:	ZERO? TICK /?L15
	SET 'Q?,CLOCK-HAND
?L15:	GRTR? TICK,0 /?L26
	GET CLOCK-HAND,C-RTN >RTN
	ZERO? TICK \?L20
	PUT CLOCK-HAND,C-RTN,0
?L20:	CALL RTN >STACK
	ZERO? STACK /?L23
	SET 'FLG,1
?L23:	ZERO? Q? \?L26
	GET CLOCK-HAND,C-RTN >STACK
	ZERO? STACK /?L26
	SET 'Q?,1
?L26:	ADD CLOCK-HAND,C-INTLEN >CLOCK-HAND
	ZERO? Q? \?L4
	ADD C-INTS,C-INTLEN >C-INTS
	JUMP ?L4

	.FUNCT FIXED-FONT-ON
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT FIXED-FONT-OFF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT PARSER,PTR=P-LEXSTART,WRD,VAL=0,VERB=0,OF-FLAG=0,LEN,DIR=0,NW=0,LW=0,CNT=-1,OWINNER,OMERGED,TEMP=0
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	ZERO? P-OFLAG \?L6
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
?L6:	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'OMERGED,P-MERGED
	SET 'P-MERGED,0
	SET 'P-END-ON-PREP,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	SET 'OWINNER,WINNER
	ZERO? P-OFLAG \?L9
	SET 'P-PRSA-WORD,0
?L9:	ZERO? QUOTE-FLAG \?L12
	EQUAL? WINNER,PLAYER /?L12
	SET 'WINNER,PLAYER
	SET 'LAST-PLAYER-LOC,HERE
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L14
	SET 'LAST-PLAYER-LOC,HERE
	LOC WINNER >HERE
?L14:	CALL LIT?,HERE >LIT
?L12:	ZERO? RESERVE-PTR /?L18
	SET 'PTR,RESERVE-PTR
	CALL STUFF,P-LEXV,RESERVE-LEXV
	ZERO? VERBOSITY /?L20
	EQUAL? PLAYER,WINNER \?L20
	CRLF
?L20:	SET 'RESERVE-PTR,0
	SET 'P-CONT,0
	JUMP ?L28
?L18:	ZERO? P-CONT /?L23
	SET 'PTR,P-CONT
	SET 'P-CONT,0
	ZERO? SAYING? /?L24
	SET 'SAYING?,0
	JUMP ?L28
?L24:	ZERO? VERBOSITY /?L28
	EQUAL? PLAYER,WINNER \?L28
	CRLF
	JUMP ?L28
?L23:	SET 'SAYING?,0
	SET 'WINNER,PLAYER
	SET 'QUOTE-FLAG,0
	SET 'LAST-PLAYER-LOC,HERE
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L29
	SET 'LAST-PLAYER-LOC,HERE
	LOC WINNER >HERE
?L29:	CALL LIT?,HERE >LIT
	ZERO? VERBOSITY /?L32
	CRLF
?L32:	PUTB P-LEXV,0,59
	PRINTI ">"
	READ P-INBUF,P-LEXV
?L28:	GETB P-LEXV,P-LEXWORDS >P-LEN
	GET P-LEXV,PTR >STACK
	EQUAL? W?$QUOTE,STACK \?L35
	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L35
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L35:	GET P-LEXV,PTR >STACK
	EQUAL? W?THEN,STACK \?L38
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L38:	LESS? 1,P-LEN \?L41
	GET P-LEXV,PTR >STACK
	EQUAL? W?GO,STACK \?L41
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
	ZERO? NW /?L41
	CALL WT?,NW,PS?VERB >STACK
	ZERO? STACK /?L41
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L41:	ZERO? P-LEN \?L44
	PRINTI "[Beg pardon?]"
	CRLF
	RFALSE
?L44:	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?OOPS \?L46
	GRTR? P-LEN,1 /?L47
	PRINTI "[You can't use OOPS that way.]"
	CRLF
	RFALSE
?L47:	GET OOPS-TABLE,O-PTR >STACK
	ZERO? STACK /?L49
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	GET OOPS-TABLE,O-PTR >STACK
	PUT AGAIN-LEXV,STACK,STACK
	SET 'WINNER,OWINNER
	GET OOPS-TABLE,O-PTR >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,3 >STACK
	MUL PTR,P-LEXELEN >STACK
	ADD STACK,7 >STACK
	GETB P-LEXV,STACK >STACK
	MUL PTR,P-LEXELEN >STACK
	ADD STACK,6 >STACK
	GETB P-LEXV,STACK >STACK
	CALL INBUF-ADD,STACK,STACK,STACK
	CALL STUFF,P-LEXV,AGAIN-LEXV
	GETB P-LEXV,P-LEXWORDS >P-LEN
	GET OOPS-TABLE,O-START >PTR
	CALL INBUF-STUFF,P-INBUF,OOPS-INBUF
	JUMP ?L51
?L49:	PUT OOPS-TABLE,O-END,0
	PRINTI "[There was no word to replace!]"
	CRLF
	RFALSE
?L46:	PUT OOPS-TABLE,O-END,0
?L51:	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?AGAIN,W?G \?L52
	ZERO? P-OFLAG \?L56
	ZERO? P-WON \?L54
?L56:	PRINTI "[You can't use AGAIN that way.]"
	CRLF
	RFALSE
?L54:	GRTR? P-LEN,1 \?L57
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA,W?THEN /?L60
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?AND \?L58
?L60:	ADD PTR,4 >PTR
	GETB P-LEXV,P-LEXWORDS >STACK
	SUB STACK,2 >STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
	JUMP ?L62
?L58:	PRINTI "[I couldn't understand that sentence.]"
	CRLF
	RFALSE
?L57:	ADD PTR,P-LEXELEN >PTR
	GETB P-LEXV,P-LEXWORDS >STACK
	DEC 'STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
?L62:	GETB P-LEXV,P-LEXWORDS >STACK
	GRTR? STACK,0 \?L63
	CALL STUFF,RESERVE-LEXV,P-LEXV
	SET 'RESERVE-PTR,PTR
	JUMP ?L65
?L63:	SET 'RESERVE-PTR,0
?L65:	SET 'WINNER,OWINNER
	SET 'P-MERGED,OMERGED
	CALL INBUF-STUFF,P-INBUF,OOPS-INBUF
	CALL STUFF,P-LEXV,AGAIN-LEXV
	SET 'CNT,-1
	SET 'DIR,P-WALK-DIR
?L66:	IGRTR? 'CNT,P-ITBLLEN /?L73
	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L66
?L52:	SET 'P-NUMBER,-1
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADVERB,0
	CALL STUFF,AGAIN-LEXV,P-LEXV
	CALL INBUF-STUFF,OOPS-INBUF,P-INBUF
	PUT OOPS-TABLE,O-START,PTR
	MUL 4,P-LEN >STACK
	PUT OOPS-TABLE,O-LENGTH,STACK
	SET 'RESERVE-PTR,0
	SET 'LEN,P-LEN
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
	PUT P-ITBL,P-VERBN,0
	SET 'P-SENTENCE,PTR
?L72:	DLESS? 'P-LEN,0 \?L74
	SET 'QUOTE-FLAG,0
	JUMP ?L73
?L74:	GET P-LEXV,PTR >WRD
	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	ZERO? WRD \?L78
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L77
?L78:	ZERO? P-LEN \?L79
	SET 'NW,0
	JUMP ?L81
?L79:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L81:	EQUAL? WRD,W?TO \?L82
	EQUAL? VERB,ACT?TELL,ACT?ASK \?L82
	PUT P-ITBL,P-VERB,ACT?TELL
	SET 'WRD,W?$QUOTE
	JUMP ?L84
?L82:	EQUAL? WRD,W?THEN \?L84
	ZERO? VERB \?L84
	ZERO? QUOTE-FLAG \?L84
	GET P-ITBL,P-NC1 >STACK
	ZERO? STACK /?L84
	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WRD,W?$QUOTE
?L84:	EQUAL? WRD,W?$PERIOD \?L86
	EQUAL? LW,W?MR,W?MISS,W?MRS \?L86
	SET 'LW,0
	JUMP ?L134
?L86:	EQUAL? WRD,W?THEN,W?$PERIOD,W?$QUOTE \?L88
	EQUAL? WRD,W?$QUOTE \?L93
	ZERO? QUOTE-FLAG /?L91
	SET 'QUOTE-FLAG,0
	JUMP ?L93
?L91:	SET 'QUOTE-FLAG,1
?L93:	ZERO? P-LEN /?L95
	ADD PTR,P-LEXELEN >P-CONT
?L95:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L73
?L88:	CALL WT?,WRD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L97
	EQUAL? VERB,0,ACT?WALK,ACT?GO \?L97
	EQUAL? LEN,1 /?L98
	EQUAL? LEN,2 \?L99
	EQUAL? VERB,ACT?WALK,ACT?GO /?L98
?L99:	EQUAL? NW,W?THEN,W?$PERIOD,W?$QUOTE \?L100
	GRTR? LEN,1 /?L98
?L100:	ZERO? QUOTE-FLAG /?L101
	EQUAL? LEN,2 \?L101
	EQUAL? NW,W?$QUOTE /?L98
?L101:	GRTR? LEN,2 \?L97
	EQUAL? NW,W?$COMMA,W?AND \?L97
?L98:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L102
	ADD PTR,P-LEXELEN >STACK
	CALL CHANGE-LEXV,STACK,W?THEN
?L102:	GRTR? LEN,2 /?L134
	SET 'QUOTE-FLAG,0
	JUMP ?L73
?L97:	CALL WT?,WRD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L108
	ZERO? VERB \?L108
	SET 'P-PRSA-WORD,WRD
	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WRD
	MUL PTR,2 >STACK
	ADD STACK,2 >TEMP
	GETB P-LEXV,TEMP >STACK
	PUTB P-VTBL,2,STACK
	ADD TEMP,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L134
?L108:	CALL WT?,WRD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L110
	EQUAL? WRD,W?A,W?BOTH,W?ALL /?L111
	EQUAL? WRD,W?EVERYTHING /?L111
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L111
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L109
?L111:	SET 'VAL,0
?L110:	GRTR? P-LEN,1 \?L112
	EQUAL? NW,W?OF \?L112
	EQUAL? VERB,ACT?TAKE /?L112
	ZERO? VAL \?L147
	EQUAL? WRD,W?A,W?ALL,W?BOTH /?L112
	EQUAL? WRD,W?EVERYTHING /?L112
	SET 'OF-FLAG,1
	JUMP ?L134
?L112:	ZERO? VAL /?L114
?L147:	ZERO? P-LEN /?L115
	EQUAL? NW,W?THEN,W?$PERIOD \?L114
?L115:	SET 'P-END-ON-PREP,1
	LESS? P-NCN,2 \?L134
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WRD
	JUMP ?L134
?L114:	EQUAL? P-NCN,2 \?L119
	PRINTI "[There are too many nouns in that sentence!]"
	CRLF
	RFALSE
?L119:	INC 'P-NCN
	CALL CLAUSE,PTR,VAL,WRD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L134
	SET 'QUOTE-FLAG,0
	JUMP ?L73
?L109:	EQUAL? WRD,W?OF \?L126
	ZERO? OF-FLAG /?L129
	EQUAL? NW,W?$PERIOD,W?THEN \?L127
?L129:	CALL CANT-USE,PTR
	RFALSE
?L127:	SET 'OF-FLAG,0
	JUMP ?L134
?L126:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L134
	EQUAL? VERB,ACT?TELL \?L132
	CALL WT?,WRD,PS?VERB >STACK
	ZERO? STACK /?L132
	CALL WAY-TO-TALK
	RFALSE
?L132:	CALL CANT-USE,PTR
	RFALSE
?L77:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L134:	SET 'LW,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L72
?L73:	PUT OOPS-TABLE,O-PTR,0
	ZERO? DIR /?L135
	SET 'PRSA,V?WALK
	SET 'P-WALK-DIR,DIR
	SET 'PRSO,DIR
	SET 'P-OFLAG,0
	RTRUE
?L135:	SET 'P-WALK-DIR,0
	ZERO? P-OFLAG /?L138
	CALL ORPHAN-MERGE >STACK
	ZERO? STACK /?L138
	SET 'WINNER,OWINNER
?L138:	ZERO? P-CONT /?L141
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK \?L141
	GET P-ITBL,P-NC1 >STACK
	ZERO? STACK /?L141
	PUT P-ITBL,P-VERB,ACT?TELL
?L141:	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT CHANGE-LEXV,PTR,WRD
	PUT P-LEXV,PTR,WRD
	PUT AGAIN-LEXV,PTR,WRD
	RTRUE

	.FUNCT WAY-TO-TALK
	PRINTR "[Refer to your HOLLYWOOD HIJINX manual for the correct way to talk to characters.]"

	.FUNCT WT?,PTR,BIT,B1=5,OFFS=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L6
	INC 'OFFS
?L6:	GETB PTR,OFFS >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WRD,OFF,NUM,ANDFLG=0,FIRST??=1,NW,LW=0,LEN
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L3
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?RIGHT,W?LEFT \?L1
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?END \?L1
	SET 'VAL,0
	INC 'P-LEN
	JUMP ?L12
?L1:	ZERO? VAL /?L3
	ADD P-PREP1,OFF >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WRD
	ADD PTR,P-LEXELEN >PTR
	EQUAL? WRD,W?TO /?L12
	SET 'LEN,P-LEN
?L6:	DEC 'LEN
	GET P-LEXV,PTR >WRD
	EQUAL? WRD,W?LEFT,W?RIGHT \?L12
	GRTR? LEN,0 \?L12
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?END /?L12
	CALL WT?,WRD,PS?PREPOSITION,0 >VAL
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L6
?L3:	INC 'P-LEN
?L12:	ZERO? P-LEN \?L13
	DEC 'P-NCN
	RETURN -1
?L13:	ADD P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L16
	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L16:	DLESS? 'P-LEN,0 \?L21
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L21:	GET P-LEXV,PTR >WRD
	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	ZERO? WRD \?L27
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L26
?L27:	ZERO? P-LEN \?L28
	SET 'NW,0
	JUMP ?L30
?L28:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L30:	EQUAL? WRD,W?$PERIOD \?L31
	EQUAL? LW,W?MR,W?MRS,W?MISS \?L31
	SET 'LW,0
	JUMP ?L53
?L31:	EQUAL? WRD,W?AND,W?$COMMA \?L33
	SET 'ANDFLG,1
	JUMP ?L53
?L33:	EQUAL? WRD,W?ALL,W?BOTH,W?EVERYTHING \?L34
	EQUAL? NW,W?OF \?L53
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L53
?L34:	EQUAL? WRD,W?THEN,W?$PERIOD /?L39
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L38
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK /?L38
	ZERO? FIRST?? \?L38
?L39:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L38:	ZERO? ANDFLG /?L40
	GET P-ITBL,P-VERBN >STACK
	ZERO? STACK /?L41
	CALL VERB-DIR-ONLY?,WRD >STACK
	ZERO? STACK /?L40
?L41:	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	CALL CHANGE-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L53
?L40:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L42
	GRTR? P-LEN,0 \?L43
	EQUAL? NW,W?OF \?L43
	EQUAL? WRD,W?ALL,W?EVERYTHING \?L53
?L43:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK /?L45
	ZERO? NW /?L45
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L53
?L45:	ZERO? ANDFLG \?L46
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L46
	EQUAL? NW,W?$COMMA /?L46
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L46:	SET 'ANDFLG,0
	JUMP ?L53
?L42:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L53
	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L53
	ZERO? ANDFLG /?L50
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK \?L50
	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	CALL CHANGE-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L53
?L50:	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK \?L53
	CALL CANT-USE,PTR
	RFALSE
?L26:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L53:	SET 'LW,WRD
	SET 'FIRST??,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L16

	.FUNCT THIS-IS-IT,OBJ
	EQUAL? OBJ,0,PLAYER,NOT-HERE-OBJECT /TRUE
	EQUAL? OBJ,INTDIR /TRUE
	EQUAL? PRSA,V?WALK,V?WALK-TO \?L4
	EQUAL? OBJ,PRSO /TRUE
?L4:	SET 'P-THEM-OBJECT,OBJ
	SET 'P-IT-OBJECT,OBJ
	RTRUE

	.FUNCT REFERRING,WHO=0
	PRINTI "[I don't see wh"
	ZERO? WHO /?L1
	PRINTI "om"
	JUMP ?L3
?L1:	PRINTI "at"
?L3:	PRINTR " you're referring to.]"

	.FUNCT FAKE-ORPHAN,TMP
	CALL ORPHAN,P-SYNTAX,0
	PRINTI "[Be specific: what object do you want to "
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	JUMP ?L4
?L1:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L3
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L4
?L3:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L4:	SET 'P-OFLAG,1
	SET 'P-WON,0
	PRINTR "?]"

	.FUNCT SEE-VERB?
	EQUAL? PRSA,V?LOOK,V?EXAMINE,V?LOOK-INSIDE /TRUE
	EQUAL? PRSA,V?SEARCH,V?FIND,V?LOOK-ON /TRUE
	EQUAL? PRSA,V?OPEN,V?LOOK-UNDER,V?LOOK-BEHIND /TRUE
	EQUAL? PRSA,V?READ,V?LOOK-THRU,V?LOOK-DOWN /TRUE
	EQUAL? PRSA,V?COUNT /TRUE
	EQUAL? PRSA,V?PLAY \FALSE
	RTRUE

	.FUNCT PERFORM,A,O=0,I=0,V,OA,OO,OI
	ZERO? DEBUG /?L1
	PRINTI "[Perform: "
	PRINTN A
	ZERO? O /?L7
	PRINTI "/"
	EQUAL? A,V?WALK \?L5
	PRINTN O
	JUMP ?L7
?L5:	CALL DPRINT,O
?L7:	ZERO? I /?L9
	PRINTI "/"
	CALL DPRINT,I
?L9:	PRINTI "]"
	CRLF
?L1:	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	SET 'PRSA,A
	ZERO? LIT \?L13
	CALL SEE-VERB? >STACK
	ZERO? STACK /?L13
	CALL TOO-DARK
	RETURN 2
?L13:	EQUAL? A,V?WALK /?L97
	EQUAL? IT,I,O \?L22
	ZERO? P-IT-OBJECT /?L20
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK \?L22
?L20:	ZERO? I \?L23
	CALL FAKE-ORPHAN
	RETURN 2
?L23:	CALL REFERRING
	RETURN 2
?L22:	EQUAL? THEM,I,O \?L42
	ZERO? P-THEM-OBJECT /?L31
	CALL VISIBLE?,P-THEM-OBJECT >STACK
	ZERO? STACK /?L31
	ZERO? DEBUG /?L33
	PRINTI "[them="
	CALL DPRINT,P-THEM-OBJECT
	PRINTI "]"
	CRLF
?L33:	EQUAL? THEM,O \?L36
	SET 'O,P-THEM-OBJECT
?L36:	EQUAL? THEM,I \?L42
	SET 'I,P-THEM-OBJECT
	JUMP ?L42
?L31:	ZERO? I \?L43
	CALL FAKE-ORPHAN
	RETURN 2
?L43:	CALL REFERRING,1
	RETURN 2
?L42:	EQUAL? HER,I,O \?L62
	ZERO? P-HER-OBJECT /?L51
	CALL VISIBLE?,P-HER-OBJECT >STACK
	ZERO? STACK /?L51
	ZERO? DEBUG /?L53
	PRINTI "[her="
	CALL DPRINT,P-HER-OBJECT
	PRINTI "]"
	CRLF
?L53:	EQUAL? HER,O \?L56
	SET 'O,P-HER-OBJECT
?L56:	EQUAL? HER,I \?L62
	SET 'I,P-HER-OBJECT
	JUMP ?L62
?L51:	ZERO? I \?L63
	CALL FAKE-ORPHAN
	RETURN 2
?L63:	CALL REFERRING,1
	RETURN 2
?L62:	EQUAL? HIM,I,O \?L82
	ZERO? P-HIM-OBJECT /?L71
	CALL VISIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK /?L71
	ZERO? DEBUG /?L73
	PRINTI "[him="
	CALL DPRINT,P-HIM-OBJECT
	PRINTI "]"
	CRLF
?L73:	EQUAL? HIM,O \?L76
	SET 'O,P-HIM-OBJECT
?L76:	EQUAL? HIM,I \?L82
	SET 'I,P-HIM-OBJECT
	JUMP ?L82
?L71:	ZERO? I \?L83
	CALL FAKE-ORPHAN
	RETURN 2
?L83:	CALL REFERRING,1
	RETURN 2
?L82:	EQUAL? O,IT \?L91
	SET 'O,P-IT-OBJECT
	ZERO? DEBUG /?L91
	PRINTI "[it="
	CALL DPRINT,O
	PRINTI "]"
	CRLF
?L91:	EQUAL? I,IT \?L97
	SET 'I,P-IT-OBJECT
	ZERO? DEBUG /?L97
	PRINTI "[it="
	CALL DPRINT,O
	PRINTI "]"
	CRLF
?L97:	SET 'PRSI,I
	SET 'PRSO,O
	SET 'V,0
	EQUAL? A,V?WALK /?L104
	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \?L104
	CALL NOT-HERE-OBJECT-F >V
	ZERO? V /?L104
	SET 'P-WON,0
?L104:	CALL THIS-IS-IT,PRSI
	CALL THIS-IS-IT,PRSO
	SET 'O,PRSO
	SET 'I,PRSI
	ZERO? V \?L138
	GETP WINNER,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L138
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-BEG >V
	ZERO? V \?L138
	GET PREACTIONS,A >STACK
	CALL STACK >V
	ZERO? V \?L138
	ZERO? I /?L119
	EQUAL? A,V?WALK /?L119
	LOC I >STACK
	ZERO? STACK /?L119
	LOC I >STACK
	GETP STACK,P?CONTFCN >V
	ZERO? V /?L147
	CALL V,M-CONT >V
?L119:	ZERO? V \?L138
?L147:	ZERO? I /?L123
	GETP I,P?ACTION >STACK
	CALL STACK >V
?L123:	ZERO? V \?L138
	ZERO? O /?L128
	EQUAL? A,V?WALK /?L128
	LOC O >STACK
	ZERO? STACK /?L128
	LOC O >STACK
	GETP STACK,P?CONTFCN >V
	ZERO? V /?L148
	CALL V,M-CONT >V
?L128:	ZERO? V \?L138
?L148:	ZERO? O /?L134
	EQUAL? A,V?WALK /?L134
	GETP O,P?ACTION >STACK
	CALL STACK >V
	ZERO? V /?L149
	CALL THIS-IS-IT,O
?L134:	ZERO? V \?L138
?L149:	GET ACTIONS,A >STACK
	CALL STACK >V
?L138:	EQUAL? V,M-FATAL /?L143
	CALL GAME-VERB? >STACK
	ZERO? STACK \?L143
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-END >V
?L143:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT BUZZER-WORD?,WORD
	CALL NUMBER-WORD?,WORD >STACK
	ZERO? STACK \TRUE
	CALL NAUGHTY-WORD?,WORD >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT NUMBER-WORD?,WRD
	EQUAL? WRD,W?ONE,W?TWO,W?THREE /?L3
	EQUAL? WRD,W?FOUR,W?FIVE,W?SIX /?L3
	EQUAL? WRD,W?SEVEN,W?EIGHT,W?NINE /?L3
	EQUAL? WRD,W?TEN,W?ELEVEN,W?TWELVE /?L3
	EQUAL? WRD,W?THIRTE,W?FOURTE,W?FIFTEE /?L3
	EQUAL? WRD,W?SIXTEE,W?SEVENT,W?EIGHTE /?L3
	EQUAL? WRD,W?NINETE,W?TWENTY,W?THIRTY /?L3
	EQUAL? WRD,W?FORTY,W?FIFTY,W?SIXTY /?L3
	EQUAL? WRD,W?EIGHTY,W?NINETY,W?HUNDRE /?L3
	EQUAL? WRD,W?THOUSA /?L3
	EQUAL? WRD,W?MILLIO,W?BILLIO,W?ZERO \FALSE
?L3:	PRINTR "[Use numerals for numbers, for example ""10.""]"

	.FUNCT NAUGHTY-WORD?,WORD
	EQUAL? WORD,W?CURSE,W?GODDAMNED,W?CUSS /?L3
	EQUAL? WORD,W?DAMN,W?SHIT,W?FUCK /?L3
	EQUAL? WORD,W?SHITHEAD,W?PISS,W?SUCK /?L3
	EQUAL? WORD,W?BASTARD,W?SCREW,W?FUCKING /?L3
	EQUAL? WORD,W?DAMNED,W?PEE,W?COCKSUCKER /?L3
	EQUAL? WORD,W?FUCKED,W?CUNT,W?ASSHOLE /?L3
	EQUAL? WORD,W?BITCH \FALSE
?L3:	CALL PICK-ONE,OFFENDED >STACK
	PRINT STACK
	CALL PRINT-ID,STR?17 >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT VERB-DIR-ONLY?,WRD,?TMP
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK \FALSE
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \FALSE
	CALL WT?,WRD,PS?DIRECTION >?TMP
	ZERO? ?TMP /?L5
	RETURN ?TMP
?L5:	CALL WT?,WRD,PS?VERB >STACK
	RSTACK

	.FUNCT STUFF,DEST,SRC,MAX=29,PTR=P-LEXSTART,CTR=1,BPTR
	GETB SRC,0 >STACK
	PUTB DEST,0,STACK
	GETB SRC,1 >STACK
	PUTB DEST,1,STACK
?L1:	GET SRC,PTR >STACK
	PUT DEST,PTR,STACK
	MUL PTR,2 >STACK
	ADD STACK,2 >BPTR
	GETB SRC,BPTR >STACK
	PUTB DEST,BPTR,STACK
	MUL PTR,2 >STACK
	ADD STACK,3 >BPTR
	GETB SRC,BPTR >STACK
	PUTB DEST,BPTR,STACK
	ADD PTR,P-LEXELEN >PTR
	IGRTR? 'CTR,MAX \?L1
	RTRUE

	.FUNCT INBUF-STUFF,DEST,SRC,CNT=-1
?L1:	IGRTR? 'CNT,59 /TRUE
	GETB SRC,CNT >STACK
	PUTB DEST,CNT,STACK
	JUMP ?L1

	.FUNCT INBUF-ADD,LEN,BEG,SLOT,DBEG,CTR=0,TMP,?TMP
	GET OOPS-TABLE,O-END >TMP
	ZERO? TMP /?L1
	SET 'DBEG,TMP
	JUMP ?L3
?L1:	GET OOPS-TABLE,O-LENGTH >TMP
	GETB AGAIN-LEXV,TMP >?TMP
	ADD TMP,1 >STACK
	GETB AGAIN-LEXV,STACK >STACK
	ADD ?TMP,STACK >DBEG
?L3:	ADD DBEG,LEN >STACK
	PUT OOPS-TABLE,O-END,STACK
?L4:	ADD BEG,CTR >STACK
	GETB P-INBUF,STACK >STACK
	ADD DBEG,CTR >STACK
	PUTB OOPS-INBUF,STACK,STACK
	INC 'CTR
	EQUAL? CTR,LEN \?L4
	PUTB AGAIN-LEXV,SLOT,DBEG
	SUB SLOT,1 >STACK
	PUTB AGAIN-LEXV,STACK,LEN
	RTRUE

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0,TIM=0,EXC=0,NOHYP?=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	EQUAL? CNT,7 \?L1
	SET 'NOHYP?,1
?L1:	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L4:	DLESS? 'CNT,0 /?L5
	GETB P-INBUF,BPTR >CHR
	ZERO? NOHYP? /?L9
	EQUAL? CNT,3 \?L9
	EQUAL? CHR,45 /?L9
	ZERO? TIM \FALSE
	SET 'EXC,SUM
	SET 'SUM,0
?L9:	EQUAL? CHR,58 \?L15
	ZERO? EXC \FALSE
	SET 'TIM,SUM
	SET 'SUM,0
	JUMP ?L26
?L15:	EQUAL? CHR,45 \?L20
	SET 'NOHYP?,0
	ZERO? TIM \FALSE
	SET 'EXC,SUM
	SET 'SUM,0
	JUMP ?L26
?L20:	GRTR? SUM,9999 \?L24
	SET 'SUM,10000
	JUMP ?L5
?L24:	LESS? CHR,58 \FALSE
	GRTR? CHR,47 \FALSE
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
?L26:	INC 'BPTR
	JUMP ?L4
?L5:	PUT P-LEXV,PTR,W?INTNUM
	PUT AGAIN-LEXV,PTR,W?INTNUM
	ZERO? EXC /?L27
	SET 'P-EXCHANGE,EXC
	JUMP ?L36
?L27:	ZERO? TIM /?L29
	SET 'P-EXCHANGE,0
	GRTR? TIM,23 /FALSE
	GRTR? TIM,19 /?L35
	GRTR? TIM,12 /FALSE
	GRTR? TIM,7 /?L35
	ADD 12,TIM >TIM
?L35:	MUL TIM,60 >STACK
	ADD SUM,STACK >SUM
	JUMP ?L36
?L29:	SET 'P-EXCHANGE,0
?L36:	SET 'P-NUMBER,SUM
	RETURN W?INTNUM

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,WRD,?TMP
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >WRD
	CALL WT?,WRD,PS?VERB,P1?VERB >?TMP
	GET P-OTBL,P-VERB >STACK
	EQUAL? ?TMP,STACK /?L3
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK /?L1
?L3:	SET 'ADJ,1
	JUMP ?L4
?L1:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L4
	ZERO? P-NCN \?L4
	PUT P-ITBL,P-VERB,0
	PUT P-ITBL,P-VERBN,0
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
	SET 'P-NCN,1
?L4:	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L6
	ZERO? ADJ \?L6
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L6:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L9
	GET P-ITBL,P-PREP1 >TEMP
	ZERO? TEMP /?L12
	GET P-OTBL,P-PREP1 >STACK
	EQUAL? TEMP,STACK \FALSE
?L12:	ZERO? ADJ /?L13
	ADD P-LEXV,2 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L15
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L15:	ZERO? P-NCN \?L21
	SET 'P-NCN,1
	JUMP ?L21
?L13:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
?L21:	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L42
?L9:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L23
	GET P-ITBL,P-PREP1 >TEMP
	ZERO? TEMP /?L26
	GET P-OTBL,P-PREP2 >STACK
	EQUAL? TEMP,STACK \FALSE
?L26:	ZERO? ADJ /?L29
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L29
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L29:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L42
?L23:	ZERO? P-ACLAUSE /?L42
	EQUAL? P-NCN,1 /?L35
	ZERO? ADJ \?L35
	SET 'P-ACLAUSE,0
	RFALSE
?L35:	GET P-ITBL,P-NC1 >BEG
	ZERO? ADJ /?L38
	ADD P-LEXV,2 >BEG
	SET 'ADJ,0
?L38:	GET P-ITBL,P-NC1L >END
?L41:	GET BEG,0 >WRD
	EQUAL? BEG,END \?L43
	ZERO? ADJ /?L45
	CALL CLAUSE-WIN,ADJ
	JUMP ?L42
?L45:	SET 'P-ACLAUSE,0
	RFALSE
?L43:	EQUAL? WRD,W?ALL,W?ONE /?L49
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE \?L48
	CALL ADJ-CHECK,WRD,ADJ >STACK
	ZERO? STACK /?L48
?L49:	SET 'ADJ,WRD
	JUMP ?L51
?L48:	EQUAL? WRD,W?ONE \?L50
	CALL CLAUSE-WIN,ADJ
	JUMP ?L42
?L50:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT \?L51
	ADD BEG,P-WORDLEN >STACK
	EQUAL? STACK,END \?L51
	EQUAL? WRD,P-ANAM \?L52
	CALL CLAUSE-WIN,ADJ
	JUMP ?L42
?L52:	CALL CLAUSE-WIN
	JUMP ?L42
?L51:	ADD BEG,P-WORDLEN >BEG
	ZERO? END \?L41
	SET 'END,BEG
	SET 'P-NCN,1
	SUB BEG,4 >STACK
	PUT P-ITBL,P-NC1,STACK
	PUT P-ITBL,P-NC1L,BEG
	JUMP ?L41
?L42:	GET P-OVTBL,0 >STACK
	PUT P-VTBL,0,STACK
	GETB P-OVTBL,2 >STACK
	PUTB P-VTBL,2,STACK
	GETB P-OVTBL,3 >STACK
	PUTB P-VTBL,3,STACK
	PUT P-OTBL,P-VERBN,P-VTBL
	PUTB P-VTBL,2,0
?L60:	IGRTR? 'CNT,P-ITBLLEN \?L62
	SET 'P-MERGED,1
	RTRUE
?L62:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L60

	.FUNCT CLAUSE-WIN,ADJ=0
	ZERO? ADJ /?L1
	GET P-OTBL,P-VERB >STACK
	PUT P-ITBL,P-VERB,STACK
	JUMP ?L3
?L1:	SET 'ADJ,1
?L3:	PUT P-CCTBL,CC-SBPTR,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-SEPTR,STACK
	EQUAL? P-ACLAUSE,P-NC1 \?L4
	PUT P-CCTBL,CC-OCLAUSE,P-OCL1
	JUMP ?L6
?L4:	PUT P-CCTBL,CC-OCLAUSE,P-OCL2
?L6:	CALL CLAUSE-COPY,P-OTBL,P-OTBL,ADJ
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L7
	SET 'P-NCN,2
?L7:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,MSG,?TMP
	PUT OOPS-TABLE,O-PTR,PTR
	CALL PICK-ONE,UNKNOWN-MSGS >MSG
	PRINTI "["
	GET MSG,0 >STACK
	PRINT STACK
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	GET MSG,1 >STACK
	PRINT STACK
	PRINTR "]"

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	CALL NOT-IN-SENTENCE,STR?18
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L4:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	GRTR? P-NCN,NUM /?L13
	LESS? NUM,1 /?L8
	ZERO? P-NCN \?L8
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L9
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L8
?L9:	SET 'DRIVE1,SYN
	JUMP ?L13
?L8:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L13
	EQUAL? NUM,2 \?L11
	EQUAL? P-NCN,1 \?L11
	SET 'DRIVE2,SYN
	JUMP ?L13
?L11:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L13
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L13:	DLESS? 'LEN,1 \?L16
	ZERO? DRIVE1 \?L49
	ZERO? DRIVE2 \?L5
	CALL DONT-UNDERSTAND
	RFALSE
?L16:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L4
?L5:	ZERO? DRIVE1 /?L23
?L49:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L23
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L23:	ZERO? DRIVE2 /?L25
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L25
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L25:	EQUAL? VERB,ACT?FIND \?L26
	PRINTI "That's your problem!"
	CRLF
	RFALSE
?L26:	EQUAL? WINNER,PLAYER \?L28
	CALL ORPHAN,DRIVE1,DRIVE2
	PRINTI "[Wh"
	JUMP ?L30
?L28:	PRINTI "[Your command wasn't complete. Next time, type wh"
?L30:	EQUAL? VERB,ACT?WALK,ACT?GO \?L31
	PRINTI "ere"
	JUMP ?L36
?L31:	ZERO? DRIVE1 /?L35
	GETB DRIVE1,P-SFWIM1 >STACK
	EQUAL? STACK,ACTORBIT /?L34
?L35:	ZERO? DRIVE2 /?L33
	GETB DRIVE2,P-SFWIM2 >STACK
	EQUAL? STACK,ACTORBIT \?L33
?L34:	PRINTI "om"
	JUMP ?L36
?L33:	PRINTI "at"
?L36:	EQUAL? WINNER,PLAYER \?L37
	PRINTI " do you want to "
	JUMP ?L39
?L37:	PRINTI " you want"
	CALL TPRINT,WINNER
	PRINTI " to "
?L39:	CALL VERB-PRINT
	ZERO? DRIVE2 /?L40
	CALL CLAUSE-PRINT,P-NC1,P-NC1L
?L40:	SET 'P-END-ON-PREP,0
	ZERO? DRIVE1 /?L43
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L45
?L43:	GETB DRIVE2,P-SPREP2 >STACK
?L45:	CALL PREP-PRINT,STACK
	EQUAL? WINNER,PLAYER \?L46
	SET 'P-OFLAG,1
	PRINTI "?]"
	CRLF
	RFALSE
?L46:	SET 'P-OFLAG,0
	PRINTI ".]"
	CRLF
	RFALSE

	.FUNCT VERB-PRINT,TMP
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	RTRUE
?L1:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L3
	GET TMP,0 >STACK
	PRINTB STACK
	RTRUE
?L3:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
	RTRUE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	ZERO? P-MERGED \?L1
	PUT P-OCL1,P-MATCHLEN,0
	PUT P-OCL2,P-MATCHLEN,0
?L1:	GET P-VTBL,0 >STACK
	PUT P-OVTBL,0,STACK
	GETB P-VTBL,2 >STACK
	PUTB P-OVTBL,2,STACK
	GETB P-VTBL,3 >STACK
	PUTB P-OVTBL,3,STACK
?L4:	IGRTR? 'CNT,P-ITBLLEN /?L5
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L4
?L5:	EQUAL? P-NCN,2 \?L9
	PUT P-CCTBL,CC-SBPTR,P-NC2
	PUT P-CCTBL,CC-SEPTR,P-NC2L
	PUT P-CCTBL,CC-OCLAUSE,P-OCL2
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L9:	LESS? P-NCN,1 /?L12
	PUT P-CCTBL,CC-SBPTR,P-NC1
	PUT P-CCTBL,CC-SEPTR,P-NC1L
	PUT P-CCTBL,CC-OCLAUSE,P-OCL1
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L12:	ZERO? D1 /?L15
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L15:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT CLAUSE-PRINT,BPTR,EPTR,THE?=1
	GET P-ITBL,EPTR >STACK
	GET P-ITBL,BPTR >STACK
	CALL BUFFER-PRINT,STACK,STACK,THE? >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=0,WRD,FIRST??=1,PN=0
?L1:	EQUAL? BEG,END /TRUE
	ZERO? NOSP /?L6
	SET 'NOSP,0
	JUMP ?L8
?L6:	PRINTI " "
?L8:	GET BEG,0 >WRD
	EQUAL? WRD,W?HIM \?L12
	CALL VISIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK /?L11
?L12:	EQUAL? WRD,W?HER \?L13
	CALL VISIBLE?,P-HER-OBJECT >STACK
	ZERO? STACK /?L11
?L13:	EQUAL? WRD,W?THEM \?L9
	CALL VISIBLE?,P-THEM-OBJECT >STACK
	ZERO? STACK \?L9
?L11:	SET 'PN,1
?L9:	EQUAL? WRD,W?$PERIOD \?L15
	SET 'NOSP,1
	JUMP ?L22
?L15:	EQUAL? WRD,W?ALL \?L17
	PRINTI "all"
	JUMP ?L22
?L17:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L19
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L18
?L19:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L18
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK \?L18
	SET 'NOSP,1
	JUMP ?L22
?L18:	EQUAL? WRD,W?ME \?L20
	CALL DPRINT,PLAYER
	SET 'PN,1
	JUMP ?L22
?L20:	CALL NAME?,WRD >STACK
	ZERO? STACK /?L21
	CALL CAPITALIZE,BEG
	SET 'PN,1
	JUMP ?L22
?L21:	ZERO? FIRST?? /?L23
	ZERO? PN \?L23
	ZERO? CP /?L23
	PRINTI "the "
?L23:	ZERO? P-OFLAG \?L28
	ZERO? P-MERGED /?L26
?L28:	PRINTB WRD
	JUMP ?L33
?L26:	EQUAL? WRD,W?IT \?L29
	CALL VISIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L29
	CALL DPRINT,P-IT-OBJECT
	JUMP ?L33
?L29:	EQUAL? WRD,W?HER \?L30
	ZERO? PN \?L30
	CALL DPRINT,P-HER-OBJECT
	JUMP ?L33
?L30:	EQUAL? WRD,W?THEM \?L31
	ZERO? PN \?L31
	CALL DPRINT,P-THEM-OBJECT
	JUMP ?L33
?L31:	EQUAL? WRD,W?HIM \?L32
	ZERO? PN \?L32
	CALL DPRINT,P-HIM-OBJECT
	JUMP ?L33
?L32:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L33:	SET 'FIRST??,0
?L22:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT NAME?,WRD
	EQUAL? WRD,W?MR,W?MRS,W?MISS /TRUE
	EQUAL? WRD,W?BUCK,W?PALACE,W?HERMAN /TRUE
	EQUAL? WRD,W?HILDEG,W?BURBAN,W?AUNT /TRUE
	EQUAL? WRD,W?COUSIN,W?UNCLE,W?BUDDY \FALSE
	RTRUE

	.FUNCT CAPITALIZE,PTR
	ZERO? P-OFLAG \?L3
	ZERO? P-MERGED /?L1
?L3:	GET PTR,0 >STACK
	PRINTB STACK
	RTRUE
?L1:	GETB PTR,3 >STACK
	GETB P-INBUF,STACK >STACK
	SUB STACK,32 >STACK
	PRINTC STACK
	GETB PTR,3 >STACK
	INC 'STACK
	GETB PTR,2 >STACK
	DEC 'STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT PREP-PRINT,PREP,SP?=1,WRD
	ZERO? PREP /FALSE
	ZERO? P-END-ON-PREP \FALSE
	ZERO? SP? /?L3
	PRINTI " "
?L3:	CALL PREP-FIND,PREP >WRD
	EQUAL? WRD,W?THROUGH \?L6
	PRINTI "through"
	JUMP ?L8
?L6:	PRINTB WRD
?L8:	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?SIT,STACK \?L9
	EQUAL? W?DOWN,WRD \?L9
	PRINTI " on"
?L9:	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?GET,STACK \TRUE
	EQUAL? W?OUT,WRD \TRUE
	PRINTI " of"
	RTRUE

	.FUNCT CLAUSE-COPY,SRC,DEST,INSRT=0,OCL,BEG,END,BB,EE,OBEG,CNT,B,E
	GET P-CCTBL,CC-SBPTR >BB
	GET P-CCTBL,CC-SEPTR >EE
	GET P-CCTBL,CC-OCLAUSE >OCL
	GET SRC,BB >BEG
	GET SRC,EE >END
	GET OCL,P-MATCHLEN >OBEG
?L1:	EQUAL? BEG,END /?L2
	ZERO? INSRT /?L6
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L6
	EQUAL? INSRT,1 \?L8
	GET P-ITBL,P-NC1 >B
	GET P-ITBL,P-NC1L >E
?L10:	EQUAL? B,E /?L19
	GET B,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD B,P-WORDLEN >B
	JUMP ?L10
?L8:	GET OCL,1 >STACK
	EQUAL? INSRT,STACK /?L16
	CALL CLAUSE-ADD,INSRT
?L16:	CALL CLAUSE-ADD,P-ANAM
	JUMP ?L19
?L6:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
?L19:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1
?L2:	EQUAL? SRC,DEST \?L20
	GRTR? OBEG,0 \?L20
	GET OCL,P-MATCHLEN >STACK
	SUB STACK,OBEG >CNT
	LESS? 0,CNT \?L20
	PUT OCL,P-MATCHLEN,0
	INC 'OBEG
?L22:	GET OCL,OBEG >STACK
	CALL CLAUSE-ADD,STACK,1
	SUB CNT,2 >CNT
	ZERO? CNT /?L23
	ADD OBEG,2 >OBEG
	JUMP ?L22
?L23:	SET 'OBEG,0
?L20:	MUL OBEG,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD OCL,STACK >STACK
	PUT DEST,BB,STACK
	GET OCL,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD OCL,STACK >STACK
	PUT DEST,EE,STACK
	RTRUE

	.FUNCT CLAUSE-ADD,WRD,CHECK?=0,OCL,PTR
	GET P-CCTBL,CC-OCLAUSE >OCL
	GET OCL,P-MATCHLEN >PTR
	ZERO? CHECK? /?L1
	ZERO? PTR /?L1
	CALL ZMEMQ,WRD,OCL >STACK
	ZERO? STACK \FALSE
?L1:	ADD PTR,2 >PTR
	SUB PTR,1 >STACK
	PUT OCL,STACK,WRD
	PUT OCL,PTR,0
	PUT OCL,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-FIND,PREP,CNT=0,SIZE
	GET PREPOSITIONS,0 >STACK
	MUL STACK,2 >SIZE
?L1:	IGRTR? 'CNT,SIZE /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L1
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ
	EQUAL? GBIT,RLANDBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	PRINTI "["
	CALL PREP-PRINT,PREP,0 >STACK
	ZERO? STACK /?L8
	CALL TPRINT,OBJ
	JUMP ?L10
?L8:	CALL DPRINT,OBJ
?L10:	PRINTI "]"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,PTR
	GET P-ITBL,P-NC1 >PTR
	ZERO? PTR /?L5
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /?L5
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L5:	GET P-ITBL,P-NC2 >PTR
	ZERO? PTR /TRUE
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSI,P-MATCHLEN >STACK
	EQUAL? STACK,1 \?L14
	CALL BUT-MERGE,P-PRSO >P-PRSO
	RTRUE
?L14:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,BUT=0,LEN,WV,WRD,NW,WAS-ALL?=0,ONEOBJ
	SET 'P-AND,0
	EQUAL? P-GETFLAGS,P-ALL \?L1
	SET 'WAS-ALL?,1
?L1:	SET 'P-GETFLAGS,0
	PUT P-BUTS,P-MATCHLEN,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WRD
?L4:	EQUAL? PTR,EPTR \?L6
?L58:	ZERO? BUT /?L9
	PUSH BUT
	JUMP ?L8
?L9:	PUSH TBL
?L8:	CALL GET-OBJECT,STACK >WV
	ZERO? WAS-ALL? /?L10
	SET 'P-GETFLAGS,P-ALL
?L10:	RETURN WV
?L6:	ADD PTR,P-WORDLEN >STACK
	EQUAL? EPTR,STACK \?L14
	SET 'NW,0
	JUMP ?L16
?L14:	GET PTR,P-LEXELEN >NW
?L16:	EQUAL? WRD,W?ALL,W?BOTH,W?EVERYTHING \?L17
	SET 'P-GETFLAGS,P-ALL
	EQUAL? NW,W?OF \?L53
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L53
?L17:	EQUAL? WRD,W?BUT,W?EXCEPT \?L22
	ZERO? BUT /?L26
	PUSH BUT
	JUMP ?L25
?L26:	PUSH TBL
?L25:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,P-BUTS
	PUT BUT,P-MATCHLEN,0
	JUMP ?L53
?L22:	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	EQUAL? WRD,W?A \?L28
	ZERO? P-ADJ \?L29
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L53
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L53
?L29:	SET 'P-NAM,ONEOBJ
	ZERO? BUT /?L38
	PUSH BUT
	JUMP ?L37
?L38:	PUSH TBL
?L37:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L53
?L28:	EQUAL? WRD,W?AND,W?$COMMA \?L41
	EQUAL? NW,W?AND,W?$COMMA /?L41
	SET 'P-AND,1
	ZERO? BUT /?L45
	PUSH BUT
	JUMP ?L44
?L45:	PUSH TBL
?L44:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L53
?L41:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L53
	EQUAL? WRD,W?AND,W?$COMMA /?L53
	EQUAL? WRD,W?OF \?L48
	ZERO? P-GETFLAGS \?L53
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L53
?L48:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L52
	CALL ADJ-CHECK,WRD,P-ADJ >STACK
	ZERO? STACK /?L52
	SET 'P-ADJ,WV
	SET 'P-ADJN,WRD
	JUMP ?L53
?L52:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L53
	SET 'P-NAM,WRD
	SET 'ONEOBJ,WRD
?L53:	EQUAL? PTR,EPTR /?L58
	ADD PTR,P-WORDLEN >PTR
	SET 'WRD,NW
	JUMP ?L4

	.FUNCT ADJ-CHECK,WRD,ADJ
	ZERO? ADJ /TRUE
	EQUAL? WRD,W?COPY,W?FILM,W?SLIDE /TRUE
	EQUAL? WRD,W?FIRST,W?SECOND,W?THIRD /TRUE
	EQUAL? WRD,W?SAWED,W?RED,W?WHITE /TRUE
	EQUAL? WRD,W?BLUE,W?ORANGE,W?YELLOW /TRUE
	EQUAL? WRD,W?GREEN /TRUE
	EQUAL? WRD,W?INDIGO,W?VIOLET \FALSE
	RTRUE

	.FUNCT GET-OBJECT,TBL,VRB=1,BTS,LEN,XBITS,TLEN,GCHECK=0,OLEN=0,OBJ,ADJ,X
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	SET 'ADJ,P-ADJN
	ZERO? P-NAM \?L11
	ZERO? P-ADJ /?L8
	CALL WT?,P-ADJN,PS?OBJECT >STACK
	ZERO? STACK /?L6
	SET 'P-NAM,P-ADJN
	SET 'P-ADJ,0
	JUMP ?L8
?L6:	CALL WT?,P-ADJN,PS?DIRECTION,P1?DIRECTION >BTS
	ZERO? BTS /?L8
	SET 'P-ADJ,0
	PUT TBL,P-MATCHLEN,1
	PUT TBL,1,INTDIR
	SET 'P-DIRECTION,BTS
	RTRUE
?L8:	ZERO? P-NAM \?L11
	ZERO? P-ADJ \?L11
	EQUAL? P-GETFLAGS,P-ALL /?L69
	ZERO? P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	CALL NOT-IN-SENTENCE,STR?19
	RFALSE
?L11:	EQUAL? P-GETFLAGS,P-ALL \?L19
?L69:	ZERO? P-SLOCBITS \?L17
?L19:	SET 'P-SLOCBITS,-1
?L17:	SET 'P-TABLE,TBL
?L21:	ZERO? GCHECK /?L23
	CALL GLOBAL-CHECK,TBL
	JUMP ?L25
?L23:	ZERO? LIT /?L26
	FCLEAR PLAYER,TRANSBIT
	CALL DO-SL,HERE,SOG,SIR
	FSET PLAYER,TRANSBIT
?L26:	CALL DO-SL,PLAYER,SH,SC
?L25:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL /?L67
	BTST P-GETFLAGS,P-ONE \?L31
	ZERO? LEN /?L31
	EQUAL? LEN,1 /?L32
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "[How about"
	GET TBL,1 >STACK
	CALL TPRINT,STACK
	PRINTI "?]"
	CRLF
?L32:	PUT TBL,P-MATCHLEN,1
	JUMP ?L67
?L31:	GRTR? LEN,1 /?L36
	ZERO? LEN \?L67
	EQUAL? P-SLOCBITS,-1 /?L35
?L36:	EQUAL? P-SLOCBITS,-1 \?L37
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L21
?L37:	ZERO? LEN \?L40
	SET 'LEN,OLEN
?L40:	ZERO? P-NAM /?L43
	ADD TLEN,1 >STACK
	GET TBL,STACK >OBJ
	ZERO? OBJ /?L43
	GETP OBJ,P?GENERIC >STACK
	CALL STACK >OBJ
	ZERO? OBJ /?L43
	EQUAL? OBJ,NOT-HERE-OBJECT /FALSE
	PUT TBL,1,OBJ
	PUT TBL,P-MATCHLEN,1
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	RTRUE
?L43:	ZERO? VRB /?L55
	EQUAL? WINNER,PLAYER /?L50
	PRINTI "[Please try saying that another way.]"
	CRLF
	RFALSE
?L50:	ZERO? VRB /?L55
	ZERO? P-NAM /?L51
	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L52
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L54
?L52:	SET 'P-ACLAUSE,P-NC2
?L54:	SET 'P-AADJ,P-ADJ
	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L55
?L51:	ZERO? VRB /?L55
	CALL NOT-IN-SENTENCE,STR?19
?L55:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L35:	ZERO? LEN \?L67
	ZERO? GCHECK /?L57
	ZERO? VRB /?L65
	SET 'P-SLOCBITS,XBITS
	ZERO? LIT \?L62
	CALL SPEAKING-VERB? >STACK
	ZERO? STACK /?L60
?L62:	CALL OBJ-FOUND,NOT-HERE-OBJECT,TBL
	SET 'P-XNAM,P-NAM
	SET 'P-NAM,0
	SET 'P-XADJ,P-ADJ
	SET 'P-XADJN,P-ADJN
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	RTRUE
?L60:	CALL TOO-DARK
?L65:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L57:	ZERO? LEN \?L67
	SET 'GCHECK,1
	JUMP ?L21
?L67:	ADD TLEN,1 >STACK
	GET TBL,STACK >X
	SET 'P-SLOCBITS,XBITS
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE

	.FUNCT SPEAKING-VERB?,V=0
	ZERO? V \?L1
	SET 'V,PRSA
?L1:	EQUAL? V,V?ASK-ABOUT,V?ASK-FOR,V?HELLO /TRUE
	EQUAL? V,V?TELL,V?QUESTION,V?REPLY \FALSE
	RTRUE

	.FUNCT MOBY-FIND,TBL,OBJ=1,LEN,FOO
	SET 'P-NAM,P-XNAM
	SET 'P-ADJ,P-XADJ
	PUT TBL,P-MATCHLEN,0
	GETB 0,18 >STACK
	ZERO? STACK /?L1
?L3:	CALL META-LOC,OBJ >FOO
	ZERO? FOO /?L5
	CALL THIS-IT?,OBJ >FOO
	ZERO? FOO /?L5
	CALL OBJ-FOUND,OBJ,TBL >FOO
?L5:	IGRTR? 'OBJ,DUMMY-OBJECT \?L3
	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L11
	GET TBL,1 >P-MOBY-FOUND
?L11:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RETURN LEN
?L1:	SET 'P-MOBY-FLAG,1
	SET 'P-TABLE,TBL
	SET 'P-SLOCBITS,-1
	FIRST? ROOMS >FOO \?L17
?L18:	CALL SEARCH-LIST,FOO,TBL,P-SRCALL
	NEXT? FOO >FOO /?L18
?L17:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L22
	CALL DO-SL,LOCAL-GLOBALS,1,1
?L22:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L25
	CALL DO-SL,ROOMS,1,1
?L25:	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L28
	GET TBL,1 >P-MOBY-FOUND
?L28:	SET 'P-MOBY-FLAG,0
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RETURN LEN

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	SET 'RLEN,LEN
	PRINTI "[Which"
	EQUAL? P-NAM,W?PLANK \?L1
	PRINTI " end"
	JUMP ?L6
?L1:	ZERO? P-OFLAG \?L4
	ZERO? P-MERGED \?L4
	ZERO? P-AND /?L3
?L4:	PRINTI " "
	PRINTB P-NAM
	JUMP ?L6
?L3:	EQUAL? TBL,P-PRSO \?L5
	CALL CLAUSE-PRINT,P-NC1,P-NC1L,0
	JUMP ?L6
?L5:	CALL CLAUSE-PRINT,P-NC2,P-NC2L,0
?L6:	PRINTI " do you mean,"
?L7:	INC 'TLEN
	GET TBL,TLEN >OBJ
	CALL TPRINT,OBJ
	EQUAL? LEN,2 \?L9
	EQUAL? RLEN,2 /?L11
	PRINTI ","
?L11:	PRINTI " or"
	JUMP ?L14
?L9:	GRTR? LEN,2 \?L14
	PRINTI ","
?L14:	DLESS? 'LEN,1 \?L7
	PRINTR "?]"

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS,FOO
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	FIRST? OBJ >STACK \?L5
	CALL SEARCH-LIST,OBJ,TBL,P-SRCALL
?L5:	CALL THIS-IT?,OBJ >STACK
	ZERO? STACK /?L8
	CALL OBJ-FOUND,OBJ,TBL
?L8:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETP HERE,P?THINGS >RMG
	ZERO? RMG /?L18
	GET RMG,0 >RMGL
	SET 'CNT,0
?L17:	ZERO? P-NAM /?L19
	ADD CNT,1 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L22
?L19:	ZERO? P-ADJ /?L21
	ADD CNT,2 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-ADJN,STACK \?L22
?L21:	ZERO? P-NAM \?L23
	ZERO? P-ADJ /?L22
?L23:	SET 'LAST-PSEUDO-LOC,HERE
	ADD CNT,3 >STACK
	GET RMG,STACK >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	GETPT PSEUDO-OBJECT,P?ACTION >STACK
	SUB STACK,5 >FOO
	ADD CNT,1 >STACK
	GET RMG,STACK >RMG
	GET RMG,0 >STACK
	PUT FOO,0,STACK
	GET RMG,1 >STACK
	PUT FOO,1,STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L18
?L22:	ADD CNT,3 >CNT
	LESS? CNT,RMGL /?L17
?L18:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	GET TBL,P-MATCHLEN >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?LOOK-INSIDE,V?CHASTISE,V?EXAMINE /?L35
	EQUAL? PRSA,V?LEAVE,V?FOLLOW,V?FIND /?L35
	EQUAL? PRSA,V?ENTER,V?SMELL,V?SEARCH /?L35
	EQUAL? PRSA,V?LOOK-ON,V?WAIT-FOR,V?WALK-TO \FALSE
?L35:	CALL DO-SL,ROOMS,1,1 >STACK
	RSTACK

	.FUNCT DO-SL,OBJ,BIT1,BIT2,BITS
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL
	FIRST? OBJ >OBJ \FALSE
?L3:	EQUAL? LVL,P-SRCBOT /?L5
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L5
	CALL THIS-IT?,OBJ >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	EQUAL? LVL,P-SRCTOP \?L10
	FSET? OBJ,SEARCHBIT /?L10
	FSET? OBJ,SURFACEBIT \?L8
?L10:	FIRST? OBJ >STACK \?L8
	CALL SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /?L8
	FSET? OBJ,SURFACEBIT \?L11
	PUSH P-SRCALL
	JUMP ?L14
?L11:	FSET? OBJ,SEARCHBIT \?L13
	PUSH P-SRCALL
	JUMP ?L14
?L13:	PUSH P-SRCTOP
?L14:	CALL SEARCH-LIST,OBJ,TBL,STACK
?L8:	NEXT? OBJ >OBJ /?L3
	RTRUE

	.FUNCT THIS-IT?,OBJ,SYNS
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	ZERO? P-ADJ /?L5
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DEC 'STACK
	CALL ZMEMQB,P-ADJ,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L5:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,BITS,PTR,OBJ,TAKEN
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST BITS,SHAVE /?L3
	BTST BITS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L9
	ZERO? P-IT-OBJECT /?L13
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK \?L11
?L13:	CALL REFERRING
	RFALSE
?L11:	SET 'OBJ,P-IT-OBJECT
	JUMP ?L29
?L9:	EQUAL? OBJ,HER \?L15
	ZERO? P-HER-OBJECT /?L18
	CALL ACCESSIBLE?,P-HER-OBJECT >STACK
	ZERO? STACK \?L16
?L18:	CALL REFERRING
	RFALSE
?L16:	SET 'OBJ,P-HER-OBJECT
	JUMP ?L29
?L15:	EQUAL? OBJ,HIM \?L20
	ZERO? P-HIM-OBJECT /?L23
	CALL ACCESSIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK \?L21
?L23:	CALL REFERRING
	RFALSE
?L21:	SET 'OBJ,P-HIM-OBJECT
	JUMP ?L29
?L20:	EQUAL? OBJ,THEM \?L29
	ZERO? P-THEM-OBJECT /?L28
	CALL ACCESSIBLE?,P-THEM-OBJECT >STACK
	ZERO? STACK \?L26
?L28:	CALL REFERRING
	RFALSE
?L26:	SET 'OBJ,P-THEM-OBJECT
?L29:	CALL ULTIMATELY-IN?,OBJ >STACK
	ZERO? STACK \?L3
	EQUAL? OBJ,HANDS,YOUR-FEET /?L3
	SET 'PRSO,OBJ
	FSET? OBJ,TRYTAKEBIT \?L33
	SET 'TAKEN,1
	JUMP ?L39
?L33:	CALL ULTIMATELY-IN?,OBJ,BUCKET >STACK
	ZERO? STACK /?L35
	ZERO? BUCKET-PEG /?L35
	SET 'TAKEN,1
	JUMP ?L39
?L35:	EQUAL? WINNER,PLAYER /?L36
	SET 'TAKEN,0
	JUMP ?L39
?L36:	BTST BITS,STAKE \?L37
	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \?L37
	SET 'TAKEN,0
	JUMP ?L39
?L37:	EQUAL? PRSA,V?PUT \?L38
	EQUAL? OBJ,WATER /TRUE
?L38:	SET 'TAKEN,1
?L39:	ZERO? TAKEN /?L53
	BTST BITS,SHAVE \?L40
	PRINTI "[You don't seem to be holding"
	GET TBL,P-MATCHLEN >STACK
	LESS? 1,STACK \?L42
	PRINTI " all those things"
	JUMP ?L45
?L42:	EQUAL? OBJ,NOT-HERE-OBJECT \?L44
	PRINTI " that"
	JUMP ?L45
?L44:	CALL THIS-IS-IT,OBJ
	CALL TPRINT,OBJ
?L45:	PRINTI "!]"
	CRLF
	RFALSE
?L40:	ZERO? TAKEN \?L3
?L53:	EQUAL? WINNER,PLAYER \?L3
	PRINTI "[taking"
	CALL TPRINT,PRSO
	ZERO? ITAKE-LOC /?L47
	PRINTI " from"
	CALL TPRINT,ITAKE-LOC
?L47:	PRINTI " first]"
	CRLF
	JUMP ?L3

	.FUNCT MANY-CHECK,LOSS=0,TMP
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	PRINTI "["
	PRINT YOU-CANT
	PRINTI "use more than one object at a time with """
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L7
	PRINTI "tell"
	JUMP ?L11
?L7:	ZERO? P-OFLAG \?L10
	ZERO? P-MERGED /?L9
?L10:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L11
?L9:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L11:	PRINTI ".""]"
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK \?L9
	ADD CNT,1 >STACK
	RSTACK
?L9:	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK \?L3
	ZERO? CNT /TRUE
	RETURN CNT
?L3:	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT LIT?,RM,OHERE,LIT?1=0,OGWIM=0
	SET 'OHERE,HERE
	SET 'HERE,RM
	FSET? RM,ONBIT \?L1
	SET 'LIT?1,1
	JUMP ?L12
?L1:	EQUAL? RM,ON-POOL-1 \?L3
	CALL LIT?,BOAT-DOCK >STACK
	ZERO? STACK /?L3
	SET 'LIT?1,1
	JUMP ?L12
?L3:	EQUAL? RM,ON-POOL-2 \?L4
	CALL LIT?,LEDGE >STACK
	ZERO? STACK /?L4
	SET 'LIT?1,1
	JUMP ?L12
?L4:	SET 'OGWIM,P-GWIMBIT
	SET 'P-GWIMBIT,ONBIT
	PUT P-MERGE,P-MATCHLEN,0
	SET 'P-TABLE,P-MERGE
	SET 'P-SLOCBITS,-1
	EQUAL? OHERE,RM \?L8
	CALL DO-SL,WINNER,1,1
	EQUAL? WINNER,PLAYER /?L8
	IN? PLAYER,RM \?L8
	CALL DO-SL,PLAYER,1,1
?L8:	CALL DO-SL,RM,1,1
	GET P-TABLE,P-MATCHLEN >STACK
	GRTR? STACK,0 \?L12
	SET 'LIT?1,1
?L12:	SET 'HERE,OHERE
	SET 'P-GWIMBIT,OGWIM
	RETURN LIT?1

	.FUNCT PICK-ONE,FROB,THIS=0,L,CNT,RND,MSG,RFROB
	GET FROB,0 >L
	GET FROB,1 >CNT
	DEC 'L
	ADD FROB,2 >FROB
	MUL CNT,2 >STACK
	ADD FROB,STACK >RFROB
	ZERO? THIS /?L1
	ZERO? CNT \?L1
	SET 'RND,THIS
	JUMP ?L3
?L1:	SUB L,CNT >STACK
	RANDOM STACK >RND
?L3:	GET RFROB,RND >MSG
	GET RFROB,1 >STACK
	PUT RFROB,RND,STACK
	PUT RFROB,1,MSG
	INC 'CNT
	EQUAL? CNT,L \?L4
	SET 'CNT,0
?L4:	PUT FROB,0,CNT
	RETURN MSG

	.FUNCT PICK-REMOVE,OBJ,FROB,L,CNT,RND,MSG,RFROB,ROBJ
	GET FROB,0 >L
	GET FROB,1 >CNT
	DEC 'L
	ADD FROB,2 >FROB
	ADD CNT,1 >STACK
	MUL STACK,2 >STACK
	ADD FROB,STACK >RFROB
	SUB L,CNT >STACK
	CALL ZMEMQ,OBJ,RFROB,STACK >RND
	ZERO? RND /FALSE
	DEC 'RND
	GET RFROB,RND >MSG
	GET RFROB,0 >STACK
	PUT RFROB,RND,STACK
	PUT RFROB,0,MSG
	INC 'CNT
	EQUAL? CNT,L \?L3
	SET 'CNT,0
?L3:	PUT FROB,0,CNT
	RETURN MSG

	.FUNCT DONT-HAVE?,OBJ,WHERE
	LOC OBJ >WHERE
	EQUAL? WHERE,PLAYER /FALSE
	IN? WHERE,PLAYER \?L3
	PRINTI "You'll have to take"
	CALL TPRINT,OBJ
	PRINTI " "
	FSET? WHERE,CONTBIT \?L4
	PRINTI "out"
	JUMP ?L6
?L4:	PRINTI "off"
?L6:	PRINTI " of"
	CALL TPRINT,WHERE
	PRINTR " first."
?L3:	CALL NOT-HOLDING,OBJ
	RTRUE

	.FUNCT NOT-HOLDING,OBJ=0
	PRINTI "You're not holding"
	ZERO? OBJ /?L1
	CALL TPRINT,OBJ
	JUMP ?L3
?L1:	PRINTI " that"
?L3:	PRINTR "."

	.FUNCT ASKING?,ACTOR
	EQUAL? PRSA,V?QUESTION,V?ASK-FOR,V?ASK-ABOUT \FALSE
	EQUAL? PRSO,ACTOR \FALSE
	RTRUE

	.FUNCT TALKING-TO?,ACTOR
	CALL ASKING?,ACTOR >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?WAVE-AT,V?HELLO,V?TELL /?L4
	EQUAL? PRSA,V?ALARM,V?REPLY \FALSE
?L4:	EQUAL? PRSO,ACTOR \FALSE
	RTRUE

	.FUNCT TOUCHING?,THING
	EQUAL? PRSA,V?TAKE,V?RUB,V?SHAKE /TRUE
	EQUAL? PRSA,V?SWING,V?CLEAN,V?PUT /TRUE
	EQUAL? PRSA,V?PUT-ON,V?MOVE,V?PULL /TRUE
	EQUAL? PRSA,V?PUSH,V?PUT-UNDER,V?PUT-BEHIND /TRUE
	EQUAL? PRSA,V?SMELL,V?KISS,V?BURN /TRUE
	CALL HURT?,THING >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT HURT?,THING
	EQUAL? PRSA,V?MUNG,V?KICK,V?KILL /?L3
	EQUAL? PRSA,V?KNOCK,V?SQUEEZE,V?CUT /?L3
	EQUAL? PRSA,V?BITE,V?RAPE,V?SHAKE \?L1
?L3:	EQUAL? PRSO,THING /TRUE
?L1:	EQUAL? PRSA,V?THROW \FALSE
	EQUAL? PRSI,THING \FALSE
	RTRUE

	.FUNCT ANYONE-HERE?,OBJ
	FIRST? HERE >OBJ /?L4
	RETURN OBJ
?L4:	FSET? OBJ,ACTORBIT \?L6
	EQUAL? OBJ,PLAYER /?L6
	RETURN OBJ
?L6:	NEXT? OBJ >OBJ /?L4
	RETURN OBJ

	.FUNCT GETTING-INTO?
	EQUAL? PRSA,V?WALK-TO,V?ENTER,V?SIT /TRUE
	EQUAL? PRSA,V?STAND-ON,V?LIE-DOWN,V?CLIMB-UP /TRUE
	EQUAL? PRSA,V?CLIMB-ON,V?LEAP /TRUE
	EQUAL? PRSA,V?SWIM,V?WEAR,V?WALK-AROUND \FALSE
	RTRUE

	.FUNCT SAY-THE,THING
	PRINTI "The "
	CALL DPRINT,THING
	RTRUE

	.FUNCT BUT-THE,THING
	PRINTI "But"
	CALL TPRINT,THING
	PRINTI " "
	RTRUE

	.FUNCT MOVING?,THING
	EQUAL? PRSA,V?MOVE,V?PULL,V?PUSH /?L3
	EQUAL? PRSA,V?TAKE,V?TURN,V?PUSH-TO /?L3
	EQUAL? PRSA,V?RAISE,V?SHAKE \FALSE
?L3:	EQUAL? PRSO,THING \FALSE
	RTRUE

	.FUNCT NOT-HERE-OBJECT-F,TBL,PRSO?=1,OBJ
	EQUAL? PRSO,NOT-HERE-OBJECT \?L3
	EQUAL? PRSI,NOT-HERE-OBJECT \?L1
	PRINTR "Those things aren't here!"
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L3
	SET 'TBL,P-PRSO
	JUMP ?L4
?L3:	SET 'TBL,P-PRSI
	SET 'PRSO?,0
?L4:	ZERO? PRSO? /?L5
	EQUAL? PRSA,V?FIND,V?FOLLOW,V?BUY /?L9
	EQUAL? PRSA,V?WAIT-FOR,V?WALK-TO /?L9
	EQUAL? PRSA,V?TAKE \?L20
	EQUAL? WINNER,PLAYER /?L20
?L9:	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT /?L20
	RETURN 2
?L5:	EQUAL? PRSA,V?TELL,V?ASK-ABOUT,V?ASK-FOR /FALSE
?L20:	PRINT YOU-CANT
	PRINTI "see"
	CALL NAME?,P-XNAM >STACK
	ZERO? STACK \?L23
	PRINTI " any"
?L23:	CALL NOT-HERE-PRINT,PRSO?
	PRINTI " here!"
	CRLF
	CALL PCLEAR
	RETURN 2

	.FUNCT FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ
	CALL MOBY-FIND,TBL >M-F
	ZERO? DEBUG /?L1
	PRINTI "[Found "
	PRINTN M-F
	PRINTI " obj]"
	CRLF
?L1:	EQUAL? 1,M-F \?L4
	ZERO? DEBUG /?L6
	PRINTI "[Namely:"
	CALL DPRINT,P-MOBY-FOUND
	PRINTI "]"
	CRLF
?L6:	ZERO? PRSO? /?L9
	SET 'PRSO,P-MOBY-FOUND
	RFALSE
?L9:	SET 'PRSI,P-MOBY-FOUND
	RFALSE
?L4:	ZERO? PRSO? \?L12
	PRINTI "You wouldn't find any"
	CALL NOT-HERE-PRINT,PRSO?
	PRINTR " there."
?L12:	RETURN NOT-HERE-OBJECT

	.FUNCT NOT-HERE-PRINT,PRSO?=0
	ZERO? P-OFLAG \?L3
	ZERO? P-MERGED /?L1
?L3:	ZERO? P-XADJ /?L4
	PRINTI " "
	PRINTB P-XADJN
?L4:	ZERO? P-XNAM /FALSE
	PRINTI " "
	PRINTB P-XNAM
	RTRUE
?L1:	ZERO? PRSO? /?L10
	GET P-ITBL,P-NC1L >STACK
	GET P-ITBL,P-NC1 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK
?L10:	GET P-ITBL,P-NC2L >STACK
	GET P-ITBL,P-NC2 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK

	.FUNCT MOVE-ALL,FROM,TO=0,OBJ,NXT
	FIRST? FROM >OBJ /?L14
	RTRUE
?L1:	ZERO? OBJ /TRUE
?L14:	NEXT? OBJ >NXT /?L6
?L6:	FCLEAR OBJ,WORNBIT
	EQUAL? OBJ,FUSE /?L11
	ZERO? TO /?L9
	MOVE OBJ,TO
	JUMP ?L11
?L9:	REMOVE OBJ
?L11:	SET 'OBJ,NXT
	JUMP ?L1

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,TBL
	GETPT OBJ2,P?GLOBAL >TBL
	ZERO? TBL /FALSE
	PTSIZE TBL >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,TBL,STACK >STACK
	RSTACK

	.FUNCT WHAT-A-CONCEPT
	PRINTR "What a concept!"

	.FUNCT YOU-DONT-NEED,THING,STRING?=0
	PRINTI "[You don't need to refer to"
	ZERO? STRING? /?L1
	CALL TPRINT,THING
	JUMP ?L3
?L1:	CALL TPRINT,THING
?L3:	PRINTR " that way to finish this story.]"

	.FUNCT ITS-CLOSED,OBJ
	CALL THIS-IS-IT,OBJ
	CALL SAY-THE,OBJ
	CALL IS-CLOSED
	CRLF
	RTRUE

	.FUNCT IS-CLOSED
	PRINTI " is closed."
	RTRUE

	.FUNCT CANT-USE,PTR,BUF,?TMP
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	PRINTI "[This story can't understand the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTR """ when you use it that way.]"

	.FUNCT DONT-UNDERSTAND
	PRINTR "[That sentence didn't make sense. Please reword it or try something else.]"

	.FUNCT NOT-IN-SENTENCE,STR
	PRINTI "[There aren't "
	PRINT STR
	PRINTR " in that sentence!]"

	.FUNCT LIGHTS-F
	FSET? HERE,OUTDOORSBIT /?L4
	FSET? HERE,CAVEBIT /?L4
	EQUAL? HERE,CRAWL-SPACE-NORTH,CRAWL-SPACE-SOUTH,FIRST-SECRET-ROOM /?L4
	EQUAL? HERE,FIREPLACE,CHIMNEY-1,CHIMNEY-2 /?L4
	EQUAL? HERE,CHIMNEY-3 \?L1
?L4:	CALL CANT-SEE-ANY,LIGHTS >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LAMP-ON \FALSE
	PRINTR "You flip the switch but nothing happens. It seems the light bulbs are missing."

	.FUNCT GROUND-F
	CALL GETTING-INTO? >STACK
	ZERO? STACK \?L3
	EQUAL? PRSA,V?LOOK-BEHIND \?L1
?L3:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-UNDER \?L4
	PRINTR "Nothing but dirt."
?L4:	CALL HURT?,GROUND >STACK
	ZERO? STACK \?L6
	CALL MOVING?,GROUND >STACK
	ZERO? STACK /?L5
?L6:	CALL SAY-THE,GROUND
	PRINTR " is not affected."
?L5:	CALL TALKING-TO?,GROUND >STACK
	ZERO? STACK \?L8
	EQUAL? PRSA,V?YELL \FALSE
?L8:	PRINTI "Talking to"
	CALL TPRINT,GROUND
	CALL SIGN-OF-COLLAPSE
	RETURN 2

	.FUNCT MAZE-HOLE-F
	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "There's nothing but dirt in the hole."

	.FUNCT WALLS-F
	FSET? HERE,OUTDOORSBIT \?L1
	CALL CANT-SEE-ANY,WALLS
	RETURN 2
?L1:	CALL GETTING-INTO? >STACK
	ZERO? STACK \?L6
	EQUAL? PRSA,V?LOOK-BEHIND \?L5
?L6:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L5:	EQUAL? PRSA,V?LOOK-UNDER \?L7
	PRINTR "There's a floor there."
?L7:	CALL HURT?,WALLS >STACK
	ZERO? STACK \?L9
	CALL MOVING?,WALLS >STACK
	ZERO? STACK /?L8
?L9:	EQUAL? PRSA,V?THROW \?L10
	EQUAL? PRSO,FINCH /FALSE
?L10:	CALL SAY-THE,WALLS
	PRINTR " is not affected."
?L8:	CALL TALKING-TO?,WALLS >STACK
	ZERO? STACK \?L14
	EQUAL? PRSA,V?YELL \?L13
?L14:	PRINTI "Talking to walls"
	CALL SIGN-OF-COLLAPSE
	RETURN 2
?L13:	EQUAL? PRSA,V?EXAMINE /FALSE
	CALL YOU-DONT-NEED,WALLS
	RETURN 2

	.FUNCT CEILING-F
	FSET? HERE,OUTDOORSBIT \?L1
	CALL CANT-SEE-ANY,CEILING
	RETURN 2
?L1:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	CALL V-LOOK
	RTRUE

	.FUNCT HANDS-F
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,HANDS \FALSE
	CALL PERFORM,V?REACH-IN,PRSI
	RTRUE

	.FUNCT YOUR-FEET-F
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,SKIS \FALSE
	CALL PERFORM,V?WEAR,SKIS
	RTRUE

	.FUNCT ME-F,CONTEXT=0,OLIT
	EQUAL? PRSA,V?ALARM \?L1
	PRINTR "You're already wide awake."
?L1:	CALL TALKING-TO?,ME >STACK
	ZERO? STACK \?L4
	EQUAL? PRSA,V?YELL \?L3
?L4:	CALL TALK-TO-SELF
	RETURN 2
?L3:	EQUAL? PRSA,V?LISTEN \?L7
	PRINT YOU-CANT
	PRINTR "help doing that."
?L7:	EQUAL? PRSA,V?GIVE \?L8
	EQUAL? PRSI,ME \?L8
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L9
	PRINTR "You already have it."
?L9:	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L8:	EQUAL? PRSA,V?KILL \?L12
	PRINTI "Desperate? Call the Samaritans."
	CRLF
	CALL PRINT-ID,STR?20
	RTRUE
?L12:	EQUAL? PRSA,V?FIND \?L13
	PRINTR "You're right here!"
?L13:	CALL HURT?,ME >STACK
	ZERO? STACK /FALSE
	PRINTI "Punishing yourself that way won't help matters."
	CRLF
	CALL PRINT-ID,STR?21
	RTRUE

	.FUNCT TALK-TO-SELF
	PRINTI "Talking to yourself"
	CALL SIGN-OF-COLLAPSE
	CALL PCLEAR >STACK
	RSTACK

	.FUNCT SIGN-OF-COLLAPSE
	PRINTR " is said to be a sign of impending mental collapse."

	.FUNCT GLOBAL-ROOM-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE,V?LOOK \?L1
	CALL V-LOOK
	RTRUE
?L1:	EQUAL? PRSA,V?EXIT,V?DROP,V?ENTER \?L3
	CALL V-WALK-AROUND >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?SEARCH \?L4
	PRINTR "You find nothing new."
?L4:	EQUAL? PRSA,V?WALK-AROUND \FALSE
	PRINTR "Walking around the area reveals nothing new.

(If you want to go somewhere, just type a direction.)"

	.FUNCT CANT-SEE-ANY,THING=0,STRING?=0
	CALL YOU-CANT-SEE
	ZERO? STRING? /?L1
	PRINT THING
	JUMP ?L7
?L1:	ZERO? THING /?L3
	FSET? THING,NARTICLEBIT /?L4
	PRINTI "any "
?L4:	CALL DPRINT,THING
	JUMP ?L7
?L3:	PRINTI "that"
?L7:	PRINTR " here!"

	.FUNCT YOU-CANT-SEE
	SET 'CLOCK-WAIT,1
	CALL PCLEAR
	PRINT YOU-CANT
	PRINTI "see "
	RTRUE

	.FUNCT YOU-ALREADY
	PRINTR "You already did that."

	.FUNCT HOW?
	PRINTR "How do you intend to do that?"

	.FUNCT PRESUMABLY-YOU-WANT-TO,STR,THING=0
	PRINT I-ASSUME
	PRINTI " "
	PRINT STR
	PRINTI " "
	ZERO? THING /?L1
	CALL DPRINT,THING
	JUMP ?L3
?L1:	PRINTI "it"
?L3:	PRINTR ".]"

	.FUNCT NOT-LIKELY,THING,STR
	PRINTI "It"
	CALL PICK-ONE,LIKELIES >STACK
	PRINT STACK
	PRINTI " that"
	CALL TPRINT,THING
	PRINTI " "
	PRINT STR
	PRINTR "."

	.FUNCT YOUD-HAVE-TO,STR,THING
	PRINTI "You'd have to "
	PRINT STR
	CALL TPRINT,THING
	PRINTR " to do that."

	.FUNCT WINDOW-F
	EQUAL? PRSA,V?LOOK-INSIDE \?L7
	EQUAL? HERE,PROJECTION-BOOTH \?L1
	PRINTR "Uncle Buddy's screening room isn't packing in much of a crowd tonight. A viewing screen dominates the room."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L7
	EQUAL? HERE,DINING-ROOM \?L3
	GRTR? MOVES,535 /?L4
	PRINTI "By the moonlight you can see the outline of"
	JUMP ?L6
?L4:	PRINTI "You can see"
?L6:	PRINTR " Aunt Hildegarde's lush garden."
?L3:	EQUAL? PRSA,V?LOOK-INSIDE \?L7
	PRINTI "You see the "
	EQUAL? HERE,SCREENING-ROOM \?L8
	PRINTI "projection booth of"
	JUMP ?L11
?L8:	FSET? HERE,OUTDOORSBIT \?L10
	PRINTI "interior of"
	JUMP ?L11
?L10:	PRINTI "grounds outside"
?L11:	PRINTR " Uncle Buddy's house."
?L7:	EQUAL? PRSA,V?OPEN \?L12
	EQUAL? HERE,PROJECTION-BOOTH,SCREENING-ROOM /?L12
	PRINTR "That would let in all the smog!"
?L12:	EQUAL? PRSA,V?ENTER,V?CLOSE \FALSE
	PRINTR "The window isn't open."

	.FUNCT V-FLUSH
	EQUAL? PRSO,INTNUM \?L1
	EQUAL? P-NUMBER,33 \?L1
	GETB 0,18 >STACK
	ZERO? STACK /?L3
	ZERO? P-VMERGE /?L1
?L3:	CALL GOTO,P-NMERGE
	CALL V-LOOK
	RTRUE
?L1:	PRINTR "You can't flush that."

	.FUNCT DESCRIBE-ROOM,VERB-IS-LOOK=0,FIRST-VISIT=0
	ZERO? LIT \?L1
	EQUAL? HERE,ON-POOL-2 /?L1
	CALL NOW-BLACK
	CRLF
	RFALSE
?L1:	FSET? HERE,TOUCHBIT /?L4
	FSET HERE,TOUCHBIT
	SET 'FIRST-VISIT,1
?L4:	CALL DPRINT,HERE
	LOC PLAYER >STACK
	FSET? STACK,VEHBIT \?L7
	PRINTI ", on"
	LOC PLAYER >STACK
	CALL TPRINT,STACK
?L7:	CRLF
	ZERO? VERB-IS-LOOK \?L12
	EQUAL? VERBOSITY,2 /?L12
	ZERO? FIRST-VISIT /TRUE
	EQUAL? VERBOSITY,1 \TRUE
?L12:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \?L13
	GETP HERE,P?LDESC >STACK
	PRINT STACK
?L13:	CRLF
	RTRUE

	.FUNCT DESCRIBE-OBJECTS,O,STR,1ST?=1,AV
	LOC WINNER >AV
	FIRST? HERE >O \FALSE
?L7:	CALL DESCRIBABLE?,O >STACK
	ZERO? STACK /?L9
	FSET? O,TOUCHBIT /?L9
	GETP O,P?FDESC >STR
	ZERO? STR /?L9
	CRLF
	PRINT STR
	FSET? O,CONTBIT \?L10
	CALL DESCRIBE-CONTENTS,O,1,3
?L10:	CRLF
?L9:	NEXT? O >O /?L7
	FIRST? HERE >O /?L15
?L15:	SET '1ST?,1
	ZERO? O /?L17
?L18:	CALL DESCRIBABLE?,O >STACK
	ZERO? STACK /?L26
	GETP O,P?FDESC >STACK
	ZERO? STACK /?L20
	FSET? O,TOUCHBIT \?L26
?L20:	GETP O,P?DESCFCN >STR
	ZERO? STR /?L22
	CALL STR,M-OBJDESC >STR
	ZERO? STR /?L22
	FSET? O,CONTBIT \?L23
	EQUAL? STR,M-FATAL /?L23
	CALL DESCRIBE-CONTENTS,O,1,3
?L23:	CRLF
	JUMP ?L26
?L22:	GETP O,P?LDESC >STR
	ZERO? STR /?L26
	PRINT STR
	FSET? O,CONTBIT \?L27
	CALL DESCRIBE-CONTENTS,O,1,3
?L27:	CRLF
?L26:	NEXT? O >O /?L18
?L17:	CALL DESCRIBE-CONTENTS,HERE,0,0
	ZERO? AV /FALSE
	EQUAL? HERE,AV /FALSE
	CALL DESCRIBE-CONTENTS,AV,0,0 >STACK
	RSTACK

	.FUNCT DESCRIBE-CONTENTS,OBJ,LEVEL=-1,ALL?=D-ALL?,F=0,N,1ST?=1,IT?=0,START?=0,TWO?=0,PARA?=0
	EQUAL? LEVEL,2 \?L1
	SET 'LEVEL,1
	SET 'PARA?,1
	SET 'START?,1
	JUMP ?L3
?L1:	BTST ALL?,D-PARA? \?L3
	SET 'PARA?,1
?L3:	FIRST? OBJ >N /?L5
?L5:	ZERO? START? \?L8
	IN? OBJ,ROOMS /?L8
	FSET? OBJ,ACTORBIT /?L8
	FSET? OBJ,CONTBIT \FALSE
	FSET? OBJ,OPENBIT /?L9
	FSET? OBJ,TRANSBIT \FALSE
?L9:	FSET? OBJ,SEARCHBIT \FALSE
	ZERO? N /FALSE
?L8:	ZERO? N /?L15
?L99:	CALL DESCRIBABLE?,N >STACK
	ZERO? STACK /?L12
	BTST ALL?,D-ALL? /?L15
	CALL SIMPLE-DESC?,N >STACK
	ZERO? STACK /?L12
?L15:	ZERO? F /?L54
	ZERO? 1ST? /?L18
	SET '1ST?,0
	EQUAL? LEVEL,0,1 \?L20
	ZERO? START? \?L45
	ZERO? PARA? \?L24
	EQUAL? OBJ,PLAYER /?L26
	CRLF
?L26:	SET 'PARA?,1
	JUMP ?L29
?L24:	EQUAL? LEVEL,1 \?L29
	PRINTI " "
?L29:	EQUAL? OBJ,HERE \?L31
	PRINT YOU-SEE
	JUMP ?L45
?L31:	EQUAL? OBJ,PLAYER \?L33
	PRINTI "You have"
	JUMP ?L45
?L33:	FSET? OBJ,SURFACEBIT \?L34
	PRINTI "Sitting on"
	CALL TPRINT,OBJ
	PRINTI " is"
	JUMP ?L45
?L34:	PRINTI "It looks as if"
	CALL TPRINT,OBJ
	FSET? OBJ,ACTORBIT \?L36
	PRINTI " has"
	JUMP ?L45
?L36:	PRINTI " contains"
	JUMP ?L45
?L20:	EQUAL? LEVEL,-1 /?L45
	PRINT LEVEL
	JUMP ?L45
?L18:	ZERO? N /?L43
	PRINTI ","
	JUMP ?L45
?L43:	PRINTI " and"
?L45:	CALL APRINT,F
	FSET? F,WORNBIT \?L46
	PRINTI " (being worn)"
	JUMP ?L50
?L46:	FSET? F,ONBIT \?L50
	PRINTI " (providing light)"
?L50:	ZERO? IT? \?L52
	ZERO? TWO? \?L52
	SET 'IT?,F
	JUMP ?L54
?L52:	SET 'TWO?,1
	SET 'IT?,0
?L54:	SET 'F,N
?L12:	ZERO? N /?L59
	NEXT? N >N /?L59
?L59:	ZERO? F \?L8
	ZERO? N \?L99
	ZERO? IT? /?L63
	ZERO? TWO? \?L63
	CALL THIS-IS-IT,IT?
?L63:	ZERO? 1ST? /?L97
	ZERO? START? /?L66
	PRINTI " nothing"
	RFALSE
?L66:	ZERO? 1ST? \?L11
?L97:	EQUAL? LEVEL,0,1 \?L11
	EQUAL? OBJ,HERE \?L71
	PRINTI " here"
?L71:	PRINTI "."
?L11:	FIRST? OBJ >F \?L78
?L79:	FSET? F,CONTBIT \?L83
	CALL DESCRIBABLE?,F,1 >STACK
	ZERO? STACK /?L83
	BTST ALL?,D-ALL? /?L82
	CALL SIMPLE-DESC?,F >STACK
	ZERO? STACK /?L83
?L82:	ZERO? PARA? /?L85
	PUSH 3
	JUMP ?L87
?L85:	PUSH D-ALL?
?L87:	CALL DESCRIBE-CONTENTS,F,1,STACK >STACK
	ZERO? STACK /?L83
	SET '1ST?,0
	SET 'PARA?,1
?L83:	NEXT? F >F /?L79
?L78:	ZERO? 1ST? \FALSE
	EQUAL? LEVEL,0,1 \?L91
	LOC WINNER >STACK
	EQUAL? OBJ,HERE,STACK \?L91
	CRLF
?L91:	ZERO? 1ST? \FALSE
	RTRUE

	.FUNCT DESCRIBABLE?,OBJ,CONT?=0
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? OBJ,WINNER /FALSE
	LOC WINNER >STACK
	EQUAL? OBJ,STACK \?L4
	LOC WINNER >STACK
	EQUAL? HERE,STACK \FALSE
?L4:	ZERO? CONT? \TRUE
	FSET? OBJ,NDESCBIT \TRUE
	RFALSE

	.FUNCT SIMPLE-DESC?,OBJ,STR
	GETP OBJ,P?FDESC >STACK
	ZERO? STACK /?L1
	FSET? OBJ,TOUCHBIT \FALSE
?L1:	GETP OBJ,P?DESCFCN >STR
	ZERO? STR /?L3
	CALL STR,M-OBJDESC? >STACK
	ZERO? STACK \FALSE
?L3:	GETP OBJ,P?LDESC >STACK
	ZERO? STACK /TRUE
	RFALSE

	.FUNCT DESCRIBE-NOTHING
	CALL DESCRIBE-CONTENTS,PRSO,2 >STACK
	ZERO? STACK /FALSE
	IN? PLAYER,PRSO /TRUE
	CRLF
	RTRUE

	.FUNCT V-ALARM
	EQUAL? PRSO,ME,ROOMS \?L1
	PRINTI "But you're "
	JUMP ?L4
?L1:	FSET? PRSO,ACTORBIT \?L3
	CALL PRINT-ID,STR?22
	CALL BUT-THE,PRSO
	PRINTI "is "
	JUMP ?L4
?L3:	CALL WHAT-A-CONCEPT
	RTRUE
?L4:	PRINTR "already wide awake!"

	.FUNCT ALREADY-OPEN
	CALL ITS-ALREADY,STR?23 >STACK
	RSTACK

	.FUNCT ALREADY-CLOSED
	CALL ITS-ALREADY,STR?24 >STACK
	RSTACK

	.FUNCT V-ASK-ABOUT
	FSET? PRSO,ACTORBIT \?L1
	SET 'WINNER,PRSO
	CALL PERFORM,V?TELL,PRSO
	SET 'WINNER,PLAYER
	RTRUE
?L1:	CALL V-ASK-FOR >STACK
	RSTACK

	.FUNCT V-ASK-FOR
	EQUAL? PRSO,ME,ROOMS \?L1
	CALL PERFORM,V?TELL,ME
	JUMP ?L3
?L1:	CALL NOT-LIKELY,PRSO,STR?25
?L3:	CALL PCLEAR
	RETURN 2

	.FUNCT V-BITE,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJECT-OR-PROPERTY? >STACK
?L1:	CALL PRINT-ID,STR?26,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?27,STACK
	CALL HACK-HACK,STR?28 >STACK
	RSTACK

	.FUNCT V-BLOW-INTO
	FSET? PRSO,ACTORBIT \?L1
	CALL PERFORM,V?USE,PRSO
	RTRUE
?L1:	CALL HACK-HACK,STR?29 >STACK
	RSTACK

	.FUNCT PRE-BOARD
	LOC PLAYER >STACK
	EQUAL? PRSO,STACK \?L1
	PRINTR "Look around you."
?L1:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /FALSE
	PRINTR "You're holding it!"

	.FUNCT V-BOARD
	FSET? PRSO,VEHBIT \?L1
	MOVE PLAYER,PRSO
	PRINTI "You are now on"
	CALL TPRINT,PRSO
	PRINTR "."
?L1:	PRINTI "You can't get into"
	CALL TPRINT,PRSO
	PRINTR "!"

	.FUNCT V-BURN
	FSET? PRSI,FLAMEBIT \?L1
	FSET? PRSO,BURNBIT \?L3
	REMOVE PRSO
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTI " catches fire and is reduced to ashes."
	CRLF
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?30,STACK >STACK
	RSTACK
?L3:	PRINT PYRO
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?31,STACK
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?32,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?33,STACK >STACK
	RSTACK
?L1:	PRINTI "With"
	CALL APRINT,PRSI
	PRINTI "? "
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?34,STACK
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?35,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?36,STACK >STACK
	RSTACK

	.FUNCT V-BUY
	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK \?L1
	CALL CANT-SEE-ANY,PRSO
	RTRUE
?L1:	FSET? PRSO,TAKEBIT /?L3
	FSET? PRSO,TRYTAKEBIT /?L3
	PRINT YOU-CANT
	PRINTR "buy that!"
?L3:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L4
	PRINTR "You already have one."
?L4:	ZERO? PRSI /?L5
	CALL NOT-LIKELY,PRSI,STR?37 >STACK
	RSTACK
?L5:	PRINTR "You don't have any money."

	.FUNCT CANT-CLOSE-THAT
	PRINT YOU-CANT
	PRINTR "close that!"

	.FUNCT CANT-GO
	PRINT YOU-CANT
	PRINTR "go that way."

	.FUNCT CANT-LOCK,UN?=0
	PRINT YOU-CANT
	ZERO? UN? /?L1
	PRINTI "un"
?L1:	PRINTI "lock"
	CALL TPRINT,PRSO
	PRINTR "!"

	.FUNCT V-CHASTISE
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	EQUAL? PRSO,INTDIR \?L3
	PRINTR "You'll have to go in that direction to see what's there."
?L3:	PRINTR "Use prepositions to indicate precisely what you want to do. For example, LOOK AT the object, LOOK INSIDE it, LOOK UNDER it, etc."

	.FUNCT V-CLEAN
	CALL PRINT-ID,STR?38
	CALL NOT-A,STR?39 >STACK
	RSTACK

	.FUNCT V-CLIMB
	CALL PERFORM,V?CLIMB-UP,PRSO
	RTRUE

	.FUNCT V-CLIMB-DOWN
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L1:	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT V-CLIMB-ON
	EQUAL? P-PRSA-WORD,W?HOLD \?L1
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L1:	PRINT YOU-CANT
	PRINTI "climb onto that."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?40,STACK >STACK
	RSTACK

	.FUNCT V-CLIMB-OVER
	EQUAL? PRSO,ROOMS \?L1
	CALL V-WALK-AROUND >STACK
	RSTACK
?L1:	PRINT YOU-CANT
	PRINTI "climb over that."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?41,STACK >STACK
	RSTACK

	.FUNCT V-CLIMB-UP
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?42,STACK
	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT V-CLOSE
	FSET? PRSO,ACTORBIT \?L1
	CALL NOT-A,STR?43 >STACK
	RSTACK
?L1:	FSET? PRSO,SURFACEBIT \?L3
	CALL CANT-CLOSE-THAT >STACK
	RSTACK
?L3:	FSET? PRSO,CONTBIT /?L4
	FSET? PRSO,DOORBIT /?L4
	CALL PERFORM,V?OPEN,PRSO
	RTRUE
?L4:	FSET? PRSO,SURFACEBIT /?L5
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L5
	FSET? PRSO,OPENBIT \?L6
	CALL NOW-CLOSED-OR-OPEN,PRSO
	CALL SAY-IF-NOT-LIT >STACK
	RSTACK
?L6:	CALL ALREADY-CLOSED >STACK
	RSTACK
?L5:	FSET? PRSO,DOORBIT \?L9
	FSET? PRSO,OPENBIT \?L10
	FCLEAR PRSO,OPENBIT
	CALL SAY-THE,PRSO
	PRINTI " "
	CALL PICK-ONE,DOOR-NOISES >STACK
	PRINT STACK
	PRINTR " as it closes."
?L10:	CALL ALREADY-CLOSED >STACK
	RSTACK
?L9:	CALL CANT-CLOSE-THAT >STACK
	RSTACK

	.FUNCT V-COMPARE
	PRINTR "You compare the two items and find nothing interesting."

	.FUNCT V-COUNT
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-COVER
	CALL PERFORM,V?PUT-ON,PRSI,PRSO
	RTRUE

	.FUNCT V-CROSS
	PRINT YOU-CANT
	PRINTR "cross that!"

	.FUNCT V-CUT
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?44,STACK
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?45,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?46,STACK
	CALL NOT-LIKELY,PRSI,STR?47 >STACK
	RSTACK

	.FUNCT V-$0024DEBUG
	ZERO? DEBUG /?L1
	SET 'DEBUG,0
	PRINTR "Debug off."
?L1:	SET 'DEBUG,1
	PRINTR "Debug on."

	.FUNCT V-DIAGNOSE
	PRINTI "You're in good health"
	RANDOM 100 >STACK
	LESS? 50,STACK /?L1
	PRINTI "... at the moment"
?L1:	PRINTR "."

	.FUNCT V-DIG-WITH
	CALL PERFORM,V?DIG,GROUND,PRSO
	RTRUE

	.FUNCT V-DIG
	ZERO? PRSI \?L5
	IN? SHOVEL,PLAYER \?L3
	SET 'PRSI,SHOVEL
	PRINTI "[with the shovel]"
	CRLF
	JUMP ?L5
?L3:	SET 'PRSI,HANDS
	PRINTI "[with your hands]"
	CRLF
?L5:	EQUAL? PRSO,SAND,GROUND \?L7
	EQUAL? PRSI,SHOVEL /?L9
	PRINTR "I suppose you also excavate tunnels with a teaspoon."
?L9:	EQUAL? PRSO,SAND /?L12
	EQUAL? HERE,BEACH \?L11
?L12:	PRINTR "You find nothing, so you fill in the hole."
?L11:	GETP HERE,P?CAPACITY >STACK
	EQUAL? STACK,2 \?L13
	PRINTR "You attempt to dig in the stone path, but it proves too tough for your efforts."
?L13:	GETP HERE,P?CAPACITY >STACK
	ZERO? STACK \?L14
	PRINTR "The ground is too hard here."
?L14:	GETP HERE,P?CAPACITY >STACK
	EQUAL? STACK,10 /?L16
	GETP HERE,P?CAPACITY >STACK
	EQUAL? STACK,20 \?L15
?L16:	PRINTR "You can't dig a hole here!"
?L15:	EQUAL? HERE,HEART-OF-MAZE \?L18
	IN? HEART-OF-MAZE-HOLE,HEART-OF-MAZE \?L20
	PRINTR "You already dug a hole here."
?L20:	PRINTI "You dig a hole and uncover"
	CALL ARPRINT,RUBBER-STAMP
	MOVE HEART-OF-MAZE-HOLE,HEART-OF-MAZE
	RTRUE
?L18:	GETP HERE,P?CAPACITY >STACK
	EQUAL? STACK,1 \?L24
	GETB HM-TABLE,HM-ROOM >STACK
	GRTR? STACK,15 \?L24
	PRINTR "You've already dug a hole here."
?L24:	GETP HERE,P?CAPACITY >STACK
	EQUAL? STACK,1 \FALSE
	MOVE MAZE-HOLE,HERE
	GETB HM-TABLE,HM-ROOM >STACK
	BOR STACK,X-H >STACK
	PUTB HM-TABLE,HM-ROOM,STACK
	GETB HM-TABLE,HM-ROOM >HM-BITS
	PRINTR "You dig a good sized hole, but find nothing."
?L7:	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-DISEMBARK
	LOC PLAYER >STACK
	EQUAL? STACK,PRSO /?L1
	PRINTI "Look around you."
	CRLF
	RETURN 2
?L1:	MOVE WINNER,HERE
	PRINTI "You are no longer on"
	CALL TPRINT,PRSO
	PRINTR "."

	.FUNCT V-DRINK
	PRINT YOU-CANT
	PRINTI "drink that!"
	CRLF
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?48,STACK >STACK
	RSTACK

	.FUNCT V-DRINK-FROM
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?49,STACK
	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT SPECIAL-DROP
	EQUAL? HERE,ROOF-1,ROOF-2 \?L1
	EQUAL? PRSO,FINCH \?L6
	FSET? FINCH,EVERYBIT \?L5
?L6:	CALL ULTIMATELY-IN?,FINCH,PRSO >STACK
	ZERO? STACK /?L3
	FSET? FINCH,EVERYBIT /?L3
?L5:	CALL BREAK-FINCH,1
?L3:	EQUAL? PRSO,BLUE-CANDLE,WHITE-CANDLE,RED-CANDLE \?L8
	FSET? PRSO,FLAMEBIT \?L8
	CALL BLOW-OUT-CANDLE,PRSO,1
?L8:	MOVE PRSO,PATIO
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " slides off the roof."
?L1:	EQUAL? HERE,ON-POOL-1,ON-POOL-2,INLET /?L12
	EQUAL? HERE,IN-POOL-1,IN-POOL-2 \?L11
?L12:	CALL PERFORM,V?PUT,PRSO,WATER
	RTRUE
?L11:	EQUAL? HERE,CHIMNEY-2 /?L14
	EQUAL? HERE,CHIMNEY-1 \FALSE
?L14:	CALL PERFORM,V?PUT,PRSO,CHIMNEY
	RTRUE

	.FUNCT V-DROP
	CALL SPECIAL-DROP >STACK
	ZERO? STACK \TRUE
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	PRINTR "Dropped."

	.FUNCT IDROP
	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \FALSE
	IN? PRSO,WINNER /?L3
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L3
	PRINT YOU-CANT
	PRINTI "do that while"
	CALL TPRINT,PRSO
	CALL IS-CLOSED
	CRLF
	RFALSE
?L3:	FSET? PRSO,WORNBIT \?L4
	PRINTI "You'll have to take off"
	CALL TPRINT,PRSO
	PRINTI " first."
	CRLF
	RFALSE
?L4:	MOVE PRSO,HERE
	RTRUE

	.FUNCT V-EAT
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?50,STACK
	CALL NOT-LIKELY,PRSO,STR?51 >STACK
	RSTACK

	.FUNCT V-EMPTY,OBJ,NXT
	FSET? PRSO,CONTBIT \?L1
	FSET? PRSO,OPENBIT \?L3
	FIRST? PRSO >OBJ /?L20
	JUMP ?L6
?L8:	ZERO? OBJ /TRUE
?L20:	NEXT? OBJ >NXT /?L12
?L12:	FSET? OBJ,NARTICLEBIT /?L13
	PRINTI "The "
?L13:	CALL DPRINT,OBJ
	PRINTI ": "
	CALL PERFORM,V?TAKE,OBJ,PRSO
	SET 'OBJ,NXT
	JUMP ?L8
?L6:	CALL BUT-THE,PRSO
	PRINTR "is already empty!"
?L3:	CALL ITS-CLOSED,PRSO
	RTRUE
?L1:	PRINT YOU-CANT
	PRINTR "empty that!"

	.FUNCT V-ENTER
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L1:	FSET? PRSO,DOORBIT \?L3
	CALL OTHER-SIDE,PRSO >STACK
	CALL DO-WALK,STACK >STACK
	RSTACK
?L3:	IN? PRSO,WINNER \?L4
	PRINTR "That would involve quite a contortion!"
?L4:	FSET? PRSO,WEARBIT \?L5
	CALL PRESUMABLY-YOU-WANT-TO,STR?52,PRSO
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L5:	FSET? PRSO,VEHBIT \?L6
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L6:	PRINTI "You hit your head against"
	CALL TPRINT,PRSO
	PRINTI " as you attempt this feat."
	CRLF
	CALL PRINT-ID,STR?53 >STACK
	RSTACK

	.FUNCT PRE-EXAMINE
	ZERO? LIT \FALSE
	CALL TOO-DARK
	RTRUE

	.FUNCT V-EXAMINE
	FSET? PRSO,DOORBIT \?L1
	PRINTI "It looks as if"
	CALL TPRINT,PRSO
	PRINTI " is "
	FSET? PRSO,OPENBIT \?L3
	PRINTI "open"
	JUMP ?L5
?L3:	PRINTI "closed"
?L5:	PRINTR "."
?L1:	FSET? PRSO,SURFACEBIT \?L6
	CALL V-LOOK-ON >STACK
	RSTACK
?L6:	FSET? PRSO,CONTBIT \?L7
	FSET? PRSO,OPENBIT /?L10
	FSET? PRSO,TRANSBIT \?L8
?L10:	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L8:	CALL ITS-CLOSED,PRSO >STACK
	RSTACK
?L7:	FSET? PRSO,READBIT \?L12
	CALL PERFORM,V?READ,PRSO >STACK
	RSTACK
?L12:	PRINTI "You see nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTI " about"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-EXIT
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT FAILED
	PRINTR "Failed."

	.FUNCT V-FILL
	ZERO? PRSI \?L1
	CALL GLOBAL-IN?,WATER,HERE >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?FILL,PRSO,WATER
	RTRUE
?L3:	FSET? PRSO,CONTBIT \?L5
	PRINTR "There's nothing to fill it with."
?L5:	CALL V-STAND-UNDER >STACK
	RSTACK
?L1:	EQUAL? PRSI,PORTABLE-WATER,WATER \?L7
	CALL GLOBAL-IN?,WATER,HERE >STACK
	ZERO? STACK \?L8
	CALL CANT-SEE-ANY,WATER >STACK
	RSTACK
?L8:	EQUAL? PRSO,BUCKET /?L10
	CALL V-STAND-UNDER >STACK
	RSTACK
?L10:	FIRST? BUCKET >STACK \?L11
	FIRST? BUCKET >STACK /?L12
?L12:	EQUAL? STACK,PORTABLE-WATER /?L11
	PRINTR "That would get the stuff in the bucket all wet."
?L11:	MOVE PORTABLE-WATER,BUCKET
	CALL QUEUE,I-DRIP,2
	SET 'AMOUNT-OF-WATER,26
	PRINTI "You fill"
	CALL TPRINT,BUCKET
	PRINTR ", which naturally leaks slowly."
?L7:	EQUAL? PRSI,PORTABLE-WATER \?L14
	CALL PERFORM,V?POUR,PORTABLE-WATER,PRSO
	CALL THIS-IS-IT,PRSO
	RTRUE
?L14:	CALL V-STAND-UNDER >STACK
	RSTACK

	.FUNCT V-FIND,L
	LOC PRSO >L
	EQUAL? PRSO,ME,HANDS \?L1
	PRINTI "You're right here"
	JUMP ?L12
?L1:	IN? PRSO,PLAYER \?L3
	PRINTI "You're holding it"
	JUMP ?L12
?L3:	IN? PRSO,HERE /?L5
	EQUAL? PRSO,PSEUDO-OBJECT \?L4
?L5:	CALL BUT-THE,PRSO
	PRINTI "is right in front of you"
	JUMP ?L12
?L4:	IN? PRSO,LOCAL-GLOBALS \?L6
	CALL HOW?
	RTRUE
?L6:	FSET? L,ACTORBIT \?L7
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L7
	PRINTI "It looks as if"
	CALL TPRINT,L
	PRINTI " has it"
	JUMP ?L12
?L7:	CALL SEE-INSIDE?,L >STACK
	ZERO? STACK /?L8
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L8
	PRINTI "It's "
	FSET? L,SURFACEBIT \?L9
	PRINTI "on"
	JUMP ?L11
?L9:	PRINTI "in"
?L11:	CALL TPRINT,L
	JUMP ?L12
?L8:	PRINTI "You'll have to do that yourself"
?L12:	PRINTR "."

	.FUNCT FIND-IN,WHERE,WHAT,W
	FIRST? WHERE >W \FALSE
?L2:	FSET? W,WHAT \?L7
	RETURN W
?L7:	NEXT? W >W /?L2
	RFALSE

	.FUNCT FINISH,REPEATING=0,WORD
	CRLF
	ZERO? REPEATING \?L1
	CALL V-SCORE
	CRLF
?L1:	PRINTI "[EVENT: GAME OVER]Do you want to restart the story, restore a saved position, or quit?

(Please type RESTART, RESTORE or QUIT.) >"
	READ P-INBUF,P-LEXV
	GET P-LEXV,1 >WORD
	EQUAL? WORD,W?RESTAR \?L4
	RESTART
?L4:	EQUAL? WORD,W?RESTOR \?L6
	RESTORE \?L7
	CALL SAY-OKAY >STACK
	RSTACK
?L7:	CALL FAILED
	CALL FINISH,1 >STACK
	RSTACK
?L6:	EQUAL? WORD,W?QUIT,W?Q \?L10
	QUIT
?L10:	CALL FINISH,1 >STACK
	RSTACK

	.FUNCT V-FLY
	PRINTR "That's not in the script!"

	.FUNCT V-FOCUS
	PRINTR "It's your thinking that's out of focus."

	.FUNCT V-FOLLOW,WHERE
	LOC PRSO >WHERE
	CALL BUT-THE,PRSO
	PRINTI "is "
	EQUAL? WHERE,HERE /?L3
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK /?L1
?L3:	PRINTI "right here in front of you"
	JUMP ?L6
?L1:	EQUAL? WHERE,PLAYER \?L4
	PRINTI "in"
	CALL DPRINT,HANDS
	PRINTI "s"
	JUMP ?L6
?L4:	IN? WHERE,PLAYER \?L5
	PRINTI "in"
	CALL TPRINT,WHERE
	JUMP ?L6
?L5:	PRINTI "nowhere to be seen"
?L6:	PRINTR "!"

	.FUNCT PRE-GIVE
	ZERO? PRSO /?L3
	ZERO? PRSI \?L1
?L3:	CALL REFERRING
	RTRUE
?L1:	IN? PRSO,LOCAL-GLOBALS /?L5
	IN? PRSO,PSEUDO-OBJECT \?L4
?L5:	CALL NOT-HOLDING
	RTRUE
?L4:	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \TRUE
	FSET? PRSI,ACTORBIT /?L7
	PRINT YOU-CANT
	PRINTR "give anything to that!"
?L7:	FSET? PRSO,WORNBIT \FALSE
	CALL TAKE-OFF-PRSO-FIRST >STACK
	RSTACK

	.FUNCT V-GIVE
	FSET? PRSI,ACTORBIT \FALSE
	PRINTI "Politely,"
	CALL TPRINT,PRSI
	PRINTR " refuses your offer."

	.FUNCT V-SGIVE
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT GOTO,RM,V?=1,OLIT,OHERE,X
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-EXIT >X
	SET 'OHERE,HERE
	SET 'OLIT,LIT
	MOVE WINNER,RM
	SET 'HERE,RM
	CALL LIT?,HERE >LIT
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	CALL DESCRIBE-ROOM >STACK
	ZERO? STACK /TRUE
	ZERO? VERBOSITY /TRUE
	CALL DESCRIBE-OBJECTS
	RTRUE

	.FUNCT HACK-HACK,STR
	PRINT STR
	CALL TPRINT,PRSO
	PRINTI " "
	CALL PICK-ONE,HO-HUM >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT PRE-HANG-UP
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSO,PHONE /FALSE
	CALL NOT-HOLDING,PRSO >STACK
	RSTACK

	.FUNCT V-HANG-UP
	ZERO? PRSI \?L1
	EQUAL? HERE,CLOSET \?L3
	PRINTR "Next time, say which peg to hang it on."
?L3:	PRINTR "There's no place to hang it up."
?L1:	PRINTI "You can't hang something on"
	CALL ARPRINT,PRSI
	RTRUE

	.FUNCT V-HELLO,WHO
	ZERO? PRSO /?L1
	SET 'WHO,PRSO
	JUMP ?L4
?L1:	CALL ANYONE-HERE? >WHO
	ZERO? WHO /?L7
	CALL SPOKEN-TO,WHO
	CALL PERFORM,V?HELLO,WHO
	RTRUE
?L4:	ZERO? WHO /?L7
	FSET? WHO,ACTORBIT \?L9
	PRINTI "It's apparent that"
	CALL TPRINT,WHO
	PRINTR " didn't expect you to say that."
?L9:	CALL NOT-LIKELY,WHO,STR?25 >STACK
	RSTACK
?L7:	CALL TALK-TO-SELF >STACK
	RSTACK

	.FUNCT V-HELP
	PRINTR "[If you're really stuck, maps and InvisiClues (TM) hint booklets are available using the order form that came in your HOLLYWOOD HIJINX package.]"

	.FUNCT V-HIDE
	PRINTR "There aren't any good hiding places here."

	.FUNCT V-INVENTORY
	CALL DESCRIBE-CONTENTS,WINNER,0 >STACK
	ZERO? STACK \?L1
	PRINTI "You are empty-handed."
?L1:	CRLF
	RTRUE

	.FUNCT ITS-ALREADY,STR
	PRINTI "It's already "
	PRINT STR
	PRINTR "."

	.FUNCT JIGS-UP,REASON=0
	ZERO? REASON /?L1
	PRINT REASON
	CRLF
?L1:	CALL KILL-INTERRUPTS
	CRLF
	PRINTI "Fade to black:

        ****  You have died  ****"
	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT V-KICK,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJECT-OR-PROPERTY? >STACK
?L1:	CALL PRINT-ID,STR?54,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?55,STACK
	CALL HACK-HACK,STR?56 >STACK
	RSTACK

	.FUNCT V-KILL
	FSET? PRSO,ACTORBIT /?L1
	PRINT YOU-CANT
	PRINTI "attack"
	CALL TPRINT,PRSO
	PRINTI "!"
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?57,STACK
	CRLF
	RTRUE
?L1:	PRINTI "Attacking"
	CALL TPRINT,PRSO
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?58,STACK
	ZERO? PRSI /?L4
	PRINTI " with"
	CALL TPRINT,PRSI
?L4:	PRINTR " isn't likely to help matters."

	.FUNCT KILL-INTERRUPTS
	RTRUE

	.FUNCT V-KISS
	PRINTI "Smack!"
	CRLF
	CALL PRINT-ID,STR?59 >STACK
	RSTACK

	.FUNCT V-KNOCK
	FSET? PRSO,DOORBIT \?L1
	CALL NO-ANSWER >STACK
	RSTACK
?L1:	FSET? PRSO,ACTORBIT \?L3
	CALL PERFORM,V?USE,PRSO
	RTRUE
?L3:	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-LAMP-OFF
	EQUAL? P-PRSA-WORD,W?BLOW \?L1
	EQUAL? PRSO,FLASHLIGHT,COMPUTER,FILM-PROJECTOR /?L3
	EQUAL? PRSO,SLIDE-PROJECTOR \?L1
?L3:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	FSET? PRSO,LIGHTBIT /?L5
	FSET? PRSO,BURNBIT \?L4
?L5:	FSET? PRSO,ONBIT \?L6
	FCLEAR PRSO,ONBIT
	PRINTI "Okay,"
	CALL TPRINT,PRSO
	PRINTI " is now off."
	CRLF
	CALL SAY-IF-NOT-LIT
	RTRUE
?L6:	PRINTR "It isn't on!"
?L4:	CALL CANT-TURN,STR?60 >STACK
	RSTACK

	.FUNCT V-LAMP-ON
	FSET? PRSO,LIGHTBIT \?L1
	FSET? PRSO,ONBIT \?L3
	CALL ITS-ALREADY,STR?61 >STACK
	RSTACK
?L3:	FSET PRSO,ONBIT
	PRINTI "Okay,"
	CALL TPRINT,PRSO
	PRINTI " is now on."
	CRLF
	CALL NOW-LIT? >STACK
	RSTACK
?L1:	FSET? PRSO,BURNBIT \?L6
	CALL SET-FLAME-SOURCE >STACK
	ZERO? STACK \TRUE
	CALL PERFORM,V?BURN,PRSO,PRSI
	RTRUE
?L6:	CALL CANT-TURN,STR?62 >STACK
	RSTACK

	.FUNCT CANT-TURN,STRING
	PRINT YOU-CANT
	PRINTI "turn that o"
	PRINT STRING
	PRINTR "."

	.FUNCT V-LEAP
	EQUAL? PRSO,ROOMS /?L1
	PRINTR "That'd be a cute trick."
?L1:	EQUAL? HERE,IN-POOL-1,IN-POOL-2,ON-POOL-1 /?L4
	EQUAL? HERE,ON-POOL-2,INLET,UNDERPASS-1 /?L4
	EQUAL? HERE,UNDERPASS-2 \?L3
?L4:	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L3:	CALL GLOBAL-IN?,WATER,HERE >STACK
	ZERO? STACK /?L5
	CALL PERFORM,V?SWIM,WATER
	RTRUE
?L5:	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-LEAVE
	EQUAL? PRSO,ROOMS /?L3
	FSET? PRSO,TAKEBIT /?L1
?L3:	CALL DO-WALK,P?OUT
	RTRUE
?L1:	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \TRUE
	CALL PERFORM,V?DROP,PRSO
	RTRUE

	.FUNCT V-LET-GO
	CALL PERFORM,V?DROP,PRSO
	RTRUE

	.FUNCT V-LIE-DOWN
	PRINTR "This is no time for resting."

	.FUNCT V-LISTEN
	EQUAL? PRSO,ROOMS \?L1
	EQUAL? HERE,CLOSET \?L3
	ZERO? BUCKET-PEG /?L3
	PRINTR """Hummm."""
?L3:	PRINTR "You hear nothing special."
?L1:	PRINTI "At the moment,"
	CALL TPRINT,PRSO
	PRINTR " makes no sound."

	.FUNCT V-LOCK
	FSET? PRSO,DOORBIT /?L3
	FSET? PRSO,CONTBIT \?L1
?L3:	FSET? HERE,LOCKEDBIT /?L4
	PRINT YOU-CANT
	PRINTR "lock it from here."
?L4:	FSET? PRSO,OPENBIT \?L6
	PRINTI "You can't lock"
	CALL TPRINT,PRSO
	PRINTR " when it's open. You should have eaten more fish (brain food) as Aunt Hildegarde told you to."
?L6:	FSET? PRSO,LOCKEDBIT \?L7
	PRINTI "You attempt to lock"
	CALL TPRINT,PRSO
	PRINTR " and find it's already locked."
?L7:	ZERO? PRSI /?L8
	PRINTI "When was the last time you locked something with"
	CALL ARPRINT,PRSI
	RTRUE
?L8:	FSET? HERE,LOCKEDBIT \?L9
	FSET PRSO,LOCKEDBIT
	PRINTI "You lock"
	CALL TRPRINT,PRSO
	RTRUE
?L9:	CALL THING-WONT-LOCK,PRSI,PRSO >STACK
	RSTACK
?L1:	CALL CANT-LOCK >STACK
	RSTACK

	.FUNCT THING-WONT-LOCK,THING,CLOSED-THING,UN?=0
	PRINTI "A quick test shows that"
	CALL TPRINT,THING
	PRINTI " won't "
	ZERO? UN? /?L1
	PRINTI "un"
?L1:	PRINTI "lock"
	CALL TRPRINT,CLOSED-THING
	RTRUE

	.FUNCT V-LOOK
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /TRUE
	CALL DESCRIBE-OBJECTS
	RTRUE

	.FUNCT V-LOOK-BEHIND
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	PRINTI "There's nothing behind"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-LOOK-DOWN
	ZERO? LIT \?L1
	CALL TOO-DARK
	RTRUE
?L1:	EQUAL? HERE,UPPER-BEACH-STAIRS,LOWER-BEACH-STAIRS \?L3
	CALL PERFORM,V?LOOK-INSIDE,GAP
	RTRUE
?L3:	EQUAL? PRSO,ROOMS \?L4
	CALL PERFORM,V?EXAMINE,GROUND
	RTRUE
?L4:	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE

	.FUNCT V-LOOK-INSIDE
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	FSET? PRSO,ACTORBIT \?L3
	CALL NOT-A,STR?43 >STACK
	RSTACK
?L3:	FSET? PRSO,DOORBIT \?L4
	EQUAL? PRSO,UPSTAIRS-CD,FOYER-CD,CELLAR-CD /?L7
	EQUAL? PRSO,ATTIC-CD \?L5
?L7:	EQUAL? HERE,CLOSET /?L5
	FSET? PRSO,OPENBIT \?L5
	CALL PERFORM,V?LOOK-INSIDE,CLOSET-REF
	RTRUE
?L5:	CALL PERFORM,V?EXAMINE,PRSO
	RTRUE
?L4:	FSET? PRSO,CONTBIT \?L9
	LOC WINNER >STACK
	EQUAL? PRSO,STACK \?L10
	CALL V-LOOK >STACK
	RSTACK
?L10:	FSET? PRSO,OPENBIT /?L12
	FSET? PRSO,TRANSBIT /?L12
	CALL ITS-CLOSED,PRSO >STACK
	RSTACK
?L12:	PRINT YOU-SEE
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINTI " in"
	CALL TRPRINT,PRSO
	RTRUE
?L9:	PRINT YOU-CANT
	PRINTI "look inside"
	CALL ARPRINT,PRSO
	RTRUE

	.FUNCT V-LOOK-ON
	ZERO? LIT \?L1
	CALL TOO-DARK
	RTRUE
?L1:	PRINT YOU-SEE
	FSET? PRSO,SURFACEBIT \?L4
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINTI " on"
	CALL TRPRINT,PRSO
	RTRUE
?L4:	PRINTI " nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTI " on"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-LOOK-THRU
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	ZERO? PRSI /?L3
	FSET? PRSI,TRANSBIT /?L3
	PRINT YOU-CANT
	PRINTR "look through that!"
?L3:	CALL NOTHING-INTERESTING,1 >STACK
	RSTACK

	.FUNCT V-LOOK-UNDER
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	IN? PRSO,PLAYER \?L3
	PRINTI "You're already "
	FSET? PRSO,WORNBIT \?L4
	PRINTI "wear"
	JUMP ?L6
?L4:	PRINTI "hold"
?L6:	PRINTR "ing that!"
?L3:	CALL NOTHING-INTERESTING,1 >STACK
	RSTACK

	.FUNCT V-LOOK-UP
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	EQUAL? HERE,UPSTAIRS-HALL-MIDDLE \?L3
	FSET? ATTIC-DOOR,OPENBIT \?L4
	PRINTR "You see an opening in the ceiling previously covered by the small panel. A ladder attached to the small door hangs down from the opening."
?L4:	PRINTR "You see the outline of a small panel in the ceiling."
?L3:	EQUAL? HERE,CLOSET-TOP \?L7
	PRINTR "The shaft continues upward."
?L7:	EQUAL? HERE,SHAFT-BOTTOM \?L8
	PRINTI "You see the bottom of the closet "
	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE,ATTIC \?L9
	PRINTI "far "
?L9:	PRINTR "above you."
?L8:	EQUAL? HERE,FIREPLACE,CHIMNEY-1,CHIMNEY-2 /?L13
	EQUAL? HERE,CHIMNEY-3 /?L13
	FSET? HERE,OUTDOORSBIT \?L12
?L13:	GRTR? MOVES,556 \?L14
	PRINTR "You see the blue sky of a new day."
?L14:	PRINTR "You see the night's sky."
?L12:	PRINTR "You begin to get a stiff neck."

	.FUNCT V-LOWER
	CALL V-RAISE >STACK
	RSTACK

	.FUNCT V-MOVE
	EQUAL? PRSO,ROOMS \?L1
	CALL V-WALK-AROUND >STACK
	RSTACK
?L1:	FSET? PRSO,TAKEBIT \?L3
	PRINTI "Moving"
	CALL TPRINT,PRSO
	PRINTI " reveals nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTR "."
?L3:	PRINT YOU-CANT
	PRINTI "move"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-MUNG
	PRINTI "Let's leave the violence to the movies."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?63,STACK
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?64,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?65,STACK >STACK
	RSTACK

	.FUNCT NO-ANSWER
	PRINTR "There's no answer."

	.FUNCT NOT-A,STR
	PRINTI "You're not a "
	PRINT STR
	PRINTR "!"

	.FUNCT NOTHING-INTERESTING,SEE?=0
	PRINTI "You "
	ZERO? SEE? /?L1
	PRINTI "see"
	JUMP ?L3
?L1:	PRINTI "find"
?L3:	PRINTI " nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT NOW-BLACK
	PRINTI "It is pitch black."
	RTRUE

	.FUNCT NOW-CLOSED-OR-OPEN,THING,OPEN?=0
	CALL THIS-IS-IT,THING
	PRINT OKAY
	PRINTI "the "
	CALL DPRINT,PRSO
	PRINTI " is now "
	ZERO? OPEN? /?L1
	FSET THING,OPENBIT
	PRINTI "open"
	JUMP ?L3
?L1:	FCLEAR THING,OPENBIT
	PRINTI "closed"
?L3:	PRINTR "."

	.FUNCT V-OPEN,F,STR
	FSET? PRSO,ACTORBIT \?L1
	CALL NOT-A,STR?43 >STACK
	RSTACK
?L1:	FSET? PRSO,SURFACEBIT /?L4
	FSET? PRSO,VEHBIT \?L3
?L4:	PRINTR "Huh?"
?L3:	FSET? PRSO,CONTBIT /?L5
	FSET? PRSO,DOORBIT /?L5
	PRINTI "How can you do that to"
	CALL APRINT,PRSO
	PRINTR "?"
?L5:	FSET? PRSO,OPENBIT \?L6
	CALL ALREADY-OPEN >STACK
	RSTACK
?L6:	FSET? PRSO,LOCKEDBIT \?L7
	PRINTR "You'll have to unlock it first."
?L7:	FSET? PRSO,CONTBIT \?L8
	FSET PRSO,OPENBIT
	FSET PRSO,TOUCHBIT
	FIRST? PRSO >STACK \?L11
	FSET? PRSO,TRANSBIT \?L9
?L11:	CALL NOW-CLOSED-OR-OPEN,PRSO,1 >STACK
	RSTACK
?L9:	PRINTI "Opening"
	CALL TPRINT,PRSO
	PRINTI " reveals"
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINTR "."
?L8:	FSET PRSO,OPENBIT
	CALL SAY-THE,PRSO
	ZERO? MYSTERY-GUEST /?L17
	EQUAL? PRSO,OAK-DOOR \?L17
	SET 'MYSTERY-GUEST,0
	PRINTR " opens with a long squeal, and you hear hurried footsteps several rooms away."
?L17:	PRINTI " "
	CALL PICK-ONE,DOOR-NOISES >STACK
	PRINT STACK
	PRINTR " as it opens."

	.FUNCT CANT-OPEN-CLOSE
	PRINTI "You can't "
	EQUAL? PRSA,V?OPEN \?L1
	PRINTI "open"
	JUMP ?L3
?L1:	PRINTI "close"
?L3:	CALL APRINT,PRSO
	PRINTR "!"

	.FUNCT OTHER-SIDE,DOBJ,P=0,T
?L1:	NEXTP HERE,P >P
	LESS? P,P?OUT /FALSE
	GETPT HERE,P >T
	PTSIZE T >STACK
	EQUAL? STACK,DEXIT \?L1
	GETB T,DEXITOBJ >STACK
	EQUAL? STACK,DOBJ \?L1
	RETURN P

	.FUNCT V-PICK
	FSET? PRSO,DOORBIT \?L1
	CALL NOT-A,STR?66 >STACK
	RSTACK
?L1:	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT V-PLAY,WD,PTR
	ADD P-SENTENCE,P-LEXELEN >PTR
	GET P-LEXV,PTR >WD
	EQUAL? WD,W?$QUOTE \?L1
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >WD
?L1:	EQUAL? PRSI,0,PIANO /?L4
	PRINTI "You can't play"
	CALL ARPRINT,PRSI
	RTRUE
?L4:	EQUAL? PRSO,0,PIANO /?L6
	PRINTI "You can't play"
	CALL ARPRINT,PRSO
	RTRUE
?L6:	IN? PIANO,HERE /?L7
	PRINTI "There's not a musical instrument in sight."
	CRLF
	CALL PCLEAR >STACK
	RSTACK
?L7:	ZERO? SONG-NUMBER \?L8
	EQUAL? WD,W?YESTER \?L8
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L8:	EQUAL? SONG-NUMBER,1 \?L9
	EQUAL? WD,W?GREENS \?L9
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L9:	EQUAL? SONG-NUMBER,2 \?L10
	EQUAL? WD,W?CAMELO \?L10
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L10:	EQUAL? SONG-NUMBER,3 \?L11
	EQUAL? WD,W?STARDU \?L11
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L11:	EQUAL? SONG-NUMBER,4 \?L12
	EQUAL? WD,W?MISTY \?L12
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L12:	EQUAL? SONG-NUMBER,5 \?L13
	EQUAL? WD,W?PEOPLE \?L13
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L13:	EQUAL? SONG-NUMBER,6 \?L14
	EQUAL? WD,W?FEELIN \?L14
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L14:	EQUAL? SONG-NUMBER,7 \?L15
	EQUAL? WD,W?TOMORR \?L15
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L15:	EQUAL? SONG-NUMBER,8 \?L16
	EQUAL? WD,W?TONIGH \?L16
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L16:	EQUAL? SONG-NUMBER,9 \?L17
	EQUAL? WD,W?OKLAHO \?L17
	CALL OPEN-CRAWL-SPACE-DOOR?
	CALL PCLEAR >STACK
	RSTACK
?L17:	ZERO? PRSO \?L19
	ZERO? PRSI \?L19
	PRINTI "[on the piano]"
	CRLF
?L19:	PRINTI "You play for a few moments. It's very beautiful and melodious."
	CRLF
	CALL PRINT-ID,STR?67
	CALL PCLEAR >STACK
	RSTACK

	.FUNCT OPEN-CRAWL-SPACE-DOOR?
	ZERO? SONG-PLAYED /?L1
	PRINTI "You play """
	GET SONGS,SONG-NUMBER >STACK
	PRINT STACK
	PRINTR """ again. You tell yourself you're getting better and promise to begin taking lessons again soon."
?L1:	FSET CRAWL-SPACE-DOOR,OPENBIT
	SET 'SONG-PLAYED,1
	PRINTI "Although a little rusty, you begin to play """
	GET SONGS,SONG-NUMBER >STACK
	PRINT STACK
	PRINTR "."" Just as you start to seriously consider taking lessons again, a door in the floor opens."

	.FUNCT V-POUR
	PRINT YOU-CANT
	PRINTR "pour that!"

	.FUNCT V-PULL
	CALL HACK-HACK,STR?68 >STACK
	RSTACK

	.FUNCT V-PUSH
	CALL HACK-HACK,STR?69 >STACK
	RSTACK

	.FUNCT V-PUSH-DOWN
	ZERO? PRSI /?L1
	PRINT YOU-CANT
	PRINTR "push things down that."
?L1:	CALL HACK-HACK,STR?70 >STACK
	RSTACK

	.FUNCT V-PUSH-TO
	PRINT YOU-CANT
	PRINTR "push things to that."

	.FUNCT V-PUSH-UP
	CALL HACK-HACK,STR?71 >STACK
	RSTACK

	.FUNCT PRE-PUT
	EQUAL? PRSO,WHITE-WAX,RED-WAX,BLUE-WAX \?L1
	EQUAL? PRSA,V?PUT-ON,V?PUT \?L1
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK \FALSE
?L1:	EQUAL? PRSO,YOUR-FEET \?L3
	EQUAL? PRSI,BRICK-HOLE \?L3
	PRINTR "If you want to climb up the chimney, say so."
?L3:	EQUAL? PRSO,WATER,PORTABLE-WATER /FALSE
	CALL ULTIMATELY-IN?,PRSI,PRSO >STACK
	ZERO? STACK /?L5
	PRINT YOU-CANT
	PRINTI "put"
	CALL TPRINT,PRSO
	GET P-ITBL,P-PREP2 >STACK
	EQUAL? STACK,PR?ON \?L6
	PRINTI " on"
	JUMP ?L8
?L6:	PRINTI " in"
?L8:	CALL TPRINT,PRSI
	PRINTI " when"
	CALL TPRINT,PRSI
	PRINTI " is already "
	FSET? PRSO,SURFACEBIT \?L9
	PRINTI "on"
	JUMP ?L11
?L9:	PRINTI "in"
?L11:	CALL TPRINT,PRSO
	PRINTR "!"
?L5:	IN? PRSO,GLOBAL-OBJECTS /?L13
	FSET? PRSO,TAKEBIT /?L12
?L13:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L12:	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSI,GROUND \?L15
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L15:	ZERO? PRSI /?L16
	CALL ACCESSIBLE?,PRSI >STACK
	ZERO? STACK \?L16
	CALL CANT-SEE-ANY,PRSI
	RTRUE
?L16:	FSET? PRSO,WORNBIT \FALSE
	CALL TAKE-OFF-PRSO-FIRST >STACK
	RSTACK

	.FUNCT V-PUT,?TMP
	EQUAL? PRSO,SKIS \?L1
	EQUAL? PRSI,BS-SAFE,WALL-SAFE,SACK /?L3
	EQUAL? PRSI,COMPARTMENT \?L1
?L3:	PRINTR "The skis can't possibly fit in there."
?L1:	ZERO? PRSI /?L4
	FSET? PRSI,OPENBIT /?L5
	FSET? PRSI,DOORBIT /?L4
	FSET? PRSI,CONTBIT /?L4
	FSET? PRSI,SURFACEBIT /?L4
	PRINT YOU-CANT
	PRINTR "possibly do that!"
?L4:	FSET? PRSI,OPENBIT /?L5
	FSET? PRSI,SURFACEBIT /?L5
	CALL BUT-THE,PRSI
	PRINTI "isn't open!"
	CRLF
	CALL THIS-IS-IT,PRSI >STACK
	RSTACK
?L5:	EQUAL? PRSI,PRSO \?L6
	CALL WHAT-A-CONCEPT >STACK
	RSTACK
?L6:	IN? PRSO,PRSI \?L7
	CALL BUT-THE,PRSO
	PRINTI "is already "
	FSET? PRSI,SURFACEBIT \?L8
	PRINTI "on "
	JUMP ?L10
?L8:	PRINTI "in "
?L10:	CALL TPRINT,PRSI
	PRINTR "!"
?L7:	FSET? PRSI,BURNBIT \?L11
	FSET? PRSO,FLAMEBIT \?L11
	CALL PERFORM,V?BURN,PRSI,PRSO
	RTRUE
?L11:	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \?L12
	PRINTR "There's no room."
?L12:	IN? PRSO,PLAYER /?L13
	CALL ITAKE >STACK
	EQUAL? STACK,0,M-FATAL /TRUE
?L13:	MOVE PRSO,PRSI
	FSET PRSO,TOUCHBIT
	PRINTR "Done."

	.FUNCT V-PUT-BEHIND
	PRINTR "That hiding place is too obvious."

	.FUNCT V-PUT-ON
	EQUAL? PRSI,ME \?L1
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L1:	FSET? PRSI,SURFACEBIT \?L3
	CALL V-PUT >STACK
	RSTACK
?L3:	EQUAL? PRSI,FILM-PROJECTOR \?L4
	CALL V-PUT >STACK
	RSTACK
?L4:	PRINTI "There's no good surface on"
	ZERO? PRSI /?L6
	CALL TPRINT,PRSI
	JUMP ?L8
?L6:	PRINTI " that"
?L8:	PRINTR "."

	.FUNCT V-PUT-UNDER
	PRINT YOU-CANT
	PRINTR "put anything under that."

	.FUNCT V-QUESTION
	CALL V-ASK-FOR >STACK
	RSTACK

	.FUNCT V-QUIT,ASK?=1
	CALL V-SCORE
	ZERO? ASK? /?L1
	CALL SAY-SURE
	PRINTI "leave the story now?"
	CALL YES? >STACK
	ZERO? STACK /?L3
	CRLF
	PRINTI "Cut! That's a take."
	CRLF
	QUIT
?L3:	PRINT OKAY
	PRINTR "continuing."
?L1:	QUIT

	.FUNCT V-RAPE
	PRINTI "What a wholesome idea."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?72,STACK >STACK
	RSTACK

	.FUNCT V-RAISE
	EQUAL? PRSO,ROOMS \?L1
	CALL PERFORM,V?STAND,ROOMS
	RTRUE
?L1:	CALL HACK-HACK,STR?73 >STACK
	RSTACK

	.FUNCT V-REACH-IN,OBJ
	FIRST? PRSO >OBJ /?L1
?L1:	FSET? PRSO,ACTORBIT \?L2
	CALL NOT-A,STR?43 >STACK
	RSTACK
?L2:	FSET? PRSO,CONTBIT /?L4
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L4:	FSET? PRSO,OPENBIT /?L5
	PRINTR "It's not open."
?L5:	ZERO? OBJ /?L7
	FSET? OBJ,INVISIBLE /?L7
	FSET? OBJ,TAKEBIT /?L6
?L7:	PRINTR "It's empty."
?L6:	PRINTI "You reach into"
	CALL TPRINT,PRSO
	PRINTR " and feel something."

	.FUNCT V-READ
	FSET? PRSO,READBIT \?L1
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	CALL CANT-VERB-A-PRSO,STR?74 >STACK
	RSTACK

	.FUNCT CANT-VERB-A-PRSO,STRING
	PRINT YOU-CANT
	PRINT STRING
	CALL APRINT,PRSO
	PRINTR "!"

	.FUNCT V-READ-TO
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	FSET? PRSO,READBIT /?L3
	CALL HOW-READ
	PRINTI " to"
	CALL APRINT,PRSI
	PRINTR "?"
?L3:	CALL NOT-LIKELY,PRSI,STR?75 >STACK
	RSTACK

	.FUNCT HOW-READ
	PRINTI "How can you read"
	CALL APRINT,PRSO
	RTRUE

	.FUNCT V-REMOVE
	FSET? PRSO,WORNBIT \?L1
	CALL PERFORM,V?TAKE-OFF,PRSO
	RTRUE
?L1:	CALL PERFORM,V?TAKE,PRSO
	RTRUE

	.FUNCT V-REMOVE-FROM
	EQUAL? PRSO,WAX-COAT-2,WAX-COAT-1 \?L1
	EQUAL? PRSI,GREEN-MATCH,RED-MATCH \?L1
	CALL PERFORM,V?SCRAPE-OFF,PRSO,PRSI
	RTRUE
?L1:	CALL PERFORM,V?TAKE,PRSO,PRSI
	RTRUE

	.FUNCT V-REPLACE
	EQUAL? PRSO,ME \?L1
	PRINTI "That's easy"
	JUMP ?L3
?L1:	CALL BUT-THE,PRSO
	PRINTI "doesn't need replacement"
?L3:	PRINTR "."

	.FUNCT V-REPLY
	CALL NOT-LIKELY,PRSO,STR?76
	CALL PCLEAR
	RETURN 2

	.FUNCT V-RESCUE
	EQUAL? PRSO,ME \?L1
	CALL V-HELP >STACK
	RSTACK
?L1:	CALL BUT-THE,PRSO
	PRINTR "doesn't need any help."

	.FUNCT V-RESET
	PRINTR "You don't need to reset that."

	.FUNCT V-RESTART
	CALL V-SCORE
	CALL SAY-SURE
	PRINTI "restart the story?"
	CALL YES? >STACK
	ZERO? STACK /FALSE
	RESTART

	.FUNCT V-RESTORE
	RESTORE \?L1
	CALL SAY-OKAY >STACK
	RSTACK
?L1:	CALL FAILED >STACK
	RSTACK

	.FUNCT V-RIDE
	FSET? PRSO,ACTORBIT \?L1
	CALL PRINT-ID,STR?77
	CALL NOT-LIKELY,PRSO,STR?78
	CRLF
	RTRUE
?L1:	PRINT YOU-CANT
	PRINTI "ride that!"
	CRLF
	CRLF
	RTRUE

	.FUNCT ROB,WHO,WHERE,N,X
	FIRST? WHO >X /?L11
	RTRUE
?L1:	ZERO? X /TRUE
?L11:	NEXT? X >N /?L6
?L6:	FSET? X,TAKEBIT \?L7
	MOVE X,WHERE
?L7:	SET 'X,N
	JUMP ?L1

	.FUNCT V-ROLL-UP
	PRINT YOU-CANT
	PRINTI "roll up"
	CALL APRINT,PRSO
	PRINTR "."

	.FUNCT V-RUB
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?79,STACK
	CALL HACK-HACK,STR?80 >STACK
	RSTACK

	.FUNCT V-SAVE
	PRINTI "You can almost hear Buck Palace saying, ""Wimp!"""
	CRLF
	CRLF
	SAVE \?L1
	CALL SAY-OKAY >STACK
	RSTACK
?L1:	CALL FAILED >STACK
	RSTACK

	.FUNCT V-SAY
	CALL ANYONE-HERE? >STACK
	ZERO? STACK /?L1
	CALL WAY-TO-TALK
	CALL PCLEAR
	RETURN 2
?L1:	CALL TALK-TO-SELF >STACK
	RSTACK

	.FUNCT SAY-IF-NOT-LIT
	CALL LIT?,HERE >LIT
	ZERO? LIT \FALSE
	CRLF
	CALL NOW-BLACK
	CRLF
	RTRUE

	.FUNCT SAY-OKAY
	PRINT OKAY
	PRINTR "done."

	.FUNCT SAY-SURE
	PRINTI "Are you sure you want to "
	RTRUE

	.FUNCT V-SCORE
	PRINTI "Your score is "
	PRINTN SCORE
	PRINTI " point"
	EQUAL? SCORE,1 /?L1
	PRINTI "s"
?L1:	PRINTI " out of "
	PRINTN SCORE-MAX
	PRINTI ", in "
	PRINTN MOVES
	PRINTI " move"
	EQUAL? MOVES,1 /?L4
	PRINTI "s"
?L4:	PRINTR "."

	.FUNCT V-SCRAPE-OFF
	ZERO? PRSI /?L1
	PRINTI "You can't scrape"
	CALL TPRINT,PRSO
	PRINTI " off"
	CALL TPRINT,PRSI
	PRINTR "!"
?L1:	PRINTI "There's nothing to scrape off"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-SCRIPT
	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	CALL TRANSCRIPT,STR?81
	RTRUE

	.FUNCT V-UNSCRIPT
	CALL TRANSCRIPT,STR?82
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT TRANSCRIPT,STR
	PRINTI "Here "
	PRINT STR
	PRINTI "s a transcript of interaction with"
	CRLF
	CALL V-VERSION >STACK
	RSTACK

	.FUNCT V-SEARCH
	EQUAL? PRSO,ME \?L1
	CALL V-HELP >STACK
	RSTACK
?L1:	FSET? PRSO,CONTBIT \?L3
	FSET? PRSO,OPENBIT /?L4
	FSET? PRSO,TRANSBIT /?L4
	CALL YOUD-HAVE-TO,STR?23,PRSO >STACK
	RSTACK
?L4:	PRINTI "You find"
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINTR "."
?L3:	FSET? PRSO,SURFACEBIT \?L10
	PRINTI "You find"
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINTR "."
?L10:	FSET? PRSO,ACTORBIT \?L14
	CALL PERFORM,V?USE,PRSO
	RTRUE
?L14:	CALL NOTHING-INTERESTING >STACK
	RSTACK

	.FUNCT V-SHAKE,X
	FSET? PRSO,ACTORBIT \?L1
	CALL PERFORM,V?ALARM,PRSO
	RTRUE
?L1:	FSET? PRSO,TAKEBIT /?L3
	FSET? PRSO,TRYTAKEBIT /?L3
	CALL HACK-HACK,STR?83 >STACK
	RSTACK
?L3:	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-SHOOT
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?84,STACK
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?85,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?86,STACK
	CALL IS-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?87,STACK
	ZERO? PRSI \?L1
	CALL ULTIMATELY-IN?,GUN >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?SHOOT,GUN,PRSO
	RTRUE
?L1:	FSET? PRSO,ACTORBIT \?L3
	PRINTR "You haven't got a gun."
?L3:	PRINTR "You can't shoot that."

	.FUNCT V-SSHOOT
	CALL PERFORM,V?SHOOT,PRSI,PRSO
	RTRUE

	.FUNCT V-SHOW
	PRINTI "It isn't likely that"
	CALL TPRINT,PRSI
	PRINTR " is interested."

	.FUNCT V-SSHOW
	CALL PERFORM,V?SHOW,PRSI,PRSO
	RTRUE

	.FUNCT V-SIT,VEHICLE
	EQUAL? PRSO,ROOMS \?L1
	CALL GLOBAL-IN?,SEAT,HERE >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?BOARD,SEAT
	RTRUE
?L1:	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT PRE-SKI
	FSET? SKIS,WORNBIT /FALSE
	PRINTR "You're not wearing skis!"

	.FUNCT V-SKI
	EQUAL? PRSO,INTDIR \?L1
	EQUAL? P-DIRECTION,P?UP \?L3
	PRINTR "There's no tow rope here."
?L3:	CALL DO-WALK,P-DIRECTION >STACK
	RSTACK
?L1:	PRINTR "You can't ski down that!"

	.FUNCT V-SLEEP
	PRINTR "Maybe you should've had a nap before the lawyer dropped you off."

	.FUNCT V-SMELL
	EQUAL? PRSO,ROOMS \?L1
	PRINTI "You smell nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	JUMP ?L3
?L1:	PRINTI "It smells just like"
	CALL APRINT,PRSO
?L3:	PRINTR "."

	.FUNCT V-SPLICE
	PRINT YOU-CANT
	PRINTR "splice that!"

	.FUNCT V-SQUEEZE
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-STAND
	ZERO? PRSO /?L3
	EQUAL? PRSO,ROOMS \?L1
?L3:	PRINTR "You're already standing."
?L1:	PRINT YOU-CANT
	PRINTR "stand that up."

	.FUNCT V-STAND-ON
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?88,STACK
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-STAND-UNDER
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-SWING
	ZERO? PRSI \?L1
	PRINTR "Whoosh!"
?L1:	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?89,STACK
	CALL PERFORM,V?KILL,PRSI,PRSO
	RTRUE

	.FUNCT V-SWIM
	ZERO? PRSO /?L1
	EQUAL? PRSO,INTDIR \?L3
	FSET? PLAYER,WETBIT \?L5
	CALL DO-WALK,P-DIRECTION >STACK
	RSTACK
?L5:	PRINTR "You'd be swimming in air."
?L3:	PRINTI "You can't swim in"
	CALL ARPRINT,PRSO
	RTRUE
?L1:	CALL GLOBAL-IN?,WATER,HERE >STACK
	ZERO? STACK /?L9
	CALL PERFORM,V?SWIM,WATER
	RTRUE
?L9:	PRINT YOU-CANT
	PRINTR "swim here!"

	.FUNCT V-SWIM-UP
	CALL DO-WALK,P?UP >STACK
	RSTACK

	.FUNCT V-SWIM-DOWN
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT PRE-TAKE,CONTAINER
	LOC PRSO >CONTAINER
	IN? PRSO,WINNER \?L1
	PRINTI "You're already "
	FSET? PRSO,WORNBIT \?L3
	PRINTI "wear"
	JUMP ?L5
?L3:	PRINTI "hold"
?L5:	PRINTR "ing it."
?L1:	ZERO? CONTAINER /?L6
	FSET? CONTAINER,CONTBIT \?L6
	FSET? CONTAINER,OPENBIT /?L6
	PRINT YOU-CANT
	PRINTI "reach into"
	CALL TPRINT,CONTAINER
	PRINTR ". It's closed."
?L6:	ZERO? PRSI /?L7
	EQUAL? PRSO,ME \?L8
	CALL PERFORM,V?DROP,PRSI
	RTRUE
?L8:	EQUAL? PRSO,WATER \?L10
	EQUAL? PRSI,POND /FALSE
?L10:	IN? PRSO,PRSI /?L11
	EQUAL? PRSO,RING \?L12
	EQUAL? PRSI,DOG \?L12
	FSET? DOG,EVERYBIT /FALSE
?L12:	EQUAL? PRSO,LADDER \?L14
	EQUAL? PRSI,HATCH-HOLE \?L14
	FSET? LADDER,EVERYBIT /FALSE
?L14:	EQUAL? PRSO,LENS-CAP \?L15
	EQUAL? PRSI,FILM-PROJECTOR-LENS \?L15
	FSET? LENS-CAP,NDESCBIT /FALSE
?L15:	FSET? PRSI,ACTORBIT /?L19
	EQUAL? PRSI,DOG \?L17
?L19:	CALL BUT-THE,PRSI
	PRINTI "doesn't have"
	CALL APRINT,PRSO
	JUMP ?L20
?L17:	CALL BUT-THE,PRSO
	PRINTI "isn't in"
	CALL TPRINT,PRSI
?L20:	PRINTR "."
?L11:	CALL ULTIMATELY-IN?,PRSO,BUCKET >STACK
	ZERO? STACK /FALSE
	ZERO? BUCKET-PEG /FALSE
	PRINT PEG-IN-WAY
	RTRUE
?L7:	CALL ULTIMATELY-IN?,PRSO,BUCKET >STACK
	ZERO? STACK /?L23
	ZERO? BUCKET-PEG /?L23
	PRINT PEG-IN-WAY
	RTRUE
?L23:	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	PRINTR "You're in it!"

	.FUNCT V-TAKE
	CALL ITAKE >STACK
	ZERO? STACK /FALSE
	PRINTI "Taken."
	CRLF
	CALL IS-THEFT? >STACK
	CALL PRINT-ID,STR?90,STACK >STACK
	RSTACK

	.FUNCT ITAKE,VB=1
	CALL THIS-IS-IT,PRSO
	FSET? PRSO,TAKEBIT /?L1
	ZERO? VB /FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RFALSE
?L1:	CALL TOO-MUCH-JUNK?,VB >STACK
	ZERO? STACK \FALSE
	CALL BOKS-BIG-ONE,PRSO >STACK
	ZERO? STACK /?L7
	EQUAL? TREASURES-FOUND,10 /FALSE
?L7:	MOVE PRSO,WINNER
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	RTRUE

	.FUNCT BOKS-BIG-ONE,T-OBJ
	GETP T-OBJ,P?VALUE >STACK
	ZERO? STACK /FALSE
	GETP T-OBJ,P?VALUE >STACK
	ADD SCORE,STACK >SCORE
	PUTP T-OBJ,P?VALUE,0
	INC 'TREASURES-FOUND
	EQUAL? TREASURES-FOUND,10 \TRUE
	LOC T-OBJ >STACK
	MOVE PEG-0,STACK
	LOC T-OBJ >STACK
	MOVE NOTE,STACK
	EQUAL? T-OBJ,FINCH /?L5
	MOVE T-OBJ,WINNER
?L5:	FSET T-OBJ,TOUCHBIT
	FCLEAR T-OBJ,NDESCBIT
	EQUAL? T-OBJ,RING \?L8
	PRINTI "As you take"
	CALL TPRINT,PRSO
	PRINTI ", a small peg and a note drop out from under the model."
	CRLF
	MOVE PEG-0,HERE
	MOVE NOTE,HERE
	RTRUE
?L8:	PRINTI "As you "
	PRINTB P-PRSA-WORD
	CALL TPRINT,PRSO
	PRINTI " you notice a wooden peg and a note "
	EQUAL? T-OBJ,CORPSE-LINE,GRATER,PARKING-METER \?L11
	PRINTI "behind"
	JUMP ?L14
?L11:	EQUAL? T-OBJ,FINCH \?L13
	PRINTI "next to"
	CALL ARPRINT,FINCH
	RTRUE
?L13:	PRINTI "beneath"
?L14:	PRINTR " it."

	.FUNCT V-TAKE-OFF,WHERE
	EQUAL? P-PRSA-WORD,W?GET \?L1
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L1:	IN? PRSO,PLAYER \?L3
	FSET? PRSO,WORNBIT \?L3
	FCLEAR PRSO,WORNBIT
	PRINT OKAY
	PRINTI "you're no longer wearing"
	CALL TRPRINT,PRSO
	RTRUE
?L3:	PRINTR "You aren't wearing that!"

	.FUNCT TAKE-OFF-PRSO-FIRST
	PRINTI "You'll have to remove"
	CALL TPRINT,PRSO
	PRINTR " first."

	.FUNCT V-TASTE
	CALL PERFORM,V?EAT,PRSO
	RTRUE

	.FUNCT V-TELL
	EQUAL? PRSO,ME,ROOMS \?L1
	CALL TALK-TO-SELF >STACK
	RSTACK
?L1:	FSET? PRSO,ACTORBIT \?L3
	ZERO? P-CONT /?L4
	SET 'WINNER,PRSO
	LOC WINNER >HERE
	RETURN HERE
?L4:	CALL NO-ANSWER >STACK
	RSTACK
?L3:	PRINT YOU-CANT
	PRINTI "talk to"
	CALL APRINT,PRSO
	PRINTI "!"
	CRLF
	CALL PCLEAR
	RETURN 2

	.FUNCT TELL-TIME,MINUTES,HOURS,PM=0
	ADD MOVES,1260 >MINUTES
	GRTR? MINUTES,1439 \?L1
	SUB MINUTES,1440 >MINUTES
?L1:	DIV MINUTES,60 >HOURS
	GRTR? HOURS,11 \?L4
	SET 'PM,1
	SUB HOURS,12 >HOURS
?L4:	ZERO? HOURS \?L7
	SET 'HOURS,12
?L7:	PRINTN HOURS
	PRINTI ":"
	MOD MINUTES,60 >MINUTES
	LESS? MINUTES,10 \?L10
	PRINTI "0"
?L10:	PRINTN MINUTES
	ZERO? PM /?L13
	PRINTI " pm"
	RTRUE
?L13:	PRINTI " am"
	RTRUE

	.FUNCT V-TIME
	PRINTI "It's "
	CALL TELL-TIME
	PRINTR "."

	.FUNCT V-THROW
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	CALL SPECIAL-DROP >STACK
	ZERO? STACK \TRUE
	ZERO? PRSI /?L5
	PRINTR "You missed."
?L5:	PRINTR "Thrown."

	.FUNCT V-THROW-OFF
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-TIE
	PRINT YOU-CANT
	PRINTI "tie"
	CALL TPRINT,PRSO
	PRINTI " to that."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?91,STACK >STACK
	RSTACK

	.FUNCT V-TIE-UP
	PRINT YOU-CANT
	PRINTI "tie anything with that!"
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?92,STACK >STACK
	RSTACK

	.FUNCT TOO-DARK
	PRINTR "It's too dark to see!"

	.FUNCT TOO-MUCH-JUNK?,VB=1,?TMP
	LOC PRSO >STACK
	IN? STACK,WINNER /FALSE
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,WINNER >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,LOAD-ALLOWED \FALSE
	ZERO? VB /TRUE
	FIRST? PLAYER >STACK \?L5
	PRINTI "Your load is"
	JUMP ?L7
?L5:	PRINTI "It's a little"
?L7:	PRINTR " too heavy."

	.FUNCT V-TURN
	FSET? PRSO,TAKEBIT /?L1
	FSET? PRSO,TRYTAKEBIT /?L1
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	CALL HACK-HACK,STR?93 >STACK
	RSTACK

	.FUNCT V-TURN-LEFT
	CALL V-TURN >STACK
	RSTACK

	.FUNCT V-TURN-RIGHT
	CALL V-TURN >STACK
	RSTACK

	.FUNCT V-USE
	FSET? PRSO,ACTORBIT \?L1
	CALL BUT-THE,PRSO
	PRINTI "might resent that."
	CRLF
	CALL PRINT-ID,STR?94
	RTRUE
?L1:	CALL HOW? >STACK
	RSTACK

	.FUNCT V-VERBOSE
	SET 'VERBOSITY,2
	PRINTI "[Maximum verbosity.]"
	CRLF
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT V-BRIEF
	SET 'VERBOSITY,1
	PRINTR "[Brief descriptions.]"

	.FUNCT V-SUPER-BRIEF
	SET 'VERBOSITY,0
	PRINTR "[Superbrief descriptions.]"

	.FUNCT V-VERSION,CNT=17,V
	GET 0,1 >STACK
	BAND STACK,2047 >V
	CRLF
	PRINTI "HOLLYWOOD HIJINX
Infocom interactive fiction -- a zany treasure hunt
Copyright (C) 1986 Infocom, Inc. All rights reserved.
"
	GETB 0,1 >STACK
	BTST STACK,8 \?L1
	PRINTI "Licensed to Tandy Corporation. Version 00.00."
	PRINTN V
	CRLF
?L1:	PRINTI "HOLLYWOOD HIJINX is a trademark of Infocom, Inc.
Release "
	PRINTN V
	PRINTI " / Serial Number "
?L4:	IGRTR? 'CNT,23 /?L5
	GETB 0,CNT >STACK
	PRINTC STACK
	JUMP ?L4
?L5:	CRLF
	RTRUE

	.FUNCT V-$0024VERIFY
	ZERO? PRSO /?L1
	EQUAL? PRSO,INTNUM \?L3
	EQUAL? P-NUMBER,57 \?L3
	PRINTN SERIAL
	CRLF
	RTRUE
?L3:	CALL DONT-UNDERSTAND >STACK
	RSTACK
?L1:	PRINTI "Verifying disk."
	CRLF
	VERIFY \?L7
	PRINTR "Correct."
?L7:	CALL FAILED >STACK
	RSTACK

	.FUNCT V-$0024COMMAND
	DIRIN 1
	RTRUE

	.FUNCT V-$0024RANDOM
	EQUAL? PRSO,INTNUM /?L1
	PRINTR "Illegal."
?L1:	SUB 0,P-NUMBER >STACK
	RANDOM STACK >STACK
	RTRUE

	.FUNCT V-$0024RECORD
	DIROUT D-RECORD-ON
	RTRUE

	.FUNCT V-$0024UNRECORD
	DIROUT D-RECORD-OFF
	RTRUE

	.FUNCT V-UNLOCK
	FSET? PRSO,DOORBIT /?L3
	FSET? PRSO,CONTBIT \?L1
?L3:	FSET? PRSO,OPENBIT \?L4
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " is already open. You should have eaten more carrots as Aunt Hildegarde always told you."
?L4:	FSET? PRSO,LOCKEDBIT /?L6
	PRINTI "You attempt to unlock"
	CALL TPRINT,PRSO
	PRINTR " and find it isn't locked."
?L6:	ZERO? PRSI /?L7
	PRINTI "When was the last time you unlocked something with"
	CALL APRINT,PRSI
	PRINTR "?"
?L7:	FSET? PRSO,DOORBIT \?L8
	FSET? HERE,LOCKEDBIT /?L9
	PRINT YOU-CANT
	PRINTR "unlock it from this side."
?L9:	PRINTI "With a click you unlock"
	CALL TRPRINT,PRSO
	FCLEAR PRSO,LOCKEDBIT
	RTRUE
?L8:	FSET? PRSO,CONTBIT \?L12
	FSET? PRSO,LOCKEDBIT \?L12
	PRINTR "Perhaps if you had the combination..."
?L12:	CALL THING-WONT-LOCK,PRSI,PRSO,1 >STACK
	RSTACK
?L1:	CALL CANT-LOCK,1 >STACK
	RSTACK

	.FUNCT V-UNROLL
	PRINT YOU-CANT
	PRINTI "unroll"
	CALL ARPRINT,PRSO
	RTRUE

	.FUNCT V-UNTIE
	PRINTR "You don't need to untie it. It's not tied to anything."

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR
	RTRUE

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	FSET? SKIS,WORNBIT \?L1
	EQUAL? PRSO,P?DOWN /?L1
	PRINTI "These are downhill skis, not cross-country skis!"
	CRLF
	RETURN 2
?L1:	ZERO? P-WALK-DIR \?L5
	ZERO? PRSO /?L6
	CALL PRESUMABLY-YOU-WANT-TO,STR?95,PRSO
	CALL PERFORM,V?WALK-TO,PRSO
	RTRUE
?L6:	CALL V-WALK-AROUND
	RTRUE
?L5:	LOC PLAYER >STACK
	EQUAL? STACK,HERE /?L9
	PRINTI "You're not going anywhere while you're on"
	LOC PLAYER >STACK
	CALL TRPRINT,STACK
	RETURN 2
?L9:	GETPT HERE,PRSO >PT
	ZERO? PT /?L12
	PTSIZE PT >PTS
	EQUAL? PTS,UEXIT \?L13
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L13:	EQUAL? PTS,NEXIT \?L15
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L15:	EQUAL? PTS,FEXIT \?L18
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L19
	CALL GOTO,RM >STACK
	RSTACK
?L19:	RETURN 2
?L18:	EQUAL? PTS,CEXIT \?L24
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L25
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L25:	GET PT,CEXITSTR >STR
	ZERO? STR /?L27
	PRINT STR
	CRLF
	RETURN 2
?L27:	CALL CANT-GO
	RETURN 2
?L24:	EQUAL? PTS,DEXIT \FALSE
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L34
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L34:	GET PT,DEXITSTR >STR
	ZERO? STR /?L36
	PRINT STR
	CRLF
	CALL THIS-IS-IT,OBJ
	RETURN 2
?L36:	CALL ITS-CLOSED,OBJ
	RETURN 2
?L12:	EQUAL? P-WALK-DIR,P?IN,P?OUT \?L44
	PRINTR "Please use compass directions."
?L44:	CALL CANT-GO
	RETURN 2

	.FUNCT V-WALK-AROUND
	PRINTR "[Do you have any particular direction in mind?]"

	.FUNCT V-WALK-TO
	EQUAL? PRSO,INTDIR \?L1
	CALL DO-WALK,P-DIRECTION >STACK
	RSTACK
?L1:	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT V-WAIT,NUM=3
	PRINTI "Time passes."
	CRLF
?L1:	DLESS? 'NUM,0 /?L2
	CALL CLOCKER >STACK
	ZERO? STACK /?L1
?L2:	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT

	.FUNCT V-$0024WAIT,NUM
	EQUAL? PRSO,INTNUM \?L1
	SET 'NUM,P-NUMBER
	PRINTI "Time passes."
	CRLF
?L3:	DLESS? 'NUM,0 /?L4
	CALL CLOCKER >STACK
	ZERO? STACK /?L3
?L4:	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT
?L1:	PRINTR "Youse should use a numba."

	.FUNCT V-WAIT-FOR
	LOC PRSO >STACK
	EQUAL? STACK,HERE,WINNER \?L1
	CALL BUT-THE,PRSO
	PRINTR "is already here!"
?L1:	PRINTR "You may be waiting quite a while."

	.FUNCT PRE-WATER
	ZERO? PRSI /?L1
	EQUAL? PRSI,PORTABLE-WATER /FALSE
	EQUAL? PRSI,BUCKET \?L5
	IN? PORTABLE-WATER,BUCKET \?L5
	SET 'PRSI,PORTABLE-WATER
	RFALSE
?L5:	PRINTI "As the word implies, you can only water"
	CALL APRINT,PRSO
	PRINTR " with water."
?L1:	CALL ULTIMATELY-IN?,PORTABLE-WATER >STACK
	ZERO? STACK /?L8
	SET 'PRSI,PORTABLE-WATER
	RFALSE
?L8:	PRINTI "You don't have any water to water"
	CALL TPRINT,PRSO
	PRINTR " with!"

	.FUNCT V-WATER
	PRINTI "A nice thought, but"
	CALL TPRINT,PRSO
	PRINTR " doesn't need watering."

	.FUNCT V-WAVE-AT
	CALL V-ASK-FOR >STACK
	RSTACK

	.FUNCT V-WEAR
	FSET? PRSO,WORNBIT \?L1
	PRINTI "You're already wearing"
	CALL TRPRINT,PRSO
	RTRUE
?L1:	FSET? PRSO,WEARBIT /?L3
	PRINT YOU-CANT
	PRINTI "wear"
	CALL ARPRINT,PRSO
	RTRUE
?L3:	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \TRUE
	FSET PRSO,WORNBIT
	EQUAL? PRSO,TOUPEE \?L6
	PRINTI "You put on "
	CALL DPRINT,TOUPEE
	PRINTR " in an attempt to cover that Burbank bald spot."
?L6:	EQUAL? PRSO,MASK \?L8
	PRINTI "You slip on"
	CALL TPRINT,MASK
	PRINTR " and feel an unexplainable urge to go to summer camp."
?L8:	PRINT OKAY
	PRINTI "you're now wearing"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT WEIGHT,THING,OBJ,WT=0
	FIRST? THING >OBJ \?L3
?L11:	EQUAL? THING,PLAYER \?L6
	FSET? OBJ,WORNBIT \?L6
	INC 'WT
	JUMP ?L8
?L6:	CALL WEIGHT,OBJ >STACK
	ADD WT,STACK >WT
?L8:	NEXT? OBJ >OBJ /?L11
?L3:	GETP THING,P?SIZE >STACK
	ADD WT,STACK >WT
	RETURN WT

	.FUNCT V-YELL
	CALL PCLEAR
	CALL ANYONE-HERE? >STACK
	ZERO? STACK /?L1
	CALL WAY-TO-TALK
	RETURN 2
?L1:	PRINTR "You begin to get a sore throat."

	.FUNCT YES?,WORD
	CRLF
?L1:	CRLF
	PRINTI "(Please type YES or NO.) >"
	PUTB YES-LEXV,0,4
	READ YES-INBUF,YES-LEXV
	GET YES-LEXV,P-LEXSTART >WORD
	GETB YES-LEXV,P-LEXWORDS >STACK
	ZERO? STACK /?L1
	ZERO? WORD /?L1
	EQUAL? WORD,W?YES,W?Y,W?YUP /TRUE
	EQUAL? WORD,W?OKAY,W?OK,W?AYE /TRUE
	EQUAL? WORD,W?SURE,W?AFFIRM,W?POSITI /TRUE
	EQUAL? WORD,W?NO,W?N,W?NOPE /FALSE
	EQUAL? WORD,W?NAY,W?NAW,W?NEGATIVE \?L1
	RFALSE

	.FUNCT NOW-LIT?
	ZERO? LIT \FALSE
	CALL LIT?,HERE >STACK
	ZERO? STACK /FALSE
	SET 'LIT,1
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT WASTE-OF-TIME
	CALL PICK-ONE,USELESSNESS >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT FILM-F
	EQUAL? PRSA,V?EXAMINE \?L1
	IN? FILM,FILM-PROJECTOR \?L3
	FSET? FILM-PROJECTOR,ONBIT \?L3
	CALL PERFORM,V?EXAMINE,PROJECTION-SCREEN
	RTRUE
?L3:	CALL FILM-SLIDE-DESC,FILM,STR?96 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?TAKE \?L6
	IN? FILM,FILM-PROJECTOR \FALSE
	FSET? FILM-PROJECTOR,ONBIT \FALSE
	PRINTI "Even a nonunion projectionist like yourself should know how dangerous it is to try to take film from"
	CALL APRINT,FILM-PROJECTOR
	PRINTI " while it's running."
	CRLF
	CALL PRINT-ID,STR?97 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?PUT \FALSE
	FSET? FILM-PROJECTOR,ONBIT \?L10
	EQUAL? PRSI,FILM-PROJECTOR \?L10
	PRINTI "You start to put"
	CALL TPRINT,FILM
	PRINTI " in"
	CALL TPRINT,FILM-PROJECTOR
	PRINTI ", but glance up at a sign on the wall. The sign states: Remember, Perry Projectionist sez, ""Never try to put film in"
	CALL APRINT,FILM-PROJECTOR
	PRINTI " that's turned on."""
	CRLF
	CALL PRINT-ID,STR?98 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,SLIDE-PROJECTOR \FALSE
	PRINTI "The "
	CALL DPRINT,FILM
	PRINTI " won't fit in"
	CALL TRPRINT,PRSI
	RTRUE

	.FUNCT SLIDE-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL FILM-SLIDE-DESC,SLIDE >STACK
	RSTACK

	.FUNCT FILM-SLIDE-DESC,OBJ,STRING=0
	IN? OBJ,FILM-PROJECTOR /?L3
	IN? OBJ,SLIDE-PROJECTOR \?L1
?L3:	PRINTI "It's in"
	LOC OBJ >STACK
	CALL TPRINT,STACK
	PRINTR "."
?L1:	PRINTI "You examine the "
	ZERO? STRING /?L5
	PRINT STRING
?L5:	CALL DPRINT,OBJ
	PRINTR " closely. Whatever is on it is too small for you to make out."

	.FUNCT FILM-PROJECTOR-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a large, black, Simplex 70, 35mm "
	CALL DPRINT,FILM-PROJECTOR
	PRINTI ". In the front it has a short lens. "
	IN? LENS-CAP,FILM-PROJECTOR \?L3
	PRINTI "There's a lens cap on the lens. "
?L3:	PRINTI "The "
	CALL DPRINT,FILM-PROJECTOR
	IN? FILM,FILM-PROJECTOR \?L6
	PRINTI " has"
	CALL APRINT,FILM
	PRINTI " in it, and"
	JUMP ?L8
?L6:	IN? CORPSE-LINE,FILM-PROJECTOR \?L8
	PRINTI " has"
	CALL APRINT,CORPSE-LINE
	PRINTI " in it, and"
?L8:	PRINTI " is turned o"
	FSET? FILM-PROJECTOR,ONBIT \?L10
	PRINTI "n"
	JUMP ?L12
?L10:	PRINTI "ff"
?L12:	PRINTR "."
?L1:	EQUAL? PRSA,V?LAMP-ON \?L13
	FSET? FILM-PROJECTOR,ONBIT /?L13
	PRINTI "Immediately the projector begins to roll"
	FSET FILM-PROJECTOR,ONBIT
	IN? FILM,FILM-PROJECTOR /?L43
	IN? CORPSE-LINE,FILM-PROJECTOR \?L14
	IN? FILM,FILM-PROJECTOR \?L17
?L43:	CALL QUEUE,I-FILM-DROP,2
?L17:	PRINTI ". The film starts to run through the projector"
	FSET? LENS-CAP,EVERYBIT \?L27
	FSET SCREENING-ROOM,ONBIT
	PRINTI " and a stream of colored light shoots out of the lens onto the screen in the screening room"
	IN? CORPSE-LINE,FILM-PROJECTOR \?L27
	PRINTI "."
	CRLF
	CALL CORPSE-LINE-DEATH
	JUMP ?L27
?L14:	FSET? LENS-CAP,EVERYBIT \?L27
	FSET SCREENING-ROOM,ONBIT
	PRINTI ". A stream of white light shoots out of the lens of"
	CALL TPRINT,FILM-PROJECTOR
	PRINTI " onto the screen in the screening room"
?L27:	PRINTR "."
?L13:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L30
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK
?L30:	EQUAL? PRSA,V?LAMP-OFF \?L31
	FSET? FILM-PROJECTOR,ONBIT \?L31
	FCLEAR FILM-PROJECTOR,ONBIT
	FSET? SLIDE-PROJECTOR,ONBIT /?L32
	FCLEAR SCREENING-ROOM,ONBIT
?L32:	PRINTI "You hear"
	CALL TPRINT,FILM-PROJECTOR
	PRINTR "'s whining trail off as it rolls to a stop."
?L31:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSI,FILM-PROJECTOR \FALSE
	EQUAL? PRSO,FILM,CORPSE-LINE /?L36
	CALL WASTE-OF-TIME >STACK
	RSTACK
?L36:	IN? FILM,FILM-PROJECTOR /?L39
	IN? CORPSE-LINE,FILM-PROJECTOR \FALSE
?L39:	PRINTI "You'll have to take"
	FIRST? FILM-PROJECTOR >STACK /?L40
?L40:	CALL TPRINT,STACK
	PRINTR " out first."

	.FUNCT CORPSE-LINE-DEATH
	CRLF
	PRINTI "Your eyes are immediately drawn to the screen. "
	FSET? SLIDE-PROJECTOR,ONBIT \?L1
	PRINTI "Although it's a little distorted by the slide projector, you"
	JUMP ?L3
?L1:	PRINTI "You"
?L3:	CALL PRINT-ID,STR?99
	CALL JIGS-UP,STR?100 >STACK
	RSTACK

	.FUNCT I-FILM-DROP
	MOVE FILM,PROJECTION-BOOTH
	EQUAL? HERE,PROJECTION-BOOTH \FALSE
	CRLF
	PRINTI "The "
	CALL DPRINT,FILM
	PRINTI " runs out of"
	CALL TPRINT,FILM-PROJECTOR
	PRINTR " and onto the floor."

	.FUNCT PROJECTORS-DESC,OBJ,STRING=0
	PRINTI "It's"
	CALL APRINT,OBJ
	ZERO? STRING /?L1
	PRINT STRING
?L1:	PRINTI ". The "
	CALL DPRINT,OBJ
	PRINTI " "
	FIRST? OBJ >STACK \?L4
	PRINTI "has"
	FIRST? OBJ >STACK /?L6
?L6:	CALL APRINT,STACK
	PRINTI " in it"
	JUMP ?L7
?L4:	PRINTI "is empty"
?L7:	PRINTI " and is turned o"
	FSET? OBJ,ONBIT \?L8
	PRINTI "n"
	JUMP ?L10
?L8:	PRINTI "ff"
?L10:	PRINTR "."

	.FUNCT SLIDE-PROJECTOR-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL PROJECTORS-DESC,SLIDE-PROJECTOR,STR?101 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LAMP-ON \?L3
	FSET? SLIDE-PROJECTOR,ONBIT /?L3
	FSET SLIDE-PROJECTOR,ONBIT
	FSET SCREENING-ROOM,ONBIT
	PRINTI "A stream of "
	IN? SLIDE,SLIDE-PROJECTOR \?L4
	PRINTI "colored"
	JUMP ?L6
?L4:	PRINTI "white"
?L6:	PRINTI " light shoots out of the lens of"
	CALL TPRINT,SLIDE-PROJECTOR
	PRINTR " onto the screen in the screening room."
?L3:	EQUAL? PRSA,V?FOCUS \?L7
	CALL PERFORM,V?FOCUS,SLIDE-PROJECTOR-LENS
	RTRUE
?L7:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L8
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?LAMP-OFF \FALSE
	FSET? SLIDE-PROJECTOR,ONBIT \FALSE
	FCLEAR SLIDE-PROJECTOR,ONBIT
	FSET? FILM-PROJECTOR,ONBIT \?L12
	FSET? LENS-CAP,EVERYBIT /?L10
?L12:	FCLEAR SCREENING-ROOM,ONBIT
?L10:	PRINTI "You turn off"
	CALL TPRINT,SLIDE-PROJECTOR
	PRINTR " and the light from the lens fades away."

	.FUNCT PROJECTED-IMAGE-F
	EQUAL? PRSI,PROJECTED-IMAGE \?L1
	CALL PERFORM,PRSA,PRSO,PROJECTION-SCREEN
	RTRUE
?L1:	EQUAL? PRSO,PROJECTED-IMAGE \FALSE
	CALL PERFORM,PRSA,PROJECTION-SCREEN,PRSI
	RTRUE

	.FUNCT PROJECTION-SCREEN-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	PRINTI "The "
	CALL DPRINT,PROJECTION-SCREEN
	PRINTI " is "
	FSET? FILM-PROJECTOR,ONBIT \?L3
	FSET? LENS-CAP,EVERYBIT \?L3
	IN? FILM,FILM-PROJECTOR \?L5
	FSET? SLIDE-PROJECTOR,ONBIT \?L7
	IN? SLIDE,SLIDE-PROJECTOR \?L9
	FSET? SLIDE-PROJECTOR-LENS,EVERYBIT \?L11
	PRINTI "showing a message saying:

PLAY """
	GET SONGS,SONG-NUMBER >STACK
	PRINT STACK
	PRINTI ".""
         Love,
           Aunt Hildegarde"
	ZERO? PROJECTOR-POINTS \?L38
	ADD SCORE,10 >SCORE
	SET 'PROJECTOR-POINTS,1
	JUMP ?L38
?L11:	PRINTI "filled with bits of colored words and a blur of colored light"
	JUMP ?L38
?L9:	PRINT WASHED-OUT-BITS
	JUMP ?L38
?L7:	PRINT BITS-$0026-PIECES
	JUMP ?L38
?L5:	FSET? SLIDE-PROJECTOR,ONBIT \?L20
	IN? SLIDE,SLIDE-PROJECTOR \?L22
	FSET? SLIDE-PROJECTOR-LENS,EVERYBIT \?L24
	PRINT WASHED-OUT-BITS
	JUMP ?L38
?L24:	PRINT WASHED-OUT-BITS
	JUMP ?L38
?L22:	PRINT WHITE-LIGHT
	JUMP ?L38
?L20:	PRINT WHITE-LIGHT
	JUMP ?L38
?L3:	FSET? SLIDE-PROJECTOR,ONBIT \?L30
	IN? SLIDE,SLIDE-PROJECTOR \?L32
	FSET? SLIDE-PROJECTOR-LENS,EVERYBIT \?L34
	PRINT BITS-$0026-PIECES
	JUMP ?L38
?L34:	PRINTI "a blur of colored light"
	JUMP ?L38
?L32:	PRINT WHITE-LIGHT
	JUMP ?L38
?L30:	PRINTI "blank"
?L38:	PRINTR "."

	.FUNCT LENS-CAP-F
	EQUAL? PRSA,V?PUT-ON \?L6
	EQUAL? PRSI,FILM-PROJECTOR,FILM-PROJECTOR-LENS \?L1
	FCLEAR LENS-CAP,EVERYBIT
	FSET LENS-CAP,NDESCBIT
	FSET LENS-CAP,TRYTAKEBIT
	MOVE LENS-CAP,FILM-PROJECTOR
	FSET? SLIDE-PROJECTOR,ONBIT /?L3
	FSET? FILM-PROJECTOR,ONBIT \?L3
	FCLEAR SCREENING-ROOM,ONBIT
?L3:	PRINTI "You place"
	CALL TPRINT,LENS-CAP
	PRINTI " over"
	CALL TRPRINT,FILM-PROJECTOR-LENS
	RTRUE
?L1:	EQUAL? PRSA,V?PUT-ON \?L6
	EQUAL? PRSI,SLIDE-PROJECTOR,SLIDE-PROJECTOR-LENS \?L6
	PRINTI "The "
	CALL DPRINT,LENS-CAP
	PRINTI " won't fit on"
	CALL TRPRINT,PRSI
	RTRUE
?L6:	EQUAL? PRSA,V?UNTIE,V?TAKE-OFF \?L7
	FSET? LENS-CAP,EVERYBIT /?L7
	CALL PERFORM,V?TAKE,LENS-CAP
	RTRUE
?L7:	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,LENS-CAP \FALSE
	FSET? LENS-CAP,EVERYBIT /FALSE
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	FSET LENS-CAP,EVERYBIT
	FCLEAR LENS-CAP,NDESCBIT
	FCLEAR LENS-CAP,TRYTAKEBIT
	FSET? FILM-PROJECTOR,ONBIT \FALSE
	FSET SCREENING-ROOM,ONBIT
	PRINTI "As you remove"
	CALL TPRINT,LENS-CAP
	PRINTI " a stream of "
	IN? FILM,FILM-PROJECTOR /?L16
	IN? CORPSE-LINE,FILM-PROJECTOR \?L14
?L16:	PRINTI "colored"
	JUMP ?L17
?L14:	PRINTI "white"
?L17:	PRINTI " light shoots from"
	CALL TPRINT,FILM-PROJECTOR
	PRINTI "'s lens."
	CRLF
	IN? CORPSE-LINE,FILM-PROJECTOR \TRUE
	CALL CORPSE-LINE-DEATH
	RTRUE

	.FUNCT FILM-PROJECTOR-LENS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a hand-ground, all-aluminum, Bierman 500 "
	CALL DPRINT,FILM-PROJECTOR-LENS
	FSET? LENS-CAP,EVERYBIT /?L3
	PRINTI " with"
	CALL APRINT,LENS-CAP
	PRINTI " on it"
	JUMP ?L6
?L3:	FSET? FILM-PROJECTOR,ONBIT \?L6
	PRINTI ", with a spray of "
	IN? FILM,FILM-PROJECTOR \?L8
	PRINTI "colored"
	JUMP ?L10
?L8:	PRINTI "white"
?L10:	PRINTI " light coming out of it"
?L6:	PRINTR "."
?L1:	EQUAL? PRSA,V?TURN,V?FOCUS \?L12
	PRINT YOU-CANT
	PRINTI "adjust"
	CALL TPRINT,FILM-PROJECTOR-LENS
	PRINTR ". It's preset for Uncle Buddy's screening room."
?L12:	EQUAL? PRSA,V?UNTIE,V?TAKE \FALSE
	PRINT LENS-ATTACHED
	CRLF
	CALL PRINT-ID,STR?102 >STACK
	RSTACK

	.FUNCT SLIDE-PROJECTOR-LENS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a fairly expensive, focusable "
	CALL DPRINT,SLIDE-PROJECTOR-LENS
	FSET? SLIDE-PROJECTOR,ONBIT \?L3
	PRINTI ". A stream of "
	IN? SLIDE,SLIDE-PROJECTOR \?L5
	PRINTI "colored"
	JUMP ?L7
?L5:	PRINTI "white"
?L7:	PRINTI " light sprays from the lens"
?L3:	PRINTR "."
?L1:	EQUAL? PRSA,V?TURN,V?FOCUS \?L9
	FSET? SLIDE-PROJECTOR,ONBIT /?L10
	PRINTI "How can you focus"
	CALL TPRINT,SLIDE-PROJECTOR
	PRINTR " when it's not turned on?"
?L10:	FSET? SLIDE-PROJECTOR-LENS,EVERYBIT \?L12
	CALL YOU-ALREADY >STACK
	RSTACK
?L12:	IN? SLIDE,SLIDE-PROJECTOR /?L13
	PRINTI "How can you focus"
	CALL TPRINT,SLIDE-PROJECTOR
	PRINTR " when there's nothing in it?"
?L13:	PRINTI "You twist"
	CALL TRPRINT,SLIDE-PROJECTOR-LENS
	FSET SLIDE-PROJECTOR-LENS,EVERYBIT
	RTRUE
?L9:	EQUAL? PRSA,V?TAKE \FALSE
	PRINT LENS-ATTACHED
	CRLF
	CALL PRINT-ID,STR?103 >STACK
	RSTACK

	.FUNCT PROJECTION-BOOTH-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FSET? PROJECTION-BOOTH,EVERYBIT /FALSE
	FSET PROJECTION-BOOTH,EVERYBIT
	RANDOM 10 >STACK
	SUB STACK,1 >SONG-NUMBER
	RETURN SONG-NUMBER

	.FUNCT SCREENING-ROOM-PSEUDO-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL PERFORM,V?LOOK-INSIDE,WINDOW
	RTRUE

	.FUNCT OUTSIDE-PARLOR-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a long hall stretching east and west."
	FSET? WALL-SAFE,INVISIBLE \?L3
	PRINTI " There is a painting hanging here."
	RTRUE
?L3:	PRINTI " There is a painting swung away from the wall. Next to the painting is a"
	FSET? WALL-SAFE,OPENBIT \?L6
	PRINTI "n open"
	JUMP ?L8
?L6:	PRINTI " closed"
?L8:	PRINTI " wall safe."
	RTRUE

	.FUNCT PARLOR-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	ZERO? TIPPED /?L3
	PRINTI "This room is askew with the floor tilting down in the "
	EQUAL? TIPPED,CRAWL-SPACE-NORTH \?L5
	PRINTI "north and up in the south"
	JUMP ?L7
?L5:	PRINTI "south and up in the north"
?L7:	PRINTI ". The piano is "
	JUMP ?L8
?L3:	PRINTI "This is the parlor where Uncle Buddy would bring potential investors. He would break out his finest scotch and Cuban cigars. Once the ""guests"" were tight he would present his latest movie idea. (You've seen his movies, so you know anyone who would agree to invest in one of them had to have been drinking.) Strange, you notice all the furniture in this room is bolted to the floor, except for the piano "
?L8:	EQUAL? PIANO-LOC,1 \?L9
	PRINTI "against the northern wall"
	JUMP ?L12
?L9:	EQUAL? PIANO-LOC,2 \?L11
	PRINTI "in the middle of the room"
	JUMP ?L12
?L11:	PRINTI "against the southern wall"
?L12:	FSET? CRAWL-SPACE-DOOR,OPENBIT \?L13
	PRINTI ". There is an open door in the floor"
?L13:	PRINTI ". A doorway leads west."
	RTRUE

	.FUNCT TO-CRAWL-SPACE-NORTH
	FSET? CRAWL-SPACE-DOOR,OPENBIT \?L1
	FSET? SKIS,WORNBIT \?L3
	PRINTI "You can't fit through the opening wearing the skis."
	CRLF
	RFALSE
?L3:	EQUAL? TIPPED,CRAWL-SPACE-NORTH \?L5
	PRINTI "Now that the parlor is tilted, you can't fit into the crawl space."
	CRLF
	RFALSE
?L5:	RETURN CRAWL-SPACE-NORTH
?L1:	PRINTI "You can't go that way."
	CRLF
	RFALSE

	.FUNCT CRAWL-SPACE-DOOR-F
	EQUAL? PRSA,V?OPEN \FALSE
	EQUAL? HERE,PARLOR \FALSE
	ZERO? SONG-PLAYED /?L5
	FSET? CRAWL-SPACE-DOOR,OPENBIT /?L5
	FSET CRAWL-SPACE-DOOR,OPENBIT
	PRINTR "Opened."
?L5:	PRINTR "You can't seem to open it."

	.FUNCT CRAWL-SPACE-NORTH-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the northern half of an uncomfortably warm crawl space beneath the parlor. It appears as though this room is under construction."
	CALL DESCRIBE-CRAWL-SPACE-BEAM,STR?104
	PRINTI " To the north, about a foot above the floor, you see an entrance to a passage."
	ZERO? TIPPED \?L3
	PRINTI " The entrance is partially blocked by the floor of the room above."
?L3:	CALL DESCRIBE-NICHE,NORTH-NICHE
	PRINTI " There is a"
	FSET? CRAWL-SPACE-DOOR,OPENBIT \?L6
	PRINTI "n open"
	JUMP ?L8
?L6:	PRINTI " closed"
?L8:	PRINTI " door above you."
	RTRUE

	.FUNCT TO-CRAWL-SPACE-SOUTH
	EQUAL? TIPPED,CRAWL-SPACE-SOUTH \?L1
	PRINTI "You won't fit in the southern half of the crawl space. The ceiling shifted and now fills the space."
	CRLF
	RFALSE
?L1:	RETURN CRAWL-SPACE-SOUTH

	.FUNCT TO-FIRST-SECRET-ROOM
	EQUAL? TIPPED,CRAWL-SPACE-SOUTH \?L1
	RETURN FIRST-SECRET-ROOM
?L1:	PRINTI "You can't fit through the passage. It's partially blocked by the floor of the room above."
	CRLF
	RFALSE

	.FUNCT PARKING-METER-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "This is the parking meter that was the final frustration for budding actor Alan Chaplin in Uncle Buddy's ""You Can't Fight City Hall, But You Can Blow It Up!"""

	.FUNCT DESCRIBE-NICHE,NICHE
	PRINTI " There is a niche in the ceiling here."
	FIRST? NICHE >STACK \TRUE
	PRINTI " In"
	CALL TPRINT,NICHE
	PRINTI " there is"
	FIRST? NICHE >STACK /?L3
?L3:	CALL APRINT,STACK
	PRINTI " supporting the ceiling."
	RTRUE

	.FUNCT BEAM-PSEUDO
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "The thick, wooden beam runs across the ceiling of the crawl space."

	.FUNCT DESCRIBE-CRAWL-SPACE-BEAM,STRING
	PRINTI " A wooden beam runs east-west across the ceiling, forming the boundary between this side of the crawl space and the other half to the "
	PRINT STRING
	PRINTI "."
	RTRUE

	.FUNCT CRAWL-SPACE-SOUTH-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the southern half of an uncomfortably warm crawl space beneath the parlor."
	CALL DESCRIBE-CRAWL-SPACE-BEAM,STR?105
	CALL DESCRIBE-NICHE,SOUTH-NICHE >STACK
	RSTACK

	.FUNCT POST-F,OARG,POST-LOC
	LOC PRSO >POST-LOC
	EQUAL? PRSA,V?MOVE,V?TAKE \?L1
	FSET? PRSO,EVERYBIT \?L1
	PRINTR "The pillar won't budge from the niche."
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	EQUAL? POST-LOC,NORTH-NICHE,SOUTH-NICHE \?L4
	PRINTI "It's in"
	LOC PRSO >STACK
	CALL TRPRINT,STACK
	RTRUE
?L4:	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " is made of wood and is about two feet tall."
?L3:	EQUAL? PRSA,V?PUT \?L7
	EQUAL? PRSI,NORTH-NICHE,SOUTH-NICHE \?L7
	ZERO? TIPPED /?L8
	PRINTR "The post won't go in the niche now that the ceiling is tilted."
?L8:	EQUAL? PRSI,NORTH-NICHE \?L12
	EQUAL? PIANO-LOC,1 /?L14
?L12:	EQUAL? PRSI,SOUTH-NICHE \?L13
	EQUAL? PIANO-LOC,3 /?L14
?L13:	EQUAL? PIANO-LOC,2 \FALSE
	EQUAL? PRSI,NORTH-NICHE /?L14
	EQUAL? PRSI,SOUTH-NICHE \FALSE
?L14:	PRINTR "Because of the weight from above you can't put the pillar back in the niche."
?L7:	EQUAL? PRSA,V?BURN \FALSE
	PRINT PYRO
	CALL PRINT-ID,STR?106 >STACK
	RSTACK

	.FUNCT PIANO-F
	EQUAL? PRSA,V?PUSH-TO \?L1
	EQUAL? PRSI,INTDIR \?L1
	EQUAL? TIPPED,CRAWL-SPACE-NORTH,CRAWL-SPACE-SOUTH /?L3
	EQUAL? P-DIRECTION,P?NORTH \?L11
	EQUAL? PIANO-LOC,1 \?L5
	PRINTR "It's already up against the wall."
?L5:	EQUAL? P-DIRECTION,P?NORTH \?L11
	EQUAL? PIANO-LOC,2 \?L7
	IN? ROUND-POST,NORTH-NICHE \?L8
	FCLEAR SQUARE-POST,EVERYBIT
	SET 'PIANO-LOC,1
	PRINTR "The hearty breakfast you had this morning pays off as you push the piano north against the wall."
?L8:	SET 'TIPPED,CRAWL-SPACE-NORTH
	SET 'PIANO-LOC,1
	PRINTR "You push the piano north a couple of feet and the room begins to tip. As the north side of the parlor tips down, the piano rolls across the floor and against the north wall with an atonal banging of the keys. The south side of the floor tilts up."
?L7:	EQUAL? P-DIRECTION,P?NORTH \?L11
	EQUAL? PIANO-LOC,3 \?L11
	IN? ROUND-POST,NORTH-NICHE \?L12
	FSET ROUND-POST,EVERYBIT
?L12:	IN? SQUARE-POST,SOUTH-NICHE \?L15
	FSET SQUARE-POST,EVERYBIT
?L15:	SET 'PIANO-LOC,2
	PRINTR "You push the piano north to the center of the room."
?L11:	EQUAL? P-DIRECTION,P?SOUTH \?L29
	EQUAL? PIANO-LOC,1 \?L18
	IN? ROUND-POST,NORTH-NICHE \?L19
	FSET ROUND-POST,EVERYBIT
?L19:	IN? SQUARE-POST,SOUTH-NICHE \?L22
	FSET SQUARE-POST,EVERYBIT
?L22:	SET 'PIANO-LOC,2
	PRINTR "You push the piano south to the center of the room."
?L18:	EQUAL? P-DIRECTION,P?SOUTH \?L29
	EQUAL? PIANO-LOC,2 \?L25
	IN? SQUARE-POST,SOUTH-NICHE \?L26
	FCLEAR ROUND-POST,EVERYBIT
	SET 'PIANO-LOC,3
	PRINTR "The hearty breakfast you had this morning pays off as you push the piano south against the wall."
?L26:	MOVE ROUND-POST,CRAWL-SPACE-NORTH
	FCLEAR ROUND-POST,NDESCBIT
	FCLEAR ROUND-POST,EVERYBIT
	SET 'TIPPED,CRAWL-SPACE-SOUTH
	SET 'PIANO-LOC,3
	PRINTR "You push the piano south a couple of feet and the room begins to tip. As the south side of the parlor tips down the piano rolls across the floor and slams against the south wall. The north side of the floor tilts up."
?L25:	EQUAL? P-DIRECTION,P?SOUTH \?L29
	EQUAL? PIANO-LOC,3 \?L29
	PRINTR "It's already up against the wall."
?L29:	EQUAL? P-DIRECTION,P?EAST,P?WEST,P?NE /?L31
	EQUAL? P-DIRECTION,P?NW,P?SE,P?SW \FALSE
?L31:	PRINTI "You try pushing the piano "
	EQUAL? P-DIRECTION,P?EAST \?L32
	PRINTI "east"
	JUMP ?L38
?L32:	EQUAL? P-DIRECTION,P?WEST \?L34
	PRINTI "west"
	JUMP ?L38
?L34:	EQUAL? P-DIRECTION,P?NE \?L35
	PRINTI "northeast"
	JUMP ?L38
?L35:	EQUAL? P-DIRECTION,P?NW \?L36
	PRINTI "northwest"
	JUMP ?L38
?L36:	EQUAL? P-DIRECTION,P?SE \?L37
	PRINTI "southeast"
	JUMP ?L38
?L37:	EQUAL? P-DIRECTION,P?SW \?L38
	PRINTI "southwest"
?L38:	PRINTI " but the casters it rides on are old and worn. They're stuck, so"
	CALL TPRINT,PIANO
	PRINTR " will only move north and south."
?L3:	PRINTR "Now that the room is tipped, the piano is too heavy to move."
?L1:	EQUAL? PRSA,V?MOVE,V?PUSH \?L42
	PRINTR "Did you have a direction in mind?"
?L42:	EQUAL? PRSA,V?RAISE \?L43
	CALL PERFORM,V?OPEN,PIANO
	RTRUE
?L43:	EQUAL? PRSA,V?LOWER \?L44
	CALL PERFORM,V?CLOSE,PIANO
	RTRUE
?L44:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "It's the baby grand that Aunt Hildegarde bought for you and Herman. Though neither of you practiced as you should, you've managed to maintain a shaky repertoire of standards. The casters on the piano's legs have seen better days. The piano lid is "
	FSET? PIANO,OPENBIT \?L46
	PRINTI "open"
	JUMP ?L48
?L46:	PRINTI "closed"
?L48:	PRINTR "."

	.FUNCT CASTERS-PSEUDO
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "The casters look old and worn, as if they have seen better days."

	.FUNCT NICHE-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	PRINTI "You see"
	FIRST? PRSO >STACK /?L6
	PRINTI " nothing"
	JUMP ?L5
?L6:	CALL APRINT,STACK
?L5:	PRINTI " in"
	CALL TRPRINT,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \?L7
	EQUAL? PRSI,SOUTH-NICHE,NORTH-NICHE \?L7
	EQUAL? PRSO,SQUARE-POST,ROUND-POST /?L7
	CALL WASTE-OF-TIME >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT I-NOISE
	FSET? HERE,CAVEBIT \?L1
	CALL QUEUE,I-NOISE,5
	RFALSE
?L1:	CRLF
	FSET? HERE,OUTDOORSBIT \?L4
	CALL PICK-ONE,OUTDOOR-NOISE >STACK
	PRINT STACK
	JUMP ?L6
?L4:	CALL PICK-ONE,INDOOR-NOISE >STACK
	PRINT STACK
?L6:	CRLF
	RANDOM 20 >STACK
	ADD 30,STACK >STACK
	CALL QUEUE,I-NOISE,STACK
	RFALSE

	.FUNCT OUT-OF-P-DEBUG
	FSET FLASHLIGHT,ONBIT
	MOVE GREEN-MATCH,PLAYER
	MOVE FLASHLIGHT,PLAYER
	PRINTI "Your flashlight comes on and a green match appears in your hand as you exit the work room."
	CRLF
	CRLF
	EQUAL? P-WALK-DIR,P?NORTH \?L1
	RETURN CELLAR
?L1:	EQUAL? P-WALK-DIR,P?SW \?L3
	RETURN ATTIC
?L3:	EQUAL? P-WALK-DIR,P?WEST \?L4
	RETURN BOAT-DOCK
?L4:	EQUAL? P-WALK-DIR,P?EAST \?L5
	RETURN HEART-OF-MAZE
?L5:	EQUAL? P-WALK-DIR,P?SOUTH \?L6
	RETURN UPSTAIRS-HALL-MIDDLE
?L6:	EQUAL? P-WALK-DIR,P?SE \?L7
	RETURN BOMB-SHELTER
?L7:	EQUAL? P-WALK-DIR,P?NE \?L8
	RETURN CRAWL-SPACE-NORTH
?L8:	EQUAL? P-WALK-DIR,P?NW \FALSE
	RETURN CANNON-EMPLACEMENT

	.FUNCT LETTER-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	FSET? LETTER,WETBIT \?L3
	CALL WET-PAPER
	RTRUE
?L3:	PRINTR "The letter looks exactly like the letter in your exquisitely designed game package."

	.FUNCT PHOTO-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	FSET? PHOTO,WETBIT \?L3
	CALL WET-PAPER
	RTRUE
?L3:	FSET? PHOTO,READBIT /?L6
	FSET PHOTO,READBIT
?L6:	PRINTR "The photo looks exactly like the one that came in your game package."

	.FUNCT BUCK-F,OARG=0
	ZERO? OARG /?L1
	EQUAL? OARG,M-OBJDESC? /TRUE
	ZERO? BUCK-TURNED? \?L6
	EQUAL? SOUTH-JUNCTION-VISITS,2 \?L6
	SET 'BUCK-DIR,P?SOUTH
?L6:	CRLF
	PRINTI "A life-size statue of Buck Palace, one of the stars of Uncle Buddy's talent stables, stands here. He's holding a bazooka pointing "
	CALL SAY-BUCK-DIR
	PRINTI "."
	ZERO? BUCK-TURNED? \TRUE
	EQUAL? SOUTH-JUNCTION-VISITS,2 \TRUE
	PRINTI " Hmmm. It looks as if"
	CALL TPRINT,BUCK
	PRINTI ", has changed position."
	RTRUE
?L1:	EQUAL? PRSA,V?TURN \?L12
	ZERO? PRSI \?L13
	PRINTR "Next time, say which direction to turn it."
?L13:	EQUAL? PRSI,INTDIR \FALSE
	EQUAL? P-DIRECTION,BUCK-DIR \?L16
	CALL ITS-ALREADY,STR?107 >STACK
	RSTACK
?L16:	SET 'BUCK-DIR,P-DIRECTION
	SET 'BUCK-TURNED?,1
	ZERO? STEPS-THROUGH-BUCK \?L18
	EQUAL? P-DIRECTION,P?WEST \?L18
	SET 'STEPS-THROUGH-BUCK,1
	JUMP ?L22
?L18:	EQUAL? STEPS-THROUGH-BUCK,1 \?L20
	EQUAL? P-DIRECTION,P?EAST \?L20
	SET 'STEPS-THROUGH-BUCK,2
	JUMP ?L22
?L20:	EQUAL? STEPS-THROUGH-BUCK,2 \?L21
	EQUAL? P-DIRECTION,P?NORTH \?L21
	SET 'STEPS-THROUGH-BUCK,3
	JUMP ?L22
?L21:	SET 'STEPS-THROUGH-BUCK,0
?L22:	PRINTI "You turn"
	CALL TPRINT,BUCK
	PRINTI ", to the "
	CALL SAY-BUCK-DIR
	EQUAL? STEPS-THROUGH-BUCK,3 \?L23
	PRINTI ", and hear a click from off to the north"
	FCLEAR OAK-DOOR,LOCKEDBIT
?L23:	PRINTR "."
?L12:	EQUAL? PRSA,V?EXAMINE \?L26
	PRINTI "It's pretty much what you would expect of a sculpture of Buck Palace. One hand is holding a pair of Uzi machine guns and his other hand is gripping a bazooka on his shoulder which he is pointing "
	CALL SAY-BUCK-DIR
	PRINTR ". Several belts of ammunition crisscross his half-naked chest. He's wearing a double belt of grenades around his waist, and has a high-powered rifle stuck in one of his combat boots and a bayonet between his teeth. Of course Buck Palace, the fighting letter carrier, would not be complete without his government-issue mailbag over his shoulder. The statue is on a round, rotating pedestal, encircled by a compass rose."
?L26:	EQUAL? PRSA,V?MOVE,V?PUSH \FALSE
	PRINTI "The "
	CALL DPRINT,BUCK
	PRINTI " turns slightly, then twists back with the bazooka pointing "
	CALL SAY-BUCK-DIR
	PRINTR "."

	.FUNCT SAY-BUCK-DIR
	EQUAL? BUCK-DIR,P?NORTH,0 \?L1
	SET 'BUCK-DIR,P?NORTH
	PRINTI "north"
	RTRUE
?L1:	EQUAL? BUCK-DIR,P?EAST \?L3
	PRINTI "east"
	RTRUE
?L3:	EQUAL? BUCK-DIR,P?SOUTH \?L4
	PRINTI "south"
	RTRUE
?L4:	EQUAL? BUCK-DIR,P?WEST \?L5
	PRINTI "west"
	RTRUE
?L5:	EQUAL? BUCK-DIR,P?NE \?L6
	PRINTI "northeast"
	RTRUE
?L6:	EQUAL? BUCK-DIR,P?NW \?L7
	PRINTI "northwest"
	RTRUE
?L7:	EQUAL? BUCK-DIR,P?SE \?L8
	PRINTI "southeast"
	RTRUE
?L8:	EQUAL? BUCK-DIR,P?SW \FALSE
	PRINTI "southwest"
	RTRUE

	.FUNCT FLASHLIGHT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? FLASHLIGHT,WETBIT \?L3
	PRINTR "The soggy flashlight is switched on, but isn't working."
?L3:	PRINTI "The rugged-looking "
	CALL DPRINT,FLASHLIGHT
	PRINTI " is turned "
	FSET? FLASHLIGHT,ONBIT \?L6
	PRINTI "on"
	JUMP ?L8
?L6:	PRINTI "off"
?L8:	PRINTR "."
?L1:	EQUAL? PRSA,V?LAMP-ON \?L9
	FSET? FLASHLIGHT,WETBIT \FALSE
	PRINTR "You turn it on, but nothing happens!"
?L9:	EQUAL? PRSA,V?OPEN \FALSE
	PRINTR "I'll bet you were the kind of kid who always took their toys apart."

	.FUNCT STAIRS-F
	EQUAL? PRSA,V?PUSH-DOWN \?L1
	CALL MOVE-OBJ-DOWN >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?SKI \?L3
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?CLIMB-UP \?L4
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?CLIMB-DOWN \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT FOYER-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the elegant foyer, covered in rich mahogany paneling. Your footsteps echo sharply in this large, hollow space. A broad, graceful staircase sweeps upstairs. Pillared archways beckon you east, west and north. The front door to the south is "
	FSET? OAK-DOOR,OPENBIT \?L3
	PRINTI "open"
	JUMP ?L5
?L3:	PRINTI "closed"
?L5:	PRINTI ". There is a coat closet by the front door. The door to the closet is "
	FSET? FOYER-CD,OPENBIT \?L6
	PRINTI "open"
	JUMP ?L8
?L6:	PRINTI "closed"
?L8:	PRINTI "."
	RTRUE

	.FUNCT FOYER-CD-F
	EQUAL? PRSA,V?OPEN \FALSE
	FSET? FOYER-CD,OPENBIT /FALSE
	EQUAL? CLOSET-FLOOR,FOYER /FALSE
	EQUAL? HERE,FOYER \FALSE
	CALL OPEN-DOOR-TO-SHAFT
	FSET FOYER-CD,OPENBIT
	RTRUE

	.FUNCT FOYER-STAIRS-F
	EQUAL? PRSA,V?PUSH-DOWN \?L1
	CALL MOVE-OBJ-DOWN >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "The stairs are made of rich mahogany and lead "
	EQUAL? HERE,FOYER \?L4
	PRINTI "up"
	JUMP ?L6
?L4:	PRINTI "down"
?L6:	PRINTR "."
?L3:	EQUAL? PRSA,V?CLIMB-UP \?L7
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?SKI,V?CLIMB-DOWN \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT TO-UPSTAIRS-HALL-MIDDLE
	FSET? NEWEL,EVERYBIT /?L1
	PRINTI "You start to go up, but suddenly the staircase flattens out. After you awkwardly slide back down, the flattened stairs return to normal."
	CRLF
	RFALSE
?L1:	PRINTI "You climb up the stairs to the..."
	CRLF
	CRLF
	RETURN UPSTAIRS-HALL-MIDDLE

	.FUNCT NEWEL-F
	EQUAL? PRSA,V?TURN \?L1
	FSET? NEWEL,EVERYBIT \?L3
	FCLEAR NEWEL,EVERYBIT
	JUMP ?L5
?L3:	FSET NEWEL,EVERYBIT
?L5:	PRINTI "You turn"
	CALL TPRINT,NEWEL
	PRINTR " and hear a click from the staircase."
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a life-size, wooden replica of the head of one of Uncle Buddy's rivals, Roger Corman."

	.FUNCT FOYER-CLOSET-ENTER-F
	FSET? FOYER-CD,OPENBIT /?L1
	CALL ITS-CLOSED,FOYER-CD
	RFALSE
?L1:	EQUAL? CLOSET-FLOOR,FOYER \?L3
	RETURN CLOSET
?L3:	EQUAL? CLOSET-FLOOR,CELLAR \?L4
	RETURN CLOSET-TOP
?L4:	PRINTI "You enter the shaft and plunge down a floor. A bit shaken, you find yourself at..."
	CRLF
	CRLF
	RETURN SHAFT-BOTTOM

	.FUNCT CELLAR-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in a musty cellar. One of Uncle Buddy's old movie props, a huge, over-teched "
	CALL DPRINT,COMPUTER
	PRINTI " is here. There is a"
	FSET? CELLAR-CD,OPENBIT \?L3
	PRINTI "n open"
	JUMP ?L5
?L3:	PRINTI " closed"
?L5:	PRINTI " closet door to the south. A staircase leads up."
	RTRUE

	.FUNCT CELLAR-PSEUDO
	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT CELLAR-CD-F
	EQUAL? PRSA,V?OPEN \FALSE
	FSET? CELLAR-CD,OPENBIT /FALSE
	EQUAL? CLOSET-FLOOR,CELLAR /FALSE
	EQUAL? HERE,CELLAR \FALSE
	CALL OPEN-DOOR-TO-SHAFT
	FSET CELLAR-CD,OPENBIT
	RTRUE

	.FUNCT CELLAR-CLOSET-ENTER-F
	FSET? CELLAR-CD,OPENBIT /?L1
	CALL ITS-CLOSED,CELLAR-CD
	RFALSE
?L1:	EQUAL? CLOSET-FLOOR,CELLAR \?L3
	RETURN CLOSET
?L3:	PRINTI "You step down a foot into the..."
	CRLF
	CRLF
	RETURN SHAFT-BOTTOM

	.FUNCT DISPLAY-LIGHTS-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	FSET? COMPUTER,ONBIT \?L3
	PRINTI "You study the display of lights and see:"
	CRLF
	CRLF
	CALL FIXED-FONT-ON
	GET DISPLAY-TABLE,0 >STACK
	PRINT STACK
	CRLF
	GET DISPLAY-TABLE,1 >STACK
	PRINT STACK
	CRLF
	GET DISPLAY-TABLE,2 >STACK
	PRINT STACK
	CRLF
	GET DISPLAY-TABLE,3 >STACK
	PRINT STACK
	CRLF
	GET DISPLAY-TABLE,4 >STACK
	PRINT STACK
	CRLF
	GET DISPLAY-TABLE,5 >STACK
	PRINT STACK
	CRLF
	GET DISPLAY-TABLE,6 >STACK
	PRINT STACK
	CRLF
	CALL FIXED-FONT-OFF >STACK
	RSTACK
?L3:	PRINTI "The "
	CALL DPRINT,DISPLAY-LIGHTS
	PRINTR " are off."

	.FUNCT COMPUTER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's the huge, massive, steel contraption of"
	CALL APRINT,COMPUTER
	PRINTI " that saved the earth from the maurading marketeers in ""Plan Nine from Marketing."" The front of"
	CALL TPRINT,COMPUTER
	PRINTI " is covered with rows of lights. Beneath the lights are a slot and a button. There is a hopper on one end of it. The "
	CALL DPRINT,COMPUTER
	PRINTI " is "
	FSET? COMPUTER,ONBIT \?L3
	PRINTI "on"
	JUMP ?L5
?L3:	PRINTI "off"
?L5:	PRINTR "."
?L1:	EQUAL? PRSA,V?PUT \?L6
	EQUAL? PRSI,COMPUTER \?L6
	GETPT PRSO,P?CARD-NUM >STACK
	ZERO? STACK /?L7
	FSET? COMPUTER,ONBIT /?L9
	PRINT NO-DATA
	RTRUE
?L9:	FSET? PRSO,WETBIT \?L11
	MOVE PRSO,HERE
	PRINTI "The "
	CALL DPRINT,COMPUTER
	PRINTR " starts to suck in the wet punch card, then spits it back out at you."
?L11:	PRINTI "The "
	CALL DPRINT,COMPUTER
	PRINTI " sucks in the card, making a slurping noise"
	IN? TOUPEE,RESET-BUTTON \?L13
	PRINTI ", then begins to rumble like something inside is trying to get out"
?L13:	PRINTI ". It pauses as if it were thinking about what to do next, then"
	CALL TPRINT,DISPLAY-LIGHTS
	PRINTI " change."
	CRLF
	GETP PRSO,P?CARD-NUM >STACK
	GET CARD-TABLE,STACK >STACK
	PUT DISPLAY-TABLE,WHERE-TO-PRINT,STACK
	INC 'WHERE-TO-PRINT
	INC 'CARD-COUNT
	MOVE PRSO,COMPUTER
	EQUAL? CARD-COUNT,7 \TRUE
	FSET TOUPEE,EVERYBIT
	RTRUE
?L7:	GETP PRSO,P?SIZE >STACK
	EQUAL? STACK,1 \?L19
	FSET? COMPUTER,ONBIT \?L20
	PRINTI "The "
	CALL DPRINT,COMPUTER
	PRINTI " sucks in"
	CALL TPRINT,PRSO
	PRINTI ", pauses momentarily, then spits out"
	CALL TPRINT,PRSO
	PRINTI " with a whining noise."
	CRLF
	CALL PRINT-ID,STR?108
	MOVE PRSO,HERE
	RTRUE
?L20:	PRINT NO-DATA
	RTRUE
?L19:	PRINTI "How are you going to fit"
	CALL TPRINT,PRSO
	PRINTI " in"
	CALL TPRINT,COMPUTER
	PRINTI "'s card slot?"
	CRLF
	CALL PRINT-ID,STR?109 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?LAMP-ON \?L24
	FSET? COMPUTER,ONBIT \?L25
	CALL ITS-ALREADY,STR?61 >STACK
	RSTACK
?L25:	PRINTI "The "
	CALL DPRINT,COMPUTER
	PRINTI "'s machinery begins to roar as you turn it on. The seven rows of display lights on the front of"
	CALL TPRINT,COMPUTER
	PRINTI " flash on and off in unison several times as it comes to life."
	CRLF
	FSET COMPUTER,ONBIT
	FSET CELLAR,ONBIT
	RTRUE
?L24:	EQUAL? PRSA,V?LAMP-OFF \?L28
	FSET? COMPUTER,ONBIT \?L28
	PRINTI "The "
	CALL DPRINT,COMPUTER
	PRINTI " winds down slowly coming to a stop and the lights of the display dim and go out. "
	CALL RESET-COMPUTER
	FCLEAR CELLAR,ONBIT
	FCLEAR COMPUTER,ONBIT
	RTRUE
?L28:	EQUAL? PRSA,V?RESET \FALSE
	CALL PERFORM,V?PUSH,RESET-BUTTON
	RTRUE

	.FUNCT RESET-COMPUTER
	FIRST? COMPUTER >STACK \?L1
	EQUAL? CARD-COUNT,1 \?L3
	PRINTI "A punch card drops"
	JUMP ?L5
?L3:	LESS? CARD-COUNT,3 \?L6
	PRINTI "A couple of"
	JUMP ?L9
?L6:	LESS? CARD-COUNT,4 \?L8
	PRINTI "A few"
	JUMP ?L9
?L8:	LESS? CARD-COUNT,8 \?L9
	PRINTI "Some"
?L9:	PRINTI " punch cards drop"
?L5:	PRINTI " into"
	CALL TPRINT,HOPPER
	PRINTI "."
	CRLF
	JUMP ?L11
?L1:	CRLF
?L11:	SET 'WHERE-TO-PRINT,0
	CALL ROB,COMPUTER,HOPPER
	SET 'CARD-COUNT,0
	PUT DISPLAY-TABLE,0,COMPUTER-LIGHTS
	PUT DISPLAY-TABLE,1,COMPUTER-LIGHTS
	PUT DISPLAY-TABLE,2,COMPUTER-LIGHTS
	PUT DISPLAY-TABLE,3,COMPUTER-LIGHTS
	PUT DISPLAY-TABLE,4,COMPUTER-LIGHTS
	PUT DISPLAY-TABLE,5,COMPUTER-LIGHTS
	PUT DISPLAY-TABLE,6,COMPUTER-LIGHTS
	RTRUE

	.FUNCT RESET-BUTTON-F
	EQUAL? PRSA,V?PUSH \?L1
	FSET? COMPUTER,ONBIT \?L3
	PRINTI "All"
	CALL TPRINT,DISPLAY-LIGHTS
	PRINTI " flash off and on several times. "
	CALL RESET-COMPUTER >STACK
	RSTACK
?L3:	PRINTR "You hear a click, but that's all."
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a small button labeled ""Reset."""

	.FUNCT TOUPEE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "Ah, ahem, well, it looks like Uncle Buddy's toupee. One of the worst kept secrets in Hollywood."
?L1:	EQUAL? PRSA,V?ROLL-UP \FALSE
	PRINTR "Now come on, it's not that kind of a rug!"

	.FUNCT PUNCH-CARD-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The surface of"
	CALL TPRINT,PRSO
	PRINTI " is covered with holes"
	FSET? PRSO,WETBIT \?L3
	PRINTI " and it's rather soggy"
?L3:	PRINTR "."
?L1:	EQUAL? PRSA,V?READ \FALSE
	PRINTR "Only a computer can read a punch card!"

	.FUNCT PERSIAN-RUG-F
	EQUAL? PRSA,V?TAKE \?L1
	PRINT SPINACH
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?PUT-ON \?L3
	EQUAL? PRSI,PERSIAN-RUG \?L3
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L3:	EQUAL? PRSA,V?LOOK-UNDER,V?MOVE,V?ROLL-UP \FALSE
	PRINTR "You move the rug but don't find any trap door. Amidst your sorrow you return the carpet to its original splendor."

	.FUNCT BLUE-CANDLE-F
	CALL CANDLE-F,BLUE-CANDLE >STACK
	RSTACK

	.FUNCT WHITE-CANDLE-F
	CALL CANDLE-F,WHITE-CANDLE >STACK
	RSTACK

	.FUNCT RED-CANDLE-F
	CALL CANDLE-F,RED-CANDLE >STACK
	RSTACK

	.FUNCT GENERIC-CANDLE-F,NUM,LIT-CANDLE
	EQUAL? PRSA,V?LAMP-OFF \FALSE
	SET 'NUM,0
	FSET? RED-CANDLE,FLAMEBIT \?L3
	CALL VISIBLE?,RED-CANDLE >STACK
	ZERO? STACK /?L3
	INC 'NUM
	SET 'LIT-CANDLE,RED-CANDLE
	JUMP ?L6
?L3:	FSET? WHITE-CANDLE,FLAMEBIT \?L5
	CALL VISIBLE?,WHITE-CANDLE >STACK
	ZERO? STACK /?L5
	INC 'NUM
	SET 'LIT-CANDLE,WHITE-CANDLE
	JUMP ?L6
?L5:	FSET? BLUE-CANDLE,FLAMEBIT \?L6
	CALL VISIBLE?,BLUE-CANDLE >STACK
	ZERO? STACK /?L6
	INC 'NUM
	SET 'LIT-CANDLE,BLUE-CANDLE
?L6:	EQUAL? NUM,1 \FALSE
	RETURN LIT-CANDLE

	.FUNCT CANDLE-F,CANDLE,SIZE,FEET,I-CANDLE,CANDLE-WAX
	GETP PRSO,P?SIZE >SIZE
	EQUAL? CANDLE,RED-CANDLE \?L1
	SET 'FEET,RED-FEET
	SET 'I-CANDLE,I-RED-CANDLE-BURN
	SET 'CANDLE-WAX,RED-WAX
	JUMP ?L4
?L1:	EQUAL? CANDLE,WHITE-CANDLE \?L3
	SET 'FEET,WHITE-FEET
	SET 'I-CANDLE,I-WHITE-CANDLE-BURN
	SET 'CANDLE-WAX,WHITE-WAX
	JUMP ?L4
?L3:	EQUAL? CANDLE,BLUE-CANDLE \?L4
	SET 'FEET,BLUE-FEET
	SET 'I-CANDLE,I-BLUE-CANDLE-BURN
	SET 'CANDLE-WAX,BLUE-WAX
?L4:	EQUAL? PRSA,V?EXAMINE \?L6
	EQUAL? SIZE,1 \?L8
	CALL WAX-FEET,FEET
	RTRUE
?L8:	PRINTI "It's "
	LESS? SIZE,10 \?L11
	PRINTI "what's left of "
?L11:	PRINTI "a thin, wax statuette of a Hindu god, dressed in a long gown. "
	GRTR? SIZE,7 \?L14
	PRINTI "The foot-high god is holding up its "
	EQUAL? PRSO,WHITE-CANDLE \?L16
	PRINTI "lef"
	JUMP ?L18
?L16:	PRINTI "righ"
?L18:	PRINTI "t hand, showing "
	EQUAL? PRSO,RED-CANDLE \?L19
	PRINTI "three"
	JUMP ?L22
?L19:	EQUAL? PRSO,WHITE-CANDLE \?L21
	PRINTI "seven"
	JUMP ?L22
?L21:	PRINTI "five"
?L22:	PRINTI " fingers. "
?L14:	FSET? PRSO,ONBIT \?L24
	PRINTI "The wax statuette is lit, and a bit of wax is dripping down it"
	JUMP ?L31
?L24:	GRTR? SIZE,1 \?L31
	PRINTI "A wick is sticking up from "
	GRTR? SIZE,4 \?L29
	PRINTI "the top of the statuette"
	JUMP ?L31
?L29:	PRINTI "the little that remains of the statuette"
?L31:	LESS? SIZE,10 \?L33
	GRTR? SIZE,1 \?L33
	PRINTI ". The wax statuette has burned down to the god's "
	GET CANDLE-DESC,SIZE >STACK
	PRINT STACK
?L33:	PRINTR "."
?L6:	EQUAL? PRSA,V?PUT \?L36
	EQUAL? PRSI,CANDLE \?L36
	PRINTR "You can't possibly do that."
?L36:	EQUAL? PRSA,V?BURN,V?LAMP-ON \?L37
	EQUAL? PRSO,BLUE-CANDLE,WHITE-CANDLE,RED-CANDLE \?L37
	CALL SET-FLAME-SOURCE >STACK
	ZERO? STACK \TRUE
	FSET? PRSI,FLAMEBIT \?L41
	FSET? PRSO,FLAMEBIT \?L43
	PRINTR "It's already lit."
?L43:	EQUAL? SIZE,1 \?L45
	PRINTI "It's all used up. "
	CALL WAX-FEET,FEET >STACK
	RSTACK
?L45:	FSET PRSO,ONBIT
	FSET PRSO,FLAMEBIT
	FCLEAR PRSO,NDESCBIT
	CALL QUEUE,I-CANDLE,-1
	MOVE CANDLE-WAX,CANDLE
	PRINTI "You light"
	CALL TPRINT,PRSO
	PRINTR " and a bit of wax begins to dribble down the god."
?L41:	EQUAL? PRSI,RED-CANDLE,GREEN-MATCH,RED-MATCH /?L48
	EQUAL? PRSI,WHITE-CANDLE,BLUE-CANDLE \FALSE
?L48:	PRINTI "But"
	CALL TPRINT,PRSI
	PRINTR "'s not lit!"
?L37:	EQUAL? PRSA,V?LAMP-OFF \?L50
	FSET? PRSO,ONBIT \?L51
	CALL BLOW-OUT-CANDLE,CANDLE >STACK
	RSTACK
?L51:	PRINTR "The wax god isn't lit."
?L50:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L54
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK
?L54:	EQUAL? PRSA,V?TAKE \FALSE
	FCLEAR PRSO,NDESCBIT
	RFALSE

	.FUNCT CANDLE-BURN,CANDLE,FEET,I-CANDLE,SIZE
	GETP CANDLE,P?SIZE >STACK
	DEC 'STACK
	PUTP CANDLE,P?SIZE,STACK
	GETP CANDLE,P?SIZE >SIZE
	EQUAL? SIZE,1 \?L1
	CALL VISIBLE?,CANDLE >STACK
	ZERO? STACK /?L3
	CRLF
?L3:	LOC CANDLE >STACK
	MOVE FEET,STACK
	CALL BLOW-OUT-CANDLE,CANDLE
	REMOVE CANDLE
	CALL DEQUEUE,I-CANDLE
?L1:	EQUAL? SIZE,2 \?L12
	EQUAL? CANDLE,RED-CANDLE \?L9
	CALL QUEUE,I-RED-ALMOST-OUT,5
	JUMP ?L12
?L9:	EQUAL? CANDLE,WHITE-CANDLE \?L11
	CALL QUEUE,I-WHITE-ALMOST-OUT,5
	JUMP ?L12
?L11:	EQUAL? CANDLE,BLUE-CANDLE \?L12
	CALL QUEUE,I-BLUE-ALMOST-OUT,5
?L12:	CALL ACCESSIBLE?,CANDLE >STACK
	ZERO? STACK /FALSE
	EQUAL? SIZE,8,6,4 /?L18
	EQUAL? SIZE,2 \FALSE
?L18:	CRLF
	PRINTI "The "
	CALL DPRINT,CANDLE
	PRINTI " has burned down to the god's "
	GET CANDLE-DESC,SIZE >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT I-RED-ALMOST-OUT
	CALL QUEUE,I-RED-NEARLY-OUT,2
	CALL ACCESSIBLE?,RED-CANDLE >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "The "
	CALL DPRINT,RED-CANDLE
	PRINTR " is almost out!"

	.FUNCT I-WHITE-ALMOST-OUT
	CALL QUEUE,I-WHITE-NEARLY-OUT,2
	CALL ACCESSIBLE?,WHITE-CANDLE >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "The "
	CALL DPRINT,WHITE-CANDLE
	PRINTR " is almost out!"

	.FUNCT I-BLUE-ALMOST-OUT
	CALL QUEUE,I-BLUE-NEARLY-OUT,2
	CALL ACCESSIBLE?,BLUE-CANDLE >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "The "
	CALL DPRINT,BLUE-CANDLE
	PRINTR " is almost out!"

	.FUNCT I-RED-NEARLY-OUT
	CALL ACCESSIBLE?,RED-CANDLE >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "The "
	CALL DPRINT,RED-CANDLE
	PRINTR " is nearly out!"

	.FUNCT I-WHITE-NEARLY-OUT
	CALL ACCESSIBLE?,WHITE-CANDLE >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "The "
	CALL DPRINT,WHITE-CANDLE
	PRINTR " is nearly out!"

	.FUNCT I-BLUE-NEARLY-OUT
	CALL ACCESSIBLE?,BLUE-CANDLE >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "The "
	CALL DPRINT,BLUE-CANDLE
	PRINTR " is nearly out!"

	.FUNCT I-RED-CANDLE-BURN
	ZERO? RED-MID-BURN /?L1
	PUSH RED-MID-BURN
	JUMP ?L3
?L1:	PUSH 10
?L3:	CALL QUEUE,I-RED-CANDLE-BURN,STACK
	SET 'RED-MID-BURN,0
	CALL CANDLE-BURN,RED-CANDLE,RED-FEET,I-RED-CANDLE-BURN >STACK
	RSTACK

	.FUNCT I-WHITE-CANDLE-BURN
	ZERO? WHITE-MID-BURN /?L1
	PUSH WHITE-MID-BURN
	JUMP ?L3
?L1:	PUSH 10
?L3:	CALL QUEUE,I-WHITE-CANDLE-BURN,STACK
	SET 'WHITE-MID-BURN,0
	CALL CANDLE-BURN,WHITE-CANDLE,WHITE-FEET,I-WHITE-CANDLE-BURN >STACK
	RSTACK

	.FUNCT I-BLUE-CANDLE-BURN
	ZERO? BLUE-MID-BURN /?L1
	PUSH BLUE-MID-BURN
	JUMP ?L3
?L1:	PUSH 10
?L3:	CALL QUEUE,I-BLUE-CANDLE-BURN,STACK
	SET 'BLUE-MID-BURN,0
	CALL CANDLE-BURN,BLUE-CANDLE,BLUE-FEET,I-BLUE-CANDLE-BURN >STACK
	RSTACK

	.FUNCT FEET-F
	EQUAL? PRSA,V?BURN,V?LAMP-ON \FALSE
	PRINTR "They're just wax. You can't light them."

	.FUNCT BLOW-OUT-CANDLE,CANDLE,DONT-TELL=0,C,FEET
	FCLEAR CANDLE,ONBIT
	FCLEAR CANDLE,FLAMEBIT
	EQUAL? CANDLE,RED-CANDLE \?L1
	SET 'FEET,RED-FEET
	CALL QUEUED?,I-RED-CANDLE-BURN >C
	ZERO? C /?L3
	GET C,C-TICK >RED-MID-BURN
	JUMP ?L5
?L3:	SET 'RED-MID-BURN,0
?L5:	CALL STOP-RED-BURNING
	JUMP ?L10
?L1:	EQUAL? CANDLE,WHITE-CANDLE \?L6
	SET 'FEET,WHITE-FEET
	CALL QUEUED?,I-WHITE-CANDLE-BURN >C
	ZERO? C /?L7
	GET C,C-TICK >WHITE-MID-BURN
	JUMP ?L9
?L7:	SET 'WHITE-MID-BURN,0
?L9:	CALL STOP-WHITE-BURNING
	JUMP ?L10
?L6:	EQUAL? CANDLE,BLUE-CANDLE \?L10
	SET 'FEET,BLUE-FEET
	CALL QUEUED?,I-BLUE-CANDLE-BURN >C
	ZERO? C /?L11
	GET C,C-TICK >BLUE-MID-BURN
	JUMP ?L13
?L11:	SET 'BLUE-MID-BURN,0
?L13:	CALL STOP-BLUE-BURNING
?L10:	ZERO? DONT-TELL \?L20
	CALL ACCESSIBLE?,CANDLE >STACK
	ZERO? STACK /?L20
	PRINTI "The "
	CALL DPRINT,CANDLE
	PRINTI " goes out."
	GETP CANDLE,P?SIZE >STACK
	EQUAL? STACK,1 \?L17
	PRINTI " "
	CALL WAX-FEET,FEET
	JUMP ?L20
?L17:	EQUAL? PRSI,POND /TRUE
	CRLF
?L20:	CALL SAY-IF-NOT-LIT
	RTRUE

	.FUNCT WAX-FEET,FEET
	CALL ACCESSIBLE?,FEET >STACK
	ZERO? STACK /FALSE
	PRINTI "There's nothing left but"
	CALL APRINT,FEET
	PRINTR "."

	.FUNCT STOP-RED-BURNING
	CALL DEQUEUE,I-RED-CANDLE-BURN
	CALL DEQUEUE,I-RED-ALMOST-OUT
	CALL DEQUEUE,I-RED-NEARLY-OUT >STACK
	RSTACK

	.FUNCT STOP-WHITE-BURNING
	CALL DEQUEUE,I-WHITE-CANDLE-BURN
	CALL DEQUEUE,I-WHITE-ALMOST-OUT
	CALL DEQUEUE,I-WHITE-NEARLY-OUT >STACK
	RSTACK

	.FUNCT STOP-BLUE-BURNING
	CALL DEQUEUE,I-BLUE-CANDLE-BURN
	CALL DEQUEUE,I-BLUE-ALMOST-OUT
	CALL DEQUEUE,I-BLUE-NEARLY-OUT >STACK
	RSTACK

	.FUNCT GENERIC-WAX-F,RED-HERE=0,BLUE-HERE=0,WHITE-HERE=0
	EQUAL? PRSA,V?SCRAPE-OFF \?L6
	CALL VISIBLE?,WAX-COAT-1 >STACK
	ZERO? STACK /?L3
	RETURN WAX-COAT-1
?L3:	CALL VISIBLE?,WAX-COAT-2 >STACK
	ZERO? STACK /FALSE
	RETURN WAX-COAT-2
?L6:	FSET? RED-CANDLE,ONBIT \?L8
	CALL VISIBLE?,RED-CANDLE >STACK
	ZERO? STACK /?L8
	SET 'RED-HERE,1
	JUMP ?L11
?L8:	FSET? WHITE-CANDLE,ONBIT \?L10
	CALL VISIBLE?,WHITE-CANDLE >STACK
	ZERO? STACK /?L10
	SET 'WHITE-HERE,1
	JUMP ?L11
?L10:	FSET? BLUE-CANDLE,ONBIT \?L11
	CALL VISIBLE?,BLUE-CANDLE >STACK
	ZERO? STACK /?L11
	SET 'BLUE-HERE,1
?L11:	ZERO? BLUE-HERE /?L13
	ZERO? RED-HERE \?L18
	ZERO? WHITE-HERE \?L13
	RETURN BLUE-WAX
?L13:	ZERO? RED-HERE /?L15
?L18:	ZERO? BLUE-HERE \?L15
	ZERO? WHITE-HERE \?L19
	RETURN RED-WAX
?L15:	ZERO? WHITE-HERE /FALSE
?L19:	ZERO? BLUE-HERE \FALSE
	ZERO? RED-HERE \FALSE
	RETURN WHITE-WAX

	.FUNCT WAX-F
	EQUAL? PRSO,RED-WAX \?L1
	FSET? RED-CANDLE,FLAMEBIT /?L1
	EQUAL? PRSA,V?PUT-ON,V?POUR \?L3
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " is not lit."
?L3:	CALL PERFORM,PRSA,RED-CANDLE,PRSI
	RTRUE
?L1:	EQUAL? PRSI,RED-WAX \?L6
	FSET? RED-CANDLE,FLAMEBIT /?L6
	CALL PERFORM,PRSA,PRSO,RED-CANDLE
	RTRUE
?L6:	EQUAL? PRSO,WHITE-WAX \?L7
	FSET? WHITE-CANDLE,FLAMEBIT /?L7
	EQUAL? PRSA,V?PUT-ON,V?POUR \?L8
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " is not lit."
?L8:	CALL PERFORM,PRSA,WHITE-CANDLE,PRSI
	RTRUE
?L7:	EQUAL? PRSI,WHITE-WAX \?L11
	FSET? WHITE-CANDLE,FLAMEBIT /?L11
	CALL PERFORM,PRSA,PRSO,WHITE-CANDLE
	RTRUE
?L11:	EQUAL? PRSO,BLUE-WAX \?L12
	FSET? BLUE-CANDLE,FLAMEBIT /?L12
	EQUAL? PRSA,V?PUT-ON,V?POUR \?L13
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " is not lit."
?L13:	CALL PERFORM,PRSA,BLUE-CANDLE,PRSI
	RTRUE
?L12:	EQUAL? PRSI,BLUE-WAX \?L16
	FSET? BLUE-CANDLE,FLAMEBIT /?L16
	CALL PERFORM,PRSA,PRSO,BLUE-CANDLE
	RTRUE
?L16:	EQUAL? PRSA,V?RUB,V?TAKE \?L17
	PRINTR "You'd burn your fingers."
?L17:	EQUAL? PRSA,V?PUT \?L18
	EQUAL? PRSI,BLUE-WAX,WHITE-WAX,RED-WAX \?L18
	CALL PERFORM,V?PUT-ON,PRSI,PRSO
	RTRUE
?L18:	EQUAL? PRSA,V?POUR \?L19
	EQUAL? PRSO,BLUE-WAX,WHITE-WAX,RED-WAX \?L19
	CALL PERFORM,V?PUT-ON,PRSO,PRSI
	RTRUE
?L19:	EQUAL? PRSA,V?DROP \?L20
	PRINTR "Huh?"
?L20:	EQUAL? PRSA,V?PUT-ON \FALSE
	EQUAL? PRSO,BLUE-WAX,RED-WAX,WHITE-WAX \FALSE
	FSET? PRSI,EVERYBIT \?L22
	CALL YOU-ALREADY >STACK
	RSTACK
?L22:	FSET? PRSI,FLAMEBIT \?L24
	PRINT YOU-CANT
	PRINTR "put wax on it while it's burning."
?L24:	EQUAL? PRSI,GREEN-MATCH,RED-MATCH \?L25
	FSET PRSI,EVERYBIT
	LOC WAX-COAT-1 >STACK
	ZERO? STACK /?L26
	MOVE WAX-COAT-2,PRSI
	JUMP ?L28
?L26:	MOVE WAX-COAT-1,PRSI
?L28:	PRINTR "The match head is now covered with a thin coating of candle wax."
?L25:	PRINTI "You drip a bit of wax onto"
	CALL TPRINT,PRSI
	PRINTR ". Rather pointless, really."

	.FUNCT PORTRAIT-F
	EQUAL? PRSA,V?PULL,V?LOOK-BEHIND,V?MOVE /?L3
	EQUAL? PRSA,V?SWING,V?RAISE \?L1
?L3:	FSET? WALL-SAFE,INVISIBLE /?L4
	CALL YOU-ALREADY >STACK
	RSTACK
?L4:	FCLEAR WALL-SAFE,INVISIBLE
	PRINTI "You swing"
	CALL TPRINT,PORTRAIT
	PRINTI " away from the wall and find"
	CALL APRINT,WALL-SAFE
	PRINTI "."
	FSET? GREEN-CARD,INVISIBLE \?L7
	FCLEAR GREEN-CARD,INVISIBLE
	PRINTI " A "
	CALL DPRINT,GREEN-CARD
	PRINTR " flutters to the floor."
?L7:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L10
	PRINTI "It seems to be attached to the wall on one side."
	CRLF
	CALL PRINT-ID,STR?110 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?COVER \?L11
	EQUAL? PRSO,WALL-SAFE \?L11
	FSET WALL-SAFE,INVISIBLE
	PRINTI "You cover"
	CALL TPRINT,WALL-SAFE
	PRINTI " with"
	CALL TRPRINT,PORTRAIT
	RTRUE
?L11:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a very conservative portrait of Aunt Hildegarde sitting in a Victorian-style chair with Uncle Buddy standing behind her, wearing a black-and-white checkered polyester leisure suit."

	.FUNCT WALL-SAFE-F
	EQUAL? PRSA,V?TURN-RIGHT,V?TURN-LEFT \?L1
	EQUAL? PRSI,INTNUM \?L1
	GRTR? P-NUMBER,10 \?L3
	PRINTR "The dial only goes to 10."
?L3:	SET 'DIAL-NUMBER,P-NUMBER
	PRINTI "You turn the dial to "
	PRINTN DIAL-NUMBER
	PRINTI "."
	FSET? WALL-SAFE,OPENBIT /?L9
	ZERO? STEPS-THROUGH-WALL-SAFE \?L6
	EQUAL? PRSA,V?TURN-RIGHT \?L6
	EQUAL? DIAL-NUMBER,3 \?L6
	SET 'STEPS-THROUGH-WALL-SAFE,1
	CRLF
	RTRUE
?L6:	FSET? WALL-SAFE,OPENBIT /?L9
	EQUAL? STEPS-THROUGH-WALL-SAFE,1 \?L8
	EQUAL? PRSA,V?TURN-LEFT \?L8
	EQUAL? DIAL-NUMBER,7 \?L8
	SET 'STEPS-THROUGH-WALL-SAFE,2
	CRLF
	RTRUE
?L8:	FSET? WALL-SAFE,OPENBIT /?L9
	EQUAL? STEPS-THROUGH-WALL-SAFE,2 \?L9
	EQUAL? PRSA,V?TURN-RIGHT \?L9
	EQUAL? DIAL-NUMBER,5 \?L9
	SET 'STEPS-THROUGH-WALL-SAFE,3
	FCLEAR WALL-SAFE,LOCKEDBIT
	PRINTR " You hear a faint click."
?L9:	SET 'STEPS-THROUGH-WALL-SAFE,0
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TURN-RIGHT,V?TURN-LEFT,V?TURN \?L11
	EQUAL? PRSI,0,ROOMS \?L12
	PRINTR "You didn't say what number you wanted to turn the dial to, or the direction."
?L12:	EQUAL? PRSI,INTNUM \?L14
	PRINTI "You didn't say whether you wanted to turn the dial RIGHT to "
	PRINTN P-NUMBER
	PRINTI " or LEFT to "
	PRINTN P-NUMBER
	PRINTR "."
?L14:	PRINTR "Huh?"
?L11:	EQUAL? PRSA,V?EXAMINE \?L16
	PRINTI "It's a rather large safe with a dial which can be set to any number between 0 and 10. The dial is set to "
	PRINTN DIAL-NUMBER
	PRINTI ". "
	RFALSE
?L16:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? WALL-SAFE,OPENBIT \FALSE
	FSET WALL-SAFE,LOCKEDBIT
	SET 'STEPS-THROUGH-WALL-SAFE,0
	RFALSE

	.FUNCT GRATER-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's the cheese grater Mama Maggio used to paddle her nine sons and seven daughters with in the ""Maggio Boys and Girls"" serial. Uncle Buddy wrote the scripts for these mystery yarns about 16 teenage brothers and sisters who were junior detectives."

	.FUNCT FIREPLACE-GLOBAL-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,FIREPLACE \?L3
	CALL V-LOOK >STACK
	RSTACK
?L3:	PRINTR "You see a large, finely crafted brick fireplace."
?L1:	EQUAL? PRSA,V?SEARCH,V?LOOK-INSIDE \?L6
	EQUAL? HERE,LIVING-ROOM \?L7
	PRINTR "You can't quite make out the inside of the fireplace from here."
?L7:	PRINTR "Look around you!"
?L6:	EQUAL? PRSA,V?BOARD,V?ENTER \?L10
	EQUAL? HERE,LIVING-ROOM \?L10
	CALL GOTO,FIREPLACE >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?REACH-IN \?L11
	EQUAL? HERE,LIVING-ROOM \FALSE
	PRINTR "You reach in the fireplace and imagine a warm glow."
?L11:	EQUAL? PRSA,V?CLIMB-UP \?L15
	EQUAL? PRSI,FIREPLACE \?L15
	EQUAL? HERE,FIREPLACE \?L15
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L15:	EQUAL? PRSA,V?PUT \FALSE
	MOVE PRSO,FIREPLACE
	PRINTR "Done."

	.FUNCT FIREPLACE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The fireplace is finely crafted masonry, but has long been neglected. The mortar is crumbling in a number of places."
	FSET? BRICK-HOLE,INVISIBLE \?L3
	PRINTI " One brick, about waist high, seems particularly loose."
?L3:	PRINTI " The fireplace opens to the east."
	RTRUE

	.FUNCT BRICK-HOLE-F
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,BRICK-HOLE \?L1
	EQUAL? PRSO,BRICK \?L3
	FCLEAR FIREPLACE,EVERYBIT
	FSET PRSO,NDESCBIT
	FSET BRICK-HOLE,INVISIBLE
	RFALSE
?L3:	GETP PRSO,P?SIZE >STACK
	LESS? STACK,5 \?L5
	FSET? FIREPLACE,EVERYBIT \?L5
	REMOVE PRSO
	PRINTR "You push it into the hole and it falls down into the space beyond the hole."
?L5:	PRINTR "It doesn't fit into the hole."
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT BRICK-HOLE-GLOBAL-F
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,BRICK-HOLE-GLOBAL \?L1
	EQUAL? PRSO,BRICK \?L3
	PRINTR "You wouldn't be able to climb the chimney if you did that."
?L3:	GETP PRSO,P?SIZE >STACK
	LESS? STACK,5 \?L5
	REMOVE PRSO
	PRINTR "It falls down into the space beyond the hole."
?L5:	PRINTR "It doesn't fit into the hole."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L7
	PRINTR "You can't see a thing. It's pitch black."
?L7:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT BRICK-F
	EQUAL? PRSA,V?PULL,V?TAKE \FALSE
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	FSET FIREPLACE,EVERYBIT
	FCLEAR BRICK-HOLE,INVISIBLE
	FSET? INDIGO-CARD,INVISIBLE \FALSE
	FCLEAR INDIGO-CARD,INVISIBLE
	PRINTI "You pull the brick out of the hole, and along with it comes"
	CALL APRINT,INDIGO-CARD
	PRINTR ", which drops in a spiral to the ground."

	.FUNCT UP-CHIMNEY
	FSET? FIREPLACE,EVERYBIT /?L1
	EQUAL? HERE,FIREPLACE \?L1
	PRINTI "You'll have to figure that out for yourself."
	CRLF
	RFALSE
?L1:	CALL WEIGHT,PLAYER >STACK
	GRTR? STACK,38 \?L3
	PRINTI "You're carrying too much to climb up"
	CALL TRPRINT,CHIMNEY
	RFALSE
?L3:	FSET? SKIS,WORNBIT \?L4
	PRINTR "You can't climb up while you're wearing the skis."
?L4:	PRINTI "Using the "
	EQUAL? HERE,FIREPLACE \?L6
	PRINTI "hole where the brick was,"
	JUMP ?L8
?L6:	PRINTI "holes"
?L8:	PRINTI " you climb up the chimney several feet"
	EQUAL? HERE,FIREPLACE \?L9
	PRINTI "."
	CRLF
	CRLF
	RETURN CHIMNEY-1
?L9:	EQUAL? HERE,CHIMNEY-1 \?L11
	PRINTI "."
	CRLF
	CRLF
	RETURN CHIMNEY-2
?L11:	PRINTI " onto the..."
	CRLF
	CRLF
	EQUAL? HERE,CHIMNEY-2 \?L13
	RETURN ROOF-1
?L13:	RETURN ROOF-2

	.FUNCT DOWN-CHIMNEY
	PRINTI "Using the "
	EQUAL? HERE,FIREPLACE \?L1
	PRINTI "hole where the brick was"
	JUMP ?L3
?L1:	PRINTI "holes"
?L3:	PRINTI ", you climb down the chimney several feet"
	EQUAL? HERE,CHIMNEY-1 \?L4
	PRINTI " into the..."
	CRLF
	CRLF
	RETURN FIREPLACE
?L4:	EQUAL? HERE,CHIMNEY-2 \FALSE
	PRINTI "."
	CRLF
	CRLF
	RETURN CHIMNEY-1

	.FUNCT PENGUIN-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a life-size stuffed penguin. It was probably used in the filming of ""Vampire Penguins of the North."""

	.FUNCT MASK-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "It looks like"
	CALL TPRINT,MASK
	PRINTR " from ""Friday the 15th."""

	.FUNCT CHIMNEY-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It is your average chimney, made of bricks."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L3
	EQUAL? HERE,ROOF-1 \?L4
	PRINTI "You see a few holes in the wall of"
	CALL TRPRINT,CHIMNEY
	RTRUE
?L4:	PRINTR "You can't quite make out what's inside from here."
?L3:	EQUAL? PRSA,V?PUT \?L7
	EQUAL? PRSI,CHIMNEY \?L7
	EQUAL? HERE,FIREPLACE \?L8
	PRINTR "You're at the bottom of the chimney!"
?L8:	PRINTI "You drop"
	CALL TPRINT,PRSO
	PRINTI " down the chimney."
	CRLF
	EQUAL? HERE,ROOF-1,CHIMNEY-1,CHIMNEY-2 \?L11
	EQUAL? PRSO,BLUE-CANDLE,WHITE-CANDLE,RED-CANDLE \?L13
	FSET? PRSO,FLAMEBIT \?L13
	CALL BLOW-OUT-CANDLE,PRSO
	JUMP ?L15
?L13:	EQUAL? PRSO,FINCH /?L16
	CALL ULTIMATELY-IN?,FINCH,PRSO >STACK
	ZERO? STACK /?L15
?L16:	CALL BREAK-FINCH,1
?L15:	MOVE PRSO,FIREPLACE
	RTRUE
?L11:	MOVE PRSO,CHIMNEY-3
	RTRUE
?L7:	EQUAL? PRSA,V?ENTER \?L19
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?CLIMB-UP \?L20
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?CLIMB-DOWN \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT ROOF-TO-CHIMNEY
	PRINTI "You climb down into the chimney."
	CRLF
	CRLF
	EQUAL? HERE,ROOF-1 \?L1
	RETURN CHIMNEY-2
?L1:	RETURN CHIMNEY-3

	.FUNCT VERTICAL-MAP-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	FSET? VERTICAL-MAP,WETBIT \?L3
	CALL WET-PAPER >STACK
	RSTACK
?L3:	CALL LOOK-AT-MAP
	PRINTI "
|   | | |     |   |    |   |       |
| |   |       | | |        | |   | |
| |     | | | | | |   | |  | | | | |
|       | | |     | |   |  | | | | |
|         |       | | |    |   | | |
|  | | | | | |      | | |  | | | | |
|    | | | | |  |       |  | | | | |
| |    | | |    | |   | |    | | | |
| | |    |    | | |X| |    |     | |
| | | |     | | | | | |  | |       |
| | | | | | | | |     | |      |   |
|     | | | |     |   | | |    | | |
| |   | | | |   | | | | | | |  | | |
| | | |     | | |     |   | |  | | |
| | |         |           |      | |
| |     |       | | |   | |    |   |
| |   | | |   | | | | | |      | | |
| | | |   | | | | |     | | |  | | |
|   |       |   |         |    |   |
"
	CALL FIXED-FONT-OFF >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUT-ON \FALSE
	EQUAL? PRSO,HORIZONTAL-MAP /?L9
	EQUAL? PRSI,HORIZONTAL-MAP \?L7
?L9:	FSET? VERTICAL-MAP,WETBIT \?L10
	FSET? HORIZONTAL-MAP,WETBIT \?L10
	PRINTR "All you can make out on the soggy pieces of paper are some blurred lines."
?L10:	FSET? PRSO,WETBIT \?L12
	PRINTR "You see blurred vertical lines through the soggy paper."
?L12:	FSET? PRSI,WETBIT \?L13
	CALL PERFORM,V?READ,PRSO
	RTRUE
?L13:	CALL WHOLE-MAP >STACK
	RSTACK
?L7:	FSET? PRSI,SURFACEBIT /FALSE
	PRINTR "That doesn't seem to accomplish much."

	.FUNCT LOOK-AT-MAP
	PRINTI "You see the following:"
	CRLF
	CALL FIXED-FONT-ON >STACK
	RSTACK

	.FUNCT WET-PAPER
	PRINTR "All you see is a piece of wet paper with ink stains on it."

	.FUNCT HORIZONTAL-MAP-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	FSET? HORIZONTAL-MAP,WETBIT \?L3
	CALL WET-PAPER >STACK
	RSTACK
?L3:	CALL LOOK-AT-MAP
	PRINTI "____________________________________
  __     ____       ___ __   _____
    __ __          __ _ ___
    ___             __    _
 ______      _____       _  _
  __   ___ _ ____       __
 __            _____     __
  ___         __  ______  _
    ___     ___          ____
      ___ ___      X   ___   ____
                   _    _   ______
 _             _ _____    ____   __
  ____       ____           __
         _         _          _
       __ __     ____  __    __
     _________ __   ___     ____
   ____   _____            ___   __
                     _      ___
       ___         __ __     _
 ___ _______ ___ ____ ____ ____ ___
"
	CALL FIXED-FONT-OFF >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUT-ON \FALSE
	EQUAL? PRSO,VERTICAL-MAP /?L9
	EQUAL? PRSI,VERTICAL-MAP \?L7
?L9:	FSET? HORIZONTAL-MAP,WETBIT \?L10
	FSET? VERTICAL-MAP,WETBIT \?L10
	PRINTR "You see blurred vertical lines through the soggy paper."
?L10:	FSET? PRSI,WETBIT \?L12
	CALL PERFORM,V?READ,PRSO
	RTRUE
?L12:	CALL WHOLE-MAP >STACK
	RSTACK
?L7:	FSET? PRSI,SURFACEBIT /FALSE
	PRINTR "That doesn't seem to accomplish much."

	.FUNCT WHOLE-MAP
	CALL LOOK-AT-MAP
	PRINTI "____________________________________
| __| | |____ |   | ___|__ | _____ |
| | __|__     | | |__ _ ___| |   | |
| | ___ | | | | | | __| | _| | | | |
|______ | | |_____| |   |_ |_| | | |
| __   ___|_ ____ | | | __ |   | | |
|__| | | | | | _____| | |__| | | | |
| ___| | | | |__| ______| _| | | | |
| | ___| | |___ | |   | |____| | | |
| | | ___|___ | | |X| |___ | ____| |
| | | |     | | | |_| | _| |______ |
|_| | | | | | |_|_____| | ____ | __|
| ____| | | |____ |   | | | __ | | |
| |   | |_| |   | |_| | | | | _| | |
| | | |__ __| | |____ |__ | |__| | |
| | |_________|__   ___   | ____ | |
| |____ | _____ | | |   | |___ | __|
| |   | | |   | | | |_| |   ___| | |
| | | |___| | | | |__ __| | |_ | | |
|___|_______|___|____ ____|____|___|
"
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT TO-CELLAR
	FSET? SKIS,WORNBIT \?L1
	PRINT SNOWPLOW
	CRLF
	CRLF
?L1:	RETURN CELLAR

	.FUNCT UPSTAIRS-HALL-MIDDLE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the middle of the upstairs hall. The hall stretches to the east and the west. To the south there is a"
	FSET? UPSTAIRS-CD,OPENBIT \?L3
	PRINTI "n open"
	JUMP ?L5
?L3:	PRINTI " closed"
?L5:	PRINTI " closet door. "
	FSET? ATTIC-DOOR,OPENBIT \?L6
	PRINTI "There is pull-down ladder extending from the floor into an open panel in the ceiling here."
	JUMP ?L8
?L6:	PRINTI "In the ceiling above you see the outline of a panel."
?L8:	PRINTI " You notice an unusual newel next to the stairs leading down."
	RTRUE

	.FUNCT UPSTAIRS-HALL-EAST-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the eastern end of the upstairs hall, which stretches west. Doorways lead north and south. There is a"
	FSET? SACK-WINDOW,EVERYBIT \?L3
	PRINTI "n open"
	JUMP ?L5
?L3:	PRINTI " closed"
?L5:	PRINTI " window here"
	ZERO? SACK-IN-WINDOW /?L6
	PRINTI ". A blue velvet sack is barely visible, sticking out from beneath the closed window"
?L6:	PRINTI "."
	RTRUE

	.FUNCT UPSTAIRS-HALL-EAST-EXIT-F
	FSET? SACK,EVERYBIT \?L1
	ZERO? SACK-IN-WINDOW /?L1
	PRINTI "You'll have to let go of the sack first."
	CRLF
	RFALSE
?L1:	EQUAL? PRSO,P?NORTH \?L4
	RETURN BEDROOM-2
?L4:	EQUAL? PRSO,P?SOUTH \?L6
	RETURN BEDROOM-3
?L6:	RETURN UPSTAIRS-HALL-MIDDLE

	.FUNCT FINCH-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's the Maltese finch"
	FSET? FINCH,EVERYBIT \?L3
	PRINTI ", well, pieces of the Maltese finch"
?L3:	PRINTR " from Uncle Buddy's knockoff of ""The Maltese Falcon."" In Uncle Buddy's updated version, a Humphrey Bogart look-alike plays the part of a pet shop owner."
?L1:	EQUAL? PRSA,V?MUNG,V?THROW \FALSE
	FSET? FINCH,EVERYBIT /FALSE
	CALL ULTIMATELY-IN?,FINCH >STACK
	ZERO? STACK /FALSE
	EQUAL? PRSO,FINCH \FALSE
	CALL SPECIAL-DROP >STACK
	ZERO? STACK \FALSE
	MOVE FINCH,HERE
	CALL BREAK-FINCH >STACK
	RSTACK

	.FUNCT BREAK-FINCH,DONT-TELL=0
	FSET? FINCH,EVERYBIT /FALSE
	PUTP FINCH,P?VALUE,0
	FSET FINCH,EVERYBIT
	ZERO? DONT-TELL \?L4
	PRINTI "As your hand releases"
	CALL TPRINT,PRSO
	PRINTI ", the sound of it smashing onto"
	CALL TPRINT,GROUND
	PRINTI " is masked only slightly by the almost inaudible sound of someone rolling over in his grave. Uncle Buddy perhaps?"
	CRLF
	CALL PRINT-ID,STR?111
?L4:	FSET FINCH,NARTICLEBIT
	PUTP FINCH,P?SDESC,STR?112
	RTRUE

	.FUNCT SACK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? SACK-WINDOW,EVERYBIT /?L1
	ZERO? SACK-IN-WINDOW /?L1
	PRINTI "The "
	CALL DPRINT,SACK
	PRINTI " is just visible, stuck beneath the closed "
	CALL DPRINT,SACK-WINDOW
	PRINTR "."
?L1:	EQUAL? PRSA,V?TAKE \?L3
	ZERO? SACK-IN-WINDOW /?L3
	FSET? SACK,EVERYBIT /?L4
	FSET SACK,EVERYBIT
	PRINTR "You grab hold of the top of the sack, but the rest of it is still under the closed window."
?L4:	PRINTR "You already have your hand on it."
?L3:	EQUAL? PRSA,V?DROP \?L7
	FSET? SACK,EVERYBIT \?L7
	CALL PERFORM,V?LET-GO,SACK
	RTRUE
?L7:	EQUAL? PRSA,V?LET-GO \?L8
	FSET? SACK,EVERYBIT \?L8
	FCLEAR SACK,EVERYBIT
	PRINTR "You let go of the sack."
?L8:	EQUAL? PRSA,V?OPEN \?L9
	ZERO? SACK-IN-WINDOW /?L10
	PRINTI "You can't open"
	CALL TPRINT,SACK
	PRINTI " when it's stuck in"
	CALL TRPRINT,SACK-WINDOW
	RTRUE
?L10:	GETP FINCH,P?VALUE >STACK
	ZERO? STACK /FALSE
	FSET SACK,OPENBIT
	CALL BOKS-BIG-ONE,FINCH >STACK
	ZERO? STACK /?L13
	EQUAL? TREASURES-FOUND,10 /TRUE
?L13:	PRINTI "Opening the sack reveals"
	CALL APRINT,FINCH
	PRINTR "."
?L9:	EQUAL? PRSA,V?THROW \?L17
	IN? FINCH,SACK \?L17
	FSET? FINCH,EVERYBIT /?L17
	CALL BREAK-FINCH
	EQUAL? HERE,ROOF-1,ROOF-2 \?L18
	MOVE SACK,PATIO
	RTRUE
?L18:	MOVE SACK,HERE
	RTRUE
?L17:	EQUAL? PRSA,V?PULL \?L21
	FSET? SACK-WINDOW,EVERYBIT /?L21
	FSET? SACK,EVERYBIT \?L22
	PRINTR "It's stuck under the window."
?L22:	PRINTI "You pull on"
	CALL TPRINT,SACK
	PRINTR ", but it's stuck under the window sill."
?L21:	EQUAL? PRSA,V?PUT \FALSE
	FSET? PRSO,FLAMEBIT \FALSE
	PRINTI "Shouldn't you put out"
	CALL TPRINT,PRSO
	PRINTR " first?"

	.FUNCT SACK-WINDOW-F
	EQUAL? PRSA,V?EXAMINE \?L1
	ZERO? SACK-IN-WINDOW /?L3
	PRINTR "The window is closed on the top of a cloth sack."
?L3:	PRINTI "The "
	CALL DPRINT,SACK-WINDOW
	PRINTI " is "
	FSET? SACK-WINDOW,EVERYBIT \?L6
	PRINTI "open"
	JUMP ?L8
?L6:	PRINTI "closed"
?L8:	PRINTR "."
?L1:	EQUAL? PRSA,V?OPEN \?L9
	FSET? SACK-WINDOW,EVERYBIT \?L10
	CALL ALREADY-OPEN
	RTRUE
?L10:	ZERO? SACK-IN-WINDOW /?L12
	FSET? SACK,EVERYBIT \?L13
	FCLEAR SACK,EVERYBIT
	MOVE SACK,PLAYER
	SET 'SACK-IN-WINDOW,0
	FSET SACK-WINDOW,EVERYBIT
	PRINTI "With one hand you lift"
	CALL TPRINT,SACK-WINDOW
	PRINTI " and with the other you pull"
	CALL TPRINT,SACK
	PRINTI " inside."
	CRLF
	JUMP ?L15
?L13:	MOVE SACK,SOUTHEAST-JUNCTION
	CALL BREAK-FINCH,1
	PRINTI "As you lift up"
	CALL TPRINT,SACK-WINDOW
	PRINTI ","
	CALL TPRINT,SACK
	PRINTI " slides off"
	CALL TPRINT,SACK-WINDOW
	PRINTI " sill and falls to"
	CALL TPRINT,GROUND
	PRINTI " with a decided thud."
	CRLF
?L15:	FSET SACK-WINDOW,EVERYBIT
	FCLEAR SACK,NDESCBIT
	FCLEAR SACK,TRYTAKEBIT
	SET 'SACK-IN-WINDOW,0
	RTRUE
?L12:	PRINTI "You open"
	CALL TRPRINT,SACK-WINDOW
	FSET SACK-WINDOW,EVERYBIT
	RTRUE
?L9:	EQUAL? PRSA,V?CLOSE \?L17
	FSET? SACK-WINDOW,EVERYBIT /?L18
	CALL ALREADY-CLOSED >STACK
	RSTACK
?L18:	PRINTI "You close"
	CALL TRPRINT,SACK-WINDOW
	FCLEAR SACK-WINDOW,EVERYBIT
	RTRUE
?L17:	EQUAL? PRSA,V?PUT \?L21
	EQUAL? PRSI,SACK-WINDOW \?L21
	FSET? SACK-WINDOW,EVERYBIT \?L22
	PRINTI "You toss"
	CALL TPRINT,PRSO
	PRINTI " out"
	CALL TRPRINT,SACK-WINDOW
	EQUAL? PRSO,BLUE-CANDLE,WHITE-CANDLE,RED-CANDLE \?L24
	FSET? PRSO,FLAMEBIT \?L24
	CALL BLOW-OUT-CANDLE,PRSO
?L24:	EQUAL? PRSO,FINCH \?L30
	FSET? FINCH,EVERYBIT \?L29
?L30:	CALL ULTIMATELY-IN?,FINCH,SACK >STACK
	ZERO? STACK /?L27
	FSET? FINCH,EVERYBIT /?L27
?L29:	CALL BREAK-FINCH,1
?L27:	MOVE PRSO,SOUTHEAST-JUNCTION
	RTRUE
?L22:	PRINTR "But it's not open!"
?L21:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL PERFORM,V?LOOK-INSIDE,WINDOW
	RTRUE

	.FUNCT UPSTAIRS-HALL-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the western end of the upstairs hall, which stretches east. There are doorways leading to the north and south."
	FSET? UPSTAIRS-HALL-WEST,EVERYBIT \TRUE
	RANDOM 100 >STACK
	LESS? 50,STACK /TRUE
	FCLEAR UPSTAIRS-HALL-WEST,EVERYBIT
	PRINTI " Hmmm. You have the uneasy feeling that someone is watching you."
	RTRUE

	.FUNCT BEDROOM-2-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This was the guest room you shared with Cousin Herman during your summer visits. A quick glance at the bunk beds and you remember all too well the night in the bottom bunk when Cousin Herman got sick in the top bunk. "
	RANDOM 100 >STACK
	LESS? 50,STACK /?L3
	PRINTI "You got even with him later. While he was asleep you squirted honey up his nose. When he ran and told Aunt Hildegarde what you had done, she didn't believe it was honey and told him he shouldn't be out of bed with such a bad cold. "
?L3:	PRINTI "A doorway leads south."
	RTRUE

	.FUNCT HANDLES-F
	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "You grip the handles firmly and imagine one of Uncle Buddy's guests clutching them in a drunken stupor. After a minute, you begin to feel a bit of nausea and let go of the handles."

	.FUNCT UPSTAIRS-BATHROOM-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "It's a Hollywood bathroom. Everything from the temperature-controlled marble toilet seat to the Oscars for hot and cold water is overdone. The shower has a gold curtain and you can't help but notice the bath mat with Jack Valenti's picture on it"
	FSET? BATH-MAT,TOUCHBIT \?L3
	PRINTI " has been moved"
?L3:	PRINTI "."
	RTRUE

	.FUNCT BATH-PSEUDO
	EQUAL? PRSA,V?WALK,V?LAMP-ON,V?TAKE /?L3
	EQUAL? PRSA,V?USE,V?BOARD,V?ENTER \FALSE
?L3:	PRINTR "Sorry, the water has been turned off."

	.FUNCT BATH-MAT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's a rubber bath mat with a picture of the President of the Academy of Motion Picture Arts and Sciences, Jack Valenti, on it."
?L1:	EQUAL? PRSA,V?PUT-ON \?L3
	EQUAL? PRSI,BATH-MAT \?L3
	PRINTR "Jack wouldn't like that."
?L3:	EQUAL? PRSA,V?RAISE,V?MOVE,V?LOOK-UNDER \?L4
	FSET? RED-CARD,INVISIBLE \?L4
	FCLEAR RED-CARD,INVISIBLE
	PRINTI "You move"
	CALL TPRINT,BATH-MAT
	PRINTI " and see"
	CALL APRINT,RED-CARD
	PRINTR " lying on the floor of the bathroom."
?L4:	EQUAL? PRSA,V?TAKE \FALSE
	FSET? RED-CARD,INVISIBLE \FALSE
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	FCLEAR RED-CARD,INVISIBLE
	PRINTI "As you take"
	CALL TPRINT,BATH-MAT
	PRINTI " you notice"
	CALL APRINT,RED-CARD
	PRINTI " lying on the floor of the bathroom."
	CRLF
	CALL PRINT-ID,STR?113 >STACK
	RSTACK

	.FUNCT UPSTAIRS-CD-F
	EQUAL? PRSA,V?OPEN \FALSE
	FSET? UPSTAIRS-CD,OPENBIT /FALSE
	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE /FALSE
	EQUAL? HERE,UPSTAIRS-HALL-MIDDLE \FALSE
	CALL OPEN-DOOR-TO-SHAFT
	FSET UPSTAIRS-CD,OPENBIT
	RTRUE

	.FUNCT OPEN-DOOR-TO-SHAFT
	PRINTI "You open the door and see the "
	EQUAL? HERE,UPSTAIRS-HALL-MIDDLE \?L4
	EQUAL? CLOSET-FLOOR,FOYER /?L3
?L4:	EQUAL? HERE,FOYER \?L1
	EQUAL? CLOSET-FLOOR,CELLAR \?L1
?L3:	PRINTR "top of the closet at floor level and the shaft continuing upwards."
?L1:	EQUAL? HERE,CELLAR \?L7
	EQUAL? CLOSET-FLOOR,FOYER /?L6
?L7:	EQUAL? HERE,FOYER \?L8
	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE /?L6
?L8:	EQUAL? HERE,UPSTAIRS-HALL-MIDDLE \?L5
	EQUAL? CLOSET-FLOOR,ATTIC \?L5
?L6:	PRINTI "bottom of the closet at ceiling level"
	EQUAL? HERE,FOYER,UPSTAIRS-HALL-MIDDLE \?L9
	PRINTI " and a shaft below"
?L9:	PRINTR "."
?L5:	EQUAL? HERE,CELLAR \?L14
	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE /?L13
?L14:	EQUAL? HERE,UPSTAIRS-HALL-MIDDLE \?L12
	EQUAL? CLOSET-FLOOR,CELLAR \?L12
?L13:	EQUAL? HERE,CELLAR \?L15
	PRINTI "bottom of the closet far above"
	JUMP ?L17
?L15:	PRINTI "top of the closet far below"
?L17:	PRINTR "."
?L12:	EQUAL? HERE,ATTIC \FALSE
	PRINTI "top of the closet "
	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE \?L19
	PRINTI "at floor level"
	JUMP ?L22
?L19:	EQUAL? CLOSET-FLOOR,CELLAR \?L21
	PRINTI "far below"
	JUMP ?L22
?L21:	PRINTI "below"
?L22:	PRINTR "."

	.FUNCT TO-FOYER-F
	FSET? NEWEL,EVERYBIT /?L1
	PRINTI "As you step onto the first step, the staircase flattens and you slide down the flattened stairs"
	RANDOM 100 >STACK
	LESS? 50,STACK /?L3
	PRINTI ", experiencing for a split second the euphoria only an Olympic bobsledder can know"
	CALL PRINT-ID,STR?114
?L3:	PRINTI ". After you slide into the foyer, the stairs return to normal."
	CRLF
	CRLF
	RETURN FOYER
?L1:	FSET? SKIS,WORNBIT \?L7
	PRINT SNOWPLOW
	CRLF
	CRLF
	RETURN FOYER
?L7:	PRINTI "You walk down the stairs to the..."
	CRLF
	CRLF
	RETURN FOYER

	.FUNCT UPSTAIRS-CLOSET-ENTER-F
	FSET? UPSTAIRS-CD,OPENBIT /?L1
	CALL ITS-CLOSED,UPSTAIRS-CD
	RFALSE
?L1:	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE \?L3
	RETURN CLOSET
?L3:	EQUAL? CLOSET-FLOOR,FOYER \?L4
	RETURN CLOSET-TOP
?L4:	PRINTI "You enter the shaft and plunge down a floor. A bit shaken, you find yourself at..."
	CRLF
	CRLF
	CALL PRINT-ID,STR?115
	RETURN CLOSET-TOP

	.FUNCT PHONE-F
	EQUAL? PRSA,V?REPLY \?L1
	PRINTR "It wasn't ringing."
?L1:	EQUAL? PRSA,V?TAKE \?L3
	FSET? PHONE,EVERYBIT \?L4
	PRINTR "You don't hear a dial tone. The line is dead."
?L4:	PRINTR "You hear a dial tone."
?L3:	EQUAL? PRSA,V?PHONE \?L7
	EQUAL? PRSO,PHONE \?L7
	PRINTR "You should dial a number, such as 911."
?L7:	EQUAL? PRSA,V?HANG-UP \FALSE
	PRINTR "You replace the receiver."

	.FUNCT THERE-DOESNT-SEEM
	PRINTI "There doesn't seem to be"
	RTRUE

	.FUNCT V-PHONE
	CALL GLOBAL-IN?,PHONE,HERE >STACK
	ZERO? STACK \?L1
	CALL THERE-DOESNT-SEEM
	CALL APRINT,PHONE
	PRINTR " here."
?L1:	EQUAL? PRSI,0,PHONE /?L3
	PRINTI "Too bad"
	CALL TPRINT,PRSI
	PRINTR " isn't a telephone."
?L3:	FSET? PHONE,EVERYBIT \?L4
	PRINTR "You don't hear a dial tone. The line is dead."
?L4:	EQUAL? PRSO,INTNUM \?L5
	GRTR? P-EXCHANGE,999 /?L8
	GRTR? P-NUMBER,9999 \?L6
?L8:	PRINTR "You dialed too many numbers. Remember what Aunt Hildegarde thought about guests making long distance calls!"
?L6:	ZERO? P-EXCHANGE \?L11
	ZERO? P-NUMBER /?L10
?L11:	EQUAL? P-EXCHANGE,555 \?L12
	EQUAL? P-NUMBER,1212 /?L10
?L12:	ZERO? P-EXCHANGE \?L13
	EQUAL? P-NUMBER,411 \?L9
?L10:	PRINTR "You hear a lazy voice come on the line. ""You have reached the Malibu phone company. Our operator is busy now. Mellow out and try your call again later."""
?L9:	ZERO? P-EXCHANGE \?L13
	EQUAL? P-NUMBER,911 \?L13
	PRINTR "A police officer answers the phone in mid-snore saying he'll send a car right over, then hangs up and goes back to sleep."
?L13:	EQUAL? P-EXCHANGE,492 \?L14
	EQUAL? P-NUMBER,6000 \?L14
	PRINTR "You hear voice talking at a fast pace trying to announce all the information necessary in 30 seconds. The voice says, ""Thank you for calling Infocom. We are closed now. Please call back during regular business hours, Monday through Friday, 9 a.m. to 6 p.m., Eastern Standard Time."" Then the voice speeds up even more, giving information for technical problems and the special numbers to call. Finally you hear the voice take a deep breath and say, ""Have a nice (BEEP),"" and the message ends."
?L14:	EQUAL? P-EXCHANGE,576 \?L16
	EQUAL? P-NUMBER,1851 \?L15
	PRINTI "A nerdish voice answers"
	CALL TPRINT,PHONE
	PRINTR " saying, ""Hello, this is Roy G. Biv, Computer Service and Repair. Our office is closed now. Please call back during our regular business hours."""
?L15:	EQUAL? P-EXCHANGE,576 \?L16
	EQUAL? P-NUMBER,3190 \?L16
	FSET? TOUPEE,EVERYBIT \?L17
	FSET PHONE,EVERYBIT
	MOVE TOUPEE,HOPPER
	PRINTR "An answering machine comes on the line. It sounds like Aunt Hildegarde's voice saying, ""I can't come to the phone right now. I'm dead. Don't forget to look in the hopper."" Then the line goes dead."
?L17:	PRINTR "You get a busy signal."
?L16:	RANDOM 100 >STACK
	LESS? 60,STACK /?L20
	PRINTI "The "
	CALL DPRINT,PHONE
	PRINTR " rings and rings, but no one answers."
?L20:	PRINTI "The "
	CALL DPRINT,PHONE
	PRINTR " is answered, ""Hello? Hello? Hey, what is this, a crank call? You made my wife cry the last time you called, you pervert."" You hear the receiver slammed down."
?L5:	PRINTI "There's no sense in phoning"
	CALL ARPRINT,PRSO
	RTRUE

	.FUNCT TOILET-F
	EQUAL? PRSO,TOILET \FALSE
	EQUAL? PRSA,V?SIT,V?USE,V?WALK \?L3
	PRINTI "You'll have to hold it in. The water's been shut off, remember?"
	CRLF
	EQUAL? PRSA,V?USE /?L5
	PUSH 0
	JUMP ?L6
?L5:	PUSH 1
?L6:	CALL PRINT-ID,STR?116,STACK >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?SMELL,V?LOOK-INSIDE \?L7
	PRINTI "The toilet is immaculate. Nosey, aren't you?"
	CRLF
	EQUAL? PRSA,V?SMELL /?L8
	PUSH 0
	JUMP ?L9
?L8:	PUSH 1
?L9:	CALL PRINT-ID,STR?117,STACK >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?FLUSH \FALSE
	PRINTR "You pull the handle, but nothing happens. The water has been shut off."

	.FUNCT SEAT-F
	EQUAL? PRSA,V?TAKE \?L1
	EQUAL? PRSO,SEAT \?L1
	PRINT RIDICULOUS
	CRLF
	CALL PRINT-ID,STR?118 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUT \?L3
	EQUAL? PRSI,SEAT,SOFA \?L3
	FCLEAR PRSO,WEARBIT
	MOVE PRSO,HERE
	PRINTI "It seems a shame to mar"
	CALL TPRINT,PRSI
	PRINTI " with"
	CALL APRINT,PRSO
	PRINTR ", so you put it on the floor instead."
?L3:	EQUAL? PRSA,V?SIT,V?BOARD,V?CLIMB-ON /?L5
	EQUAL? PRSA,V?ENTER \FALSE
?L5:	PRINTR "You sit down and relax for a moment. Soon your mind begins to ponder your Aunt's wealth and you jump to your feet, ready to continue."

	.FUNCT BED-F
	EQUAL? PRSA,V?TAKE \?L1
	EQUAL? PRSO,BED \?L1
	PRINT RIDICULOUS
	CRLF
	CALL PRINT-ID,STR?119 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?BOARD,V?CLIMB-ON,V?LIE-DOWN /?L4
	EQUAL? PRSA,V?ENTER,V?SIT \?L3
?L4:	PRINTR "You get into bed and relax for a moment. Soon your mind begins to ponder your Aunt's wealth and you jump to your feet, ready to continue."
?L3:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L5
	EQUAL? PRSI,BED \?L5
	MOVE PRSO,HERE
	PRINTI "Rather than marring the bed's fine linen with"
	CALL APRINT,PRSO
	PRINTR ", you put it on the floor."
?L5:	EQUAL? PRSA,V?PUSH-TO,V?PUSH \FALSE
	PRINT RIDICULOUS
	CRLF
	RTRUE

	.FUNCT I-SANDS-OF-TIME,X=0,MINUTES,CNT=0,TCNT=0,TNUM,FOLLOW-THE-LAWYER=0
	ADD MOVES,1260 >MINUTES
	EQUAL? MINUTES,1859 \?L1
	SET 'X,60
	CALL MICKEY-MOUSE,2,STR?120
	JUMP ?L5
?L1:	EQUAL? MINUTES,1919 \?L3
	SET 'X,30
	CALL MICKEY-MOUSE,1,STR?121
	JUMP ?L5
?L3:	EQUAL? MINUTES,1949 \?L4
	SET 'X,30
	CALL MICKEY-MOUSE,30,STR?122
	JUMP ?L5
?L4:	EQUAL? MINUTES,1979 \?L5
	EQUAL? HERE,FOYER,FRONT-PORCH,SOUTH-JUNCTION \?L6
	FSET LIVING-ROOM,ONBIT
	SET 'FOLLOW-THE-LAWYER,1
	CRLF
	PRINT OUT-OF-NOWHERE
	PRINTI """Ah, there you are. Let's go into the living room and talk,"" says the lawyer. You follow him to the living room."
	CRLF
	CRLF
	CALL GOTO,LIVING-ROOM
	CRLF
?L6:	IN? PLAYER,LIVING-ROOM \?L9
	ZERO? FOLLOW-THE-LAWYER \?L11
	CRLF
	PRINT OUT-OF-NOWHERE
?L11:	PRINTI """Well, let's wrap this up quickly, I've got to be in court for the LaFlank divorce this afternoon,"" the lawyer snaps. He pauses for a moment, glancing around the room"
	GET TREASURE-TABLE,0 >TNUM
?L14:	IGRTR? 'CNT,TNUM /?L15
	GET TREASURE-TABLE,CNT >X
	CALL VISIBLE?,X >STACK
	ZERO? STACK /?L14
	INC 'TCNT
	JUMP ?L14
?L15:	ZERO? TCNT \?L22
	PRINTI ". ""Uhh, I don't see any 'treasures.'"
	JUMP ?L25
?L22:	EQUAL? TCNT,10 \?L24
	PRINTI " then at a small note pad in his hand. He congratulates you for finding all the ""treasures."" ""But you didn't follow your aunt's instructions in the note."
	JUMP ?L25
?L24:	PRINTI " then at a small note pad in his hand. ""Uhh, I only count "
	GET NUMWORDS,TCNT >STACK
	PRINT STACK
	PRINTI " 'treasure"
	EQUAL? TCNT,1 /?L26
	PRINTI "s"
?L26:	PRINTI "' here."
?L25:	PRINTI " I'm sorry, but you won't be inheriting Mrs. Burbank's estate after all,"" says the lawyer. He turns and leaves as his words echo in your head. Then you feel a sharp pain in your backside, as you kick yourself for not having "
	EQUAL? TCNT,10 \?L29
	PRINTI "followed the instructions in the note"
	JUMP ?L33
?L29:	EQUAL? TREASURES-FOUND,10 \?L31
	PRINTI "brought all the ""treasures"" you found to the living room"
	JUMP ?L33
?L31:	ZERO? TREASURES-FOUND \?L32
	PRINTI "found any of the ""treasures"""
	JUMP ?L33
?L32:	PRINTI "found all the ""treasures"" in time"
?L33:	PRINTI "."
	CRLF
	JUMP ?L34
?L9:	PRINTI "Your time is up! "
	EQUAL? TREASURES-FOUND,10 \?L35
	PRINTI "You did a good job by finding all the ""treasures,"" but you didn't meet the lawyer at 9 a.m."
	JUMP ?L38
?L35:	GRTR? TREASURES-FOUND,0 \?L37
	PRINTI "You only found "
	GET NUMWORDS,TREASURES-FOUND >STACK
	PRINT STACK
	PRINTI " of the ten ""treasures."""
	JUMP ?L38
?L37:	PRINTI "What a bozo! You didn't find any ""treasures."" You're not fit to be fertilizer for the family tree! Are you sure you're a Burbank? I'd go on but there is only so much room on a disk."
?L38:	PRINTI " You can't help but think about how disappointed Aunt Hildegarde and Uncle Buddy would have been with you right now. Never mind your own disappointment of missing out on inheriting a fortune."
?L34:	SET 'MOVES,720
	USL
	CALL FINISH
?L5:	CALL QUEUE,I-SANDS-OF-TIME,X >STACK
	RSTACK

	.FUNCT MICKEY-MOUSE,NUM,STRING
	CRLF
	PRINTI "[Hurry up, you only have "
	PRINTN NUM
	PRINTI " "
	PRINT STRING
	PRINTR " left!]"

	.FUNCT MATCHBOX-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "You see a picture of Santa Claus in his sleigh. The sleigh is filled with computer games from Infocom, and the reindeer pulling it look strained."
?L1:	EQUAL? PRSA,V?TAKE \FALSE
	CALL PRINT-ID,STR?123
	FCLEAR MATCHBOX,NDESCBIT
	RFALSE

	.FUNCT WAX-COAT-F
	EQUAL? PRSA,V?SCRAPE-OFF \FALSE
	EQUAL? PRSI,GREEN-MATCH,RED-MATCH \FALSE
	FSET? PRSI,EVERYBIT \FALSE
	FCLEAR PRSI,EVERYBIT
	IN? PRSO,PRSI \?L5
	REMOVE PRSO
	JUMP ?L7
?L5:	REMOVE WAX-COAT-2
?L7:	PRINTI "You scrape the wax coating off"
	CALL TRPRINT,PRSI
	RTRUE

	.FUNCT MATCH-F,WAXED
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's the wooden, self-lighting variety of match. The "
	CALL DPRINT,PRSO
	FSET? PRSO,EVERYBIT \?L3
	PRINTI " head is coated with a thin layer of wax"
	JUMP ?L6
?L3:	FSET? PRSO,WETBIT \?L5
	PRINTI " is wet"
	JUMP ?L6
?L5:	PRINTI " is "
	FSET? PRSO,ONBIT /?L7
	PRINTI "not "
?L7:	PRINTI "lit"
?L6:	PRINTR "."
?L1:	EQUAL? PRSA,V?KILL,V?LAMP-ON \?L10
	IN? PRSO,PLAYER /?L11
	PRINTI "You're not holding"
	CALL TRPRINT,PRSO
	RTRUE
?L11:	FSET? PRSO,FLAMEBIT \?L13
	PRINTR "It's already lit."
?L13:	GETP PRSO,P?MATCH-LIFE >STACK
	ZERO? STACK \?L14
	PRINTR "You can't. It's all used up."
?L14:	FSET? PRSO,WETBIT \?L15
	PRINTR "It's wet. It won't light now."
?L15:	EQUAL? HERE,IN-POOL-1,IN-POOL-2,UNDERPASS-1 /?L17
	EQUAL? HERE,UNDERPASS-2 \?L16
?L17:	PRINTR "Not even Uncle Buddy's best special effects men could light a match under water!"
?L16:	EQUAL? HERE,ON-POOL-1,ON-POOL-2,INLET \?L18
	PRINTR "You'd better find some dry land first."
?L18:	CALL QUEUE,I-MATCH-BURN,-1
	FSET PRSO,ONBIT
	IN? WAX-COAT-1,PRSO \?L20
	REMOVE WAX-COAT-1
	JUMP ?L22
?L20:	IN? WAX-COAT-2,PRSO \?L22
	REMOVE WAX-COAT-2
?L22:	FSET PRSO,FLAMEBIT
	FSET? PRSO,EVERYBIT \?L24
	FCLEAR PRSO,EVERYBIT
	PRINTI "The wax coating melts away as you light"
	CALL TRPRINT,PRSO
	JUMP ?L26
?L24:	PRINTI "Okay,"
	CALL TPRINT,PRSO
	PRINTI " is now lit."
	CRLF
?L26:	CALL NOW-LIT?
	RTRUE
?L10:	EQUAL? PRSA,V?LAMP-OFF \?L27
	FSET? PRSO,ONBIT \?L28
	CALL BLOW-OUT-MATCH,PRSO >STACK
	RSTACK
?L28:	PRINTR "It's not lit."
?L27:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT I-MATCH-BURN
	FSET? RED-MATCH,ONBIT \?L1
	CALL MATCH-BURN,RED-MATCH
?L1:	FSET? GREEN-MATCH,ONBIT \FALSE
	CALL MATCH-BURN,GREEN-MATCH >STACK
	RSTACK

	.FUNCT MATCH-BURN,OBJ
	GETP OBJ,P?MATCH-LIFE >STACK
	ZERO? STACK \?L1
	CALL BLOW-OUT-MATCH,OBJ,1 >STACK
	RSTACK
?L1:	GETP OBJ,P?MATCH-LIFE >STACK
	DEC 'STACK
	PUTP OBJ,P?MATCH-LIFE,STACK
	RTRUE

	.FUNCT BLOW-OUT-MATCH,OBJ,ADD-CR=0
	FCLEAR OBJ,ONBIT
	FCLEAR OBJ,FLAMEBIT
	FSET? RED-MATCH,ONBIT /?L1
	FSET? GREEN-MATCH,ONBIT /?L1
	CALL DEQUEUE,I-MATCH-BURN
?L1:	CALL VISIBLE?,OBJ >STACK
	ZERO? STACK /FALSE
	ZERO? ADD-CR /?L6
	CRLF
?L6:	PRINTI "The "
	CALL DPRINT,OBJ
	PRINTI " goes out, turns to ashes, falls to the ground and disappears."
	CRLF
	CALL SAY-IF-NOT-LIT
	REMOVE OBJ
	RTRUE

	.FUNCT BOAT-DOCK-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in a large grotto standing on a boat dock. Moonlight trickling through the grotto's opening to the north reflects off the water, dimly illuminating this area. A wooden walkway leads north out of the grotto. A pool of sea water covers the bottom of the grotto."
	RTRUE

	.FUNCT PORTABLE-WATER-F
	EQUAL? PRSA,V?ENTER,V?SWIM \?L1
	CALL GLOBAL-IN?,WATER,HERE >STACK
	ZERO? STACK /?L3
	CALL PERFORM,PRSA,WATER
	RTRUE
?L3:	PRINTI "You'd never fit into"
	LOC PORTABLE-WATER >STACK
	CALL TPRINT,STACK
	PRINTR "!"
?L1:	EQUAL? PRSA,V?TASTE,V?DRINK-FROM,V?DRINK \?L6
	CALL NOT-HOLDING-WATER? >STACK
	ZERO? STACK \TRUE
	PRINTR "You take a sip."
?L6:	EQUAL? PRSA,V?EMPTY,V?DROP,V?THROW /?L11
	EQUAL? PRSA,V?POUR,V?PUT,V?PUT-ON \?L10
?L11:	EQUAL? PRSO,PORTABLE-WATER \?L10
	CALL NOT-HOLDING-WATER? >STACK
	ZERO? STACK \TRUE
	REMOVE PORTABLE-WATER
	FCLEAR PORTABLE-WATER,NDESCBIT
	SET 'AMOUNT-OF-WATER,0
	CALL DEQUEUE,I-DRIP
	EQUAL? PRSA,V?EMPTY \?L15
	PRINTR "You pour the water out of the bucket."
?L15:	ZERO? PRSI /?L18
	FSET PRSI,WETBIT
	FSET? PRSI,FLAMEBIT \?L20
	FCLEAR PRSI,FLAMEBIT
	FCLEAR PRSI,ONBIT
	EQUAL? PRSI,RED-CANDLE \?L22
	CALL STOP-RED-BURNING
	JUMP ?L26
?L22:	EQUAL? PRSI,WHITE-CANDLE \?L24
	CALL STOP-WHITE-BURNING
	JUMP ?L26
?L24:	EQUAL? PRSI,BLUE-CANDLE \?L25
	CALL STOP-BLUE-BURNING
	JUMP ?L26
?L25:	EQUAL? PRSI,GREEN-MATCH,RED-MATCH \?L26
	CALL DEQUEUE,I-MATCH-BURN
?L26:	PRINTR "You douse the flame with water."
?L20:	PRINTI "You pour water over it, making a mess."
	CRLF
	CALL PRINT-ID,STR?124 >STACK
	RSTACK
?L18:	REMOVE PORTABLE-WATER
	PRINTI "The water pours out, making a mess."
	CRLF
	CALL PRINT-ID,STR?125 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L30
	EQUAL? PRSI,PORTABLE-WATER \?L30
	IN? PORTABLE-WATER,BUCKET \?L30
	CALL PERFORM,V?PUT,PRSO,BUCKET
	RTRUE
?L30:	EQUAL? PRSA,V?GIVE \?L31
	EQUAL? PRSO,PORTABLE-WATER \?L31
	FSET? PRSI,ACTORBIT \?L31
	CALL PERFORM,V?POUR,PORTABLE-WATER
	RTRUE
?L31:	EQUAL? PRSA,V?EXAMINE,V?SEARCH,V?LOOK-INSIDE \FALSE
	LOC PORTABLE-WATER >STACK
	CALL PERFORM,PRSA,STACK
	RTRUE

	.FUNCT WATER-F
	EQUAL? HERE,UPSTAIRS-BATHROOM,KITCHEN,LADIES-ROOM /?L3
	EQUAL? HERE,MENS-ROOM \?L1
?L3:	PRINTR "Hmmm. It seems the water has been turned off."
?L1:	EQUAL? PRSA,V?DISEMBARK \?L4
	CALL DO-WALK,P?OUT
	RTRUE
?L4:	EQUAL? PRSA,V?ENTER,V?SWIM \?L5
	EQUAL? HERE,NORTH-GARDEN \?L6
	PRINTR "The pond's too shallow for swimming."
?L6:	FSET? SKIS,WORNBIT \?L8
	PRINT DOG-PADDLE
	CRLF
	RTRUE
?L8:	CALL ULTIMATELY-IN?,LADDER >STACK
	ZERO? STACK /?L9
	PRINTI "You won't be able to swim carrying"
	CALL TRPRINT,LADDER
	RTRUE
?L9:	EQUAL? HERE,INLET,ON-POOL-1,IN-POOL-1 /?L11
	EQUAL? HERE,UNDERPASS-1,UNDERPASS-2,IN-POOL-2 /?L11
	EQUAL? HERE,ON-POOL-2 \?L10
?L11:	PRINTR "You swim a few yards."
?L10:	CALL ALL-WET,PLAYER
	PRINTI "As you enter the chilly water, goose bumps cover your body and your teeth chatter a bit."
	CRLF
	CRLF
	CALL PRINT-ID,STR?126
	IN? BUCKET,PLAYER \?L13
	MOVE PORTABLE-WATER,BUCKET
	CALL QUEUE,I-DRIP,1
?L13:	EQUAL? HERE,BOAT-DOCK \?L16
	CALL GOTO,ON-POOL-1
	JUMP ?L19
?L16:	EQUAL? HERE,LEDGE \?L18
	CALL GOTO,ON-POOL-2
	JUMP ?L19
?L18:	CALL GOTO,INLET
?L19:	CALL ULTIMATELY-IN?,FLASHLIGHT >STACK
	ZERO? STACK /?L20
	FSET? FLASHLIGHT,ONBIT \?L20
	FCLEAR FLASHLIGHT,ONBIT
	CRLF
	PRINTI "Oops! Your flashlight went out. The water ruined it."
	CRLF
?L20:	CALL ULTIMATELY-IN?,RED-CANDLE >STACK
	ZERO? STACK /?L23
	FSET? RED-CANDLE,ONBIT \?L23
	CALL BLOW-OUT-CANDLE,RED-CANDLE
?L23:	CALL ULTIMATELY-IN?,WHITE-CANDLE >STACK
	ZERO? STACK /?L26
	FSET? WHITE-CANDLE,ONBIT \?L26
	CALL BLOW-OUT-CANDLE,WHITE-CANDLE
?L26:	CALL ULTIMATELY-IN?,BLUE-CANDLE >STACK
	ZERO? STACK /?L29
	FSET? BLUE-CANDLE,ONBIT \?L29
	CALL BLOW-OUT-CANDLE,BLUE-CANDLE
?L29:	CALL ULTIMATELY-IN?,GREEN-MATCH >STACK
	ZERO? STACK /?L32
	FSET? GREEN-MATCH,FLAMEBIT \?L32
	CALL ULTIMATELY-IN?,RED-MATCH >STACK
	ZERO? STACK /?L32
	FSET? RED-MATCH,FLAMEBIT \?L32
	FCLEAR RED-MATCH,ONBIT
	FCLEAR RED-MATCH,FLAMEBIT
	REMOVE RED-MATCH
	FCLEAR GREEN-MATCH,ONBIT
	FCLEAR GREEN-MATCH,FLAMEBIT
	REMOVE GREEN-MATCH
	PRINTI "You drop the lit "
	CALL DPRINT,GREEN-MATCH
	PRINTI " and the lit "
	CALL DPRINT,RED-MATCH
	PRINTI "."
	CRLF
?L32:	CALL ULTIMATELY-IN?,RED-MATCH >STACK
	ZERO? STACK /?L35
	FSET? RED-MATCH,FLAMEBIT \?L35
	FCLEAR RED-MATCH,ONBIT
	FCLEAR RED-MATCH,FLAMEBIT
	REMOVE RED-MATCH
	PRINTI "You drop the lit "
	CALL DPRINT,RED-MATCH
	PRINTI "."
	CRLF
?L35:	CALL ULTIMATELY-IN?,GREEN-MATCH >STACK
	ZERO? STACK /TRUE
	FSET? GREEN-MATCH,FLAMEBIT \TRUE
	FCLEAR GREEN-MATCH,ONBIT
	FCLEAR GREEN-MATCH,FLAMEBIT
	REMOVE GREEN-MATCH
	PRINTI "You drop the lit "
	CALL DPRINT,GREEN-MATCH
	PRINTR "."
?L5:	EQUAL? PRSA,V?TAKE \?L41
	EQUAL? PRSO,WATER \?L41
	IN? BUCKET,PLAYER \?L41
	CALL PERFORM,V?FILL,BUCKET,WATER
	RTRUE
?L41:	EQUAL? PRSA,V?PUT \?L42
	EQUAL? PRSI,WATER \?L42
	EQUAL? HERE,NORTH-GARDEN \?L43
	CALL PERFORM,V?PUT,PRSO,POND
	RTRUE
?L43:	REMOVE PRSO
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " disappears into the ocean water."
?L42:	EQUAL? PRSA,V?LOOK-INSIDE \?L46
	EQUAL? HERE,NORTH-GARDEN \?L47
	CALL PERFORM,V?LOOK-INSIDE,POND
	RTRUE
?L47:	PRINTR "You see nothing unusual about sea water."
?L46:	EQUAL? PRSA,V?DRINK \FALSE
	EQUAL? PRSO,WATER \FALSE
	PRINTI "You take a sip."
	CRLF
	IN? PLAYER,NORTH-GARDEN /?L51
	PUSH 1
	JUMP ?L52
?L51:	PUSH 0
?L52:	CALL PRINT-ID,STR?127,STACK >STACK
	RSTACK

	.FUNCT ALL-WET,THING,OBJ
	FSET THING,WETBIT
	FIRST? THING >OBJ \?L3
?L4:	FSET OBJ,WETBIT
	FIRST? OBJ >STACK \?L7
	CALL ALL-WET,OBJ
?L7:	NEXT? OBJ >OBJ /?L4
?L3:	FSET? RED-MATCH,EVERYBIT \?L11
	FCLEAR RED-MATCH,WETBIT
?L11:	FSET? GREEN-MATCH,EVERYBIT \FALSE
	FCLEAR GREEN-MATCH,WETBIT
	RTRUE

	.FUNCT TO-BOAT-DOCK
	EQUAL? HERE,ON-POOL-1 \FALSE
	PRINTI "You climb out of the pool and onto the boat dock. The night air makes you shiver."
	CRLF
	CRLF
	RETURN BOAT-DOCK

	.FUNCT UNDER-WATER-F
	PRINTI "You take a deep breath then plunge down."
	CRLF
	CRLF
	EQUAL? HERE,ON-POOL-1 \?L1
	CALL GOTO,IN-POOL-1
	JUMP ?L3
?L1:	CALL GOTO,IN-POOL-2
?L3:	SET 'BREATH,6
	CALL QUEUE,I-BREATH,-1
	RFALSE

	.FUNCT I-BREATH
	DEC 'BREATH
	EQUAL? BREATH,3 \?L1
	CRLF
	PRINTR "You feel pressure building in your chest. You won't be able to hold your breath much longer."
?L1:	EQUAL? BREATH,2 \?L3
	CRLF
	PRINTR "The pressure is increasing. Your feel as if your lungs are going to rupture!"
?L3:	EQUAL? BREATH,1 \?L4
	CRLF
	PRINTI "You can't hold the air in your lungs any longer. You open your mouth and the air bursts out."
	CRLF
	CALL PRINT-ID,STR?128 >STACK
	RSTACK
?L4:	ZERO? BREATH \FALSE
	CRLF
	PRINTI "As you gasp for your next breath, you suck in a mouthful of cold sea water. You swim frantically a short distance then pass out. Later you awake to find yourself on the beach."
	CRLF
	CRLF
	CALL PRINT-ID,STR?129
	CALL GOTO,BEACH >STACK
	RSTACK

	.FUNCT OUT-OF-WATER-F
	CALL DEQUEUE,I-BREATH
	PRINTI "You come to the surface and catch your breath."
	CRLF
	CRLF
	EQUAL? HERE,IN-POOL-1 \?L1
	RETURN ON-POOL-1
?L1:	EQUAL? HERE,IN-POOL-2 \FALSE
	RETURN ON-POOL-2

	.FUNCT TO-UNDERPASS-EAST
	PRINTI "You swim east through a narrow, jagged passage."
	CRLF
	CRLF
	RETURN UNDERPASS-1

	.FUNCT TO-UNDERPASS-WEST
	PRINTI "You swim west through a narrow, jagged passage."
	CRLF
	CRLF
	RETURN UNDERPASS-2

	.FUNCT IN-POOL-2-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are swimming underwater. In the darkness, you can't make out your surroundings here."
	CALL LIT?,ON-POOL-2 >STACK
	ZERO? STACK /TRUE
	PRINTI " However you do notice a faint light above you."
	RTRUE

	.FUNCT ON-POOL-2-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are swimming on the surface of a pool "
	CALL LIT?,HERE >STACK
	ZERO? STACK /?L3
	PRINTI "inside a small grotto. To the north is a small ledge."
	RTRUE
?L3:	PRINTI "in the dark. From the sound of your breathing you can tell this is a fairly small area."
	RTRUE

	.FUNCT BOMB-SHELTER-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "With its concrete walls and floor this room looks as if it might be a bomb shelter. A heavy-duty sawhorse has"
	CALL APRINT,PLANK
	PRINTI " across it. "
	FSET? BS-SAFE,EVERYBIT \?L3
	PRINTI "A "
	CALL DPRINT,BS-SAFE
	PRINTI " is on"
	CALL TPRINT,LEFT-END
	JUMP ?L5
?L3:	PRINTI "Suspended above the left end of the plank by"
	CALL APRINT,ROPE
	EQUAL? ROPE-LIFE,1,2 \?L6
	PRINTI ", which is burning,"
?L6:	PRINTI " is"
	CALL APRINT,BS-SAFE
	PRINTI ". The rope stretches from the safe, through a pulley in the ceiling, to the floor where it is tied to a pipe running along the wall"
?L5:	PRINTI ". In the ceiling above"
	CALL TPRINT,RIGHT-END
	PRINTI " there is a"
	FSET? HATCH,OPENBIT \?L9
	PRINTI "n open"
	JUMP ?L11
?L9:	PRINTI " closed"
?L11:	PRINTI " hatch. A long chain hangs down from"
	CALL TPRINT,HATCH
	PRINTI ". Just beneath"
	CALL TPRINT,HATCH
	PRINTI " there is a "
	FSET? LADDER,EVERYBIT \?L12
	CALL DPRINT,LADDER
	PRINTI " hanging from a "
?L12:	PRINTI "pair of heavy-duty metal hooks protruding from the wall. There is a doorway leading south."
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?HANG-UP \FALSE
	ZERO? PRSI \FALSE
	CALL PERFORM,V?HANG-UP,PRSO,HOOKS
	RTRUE

	.FUNCT HATCH-F
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,HATCH \?L1
	FSET? HATCH,OPENBIT \?L3
	CALL PERFORM,V?PUT,PRSO,HATCH-HOLE
	RTRUE
?L3:	PRINTR "The hatch is closed!"
?L1:	EQUAL? PRSA,V?OPEN \?L6
	FSET? HATCH,OPENBIT /?L6
	EQUAL? HERE,BOMB-SHELTER \?L7
	PRINTR "That's for you to figure out."
?L7:	PRINTR "There doesn't seem to be any way to open it from this side."
?L6:	EQUAL? PRSA,V?EXAMINE \?L10
	FSET? HATCH,OPENBIT \?L10
	PRINTI "The "
	CALL DPRINT,HATCH
	PRINTR " is open, revealing a hole about the size of a manhole."
?L10:	EQUAL? PRSA,V?CLOSE \?L11
	FSET? HATCH,OPENBIT \?L11
	EQUAL? HERE,BOMB-SHELTER \?L12
	PRINTR "That's for you to figure out."
?L12:	FCLEAR HATCH,OPENBIT
	FSET HATCH-HOLE,INVISIBLE
	PRINTR "With a show of strength which would make Aunt Hildegarde proud, you manage to close the heavy hatch."
?L11:	EQUAL? PRSA,V?ENTER \FALSE
	EQUAL? HERE,CLIFF \?L16
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L16:	CALL DO-WALK,P?UP >STACK
	RSTACK

	.FUNCT CHAIN-F
	EQUAL? PRSA,V?CLIMB-UP,V?PULL \?L1
	PRINTI "You pull on the "
	CALL DPRINT,CHAIN
	EQUAL? PRSA,V?CLIMB-UP \?L3
	PRINTI " as you attempt to climb"
?L3:	PRINTI " and"
	CALL TPRINT,HATCH
	FSET? HATCH,OPENBIT \?L6
	PRINTI " drops, covering the"
	FCLEAR HATCH,OPENBIT
	FSET HATCH-HOLE,INVISIBLE
	JUMP ?L8
?L6:	PRINTI " pops up, revealing a"
	FSET HATCH,OPENBIT
	FCLEAR HATCH-HOLE,INVISIBLE
?L8:	PRINTI " hole in the ceiling."
	EQUAL? PRSA,V?CLIMB-UP \?L9
	PRINTI " The chain is too slippery to climb."
?L9:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L12
	PRINTI "The "
	CALL DPRINT,CHAIN
	PRINTR " hangs down to about eye-level from the hatch above."
?L12:	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "You can't take the chain; it's attached to the hatch."

	.FUNCT ENDS-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	CALL TOUCHING?,PRSO >STACK
	ZERO? STACK /?L1
	LOC PLAYER >STACK
	CALL ULTIMATELY-IN?,PRSO,STACK >STACK
	ZERO? STACK \?L1
	PRINT YOU-CANT
	PRINTI "reach it from here. You'll have to step off"
	LOC PLAYER >STACK
	CALL TPRINT,STACK
	PRINTR " first."
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?EXAMINE \?L4
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTI " is "
	EQUAL? PRSO,RIGHT-END \?L8
	EQUAL? WHICH-END-IS-UP,RIGHT-END /?L7
?L8:	EQUAL? PRSO,LEFT-END \?L5
	EQUAL? WHICH-END-IS-UP,LEFT-END \?L5
?L7:	PRINTI "in the air"
	JUMP ?L9
?L5:	PRINTI "on the ground"
?L9:	PRINTR "."
?L4:	EQUAL? PRSA,V?LOWER,V?PUSH-DOWN \?L10
	ZERO? PRSI \?L10
	EQUAL? PRSO,WHICH-END-IS-UP /?L11
	CALL ITS-ALREADY,STR?130 >STACK
	RSTACK
?L11:	FSET? BS-SAFE,EVERYBIT \?L13
	PRINTR "It won't budge. The safe is on the other end. You should have eaten more carrots as Aunt Hildegarde told you to, instead of feeding them to the dog. It might have improved your eyesight."
?L13:	LOC PLAYER >STACK
	EQUAL? PRSO,STACK \?L14
	PRINTI "How can you do that to"
	CALL TPRINT,PRSO
	PRINTR " when you're standing on it?"
?L14:	EQUAL? PRSO,WHICH-END-IS-UP \?L15
	IN? PLAYER,LEFT-END /?L16
	IN? PLAYER,RIGHT-END \?L15
?L16:	PRINTI "You can't lower"
	CALL TPRINT,PRSO
	PRINTI " when you're standing on"
	LOC PLAYER >STACK
	CALL TRPRINT,STACK
	RTRUE
?L15:	PRINTI "You push down the "
	EQUAL? WHICH-END-IS-UP,RIGHT-END \?L18
	SET 'WHICH-END-IS-UP,LEFT-END
	PRINTI "right"
	JUMP ?L20
?L18:	SET 'WHICH-END-IS-UP,RIGHT-END
	PRINTI "left"
?L20:	PRINTR " end of the plank and the other end goes up."
?L10:	EQUAL? PRSA,V?RAISE \?L21
	ZERO? PRSI \?L21
	EQUAL? PRSO,WHICH-END-IS-UP \?L22
	CALL ITS-ALREADY,STR?131 >STACK
	RSTACK
?L22:	LOC PLAYER >STACK
	EQUAL? PRSO,STACK \?L24
	PRINTI "How can you raise"
	CALL TPRINT,PRSO
	PRINTR " when you're standing on it?"
?L24:	EQUAL? PRSO,LEFT-END \?L25
	FSET? BS-SAFE,EVERYBIT \?L25
	PRINTR "You can't raise the left end when the safe is on it."
?L25:	PRINTI "You raise the "
	EQUAL? WHICH-END-IS-UP,RIGHT-END \?L27
	SET 'WHICH-END-IS-UP,LEFT-END
	PRINTI "left"
	JUMP ?L29
?L27:	SET 'WHICH-END-IS-UP,RIGHT-END
	PRINTI "right"
?L29:	PRINTR " end of the plank and the other end goes down."
?L21:	EQUAL? PRSA,V?CLIMB-ON,V?STAND-ON \?L30
	EQUAL? WHICH-END-IS-UP,PRSO \?L31
	CALL IN-AIR >STACK
	RSTACK
?L31:	FSET? BS-SAFE,EVERYBIT \?L33
	PRINT YOU-CANT
	PRINTI "do that. The "
	CALL DPRINT,BS-SAFE
	PRINTR " is already there."
?L33:	FSET? SKIS,WORNBIT \?L34
	PRINTI "You step onto"
	CALL TPRINT,PLANK
	PRINTR " but ski right off."
?L34:	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L30:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	CALL SLIDES-OFF >STACK
	RSTACK

	.FUNCT IN-AIR
	PRINTR "It's in the air. How can you stand on it?"

	.FUNCT GENERIC-PLANK-F
	EQUAL? PRSA,V?CLIMB-ON,V?STAND-ON /FALSE
	RETURN PLANK

	.FUNCT PLANK-F
	EQUAL? PRSA,V?CLIMB-ON,V?STAND-ON \?L1
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "The "
	CALL DPRINT,PLANK
	PRINTI " is about 12 feet long and several inches thick. The right end of the plank is "
	EQUAL? WHICH-END-IS-UP,RIGHT-END \?L4
	PRINTI "in the air "
	JUMP ?L6
?L4:	PRINTI "on the ground "
?L6:	PRINTI "and the left end is "
	EQUAL? WHICH-END-IS-UP,RIGHT-END \?L7
	PRINTI "on the ground"
	FSET? BS-SAFE,EVERYBIT \?L12
	PRINTI " with"
	CALL APRINT,BS-SAFE
	PRINTI " sitting on it"
	JUMP ?L12
?L7:	PRINTI "in the air"
?L12:	PRINTR "."
?L3:	EQUAL? PRSA,V?DISEMBARK \?L13
	IN? PLAYER,RIGHT-END /?L14
	IN? PLAYER,LEFT-END \?L13
?L14:	LOC PLAYER >STACK
	CALL PERFORM,V?DISEMBARK,STACK
	RTRUE
?L13:	EQUAL? PRSA,V?PUSH-DOWN \?L15
	ZERO? PRSI \?L15
	CALL ENDS-F >STACK
	RSTACK
?L15:	EQUAL? PRSA,V?TAKE \?L16
	PRINT SPINACH
	CRLF
	RTRUE
?L16:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	CALL SLIDES-OFF >STACK
	RSTACK

	.FUNCT SLIDES-OFF
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTI " slides off onto the ground."
	CRLF
	MOVE PRSO,HERE
	RTRUE

	.FUNCT PULLEY-PSEUDO
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "The pulley is firmly attached to the ceiling."

	.FUNCT PIPE-F
	EQUAL? PRSA,V?UNTIE \?L1
	PRINTR "You can't even loosen the knot because of the weight of the safe."
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "The "
	CALL DPRINT,PIPE
	PRINTI " runs along a wall of the bomb shelter"
	ZERO? ROPE-LIFE /?L4
	PRINTI ". There is a rope tied to it"
?L4:	PRINTR "."

	.FUNCT BS-SAFE-F
	EQUAL? PRSA,V?TURN-RIGHT,V?TURN-LEFT \?L1
	EQUAL? PRSI,INTNUM \?L1
	FSET? BS-SAFE,EVERYBIT /?L3
	PRINTR "You can't reach the safe from here."
?L3:	GRTR? P-NUMBER,10 \?L6
	PRINTR "The dial only goes to 10."
?L6:	SET 'BS-SAFE-DIAL-NUMBER,P-NUMBER
	PRINTI "You turn the dial to "
	PRINTN BS-SAFE-DIAL-NUMBER
	PRINTI "."
	FSET? BS-SAFE,OPENBIT /?L12
	ZERO? STEPS-THROUGH-BS-SAFE \?L9
	EQUAL? PRSA,V?TURN-LEFT \?L9
	EQUAL? BS-SAFE-DIAL-NUMBER,4 \?L9
	SET 'STEPS-THROUGH-BS-SAFE,1
	CRLF
	RTRUE
?L9:	FSET? BS-SAFE,OPENBIT /?L12
	EQUAL? STEPS-THROUGH-BS-SAFE,1 \?L11
	EQUAL? PRSA,V?TURN-RIGHT \?L11
	EQUAL? BS-SAFE-DIAL-NUMBER,5 \?L11
	SET 'STEPS-THROUGH-BS-SAFE,2
	CRLF
	RTRUE
?L11:	FSET? BS-SAFE,OPENBIT /?L12
	EQUAL? STEPS-THROUGH-BS-SAFE,2 \?L12
	EQUAL? PRSA,V?TURN-LEFT \?L12
	EQUAL? BS-SAFE-DIAL-NUMBER,7 \?L12
	SET 'STEPS-THROUGH-BS-SAFE,3
	FCLEAR BS-SAFE,LOCKEDBIT
	PRINTR " You hear a faint click."
?L12:	SET 'STEPS-THROUGH-BS-SAFE,0
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TURN-LEFT,V?TURN-RIGHT,V?TURN \?L14
	FSET? BS-SAFE,EVERYBIT /?L15
	PRINTR "You can't reach the safe from here."
?L15:	EQUAL? PRSI,0,ROOMS \?L18
	PRINTR "You didn't say what number you wanted to turn the dial to, or the direction."
?L18:	EQUAL? PRSI,INTNUM \?L20
	PRINTI "You didn't say whether you wanted to turn the dial RIGHT to "
	PRINTN P-NUMBER
	PRINTI " or LEFT to "
	PRINTN P-NUMBER
	PRINTR "."
?L20:	PRINTR "Huh?"
?L14:	EQUAL? PRSA,V?EXAMINE \?L22
	PRINTI "The "
	CALL DPRINT,BS-SAFE
	PRINTI " is "
	FSET? BS-SAFE,EVERYBIT \?L23
	PRINTI "sitting on"
	CALL TPRINT,LEFT-END
	PRINTI ". There is a dial on the safe which can be set to any number between 0 and 10. The dial is set to "
	PRINTN BS-SAFE-DIAL-NUMBER
	JUMP ?L25
?L23:	PRINTI "suspended overhead by"
	CALL APRINT,ROPE
?L25:	PRINTI ". There is a small plaque on the front of"
	CALL TPRINT,BS-SAFE
	PRINTI ". "
	RFALSE
?L22:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? BS-SAFE,OPENBIT \FALSE
	FSET BS-SAFE,LOCKEDBIT
	RFALSE

	.FUNCT PLAQUE-F
	FSET? BS-SAFE,EVERYBIT /?L1
	PRINTI "It's up too high. "
	PRINT YOU-CANT
	PRINTR "read it from here."
?L1:	EQUAL? PRSA,V?READ \FALSE
	CALL FIXED-FONT-ON
	PRINTI " LEVY, REGAN, LEBLING
     SAFE COMPANY
 UPPER SANDUSKY, OHIO
         1936"
	CALL FIXED-FONT-OFF >STACK
	RSTACK

	.FUNCT CORPSE-LINE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	IN? CORPSE-LINE,FILM-PROJECTOR \?L3
	FSET? FILM-PROJECTOR,ONBIT \?L3
	CALL PERFORM,V?EXAMINE,PROJECTION-SCREEN
	RTRUE
?L3:	PRINTR "It's a copy of the film ""A Corpse Line,"" on a large film reel."
?L1:	EQUAL? PRSA,V?TAKE \?L6
	IN? CORPSE-LINE,FILM-PROJECTOR \FALSE
	FSET? FILM-PROJECTOR,ONBIT \FALSE
	PRINTI "Even a nonunion projectionist like yourself should know how dangerous it is to try to take film from"
	CALL APRINT,FILM-PROJECTOR
	PRINTI " while it's running."
	CRLF
	CALL PRINT-ID,STR?132 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?PUT \?L10
	FSET? FILM-PROJECTOR,ONBIT \?L10
	EQUAL? PRSI,FILM-PROJECTOR \?L10
	PRINTI "You start to put"
	CALL TPRINT,CORPSE-LINE
	PRINTI " in"
	CALL TPRINT,FILM-PROJECTOR
	PRINTI ", but glance up at a sign on the wall. The sign states: Remember, Perry Projectionist sez, ""Never try to put film in"
	CALL APRINT,FILM-PROJECTOR
	PRINTI " that's turned on."""
	CRLF
	CALL PRINT-ID,STR?133 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?SHOW \FALSE
	PRINTR "It is a little more complicated than that."

	.FUNCT RUBBER-STAMP-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's the large rubber stamp Buck Palace used to mail the POW's to the Pentagon in Uncle Buddy's ""Address Unknown."""

	.FUNCT ROPE-F
	EQUAL? PRSA,V?UNTIE,V?TIE,V?TAKE \?L1
	EQUAL? ROPE-LIFE,1,2 \?L3
	PRINTI "You'd burn your hand. It's on fire!"
	CRLF
	CALL PRINT-ID,STR?134 >STACK
	RSTACK
?L3:	PRINTI "You can't even loosen the knot because of the weight of"
	CALL TRPRINT,BS-SAFE
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L6
	EQUAL? ROPE-LIFE,2 \?L7
	PRINTI "One end of"
	CALL TPRINT,ROPE
	PRINTI " is tied around"
	CALL TPRINT,BS-SAFE
	PRINTR " and the other end is tied to a pipe running along the wall."
?L7:	EQUAL? ROPE-LIFE,1 \FALSE
	PRINTI "The rope is burning and is tied to"
	CALL TRPRINT,BS-SAFE
	RTRUE
?L6:	EQUAL? PRSA,V?PUT-UNDER \?L11
	EQUAL? PRSO,WHITE-CANDLE,BLUE-CANDLE,RED-CANDLE \?L11
	FSET? PRSO,FLAMEBIT \?L11
	CALL PERFORM,V?BURN,ROPE,PRSO
	RTRUE
?L11:	EQUAL? PRSA,V?BURN \?L12
	CALL SET-FLAME-SOURCE >STACK
	ZERO? STACK \TRUE
	FSET? PRSI,FLAMEBIT /?L15
	PRINTR "Huh?"
?L15:	LESS? ROPE-LIFE,3 \?L16
	CALL ITS-ALREADY,STR?135 >STACK
	RSTACK
?L16:	EQUAL? ROPE-LIFE,3 \FALSE
	PRINTI "You touch the flame to the rope then pull it back. The rope catches fire and begins to burn."
	CRLF
	CALL PRINT-ID,STR?136
	SET 'ROPE-LIFE,2
	FSET ROPE,ONBIT
	CALL QUEUE,I-ROPE-BURN,2 >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?PULL \?L19
	FSET? BS-SAFE,EVERYBIT /?L19
	PRINTI "You pull on"
	CALL TPRINT,ROPE
	PRINTR " but nothing happens."
?L19:	EQUAL? PRSA,V?TIE \?L20
	PRINT YOU-CANT
	PRINTI " do that. The "
	CALL DPRINT,ROPE
	PRINTI " is already tied to"
	CALL TRPRINT,BS-SAFE
	RTRUE
?L20:	EQUAL? PRSA,V?CLIMB-UP \FALSE
	PRINTR "You climb the rope, almost reaching the safe, then lose your grip and drop to the ground."

	.FUNCT I-ROPE-BURN
	DEC 'ROPE-LIFE
	ZERO? ROPE-LIFE \?L1
	CRLF
	CALL DEQUEUE,I-ROPE-BURN
	CALL BURN-THROUGH-ROPE >STACK
	RSTACK
?L1:	CRLF
	PRINTI "The "
	CALL DPRINT,ROPE
	PRINTI " continues to burn."
	CRLF
	CALL QUEUE,I-ROPE-BURN,-1
	RTRUE

	.FUNCT BURN-THROUGH-ROPE
	EQUAL? HERE,TUNNEL /?L3
	EQUAL? HERE,LEDGE \?L1
?L3:	PRINTI "You hear a crash echo from the bomb shelter."
	CRLF
	JUMP ?L11
?L1:	EQUAL? HERE,BOMB-SHELTER \?L11
	PRINTI "As the flame burns through"
	CALL TPRINT,ROPE
	PRINTI " it snaps and"
	CALL TPRINT,BS-SAFE
	PRINTI " crashes down on"
	CALL TPRINT,LEFT-END
	LOC PLAYER >STACK
	EQUAL? STACK,RIGHT-END \?L5
	PRINTI ". The "
	CALL DPRINT,RIGHT-END
	PRINTI " catapults you up"
	FSET? HATCH,OPENBIT \?L7
	PRINTI " through the opening in the ceiling. The thrilling sensation of flying ends as you land on your feet on a cliff."
	CRLF
	CRLF
	CALL GOTO,CLIFF
	JUMP ?L11
?L7:	CALL PRINT-ID,STR?137
	CALL JIGS-UP,STR?138
	JUMP ?L11
?L5:	LOC PLAYER >STACK
	EQUAL? STACK,LEFT-END \?L10
	CALL PRINT-ID,STR?139
	CALL JIGS-UP,STR?140
	JUMP ?L11
?L10:	PRINTI ". The rope burns up and turns to ashes."
	CRLF
?L11:	FSET BS-SAFE,EVERYBIT
	SET 'ROPE-LIFE,0
	FCLEAR ROPE,ONBIT
	REMOVE ROPE
	SET 'WHICH-END-IS-UP,RIGHT-END
	RETURN WHICH-END-IS-UP

	.FUNCT I-SUNRISE
	FSET? HERE,OUTDOORSBIT /?L3
	GETP HERE,P?CAPACITY >STACK
	EQUAL? STACK,20 \FALSE
?L3:	EQUAL? MOVES,547 \?L4
	CALL QUEUE,I-SUNRISE,10
	CALL DEQUEUE,I-NOISE
	CRLF
	PRINTR "The sun begins to rise over the colony."
?L4:	EQUAL? MOVES,557 \FALSE
	FSET GAME-ROOM,ONBIT
	FSET SHORT-HALL,ONBIT
	FSET OUTSIDE-PARLOR,ONBIT
	FSET FOYER,ONBIT
	FSET LIVING-ROOM,ONBIT
	FSET KITCHEN,ONBIT
	FSET DINING-ROOM,ONBIT
	FSET BEDROOM-1,ONBIT
	FSET BEDROOM-2,ONBIT
	FSET BEDROOM-3,ONBIT
	FSET UPSTAIRS-HALL-EAST,ONBIT
	FSET UPSTAIRS-HALL-MIDDLE,ONBIT
	FSET UPSTAIRS-HALL-WEST,ONBIT
	CRLF
	PRINTR "The sun rises in the sky, signalling a new day in Malibu."

	.FUNCT HOUSE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's dark, but you can make out a stately two-story home with chimneys near the east and west ends of the house. Hardly anything has changed since you were last here several years ago, though you always remember the house as full of life, and now it is deserted and silent."
?L1:	EQUAL? PRSA,V?ENTER \FALSE
	CALL DO-WALK,P?IN >STACK
	RSTACK

	.FUNCT SOUTH-JUNCTION-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	INC 'SOUTH-JUNCTION-VISITS
	RETURN SOUTH-JUNCTION-VISITS

	.FUNCT TO-FRONT-PORCH
	FSET? SOUTH-JUNCTION,EVERYBIT \?L1
	PRINTI "As you walk toward the house, a large black cat scurries across the path, heading toward Johnny Carson's house."
	CRLF
	CRLF
	FCLEAR SOUTH-JUNCTION,EVERYBIT
?L1:	RETURN FRONT-PORCH

	.FUNCT COMPASS-ROSE-PSEUDO
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "The compass rose encircles the base of the statue."

	.FUNCT BAZOOKA-F
	EQUAL? PRSA,V?TURN,V?MOVE,V?PUSH \?L1
	CALL PERFORM,PRSA,BUCK,PRSI
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "The bazooka is pointing to the "
	CALL SAY-BUCK-DIR
	PRINTR "."
?L3:	EQUAL? PRSA,V?SHOOT \FALSE
	PRINTI "It's a stone gun, you geek."
	CRLF
	CALL PRINT-ID,STR?141 >STACK
	RSTACK

	.FUNCT TO-$0026-FROM-SOUTH-JUNCTION,NEW-ROOM
	PRINTI "You follow the stone walkway as it turns "
	EQUAL? HERE,SOUTHEAST-JUNCTION \?L1
	SET 'NEW-ROOM,SOUTH-JUNCTION
	PRINTI "west"
	JUMP ?L7
?L1:	EQUAL? HERE,SOUTHWEST-JUNCTION \?L3
	SET 'NEW-ROOM,SOUTH-JUNCTION
	PRINTI "east"
	JUMP ?L7
?L3:	PRINTI "north"
	EQUAL? PRSO,P?WEST \?L5
	SET 'NEW-ROOM,SOUTHWEST-JUNCTION
	JUMP ?L7
?L5:	SET 'NEW-ROOM,SOUTHEAST-JUNCTION
?L7:	PRINTI " around the corner of the house, arriving at..."
	CRLF
	CRLF
	RETURN NEW-ROOM

	.FUNCT TO-$0026-FROM-TOP-LANDING
	FSET? NORTHEAST-JUNCTION,EVERYBIT \?L1
	FCLEAR NORTHEAST-JUNCTION,EVERYBIT
	PRINTI "As you walk along the path you hear footsteps running south along the stone walkway."
	CRLF
	CRLF
	JUMP ?L3
?L1:	PRINTI "You walk a short distance along the grass path, arriving at..."
	CRLF
	CRLF
?L3:	EQUAL? HERE,NORTHEAST-JUNCTION \?L4
	RETURN TOP-LANDING
?L4:	EQUAL? HERE,TOP-LANDING \FALSE
	RETURN NORTHEAST-JUNCTION

	.FUNCT PATIO-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a large fieldstone patio spanning the entire width of the back of the house. In the daytime you can look out onto Aunt Hildegarde's beautiful garden, said to be the envy of the Malibu colony. This is where Uncle Buddy and Aunt Hildegarde would often entertain.

Standing here you remember the time at one of their parties when you swiped one of Uncle Buddy's big Hollywood cigars and smoked it, then got sick on a rose bush in the garden. You snicker a little bit thinking about that poor rose bush now and the goofy things you did as a child. To the north a stone pathway leads to the garden. Steps lead down off to the east and west, and there is a"
	FSET? PATIO-DOOR,OPENBIT \?L3
	PRINTI "n open"
	JUMP ?L5
?L3:	PRINTI " closed"
?L5:	PRINTI " door to the south."
	RTRUE

	.FUNCT GARDEN-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This garden was Aunt Hildegarde's pride and joy. "
	GRTR? MOVES,535 /?L3
	PRINTI "By the moonlight you can see the outline of"
	JUMP ?L5
?L3:	PRINTI "You can see"
?L5:	PRINTR " dozens of fancy varieties of flowers and shrubs. Several small trees dot the garden, giving shade during the day to the more delicate blossoms. Stone walkways lead through the garden. A stone wall surrounds the garden with entrances north and south."
?L1:	EQUAL? PRSA,V?ENTER \FALSE
	PRINTR "You can only enter the garden from the north or south of the garden."

	.FUNCT GARDEN-WALLS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The stone wall surrounds the entire garden, with entrances to the north and south of the garden."
?L1:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON,V?CLIMB /?L4
	EQUAL? PRSA,V?CLIMB-OVER \FALSE
?L4:	PRINTI "Aunt Hildegarde would paddle your fanny if she saw you do that."
	CRLF
	CALL PRINT-ID,STR?142 >STACK
	RSTACK

	.FUNCT ROSE-BUSH-PSEUDO
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "You remember this rose bush from many summers ago. It's the one you got sick on after smoking one of Uncle Buddy's cigars."
?L1:	EQUAL? PRSA,V?SMELL \?L3
	PRINTR "No doubt the fragrance would be sweeter had you not thrown-up on it many years ago."
?L3:	EQUAL? PRSA,V?WATER \FALSE
	PRINTI "Driven by guilt, you splash some water on the bush. It looks better already."
	CRLF
	CALL PRINT-ID,STR?143 >STACK
	RSTACK

	.FUNCT FLORAL-PSEUDO
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's the lovely flora you would expect in Aunt Hildegarde's reknowned garden."
?L1:	EQUAL? PRSA,V?SMELL \FALSE
	PRINTR "Hmmm. What a lovely scent."

	.FUNCT POND-F
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,POND \?L1
	PRINTI "You drop"
	CALL TPRINT,PRSO
	PRINTI " in"
	CALL TPRINT,POND
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,5 \?L3
	PRINTI " with a splash"
?L3:	PRINTI "."
	MOVE PRSO,POND
	CALL ALL-WET,PRSO
	CALL BLOW-OUT-ALL-IN,PRSO,STR?144
	EQUAL? PRSO,BUCKET \?L6
	FIRST? PRSO >STACK \?L6
	CALL ROB,BUCKET,POND
	PRINTI " The contents of the bucket sink to the bottom of the shallow pond."
?L6:	EQUAL? PRSO,FLASHLIGHT \?L9
	FSET? FLASHLIGHT,ONBIT \?L9
	FCLEAR FLASHLIGHT,ONBIT
	FSET FLASHLIGHT,WETBIT
	PRINTI " The flashlight goes out."
?L9:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?ENTER \?L12
	PRINTI "How soon they forget. Don't you remember the summer Aunt Hildegarde caught you wading in the pond and paddled your behind?"
	CRLF
	CALL PRINT-ID,STR?145 >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT BLOW-OUT-ALL-IN,OBJ,STR=0
	ZERO? STR \?L1
	SET 'STR,STR?146
?L1:	ZERO? OBJ /TRUE
?L6:	FSET? OBJ,FLAMEBIT \?L15
	FCLEAR OBJ,FLAMEBIT
	FCLEAR OBJ,ONBIT
	PRINTI " The "
	CALL DPRINT,OBJ
	PRINTI " goes out"
	PRINT STR
	PRINTI "."
	EQUAL? OBJ,RED-CANDLE \?L11
	CALL STOP-RED-BURNING
	JUMP ?L15
?L11:	EQUAL? OBJ,WHITE-CANDLE \?L13
	CALL STOP-WHITE-BURNING
	JUMP ?L15
?L13:	EQUAL? OBJ,BLUE-CANDLE \?L14
	CALL STOP-BLUE-BURNING
	JUMP ?L15
?L14:	EQUAL? OBJ,GREEN-MATCH,RED-MATCH \?L15
	CALL DEQUEUE,I-MATCH-BURN
?L15:	FIRST? OBJ >STACK \?L18
	FIRST? OBJ >STACK /?L20
?L20:	CALL BLOW-OUT-ALL-IN,STACK,STR
?L18:	NEXT? OBJ >OBJ /?L6
	RTRUE

	.FUNCT TO-$0026-FROM-CANNON,NEW-ROOM
	PRINTI "You follow the walkway as it turns "
	EQUAL? HERE,NORTHWEST-JUNCTION \?L1
	SET 'NEW-ROOM,CANNON-EMPLACEMENT
	PRINTI "east"
	JUMP ?L7
?L1:	EQUAL? HERE,NORTHEAST-JUNCTION \?L3
	SET 'NEW-ROOM,CANNON-EMPLACEMENT
	PRINTI "west"
	JUMP ?L7
?L3:	PRINTI "south"
	EQUAL? PRSO,P?WEST \?L5
	SET 'NEW-ROOM,NORTHWEST-JUNCTION
	JUMP ?L7
?L5:	SET 'NEW-ROOM,NORTHEAST-JUNCTION
?L7:	PRINTI " around the hedge leading to..."
	CRLF
	CRLF
	RETURN NEW-ROOM

	.FUNCT CANNON-EMPLACEMENT-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a cannon emplacement complete with a Civil War-style cannon and a neatly stacked pyramid of cannon balls. During the day this area affords a spectacular view of the coastline. Stone walkways lead east and west, and a steep path leads down."
	RTRUE

	.FUNCT TO-CLIFF
	FSET? SKIS,WORNBIT \?L1
	CALL PRINT-ID,STR?147
	CALL JIGS-UP,STR?148 >STACK
	RSTACK
?L1:	PRINTI "You attempt to walk down, but end up sliding most of the way to a cliff below."
	CRLF
	CRLF
	RETURN CLIFF

	.FUNCT CLIFF-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This cliff affords the same spectacular view as from the cannon emplacement above. Far below you and stretching east, are the white sands of a beach"
	GRTR? MOVES,535 /?L3
	PRINTI ", illuminated by the moon's glow"
?L3:	PRINTI ". You can hear the faint sound of waves lapping at the shore. Nearby in the ground is a"
	FSET? HATCH,OPENBIT \?L6
	PRINTI "n open hatch, forming a hole which leads down."
	RTRUE
?L6:	PRINTI " closed hatch."
	RTRUE

	.FUNCT CLIFF-PSEUDO
	EQUAL? PRSA,V?LEAP \FALSE
	CALL PRINT-ID,STR?149
	CALL JIGS-UP,STR?150 >STACK
	RSTACK

	.FUNCT TO-CANNON-EMPLACEMENT
	PRINTI "You slip and slide in the loose rock, "
	CALL ULTIMATELY-IN?,LADDER >STACK
	ZERO? STACK /?L1
	PRINTI "unable to climb up the cliff because of the weight of the ladder."
	CRLF
	RFALSE
?L1:	PRINTI "but manage to make your way up to the cannon emplacement."
	CRLF
	CRLF
	RETURN CANNON-EMPLACEMENT

	.FUNCT TO-$0026-FROM-BOMB-SHELTER
	FSET? HATCH,OPENBIT /?L12
	PRINT YOU-CANT
	PRINTI "go through the closed hatch."
	CRLF
	RFALSE
?L12:	FSET? SKIS,WORNBIT \?L3
	PRINTI "You can't fit through the opening wearing the skis."
	CRLF
	RFALSE
?L3:	FSET? LADDER,EVERYBIT \?L4
	EQUAL? HERE,BOMB-SHELTER \?L5
	PRINTI "You climb up the ladder to the cliff."
	CRLF
	CRLF
	MOVE LADDER,CLIFF
	RETURN CLIFF
?L5:	PRINTI "You climb down the ladder to the bomb shelter."
	CRLF
	CRLF
	MOVE LADDER,BOMB-SHELTER
	RETURN BOMB-SHELTER
?L4:	EQUAL? HERE,BOMB-SHELTER \?L9
	PRINTI "You'll have to figure that out for yourself."
	CRLF
	RFALSE
?L9:	PRINTI "You drop into the hole, managing to land on your feet."
	CRLF
	CRLF
	RETURN BOMB-SHELTER

	.FUNCT LADDER-F
	EQUAL? HERE,CLIFF \?L1
	FSET? LADDER,EVERYBIT \?L1
	FSET? HATCH,OPENBIT /?L1
	CALL CANT-SEE-ANY,LADDER
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "This straight ladder is made of heavy-duty steel bars. It resembles a ladder you might find on a fire escape."
?L3:	EQUAL? PRSA,V?UNTIE,V?TAKE \?L4
	FSET? LADDER,EVERYBIT \?L4
	EQUAL? HERE,CLIFF \?L5
	PRINTR "It's too heavy to lift out of the hole."
?L5:	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	FCLEAR LADDER,EVERYBIT
	PRINTR "Taken."
?L4:	EQUAL? PRSA,V?HANG-UP \?L11
	EQUAL? HERE,BOMB-SHELTER \?L11
	ZERO? PRSI \?L11
	CALL PERFORM,V?HANG-UP,LADDER,HOOKS
	RTRUE
?L11:	EQUAL? PRSA,V?CLIMB-DOWN,V?CLIMB,V?CLIMB-UP \FALSE
	FSET? LADDER,EVERYBIT \?L13
	EQUAL? HERE,CLIFF \?L15
	EQUAL? PRSA,V?CLIMB-UP \?L17
	PRINTR "The ladder only leads down, through the open hatch."
?L17:	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L15:	EQUAL? PRSA,V?CLIMB-DOWN \?L21
	PRINTR "The ladder only leads up, through the open hatch."
?L21:	CALL DO-WALK,P?UP >STACK
	RSTACK
?L13:	CALL ULTIMATELY-IN?,LADDER >STACK
	ZERO? STACK /?L24
	PRINTR "You're holding the ladder!"
?L24:	PRINTR "You can't climb a ladder that's lying down."

	.FUNCT HOOKS-F
	EQUAL? PRSA,V?TIE,V?PUT-ON,V?HANG-UP \FALSE
	EQUAL? PRSO,LADDER \?L3
	PRINTI "You hang the ladder from"
	CALL TRPRINT,HOOKS
	MOVE LADDER,HERE
	FSET LADDER,NDESCBIT
	FSET LADDER,EVERYBIT
	RTRUE
?L3:	PRINTR "You can't reach the hooks."

	.FUNCT HATCH-HOLE-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	PRINTI "The hole is about the size of a manhole"
	EQUAL? HERE,CLIFF \?L8
	PRINTI ". The "
	CALL DPRINT,HATCH-HOLE
	PRINTI " descends down into "
	CALL LIT?,BOMB-SHELTER >STACK
	ZERO? STACK /?L5
	PRINTI "the bomb shelter"
	JUMP ?L7
?L5:	PRINTI "darkness"
?L7:	FSET? LADDER,EVERYBIT \?L8
	PRINTI ". A "
	CALL DPRINT,LADDER
	PRINTI " in the hole leads down"
?L8:	PRINTR "."
?L1:	EQUAL? PRSA,V?ENTER \?L12
	EQUAL? HERE,CLIFF \?L13
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L13:	PRINTR "You can't reach it."
?L12:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? HERE,CLIFF \FALSE
	EQUAL? PRSI,HATCH-HOLE \FALSE
	PRINTI "You drop"
	CALL TPRINT,PRSO
	PRINTI " in"
	CALL TPRINT,HATCH-HOLE
	PRINTI " and a second later hear it hit the ground."
	CRLF
	EQUAL? PRSO,BLUE-CANDLE,WHITE-CANDLE,RED-CANDLE \?L17
	FSET? PRSO,FLAMEBIT \?L17
	CALL BLOW-OUT-CANDLE,PRSO
?L17:	EQUAL? PRSO,FINCH \?L23
	FSET? FINCH,EVERYBIT \?L22
?L23:	CALL ULTIMATELY-IN?,FINCH,PRSO >STACK
	ZERO? STACK /?L20
	FSET? FINCH,EVERYBIT /?L20
?L22:	CALL BREAK-FINCH,1
?L20:	MOVE PRSO,BOMB-SHELTER
	RTRUE

	.FUNCT PILE-OF-BALLS-F
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?TAKE,V?EXAMINE \?L3
	IN? CANNON-BALL,PILE-OF-BALLS /?L6
	FIRST? PILE-OF-BALLS >STACK /FALSE
?L6:	PRINTI "The pile of cannon balls appears to be strictly ornamental. All of the balls are welded together"
	IN? CANNON-BALL,PILE-OF-BALLS \?L7
	PRINTI ", except for the ball on the top of the pile"
?L7:	PRINTR "."
?L3:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	PRINT YOU-CANT
	PRINTI "look under"
	CALL TRPRINT,PILE-OF-BALLS
	RTRUE

	.FUNCT GENERIC-BALL-F
	RETURN CANNON-BALL

	.FUNCT FUSE-F,OBJ,FLAME
	EQUAL? PRSA,V?LAMP-ON,V?BURN \?L1
	CALL SET-FLAME-SOURCE >STACK
	ZERO? STACK \TRUE
	FSET? PRSI,FLAMEBIT /?L5
	FSET? PRSI,BURNBIT \?L6
	PRINTI "You'll have to light"
	CALL TPRINT,PRSI
	PRINTR " first."
?L6:	PRINTI "You can't light"
	CALL TPRINT,PRSO
	PRINTI " with"
	CALL ARPRINT,PRSI
	RTRUE
?L5:	REMOVE FUSE
	FIRST? CANNON >OBJ /?L10
?L10:	PRINTI "You touch the flame to"
	CALL TPRINT,FUSE
	PRINTI " and it sizzles. A second later"
	CALL TPRINT,CANNON
	PRINTI " fires"
	ZERO? OBJ \?L11
	PRINTR " with a bang."
?L11:	IN? CANNON-BALL,CANNON \?L14
	FSET CANNON,EVERYBIT
	REMOVE CANNON-BALL
	PRINTI ", pushing it back a couple of feet. "
?L14:	IN? FLASHLIGHT,CANNON \?L17
	FCLEAR FLASHLIGHT,ONBIT
?L17:	IN? RED-CANDLE,CANNON \?L20
	FCLEAR RED-CANDLE,FLAMEBIT
	FCLEAR RED-CANDLE,ONBIT
	CALL STOP-RED-BURNING
?L20:	IN? WHITE-CANDLE,CANNON \?L23
	FCLEAR WHITE-CANDLE,FLAMEBIT
	FCLEAR WHITE-CANDLE,ONBIT
	CALL STOP-WHITE-BURNING
?L23:	IN? BLUE-CANDLE,CANNON \?L26
	FCLEAR BLUE-CANDLE,FLAMEBIT
	FCLEAR BLUE-CANDLE,ONBIT
	CALL STOP-BLUE-BURNING
?L26:	FSET? CANNON,EVERYBIT \?L29
	PRINTI "The "
	CALL DPRINT,CANNON-BALL
	FIRST? CANNON >STACK \?L34
	PRINTI " and pieces of"
	CALL CLOSE-ALL-IN,CANNON
	CALL DESCRIBE-CONTENTS,CANNON,-1
	JUMP ?L34
?L29:	FIRST? CANNON >STACK \?L34
	PRINTI " and pieces of"
	CALL CLOSE-ALL-IN,CANNON
	CALL DESCRIBE-CONTENTS,CANNON,-1
?L34:	PRINTI " fl"
	FIRST? CANNON >STACK \?L36
	PRINTI "y"
	JUMP ?L38
?L36:	PRINTI "ies"
?L38:	PRINTI " from"
	CALL TPRINT,CANNON
	PRINTI "'s barrel out to sea."
	CRLF
	CALL MOVE-ALL,CANNON >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "It's stuck."

	.FUNCT CLOSE-ALL-IN,CONT,OBJ
	FIRST? CONT >OBJ /?L1
?L1:	FCLEAR OBJ,OPENBIT
	NEXT? OBJ >OBJ /?L1
	RTRUE

	.FUNCT SET-FLAME-SOURCE,FLAME
	ZERO? PRSI \FALSE
	CALL FIND-IN,PLAYER,FLAMEBIT >FLAME
	ZERO? FLAME /?L3
	SET 'PRSI,FLAME
	PRINTI "[with"
	CALL TPRINT,FLAME
	PRINTI "]"
	CRLF
	RFALSE
?L3:	EQUAL? HERE,BEACH \?L4
	SET 'PRSI,FIRE
	PRINTI "[with the fire]"
	CRLF
	RFALSE
?L4:	PRINTI "You have nothing to light"
	CALL TPRINT,PRSO
	PRINTR " with."

	.FUNCT CANNON-F
	EQUAL? PRSA,V?PUSH-TO,V?PUSH,V?TAKE /?L3
	EQUAL? PRSA,V?TURN,V?MOVE,V?PULL /?L3
	EQUAL? PRSA,V?EMPTY,V?LOWER,V?RAISE \?L1
?L3:	EQUAL? PRSO,CANNON \?L1
	PRINTR "The cannon is too heavy for you to move."
?L1:	EQUAL? PRSA,V?SHOOT \?L4
	PRINTR "Try lighting the fuse!"
?L4:	EQUAL? PRSA,V?EXAMINE \?L5
	PRINTI "It's a replica Civil War "
	CALL DPRINT,CANNON
	PRINTI " pointing out to sea. "
	IN? FUSE,CANNON-EMPLACEMENT \?L6
	PRINTI "There is"
	CALL APRINT,FUSE
	PRINTI " sticking up from the cannon. "
?L6:	FSET? CANNON,EVERYBIT /?L9
	PRINTI "One of"
	CALL TPRINT,CANNON
	PRINTI "'s wheels is on top of a small compartment."
	JUMP ?L11
?L9:	PRINTI "Right next to"
	CALL TPRINT,CANNON
	PRINTI " is"
	CALL APRINT,COMPARTMENT
	PRINTI "."
?L11:	PRINTI " The "
	CALL DPRINT,CANNON
	PRINTR " was used in Uncle Buddy's production of ""Dracula Meets the Confederacy."" Uncle Buddy said he always kept it loaded in case those big Hollywood studio types came around."
?L5:	EQUAL? PRSA,V?LAMP-ON,V?BURN \?L12
	CALL PERFORM,V?BURN,FUSE
	RTRUE
?L12:	EQUAL? PRSA,V?PUT \?L13
	EQUAL? PRSO,BUCKET \?L13
	PRINTR "It won't fit in the cannon."
?L13:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT COMPARTMENT-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? CANNON,EVERYBIT /?L1
	CALL PERFORM,V?EXAMINE,COMPARTMENT
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	FSET? CANNON,EVERYBIT /FALSE
	PRINTI "One of"
	CALL TPRINT,CANNON
	PRINTI "'s wheels is on"
	CALL TRPRINT,COMPARTMENT
	RTRUE

	.FUNCT MOVE-OBJ-DOWN
	FSET? PRSO,TAKEBIT \FALSE
	PRINTI "You "
	PRINTB P-PRSA-WORD
	PRINTI " the "
	CALL DPRINT,PRSO
	PRINTI " and it tumbles down the stairs."
	EQUAL? UPSTAIRS-HALL-MIDDLE,HERE \?L3
	MOVE PRSO,FOYER
	RTRUE
?L3:	EQUAL? FRONT-PORCH,HERE \?L5
	MOVE PRSO,SOUTH-JUNCTION
	RTRUE
?L5:	MOVE PRSO,CELLAR
	RTRUE

	.FUNCT DOOR-BELL-F
	EQUAL? PRSA,V?PUSH \FALSE
	PRINTI "The "
	CALL DPRINT,DOOR-BELL
	PRINTI " plays a tune from one of Uncle Buddy's films. You recognize the "
	CALL PICK-ONE,DOOR-BELL-TUNES >STACK
	PRINT STACK
	PRINTR "."""

	.FUNCT SKIS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "They're a large pair of downhill snow skis."
?L1:	EQUAL? PRSA,V?WEAR \FALSE
	EQUAL? HERE,UPPER-BEACH-STAIRS /?L6
	EQUAL? HERE,LOWER-BEACH-STAIRS \?L4
?L6:	PRINTR "You can't put them on while standing on the stairs."
?L4:	EQUAL? HERE,ROOF-1,ROOF-2 \?L7
	CALL PRINT-ID,STR?151
	CALL JIGS-UP,STR?152 >STACK
	RSTACK
?L7:	EQUAL? HERE,INLET,ON-POOL-1,IN-POOL-1 /?L9
	EQUAL? HERE,UNDERPASS-1,UNDERPASS-2,IN-POOL-2 /?L9
	EQUAL? HERE,ON-POOL-2 \?L8
?L9:	PRINT DOG-PADDLE
	CRLF
	RTRUE
?L8:	EQUAL? HERE,CLOSET,SHAFT-BOTTOM,CLOSET-TOP /?L11
	EQUAL? HERE,CHIMNEY-1,CHIMNEY-2,CHIMNEY-3 \?L10
?L11:	PRINTI "The "
	EQUAL? HERE,CLOSET \?L12
	PRINTI "closet"
	JUMP ?L15
?L12:	EQUAL? HERE,CLOSET-TOP,SHAFT-BOTTOM \?L14
	PRINTI "shaft"
	JUMP ?L15
?L14:	PRINTI "chimney"
?L15:	PRINTR " is too small for you to put on the skis."
?L10:	EQUAL? HERE,CRAWL-SPACE-NORTH,CRAWL-SPACE-SOUTH,FIRST-SECRET-ROOM \?L16
	PRINT YOU-CANT
	PRINTR "quite slip into them in this cramped space."
?L16:	LOC PLAYER >STACK
	EQUAL? STACK,RIGHT-END,LEFT-END \FALSE
	PRINT YOU-CANT
	PRINTI "seem to get them on while standing on"
	CALL TRPRINT,PLANK
	RTRUE

	.FUNCT TOP-LANDING-F,ARG
	EQUAL? ARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? PRSO,P?NORTH \FALSE
	SET 'PRSO,P?DOWN
	RFALSE

	.FUNCT TO-BEACH
	FSET? SKIS,WORNBIT \?L1
	CALL SKI-DOWN-STAIRS
	RETURN BEACH
?L1:	EQUAL? HERE,UPPER-BEACH-STAIRS \?L4
	CALL PRINT-ID,STR?153
	CALL JIGS-UP,STR?154 >STACK
	RSTACK
?L4:	PRINTI "You walk down the old, creaking stairs. You stop as you come to a wide gap of missing steps."
	CRLF
	CRLF
	RETURN UPPER-BEACH-STAIRS

	.FUNCT GAP-F
	EQUAL? PRSA,V?CROSS,V?LEAP \?L1
	PRINTI "You leap across the gap "
	RANDOM 100 >STACK
	LESS? 50,STACK /?L3
	PRINTI "and just miss the first step on the other side. For a split second you admire a view of the coastline that few if any have seen before. You then"
	JUMP ?L5
?L3:	PRINTI "and land on the first step. Unfortunately your weight was a bit too much for the step. It squeals with pain then breaks in half, and you"
?L5:	CALL PRINT-ID,STR?155
	CALL JIGS-UP,STR?156 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L6
	PRINTR "Far below are sharp rocks."
?L6:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L7
	EQUAL? PRSI,GAP \?L7
	REMOVE PRSO
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " drops to the rocks below."
?L7:	EQUAL? PRSA,V?ENTER \FALSE
	CALL FROM-LOWER-STAIRS >STACK
	RSTACK

	.FUNCT SKI-DOWN-STAIRS,CANDLE=0,MATCH=0
	EQUAL? HERE,TOP-LANDING \FALSE
	FSET? TOP-LANDING,EVERYBIT \?L3
	FCLEAR TOP-LANDING,EVERYBIT
	ADD SCORE,10 >SCORE
?L3:	PRINTI "You shuffle over the edge of the landing, and quickly gain momentum as you sail down the stairs."
	CALL FIND-IN,PLAYER,FLAMEBIT >STACK
	ZERO? STACK /?L42
	IN? RED-CANDLE,PLAYER \?L8
	FSET? RED-CANDLE,FLAMEBIT \?L8
	INC 'CANDLE
	CALL BLOW-OUT-CANDLE,RED-CANDLE,1
?L8:	IN? WHITE-CANDLE,PLAYER \?L11
	FSET? WHITE-CANDLE,FLAMEBIT \?L11
	INC 'CANDLE
	CALL BLOW-OUT-CANDLE,WHITE-CANDLE,1
?L11:	IN? BLUE-CANDLE,PLAYER \?L14
	FSET? BLUE-CANDLE,FLAMEBIT \?L14
	INC 'CANDLE
	CALL BLOW-OUT-CANDLE,BLUE-CANDLE,1
?L14:	EQUAL? CANDLE,1,2,3 \?L17
	PRINTI " The candle"
	EQUAL? CANDLE,2,3 \?L19
	PRINTI "s"
?L19:	PRINTI " in your hand blow"
	EQUAL? CANDLE,1 \?L22
	PRINTI "s"
?L22:	PRINTI " out."
?L17:	IN? RED-MATCH,PLAYER \?L26
	FSET? RED-MATCH,FLAMEBIT \?L26
	INC 'MATCH
	FCLEAR RED-MATCH,ONBIT
	FCLEAR RED-MATCH,FLAMEBIT
	REMOVE RED-MATCH
	CALL DEQUEUE,I-MATCH-BURN
?L26:	IN? GREEN-MATCH,PLAYER \?L29
	FSET? GREEN-MATCH,FLAMEBIT \?L29
	INC 'MATCH
	FCLEAR GREEN-MATCH,ONBIT
	FCLEAR GREEN-MATCH,FLAMEBIT
	REMOVE GREEN-MATCH
	CALL DEQUEUE,I-MATCH-BURN
?L29:	EQUAL? MATCH,1,2 \?L42
	PRINTI " The match"
	EQUAL? MATCH,2 \?L34
	PRINTI "s"
?L34:	PRINTI " in your hand blow"
	EQUAL? MATCH,1 \?L37
	PRINTI "s"
?L37:	PRINTI " out and you drop "
	EQUAL? MATCH,1 \?L40
	PRINTI "it."
	JUMP ?L42
?L40:	PRINTI "them."
?L42:	PRINTI " Ahead of you is the gap in the stairs. Racing into the gap, your skis bow slightly, but your forward momentum pulls you across the gap. You hit the landing at the bottom of the stairs but don't stop. You continue down a short flight of stairs then sail onto the sandy beach. You quickly stop with the drag of the sand and a feeble attempt to snow plow."
	CRLF
	CRLF
	RTRUE

	.FUNCT FROM-LOWER-STAIRS
	CALL PRINT-ID,STR?157
	CALL JIGS-UP,STR?158
	RFALSE

	.FUNCT WALKWAY-TO-BOAT-DOCK
	PRINTI "You follow the wooden planking as it turns "
	EQUAL? HERE,BOTTOM-LANDING \?L1
	PRINTI "left and enters a cave arriving at..."
	CRLF
	CRLF
	RETURN BOAT-DOCK
?L1:	PRINTI "right and exits the cave arriving at..."
	CRLF
	CRLF
	RETURN BOTTOM-LANDING

	.FUNCT FIRE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's"
	CALL APRINT,FIRE
	PRINTR " in a shallow pit in the sand, probably left here by Morgan Fairchild and a friend earlier in the evening."
?L1:	EQUAL? PRSA,V?RUB,V?MOVE,V?TAKE /?L4
	EQUAL? PRSA,V?LAMP-OFF \?L3
?L4:	PRINTI "You'd burn your hands, and besides, it might upset Morgan."
	CRLF
	CALL PRINT-ID,STR?159 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?POUR \?L5
	REMOVE FIRE
	PRINTR "With the skill of a seasoned firefighter, you extinguish the fire."
?L5:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L6
	CALL PERFORM,V?BURN,PRSO,FIRE
	RTRUE
?L6:	EQUAL? PRSA,V?ENTER \?L7
	PRINT PYRO
	RTRUE
?L7:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT SAND-F
	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "It slips through your hands."

	.FUNCT CLOSET-HOLE-PSEUDO
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSO,PEG-0 \?L3
	ADD SCORE,10 >SCORE
	CALL ROB,PLAYER,HEART-OF-MAZE
	FSET? RING,WORNBIT \?L5
	MOVE RING,PLAYER
?L5:	FSET? TOUPEE,WORNBIT \?L8
	MOVE TOUPEE,PLAYER
?L8:	FSET? MASK,WORNBIT \?L11
	MOVE MASK,PLAYER
?L11:	CALL DEQUEUE,I-SANDS-OF-TIME
	CALL DEQUEUE,I-NOISE
	CALL QUEUE,I-AUNT,2
	PRINTI "You put"
	CALL TPRINT,PEG-0
	PRINTI " in the hole and the closet door slams shut. Without warning, the floor drops out from under you! You fall for several seconds then land with a bone-crunching thud, dropping everything you're holding. You slide down a twisting, slippery slide and are dumped into a room filled with props.

You look around the room and can't believe what your eyes are seeing. There is Aunt Hildegarde! She's tied to the conveyor belt of a whirling buzz saw and a man is standing over her. Aunt Hildegarde sees you and screams. The man turns and you immediately recognize your childhood nemesis: Cousin Herman."
	CRLF
	CRLF
	CALL QUEUE,I-HERMAN-ATTACK,2
	CALL GOTO,PROP-VAULT >STACK
	RSTACK
?L3:	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " won't fit in the hole."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "You see nothing but darkness."

	.FUNCT CLOSET-F,RARG,DOOR
	EQUAL? RARG,M-LOOK \FALSE
	CALL WHICH-DOOR? >DOOR
	PRINTI "You're in a small closet. Mounted at an angle on the back wall of the closet are three coat pegs. To the left of the first peg there is a hole the size of a peg. To the right of the third peg there is a peg which has been sawed-off, flush with the wall. The door to the north is "
	FSET? DOOR,OPENBIT \?L3
	PRINTI "open"
	JUMP ?L5
?L3:	PRINTI "closed"
?L5:	PRINTI "."
	RTRUE

	.FUNCT PEG-5-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's what's left of a coat peg. It looks as if someone sawed off the peg."
?L1:	EQUAL? PRSA,V?PULL \FALSE
	PRINTR "There's nothing to pull -- it's sawed-off."

	.FUNCT CLOSET-EXIT-F,DOOR
	CALL WHICH-DOOR? >DOOR
	FSET? DOOR,OPENBIT /?L1
	CALL THIS-IS-IT,DOOR
	CALL ITS-CLOSED,DOOR
	RFALSE
?L1:	EQUAL? CLOSET-FLOOR,CELLAR \?L3
	RETURN CELLAR
?L3:	EQUAL? CLOSET-FLOOR,FOYER \?L4
	RETURN FOYER
?L4:	RETURN UPSTAIRS-HALL-MIDDLE

	.FUNCT WHICH-DOOR?
	EQUAL? HERE,CLOSET \?L1
	EQUAL? CLOSET-FLOOR,CELLAR \?L3
	RETURN CELLAR-CD
?L3:	EQUAL? CLOSET-FLOOR,FOYER \?L5
	RETURN FOYER-CD
?L5:	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE \?L6
	RETURN UPSTAIRS-CD
?L6:	RETURN ATTIC-CD
?L1:	EQUAL? CLOSET-FLOOR,CELLAR \?L9
	RETURN FOYER-CD
?L9:	EQUAL? CLOSET-FLOOR,FOYER \?L11
	RETURN UPSTAIRS-CD
?L11:	RETURN ATTIC-CD

	.FUNCT PROP-VAULT-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a vault filled with props. You can see Aunt Hildegarde tied to a buzz saw. Cousin Herman is here, thinking of something rotten to do to you. To the east there is a chute."
	RTRUE

	.FUNCT CHUTE-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	PRINTR "The chute leads down into darkness."
?L1:	EQUAL? PRSA,V?ENTER \?L3
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,CHUTE \FALSE
	REMOVE PRSO
	PRINTI "You toss"
	CALL TPRINT,PRSO
	PRINTR " in the chute."

	.FUNCT TO-CHUTE
	ZERO? HERMAN-DOWN /?L1
	PRINTI "Haven't you forgotten something?"
	CRLF
	RFALSE
?L1:	PRINTI "Cousin Herman jumps in front of the chute then punches you in the stomach."
	CRLF
	CALL PRINT-ID,STR?160
	RFALSE

	.FUNCT CLOSET-REF-F
	EQUAL? PRSA,V?SEARCH,V?ENTER,V?LOOK-INSIDE \?L1
	EQUAL? HERE,CLOSET-TOP \?L1
	PRINTR "You can't enter the closet from here."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L3
	EQUAL? HERE,CLOSET \?L3
	CALL V-LOOK >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?SEARCH,V?LOOK-INSIDE \?L4
	EQUAL? HERE,CLOSET /?L4
	EQUAL? CLOSET-FLOOR,HERE \?L5
	PRINTR "You'll have to enter the closet first."
?L5:	PRINTR "You see an empty shaft."
?L4:	EQUAL? PRSA,V?SEARCH \?L8
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RTRUE
?L8:	EQUAL? PRSA,V?OPEN \?L9
	EQUAL? HERE,CLOSET \?L10
	CALL WHICH-DOOR? >STACK
	JUMP ?L15
?L10:	EQUAL? HERE,FOYER \?L12
	PUSH FOYER-CD
	JUMP ?L15
?L12:	EQUAL? HERE,UPSTAIRS-HALL-MIDDLE \?L13
	PUSH UPSTAIRS-CD
	JUMP ?L15
?L13:	EQUAL? HERE,CELLAR \?L14
	PUSH CELLAR-CD
	JUMP ?L15
?L14:	PUSH ATTIC-CD
?L15:	CALL PERFORM,V?OPEN,STACK
	RTRUE
?L9:	EQUAL? PRSA,V?CLOSE \?L16
	EQUAL? HERE,CLOSET \?L17
	CALL WHICH-DOOR? >STACK
	JUMP ?L22
?L17:	EQUAL? HERE,FOYER \?L19
	PUSH FOYER-CD
	JUMP ?L22
?L19:	EQUAL? HERE,UPSTAIRS-HALL-MIDDLE \?L20
	PUSH UPSTAIRS-CD
	JUMP ?L22
?L20:	EQUAL? HERE,CELLAR \?L21
	PUSH CELLAR-CD
	JUMP ?L22
?L21:	PUSH ATTIC-CD
?L22:	CALL PERFORM,V?CLOSE,STACK
	RTRUE
?L16:	EQUAL? PRSA,V?EXIT,V?DISEMBARK \?L23
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L23:	EQUAL? PRSA,V?ENTER \FALSE
	EQUAL? HERE,CLOSET \?L25
	PRINTR "Look around."
?L25:	CALL DO-WALK,P?IN >STACK
	RSTACK

	.FUNCT PEGS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "There are three pegs mounted at an angle to the wall. To the left of the first peg is a hole the size of a peg. To the right of the third peg you can see where a peg has been sawed-off, flush with the wall."
?L1:	EQUAL? PRSA,V?PUSH,V?PULL,V?MOVE /?L4
	EQUAL? PRSA,V?PUSH-DOWN,V?LOWER \FALSE
?L4:	PRINTR "You try to pull down all three pegs at once. They won't budge, but the closet makes a grinding noise."

	.FUNCT PEG-F
	EQUAL? PRSA,V?PUSH,V?PULL,V?MOVE /?L3
	EQUAL? PRSA,V?PUSH-DOWN,V?LOWER \?L1
?L3:	EQUAL? PRSO,BUCKET-PEG \?L4
	FSET? BUCKET,EVERYBIT \?L4
	PRINTI "The bucket is already holding"
	CALL TPRINT,PRSO
	PRINTR " down."
?L4:	PRINTI "You pull the peg down to a horizontal position."
	FSET? BUCKET,EVERYBIT \?L7
	PRINTI " You hear a grinding noise."
?L7:	CRLF
	CRLF
	PRINTI "As you release the peg, it pops back into its original 45-degree position."
	FSET? BUCKET,EVERYBIT \?L10
	CRLF
	RTRUE
?L10:	PRINTI " "
	CALL ELEVATOR-OPERATOR,PRSO >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?HANG-UP \?L13
	EQUAL? PRSI,PEG-3,PEG-2,PEG-1 \?L13
	EQUAL? PRSO,BUCKET /?L13
	MOVE PRSO,HERE
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " slips off and falls to the floor."
?L13:	EQUAL? PRSA,V?EXAMINE \FALSE
	FSET? BUCKET,EVERYBIT \?L15
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " is in a horizontal position with a bucket hanging on it."
?L15:	EQUAL? PRSO,BUCKET-PEG \?L17
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " is pointing up at an angle with a bucket hanging on it."
?L17:	PRINTR "You see a worn coat peg mounted at an angle."

	.FUNCT PEG-0-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a worn coat peg."

	.FUNCT ELEVATOR-OPERATOR,PEG
	EQUAL? HERE,FOYER,CELLAR,UPSTAIRS-HALL-MIDDLE /?L3
	EQUAL? HERE,ATTIC,SHAFT-BOTTOM \?L1
?L3:	PRINTI "The closet door swings shut by itself."
	CRLF
?L1:	EQUAL? PEG,PEG-1 \?L8
	EQUAL? CLOSET-FLOOR,CELLAR /?L7
?L8:	EQUAL? PEG,PEG-2 \?L9
	EQUAL? CLOSET-FLOOR,FOYER /?L7
?L9:	EQUAL? PEG,PEG-3 \?L5
	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE \?L5
?L7:	EQUAL? HERE,CLOSET,CLOSET-TOP \?L63
	EQUAL? HERE,CLOSET \?L12
	CALL WHICH-DOOR? >STACK
	FSET? STACK,OPENBIT \?L14
	PRINTI "The closet door swings shut and you"
	JUMP ?L20
?L14:	PRINTI "You"
	JUMP ?L20
?L12:	CALL WHICH-DOOR? >STACK
	FSET? STACK,OPENBIT \?L18
	PRINTI "The shaft door swings shut and you"
	JUMP ?L20
?L18:	PRINTI "You"
?L20:	PRINTI " feel the closet"
	EQUAL? HERE,CLOSET /?L21
	PRINTI " ceiling"
?L21:	PRINTI " vibrate, then stop."
	CRLF
	JUMP ?L63
?L5:	EQUAL? HERE,CLOSET,CLOSET-TOP \?L26
	EQUAL? HERE,CLOSET /?L28
	CRLF
?L28:	PRINTI "The closet "
	EQUAL? HERE,CLOSET-TOP \?L31
	PRINTI "ceiling "
?L31:	PRINTI "begins to shake and rattle a bit"
	EQUAL? HERE,CLOSET,CLOSET-TOP \?L34
	CALL WHICH-DOOR? >STACK
	FSET? STACK,OPENBIT \?L34
	PRINTI " as the door swings shut"
?L34:	PRINTI ". You feel your stomach "
	EQUAL? PEG,PEG-3 \?L37
	PRINTI "drop to your knees as the closet "
	EQUAL? HERE,CLOSET /?L39
	PRINTI "moves up. You enter the top of the shaft, then the closet stops."
	CRLF
	CRLF
	CALL GOTO,CLOSET-TOP
	JUMP ?L63
?L39:	PRINTI "moves up, then stops."
	CRLF
	JUMP ?L63
?L37:	EQUAL? PEG,PEG-2 \?L49
	EQUAL? CLOSET-FLOOR,CELLAR \?L42
	PRINTI "drop to your knees as the closet "
	EQUAL? HERE,CLOSET /?L43
	PRINTI "floor "
?L43:	PRINTI "moves up, then stops."
	CRLF
	EQUAL? HERE,CLOSET /?L63
	CRLF
	CALL GOTO,CLOSET-TOP
	JUMP ?L63
?L42:	EQUAL? PEG,PEG-2 \?L49
	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE \?L49
	PRINTI "rising to your throat as the closet "
	EQUAL? HERE,CLOSET /?L50
	PRINTI "floor "
?L50:	PRINTI "moves down, then stops."
	CRLF
	EQUAL? HERE,CLOSET /?L63
	CRLF
	CALL GOTO,CLOSET-TOP
	JUMP ?L63
?L49:	PRINTI "rising to your throat as the closet "
	EQUAL? HERE,CLOSET /?L57
	PRINTI "floor "
?L57:	PRINTI "moves down, then stops."
	CRLF
	EQUAL? HERE,CLOSET /?L63
	CRLF
	CALL GOTO,CLOSET-TOP
	JUMP ?L63
?L26:	EQUAL? HERE,SHAFT-BOTTOM \?L63
	EQUAL? PEG,PEG-1 \?L65
	CALL PRINT-ID,STR?161
	CALL JIGS-UP,STR?162
?L63:	EQUAL? PEG,PEG-1 \?L65
	SET 'CLOSET-FLOOR,CELLAR
	JUMP ?L68
?L65:	EQUAL? PEG,PEG-2 \?L67
	SET 'CLOSET-FLOOR,FOYER
	JUMP ?L68
?L67:	SET 'CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE
?L68:	FCLEAR ATTIC-CD,OPENBIT
	FCLEAR UPSTAIRS-CD,OPENBIT
	FCLEAR FOYER-CD,OPENBIT
	FCLEAR CELLAR-CD,OPENBIT
	RTRUE

	.FUNCT BUCKET-F,OARG=0,FULL?=0
	IN? PORTABLE-WATER,BUCKET /?L1
	SET 'FULL?,0
	JUMP ?L2
?L1:	SET 'FULL?,1
?L2:	ZERO? OARG /?L3
	ZERO? BUCKET-PEG /FALSE
	EQUAL? OARG,M-OBJDESC? /TRUE
	CRLF
	PRINTI "A "
	PRINTD BUCKET
	PRINTI " is hanging from"
	CALL TPRINT,BUCKET-PEG
	IN? PORTABLE-WATER,BUCKET \?L10
	PRINTI ". The bucket "
	CALL DESCRIBE-WATER-LEVEL
?L10:	PRINTI "."
	RTRUE
?L3:	EQUAL? PRSA,V?HANG-UP,V?PUT-ON \?L14
	EQUAL? PRSI,PEG-3,PEG-2,PEG-1 \?L14
	SET 'BUCKET-PEG,PRSI
	FSET BUCKET,TRYTAKEBIT
	MOVE BUCKET,HERE
	IN? PORTABLE-WATER,BUCKET \?L21
	FSET PORTABLE-WATER,NDESCBIT
	IN? PORTABLE-WATER,BUCKET \?L21
	GRTR? AMOUNT-OF-WATER,10 /?L20
?L21:	CALL WEIGHT,BUCKET >STACK
	GRTR? STACK,20 \?L18
?L20:	FSET BUCKET,EVERYBIT
	PRINTI "As you hang"
	CALL TPRINT,BUCKET
	PRINTI " on"
	CALL TPRINT,PRSI
	PRINTR ", the peg lowers to a horizontal position and you feel the closet begin to vibrate."
?L18:	PRINTI "You hang"
	CALL TPRINT,BUCKET
	PRINTR " on the peg."
?L14:	EQUAL? PRSA,V?TAKE \?L23
	EQUAL? PRSO,BUCKET \?L23
	FSET? BUCKET,TRYTAKEBIT \?L23
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	FSET? BUCKET,WETBIT \?L26
	FCLEAR BUCKET,WETBIT
	MOVE PORTABLE-WATER,BUCKET
	SET 'AMOUNT-OF-WATER,26
	PRINTI "Taken."
	CRLF
	CALL QUEUE,I-DRIP,1 >STACK
	RSTACK
?L26:	FSET? BUCKET,EVERYBIT \?L27
	FCLEAR BUCKET,TRYTAKEBIT
	FCLEAR BUCKET,EVERYBIT
	FCLEAR PORTABLE-WATER,NDESCBIT
	PRINTI "As you remove"
	CALL TPRINT,BUCKET
	PRINTI ","
	CALL TPRINT,BUCKET-PEG
	PRINTI " pops back into its original 45-degree position. "
	CALL ELEVATOR-OPERATOR,BUCKET-PEG
	SET 'BUCKET-PEG,0
	RTRUE
?L27:	FCLEAR BUCKET,TRYTAKEBIT
	FCLEAR PORTABLE-WATER,NDESCBIT
	SET 'BUCKET-PEG,0
	PRINTR "Taken."
?L23:	EQUAL? PRSA,V?EXAMINE,V?SEARCH,V?LOOK-INSIDE \?L29
	PRINTI "It's an old metal bucket which is beginning to rust through on the bottom. It has a rusty handle and "
	IN? PORTABLE-WATER,BUCKET \?L30
	CALL DESCRIBE-WATER-LEVEL
	PRINTR "."
?L30:	FIRST? BUCKET >STACK \?L32
	PRINTI "contains"
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	RTRUE
?L32:	PRINTR "it's empty."
?L29:	ZERO? FULL? /?L37
	EQUAL? PRSA,V?THROW \?L37
	CALL PERFORM,V?DROP,PORTABLE-WATER
	MOVE BUCKET,HERE
	RTRUE
?L37:	EQUAL? PRSA,V?STAND-ON \?L38
	PRINTR "It wouldn't be a very elevating experience."
?L38:	EQUAL? PRSA,V?DRINK-FROM,V?DRINK \?L39
	ZERO? FULL? /?L40
	CALL PERFORM,V?DRINK,WATER
	RTRUE
?L40:	CALL EMPTY-BUCKET >STACK
	RSTACK
?L39:	EQUAL? PRSA,V?EMPTY,V?POUR \?L43
	ZERO? FULL? /?L44
	CALL PERFORM,V?EMPTY,PORTABLE-WATER
	RTRUE
?L44:	CALL EMPTY-BUCKET >STACK
	RSTACK
?L43:	EQUAL? PRSA,V?PUT \?L47
	EQUAL? PRSI,BUCKET \?L47
	ZERO? BUCKET-PEG /?L48
	PRINT PEG-IN-WAY
	RTRUE
?L48:	EQUAL? PRSO,WATER,PORTABLE-WATER \?L50
	CALL PERFORM,V?FILL,BUCKET,WATER
	RTRUE
?L50:	ZERO? FULL? /FALSE
	PRINTI "But"
	CALL TPRINT,PRSO
	PRINTR " would get all wet."
?L47:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT DESCRIBE-WATER-LEVEL
	PRINTI "is "
	GRTR? AMOUNT-OF-WATER,21 \?L1
	PRINTI "full"
	JUMP ?L6
?L1:	GRTR? AMOUNT-OF-WATER,13 \?L3
	PRINTI "more than half full"
	JUMP ?L6
?L3:	GRTR? AMOUNT-OF-WATER,11 \?L4
	PRINTI "about half full"
	JUMP ?L6
?L4:	GRTR? AMOUNT-OF-WATER,3 \?L5
	PRINTI "less than half full"
	JUMP ?L6
?L5:	PRINTI "nearly empty"
?L6:	PRINTI " of water"
	RTRUE

	.FUNCT I-DRIP
	CALL QUEUE,I-DRIP,-1
	DEC 'AMOUNT-OF-WATER
	IN? BUCKET,POND /?L4
	IN? BUCKET,PLAYER \?L1
	EQUAL? HERE,INLET,ON-POOL-1,IN-POOL-1 /?L4
	EQUAL? HERE,UNDERPASS-1,UNDERPASS-2,IN-POOL-2 /?L4
	EQUAL? HERE,ON-POOL-2 \?L1
?L4:	SET 'AMOUNT-OF-WATER,26
	RFALSE
?L1:	ZERO? AMOUNT-OF-WATER \?L5
	FCLEAR PORTABLE-WATER,NDESCBIT
	REMOVE PORTABLE-WATER
	CALL DEQUEUE,I-DRIP
?L5:	CALL VISIBLE?,BUCKET >STACK
	ZERO? STACK /?L7
	ZERO? LIT /?L7
	CRLF
	PRINTI "The water "
	EQUAL? AMOUNT-OF-WATER,25 \?L9
	PRINTI "begin"
	JUMP ?L11
?L9:	PRINTI "continue"
?L11:	PRINTI "s to dribble out of"
	CALL TPRINT,BUCKET
	PRINTI "."
	ZERO? AMOUNT-OF-WATER \?L12
	PRINTI " The bucket is now pretty much empty."
	JUMP ?L14
?L12:	EQUAL? AMOUNT-OF-WATER,6,12,18 \?L14
	PRINTI " The bucket is now around "
	EQUAL? AMOUNT-OF-WATER,18 \?L15
	PRINTI "three-quarters"
	JUMP ?L18
?L15:	EQUAL? AMOUNT-OF-WATER,12 \?L17
	PRINTI "half"
	JUMP ?L18
?L17:	PRINTI "one-quarter"
?L18:	PRINTI " full."
?L14:	CRLF
?L7:	FSET? BUCKET,EVERYBIT \?L21
	LESS? AMOUNT-OF-WATER,10 \?L21
	CALL VISIBLE?,BUCKET >STACK
	ZERO? STACK /?L23
	PRINTI "Suddenly"
	CALL TPRINT,BUCKET-PEG
	PRINTI " pops back into its original 45-degree position. "
?L23:	CALL ELEVATOR-OPERATOR,BUCKET-PEG
	FCLEAR BUCKET,EVERYBIT
	RTRUE
?L21:	CALL VISIBLE?,BUCKET >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT EMPTY-BUCKET,OBJ
	FIRST? BUCKET >OBJ \?L1
	EQUAL? PRSA,V?DRINK-FROM \?L3
	CALL PERFORM,V?DRINK,OBJ
	RTRUE
?L3:	NEXT? OBJ >STACK \?L6
	PRINTI "The contents of the "
	CALL DPRINT,BUCKET
	PRINTI " fall"
	JUMP ?L8
?L6:	PRINTI "Okay,"
	CALL TPRINT,OBJ
	PRINTI " falls"
?L8:	CALL ROB,BUCKET,HERE
	PRINTR " out of it."
?L1:	PRINTR "It's empty."

	.FUNCT NOT-HOLDING-WATER?
	IN? PORTABLE-WATER,BUCKET /FALSE
	PRINTR "You're not carrying any water."

	.FUNCT SHAFT-BOTTOM-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You're standing at the bottom of a shaft. The door to the north is "
	FSET? CELLAR-CD,OPENBIT \?L3
	PRINTI "open"
	JUMP ?L5
?L3:	PRINTI "closed"
?L5:	PRINTI "."
	RTRUE

	.FUNCT CLOSET-TOP-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You're standing in a shaft on top of the closet. The door to the north is "
	CALL WHICH-DOOR? >STACK
	FSET? STACK,OPENBIT \?L3
	PRINTI "open"
	JUMP ?L5
?L3:	PRINTI "closed"
?L5:	PRINTI "."
	RTRUE

	.FUNCT CLOSET-TOP-EXIT,DOOR
	CALL WHICH-DOOR? >DOOR
	FSET? DOOR,OPENBIT /?L1
	CALL THIS-IS-IT,DOOR
	CALL ITS-CLOSED,DOOR
	RFALSE
?L1:	EQUAL? CLOSET-FLOOR,CELLAR \?L3
	RETURN FOYER
?L3:	EQUAL? CLOSET-FLOOR,FOYER \?L4
	RETURN UPSTAIRS-HALL-MIDDLE
?L4:	RETURN ATTIC

	.FUNCT ATTIC-CD-F
	EQUAL? PRSA,V?OPEN \FALSE
	FSET? ATTIC-CD,OPENBIT /FALSE
	EQUAL? CLOSET-FLOOR,ATTIC /FALSE
	EQUAL? HERE,ATTIC \FALSE
	CALL OPEN-DOOR-TO-SHAFT
	FSET ATTIC-CD,OPENBIT
	RTRUE

	.FUNCT ATTIC-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a dusty old attic with cobwebs hanging from the ceiling rafters. The attic is empty except for"
	CALL APRINT,TRUNK
	FSET? ATTIC-DOOR,OPENBIT \?L3
	PRINTI ". A ladder leads down through an opening"
	JUMP ?L5
?L3:	PRINTI " and a folding ladder attached to a panel"
?L5:	PRINTI " in the floor. To the south there is a"
	FSET? ATTIC-CD,OPENBIT \?L6
	PRINTI "n open"
	JUMP ?L8
?L6:	PRINTI " closed"
?L8:	PRINTI " door."
	RTRUE

	.FUNCT TO-$0026-FROM-ATTIC
	FSET? ATTIC-DOOR,OPENBIT \?L1
	FSET? SKIS,WORNBIT \?L3
	PRINTI "You can't fit through the opening wearing the skis."
	CRLF
	RFALSE
?L3:	EQUAL? HERE,ATTIC \?L6
	RETURN UPSTAIRS-HALL-MIDDLE
?L6:	RETURN ATTIC
?L1:	PRINTI "The "
	CALL DPRINT,ATTIC-DOOR
	PRINTI " is closed."
	CRLF
	RFALSE

	.FUNCT ATTIC-CLOSET-ENTER-F
	FSET? ATTIC-CD,OPENBIT /?L1
	CALL ITS-CLOSED,ATTIC-CD
	RFALSE
?L1:	EQUAL? CLOSET-FLOOR,UPSTAIRS-HALL-MIDDLE \?L3
	RETURN CLOSET-TOP
?L3:	EQUAL? CLOSET-FLOOR,FOYER \?L4
	PRINTI "You enter the shaft and plunge down a floor. A bit shaken, you find yourself at..."
	CRLF
	CRLF
	RETURN CLOSET-TOP
?L4:	CALL PRINT-ID,STR?163
	CALL JIGS-UP,STR?164 >STACK
	RSTACK

	.FUNCT TRUNK-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? TRUNK,EVERYBIT \?L1
	PRINTR "It won't budge."
?L1:	EQUAL? PRSA,V?MOVE,V?TAKE \FALSE
	EQUAL? PRSO,TRUNK \FALSE
	PRINT SPINACH
	CRLF
	RTRUE

	.FUNCT FIRE-HYDRANT-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "Don't you recognize it? It's a prop "
	CALL DPRINT,FIRE-HYDRANT
	PRINTR " from ""Atomic Chihuahuas From Hell."" Uncle Buddy took a lot of heat for that film when two unlikely special interest groups, the Institute for Nuclear Power and the American Chihuahua Breeders Association, joined forces in an effort to have the film banned."

	.FUNCT ATTIC-DOOR-F
	EQUAL? PRSA,V?LOWER,V?OPEN,V?PUSH-DOWN /?L3
	EQUAL? PRSA,V?PUSH,V?PULL \?L1
?L3:	FSET? ATTIC-DOOR,OPENBIT /?L1
	EQUAL? HERE,UPSTAIRS-HALL-MIDDLE \?L4
	PRINTR "It won't budge from this side."
?L4:	FSET ATTIC-DOOR,OPENBIT
	FCLEAR ATTIC-DOOR,LOCKEDBIT
	PRINTI "The panel in the floor drops downward and the ladder unfolds as it swings down into the upstairs hallway."
	FSET? TRUNK,OPENBIT /?L7
	FCLEAR TRUNK,EVERYBIT
	PRINTI " At the same time you hear a click from under"
	CALL TPRINT,TRUNK
	PRINTI "'s lid."
?L7:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	FSET? ATTIC-DOOR,OPENBIT \?L11
	PRINTR "The ladder hangs from an open panel in the ceiling, extended to the floor of the upstairs hallway."
?L11:	EQUAL? HERE,ATTIC \FALSE
	PRINTR "The wooden ladder is folded in thirds, with the first third attached to a panel in the floor."

	.FUNCT AUNT-F
	EQUAL? AUNT,WINNER \?L1
	PRINTI """Shut up and get me off this buzz saw!"""
	CRLF
	CALL PCLEAR >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "She's strapped to the conveyor belt and moving closer to the buzz saw's spinning blade."
?L3:	EQUAL? PRSA,V?CUT \?L4
	EQUAL? PRSI,SWORD \?L4
	CALL PERFORM,V?LAMP-OFF,SAW
	RTRUE
?L4:	EQUAL? PRSA,V?LET-GO,V?RESCUE,V?UNTIE \FALSE
	EQUAL? PRSO,AUNT \FALSE
	CALL PERFORM,V?LAMP-OFF,SAW
	RTRUE

	.FUNCT HERMAN-F
	EQUAL? PRSA,V?TELL /?L3
	EQUAL? PRSA,V?ASK-ABOUT \?L1
	EQUAL? PRSO,HERMAN \?L1
?L3:	PRINTI "Herman never was the talkative type."
	CRLF
	CALL PCLEAR >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?KILL \?L4
	ZERO? PRSI \?L4
	FIRST? PLAYER >STACK \?L5
	PRINTI "[with the "
	FIRST? PLAYER >STACK /?L7
?L7:	CALL DPRINT,STACK
	PRINTI "]"
	CRLF
	FIRST? PLAYER >STACK /?L8
?L8:	CALL PERFORM,V?KILL,HERMAN,STACK
	RTRUE
?L5:	PRINTI "You slug Herman in the gut. It feels good after all these years."
	CRLF
	CALL PRINT-ID,STR?165 >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?PUSH \?L10
	EQUAL? PRSO,HERMAN \?L10
	PRINTR "He pushes you right back."
?L10:	EQUAL? PRSA,V?EXAMINE \?L11
	PRINTR "It's Cousin Herman all right. A little older and a little chubbier. He still wears Batman slip-on tennis shoes."
?L11:	EQUAL? PRSA,V?KICK,V?BITE \FALSE
	PRINTI """%*&@#!,"" shouts Herman at the top of his lungs. You are aghast at Herman's profanity in the presence of your Aunt Hildegarde."
	CRLF
	CALL PRINT-ID,STR?166 >STACK
	RSTACK

	.FUNCT PROP-F,HERMAN-THING,PLAYER-THING
	FIRST? HERMAN >HERMAN-THING /?L1
?L1:	FIRST? PLAYER >PLAYER-THING \?L4
?L5:	EQUAL? PLAYER-THING,TOUPEE,MASK,RING \?L4
	NEXT? PLAYER-THING >PLAYER-THING /?L5
?L4:	EQUAL? PRSA,V?TAKE \?L10
	EQUAL? PRSO,HERMAN-THING \?L12
	PRINTI "You reach for"
	CALL TPRINT,HERMAN-THING
	PRINTI ", but "
	CALL DPRINT,HERMAN
	PRINTI " twists away from you."
	CRLF
	CALL PRINT-ID,STR?167 >STACK
	RSTACK
?L12:	ZERO? PLAYER-THING /?L14
	PRINTI "You're already armed with"
	CALL ARPRINT,PLAYER-THING
	RTRUE
?L14:	CALL PICK-REMOVE,PRSO,PROPS
	RFALSE
?L10:	EQUAL? PRSA,V?THROW,V?SHOOT \?L16
	EQUAL? PRSI,HERMAN \?L16
	CALL PERFORM,V?KILL,HERMAN,PRSO
	RTRUE
?L16:	EQUAL? PRSA,V?CUT,V?KILL \FALSE
	EQUAL? PRSO,HERMAN \FALSE
	INC 'HERMAN-HITS
	ZERO? HERMAN-DOWN /?L18
	CALL DEQUEUE,I-AUNT
	PRINTI "With the hate of all those summers of his bullying built up, you let Herman have it with"
	CALL TPRINT,PLAYER-THING
	PRINTI ", killing him. At the same time you hear a scream not unlike one you would hear in an Uncle Buddy movie. As the tone of the saw blade changes you realize your Aunt Hildegarde has just taken her final bow. You stand and cry for a few minutes remembering the good times with your aunt and wishing you had done more to save her.

Later you find your way out of the prop vault. You go next door to Johnny's and call the police. Unfortunately it never occurred to you that with two dead bodies involved they wouldn't believe your story."
	CRLF
	CALL PRINT-ID,STR?168
	CALL FINISH >STACK
	RSTACK
?L18:	EQUAL? HERMAN-HITS,3 \?L20
	SET 'HERMAN-DOWN,1
	SET 'AUNT-COUNT,6
	CALL QUEUE,I-AUNT,2
	CALL DEQUEUE,I-HERMAN-ATTACK
	PRINTI "You "
	EQUAL? PLAYER-THING,GUN \?L21
	PRINTI "fire"
	CALL TPRINT,GUN
	PRINTI " hitting him in the shoulder."
	JUMP ?L23
?L21:	PRINTI "give it your best, striking Herman."
?L23:	PRINTI " He drops to the ground. (Hmm, guess that wasn't a prop after all.) Slowly, he starts to come to his feet. The saw blade is less than an inch from the blue-gray hairs of Aunt Hildegarde's head!"
	CRLF
	CALL PRINT-ID,STR?169 >STACK
	RSTACK
?L20:	PRINTI "You "
	CALL PRINT-ID,STR?170
	EQUAL? PLAYER-THING,GUN \?L25
	PRINTI "fire"
	CALL TPRINT,GUN
	PRINTI ", blasting Herman with smooth and creamy whipped cream. You toss the gun away in disgust. It sails into the chute."
	CRLF
	JUMP ?L27
?L25:	PRINTI "give it your best, striking Herman. The "
	CALL DPRINT,PLAYER-THING
	PRINTI " breaks into a hundred pieces. It was only a prop."
	CRLF
?L27:	REMOVE PLAYER-THING
	RTRUE

	.FUNCT I-AUNT
	CALL QUEUE,I-AUNT,1
	INC 'AUNT-COUNT
	EQUAL? AUNT-COUNT,7 \?L1
	CRLF
	PRINTI "You hear what sounds like an old woman being run through a buzz saw. Suddenly you realize -- that old woman was your Aunt Hildegarde. Cousin Herman stares at the saw blade in horror then turns and dives into the chute, disappearing. You stand there as the blade continues to cut, wishing you had done more to save her.

Later you find your way out of the prop vault. You go next door to Johnny's and call the police. When they arrive they have a difficult time believing your story. You're advised to call a good lawyer."
	CRLF
	CALL PRINT-ID,STR?171
	CALL FINISH >STACK
	RSTACK
?L1:	CRLF
	PRINTI "Your Aunt Hildegarde, strapped to the conveyor belt, is "
	GET AUNT-DISTANCE,AUNT-COUNT >STACK
	PRINT STACK
	PRINTI " the saw blade. "
	ZERO? HERMAN-HITS /?L4
	EQUAL? AUNT-COUNT,1 \?L6
	PRINTR """Herman, dear, please turn off the buzz saw and untie me,"" says Aunt Hildegarde politely."
?L6:	EQUAL? AUNT-COUNT,2 \?L8
	PRINTR """Herman, that's no way to treat your cousin,"" admonishes Aunt Hildegarde."
?L8:	EQUAL? AUNT-COUNT,3 \?L9
	PRINTR """I'm just glad your Uncle Buddy isn't alive to see this,"" says Aunt Hildegarde with resignation."
?L9:	EQUAL? AUNT-COUNT,4 \?L10
	PRINTR """Herman, enough is enough. You are in big trouble, buster. Pumpkin, untie me then run and get your Uncle Buddy's belt,"" orders Aunt Hildegarde."
?L10:	EQUAL? AUNT-COUNT,5 \?L11
	PRINTR """Now you two stop that horseplay and get me off this contraption,"" demands Aunt Hildegarde."
?L11:	EQUAL? AUNT-COUNT,6 \?L14
	PRINTR """Pumpkin! Help!"" screams Aunt Hildegarde over the roar of the buzz saw."
?L4:	PRINTI """Herman, stop this silly game this instant and untie me,"" demands Aunt Hildegarde."
?L14:	CRLF
	RTRUE

	.FUNCT SAW-F,HERMAN-THING
	FIRST? HERMAN >HERMAN-THING /?L1
?L1:	EQUAL? PRSA,V?LAMP-OFF \?L2
	ZERO? HERMAN-DOWN /?L4
	ADD SCORE,20 >SCORE
	PRINTI "The conveyor belt stops and the buzz saw's blade begins to slow. As you untie your Aunt Hildegarde, Herman races toward the chute and jumps inside, disappearing. You hear his squeaky laugh trail off in the distance. Aunt Hildegarde gets up from the buzz saw rubbing the back of her head. Though a bit shaken, she explains she had been watching you while you searched for the ""treasures.""

""As I followed your progress I began to realize you and I were not the only ones on the estate. My suspicions were confirmed when I received a rap on the skull. The next thing I knew I was being tied to this buzz saw by your Cousin Herman,"" says Aunt Hildegarde. ""I guess he couldn't stand to see you inherit the family fortune. Well, it's all yours now. I knew you could do it,"" says Aunt Hildegarde with satisfaction.

""I'm sorry I put you through all this, Pumpkin, but your Uncle Buddy and I had to be sure that whoever inherited the estate and the studio would be clever enough to handle it all. The only way I could be sure the stipulations in my will would be carried out would be to oversee it myself, so I faked my death,"" says Aunt Hildegarde, hugging you so tight she squeezes the air out of your lungs. ""Tomorrow we'll go see my lawyer and he'll take care of all the paper work. I know you'll take good care of Hildebud and the studio. As for me, I'm sure it won't be long before the press discovers I'm alive. I plan to go to the south of France for a rest while the story leaks out. It will be great publicity for the studio,"" says Aunt Hildegarde. Then she adds, ""And let's hope we've seen the last of your Cousin Herman."""
	CRLF
	CALL PRINT-ID,STR?172
	CALL FINISH >STACK
	RSTACK
?L4:	ZERO? HERMAN-THING /?L6
	REMOVE HERMAN-THING
	PRINTI "Cousin Herman hits you with"
	CALL TPRINT,HERMAN-THING
	PRINTI ", driving you away from the buzz saw. The "
	CALL DPRINT,HERMAN-THING
	PRINTR " crumbles; it was only a prop."
?L6:	PRINTR "Cousin Herman slugs you in the stomach, pushing you away from the buzz saw."
?L2:	EQUAL? PRSA,V?LAMP-ON \?L8
	PRINTI "It's already turned on!"
	CALL PRINT-ID,STR?173 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a large, steel blade that seems to spin faster as Aunt Hildegarde moves closer to it."

	.FUNCT I-HERMAN-ATTACK,NEXT-PROP,FOO,HERMAN-THING
	FIRST? HERMAN >HERMAN-THING /?L1
?L1:	CALL QUEUE,I-HERMAN-ATTACK,-1
	ZERO? HERMAN-THING /?L2
	REMOVE HERMAN-THING
	CRLF
	PRINTI "Cousin Herman "
	EQUAL? HERMAN-THING,GUN \?L4
	PRINTI "fires"
	JUMP ?L7
?L4:	EQUAL? HERMAN-THING,BAG \?L6
	PRINTI "throws"
	JUMP ?L7
?L6:	PRINTI "swings"
?L7:	PRINTI " the "
	CALL DPRINT,HERMAN-THING
	PRINTI ", "
	EQUAL? HERMAN-THING,GUN \?L8
	PRINTR "covering you with whipped cream. Herman tosses the gun in the chute."
?L8:	PRINTI "striking you. The "
	CALL DPRINT,HERMAN-THING
	PRINTR " crumbles; it was only a prop."
?L2:	CALL PICK-ONE,PROPS >STACK
	MOVE STACK,HERMAN
	FIRST? HERMAN >HERMAN-THING /?L12
?L12:	CRLF
	PRINTI "Cousin Herman grabs the "
	CALL DPRINT,HERMAN-THING
	PRINTR "."

	.FUNCT PARK-PSEUDO
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's Tokyo Central Park, filled with little plastic trees and shrubs, and little plastic people sitting on little plastic benches. Tokyo's Main Street stops on the west side of the park then continues on the east side of the park. "
	EQUAL? DOG-LOC,6 \?L3
	PRINTI "In the western half of the park you can't help but notice the out-of-place "
	CALL DPRINT,DOG
	ZERO? ROCKET-LIFE /?L5
	PRINTI " with a small rocket buzzing around it."
	JUMP ?L7
?L5:	PRINTI "."
?L7:	EQUAL? TRUCK-LOC,33,30 /?L30
	PRINTR " A tiny truck is near some plastic trees in the eastern half of the park."
?L3:	PRINTI "In the eastern half of the park there"
	FSET? MONUMENT,EVERYBIT \?L12
	PRINTI " are bits and pieces of a smashed monument. "
	FSET? DOG,EVERYBIT /?L17
	ZERO? RING-UNDER-DOME /?L17
	PRINTI "Lying near the remains of the monument is"
	CALL APRINT,RING
	PRINTI ". "
	JUMP ?L17
?L12:	PRINTI " is a monument. "
?L17:	FSET? RING,EVERYBIT \?L18
	PRINTI "There is"
	CALL APRINT,RING
	PRINTI " perched on top of the monument. "
?L18:	EQUAL? DOG-LOC,7 \?L21
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI " is standing in front of the monument and a "
	EQUAL? TRUCK-LOC,30 \?L23
	PRINTI "smashed "
?L23:	PRINTI "truck is at his feet."
	ZERO? ROCKET-LIFE /?L30
	PRINTR " There is a rocket flying around the dog."
?L21:	EQUAL? DOG-LOC,30 \?L30
	PRINTI "Scattered on the west and east sides of the park are pieces of fur and scales, mixed with bits of wire and a couple of servomotors."
	FSET? DOG,EVERYBIT \?L30
	PRINTI " A "
	CALL DPRINT,RING
	PRINTI " is lying near the debris."
?L30:	CRLF
	RTRUE
?L1:	CALL TOUCHING?,PSEUDO-OBJECT >STACK
	ZERO? STACK /FALSE
	PRINTR "You can't touch the park. It's under the plastic dome."

	.FUNCT DOME-PSEUDO
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The thick plastic dome covers the model of downtown Tokyo"
	LESS? BURN-DOME,3 \?L3
	PRINTI ". There is a "
	EQUAL? BURN-DOME,2 \?L5
	PRINTI "slightly melted spot"
	JUMP ?L8
?L5:	EQUAL? BURN-DOME,1 \?L7
	PRINTI "melted spot, almost a hole"
	JUMP ?L8
?L7:	ZERO? BURN-DOME \?L8
	PRINTI "small hole"
?L8:	PRINTI " on the dome's eastern side"
?L3:	PRINTR "."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L11
	CALL PERFORM,V?EXAMINE,TOKYO
	RTRUE
?L11:	EQUAL? PRSA,V?PUT \FALSE
	ZERO? BURN-DOME \FALSE
	PRINTR "You don't want to ruin the delicate model."

	.FUNCT DOME-HOLE-PSEUDO
	EQUAL? BURN-DOME,3 \?L1
	CALL CANT-SEE-ANY >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	LESS? BURN-DOME,3 \?L3
	PRINTI "There is a "
	EQUAL? BURN-DOME,2 \?L4
	PRINTI "slightly melted spot"
	JUMP ?L7
?L4:	EQUAL? BURN-DOME,1 \?L6
	PRINTI "melted spot, almost a hole,"
	JUMP ?L7
?L6:	ZERO? BURN-DOME \?L7
	PRINTI "hole about the size of an orange"
?L7:	PRINTR " on the dome's eastern side."
?L3:	EQUAL? PRSA,V?REACH-IN \?L9
	FSET? DOG,EVERYBIT \?L9
	ZERO? BURN-DOME \?L9
	PRINTI "The "
	CALL DPRINT,RING
	PRINTI ": "
	CALL PERFORM,V?TAKE,RING
	RTRUE
?L9:	EQUAL? PRSA,V?LOOK-INSIDE \?L10
	PRINTR "You see downtown Tokyo."
?L10:	EQUAL? PRSA,V?PUT \FALSE
	ZERO? BURN-DOME \FALSE
	PRINTR "You don't want to ruin the delicate model."

	.FUNCT TRUCK-PSEUDO
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? TRUCK-LOC,33 \?L3
	PRINTR "You can't see any tiny truck here."
?L3:	EQUAL? TRUCK-LOC,30 \?L5
	PRINTR "The tiny truck is smashed into tiny bits and pieces."
?L5:	PRINTI "It's a tiny truck with a small radar dish which is pointing at"
	CALL TRPRINT,DOG
	RTRUE
?L1:	CALL TOUCHING?,PSEUDO-OBJECT >STACK
	ZERO? STACK /FALSE
	PRINTR "You can't reach the tiny truck. It's under the plastic dome."

	.FUNCT ROCKET-PSEUDO
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? ROCKET-LOC,33 \?L3
	PRINTR "You can't see any rocket here."
?L3:	EQUAL? ROCKET-LOC,30 \?L5
	PRINTR "You can't see any rocket here. It has been destroyed."
?L5:	PRINTI "The rocket is circling around"
	CALL TRPRINT,DOG
	RTRUE
?L1:	CALL TOUCHING?,PSEUDO-OBJECT >STACK
	ZERO? STACK /FALSE
	PRINTR "You can't reach the rocket. It's under the plastic dome."

	.FUNCT TOKYO-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "It's the scale model of downtown Tokyo used in the movie ""Atomic Chihuahuas From Hell."" In the center of the model is Tokyo Central Park. "
	PRINTI "In the eastern half of the park there "
	FSET? MONUMENT,EVERYBIT \?L3
	PRINTI "are bits and pieces of a smashed monument."
	FSET? DOG,EVERYBIT /?L8
	ZERO? RING-UNDER-DOME /?L8
	PRINTI " Lying near the remains of the monument is"
	CALL APRINT,RING
	PRINTI "."
	JUMP ?L8
?L3:	PRINTI "is a monument."
?L8:	FSET? RING,EVERYBIT \?L9
	PRINTI " There is"
	CALL APRINT,RING
	PRINTI " perched on top of the monument."
?L9:	PRINTI " Stretching east and west from the park is Tokyo's main street. "
	EQUAL? DOG-LOC,30 \?L12
	PRINTI "Scattered throughout the park are pieces of fur and scales mixed with bits of wire and a couple of servomotors."
	FSET? DOG,EVERYBIT \?L31
	PRINTI " A "
	CALL DPRINT,RING
	PRINTI " is lying near the debris."
	JUMP ?L31
?L12:	EQUAL? DOG-LOC,20 \?L17
	PRINTI "West of the park,"
	CALL TPRINT,DOG
	PRINTI " is lying in the street."
	JUMP ?L31
?L17:	EQUAL? DOG-LOC,40 \?L18
	PRINTI "Scattered in the street east of the park are pieces of fur and scales mixed with bits of wire and a couple of servomotors."
	FSET? DOG,EVERYBIT \?L31
	PRINTI " A "
	CALL DPRINT,RING
	PRINTI " is lying near the debris."
	JUMP ?L31
?L18:	LESS? DOG-LOC,6 \?L22
	GRTR? DOG-LOC,0 \?L22
	PRINTI "In the street west of the park there is an "
	CALL DPRINT,DOG
	SUB TANK-LOC,1 >STACK
	EQUAL? DOG-LOC,TANK-LOC,STACK /?L25
	SUB PLANE-LOC,1 >STACK
	EQUAL? DOG-LOC,PLANE-LOC,STACK \?L23
?L25:	PRINTI " under attack"
?L23:	PRINTI "."
	JUMP ?L31
?L22:	EQUAL? DOG-LOC,6,7 \?L27
	PRINTI "There is an "
	CALL DPRINT,DOG
	PRINTI " in the park"
	ZERO? ROCKET-LIFE /?L28
	PRINTI " with a rocket buzzing around it"
?L28:	PRINTI "."
	JUMP ?L31
?L27:	GRTR? DOG-LOC,7 \?L31
	PRINTI "There is an "
	CALL DPRINT,DOG
	PRINTI " in the street east of the park"
	ZERO? ROCKET-LIFE /?L32
	PRINTI " with a rocket buzzing around it"
?L32:	PRINTI "."
?L31:	PRINTI " The entire model is covered by a thick plastic dome"
	LESS? BURN-DOME,3 \?L36
	PRINTI " which has a "
	EQUAL? BURN-DOME,2 \?L38
	PRINTI "slightly melted spot"
	JUMP ?L41
?L38:	EQUAL? BURN-DOME,1 \?L40
	PRINTI "melted spot"
	JUMP ?L41
?L40:	ZERO? BURN-DOME \?L41
	PRINTI "small hole"
?L41:	PRINTI " in it near the east end"
?L36:	PRINTR ". Outside the dome on the model there are five buttons: a blue button, a black button, a green button, a white button and a red button."

	.FUNCT MONUMENT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's "
	FSET? MONUMENT,EVERYBIT \?L3
	PRINTI "what's left of "
?L3:	PRINTI "a memorial dedicated to the brave Japanese men and women who have died defending Tokyo against various monsters"
	FSET? RING,EVERYBIT \?L6
	PRINTI ". A "
	CALL DPRINT,RING
	PRINTI " is sitting atop the monument"
	JUMP ?L8
?L6:	FSET? MONUMENT,EVERYBIT \?L8
	FSET? DOG,EVERYBIT /?L8
	PRINTI ". There is"
	CALL APRINT,RING
	PRINTI " lying next to the monument rubble"
?L8:	PRINTR "."
?L1:	CALL TOUCHING?,MONUMENT >STACK
	ZERO? STACK /FALSE
	PRINTI "You can't reach"
	CALL TPRINT,MONUMENT
	PRINTR ". It's under the plastic dome."

	.FUNCT RING-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's"
	CALL TPRINT,RING
	PRINTR " from Uncle Buddy's movie ""The Big Diamond Ring."""
?L1:	EQUAL? PRSA,V?TAKE \?L3
	FSET? RING,TRYTAKEBIT \?L3
	ZERO? BURN-DOME \?L4
	FSET? DOG,EVERYBIT \?L6
	FCLEAR RING,TRYTAKEBIT
	FCLEAR DOG,EVERYBIT
	FCLEAR RING,NDESCBIT
	SET 'RING-UNDER-DOME,0
	RFALSE
?L6:	PRINTR "It's in the park in the middle of downtown Tokyo, the model that is. Despite the hole, you can't reach it from here."
?L4:	PRINTR "It's under the plastic dome. You can't reach it."
?L3:	EQUAL? PRSA,V?CUT \FALSE
	EQUAL? PRSI,RING \FALSE
	PRINTI "You don't think that's a real diamond, do you? Not in one of Uncle Buddy's movies."
	CRLF
	CALL PRINT-ID,STR?174 >STACK
	RSTACK

	.FUNCT TANK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? TANK-LOC,33 \FALSE
	PRINTI "You can't see any "
	CALL DPRINT,TANK
	PRINTR " here."
?L1:	CALL TOUCHING?,TANK >STACK
	ZERO? STACK /FALSE
	PRINTI "You can't reach"
	CALL TPRINT,TANK
	PRINTR " under the plastic dome."

	.FUNCT PLANE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? PLANE-LOC,33 \FALSE
	PRINTI "You can't see any "
	CALL DPRINT,PLANE
	PRINTR " here."
?L1:	CALL TOUCHING?,PLANE >STACK
	ZERO? STACK /FALSE
	PRINTI "You can't reach"
	CALL TPRINT,PLANE
	PRINTR " under the plastic dome."

	.FUNCT DOG-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? DOG-LOC,30,40 \?L3
	PRINTR "There's nothing left but bits of fur and scales mixed with pieces of wire and a couple of servomotors."
?L3:	PRINTI "Being atomic, it bears little resemblance to the prancing rats you're used to seeing, except for the bulging eyes, of course. It has a furry underbelly, but in most places scales have replaced hair, giving it a more reptilian look. Its front paws are now heavy, clawed appendages and it has fierce-looking fangs. "
	EQUAL? DOG-LOC,20 \?L6
	PRINTI "It's lying on its side in the street, west of the park."
	JUMP ?L8
?L6:	PRINTI "It's standing on its hind legs balanced by its huge mutated spiny tail."
?L8:	GRTR? HIT-POINTS,29 \?L9
	LESS? HIT-POINTS,33 \?L9
	PRINTI " It seems near death."
	JUMP ?L11
?L9:	GRTR? HIT-POINTS,25 \?L11
	LESS? HIT-POINTS,29 \?L11
	PRINTI " The repeated attacks are taking their toll."
?L11:	FSET? DOG,EVERYBIT \?L13
	PRINTI " It's clutching"
	CALL APRINT,RING
	PRINTI " with its claws."
?L13:	CRLF
	RTRUE
?L1:	CALL TOUCHING?,DOG >STACK
	ZERO? STACK /FALSE
	EQUAL? PRSA,V?TAKE \?L17
	EQUAL? PRSI,DOG \?L17
	EQUAL? PRSO,RING \?L17
	ZERO? BURN-DOME \?L17
	FSET? DOG,EVERYBIT /FALSE
?L17:	PRINTI "You can't reach"
	CALL TPRINT,DOG
	PRINTR ". It's under the plastic dome."

	.FUNCT RED-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	CALL DOG-DEAD? >STACK
	ZERO? STACK \TRUE
	ZERO? DOG-BREATH \?L5
	PRINTI "You hear a faint gagging noise coming from"
	CALL TPRINT,DOG
	PRINTR ", then see a little smoke rise from his nostrils."
?L5:	DEC 'DOG-BREATH
	EQUAL? DOG-LOC,PLANE-LOC \?L7
	EQUAL? PLANES-LEFT,2 \?L9
	SET 'PLANES-LEFT,1
	PUTP PLANE,P?SDESC,STR?175
	PRINTI "A gout of flame from the maw of the plutonium puppy burns up one of the puny planes."
	CRLF
	CALL PRINT-ID,STR?176 >STACK
	RSTACK
?L9:	MOVE PLANE,P-NMERGE
	SET 'PLANES-LEFT,0
	SET 'PLANE-LOC,30
	PRINTI "An eight-inch flame shoots from the dog's mouth, burning up the remaining puny plane."
	CRLF
	CALL PRINT-ID,STR?177 >STACK
	RSTACK
?L7:	EQUAL? DOG-LOC,6,7 \?L12
	ZERO? ROCKET-LIFE /?L12
	CALL DEQUEUE,I-ROCKET-ATTACK
	SET 'ROCKET-LIFE,0
	SET 'ROCKET-LOC,30
	PRINTI "The dog barks a flame, which burns the rocket to a crisp. (Japanese taxpayers are bound to complain about this useless and expensive waste of military hardware.)"
	CRLF
	CALL PRINT-ID,STR?178 >STACK
	RSTACK
?L12:	EQUAL? DOG-LOC,10 \?L13
	ZERO? ROCKET-LIFE \?L13
	ZERO? BURN-DOME /?L13
	DEC 'BURN-DOME
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI " breathes fire which "
	EQUAL? BURN-DOME,2 \?L14
	PRINTI "slightly melts a spot"
	CALL PRINT-ID,STR?179
	JUMP ?L17
?L14:	EQUAL? BURN-DOME,1 \?L16
	PRINTI "melts the spot even more. There is almost a hole"
	CALL PRINT-ID,STR?180
	JUMP ?L17
?L16:	ZERO? BURN-DOME \?L17
	PRINTI "burns a small hole"
	CALL PRINT-ID,STR?181
?L17:	PRINTR " in the plastic dome."
?L13:	PRINTR "A flame shoots from the dog's mouth into the air."

	.FUNCT WHITE-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	CALL DOG-DEAD? >STACK
	ZERO? STACK \TRUE
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI " swipes at "
	EQUAL? DOG-LOC,PLANE-LOC \?L6
	PRINTI "the "
	CALL DPRINT,PLANE
	PRINTI ", striking "
	EQUAL? PLANES-LEFT,2 \?L8
	PRINTI "one"
	JUMP ?L10
?L8:	PRINTI "it"
?L10:	PRINTI ". A puff of black smoke begins to trail from the puny plane. "
	EQUAL? PLANES-LEFT,2 \?L11
	PRINTI "It rolls to one side, then heads down, crashing in a Tokyo suburb"
	JUMP ?L13
?L11:	PRINTI "It tumbles out of control, crashing in the parking lot of the Tokyo Disneyland"
?L13:	DEC 'PLANES-LEFT
	PUTP PLANE,P?SDESC,STR?175
	ZERO? PLANES-LEFT \?L18
	MOVE PLANE,P-NMERGE
	SET 'PLANES-LEFT,0
	SET 'PLANE-LOC,30
	JUMP ?L18
?L6:	EQUAL? DOG-LOC,ROCKET-LOC \?L17
	EQUAL? ROCKET-LOC,30 /?L17
	PRINTI "the rocket, barely missing it"
	JUMP ?L18
?L17:	PRINTI "thin air"
?L18:	PRINTR "."

	.FUNCT DOG-DEAD?
	EQUAL? DOG-LOC,30,40 \?L1
	PRINTI "A servomotor "
	EQUAL? DOG-LOC,40 \?L3
	PRINTI "east of "
	JUMP ?L5
?L3:	PRINTI "in "
?L5:	PRINTR "the park spins for a moment."
?L1:	EQUAL? DOG-LOC,20 \FALSE
	EQUAL? PRSI,RED-BUTTON \?L7
	PRINTI "A slight puff of smoke emerges slowly from"
	CALL TPRINT,DOG
	PRINTR "'s left nostril."
?L7:	PRINTI "You press"
	CALL TPRINT,PRSO
	PRINTR " but nothing happens."

	.FUNCT GREEN-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	CALL DOG-DEAD? >STACK
	ZERO? STACK \TRUE
	EQUAL? DOG-LOC,TANK-LOC,PLANE-LOC \?L5
	PRINTI "The gunfire prevents"
	CALL TPRINT,DOG
	PRINTI " from moving further forward."
	CRLF
	JUMP ?L29
?L5:	EQUAL? DOG-LOC,10 \?L6
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI " bumps its atomic snout into the plastic dome covering the model."
	CRLF
	JUMP ?L29
?L6:	INC 'DOG-LOC
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI ", in "
	GRTR? HIT-POINTS,8 \?L8
	PRINTI "a wounded waddle,"
	JUMP ?L10
?L8:	PRINTI "its best prehistoric prance,"
?L10:	PRINTI " moves "
	EQUAL? DOG-LOC,6 \?L11
	PRINTI "into the west end of the park, violating all leash laws."
	CRLF
	JUMP ?L29
?L11:	EQUAL? DOG-LOC,7 \?L13
	PRINTI "to the east end of the park right in front of a monument, near the tiny truck."
	ZERO? ROCKET-LIFE /?L14
	SET 'ROCKET-LOC,7
	PRINTI " The rocket follows close behind."
?L14:	CRLF
	JUMP ?L29
?L13:	EQUAL? DOG-LOC,8 \?L17
	PRINTI "forward, crushing the monument. Dozens of local pigeons commence mourning. "
	FSET MONUMENT,EVERYBIT
	FSET? DOG,EVERYBIT /?L18
	FCLEAR RING,EVERYBIT
	PRINTI "The "
	CALL DPRINT,RING
	PRINTI " tumbles off the monument onto the ground. "
?L18:	PRINTI "The dog leaves the park and moves into the street"
	EQUAL? DOG-LOC,ROCKET-LOC /?L21
	EQUAL? ROCKET-LOC,30 /?L21
	SET 'ROCKET-LOC,DOG-LOC
	PRINTI ". The rocket follows close behind"
?L21:	PRINTI "."
	CRLF
	JUMP ?L29
?L17:	EQUAL? DOG-LOC,9 \?L24
	PRINTI "further east, then comes to a stop."
	EQUAL? DOG-LOC,ROCKET-LOC /?L25
	EQUAL? ROCKET-LOC,30 /?L25
	SET 'ROCKET-LOC,DOG-LOC
	PRINTI " The rocket follows close behind."
?L25:	CRLF
	JUMP ?L29
?L24:	EQUAL? DOG-LOC,2 \?L28
	PRINTI "east, then comes to a stop."
	CRLF
	JUMP ?L29
?L28:	PRINTI "further east, then comes to a stop."
	CRLF
?L29:	EQUAL? DOG-LOC,2 \?L30
	EQUAL? DOG-LOC,TANK-LOC,PLANE-LOC /?L30
	SET 'TANK-LOC,5
	SET 'PLANE-LOC,7
	CALL QUEUE,I-TANK-ATTACK,2
	CRLF
	PRINTI "Suddenly, several blocks east of"
	CALL TPRINT,DOG
	PRINTI ", a pair of "
	CALL DPRINT,TANK
	PRINTI " turn a corner onto the main street. They're heading straight for"
	CALL TPRINT,DOG
	PRINTR ". Out of the corner of your eye you notice a puny plane flying over the park. The puny plane banks, turning towards the main street."
?L30:	EQUAL? DOG-LOC,6 \TRUE
	CALL QUEUE,I-ROCKET-ATTACK,2
	SET 'ROCKET-LOC,6
	SET 'TRUCK-LOC,7
	CRLF
	PRINTI "Suddenly out from under a clump of trees at the east end of the park, a tiny truck with a rocket mounted on it rolls into view. (Apparently, violating Tokyo's leash laws is not taken lightly.) A small radar dish on the tiny truck spins furiously until it locks in on"
	CALL TPRINT,DOG
	PRINTR " and stops. A puff of smoke comes from the back of the rocket as it blasts off toward the dog."

	.FUNCT I-TANK-ATTACK,HITS,TANK-IN-RANGE=0,PLANE-IN-RANGE=0
	ZERO? TANKS-LEFT \?L1
	ZERO? PLANES-LEFT \?L1
	CALL DEQUEUE,I-TANK-ATTACK
	RFALSE
?L1:	CALL QUEUE,I-TANK-ATTACK,-1
	SET 'HITS,HIT-POINTS
	EQUAL? HERE,GAME-ROOM \?L4
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L4
	CRLF
?L4:	EQUAL? DOG-LOC,TANK-LOC \?L7
	EQUAL? DOG-LOC,PLANE-LOC \?L7
	EQUAL? HERE,GAME-ROOM \?L9
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L9
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI " continues to take fire from"
	CALL TPRINT,TANK
	PRINTI " and"
	CALL TPRINT,PLANE
	PRINTI "."
?L9:	ADD PLANES-LEFT,TANKS-LEFT >STACK
	ADD HIT-POINTS,STACK >HIT-POINTS
	JUMP ?L78
?L7:	EQUAL? TANK-LOC,DOG-LOC \?L13
	EQUAL? HERE,GAME-ROOM \?L15
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L15
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI " continues to take hits from"
	CALL TPRINT,TANK
	PRINTI "."
?L15:	ADD HIT-POINTS,TANKS-LEFT >HIT-POINTS
	JUMP ?L32
?L13:	ZERO? TANKS-LEFT /?L39
	DEC 'TANK-LOC
	EQUAL? TANK-LOC,DOG-LOC \?L19
	EQUAL? HERE,GAME-ROOM \?L21
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L21
	PRINTI "The tanks "
	GRTR? HIT-POINTS,0 \?L23
	PRINTI "continue"
	JUMP ?L25
?L23:	PRINTI "begin"
?L25:	PRINTI " to fire as they roll to a stop at the foot of the mutant Mexican hairless."
?L21:	ADD HIT-POINTS,TANKS-LEFT >HIT-POINTS
	JUMP ?L32
?L19:	ADD DOG-LOC,1 >STACK
	EQUAL? STACK,TANK-LOC \?L27
	EQUAL? HERE,GAME-ROOM \?L28
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L28
	PRINTI "The tanks, only a block away, begin firing as they move within range."
?L28:	ADD HIT-POINTS,TANKS-LEFT >HIT-POINTS
	JUMP ?L32
?L27:	EQUAL? TANK-LOC,DOG-LOC /?L32
	EQUAL? HERE,GAME-ROOM \?L32
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L32
	PRINTI "The tanks, a few blocks away, continue to advance toward the radiated sewer rat."
?L32:	ZERO? TANKS-LEFT /?L39
	EQUAL? HERE,GAME-ROOM \?L39
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L39
	PRINTI " "
?L39:	EQUAL? PLANE-LOC,DOG-LOC \?L43
	EQUAL? HERE,GAME-ROOM \?L45
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L45
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI " continues to take fire from"
	CALL TPRINT,PLANE
	PRINTI "."
?L45:	ADD HIT-POINTS,PLANES-LEFT >HIT-POINTS
	JUMP ?L78
?L43:	ZERO? PLANES-LEFT /?L78
	DEC 'PLANE-LOC
	EQUAL? PLANE-LOC,DOG-LOC \?L49
	EQUAL? HERE,GAME-ROOM \?L51
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L51
	PRINTI "The planes, spewing bullet-shaped death, reach the radioactive reptile and begin circling around it."
?L51:	ADD HIT-POINTS,PLANES-LEFT >HIT-POINTS
	JUMP ?L78
?L49:	ADD DOG-LOC,1 >STACK
	EQUAL? STACK,PLANE-LOC \?L54
	EQUAL? HERE,GAME-ROOM \?L55
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L55
	PRINTI "The planes, only a block away, begin firing as they move within range."
?L55:	ADD HIT-POINTS,PLANES-LEFT >HIT-POINTS
	JUMP ?L78
?L54:	EQUAL? PLANE-LOC,DOG-LOC /?L78
	EQUAL? PLANE-LOC,6 \?L59
	EQUAL? HERE,GAME-ROOM \?L61
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L61
	PRINTI "Over the park, a second puny plane joins the first one."
?L61:	PUTP PLANE,P?SDESC,STR?182
	JUMP ?L78
?L59:	EQUAL? PLANE-LOC,5 \?L64
	EQUAL? HERE,GAME-ROOM \?L65
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L65
	PRINTI "The puny planes swoop out of the park and down the street"
?L65:	EQUAL? DOG-LOC,4 \?L68
	EQUAL? HERE,GAME-ROOM \?L70
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L70
	PRINTI " firing at"
	CALL TPRINT,DOG
?L70:	ADD HIT-POINTS,PLANES-LEFT >HIT-POINTS
?L68:	EQUAL? HERE,GAME-ROOM \?L78
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L78
	PRINTI "."
	JUMP ?L78
?L64:	EQUAL? HERE,GAME-ROOM \?L78
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L78
	PRINTI "The planes, a few blocks away, continue to fly toward the radiated sewer rat."
?L78:	GRTR? HIT-POINTS,HITS \?L125
	EQUAL? HERE,GAME-ROOM \?L89
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L89
	EQUAL? PLANE-LOC,30 \?L87
	CALL PICK-ONE,DOG-IN-PAIN >STACK
	PRINT STACK
	JUMP ?L89
?L87:	PRINTI " "
	CALL PICK-ONE,DOG-IN-PAIN >STACK
	PRINT STACK
?L89:	GRTR? HIT-POINTS,19 \?L91
	CALL DEQUEUE,I-TANK-ATTACK
	SET 'DOG-LOC,20
	SET 'TANK-LOC,33
	SET 'PLANE-LOC,33
	EQUAL? HERE,GAME-ROOM \TRUE
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L125
	PRINTI " The "
	CALL DPRINT,DOG
	PRINTI " starts to shake as if he has to go outside, then stumbles and falls to the ground.

*** The "
	CALL DPRINT,DOG
	PRINTI " has died ***

           Tokyo is saved!"
	CRLF
	CRLF
	PRINTI "The "
	ZERO? TANKS-LEFT /?L95
	PRINTI "tiny tank"
	EQUAL? TANKS-LEFT,2 \?L97
	PRINTI "s turn"
	JUMP ?L99
?L97:	PRINTI " turns"
?L99:	PRINTI " onto a side street and disappear"
	EQUAL? TANKS-LEFT,1 \?L100
	PRINTI "s"
?L100:	ZERO? PLANES-LEFT \?L103
	PRINTI "."
	JUMP ?L125
?L103:	PRINTI " as the puny plane"
	EQUAL? PLANES-LEFT,2 \?L106
	PRINTI "s tip their"
	JUMP ?L108
?L106:	PRINTI " tips its"
?L108:	PRINTI " wings and head"
	EQUAL? PLANES-LEFT,1 \?L109
	PRINTI "s"
?L109:	PRINTI " for home."
	JUMP ?L125
?L95:	PRINTI "puny plane"
	EQUAL? PLANES-LEFT,2 \?L113
	PRINTI "s tip their"
	JUMP ?L115
?L113:	PRINTI " tips its"
?L115:	PRINTI " wings and head"
	EQUAL? PLANES-LEFT,1 \?L116
	PRINTI "s"
?L116:	PRINTI " for home."
	JUMP ?L125
?L91:	GRTR? HIT-POINTS,15 \?L120
	GRTR? HITS,15 /?L120
	EQUAL? HERE,GAME-ROOM \TRUE
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L125
	PRINTI " The repeated attacks weaken"
	CALL TPRINT,DOG
	PRINTI " and it seems near death."
	JUMP ?L125
?L120:	GRTR? HIT-POINTS,11 \?L125
	GRTR? HITS,11 /?L125
	EQUAL? HERE,GAME-ROOM \TRUE
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L125
	PRINTI " The repeated attacks begin to take their toll on"
	CALL TPRINT,DOG
	PRINTI "."
?L125:	EQUAL? HERE,GAME-ROOM \TRUE
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /TRUE
	CRLF
	RTRUE

	.FUNCT I-ROCKET-ATTACK
	EQUAL? ROCKET-LOC,30 /FALSE
	CALL QUEUE,I-ROCKET-ATTACK,-1
	DEC 'ROCKET-LIFE
	ZERO? ROCKET-LIFE \?L4
	EQUAL? HERE,GAME-ROOM \?L6
	CALL LIT?,GAME-ROOM >STACK
	ZERO? STACK /?L6
	CRLF
	PRINTI "The rocket swoops down, striking"
	CALL TPRINT,DOG
	PRINTI " in the chest. The "
	CALL DPRINT,DOG
	PRINTI " explodes and pieces of fur and scales, mixed with bits of wire and a couple of servomotors, scatter throughout the area.

*** The "
	CALL DPRINT,DOG
	PRINTI " has died ***

           Tokyo is saved!"
	CRLF
?L6:	SET 'ROCKET-LOC,30
	CALL DEQUEUE,I-ROCKET-ATTACK
	EQUAL? DOG-LOC,6,7 \?L9
	SET 'DOG-LOC,30
	RETURN DOG-LOC
?L9:	SET 'DOG-LOC,40
	RETURN DOG-LOC
?L4:	EQUAL? ROCKET-LIFE,3 \?L13
	EQUAL? HERE,GAME-ROOM \?L13
	CALL LIT?,HERE >STACK
	ZERO? STACK /?L13
	CRLF
	PRINTI "The rocket speeds toward"
	CALL TPRINT,DOG
	PRINTR " and begins circling as it nears."
?L13:	EQUAL? ROCKET-LIFE,2 \?L15
	EQUAL? HERE,GAME-ROOM \?L15
	CALL LIT?,HERE >STACK
	ZERO? STACK /?L15
	CRLF
	PRINTI "The rocket begins bobbing up and down, sniffing for just the right spot as it circles"
	CALL TRPRINT,DOG
	RTRUE
?L15:	EQUAL? ROCKET-LIFE,1 \FALSE
	EQUAL? HERE,GAME-ROOM \FALSE
	CALL LIT?,HERE >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "Suddenly the rocket makes a wide turn out in front of"
	CALL TPRINT,DOG
	PRINTR ". It seems to have found the spot it was looking for. The rocket's speed increases as it heads right for the dog's heart!"

	.FUNCT BLUE-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	CALL DOG-DEAD? >STACK
	ZERO? STACK \TRUE
	PRINTI "The "
	CALL DPRINT,DOG
	FSET? DOG,EVERYBIT \?L6
	PRINTI " clutches"
	CALL TPRINT,RING
	PRINTR " more tightly."
?L6:	EQUAL? DOG-LOC,7 \?L8
	PRINTI " clutches"
	CALL TPRINT,RING
	PRINTI " in its front claws."
	CRLF
	FCLEAR RING,EVERYBIT
	FSET DOG,EVERYBIT
	RTRUE
?L8:	PRINTR " grasps at thin air with its front claws."

	.FUNCT BLACK-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	CALL DOG-DEAD? >STACK
	ZERO? STACK \TRUE
	EQUAL? DOG-LOC,TANK-LOC \?L6
	EQUAL? TANKS-LEFT,2 \?L8
	RANDOM 100 >STACK
	LESS? 50,STACK /?L8
	PUTP TANK,P?SDESC,STR?183
	PRINTI "Just as"
	CALL TPRINT,DOG
	PRINTI " is about to raise its hind leg, one of the tiny tanks drives up onto its toenail. As"
	CALL TPRINT,DOG
	PRINTI " raises its hind leg, the tiny tank is lifted off the ground and hurled through the air into the middle of a nearby apartment building, demolishing a large portion of it. Hundreds of house plants fall to their deaths. The "
	CALL DPRINT,DOG
	PRINTI " stomps the street's pavement with its clawed foot."
	SET 'TANKS-LEFT,1
	CRLF
	RTRUE
?L8:	PRINTI "The "
	CALL DPRINT,DOG
	PRINTI " lifts its hind leg and, just as you thought this game was going to become even more base, stomps its clawed foot down on "
	EQUAL? TANKS-LEFT,2 \?L11
	PRINTI "one of the tiny tanks"
	PUTP TANK,P?SDESC,STR?183
	SET 'TANKS-LEFT,1
	JUMP ?L13
?L11:	PRINTI "the other tiny tank"
	MOVE TANK,P-NMERGE
	SET 'TANKS-LEFT,0
	SET 'TANK-LOC,30
?L13:	PRINTI ", crushing it."
	CALL PRINT-ID,STR?184
	CRLF
	RTRUE
?L6:	EQUAL? TRUCK-LOC,7 \?L14
	EQUAL? DOG-LOC,7 \?L14
	PRINTI "The Chihuahua raises his hind leg and soundly stomps the tiny truck, smashing it to bits."
	CALL PRINT-ID,STR?185
	ZERO? ROCKET-LIFE /?L15
	PRINTI " The rocket heads straight for the Atomic Chihuahua, then begins to swerve and dive erratically. It sails past the Atomic Chihuahua, colliding with Tokyo's tallest building, the Ginsu Building, corporate headquarters of the Ginsu Knife Company. Just as your mind pauses to consider the possibility of a Ginsu knife standing up to this kind of punishment, the rocket explodes and the entire building collapses. Tokyo isn't saved but millions of late-night TV viewers are."
?L15:	SET 'TRUCK-LOC,30
	SET 'ROCKET-LOC,30
	SET 'ROCKET-LIFE,0
	CALL DEQUEUE,I-ROCKET-ATTACK
	CRLF
	RTRUE
?L14:	EQUAL? DOG-LOC,6,7 \?L18
	PRINTI "The "
	CALL DPRINT,DOG
	PRINTR " lifts its hind leg (no, not that!) and stomps its scaly claw down on the grass, creating a children's wading pool."
?L18:	PRINTI "The "
	CALL DPRINT,DOG
	PRINTR " lifts its hind leg and stomps its clawed foot down on the street's pavement."

	.FUNCT MENS-ROOM-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	CALL DESCRIBE-BATHROOM,STR?186 >STACK
	RSTACK

	.FUNCT DESCRIBE-BATHROOM,GENDER
	PRINTI "This is an ordinary restroom which looks like a "
	PRINT GENDER
	PRINTI " room in a theatre."
	RTRUE

	.FUNCT LADIES-ROOM-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	CALL DESCRIBE-BATHROOM,STR?187 >STACK
	RSTACK

	.FUNCT ENTER-HM
	FCLEAR HEDGE-MAZE,TOUCHBIT
	SET 'HM-ROOM,439
	CALL ULTIMATELY-IN?,VERTICAL-MAP >STACK
	ZERO? STACK \?L1
	CALL ULTIMATELY-IN?,HORIZONTAL-MAP >STACK
	ZERO? STACK \?L1
	PRINTI "You feel uneasy going into the hedge maze knowing Aunt Hildegarde isn't here to help you find your way out."
	CRLF
	CRLF
?L1:	RANDOM 20 >STACK
	ADD 30,STACK >STACK
	CALL QUEUE,I-HEDGE-FOOTSTEPS,STACK
	RETURN HEDGE-MAZE

	.FUNCT I-HEDGE-FOOTSTEPS
	EQUAL? HERE,HEDGE-MAZE \FALSE
	RANDOM 20 >STACK
	ADD 30,STACK >STACK
	CALL QUEUE,I-HEDGE-FOOTSTEPS,STACK
	CRLF
	PRINTR "You hear footsteps on the other side of the hedge."

	.FUNCT HEDGE-MAZE-OBJ-F
	EQUAL? PRSA,V?LEAVE,V?EXIT,V?ENTER /?L3
	EQUAL? PRSA,V?DISEMBARK,V?WALK-TO \FALSE
?L3:	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT HEDGE-MAZE-F,RARG,PATHS=0,OLD,STEPS,DIR
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are in a hedge maze of astonishing complexity. "
	BTST HM-BITS,X-N \?L3
	INC 'PATHS
?L3:	BTST HM-BITS,X-E \?L6
	INC 'PATHS
?L6:	BTST HM-BITS,X-W \?L9
	INC 'PATHS
?L9:	BTST HM-BITS,X-S \?L12
	INC 'PATHS
?L12:	GRTR? PATHS,1 \?L15
	PRINTI "Paths lead "
	JUMP ?L17
?L15:	PRINTI "A path leads "
?L17:	BTST HM-BITS,X-N \?L18
	PRINTI "north"
	CALL PUNCTUATION,PATHS >PATHS
?L18:	BTST HM-BITS,X-S \?L21
	PRINTI "south"
	CALL PUNCTUATION,PATHS >PATHS
?L21:	BTST HM-BITS,X-E \?L24
	PRINTI "east"
	CALL PUNCTUATION,PATHS >PATHS
?L24:	BTST HM-BITS,X-W \?L27
	PRINTI "west"
	CALL PUNCTUATION,PATHS >PATHS
?L27:	BTST HM-BITS,X-H \TRUE
	CRLF
	CRLF
	PRINTI "There is a hole in the ground here from your previous excavations."
	MOVE MAZE-HOLE,HERE
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \?L33
	GETB HM-TABLE,HM-ROOM >HM-BITS
	CALL OBJECTS-TO-ROOM,HM-ROOM >STACK
	RSTACK
?L33:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	SET 'OLD,HM-ROOM
	CALL OBJECTS-TO-TABLE,OLD
	EQUAL? P-WALK-DIR,P?NORTH \?L37
	BTST HM-BITS,X-N \?L37
	SET 'DIR,STR?105
	CALL HEDGE-WALK,X-N >STEPS
	JUMP ?L52
?L37:	EQUAL? P-WALK-DIR,P?SOUTH \?L39
	BTST HM-BITS,X-S \?L39
	EQUAL? HM-ROOM,439 \?L40
	CALL GOTO,ENTRANCE-TO-MAZE
	RTRUE
?L40:	EQUAL? HM-ROOM,388 \?L42
	PRINTI "You make your way 10 feet south along the path."
	CRLF
	CRLF
	CALL GOTO,HEART-OF-MAZE
	RTRUE
?L42:	SET 'DIR,STR?104
	CALL HEDGE-WALK,X-S >STEPS
	JUMP ?L52
?L39:	EQUAL? P-WALK-DIR,P?EAST \?L44
	BTST HM-BITS,X-E \?L44
	SET 'DIR,STR?188
	CALL HEDGE-WALK,X-E >STEPS
	JUMP ?L52
?L44:	EQUAL? P-WALK-DIR,P?WEST \?L45
	BTST HM-BITS,X-W \?L45
	SET 'DIR,STR?189
	CALL HEDGE-WALK,X-W >STEPS
	JUMP ?L52
?L45:	EQUAL? P-WALK-DIR,P?UP \?L46
	PRINTI "Please don't climb the hedges."
	CRLF
	RETURN 2
?L46:	EQUAL? P-WALK-DIR,P?DOWN \?L49
	PRINTI "You burrow furiously to no avail."
	CRLF
	RETURN 2
?L49:	CALL OBJECTS-TO-ROOM,OLD
	CALL PICK-ONE,HEDGE-CRASH >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	RETURN 2
?L52:	FCLEAR HEDGE-MAZE,TOUCHBIT
	PRINTI "You make your way "
	MUL 10,STEPS >STACK
	PRINTN STACK
	PRINTI " feet "
	PRINT DIR
	PRINTI " along the path."
	CRLF
	CRLF
	CALL GOTO,HEDGE-MAZE >STACK
	RSTACK

	.FUNCT OUT-OF-HEART-OF-MAZE
	FCLEAR HEDGE-MAZE,TOUCHBIT
	PRINTI "You make your way 10 feet north along the path."
	CRLF
	CRLF
	RETURN HEDGE-MAZE

	.FUNCT HEART-OF-MAZE-HOLE-F
	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL CANT-OPEN-CLOSE >STACK
	RSTACK

	.FUNCT PUNCTUATION,PATHS
	EQUAL? PATHS,4 \?L1
	PRINTI ", "
	JUMP ?L5
?L1:	EQUAL? PATHS,3 \?L3
	PRINTI ", "
	JUMP ?L5
?L3:	EQUAL? PATHS,2 \?L4
	PRINTI " and "
	JUMP ?L5
?L4:	PRINTI "."
?L5:	DEC 'PATHS
	RETURN PATHS

	.FUNCT HEDGE-WALK,BIT,STEPS=0,MBITS
	SET 'MBITS,HM-BITS
?L1:	EQUAL? BIT,X-N \?L3
	BTST MBITS,X-N \?L3
	DEC 'HM-ROOM
	JUMP ?L8
?L3:	EQUAL? BIT,X-S \?L5
	BTST MBITS,X-S \?L5
	INC 'HM-ROOM
	JUMP ?L8
?L5:	EQUAL? BIT,X-E \?L6
	BTST MBITS,X-E \?L6
	ADD HM-ROOM,20 >HM-ROOM
	JUMP ?L8
?L6:	EQUAL? BIT,X-W \?L7
	BTST MBITS,X-W \?L7
	SUB HM-ROOM,20 >HM-ROOM
	JUMP ?L8
?L7:	RETURN STEPS
?L8:	INC 'STEPS
	GETB HM-TABLE,HM-ROOM >STACK
	ZERO? STACK /?L9
	RETURN STEPS
?L9:	SET 'MBITS,15
	JUMP ?L1

	.FUNCT OBJECTS-TO-TABLE,SLOC,TBL,CNT=0,F,N
	FIRST? HEDGE-MAZE >F /?L1
?L1:	REMOVE MAZE-HOLE
	SET 'TBL,HEDGE-OBJECTS-TABLE
?L2:	ZERO? F /TRUE
	NEXT? F >N /?L7
?L7:	EQUAL? F,WINNER /?L12
	FSET? F,TAKEBIT \?L12
?L11:	GET TBL,CNT >STACK
	ZERO? STACK \?L13
	PUT TBL,CNT,SLOC
	ADD CNT,1 >STACK
	PUT TBL,STACK,F
	ADD CNT,2 >CNT
	REMOVE F
	JUMP ?L12
?L13:	ADD CNT,2 >CNT
	JUMP ?L11
?L12:	SET 'F,N
	JUMP ?L2

	.FUNCT OBJECTS-TO-ROOM,SLOC,TBL,CNT=0
	SET 'TBL,HEDGE-OBJECTS-TABLE
?L1:	LESS? CNT,HEDGE-OBJECT-TABLE-LENGTH \TRUE
	GET TBL,CNT >STACK
	EQUAL? STACK,SLOC \?L5
	PUT TBL,CNT,0
	ADD CNT,1 >STACK
	GET TBL,STACK >STACK
	MOVE STACK,HEDGE-MAZE
?L5:	ADD CNT,2 >CNT
	JUMP ?L1

	.INSERT "hollywoodhijinx/hollywoodhijinx_str"
	.END
