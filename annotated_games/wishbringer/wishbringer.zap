	.TIME
	.INSERT "annotated_games/wishbringer/wishbringer_freq"
	.INSERT "annotated_games/wishbringer/wishbringer_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	PRINTD OBJ
	RTRUE

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-THEFT?
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,UMBRELLA,CARTON,STATUE /TRUE
	EQUAL? PRSO,CHOCOLATE,VIOLET-NOTE,CLUTTER /TRUE
	EQUAL? PRSO,FOSSIL,DCASE,SCULPTURE /TRUE
	EQUAL? PRSO,CANDLE,HAT,VOSS-THINGS /TRUE
	EQUAL? PRSO,CLOCK,BONE,LIBRARY-KEY /TRUE
	EQUAL? PRSO,BOOKS,ART,INSTRUMENTS /TRUE
	EQUAL? PRSO,COAT,KEY,TMACHINE /TRUE
	EQUAL? PRSO,LEVER,SCOPE,BROOM /TRUE
	EQUAL? PRSO,REFRIGERATOR,BOTTLE,MILK /TRUE
	EQUAL? PRSO,WORM \FALSE
	RTRUE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,AISLE,ARCADE,ART /TRUE
	EQUAL? PRSO,BAY,BLANKET,BONE /TRUE
	EQUAL? PRSO,BOOKCASE,BOOKS,BOTTLE /TRUE
	EQUAL? PRSO,BRANCH,BRIDGE,BRIDGE-SIGN /TRUE
	EQUAL? PRSO,BROOM,BUNK,BUTTON /TRUE
	EQUAL? PRSO,CAN-BOTTOM,CANDLE,CARTON /TRUE
	EQUAL? PRSO,CASTLE,CASTLE-JUNK,CDEBRIS /TRUE
	EQUAL? PRSO,CDESK,CEILING,CELL /TRUE
	EQUAL? PRSO,CELL-DOOR,CEMETERY,CHAINS /TRUE
	EQUAL? PRSO,CHAOS,CHEMICALS,CHOCOLATE /TRUE
	EQUAL? PRSO,CHURCH,CHURCH-DOOR,CIRCULATION-DESK /TRUE
	EQUAL? PRSO,CLIFF,CLIFF-BOTTOM,CLIFF-EDGE /TRUE
	EQUAL? PRSO,CLOCK,CLUTTER,COAT /TRUE
	EQUAL? PRSO,COIN,CONCH-SHELL,CORNER /TRUE
	EQUAL? PRSO,CORRIDOR,COTTAGE,COTTAGE-DOOR /TRUE
	EQUAL? PRSO,COUNTER,CRANK,CREEPY-CORNER /TRUE
	EQUAL? PRSO,CURTAIN,DCASE,DEBRIS /TRUE
	EQUAL? PRSO,DESK,DHORSE,DRAWBRIDGE /TRUE
	EQUAL? PRSO,ENVELOPE,EXHIBITS,FESTERON-POINT /TRUE
	EQUAL? PRSO,FOSSIL,FOUNTAIN,GLASS-CASE /TRUE
	EQUAL? PRSO,GLASSES,GLOBBY,GMUSEUM /TRUE
	EQUAL? PRSO,GNARLED-TREE,GRAVE,GRUE-NEST /TRUE
	EQUAL? PRSO,HAT,HATCH,HIDDEN-HATCH /TRUE
	EQUAL? PRSO,HOUSE-DOOR,INSTRUMENTS,JAIL-CELL /TRUE
	EQUAL? PRSO,JOYSTICK,KEY,LABORATORY /TRUE
	EQUAL? PRSO,LADDER,LAKE,LAKE-SAND /TRUE
	EQUAL? PRSO,LEAFLET,LEAVES,LEVER /TRUE
	EQUAL? PRSO,LIBRARY,LIBRARY-DOOR,LIBRARY-KEY /TRUE
	EQUAL? PRSO,LIGHTHOUSE,LOBBY,MACHINE /TRUE
	EQUAL? PRSO,MAGICK-SHOPPE,MAILBOX,MILK /TRUE
	EQUAL? PRSO,MONUMENTS,MOVIE-THEATER,MUSEUM /TRUE
	EQUAL? PRSO,NORTH-GATE,OPEN-ENVELOPE,OPEN-GRAVE /TRUE
	EQUAL? PRSO,PANEL,POLICE-DOOR,POLICE-STATION /TRUE
	EQUAL? PRSO,POST-DOOR,POST-OFFICE,POSTER /TRUE
	EQUAL? PRSO,PSEUDO-BUNK,RADIO,RANSOM-LETTER /TRUE
	EQUAL? PRSO,REFRIGERATOR,SCHEDULE,SCOPE /TRUE
	EQUAL? PRSO,SCRAWL,SCREEN,SCULPTURE /TRUE
	EQUAL? PRSO,SEAT,SHOE,SHOPPE-DOOR /TRUE
	EQUAL? PRSO,SIGN,SMALL-BOX,SNAKE-CAN /TRUE
	EQUAL? PRSO,SOUTH-GATE,SPEAKER,STATUE /TRUE
	EQUAL? PRSO,STOCK,STUMP,SW1 /TRUE
	EQUAL? PRSO,SW2,THRONE-ROOM,TICKET /TRUE
	EQUAL? PRSO,TMACHINE,TOKEN,TOLL-GATE /TRUE
	EQUAL? PRSO,TORTURE-CHAMBER,TOWER,TREE /TRUE
	EQUAL? PRSO,UMBRELLA,VIDEO-ARCADE,VIDEO-SCREEN /TRUE
	EQUAL? PRSO,VIOLET-NOTE,VOSS-THINGS,WALLS /TRUE
	EQUAL? PRSO,WHISTLE,WHITE-HOUSE,WILLOWS /TRUE
	EQUAL? PRSO,WINDOW,WISHBRINGER \FALSE
	RTRUE

	.FUNCT IS-LIGHT-OBJECT?
	EQUAL? PRSO,GLASSES,HAT,KEY /TRUE
	EQUAL? PRSO,LEAVES,OPEN-ENVELOPE,TICKET \FALSE
	RTRUE

	.FUNCT IS-PERSON?
	EQUAL? PRSO,BOOTS,CRISP,CROWD /TRUE
	EQUAL? PRSO,EVIL-ONE,FESTERON,GRAVEDIGGER /TRUE
	EQUAL? PRSO,HER,HIM,HUMANOIDS /TRUE
	EQUAL? PRSO,KING,MACGUFFIN,MISS-VOSS /TRUE
	EQUAL? PRSO,OLD-WOMAN,PLATYPUS,PRINCESS /TRUE
	EQUAL? PRSO,TROLL \FALSE
	RTRUE

	.FUNCT IS-ANIMAL?
	EQUAL? PRSO,ALEXIS,BABY,GOLDFISH /TRUE
	EQUAL? PRSO,HELLHOUND,HORSE,KITTY /TRUE
	EQUAL? PRSO,PELICAN,PIRANHA,POODLE /TRUE
	EQUAL? PRSO,VULTURE,WORM \FALSE
	RTRUE

	.FUNCT IS-SELF?
	EQUAL? PRSO,ME,PROTAGONIST \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? PRSO,HANDS \FALSE
	RTRUE

	.FUNCT IS-SELF-OR-PART-OF-SELF?,?TMP
	CALL IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-PART-OF-SELF? >STACK
	RSTACK

	.FUNCT DANGEROUS-DRINK?
	EQUAL? PRSO,CHEMICALS,MILK \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?
	CALL IS-PART-OF-SELF? >STACK
	ZERO? STACK \?L2
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	ZERO? STACK /FALSE
?L2:	EQUAL? PRSO,CHOCOLATE \TRUE
	RFALSE

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-ANIMAL? >STACK
	RSTACK

	.FUNCT GO
START::
?L0:	SET 'HERE,HILLTOP
	SET 'WINNER,PROTAGONIST
	SET 'SCORE,15
	SET 'MOVES,0
	CALL QUEUE,I-PROMPT-1,1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-PROMPT-2,10 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-CRISP-CALLING,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-VOSS-CALLING,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-BARKING,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-BEFORE-FIVE,-1 >STACK
	PUT STACK,0,1
	CALL RESET-THEM
	CRLF
	CALL INTRO
	PRINTI " Thermofax.

Only your Magick sword can save you now. You swing it high, speak the Word and stand unhurt as the blade absorbs the searing dragon-breath.

The reptile bellows with rage and flaps its wings to fan the fire in its belly. You are advancing, sword poised to strike, when a familiar voice shatters the daydream and stays your mighty hand..."
	CRLF
	CALL V-VERSION
	CRLF
	CALL V-LOOK
	CALL SOMEBODY-CALLING
	CALL DO-MAIN-LOOP
	JUMP ?L0

	.FUNCT DO-MAIN-LOOP,X
?L1:	CALL MAIN-LOOP >X
	JUMP ?L1

	.FUNCT MAIN-LOOP,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP,X
?L1:	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	CALL PARSER >P-WON
	ZERO? P-WON /?L3
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	ZERO? P-IT-OBJECT /?L5
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L5
	SET 'TMP,0
?L7:	IGRTR? 'CNT,ICNT /?L8
	GET P-PRSI,CNT >STACK
	EQUAL? STACK,IT \?L7
	PUT P-PRSI,CNT,P-IT-OBJECT
	SET 'TMP,1
?L8:	ZERO? TMP \?L18
	SET 'CNT,0
?L17:	IGRTR? 'CNT,OCNT /?L18
	GET P-PRSO,CNT >STACK
	EQUAL? STACK,IT \?L17
	PUT P-PRSO,CNT,P-IT-OBJECT
?L18:	SET 'CNT,0
?L5:	ZERO? OCNT \?L27
	SET 'NUM,OCNT
	JUMP ?L34
?L27:	GRTR? OCNT,1 \?L29
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L30
	SET 'OBJ,0
	JUMP ?L32
?L30:	GET P-PRSI,1 >OBJ
?L32:	SET 'NUM,OCNT
	JUMP ?L34
?L29:	GRTR? ICNT,1 \?L33
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L34
?L33:	SET 'NUM,1
?L34:	ZERO? OBJ \?L35
	EQUAL? ICNT,1 \?L35
	GET P-PRSI,1 >OBJ
?L35:	EQUAL? PRSA,V?WALK \?L38
	CALL PERFORM,PRSA,PRSO >V
	JUMP ?L58
?L38:	ZERO? NUM \?L40
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	ZERO? STACK \?L41
	CALL PERFORM,PRSA >V
	SET 'PRSO,0
	JUMP ?L58
?L41:	ZERO? LIT \?L43
	CALL PCLEAR
	CALL TOO-DARK
	JUMP ?L58
?L43:	CALL PCLEAR
	PRINTI "(There isn't anything to "
	GET P-ITBL,P-VERBN >TMP
	EQUAL? PRSA,V?TELL \?L47
	PRINTI "talk to"
	JUMP ?L53
?L47:	ZERO? P-MERGED \?L52
	ZERO? P-OFLAG /?L51
?L52:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L53
?L51:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK >V
?L53:	PRINTI "!)"
	CRLF
	SET 'V,0
	JUMP ?L58
?L40:	SET 'X,0
	SET 'TMP,0
?L57:	IGRTR? 'CNT,NUM \?L59
	GRTR? X,0 \?L61
	PRINTI "(The "
	EQUAL? X,NUM /?L65
	PRINTI "other "
?L65:	PRINTI "object"
	EQUAL? X,1 /?L72
	PRINTI "s"
?L72:	PRINTI " that you mentioned "
	EQUAL? X,1 /?L79
	PRINTI "are"
	JUMP ?L83
?L79:	PRINTI "is"
?L83:	PRINTI "n't here!)"
	CRLF
	JUMP ?L58
?L61:	ZERO? TMP \?L58
	CALL REFERRING
	JUMP ?L58
?L59:	ZERO? PTBL /?L91
	GET P-PRSO,CNT >OBJ1
	JUMP ?L93
?L91:	GET P-PRSI,CNT >OBJ1
?L93:	GRTR? NUM,1 /?L96
	GET P-ITBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL,W?EVERYTHING \?L102
?L96:	EQUAL? OBJ1,NOT-HERE-OBJECT \?L97
	INC 'X
	JUMP ?L57
?L97:	EQUAL? P-GETFLAGS,P-ALL \?L99
	CALL DONT-ALL?,OBJ1,OBJ >STACK
	ZERO? STACK \?L57
?L99:	CALL ACCESSIBLE?,OBJ1 >STACK
	ZERO? STACK /?L57
	EQUAL? OBJ1,PROTAGONIST /?L57
	EQUAL? OBJ1,IT \?L103
	FSET? P-IT-OBJECT,NARTICLEBIT /?L105
	PRINTI "The "
?L105:	PRINTD P-IT-OBJECT
	JUMP ?L110
?L103:	FSET? OBJ1,NARTICLEBIT /?L111
	PRINTI "The "
?L111:	PRINTD OBJ1
?L110:	PRINTI ": "
?L102:	SET 'TMP,1
	ZERO? PTBL /?L119
	SET 'PRSO,OBJ1
	JUMP ?L121
?L119:	SET 'PRSO,OBJ
?L121:	ZERO? PTBL /?L122
	SET 'PRSI,OBJ
	JUMP ?L124
?L122:	SET 'PRSI,OBJ1
?L124:	CALL PERFORM,PRSA,PRSO,PRSI >V
	EQUAL? V,M-FATAL \?L57
?L58:	CALL GAME-VERB? >STACK
	ZERO? STACK \?L132
	EQUAL? PRSA,V?AGAIN /?L132
	ZERO? P-OFLAG \?L132
	SET 'L-PRSA,PRSA
	SET 'L-PRSO,PRSO
	SET 'L-PRSI,PRSI
?L132:	EQUAL? V,M-FATAL \?L136
	SET 'P-CONT,0
	JUMP ?L136
?L3:	SET 'P-CONT,0
?L136:	ZERO? P-WON /?L142
	CALL GAME-VERB? >STACK
	ZERO? STACK \?L142
	EQUAL? PRSA,V?AGAIN \?L141
	CALL GAME-VERB?,L-PRSA >STACK
	ZERO? STACK \?L142
?L141:	CALL CLOCKER >V
?L142:	SET 'PRSA,0
	SET 'PRSO,0
	SET 'PRSI,0
	JUMP ?L1

	.FUNCT DONT-ALL?,O,I,L
	LOC O >L
	EQUAL? O,I /TRUE
	EQUAL? PRSA,V?TAKE \?L3
	EQUAL? L,PROTAGONIST /TRUE
	FSET? O,TAKEBIT /?L6
	FSET? O,TRYTAKEBIT \TRUE
?L6:	EQUAL? O,CAN-BOTTOM /TRUE
	ZERO? I /?L8
	EQUAL? L,I \TRUE
	CALL SEE-INSIDE?,I >STACK
	ZERO? STACK /TRUE
	RFALSE
?L8:	EQUAL? O,MILK,VULTURE /TRUE
	EQUAL? L,HERE /FALSE
	FSET? L,SURFACEBIT /FALSE
	FSET? L,ACTORBIT \TRUE
	RFALSE
?L3:	EQUAL? PRSA,V?DROP,V?PUT,V?PUT-ON /?L19
	EQUAL? PRSA,V?THROW \FALSE
?L19:	EQUAL? O,MILK,CAN-BOTTOM /TRUE
	EQUAL? L,PROTAGONIST,WINNER \TRUE
	RFALSE

	.FUNCT ENABLED?,RTN,C,E
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E /FALSE
	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L8
	GET C,C-ENABLED? >STACK
	ZERO? STACK \TRUE
	RFALSE
?L8:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT GAME-VERB?,V=0
	ZERO? V \?L1
	SET 'V,PRSA
?L1:	EQUAL? V,V?BRIEF,V?SCORE,V?VERBOSE /TRUE
	EQUAL? V,V?QUIT,V?RESTART,V?RESTORE /TRUE
	EQUAL? V,V?SAVE,V?SCRIPT,V?SUPER-BRIEF /TRUE
	EQUAL? V,V?TELL,V?UNSCRIPT,V?VERSION /TRUE
	EQUAL? V,V?TIME \FALSE
	RTRUE

	.FUNCT SPOKEN-TO,WHO
	CALL PCLEAR
	PRINTI "(spoken to "
	CALL ARTICLE,WHO,1
	PRINTD WHO
	PRINTR ")"

	.FUNCT ACCESSIBLE?,OBJ
	FSET? OBJ,INVISIBLE /FALSE
	CALL META-LOC,OBJ >STACK
	EQUAL? STACK,WINNER,HERE,GLOBAL-OBJECTS /TRUE
	CALL VISIBLE?,OBJ >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT VISIBLE?,OBJ,L
	LOC OBJ >L
	ZERO? L /FALSE
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? L,GLOBAL-OBJECTS /FALSE
	EQUAL? L,PROTAGONIST,HERE,WINNER /TRUE
	EQUAL? L,LOCAL-GLOBALS \?L6
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	ZERO? STACK \TRUE
?L6:	CALL SEE-INSIDE?,L >STACK
	ZERO? STACK /FALSE
	CALL VISIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT SEE-INSIDE?,CONTAINER
	FSET? CONTAINER,SURFACEBIT /TRUE
	FSET? CONTAINER,CONTBIT \?L3
	FSET? CONTAINER,OPENBIT /TRUE
	FSET? CONTAINER,TRANSBIT \FALSE
	RTRUE
?L3:	FSET? CONTAINER,ACTORBIT \FALSE
	EQUAL? CONTAINER,PROTAGONIST /FALSE
	RTRUE

	.FUNCT META-LOC,OBJ
?L1:	ZERO? OBJ /FALSE
	IN? OBJ,GLOBAL-OBJECTS \?L5
	RETURN GLOBAL-OBJECTS
?L5:	IN? OBJ,ROOMS \?L6
	RETURN OBJ
?L6:	FSET? OBJ,INVISIBLE /FALSE
	LOC OBJ >OBJ
	JUMP ?L1

	.FUNCT QUEUE,RTN,TICK,CINT
	CALL INT,RTN >CINT
	PUT CINT,C-TICK,TICK
	RETURN CINT

	.FUNCT INT,RTN,DEMON=0,E,C,INT?1
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	SUB C-INTS,C-INTLEN >C-INTS
	ZERO? DEMON /?L5
	SUB C-DEMONS,C-INTLEN >C-DEMONS
?L5:	ADD C-TABLE,C-INTS >INT?1
	PUT INT?1,C-RTN,RTN
	RETURN INT?1
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L7
	RETURN C
?L7:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT CLOCKER,C,E,I,TICK,FLG=0
	ZERO? CLOCK-WAIT /?L1
	SET 'CLOCK-WAIT,0
	RFALSE
?L1:	ZERO? P-WON /?L4
	PUSH C-INTS
	JUMP ?L6
?L4:	PUSH C-DEMONS
?L6:	ADD C-TABLE,STACK >C
	ADD C-TABLE,C-TABLELEN >E
	ZERO? ECLIPSE? /?L9
	CALL INT,I-ECLIPSE >I
	GET I,C-ENABLED? >STACK
	ZERO? STACK /?L9
	GET I,C-TICK >STACK
	LESS? STACK,2 \?L9
	GET I,C-RTN >STACK
	CALL STACK >STACK
?L9:	EQUAL? C,E \?L15
	EQUAL? HERE,INSIDE-SHOPPE \?L19
	FSET? CLOCK,RMUNGBIT \?L22
?L19:	INC 'GMOVES
	IGRTR? 'MOVES,59 \?L22
	SET 'MOVES,0
	IGRTR? 'SCORE,23 \?L22
	SET 'SCORE,0
?L22:	RETURN FLG
?L15:	GET C,C-ENABLED? >STACK
	ZERO? STACK /?L31
	GET C,C-TICK >TICK
	ZERO? TICK /?L31
	SUB TICK,1 >STACK
	PUT C,C-TICK,STACK
	GRTR? TICK,1 /?L31
	GET C,C-RTN >STACK
	CALL STACK >STACK
	ZERO? STACK /?L31
	SET 'FLG,1
?L31:	ADD C,C-INTLEN >C
	JUMP ?L9

	.FUNCT CARRIAGE-RETURNS,CNT=22
	CALL RESET-THEM
?L1:	CRLF
	DEC 'CNT
	ZERO? CNT \?L1
	RTRUE

	.FUNCT RESET-THEM
	CALL PCLEAR
	SET 'P-IT-OBJECT,NOT-HERE-OBJECT
	SET 'P-HIM-OBJECT,NOT-HERE-OBJECT
	SET 'P-HER-OBJECT,NOT-HERE-OBJECT
	SET 'P-THEM-OBJECT,NOT-HERE-OBJECT
	RETURN P-THEM-OBJECT

	.FUNCT PCLEAR
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RETURN QUOTE-FLAG

	.FUNCT PARSER,PTR=P-LEXSTART,WRD,VAL=0,VERB=0,BOTTOM=0,LEN,DIR=0,NW=0,LW=0,NUM,SCNT,CNT=-1,OWINNER,OF-FLAG=0
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'P-NUMBER,-1
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADVERB,0
	SET 'P-MERGED,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	SET 'OWINNER,WINNER
	ZERO? QUOTE-FLAG \?L6
	EQUAL? WINNER,PROTAGONIST /?L6
	SET 'L-WINNER,WINNER
	SET 'WINNER,PROTAGONIST
	SET 'LAST-PLAYER-LOC,HERE
	LOC WINNER >HERE
	CALL LIT?,HERE >LIT
?L6:	ZERO? P-CONT /?L9
	SET 'PTR,P-CONT
	SET 'P-CONT,0
	ZERO? SAYING? /?L11
	SET 'SAYING?,0
	JUMP ?L15
?L11:	ZERO? SUPER-BRIEF \?L15
	EQUAL? PROTAGONIST,WINNER \?L15
	CRLF
	JUMP ?L15
?L9:	SET 'SAYING?,0
	SET 'L-WINNER,WINNER
	SET 'WINNER,PROTAGONIST
	SET 'QUOTE-FLAG,0
	SET 'LAST-PLAYER-LOC,HERE
	LOC WINNER >HERE
	CALL LIT?,HERE >LIT
	ZERO? SUPER-BRIEF \?L16
	CRLF
?L16:	ZERO? P-PROMPT /?L19
	ZERO? P-OFLAG \?L19
	EQUAL? P-PROMPT,2 \?L21
	PRINT OKAY
	PRINTI "what do you want to do now?"
	JUMP ?L25
?L21:	PRINTI "What next?"
?L25:	CRLF
?L19:	PUTB P-LEXV,0,59
	PRINTI ">"
	READ P-INBUF,P-LEXV
?L15:	GETB P-LEXV,P-LEXWORDS >P-LEN
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?$QUOTE \?L31
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L31:	GET P-LEXV,PTR >STACK
	EQUAL? W?THEN,STACK \?L34
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L34:	LESS? 1,P-LEN \?L37
	GET P-LEXV,PTR >STACK
	EQUAL? W?GO,STACK \?L37
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
	ZERO? NW /?L37
	CALL WT?,NW,PS?VERB,P1?VERB >STACK
	ZERO? STACK /?L37
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L37:	ZERO? P-LEN \?L40
	PRINTI "Beg pardon?"
	CRLF
	RFALSE
?L40:	SET 'LEN,P-LEN
	SET 'P-DIR,0
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
	SET 'BOTTOM,0
	PUT P-ITBL,P-VERBN,0
?L45:	DLESS? 'P-LEN,0 \?L47
	SET 'QUOTE-FLAG,0
	JUMP ?L46
?L47:	GET P-LEXV,PTR >WRD
	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	ZERO? WRD \?L51
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L50
?L51:	EQUAL? WRD,W?TO \?L52
	EQUAL? VERB,ACT?TELL,ACT?ASK \?L52
	SET 'VERB,ACT?TELL
	SET 'WRD,W?$QUOTE
	JUMP ?L54
?L52:	EQUAL? WRD,W?THEN \?L54
	ZERO? VERB \?L54
	ZERO? QUOTE-FLAG \?L54
	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WRD,W?$QUOTE
?L54:	EQUAL? WRD,W?$PERIOD \?L56
	EQUAL? LW,W?MR,W?MS,W?SGT \?L56
	SET 'LW,0
	JUMP ?L109
?L56:	EQUAL? WRD,W?THEN,W?$PERIOD,W?$QUOTE \?L58
	EQUAL? WRD,W?$QUOTE \?L63
	ZERO? QUOTE-FLAG /?L61
	SET 'QUOTE-FLAG,0
	JUMP ?L63
?L61:	SET 'QUOTE-FLAG,1
?L63:	ZERO? P-LEN /?L65
	ADD PTR,P-LEXELEN >P-CONT
?L65:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L46
?L58:	CALL WT?,WRD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L67
	EQUAL? VERB,0,ACT?WALK \?L67
	EQUAL? LEN,1 /?L68
	EQUAL? LEN,2 \?L69
	EQUAL? VERB,ACT?WALK /?L68
?L69:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
	EQUAL? NW,W?THEN,W?$PERIOD,W?$QUOTE \?L70
	GRTR? LEN,1 /?L68
?L70:	ZERO? QUOTE-FLAG /?L71
	EQUAL? LEN,2 \?L71
	EQUAL? NW,W?$QUOTE /?L68
?L71:	GRTR? LEN,2 \?L67
	EQUAL? NW,W?$COMMA,W?AND \?L67
?L68:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L72
	ADD PTR,P-LEXELEN >STACK
	PUT P-LEXV,STACK,W?THEN
?L72:	GRTR? LEN,2 /?L109
	SET 'QUOTE-FLAG,0
	JUMP ?L46
?L67:	CALL WT?,WRD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L78
	ZERO? VERB \?L78
	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WRD
	MUL PTR,2 >STACK
	ADD STACK,2 >NUM
	GETB P-LEXV,NUM >STACK
	PUTB P-VTBL,2,STACK
	ADD NUM,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L109
?L78:	CALL WT?,WRD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L80
	EQUAL? WRD,W?A,W?BOTH,W?ALL /?L81
	EQUAL? WRD,W?EVERYTHING /?L81
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L81
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L79
?L81:	SET 'VAL,0
?L80:	GRTR? P-LEN,1 \?L82
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?OF \?L82
	EQUAL? VERB,ACT?TAKE /?L82
	ZERO? VAL \?L119
	EQUAL? WRD,W?A,W?ALL,W?BOTH /?L82
	EQUAL? WRD,W?EVERYTHING /?L82
	EQUAL? WRD,W?BOTTOM \?L84
	SET 'BOTTOM,1
?L84:	SET 'OF-FLAG,1
	JUMP ?L109
?L82:	ZERO? VAL /?L87
?L119:	ZERO? P-LEN /?L88
	ADD PTR,2 >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?THEN,W?$PERIOD \?L87
?L88:	LESS? P-NCN,2 \?L109
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WRD
	JUMP ?L109
?L87:	EQUAL? P-NCN,2 \?L92
	PRINTI "(There are too many nouns in that sentence!)"
	CRLF
	RFALSE
?L92:	INC 'P-NCN
	CALL CLAUSE,PTR,VAL,WRD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L109
	SET 'QUOTE-FLAG,0
	JUMP ?L46
?L79:	EQUAL? WRD,W?OF \?L101
	ZERO? OF-FLAG /?L104
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?THEN \?L102
?L104:	CALL CANT-USE,PTR
	RFALSE
?L102:	SET 'OF-FLAG,0
	JUMP ?L109
?L101:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L109
	EQUAL? VERB,ACT?TELL \?L107
	CALL WT?,WRD,PS?VERB,P1?VERB >STACK
	ZERO? STACK /?L107
	CALL WAY-TO-TALK
	RFALSE
?L107:	CALL CANT-USE,PTR
	RFALSE
?L50:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L109:	SET 'LW,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L45
?L46:	ZERO? DIR /?L110
	SET 'PRSA,V?WALK
	SET 'P-WALK-DIR,DIR
	SET 'PRSO,DIR
	SET 'P-OFLAG,0
	RTRUE
?L110:	SET 'P-WALK-DIR,0
	ZERO? P-OFLAG /?L113
	CALL ORPHAN-MERGE >STACK
	ZERO? STACK /?L113
	SET 'WINNER,OWINNER
	JUMP ?L115
?L113:	SET 'BOTTOM?,BOTTOM
?L115:	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT WAY-TO-TALK
	CALL REFER-TO-MANUAL
	PRINTR " for the correct way to talk to characters.)"

	.FUNCT WT?,PTR,BIT,B1=5,OFFS=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L6
	INC 'OFFS
?L6:	GETB PTR,OFFS >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WRD,OFF,NUM,ANDFLG=0,FIRST??=1,NW,LW=0
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L1
	ADD P-PREP1,OFF >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'P-LEN
?L3:	ZERO? P-LEN \?L4
	DEC 'P-NCN
	RETURN -1
?L4:	ADD P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L7
	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
?L7:	DLESS? 'P-LEN,0 \?L12
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L12:	GET P-LEXV,PTR >WRD
	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	ZERO? WRD \?L18
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L17
?L18:	ZERO? P-LEN \?L19
	SET 'NW,0
	JUMP ?L21
?L19:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L21:	EQUAL? WRD,W?$PERIOD \?L22
	EQUAL? LW,W?MR,W?MS,W?SGT \?L22
	SET 'LW,0
	JUMP ?L44
?L22:	EQUAL? WRD,W?AND,W?$COMMA \?L24
	SET 'ANDFLG,1
	JUMP ?L44
?L24:	EQUAL? WRD,W?ALL,W?BOTH,W?EVERYTHING \?L25
	EQUAL? NW,W?OF \?L44
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L44
?L25:	EQUAL? WRD,W?THEN,W?$PERIOD /?L30
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L29
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK /?L29
	ZERO? FIRST?? \?L29
?L30:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L29:	ZERO? ANDFLG /?L31
	GET P-ITBL,P-VERBN >STACK
	ZERO? STACK /?L32
	CALL VERB-DIR-ONLY?,WRD >STACK
	ZERO? STACK /?L31
?L32:	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	PUT P-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L44
?L31:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L33
	GRTR? P-LEN,0 \?L34
	EQUAL? NW,W?OF \?L34
	EQUAL? WRD,W?ALL,W?EVERYTHING \?L44
?L34:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L36
	ZERO? NW /?L36
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L44
?L36:	ZERO? ANDFLG \?L37
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L37
	EQUAL? NW,W?$COMMA /?L37
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L37:	SET 'ANDFLG,0
	JUMP ?L44
?L33:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L44
	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L44
	ZERO? ANDFLG /?L41
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK \?L41
	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	PUT P-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L44
?L41:	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK \?L44
	CALL CANT-USE,PTR
	RFALSE
?L17:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L44:	SET 'LW,WRD
	SET 'FIRST??,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT THIS-IS-IT,OBJ
	EQUAL? OBJ,0,PROTAGONIST,NOT-HERE-OBJECT /TRUE
	EQUAL? OBJ,INTDIR /TRUE
	EQUAL? PRSA,V?WALK,V?WALK-TO \?L4
	EQUAL? OBJ,PRSO /TRUE
?L4:	EQUAL? OBJ,CHAINS,GLASSES,BOOTS /?L6
	EQUAL? OBJ,CROWD,MONUMENTS,HUMANOIDS /?L6
	EQUAL? OBJ,VAPORS,INSTRUMENTS,SHARKS \?L5
?L6:	SET 'P-IT-OBJECT,OBJ
	SET 'P-THEM-OBJECT,OBJ
	RTRUE
?L5:	EQUAL? OBJ,MISS-VOSS,OLD-WOMAN,EVIL-ONE \?L7
	SET 'P-HER-OBJECT,OBJ
	RTRUE
?L7:	EQUAL? OBJ,KITTY,CHAOS,PRINCESS \?L8
	SET 'P-IT-OBJECT,OBJ
	SET 'P-HER-OBJECT,OBJ
	RTRUE
?L8:	EQUAL? OBJ,CRISP,GRAVEDIGGER,MACGUFFIN \?L9
	SET 'P-HIM-OBJECT,OBJ
	RTRUE
?L9:	EQUAL? OBJ,TROLL,KING,VULTURE /?L11
	EQUAL? OBJ,GOLDFISH,PIRANHA,HORSE \?L10
?L11:	SET 'P-IT-OBJECT,OBJ
	SET 'P-HIM-OBJECT,OBJ
	RTRUE
?L10:	SET 'P-IT-OBJECT,OBJ
	RTRUE

	.FUNCT FAKE-ORPHAN,TMP
	CALL ORPHAN,P-SYNTAX,0
	CALL BE-SPECIFIC
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	JUMP ?L6
?L1:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L5
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L6
?L5:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L6:	SET 'P-OFLAG,1
	SET 'P-WON,0
	PRINTR "?)"

	.FUNCT SEE-VERB?
	EQUAL? PRSA,V?LOOK,V?EXAMINE,V?LOOK-INSIDE /TRUE
	EQUAL? PRSA,V?SEARCH,V?FIND,V?LOOK-ON /TRUE
	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-BEHIND,V?READ /TRUE
	EQUAL? PRSA,V?LOOK-THRU,V?LOOK-DOWN,V?COUNT \FALSE
	RTRUE

	.FUNCT PERFORM,A,O=0,I=0,V=0,OA,OO,OI
	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	SET 'PRSA,A
	ZERO? LIT \?L1
	CALL SEE-VERB? >STACK
	ZERO? STACK /?L1
	CALL TOO-DARK
	RETURN 2
?L1:	ZERO? IMMOBILIZED? /?L5
	CALL SEE-VERB? >STACK
	ZERO? STACK \?L5
	CALL GAME-VERB? >STACK
	ZERO? STACK \?L5
	EQUAL? PRSA,V?AGAIN /?L5
	PRINTI "Your body seems unwilling to respond."
	CRLF
	RETURN 2
?L5:	EQUAL? A,V?WALK /?L73
	EQUAL? IT,I,O \?L11
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK \?L11
	ZERO? I \?L13
	CALL FAKE-ORPHAN
	RETURN 2
?L13:	CALL CANT-SEE-ANY,P-IT-OBJECT
	RETURN 2
?L11:	EQUAL? THEM,I,O \?L29
	CALL VISIBLE?,P-THEM-OBJECT >STACK
	ZERO? STACK /?L21
	EQUAL? THEM,O \?L23
	SET 'O,P-THEM-OBJECT
?L23:	EQUAL? THEM,I \?L29
	SET 'I,P-THEM-OBJECT
	JUMP ?L29
?L21:	ZERO? I \?L30
	CALL FAKE-ORPHAN
	RETURN 2
?L30:	CALL CANT-SEE-ANY,P-THEM-OBJECT
	RETURN 2
?L29:	EQUAL? HER,I,O \?L46
	CALL VISIBLE?,P-HER-OBJECT >STACK
	ZERO? STACK /?L38
	EQUAL? HER,O \?L40
	SET 'O,P-HER-OBJECT
?L40:	EQUAL? HER,I \?L46
	SET 'I,P-HER-OBJECT
	JUMP ?L46
?L38:	ZERO? I \?L47
	CALL FAKE-ORPHAN
	RETURN 2
?L47:	CALL CANT-SEE-ANY,P-HER-OBJECT
	RETURN 2
?L46:	EQUAL? HIM,I,O \?L63
	CALL VISIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK /?L55
	EQUAL? HIM,O \?L57
	SET 'O,P-HIM-OBJECT
?L57:	EQUAL? HIM,I \?L63
	SET 'I,P-HIM-OBJECT
	JUMP ?L63
?L55:	ZERO? I \?L64
	CALL FAKE-ORPHAN
	RETURN 2
?L64:	CALL CANT-SEE-ANY,P-HIM-OBJECT
	RETURN 2
?L63:	EQUAL? O,IT \?L70
	SET 'O,P-IT-OBJECT
?L70:	EQUAL? I,IT \?L73
	SET 'I,P-IT-OBJECT
?L73:	SET 'PRSI,I
	SET 'PRSO,O
	SET 'V,0
	EQUAL? A,V?WALK /?L79
	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \?L79
	CALL NOT-HERE-OBJECT-F >V
	ZERO? V /?L79
	SET 'P-WON,0
?L79:	CALL THIS-IS-IT,PRSI
	CALL THIS-IS-IT,PRSO
	SET 'O,PRSO
	SET 'I,PRSI
	ZERO? V \?L116
	GETP WINNER,P?ACTION >STACK
	CALL STACK,M-WINNER >V
	ZERO? V \?L116
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-BEG >V
	ZERO? V \?L116
	GET PREACTIONS,A >STACK
	CALL STACK >V
	ZERO? V \?L116
	EQUAL? WINNER,PROTAGONIST /?L92
	GET ACTIONS,A >STACK
	CALL STACK >STACK
	SET 'V,1
?L92:	ZERO? V \?L116
	ZERO? I /?L97
	EQUAL? A,V?WALK /?L97
	LOC I >STACK
	ZERO? STACK /?L97
	LOC I >STACK
	GETP STACK,P?CONTFCN >V
	ZERO? V /?L119
	CALL V,M-CONT >V
?L97:	ZERO? V \?L116
?L119:	ZERO? I /?L101
	GETP I,P?ACTION >STACK
	CALL STACK >V
?L101:	ZERO? V \?L116
	ZERO? O /?L106
	EQUAL? A,V?WALK /?L106
	LOC O >STACK
	ZERO? STACK /?L106
	LOC O >STACK
	GETP STACK,P?CONTFCN >V
	ZERO? V /?L120
	CALL V,M-CONT >V
?L106:	ZERO? V \?L116
?L120:	ZERO? O /?L112
	EQUAL? A,V?WALK /?L112
	GETP O,P?ACTION >STACK
	CALL STACK >V
	ZERO? V /?L121
	CALL THIS-IS-IT,O
?L112:	ZERO? V \?L116
?L121:	GET ACTIONS,A >STACK
	CALL STACK >V
?L116:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT BUZZER-WORD?,WORD
	CALL QUESTION-WORD?,WORD >STACK
	ZERO? STACK \TRUE
	CALL NAUGHTY-WORD?,WORD >STACK
	ZERO? STACK \TRUE
	CALL MAGIC-WORD?,WORD >STACK
	ZERO? STACK \TRUE
	EQUAL? WORD,W?NW,W?NORTHW,W?NE /?L6
	EQUAL? WORD,W?SW,W?SOUTHW,W?NORTHE /?L6
	EQUAL? WORD,W?SE,W?SOUTHE \?L5
?L6:	CALL V-BAD-DIRECTION
	RTRUE
?L5:	EQUAL? WORD,W?MOUSE,W?RAT,W?RODENT \?L7
	EQUAL? HERE,INSIDE-CHURCH \?L8
	FSET? CHURCH,TOUCHBIT /?L8
	PRINTR "It disappeared before you could get a good look."
?L8:	CALL CANT-SEE-ANY
	RTRUE
?L7:	CALL SESAME?,WORD >STACK
	ZERO? STACK \TRUE
	EQUAL? WORD,W?FUZZY,W?BLURRY,W?BLURRED \?L14
	ZERO? FUZZY? \?L14
	PRINT YOU-SEE
	PRINTI "nothing "
	PRINTB WORD
	PRINTR " here!"
?L14:	EQUAL? WORD,W?CORKY \FALSE
	IN? CRISP,HERE \?L20
	PRINTD CRISP
	PRINTI " reddens. ""Don't use that name in front of me!"""
	CALL PRINT-ID,STR?8
	CRLF
	RTRUE
?L20:	PRINTI "("
	PRINTD CRISP
	PRINTI " hates it when you use that name!)"
	CALL PRINT-ID,STR?9
	CRLF
	RTRUE

	.FUNCT SESAME?,WORD,MWORD
	EQUAL? WORD,W?KALUZE,W?FRATTO,W?SORKIN \FALSE
	ZERO? POWER \?L3
	SET 'MWORD,W?KALUZE
	JUMP ?L6
?L3:	EQUAL? POWER,1 \?L5
	SET 'MWORD,W?FRATTO
	JUMP ?L6
?L5:	SET 'MWORD,W?SORKIN
?L6:	ZERO? SKEWED? /?L9
	EQUAL? HERE,HILLTOP \?L9
	EQUAL? WORD,MWORD /?L7
?L9:	PRINTI "(The word """
	PRINTB WORD
	PRINTR """ isn't useful here.)"
?L7:	FSET? PELICAN,RMUNGBIT \?L14
	CALL SAY-THE,DRAWBRIDGE
	PRINTI " decides that you're only guessing the word """
	PRINTB WORD
	PRINTR ","" and refuses to cooperate."
?L14:	FSET? DRAWBRIDGE,RMUNGBIT \?L19
	CALL NOTHING-EXCITING
	RTRUE
?L19:	ZERO? ECLIPSE? /?L20
	CALL DARK-IS-POWERFUL
	RTRUE
?L20:	FSET DRAWBRIDGE,RMUNGBIT
	FSET DRAWBRIDGE,OPENBIT
	PRINTI "With a great creak of wood and rattle of chains, the "
	PRINTD DRAWBRIDGE
	PRINTI " slowly lowers across the moat."
	CRLF
	CRLF
	CALL UPDATE-SCORE,3
	CALL GOOD-PLACE-TO-SAVE
	RTRUE

	.FUNCT QUESTION-WORD?,WORD
	EQUAL? WORD,W?WHERE \?L1
	CALL TO-DO-THING-USE,STR?11,STR?10
	RTRUE
?L1:	EQUAL? WORD,W?WHAT,W?WHAT$0027S,W?WHO /?L4
	EQUAL? WORD,W?WHO$0027S,W?WHY,W?HOW /?L4
	EQUAL? WORD,W?WHEN,W?WHEN$0027S,W?AM /?L4
	EQUAL? WORD,W?WOULD,W?COULD,W?SHOULD \?L3
?L4:	CALL TO-DO-THING-USE,STR?13,STR?12
	RTRUE
?L3:	EQUAL? WORD,W?THAT$0027S,W?IT$0027S,W?I$0027M /?L6
	EQUAL? WORD,W?IS,W?DID,W?ARE /?L6
	EQUAL? WORD,W?DO,W?HAVE,W?ANY /?L6
	EQUAL? WORD,W?WILL,W?WAS,W?WERE /?L6
	EQUAL? WORD,W?I$0027LL,W?WHICH,W?WE$0027RE /?L6
	EQUAL? WORD,W?I$0027VE,W?WON$0027T,W?HAS /?L6
	EQUAL? WORD,W?YOU$0027RE,W?HE$0027S,W?SHE$0027S /?L6
	EQUAL? WORD,W?THEY$0027RE,W?SHALL \FALSE
?L6:	PRINTR "(Please use commands, not statements or questions.)"

	.FUNCT NAUGHTY-WORD?,WORD
	EQUAL? WORD,W?CURSE,W?GODDAMNED,W?CUSS /?L3
	EQUAL? WORD,W?DAMN,W?SHIT,W?FUCK /?L3
	EQUAL? WORD,W?SHITHEAD,W?PISS,W?SUCK /?L3
	EQUAL? WORD,W?BASTARD,W?SCREW,W?FUCKING /?L3
	EQUAL? WORD,W?DAMNED,W?PEE,W?COCKSUCKER /?L3
	EQUAL? WORD,W?FUCKED,W?CUNT,W?ASSHOLE /?L3
	EQUAL? WORD,W?BITCH \FALSE
?L3:	PRINTI "("
	CALL PICK-ONE,OFFENDED >STACK
	PRINT STACK
	CALL PRINT-ID,STR?14 >STACK
	PRINT STACK
	PRINTR ".)"

	.FUNCT MAGIC-WORD?,WORD
	EQUAL? WORD,W?PLUGH,W?XYZZY,W?YOHO /?L3
	EQUAL? WORD,W?ECHO,W?ODYSSEUS,W?ULYSSES /?L3
	EQUAL? WORD,W?SAILOR,W?ZORK,W?OZMOO \FALSE
?L3:	PRINTR "A hollow voice says, ""Fool!"""

	.FUNCT VERB-DIR-ONLY?,WRD,?TMP
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK \FALSE
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \FALSE
	CALL WT?,WRD,PS?DIRECTION >?TMP
	ZERO? ?TMP /?L5
	RETURN ?TMP
?L5:	CALL WT?,WRD,PS?VERB >STACK
	RSTACK

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0,TIM=0,DOLLAR=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L1:	DLESS? 'CNT,0 /?L2
	GETB P-INBUF,BPTR >CHR
	EQUAL? CHR,58 \?L6
	SET 'TIM,SUM
	SET 'SUM,0
	JUMP ?L12
?L6:	GRTR? SUM,9999 /FALSE
	EQUAL? CHR,CURRENCY-SYMBOL \?L9
	SET 'DOLLAR,1
	JUMP ?L12
?L9:	GRTR? CHR,57 /FALSE
	LESS? CHR,48 /FALSE
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
?L12:	INC 'BPTR
	JUMP ?L1
?L2:	PUT P-LEXV,PTR,W?INTNUM
	GRTR? SUM,9999 /FALSE
	ZERO? TIM /?L15
	GRTR? TIM,23 /FALSE
	MUL TIM,60 >STACK
	ADD SUM,STACK >SUM
?L15:	SET 'P-DOLLAR-FLAG,DOLLAR
	ZERO? DOLLAR /?L20
	GRTR? SUM,0 \?L20
	SET 'P-AMOUNT,SUM
	RETURN W?MONEY
?L20:	SET 'P-NUMBER,SUM
	SET 'P-DOLLAR-FLAG,0
	RETURN W?INTNUM

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,WRD
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >WRD
	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L1
	SET 'ADJ,1
	JUMP ?L3
?L1:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L3
	ZERO? P-NCN \?L3
	PUT P-ITBL,P-VERB,0
	PUT P-ITBL,P-VERBN,0
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
	SET 'P-NCN,1
?L3:	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L5
	ZERO? ADJ \?L5
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L5:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L8
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP1 >STACK
	EQUAL? TEMP,STACK /?L11
	ZERO? TEMP \FALSE
?L11:	ZERO? ADJ /?L12
	ADD P-LEXV,2 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L14
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L14:	ZERO? P-NCN \?L20
	SET 'P-NCN,1
	JUMP ?L20
?L12:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
?L20:	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L41
?L8:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L22
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP2 >STACK
	EQUAL? TEMP,STACK /?L25
	ZERO? TEMP \FALSE
?L25:	ZERO? ADJ /?L28
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L28
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L28:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L41
?L22:	ZERO? P-ACLAUSE /?L41
	EQUAL? P-NCN,1 /?L34
	ZERO? ADJ \?L34
	SET 'P-ACLAUSE,0
	RFALSE
?L34:	GET P-ITBL,P-NC1 >BEG
	ZERO? ADJ /?L37
	ADD P-LEXV,2 >BEG
	SET 'ADJ,0
?L37:	GET P-ITBL,P-NC1L >END
?L40:	GET BEG,0 >WRD
	EQUAL? BEG,END \?L42
	ZERO? ADJ /?L44
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L41
?L44:	SET 'P-ACLAUSE,0
	RFALSE
?L42:	ZERO? ADJ \?L47
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE /?L48
	EQUAL? WRD,W?ALL,W?EVERYTHING \?L47
?L48:	SET 'ADJ,WRD
	JUMP ?L49
?L47:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT \?L49
	EQUAL? WRD,P-ANAM \?L50
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L41
?L50:	CALL NCLAUSE-WIN
	JUMP ?L41
?L49:	ADD BEG,P-WORDLEN >BEG
	ZERO? END \?L40
	SET 'END,BEG
	SET 'P-NCN,1
	SUB BEG,4 >STACK
	PUT P-ITBL,P-NC1,STACK
	PUT P-ITBL,P-NC1L,BEG
	JUMP ?L40
?L41:	GET P-OVTBL,0 >STACK
	PUT P-VTBL,0,STACK
	GETB P-OVTBL,2 >STACK
	PUTB P-VTBL,2,STACK
	GETB P-OVTBL,3 >STACK
	PUTB P-VTBL,3,STACK
	PUT P-OTBL,P-VERBN,P-VTBL
	PUTB P-VTBL,2,0
?L58:	IGRTR? 'CNT,P-ITBLLEN \?L60
	SET 'P-MERGED,1
	RTRUE
?L60:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L58

	.FUNCT ACLAUSE-WIN,ADJ
	GET P-OTBL,P-VERB >STACK
	PUT P-ITBL,P-VERB,STACK
	PUT P-CCTBL,CC-SBPTR,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-SEPTR,STACK
	PUT P-CCTBL,CC-DBPTR,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-DEPTR,STACK
	CALL CLAUSE-COPY,P-OTBL,P-OTBL,ADJ
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'P-NCN,2
?L1:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT NCLAUSE-WIN
	PUT P-CCTBL,CC-SBPTR,P-NC1
	PUT P-CCTBL,CC-SEPTR,P-NC1L
	PUT P-CCTBL,CC-DBPTR,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-DEPTR,STACK
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'P-NCN,2
?L1:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,MSG,?TMP
	CALL PICK-ONE,UNKNOWN-MSGS >MSG
	PRINTI "("
	GET MSG,0 >STACK
	PRINT STACK
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	GET MSG,1 >STACK
	PRINT STACK
	PRINTR ")"

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	CALL NOT-IN-SENTENCE,STR?15
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L4:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	GRTR? P-NCN,NUM /?L13
	LESS? NUM,1 /?L8
	ZERO? P-NCN \?L8
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L9
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L8
?L9:	SET 'DRIVE1,SYN
	JUMP ?L13
?L8:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L13
	EQUAL? NUM,2 \?L11
	EQUAL? P-NCN,1 \?L11
	SET 'DRIVE2,SYN
	JUMP ?L13
?L11:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L13
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L13:	DLESS? 'LEN,1 \?L16
	ZERO? DRIVE1 \?L58
	ZERO? DRIVE2 \?L5
	CALL DONT-UNDERSTAND
	RFALSE
?L16:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L4
?L5:	ZERO? DRIVE1 /?L23
?L58:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L23
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L23:	ZERO? DRIVE2 /?L25
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L25
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L25:	EQUAL? VERB,ACT?FIND \?L26
	PRINTI "That's your problem!"
	CRLF
	RFALSE
?L26:	EQUAL? WINNER,PROTAGONIST \?L30
	CALL ORPHAN,DRIVE1,DRIVE2
	PRINTI "(Wh"
	EQUAL? VERB,ACT?WALK \?L34
	PUSH STR?16
	JUMP ?L36
?L34:	PUSH STR?17
?L36:	PRINT STACK
	PRINTI " do you want to "
	JUMP ?L37
?L30:	PRINTI "(Your command wasn't complete. Next time, type wh"
	EQUAL? VERB,ACT?WALK \?L40
	PUSH STR?16
	JUMP ?L42
?L40:	PUSH STR?17
?L42:	PRINT STACK
	PRINTI " you want "
	CALL ARTICLE,WINNER,1
	PRINTD WINNER
	PRINTI " to "
?L37:	CALL VERB-PRINT
	ZERO? DRIVE2 /?L45
	CALL CLAUSE-PRINT,P-NC1,P-NC1L
?L45:	ZERO? DRIVE1 /?L48
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L50
?L48:	GETB DRIVE2,P-SPREP2 >STACK
?L50:	CALL PREP-PRINT,STACK
	EQUAL? WINNER,PROTAGONIST \?L51
	SET 'P-OFLAG,1
	PRINTI "?)"
	CRLF
	RFALSE
?L51:	SET 'P-OFLAG,0
	PRINTI ".)"
	CRLF
	RFALSE

	.FUNCT VERB-PRINT,TMP
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	RTRUE
?L1:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L5
	GET TMP,0 >STACK
	PRINTB STACK
	RTRUE
?L5:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
	RTRUE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	ZERO? P-MERGED \?L1
	PUT P-OCLAUSE,P-MATCHLEN,0
?L1:	GET P-VTBL,0 >STACK
	PUT P-OVTBL,0,STACK
	GETB P-VTBL,2 >STACK
	PUTB P-OVTBL,2,STACK
	GETB P-VTBL,3 >STACK
	PUTB P-OVTBL,3,STACK
?L4:	IGRTR? 'CNT,P-ITBLLEN /?L5
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L4
?L5:	EQUAL? P-NCN,2 \?L9
	PUT P-CCTBL,CC-SBPTR,P-NC2
	PUT P-CCTBL,CC-SEPTR,P-NC2L
	PUT P-CCTBL,CC-DBPTR,P-NC2
	PUT P-CCTBL,CC-DEPTR,P-NC2L
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L9:	LESS? P-NCN,1 /?L12
	PUT P-CCTBL,CC-SBPTR,P-NC1
	PUT P-CCTBL,CC-SEPTR,P-NC1L
	PUT P-CCTBL,CC-DBPTR,P-NC1
	PUT P-CCTBL,CC-DEPTR,P-NC1L
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L12:	ZERO? D1 /?L15
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L15:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT CLAUSE-PRINT,BPTR,EPTR,THE?=1
	GET P-ITBL,EPTR >STACK
	GET P-ITBL,BPTR >STACK
	CALL BUFFER-PRINT,STACK,STACK,THE? >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=0,WRD,FIRST??=1,PN=0
?L1:	EQUAL? BEG,END /TRUE
	ZERO? NOSP /?L6
	SET 'NOSP,0
	JUMP ?L8
?L6:	PRINTI " "
?L8:	GET BEG,0 >WRD
	EQUAL? WRD,W?HIM \?L14
	CALL VISIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK /?L13
?L14:	EQUAL? WRD,W?HER \?L15
	CALL VISIBLE?,P-HER-OBJECT >STACK
	ZERO? STACK /?L13
?L15:	EQUAL? WRD,W?THEM \?L11
	CALL VISIBLE?,P-THEM-OBJECT >STACK
	ZERO? STACK \?L11
?L13:	SET 'PN,1
?L11:	EQUAL? WRD,W?$PERIOD \?L17
	SET 'NOSP,1
	JUMP ?L21
?L17:	EQUAL? WRD,W?ME \?L19
	PRINTD PROTAGONIST
	SET 'PN,1
	JUMP ?L21
?L19:	CALL NAME?,WRD >STACK
	ZERO? STACK /?L20
	CALL CAPITALIZE,BEG
	SET 'PN,1
	JUMP ?L21
?L20:	ZERO? FIRST?? /?L22
	ZERO? PN \?L22
	ZERO? CP /?L22
	PRINTI "the "
?L22:	ZERO? P-OFLAG \?L29
	ZERO? P-MERGED /?L27
?L29:	PRINTB WRD
	JUMP ?L34
?L27:	EQUAL? WRD,W?IT \?L30
	CALL VISIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L30
	PRINTD P-IT-OBJECT
	JUMP ?L34
?L30:	EQUAL? WRD,W?HER \?L31
	ZERO? PN \?L31
	PRINTD P-HER-OBJECT
	JUMP ?L34
?L31:	EQUAL? WRD,W?THEM \?L32
	ZERO? PN \?L32
	PRINTD P-THEM-OBJECT
	JUMP ?L34
?L32:	EQUAL? WRD,W?HIM \?L33
	ZERO? PN \?L33
	PRINTD P-HIM-OBJECT
	JUMP ?L34
?L33:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L34:	SET 'FIRST??,0
?L21:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT NAME?,WRD
	EQUAL? WRD,W?CRISP,W?VOSS,W?MACGUFFIN /TRUE
	EQUAL? WRD,W?FESTERON,W?SHOPPE,W?MAGICK /TRUE
	EQUAL? WRD,W?KING,W?PRINCESS,W?TASMANIA /TRUE
	EQUAL? WRD,W?ANATINUS,W?EVIL,W?ONE /TRUE
	EQUAL? WRD,W?WISHBRINGER,W?CHAOS,W?MR /TRUE
	EQUAL? WRD,W?MISS,W?MS,W?ALEXIS /TRUE
	RFALSE

	.FUNCT CAPITALIZE,PTR
	GETB PTR,3 >STACK
	GETB P-INBUF,STACK >STACK
	SUB STACK,32 >STACK
	PRINTC STACK
	GETB PTR,3 >STACK
	INC 'STACK
	GETB PTR,2 >STACK
	DEC 'STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT PREP-PRINT,PREP,SP?=1,WRD
	ZERO? PREP /FALSE
	ZERO? SP? /?L3
	PRINTI " "
?L3:	CALL PREP-FIND,PREP >WRD
	EQUAL? WRD,W?THROUGH \?L8
	PRINTI "through"
	JUMP ?L12
?L8:	PRINTB WRD
?L12:	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?SIT,STACK \?L13
	EQUAL? W?DOWN,WRD \?L13
	PRINTI " on"
?L13:	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?GET,STACK \TRUE
	EQUAL? W?OUT,WRD \TRUE
	PRINTI " of"
	RTRUE

	.FUNCT CLAUSE-COPY,SRC,DEST,INSRT=0,BEG,END
	GET P-CCTBL,CC-SBPTR >STACK
	GET SRC,STACK >BEG
	GET P-CCTBL,CC-SEPTR >STACK
	GET SRC,STACK >END
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	GET P-CCTBL,CC-DBPTR >STACK
	PUT DEST,STACK,STACK
?L1:	EQUAL? BEG,END \?L3
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	GET P-CCTBL,CC-DEPTR >STACK
	PUT DEST,STACK,STACK
	RTRUE
?L3:	ZERO? INSRT /?L6
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L6
	CALL CLAUSE-ADD,INSRT
?L6:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CLAUSE-ADD,WRD,PTR
	GET P-OCLAUSE,P-MATCHLEN >STACK
	ADD STACK,2 >PTR
	SUB PTR,1 >STACK
	PUT P-OCLAUSE,STACK,WRD
	PUT P-OCLAUSE,PTR,0
	PUT P-OCLAUSE,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-FIND,PREP,CNT=0,SIZE
	GET PREPOSITIONS,0 >STACK
	MUL STACK,2 >SIZE
?L1:	IGRTR? 'CNT,SIZE /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L1
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ,WPREP
	EQUAL? GBIT,RLANDBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	PRINTI "("
	CALL PREP-PRINT,PREP,0 >STACK
	ZERO? STACK /?L10
	PRINTI " "
	CALL ARTICLE,OBJ,1
?L10:	PRINTD OBJ
	PRINTI ")"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,PTR
	GET P-ITBL,P-NC1 >PTR
	ZERO? PTR /?L5
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /?L5
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L5:	GET P-ITBL,P-NC2 >PTR
	ZERO? PTR /TRUE
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSI,P-MATCHLEN >STACK
	EQUAL? STACK,1 \?L14
	CALL BUT-MERGE,P-PRSO >P-PRSO
	RTRUE
?L14:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,BUT=0,LEN,WV,WRD,NW,WAS-ALL?=0
	SET 'P-AND,0
	EQUAL? P-GETFLAGS,P-ALL \?L1
	SET 'WAS-ALL?,1
?L1:	SET 'P-GETFLAGS,0
	PUT P-BUTS,P-MATCHLEN,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WRD
?L4:	EQUAL? PTR,EPTR \?L6
?L55:	ZERO? BUT /?L9
	PUSH BUT
	JUMP ?L8
?L9:	PUSH TBL
?L8:	CALL GET-OBJECT,STACK >WV
	ZERO? WAS-ALL? /?L10
	SET 'P-GETFLAGS,P-ALL
?L10:	RETURN WV
?L6:	GET PTR,P-LEXELEN >NW
	EQUAL? WRD,W?ALL,W?BOTH,W?EVERYTHING \?L14
	SET 'P-GETFLAGS,P-ALL
	EQUAL? NW,W?OF \?L50
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L50
?L14:	EQUAL? WRD,W?BUT,W?EXCEPT \?L19
	ZERO? BUT /?L23
	PUSH BUT
	JUMP ?L22
?L23:	PUSH TBL
?L22:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,P-BUTS
	PUT BUT,P-MATCHLEN,0
	JUMP ?L50
?L19:	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	EQUAL? WRD,W?A \?L25
	ZERO? P-ADJ \?L26
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L50
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L50
?L26:	SET 'P-NAM,P-ONEOBJ
	ZERO? BUT /?L35
	PUSH BUT
	JUMP ?L34
?L35:	PUSH TBL
?L34:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L50
?L25:	EQUAL? WRD,W?AND,W?$COMMA \?L38
	EQUAL? NW,W?AND,W?$COMMA /?L38
	SET 'P-AND,1
	ZERO? BUT /?L42
	PUSH BUT
	JUMP ?L41
?L42:	PUSH TBL
?L41:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L50
?L38:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L50
	EQUAL? WRD,W?AND,W?$COMMA /?L50
	EQUAL? WRD,W?OF \?L45
	ZERO? P-GETFLAGS \?L50
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L50
?L45:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L49
	ZERO? P-ADJ \?L49
	SET 'P-ADJ,WV
	SET 'P-ADJN,WRD
	JUMP ?L50
?L49:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L50
	SET 'P-NAM,WRD
	SET 'P-ONEOBJ,WRD
?L50:	EQUAL? PTR,EPTR /?L55
	ADD PTR,P-WORDLEN >PTR
	SET 'WRD,NW
	JUMP ?L4

	.FUNCT GET-OBJECT,TBL,VRB=1,BTS,LEN,XBITS,TLEN,GCHECK=0,OLEN=0,OBJ,ADJ,X
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	SET 'ADJ,P-ADJN
	ZERO? P-NAM \?L11
	ZERO? P-ADJ /?L8
	CALL WT?,P-ADJN,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L6
	SET 'P-NAM,P-ADJN
	SET 'P-ADJ,0
	JUMP ?L8
?L6:	CALL WT?,P-ADJN,PS?DIRECTION,P1?DIRECTION >BTS
	ZERO? BTS /?L8
	SET 'P-ADJ,0
	PUT TBL,P-MATCHLEN,1
	PUT TBL,1,INTDIR
	SET 'P-DIRECTION,BTS
	RTRUE
?L8:	ZERO? P-NAM \?L11
	ZERO? P-ADJ \?L11
	EQUAL? P-GETFLAGS,P-ALL /?L74
	ZERO? P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	CALL NOT-IN-SENTENCE,STR?18
	RFALSE
?L11:	EQUAL? P-GETFLAGS,P-ALL \?L19
?L74:	ZERO? P-SLOCBITS \?L17
?L19:	SET 'P-SLOCBITS,-1
?L17:	SET 'P-TABLE,TBL
?L21:	ZERO? GCHECK /?L23
	CALL GLOBAL-CHECK,TBL
	JUMP ?L25
?L23:	ZERO? LIT /?L26
	FCLEAR PROTAGONIST,TRANSBIT
	CALL DO-SL,HERE,SOG,SIR
	FSET PROTAGONIST,TRANSBIT
?L26:	CALL DO-SL,PROTAGONIST,SH,SC
?L25:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL /?L65
	BTST P-GETFLAGS,P-ONE \?L31
	ZERO? LEN /?L31
	EQUAL? LEN,1 /?L32
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "(How about "
	GET TBL,1 >STACK
	CALL ARTICLE,STACK,1
	GET TBL,1 >STACK
	PRINTD STACK
	PRINTI "?)"
	CRLF
?L32:	PUT TBL,P-MATCHLEN,1
	JUMP ?L65
?L31:	GRTR? LEN,1 /?L40
	ZERO? LEN \?L65
	EQUAL? P-SLOCBITS,-1 /?L39
?L40:	EQUAL? P-SLOCBITS,-1 \?L41
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L21
?L41:	ZERO? LEN \?L44
	SET 'LEN,OLEN
?L44:	EQUAL? WINNER,PROTAGONIST /?L47
	PRINTI "(Please try saying that another way.)"
	CRLF
	RFALSE
?L47:	ZERO? VRB /?L55
	ZERO? P-NAM /?L51
	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L52
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L54
?L52:	SET 'P-ACLAUSE,P-NC2
?L54:	SET 'P-AADJ,P-ADJ
	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L55
?L51:	ZERO? VRB /?L55
	CALL NOT-IN-SENTENCE,STR?18
?L55:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L39:	ZERO? LEN \?L65
	ZERO? GCHECK /?L57
	ZERO? VRB /?L63
	SET 'P-SLOCBITS,XBITS
	ZERO? LIT \?L62
	CALL SPEAKING-VERB? >STACK
	ZERO? STACK /?L60
?L62:	CALL OBJ-FOUND,NOT-HERE-OBJECT,TBL
	SET 'P-XNAM,P-NAM
	SET 'P-XADJ,P-ADJ
	SET 'P-XADJN,P-ADJN
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	RTRUE
?L60:	CALL TOO-DARK
?L63:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L57:	ZERO? LEN \?L65
	SET 'GCHECK,1
	JUMP ?L21
?L65:	ADD TLEN,1 >STACK
	GET TBL,STACK >X
	ZERO? P-ADJ /?L67
	ZERO? P-NAM \?L67
	ZERO? X /?L67
	PRINT I-ASSUME
	PRINTI " "
	CALL ARTICLE,X,1
	PRINTD X
	PRINTI ".)"
	CRLF
?L67:	SET 'P-SLOCBITS,XBITS
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE

	.FUNCT SPEAKING-VERB?,V=0
	ZERO? V \?L1
	SET 'V,PRSA
?L1:	EQUAL? V,V?ASK-ABOUT,V?ASK-FOR,V?HELLO /TRUE
	EQUAL? V,V?TELL,V?QUESTION,V?REPLY \FALSE
	RTRUE

	.FUNCT MOBY-FIND,TBL,OBJ=1,LEN,FOO
	SET 'P-NAM,P-XNAM
	SET 'P-ADJ,P-XADJ
	PUT TBL,P-MATCHLEN,0
?L1:	CALL META-LOC,OBJ >FOO
	ZERO? FOO /?L3
	CALL THIS-IT?,OBJ >FOO
	ZERO? FOO /?L3
	CALL OBJ-FOUND,OBJ,TBL >FOO
?L3:	IGRTR? 'OBJ,DUMMY-OBJECT \?L1
	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L9
	GET TBL,1 >P-MOBY-FOUND
?L9:	RETURN LEN

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	SET 'RLEN,LEN
	PRINTI "Which"
	ZERO? P-OFLAG \?L5
	ZERO? P-MERGED \?L5
	ZERO? P-AND /?L3
?L5:	PRINTI " "
	PRINTB P-NAM
	JUMP ?L9
?L3:	EQUAL? TBL,P-PRSO \?L8
	CALL CLAUSE-PRINT,P-NC1,P-NC1L,0
	JUMP ?L9
?L8:	CALL CLAUSE-PRINT,P-NC2,P-NC2L,0
?L9:	PRINTI " do you mean,"
?L12:	INC 'TLEN
	GET TBL,TLEN >OBJ
	PRINTI " "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	EQUAL? LEN,2 \?L18
	EQUAL? RLEN,2 /?L20
	PRINTI ","
?L20:	PRINTI " or"
	JUMP ?L27
?L18:	GRTR? LEN,2 \?L27
	PRINTI ","
?L27:	DLESS? 'LEN,1 \?L12
	PRINTR "?"

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS,FOO
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	FIRST? OBJ >STACK \?L5
	CALL SEARCH-LIST,OBJ,TBL,P-SRCALL
?L5:	CALL THIS-IT?,OBJ >STACK
	ZERO? STACK /?L8
	CALL OBJ-FOUND,OBJ,TBL
?L8:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETPT HERE,P?PSEUDO >RMG
	ZERO? RMG /?L18
	PTSIZE RMG >STACK
	DIV STACK,4 >STACK
	SUB STACK,1 >RMGL
	SET 'CNT,0
?L17:	MUL CNT,2 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L19
	SET 'LAST-PSEUDO-LOC,HERE
	MUL CNT,2 >STACK
	INC 'STACK
	GET RMG,STACK >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	GETPT PSEUDO-OBJECT,P?ACTION >STACK
	SUB STACK,5 >FOO
	GET P-NAM,0 >STACK
	PUT FOO,0,STACK
	GET P-NAM,1 >STACK
	PUT FOO,1,STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L18
?L19:	IGRTR? 'CNT,RMGL \?L17
?L18:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	GET TBL,P-MATCHLEN >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?LOOK-INSIDE,V?DUMB-EXAMINE,V?EXAMINE /?L30
	EQUAL? PRSA,V?LEAVE,V?FOLLOW,V?FIND /?L30
	EQUAL? PRSA,V?THROUGH,V?SMELL,V?SEARCH /?L30
	EQUAL? PRSA,V?LOOK-ON,V?WAIT-FOR,V?WALK-TO \FALSE
?L30:	CALL DO-SL,ROOMS,1,1 >STACK
	RSTACK

	.FUNCT DO-SL,OBJ,BIT1,BIT2,BITS
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL
	FIRST? OBJ >OBJ \FALSE
?L4:	EQUAL? LVL,P-SRCBOT /?L6
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L6
	CALL THIS-IT?,OBJ >STACK
	ZERO? STACK /?L6
	CALL OBJ-FOUND,OBJ,TBL
?L6:	EQUAL? LVL,P-SRCTOP \?L11
	FSET? OBJ,SURFACEBIT \?L9
?L11:	FIRST? OBJ >STACK \?L9
	CALL SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /?L9
	FSET? OBJ,SURFACEBIT \?L12
	PUSH P-SRCALL
	JUMP ?L14
?L12:	PUSH P-SRCTOP
?L14:	CALL SEARCH-LIST,OBJ,TBL,STACK
?L9:	NEXT? OBJ >OBJ /?L4
	RTRUE

	.FUNCT THIS-IT?,OBJ,SYNS
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	ZERO? P-ADJ /?L5
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DEC 'STACK
	CALL ZMEMQB,P-ADJ,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L5:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,BITS,PTR,OBJ,TAKEN
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST BITS,SHAVE /?L3
	BTST BITS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L9
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK \?L11
	CALL REFERRING
	RFALSE
?L11:	SET 'OBJ,P-IT-OBJECT
	JUMP ?L25
?L9:	EQUAL? OBJ,HER \?L14
	CALL ACCESSIBLE?,P-HER-OBJECT >STACK
	ZERO? STACK \?L15
	CALL REFERRING
	RFALSE
?L15:	SET 'OBJ,P-HER-OBJECT
	JUMP ?L25
?L14:	EQUAL? OBJ,HIM \?L18
	CALL ACCESSIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK \?L19
	CALL REFERRING
	RFALSE
?L19:	SET 'OBJ,P-HIM-OBJECT
	JUMP ?L25
?L18:	EQUAL? OBJ,THEM \?L25
	CALL ACCESSIBLE?,P-THEM-OBJECT >STACK
	ZERO? STACK \?L23
	CALL REFERRING
	RFALSE
?L23:	SET 'OBJ,P-THEM-OBJECT
?L25:	CALL HELD?,OBJ >STACK
	ZERO? STACK \?L3
	EQUAL? OBJ,HANDS /?L3
	SET 'PRSO,OBJ
	FSET? OBJ,TRYTAKEBIT \?L29
	SET 'TAKEN,1
	JUMP ?L33
?L29:	EQUAL? WINNER,PROTAGONIST /?L31
	SET 'TAKEN,0
	JUMP ?L33
?L31:	BTST BITS,STAKE \?L32
	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \?L32
	SET 'TAKEN,0
	JUMP ?L33
?L32:	SET 'TAKEN,1
?L33:	ZERO? TAKEN /?L69
	BTST BITS,SHAVE \?L34
	PRINTI "(You don't seem to be holding"
	GET TBL,P-MATCHLEN >STACK
	LESS? 1,STACK \?L38
	PRINTI " all those things"
	JUMP ?L45
?L38:	EQUAL? OBJ,NOT-HERE-OBJECT \?L42
	PRINTI " that"
	JUMP ?L45
?L42:	CALL THIS-IS-IT,OBJ
	PRINTI " "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
?L45:	PRINTI "!)"
	CRLF
	RFALSE
?L34:	ZERO? TAKEN \?L3
?L69:	EQUAL? WINNER,PROTAGONIST \?L3
	PRINTI "(taking "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	ZERO? ITAKE-LOC /?L57
	PRINTI " from "
	CALL ARTICLE,ITAKE-LOC,1
	PRINTD ITAKE-LOC
?L57:	PRINTI " first)"
	CRLF
	JUMP ?L3

	.FUNCT MANY-CHECK,LOSS=0,TMP
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	PRINTI "("
	PRINT CANT
	PRINTI " use more than one object at a time with """
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L9
	PRINTI "tell"
	JUMP ?L15
?L9:	ZERO? P-OFLAG \?L14
	ZERO? P-MERGED /?L13
?L14:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L15
?L13:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L15:	PRINTI "."")"
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK \?L9
	ZERO? CNT /TRUE
	RETURN CNT
?L9:	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK \?L3
	ZERO? CNT /TRUE
	RETURN CNT
?L3:	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT LIT?,RM,RMBIT=1,OHERE,LIT?1=0
	ZERO? ALWAYS-LIT? /?L1
	EQUAL? WINNER,PROTAGONIST /TRUE
?L1:	ZERO? ECLIPSE? \FALSE
	SET 'P-GWIMBIT,ONBIT
	SET 'OHERE,HERE
	SET 'HERE,RM
	ZERO? RMBIT /?L5
	FSET? RM,ONBIT \?L5
	SET 'LIT?1,1
	JUMP ?L14
?L5:	PUT P-MERGE,P-MATCHLEN,0
	SET 'P-TABLE,P-MERGE
	SET 'P-SLOCBITS,-1
	EQUAL? OHERE,RM \?L10
	CALL DO-SL,WINNER,1,1
	EQUAL? WINNER,PROTAGONIST /?L10
	IN? PROTAGONIST,RM \?L10
	CALL DO-SL,PROTAGONIST,1,1
?L10:	CALL DO-SL,RM,1,1
	GET P-TABLE,P-MATCHLEN >STACK
	GRTR? STACK,0 \?L14
	SET 'LIT?1,1
?L14:	SET 'HERE,OHERE
	SET 'P-GWIMBIT,0
	RETURN LIT?1

	.FUNCT PICK-ONE,FROB,THIS=0,L,CNT,RND,MSG,RFROB
	GET FROB,0 >L
	GET FROB,1 >CNT
	DEC 'L
	ADD FROB,2 >FROB
	MUL CNT,2 >STACK
	ADD FROB,STACK >RFROB
	ZERO? THIS /?L1
	ZERO? CNT \?L1
	SET 'RND,THIS
	JUMP ?L3
?L1:	SUB L,CNT >STACK
	RANDOM STACK >RND
?L3:	GET RFROB,RND >MSG
	GET RFROB,1 >STACK
	PUT RFROB,RND,STACK
	PUT RFROB,1,MSG
	INC 'CNT
	EQUAL? CNT,L \?L4
	SET 'CNT,0
?L4:	PUT FROB,0,CNT
	RETURN MSG

	.FUNCT DONT-HAVE?,OBJ,WHERE
	LOC OBJ >WHERE
	EQUAL? WHERE,PROTAGONIST /FALSE
	IN? WHERE,PROTAGONIST \?L3
	PRINTI "You'll have to take "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	PRINTI " "
	FSET? WHERE,CONTBIT \?L8
	PRINTI "out"
	JUMP ?L12
?L8:	PRINTI "off"
?L12:	PRINTI " of "
	CALL ARTICLE,WHERE,1
	PRINTD WHERE
	PRINTR " first."
?L3:	CALL NOT-HOLDING,OBJ
	RTRUE

	.FUNCT NOT-HOLDING,OBJ=0
	PRINTI "You're not holding "
	ZERO? OBJ /?L3
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	JUMP ?L5
?L3:	PRINTI "that"
?L5:	PRINTR "."

	.FUNCT ASKING?,ACTOR
	EQUAL? PRSA,V?QUESTION,V?ASK-FOR,V?ASK-ABOUT \FALSE
	EQUAL? PRSO,ACTOR \FALSE
	RTRUE

	.FUNCT TALKING-TO?,ACTOR
	CALL ASKING?,ACTOR >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?WAVE-AT,V?HELLO,V?TELL /?L4
	EQUAL? PRSA,V?ALARM,V?REPLY \FALSE
?L4:	EQUAL? PRSO,ACTOR \FALSE
	RTRUE

	.FUNCT TOUCHING?,THING
	EQUAL? PRSA,V?TAKE,V?RUB,V?SHAKE /TRUE
	EQUAL? PRSA,V?SWING,V?PLAY,V?SPIN /TRUE
	EQUAL? PRSA,V?CLEAN,V?PUT,V?PUT-ON /TRUE
	EQUAL? PRSA,V?MOVE,V?PULL,V?PUSH /TRUE
	EQUAL? PRSA,V?PUT-UNDER,V?PUT-BEHIND,V?SMELL /TRUE
	EQUAL? PRSA,V?KISS /TRUE
	CALL HURT?,THING >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT HURT?,THING
	EQUAL? PRSA,V?MUNG,V?KICK,V?KILL /?L3
	EQUAL? PRSA,V?KNOCK,V?SQUEEZE,V?CUT /?L3
	EQUAL? PRSA,V?BITE,V?RAPE,V?SHAKE \?L1
?L3:	EQUAL? PRSO,THING /TRUE
?L1:	EQUAL? PRSA,V?THROW \FALSE
	EQUAL? PRSI,THING \FALSE
	RTRUE

	.FUNCT ENTER-FROM?,ENTRY,DEST=0,PLACE=0
	EQUAL? PRSA,V?ENTER,V?THROUGH,V?WALK-TO \FALSE
	EQUAL? HERE,ENTRY \?L3
	CALL DO-WALK,P?IN
	RTRUE
?L3:	ZERO? DEST /?L5
	ZERO? PLACE /?L5
	EQUAL? HERE,DEST \?L5
	CALL ALREADY-IN,PLACE
	RTRUE
?L5:	CALL HOW?
	RTRUE

	.FUNCT USE-DOOR?,OUTSIDE
	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO /?L3
	EQUAL? PRSA,V?USE \?L1
?L3:	EQUAL? HERE,OUTSIDE \?L4
	CALL DO-WALK,P?IN
	RTRUE
?L4:	CALL DO-WALK,P?OUT
	RTRUE
?L1:	EQUAL? PRSA,V?EXIT \FALSE
	EQUAL? HERE,OUTSIDE \?L8
	CALL V-WALK-AROUND
	RTRUE
?L8:	CALL DO-WALK,P?OUT
	RTRUE

	.FUNCT ANYONE-HERE?,OBJ
	EQUAL? HERE,CLIFF-BOTTOM \?L1
	IN? VULTURE,GNARLED-TREE \?L1
	RETURN VULTURE
?L1:	FIRST? HERE >OBJ /?L7
	RETURN OBJ
?L7:	FSET? OBJ,ACTORBIT \?L9
	EQUAL? OBJ,PROTAGONIST,VULTURE,ALEXIS /?L9
	RETURN OBJ
?L9:	NEXT? OBJ >OBJ /?L7
	RETURN OBJ

	.FUNCT FIXED-FONT-ON
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT FIXED-FONT-OFF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT GETTING-INTO?
	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?ENTER /TRUE
	EQUAL? PRSA,V?SIT,V?STAND-ON,V?LIE-DOWN /TRUE
	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON,V?LEAP /TRUE
	EQUAL? PRSA,V?SWIM,V?WEAR,V?WALK-AROUND \FALSE
	RTRUE

	.FUNCT SAY-THE,THING
	PRINTI "The "
	PRINTD THING
	RTRUE

	.FUNCT BUT-THE,THING
	PRINTI "But "
	CALL ARTICLE,THING,1
	PRINTD THING
	PRINTI " "
	RTRUE

	.FUNCT MOVING?,THING
	EQUAL? PRSA,V?MOVE,V?PULL,V?PUSH /?L3
	EQUAL? PRSA,V?TAKE,V?TURN,V?PUSH-TO /?L3
	EQUAL? PRSA,V?RAISE,V?SPIN,V?SHAKE \FALSE
?L3:	EQUAL? PRSO,THING \FALSE
	RTRUE

	.FUNCT NOT-HERE-OBJECT-F,TBL,PRSO?=1,OBJ
	EQUAL? PRSO,NOT-HERE-OBJECT \?L5
	EQUAL? PRSI,NOT-HERE-OBJECT \?L1
	PRINTR "Those things aren't here!"
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L5
	SET 'TBL,P-PRSO
	JUMP ?L6
?L5:	SET 'TBL,P-PRSI
	SET 'PRSO?,0
?L6:	ZERO? PRSO? /?L7
	EQUAL? PRSA,V?FIND,V?FOLLOW,V?BUY /?L11
	EQUAL? PRSA,V?WAIT-FOR /?L11
	EQUAL? PRSA,V?TAKE \?L22
	EQUAL? WINNER,PROTAGONIST /?L22
?L11:	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT /?L22
	RETURN 2
?L7:	EQUAL? PRSA,V?TELL,V?ASK-ABOUT,V?ASK-FOR /FALSE
?L22:	PRINT CANT
	PRINTI " see"
	EQUAL? P-XNAM,W?GRAVEDIGGER,W?DIGGER,W?ONE \?L27
	PRINTI " the"
	JUMP ?L31
?L27:	CALL NAME?,P-XNAM >STACK
	ZERO? STACK \?L31
	PRINTI " any"
?L31:	CALL NOT-HERE-PRINT,PRSO?
	PRINTI " here!"
	EQUAL? HERE,FUZZY \?L37
	PRINTI " Everything is too "
	CALL PICK-ONE,BLURS >STACK
	PRINT STACK
	PRINTI "."
?L37:	CRLF
	CALL PCLEAR
	RETURN 2

	.FUNCT FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ
	CALL MOBY-FIND,TBL >M-F
	EQUAL? 1,M-F \?L1
	ZERO? PRSO? /?L3
	SET 'PRSO,P-MOBY-FOUND
	RFALSE
?L3:	SET 'PRSI,P-MOBY-FOUND
	RFALSE
?L1:	ZERO? PRSO? \?L6
	PRINTI "You wouldn't find any"
	CALL NOT-HERE-PRINT,PRSO?
	PRINTR " there."
?L6:	RETURN NOT-HERE-OBJECT

	.FUNCT NOT-HERE-PRINT,PRSO?=0
	ZERO? P-OFLAG /?L1
	ZERO? P-XADJ /?L3
	PRINTI " "
	PRINTB P-XADJN
?L3:	ZERO? P-XNAM /FALSE
	PRINTI " "
	PRINTB P-XNAM
	RTRUE
?L1:	ZERO? PRSO? /?L13
	GET P-ITBL,P-NC1L >STACK
	GET P-ITBL,P-NC1 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK
?L13:	GET P-ITBL,P-NC2L >STACK
	GET P-ITBL,P-NC2 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK

	.FUNCT PRINT-CONTENTS,THING,OBJ,NXT,1ST?=1,IT?=0,TWO?=0
	FIRST? THING >OBJ /?L62
	JUMP ?L3
?L1:	ZERO? OBJ /?L3
?L62:	NEXT? OBJ >NXT /?L6
?L6:	FSET? OBJ,INVISIBLE /?L9
	EQUAL? OBJ,WINNER \?L7
?L9:	MOVE OBJ,C-OBJECT
?L7:	SET 'OBJ,NXT
	JUMP ?L1
?L3:	FIRST? THING >OBJ /?L63
	PRINTI "nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	JUMP ?L19
?L13:	ZERO? OBJ /?L20
?L63:	NEXT? OBJ >NXT /?L22
?L22:	ZERO? 1ST? /?L23
	SET '1ST?,0
	JUMP ?L30
?L23:	ZERO? NXT /?L26
	PRINTI ", "
	JUMP ?L30
?L26:	PRINTI " and "
?L30:	CALL ARTICLE,OBJ
	ZERO? FUZZY? /?L33
	CALL PICK-ONE,BLURS >STACK
	PRINT STACK
	PRINTI " "
?L33:	PRINTD OBJ
	FSET? OBJ,WORNBIT \?L40
	PRINTI " (being worn)"
?L40:	FSET? OBJ,ONBIT \?L45
	PRINTI " (providing light)"
?L45:	EQUAL? OBJ,BROOM \?L50
	IN? BROOM,PROTAGONIST \?L50
	ZERO? BROOM-SIT? /?L50
	PRINTI " (on which you're sitting)"
?L50:	ZERO? IT? \?L55
	ZERO? TWO? \?L55
	SET 'IT?,OBJ
	JUMP ?L57
?L55:	SET 'TWO?,1
	SET 'IT?,0
?L57:	SET 'OBJ,NXT
	JUMP ?L13
?L20:	ZERO? IT? /?L19
	ZERO? TWO? \?L19
	CALL THIS-IS-IT,IT?
?L19:	CALL MOVE-ALL,C-OBJECT,THING >STACK
	RSTACK

	.FUNCT MOVE-ALL,FROM,TO,OBJ,NXT
	FIRST? FROM >OBJ /?L8
	RTRUE
?L1:	ZERO? OBJ /TRUE
?L8:	NEXT? OBJ >NXT /?L6
?L6:	FCLEAR OBJ,WORNBIT
	MOVE OBJ,TO
	SET 'OBJ,NXT
	JUMP ?L1

	.FUNCT DESCRIBE-OBJECTS,OBJ,NXT,STR,1ST?=1,TWO?=0,IT?=0
	ZERO? LIT \?L1
	CALL TOO-DARK
	RTRUE
?L1:	FIRST? HERE >OBJ /?L97
	RTRUE
?L5:	ZERO? OBJ /?L9
?L97:	NEXT? OBJ >NXT /?L12
?L12:	FSET? OBJ,INVISIBLE /?L15
	FSET? OBJ,NDESCBIT /?L15
	EQUAL? OBJ,WINNER \?L13
?L15:	MOVE OBJ,DUMMY-OBJECT
?L13:	SET 'OBJ,NXT
	JUMP ?L5
?L9:	FIRST? HERE >OBJ /?L98
	JUMP ?L20
?L18:	ZERO? OBJ /?L20
?L98:	NEXT? OBJ >NXT /?L23
?L23:	GETP OBJ,P?FDESC >STR
	ZERO? STR /?L24
	FSET? OBJ,TOUCHBIT /?L24
	CRLF
	PRINT STR
	CRLF
	MOVE OBJ,DUMMY-OBJECT
?L24:	SET 'OBJ,NXT
	JUMP ?L18
?L20:	FIRST? HERE >OBJ /?L99
	JUMP ?L32
?L30:	ZERO? OBJ /?L32
?L99:	NEXT? OBJ >NXT /?L35
?L35:	GETP OBJ,P?DESCFCN >STR
	ZERO? STR /?L36
	CRLF
	CALL STR,M-OBJDESC >STR
	CRLF
	MOVE OBJ,DUMMY-OBJECT
?L36:	SET 'OBJ,NXT
	JUMP ?L30
?L32:	FIRST? HERE >OBJ /?L100
	JUMP ?L44
?L43:	ZERO? OBJ /?L45
?L100:	NEXT? OBJ >NXT /?L47
?L47:	ZERO? 1ST? /?L48
	SET '1ST?,0
	CRLF
	ZERO? NXT /?L50
	PRINT YOU-SEE
	JUMP ?L62
?L50:	PRINTI "There's "
	JUMP ?L62
?L48:	ZERO? NXT /?L58
	PRINTI ", "
	JUMP ?L62
?L58:	PRINTI " and "
?L62:	CALL ARTICLE,OBJ
	PRINTD OBJ
	FSET? OBJ,ONBIT \?L67
	PRINTI " (providing light)"
?L67:	CALL SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /?L72
	CALL SEE-ANYTHING-IN?,OBJ >STACK
	ZERO? STACK /?L72
	EQUAL? OBJ,COAT /?L72
	PRINTI " with "
	CALL PRINT-CONTENTS,OBJ
	FSET? OBJ,CONTBIT \?L76
	PRINTI " in"
	JUMP ?L80
?L76:	PRINTI " on"
?L80:	PRINTI " it"
?L72:	ZERO? IT? \?L86
	ZERO? TWO? \?L86
	SET 'IT?,OBJ
	JUMP ?L88
?L86:	SET 'TWO?,1
	SET 'IT?,0
?L88:	SET 'OBJ,NXT
	JUMP ?L43
?L45:	ZERO? IT? /?L90
	ZERO? TWO? \?L90
	CALL THIS-IS-IT,IT?
?L90:	PRINTI " here."
	CRLF
?L44:	CALL MOVE-ALL,DUMMY-OBJECT,HERE >STACK
	RSTACK

	.FUNCT SEE-ANYTHING-IN?,THING,OBJ,NXT,ANY?=0
	FIRST? THING >OBJ /?L11
	RETURN ANY?
?L11:	FSET? OBJ,INVISIBLE /?L6
	FSET? OBJ,NDESCBIT /?L6
	EQUAL? OBJ,WINNER /?L6
	SET 'ANY?,1
	RETURN ANY?
?L6:	NEXT? OBJ >OBJ /?L11
	RETURN ANY?

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,T
	GETPT OBJ2,P?GLOBAL >T
	ZERO? T /FALSE
	PTSIZE T >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,T,STACK >STACK
	RSTACK

	.FUNCT ARTICLE,OBJ,THE=0
	FSET? OBJ,NARTICLEBIT /FALSE
	ZERO? THE /?L3
	PRINTI "the "
	RTRUE
?L3:	FSET? OBJ,VOWELBIT \?L6
	PRINTI "an "
	RTRUE
?L6:	PRINTI "a "
	RTRUE

	.FUNCT HELD?,OBJ
	ZERO? OBJ /FALSE
	IN? OBJ,PROTAGONIST /TRUE
	IN? OBJ,WINNER /TRUE
	FSET? OBJ,TAKEBIT \FALSE
	IN? OBJ,ROOMS /FALSE
	IN? OBJ,GLOBAL-OBJECTS /FALSE
	LOC OBJ >STACK
	CALL HELD?,STACK >STACK
	RSTACK

	.FUNCT WHAT-A-CONCEPT
	PRINTR "What a concept!"

	.FUNCT YOU-DONT-NEED,THING,STRING?=0
	PRINTI "(You don't need to refer to "
	ZERO? STRING? /?L3
	PRINTI "the "
	PRINT THING
	JUMP ?L7
?L3:	CALL ARTICLE,THING,1
	PRINTD THING
?L7:	PRINTR " that way to finish this story.)"

	.FUNCT ITS-CLOSED,OBJ
	CALL THIS-IS-IT,OBJ
	CALL SAY-THE,OBJ
	CALL IS-CLOSED
	CRLF
	RTRUE

	.FUNCT IS-CLOSED
	PRINTI " is closed."
	RTRUE

	.FUNCT IF-YOU-TRIED
	PRINTR " if you tried that!"

	.FUNCT AND-DROPS-OUT,THING
	PRINTI " and "
	FCLEAR THING,WORNBIT
	EQUAL? HERE,FOG \?L3
	PRINTI "disappears in the fog."
	CRLF
	CALL PRINT-ID,STR?19
	MOVE THING,CLIFF-BOTTOM
	RTRUE
?L3:	EQUAL? HERE,STEEP-TRAIL \?L7
	PRINTI "tumbles over the edge of the cliff."
	CRLF
	CALL PRINT-ID,STR?20
	MOVE THING,CLIFF-BOTTOM
	RTRUE
?L7:	EQUAL? HERE,FUZZY \?L10
	PRINTI "disappears in the fuzziness."
	CRLF
	CALL PRINT-ID,STR?21
	MOVE THING,FUZZY-FROM
	RTRUE
?L10:	PRINTI "lands at your feet."
	CRLF
	EQUAL? HERE,OUTSIDE-COTTAGE \?L16
	CRLF
	CALL PERFORM,V?GIVE,THING,POOCH
	SET 'CLOCK-WAIT,1
	RTRUE
?L16:	MOVE THING,HERE
	RTRUE

	.FUNCT OPEN-CLOSED,THING,N?=0
	FSET? THING,OPENBIT \?L1
	ZERO? N? /?L3
	PRINTI "n"
?L3:	PRINTI " open "
	RTRUE
?L1:	PRINTI " closed "
	RTRUE

	.FUNCT WHICH-TOWN,STR=0
	PRINTI " "
	ZERO? SKEWED? /?L5
	ZERO? SUCCESS? /?L3
?L5:	PRINTI "Festeron"
	JUMP ?L8
?L3:	PRINTI "Witchville"
?L8:	ZERO? STR /FALSE
	PRINTI " "
	PRINT STR
	RTRUE

	.FUNCT I-BEFORE-FIVE
	EQUAL? SCORE,16 \?L1
	ZERO? MOVES \?L3
	CALL BETTER-HURRY >STACK
	RSTACK
?L3:	EQUAL? MOVES,30 \FALSE
	CALL BETTER-HURRY,1 >STACK
	RSTACK
?L1:	EQUAL? SCORE,17 \FALSE
	EQUAL? HERE,INSIDE-SHOPPE /FALSE
	CALL FIRED,1 >STACK
	RSTACK

	.FUNCT I-BREAK-IN
	EQUAL? HERE,JAIL-CELL \FALSE
	RANDOM 100 >STACK
	LESS? 10,STACK /FALSE
	CRLF
	CALL HEAR-WAILS >STACK
	RSTACK

	.FUNCT I-CREAK
	EQUAL? HERE,EDGE-OF-LAKE \FALSE
	FSET? NORTH-GATE,RMUNGBIT \?L3
	FCLEAR NORTH-GATE,RMUNGBIT
	RTRUE
?L3:	CALL INT,I-CREAK >STACK
	PUT STACK,0,0
	FCLEAR NORTH-GATE,LOCKEDBIT
	FSET NORTH-GATE,OPENBIT
	CALL THIS-IS-IT,NORTH-GATE
	CRLF
	PRINTI "A rusty ""click!"" draws your eyes to the "
	PRINTD NORTH-GATE
	PRINTR ". You watch as it slowly creaks open, all by itself!"

	.FUNCT I-VULTURE
	ZERO? ECLIPSE? \TRUE
	ZERO? FUZZY? \TRUE
	FSET? HERE,INDOORSBIT /TRUE
	EQUAL? HERE,WEST-OF-HOUSE /TRUE
	FSET? VULTURE,RMUNGBIT /?L5
	RANDOM 100 >STACK
	LESS? 5,STACK /FALSE
?L5:	FCLEAR VULTURE,RMUNGBIT
	MOVE VULTURE,HERE
	CRLF
	CALL SEE-VULTURE >STACK
	RSTACK

	.FUNCT I-BEFORE-MOONSET,H
	GRTR? SCORE,17 /TRUE
	GRTR? SCORE,5 \?L3
	CRLF
	FSET? HERE,INDOORSBIT /?L4
	ZERO? FUZZY? \?L4
	ZERO? ECLIPSE? \?L4
	PRINTI "You watch with horror as the "
	PRINTD MOON
	PRINTI " slowly sets in the western sky."
	CRLF
	CRLF
?L4:	PRINTI "Out of nowhere, the sad voice of the "
	PRINTD OLD-WOMAN
	PRINTI " from the "
	PRINTD MAGICK-SHOPPE
	PRINTI " rises around you. ""Your quest is over"
	PRINT ADVENTURER
	PRINTI ". The moon is set, and "
	PRINTD CHAOS
	PRINTI " is no more. "
	CALL THANKS-ANYWAY
	CALL PRINT-ID,STR?22
	CALL BAD-ENDING >STACK
	RSTACK
?L3:	ZERO? MOVES \FALSE
	SUB 6,SCORE >H
	CALL SAY-HURRY
	PRINTI "You've only got "
	EQUAL? H,1 \?L14
	PRINTI "one more hour"
	JUMP ?L18
?L14:	PRINTN H
	PRINTI " hours"
?L18:	PRINTI " before the "
	PRINTD MOON
	PRINTR " sets!)"

	.FUNCT I-PROMPT-1
	SET 'P-PROMPT,1
	RFALSE

	.FUNCT I-PROMPT-2
	ZERO? P-PROMPT /FALSE
	SET 'P-PROMPT,0
	CRLF
	PRINTI "(You won't see the ""What next?"" prompt any more.)"
	CALL INT,I-PROMPT-2 >STACK
	PUT STACK,0,0
	RFALSE

	.FUNCT I-LUCK,SHUTOFF?=0
	ZERO? NO-LUCK? \TRUE
	IN? SHOE,PROTAGONIST \?L4
	IN? WISHBRINGER,PROTAGONIST \?L4
	FSET? WISHBRINGER,ONBIT \?L4
	ZERO? SHUTOFF? \?L4
	ZERO? LUCKY? \?L12
	FSET SHOE,ONBIT
	CALL THIS-IS-IT,SHOE
	SET 'LUCKY?,1
	CRLF
	CALL SAY-THE,SHOE
	PRINTI " is twinkling again."
	CRLF
	JUMP ?L12
?L4:	ZERO? LUCKY? /?L12
	CALL VISIBLE?,SHOE >STACK
	ZERO? STACK /?L14
	CALL THIS-IS-IT,SHOE
	CRLF
	CALL SAY-THE,SHOE
	PRINTI " isn't twinkling any more."
	CRLF
?L14:	FCLEAR SHOE,ONBIT
	SET 'LUCKY?,0
?L12:	ZERO? SHUTOFF? /FALSE
	SET 'NO-LUCK?,1
	RETURN NO-LUCK?

	.FUNCT I-GLOW
	ZERO? ECLIPSE? \FALSE
	IN? WISHBRINGER,PROTAGONIST \?L3
	FSET? WISHBRINGER,TOOLBIT \?L4
	FCLEAR WISHBRINGER,TOOLBIT
	CRLF
	PRINTI "As your fingers close around the "
	PRINTD WISHBRINGER
	PRINTI " it begins to glow"
	CALL SAY-GLOW
	JUMP ?L11
?L4:	FSET? WISHBRINGER,RMUNGBIT \FALSE
	CRLF
	CALL SAY-THE,WISHBRINGER
	PRINTI " begins to glow again."
	CRLF
?L11:	FSET WISHBRINGER,ONBIT
	FCLEAR WISHBRINGER,RMUNGBIT
	ZERO? LIT \?L12
	SET 'LIT,1
	CRLF
	CALL V-LOOK
?L12:	FSET? LUCK,TOUCHBIT \FALSE
	IN? SHOE,PROTAGONIST \FALSE
	CALL I-LUCK >STACK
	RSTACK
?L3:	FSET? WISHBRINGER,RMUNGBIT /FALSE
	FSET WISHBRINGER,RMUNGBIT
	FCLEAR WISHBRINGER,ONBIT
	CALL VISIBLE?,WISHBRINGER >STACK
	ZERO? STACK /?L19
	CRLF
	CALL SAY-THE,WISHBRINGER
	PRINTI " stops glowing."
	CRLF
?L19:	CALL SAY-IF-NOT-LIT >STACK
	RSTACK

	.FUNCT I-SHELL-TALK
	DEC 'SHELL-SCRIPT
	ZERO? SHELL-SCRIPT /?L3
	IN? CONCH-SHELL,PROTAGONIST \?L3
	IN? WISHBRINGER,PROTAGONIST /?L1
?L3:	CALL INT,I-SHELL-TALK >STACK
	PUT STACK,0,0
	CALL VISIBLE?,CONCH-SHELL >STACK
	ZERO? STACK /FALSE
	LESS? SHELL-SCRIPT,4 \FALSE
	CALL THIS-IS-IT,CONCH-SHELL
	CRLF
	PRINTI "The buzzing sound in the "
	PRINTD CONCH-SHELL
	PRINTR " stops."
?L1:	EQUAL? SHELL-SCRIPT,4 \?L9
	CALL THIS-IS-IT,CONCH-SHELL
	CRLF
	PRINT YOU-HEAR
	PRINTI "a faint buzzing sound, like an overheard telephone, coming from the "
	PRINTD CONCH-SHELL
	PRINTR "."
?L9:	EQUAL? SHELL-SCRIPT,2 \FALSE
	CALL THIS-IS-IT,CONCH-SHELL
	CRLF
	PRINTI "("
	CALL SAY-THE,CONCH-SHELL
	PRINTR " is still buzzing. Maybe you should listen to it.)"

	.FUNCT TO-N
	GET DIR-NAMES,0 >STACK
	RSTACK

	.FUNCT TO-S
	GET DIR-NAMES,1 >STACK
	RSTACK

	.FUNCT TO-E
	GET DIR-NAMES,2 >STACK
	RSTACK

	.FUNCT I-BOOT-PATROL,DIR-INDEX,DIR-TABLE,PLACE,WHERE-BOOTS
	ZERO? ECLIPSE? \TRUE
	EQUAL? LAST-PLACE,HERE \?L4
	LOC BOOTS >WHERE-BOOTS
	ZERO? FUZZY? /?L6
	EQUAL? FUZZY-FROM,WHERE-BOOTS \?L6
	CRLF
	PRINTI "The fuzzy"
	CALL TRAMP
	PRINTI "fades away."
	CRLF
?L6:	IGRTR? 'BOOT-LOC,BOOT-MAX \?L13
	SET 'BOOT-LOC,0
?L13:	GET BOOT-PATH,BOOT-LOC >WHERE-BOOTS
	MOVE BOOTS,WHERE-BOOTS
	JUMP ?L16
?L4:	LOC BOOTS >WHERE-BOOTS
	SET 'LAST-PLACE,HERE
?L16:	ZERO? FUZZY? /?L17
	EQUAL? FUZZY-FROM,WHERE-BOOTS \?L17
	CRLF
	PRINT YOU-HEAR
	PRINTI "the"
	CALL TRAMP
	PRINTR "all around you. But the sound is fuzzy and oddly distant."
?L17:	EQUAL? HERE,WHERE-BOOTS \?L24
	CALL DEPOSIT-BRANCH
	CRLF
	PRINTI "The night is filled with rhythmic thunder, and a platoon of gigantic leather army "
	PRINTD BOOTS
	PRINTI " marches into view. It's the Boot Patrol"
	ZERO? JAIL-VISITS /?L28
	PRINTI " again"
?L28:	PRINTI "!

You're immediately surrounded, tied, gagged and dragged before an especially tall Boot. "
	CALL PRINT-ID,STR?23
	ZERO? JAIL-VISITS \?L35
	PRINTI """What have we here?"" he hisses. ""Out after curfew? Tsk, tsk, tsk. I wonder what "
	PRINTD MACGUFFIN
	PRINTI " will say about this."""
	JUMP ?L42
?L35:	EQUAL? JAIL-VISITS,1 \?L39
	PRINTI """What!"" he cries. ""I thought you were locked up with "
	PRINTD MACGUFFIN
	PRINTI ". Tsk, tsk."""
	JUMP ?L42
?L39:	PRINTI """Escaped again!"" He looks around at the silent platoon. ""We don't want to bother "
	PRINTD MACGUFFIN
	CALL SHARK-SNACK
?L42:	CALL THROWN-OVER-SHOULDER
	EQUAL? JAIL-VISITS,0,1 \?L45
	PRINTI "the "
	PRINTD GLOBBY
	PRINTI " of the "
	PRINTD INSIDE-POLICE-STATION
	PRINTI "."
	CRLF
	CRLF
	PRINTD MACGUFFIN
	PRINTI " glares at you as the "
	PRINTD BOOTS
	PRINTI " dump you on the floor. "
	ZERO? JAIL-VISITS \?L49
	PRINTI """What's this?"" he demands impatiently.

""A nightcrawler,"" hisses the Tall Boot, giving you a vicious little kick. ""Outside after curfew. Shall I feed it to the "
	PRINTD SHARKS
	PRINTI "?"""
	CRLF
	CRLF
	PRINTD MACGUFFIN
	PRINTI " shakes his head. ""Later. The Tower wants all prisoners held for questioning."" He turns back to his work. ""Cell Three."""
	CALL PRINT-ID,STR?24
	JUMP ?L53
?L49:	PRINTI "His eyes narrow when he sees you. "
	CALL JAIL-AGAIN
?L53:	CALL TO-JAIL
	RTRUE
?L45:	CALL INTO-BAY
	RTRUE
?L24:	SET 'DIR-INDEX,0
	GET DIRECTION-TABLES,BOOT-LOC >DIR-TABLE
?L58:	GRTR? DIR-INDEX,DIR-MAX /TRUE
	GET DIR-TABLE,DIR-INDEX >PLACE
	EQUAL? PLACE,PARK \?L67
	EQUAL? DIR-INDEX,0,1 \?L65
	EQUAL? HERE,ROTARY-WEST,ROTARY-EAST \?L65
	SET 'PLACE,HERE
	JUMP ?L67
?L65:	EQUAL? DIR-INDEX,2,3 \?L67
	EQUAL? HERE,ROTARY-NORTH,ROTARY-SOUTH \?L67
	SET 'PLACE,HERE
?L67:	EQUAL? HERE,PLACE \?L70
	CALL THIS-IS-IT,BOOTS
	CRLF
	PRINT YOU-HEAR
	PRINTI "the"
	CALL TRAMP
	GET DIR-NAMES,DIR-INDEX >STACK
	PRINT STACK
	PRINTI "."
	ADD BOOT-LOC,1 >STACK
	GET BOOT-PATH,STACK >STACK
	EQUAL? HERE,STACK \?L76
	CALL COMING-THIS-WAY
?L76:	CRLF
	RTRUE
?L70:	INC 'DIR-INDEX
	JUMP ?L58

	.FUNCT I-JAIL
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,JAIL-CELL \FALSE
	DEC 'JAIL-SCRIPT
	EQUAL? JAIL-SCRIPT,8 \?L5
	CRLF
	PRINT YOU-HEAR
	CALL EVIL-VOICES
	PRINTR "."
?L5:	EQUAL? JAIL-SCRIPT,6,3 \?L11
	CRLF
	PRINTI "The "
	CALL EVIL-VOICES
	PRINTR " laugh among themselves."
?L11:	EQUAL? JAIL-SCRIPT,5 \?L16
	CRLF
	PRINTI "One of the "
	CALL EVIL-VOICES
	PRINTR " just mentioned your name!"
?L16:	EQUAL? JAIL-SCRIPT,2 \?L21
	CRLF
	PRINT YOU-HEAR
	PRINTI "the"
	CALL TRAMP
	PRINTI "in the "
	PRINTD CORRIDOR
	PRINTI " outside."
	CALL COMING-THIS-WAY
	CRLF
	RTRUE
?L21:	EQUAL? JAIL-SCRIPT,1 \?L26
	CRLF
	PRINTI "Uh-oh. Somebody's unlocking your "
	PRINTD CELL-DOOR
	PRINTR "!"
?L26:	ZERO? JAIL-SCRIPT \?L29
	CRLF
	PRINTI "The door flies open, and a dozen giant army boots stride into your cell."
	CALL THROWN-OVER-SHOULDER
	CALL TORTURE-ENDING >STACK
	RSTACK
?L29:	EQUAL? JAIL-SCRIPT,7,4 /?L33
	RANDOM 100 >STACK
	LESS? 10,STACK /FALSE
?L33:	CRLF
	CALL HEAR-WAILS >STACK
	RSTACK

	.FUNCT I-SMOKE
	EQUAL? HERE,VIDEO-ARCADE \FALSE
	CALL INT,I-SMOKE >STACK
	PUT STACK,0,0
	CRLF
	PRINTR "A vague electrical smell quickly fades."

	.FUNCT BE-SPECIFIC
	PRINTI "(Be specific: what do you want to "
	RTRUE

	.FUNCT TO-DO-THING-USE,STR1,STR2
	PRINTI "(To "
	PRINT STR1
	PRINTI " something, use the command: "
	PRINT STR2
	PRINTR " THING.)"

	.FUNCT CANT-USE,PTR,BUF,?TMP
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	PRINTI "(This story can't understand the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTR """ when you use it that way.)"

	.FUNCT DONT-UNDERSTAND
	PRINTR "(That sentence didn't make sense. Please reword it or try something else.)"

	.FUNCT NOT-IN-SENTENCE,STR
	PRINTI "(There aren't "
	PRINT STR
	PRINTR " in that sentence!)"

	.FUNCT GROUND-F
	EQUAL? PRSA,V?SEARCH,V?LOOK-ON,V?EXAMINE \?L1
	EQUAL? HERE,INSIDE-THEATER \?L3
	FSET? GLASSES,RMUNGBIT \?L3
	CALL PERFORM,V?LOOK-UNDER,SEAT
	RTRUE
?L3:	PRINT YOU-SEE
	PRINTI "nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTI " about the "
	CALL GROUND-OR-FLOOR
	PRINTR "."
?L1:	EQUAL? PRSA,V?LIE-DOWN,V?SIT \?L10
	CALL V-LIE-DOWN
	RTRUE
?L10:	EQUAL? PRSA,V?THROUGH,V?WALK-TO,V?CROSS /?L12
	EQUAL? PRSA,V?ENTER \?L11
?L12:	CALL V-WALK-AROUND
	RTRUE
?L11:	EQUAL? PRSA,V?PUT-UNDER,V?LOOK-UNDER \?L13
	CALL HOW?
	RTRUE
?L13:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L14
	EQUAL? PRSI,GROUND,AISLE \?L14
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L14:	EQUAL? PRSA,V?TAKE \?L15
	EQUAL? PRSI,GROUND,AISLE \?L15
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L15:	EQUAL? AISLE,PRSO,PRSI /FALSE
	CALL YOU-DONT-NEED,GROUND
	RETURN 2

	.FUNCT GROUND-OR-FLOOR
	FSET? HERE,INDOORSBIT \?L1
	PRINTI "floor"
	RTRUE
?L1:	PRINTD GROUND
	RTRUE

	.FUNCT HERE-F
	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL V-LOOK
	RTRUE
?L1:	EQUAL? PRSA,V?FIND \?L3
	PRINTR "It's right here!"
?L3:	EQUAL? PRSA,V?WALK,V?WALK-TO,V?FOLLOW /?L7
	EQUAL? PRSA,V?CLIMB-ON,V?CROSS,V?LEAVE /?L7
	EQUAL? PRSA,V?ENTER,V?CLIMB-DOWN,V?CLIMB-UP /?L7
	EQUAL? PRSA,V?THROUGH \?L6
?L7:	CALL V-WALK-AROUND
	RETURN 2
?L6:	EQUAL? PRSA,V?DIG,V?LIE-DOWN,V?SIT \?L10
	CALL WASTE-OF-TIME
	RTRUE
?L10:	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT \?L11
	EQUAL? PRSI,PSEUDO-OBJECT \?L11
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L11:	CALL TALKING-TO?,ROAD >STACK
	ZERO? STACK \?L13
	EQUAL? PRSA,V?YELL \?L12
?L13:	CALL NOTHING-EXCITING
	RETURN 2
?L12:	CALL YOU-DONT-NEED,STR?25,1
	RTRUE

	.FUNCT WALLS-F
	FSET? HERE,INDOORSBIT /?L1
	EQUAL? HERE,INSIDE-GRAVE /?L1
	CALL CANT-SEE-ANY,WALLS
	RETURN 2
?L1:	CALL GETTING-INTO? >STACK
	ZERO? STACK \?L6
	EQUAL? PRSA,V?LOOK-BEHIND \?L5
?L6:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L5:	EQUAL? PRSA,V?LOOK-UNDER \?L9
	PRINTR "There's a floor there."
?L9:	CALL HURT?,WALLS >STACK
	ZERO? STACK \?L13
	CALL MOVING?,WALLS >STACK
	ZERO? STACK /?L12
?L13:	CALL SAY-THE,WALLS
	PRINTI " is not affected."
	CRLF
	CALL PRINT-ID,STR?26
	RTRUE
?L12:	CALL TALKING-TO?,WALLS >STACK
	ZERO? STACK \?L17
	EQUAL? PRSA,V?YELL \?L16
?L17:	PRINTI "Talking to walls"
	CALL SIGN-OF-COLLAPSE
	RETURN 2
?L16:	CALL YOU-DONT-NEED,WALLS
	RETURN 2

	.FUNCT CEILING-F
	FSET? HERE,INDOORSBIT /?L1
	CALL CANT-SEE-ANY,CEILING
	RETURN 2
?L1:	EQUAL? PRSA,V?LOOK-UNDER \?L5
	CALL V-LOOK
	RTRUE
?L5:	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \FALSE
	EQUAL? HERE,UNDER-CELL \?L7
	CALL PERFORM,V?EXAMINE,HIDDEN-HATCH
	RTRUE
?L7:	EQUAL? HERE,ON-BRIDGE \FALSE
	PRINTR "The bridge is covered by a roof."

	.FUNCT ME-F,CONTEXT=0,OLIT
	EQUAL? PRSA,V?ALARM \?L1
	PRINTR "You're already wide awake."
?L1:	CALL TALKING-TO?,ME >STACK
	ZERO? STACK \?L6
	EQUAL? PRSA,V?YELL \?L5
?L6:	CALL TALK-TO-SELF
	RETURN 2
?L5:	EQUAL? PRSA,V?LISTEN \?L9
	PRINT CANT
	PRINTR " help doing that."
?L9:	EQUAL? PRSA,V?GIVE \?L12
	EQUAL? PRSI,ME \?L12
	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L13
	PRINTR "You already have it."
?L13:	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L12:	EQUAL? PRSA,V?KILL \?L18
	PRINTI "Desperate? Call the Samaritans."
	CRLF
	CALL PRINT-ID,STR?27
	RTRUE
?L18:	EQUAL? PRSA,V?FIND \?L21
	PRINTR "You're right here!"
?L21:	CALL HURT?,ME >STACK
	ZERO? STACK /FALSE
	PRINTI "Punishing yourself that way won't help matters."
	CRLF
	CALL PRINT-ID,STR?28
	RTRUE

	.FUNCT TALK-TO-SELF
	PRINTI "Talking to yourself"
	CALL SIGN-OF-COLLAPSE
	CALL PCLEAR >STACK
	RSTACK

	.FUNCT SIGN-OF-COLLAPSE
	PRINTR " is said to be a sign of impending mental collapse."

	.FUNCT GLOBAL-ROOM-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE,V?LOOK \?L1
	CALL V-LOOK
	RTRUE
?L1:	EQUAL? PRSA,V?DROP,V?THROUGH,V?ENTER /?L4
	EQUAL? PRSA,V?EXIT \?L3
?L4:	CALL V-WALK-AROUND
	RETURN 2
?L3:	EQUAL? PRSA,V?WALK-AROUND \FALSE
	PRINTR "Walking around the area reveals nothing new.

(If you want to go somewhere, just type a direction.)"

	.FUNCT ALREADY-IN,PLACE,NOT?=0
	PRINTI "But you're "
	ZERO? NOT? /?L3
	PRINTI "not"
	JUMP ?L7
?L3:	PRINTI "already"
?L7:	PRINTI " in "
	CALL ARTICLE,PLACE,1
	PRINTD PLACE
	PRINTR "!"

	.FUNCT UPDATE-SCORE,POINTS
	ADD GSCORE,POINTS >GSCORE
	PRINTI "(Your score just went "
	GRTR? POINTS,-1 \?L3
	PRINTI "up"
	JUMP ?L7
?L3:	PRINTI "DOWN"
?L7:	PRINTI " by "
	LESS? POINTS,0 \?L12
	SUB 0,POINTS >STACK
	JUMP ?L14
?L12:	PUSH POINTS
?L14:	PRINTN STACK
	PRINTI " point"
	EQUAL? POINTS,1,-1 /?L15
	PRINTI "s"
?L15:	PRINTI "! Your total score is "
	PRINTN GSCORE
	PRINTR " out of 101.)"

	.FUNCT GO-INSIDE
	PRINTR "Why not go inside and look around?"

	.FUNCT CANT-MAKE-OUT-ANYTHING
	PRINT CANT
	PRINTR " make out anything inside."

	.FUNCT OBJECT-IS-LOCKED
	PRINT CANT
	PRINTR " do that. It's locked."

	.FUNCT CANT-SEE-ANY,THING=0,STRING?=0
	CALL YOU-CANT-SEE
	ZERO? STRING? /?L1
	PRINT THING
	JUMP ?L13
?L1:	ZERO? THING /?L5
	FSET? THING,NARTICLEBIT /?L6
	PRINTI "any "
?L6:	PRINTD THING
	JUMP ?L13
?L5:	PRINTI "that"
?L13:	PRINTR " here!"

	.FUNCT YOU-CANT-SEE
	SET 'CLOCK-WAIT,1
	CALL PCLEAR
	PRINT CANT
	PRINTI " see "
	RTRUE

	.FUNCT HOW-WOULD-YOU-LIKE-IT,OBJ
	PRINTI "How would you like it if somebody did that to YOUR "
	PRINTD OBJ
	PRINTR "?"

	.FUNCT SIGN-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	EQUAL? HERE,HILLTOP \?L3
	PRINTI "There are two arrows on the signpost. The arrow pointing west says ""To Cemetery."" The east arrow is marked ""To"
	CALL WHICH-TOWN
	PRINTR "."""
?L3:	EQUAL? HERE,ROTARY-WEST \?L9
	CALL SAY-THE,SIGN
	PRINTI " over the "
	PRINTD ENTRANCE
	PRINTI " says, """
	ZERO? SKEWED? /?L12
	PRINTI "Witchville"
	JUMP ?L16
?L12:	PRINTI "Festeron"
?L16:	PRINTR " Police Headquarters."""
?L9:	EQUAL? HERE,NORTH-OF-BRIDGE \?L21
	ZERO? SKEWED? /?L22
	PRINTR "The childlike scrawl is hard to decipher. With a little imagination, you can make out the phrase ""Toll Bridge, One Gold Coin."""
?L22:	CALL CANT-SEE-ANY,SIGN
	RTRUE
?L21:	EQUAL? HERE,CLIFF-EDGE \?L27
	CALL DESCRIBE-SIGN
	RTRUE
?L27:	EQUAL? HERE,PLEASURE-WHARF \?L28
	PRINTR "The neon sign says, ""VIDEO GAMES."""
?L28:	EQUAL? HERE,EDGE-OF-LAKE \?L31
	CALL PERFORM,V?READ,SAND
	RTRUE
?L31:	EQUAL? HERE,GRUE-NEST \?L32
	CALL PERFORM,V?EXAMINE,REFRIGERATOR
	RTRUE
?L32:	EQUAL? HERE,VIDEO-ARCADE \?L33
	CALL ARCADE-SIGN
	RTRUE
?L33:	EQUAL? HERE,CIRCULATION-DESK \?L34
	CALL SAY-THE,SIGN
	PRINTI " over the hall says, ""To "
	PRINTD MUSEUM
	PRINTR "."""
?L34:	EQUAL? HERE,MUSEUM \FALSE
	CALL SAY-DCASE-SIGN
	RTRUE
?L1:	CALL HURT?,SIGN >STACK
	ZERO? STACK \?L41
	EQUAL? PRSA,V?PUT,V?RUB,V?TAKE /?L41
	EQUAL? PRSA,V?MOVE,V?PUSH \?L39
?L41:	CALL PRINT-ID,STR?29
	CALL WASTE-OF-TIME
	RTRUE
?L39:	CALL YOU-DONT-NEED,SIGN
	RETURN 2

	.FUNCT CANT-FIT-INTO?,PLACE
	IN? BRANCH,PROTAGONIST \?L1
	CALL NEVER-GET-IN,PLACE,STR?30
	RTRUE
?L1:	IN? UMBRELLA,PROTAGONIST \?L3
	FSET? UMBRELLA,OPENBIT \?L3
	CALL NEVER-GET-IN,PLACE,STR?31
	RTRUE
?L3:	CALL WEIGHT,PROTAGONIST >STACK
	GRTR? STACK,18 \FALSE
	CALL NEVER-GET-IN,PLACE,STR?32
	RTRUE

	.FUNCT NEVER-GET-IN,PLACE,THING
	PRINTI "You'll never get into the "
	PRINT PLACE
	PRINTI " holding "
	PRINT THING
	PRINTR "!"

	.FUNCT GET-INTO,PLACE
	PRINTI "With great effort, you manage to squeeze yourself into the "
	PRINT PLACE
	PRINTI "."
	CRLF
	CRLF
	RTRUE

	.FUNCT NOT-LIQUID
	CALL ITS-NOT-A,STR?33 >STACK
	RSTACK

	.FUNCT NOT-SOLID
	CALL ITS-NOT-A,STR?34 >STACK
	RSTACK

	.FUNCT ITS-NOT-A,STR
	PRINTI "It's not a "
	PRINT STR
	PRINTR "."

	.FUNCT COME-TO-SENSES
	CALL CARRIAGE-RETURNS
	SET 'BROOM-SIT?,0
	PRINTI "You come to your senses empty-handed and aching all over."
	CRLF
	CRLF
	CALL V-LOOK
	CALL I-LUCK
	CALL I-GLOW >STACK
	RSTACK

	.FUNCT PROBABLY-DROWN-IN-RIVER
	CALL PROBABLY-DROWN,1
	RFALSE

	.FUNCT PROBABLY-DROWN,RIVER?=0
	PRINTI "You'd probably drown in the "
	CALL PRINT-ID,STR?35
	ZERO? RIVER? /?L3
	PRINTD RIVER
	JUMP ?L9
?L3:	EQUAL? HERE,WHARF,TIDAL-POOL,FESTERON-POINT \?L5
	PRINTD BAY
	JUMP ?L9
?L5:	EQUAL? HERE,EDGE-OF-LAKE,RIVER-OUTLET,ISLAND \?L6
	PRINTD LAKE
	JUMP ?L9
?L6:	EQUAL? HERE,PARK \?L7
	PRINTD FOUNTAIN
	JUMP ?L9
?L7:	EQUAL? HERE,HILLTOP \?L8
	ZERO? SKEWED? /?L8
	PRINTD MOAT
	JUMP ?L9
?L8:	PRINTD RIVER
?L9:	CALL WENT-THAT-WAY
	RFALSE

	.FUNCT WENT-THAT-WAY
	PRINTR " if you went that way."

	.FUNCT WATER-DIRTY
	PRINTR "Better not. The water might be dirty."

	.FUNCT HANDLE-WATER?
	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L1
	CALL PROBABLY-DROWN
	RTRUE
?L1:	EQUAL? PRSA,V?TASTE,V?DRINK \?L3
	CALL WATER-DIRTY
	RTRUE
?L3:	EQUAL? PRSA,V?BITE,V?EAT \?L4
	CALL NOT-SOLID
	RTRUE
?L4:	EQUAL? PRSA,V?PUT-UNDER,V?PUT-ON,V?PUT /?L6
	EQUAL? PRSA,V?THROW \?L5
?L6:	EQUAL? PRSI,BAY,RIVER,LAKE /?L7
	EQUAL? PRSI,MOAT \?L5
?L7:	REMOVE PRSO
	PRINTI "Splash!"
	CRLF
	CRLF
	EQUAL? PRSO,HORSE,DHORSE \?L10
	CALL ENABLED?,I-HORSE-DEATH >STACK
	ZERO? STACK /?L12
	CALL INT,I-HORSE-DEATH >STACK
	PUT STACK,0,0
?L12:	CALL SAY-THE,PRSO
	PRINTI " floats without moving for a few anxious moments. Then it "
	EQUAL? PRSO,DHORSE \?L17
	PRINTI "sinks slowly into the dark water"
	JUMP ?L21
?L17:	CALL PRINT-ID,STR?36
	SET 'HORSE-SAVED?,1
	PRINTI "springs suddenly to life, circling and splashing joyfully in the waves. Before it swims away it looks up at you with an unmistakable expression of gratitude"
?L21:	PRINTR "."
?L10:	EQUAL? PRSO,CANDLE \?L26
	FSET? CANDLE,ONBIT \?L26
	PRINTI "Weird! "
	CALL SAY-THE,CANDLE
	PRINTI " remains lit even as it"
	CALL PRINT-ID,STR?37
	CALL SINKS-INTO-WATER
	RTRUE
?L26:	PRINTI "Silently, "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	CALL PRINT-ID,STR?38
	CALL SINKS-INTO-WATER
	RTRUE
?L5:	EQUAL? PRSA,V?PUSH-TO \?L36
	EQUAL? PRSI,BAY,RIVER,LAKE /?L37
	EQUAL? PRSI,MOAT \?L36
?L37:	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L38
	CALL PRESUMABLY-YOU-WANT-TO,STR?39,PRSI
	CALL PERFORM,V?PUT,PRSO,PRSI
	RTRUE
?L38:	IN? PRSO,HERE \?L40
	FSET? PRSO,TAKEBIT \?L40
	MOVE PRSO,PROTAGONIST
	PRINTI "(with your foot)"
	CRLF
	CALL PERFORM,V?PUT,PRSO,PRSI
	RTRUE
?L40:	CALL V-PUSH-TO
	RTRUE
?L36:	CALL SEE-VERB? >STACK
	ZERO? STACK /?L44
	PRINTR "The water is too deep to see much of anything."
?L44:	CALL YOU-DONT-NEED,STR?40,1
	RETURN 2

	.FUNCT SINKS-INTO-WATER
	PRINTI " disappears beneath the surface of "
	CALL ARTICLE,PRSI,1
	PRINTD PRSI
	PRINTR "."

	.FUNCT YOU-ARE-HOLDING,THING,AGAIN=0
	CALL THIS-IS-IT,THING
	CRLF
	CRLF
	PRINTI "(You are "
	ZERO? AGAIN /?L3
	PRINTI "again"
	JUMP ?L7
?L3:	PRINTI "now"
?L7:	PRINTI " holding "
	CALL ARTICLE,THING,AGAIN
	PRINTD THING
	PRINTI ".)"
	RTRUE

	.FUNCT NOTHING-EXCITING
	PRINTR "Nothing exciting happens."

	.FUNCT THAT-WAS-CLOSE
	PRINTR "Whew! That was close."

	.FUNCT GOOD-PLACE-TO-SAVE
	CRLF
	PRINTR "(This might be a good time to SAVE your story position.)"

	.FUNCT HOW?
	PRINTR "How do you intend to do that?"

	.FUNCT CORNER-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?LOOK-ON,V?EXAMINE \?L1
	CALL V-LOOK
	RTRUE
?L1:	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L3
	PRINTI "You're close enough to the "
	PRINTD CORNER
	PRINTR " already."
?L3:	CALL YOU-DONT-NEED,CORNER
	RETURN 2

	.FUNCT TOO-FAR-AWAY,OBJ
	CALL UNFORTUNATELY
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	PRINTR " is too far away for you to do that."

	.FUNCT UNFORTUNATELY
	PRINTI "Unfortunately, "
	RTRUE

	.FUNCT EXCELLENT-VIEW,OBJ
	CALL SAY-THE,OBJ
	PRINTR " affords an excellent view of the surrounding area."

	.FUNCT ALREADY-AT,OBJ,TOP?=0
	PRINTI "You're already at the "
	ZERO? TOP? /?L3
	PRINTI "top"
	JUMP ?L7
?L3:	PRINTI "bottom"
?L7:	PRINTI " of the "
	PRINTD OBJ
	PRINTR "!"

	.FUNCT LOITERING-ON,OBJ
	PRINTI "There's no reason to loiter around the "
	PRINTD OBJ
	PRINTR "."

	.FUNCT PRESUMABLY-YOU-WANT-TO,STR,THING=0
	PRINT I-ASSUME
	PRINTI " "
	PRINT STR
	PRINTI " "
	ZERO? THING /?L3
	CALL ARTICLE,THING,1
	PRINTD THING
	JUMP ?L7
?L3:	PRINTI "it"
?L7:	PRINTR ".)"

	.FUNCT MAKE-IT-SNAPPY
	PRINTI " If you want to make a wish, you'd better make it snappy!)"
	RTRUE

	.FUNCT HOLD-YOUR-PEACE
	PRINTI " Wish now, or forever hold your peace!)"
	RTRUE

	.FUNCT IT-IGNORES-YOU,WHO
	CALL SAY-THE,WHO
	PRINTI " "
	CALL PICK-ONE,IGNORANCE >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT SOUND-F
	EQUAL? PRSA,V?LISTEN \?L1
	EQUAL? HERE,INSIDE-THEATER \?L3
	EQUAL? MOVIE-SCRIPT,6 /?L7
	ZERO? ECLIPSE? /?L5
?L7:	CALL BLANK-SCREEN
	RTRUE
?L5:	PRINTR "The soundtrack is an artless mix of Witchville slogans and John Philip Sousa marches, played at earsplitting volume."
?L3:	EQUAL? HERE,LOBBY \?L11
	LESS? MOVIE-SCRIPT,6 \?L11
	ZERO? ECLIPSE? \?L11
	PRINT YOU-HEAR
	PRINTI "a blare of noise coming from inside the "
	PRINTD MOVIE-THEATER
	JUMP ?L31
?L11:	EQUAL? HERE,HILLTOP \?L14
	FSET? ENVELOPE,RMUNGBIT /?L14
	PRINTI "Uh-oh! The calling voice belongs to"
	CALL BOSS
	PRINTR "!"
?L14:	EQUAL? HERE,MUSEUM \?L19
	CALL ENABLED?,I-PLEA >STACK
	ZERO? STACK /?L19
	PRINTI "The voice sounds just like the "
	PRINTD OLD-WOMAN
	PRINTI " you met at the "
	PRINTD MAGICK-SHOPPE
	JUMP ?L31
?L19:	EQUAL? HERE,INSIDE-SHOPPE \?L22
	FSET? CLOCK,RMUNGBIT \?L22
	CALL PERFORM,V?LISTEN,CLOCK
	RTRUE
?L22:	EQUAL? HERE,JAIL-CELL \?L23
	LESS? JAIL-SCRIPT,9 \?L24
	PRINTI "The "
	CALL EVIL-VOICES
	PRINTR " don't sound very friendly."
?L24:	CALL HEAR-WAILS
	RTRUE
?L23:	PRINTI "At the moment, you hear nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
?L31:	PRINTR "."
?L1:	EQUAL? PRSA,V?WALK-TO,V?FOLLOW \?L36
	CALL V-WALK-AROUND
	RTRUE
?L36:	EQUAL? PRSA,V?WAIT-FOR \?L37
	CALL V-WAIT
	RTRUE
?L37:	EQUAL? PRSA,V?REPLY \?L38
	EQUAL? HERE,HILLTOP \?L38
	FSET? ENVELOPE,RMUNGBIT /?L38
	PRINTR "You'll have to go inside to do that."
?L38:	CALL TALKING-TO?,SOUND >STACK
	ZERO? STACK \?L42
	EQUAL? PRSA,V?YELL \?L41
?L42:	PRINTI "Try addressing the source of the sound."
	CRLF
	RETURN 2
?L41:	PRINT CANT
	CALL DO-TO
	PRINTI "a "
	PRINTD SOUND
	PRINTR "!"

	.FUNCT TOO-LARGE,THING,SMALL?=0
	CALL BUT-THE,THING
	PRINTI "is much too "
	ZERO? SMALL? /?L3
	PRINTI "small"
	JUMP ?L7
?L3:	PRINTI "large"
?L7:	PRINTR "!"

	.FUNCT FROBOZZ,STR
	PRINTI "Frobozz Magic "
	PRINT STR
	PRINTI " Company"
	RTRUE

	.FUNCT NOT-LIKELY,THING,STR
	PRINTI "It"
	CALL PICK-ONE,LIKELIES >STACK
	PRINT STACK
	PRINTI " that "
	CALL ARTICLE,THING,1
	PRINTD THING
	PRINTI " "
	PRINT STR
	PRINTR "."

	.FUNCT YOUD-HAVE-TO,STR,THING
	PRINTI "You'd have to "
	PRINT STR
	PRINTI " "
	CALL ARTICLE,THING,1
	PRINTD THING
	PRINTR " to do that."

	.FUNCT CLOSED-AND-LOCKED
	PRINTR " closed and locked."

	.FUNCT STANDING
	PRINTI "You're standing "
	RTRUE

	.FUNCT DO-TO
	PRINTI " do that to "
	RTRUE

	.FUNCT INTRO
	PRINTI """Behind you!"" cries the Princess. ""It's a trap!""

Too late. The "
	PRINTD DRAWBRIDGE
	PRINTI " crashes shut against the "
	PRINTD TOWER
	PRINTI " wall. You turn to face your enemy, and find yourself staring into the open maw of"
	RTRUE

	.FUNCT FIRED,TIMEOUT?=0
	CRLF
	PRINTI """There you are, "
	CALL PICK-ONE,INSULTS >STACK
	PRINT STACK
	PRINTI "!""

You wince as "
	PRINTD CRISP
	PRINTI " strides into view and grabs you by the front of your uniform.

""You good-for-nothing "
	CALL PICK-ONE,INSULTS >STACK
	PRINT STACK
	PRINTI "!"" he bellows in your face. ""I wanted you to "
	ZERO? TIMEOUT? /?L3
	PRINTI "deliver that envelope BEFORE five o'clock! Now the "
	PRINTD MAGICK-SHOPPE
	PRINTI " is closed... and y"
	JUMP ?L7
?L3:	PRINTI "get back to the "
	PRINTD POST-OFFICE
	PRINTI " as soon as you were done with that envelope! Y"
?L7:	PRINTI "ou're FIRED!"""
	CALL BAD-ENDING >STACK
	RSTACK

	.FUNCT SAY-HURRY
	CRLF
	PRINTI "(It's "
	CALL TELL-TIME
	PRINTI ". Better hurry! "
	RTRUE

	.FUNCT BETTER-HURRY,HALF?=0
	CALL SAY-HURRY
	CALL SAY-THE,MAGICK-SHOPPE
	PRINTI " closes in less than "
	ZERO? HALF? /?L3
	PRINTI "half "
?L3:	PRINTR "an hour!)"

	.FUNCT V-BAD-DIRECTION
	PRINTR "(That direction isn't used in this story.)"

	.FUNCT V-VERBOSE
	SET 'VERBOSE,1
	SET 'SUPER-BRIEF,0
	PRINTI "(Maximum verbosity.)"
	CRLF
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT V-BRIEF
	SET 'VERBOSE,0
	SET 'SUPER-BRIEF,0
	PRINTR "(Brief descriptions.)"

	.FUNCT V-SUPER-BRIEF
	SET 'SUPER-BRIEF,1
	PRINTR "(Super-brief descriptions.)"

	.FUNCT V-INVENTORY
	PRINTI "You're "
	FIRST? PROTAGONIST >STACK \?L3
	PRINTI "holding "
	CALL PRINT-CONTENTS,PROTAGONIST
	JUMP ?L7
?L3:	PRINTI "not holding anything"
?L7:	PRINTR "."

	.FUNCT SAY-SURE
	PRINTI "Are you sure you want to "
	RTRUE

	.FUNCT V-QUIT,ASK?=1,SCOR
	CALL V-SCORE
	ZERO? ASK? /?L1
	CALL SAY-SURE
	PRINTI "leave the story now?"
	CALL YES? >STACK
	ZERO? STACK /?L5
	QUIT
?L5:	PRINT OKAY
	PRINTR "continuing."
?L1:	QUIT

	.FUNCT V-RESTART
	CALL V-SCORE
	CALL SAY-SURE
	PRINTI "restart the story?"
	CALL YES? >STACK
	ZERO? STACK /FALSE
	RESTART

	.FUNCT BAD-ENDING
	MOVE PROTAGONIST,END-ROOM
	SET 'HERE,END-ROOM
	CALL CARRIAGE-RETURNS
	PRINTI "Looks like the story's over. But don't despair! Interactive fiction lets you learn from your mistakes."
	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT FINISH,REPEATING=0,WORD
	CRLF
	ZERO? REPEATING \?L1
	CALL V-SCORE
	CRLF
?L1:	PRINTI "[EVENT: GAME OVER]Do you want to restart the story, restore a saved position, or quit?

(Type RESTART, RESTORE or QUIT.) >"
	READ P-INBUF,P-LEXV
	GET P-LEXV,1 >WORD
	EQUAL? WORD,W?RESTART \?L6
	RESTART
?L6:	EQUAL? WORD,W?RESTORE \?L8
	RESTORE \?L9
	CALL SAY-OKAY >STACK
	RSTACK
?L9:	CALL FAILED
	CALL FINISH,1 >STACK
	RSTACK
?L8:	QUIT

	.FUNCT YES?,WORD
	CRLF
?L1:	CRLF
	PRINTI "(Please type YES or NO.) >"
	PUTB YES-LEXV,0,4
	READ YES-INBUF,YES-LEXV
	GET YES-LEXV,P-LEXSTART >WORD
	GETB YES-LEXV,P-LEXWORDS >STACK
	ZERO? STACK /?L1
	ZERO? WORD /?L1
	EQUAL? WORD,W?YES,W?Y,W?YUP /TRUE
	EQUAL? WORD,W?OKAY,W?OK,W?AYE /TRUE
	EQUAL? WORD,W?SURE,W?AFFIRM,W?POSITI /TRUE
	EQUAL? WORD,W?NO,W?N,W?NOPE /FALSE
	EQUAL? WORD,W?NAY,W?NAW,W?NEGATIVE \?L1
	RFALSE

	.FUNCT SAY-OKAY
	PRINT OKAY
	PRINTR "done."

	.FUNCT FAILED
	PRINTR "Failed."

	.FUNCT V-RESTORE
	RESTORE \?L1
	CALL SAY-OKAY >STACK
	RSTACK
?L1:	CALL FAILED >STACK
	RSTACK

	.FUNCT V-SAVE
	SET 'P-CONT,0
	SAVE \?L1
	CALL SAY-OKAY >STACK
	RSTACK
?L1:	CALL FAILED >STACK
	RSTACK

	.FUNCT V-SCORE
	PRINTI "Your score is "
	PRINTN GSCORE
	PRINTI " point"
	EQUAL? GSCORE,1 /?L3
	PRINTI "s"
?L3:	PRINTI " out of 101, in "
	PRINTN GMOVES
	PRINTI " move"
	EQUAL? GMOVES,1 /?L10
	PRINTI "s"
?L10:	PRINTI "."
	ZERO? SPELLS /?L17
	PRINTI " You've used "
	PRINTN SPELLS
	PRINTI " of the Stone's 7 Wishes."
?L17:	CRLF
	RTRUE

	.FUNCT V-TIME,H,M
	PRINTI "(It's "
	CALL TELL-TIME
	FSET? ENVELOPE,TOUCHBIT \?L53
	EQUAL? HERE,INSIDE-SHOPPE /?L53
	ZERO? ENDING? \?L53
	PRINTI ". You have "
	ZERO? SKEWED? /?L7
	GRTR? SCORE,17 \?L9
	SUB 24,SCORE >STACK
	ADD STACK,5 >H
	JUMP ?L12
?L9:	SUB 5,SCORE >H
	JUMP ?L12
?L7:	SUB 16,SCORE >H
?L12:	ZERO? MOVES \?L13
	SET 'M,0
	INC 'H
	JUMP ?L15
?L13:	SUB 60,MOVES >M
?L15:	ZERO? H \?L16
	PRINTI "only "
	JUMP ?L30
?L16:	PRINTN H
	PRINTI " hour"
	EQUAL? H,1 /?L23
	PRINTI "s"
?L23:	PRINTI " "
	ZERO? M /?L35
	PRINTI "and "
?L30:	ZERO? M /?L35
	PRINTN M
	PRINTI " minute"
	EQUAL? M,1 /?L39
	PRINTI "s"
?L39:	PRINTI " "
?L35:	PRINTI "to complete your "
	ZERO? SKEWED? /?L49
	PRINTI "quest"
	JUMP ?L53
?L49:	PRINTI "delivery"
?L53:	PRINTR ".)"

	.FUNCT TELL-TIME,H,PM?=0
	GRTR? SCORE,11 \?L1
	SET 'PM?,1
?L1:	GRTR? SCORE,12 \?L4
	SUB SCORE,12 >H
	JUMP ?L7
?L4:	ZERO? SCORE \?L6
	SET 'H,12
	JUMP ?L7
?L6:	SET 'H,SCORE
?L7:	PRINTN H
	PRINTI ":"
	LESS? MOVES,10 \?L10
	PRINTI "0"
?L10:	PRINTN MOVES
	ZERO? PM? /?L17
	PRINTI " pm"
	RTRUE
?L17:	PRINTI " am"
	RTRUE

	.FUNCT V-SCRIPT
	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	CALL TRANSCRIPT,STR?41
	RTRUE

	.FUNCT V-UNSCRIPT
	CALL TRANSCRIPT,STR?42
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT TRANSCRIPT,STR
	PRINTI "Here "
	PRINT STR
	PRINTI "s a transcript of interaction with"
	CRLF
	CALL V-VERSION >STACK
	RSTACK

	.FUNCT V-VERSION,CNT=17
	CRLF
	PRINTI "WISHBRINGER
The Magick Stone of Dreams
Copyright (C)1985 Infocom, Inc. All rights reserved."
	CRLF
	PRINT GAME
	PRINTI " is a registered trademark of Infocom, Inc.
Release "
	GET 0,1 >STACK
	BAND STACK,2047 >STACK
	PRINTN STACK
	PRINTI " / Serial Number "
?L7:	IGRTR? 'CNT,23 /?L8
	GETB 0,CNT >STACK
	PRINTC STACK
	JUMP ?L7
?L8:	CRLF
	RTRUE

	.FUNCT V-USE
	FSET? PRSO,ACTORBIT \?L1
	CALL BUT-THE,PRSO
	PRINTR "might resent that."
?L1:	CALL HOW? >STACK
	RSTACK

	.FUNCT V-$0024VERIFY
	ZERO? PRSO /?L1
	EQUAL? PRSO,INTNUM \?L3
	EQUAL? P-NUMBER,93 \?L3
	PRINTN SERIAL
	CRLF
	RTRUE
?L3:	CALL DONT-UNDERSTAND >STACK
	RSTACK
?L1:	PRINTI "Verifying disk."
	CRLF
	VERIFY \?L11
	PRINTR "Correct."
?L11:	CALL FAILED >STACK
	RSTACK

	.FUNCT V-AGAIN,OBJ
	ZERO? L-PRSA \?L1
	SET 'L-PRSA,V?HELP
	SET 'PRSA,V?HELP
	PRINTI "("
	PRINT CANT
	PRINTR " use AGAIN that way.)"
?L1:	EQUAL? L-PRSA,V?WALK \?L5
	CALL DO-WALK,L-PRSO >STACK
	RSTACK
?L5:	ZERO? L-PRSO /?L7
	LOC L-PRSO >STACK
	EQUAL? STACK,ROOMS \?L7
	SET 'OBJ,L-PRSO
	JUMP ?L8
?L7:	ZERO? L-PRSI /?L9
	LOC L-PRSI >STACK
	EQUAL? STACK,ROOMS \?L9
	SET 'OBJ,L-PRSI
	JUMP ?L8
?L9:	SET 'OBJ,0
?L8:	EQUAL? OBJ,0,PSEUDO-OBJECT,ROOMS /?L11
	CALL YOU-CANT-SEE
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	PRINTI " anymore."
	CRLF
	RETURN 2
?L11:	CALL PERFORM,L-PRSA,L-PRSO,L-PRSI >STACK
	RSTACK

	.FUNCT V-ALARM
	EQUAL? PRSO,ME,ROOMS \?L1
	PRINTI "But you're "
	JUMP ?L8
?L1:	FSET? PRSO,ACTORBIT \?L5
	CALL BUT-THE,PRSO
	PRINTI "is "
	JUMP ?L8
?L5:	CALL WHAT-A-CONCEPT
	RTRUE
?L8:	PRINTI "already wide awake!"
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?43,STACK >STACK
	RSTACK

	.FUNCT V-ASK-ABOUT
	CALL V-ASK-FOR >STACK
	RSTACK

	.FUNCT V-QUESTION
	CALL V-ASK-FOR >STACK
	RSTACK

	.FUNCT V-WAVE-AT
	CALL V-ASK-FOR >STACK
	RSTACK

	.FUNCT V-ASK-FOR
	EQUAL? PRSO,ME,ROOMS \?L1
	CALL PERFORM,V?TELL,ME
	JUMP ?L3
?L1:	CALL NOT-LIKELY,PRSO,STR?44
?L3:	CALL PCLEAR
	RETURN 2

	.FUNCT V-BITE,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?45,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?46,STACK
	CALL HACK-HACK,STR?47 >STACK
	RSTACK

	.FUNCT V-BLOW-INTO
	FSET? PRSO,ACTORBIT \?L1
	CALL PERFORM,V?USE,PRSO
	RTRUE
?L1:	CALL HACK-HACK,STR?48 >STACK
	RSTACK

	.FUNCT V-BURN,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?49,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?50,STACK
	EQUAL? PRSI,CANDLE \?L3
	FSET? CANDLE,ONBIT \?L5
	PRINTR "Some people just can't be trusted with fire."
?L5:	CALL BUT-THE,CANDLE
	PRINTR "isn't lit!"
?L3:	PRINTI "With "
	CALL ARTICLE,PRSI
	PRINTD PRSI
	PRINTI "? "
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-BUY
	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK \?L1
	CALL CANT-SEE-ANY,PRSO
	RTRUE
?L1:	FSET? PRSO,TAKEBIT /?L3
	FSET? PRSO,TRYTAKEBIT /?L3
	PRINT CANT
	PRINTR " buy that!"
?L3:	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L6
	PRINTR "You already have one."
?L6:	ZERO? PRSI /?L9
	EQUAL? PRSI,COIN \?L10
	PRINTI "You couldn't buy "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " with only one "
	PRINTD COIN
	PRINTR "."
?L10:	CALL NOT-LIKELY,PRSI,STR?51 >STACK
	RSTACK
?L9:	CALL HELD?,COIN >STACK
	ZERO? STACK /?L17
	CALL WITH-COIN
	CALL NOT-LIKELY,COIN,STR?51 >STACK
	RSTACK
?L17:	CALL NO-MONEY >STACK
	RSTACK

	.FUNCT WITH-COIN
	PRINTI "(with the "
	PRINTD COIN
	PRINTR ")"

	.FUNCT NO-MONEY
	PRINTR "You don't have any money."

	.FUNCT V-CLEAN
	CALL NOT-A,STR?52 >STACK
	RSTACK

	.FUNCT V-CLIMB-DOWN
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L1:	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT V-CLIMB-ON
	PRINT CANT
	PRINTI " climb onto that."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?53,STACK >STACK
	RSTACK

	.FUNCT V-CLIMB-OVER
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?54,STACK
	EQUAL? PRSO,ROOMS \?L1
	CALL V-WALK-AROUND >STACK
	RSTACK
?L1:	PRINT CANT
	PRINTR " climb over that."

	.FUNCT V-CLIMB-UP
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT V-CLOSE
	FSET? PRSO,ACTORBIT \?L1
	CALL NOT-A,STR?55 >STACK
	RSTACK
?L1:	FSET? PRSO,SURFACEBIT \?L3
	CALL CANT-CLOSE-THAT >STACK
	RSTACK
?L3:	FSET? PRSO,CONTBIT /?L4
	FSET? PRSO,DOORBIT /?L4
	CALL PERFORM,V?OPEN,PRSO
	RTRUE
?L4:	FSET? PRSO,SURFACEBIT /?L5
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L5
	FSET? PRSO,OPENBIT \?L6
	CALL NOW-CLOSED-OR-OPEN,PRSO
	CALL SAY-IF-NOT-LIT >STACK
	RSTACK
?L6:	CALL ALREADY-CLOSED >STACK
	RSTACK
?L5:	FSET? PRSO,DOORBIT \?L9
	FSET? PRSO,OPENBIT \?L10
	CALL NOW-CLOSED-OR-OPEN,PRSO
	EQUAL? PRSO,LIBRARY-DOOR \FALSE
	FCLEAR CIRCULATION-DESK,ONBIT
	CALL SAY-IF-NOT-LIT >STACK
	RSTACK
?L10:	CALL ALREADY-CLOSED >STACK
	RSTACK
?L9:	CALL CANT-CLOSE-THAT >STACK
	RSTACK

	.FUNCT CANT-CLOSE-THAT
	PRINT CANT
	PRINTR " close that!"

	.FUNCT NOW-CLOSED-OR-OPEN,THING,OPEN?=0
	CALL THIS-IS-IT,THING
	PRINT OKAY
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " is now "
	ZERO? OPEN? /?L5
	FSET THING,OPENBIT
	PRINTI "open"
	JUMP ?L9
?L5:	FCLEAR THING,OPENBIT
	PRINTI "closed"
?L9:	PRINTR "."

	.FUNCT V-COUNT
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-COVER
	CALL PERFORM,V?PUT-ON,PRSI,PRSO
	RTRUE

	.FUNCT V-CROSS
	PRINT CANT
	PRINTR " cross that!"

	.FUNCT V-CUT,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?56,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?57,STACK
	CALL NOT-LIKELY,PRSI,STR?58 >STACK
	RSTACK

	.FUNCT V-DIG
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-DRINK
	PRINT CANT
	PRINTI " drink that!"
	CRLF
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?59,STACK >STACK
	RSTACK

	.FUNCT V-DRINK-FROM
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?60,STACK
	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT V-DROP
	EQUAL? HERE,OUTSIDE-COTTAGE \?L1
	CALL PERFORM,V?GIVE,PRSO,POOCH
	RTRUE
?L1:	CALL IDROP >STACK
	ZERO? STACK /FALSE
	PRINTR "Dropped."

	.FUNCT IDROP
	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \FALSE
	IN? PRSO,WINNER /?L3
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L3
	PRINT CANT
	PRINTI " do that while "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	CALL IS-CLOSED
	CRLF
	RFALSE
?L3:	FSET? PRSO,WORNBIT \?L6
	CALL TAKE-OFF-PRSO-FIRST
	JUMP ?L8
?L6:	EQUAL? PRSO,KITTY \?L7
	SET 'HORSE-SCRIPT,3
	JUMP ?L8
?L7:	EQUAL? PRSO,BROOM \?L8
	ZERO? BROOM-SIT? /?L8
	CALL GET-OFF-BROOM-FIRST
?L8:	EQUAL? HERE,FOG,STEEP-TRAIL,FUZZY /?L12
	EQUAL? HERE,OUTSIDE-COTTAGE \?L10
?L12:	CALL SAY-THE,PRSO
	PRINTI " drops out of "
	PRINTD HANDS
	PRINTI "s"
	CALL AND-DROPS-OUT,PRSO
	RFALSE
?L10:	LOC WINNER >STACK
	MOVE PRSO,STACK
	RTRUE

	.FUNCT V-EAT
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?61,STACK
	CALL NOT-LIKELY,PRSO,STR?62 >STACK
	RSTACK

	.FUNCT V-ENTER,VEHICLE
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?IN
	RTRUE
?L1:	FSET? PRSO,WEARBIT \?L3
	CALL PRESUMABLY-YOU-WANT-TO,STR?63,PRSO
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L3:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT PRE-DUMB-EXAMINE
	ZERO? LIT \?L1
	CALL TOO-DARK
	RTRUE
?L1:	PRINT I-ASSUME
	PRINTI " LOOK AT "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI ", not LOOK INSIDE or LOOK ON or LOOK UNDER or LOOK BEHIND "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?EXAMINE,PRSO
	RTRUE

	.FUNCT V-DUMB-EXAMINE
	CALL V-EXAMINE >STACK
	RSTACK

	.FUNCT PRE-EXAMINE
	ZERO? LIT \FALSE
	CALL TOO-DARK
	RTRUE

	.FUNCT V-EXAMINE
	FSET? PRSO,DOORBIT \?L1
	PRINTI "It looks like "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " is "
	FSET? PRSO,OPENBIT \?L7
	PRINTI "open"
	JUMP ?L11
?L7:	PRINTI "closed"
?L11:	PRINTR "."
?L1:	FSET? PRSO,SURFACEBIT \?L16
	CALL V-LOOK-ON >STACK
	RSTACK
?L16:	FSET? PRSO,CONTBIT \?L17
	FSET? PRSO,OPENBIT /?L20
	FSET? PRSO,TRANSBIT \?L18
?L20:	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L18:	CALL ITS-CLOSED,PRSO >STACK
	RSTACK
?L17:	PRINTI "You see nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTI " about "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-EXIT
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-FILL
	ZERO? PRSI \?L1
	PRINTR "There's nothing to fill it with."
?L1:	CALL HOW? >STACK
	RSTACK

	.FUNCT V-FIND,L
	LOC PRSO >L
	EQUAL? PRSO,ME,HANDS \?L1
	PRINTI "You're right here"
	JUMP ?L28
?L1:	IN? PRSO,PROTAGONIST \?L5
	PRINTI "You're holding it"
	JUMP ?L28
?L5:	IN? PRSO,HERE /?L9
	EQUAL? PRSO,PSEUDO-OBJECT \?L8
?L9:	CALL BUT-THE,PRSO
	PRINTI "is right in front of you"
	JUMP ?L28
?L8:	IN? PRSO,LOCAL-GLOBALS \?L12
	CALL HOW?
	RTRUE
?L12:	FSET? L,ACTORBIT \?L13
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L13
	PRINTI "It looks like "
	CALL ARTICLE,L,1
	PRINTD L
	PRINTI " has it"
	JUMP ?L28
?L13:	CALL SEE-INSIDE?,L >STACK
	ZERO? STACK /?L18
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L18
	PRINTI "It's "
	FSET? L,SURFACEBIT \?L21
	PRINTI "on "
	JUMP ?L25
?L21:	PRINTI "in "
?L25:	CALL ARTICLE,L,1
	PRINTD L
	JUMP ?L28
?L18:	PRINTI "You'll have to do that yourself"
?L28:	PRINTR "."

	.FUNCT V-FIRST-LOOK
	CALL DESCRIBE-ROOM >STACK
	ZERO? STACK /FALSE
	ZERO? SUPER-BRIEF \FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT V-FLY
	PRINT CANT
	PRINTR " do that without Magick."

	.FUNCT V-FOLLOW,WHERE
	LOC PRSO >WHERE
	CALL BUT-THE,PRSO
	PRINTI "is "
	EQUAL? WHERE,HERE /?L5
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK /?L3
?L5:	PRINTI "right here in front of you"
	JUMP ?L16
?L3:	EQUAL? WHERE,PROTAGONIST \?L8
	PRINTI "in "
	PRINTD HANDS
	PRINTI "s"
	JUMP ?L16
?L8:	IN? WHERE,PROTAGONIST \?L11
	PRINTI "in "
	CALL ARTICLE,WHERE,1
	PRINTD WHERE
	JUMP ?L16
?L11:	PRINTI "nowhere to be seen"
?L16:	PRINTR "!"

	.FUNCT PRE-FEED
	CALL PRE-GIVE,1 >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT V-FEED
	CALL V-GIVE,1 >STACK
	RSTACK

	.FUNCT V-SFEED
	CALL PERFORM,V?FEED,PRSI,PRSO
	RTRUE

	.FUNCT PRE-GIVE,FEED?=0
	ZERO? PRSO /?L3
	ZERO? PRSI \?L1
?L3:	CALL REFERRING
	RTRUE
?L1:	IN? PRSO,LOCAL-GLOBALS /?L5
	IN? PRSO,PSEUDO-OBJECT \?L4
?L5:	CALL NOT-HOLDING
	RTRUE
?L4:	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \TRUE
	FSET? PRSI,ACTORBIT /?L7
	EQUAL? PRSI,MAILBOX /?L7
	PRINT CANT
	ZERO? FEED? /?L10
	PRINTI " feed"
	JUMP ?L14
?L10:	PRINTI " give"
?L14:	PRINTR " anything to that!"
?L7:	FSET? PRSO,WORNBIT \?L19
	CALL TAKE-OFF-PRSO-FIRST
	RFALSE
?L19:	EQUAL? PRSO,BROOM \FALSE
	ZERO? BROOM-SIT? /FALSE
	CALL GET-OFF-BROOM-FIRST
	RFALSE

	.FUNCT V-SGIVE
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT V-GIVE,FEED?=0
	FSET? PRSI,ACTORBIT \?L1
	PRINTI "Politely, "
	CALL ARTICLE,PRSI,1
	PRINTD PRSI
	PRINTR " refuses your offer."
?L1:	PRINT CANT
	ZERO? FEED? /?L10
	PRINTI " feed "
	JUMP ?L14
?L10:	PRINTI " give "
?L14:	CALL ARTICLE,PRSO
	PRINTD PRSO
	PRINTI " to "
	CALL ARTICLE,PRSI
	PRINTD PRSI
	PRINTR "!"

	.FUNCT V-HEEL
	ZERO? WINNER /?L1
	CALL NOT-LIKELY,WINNER,STR?64 >STACK
	RSTACK
?L1:	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT V-HELLO,WHO
	ZERO? PRSO /?L1
	SET 'WHO,PRSO
	JUMP ?L4
?L1:	CALL ANYONE-HERE? >WHO
	ZERO? WHO /?L7
	CALL SPOKEN-TO,WHO
	CALL PERFORM,V?HELLO,WHO
	RTRUE
?L4:	ZERO? WHO /?L7
	FSET? WHO,ACTORBIT \?L9
	PRINTI "It's apparent that "
	CALL ARTICLE,WHO,1
	PRINTD WHO
	PRINTR " didn't expect you to say that."
?L9:	CALL NOT-LIKELY,WHO,STR?44 >STACK
	RSTACK
?L7:	CALL TALK-TO-SELF >STACK
	RSTACK

	.FUNCT V-HELP
	PRINTI "(If you're really stuck, maps and InvisiClues (TM) Hint Booklets are available using the order form that came"
	CALL IN-YOUR-PACKAGE
	PRINTR ".)"

	.FUNCT FIND-IN-PACKAGE,STRING
	PRINTI "(You'll find the "
	PRINT STRING
	CALL IN-YOUR-PACKAGE
	PRINTR ".)"

	.FUNCT REFER-TO-MAP
	PRINTI "(Look at the map"
	CALL IN-YOUR-PACKAGE
	PRINTR " for directions.)"

	.FUNCT CONSULT-PACKAGE
	CALL REFER-TO-MANUAL
	PRINTR " for the correct way to make a Wish.)"

	.FUNCT REFER-TO-MANUAL
	PRINTI "(Refer to the manual"
	CALL IN-YOUR-PACKAGE >STACK
	RSTACK

	.FUNCT IN-YOUR-PACKAGE
	PRINTI " inside your "
	PRINT GAME
	PRINTI " package"
	RTRUE

	.FUNCT V-HIDE
	PRINTR "There aren't any good hiding places here."

	.FUNCT V-KICK,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?65,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?66,STACK
	CALL HACK-HACK,STR?67 >STACK
	RSTACK

	.FUNCT V-KILL
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?68,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?69,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?70,STACK
	FSET? PRSO,ACTORBIT /?L1
	PRINT CANT
	PRINTI " attack "
	CALL ARTICLE,PRSO
	PRINTD PRSO
	PRINTR "!"
?L1:	PRINTI "Attacking "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	ZERO? PRSI /?L10
	PRINTI " with "
	CALL ARTICLE,PRSI
	PRINTD PRSI
?L10:	PRINTR " isn't likely to help matters."

	.FUNCT V-KNOCK
	FSET? PRSO,DOORBIT \?L1
	CALL NO-ANSWER >STACK
	RSTACK
?L1:	FSET? PRSO,ACTORBIT \?L3
	CALL PERFORM,V?USE,PRSO
	RTRUE
?L3:	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-KISS
	PRINTI "Smack!"
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?71,STACK >STACK
	RSTACK

	.FUNCT V-LAMP-OFF
	CALL V-LAMP-ON,1 >STACK
	RSTACK

	.FUNCT V-LAMP-ON,OFF?=0
	PRINT CANT
	PRINTI " turn that "
	ZERO? OFF? /?L3
	PRINTI "off"
	JUMP ?L7
?L3:	PRINTI "on"
?L7:	PRINTR "."

	.FUNCT V-LEAP
	EQUAL? PRSO,ROOMS /?L1
	PRINTR "That'd be a cute trick."
?L1:	FSET? HERE,WETBIT \?L5
	CALL YOU-MEAN-WATER >STACK
	RSTACK
?L5:	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT YOU-MEAN-WATER
	PRINT I-ASSUME
	PRINTI " in the water.)"
	CRLF
	CALL PRINT-ID,STR?72
	CALL PROBABLY-DROWN >STACK
	RSTACK

	.FUNCT V-LEAVE
	EQUAL? PRSO,ROOMS /?L3
	FSET? PRSO,TAKEBIT /?L1
?L3:	CALL DO-WALK,P?OUT
	RTRUE
?L1:	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \TRUE
	CALL PERFORM,V?DROP,PRSO
	RTRUE

	.FUNCT V-LIE-DOWN
	PRINTR "This is no time for resting."

	.FUNCT V-LISTEN
	EQUAL? PRSO,ROOMS \?L1
	CALL PERFORM,V?LISTEN,SOUND
	RTRUE
?L1:	PRINTI "At the moment, "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR " makes no sound."

	.FUNCT V-LOCK
	FSET? PRSO,DOORBIT /?L3
	FSET? PRSO,CONTBIT \?L1
?L3:	FSET? PRSO,OPENBIT \?L4
	CALL YOUD-HAVE-TO,STR?73,PRSO >STACK
	RSTACK
?L4:	FSET? PRSO,LOCKEDBIT \?L6
	CALL BUT-THE,PRSO
	PRINTR "is already locked."
?L6:	CALL THING-WONT-LOCK,PRSI,PRSO >STACK
	RSTACK
?L1:	CALL CANT-LOCK >STACK
	RSTACK

	.FUNCT V-UNLOCK
	FSET? PRSO,DOORBIT /?L3
	FSET? PRSO,CONTBIT \?L1
?L3:	FSET? PRSO,OPENBIT \?L4
	CALL ALREADY-OPEN >STACK
	RSTACK
?L4:	FSET? PRSO,LOCKEDBIT /?L6
	CALL BUT-THE,PRSO
	PRINTR "isn't locked."
?L6:	CALL THING-WONT-LOCK,PRSI,PRSO,1 >STACK
	RSTACK
?L1:	CALL CANT-LOCK,1 >STACK
	RSTACK

	.FUNCT CANT-LOCK,UN?=0
	PRINT CANT
	PRINTI " "
	ZERO? UN? /?L3
	PRINTI "un"
?L3:	PRINTI "lock "
	CALL ARTICLE,PRSO
	PRINTD PRSO
	PRINTR "!"

	.FUNCT THING-WONT-LOCK,THING,CLOSED-THING,UN?=0
	PRINTI "A quick test shows that "
	CALL ARTICLE,THING,1
	PRINTD THING
	PRINTI " won't "
	ZERO? UN? /?L5
	PRINTI "un"
?L5:	PRINTI "lock "
	CALL ARTICLE,CLOSED-THING,1
	PRINTD CLOSED-THING
	PRINTR "."

	.FUNCT V-LOOK
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT V-LOOK-BEHIND
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	PRINTI "There's nothing behind "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-LOOK-DOWN
	ZERO? LIT \?L1
	CALL TOO-DARK
	RTRUE
?L1:	EQUAL? PRSO,ROOMS \?L3
	CALL PERFORM,V?EXAMINE,GROUND
	RTRUE
?L3:	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE

	.FUNCT V-LOOK-UP
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	EQUAL? PRSO,ROOMS \?L3
	EQUAL? HERE,UNDER-HILL \?L4
	CALL PERFORM,V?EXAMINE,STUMP
	RTRUE
?L4:	FSET? HERE,INDOORSBIT \?L6
	CALL PERFORM,V?EXAMINE,CEILING
	RTRUE
?L6:	IN? VULTURE,HERE \?L7
	CALL SEE-VULTURE
	RTRUE
?L7:	ZERO? SKEWED? /?L9
	ZERO? SUCCESS? \?L9
	EQUAL? HERE,FOG \?L8
?L9:	CALL STIFF-NECK
	RTRUE
?L8:	CALL PERFORM,V?EXAMINE,MOON
	RTRUE
?L3:	CALL STIFF-NECK >STACK
	RSTACK

	.FUNCT STIFF-NECK
	PRINTR "You begin to get a stiff neck."

	.FUNCT V-LOOK-INSIDE
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	FSET? PRSO,ACTORBIT \?L3
	CALL NOT-A,STR?55 >STACK
	RSTACK
?L3:	FSET? PRSO,DOORBIT \?L4
	CALL PERFORM,V?EXAMINE,PRSO
	RTRUE
?L4:	FSET? PRSO,CONTBIT \?L5
	LOC WINNER >STACK
	EQUAL? PRSO,STACK \?L6
	CALL V-LOOK >STACK
	RSTACK
?L6:	FSET? PRSO,OPENBIT /?L8
	FSET? PRSO,TRANSBIT /?L8
	CALL ITS-CLOSED,PRSO >STACK
	RSTACK
?L8:	PRINT YOU-SEE
	CALL PRINT-CONTENTS,PRSO
	PRINTI " in "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."
?L5:	PRINT CANT
	PRINTI " look inside "
	CALL ARTICLE,PRSO
	PRINTD PRSO
	PRINTR "."

	.FUNCT NOT-A,STR
	PRINTI "You're a mail clerk, not a "
	PRINT STR
	PRINTR "!"

	.FUNCT V-LOOK-ON
	ZERO? LIT \?L1
	CALL TOO-DARK
	RTRUE
?L1:	PRINT YOU-SEE
	FSET? PRSO,SURFACEBIT \?L6
	CALL PRINT-CONTENTS,PRSO
	JUMP ?L8
?L6:	PRINTI "nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
?L8:	PRINTI " on "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-LOOK-THRU
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	ZERO? PRSI /?L3
	FSET? PRSI,TRANSBIT /?L3
	PRINT CANT
	PRINTR " look through that!"
?L3:	CALL NOTHING-INTERESTING,1 >STACK
	RSTACK

	.FUNCT V-LOOK-UNDER
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	IN? PRSO,PROTAGONIST \?L3
	PRINTI "You're already "
	FSET? PRSO,WORNBIT \?L6
	PRINTI "wear"
	JUMP ?L10
?L6:	PRINTI "hold"
?L10:	PRINTR "ing that!"
?L3:	CALL NOTHING-INTERESTING,1 >STACK
	RSTACK

	.FUNCT V-LOWER
	CALL V-RAISE >STACK
	RSTACK

	.FUNCT V-MOVE
	EQUAL? PRSO,ROOMS \?L1
	CALL V-WALK-AROUND >STACK
	RSTACK
?L1:	FSET? PRSO,TAKEBIT \?L3
	PRINTI "Moving "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " reveals nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTR "."
?L3:	PRINT CANT
	PRINTI " move "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-MUNG,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?74,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?75,STACK
	CALL HACK-HACK,STR?76 >STACK
	RSTACK

	.FUNCT V-OPEN,F,STR
	FSET? PRSO,ACTORBIT \?L1
	CALL NOT-A,STR?55 >STACK
	RSTACK
?L1:	FSET? PRSO,CONTBIT /?L3
	FSET? PRSO,DOORBIT /?L3
	PRINTI "How can you"
	CALL DO-TO
	CALL ARTICLE,PRSO
	PRINTD PRSO
	PRINTR "?"
?L3:	FSET? PRSO,OPENBIT \?L8
	CALL ALREADY-OPEN >STACK
	RSTACK
?L8:	FSET? PRSO,LOCKEDBIT \?L9
	CALL OBJECT-IS-LOCKED >STACK
	RSTACK
?L9:	FSET? PRSO,CONTBIT \?L10
	FSET PRSO,OPENBIT
	FSET PRSO,TOUCHBIT
	FIRST? PRSO >STACK \?L13
	FSET? PRSO,TRANSBIT \?L11
?L13:	CALL NOW-CLOSED-OR-OPEN,PRSO,1 >STACK
	RSTACK
?L11:	PRINTI "Opening "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " reveals "
	CALL PRINT-CONTENTS,PRSO
	PRINTR "."
?L10:	CALL NOW-CLOSED-OR-OPEN,PRSO,1
	EQUAL? PRSO,LIBRARY-DOOR \FALSE
	FSET CIRCULATION-DESK,ONBIT
	CALL LIT?,HERE >LIT
	RETURN LIT

	.FUNCT V-PAY
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT V-PLAY
	EQUAL? PRSO,ROOMS \?L1
	CALL WASTE-OF-TIME >STACK
	RSTACK
?L1:	CALL HACK-HACK,STR?77 >STACK
	RSTACK

	.FUNCT V-PICK
	FSET? PRSO,DOORBIT \?L1
	CALL PRINT-ID,STR?78
	CALL NOT-A,STR?79 >STACK
	RSTACK
?L1:	CALL WHAT-A-CONCEPT >STACK
	RSTACK

	.FUNCT V-POINT
	PRINTR "It's not polite to point."

	.FUNCT V-POUR
	PRINT CANT
	PRINTR " pour that!"

	.FUNCT V-EMPTY,OBJ,NXT
	FSET? PRSO,CONTBIT \?L1
	FSET? PRSO,OPENBIT \?L3
	FIRST? PRSO >OBJ /?L28
	JUMP ?L6
?L8:	ZERO? OBJ /TRUE
?L28:	NEXT? OBJ >NXT /?L12
?L12:	FSET? OBJ,NARTICLEBIT /?L13
	PRINTI "The "
?L13:	PRINTD OBJ
	PRINTI ": "
	CALL PERFORM,V?TAKE,OBJ,PRSO
	SET 'OBJ,NXT
	JUMP ?L8
?L6:	CALL BUT-THE,PRSO
	PRINTR "is already empty!"
?L3:	CALL ITS-CLOSED,PRSO
	RTRUE
?L1:	PRINT CANT
	PRINTR " empty that!"

	.FUNCT V-PULL
	CALL HACK-HACK,STR?80 >STACK
	RSTACK

	.FUNCT V-PUSH
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?81,STACK
	CALL HACK-HACK,STR?82 >STACK
	RSTACK

	.FUNCT V-PUSH-TO
	PRINT CANT
	PRINTR " push things to that."

	.FUNCT PRE-PUT
	IN? PRSO,GLOBAL-OBJECTS /?L3
	FSET? PRSO,TAKEBIT /?L1
?L3:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \TRUE
	CALL ACCESSIBLE?,PRSI >STACK
	ZERO? STACK \?L7
	CALL CANT-SEE-ANY,PRSI
	RTRUE
?L7:	FSET? PRSO,WORNBIT \?L8
	CALL TAKE-OFF-PRSO-FIRST
	RFALSE
?L8:	EQUAL? PRSO,BROOM \FALSE
	ZERO? BROOM-SIT? /FALSE
	CALL GET-OFF-BROOM-FIRST
	RFALSE

	.FUNCT TAKE-OFF-PRSO-FIRST
	PRINTI "(taking off "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " first)"
	CRLF
	CALL PERFORM,V?TAKE-OFF,PRSO
	CRLF
	RTRUE

	.FUNCT GET-OFF-BROOM-FIRST
	SET 'BROOM-SIT?,0
	PRINTI "(getting off the "
	PRINTD BROOM
	PRINTR " first)"

	.FUNCT V-PUT,?TMP
	ZERO? PRSI /?L1
	FSET? PRSI,OPENBIT /?L5
	FSET? PRSI,DOORBIT /?L1
	FSET? PRSI,CONTBIT /?L1
	FSET? PRSI,SURFACEBIT /?L1
	PRINT CANT
	PRINTR " possibly do that!"
?L1:	FSET? PRSI,OPENBIT /?L5
	FSET? PRSI,SURFACEBIT /?L5
	CALL BUT-THE,PRSI
	PRINTI "isn't open!"
	CRLF
	CALL THIS-IS-IT,PRSI >STACK
	RSTACK
?L5:	EQUAL? PRSI,PRSO \?L8
	CALL WHAT-A-CONCEPT >STACK
	RSTACK
?L8:	IN? PRSO,PRSI \?L9
	CALL BUT-THE,PRSO
	PRINTI "is already "
	FSET? PRSI,SURFACEBIT \?L12
	PRINTI "on "
	JUMP ?L16
?L12:	PRINTI "in "
?L16:	CALL ARTICLE,PRSI,1
	PRINTD PRSI
	PRINTR "!"
?L9:	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \?L21
	CALL NO-ROOM
	CRLF
	RTRUE
?L21:	IN? PRSO,PROTAGONIST /?L22
	CALL ITAKE >STACK
	EQUAL? STACK,0,M-FATAL /TRUE
?L22:	EQUAL? PRSO,KITTY \?L24
	SET 'HORSE-SCRIPT,3
?L24:	MOVE PRSO,PRSI
	FSET PRSO,TOUCHBIT
	PRINTR "Done."

	.FUNCT NO-ROOM
	PRINTI "There's no room. "
	RTRUE

	.FUNCT SAY-IF-NOT-LIT
	CALL LIT?,HERE >LIT
	ZERO? LIT \FALSE
	CRLF
	CALL NOW-BLACK
	CRLF
	RTRUE

	.FUNCT V-PUT-BEHIND
	PRINTR "That hiding place is too obvious."

	.FUNCT PRE-PUT-ON
	CALL PRE-PUT >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT V-PUT-ON
	EQUAL? PRSI,ME \?L1
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L1:	FSET? PRSI,SURFACEBIT \?L3
	CALL V-PUT >STACK
	RSTACK
?L3:	PRINTI "There's no good surface on "
	ZERO? PRSI /?L7
	CALL ARTICLE,PRSI,1
	PRINTD PRSI
	JUMP ?L9
?L7:	PRINTI "that"
?L9:	PRINTR "."

	.FUNCT V-PUT-UNDER
	PRINT CANT
	PRINTR " put anything under that."

	.FUNCT V-RAPE
	PRINTI "What a wholesome idea."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?83,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?84,STACK >STACK
	RSTACK

	.FUNCT V-RAISE,THING
	EQUAL? PRSO,ROOMS \?L1
	EQUAL? HERE,INSIDE-THEATER \?L3
	FSET? SEAT,TOOLBIT \?L3
	SET 'THING,SEAT
	JUMP ?L7
?L3:	EQUAL? HERE,LOOKOUT-HILL \?L5
	ZERO? ON-STUMP? /?L5
	SET 'THING,STUMP
	JUMP ?L7
?L5:	ZERO? BROOM-SIT? /?L6
	SET 'THING,BROOM
	JUMP ?L7
?L6:	CALL PERFORM,V?ALARM,ME
	RTRUE
?L7:	PRINT I-ASSUME
	PRINTI " off the "
	PRINTD THING
	PRINTI ")"
	CRLF
	CALL PERFORM,V?TAKE-OFF,THING
	RTRUE
?L1:	IN? PRSO,PROTAGONIST \?L10
	CALL HACK-HACK,STR?85
	RTRUE
?L10:	FSET? PRSO,TAKEBIT \?L11
	CALL NOT-HOLDING,PRSO
	RTRUE
?L11:	PRINT CANT
	CALL DO-TO
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "!"

	.FUNCT V-REACH-IN,OBJ
	FIRST? PRSO >OBJ /?L1
?L1:	FSET? PRSO,ACTORBIT \?L2
	CALL NOT-A,STR?55 >STACK
	RSTACK
?L2:	FSET? PRSO,CONTBIT /?L4
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L4:	FSET? PRSO,OPENBIT /?L7
	PRINTR "It's not open."
?L7:	ZERO? OBJ /?L11
	FSET? OBJ,INVISIBLE /?L11
	FSET? OBJ,TAKEBIT /?L10
?L11:	PRINTR "It's empty."
?L10:	PRINTI "You reach into "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR " and feel something."

	.FUNCT V-READ
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	FSET? PRSO,READBIT /?L3
	CALL HOW-READ
	PRINTR "?"
?L3:	PRINTR "It's undecipherable."

	.FUNCT V-READ-TO
	ZERO? LIT \?L1
	CALL TOO-DARK >STACK
	RSTACK
?L1:	FSET? PRSO,READBIT /?L3
	CALL HOW-READ
	PRINTI " to "
	CALL ARTICLE,PRSI
	PRINTD PRSI
	PRINTR "?"
?L3:	CALL NOT-LIKELY,PRSI,STR?86 >STACK
	RSTACK

	.FUNCT HOW-READ
	PRINTI "How can you read "
	CALL ARTICLE,PRSO
	PRINTD PRSO
	RTRUE

	.FUNCT V-RELEASE
	EQUAL? PRSO,ME \?L1
	ZERO? CHAINED? \?L5
	EQUAL? HERE,JAIL-CELL \?L3
?L5:	CALL HOW?
	RTRUE
?L3:	PRINTI "But you are"
	JUMP ?L9
?L1:	CALL BUT-THE,PRSO
	PRINTI "is"
?L9:	PRINTR "n't confined by anything!"

	.FUNCT V-REPLACE
	EQUAL? PRSO,ME \?L1
	PRINTI "That's easy"
	JUMP ?L5
?L1:	CALL BUT-THE,PRSO
	PRINTI "doesn't need replacement"
?L5:	PRINTR "."

	.FUNCT V-REPLY
	CALL NOT-LIKELY,PRSO,STR?87
	CALL PCLEAR
	RETURN 2

	.FUNCT V-RESCUE
	EQUAL? PRSO,ME \?L1
	CALL V-HELP >STACK
	RSTACK
?L1:	CALL BUT-THE,PRSO
	PRINTR "doesn't need any help."

	.FUNCT V-RIDE
	FSET? PRSO,ACTORBIT \?L1
	CALL NOT-LIKELY,PRSO,STR?88
	CRLF
	RTRUE
?L1:	PRINT CANT
	PRINTI " ride that!"
	CRLF
	CRLF
	RTRUE

	.FUNCT V-RUB
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?89,STACK
	CALL HACK-HACK,STR?90 >STACK
	RSTACK

	.FUNCT V-BOW
	CALL HACK-HACK,STR?91 >STACK
	RSTACK

	.FUNCT V-YELL
	EQUAL? HERE,GRUE-NEST \?L1
	CALL PERFORM,V?HELLO,BABY
	RTRUE
?L1:	CALL MAGIC-TALK? >STACK
	ZERO? STACK \TRUE
	CALL ANYONE-HERE? >STACK
	ZERO? STACK /?L4
	CALL WAY-TO-TALK
	CALL PCLEAR
	RETURN 2
?L4:	CALL PCLEAR
	PRINTR "You begin to get a sore throat."

	.FUNCT V-SAY
	CALL MAGIC-TALK? >STACK
	ZERO? STACK \TRUE
	CALL ANYONE-HERE? >STACK
	ZERO? STACK /?L3
	CALL WAY-TO-TALK
	CALL PCLEAR
	RETURN 2
?L3:	CALL TALK-TO-SELF >STACK
	RSTACK

	.FUNCT MAGIC-TALK?
	GET P-LEXV,P-CONT >STACK
	EQUAL? STACK,W?KALUZE,W?FRATTO,W?SORKIN \FALSE
	SET 'QUOTE-FLAG,0
	SET 'CLOCK-WAIT,1
	SET 'SAYING?,1
	RTRUE

	.FUNCT V-SEARCH
	EQUAL? PRSO,ME \?L1
	CALL V-HELP >STACK
	RSTACK
?L1:	FSET? PRSO,CONTBIT \?L3
	FSET? PRSO,OPENBIT /?L4
	FSET? PRSO,TRANSBIT /?L4
	CALL YOUD-HAVE-TO,STR?92,PRSO >STACK
	RSTACK
?L4:	PRINT YOU-SEE
	CALL PRINT-CONTENTS,PRSO
	PRINTI " inside "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."
?L3:	FSET? PRSO,SURFACEBIT \?L13
	PRINT YOU-SEE
	CALL PRINT-CONTENTS,PRSO
	PRINTI " on "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."
?L13:	FSET? PRSO,ACTORBIT \?L20
	CALL PERFORM,V?USE,PRSO
	RTRUE
?L20:	CALL NOTHING-INTERESTING >STACK
	RSTACK

	.FUNCT NOTHING-INTERESTING,SEE?=0
	PRINTI "You "
	ZERO? SEE? /?L3
	PRINTI "see"
	JUMP ?L7
?L3:	PRINTI "find"
?L7:	PRINTI " nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT V-SHAKE,X
	FSET? PRSO,ACTORBIT \?L1
	CALL PERFORM,V?ALARM,PRSO
	RTRUE
?L1:	FSET? PRSO,TAKEBIT /?L3
	FSET? PRSO,TRYTAKEBIT /?L3
	CALL HACK-HACK,STR?93 >STACK
	RSTACK
?L3:	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-SHOOT
	PRINTI "You don't have any weapons."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?94,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?95,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?96,STACK
	CALL IS-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?97,STACK >STACK
	RSTACK

	.FUNCT V-SIT
	EQUAL? HERE,INSIDE-THEATER \?L1
	CALL PERFORM,V?SIT,SEAT
	RTRUE
?L1:	EQUAL? HERE,LOOKOUT-HILL \?L3
	CALL PERFORM,V?SIT,STUMP
	RTRUE
?L3:	CALL WASTE-OF-TIME
	RTRUE

	.FUNCT V-SLEEP
	PRINTR "You're not tired."

	.FUNCT V-SMELL
	EQUAL? PRSO,ROOMS \?L1
	PRINTI "You smell nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	JUMP ?L5
?L1:	PRINTI "It smells just like "
	CALL ARTICLE,PRSO
	PRINTD PRSO
?L5:	PRINTR "."

	.FUNCT V-SPIN
	PRINT CANT
	PRINTR " spin that!"

	.FUNCT V-SQUEEZE
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-STAND
	EQUAL? HERE,INSIDE-THEATER \?L1
	CALL PERFORM,V?EXIT,SEAT
	RTRUE
?L1:	ZERO? ON-STUMP? /?L3
	EQUAL? HERE,LOOKOUT-HILL \?L3
	CALL PERFORM,V?TAKE-OFF,STUMP
	RTRUE
?L3:	PRINTR "You're already standing."

	.FUNCT V-STAND-ON
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-STAND-UNDER
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-SWING
	ZERO? PRSI \?L1
	PRINTR "Whoosh!"
?L1:	CALL PERFORM,V?KILL,PRSI,PRSO
	RTRUE

	.FUNCT V-SWIM
	EQUAL? PRSO,ROOMS \?L1
	FSET? HERE,WETBIT \?L1
	EQUAL? HERE,PARK \?L3
	CALL PERFORM,V?SWIM,FOUNTAIN
	RTRUE
?L3:	CALL YOU-MEAN-WATER >STACK
	RSTACK
?L1:	PRINT CANT
	PRINTR " swim here!"

	.FUNCT V-TAKE-OFF,WHERE
	FSET? PRSO,TAKEBIT \?L1
	IN? PRSO,PROTAGONIST \?L3
	FSET? PRSO,WORNBIT \?L3
	FCLEAR PRSO,WORNBIT
	PRINT OKAY
	PRINTI "you're no longer wearing "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI "."
	CRLF
	EQUAL? PRSO,GLASSES \FALSE
	ZERO? ENDING? \FALSE
	SET 'WHERE,HERE
	EQUAL? HERE,LABORATORY \?L11
	SET 'FUZZY?,1
	SET 'FUZZY-FROM,LABORATORY
	MOVE PROTAGONIST,FUZZY
	SET 'HERE,FUZZY
	JUMP ?L14
?L11:	EQUAL? FUZZY-FROM,LOBBY \?L13
	CALL DIGGER-PISSED? >STACK
	ZERO? STACK /?L13
	SET 'FUZZY?,0
	SET 'FUZZY-FROM,ROTARY-EAST
	SET 'HERE,ROTARY-EAST
	MOVE PROTAGONIST,ROTARY-EAST
	JUMP ?L14
?L13:	EQUAL? HERE,INSIDE-THEATER /?L14
	SET 'FUZZY?,0
	SET 'HERE,FUZZY-FROM
	MOVE PROTAGONIST,FUZZY-FROM
?L14:	EQUAL? WHERE,HERE /FALSE
	CALL LIT?,HERE >LIT
	CRLF
	CALL V-LOOK >STACK
	RSTACK
?L3:	PRINTR "You aren't wearing that!"
?L1:	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-TASTE
	CALL PERFORM,V?EAT,PRSO
	RTRUE

	.FUNCT V-TELL
	EQUAL? PRSO,ME,ROOMS \?L1
	CALL TALK-TO-SELF >STACK
	RSTACK
?L1:	FSET? PRSO,ACTORBIT \?L3
	ZERO? P-CONT /?L4
	SET 'WINNER,PRSO
	LOC WINNER >HERE
	RETURN HERE
?L4:	CALL NO-ANSWER >STACK
	RSTACK
?L3:	PRINT CANT
	PRINTI " talk to "
	CALL ARTICLE,PRSO
	PRINTD PRSO
	PRINTI "!"
	CRLF
	CALL PCLEAR
	RETURN 2

	.FUNCT NO-ANSWER
	PRINTR "There's no answer."

	.FUNCT V-THANK
	FSET? PRSO,ACTORBIT \?L1
	PRINTI "You do so, but "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR " seems less than overjoyed by your gratitude."
?L1:	PRINTR "You're loony."

	.FUNCT V-THROUGH
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L1:	FSET? PRSO,DOORBIT \?L3
	CALL OTHER-SIDE,PRSO >STACK
	CALL DO-WALK,STACK
	RTRUE
?L3:	IN? PRSO,WINNER \?L4
	PRINTR "That would involve quite a contortion!"
?L4:	FSET? PRSO,ACTORBIT \?L7
	CALL V-RAPE >STACK
	RSTACK
?L7:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT PRE-THROW
	CALL PRE-PUT >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT V-THROW
	EQUAL? HERE,OUTSIDE-COTTAGE \?L1
	CALL PERFORM,V?GIVE,PRSO,POOCH
	RTRUE
?L1:	CALL IDROP >STACK
	ZERO? STACK /TRUE
	PRINTR "Thrown."

	.FUNCT V-THROW-OFF
	CALL WASTE-OF-TIME >STACK
	RSTACK

	.FUNCT V-TIE
	PRINT CANT
	PRINTI " tie "
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?98,STACK
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR " to that."

	.FUNCT V-TIE-UP
	PRINT CANT
	PRINTI " tie anything with that!"
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?99,STACK >STACK
	RSTACK

	.FUNCT V-TURN
	FSET? PRSO,TAKEBIT /?L1
	FSET? PRSO,TRYTAKEBIT /?L1
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	CALL HACK-HACK,STR?100 >STACK
	RSTACK

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR
	RTRUE

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	ZERO? P-WALK-DIR \?L1
	ZERO? PRSO /?L3
	CALL PRESUMABLY-YOU-WANT-TO,STR?101,PRSO
	CALL PERFORM,V?WALK-TO,PRSO
	RTRUE
?L3:	CALL V-WALK-AROUND
	RTRUE
?L1:	GETPT HERE,PRSO >PT
	ZERO? PT /?L6
	PTSIZE PT >PTS
	EQUAL? PTS,UEXIT \?L7
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L7:	EQUAL? PTS,NEXIT \?L9
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L9:	EQUAL? PTS,FEXIT \?L14
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L15
	CALL GOTO,RM >STACK
	RSTACK
?L15:	RETURN 2
?L14:	EQUAL? PTS,CEXIT \?L20
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L21
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L21:	GET PT,CEXITSTR >STR
	ZERO? STR /?L23
	PRINT STR
	CRLF
	RETURN 2
?L23:	CALL CANT-GO
	RETURN 2
?L20:	EQUAL? PTS,DEXIT \FALSE
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L32
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L32:	GET PT,DEXITSTR >STR
	ZERO? STR /?L34
	PRINT STR
	CRLF
	CALL THIS-IS-IT,OBJ
	RETURN 2
?L34:	CALL ITS-CLOSED,OBJ
	RETURN 2
?L6:	CALL CANT-GO
	RETURN 2

	.FUNCT V-WALK-AROUND
	PRINTI "(Do you have any particular direction in mind?)"
	CRLF
	RFALSE

	.FUNCT V-WALK-TO
	ZERO? PRSO /?L1
	EQUAL? PRSO,INTDIR \?L3
	CALL DO-WALK,P-DIRECTION
	RTRUE
?L3:	CALL V-FOLLOW >STACK
	RSTACK
?L1:	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT V-WAIT,NUM=3
	PRINTI "Time passes."
	CRLF
?L3:	DLESS? 'NUM,0 /?L4
	CALL CLOCKER >STACK
	ZERO? STACK /?L3
?L4:	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT

	.FUNCT V-WAIT-FOR
	LOC PRSO >STACK
	EQUAL? STACK,HERE,WINNER \?L1
	CALL BUT-THE,PRSO
	PRINTR "is already here!"
?L1:	PRINTR "You may be waiting quite a while."

	.FUNCT V-WEAR
	IN? PRSO,PROTAGONIST \?L1
	FSET? PRSO,WORNBIT \?L1
	PRINTI "You're already wearing "
	JUMP ?L34
?L1:	FSET? PRSO,WEARBIT /?L5
	PRINT CANT
	PRINTI " wear "
	JUMP ?L34
?L5:	CALL DONT-HAVE?,PRSO >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSO,COAT \?L9
	ZERO? CHAINED? /?L9
	PRINT CANT
	PRINTI " do that"
	CALL WHILE-CHAINED
	RTRUE
?L9:	EQUAL? PRSO,GLASSES \?L12
	EQUAL? HERE,CIRCULATION-DESK,MUSEUM /?L13
	ZERO? ECLIPSE? \?L15
	FSET? HERE,ONBIT /?L13
?L15:	PRINTI "It's dim enough here already without the "
	PRINTD GLASSES
	PRINTR "!"
?L13:	FSET GLASSES,WORNBIT
	SET 'FUZZY-FROM,HERE
	ZERO? ENDING? /?L19
	CALL NOTHING-EXCITING
	RTRUE
?L19:	EQUAL? HERE,INSIDE-THEATER \?L21
	ZERO? ECLIPSE? \?L22
	CALL ENABLED?,I-FILM >STACK
	ZERO? STACK /?L22
	SET 'MOVIE-VISIBLE?,1
	CALL WOW,STR?102
	RTRUE
?L22:	CALL NOTHING-EXCITING
	RTRUE
?L21:	EQUAL? HERE,FUZZY \?L25
	SET 'FUZZY?,0
	MOVE PROTAGONIST,LABORATORY
	SET 'HERE,LABORATORY
	CALL WOW,STR?103
	CRLF
	CALL V-LOOK
	RTRUE
?L25:	SET 'FUZZY?,1
	SET 'HERE,FUZZY
	MOVE PROTAGONIST,FUZZY
	PRINT OKAY
	PRINTI "you're now wearing the "
	PRINTD GLASSES
	PRINTI "."
	CRLF
	CRLF
	CALL V-LOOK
	IN? EVIL-ONE,FUZZY-FROM \TRUE
	CALL THIS-IS-IT,EVIL-ONE
	CRLF
	PRINTI "The only solid thing you can see is the "
	PRINTD OLD-WOMAN
	PRINTI "..."
	CALL DARK-BEING
	CRLF
	RTRUE
?L12:	FSET PRSO,WORNBIT
	PRINT OKAY
	PRINTI "you're now wearing "
?L34:	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."

	.FUNCT WOW,STR
	PRINTI "Wow! As you put on the glasses the "
	PRINT STR
	PRINTR " fuses into a solid, 3-dimensional image."

	.FUNCT PRE-WISH
	ZERO? PRSI /?L1
	FSET? PRSI,WISHBIT \?L3
	CALL CONSULT-PACKAGE
	RTRUE
?L3:	EQUAL? PRSI,WISHBRINGER /FALSE
	CALL NOT-LIKELY,PRSI,STR?104
	RTRUE
?L1:	FSET? PRSO,WISHBIT /?L7
	CALL CONSULT-PACKAGE
	RTRUE
?L7:	IN? WISHBRINGER,PROTAGONIST /?L8
	PRINTI "You must be holding "
	PRINT GAME
	PRINTI " in "
	PRINTD HANDS
	PRINTR " to make a Wish."
?L8:	FSET? WISHBRINGER,ONBIT /?L11
	PRINTI "It seems that "
	PRINT GAME
	PRINTR " isn't glowing anymore."
?L11:	FSET? PRSO,TOUCHBIT \?L14
	PRINTR "You've already used that Wish."
?L14:	ZERO? FUZZY? /?L17
	EQUAL? PRSO,FORESIGHT /?L17
	PRINTI "You'd better get out of this "
	CALL PICK-ONE,BLURS >STACK
	PRINT STACK
	PRINTR " place first!"
?L17:	ZERO? ECLIPSE? /FALSE
	CALL DARK-IS-POWERFUL
	RTRUE

	.FUNCT DARK-IS-POWERFUL
	PRINTD DARKNESS
	PRINTR " is a powerful Wish. You'll have to wait for it to wear off before you can use more Magick."

	.FUNCT V-WISH
	CALL HOW? >STACK
	RSTACK

	.FUNCT PRE-TAKE,CONTAINER
	LOC PRSO >CONTAINER
	IN? PRSO,WINNER \?L1
	PRINTI "You're already "
	FSET? PRSO,WORNBIT \?L5
	PRINTI "wear"
	JUMP ?L9
?L5:	PRINTI "hold"
?L9:	PRINTR "ing it."
?L1:	ZERO? CONTAINER /?L14
	FSET? CONTAINER,CONTBIT \?L14
	FSET? CONTAINER,OPENBIT /?L14
	PRINT CANT
	PRINTI " reach into "
	CALL ARTICLE,CONTAINER,1
	PRINTD CONTAINER
	PRINTR ". It's closed."
?L14:	ZERO? PRSI /?L19
	EQUAL? PRSO,ME \?L20
	CALL PERFORM,V?DROP,PRSI
	RTRUE
?L20:	EQUAL? PRSI,GRAVE \?L22
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L22:	IN? PRSO,PRSI /FALSE
	FSET? PRSI,ACTORBIT \?L24
	CALL BUT-THE,PRSI
	PRINTI "doesn't have "
	CALL ARTICLE,PRSO
	PRINTD PRSO
	JUMP ?L28
?L24:	CALL BUT-THE,PRSO
	PRINTI "isn't in "
	CALL ARTICLE,PRSI,1
	PRINTD PRSI
?L28:	PRINTR "."
?L19:	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	PRINTR "You're in it!"

	.FUNCT V-TAKE,CNT
	CALL ITAKE >STACK
	ZERO? STACK /FALSE
	PRINTI "Taken."
	CRLF
	CALL IS-THEFT? >STACK
	CALL PRINT-ID,STR?105,STACK
	GETP PRSO,P?VALUE >CNT
	GRTR? CNT,0 \TRUE
	CRLF
	CALL UPDATE-SCORE,CNT
	PUTP PRSO,P?VALUE,0
	RTRUE

	.FUNCT ITAKE,VB=1,CNT,OBJ
	CALL THIS-IS-IT,PRSO
	FSET? PRSO,TAKEBIT /?L1
	ZERO? VB /FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RFALSE
?L1:	FSET? PRSO,THROWNBIT \?L8
	ZERO? VB /FALSE
	PRINT CANT
	PRINTI ". "
	PRINTD CRISP
	PRINTI " dropped it out of your reach."
	CRLF
	RFALSE
?L8:	EQUAL? HERE,OUTSIDE-COTTAGE \?L14
	ZERO? HELLHOUND-HAPPY? \?L14
	IN? PRSO,HERE /?L15
	LOC PRSO >STACK
	IN? STACK,HERE \?L14
?L15:	CALL SAY-THE,POOCH
	PRINTI " won't let you pick it up!"
	CRLF
	RFALSE
?L14:	CALL TOO-MUCH-JUNK?,VB >STACK
	ZERO? STACK \FALSE
	MOVE PRSO,WINNER
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	RTRUE

	.FUNCT TOO-MUCH-JUNK?,VB=1,?TMP
	LOC PRSO >STACK
	IN? STACK,WINNER /?L1
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,WINNER >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,LOAD-ALLOWED \?L1
	ZERO? VB /TRUE
	FIRST? PROTAGONIST >STACK \?L5
	PRINTI "Your load is"
	JUMP ?L9
?L5:	PRINTI "It's a little"
?L9:	PRINTR " too heavy."
?L1:	CALL CCOUNT,WINNER >STACK
	GRTR? STACK,FUMBLE-NUMBER \FALSE
	ZERO? VB /TRUE
	PRINTR "You're holding too many things already!"

	.FUNCT CCOUNT,THING,OBJ,CNT=0
	FIRST? THING >OBJ /?L11
	RETURN CNT
?L11:	FSET? OBJ,WORNBIT /?L6
	INC 'CNT
?L6:	NEXT? OBJ >OBJ /?L11
	RETURN CNT

	.FUNCT WEIGHT,THING,OBJ,WT=0
	FIRST? THING >OBJ \?L3
?L11:	EQUAL? THING,PROTAGONIST \?L6
	FSET? OBJ,WORNBIT \?L6
	INC 'WT
	JUMP ?L8
?L6:	CALL WEIGHT,OBJ >STACK
	ADD WT,STACK >WT
?L8:	NEXT? OBJ >OBJ /?L11
?L3:	GETP THING,P?SIZE >STACK
	ADD WT,STACK >WT
	RETURN WT

	.FUNCT DESCRIBE-ROOM,LOOK?=0,V?,STR
	SET 'V?,LOOK?
	ZERO? V? \?L1
	SET 'V?,VERBOSE
?L1:	ZERO? LIT /?L3
	SET 'FIRST-WARNING?,1
	JUMP ?L5
?L3:	CALL NOW-BLACK
	ZERO? ECLIPSE? \?L6
	ZERO? FIRST-WARNING? \?L8
	RANDOM 100 >STACK
	LESS? 50,STACK /?L6
?L8:	PRINTI " You are likely to be eaten by a grue."
	SET 'FIRST-WARNING?,0
?L6:	CRLF
	RFALSE
?L5:	FSET? HERE,TOUCHBIT /?L12
	FSET HERE,TOUCHBIT
	SET 'V?,1
?L12:	IN? HERE,ROOMS \?L15
	PRINTD HERE
	CRLF
?L15:	ZERO? LOOK? \?L22
	ZERO? SUPER-BRIEF \TRUE
?L22:	ZERO? V? /?L25
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \TRUE
	ZERO? V? /?L25
	GETP HERE,P?LDESC >STR
	ZERO? STR /?L25
	PRINT STR
	CRLF
	RTRUE
?L25:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-FLASH >STACK
	RTRUE

	.FUNCT GOTO,RM,V?=1,OLIT,OHERE
	SET 'OHERE,HERE
	SET 'OLIT,LIT
	MOVE WINNER,RM
	SET 'HERE,RM
	CALL LIT?,HERE >LIT
	ZERO? OLIT \?L1
	ZERO? LIT \?L1
	ZERO? LUCKY? \?L1
	ZERO? FIRST-WARNING? \?L1
	ZERO? ECLIPSE? \?L1
	RANDOM 100 >STACK
	LESS? 50,STACK /?L1
	PRINTI "Oh, no! Something lurked out of the "
	PRINTD DARKNESS
	PRINTI " and devoured you!"
	CALL BAD-ENDING
?L1:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	EQUAL? HERE,RM \TRUE
	ZERO? V? /TRUE
	CALL V-FIRST-LOOK
	RTRUE

	.FUNCT OTHER-SIDE,DOBJ,P=0,T
?L1:	NEXTP HERE,P >P
	LESS? P,P?OUT /FALSE
	GETPT HERE,P >T
	PTSIZE T >STACK
	EQUAL? STACK,DEXIT \?L1
	GETB T,DEXITOBJ >STACK
	EQUAL? STACK,DOBJ \?L1
	RETURN P

	.FUNCT HACK-HACK,STR
	PRINT STR
	PRINTI " "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " "
	CALL PICK-ONE,HO-HUM >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT TOO-DARK
	PRINTR "It's too dark to see!"

	.FUNCT CANT-GO
	FSET? HERE,INDOORSBIT \?L1
	PRINTI "There's no exit"
	JUMP ?L5
?L1:	PRINT CANT
	PRINTI " go"
?L5:	PRINTR " that way."

	.FUNCT NOW-BLACK
	PRINTI "It is pitch black."
	RTRUE

	.FUNCT ALREADY-OPEN
	CALL ITS-ALREADY,STR?92 >STACK
	RSTACK

	.FUNCT ALREADY-CLOSED
	CALL ITS-ALREADY,STR?106 >STACK
	RSTACK

	.FUNCT ITS-ALREADY,STR
	PRINTI "It's already "
	PRINT STR
	PRINTR "."

	.FUNCT REFERRING
	PRINTR "(Please be more specific.)"

	.FUNCT WASTE-OF-TIME
	PRINTI "That would be a "
	CALL PICK-ONE,USELESSNESS >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT BOSS
	PRINTI " your mean old boss, "
	PRINTD CRISP
	RTRUE

	.FUNCT CRISP-F,CONTEXT=0
	CALL THIS-IS-IT,CRISP
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "He's wearing a "
	ZERO? SKEWED? /?L5
	PRINTD COAT
	JUMP ?L9
?L5:	PRINTI "regulation "
	PRINTD POST-OFFICE
	PRINTI " uniform"
?L9:	PRINTR ", which does little to hide his ugly face."
?L1:	CALL ASKING?,CRISP >STACK
	ZERO? STACK /?L14
	PRINTD CRISP
	PRINTI " "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI ", ""You're here to "
	ZERO? SKEWED? /?L17
	PRINTI "answer questions, not to ask them"
	JUMP ?L21
?L17:	PRINTI "take orders, not to ask questions"
?L21:	PRINTI "!"""
	CRLF
	RETURN 2
?L14:	EQUAL? PRSA,V?REPLY,V?YELL,V?TELL /?L29
	EQUAL? PRSA,V?THANK,V?REPLY,V?HELLO \?L28
?L29:	PRINTI """Don't talk back to me!"" "
	PRINTD CRISP
	PRINTI " "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	RETURN 2
?L28:	CALL HURT?,CRISP >STACK
	ZERO? STACK /?L34
	PRINTD CRISP
	PRINTI " might "
	EQUAL? PRSA,V?RAPE,V?KILL /?L37
	PUSH 0
	JUMP ?L38
?L37:	PUSH 1
?L38:	CALL PRINT-ID,STR?107,STACK
	EQUAL? PRSA,V?RAPE,V?KILL /?L39
	PUSH 1
	JUMP ?L40
?L39:	PUSH 0
?L40:	CALL PRINT-ID,STR?108,STACK
	ZERO? SKEWED? /?L41
	PRINTI "torture"
	JUMP ?L45
?L41:	PRINTI "fire"
?L45:	PRINTI " you"
	CALL IF-YOU-TRIED
	RTRUE
?L34:	EQUAL? PRSA,V?WALK-TO,V?FOLLOW \?L50
	ZERO? CHAINED? /?L51
	CALL NOT-GOING-ANYWHERE
	RTRUE
?L51:	EQUAL? HERE,TORTURE-CHAMBER \FALSE
	CALL DO-WALK,P?UP
	RTRUE
?L50:	EQUAL? PRSA,V?GIVE \?L55
	EQUAL? PRSI,CRISP \?L55
	EQUAL? PRSO,ENVELOPE \?L56
	CALL IVE-ALREADY-SEEN-IT
	RTRUE
?L56:	PRINTD CRISP
	PRINTI " takes "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " and stares at it"
	EQUAL? PRSO,VIOLET-NOTE \?L63
	PRINTI ". "
	CALL CRISP-SEES-NOTE
	RTRUE
?L63:	EQUAL? PRSO,WISHBRINGER \?L67
	PRINTI ". "
	CALL CRISP-SEES-STONE
	RTRUE
?L67:	EQUAL? PRSO,CHOCOLATE \?L70
	PRINTI " hungrily."
	CALL HISTORY
	REMOVE CHOCOLATE
	RTRUE
?L70:	EQUAL? PRSO,CONCH-SHELL \?L73
	PRINTI " admiringly. ""This"
	CALL TV-SET,1
	PRINTI ","" he mutters, setting it aside."
	CRLF
	MOVE CONCH-SHELL,HERE
	FSET CONCH-SHELL,THROWNBIT
	RTRUE
?L73:	PRINTI " stupidly. ""Trying to butter me up with presents, eh?"" he "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI ", tossing it "
	ZERO? SKEWED? /?L81
	FSET PRSO,THROWNBIT
	MOVE PRSO,HERE
	PRINTR "angrily to the floor."
?L81:	PRINTI "back at you."
	CALL YOU-ARE-HOLDING,PRSO,1
	CRLF
	RTRUE
?L55:	EQUAL? PRSA,V?RUB,V?SQUEEZE,V?KISS \FALSE
	PRINTD CRISP
	PRINTI " blushes. ""I didn't know you cared."""
	CRLF
	CALL PRINT-ID,STR?109
	RTRUE

	.FUNCT I-GIVE-ENVELOPE
	EQUAL? HERE,INSIDE-POST-OFFICE \FALSE
	CALL THIS-IS-IT,CRISP
	INC 'CRISP-SCRIPT
	CRLF
	PRINTD CRISP
	PRINTI " "
	EQUAL? CRISP-SCRIPT,3 \?L5
	PRINTI "drums his fingers on the "
	PRINTD COUNTER
	PRINTI " impatiently. """
	CALL PICK-ONE,GET-GOINGS >STACK
	PRINT STACK
	CALL PLACE-CLOSES
	CRLF
	RTRUE
?L5:	IN? ENVELOPE,PROTAGONIST \?L9
	DEC 'ANGER
	ZERO? ANGER \?L10
	CALL CRISP-THROWS-YOU-OUT
	CRLF
	RTRUE
?L10:	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI ", """
	CALL PICK-ONE,GET-GOINGS >STACK
	PRINT STACK
	PRINTR "!"""
?L9:	EQUAL? CRISP-SCRIPT,1 \?L15
	PRINTR "hides the postcards away as you enter. ""Where have you been?"" he barks angrily. ""Daydreaming again, eh? I've been looking everywhere for you!"""
?L15:	EQUAL? CRISP-SCRIPT,2 \?L18
	MOVE ENVELOPE,COUNTER
	CALL THIS-IS-IT,ENVELOPE
	FSET ENVELOPE,RMUNGBIT
	PRINTI "reaches under the "
	PRINTD COUNTER
	PRINTI " and pulls out a "
	PRINTD ENVELOPE
	PRINTI ". ""We just got this Special Delivery,"" he snarls, tossing it onto the "
	PRINTD COUNTER
	PRINTR ". ""I want you to drop it off right away. That means NOW!"""
?L18:	CALL THIS-IS-IT,ENVELOPE
	DEC 'ANGER
	ZERO? ANGER \?L22
	PUTP ENVELOPE,P?VALUE,0
	FSET ENVELOPE,TOUCHBIT
	MOVE ENVELOPE,PROTAGONIST
	PRINTI "picks up the "
	PRINTD ENVELOPE
	PRINTI " and stuffs it into "
	PRINTD HANDS
	PRINTI "s with a curse. Then he "
	CALL CRISP-THROWS-YOU-OUT
	CRLF
	RTRUE
?L22:	PRINTI "points to the "
	PRINTD ENVELOPE
	PRINTI " on the "
	IN? ENVELOPE,COUNTER \?L29
	PRINTD COUNTER
	JUMP ?L31
?L29:	PRINTI "floor"
?L31:	PRINTI " impatiently. ""Take the "
	RANDOM 100 >STACK
	LESS? 50,STACK /?L36
	PRINTI "stupid "
?L36:	PRINTI "envelope and scram"
	CALL PLACE-CLOSES
	CRLF
	RTRUE

	.FUNCT CRISP-THROWS-YOU-OUT
	FSET? POST-DOOR,OPENBIT /?L1
	PRINTI "opens the "
	PRINTD HOUSE-DOOR
	PRINTI ", "
?L1:	PRINTI "picks you up and throws you out of the "
	PRINTD POST-OFFICE
	PRINTI ". """
	CALL PICK-ONE,GET-GOINGS >STACK
	PRINT STACK
	PRINTI "!"" he "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI " as he"
	CALL SLAMS-AND-LOCKS
	MOVE PROTAGONIST,HILLTOP
	SET 'HERE,HILLTOP
	RETURN HERE

	.FUNCT PLACE-CLOSES
	RANDOM 100 >STACK
	LESS? 50,STACK /?L1
	PRINTI ", "
	CALL PICK-ONE,INSULTS >STACK
	PRINT STACK
?L1:	PRINTI "! The "
	PRINTD MAGICK-SHOPPE
	PRINTI " closes at five o'clock!"""
	RTRUE

	.FUNCT I-CRISP-CAPTURE,OBJ
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,VESTIBULE,TORTURE-CHAMBER \FALSE
	INC 'CRISP-SCRIPT
	CRLF
	EQUAL? CRISP-SCRIPT,1 \?L5
	MOVE PRINCESS,VESTIBULE
	PRINTI """Turn back"
	PRINT ADVENTURER
	PRINTI "!""

You stare in horror at the "
	PRINTD PLATYPUS
	PRINTI " chained to the floor. It's "
	PRINTD PRINCESS
	PRINTR "!"
?L5:	EQUAL? CRISP-SCRIPT,2 \?L9
	LESS? WISDOM,6 \?L10
	CALL START-BUZZ,6
?L10:	FCLEAR DRAWBRIDGE,OPENBIT
	FCLEAR VESTIBULE,TOUCHBIT
	CALL DEPOSIT-BRANCH
	MOVE PROTAGONIST,TORTURE-CHAMBER
	MOVE PRINCESS,TORTURE-CHAMBER
	MOVE CRISP,TORTURE-CHAMBER
	MOVE CHAINS,TORTURE-CHAMBER
	SET 'CHAINED?,1
	SET 'CLAMPED?,1
	SET 'HERE,TORTURE-CHAMBER
	CALL INTRO
	PRINTI "... "
	PRINTD CRISP
	PRINTI "!

""Nice of you to drop by,"" he sneers as a gigantic Boot pins you to the "
	PRINTD GROUND
	PRINTI ". ""Saves me the bother of tracking you down."""
	CALL CARRIAGE-RETURNS
	CALL V-LOOK >STACK
	RSTACK
?L9:	EQUAL? CRISP-SCRIPT,3 \?L15
	PRINTD CRISP
	PRINTI " dangles a "
	PRINTD KEY
	PRINTI " in front of your face. ""This is the key to your "
	PRINTD CHAINS
	PRINTI ","" he announces. ""Say goodbye to it."" He drops the key into his coat pocket and laughs like a madman.

""Your laughter is like one gone mad!"" notes "
	PRINTD PRINCESS
	PRINTI " observantly.

""Silence!"" He grips a control lever on the "
	PRINTD TMACHINE
	PRINTR ". ""One more peep, your Highness, and I'll push this lever up and reward your insolence with Pain!"""
?L15:	EQUAL? CRISP-SCRIPT,4 \?L18
	PRINTD CRISP
	PRINTI " snaps on a pair of rubber gloves and smiles wickedly.

""Are you carrying anything interesting?"" he asks, looking you up and down. ""I'd hate to start my experiments without giving you a chance to bribe me."""
	CRLF
	IN? VIOLET-NOTE,TORTURE-CHAMBER \?L21
	CRLF
	CALL CRISP-LIFTS,VIOLET-NOTE
	CALL CRISP-SEES-NOTE
	RTRUE
?L21:	IN? WISHBRINGER,TORTURE-CHAMBER \?L23
	CRLF
	CALL CRISP-LIFTS,WISHBRINGER
	CALL CRISP-SEES-STONE
	RTRUE
?L23:	FIRST? PROTAGONIST >STACK /TRUE
	CRLF
	CALL NO-BRIBE
	RTRUE
?L18:	FIRST? PROTAGONIST >OBJ /?L27
?L27:	IN? VIOLET-NOTE,TORTURE-CHAMBER \?L28
	CALL CRISP-LIFTS,VIOLET-NOTE
	CALL CRISP-SEES-NOTE
	RTRUE
?L28:	IN? WISHBRINGER,TORTURE-CHAMBER \?L30
	CALL CRISP-LIFTS,WISHBRINGER
	CALL CRISP-SEES-STONE
	RTRUE
?L30:	EQUAL? OBJ,VIOLET-NOTE,WISHBRINGER,CHOCOLATE /?L32
	EQUAL? OBJ,CONCH-SHELL \?L31
?L32:	CALL PERFORM,V?GIVE,OBJ,CRISP
	EQUAL? OBJ,WISHBRINGER \TRUE
	CALL I-LUCK
	RTRUE
?L31:	ZERO? OBJ /?L36
	FCLEAR OBJ,WORNBIT
	FSET OBJ,THROWNBIT
	MOVE OBJ,TORTURE-CHAMBER
	PRINTD CRISP
	PRINTI " "
	CALL PICK-ONE,SWIPES >STACK
	PRINT STACK
	PRINTI " "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	PRINTI " away from you"
	CALL PICK-ONE,CONSIDERATIONS >STACK
	PRINT STACK
	PRINTI ". "
	CALL PICK-ONE,BORINGS >STACK
	PRINT STACK
	PRINTI " to the floor."
	CRLF
	EQUAL? OBJ,SHOE \TRUE
	CALL I-LUCK
	RTRUE
?L36:	CALL NO-BRIBE
	RTRUE

	.FUNCT CRISP-LIFTS,OBJ
	MOVE OBJ,CRISP
	PRINTD CRISP
	PRINTI " notices "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	PRINTI " lying on the floor and picks it up. "
	RTRUE

	.FUNCT CRISP-SEES-NOTE
	CALL INT,I-CRISP-CAPTURE >STACK
	PUT STACK,0,0
	SET 'CRISP-SCRIPT,0
	CALL QUEUE,I-PRINCESS-CALLS,-1 >STACK
	PUT STACK,0,1
	MOVE VIOLET-NOTE,TORTURE-CHAMBER
	FSET VIOLET-NOTE,THROWNBIT
	FCLEAR VIOLET-NOTE,RMUNGBIT
	SET 'COAT-WORN?,0
	FCLEAR COAT,NDESCBIT
	FCLEAR HATCH,OPENBIT
	MOVE CRISP,INSIDE-POST-OFFICE
	PRINTI "His face turns pale. ""Where did this come from?"" he whispers, opening it.

An unbearably sweet expression spreads over his face as he reads. The "
	PRINTD VIOLET-NOTE
	PRINTI " falls from his hands.

""I've got to run,"" "
	PRINTD CRISP
	PRINTI " cries, tossing his "
	PRINTD COAT
	PRINTI " into a "
	PRINTD CORNER
	PRINTI " and stuffing his shirttails into his pants. ""Violet scolds me when I'm late!"" He struggles into a hideous velvet blazer, pushes a comb through his hair and scampers up the "
	PRINTD LADDER
	PRINTI " like a little boy.

The "
	PRINTD HATCH
	PRINTR " closes with a hollow thud."

	.FUNCT CRISP-SEES-STONE
	MOVE WISHBRINGER,COAT
	FCLEAR WISHBRINGER,ONBIT
	FSET WISHBRINGER,RMUNGBIT
	PRINTI """Humph!"" he snorts, peering at it. ""I wonder if"
	PRINT EONE
	PRINTI " has one of these."" He plunks the "
	PRINTD WISHBRINGER
	PRINTR " into his coat pocket."

	.FUNCT NO-BRIBE
	CALL INT,I-CRISP-CAPTURE >STACK
	PUT STACK,0,0
	PRINTD CRISP
	PRINTI " searches you carefully, but finds you empty-handed. ""Too bad,"" he sighs. ""I was hoping you'd try to bribe me, then start begging for mercy, maybe even grovel a little."" He walks to the "
	PRINTD LADDER
	PRINTI " and calls upward, ""Next!""

A Boot escorts the "
	PRINTD GRAVEDIGGER
	PRINTI " down the "
	PRINTD LADDER
	PRINTI " as "
	PRINTD CRISP
	PRINTI " touches a hidden switch. The floor"
	CALL BENEATH-FEET
	PRINTI ", and you slide screaming down an endless chute..."
	CALL PRINT-ID,STR?110
	CALL BAD-ENDING >STACK
	RSTACK

	.FUNCT BENEATH-FEET
	PRINTI " falls away beneath your feet"
	RTRUE

	.FUNCT I-PRINCESS-CALLS
	ZERO? FUZZY? \TRUE
	EQUAL? HERE,TORTURE-CHAMBER \FALSE
	INC 'CRISP-SCRIPT
	EQUAL? CRISP-SCRIPT,1 /TRUE
	EQUAL? CRISP-SCRIPT,2 \?L7
	CRLF
	PRINTI "You "
	CALL HEAR-BRIDGE
	CRLF
	PRINTD PRINCESS
	PRINTR " breathes a sigh of relief."
?L7:	EQUAL? CRISP-SCRIPT,3 \?L13
	CRLF
	PRINTI "You "
	CALL HEAR-BRIDGE
	CRLF
	PRINTD PRINCESS
	PRINTI " strains against her clamps. ""Release me from this "
	PRINTD TMACHINE
	PRINT ADVENTURER
	PRINTI "! "
	CALL PICK-ONE,BEGS >STACK
	PRINT STACK
	PRINTR "."""
?L13:	RANDOM 100 >STACK
	LESS? 50,STACK /FALSE
	CALL THIS-IS-IT,LEVER
	CRLF
	PRINTI """"
	CALL PICK-ONE,BEGS >STACK
	PRINT STACK
	PRINTI ","" cries "
	PRINTD PRINCESS
	PRINTR "."

	.FUNCT GRAVEDIGGER-F,CONTEXT=0
	CALL THIS-IS-IT,GRAVEDIGGER
	EQUAL? PRSA,V?EXAMINE \?L1
	ZERO? SKEWED? /?L3
	PRINTI "No doubt about it. "
?L3:	PRINTI "He's the town "
	PRINTD GRAVEDIGGER
	PRINTI ", "
	ZERO? SKEWED? /?L10
	PRINTI "looking stiff and uncomfortable in his new usher's uniform"
	JUMP ?L14
?L10:	PRINTI "a "
	PRINTD FESTERON
	PRINTI " fixture since before you were born"
?L14:	PRINTR "."
?L1:	EQUAL? PRSA,V?WAVE-AT \?L19
	CALL SAY-THE,GRAVEDIGGER
	ZERO? SKEWED? /?L20
	PRINTI " sneers"
	JUMP ?L24
?L20:	PRINTI " winks at you slyly"
?L24:	PRINTR "."
?L19:	CALL HURT?,GRAVEDIGGER >STACK
	ZERO? STACK /?L29
	CALL PRINT-ID,STR?111
	CALL SAY-THE,GRAVEDIGGER
	CALL MIGHT-NOT-LIKE
	RTRUE
?L29:	CALL TALKING-TO?,GRAVEDIGGER >STACK
	ZERO? STACK /?L30
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " doesn't respond. He seems to be a bit hard of hearing."
	CRLF
	RETURN 2
?L30:	EQUAL? PRSA,V?YELL \?L35
	PRINTI "No reply. "
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " is apparently stone deaf."
	CRLF
	RETURN 2
?L35:	EQUAL? PRSA,V?FOLLOW \?L42
	ZERO? SKEWED? \?L42
	EQUAL? HERE,SPOOKY-COPSE \?L43
	CALL ENABLED?,I-DIGGER-TALK >STACK
	ZERO? STACK \?L43
	CALL DO-WALK,P?WEST
	RTRUE
?L43:	EQUAL? HERE,TWILIGHT-GLEN \FALSE
	FSET? NORTH-GATE,OPENBIT /FALSE
	CALL DO-WALK,P?NORTH
	RTRUE
?L42:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,GRAVEDIGGER \FALSE
	EQUAL? PRSO,ENVELOPE \?L48
	ZERO? ENVELOPE-PEERED-AT? /?L50
	CALL IVE-ALREADY-SEEN-IT
	RTRUE
?L50:	SET 'ENVELOPE-PEERED-AT?,1
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " peers at the address on the "
	PRINTD ENVELOPE
	PRINTI ". ""Hmm,"" he mutters, handing it back to you. ""Could've sworn I buried that "
	PRINTD OLD-WOMAN
	PRINTI " years ago."""
	CALL YOU-ARE-HOLDING,ENVELOPE,1
	CRLF
	RETURN 2
?L48:	EQUAL? PRSO,TICKET \?L57
	MOVE TICKET,STEEP-TRAIL
	FSET TICKET,TOOLBIT
	SET 'NO-MOVIE?,0
	CALL THIS-IS-IT,CARTON
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " takes the "
	PRINTD TICKET
	PRINTI ", gestures absently to the empty "
	PRINTD CARTON
	PRINTI " and leans back to daydream."
	CRLF
	RETURN 2
?L57:	PRINTR """No, thanks,"" he says, shaking his head. ""Got enough junk already."""

	.FUNCT I-DIGGER-TALK
	EQUAL? HERE,SPOOKY-COPSE \FALSE
	CALL THIS-IS-IT,GRAVEDIGGER
	INC 'DIGGER-SCRIPT
	CRLF
	EQUAL? DIGGER-SCRIPT,1 \?L3
	CALL SAY-THE,GRAVEDIGGER
	PRINTR " nods a greeting as you approach."
?L3:	IN? ENVELOPE,HERE \?L7
	DEC 'DIGGER-SCRIPT
	MOVE ENVELOPE,PROTAGONIST
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " notices the "
	PRINTD ENVELOPE
	PRINTI " on the "
	PRINTD GROUND
	PRINTI " and picks it up. ""You dropped this"
	ZERO? ENVELOPE-PEERED-AT? /?L10
	PRINTI ","" he says, handing it back to you."
	CALL YOU-ARE-HOLDING,ENVELOPE,1
	CRLF
	RTRUE
?L10:	CALL MIND-IF-I-LOOK
	CRLF
	CALL PERFORM,V?GIVE,ENVELOPE,GRAVEDIGGER
	RTRUE
?L7:	EQUAL? DIGGER-SCRIPT,2 \?L15
	ZERO? ENVELOPE-PEERED-AT? \?L16
	IN? ENVELOPE,PROTAGONIST \?L16
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " notices the "
	PRINTD ENVELOPE
	PRINTI " you're holding. ""That's a mighty mysterious-lookin' envelope you got there"
	CALL MIND-IF-I-LOOK >STACK
	RSTACK
?L16:	PRINTI """Nice grave-diggin' weather we're havin' lately,"" the "
	PRINTD GRAVEDIGGER
	PRINTR " notes drily."
?L15:	EQUAL? DIGGER-SCRIPT,3 \?L23
	PRINTI """"
	ZERO? ENVELOPE-PEERED-AT? \?L26
	IN? ENVELOPE,PROTAGONIST \?L26
	CALL THIS-IS-IT,ENVELOPE
	PRINTI "Sure would like to get a closer look at that "
	PRINTD ENVELOPE
	JUMP ?L30
?L26:	PRINTI "Couldn't ask for a nicer day for diggin' graves"
?L30:	PRINTR "."""
?L23:	MOVE GRAVEDIGGER,TWILIGHT-GLEN
	CALL INT,I-DIGGER-TALK >STACK
	PUT STACK,0,0
	PRINTI """Got to go,"" says the "
	PRINTD GRAVEDIGGER
	PRINTI ", picking up his shovel. ""See you soon.""

The old man ambles away "
	GET DIR-NAMES,3 >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT MIND-IF-I-LOOK
	CALL THIS-IS-IT,ENVELOPE
	PRINTR ","" he says. ""Let's have a look at it."""

	.FUNCT MACGUFFIN-F,CONTEXT=0
	CALL TALKING-TO?,MACGUFFIN >STACK
	ZERO? STACK \?L3
	EQUAL? PRSA,V?YELL \?L1
?L3:	ZERO? SKEWED? /?L4
	PRINTI """I'll do the talking around here!"" snaps "
	PRINTD MACGUFFIN
	JUMP ?L8
?L4:	PRINTD MACGUFFIN
	PRINTI " "
	GRTR? MACGUFFIN-SCRIPT,3 \?L11
	PRINTI "snores"
	JUMP ?L15
?L11:	PRINTI "mutters something vague"
?L15:	PRINTI " in reply"
?L8:	PRINTI "."
	CRLF
	RETURN 2
?L1:	EQUAL? PRSA,V?EXAMINE \?L24
	PRINTD MACGUFFIN
	ZERO? SKEWED? /?L25
	PRINTI " isn't in a good mood"
	JUMP ?L36
?L25:	PRINTI "'s "
	GRTR? MACGUFFIN-SCRIPT,3 \?L32
	PRINTI "sleeping like a baby"
	JUMP ?L36
?L32:	PRINTI "about to fall asleep"
?L36:	PRINTR "."
?L24:	CALL HURT?,MACGUFFIN >STACK
	ZERO? STACK /?L41
	PRINTD MACGUFFIN
	PRINTI " would probably have you "
	CALL PRINT-ID,STR?112
	ZERO? SKEWED? /?L44
	PRINTI "tortured"
	JUMP ?L48
?L44:	PRINTI "arrested"
?L48:	CALL IF-YOU-TRIED
	RTRUE
?L41:	EQUAL? PRSA,V?RUB,V?SQUEEZE,V?KISS \?L51
	PRINTD MACGUFFIN
	PRINTI " "
	CALL PRINT-ID,STR?113
	ZERO? SKEWED? /?L54
	PRINTI "slaps you across the face"
	JUMP ?L58
?L54:	PRINTI "smiles dreamily"
?L58:	PRINTR "."
?L51:	EQUAL? PRSA,V?FEED,V?GIVE \FALSE
	EQUAL? PRSI,MACGUFFIN \FALSE
	ZERO? SKEWED? \FALSE
	GRTR? MACGUFFIN-SCRIPT,3 \FALSE
	CALL BUT-THE,MACGUFFIN
	PRINTR "is sound asleep!"

	.FUNCT I-DULL-MACGUFFIN
	EQUAL? HERE,INSIDE-POLICE-STATION \FALSE
	INC 'MACGUFFIN-SCRIPT
	CRLF
	EQUAL? MACGUFFIN-SCRIPT,1 \?L3
	PRINTD MACGUFFIN
	PRINTI " opens one eye as you enter"
	JUMP ?L16
?L3:	EQUAL? MACGUFFIN-SCRIPT,2 \?L7
	PRINTI """Just drop my mail on the desk,"" "
	PRINTD MACGUFFIN
	PRINTI " murmurs sleepily"
	JUMP ?L16
?L7:	EQUAL? MACGUFFIN-SCRIPT,3 \?L10
	PRINTI "A voice crackles on the "
	PRINTD RADIO
	PRINTI ". ""Ten-four,"" "
	PRINTD MACGUFFIN
	PRINTI " yawns"
	JUMP ?L16
?L10:	EQUAL? MACGUFFIN-SCRIPT,4 \?L13
	PRINTD MACGUFFIN
	PRINTI " begins to snore softly"
	JUMP ?L16
?L13:	CALL INT,I-DULL-MACGUFFIN >STACK
	PUT STACK,0,0
	PRINTI "The voice of"
	CALL BOSS
	PRINTI ", crackles to life on the "
	PRINTD RADIO
	PRINTI ". """
	FSET? ENVELOPE,RMUNGBIT \?L21
	PRINTI "Stop dawdling and deliver that"
	JUMP ?L25
?L21:	PRINTI "You "
	CALL PICK-ONE,INSULTS >STACK
	PRINT STACK
	PRINTI "! You forgot the"
?L25:	PRINTI " envelope!"" he "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
?L16:	PRINTR "."

	.FUNCT I-NASTY-MACGUFFIN
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,INSIDE-POLICE-STATION \FALSE
	INC 'MACGUFFIN-SCRIPT
	CRLF
	EQUAL? MACGUFFIN-SCRIPT,1 \?L5
	ZERO? JAIL-VISITS \?L7
	PRINTI """It's past curfew,"" "
	PRINTD MACGUFFIN
	PRINTR " growls as you enter. ""I hope you've got a very good reason for coming in here at this hour."""
?L7:	SET 'MACGUFFIN-SCRIPT,0
	CALL INT,I-NASTY-MACGUFFIN >STACK
	PUT STACK,0,0
	IN? BRANCH,PROTAGONIST \?L12
	MOVE BRANCH,ROTARY-WEST
?L12:	PRINTI """You again!"" cries "
	PRINTD MACGUFFIN
	PRINTI " as you enter. Moments later you're pinned to the floor by a dozen gigantic Boots. An especially tall Boot strides into the "
	PRINTD GLOBBY
	PRINTI ", curls its leather tongue and leaves an ugly toeprint on your nice, clean clothes."
	CRLF
	CRLF
	PRINTD MACGUFFIN
	PRINTI " shows you his "
	CALL SHARP-TEETH
	PRINTI ". "
	EQUAL? JAIL-VISITS,1 \?L19
	CALL JAIL-AGAIN
	CALL TO-JAIL >STACK
	RSTACK
?L19:	PRINTI """We don't want to trouble the Tower"
	CALL SHARK-SNACK
	CALL THROWN-OVER-SHOULDER
	CALL INTO-BAY >STACK
	RSTACK
?L5:	EQUAL? MACGUFFIN-SCRIPT,2 \?L24
	PRINTI """You've got exactly one second to tell me why I shouldn't throw you in jail,"" notes "
	PRINTD MACGUFFIN
	PRINTR " through clenched teeth."
?L24:	SET 'MACGUFFIN-SCRIPT,0
	CALL INT,I-NASTY-MACGUFFIN >STACK
	PUT STACK,0,0
	IN? BRANCH,PROTAGONIST \?L28
	MOVE BRANCH,ROTARY-WEST
?L28:	PRINTI """Your second's up."""
	CALL PRINT-ID,STR?114
	CALL TO-JAIL >STACK
	RSTACK

	.FUNCT VOSS-F,CONTEXT=0,RESPONSE
	EQUAL? PRSA,V?EXAMINE \?L1
	ZERO? SKEWED? /?L3
	PRINTI "Her once kindly features have grown hard with cynicism"
	JUMP ?L7
?L3:	PRINTI "She's holding a purse and an armful of books"
?L7:	PRINTR "."
?L1:	CALL IMAGE?,MISS-VOSS >STACK
	ZERO? STACK /?L12
	RETURN 2
?L12:	CALL TALKING-TO?,MISS-VOSS >STACK
	ZERO? STACK /?L15
	ZERO? SKEWED? /?L16
	SET 'RESPONSE,BAD-VOSS-RESPONSES
	JUMP ?L18
?L16:	SET 'RESPONSE,GOOD-VOSS-RESPONSES
?L18:	PRINTI """"
	CALL PICK-ONE,RESPONSE >STACK
	PRINT STACK
	PRINTI ","" she replies."
	CRLF
	RETURN 2
?L15:	EQUAL? PRSA,V?GIVE \?L23
	EQUAL? PRSI,MISS-VOSS \?L23
	PRINTD MISS-VOSS
	EQUAL? PRSO,COIN \?L24
	CALL HELD?,COIN >STACK
	ZERO? STACK /?L24
	ZERO? SKEWED? /?L24
	MOVE COIN,MISS-VOSS
	SET 'VOSS-SCRIPT,-1
	CALL QUEUE,I-VOSS-SUSPICIOUS,-1 >STACK
	PUT STACK,0,1
	FCLEAR TICKET,RMUNGBIT
	FCLEAR TICKET,NDESCBIT
	MOVE TICKET,PROTAGONIST
	PRINTI " snatches away your "
	PRINTD COIN
	PRINTI " with her bony fingers and hands you a "
	PRINTD TICKET
	PRINTI "."
	CALL PRINT-ID,STR?115
	CALL YOU-ARE-HOLDING,TICKET
	CRLF
	CRLF
	CALL UPDATE-SCORE,3
	RTRUE
?L24:	PRINTI " shakes her head. ""I haven't any use for "
	CALL PRINT-ID,STR?116
	CALL ARTICLE,PRSO
	PRINTD PRSO
	PRINTI "!"" she "
	ZERO? SKEWED? /?L33
	PRINTI "snarl"
	JUMP ?L37
?L33:	PRINTI "laugh"
?L37:	PRINTR "s."
?L23:	EQUAL? PRSA,V?FOLLOW \?L42
	ZERO? SKEWED? \?L42
	EQUAL? HERE,ROTARY-SOUTH \?L42
	IN? MISS-VOSS,THRONE-ROOM \?L42
	MOVE MISS-VOSS,ISLAND
	CALL DO-WALK,P?SOUTH
	RTRUE
?L42:	EQUAL? PRSA,V?LISTEN \FALSE
	CALL ENABLED?,I-VOSS-SUSPICIOUS >STACK
	ZERO? STACK /FALSE
	PRINTI """M-Y-O-B!"" snaps "
	PRINTD MISS-VOSS
	PRINTR "."

	.FUNCT IN-VOSS,CONTEXT=0
	EQUAL? CONTEXT,M-CONT \FALSE
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,VIOLET-NOTE /FALSE
	CALL NOT-LIKELY,MISS-VOSS,STR?117
	RTRUE

	.FUNCT VOSS-THINGS-F
	CALL TOUCHING?,VOSS-THINGS >STACK
	ZERO? STACK \?L3
	EQUAL? PRSA,V?SEARCH,V?LOOK-INSIDE \FALSE
?L3:	PRINTD MISS-VOSS
	CALL MIGHT-NOT-LIKE
	RTRUE

	.FUNCT I-VOSS-CALLING
	ZERO? SKEWED? \FALSE
	ZERO? NOTE-GIVEN? \FALSE
	EQUAL? HERE,ROTARY-WEST,PARK,ROTARY-EAST \FALSE
	CALL SOMEBODY-CALLING,1 >STACK
	RSTACK

	.FUNCT I-VOSS-BABBLE
	EQUAL? HERE,ROTARY-SOUTH \FALSE
	CALL THIS-IS-IT,MISS-VOSS
	CRLF
	IN? VIOLET-NOTE,MISS-VOSS \?L3
	DEC 'ANGER
	ZERO? ANGER \?L5
	CALL VOSS-LEAVES
	REMOVE VIOLET-NOTE
	PRINTD MISS-VOSS
	PRINTI " puts the "
	PRINTD VIOLET-NOTE
	PRINTI " back in her purse. ""Very well,"" she says. ""If you won't take this note to "
	PRINTD CRISP
	PRINTI " for me, I'll just have to do it myself.""

She closes her purse with an indignant snap and"
	CALL VOSS-HURRIES
	CRLF
	CRLF
	CALL UPDATE-SCORE,-10
	RTRUE
?L5:	CALL THIS-IS-IT,VIOLET-NOTE
	PRINTI """"
	CALL PICK-ONE,VOSS-OFFERS >STACK
	PRINT STACK
	PRINTI ","" says "
	PRINTD MISS-VOSS
	PRINTR ", holding it out to you."
?L3:	INC 'VOSS-SCRIPT
	EQUAL? VOSS-SCRIPT,1 \?L13
	CALL LIBRARIAN
	PRINTI ", is locking the "
	PRINTD LIBRARY-DOOR
	PRINTR " as you approach. ""Just the person I was looking for!"" she exclaims, smiling brightly."
?L13:	EQUAL? VOSS-SCRIPT,2 \?L17
	MOVE VIOLET-NOTE,MISS-VOSS
	CALL THIS-IS-IT,VIOLET-NOTE
	PRINTD MISS-VOSS
	PRINTI " retrieves a violet slip of paper from the depths of her purse. ""Be a sweetie and give this note to your dear boss, "
	PRINTD CRISP
	PRINTR ","" she coos, holding the note out to you. ""I'd be ever so much obliged."""
?L17:	CALL PRINT-ID,STR?118
	SET 'NOTE-GIVEN?,1
	CALL VOSS-HURRIES-AWAY
	CRLF
	RTRUE

	.FUNCT VOSS-HURRIES-AWAY
	CALL VOSS-LEAVES
	PRINTD MISS-VOSS
	CALL VOSS-HURRIES
	PRINTI " ""Thanks! Toody-loo!"""
	RTRUE

	.FUNCT VOSS-LEAVES
	SET 'ANGER,4
	REMOVE VOSS-THINGS
	MOVE MISS-VOSS,THRONE-ROOM
	CALL INT,I-VOSS-CALLING >STACK
	PUT STACK,0,0
	CALL INT,I-VOSS-BABBLE >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT VOSS-HURRIES
	PRINTI " hurries away down the street."
	RTRUE

	.FUNCT I-VOSS-SUSPICIOUS
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,ROTARY-EAST \FALSE
	INC 'VOSS-SCRIPT
	ZERO? VOSS-SCRIPT /FALSE
	CRLF
	EQUAL? VOSS-SCRIPT,1 \?L8
	PRINTI "Out of the "
	PRINTD CORNER
	PRINTI " of your eye, you notice "
	PRINTD MISS-VOSS
	PRINTI " squinting carefully at the "
	PRINTD COIN
	PRINTR " you gave her. She looks at you suspiciously, picks up a telephone and begins to dial rapidly."
?L8:	EQUAL? VOSS-SCRIPT,2 \?L12
	PRINTD MISS-VOSS
	PRINTR " is talking urgently with someone on the phone. She doesn't take her eyes off you for a moment."
?L12:	EQUAL? VOSS-SCRIPT,3 \?L15
	PRINTD MISS-VOSS
	PRINTR " hangs up the phone and looks at you with triumph in her eyes."
?L15:	CALL INT,I-VOSS-SUSPICIOUS >STACK
	PUT STACK,0,0
	CALL SEE-VULTURE >STACK
	RSTACK

	.FUNCT DESCRIBE-HORSE,CONTEXT
	EQUAL? CONTEXT,M-OBJDESC \FALSE
	FSET? HORSE,TOUCHBIT \?L3
	PRINTI "There's a dying "
	PRINTD HORSE
	PRINTI " here"
	JUMP ?L7
?L3:	FSET HORSE,TOUCHBIT
	PRINTI "Apparently a careless fisherman has just left the wharf, for lying on the planks is a little "
	PRINTD HORSE
	PRINTI ", its gills moving in and out with its dying gasps"
?L7:	PRINTI "."
	RTRUE

	.FUNCT HORSE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "Poor thing. It's at the edge of death."
?L1:	CALL TALKING-TO?,HORSE >STACK
	ZERO? STACK /?L5
	CALL SAY-THE,HORSE
	PRINTI " is too busy dying to respond."
	CRLF
	RETURN 2
?L5:	EQUAL? PRSA,V?RESCUE \?L10
	PRINTI "A noble idea. "
	CALL HOW?
	RTRUE
?L10:	CALL HURT?,HORSE >STACK
	ZERO? STACK /FALSE
	PRINTI "Let the "
	PRINTD HORSE
	PRINTI " die in peace, will you?"
	CRLF
	CALL PRINT-ID,STR?119
	RTRUE

	.FUNCT I-HORSE-DEATH
	CALL VISIBLE?,HORSE >STACK
	ZERO? STACK /FALSE
	DEC 'HORSE-SCRIPT
	CRLF
	EQUAL? HORSE-SCRIPT,3 \?L3
	CALL SAY-THE,HORSE
	PRINTI " looks at you with moist, frightened eyes"
	JUMP ?L13
?L3:	EQUAL? HORSE-SCRIPT,2 \?L7
	CALL SAY-THE,HORSE
	PRINTI " opens and closes its little mouth pathetically"
	JUMP ?L13
?L7:	EQUAL? HORSE-SCRIPT,1 \?L10
	CALL SAY-THE,HORSE
	PRINTI "'s gills are barely moving. It's practically dead"
	JUMP ?L13
?L10:	PRINTI "With a barely perceptible sigh, the little "
	PRINTD HORSE
	PRINTI " gives up its ghost"
	LOC HORSE >STACK
	MOVE DHORSE,STACK
	REMOVE HORSE
	CALL INT,I-HORSE-DEATH >STACK
	PUT STACK,0,0
?L13:	PRINTR "."

	.FUNCT DHORSE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,HORSE
	PRINTR " is dead."
?L1:	CALL TALKING-TO?,DHORSE >STACK
	ZERO? STACK /?L5
	CALL NOT-LIKELY,DHORSE,STR?120
	RETURN 2
?L5:	CALL HURT?,DHORSE >STACK
	ZERO? STACK \?L9
	EQUAL? PRSA,V?RESCUE \FALSE
?L9:	PRINTI "Too late. "
	CALL PERFORM,V?EXAMINE,DHORSE
	RTRUE

	.FUNCT PELICAN-F,CONTEXT=0
	CALL THIS-IS-IT,PELICAN
	CALL TALKING-TO?,PELICAN >STACK
	ZERO? STACK \?L3
	EQUAL? PRSA,V?YELL \?L1
?L3:	CALL IT-IGNORES-YOU,PELICAN
	RETURN 2
?L1:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTI "It's a fat old bird with a droopy beak"
	IN? HAT,PELICAN \?L9
	PRINTI ", half-closed eyes and "
	CALL A-WIZARDS-HAT
	RTRUE
?L9:	PRINTR " and half-closed eyes."
?L6:	EQUAL? PRSA,V?LOOK-ON \?L16
	IN? HAT,PELICAN \?L16
	PRINTI "It's wearing a "
	PRINTD HAT
	PRINTR "."
?L16:	EQUAL? PRSA,V?PUT-ON,V?FEED,V?GIVE \?L19
	EQUAL? PRSI,PELICAN \?L19
	EQUAL? PRSO,BROOM \?L20
	CALL GET-OFF-BROOM-FIRST
?L20:	CALL SAY-THE,PELICAN
	PRINTI " sniffs "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " suspiciously"
	EQUAL? PRSO,DHORSE,CHOCOLATE,WORM \?L27
	REMOVE PRSO
	PRINTR ", then swallows it without a word of thanks."
?L27:	EQUAL? PRSO,MILK \?L31
	PRINTR ", but refuses to take it."
?L31:	EQUAL? PRSO,WISHBRINGER \?L34
	REMOVE WISHBRINGER
	REMOVE PELICAN
	CALL EYES-OPEN
	PRINTI " disappears with the "
	PRINTD PELICAN
	PRINTI " as it flies off across the bay."
	CRLF
	CALL PRINT-ID,STR?121
	CALL UPDATE-SCORE,-10
	RETURN 2
?L34:	EQUAL? PRSO,HAT \?L39
	REMOVE HAT
	REMOVE PELICAN
	CALL START-BUZZ,5
	FCLEAR PELICAN,RMUNGBIT
	CALL EYES-OPEN
	PRINTI " quickly finds a place on the "
	PRINTD PELICAN
	PRINTI "'s head. Then the old bird gives you a sly, knowledgeable wink.

All at once the "
	PRINTD LIGHTHOUSE
	PRINTI " blazes to life! Its shining beacon whirls like a gyroscope, and a pencil-thin beam of light pierces the sky and traces a word on a passing cloud: "
	GET POWER-WORDS,POWER >STACK
	PRINT STACK
	PRINTI ".

The "
	PRINTD PELICAN
	CALL SOARS-AWAY-OVER
	PRINTI "the bay. As the beam of the "
	PRINTD LIGHTHOUSE
	PRINTI " fades, a voice in your head whispers, ""Good luck"
	PRINT ADVENTURER
	PRINTI "!"""
	CRLF
	CRLF
	CALL UPDATE-SCORE,5
	RETURN 2
?L39:	MOVE PRSO,FESTERON-POINT
	PRINTR " and carelessly drops it at your feet."
?L19:	CALL HURT?,PELICAN >STACK
	ZERO? STACK /?L49
	PRINTI "Imagine doing that to a defenseless "
	PRINTD PELICAN
	PRINTI "!"
	CRLF
	CALL PRINT-ID,STR?122
	RTRUE
?L49:	EQUAL? PRSA,V?KISS,V?RUB,V?TAKE /?L53
	EQUAL? PRSA,V?PLAY \FALSE
?L53:	EQUAL? PRSO,PELICAN \FALSE
	CALL SAY-THE,PELICAN
	PRINTI " nips you with its beak. Ouch!"
	CRLF
	CALL PRINT-ID,STR?123
	RTRUE

	.FUNCT EYES-OPEN
	PRINTI ". Its eyes open wide with interest, and the "
	PRINTD PRSO
	RTRUE

	.FUNCT OLD-WOMAN-F,CONTEXT=0
	CALL THIS-IS-IT,OLD-WOMAN
	EQUAL? PRSA,V?WAVE-AT,V?HELLO \?L1
	CALL SAY-THE,OLD-WOMAN
	PRINTI " smiles kindly."
	CRLF
	RETURN 2
?L1:	EQUAL? PRSA,V?REPLY,V?THANK,V?TELL \?L7
	EQUAL? PRSO,OLD-WOMAN \?L7
	RANDOM 100 >STACK
	LESS? 50,STACK /?L8
	CALL SAY-THE,OLD-WOMAN
	JUMP ?L10
?L8:	PRINTI "She"
?L10:	PRINTI " "
	CALL PICK-ONE,LADY-REACTIONS >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	RETURN 2
?L7:	EQUAL? PRSA,V?QUESTION,V?ASK-ABOUT \?L17
	EQUAL? PRSO,OLD-WOMAN \?L17
	PRINTI """"
	CALL PICK-ONE,Q-SIGHS >STACK
	PRINT STACK
	PRINTI ","" sighs the "
	PRINTD OLD-WOMAN
	PRINTI " wistfully."
	RANDOM 100 >STACK
	LESS? 50,STACK /?L20
	PRINTI " """
	CALL PICK-ONE,Q-EXCUSES >STACK
	PRINT STACK
	PRINTI "."""
?L20:	CRLF
	RETURN 2
?L17:	EQUAL? PRSA,V?ASK-FOR \?L27
	EQUAL? PRSO,OLD-WOMAN \?L27
	IN? PRSI,OLD-WOMAN \?L28
	CALL PERFORM,V?TAKE,PRSI
	RTRUE
?L28:	CALL SAY-THE,OLD-WOMAN
	PRINTR " tactfully ignores your request."
?L27:	CALL HURT?,OLD-WOMAN >STACK
	ZERO? STACK \?L34
	EQUAL? PRSA,V?ALARM,V?KISS \?L33
?L34:	CALL SAY-THE,OLD-WOMAN
	CALL MIGHT-NOT-LIKE
	RTRUE
?L33:	EQUAL? PRSA,V?READ \?L35
	EQUAL? PRSI,OLD-WOMAN \?L35
	FSET? PRSO,READBIT \?L35
	EQUAL? PRSO,RANSOM-LETTER \?L36
	CALL READ-LETTER-TO-WOMAN
	RTRUE
?L36:	CALL PERFORM,V?THANK,OLD-WOMAN
	RTRUE
?L35:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,OLD-WOMAN \FALSE
	CALL THIS-IS-IT,PRSO
	EQUAL? PRSO,ENVELOPE,OPEN-ENVELOPE \?L40
	ZERO? WOMAN-SEEN-ENVELOPE? /?L42
	CALL READ-BEG
	RETURN 2
?L42:	SET 'WOMAN-SEEN-ENVELOPE?,1
	CALL INT,I-WOMAN-SCRIPT >STACK
	PUT STACK,0,0
	SET 'ANGER,4
	CALL QUEUE,I-READ-PROMPT,-1 >STACK
	PUT STACK,0,1
	CALL UPDATE-SCORE,5
	CRLF
	CALL SAY-THE,OLD-WOMAN
	PRINTI " turns pale as she takes the "
	PRINTD ENVELOPE
	PRINTI " from you. ""It's been a long, long time since I last saw this handwriting,"" she murmurs, turning it over in her hands. ""Hoped I never would again.""

She starts to open the "
	PRINTD ENVELOPE
	PRINTI ", thinks better of it and hands it back to you. ""Will you open it up and read it to me?"" she pleads. ""I'll never find my glasses in this mess."""
	CALL YOU-ARE-HOLDING,ENVELOPE,1
	CRLF
	RTRUE
?L40:	EQUAL? PRSO,RANSOM-LETTER \?L49
	CALL READ-BEG
	RETURN 2
?L49:	CALL SAY-THE,OLD-WOMAN
	PRINTI " glances at "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR " and hands it back. ""You keep it, dear. I've got enough junk already."""

	.FUNCT I-WOMAN-SCRIPT
	CALL THIS-IS-IT,OLD-WOMAN
	EQUAL? HERE,INSIDE-SHOPPE \FALSE
	INC 'WOMAN-SCRIPT
	CRLF
	EQUAL? WOMAN-SCRIPT,1 \?L3
	FSET? SHOPPE-DOOR,OPENBIT \?L5
	FCLEAR SHOPPE-DOOR,OPENBIT
	CALL THIS-IS-IT,SHOPPE-DOOR
	CALL SUDDEN-GUST
	PRINTI "slams the "
	PRINTD SHOPPE-DOOR
	PRINTI " closed. "
	CALL BELL-TINKLES
	CRLF
?L5:	PRINTI """Just a moment!"" cries a voice behind the "
	PRINTD CURTAIN
	PRINTR "."
?L3:	EQUAL? WOMAN-SCRIPT,2 \?L12
	CALL THIS-IS-IT,CLOCK
	PRINTI "The noisy tick of the "
	PRINTD CLOCK
	PRINTR " is making you uneasy."
?L12:	EQUAL? WOMAN-SCRIPT,3 \?L15
	FCLEAR CLOCK,RMUNGBIT
	MOVE OLD-WOMAN,INSIDE-SHOPPE
	CALL THIS-IS-IT,OLD-WOMAN
	CALL SAY-THE,CURTAIN
	PRINTR " opens so quickly it makes you jump.

The woman standing before you is older than your oldest aunt. Her thin, pale face and bony hands make her look fragile, like a fading signature in an antique book. But her eyes remember everything they have ever seen.

You appraise one another for a long moment before she breaks the ice. ""Welcome in, welcome!"" she chortles. ""Don't get many visitors this late in the day.""

The room seems oddly quiet all of a sudden."
?L15:	EQUAL? WOMAN-SCRIPT,4 \?L18
	SET 'ANGER,4
	PRINTI """Hope you have some mail for me,"" the "
	PRINTD OLD-WOMAN
	PRINTR " says eagerly."
?L18:	DEC 'ANGER
	ZERO? ANGER \?L22
	PRINTI """No mail, huh?"" says the woman with disappointment in her voice. ""Oh, well."""
	CALL THROWN-OUT-OF-SHOPPE
	CRLF
	RTRUE
?L22:	PRINTI """"
	CALL PICK-ONE,WOMAN-WAITS >STACK
	PRINT STACK
	PRINTR "."""

	.FUNCT I-READ-PROMPT
	CALL THIS-IS-IT,OLD-WOMAN
	EQUAL? WOMAN-SEEN-ENVELOPE?,1 \?L1
	SET 'WOMAN-SEEN-ENVELOPE?,2
	RTRUE
?L1:	DEC 'ANGER
	CRLF
	ZERO? ANGER \?L4
	PRINTI """Never mind, then,"" says the woman, taking the envelope"
	FSET? OPEN-ENVELOPE,TOUCHBIT \?L8
	PRINTI " and letter"
?L8:	PRINTI ". ""I'll read it myself later."""
	CALL THROWN-OUT-OF-SHOPPE >STACK
	RSTACK
?L4:	CALL READ-BEG >STACK
	RSTACK

	.FUNCT READ-BEG
	PRINTI """"
	RANDOM 100 >STACK
	LESS? 50,STACK /?L3
	PRINTI "Go ahead, dear. "
?L3:	RANDOM 100 >STACK
	LESS? 50,STACK /?L8
	PRINTI "Don't be bashful. "
?L8:	FSET? OPEN-ENVELOPE,TOUCHBIT \?L13
	CALL THIS-IS-IT,RANSOM-LETTER
	PRINTI "R"
	JUMP ?L17
?L13:	CALL THIS-IS-IT,ENVELOPE
	PRINTI "Open the envelope and r"
?L17:	PRINTI "ead the letter to me"
	RANDOM 100 >STACK
	LESS? 50,STACK /?L22
	PRINTI ", please"
?L22:	RANDOM 100 >STACK
	LESS? 50,STACK /?L27
	PRINTI ". I'm waiting"
?L27:	PRINTR "."""

	.FUNCT READ-LETTER-TO-WOMAN
	ZERO? LETTER-READ-TO-WOMAN? /?L1
	PRINTR """Once was more than enough."""
?L1:	SET 'LETTER-READ-TO-WOMAN?,1
	CALL INT,I-READ-PROMPT >STACK
	PUT STACK,0,0
	SET 'WOMAN-SCRIPT,-1
	SET 'ANGER,4
	CALL QUEUE,I-RECRUIT,-1 >STACK
	PUT STACK,0,1
	REMOVE RANSOM-LETTER
	REMOVE OPEN-ENVELOPE
	CALL UPDATE-SCORE,1
	CRLF
	CALL SAY-THE,OLD-WOMAN
	PRINTI " is motionless as you read. Glancing up, you see tears of anger forming; but she turns away as your eyes meet.

""Kidnapped,"" she whispers after a long silence. She paces aimlessly around the room, deep in thought.

""Many seek to gain the Stone of Dreams,"" she mutters, mostly to herself. ""Yet few can imagine the price. For years I have fought to conceal it from"
	PRINT EONE
	PRINTI " and others like her. My youth, my home and family, all were forfeited for its protection. And now,"" her voice breaking with emotion, ""now it claims my only companion.""

Impulsively, the woman snatches away the letter and envelope and crumples them in her trembling hands. ""No one is strong enough to guard "
	PRINT GAME
	PRINTR " alone."""

	.FUNCT THROWN-OUT-OF-SHOPPE
	CRLF
	CRLF
	CALL SAY-THE,OLD-WOMAN
	FSET? SHOPPE-DOOR,OPENBIT /?L1
	PRINTI " opens the "
	PRINTD HOUSE-DOOR
	PRINTI " and"
?L1:	PRINTI " leads you gently but firmly out of the "
	PRINTD MAGICK-SHOPPE
	PRINTI ". ""Thanks for the visit. Good night!""

She slams the door shut in your face. "
	CALL BELL-TINKLES
	CALL FIRED >STACK
	RSTACK

	.FUNCT I-RECRUIT
	CALL THIS-IS-IT,OLD-WOMAN
	IN? SNAKE-CAN,OLD-WOMAN \?L1
	DEC 'ANGER
	CRLF
	ZERO? ANGER \?L3
	PRINTI """Oh, well. Never mind,"" shrugs the woman as she puts the "
	PRINTD SNAKE-CAN
	PRINTI " away."
	CALL THROWN-OUT-OF-SHOPPE
	RTRUE
?L3:	CALL THIS-IS-IT,SNAKE-CAN
	PRINTI """"
	CALL PICK-ONE,CROW-OFFERS >STACK
	PRINT STACK
	PRINTI ","" says the "
	PRINTD OLD-WOMAN
	PRINTI ", holding a "
	PRINTD SNAKE-CAN
	PRINTR " out to you."
?L1:	INC 'WOMAN-SCRIPT
	ZERO? WOMAN-SCRIPT /FALSE
	CRLF
	EQUAL? WOMAN-SCRIPT,1 \?L14
	CALL THIS-IS-IT,SNAKE-CAN
	MOVE SNAKE-CAN,OLD-WOMAN
	CALL SAY-THE,OLD-WOMAN
	PRINTI " makes an effort to compose herself.

""Thank you for coming all this way for me,"" she says, reaching up to a shelf full of cheap gags. ""I know I'm not supposed to tip you, but take this little trinket anyway.""

The woman holds out a small "
	PRINTD SNAKE-CAN
	PRINTR " for you to take."
?L14:	EQUAL? WOMAN-SCRIPT,2 \?L18
	PRINTI """It's getting Dark outside,"" the "
	PRINTD OLD-WOMAN
	PRINTR " remarks, and you can almost hear the capital D. ""Maybe you should be getting back to town."""
?L18:	EQUAL? WOMAN-SCRIPT,3 \?L21
	FSET SHOPPE-DOOR,OPENBIT
	SET 'IMMOBILIZED?,1
	CALL SAY-THE,OLD-WOMAN
	PRINTI " hobbles over to the "
	PRINTD SHOPPE-DOOR
	PRINTI " and opens it. "
	CALL BELL-TINKLES
	CRLF
	PRINTI """Keep a sharp eye out for my cat, won't you?"" She speaks the words slowly and distinctly. ""Bring her to me if you find her. "
	CALL DESCRIBE-CHAOS,1
	PRINTI "... right HERE."""
	CRLF
	CRLF
	CALL SAY-THE,OLD-WOMAN
	PRINTR " touches the middle of your forehead with her finger. The light outside dims suddenly, like a cloud passing over the sun."
?L21:	EQUAL? WOMAN-SCRIPT,4 \FALSE
	SET 'IMMOBILIZED?,0
	CALL SAY-THE,OLD-WOMAN
	PRINTI " takes away her finger. Your forehead is tingling.

""The Stone of Dreams can help you in your search. I cannot reveal the place where I have hidden it, for"
	PRINT EONE
	PRINTI " would see your thoughts and take the treasure for herself. You must discover it alone, and rely on legends to instruct you in its mysteries.""

As she speaks, the "
	PRINTD OLD-WOMAN
	PRINTI " gently leads you through the door of the "
	PRINTD MAGICK-SHOPPE
	PRINTI ". She pauses before closing the door.

""Return the cat to me, and "
	PRINT GAME
	PRINTI " shall be yours.

""Her name is "
	PRINTD CHAOS
	PRINTI "."""
	CRLF
	CRLF
	CALL BELL-TINKLES
	CALL INT,I-RECRUIT >STACK
	PUT STACK,0,0
	MOVE PROTAGONIST,CLIFF-EDGE
	CALL SKEW
	LESS? SCORE,18 \?L33
	SET 'SCORE,18
	SET 'MOVES,0
?L33:	SET 'HERE,CLIFF-EDGE
	CALL CARRIAGE-RETURNS
	CALL V-LOOK
	CALL QUEUE,I-BEFORE-MOONSET,-1 >STACK
	PUT STACK,0,1
	SET 'WOMAN-SCRIPT,-1
	CALL QUEUE,I-FOG-RISING,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT SKEW,OBJ,NXT
	FIRST? ROOMS >OBJ \?L3
?L29:	FCLEAR OBJ,TOUCHBIT
	NEXT? OBJ >OBJ /?L29
?L3:	FCLEAR MAGICK-SHOPPE,TOUCHBIT
	FCLEAR SHOPPE-DOOR,OPENBIT
	FSET SHOPPE-DOOR,LOCKEDBIT
	FCLEAR SNAKE-CAN,OPENBIT
	SET 'SNAKE-GONE?,0
	MOVE VULTURE,GNARLED-TREE
	MOVE TROLL,NORTH-OF-BRIDGE
	MOVE TOLL-GATE,NORTH-OF-BRIDGE
	FCLEAR SMALL-BOX,NDESCBIT
	MOVE SMALL-BOX,WEST-OF-HOUSE
	FCLEAR LAKE-SAND,RMUNGBIT
	FSET? PIT,OPENBIT \?L8
	FSET LAKE-SAND,TOOLBIT
	JUMP ?L10
?L8:	REMOVE LEAVES
	FSET PIT,OPENBIT
	MOVE PLATYPUS,PIT
?L10:	CALL MOVE-ALL,FOUNTAIN,STEEP-TRAIL
	MOVE PIRANHA,FOUNTAIN
	MOVE TOKEN,FOUNTAIN
	MOVE BOOTS,FESTERON-POINT
	CALL QUEUE,I-BOOT-PATROL,-1 >STACK
	PUT STACK,0,1
	CALL ENABLED?,I-DULL-MACGUFFIN >STACK
	ZERO? STACK /?L11
	CALL INT,I-DULL-MACGUFFIN >STACK
	PUT STACK,0,0
?L11:	SET 'MACGUFFIN-SCRIPT,0
	IN? CHOCOLATE,DESK \?L14
	REMOVE CHOCOLATE
	JUMP ?L16
?L14:	FCLEAR CHOCOLATE,NDESCBIT
?L16:	CALL QUEUE,I-BREAK-IN,-1 >STACK
	PUT STACK,0,1
	ZERO? NOTE-GIVEN? \?L17
	CALL INT,I-VOSS-CALLING >STACK
	PUT STACK,0,0
	CALL INT,I-VOSS-BABBLE >STACK
	PUT STACK,0,0
	REMOVE VIOLET-NOTE
	REMOVE VOSS-THINGS
?L17:	MOVE MISS-VOSS,ROTARY-EAST
	MOVE TICKET,MISS-VOSS
	MOVE GRAVEDIGGER,LOBBY
	FSET ENTRANCE,OPENBIT
	FCLEAR ENTRANCE,LOCKEDBIT
	SET 'VOSS-SCRIPT,0
	MOVE CDEBRIS,INSIDE-CHURCH
	CALL ENABLED?,I-RODENT >STACK
	ZERO? STACK /?L20
	CALL INT,I-RODENT >STACK
	PUT STACK,0,0
?L20:	FSET CHURCH,RMUNGBIT
	FSET CHURCH,TOUCHBIT
	FSET CHURCH,TOOLBIT
	MOVE SPEAKER,INSIDE-CHURCH
	SET 'POODLE-HAPPY?,0
	REMOVE POODLE
	SET 'POOCH,HELLHOUND
	MOVE HELLHOUND,OUTSIDE-COTTAGE
	FSET HILLTOP,WETBIT
	MOVE MOAT,HILLTOP
	SET 'CRISP-SCRIPT,0
	FCLEAR CRISP,TOUCHBIT
	CALL ENABLED?,I-DIGGER-TALK >STACK
	ZERO? STACK /?L23
	CALL INT,I-DIGGER-TALK >STACK
	PUT STACK,0,0
?L23:	SET 'DIGGER-SCRIPT,0
	FSET SOUTH-GATE,OPENBIT
	FCLEAR SOUTH-GATE,LOCKEDBIT
	CALL QUEUE,I-CREAK,-1 >STACK
	PUT STACK,0,1
	FSET VAPORS,ACTORBIT
	CALL ACCESSIBLE?,HORSE >STACK
	ZERO? STACK \?L26
	REMOVE HORSE
?L26:	MOVE HUMANOIDS,VIDEO-ARCADE
	MOVE SHARKS,WHARF
	CALL MOVE-ALL,MAILBOX,FOSSIL
	SET 'SKEWED?,1
	RETURN SKEWED?

	.FUNCT HILLTOP-F,CONTEXT=0
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're on a hilltop overlooking the seaside "
	PRINTD FESTERON
	PRINTI " of"
	CALL WHICH-TOWN
	PRINTI "."
	CRLF
	CRLF
	ZERO? SKEWED? /?L7
	PRINTI "A "
	PRINTD TOWER
	PRINTI " stands in bleak silhouette against the moonlit sky. It rises a hundred feet above a barren plateau, and is encircled by a deep moat. The only "
	PRINTD ENTRANCE
	PRINTI "s are a"
	CALL OPEN-CLOSED,DRAWBRIDGE,1
	PRINTD DRAWBRIDGE
	PRINTI " and a dark "
	PRINTD WINDOW
	PRINTI " near the top."
	CRLF
	JUMP ?L13
?L7:	PRINTI "To the south stands the Festeron "
	PRINTD POST-OFFICE
	PRINTI ". It's a little brick building with a neatly-trimmed lawn. "
	CALL SAY-DOOR,POST-DOOR
?L13:	CRLF
	PRINTI "Roads run down the hill "
	CALL TO-E >STACK
	PRINT STACK
	PRINTR " and west. There's a signpost nearby."

	.FUNCT SAY-DOOR,OBJ
	CALL SAY-THE,OBJ
	FSET? OBJ,OPENBIT \?L1
	PRINTR " stands invitingly open."
?L1:	CALL IS-CLOSED
	CRLF
	RTRUE

	.FUNCT I-CRISP-CALLING
	EQUAL? HERE,HILLTOP \FALSE
	CALL SOMEBODY-CALLING >STACK
	RSTACK

	.FUNCT SOMEBODY-CALLING,ROTARY?=0
	CRLF
	PRINTI "Somebody "
	ZERO? ROTARY? /?L3
	PRINTI "on the south side of the Rotary"
	JUMP ?L7
?L3:	PRINTI "inside the "
	PRINTD POST-OFFICE
?L7:	PRINTR " is calling you."

	.FUNCT HILL-F
	EQUAL? PRSA,V?LOOK-UP,V?LOOK-DOWN,V?EXAMINE /?L3
	EQUAL? PRSA,V?LOOK-ON \?L1
?L3:	CALL V-LOOK
	RTRUE
?L1:	EQUAL? HERE,CLIFF-EDGE \?L4
	CALL TOO-FAR-AWAY,HILL
	RETURN 2
?L4:	EQUAL? PRSA,V?ENTER,V?USE,V?WALK-TO /?L8
	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON,V?THROUGH \?L7
?L8:	EQUAL? HERE,HILLTOP,LOOKOUT-HILL \?L9
	CALL ALREADY-AT,HILL,1
	RTRUE
?L9:	CALL DO-WALK,P?UP
	RTRUE
?L7:	EQUAL? PRSA,V?CLIMB-DOWN,V?EXIT \?L12
	EQUAL? HERE,HILLTOP,LOOKOUT-HILL \?L13
	CALL DO-WALK,P?DOWN
	RTRUE
?L13:	CALL ALREADY-AT,HILL
	RTRUE
?L12:	CALL YOU-DONT-NEED,HILL
	RETURN 2

	.FUNCT ALREADY-ON,THING,NOT?=0
	PRINTI "But you're "
	ZERO? NOT? /?L3
	PRINTI "not"
	JUMP ?L7
?L3:	PRINTI "already"
?L7:	PRINTI " on "
	CALL ARTICLE,THING,1
	PRINTD THING
	PRINTR "!"

	.FUNCT ENTER-TOWER?
	ZERO? SKEWED? /?L1
	FSET? DRAWBRIDGE,OPENBIT \?L3
	CALL QUEUE,I-CRISP-CAPTURE,-1 >STACK
	PUT STACK,0,1
	RETURN VESTIBULE
?L3:	CALL ITS-CLOSED,DRAWBRIDGE
	RFALSE
?L1:	FSET? POST-DOOR,OPENBIT \?L7
	ZERO? CRISP-SCRIPT \?L9
	CALL QUEUE,I-HOORAY,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-GIVE-ENVELOPE,-1 >STACK
	PUT STACK,0,1
?L9:	RETURN INSIDE-POST-OFFICE
?L7:	CALL ITS-CLOSED,POST-DOOR
	RFALSE

	.FUNCT I-HOORAY
	CALL INT,I-HOORAY >STACK
	PUT STACK,0,0
	RANDOM 3 >STACK
	SUB STACK,1 >POWER
	CRLF
	CALL UPDATE-SCORE,1 >STACK
	RSTACK

	.FUNCT POST-OFFICE-F
	ZERO? SKEWED? /?L1
	ZERO? SUCCESS? \?L1
	CALL CANT-SEE-ANY,POST-OFFICE
	RETURN 2
?L1:	EQUAL? HERE,CLIFF-EDGE \?L5
	CALL TOO-FAR-AWAY,POST-OFFICE
	RETURN 2
?L5:	CALL ENTER-FROM?,HILLTOP,INSIDE-POST-OFFICE,POST-OFFICE >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	EQUAL? HERE,INSIDE-POST-OFFICE \?L10
	CALL V-LOOK >STACK
	RSTACK
?L10:	FSET? POST-DOOR,OPENBIT \FALSE
	CALL GO-INSIDE >STACK
	RSTACK

	.FUNCT POST-DOOR-F
	ZERO? SKEWED? /?L1
	CALL CANT-SEE-ANY,STR?124,1
	RETURN 2
?L1:	CALL THIS-IS-IT,POST-DOOR
	EQUAL? PRSA,V?KNOCK \?L6
	FSET? POST-DOOR,OPENBIT \?L8
	CALL ALREADY-OPEN
	RTRUE
?L8:	EQUAL? HERE,INSIDE-POST-OFFICE \?L10
	CALL WASTE-OF-TIME
	RTRUE
?L10:	FSET? POST-DOOR,LOCKEDBIT /FALSE
	PRINTI "A voice inside "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTR ", ""Come in!"""
?L6:	CALL USE-DOOR?,HILLTOP >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT INSIDE-POST-OFFICE-F,CONTEXT=0
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is the "
	PRINTD GLOBBY
	PRINTI " of the Festeron "
	PRINTD POST-OFFICE
	PRINTI ". The walls are lined with small, private mailboxes and "
	PRINTD POSTER
	PRINTI "s. A "
	PRINTD COUNTER
	PRINTI " runs along the entire length of the room."
	FIRST? COUNTER >STACK \?L5
	PRINTI " "
	PRINT YOU-SEE
	CALL PRINT-CONTENTS,COUNTER
	PRINTI " on the "
	PRINTD COUNTER
	PRINTI "."
?L5:	IN? CRISP,INSIDE-POST-OFFICE \?L20
	CRLF
	CRLF
	PRINTI "Your boss, "
	PRINTD CRISP
	PRINTI ", is "
	FSET? CRISP,TOUCHBIT \?L16
	PRINTR "watching you impatiently."
?L16:	FSET CRISP,TOUCHBIT
	PRINTI "behind the "
	PRINTD COUNTER
	PRINTI " reading other people's postcards."
?L20:	CRLF
	RTRUE

	.FUNCT EXIT-POST-OFFICE
	FSET? POST-DOOR,OPENBIT \?L1
	FSET? ENVELOPE,RMUNGBIT \?L3
	CALL HELD?,ENVELOPE >STACK
	ZERO? STACK /?L3
	PRINTI "As you leave the "
	PRINTD POST-OFFICE
	PRINTI ", somebody"
	CALL SLAMS-AND-LOCKS
	JUMP ?L7
?L3:	PRINTD CRISP
	PRINTI " "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI ", ""Come back here, "
	CALL PICK-ONE,INSULTS >STACK
	PRINT STACK
	FSET? ENVELOPE,RMUNGBIT \?L10
	PRINTI "! You forgot the envelope"
	CALL PRINT-ID,STR?125
?L10:	PRINTI "!"""
?L7:	CRLF
	CRLF
	RETURN HILLTOP
?L1:	CALL ITS-CLOSED,POST-DOOR
	RFALSE

	.FUNCT SLAMS-AND-LOCKS
	PRINTI " slams and locks the door behind you."
	SET 'ANGER,4
	CALL INT,I-CRISP-CALLING >STACK
	PUT STACK,0,0
	CALL INT,I-GIVE-ENVELOPE >STACK
	PUT STACK,0,0
	FCLEAR POST-DOOR,OPENBIT
	FSET POST-DOOR,LOCKEDBIT
	RTRUE

	.FUNCT POSTCARD-PSEUDO
	PRINT CANT
	PRINTI " do that. "
	PRINTD CRISP
	PRINTI " has hidden them."
	CRLF
	RETURN 2

	.FUNCT COUNTER-F
	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-INSIDE,V?LOOK-BEHIND \?L1
	FSET? ENVELOPE,RMUNGBIT /FALSE
	PRINTD CRISP
	PRINTR " pushes you away before you can get a good look."
?L1:	CALL GETTING-INTO? >STACK
	ZERO? STACK /FALSE
	PRINTD CRISP
	PRINTI " might yell at you"
	CALL IF-YOU-TRIED
	RTRUE

	.FUNCT POSTER-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	EQUAL? HERE,INSIDE-POST-OFFICE \?L3
	CALL FIXED-FONT-ON
	CRLF
	PRINTI "          WANTED!
    For Impersonating A
        Storyteller
""PROFESSOR"" BRIAN MORIARTY"
	CRLF
	CALL FIXED-FONT-OFF
	RTRUE
?L3:	ZERO? SKEWED? /?L7
	CALL SAY-THE,POSTER
	CALL HAS-YOUR-NAME
	RTRUE
?L7:	PRINTI "It's the same as the one in the "
	PRINTD POST-OFFICE
	PRINTR "."
?L1:	CALL HURT?,POSTER >STACK
	ZERO? STACK \?L12
	EQUAL? PRSA,V?TAKE \?L11
?L12:	EQUAL? HERE,INSIDE-POST-OFFICE \?L13
	PRINTD CRISP
	JUMP ?L15
?L13:	PRINTD MACGUFFIN
?L15:	CALL PRINT-ID,STR?126
	CALL MIGHT-NOT-LIKE
	RTRUE
?L11:	CALL YOU-DONT-NEED,POSTER
	RETURN 2

	.FUNCT HAS-YOUR-NAME
	PRINTR " has your name on it!"

	.FUNCT PRIVATE-BOXES?
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,SMALL-BOX
	PRINTI "es are"
	CALL CLOSED-AND-LOCKED
	RTRUE
?L1:	CALL HURT?,SMALL-BOX >STACK
	ZERO? STACK \?L7
	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE,V?OPEN /?L7
	EQUAL? PRSA,V?REACH-IN,V?UNLOCK \?L5
?L7:	CALL SAY-THE,SMALL-BOX
	PRINTI "es are private!"
	CALL PRINT-ID,STR?127
	CALL LEAVE-THEM-ALONE
	CRLF
	RTRUE
?L5:	CALL YOU-DONT-NEED,SMALL-BOX
	RETURN 2

	.FUNCT LEAVE-THEM-ALONE
	PRINTI " Better leave them alone."
	RTRUE

	.FUNCT OUTSIDE-CEMETERY-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "next to a"
	CALL OPEN-CLOSED,SOUTH-GATE,1
	PRINTI "iron gate that leads west into the"
	CALL WHICH-TOWN,STR?128
	PRINTI ". A road runs east to the top of "
	PRINTD POST-OFFICE
	PRINTR " Hill."

	.FUNCT SOUTH-GATE-F
	CALL THIS-IS-IT,SOUTH-GATE
	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?ENTER /?L3
	EQUAL? PRSA,V?USE \?L1
?L3:	EQUAL? HERE,CREEPY-CORNER \?L4
	CALL DO-WALK,P?EAST
	RTRUE
?L4:	CALL DO-WALK,P?WEST
	RTRUE
?L1:	CALL GENERIC-GATE?,SOUTH-GATE >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT GENERIC-GATE?,GATE
	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L1
	PRINTI "The bars of the"
	CALL OPEN-CLOSED,GATE
	PRINTD GATE
	PRINTR " are 12 feet high, and closely spaced."
?L1:	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-UP,V?LEAP \?L7
	CALL TOO-HIGH,GATE
	RTRUE
?L7:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? GATE,OPENBIT \FALSE
	CALL SAY-THE,GATE
	PRINTR " is too big to close by yourself."

	.FUNCT TOO-HIGH,THING
	PRINTI "The "
	PRINTD THING
	PRINTR " is much too high."

	.FUNCT ENTER-OUTSIDE-COTTAGE
	EQUAL? HERE,ROTARY-SOUTH \?L1
	CALL WAIT-CRY,1
?L1:	SET 'WHERE-FROM,HERE
	ZERO? SKEWED? /?L4
	SET 'DOG-SCRIPT,0
?L4:	RETURN OUTSIDE-COTTAGE

	.FUNCT LIBRARIAN
	CALL THIS-IS-IT,MISS-VOSS
	PRINTD MISS-VOSS
	PRINTI ", the "
	ZERO? SKEWED? /?L3
	PRINTI "former "
?L3:	PRINTI "town librarian"
	RTRUE

	.FUNCT OUTSIDE-COTTAGE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're outside the "
	PRINTD COTTAGE
	PRINTI " of "
	CALL LIBRARIAN
	PRINTI ". The road turns north toward the "
	PRINTD FESTERON
	PRINTI ", and bends upward to the summit of "
	PRINTD POST-OFFICE
	PRINTR " Hill."

	.FUNCT TEETH-OR-FANGS
	ZERO? SKEWED? /?L1
	PRINTI "sharp, bloody fangs"
	RTRUE
?L1:	CALL SHARP-TEETH >STACK
	RSTACK

	.FUNCT SHARP-TEETH
	PRINTI "sharp little teeth"
	RTRUE

	.FUNCT NORTH-PAST-DOG?
	CALL DOG-ONLY-ALLOWS?,ROTARY-SOUTH >STACK
	ZERO? STACK /FALSE
	FSET? ROTARY-SOUTH,TOUCHBIT /?L3
	FSET NORTH-GATE,LOCKEDBIT
	FCLEAR NORTH-GATE,OPENBIT
	MOVE POSTER,INSIDE-POLICE-STATION
?L3:	CALL ENTER-ROTARY-SOUTH >STACK
	RSTACK

	.FUNCT WEST-PAST-DOG?
	CALL DOG-ONLY-ALLOWS?,HILLTOP >STACK
	ZERO? STACK /FALSE
	RETURN HILLTOP

	.FUNCT DOG-ONLY-ALLOWS?,FROM
	ZERO? POODLE-HAPPY? /?L1
	REMOVE BONE
	SET 'POODLE-HAPPY?,0
	CALL DOG-THREATENS
	RTRUE
?L1:	EQUAL? WHERE-FROM,FROM /?L4
	ZERO? HELLHOUND-HAPPY? \?L4
	ZERO? ECLIPSE? /?L3
?L4:	CALL DOG-THREATENS
	RTRUE
?L3:	CALL SAY-THE,POOCH
	PRINTI " won't let you go that way."
	CRLF
	RFALSE

	.FUNCT DOG-THREATENS
	CALL SAY-THE,POOCH
	ZERO? ECLIPSE? /?L1
	PRINTI " howls mournfully in the "
	PRINTD DARKNESS
	PRINTI " as you creep past."
	JUMP ?L6
?L1:	ZERO? HELLHOUND-HAPPY? /?L5
	CALL THUMPS-TAIL
	JUMP ?L6
?L5:	PRINTI " "
	CALL BARK-OR-ROAR
	PRINTI "s a threat as you back away."
?L6:	CRLF
	CRLF
	RTRUE

	.FUNCT THUMPS-TAIL
	PRINTI " thumps its big tail happily as you pass."
	RTRUE

	.FUNCT DESCRIBE-POOCH,CONTEXT
	EQUAL? CONTEXT,M-OBJDESC \FALSE
	FSET? POOCH,TOUCHBIT /?L3
	FSET POOCH,TOUCHBIT
	PRINTI "As you approach the "
	PRINTD COTTAGE
	PRINTI " you are greeted by the "
	ZERO? SKEWED? /?L7
	PRINTI "bigg"
	JUMP ?L11
?L7:	PRINTI "tini"
?L11:	PRINTI "est "
	PRINTD POOCH
	PRINTI " you've ever seen in your entire life. It charges across the street, "
	ZERO? SKEWED? /?L16
	PRINTI "roar"
	JUMP ?L20
?L16:	PRINTI "yapp"
?L20:	PRINTI "ing angrily and showing its "
	CALL TEETH-OR-FANGS
	PRINTI "."
	RTRUE
?L3:	ZERO? ECLIPSE? /?L27
	PRINTI "A "
	PRINTD HELLHOUND
	PRINTI " is hiding its eyes under its paws"
	JUMP ?L36
?L27:	ZERO? HELLHOUND-HAPPY? /?L30
	PRINTI "A happy "
	PRINTD HELLHOUND
	PRINTI " is thumping its tail nearby"
	JUMP ?L36
?L30:	ZERO? POODLE-HAPPY? /?L33
	PRINTI "A tiny "
	PRINTD POODLE
	PRINTI " is gnawing on a bone and watching you"
	JUMP ?L36
?L33:	PRINTI "An angry "
	PRINTD POOCH
	PRINTI " is blocking your path"
?L36:	PRINTI "."
	RTRUE

	.FUNCT CANINE-F,CONTEXT=0
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,POOCH
	PRINTI " is "
	ZERO? ECLIPSE? /?L5
	PRINTI "watching the dark sky anxiously"
	JUMP ?L18
?L5:	ZERO? HELLHOUND-HAPPY? /?L9
	PRINTI "thumping its big tail happily"
	JUMP ?L18
?L9:	ZERO? SKEWED? /?L12
	PRINTI "big enough to eat you whole, and willing to try"
	JUMP ?L18
?L12:	ZERO? POODLE-HAPPY? /?L15
	PRINTI "watching you as it gnaws on the bone"
	JUMP ?L18
?L15:	PRINTI "tiny, mean and "
	FSET? POODLE,RMUNGBIT \?L21
	PRINTI "hungry"
	JUMP ?L25
?L21:	PRINTI "nasty"
?L25:	PRINTI "-looking"
?L18:	PRINTR "."
?L1:	EQUAL? PRSA,V?TAKE \?L32
	EQUAL? PRSO,POOCH \?L32
	CALL SAY-THE,POOCH
	CALL MIGHT-NOT-LIKE
	RTRUE
?L32:	EQUAL? PRSA,V?KISS,V?RUB \?L33
	CALL SAY-THE,POOCH
	ZERO? HELLHOUND-HAPPY? /?L34
	PRINTI " seems to enjoy your attention."
	CRLF
	CALL PRINT-ID,STR?129
	RTRUE
?L34:	PRINTI " would probably chew you up"
	CALL IF-YOU-TRIED
	RTRUE
?L33:	EQUAL? PRSA,V?FEED,V?THROW,V?GIVE \?L41
	EQUAL? PRSI,POOCH,ALEXIS \?L41
	EQUAL? PRSO,BROOM \?L42
	CALL GET-OFF-BROOM-FIRST
?L42:	CALL SAY-THE,POOCH
	ZERO? ECLIPSE? /?L45
	PRINTR " is too uneasy to notice it."
?L45:	PRINTI " tests "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " with its tongue, "
	EQUAL? PRSO,BONE \?L54
	MOVE BONE,OUTSIDE-COTTAGE
	FSET BONE,NDESCBIT
	FCLEAR POODLE,RMUNGBIT
	CALL PRINT-ID,STR?130
	SET 'POODLE-HAPPY?,1
	PRINTI "lies down and begins to gnaw on it, keeping a red eye on you."
	CRLF
	CRLF
	CALL UPDATE-SCORE,3
	RTRUE
?L54:	EQUAL? PRSO,CHOCOLATE,WORM \?L58
	REMOVE PRSO
	PRINTI "gobbles it down greedily"
	JUMP ?L61
?L58:	MOVE PRSO,OUTSIDE-COTTAGE
	PRINTI "drops it on the road"
?L61:	PRINTI " and turns to "
	CALL BARK-OR-ROAR
	PRINTR " at you again."
?L41:	CALL TALKING-TO?,POOCH >STACK
	ZERO? STACK \?L69
	CALL TALKING-TO?,ALEXIS >STACK
	ZERO? STACK \?L69
	EQUAL? PRSA,V?YELL \?L68
?L69:	ZERO? HELLHOUND-HAPPY? /?L70
	CALL SOUND-OF-VOICE
	RETURN 2
?L70:	CALL SAY-THE,POOCH
	PRINTI " growls "
	ZERO? ECLIPSE? /?L77
	PRINTI "uneasi"
	JUMP ?L81
?L77:	PRINTI "dangerous"
?L81:	PRINTI "ly in reply."
	CRLF
	RETURN 2
?L68:	CALL HURT?,POOCH >STACK
	ZERO? STACK \?L90
	EQUAL? PRSA,V?SHAKE,V?CLIMB-UP,V?CLIMB-ON /?L90
	EQUAL? PRSA,V?SQUEEZE \?L88
?L90:	CALL PRINT-ID,STR?131
	ZERO? HELLHOUND-HAPPY? /?L91
	PRINTI "Why"
	CALL DO-TO
	PRINTI "a friendly, obedient "
	PRINTD HELLHOUND
	PRINTR "?"
?L91:	PRINTI "Are you kidding? This "
	PRINTD POOCH
	PRINTR " is MEAN!"
?L88:	EQUAL? PRSA,V?LISTEN \FALSE
	PRINTI "It "
	CALL BARK-OR-ROAR
	PRINTR "s louder."

	.FUNCT ALEXIS-F,CONTEXT=0
	EQUAL? HERE,OUTSIDE-COTTAGE /?L1
	CALL CANT-SEE-ANY,ALEXIS
	RETURN 2
?L1:	EQUAL? CONTEXT,M-WINNER \?L5
	EQUAL? PRSA,V?HEEL \?L6
	PRINTD ALEXIS
	ZERO? HELLHOUND-HAPPY? /?L8
	PRINTI " is already doing that!"
	CRLF
	RETURN 2
?L8:	SET 'HELLHOUND-HAPPY?,1
	CALL INT,I-BARKING >STACK
	PUT STACK,0,0
	SET 'P-HER-OBJECT,HELLHOUND
	PRINTI " pricks up her ears at the sound of her name. She sits obediently at your feet, gently licks "
	PRINTD HANDS
	PRINTI " and thumps her big tail happily."
	CRLF
	CRLF
	CALL UPDATE-SCORE,5
	RETURN 2
?L6:	ZERO? HELLHOUND-HAPPY? /?L15
	CALL SOUND-OF-VOICE
	RETURN 2
?L15:	CALL FOOL-POOCH
	RETURN 2
?L5:	ZERO? NOTE-READ? \?L19
	SET 'P-HER-OBJECT,HELLHOUND
	CALL FOOL-POOCH
	RETURN 2
?L19:	EQUAL? PRSA,V?TELL \?L22
	EQUAL? PRSO,ALEXIS /FALSE
?L22:	CALL CANINE-F,CONTEXT >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT FOOL-POOCH
	CALL SAY-THE,POOCH
	PRINTI " decides that you're only guessing its name, and "
	CALL BARK-OR-ROAR
	PRINTR "s all the louder."

	.FUNCT SOUND-OF-VOICE
	CALL SAY-THE,POOCH
	PRINTR " thumps its tail harder at the sound of your voice."

	.FUNCT BARK-OR-ROAR
	ZERO? ECLIPSE? /?L1
	PRINTI "whimper"
	RTRUE
?L1:	ZERO? HELLHOUND-HAPPY? /?L5
	PRINTI "thump"
	RTRUE
?L5:	ZERO? SKEWED? /?L8
	PRINTI "roar"
	RTRUE
?L8:	PRINTI "yap"
	RTRUE

	.FUNCT I-BARKING
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,OUTSIDE-COTTAGE \FALSE
	ZERO? POODLE-HAPPY? \TRUE
	INC 'DOG-SCRIPT
	INC 'P-HINT
	CALL THIS-IS-IT,POOCH
	CRLF
	ZERO? SKEWED? \?L8
	FSET? POODLE,RMUNGBIT \?L8
	IN? BONE,PROTAGONIST /?L8
	GRTR? P-HINT,8 \?L8
	SET 'DOG-SCRIPT,0
	SET 'P-HINT,0
	PRINTI "("
	CALL PICK-ONE,POODLE-HINTS >STACK
	PRINT STACK
	PRINTR ".)"
?L8:	EQUAL? DOG-SCRIPT,1 \?L12
	PRINTI "You can smell the "
	PRINTD POOCH
	PRINTI "'s hot breath as it "
	CALL BARK-OR-ROAR
	PRINTR "s."
?L12:	EQUAL? DOG-SCRIPT,2 \?L17
	CALL SAY-THE,POOCH
	PRINTR " glares at you through eyes red with hatred."
?L17:	EQUAL? DOG-SCRIPT,3 \?L20
	PRINT YOU-HEAR
	PRINTI "the "
	PRINTD POOCH
	PRINTI "'s "
	CALL TEETH-OR-FANGS
	PRINTI " snapping as it nips your heels."
	CRLF
	CALL PRINT-ID,STR?132 >STACK
	RSTACK
?L20:	EQUAL? DOG-SCRIPT,4 \?L25
	CALL SAY-THE,POOCH
	PRINTI " circles you warily, snarling and growling with menace."
	ZERO? SKEWED? /?L28
	ZERO? LUCKY? \?L28
	PRINTR " It looks as if it's getting ready to attack!"
?L28:	SET 'DOG-SCRIPT,0
	CRLF
	RTRUE
?L25:	PRINTI "With a savage leap, the "
	PRINTD HELLHOUND
	PRINTI " lives up to its bloodthirsty reputation."
	CALL PRINT-ID,STR?133
	CALL BAD-ENDING >STACK
	RSTACK

	.FUNCT COTTAGE-DOOR-F
	CALL SEE-VERB? >STACK
	ZERO? STACK \FALSE
	CALL USE-DOOR?,OUTSIDE-COTTAGE >STACK
	ZERO? STACK \TRUE
	ZERO? HELLHOUND-HAPPY? \FALSE
	ZERO? ECLIPSE? /?L5
	CALL TOO-DARK
	RTRUE
?L5:	CALL WONT-LET-YOU-NEAR
	RTRUE

	.FUNCT ENTER-VOSS?
	FSET? COTTAGE-DOOR,OPENBIT \?L1
	CALL SAY-THE,POOCH
	CALL THUMPS-TAIL
	CRLF
	CRLF
	RETURN INSIDE-COTTAGE
?L1:	ZERO? HELLHOUND-HAPPY? \?L6
	ZERO? ECLIPSE? /?L4
?L6:	CALL ITS-CLOSED,COTTAGE-DOOR
	RFALSE
?L4:	CALL WONT-LET-YOU-NEAR
	RFALSE

	.FUNCT WONT-LET-YOU-NEAR
	CALL SAY-THE,POOCH
	PRINTI " won't let you near the "
	PRINTD COTTAGE
	PRINTR "."

	.FUNCT COTTAGE-F
	CALL ENTER-FROM?,OUTSIDE-COTTAGE,INSIDE-COTTAGE,COTTAGE >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	EQUAL? HERE,INSIDE-COTTAGE \?L4
	CALL V-LOOK
	RTRUE
?L4:	PRINTI "It"
	ZERO? SKEWED? /?L9
	PRINTI " looks as if it was deserted a long time ago"
	JUMP ?L13
?L9:	PRINTI "'s a tidy, happy-looking little place"
?L13:	PRINTR "."

	.FUNCT INSIDE-COTTAGE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is the "
	PRINTD COTTAGE
	PRINTI " of "
	CALL LIBRARIAN
	PRINTR ". The walls are lined with timeworn books and dusty, faded photographs. Looks as if nobody's lived here for a long time."

	.FUNCT DESCRIBE-BOOKCASE,CONTEXT
	EQUAL? CONTEXT,M-OBJDESC \FALSE
	PRINTI "There's a dusty "
	PRINTD BOOKCASE
	FIRST? BOOKCASE >STACK \?L5
	PRINTI " with "
	CALL PRINT-CONTENTS,BOOKCASE
	PRINTI " on it"
?L5:	PRINTI " near the"
	CALL OPEN-CLOSED,COTTAGE-DOOR
	PRINTD HOUSE-DOOR
	PRINTI "."
	FSET? SCRAWL,RMUNGBIT /FALSE
	PRINTI " Somebody has scrawled a message in the dust on the "
	PRINTD BOOKCASE
	PRINTI "."
	RTRUE

	.FUNCT BOOKCASE-F
	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L1
	CALL WASTE-OF-TIME
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINT YOU-SEE
	CALL PRINT-CONTENTS,BOOKCASE
	PRINTI " on the "
	PRINTD BOOKCASE
	FSET? SCRAWL,RMUNGBIT /?L8
	PRINTI ", "
	FIRST? BOOKCASE >STACK \?L12
	PRINTI "and"
	JUMP ?L16
?L12:	PRINTI "except for"
?L16:	PRINTI " a message scrawled on its dusty surface"
?L8:	PRINTR "."
?L3:	CALL HURT?,BOOKCASE >STACK
	ZERO? STACK /?L24
	CALL PRINT-ID,STR?134
	CALL HOW-WOULD-YOU-LIKE-IT,BOOKCASE
	RTRUE
?L24:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTI "It's not that kind of "
	PRINTD BOOKCASE
	PRINTR "."

	.FUNCT LIBRARY-KEY-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	PRINTI "The words ""Witchville Public Library"" are etched into the "
	PRINTD LIBRARY-KEY
	PRINTR "."

	.FUNCT SCRAWL-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	FSET? SCRAWL,RMUNGBIT \?L3
	PRINTI "You rubbed out the "
	PRINTD SCRAWL
	PRINTR "."
?L3:	CALL SAY-THE,SCRAWL
	PRINTI " is enclosed in a heart-shaped outline. It says,"
	CRLF
	CALL FIXED-FONT-ON
	CRLF
	PRINTI "VIOLET + CORKY
     XXXX"
	CRLF
	CALL FIXED-FONT-OFF
	RTRUE
?L1:	CALL HURT?,SCRAWL >STACK
	ZERO? STACK \?L14
	EQUAL? PRSA,V?PUSH,V?PULL,V?MOVE /?L14
	EQUAL? PRSA,V?RUB \?L12
?L14:	CALL PRINT-ID,STR?135
	FSET SCRAWL,RMUNGBIT
	CALL SAY-THE,SCRAWL
	PRINTR " is rubbed out."
?L12:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSI,SCRAWL \FALSE
	PRINT I-ASSUME
	PRINTI " the "
	PRINTD BOOKCASE
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?PUT-ON,PRSO,BOOKCASE
	RTRUE

	.FUNCT BOOKS-F
	EQUAL? PRSA,V?TAKE,V?READ,V?EXAMINE \?L1
	EQUAL? PRSO,BOOKS \?L1
	CALL UNFORTUNATELY
	PRINTR "you don't have time for browsing."
?L1:	CALL HURT?,BOOKS >STACK
	ZERO? STACK /?L5
	CALL HOW-WOULD-YOU-LIKE-IT,BOOKS
	RTRUE
?L5:	CALL YOU-DONT-NEED,BOOKS
	RETURN 2

	.FUNCT ENTER-THEATER?
	ZERO? SKEWED? /?L1
	FSET? TICKET,RMUNGBIT \?L3
	PRINTI """You won't get far without a "
	PRINTD TICKET
	PRINTI "!"" cries "
	PRINTD MISS-VOSS
	PRINTI "."
	CRLF
	CRLF
?L3:	CALL DIGGER-PISSED? >STACK
	ZERO? STACK \FALSE
	CALL ENABLED?,I-FILM >STACK
	ZERO? STACK \?L11
	CALL QUEUE,I-FILM,-1 >STACK
	PUT STACK,0,1
?L11:	CALL THIS-IS-IT,TICKET
	RETURN LOBBY
?L1:	CALL ITS-CLOSED,MOVIE-THEATER
	RFALSE

	.FUNCT DIGGER-PISSED?
	CALL THIS-IS-IT,GRAVEDIGGER
	FSET? GRAVEDIGGER,RMUNGBIT \FALSE
	CALL ENABLED?,I-FILM >STACK
	ZERO? STACK /?L3
	CALL STOP-FILM
?L3:	SET 'NO-MOVIE?,1
	PRINTI "As you appear in the "
	PRINTD GLOBBY
	PRINTI " the "
	PRINTD GRAVEDIGGER
	PRINTI " promptly throws you "
	CALL PRINT-ID,STR?136
	EQUAL? HERE,ROTARY-EAST \?L8
	PRINTI "back"
	JUMP ?L12
?L8:	PRINTI "out"
?L12:	PRINTI " into the street. ""Sneak past me, eh? Scram!"""
	CRLF
	CRLF
	RTRUE

	.FUNCT ROTARY-EAST-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're on the eastern side of the"
	CALL WHICH-TOWN,STR?137
	PRINTI ". A street branches off "
	CALL TO-E >STACK
	PRINT STACK
	PRINTI ", towards the bay.

On the "
	PRINTD CORNER
	PRINTI " nearby stands a "
	ZERO? SKEWED? /?L7
	PRINTI "sleazy"
	JUMP ?L11
?L7:	PRINTI "charming"
?L11:	PRINTI " little "
	PRINTD MOVIE-THEATER
	PRINTI ". Showtimes and admission prices are listed on a "
	PRINTD SCHEDULE
	PRINTI " near the"
	CALL OPEN-CLOSED,ENTRANCE
	PRINTD ENTRANCE
	PRINTI ", and a "
	PRINTD MARQUEE
	PRINTI " announces the current feature."
	ZERO? SKEWED? /?L18
	CRLF
	CRLF
	CALL LIBRARIAN
	PRINTI ", is peering at you suspiciously."
?L18:	CRLF
	RTRUE

	.FUNCT MOVIE-THEATER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It looks like "
	ZERO? SKEWED? /?L5
	PRINTI "it ought to be condemned"
	JUMP ?L9
?L5:	PRINTI "the perfect place to enjoy an old movie"
?L9:	PRINTR "."
?L1:	EQUAL? PRSA,V?SEARCH \?L14
	EQUAL? HERE,INSIDE-THEATER \FALSE
	CALL PERFORM,V?LOOK-UNDER,SEAT
	RTRUE
?L14:	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO \?L18
	EQUAL? HERE,ROTARY-EAST,LOBBY \?L19
	CALL DO-WALK,P?IN
	RTRUE
?L19:	CALL ALREADY-IN,MOVIE-THEATER
	RTRUE
?L18:	EQUAL? PRSA,V?EXIT \?L22
	EQUAL? HERE,LOBBY,INSIDE-THEATER \?L23
	CALL DO-WALK,P?OUT
	RTRUE
?L23:	CALL ALREADY-IN,MOVIE-THEATER,1
	RTRUE
?L22:	EQUAL? PRSA,V?LOOK-INSIDE \?L26
	EQUAL? HERE,ROTARY-EAST \?L27
	FSET? ENTRANCE,OPENBIT \?L29
	CALL GO-INSIDE
	RTRUE
?L29:	CALL ITS-CLOSED,ENTRANCE
	RTRUE
?L27:	CALL V-LOOK
	RTRUE
?L26:	EQUAL? HERE,INSIDE-THEATER \?L33
	ZERO? MOVIE-VISIBLE? /?L33
	CALL IMAGE?,MOVIE-THEATER
	RETURN 2
?L33:	CALL ENTRANCE-F >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT MARQUEE-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	ZERO? SKEWED? /?L3
	CALL FIXED-FONT-ON
	CRLF
	PRINTI "    Now Playing!
THE ONE IS WATCHING!
      starring
    THE EVIL ONE
         in
    Amazing 3-D!"
	CRLF
	CALL FIXED-FONT-OFF
	RTRUE
?L3:	CALL SAY-THE,MARQUEE
	PRINTI " shows an outline of"
	CALL BOSS
	PRINTI ", triumphantly stepping on the face of a helpless mail clerk. Underneath are the words """
	FSET? ENVELOPE,RMUNGBIT \?L12
	PRINTI "Have You Delivered That Envelope Yet?"
	JUMP ?L16
?L12:	PRINTI "You Forgot Something At The "
	PRINTD POST-OFFICE
	PRINTI "!"
?L16:	PRINTR """ in big red letters."
?L1:	CALL HURT?,MARQUEE >STACK
	ZERO? STACK /FALSE
	CALL MUNG-THEATER
	RTRUE

	.FUNCT ENTRANCE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? ENTRANCE,OPENBIT \?L3
	PRINTR "It's open."
?L3:	CALL ITS-CLOSED,ENTRANCE
	RTRUE
?L1:	EQUAL? PRSA,V?OPEN \?L8
	ZERO? SKEWED? /?L9
	CALL ALREADY-OPEN
	RTRUE
?L9:	CALL ITS-CLOSED,ENTRANCE
	RTRUE
?L8:	EQUAL? PRSA,V?CLOSE \?L12
	ZERO? SKEWED? /?L13
	CALL PRINT-ID,STR?138
	CALL MUNG-THEATER
	RTRUE
?L13:	CALL ITS-CLOSED,ENTRANCE
	RTRUE
?L12:	CALL USE-DOOR?,ROTARY-EAST >STACK
	ZERO? STACK \TRUE
	CALL HURT?,ENTRANCE >STACK
	ZERO? STACK /?L17
	CALL PRINT-ID,STR?139
	CALL MUNG-THEATER
	RTRUE
?L17:	CALL YOU-DONT-NEED,ENTRANCE
	RETURN 2

	.FUNCT MUNG-THEATER
	PRINTI "The people who own the "
	PRINTD MOVIE-THEATER
	CALL MIGHT-NOT-LIKE >STACK
	RSTACK

	.FUNCT TICKET-F
	EQUAL? PRSA,V?BUY \?L1
	EQUAL? PRSO,TICKET \?L1
	ZERO? SKEWED? /?L5
	IN? MISS-VOSS,HERE /?L3
?L5:	PRINTR "There's nobody here to sell you one."
?L3:	ZERO? PRSI /?L8
	EQUAL? PRSI,COIN \?L9
	CALL PERFORM,V?GIVE,COIN,MISS-VOSS
	RTRUE
?L9:	CALL NOT-LIKELY,MISS-VOSS,STR?140
	RTRUE
?L8:	CALL HELD?,COIN >STACK
	ZERO? STACK /?L12
	CALL WITH-COIN
	CALL PERFORM,V?GIVE,COIN,MISS-VOSS
	RTRUE
?L12:	CALL NO-MONEY
	RTRUE
?L1:	ZERO? SKEWED? /?L14
	IN? TICKET,MISS-VOSS \?L14
	PRINTI "You'll have to buy one from "
	EQUAL? HERE,ROTARY-EAST \?L17
	PRINTD MISS-VOSS
	JUMP ?L19
?L17:	PRINTI "somebody"
?L19:	PRINTR "."
?L14:	EQUAL? PRSA,V?READ,V?EXAMINE \?L24
	PRINTI "It's an ordinary "
	PRINTD TICKET
	PRINTR ", number 802701."
?L24:	CALL HURT?,TICKET >STACK
	ZERO? STACK /FALSE
	CALL RUIN,TICKET
	RTRUE

	.FUNCT LOBBY-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "in the "
	PRINTD GLOBBY
	PRINTI " of the "
	PRINTD MOVIE-THEATER
	PRINTI ". A short "
	PRINTD CORRIDOR
	PRINTI " leads north into "
	LESS? MOVIE-SCRIPT,6 \?L5
	PRINTD DARKNESS
	PRINTI ". Sound effects and music can be heard drifting down the "
	PRINTD CORRIDOR
	JUMP ?L9
?L5:	PRINTI "silent "
	PRINTD DARKNESS
?L9:	PRINTI "."
	CRLF
	CRLF
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " is standing near the "
	PRINTD CORRIDOR
	PRINTI ", a large cardboard "
	PRINTD CARTON
	PRINTR " at his feet."

	.FUNCT EXIT-LOBBY
	ZERO? ECLIPSE? /?L1
	CALL SAY-THE,GRAVEDIGGER
	CALL DIGGER-STUMBLES
	RFALSE
?L1:	FSET? TICKET,TOOLBIT \?L10
	FSET? GLOBBY,TOUCHBIT \?L10
	CALL SAY-SURE
	PRINTI "leave the "
	PRINTD MOVIE-THEATER
	PRINTI "? The "
	PRINTD GRAVEDIGGER
	PRINTI " might not let you in again without another "
	PRINTD TICKET
	PRINTI "!"
	CALL YES? >STACK
	ZERO? STACK /?L6
	FCLEAR GLOBBY,TOUCHBIT
	SET 'NO-MOVIE?,1
	CALL STOP-FILM
	PRINTI """Come again!"" sneers the "
	PRINTD GRAVEDIGGER
	PRINTI " as you leave."
	CRLF
	CRLF
	RETURN ROTARY-EAST
?L6:	PRINT OKAY
	PRINTI "you're still in the "
	PRINTD GLOBBY
	PRINTI "."
	CRLF
	RFALSE
?L10:	RETURN ROTARY-EAST

	.FUNCT GLOBBY-F
	EQUAL? PRSA,V?THROUGH,V?WALK-TO,V?ENTER \?L1
	EQUAL? HERE,ROTARY-EAST \?L3
	CALL DO-WALK,P?IN
	RTRUE
?L3:	EQUAL? HERE,INSIDE-THEATER \?L5
	CALL DO-WALK,P?OUT
	RTRUE
?L5:	CALL ALREADY-IN,GLOBBY
	RTRUE
?L1:	EQUAL? PRSA,V?LEAVE,V?EXIT \?L7
	EQUAL? HERE,INSIDE-THEATER \?L8
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L8:	EQUAL? HERE,LOBBY \?L10
	CALL V-WALK-AROUND >STACK
	RSTACK
?L10:	CALL ALREADY-IN,GLOBBY,1 >STACK
	RSTACK
?L7:	EQUAL? HERE,LOBBY /?L12
	CALL YOUD-HAVE-TO,STR?141,GLOBBY
	RETURN 2
?L12:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L15
	CALL V-LOOK
	RTRUE
?L15:	CALL YOU-DONT-NEED,GLOBBY
	RETURN 2

	.FUNCT ENTER-AUDITORIUM?
	CALL SAY-THE,GRAVEDIGGER
	ZERO? ECLIPSE? /?L1
	FSET? TICKET,TOOLBIT \?L3
	CALL DIGGER-STUMBLES
	RFALSE
?L3:	PRINTI " cries, ""Don't leave me alone!"""
	FSET GRAVEDIGGER,RMUNGBIT
	JUMP ?L13
?L1:	ZERO? NO-MOVIE? /?L9
	PRINTI " blocks your path. """
	CALL PICK-ONE,NO-ENTERS >STACK
	PRINT STACK
	PRINTI "."""
	CRLF
	CALL PRINT-ID,STR?142
	RFALSE
?L9:	PRINTI " nods as you pass."
?L13:	CRLF
	CRLF
	RETURN INSIDE-THEATER

	.FUNCT DIGGER-STUMBLES
	PRINTR " stumbles into your path. ""Help! It's dark!"""

	.FUNCT CARTON-F
	EQUAL? PRSA,V?LOOK-ON,V?READ,V?EXAMINE \?L1
	PRINTI "The open "
	PRINTD CARTON
	PRINTR " is marked, ""Free 3D Movie Glasses Here!"""
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L5
	FIRST? CARTON >STACK \?L6
	PRINT YOU-SEE
	CALL PRINT-CONTENTS,CARTON
	PRINTI " inside"
	JUMP ?L12
?L6:	PRINTI "It's empty"
?L12:	PRINTI "."
	CRLF
	ZERO? LOOKED-IN-CARTON? \TRUE
	SET 'LOOKED-IN-CARTON?,1
	CRLF
	CALL SAY-THE,GRAVEDIGGER
	PRINTR " sees your disappointment, shrugs and mumbles something unkind about newfangled thingamabobs."
?L5:	EQUAL? PRSA,V?THROW,V?PUT \?L22
	EQUAL? PRSI,CARTON \?L22
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,10 \?L23
	CALL TOO-LARGE,PRSO
	RTRUE
?L23:	EQUAL? PRSO,TICKET \?L25
	CALL PERFORM,V?GIVE,TICKET,GRAVEDIGGER
	RTRUE
?L25:	CALL SAY-THE,GRAVEDIGGER
	PRINTI " pulls "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " out of the "
	PRINTD CARTON
	PRINTR " and hands it back to you. ""Keep it,"" he mutters."
?L22:	CALL HURT?,CARTON >STACK
	ZERO? STACK \?L32
	EQUAL? PRSA,V?TAKE \?L31
	EQUAL? PRSO,CARTON \?L31
?L32:	CALL SAY-THE,GRAVEDIGGER
	CALL MIGHT-NOT-LIKE
	RTRUE
?L31:	EQUAL? PRSA,V?CLOSE \FALSE
	PRINTR "There's no lid."

	.FUNCT SCHEDULE-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	CALL SAY-THE,SCHEDULE
	PRINTI " says:"
	CRLF
	CRLF
	CALL FIXED-FONT-ON
	ZERO? SKEWED? /?L5
	PRINTI "    OPEN ALL NIGHT!"
	JUMP ?L9
?L5:	PRINTI "   EVENINGS AT 7 & 9"
?L9:	CRLF
	PRINTI "ALL SHOWS ONE GOLD COIN"
	CRLF
	CALL FIXED-FONT-OFF
	RTRUE
?L1:	CALL HURT?,SCHEDULE >STACK
	ZERO? STACK /FALSE
	CALL PRINT-ID,STR?143
	CALL MUNG-THEATER
	RTRUE

	.FUNCT INSIDE-THEATER-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is a "
	PRINTD MOVIE-THEATER
	PRINTI " unlike any you've ever seen! The seats are wide, deep and comfortable. The aisles are spotless. The air is clear of smoke, and the screen is dramatically large. A chill goes up your spine as you realize how alien your universe has become."
	CRLF
	CRLF
	EQUAL? MOVIE-SCRIPT,6 /?L7
	ZERO? ECLIPSE? /?L5
?L7:	CALL SAY-THE,MOVIE-THEATER
	PRINTI " screen is dark and silent"
	JUMP ?L10
?L5:	PRINTI "There's a noisy movie playing on the screen"
?L10:	PRINTI ". A dark "
	PRINTD CORRIDOR
	PRINTI " leads out to the "
	PRINTD GLOBBY
	PRINTR "."

	.FUNCT SEAT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "They look really comfortable."
?L1:	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE \?L5
	FSET? SEAT,TOOLBIT \?L5
	CALL ALREADY-IN,SEAT
	RTRUE
?L5:	EQUAL? PRSA,V?ENTER,V?CLIMB-ON,V?SIT \?L6
	FSET? SEAT,TOOLBIT \?L7
	CALL ALREADY-IN,SEAT
	RTRUE
?L7:	FIRST? SEAT >STACK \?L9
	PRINTR "You'll have to clear it off first."
?L9:	FSET SEAT,TOOLBIT
	PRINTR "Done. The seat is even more comfortable than it looks."
?L6:	EQUAL? PRSA,V?TAKE-OFF,V?EXIT,V?STAND \?L15
	FSET? SEAT,TOOLBIT \?L16
	FCLEAR SEAT,TOOLBIT
	PRINTR "With a reluctant sigh, you rise from the comfortable seat."
?L16:	PRINTR "But you're already standing!"
?L15:	EQUAL? PRSA,V?SEARCH,V?LOOK-UNDER \?L23
	FSET? GLASSES,RMUNGBIT \?L24
	FCLEAR GLASSES,RMUNGBIT
	MOVE GLASSES,INSIDE-THEATER
?L24:	FSET? GLASSES,TOUCHBIT /FALSE
	PRINTI "Hmm. This place isn't completely spotless. You just discovered a used "
	PRINTD GLASSES
	PRINTR " under a seat."
?L23:	CALL HURT?,SEAT >STACK
	ZERO? STACK \?L33
	EQUAL? PRSA,V?LIE-DOWN,V?STAND-ON \FALSE
?L33:	CALL MUNG-THEATER
	RTRUE

	.FUNCT AISLE-F
	CALL GROUND-F >STACK
	ZERO? STACK \TRUE
	CALL YOU-DONT-NEED,AISLE
	RETURN 2

	.FUNCT EXIT-AUDITORIUM?
	FSET? SEAT,TOOLBIT \?L1
	CALL YOUD-HAVE-TO,STR?144,SEAT
	RFALSE
?L1:	IN? GLASSES,PROTAGONIST \?L3
	FSET? GLASSES,WORNBIT \?L3
	SET 'FUZZY-FROM,LOBBY
	SET 'FUZZY?,1
	RETURN FUZZY
?L3:	CALL DIGGER-PISSED? >STACK
	ZERO? STACK /?L4
	RETURN ROTARY-EAST
?L4:	RETURN LOBBY

	.FUNCT CHEAP-GLASSES
	PRINTR " a cheap pair of sunglasses."

	.FUNCT GLASSES-F
	CALL THIS-IS-IT,GLASSES
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "They resemble"
	CALL CHEAP-GLASSES
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L5
	CALL DONT-HAVE?,GLASSES >STACK
	ZERO? STACK \TRUE
	PRINTI "It's like peering through"
	CALL CHEAP-GLASSES
	RTRUE
?L5:	EQUAL? PRSA,V?LOOK-THRU \?L11
	EQUAL? PRSI,GLASSES \?L11
	CALL DONT-HAVE?,GLASSES >STACK
	ZERO? STACK \TRUE
	FSET? GLASSES,WORNBIT /?L14
	CALL YOUD-HAVE-TO,STR?145,GLASSES
	RTRUE
?L14:	CALL PERFORM,V?EXAMINE,PRSO
	RTRUE
?L11:	EQUAL? PRSA,V?FIND \FALSE
	EQUAL? HERE,LOBBY,INSIDE-THEATER \FALSE
	FSET? GLASSES,RMUNGBIT \FALSE
	PRINTR "You don't see any here. But somebody may have dropped a pair nearby."

	.FUNCT BLANK-SCREEN
	CALL SAY-THE,SCREEN
	PRINTR " is blank and silent."

	.FUNCT SCREEN-F
	EQUAL? PRSA,V?LISTEN \?L1
	CALL PERFORM,V?LISTEN,SOUND
	RTRUE
?L1:	EQUAL? HERE,LOBBY \?L3
	CALL CANT-SEE-ANY
	RETURN 2
?L3:	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L6
	CALL ENABLED?,I-FILM >STACK
	ZERO? STACK \?L7
	CALL BLANK-SCREEN
?L7:	SET 'NO-CR?,1
	RTRUE
?L6:	CALL HURT?,SCREEN >STACK
	ZERO? STACK /FALSE
	CALL MUNG-THEATER
	RTRUE

	.FUNCT I-FILM
	EQUAL? HERE,INSIDE-THEATER \FALSE
	FSET? GLASSES,WORNBIT \?L3
	INC 'MOVIE-SCRIPT
	ZERO? NO-CR? /?L5
	SET 'NO-CR?,0
	JUMP ?L7
?L5:	CRLF
?L7:	SET 'MOVIE-VISIBLE?,1
	EQUAL? MOVIE-SCRIPT,1 \?L8
	MOVE SCOPE,HERE
	FCLEAR SCOPE,TRYTAKEBIT
	MOVE CHEMICALS,HERE
	FCLEAR CHEMICALS,TRYTAKEBIT
	MOVE EVIL-ONE,HERE
	FCLEAR EVIL-ONE,ACTORBIT
	CALL SAY-THE,SCREEN
	PRINTI " shows an evil woman squinting through an "
	PRINTD SCOPE
	PRINTI ". A laboratory full of bubbling 3D "
	PRINTD CHEMICALS
	PRINTI " is visible in the back"
	PRINTD GROUND
	JUMP ?L24
?L8:	EQUAL? MOVIE-SCRIPT,2 \?L12
	MOVE VULTURE,INSIDE-THEATER
	FCLEAR VULTURE,ACTORBIT
	FCLEAR VULTURE,TRYTAKEBIT
	PRINTI "A 3D "
	PRINTD VULTURE
	PRINTI " lands on the woman's shoulder and croaks a secret into her ear. An evil eyebrow rises slowly as she listens"
	JUMP ?L24
?L12:	EQUAL? MOVIE-SCRIPT,3 \?L15
	CALL SAY-THE,OLD-WOMAN
	PRINTI " swings the 3D "
	PRINTD SCOPE
	PRINTI " around (narrowly missing your nose) and peers into it again. A point-of-view shot reveals what the 'scope is focused on: a small "
	PRINTD MOVIE-THEATER
	PRINTI ", remarkably similar to the one you're in right now"
	JUMP ?L24
?L15:	EQUAL? MOVIE-SCRIPT,4 \?L18
	MOVE MISS-VOSS,INSIDE-THEATER
	FCLEAR MISS-VOSS,ACTORBIT
	CALL SAY-THE,SCOPE
	PRINTI " zooms in on the "
	PRINTD ENTRANCE
	PRINTI " to the "
	PRINTD MOVIE-THEATER
	PRINTI ". A dead ringer for "
	PRINTD MISS-VOSS
	PRINTI " looks up and waves timidly at the camera"
	JUMP ?L24
?L18:	EQUAL? MOVIE-SCRIPT,5 \?L21
	MOVE MISS-VOSS,ROTARY-EAST
	FSET MISS-VOSS,ACTORBIT
	MOVE PANEL,HERE
	FCLEAR PANEL,TRYTAKEBIT
	MOVE SW2,HERE
	FCLEAR SW2,TRYTAKEBIT
	MOVE SW1,HERE
	FCLEAR SW1,TRYTAKEBIT
	MOVE KITTY,HERE
	FSET KITTY,NDESCBIT
	FCLEAR KITTY,ACTORBIT
	FCLEAR KITTY,TAKEBIT
	PUTP KITTY,P?DESCFCN,0
	CALL SAY-THE,OLD-WOMAN
	PRINTI " stalks across the lab to a panel of heavy-duty power switches. As the camera follows, you catch a fleeting 3D glimpse of a "
	PRINTD KITTY
	PRINTI " sleeping in the "
	PRINTD CORNER
	PRINTI " of the lab"
	JUMP ?L24
?L21:	EQUAL? MOVIE-SCRIPT,6 \?L24
	CALL STOP-FILM
	FSET SW1,OPENBIT
	CALL SAY-THE,OLD-WOMAN
	PRINTI " selects a power switch labeled ""Palace Theater"" and opens it with a diabolical cackle. A 3D arc of electricity leaps from the screen, and a shower of sparks seems to engulf the "
	PRINTD MOVIE-THEATER
	PRINTI "...

Poof! The image on the screen goes black. The soundtrack slowly grinds to a halt"
?L24:	PRINTR "."
?L3:	SET 'MOVIE-VISIBLE?,0
	CRLF
	CALL PICK-ONE,FUZZIES >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT STOP-FILM
	FCLEAR INSIDE-THEATER,ONBIT
	CALL INT,I-FILM >STACK
	PUT STACK,0,0
	SET 'MOVIE-VISIBLE?,0
	IN? VULTURE,INSIDE-THEATER \?L1
	FSET VULTURE,ACTORBIT
	FSET VULTURE,TRYTAKEBIT
	REMOVE VULTURE
?L1:	IN? MISS-VOSS,INSIDE-THEATER \?L4
	FSET MISS-VOSS,ACTORBIT
	MOVE MISS-VOSS,ROTARY-EAST
?L4:	IN? KITTY,INSIDE-THEATER \?L7
	MOVE KITTY,LABORATORY
	FSET KITTY,ACTORBIT
	FSET KITTY,TAKEBIT
	FCLEAR KITTY,NDESCBIT
	PUTP KITTY,P?DESCFCN,DESCRIBE-KITTY
	MOVE PANEL,LABORATORY
	FSET PANEL,TRYTAKEBIT
	MOVE SW2,LABORATORY
	FSET SW2,TRYTAKEBIT
	MOVE SW1,LABORATORY
	FSET SW1,TRYTAKEBIT
?L7:	MOVE CHEMICALS,LABORATORY
	FSET CHEMICALS,TRYTAKEBIT
	REMOVE EVIL-ONE
	FSET EVIL-ONE,ACTORBIT
	MOVE SCOPE,LABORATORY
	FSET SCOPE,TRYTAKEBIT
	RTRUE

	.FUNCT PARK-F,CONTEXT=0
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "in a circular park, surrounded by the"
	CALL WHICH-TOWN,STR?137
	PRINTI ". Walks converge from four directions on a "
	ZERO? SKEWED? /?L7
	PRINTI "neglected"
	JUMP ?L11
?L7:	PRINTI "shallow"
?L11:	PRINTI " marble "
	PRINTD FOUNTAIN
	PRINTI ", filled with "
	ZERO? SKEWED? /?L16
	PRINTI "greasy"
	JUMP ?L20
?L16:	PRINTI "sparkling"
?L20:	PRINTI " water.

A "
	PRINTD STATUE
	PRINTI " stands in the middle of the "
	PRINTD FOUNTAIN
	PRINTR "."

	.FUNCT FOUNTAIN-F
	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L1
	PRINTI "You'd get soaked"
	CALL IF-YOU-TRIED
	RTRUE
?L1:	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT \?L5
	EQUAL? PRSI,FOUNTAIN \?L5
	ZERO? SKEWED? /?L6
	CALL PERFORM,V?GIVE,PRSO,PIRANHA
	RTRUE
?L6:	CALL PERFORM,V?GIVE,PRSO,GOLDFISH
	RTRUE
?L5:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L9
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L9:	EQUAL? PRSA,V?TASTE,V?DRINK \FALSE
	CALL PRINT-ID,STR?146
	CALL WATER-DIRTY
	RTRUE

	.FUNCT IN-FOUNTAIN,CONTEXT
	EQUAL? CONTEXT,M-CONT \FALSE
	ZERO? SKEWED? /FALSE
	EQUAL? PRSO,PIRANHA /FALSE
	EQUAL? PRSA,V?TAKE /?L3
	CALL TOUCHING?,PRSO >STACK
	ZERO? STACK /FALSE
?L3:	FSET? PIRANHA,RMUNGBIT \?L4
	CALL SNAPPY
	RTRUE
?L4:	EQUAL? PRSO,BOTTLE \FALSE
	CALL SNAPPY
	SET 'PIRANHA-SCRIPT,1
	CALL I-PIRANHA-SNACK >STACK
	RSTACK

	.FUNCT SNAPPY
	CALL SAY-THE,PIRANHA
	PRINTI " "
	CALL PICK-ONE,NIPS >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT COIN-F
	IN? COIN,TROLL \?L1
	PRINT CANT
	PRINTI ". "
	CALL SAY-THE,TROLL
	PRINTI " has it."
	CRLF
	RETURN 2
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL SAY-THE,COIN
	PRINTI " is etched with a"
	CALL SAY-PROFILE
	PRINTR "."

	.FUNCT SAY-PROFILE
	PRINTI " profile of "
	CALL FATHERS >STACK
	RSTACK

	.FUNCT FATHERS
	PRINTI "one of Festeron's founding fathers"
	RTRUE

	.FUNCT GFISH-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,PRSO
	ZERO? SKEWED? /?L3
	PRINTI " stares back at you defiantly"
	ZERO? ECLIPSE? \?L14
	PRINTI ", its "
	CALL SHARP-TEETH
	PRINTI " gleaming in the moonlight"
	JUMP ?L14
?L3:	PRINTI " swims shyly away as you stare at it"
?L14:	PRINTR "."
?L1:	EQUAL? PRSA,V?TAKE \?L19
	EQUAL? PRSO,GOLDFISH,PIRANHA \?L19
	CALL SAY-THE,PRSO
	ZERO? SKEWED? /?L20
	PRINTI " would probably bite off one of your fingers"
	CALL PRINT-ID,STR?147
	CALL IF-YOU-TRIED
	RTRUE
?L20:	PRINTI " quickly swims out of reach."
	CRLF
	CALL PRINT-ID,STR?148
	RTRUE
?L19:	EQUAL? PRSA,V?FEED,V?THROW,V?GIVE /?L28
	EQUAL? PRSA,V?SWING \?L27
?L28:	EQUAL? PRSI,GOLDFISH,PIRANHA \?L27
	EQUAL? PRSO,BROOM \?L29
	CALL GET-OFF-BROOM-FIRST
?L29:	MOVE PRSO,FOUNTAIN
	PRINTI "It lands in the "
	PRINTD FOUNTAIN
	PRINTI " with a splash"
	ZERO? SKEWED? \?L34
	PRINTI ", but the "
	PRINTD GOLDFISH
	PRINTI " isn't interested"
	CALL IS-LIGHT-OBJECT? >STACK
	ZERO? STACK \?L38
	PUSH 1
	JUMP ?L39
?L38:	PUSH 0
?L39:	CALL PRINT-ID,STR?149,STACK
	JUMP ?L50
?L34:	FSET? PIRANHA,RMUNGBIT /?L40
	PRINTI ", but the "
	PRINTD PIRANHA
	PRINTI " is too busy eating to notice"
	CALL IS-LIGHT-OBJECT? >STACK
	ZERO? STACK \?L43
	PUSH 1
	JUMP ?L44
?L43:	PUSH 0
?L44:	CALL PRINT-ID,STR?150,STACK
	JUMP ?L50
?L40:	EQUAL? PRSO,WORM \?L45
	FCLEAR PIRANHA,RMUNGBIT
	MOVE WORM,STEEP-TRAIL
	CALL QUEUE,I-PIRANHA-SNACK,-1 >STACK
	PUT STACK,0,1
	PRINTI "."
	CRLF
	CRLF
	CALL SAY-THE,PIRANHA
	PRINTI " snatches away the worm and swims to the far side of the "
	PRINTD FOUNTAIN
	PRINTI " to devour it"
	CALL PRINT-ID,STR?151
	JUMP ?L50
?L45:	PRINTI ". "
	CALL UNFORTUNATELY
	PRINTI "the "
	PRINTD PIRANHA
	PRINTI " isn't as interested in "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " as it is in biting your fingers"
	CALL IS-LIGHT-OBJECT? >STACK
	ZERO? STACK \?L57
	PUSH 1
	JUMP ?L58
?L57:	PUSH 0
?L58:	CALL PRINT-ID,STR?152,STACK
?L50:	PRINTR "."
?L27:	CALL TOUCHING?,PRSO >STACK
	ZERO? STACK /?L61
	CALL SAY-THE,PRSO
	PRINTI " won't let you near."
	CRLF
	CALL PRINT-ID,STR?153,SKEWED?
	RTRUE
?L61:	CALL TALKING-TO?,PRSO >STACK
	ZERO? STACK \?L65
	EQUAL? PRSA,V?YELL \?L64
?L65:	CALL SAY-THE,PRSO
	PRINTI " gurgles "
	ZERO? SKEWED? /?L68
	PRINTI "threatening"
	JUMP ?L72
?L68:	PRINTI "shy"
?L72:	PRINTI "ly."
	CRLF
	RETURN 2
?L64:	EQUAL? PRSA,V?TASTE,V?DRINK,V?EAT \FALSE
	CALL PRINT-ID,STR?154
	CALL YOUD-HAVE-TO,STR?155,PRSO
	RTRUE

	.FUNCT I-PIRANHA-SNACK
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	DEC 'PIRANHA-SCRIPT
	ZERO? PIRANHA-SCRIPT \FALSE
	FSET PIRANHA,RMUNGBIT
	EQUAL? HERE,PARK \?L7
	CRLF
	CALL SAY-THE,PIRANHA
	PRINTI " in the "
	PRINTD FOUNTAIN
	PRINTI " is watching you hungrily."
	CRLF
?L7:	CALL INT,I-PIRANHA-SNACK >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT STATUE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,STATUE
	PRINTI " is a heroic commemoration of "
	ZERO? SKEWED? /?L5
	PRINTI "a very evil-looking "
	PRINTD OLD-WOMAN
	JUMP ?L9
?L5:	CALL FATHERS
	PRINTI ", dressed in a fancy military uniform"
?L9:	PRINTR "."
?L1:	CALL GETTING-INTO? >STACK
	ZERO? STACK \?L15
	CALL TOUCHING?,STATUE >STACK
	ZERO? STACK /FALSE
?L15:	PRINTI "You'd get soaked in the "
	PRINTD FOUNTAIN
	CALL PRINT-ID,STR?156
	CALL IF-YOU-TRIED
	RTRUE

	.FUNCT FESTERON-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL IN-VILLAGE? >STACK
	ZERO? STACK \TRUE
	EQUAL? HERE,HILLTOP,LOOKOUT-HILL,LABORATORY \?L5
	CALL TOWN-TOO-FAR
	RTRUE
?L5:	EQUAL? HERE,CLIFF-EDGE \?L6
	ZERO? SKEWED? /?L9
	ZERO? SUCCESS? /?L7
?L9:	CALL TOWN-TOO-FAR
	RTRUE
?L7:	CALL BUT-THE,FESTERON
	PRINTR "is covered with fog!"
?L6:	PRINT CANT
	PRINTI " see the "
	PRINTD FESTERON
	PRINTR " from here."
?L1:	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO \?L16
	CALL IN-VILLAGE? >STACK
	ZERO? STACK \TRUE
	CALL REFER-TO-MAP
	RTRUE
?L16:	EQUAL? PRSA,V?EXIT \FALSE
	CALL V-WALK-AROUND
	RTRUE

	.FUNCT IN-VILLAGE?
	EQUAL? HERE,ROTARY-NORTH,ROTARY-SOUTH,PARK /?L3
	EQUAL? HERE,ROTARY-EAST,ROTARY-WEST \FALSE
?L3:	CALL ALREADY-IN,FESTERON
	RTRUE

	.FUNCT TOWN-TOO-FAR
	CALL SAY-THE,FESTERON
	PRINTR " is too far away to make out much detail."

	.FUNCT ROTARY-WEST-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're on the west side of the"
	CALL WHICH-TOWN,STR?137
	PRINTI ". A street branches west, towards the lake.

The "
	PRINTD INSIDE-POLICE-STATION
	PRINTI " stands on a nearby "
	PRINTD CORNER
	PRINTI ". It's a "
	ZERO? SKEWED? /?L7
	PRINTI "grim"
	JUMP ?L11
?L7:	PRINTI "modest"
?L11:	PRINTI " little building with a sign over the"
	CALL OPEN-CLOSED,POLICE-DOOR
	PRINTD ENTRANCE
	PRINTR "."

	.FUNCT ENTER-POLICE-STATION
	FSET? POLICE-DOOR,OPENBIT \?L1
	ZERO? MACGUFFIN-SCRIPT \?L7
	ZERO? SKEWED? /?L5
	CALL QUEUE,I-NASTY-MACGUFFIN,-1 >STACK
	PUT STACK,0,1
	RETURN INSIDE-POLICE-STATION
?L5:	CALL QUEUE,I-DULL-MACGUFFIN,-1 >STACK
	PUT STACK,0,1
?L7:	RETURN INSIDE-POLICE-STATION
?L1:	CALL ITS-CLOSED,POLICE-DOOR
	RFALSE

	.FUNCT POLICE-STATION-F
	CALL ENTER-FROM?,ROTARY-WEST,INSIDE-POLICE-STATION,POLICE-STATION >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L3
	CALL V-LOOK
	RTRUE
?L3:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	EQUAL? HERE,ROTARY-WEST \?L5
	CALL GO-INSIDE
	RTRUE
?L5:	CALL V-LOOK
	RTRUE

	.FUNCT POLICE-DOOR-F
	EQUAL? PRSA,V?EXAMINE,V?LOOK-ON,V?READ \?L1
	EQUAL? HERE,ROTARY-WEST \?L1
	CALL PERFORM,V?EXAMINE,SIGN
	RTRUE
?L1:	CALL USE-DOOR?,ROTARY-WEST >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT EXIT-STATION?
	FSET? POLICE-DOOR,OPENBIT \?L1
	ZERO? SKEWED? /?L3
	SET 'MACGUFFIN-SCRIPT,1
?L3:	RETURN ROTARY-WEST
?L1:	CALL ITS-CLOSED,POLICE-DOOR
	RFALSE

	.FUNCT INSIDE-POLICE-STATION-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're in the front office of the"
	CALL WHICH-TOWN
	PRINTI " "
	PRINTD INSIDE-POLICE-STATION
	PRINTI ". "
	ZERO? SKEWED? /?L7
	PRINTI "The room is lined with dimly-lit jail cells. Occasional wails of anguish suggest that many of the cells are occupied"
	JUMP ?L11
?L7:	PRINTI "A modest jail cell is visible in a "
	PRINTD CORNER
	PRINTI " of the room"
?L11:	PRINTI "."
	CRLF
	CRLF
	PRINTD MACGUFFIN
	ZERO? SKEWED? /?L16
	PRINTI ", Witchville's finest, is glaring down at you from behind an intimidatingly high desk"
	JUMP ?L20
?L16:	PRINTI ", Festeron's finest, is "
	GRTR? MACGUFFIN-SCRIPT,3 \?L23
	PRINTI "sound asleep"
	JUMP ?L27
?L23:	PRINTI "nodding off"
?L27:	PRINTI " behind a desk"
?L20:	PRINTI ". "
	PRINT YOU-SEE
	FIRST? DESK >STACK \?L34
	CALL PRINT-CONTENTS,DESK
	PRINTI " on the desk, and "
?L34:	PRINTI "a "
	PRINTD POSTER
	PRINTR " taped to the wall."

	.FUNCT DESK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL PERFORM,V?LOOK-ON,DESK
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \?L3
	EQUAL? PRSI,DESK \?L3
	CALL PRINT-ID,STR?157
	CALL ITS-CLOSED,DESK
	RTRUE
?L3:	EQUAL? PRSA,V?LOOK-BEHIND \?L4
	CALL PERFORM,V?EXAMINE,MACGUFFIN
	RTRUE
?L4:	EQUAL? PRSA,V?LOOK-INSIDE,V?SEARCH,V?OPEN /?L6
	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L5
?L6:	CALL NOT-LIKELY,MACGUFFIN,STR?158
	CALL PRINT-ID,STR?159
	RTRUE
?L5:	EQUAL? PRSA,V?CLOSE \FALSE
	CALL ALREADY-CLOSED
	RTRUE

	.FUNCT RADIO-F
	CALL HURT?,RADIO >STACK
	ZERO? STACK \?L3
	EQUAL? PRSA,V?TAKE \?L1
?L3:	PRINTD MACGUFFIN
	CALL PRINT-ID,STR?160
	CALL MIGHT-NOT-LIKE
	RTRUE
?L1:	CALL SEE-VERB? >STACK
	ZERO? STACK \?L5
	CALL TOUCHING?,RADIO >STACK
	ZERO? STACK /?L4
?L5:	CALL SAY-THE,RADIO
	PRINTI " is hidden behind "
	PRINTD MACGUFFIN
	PRINTR "'s desk."
?L4:	EQUAL? PRSA,V?LISTEN \?L8
	PRINTI "It emits"
	CALL STATIC
	PRINTR "."
?L8:	CALL YOU-DONT-NEED,RADIO
	RETURN 2

	.FUNCT CHOCOLATE-F
	EQUAL? PRSA,V?TAKE \?L1
	EQUAL? PRSO,CHOCOLATE \?L1
	IN? CHOCOLATE,DESK \?L1
	LESS? MACGUFFIN-SCRIPT,4 \?L1
	SET 'MACGUFFIN-SCRIPT,1
	PRINTI """Hands off,"" "
	PRINTD MACGUFFIN
	PRINTI " growls sleepily."
	CRLF
	CALL PRINT-ID,STR?161
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	FSET CHOCOLATE,TOOLBIT
	PRINTI "You share "
	PRINTD MACGUFFIN
	PRINTR "'s passion for fine chocolate. Looking at this creamy piece is making your mouth water. Only your iron will is stopping you from eating it right now."
?L5:	EQUAL? PRSA,V?EAT \?L8
	CALL EAT-CHOCOLATE? >STACK
	ZERO? STACK /TRUE
	PRINTI "Gulp! "
	FSET? CHOCOLATE,TOOLBIT \?L13
	PRINTI "So much for your iron will"
	JUMP ?L17
?L13:	PRINTI "It's gone"
?L17:	PRINTR "."
?L8:	EQUAL? PRSA,V?BITE,V?TASTE \?L23
	CALL EAT-CHOCOLATE? >STACK
	ZERO? STACK /TRUE
	PRINTI "The taste makes you hungry for more."
	CALL HISTORY
	RTRUE
?L23:	EQUAL? PRSA,V?DRINK \?L29
	CALL NOT-LIQUID
	RTRUE
?L29:	EQUAL? PRSA,V?GIVE \?L30
	EQUAL? CHOCOLATE,PRSO \?L30
	FSET? PRSI,ACTORBIT \?L30
	REMOVE CHOCOLATE
	PRINTI "Eagerly, "
	CALL ARTICLE,PRSI,1
	PRINTD PRSI
	PRINTI " accepts the "
	PRINTD CHOCOLATE
	PRINTI "."
	CALL PRINT-ID,STR?162
	CALL HISTORY
	RTRUE
?L30:	EQUAL? PRSA,V?PUT-ON \FALSE
	EQUAL? PRSI,DESK \FALSE
	ZERO? SKEWED? /FALSE
	CALL PERFORM,V?GIVE,CHOCOLATE,MACGUFFIN
	RTRUE

	.FUNCT HISTORY
	PRINTR " In a few moments, the candy is history."

	.FUNCT EAT-CHOCOLATE?
	CALL DONT-HAVE?,CHOCOLATE >STACK
	ZERO? STACK \FALSE
	REMOVE CHOCOLATE
	SET 'CHOCOLATE-SCRIPT,3
	CALL QUEUE,I-DIGEST-CHOCOLATE,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT I-DIGEST-CHOCOLATE
	DEC 'CHOCOLATE-SCRIPT
	CRLF
	PRINTI "(The "
	EQUAL? CHOCOLATE-SCRIPT,2 \?L3
	PRINTD CHOCOLATE
	PRINTI " is melting in your mouth."
	ZERO? SKEWED? /?L7
	CALL MAKE-IT-SNAPPY
	CRLF
	RTRUE
?L7:	PRINTR ")"
?L3:	EQUAL? CHOCOLATE-SCRIPT,1 \?L12
	CALL C-TASTE
	PRINTI "almost gone."
	ZERO? SKEWED? /?L15
	CALL HOLD-YOUR-PEACE
	CRLF
	RTRUE
?L15:	PRINTR ")"
?L12:	SET 'CHOCOLATE-SCRIPT,0
	CALL INT,I-DIGEST-CHOCOLATE >STACK
	PUT STACK,0,0
	CALL C-TASTE
	PRINTR "gone. Sure was great while it lasted.)"

	.FUNCT C-TASTE
	PRINTI "chocolate taste in your mouth is "
	RTRUE

	.FUNCT TO-NORTH
	CALL WAIT-CRY
	RETURN PARK

	.FUNCT TO-EAST
	CALL WAIT-CRY
	RETURN ROTARY-EAST

	.FUNCT TO-WEST
	CALL WAIT-CRY
	RETURN ROTARY-WEST

	.FUNCT WAIT-CRY,GOING-SOUTH?=0
	IN? MISS-VOSS,ROTARY-SOUTH \FALSE
	ZERO? NOTE-GIVEN? /?L3
	CALL VOSS-HURRIES-AWAY
	JUMP ?L5
?L3:	PRINTI """"
	IN? VIOLET-NOTE,MISS-VOSS \?L8
	ZERO? GOING-SOUTH? \?L8
	CALL VOSS-LEAVES
	PRINT OKAY
	PRINTI "never mind!"" shrug"
	JUMP ?L12
?L8:	PRINTI "Wait! I want to talk to you!"" crie"
?L12:	PRINTI "s "
	PRINTD MISS-VOSS
	PRINTI " as you walk away."
?L5:	CRLF
	CRLF
	RTRUE

	.FUNCT ENTER-LIBRARY?
	FSET? LIBRARY-DOOR,OPENBIT \?L1
	CALL ENABLED?,I-SLAM-DOOR >STACK
	ZERO? STACK \?L3
	CALL START-BUZZ,7
	SET 'CRISP-SCRIPT,2
	CALL QUEUE,I-SLAM-DOOR,-1 >STACK
	PUT STACK,0,1
?L3:	RETURN CIRCULATION-DESK
?L1:	CALL ITS-CLOSED,LIBRARY-DOOR
	CALL VOSS-EXCUSE
	RFALSE

	.FUNCT VOSS-EXCUSE
	EQUAL? HERE,ROTARY-SOUTH \FALSE
	IN? MISS-VOSS,HERE \FALSE
	CRLF
	PRINTI """I leave early on Fridays,"" explains "
	PRINTD MISS-VOSS
	PRINTR "."

	.FUNCT I-SLAM-DOOR
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,CIRCULATION-DESK \FALSE
	DEC 'CRISP-SCRIPT
	ZERO? CRISP-SCRIPT \TRUE
	CALL INT,I-SLAM-DOOR >STACK
	PUT STACK,0,0
	CRLF
	FSET? LIBRARY-DOOR,OPENBIT \?L8
	PRINTI "Bang! The "
	PRINTD LIBRARY-DOOR
	PRINTI " slams shut. "
?L8:	PRINTI "You hear a faint ""click"" as somebody locks "
	FSET? LIBRARY-DOOR,OPENBIT \?L15
	FCLEAR LIBRARY-DOOR,OPENBIT
	FCLEAR CIRCULATION-DESK,ONBIT
	PRINTI "it"
	JUMP ?L19
?L15:	PRINTI "the "
	PRINTD LIBRARY-DOOR
?L19:	PRINTI " from the outside."
	CRLF
	FSET LIBRARY-DOOR,LOCKEDBIT
	CALL VISIBLE?,CANDLE >STACK
	ZERO? STACK /?L24
	FSET? CANDLE,ONBIT \?L24
	FCLEAR CANDLE,ONBIT
	FSET CANDLE,RMUNGBIT
	CRLF
	CALL SAY-THE,CANDLE
	PRINTI " flares brightly, and then fizzles out."
	CRLF
?L24:	CALL SAY-IF-NOT-LIT >STACK
	RSTACK

	.FUNCT ROTARY-SOUTH-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is the south side of the"
	CALL WHICH-TOWN,STR?137
	PRINTI ". A road branches south, towards "
	PRINTD POST-OFFICE
	PRINTI " Hill.

The"
	CALL WHICH-TOWN,STR?163
	PRINTI ", "
	ZERO? SKEWED? /?L9
	PRINTI "once "
?L9:	PRINTI "famous for its museum of local historic artifacts, stands "
	ZERO? SKEWED? /?L16
	PRINTI "in a pitiful state of disrepair"
	JUMP ?L20
?L16:	PRINTI "proudly on the nearby "
	PRINTD CORNER
?L20:	PRINTR "."

	.FUNCT ENTER-ROTARY-SOUTH
	ZERO? SKEWED? \?L1
	ZERO? NOTE-GIVEN? \?L1
	ZERO? VOSS-SCRIPT \?L1
	CALL QUEUE,I-VOSS-BABBLE,-1 >STACK
	PUT STACK,0,1
?L1:	RETURN ROTARY-SOUTH

	.FUNCT LIBRARY-F
	CALL ENTER-FROM?,ROTARY-SOUTH,CIRCULATION-DESK,LIBRARY >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	EQUAL? HERE,ROTARY-SOUTH \?L4
	FSET? LIBRARY-DOOR,OPENBIT \?L6
	CALL GO-INSIDE
	RTRUE
?L6:	CALL ITS-CLOSED,LIBRARY-DOOR
	RTRUE
?L4:	CALL V-LOOK
	RTRUE

	.FUNCT LIBRARY-DOOR-F
	EQUAL? PRSA,V?UNLOCK \?L1
	EQUAL? PRSO,LIBRARY-DOOR \?L1
	FSET? LIBRARY-DOOR,LOCKEDBIT \?L1
	FSET? PRSO,OPENBIT \?L3
	CALL ALREADY-OPEN
	RTRUE
?L3:	EQUAL? HERE,ROTARY-SOUTH /?L5
	CALL LOCK-IS-OUTSIDE
	RTRUE
?L5:	EQUAL? PRSI,LIBRARY-KEY /?L6
	CALL THING-WONT-LOCK,PRSI,PRSO,1
	RTRUE
?L6:	FCLEAR LIBRARY-DOOR,LOCKEDBIT
	FSET CIRCULATION-DESK,ONBIT
	FSET LIBRARY-DOOR,OPENBIT
	PRINT OKAY
	PRINTI "the "
	PRINTD LIBRARY-DOOR
	PRINTI " is now unlocked and open."
	CRLF
	FSET? LIBRARY-DOOR,RMUNGBIT \?L10
	FCLEAR LIBRARY-DOOR,RMUNGBIT
	CRLF
	CALL UPDATE-SCORE,3
?L10:	CALL GOOD-PLACE-TO-SAVE
	RTRUE
?L1:	EQUAL? PRSA,V?LOCK \?L13
	EQUAL? PRSO,LIBRARY-DOOR \?L13
	FSET? LIBRARY-DOOR,OPENBIT /?L13
	FSET? LIBRARY-DOOR,LOCKEDBIT /?L13
	EQUAL? HERE,CIRCULATION-DESK \?L14
	CALL LOCK-IS-OUTSIDE
	RTRUE
?L14:	EQUAL? PRSI,LIBRARY-KEY /?L16
	CALL THING-WONT-LOCK,PRSI,LIBRARY-DOOR
	RTRUE
?L16:	FSET LIBRARY-DOOR,LOCKEDBIT
	FCLEAR CIRCULATION-DESK,ONBIT
	FCLEAR LIBRARY-DOOR,OPENBIT
	PRINT OKAY
	PRINTI "the "
	PRINTD LIBRARY-DOOR
	PRINTI " is"
	CALL CLOSED-AND-LOCKED
	RTRUE
?L13:	CALL HURT?,LIBRARY-DOOR >STACK
	ZERO? STACK /?L20
	CALL PRINT-ID,STR?164
	FSET? LIBRARY-DOOR,OPENBIT /?L21
	PRINTI "You won't get through the "
	PRINTD LIBRARY-DOOR
	PRINTR " that way."
?L21:	PRINTI "Why bother? "
	CALL ALREADY-OPEN
	RTRUE
?L20:	EQUAL? PRSA,V?OPEN \?L28
	FSET? LIBRARY-DOOR,OPENBIT \?L29
	CALL ALREADY-OPEN
	RTRUE
?L29:	FSET? LIBRARY-DOOR,LOCKEDBIT \FALSE
	CALL OBJECT-IS-LOCKED
	CALL VOSS-EXCUSE
	RTRUE
?L28:	CALL USE-DOOR?,ROTARY-SOUTH >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT LOCK-IS-OUTSIDE
	CALL UNFORTUNATELY
	PRINTR "the lock is on the outside."

	.FUNCT VIOLET-NOTE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a folded sheet of pale violet paper"
	FSET? VIOLET-NOTE,RMUNGBIT \?L5
	PRINTI ", sealed with a dab of library paste"
?L5:	PRINTI ". "
	CALL SAY-ADDRESS
	RTRUE
?L1:	EQUAL? PRSA,V?OPEN \?L12
	CALL DONT-HAVE?,VIOLET-NOTE >STACK
	ZERO? STACK \TRUE
	FSET? VIOLET-NOTE,RMUNGBIT \?L15
	CALL PRINT-ID,STR?165
	CALL NOT-YOURS,VIOLET-NOTE
	RTRUE
?L15:	PRINTD CRISP
	PRINTR " already opened it."
?L12:	EQUAL? PRSA,V?READ \?L19
	CALL DONT-HAVE?,VIOLET-NOTE >STACK
	ZERO? STACK \TRUE
	FSET? VIOLET-NOTE,RMUNGBIT \?L22
	CALL SAY-ADDRESS
	RTRUE
?L22:	CALL SAY-NOTE
	RTRUE
?L19:	EQUAL? PRSA,V?LOOK-INSIDE \?L24
	CALL DONT-HAVE?,VIOLET-NOTE >STACK
	ZERO? STACK \TRUE
	FSET? VIOLET-NOTE,RMUNGBIT \?L27
	CALL PRINT-ID,STR?166
	CALL NOT-YOURS,VIOLET-NOTE
	RTRUE
?L27:	CALL SAY-NOTE
	RTRUE
?L24:	CALL HURT?,VIOLET-NOTE >STACK
	ZERO? STACK /?L29
	CALL PRINT-ID,STR?167
	CALL HOW-WOULD-YOU-LIKE-IT,VIOLET-NOTE
	RTRUE
?L29:	EQUAL? PRSA,V?SMELL \FALSE
	PRINTR "Ugh! Cheap perfume."

	.FUNCT NOT-YOURS,THING
	CALL BUT-THE,THING
	PRINTR "isn't addressed to you!"

	.FUNCT SAY-ADDRESS
	PRINTR "The name ""Corky"" is beautifully handwritten on the outside."

	.FUNCT SAY-NOTE
	ZERO? NOTE-READ? \?L1
	SET 'NOTE-READ?,1
	CALL UPDATE-SCORE,3
	CRLF
?L1:	PRINTI "The handwritten note says:

""Corky-Poo,

I've got a plate of fresh oatmeal cookies waiting for you. Come over around sixish, and I'll show you my collection of Byron first editions, etc...

Violet

PS: If my little "
	PRINTD POODLE
	PRINTR " yaps at you, just say ALEXIS, HEEL and she'll behave."""

	.FUNCT EXIT-DESK
	CALL SHUT-DOOR? >STACK
	ZERO? STACK \FALSE
	CALL ITS-CLOSED,LIBRARY-DOOR
	RFALSE

	.FUNCT SHUT-DOOR?
	FSET? LIBRARY-DOOR,OPENBIT \FALSE
	PRINTI "A sudden noise stops you in your tracks."
	CRLF
	CALL I-SLAM-DOOR
	RTRUE

	.FUNCT ENTER-MUSEUM
	CALL SHUT-DOOR? >STACK
	ZERO? STACK \FALSE
	CALL EVIL-HERE? >STACK
	ZERO? STACK \FALSE
	RETURN MUSEUM

	.FUNCT CIRCULATION-DESK-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "before a large desk at the "
	PRINTD LIBRARY
	PRINTI " "
	PRINTD ENTRANCE
	PRINTI ". The top of the desk is almost hidden under a "
	PRINTD CLUTTER
	PRINTI ", all grey with dust."
	FIRST? CDESK >STACK \?L5
	PRINTI " There's also "
	CALL PRINT-CONTENTS,CDESK
	PRINTI " on the desk."
?L5:	CRLF
	CRLF
	PRINTI "A dark "
	PRINTD CORRIDOR
	PRINTI " leads south into "
	PRINTD DARKNESS
	PRINTI ". "
	CALL SAY-DOOR,LIBRARY-DOOR
	CALL SEE-WITCH >STACK
	RSTACK

	.FUNCT CDESK-F
	EQUAL? PRSA,V?LOCK,V?CLOSE \?L1
	CALL SAY-THE,CDESK
	PRINTI " is already"
	CALL CLOSED-AND-LOCKED
	RTRUE
?L1:	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L5
	CALL WASTE-OF-TIME
	RTRUE
?L5:	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L6
	PRINTI "Aside from the "
	PRINTD CLUTTER
	PRINTI ", you see "
	CALL PRINT-CONTENTS,CDESK
	PRINTI " on the "
	PRINTD CDESK
	PRINTR "."
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL ITS-CLOSED,CDESK
	RTRUE

	.FUNCT GMUSEUM-F
	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE,V?EXAMINE /?L3
	EQUAL? PRSA,V?LOOK-THRU \?L1
?L3:	EQUAL? HERE,MUSEUM \?L4
	CALL V-LOOK
	RTRUE
?L4:	CALL GO-INSIDE
	RTRUE
?L1:	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO /?L8
	EQUAL? PRSA,V?USE \?L7
?L8:	EQUAL? HERE,MUSEUM \?L9
	PRINTR "It's right here!"
?L9:	CALL DO-WALK,P?IN
	RTRUE
?L7:	EQUAL? PRSA,V?STAND-ON,V?LIE-DOWN,V?SIT \FALSE
	CALL LOITERING-ON,GMUSEUM
	RTRUE

	.FUNCT CLUTTER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The titles range from classics of world literature to forgotten hits of years long past. Dust covers them equally, regardless of merit."
?L1:	EQUAL? PRSA,V?READ \?L5
	CALL LOITERING-ON,CLUTTER
	RTRUE
?L5:	EQUAL? PRSA,V?TAKE \?L6
	PRINT CANT
	PRINTI " take any books. You don't have a "
	PRINTD LIBRARY
	PRINTI " card."
	CRLF
	CALL PRINT-ID,STR?168
	RTRUE
?L6:	EQUAL? PRSA,V?KICK,V?MUNG \?L9
	PRINTI "That's no way to handle "
	PRINTD LIBRARY
	PRINTI " materials!"
	CRLF
	CALL PRINT-ID,STR?169
	RTRUE
?L9:	CALL YOU-DONT-NEED,CLUTTER
	RETURN 2

	.FUNCT MUSEUM-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "Formerly a popular tourist attraction, the old Festeron "
	PRINTD MUSEUM
	PRINTI " is in a sorry state. "
	CALL SAY-EXHIBITS
	IN? FOSSIL,MUSEUM \?L5
	CRLF
	PRINTI "Fortunately, one of your childhood favorites is still intact. It's a pair of enormous fossil mailboxes, their metal bones locked together in a pose of eternal combat."
	CRLF
?L5:	CRLF
	PRINTI "There's a "
	FSET? DCASE,OPENBIT \?L12
	PRINTI "broken "
?L12:	PRINTI "glass "
	PRINTD DCASE
	PRINTI " in the "
	PRINTD CORNER
	PRINTI "."
	FIRST? DCASE >STACK \?L19
	PRINTI " "
	PRINT YOU-SEE
	CALL PRINT-CONTENTS,DCASE
	PRINTI " in the case."
?L19:	CRLF
	CALL SEE-WITCH >STACK
	RSTACK

	.FUNCT SAY-EXHIBITS
	PRINTI "Many of the best "
	PRINTD EXHIBITS
	PRINTR " have been carted away; the few remaining are sorely in need of renovation."

	.FUNCT SEE-WITCH
	IN? EVIL-ONE,HERE \FALSE
	CRLF
	PRINTI "There's an "
	PRINTD OLD-WOMAN
	PRINTI " standing in the "
	PRINTD CORRIDOR
	PRINTR "."

	.FUNCT EXIT-MUSEUM
	CALL EVIL-HERE? >STACK
	ZERO? STACK \FALSE
	RETURN CIRCULATION-DESK

	.FUNCT EVIL-HERE?
	IN? EVIL-ONE,HERE \FALSE
	CALL SAY-THE,OLD-WOMAN
	PRINTR " is blocking your path."

	.FUNCT EXHIBITS-F
	CALL SEE-VERB? >STACK
	ZERO? STACK /?L1
	CALL SAY-EXHIBITS
	RTRUE
?L1:	CALL YOU-DONT-NEED,EXHIBITS
	RETURN 2

	.FUNCT FOSSIL-F,OBJ
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "There's something disturbingly familiar about the "
	PRINTD FOSSIL
	PRINTI "."
	FIRST? FOSSIL >OBJ /?L8
	CRLF
	RTRUE
?L8:	PRINTI " Maybe it has something to do with the object"
	NEXT? OBJ >STACK \?L10
	PRINTI "s"
?L10:	PRINTR " you can see lying inside."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L18
	PRINT YOU-SEE
	CALL PRINT-CONTENTS,FOSSIL
	PRINTI " among the ribs of the "
	PRINTD FOSSIL
	PRINTR "."
?L18:	EQUAL? PRSA,V?PUT \?L23
	EQUAL? PRSI,FOSSIL \?L23
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,1 \?L24
	CALL BUT-THE,PRSO
	PRINTI "won't fit"
	JUMP ?L28
?L24:	MOVE PRSO,FOSSIL
	PRINT OKAY
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " slips"
?L28:	PRINTI " between the ribs of the "
	PRINTD FOSSIL
	PRINTR "."
?L23:	CALL HURT?,FOSSIL >STACK
	ZERO? STACK \?L36
	CALL MOVING?,FOSSIL >STACK
	ZERO? STACK \?L36
	EQUAL? PRSA,V?OPEN,V?REACH-IN \?L35
?L36:	CALL PRINT-ID,STR?170
	CALL HURT-FOSSIL
	RTRUE
?L35:	EQUAL? PRSA,V?CLOSE \FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT HURT-FOSSIL
	PRINTI "You'd probably damage the priceless "
	PRINTD FOSSIL
	CALL IF-YOU-TRIED >STACK
	RSTACK

	.FUNCT IN-FOSSIL,CONTEXT
	EQUAL? CONTEXT,M-CONT \FALSE
	CALL TOUCHING?,PRSO >STACK
	ZERO? STACK /FALSE
	PRINT CANT
	PRINTI " possibly reach "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR ". The fossil's ribs are too close together."

	.FUNCT IN-DCASE,CONTEXT
	EQUAL? CONTEXT,M-CONT \FALSE
	FSET? DCASE,OPENBIT /FALSE
	CALL SEE-VERB? >STACK
	ZERO? STACK \FALSE
	PRINT CANT
	PRINTI " reach inside the closed "
	PRINTD DCASE
	PRINTR "."

	.FUNCT DCASE-F,OPEN?,THING
	FSET? DCASE,OPENBIT /?L1
	SET 'OPEN?,0
	JUMP ?L2
?L1:	SET 'OPEN?,1
?L2:	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE,V?EXAMINE \?L3
	PRINTI "The "
	ZERO? OPEN? /?L7
	PRINTI "broken "
?L7:	PRINTD DCASE
	FIRST? DCASE >STACK \?L12
	PRINTI " contains "
	CALL PRINT-CONTENTS,DCASE
	JUMP ?L16
?L12:	PRINTI " is empty"
?L16:	PRINTI ". "
	CALL SAY-DCASE-SIGN
	RTRUE
?L3:	EQUAL? PRSA,V?LOOK-ON /?L22
	EQUAL? PRSA,V?PUT-ON \?L21
	EQUAL? PRSI,DCASE \?L21
?L22:	CALL TOO-HIGH,DCASE
	RTRUE
?L21:	EQUAL? PRSA,V?READ \?L23
	CALL SAY-DCASE-SIGN
	RTRUE
?L23:	EQUAL? PRSA,V?KILL,V?MUNG \?L24
	EQUAL? PRSO,DCASE \?L24
	ZERO? OPEN? /?L25
	CALL PRINT-ID,STR?171
	CALL ALREADY-BROKE-IT
	RTRUE
?L25:	ZERO? PRSI \?L27
	PRINTI "(with "
	PRINTD HANDS
	PRINTI ")"
	CRLF
	CALL PRINT-ID,STR?172
	CALL TRY-BREAK,STR?173
	RTRUE
?L27:	EQUAL? PRSI,BROOM,BRANCH,CONCH-SHELL /?L31
	EQUAL? PRSI,BOTTLE,UMBRELLA,SHOE \?L30
?L31:	EQUAL? PRSI,BROOM \?L32
	ZERO? BROOM-SIT? /?L32
	CALL GET-OFF-BROOM-FIRST
?L32:	FCLEAR DCASE,DOORBIT
	FSET DCASE,TRANSBIT
	FSET DCASE,OPENBIT
	FSET DCASE,RMUNGBIT
	PRINTI "Crash! You broke the "
	PRINTD DCASE
	PRINTI " open with "
	CALL PRINT-ID,STR?174
	CALL ARTICLE,PRSI,1
	PRINTD PRSI
	PRINTI "."
	CRLF
	FSET? SW2,OPENBIT /TRUE
	CRLF
	PRINTI "The tinkle of broken glass is drowned out by the blare of an electric security alarm! You stand frozen with fear as "
	PRINTD MACGUFFIN
	PRINTI " strides into the "
	PRINTD MUSEUM
	PRINTI " and drags you to "
	CALL PRINT-ID,STR?175
	CALL TORTURE-ENDING
	RETURN 2
?L30:	LOC PRSI >STACK
	EQUAL? STACK,GLOBAL-OBJECTS,LOCAL-GLOBALS /?L47
	EQUAL? PRSI,DCASE \?L46
?L47:	CALL WHAT-A-CONCEPT
	RTRUE
?L46:	CALL DONT-HAVE?,PRSI >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSI,WISHBRINGER \?L49
	PRINTI "The stone is too small."
	CRLF
	CALL PRINT-ID,STR?176
	RTRUE
?L49:	PRINTI "You'd never break the "
	PRINTD DCASE
	PRINTI " with that!"
	CRLF
	CALL PRINT-ID,STR?177
	RTRUE
?L24:	EQUAL? PRSA,V?THROW \?L55
	EQUAL? PRSI,DCASE \?L55
	SET 'THING,PRSO
	PRINTI "Thrown."
	CRLF
	CRLF
	CALL PERFORM,V?MUNG,DCASE,PRSO
	MOVE THING,HERE
	RTRUE
?L55:	EQUAL? PRSA,V?KICK \?L58
	ZERO? OPEN? /?L59
	CALL PRINT-ID,STR?178
	CALL ALREADY-BROKE-IT
	RTRUE
?L59:	CALL PRINT-ID,STR?179
	CALL TRY-BREAK,STR?180
	RTRUE
?L58:	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L62
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L62:	CALL MOVING?,DCASE >STACK
	ZERO? STACK /?L65
	CALL TOO-LARGE,DCASE
	RTRUE
?L65:	EQUAL? PRSA,V?CLOSE \FALSE
	ZERO? OPEN? /FALSE
	CALL ALREADY-BROKE-IT
	RTRUE

	.FUNCT ALREADY-BROKE-IT
	CALL SAY-THE,DCASE
	PRINTR " is broken, remember?"

	.FUNCT SAY-DCASE-SIGN
	PRINTI "A "
	PRINTD SIGN
	PRINTI " on the "
	PRINTD DCASE
	PRINTI " reads, """
	CALL FROBOZZ,STR?181
	PRINTR "."""

	.FUNCT TRY-BREAK,STR
	CALL SAY-THE,DCASE
	PRINTI " is still intact, but your "
	PRINT STR
	PRINTR " isn't. Ouch!"

	.FUNCT TORTURE-ENDING
	PRINTI "the Tower, where you're subjected to months of slow, painful torture at the skilled hands of"
	PRINT EONE
	PRINTI "."
	CALL BAD-ENDING >STACK
	RSTACK

	.FUNCT SCULPTURE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The black marble "
	PRINTD SCULPTURE
	PRINTI " is about 14 inches high. It's exquisitely crafted in the likeness of a cat."
	CRLF
	CRLF
	PRINT YOU-SEE
	PRINTI "a round, shallow hole carved into the forehead of the "
	PRINTD SCULPTURE
	PRINTR "."
?L1:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L7
	EQUAL? PRSI,SCULPTURE \?L7
	EQUAL? PRSO,WISHBRINGER \?L8
?L10:	CALL DO-END >STACK
	ZERO? STACK /?L11
	CRLF
	PRINTI "Do you still want to put "
	PRINT GAME
	PRINTI " into the "
	PRINTD SCULPTURE
	PRINTI "?"
	CALL YES? >STACK
	ZERO? STACK \?L10
	PRINT OKAY
	PRINTI "you're still holding "
	PRINT GAME
	PRINTI "."
	CRLF
?L11:	RETURN 2
?L8:	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,1 \?L24
	CALL TOO-LARGE,PRSO
	RTRUE
?L24:	CALL SAY-THE,PRSO
	PRINTI " falls out of the "
	PRINTD SCULPTURE
	CALL AND-DROPS-OUT,PRSO
	RTRUE
?L7:	EQUAL? PRSA,V?THROW /?L29
	CALL HURT?,SCULPTURE >STACK
	ZERO? STACK /FALSE
?L29:	CALL PRINT-ID,STR?182
	CALL RUIN,SCULPTURE
	RTRUE

	.FUNCT DO-END,GOT?=0
	DEC 'WIN-TRY
	EQUAL? WIN-TRY,2 \?L1
	MOVE EVIL-ONE,HERE
	SET 'WOMAN-SCRIPT,5
	CALL QUEUE,I-PLEA,-1 >STACK
	PUT STACK,0,1
	PRINT GAME
	PRINTI " glows brighter as it nears the "
	PRINTD SCULPTURE
	PRINTI ". It looks like it will fit perfectly into the black forehead.

""Wait!"" commands a familiar voice.

You turn, and see the figure of an "
	PRINTD OLD-WOMAN
	PRINTI " standing "
	ZERO? FUZZY? /?L5
	PRINTI "nearby..."
	CALL DARK-BEING
	JUMP ?L9
?L5:	PRINTI "in the "
	PRINTD DARKNESS
	PRINTI " of the "
	PRINTD CORRIDOR
	PRINTI "."
?L9:	CRLF
	CRLF
	PRINTI """Your quest is ended"
	PRINT ADVENTURER
	PRINTI ","" says the "
	PRINTD OLD-WOMAN
	PRINTI ". ""The "
	PRINTD SCULPTURE
	PRINTI " you "
	IN? SCULPTURE,PROTAGONIST \?L14
	PRINTI "hold"
	JUMP ?L18
?L14:	PRINTI "see before you"
?L18:	PRINTI " is "
	PRINTD CHAOS
	PRINTI ", the Cat Which Was Stolen. Now give "
	PRINT GAME
	PRINTR " to me, and together we shall rejoice in your success."""
?L1:	EQUAL? WIN-TRY,1 \?L23
	PRINTI """Don't!"" barks the "
	PRINTD OLD-WOMAN
	PRINTI " as "
	PRINTD HANDS
	PRINTI " moves closer to the "
	PRINTD SCULPTURE
	PRINTR "."
?L23:	IN? SCULPTURE,PROTAGONIST /?L27
	SET 'GOT?,0
	JUMP ?L28
?L27:	SET 'GOT?,1
?L28:	PRINTI """No!""

A blast of Magick shakes the building as "
	PRINT GAME
	PRINTI " touches the forehead of the "
	PRINTD SCULPTURE
	PRINTI ". Violet sheets of energy, pure and brilliant, erupt from the very heart of the Stone and illuminate the room like daylight.

The woman's disguise evaporates in the glare. It's"
	PRINT EONE
	PRINTI ", her mouth frozen open in a wail of despair as she fades into oblivion. The memory of that face will haunt your dreams as long as you live.

You "
	ZERO? GOT? /?L31
	PRINTI "feel the "
	PRINTD SCULPTURE
	PRINTI " become soft and warm in "
	PRINTD HANDS
	PRINTI "s"
	JUMP ?L35
?L31:	PRINTI "watch as the "
	PRINTD SCULPTURE
	PRINTI " begins to soften in the radiance"
?L35:	PRINTI ". It wriggles like a thing alive, leaps "
	ZERO? GOT? /?L40
	PRINTI "out of your arms"
	JUMP ?L44
?L40:	PRINTI "across the floor"
?L44:	PRINTI " and disappears into a vortex of color. The "
	PRINTD LIBRARY
	PRINTI " folds around you like the closing of a great book..."
	CALL INT,I-PLEA >STACK
	PUT STACK,0,0
	REMOVE SCULPTURE
	MOVE CHAOS,CLIFF-EDGE
	ADD GSCORE,5 >GSCORE
	SET 'SCORE,6
	SET 'MOVES,0
	CALL TO-FINISH
	SET 'SUCCESS?,1
	CALL V-LOOK
	RFALSE

	.FUNCT I-PLEA,STONE-LOC
	CALL THIS-IS-IT,EVIL-ONE
	CALL THIS-IS-IT,WISHBRINGER
	ZERO? FUZZY? /?L1
	SET 'FUZZY?,0
	FCLEAR GLASSES,WORNBIT
	CALL PRINT-ID,STR?183
	REMOVE GLASSES
	CRLF
	PRINTI """Take off those glasses!"" commands the "
	PRINTD OLD-WOMAN
	PRINTI " sharply. To your astonishment, the "
	PRINTD GLASSES
	PRINTI " leaps away from your eyes and disappears in a silent flash."
	CRLF
	CRLF
	SET 'HERE,FUZZY-FROM
	MOVE PROTAGONIST,HERE
	IN? EVIL-ONE,HERE /?L5
	MOVE EVIL-ONE,HERE
?L5:	CALL V-LOOK
	RTRUE
?L1:	LOC WISHBRINGER >STONE-LOC
	DEC 'WOMAN-SCRIPT
	CRLF
	EQUAL? STONE-LOC,HERE,DCASE,CDESK /?L11
	EQUAL? STONE-LOC,FOSSIL,COAT \?L9
?L11:	CALL SAY-THE,OLD-WOMAN
	PRINTI " snatches away the Stone,"
	CALL EVIL-ONE-TAKES-STONE >STACK
	RSTACK
?L9:	EQUAL? WOMAN-SCRIPT,4 \?L14
	CALL SAY-THE,OLD-WOMAN
	PRINTI " steps out of the "
	PRINTD DARKNESS
	PRINTR " and moves towards you. ""Give me the Stone,"" she says. ""I want to make certain you haven't damaged it."""
?L14:	EQUAL? WOMAN-SCRIPT,3 \?L17
	PRINTI """Let me touch "
	PRINT GAME
	PRINTI ","" says the "
	PRINTD OLD-WOMAN
	PRINTR ", inching closer. ""I want to hold it again in my hands.""

You feel your fingers relaxing as she speaks."
?L17:	EQUAL? WOMAN-SCRIPT,2 \?L20
	PRINTI """Quickly!"" snaps the "
	PRINTD OLD-WOMAN
	PRINTI " impatiently. ""Give me the Magick Stone. You have no use for it now!""

Your fingers are beginning to lose their grip on "
	PRINT GAME
	PRINTR "."
?L20:	EQUAL? WOMAN-SCRIPT,1 \?L23
	CALL SAY-THE,OLD-WOMAN
	PRINTI " stretches out her clawlike hand. ""If you will not give the Stone to me freely,"" she growls, ""I will have no choice but to take it.""

Your hand is trembling violently. It wants to give her "
	PRINT GAME
	PRINTR "!"
?L23:	PRINTI """Yield!"" commands the woman sharply.

The "
	PRINTD WISHBRINGER
	PRINTI " leaps out of "
	PRINTD HANDS
	PRINTI " and into the "
	PRINTD OLD-WOMAN
	PRINTI "'s bony fingers. She"
	CALL EVIL-ONE-TAKES-STONE >STACK
	RSTACK

	.FUNCT EVIL-ONE-TAKES-STONE
	CALL INT,I-PLEA >STACK
	PUT STACK,0,0
	PRINTI " holds it up and gazes into its depths. """
	PRINT GAME
	PRINTI ","" she whispers, deep in her throat.

The Stone begins to pulse with crimson light. In its sinister glow, the "
	PRINTD OLD-WOMAN
	PRINTI "'s disguise melts away. It's"
	PRINT EONE
	PRINTI "!

""A fool!"" she cackles wildly, and the "
	PRINTD SCULPTURE
	PRINTI " shatters to pieces at the sound. ""My sister was a fool to send the likes of you on such a quest! Does she think a mail clerk can save the world from Wickedness? Be gone!""

With a wave of her warty hand,"
	PRINT EONE
	PRINTI " turns you into a "
	CALL PICK-ONE,TURNS >STACK
	PRINT STACK
	PRINTI "."
	CALL PRINT-ID,STR?184
	CALL BAD-ENDING
	RTRUE

	.FUNCT EVIL-ONE-F,CONTEXT=0
	CALL THIS-IS-IT,EVIL-ONE
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,INSIDE-THEATER \?L3
	PRINTI "She's"
	CALL DARK-BEING
	CRLF
	RTRUE
?L3:	PRINTI "It looks like the "
	PRINTD OLD-WOMAN
	PRINTI " you met at the "
	PRINTD MAGICK-SHOPPE
	PRINTI ".

(Hmm. The outline of the woman is "
	CALL PICK-ONE,BLURS >STACK
	PRINT STACK
	PRINTR ", like a double image. Must be your eyes getting tired or something.)"
?L1:	CALL IMAGE?,EVIL-ONE >STACK
	ZERO? STACK /?L10
	RETURN 2
?L10:	EQUAL? PRSA,V?GIVE \?L13
	EQUAL? PRSI,EVIL-ONE \?L13
	EQUAL? PRSO,WISHBRINGER \?L14
	CALL SAY-THE,OLD-WOMAN
	PRINTI " takes "
	PRINT GAME
	PRINTI " from you,"
	CALL EVIL-ONE-TAKES-STONE
	RTRUE
?L14:	CALL GESTURE,STR?185
	RTRUE
?L13:	CALL TALKING-TO?,EVIL-ONE >STACK
	ZERO? STACK \?L20
	EQUAL? PRSA,V?YELL \?L19
?L20:	CALL GESTURE,STR?186
	RETURN 2
?L19:	CALL HURT?,EVIL-ONE >STACK
	ZERO? STACK \?L24
	EQUAL? PRSA,V?SQUEEZE,V?KISS,V?RUB \FALSE
?L24:	PRINTI "Don't try it. This "
	PRINTD OLD-WOMAN
	PRINTI " looks tough!"
	CRLF
	CALL PRINT-ID,STR?187
	RTRUE

	.FUNCT GESTURE,STR
	CALL SAY-THE,OLD-WOMAN
	PRINT STR
	PRINTR " with an impatient gesture."

	.FUNCT DARK-BEING
	PRINTI " a dark, sinister being with terrible eyes!"
	RTRUE

	.FUNCT ROTARY-NORTH-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is the northern side of the"
	CALL WHICH-TOWN,STR?137
	PRINTI ". A road leads north, towards the river.

On the "
	PRINTD CORNER
	PRINTI " stands a "
	ZERO? SKEWED? /?L7
	PRINTI "broken-down old "
	PRINTD CHURCH
	PRINTR " that looks as if it hasn't been used for years."
?L7:	PRINTI "quaint "
	PRINTD FESTERON
	PRINTI " "
	PRINTD CHURCH
	PRINTI ". Its little white steeple is straight out of a country postcard. "
	CALL SAY-DOOR,CHURCH-DOOR >STACK
	RSTACK

	.FUNCT ENTER-CHURCH
	FSET? CHURCH-DOOR,OPENBIT \?L1
	FSET? CHURCH,RMUNGBIT \?L3
	FCLEAR CHURCH,RMUNGBIT
	CALL QUEUE,I-RODENT,-1 >STACK
	PUT STACK,0,1
?L3:	RETURN INSIDE-CHURCH
?L1:	CALL ITS-CLOSED,CHURCH-DOOR
	RFALSE

	.FUNCT I-RODENT
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	FSET? CHURCH,TOOLBIT \?L4
	FCLEAR CHURCH,TOOLBIT
	RTRUE
?L4:	EQUAL? HERE,INSIDE-CHURCH \FALSE
	ZERO? LIT /FALSE
	CALL INT,I-RODENT >STACK
	PUT STACK,0,0
	FCLEAR CHURCH,TOUCHBIT
	CRLF
	PRINTI "As you look around the empty "
	PRINTD CHURCH
	PRINTI " a "
	ZERO? SKEWED? /?L8
	PRINTI "big brown rat"
	JUMP ?L12
?L8:	PRINTI "little white mouse"
?L12:	PRINTI " scurries across the "
	ZERO? SKEWED? /?L17
	PRINTI "broken glass"
	JUMP ?L21
?L17:	PRINTI "floor"
?L21:	PRINTR " and disappears."

	.FUNCT INSIDE-CHURCH-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "inside a"
	ZERO? SKEWED? /?L5
	PRINTI "n abandoned old "
	PRINTD CHURCH
	PRINTI ". The aisles are littered with debris and bits of colored glass; everything is coated with a thick layer of dust"
	JUMP ?L9
?L5:	PRINTI " beautiful old "
	PRINTD CHURCH
	PRINTI ". The aisles are diffused with rich colored light streaming in through the stained glass "
	PRINTD WINDOW
	PRINTI "s"
?L9:	PRINTR "."

	.FUNCT SPEAKER-F
	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE /?L3
	EQUAL? PRSA,V?LISTEN \?L1
?L3:	PRINTR "It's burned out."
?L1:	CALL TOUCHING?,SPEAKER >STACK
	ZERO? STACK /?L6
	CALL TOO-HIGH,SPEAKER
	RTRUE
?L6:	CALL YOU-DONT-NEED,SPEAKER
	RETURN 2

	.FUNCT CANDLE-F
	EQUAL? PRSA,V?TAKE \?L1
	EQUAL? PRSO,CANDLE \?L1
	ZERO? CANDLE-TAKEN? \?L1
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	PRINTI "A voice from above "
	ZERO? SKEWED? /?L7
	CALL PRINT-ID,STR?188
	SET 'CANDLE-TAKEN?,1
	PRINTI "begins to proclaim something, but"
	CALL STATIC
	PRINTR " drowns out the solemn words. Looking up, you notice a speaker in the ceiling emitting sparks.

Taken."
?L7:	MOVE CANDLE,INSIDE-CHURCH
	PRINTI "solemnly proclaims, ""Thou shalt not steal."""
	CALL PRINT-ID,STR?189
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?BLOW-INTO,V?LAMP-OFF \?L17
	FSET? CANDLE,ONBIT \?L18
	CALL BEST-EFFORTS,CANDLE,STR?190
	RTRUE
?L18:	CALL BUT-THE,CANDLE
	PRINTR "isn't lit!"
?L17:	EQUAL? PRSA,V?PUT-ON \FALSE
	EQUAL? PRSI,CANDLE \FALSE
	FSET? CANDLE,ONBIT \FALSE
	CALL PERFORM,V?BURN,PRSO,CANDLE
	RTRUE

	.FUNCT STATIC
	PRINTI " a burst of static"
	RTRUE

	.FUNCT BEST-EFFORTS,THING,STR
	RANDOM 100 >STACK
	LESS? 50,STACK /?L1
	PRINTI "Strange"
	JUMP ?L5
?L1:	PRINTI "That's odd"
?L5:	PRINTI ". Despite your best efforts, the "
	PRINTD THING
	PRINTI " "
	PRINT STR
	PRINTR "."

	.FUNCT CHURCH-F
	CALL ENTER-FROM?,ROTARY-NORTH,INSIDE-CHURCH,CHURCH >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L3
	CALL V-LOOK
	RTRUE
?L3:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	EQUAL? HERE,INSIDE-CHURCH \?L5
	CALL V-LOOK
	RTRUE
?L5:	CALL GO-INSIDE
	RTRUE

	.FUNCT CHURCH-WINDOWS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,WINDOW
	PRINTI "s "
	ZERO? SKEWED? /?L5
	PRINTI "are all broken"
	JUMP ?L9
?L5:	PRINTI "glow with rich colors"
?L9:	PRINTR "."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L14
	ZERO? SKEWED? /?L15
	EQUAL? HERE,ROTARY-NORTH \?L17
	CALL GO-INSIDE
	RTRUE
?L17:	CALL NOTHING-INTERESTING,1
	RTRUE
?L15:	PRINT CANT
	PRINTI ". "
	CALL SAY-THE,WINDOW
	PRINTR "s are too thick."
?L14:	CALL HURT?,WINDOW >STACK
	ZERO? STACK /?L25
	ZERO? SKEWED? /?L26
	PRINTI "They're already broken!"
	CRLF
	CALL PRINT-ID,STR?191
	RTRUE
?L26:	CALL PRINT-ID,STR?192
	CALL HOW-WOULD-YOU-LIKE-IT,WINDOW
	RTRUE
?L25:	EQUAL? PRSA,V?PUSH,V?CLOSE,V?OPEN /?L32
	EQUAL? PRSA,V?MOVE \?L31
?L32:	CALL SAY-THE,WINDOW
	PRINTI "s are "
	ZERO? SKEWED? /?L35
	PRINTR "broken!"
?L35:	PRINTR "too heavy to move."
?L31:	CALL YOU-DONT-NEED,WINDOW
	RETURN 2

	.FUNCT CDEBRIS-F
	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L1
	CALL NOTHING-INTERESTING,1
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-INSIDE,V?SEARCH \?L3
	CALL NOTHING-INTERESTING
	RTRUE
?L3:	CALL YOU-DONT-NEED,CDEBRIS
	RETURN 2

	.FUNCT JAIL-CELL-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're locked inside a damp, uncomfortable jail cell. Its thick steel door and stone walls offer little hope for escape.

The only furnishing is a hard bunk "
	FSET? BUNK,RMUNGBIT \?L5
	PRINTI "in the middle of the floor"
	JUMP ?L9
?L5:	PRINTI "against the wall"
?L9:	FIRST? BUNK >STACK \?L12
	PRINTI " with "
	CALL PRINT-CONTENTS,BUNK
	PRINTI " on it"
?L12:	PRINTI "."
	CRLF
	FSET? BUNK,RMUNGBIT \FALSE
	CRLF
	CALL SEE-HOLE >STACK
	RSTACK

	.FUNCT CELL-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	EQUAL? HERE,JAIL-CELL \?L3
	CALL V-LOOK
	RTRUE
?L3:	ZERO? SKEWED? /?L6
	PRINTI "They don't"
	JUMP ?L10
?L6:	PRINTI "It doesn't"
?L10:	PRINTR " look very comfortable."
?L1:	EQUAL? PRSA,V?ENTER,V?THROUGH,V?WALK-TO \?L15
	EQUAL? HERE,INSIDE-POLICE-STATION \?L15
	ZERO? SKEWED? /?L16
	PRINTD MACGUFFIN
	PRINTR " smirks. ""You'll be in one soon enough."""
?L16:	CALL CELL-DOOR-IS-SECURE
	RTRUE
?L15:	CALL CELL-DOOR-F >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT CELL-DOOR-IS-SECURE
	PRINTI "The lock on the "
	PRINTD CELL-DOOR
	PRINTR " is very secure."

	.FUNCT CELL-DOOR-F
	CALL HURT?,CELL-DOOR >STACK
	ZERO? STACK \?L3
	EQUAL? PRSA,V?PICK,V?SHAKE,V?EXAMINE \?L1
?L3:	CALL CELL-DOOR-IS-SECURE
	RTRUE
?L1:	EQUAL? PRSA,V?UNLOCK,V?OPEN \?L4
	CALL NOT-LIKELY,MACGUFFIN,STR?193
	RTRUE
?L4:	EQUAL? PRSA,V?LOCK,V?CLOSE \?L5
	CALL ALREADY-CLOSED
	RTRUE
?L5:	CALL USE-DOOR?,INSIDE-POLICE-STATION >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT BUNK-F
	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE /?L3
	EQUAL? PRSA,V?SEARCH \?L1
?L3:	CALL NOT-CLEAN,BUNK
	FIRST? BUNK >STACK \?L4
	PRINTI " There's "
	CALL PRINT-CONTENTS,BUNK
	PRINTI " on it."
?L4:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-UNDER \?L11
	FSET? BUNK,RMUNGBIT /?L11
	CALL SEE-HOLE
	RTRUE
?L11:	EQUAL? PRSA,V?LOOK-BEHIND \?L12
	FSET? BUNK,RMUNGBIT \?L13
	CALL SEE-HOLE
	RTRUE
?L13:	CALL YOUD-HAVE-TO,STR?194,BUNK
	RTRUE
?L12:	EQUAL? PRSA,V?MOVE,V?PUSH \?L16
	PRINT OKAY
	PRINTI "you moved the "
	PRINTD BUNK
	FSET? BUNK,RMUNGBIT \?L19
	FCLEAR BUNK,RMUNGBIT
	FCLEAR UNDER-CELL,ONBIT
	PRINTR " back up against the wall."
?L19:	FSET BUNK,RMUNGBIT
	FSET? HIDDEN-HATCH,RMUNGBIT /?L24
	FSET UNDER-CELL,ONBIT
?L24:	PRINTI " away from the wall. "
	CALL SEE-HOLE
	RTRUE
?L16:	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L29
	CALL NOT-CLEAN,BUNK,1
	CRLF
	RTRUE
?L29:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L30
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L30:	EQUAL? PRSA,V?PUT-UNDER \FALSE
	EQUAL? PRSI,BUNK \FALSE
	CALL WASTE-OF-TIME
	RTRUE

	.FUNCT SEE-HOLE
	FSET HIDDEN-HATCH,TOUCHBIT
	PRINTI "There's a "
	FSET? HIDDEN-HATCH,RMUNGBIT \?L3
	PRINTI "patch of new concrete o"
	JUMP ?L7
?L3:	PRINTI "dark, narrow hole i"
?L7:	PRINTR "n the floor."

	.FUNCT NOT-CLEAN,THING,WARN?=0
	ZERO? WARN? /?L1
	PRINTI "Better not. "
?L1:	CALL SAY-THE,THING
	PRINTI " doesn't look very sanitary."
	RTRUE

	.FUNCT BLANKET-F
	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L1
	CALL NOT-CLEAN,BLANKET,1
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L3
	IN? BLANKET,BABY \FALSE
	CALL WAKE-BABY >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L7
	EQUAL? PRSI,BLANKET \?L7
	EQUAL? PRSO,BLANKET \?L8
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L8:	CALL NOT-CLEAN,BLANKET,1
	CRLF
	RTRUE
?L7:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L13
	CALL NOT-CLEAN,BLANKET
	CRLF
	RTRUE
?L13:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L14
	CALL WASTE-OF-TIME
	RTRUE
?L14:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	IN? BLANKET,PROTAGONIST \?L16
	PRINTR "You're holding it!"
?L16:	IN? BLANKET,BABY \FALSE
	PRINTI "There's a "
	PRINTD BABY
	PRINTR " there."

	.FUNCT HIDDEN-HATCH-F
	FSET? HIDDEN-HATCH,TOUCHBIT /?L1
	EQUAL? HERE,UNDER-CELL /?L1
	CALL CANT-SEE-ANY,HIDDEN-HATCH
	RETURN 2
?L1:	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO \?L5
	EQUAL? HERE,JAIL-CELL \?L6
	CALL DO-WALK,P?DOWN
	RTRUE
?L6:	CALL DO-WALK,P?UP
	RTRUE
?L5:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L9
	FSET? HIDDEN-HATCH,RMUNGBIT \?L10
	CALL SAY-THE,HIDDEN-HATCH
	PRINTR " is sealed with cement."
?L10:	FSET? BUNK,RMUNGBIT \?L14
	CALL CANT-MAKE-OUT-ANYTHING
	RTRUE
?L14:	PRINTI "The hole is blocked by "
	EQUAL? HERE,JAIL-CELL \?L18
	PRINTI "the bunk"
	JUMP ?L22
?L18:	PRINTI "something overhead. It looks like the underside of a bed or bunk"
?L22:	PRINTR "."
?L9:	EQUAL? PRSA,V?THROW,V?PUT \?L27
	EQUAL? PRSI,HIDDEN-HATCH \?L27
	FSET? HIDDEN-HATCH,RMUNGBIT /?L30
	FSET? BUNK,RMUNGBIT /?L28
?L30:	CALL PERFORM,V?EXAMINE,HIDDEN-HATCH
	RETURN 2
?L28:	EQUAL? PRSO,HANDS \?L33
	CALL NOTHING-EXCITING
	RTRUE
?L33:	CALL PUTTING-OPEN-UMBRELLA? >STACK
	ZERO? STACK \TRUE
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,10 \?L35
	CALL TOO-LARGE,PRSO
	RTRUE
?L35:	EQUAL? HERE,JAIL-CELL \?L36
	MOVE PRSO,UNDER-CELL
	JUMP ?L37
?L36:	MOVE PRSO,JAIL-CELL
?L37:	PRINT OKAY
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " disappears into the "
	PRINTD HIDDEN-HATCH
	PRINTR "."
?L27:	FSET? HIDDEN-HATCH,RMUNGBIT \?L42
	PRINT CANT
	PRINTI " do anything useful with the cement."
	CRLF
	RETURN 2
?L42:	EQUAL? PRSA,V?REACH-IN \FALSE
	CALL NOTHING-EXCITING
	RTRUE

	.FUNCT THROUGH-HATCH?
	FSET? HIDDEN-HATCH,RMUNGBIT \?L1
	PRINT CANT
	PRINTI " pass through solid cement."
	CRLF
	RFALSE
?L1:	FSET? HIDDEN-HATCH,TOUCHBIT /?L5
	EQUAL? HERE,JAIL-CELL \?L5
	PRINT CANT
	PRINTI " see any exit that way."
	CRLF
	RFALSE
?L5:	FSET? BUNK,RMUNGBIT \?L8
	CALL CANT-FIT-INTO?,STR?195 >STACK
	ZERO? STACK \FALSE
	CALL GET-INTO,STR?195
	EQUAL? HERE,JAIL-CELL \?L12
	RETURN UNDER-CELL
?L12:	RETURN JAIL-CELL
?L8:	CALL PERFORM,V?EXAMINE,HIDDEN-HATCH
	RFALSE

	.FUNCT PBUNK-F
	FSET? BUNK,RMUNGBIT \?L1
	PRINT CANT
	PRINTI ". You"
	CALL MOVED-THE-BUNK
	RETURN 2
?L1:	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-ON,V?EXAMINE \?L7
	CALL SAY-THE,BUNK
	PRINTR " looks flimsy. You could probably move it if you tried."
?L7:	EQUAL? PRSA,V?PUSH,V?PULL,V?MOVE \?L10
	FSET HIDDEN-HATCH,TOUCHBIT
	FSET BUNK,RMUNGBIT
	FSET UNDER-CELL,ONBIT
	SET 'LIT,1
	PRINT OKAY
	PRINTI "you"
	CALL MOVED-THE-BUNK
	CRLF
	PRINTR "Faint light streams in from overhead."
?L10:	CALL GETTING-INTO? >STACK
	ZERO? STACK \?L17
	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT /?L17
	EQUAL? PRSA,V?PUT-BEHIND,V?PUT-UNDER,V?LOOK-BEHIND \FALSE
?L17:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT MOVED-THE-BUNK
	PRINTR " moved the bunk away from the hole."

	.FUNCT ISLE-F,AT-ISLE?=0
	CALL THIS-IS-IT,ISLE
	EQUAL? HERE,ISLAND,THRONE-ROOM /?L1
	SET 'AT-ISLE?,0
	JUMP ?L2
?L1:	SET 'AT-ISLE?,1
?L2:	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L3
	ZERO? AT-ISLE? /?L5
	CALL V-LOOK
	RTRUE
?L5:	PRINTD ISLAND
	PRINTR " has been shrouded in fog for as long as you can remember. Strange legends and mysterious rumors abound; but nobody you know has ever been there."
?L3:	EQUAL? PRSA,V?WALK-TO,V?FOLLOW,V?THROUGH /?L11
	EQUAL? PRSA,V?ENTER,V?FIND,V?SWIM \?L10
?L11:	ZERO? AT-ISLE? /?L12
	CALL ALREADY-ON,ISLE
	RTRUE
?L12:	CALL PROBABLY-DROWN
	RTRUE
?L10:	EQUAL? PRSA,V?LIE-DOWN,V?SIT,V?STAND-ON /?L16
	EQUAL? PRSA,V?WEAR \?L15
?L16:	ZERO? AT-ISLE? /?L17
	CALL ALREADY-ON,ISLE
	RTRUE
?L17:	CALL YOUD-HAVE-TO,STR?196,ISLE
	RTRUE
?L15:	EQUAL? PRSA,V?SEARCH,V?CROSS,V?WALK-AROUND \?L20
	ZERO? AT-ISLE? /?L21
	CALL V-WALK-AROUND
	RTRUE
?L21:	CALL YOUD-HAVE-TO,STR?196,ISLE
	RTRUE
?L20:	CALL YOU-DONT-NEED,ISLE
	RETURN 2

	.FUNCT EDGE
	PRINTI " the edge of the lake"
	RTRUE

	.FUNCT EDGE-OF-LAKE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're on the sandy shore of the lake. A road heads east towards the "
	PRINTD FESTERON
	PRINTI ", and another runs north along"
	CALL EDGE
	PRINTI ". Looking south, you can see a"
	CALL OPEN-CLOSED,NORTH-GATE,1
	PRINTD NORTH-GATE
	PRINTI " leading into the"
	CALL WHICH-TOWN,STR?128
	PRINTI "."
	CRLF
	CRLF
	PRINTD ISLAND
	PRINTI ", its outline shrouded in fog, is visible far across the water."
	CRLF
	CRLF
	PRINT YOU-SEE
	PRINTI "a "
	FSET? PIT,OPENBIT \?L13
	PRINTI "narrow pit"
	ZERO? PIT-FULL? /?L22
	PRINTI " full of rainwater"
	JUMP ?L22
?L13:	PRINTI "circular "
	PRINTD LEAVES
?L22:	PRINTI " near"
	CALL EDGE
	PRINTI ". "
	IN? BRANCH,PIT \?L29
	PRINTI "A "
	PRINTD BRANCH
	PRINTI " is sticking out of the pit. "
?L29:	FSET? LAKE-SAND,RMUNGBIT /?L34
	FSET? PLATYPUS,RMUNGBIT \?L36
	PRINTI "An ""X"" has been drawn"
	JUMP ?L45
?L36:	ZERO? SKEWED? /?L41
	PRINTI "Animal tracks are visible"
	JUMP ?L45
?L41:	PRINTI "Somebody has scrawled a message"
?L45:	PRINTI " in the sand next to the "
	FSET? PIT,OPENBIT \?L50
	PRINTD PIT
	JUMP ?L54
?L50:	PRINTD LEAVES
?L54:	PRINTI "."
?L34:	CRLF
	RTRUE

	.FUNCT ENTER-PIT?
	FSET? PIT,OPENBIT \?L1
	CALL PIT-NOT-WIDE
	RFALSE
?L1:	CALL CANT-GO
	RFALSE

	.FUNCT PIT-NOT-WIDE
	PRINT CANT
	PRINTR " fit into the pit. It's too narrow."

	.FUNCT LAKE-SAND-F
	EQUAL? PRSA,V?LOOK-UNDER,V?SEARCH,V?DIG /?L3
	EQUAL? PRSA,V?LOOK-INSIDE \?L1
?L3:	ZERO? SKEWED? /?L4
	FSET? PLATYPUS,RMUNGBIT \?L4
	FSET? LAKE-SAND,RMUNGBIT /?L4
	MOVE WHISTLE,EDGE-OF-LAKE
	CALL THIS-IS-IT,WHISTLE
	PRINTI "You discovered a "
	PRINTD WHISTLE
	PRINTI " in the sand under the ""X""!"
	CRLF
	JUMP ?L8
?L4:	CALL NOTHING-INTERESTING
?L8:	FSET LAKE-SAND,RMUNGBIT
	FCLEAR LEAVES,RMUNGBIT
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-ON,V?READ,V?EXAMINE /?L10
	EQUAL? PRSA,V?FOLLOW \?L9
?L10:	FSET? LAKE-SAND,RMUNGBIT \?L11
	CALL YOU-ERASED-SAND
	RTRUE
?L11:	FSET? PLATYPUS,RMUNGBIT \?L13
	PRINT YOU-SEE
	PRINTR "an ""X"" drawn in the sand."
?L13:	ZERO? SKEWED? /?L17
	PRINTI "The animal tracks emerge from the lake and lead to the edge of the pit, where they "
	FSET? LAKE-SAND,TOOLBIT \?L21
	PRINTI "turn and head back into the water"
	JUMP ?L25
?L21:	PRINTI "disappear abruptly"
?L25:	PRINTR "."
?L17:	FCLEAR LEAVES,RMUNGBIT
	CALL SAY-THE,SCRAWL
	PRINTR " in the sand reads, ""Do Not Disturb!"""
?L9:	EQUAL? PRSA,V?ENTER,V?THROUGH \?L33
	FSET? LAKE-SAND,RMUNGBIT /?L33
	CALL WASTE-SAND
	RTRUE
?L33:	EQUAL? PRSA,V?TAKE \?L34
	EQUAL? PRSO,LAKE-SAND \?L34
	CALL PERFORM,V?TAKE,SAND
	RTRUE
?L34:	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT \?L35
	EQUAL? PRSI,LAKE-SAND \?L35
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L35:	CALL HURT?,LAKE-SAND >STACK
	ZERO? STACK \?L37
	EQUAL? PRSA,V?RUB \FALSE
?L37:	FSET? LAKE-SAND,RMUNGBIT /FALSE
	CALL WASTE-SAND
	RTRUE

	.FUNCT WASTE-SAND
	FSET LAKE-SAND,RMUNGBIT
	FCLEAR LEAVES,RMUNGBIT
	CALL YOU-ERASED-SAND >STACK
	RSTACK

	.FUNCT YOU-ERASED-SAND
	PRINTR "You rubbed out all the markings in the sand."

	.FUNCT IN-PIT,CONTEXT
	EQUAL? CONTEXT,M-CONT \FALSE
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,BRANCH /FALSE
	PRINT CANT
	PRINTI " reach "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI ". "
	CALL SAY-THE,PIT
	PRINTI " is "
	ZERO? PIT-FULL? /?L9
	PRINTI "full of rainwater"
	JUMP ?L13
?L9:	PRINTI "a little too deep"
?L13:	PRINTI "."
	CRLF
	RETURN 2

	.FUNCT PIT-F
	FSET? PIT,OPENBIT /?L1
	CALL CANT-SEE-ANY,PIT
	RETURN 2
?L1:	CALL THIS-IS-IT,PIT
	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE,V?EXAMINE \?L6
	CALL SAY-THE,PIT
	PRINTI " is "
	ZERO? PIT-FULL? /?L10
	CALL FILLED-PIT
	JUMP ?L12
?L10:	PRINTI "more than five feet deep."
?L12:	FIRST? PIT >STACK \?L15
	PRINTI " "
	PRINT YOU-SEE
	CALL PRINT-CONTENTS,PIT
	PRINTI " in it."
?L15:	CRLF
	RTRUE
?L6:	EQUAL? PRSA,V?HIDE,V?CLOSE \?L22
	PRINT CANT
	PRINTR ". The leaves that used to cover the pit have all blown away."
?L22:	CALL GETTING-INTO? >STACK
	ZERO? STACK /?L25
	CALL PIT-NOT-WIDE
	RTRUE
?L25:	EQUAL? PRSA,V?THROW,V?PUT \?L26
	EQUAL? PRSI,PIT \?L26
	CALL PUTTING-OPEN-UMBRELLA? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSO,BRANCH \?L29
	MOVE BRANCH,PIT
	PRINT OKAY
	PRINTI "the "
	PRINTD BRANCH
	PRINTI " is now standing up inside the"
	ZERO? PIT-FULL? /?L32
	PRINTI " watery"
?L32:	PRINTI " pit."
	CRLF
	IN? PLATYPUS,PIT \TRUE
	FSET PLATYPUS,TOOLBIT
	CRLF
	CALL SAY-THE,PLATYPUS
	PRINTI " grabs onto the bottom of the "
	PRINTD BRANCH
	PRINTR " with its forepaws."
?L29:	ZERO? PIT-FULL? /FALSE
	REMOVE PRSO
	PRINTI "You watch as "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR " sinks into the watery pit."
?L26:	EQUAL? PRSA,V?OPEN \?L50
	CALL ALREADY-OPEN
	RTRUE
?L50:	EQUAL? PRSA,V?EMPTY,V?REACH-IN \FALSE
	PRINT CANT
	PRINTI ". "
	CALL SAY-THE,PIT
	PRINTI " is "
	ZERO? PIT-FULL? /?L56
	CALL FILLED-PIT
	CRLF
	RTRUE
?L56:	PRINTR "too deep."

	.FUNCT FILLED-PIT
	PRINTI "filled with rainwater."
	RTRUE

	.FUNCT LEAVES-F
	FSET? PIT,OPENBIT \?L1
	CALL SAY-THE,LEAVES
	PRINTI " blew away when you disturbed it."
	CRLF
	RETURN 2
?L1:	EQUAL? PRSA,V?TAKE \?L7
	EQUAL? PRSO,LEAVES \?L7
	PRINTR "The leaves slip through your fingers."
?L7:	EQUAL? PRSA,V?EXAMINE \?L10
	CALL SAY-THE,LEAVES
	PRINTR " is crisscrossed with twigs to keep it from blowing away. There seems to be something underneath."
?L10:	EQUAL? PRSA,V?PULL,V?MOVE,V?LOOK-UNDER /?L14
	EQUAL? PRSA,V?KICK,V?SEARCH,V?PUSH /?L14
	EQUAL? PRSA,V?RUB,V?RAISE \?L13
?L14:	EQUAL? PRSO,LEAVES \?L13
	CALL DISTURB-LEAVES? >STACK
	ZERO? STACK \TRUE
	CALL WANT-TO-MUNG? >STACK
	ZERO? STACK /TRUE
	PRINTI "Moving the "
	PRINTD LEAVES
	PRINTI " reveals"
	CALL DESCRIBE-PIT
	RTRUE
?L13:	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?ENTER /?L22
	EQUAL? PRSA,V?CROSS \?L21
?L22:	CALL DISTURB-LEAVES? >STACK
	ZERO? STACK \TRUE
	CALL WANT-TO-MUNG? >STACK
	ZERO? STACK /TRUE
	CALL SAY-THE,LEAVES
	PRINTI " caves in under your feet, revealing"
	CALL DESCRIBE-PIT
	RTRUE
?L21:	EQUAL? PRSA,V?COUNT \FALSE
	CALL COUNT-LEAVES
	RTRUE

	.FUNCT COUNT-LEAVES
	PRINTR "A quick count turns up exactly 69,105 leaves."

	.FUNCT DISTURB-LEAVES?
	FSET? LEAVES,RMUNGBIT \FALSE
	PRINTI "(You'd better read the message in the sand before you disturb the "
	PRINTD LEAVES
	PRINTR ".)"

	.FUNCT WANT-TO-MUNG?
	CALL SAY-SURE
	PRINTI "disturb that "
	PRINTD LEAVES
	PRINTI "? There's an old saying about curiosity..."
	CALL YES? >STACK
	ZERO? STACK \TRUE
	PRINT OKAY
	PRINTI "the leaves are still intact."
	CRLF
	RFALSE

	.FUNCT DESCRIBE-PIT
	FSET PIT,OPENBIT
	PRINTI " a deep, narrow pit in the sand. It appears to be a trap of some kind.

The leaves blow away in the breeze."
	CRLF
	CRLF
	CALL UPDATE-SCORE,-10 >STACK
	RSTACK

	.FUNCT PLATYPUS-F,CONTEXT=0
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,PLATYPUS
	PRINTI " is "
	FSET? PLATYPUS,TOOLBIT \?L5
	PRINTI "clutching the end of the "
	PRINTD BRANCH
	PRINTI " and looking up at you expectantly"
	JUMP ?L9
?L5:	PRINTI "obviously unhappy about being trapped in the pit"
?L9:	PRINTR "."
?L1:	CALL TALKING-TO?,PLATYPUS >STACK
	ZERO? STACK /?L14
	CALL SAY-THE,PLATYPUS
	PRINTI " stares back at you impatiently."
	CRLF
	RETURN 2
?L14:	EQUAL? PRSA,V?GIVE \?L19
	EQUAL? PRSI,PLATYPUS \?L19
	CALL SAY-THE,PLATYPUS
	PRINTR " doesn't seem interested."
?L19:	EQUAL? PRSA,V?RELEASE,V?RESCUE \?L22
	PRINTI "Very thoughtful of you. "
	CALL HOW?
	RTRUE
?L22:	CALL TOUCHING?,PLATYPUS >STACK
	ZERO? STACK /FALSE
	PRINT CANT
	PRINTI " reach the "
	PRINTD PLATYPUS
	PRINTR " while it's in the pit."

	.FUNCT DRAW-X
	CALL START-BUZZ,4
	REMOVE PLATYPUS
	FCLEAR PLATYPUS,TOOLBIT
	FSET PLATYPUS,RMUNGBIT
	FCLEAR LAKE-SAND,RMUNGBIT
	PRINTI "The little creature draws an ""X"" in the "
	ZERO? PIT-FULL? /?L3
	PRINTI "wet "
?L3:	PRINTI "sand with its tail. Then it gives you an oddly dignified nod of thanks, waddles to"
	CALL EDGE
	PRINTR " and disappears into the dark water."

	.FUNCT RIVER-OUTLET-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is where the lake empties into the"
	CALL WHICH-TOWN,STR?197
	PRINTI ". A road leads south along"
	CALL EDGE
	PRINTI ", and bends east to follow the river bank. A narrow "
	PRINTD TRAIL
	PRINTI " leads upward to the top of "
	PRINTD LOOKOUT-HILL
	PRINTR "."

	.FUNCT TRAIL-F
	EQUAL? HERE,CLIFF-BOTTOM \?L1
	ZERO? SKEWED? /?L1
	CALL TRAIL-MISPLACED
	RETURN 2
?L1:	EQUAL? HERE,ROCKY-PATH \?L5
	ZERO? SKEWED? /?L6
	ZERO? HOUSE-VISITED? /?L5
?L6:	CALL CANT-SEE-ANY,TRAIL
	RETURN 2
?L5:	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO /?L10
	EQUAL? PRSA,V?CLIMB-ON,V?USE,V?EXIT \?L9
?L10:	EQUAL? HERE,LOOKOUT-HILL,CLIFF-EDGE \?L11
	CALL DO-WALK,P?DOWN
	RTRUE
?L11:	EQUAL? HERE,RIVER-OUTLET,CLIFF-BOTTOM \?L13
	CALL DO-WALK,P?UP
	RTRUE
?L13:	EQUAL? HERE,ROCKY-PATH \?L14
	CALL DO-WALK,P?SOUTH
	RTRUE
?L14:	EQUAL? HERE,WEST-OF-HOUSE \?L15
	CALL DO-WALK,P?NORTH
	RTRUE
?L15:	CALL V-WALK-AROUND
	RTRUE
?L9:	EQUAL? PRSA,V?CLIMB-DOWN \?L17
	EQUAL? HERE,STEEP-TRAIL,FOG,CLIFF-EDGE /?L20
	EQUAL? HERE,LOOKOUT-HILL \?L18
?L20:	CALL DO-WALK,P?DOWN
	RTRUE
?L18:	EQUAL? HERE,ROCKY-PATH \?L21
	CALL DO-WALK,P?SOUTH
	RTRUE
?L21:	EQUAL? HERE,WEST-OF-HOUSE \?L22
	CALL DO-WALK,P?NORTH
	RTRUE
?L22:	CALL ALREADY-AT,TRAIL
	RTRUE
?L17:	EQUAL? PRSA,V?CLIMB-UP \?L24
	EQUAL? HERE,RIVER-OUTLET,CLIFF-BOTTOM,FOG /?L27
	EQUAL? HERE,STEEP-TRAIL \?L25
?L27:	CALL DO-WALK,P?UP
	RTRUE
?L25:	EQUAL? HERE,ROCKY-PATH \?L28
	CALL DO-WALK,P?SOUTH
	RTRUE
?L28:	EQUAL? HERE,WEST-OF-HOUSE \?L29
	CALL DO-WALK,P?NORTH
	RTRUE
?L29:	CALL ALREADY-AT,TRAIL,1
	RTRUE
?L24:	EQUAL? PRSA,V?LOOK-UP,V?LOOK-DOWN,V?EXAMINE \?L31
	CALL V-LOOK
	RTRUE
?L31:	CALL YOU-DONT-NEED,TRAIL
	RETURN 2

	.FUNCT NORTH-DOWN-HILL
	CALL GET-OFF-STUMP?
	RETURN RIVER-OUTLET

	.FUNCT DOWN-THE-HILL
	FSET? STUMP,OPENBIT \?L1
	PRINTI "(Do you want to go down the north side of the hill, or down into the open stump? Please type NORTH or IN.)"
	CRLF
	SET 'CLOCK-WAIT,1
	RFALSE
?L1:	CALL GET-OFF-STUMP?
	RETURN RIVER-OUTLET

	.FUNCT LOOKOUT-HILL-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "at the summit of a high, barren hill. Looking east, you can see"
	CALL WHICH-TOWN,STR?198
	PRINTI " nestled among the trees. A narrow "
	PRINTD TRAIL
	PRINTI " winds down the north side of the hill, towards the river.

Crowning the hill is the "
	PRINTD STUMP
	PRINTI " of what must have been a very large and majestic oak tree."
	FSET? STUMP,OPENBIT \?L7
	PRINTI " An opening in the "
	PRINTD STUMP
	PRINTI " leads down into "
	PRINTD DARKNESS
	PRINTI "."
?L7:	CRLF
	RTRUE

	.FUNCT STUMP-F
	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L1
	CALL SAY-THE,STUMP
	FSET? STUMP,OPENBIT \?L3
	PRINTI " is open, revealing a round hole that leads "
	EQUAL? HERE,LOOKOUT-HILL \?L7
	PRINTI "downward into "
	PRINTD DARKNESS
	JUMP ?L17
?L7:	PRINTI "upward into moonlight"
	JUMP ?L17
?L3:	PRINTI " is huge, easily four feet across"
	ZERO? SKEWED? /?L17
	FCLEAR STUMP,RMUNGBIT
	PRINTI ". Looking closely, you notice that the edge of the "
	PRINTD STUMP
	PRINTI " is hinged"
?L17:	PRINTR "."
?L1:	EQUAL? PRSA,V?RAISE,V?OPEN \?L24
	FSET? STUMP,OPENBIT \?L25
	CALL ALREADY-OPEN
?L25:	CALL GET-OFF-STUMP?
	ZERO? SKEWED? /?L28
	FSET UNDER-HILL,ONBIT
	SET 'LIT,1
	FSET STUMP,OPENBIT
	FCLEAR STUMP,RMUNGBIT
	PRINTI "Lifting the hinged top of the "
	PRINTD STUMP
	PRINTI " reveals a round hole leading "
	EQUAL? HERE,LOOKOUT-HILL \?L32
	PRINTI "downward into "
	PRINTD DARKNESS
	JUMP ?L39
?L32:	PRINTI "upward into moonlight"
	JUMP ?L39
?L28:	PRINT CANT
	CALL DO-TO
	PRINTI "an ordinary stump"
?L39:	PRINTR "."
?L24:	EQUAL? PRSA,V?LOWER,V?CLOSE \?L46
	FSET? STUMP,OPENBIT \?L47
	FCLEAR STUMP,OPENBIT
	FCLEAR UNDER-HILL,ONBIT
	CALL LIT?,HERE >LIT
	CALL SAY-THE,STUMP
	PRINTI " closes with a hollow bang"
	JUMP ?L51
?L47:	CALL BUT-THE,STUMP
	PRINTI "isn't open"
?L51:	PRINTR "."
?L46:	EQUAL? PRSA,V?PUSH,V?PULL,V?MOVE \?L56
	EQUAL? PRSO,STUMP \?L56
	ZERO? SKEWED? \?L57
	CALL TOO-LARGE,STUMP
	RTRUE
?L57:	FSET? STUMP,OPENBIT \?L59
	CALL PERFORM,V?CLOSE,STUMP
	RTRUE
?L59:	CALL PERFORM,V?OPEN,STUMP
	RTRUE
?L56:	EQUAL? PRSA,V?CLIMB-ON,V?STAND-ON,V?SIT \?L61
	EQUAL? HERE,UNDER-HILL \?L62
	CALL ALREADY-ON,STUMP,1
	RTRUE
?L62:	ZERO? ON-STUMP? /?L64
	CALL ALREADY-ON,STUMP
	RTRUE
?L64:	FSET? STUMP,OPENBIT \?L65
	CALL UNFORTUNATELY
	PRINTI "you forgot to close the "
	PRINTD STUMP
	PRINTI " first. Crash!"
	CALL PRINT-ID,STR?199
	CALL CARRIAGE-RETURNS
	FCLEAR UNDER-HILL,TOUCHBIT
	CALL DO-WALK,P?IN
	RETURN 2
?L65:	SET 'ON-STUMP?,1
	CALL EXCELLENT-VIEW,STUMP
	RTRUE
?L61:	EQUAL? PRSA,V?CLIMB-UP \?L71
	EQUAL? HERE,UNDER-HILL \?L72
	CALL DO-WALK,P?UP
	RTRUE
?L72:	CALL PERFORM,V?SIT,STUMP
	RTRUE
?L71:	EQUAL? PRSA,V?LEAP,V?TAKE-OFF,V?CLIMB-DOWN \?L75
	ZERO? ON-STUMP? /?L76
	SET 'ON-STUMP?,0
	PRINT OKAY
	PRINTI "you're no longer"
	JUMP ?L81
?L76:	FSET? STUMP,OPENBIT \?L80
	EQUAL? HERE,LOOKOUT-HILL \?L80
	CALL DO-WALK,P?IN
	RTRUE
?L80:	PRINTI "But you're not"
?L81:	PRINTI " on the "
	PRINTD STUMP
	PRINTR "."
?L75:	EQUAL? PRSA,V?ENTER,V?THROUGH,V?WALK-TO \?L86
	FSET? STUMP,OPENBIT \?L87
	EQUAL? HERE,LOOKOUT-HILL \?L89
	CALL DO-WALK,P?IN
	RTRUE
?L89:	CALL DO-WALK,P?UP
	RTRUE
?L87:	CALL STUMP-NOT-OPEN
	RTRUE
?L86:	EQUAL? PRSA,V?LOOK-INSIDE \?L93
	FSET? STUMP,OPENBIT \?L94
	CALL CANT-MAKE-OUT-ANYTHING
	RTRUE
?L94:	CALL STUMP-NOT-OPEN
	RTRUE
?L93:	EQUAL? PRSA,V?THROW,V?PUT \FALSE
	EQUAL? PRSI,STUMP \FALSE
	ZERO? SKEWED? \?L98
	CALL WASTE-OF-TIME
	RTRUE
?L98:	FSET? STUMP,OPENBIT /?L100
	CALL ITS-CLOSED,STUMP
	RTRUE
?L100:	EQUAL? PRSO,HANDS \?L101
	CALL NOTHING-EXCITING
	RTRUE
?L101:	CALL PUTTING-OPEN-UMBRELLA? >STACK
	ZERO? STACK \TRUE
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,10 \?L103
	CALL TOO-LARGE,PRSO
	RTRUE
?L103:	EQUAL? HERE,LOOKOUT-HILL \?L104
	MOVE PRSO,UNDER-HILL
	JUMP ?L105
?L104:	MOVE PRSO,LOOKOUT-HILL
?L105:	PRINT OKAY
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " disappears into the "
	PRINTD STUMP
	PRINTR "."

	.FUNCT GET-OFF-STUMP?
	ZERO? ON-STUMP? /FALSE
	SET 'ON-STUMP?,0
	PRINTI "(climbing off the "
	PRINTD STUMP
	PRINTR " first)"

	.FUNCT STUMP-NOT-OPEN
	FSET? STUMP,RMUNGBIT \?L1
	CALL SAY-THE,STUMP
	PRINTR " has no visible openings."
?L1:	CALL ITS-CLOSED,STUMP >STACK
	RSTACK

	.FUNCT SHOE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? SHOE,ONBIT \?L1
	CALL SAY-THE,SHOE
	PRINTR " is twinkling with lucky Magick."
?L1:	EQUAL? PRSA,V?WEAR \?L5
	PRINTR "You don't have any shoeing nails."
?L5:	EQUAL? PRSA,V?PLAY,V?THROW \FALSE
	ZERO? PRSI \FALSE
	PRINTR "This is no time for lawn games."

	.FUNCT LAKE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The surface of the lake is "
	ZERO? SKEWED? /?L5
	PRINTI "black and sinister"
	JUMP ?L9
?L5:	PRINTI "bright with ripples"
?L9:	PRINTR "."
?L1:	CALL HANDLE-WATER? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT ENTER-PLEASURE-WHARF
	ZERO? SKEWED? /?L1
	ZERO? BOX-SEEN? \?L1
	SET 'BOX-SEEN?,1
	CALL QUEUE,I-WAKE-BOX,-1 >STACK
	PUT STACK,0,1
?L1:	RETURN PLEASURE-WHARF

	.FUNCT PLEASURE-WHARF-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "near the "
	ZERO? SKEWED? /?L5
	PRINTI "remains of"
	JUMP ?L9
?L5:	PRINTD ENTRANCE
	PRINTI " to"
?L9:	PRINTI " the "
	PRINTD PLEASURE-WHARF
	ZERO? SKEWED? \?L14
	PRINTI ", the town's most popular tourist attraction"
?L14:	PRINTI ". The Wharf extends eastward into"
	CALL WHICH-TOWN,STR?200
	ZERO? SKEWED? \?L21
	PRINTI ", and a tidal beach curves north along the shore"
?L21:	PRINTI ".

To the south stands a ramshackle old building. Colorful lights, curious electronic sounds and a neon sign beckon you through the open "
	PRINTD ENTRANCE
	PRINTR "."

	.FUNCT ENTER-POOL?
	ZERO? SKEWED? \?L1
	RETURN TIDAL-POOL
?L1:	PRINT CANT
	PRINTI " go that way now. The tide is in."
	CRLF
	RFALSE

	.FUNCT WHARF-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "The sea-worn planks of the"
	CALL WHICH-TOWN
	PRINTI " "
	PRINTD PLEASURE-WHARF
	PRINTI " end abruptly a few feet "
	CALL TO-E >STACK
	PRINT STACK
	PRINTI ". You're surrounded by the "
	ZERO? SKEWED? /?L7
	PRINTI "dark, shark-infested"
	JUMP ?L11
?L7:	PRINTI "blue, sparkling"
?L11:	PRINTI " waters of"
	CALL WHICH-TOWN,STR?200
	PRINTR "."

	.FUNCT ENTER-WHARF
	ZERO? SKEWED? \?L1
	FSET? HORSE,TOUCHBIT /?L1
	CALL QUEUE,I-HORSE-DEATH,-1 >STACK
	PUT STACK,0,1
?L1:	RETURN WHARF

	.FUNCT FALL-OFF-WHARF
	ZERO? SKEWED? /?L1
	CALL SAY-THE,SHARKS
	PRINTI " would gobble you up"
	CALL PRINT-ID,STR?201
	CALL IF-YOU-TRIED
	RFALSE
?L1:	CALL PROBABLY-DROWN
	RFALSE

	.FUNCT SHARKS-F
	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L1
	PRINT YOU-SEE
	PRINTR "their black fins circling in the water nearby."
?L1:	CALL YOU-DONT-NEED,SHARKS
	RETURN 2

	.FUNCT BAY-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The waters of the bay "
	ZERO? SKEWED? /?L5
	PRINTI "swell ominously in the moon"
	JUMP ?L9
?L5:	PRINTI "twinkle merrily in the sun"
?L9:	PRINTR "light."
?L1:	CALL HANDLE-WATER? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT EXIT-ARCADE
	FSET? MACHINE,TOOLBIT \?L1
	CALL QUEUE,I-SMOKE,-1 >STACK
	PUT STACK,0,1
	FCLEAR MACHINE,TOOLBIT
	PRINTI "One of the "
	PRINTD HUMANOIDS
	PRINTI " eagerly takes over your "
	PRINTD MACHINE
	PRINTI " as you walk away."
	CRLF
	CRLF
?L1:	RETURN PLEASURE-WHARF

	.FUNCT VIDEO-ARCADE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This old building is the home of a sleazy "
	PRINTD ARCADE
	PRINTI ", lined with coin-op video games. The machines are "
	ZERO? SKEWED? /?L5
	CALL THIS-IS-IT,HUMANOIDS
	PRINTI "crowded with half-crazed, "
	PRINTD HUMANOIDS
	PRINTI ", who pay no attention to you as they satisfy their thirst for electric violence.

One machine in the "
	PRINTD CORNER
	PRINTI " appears to be deserted"
	JUMP ?L12
?L5:	CALL THIS-IS-IT,MACHINE
	PRINTI "all deserted and quiet"
	FSET? MACHINE,RMUNGBIT /?L12
	PRINTI ", except for one in the "
	PRINTD CORNER
	PRINTI " that emits a feeble ""wokka-wokka"" sound"
?L12:	PRINTI "."
	CRLF
	CRLF
	CALL ARCADE-SIGN >STACK
	RSTACK

	.FUNCT ARCADE-SIGN
	PRINTR "A sign on the wall says, ""All Games One Token."""

	.FUNCT ARCADE-F
	CALL ENTER-FROM?,PLEASURE-WHARF,VIDEO-ARCADE,ARCADE >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE,V?LOOK-ON \?L3
	EQUAL? HERE,PLEASURE-WHARF \?L4
	CALL GO-INSIDE
	RTRUE
?L4:	CALL V-LOOK
	RTRUE
?L3:	EQUAL? PRSA,V?OPEN \?L7
	CALL ALREADY-OPEN
	RTRUE
?L7:	EQUAL? PRSA,V?CLOSE \FALSE
	PRINT CANT
	PRINTI " close the "
	PRINTD ARCADE
	PRINTR " (though many have tried)."

	.FUNCT HUMANOIDS-F,CONTEXT=0
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "They have extraordinarily supple wrists, fast reflexes and tiny brains."
?L1:	CALL TALKING-TO?,HUMANOIDS >STACK
	ZERO? STACK \?L6
	EQUAL? PRSA,V?YELL,V?FEED,V?GIVE \?L5
?L6:	CALL SAY-THE,HUMANOIDS
	PRINTI " pay no attention."
	CRLF
	RETURN 2
?L5:	CALL HURT?,HUMANOIDS >STACK
	ZERO? STACK /?L11
	PRINTI "Why bother? The "
	PRINTD HUMANOIDS
	PRINTR " will soon be extinct anyway."
?L11:	CALL YOU-DONT-NEED,HUMANOIDS
	RETURN 2

	.FUNCT MACHINE-F
	EQUAL? PRSA,V?LOOK-ON,V?READ,V?EXAMINE \?L1
	CALL SAY-THE,MACHINE
	PRINTI " is equipped with a video screen, a joystick, a big red button and a narrow slot for tokens. A lurid logo ("""
	ZERO? SKEWED? /?L5
	PRINTI "TRANSMATTER"
	JUMP ?L9
?L5:	PRINTI "LEATHER GODDESSES OF PHOBOS"
?L9:	PRINTR "!"") is painted on the side."
?L1:	EQUAL? PRSA,V?KICK,V?LISTEN \?L14
	FSET? MACHINE,RMUNGBIT \?L15
	CALL NOTHING-EXCITING
	RTRUE
?L15:	ZERO? SKEWED? /?L17
	CALL SAY-THE,MACHINE
	PRINTR " emits a familiar electronic dirge."
?L17:	PRINTR """Wokka."""
?L14:	CALL PUT-THING-IN-SLOT? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-INSIDE,V?CLOSE,V?OPEN \?L24
	PRINTI "Only an authorized service representative of the "
	CALL PRINT-ID,STR?202
	CALL FROBOZZ,STR?203
	PRINTR " could do that."
?L24:	CALL BREAK-MACHINE? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?PLAY \FALSE
	CALL HOW?
	RTRUE

	.FUNCT VIDEO-SCREEN-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	CALL SAY-THE,VIDEO-SCREEN
	ZERO? SKEWED? /?L5
	FSET? MACHINE,RMUNGBIT \?L3
?L5:	PRINTR " is dark."
?L3:	PRINTI " displays a map of"
	CALL WHICH-TOWN,STR?198
	PRINTI ". A grid divides the map into 13 squares"
	FSET? MACHINE,TOOLBIT \?L13
	PRINTI ", and a "
	PRINTD STAR
	PRINTI " is centered over one of the squares"
	JUMP ?L17
?L13:	PRINTI ". The words ""Insert Token To Play"" are scrolling across the top of the screen"
?L17:	PRINTI "."
	CRLF
	CRLF
	CALL FIND-IN-PACKAGE,STR?204
	RTRUE
?L1:	CALL BREAK-MACHINE? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT BREAK-MACHINE?
	FSET? MACHINE,RMUNGBIT /FALSE
	EQUAL? PRSA,V?SHAKE,V?MOVE,V?PUSH \?L3
	FSET? MACHINE,TOOLBIT \?L3
	PRINTI "An electric alarm shrieks, ""Tilt!"""
	CRLF
	CALL PRINT-ID,STR?205
	CALL GAME-OVER
	RTRUE
?L3:	EQUAL? PRSA,V?THROW \?L7
	EQUAL? PRSI,MACHINE \?L7
	MOVE PRSO,HERE
	CALL MUNG-MACHINE
	RTRUE
?L7:	CALL HURT?,MACHINE >STACK
	ZERO? STACK /FALSE
	CALL MUNG-MACHINE
	RTRUE

	.FUNCT MUNG-MACHINE
	FCLEAR MACHINE,TOOLBIT
	FSET MACHINE,RMUNGBIT
	PRINTI "A shower of sparks erupts from the back of the "
	PRINTD MACHINE
	PRINTI ", and the "
	PRINTD VIDEO-SCREEN
	PRINTI " goes black."
	CRLF
	CALL PRINT-ID,STR?206 >STACK
	RSTACK

	.FUNCT STAR-F
	FSET? MACHINE,TOOLBIT /?L1
	CALL CANT-SEE-ANY
	RETURN 2
?L1:	EQUAL? PRSA,V?READ,V?EXAMINE \?L5
	CALL SAY-THE,STAR
	PRINTI " is now centered over square "
	GET H-NAMES,HORZ >STACK
	PRINT STACK
	PRINTI "-"
	PRINTN VERT
	PRINTR " on the map."
?L5:	EQUAL? PRSA,V?PUSH,V?PULL,V?MOVE \?L8
	CALL HOW?
	RTRUE
?L8:	EQUAL? PRSA,V?PUSH-TO \FALSE
	PRINTI "(with the "
	PRINTD JOYSTICK
	PRINTI ")"
	CRLF
	CALL PERFORM,V?PUSH-TO,JOYSTICK,PRSI
	RTRUE

	.FUNCT SLOT-F
	EQUAL? PRSA,V?LOOK-ON,V?READ,V?EXAMINE \?L1
	PRINTR "The narrow slot is marked ""Tokens Only!"""
?L1:	CALL PUT-THING-IN-SLOT? >STACK
	ZERO? STACK \TRUE
	CALL BREAK-MACHINE? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L7
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L7:	EQUAL? PRSA,V?LOOK-BEHIND,V?LOOK-INSIDE \FALSE
	CALL TOO-DARK
	RTRUE

	.FUNCT PUT-THING-IN-SLOT?
	EQUAL? PRSA,V?REACH-IN /?L3
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,TOKEN /FALSE
?L3:	CALL SAY-THE,SLOT
	PRINTR " is too narrow."

	.FUNCT JOYSTICK-F
	EQUAL? PRSA,V?PUSH-TO \?L1
	EQUAL? PRSI,INTDIR \?L1
	FSET? MACHINE,TOOLBIT /?L3
	CALL NOTHING-EXCITING
	RTRUE
?L3:	EQUAL? P-DIRECTION,P?NORTH,P?UP \?L5
	EQUAL? HORZ,1,5 /?L8
	EQUAL? VERT,1 /?L8
	EQUAL? HORZ,2,4 \?L6
	EQUAL? VERT,2 \?L6
?L8:	CALL JOYBUZZ
	RTRUE
?L6:	DEC 'VERT
	CALL MOVE-STAR,STR?207
	RTRUE
?L5:	EQUAL? P-DIRECTION,P?SOUTH,P?DOWN \?L10
	EQUAL? HORZ,1,5 /?L13
	EQUAL? VERT,5 /?L13
	EQUAL? HORZ,2,4 \?L11
	EQUAL? VERT,4 \?L11
?L13:	CALL JOYBUZZ
	RTRUE
?L11:	INC 'VERT
	CALL MOVE-STAR,STR?208
	RTRUE
?L10:	EQUAL? P-DIRECTION,P?EAST \?L15
	EQUAL? VERT,1,5 /?L18
	EQUAL? HORZ,5 /?L18
	EQUAL? VERT,2,4 \?L16
	EQUAL? HORZ,4 \?L16
?L18:	CALL JOYBUZZ
	RTRUE
?L16:	INC 'HORZ
	CALL MOVE-STAR,STR?209
	RTRUE
?L15:	EQUAL? P-DIRECTION,P?WEST \FALSE
	EQUAL? VERT,1,5 /?L23
	EQUAL? HORZ,1 /?L23
	EQUAL? VERT,2,4 \?L21
	EQUAL? HORZ,2 \?L21
?L23:	CALL JOYBUZZ
	RTRUE
?L21:	DEC 'HORZ
	CALL MOVE-STAR,STR?210
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L26
	CALL SAY-THE,JOYSTICK
	PRINTR " can be moved north, south, east or west."
?L26:	EQUAL? PRSA,V?PULL,V?MOVE,V?PUSH /?L30
	EQUAL? PRSA,V?PLAY,V?USE \?L29
?L30:	PRINTI "(To use the "
	PRINTD JOYSTICK
	PRINTI ", you must indicate a compass direction as well as an action. For example, try MOVE THE JOYSTICK TO THE WEST or PUSH STICK NORTH.)"
	CRLF
	RETURN 2
?L29:	CALL BREAK-MACHINE? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT JOYBUZZ
	PRINTI "Buzz! A synthetic voice growls, ""Keep the "
	PRINTD STAR
	PRINTR " inside the grid!"""

	.FUNCT MOVE-STAR,STR
	PRINTI "Bing! You moved the "
	PRINTD STAR
	PRINTI " one square "
	PRINT STR
	PRINTR "."

	.FUNCT BUTTON-F
	EQUAL? PRSA,V?PUSH \?L1
	EQUAL? HERE,VIDEO-ARCADE /?L3
	CALL CANT-SEE-ANY,BUTTON
	RTRUE
?L3:	CALL SAY-SURE
	PRINTI "push the "
	PRINTD BUTTON
	PRINTI "?"
	CALL YES? >STACK
	ZERO? STACK /?L26
	CRLF
	ZERO? SKEWED? /?L10
	CALL SAY-THE,HUMANOIDS
	PRINTI " in the "
	PRINTD ARCADE
	PRINTI " "
	CALL PICK-ONE,POSSIBILITIES >STACK
	PRINT STACK
	PRINTI " as "
	PRINTD HANDS
	PRINTI " touches the "
	FSET? MACHINE,TOOLBIT \?L14
	PRINTI "flashing "
?L14:	PRINTI "button. This might be a trap"
	JUMP ?L21
?L10:	PRINTI "You don't know what this "
	PRINTD MACHINE
	PRINTI " might do"
?L21:	PRINTI "! You don't really want to press that "
	PRINTD BUTTON
	PRINTI ", do you?"
	CALL YES? >STACK
	ZERO? STACK /?L26
	CALL PRESS-BUTTON
	RTRUE
?L26:	CALL THAT-WAS-CLOSE
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L30
	FSET? MACHINE,TOOLBIT \?L30
	PRINTR "It's flashing on and off rapidly."
?L30:	CALL BREAK-MACHINE? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT PRESS-BUTTON,WHERE
	CRLF
	PRINTI "("
	FSET? MACHINE,TOOLBIT \?L3
	GET DESTINATIONS,HORZ >STACK
	GET STACK,VERT >WHERE
	CALL QUEUE,I-SMOKE,-1 >STACK
	PUT STACK,0,1
	PRINTI "Hope you saved your story position.)

A sudden power drain makes all the other games in the "
	PRINTD ARCADE
	PRINTI " go dim. Blue sheets of energy leap from the "
	PRINTD MACHINE
	PRINTI ", surrounding you in an incandescent aura."
	EQUAL? WHERE,VIDEO-ARCADE /?L7
	EQUAL? WHERE,INSIDE-GRAVE \?L9
	CALL MOVE-ALL,OPEN-GRAVE,INSIDE-GRAVE
?L9:	MOVE PROTAGONIST,WHERE
	SET 'HERE,WHERE
	PRINTI " You can feel your molecules being taken apart one at a time, analyzed, modulated and broadcast through space. It is not a pleasant sensation."
	CALL CARRIAGE-RETURNS
	CALL V-LOOK
	JUMP ?L14
?L7:	CRLF
	CRLF
	CALL MUNG-MACHINE
?L14:	CALL GAME-OVER
	EQUAL? WHERE,HILLTOP \FALSE
	CRLF
	CALL UPDATE-SCORE,5 >STACK
	RSTACK
?L3:	PRINT OKAY
	PRINTI "just testing you.)"
	CRLF
	CRLF
	CALL NOTHING-EXCITING >STACK
	RSTACK

	.FUNCT GAME-OVER
	FCLEAR MACHINE,TOOLBIT
	CRLF
	PRINTR "A synthetic voice says, ""Game Over. Insert Token To Play Again."""

	.FUNCT TOKEN-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTI "The words ""Good For One Play"" are etched into the "
	PRINTD TOKEN
	PRINTR "."
?L1:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,MACHINE,SLOT \FALSE
	REMOVE TOKEN
	CALL SAY-THE,TOKEN
	PRINTI " disappears into the slot"
	FSET? MACHINE,RMUNGBIT \?L8
	PRINTI ", but the broken "
	PRINTD MACHINE
	PRINTI " doesn't respond."
	CRLF
	CALL PRINT-ID,STR?211
	RTRUE
?L8:	FSET MACHINE,TOOLBIT
	PRINTI ".

Ding! You hear a pleasant electric chime, and a "
	PRINTD STAR
	PRINTI " appears on the "
	PRINTD VIDEO-SCREEN
	PRINTI "."
	CRLF
	CRLF
	CALL PRINT-ID,STR?212
	CALL UPDATE-SCORE,1
	CALL GOOD-PLACE-TO-SAVE
	RTRUE

	.FUNCT TIDAL-POOL-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're on a damp stretch of sand that extends north towards Festeron Point, and south to the "
	PRINTD PLEASURE-WHARF
	PRINTR "."

	.FUNCT CONCH-SHELL-F
	EQUAL? PRSA,V?LISTEN \?L1
	CALL DONT-HAVE?,CONCH-SHELL >STACK
	ZERO? STACK \TRUE
	ZERO? WOMAN-SEEN-ENVELOPE? \?L6
	FSET? CONCH-SHELL,RMUNGBIT \?L6
	FCLEAR CONCH-SHELL,RMUNGBIT
	CALL TINY-VOICE
	PRINTI " that sounds just like"
	CALL BOSS
	PRINTI ", "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI ", """
	CALL HELD?,ENVELOPE >STACK
	ZERO? STACK /?L12
	PRINTI "Don't just stand there! DELIVER"
	JUMP ?L16
?L12:	PRINTI "You "
	CALL PICK-ONE,INSULTS >STACK
	PRINT STACK
?L16:	PRINTR "!"""
?L6:	CALL ENABLED?,I-SHELL-TALK >STACK
	ZERO? STACK /?L21
	LESS? SHELL-SCRIPT,5 \?L21
	FCLEAR CONCH-SHELL,RMUNGBIT
	SET 'SHELL-SCRIPT,1
	CALL TINY-VOICE
	PRINTI " says, """
	GET WISE-SAYINGS,WISDOM >STACK
	PRINT STACK
	PRINTR "."""
?L21:	PRINT YOU-HEAR
	PRINTR "the rush of ocean surf."
?L1:	EQUAL? PRSA,V?BLOW-INTO \?L27
	CALL DONT-HAVE?,CONCH-SHELL >STACK
	ZERO? STACK \TRUE
	CALL SAY-THE,CONCH-SHELL
	PRINTR " makes an embarrassing sound."
?L27:	EQUAL? PRSA,V?LOOK-INSIDE,V?SHAKE \?L33
	CALL DONT-HAVE?,CONCH-SHELL >STACK
	ZERO? STACK \TRUE
	PRINTR "A few grains of sand fall out."
?L33:	EQUAL? PRSA,V?PUT \?L39
	EQUAL? PRSI,CONCH-SHELL \?L39
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,1 \?L40
	CALL TOO-LARGE,PRSO
	RTRUE
?L40:	PRINTI "It immediately drops out"
	CALL AND-DROPS-OUT,PRSO
	RTRUE
?L39:	EQUAL? PRSA,V?EXAMINE \?L45
	CALL SAY-THE,CONCH-SHELL
	PRINTI " is smooth and shiny. It"
	CALL TV-SET
	PRINTR "."
?L45:	EQUAL? PRSA,V?TAKE \?L50
	EQUAL? PRSO,CONCH-SHELL \?L50
	CALL V-TAKE >STACK
	ZERO? STACK /TRUE
	IN? WISHBRINGER,PROTAGONIST \TRUE
	FSET? ADVICE,TOUCHBIT \TRUE
	CALL START-BUZZ
	RTRUE
?L50:	EQUAL? PRSA,V?OPEN,V?CLOSE \?L54
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L54:	CALL HURT?,CONCH-SHELL >STACK
	ZERO? STACK /FALSE
	CALL PRINT-ID,STR?213
	CALL RUIN,CONCH-SHELL
	RTRUE

	.FUNCT TV-SET,MY?=0
	PRINTI "'ll look great on "
	ZERO? MY? /?L3
	PRINTI "my"
	JUMP ?L7
?L3:	PRINTI "your"
?L7:	PRINTI " TV set back home"
	RTRUE

	.FUNCT TINY-VOICE
	PRINTI "A tiny voice in the "
	PRINTD CONCH-SHELL
	RTRUE

	.FUNCT START-BUZZ,SAYING=0
	ZERO? SAYING /?L1
	SET 'WISDOM,SAYING
?L1:	FSET? ADVICE,TOUCHBIT \FALSE
	IN? CONCH-SHELL,PROTAGONIST \FALSE
	IN? WISHBRINGER,PROTAGONIST \FALSE
	CALL ENABLED?,I-SHELL-TALK >STACK
	ZERO? STACK \FALSE
	SET 'SHELL-SCRIPT,7
	CALL QUEUE,I-SHELL-TALK,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT SAND-F
	EQUAL? PRSA,V?DIG,V?EXAMINE,V?SEARCH /?L3
	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?LOOK-UNDER \?L1
?L3:	CALL NOTHING-INTERESTING
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L4
	CALL SAY-THE,SAND
	PRINTR " slips away between your fingers."
?L4:	EQUAL? PRSA,V?CROSS,V?WALK-TO,V?FOLLOW /?L8
	EQUAL? PRSA,V?EXIT,V?ENTER,V?THROUGH \?L7
?L8:	EQUAL? HERE,PLEASURE-WHARF \?L9
	CALL DO-WALK,P?NORTH
	RTRUE
?L9:	EQUAL? HERE,FESTERON-POINT \?L11
	CALL DO-WALK,P?SOUTH
	RTRUE
?L11:	CALL V-WALK-AROUND
	RTRUE
?L7:	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT \?L13
	EQUAL? PRSI,SAND \?L13
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L13:	EQUAL? PRSA,V?KICK /FALSE
	CALL YOU-DONT-NEED,SAND
	RETURN 2

	.FUNCT FESTERON-POINT-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is where the river empties into"
	CALL WHICH-TOWN,STR?200
	PRINTI ". A"
	ZERO? SKEWED? \?L7
	PRINTI " beach follows the shore of the bay "
	CALL TO-S >STACK
	PRINT STACK
	PRINTI ", and a"
?L7:	PRINTI " path leads west along the riverbank.

A "
	ZERO? SKEWED? /?L14
	PRINTI "broken-down old "
	JUMP ?L18
?L14:	PRINTI "miniature "
?L18:	PRINTD LIGHTHOUSE
	PRINTI ", barely ten feet high, stands "
	ZERO? SKEWED? \?L23
	PRINTI "blinking "
?L23:	PRINTI "on the shore nearby."
	CRLF
	IN? PELICAN,FESTERON-POINT \FALSE
	CRLF
	CALL NOTE-PELICAN >STACK
	RSTACK

	.FUNCT NOTE-PELICAN
	PRINTI "Perched on top of the "
	PRINTD LIGHTHOUSE
	PRINTI " is a "
	PRINTD PELICAN
	PRINTI ", "
	IN? HAT,PELICAN \?L3
	CALL A-WIZARDS-HAT
	CRLF
	RTRUE
?L3:	PRINTR "watching you through half-closed eyelids."

	.FUNCT A-WIZARDS-HAT
	PRINTI "a "
	PRINTD HAT
	PRINTR " balanced on its head."

	.FUNCT LIGHTHOUSE-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	PRINTI "It's really just an automated beacon, erected by the town to impress tourists. "
	CALL NO-ENTRIES
	IN? PELICAN,FESTERON-POINT \TRUE
	CRLF
	CALL NOTE-PELICAN
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-ON \?L8
	IN? PELICAN,FESTERON-POINT \?L8
	CALL NOTE-PELICAN
	RTRUE
?L8:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L9
	EQUAL? PRSI,LIGHTHOUSE \?L9
	IN? PELICAN,FESTERON-POINT /?L10
	MOVE PRSO,FESTERON-POINT
	PRINTI "It slides off the "
	PRINTD LIGHTHOUSE
	PRINTR " and lands at your feet."
?L10:	EQUAL? PRSO,DHORSE,WORM,HAT /?L15
	EQUAL? PRSO,WISHBRINGER,CHOCOLATE,MILK \?L14
?L15:	CALL PERFORM,V?GIVE,PRSO,PELICAN
	RTRUE
?L14:	MOVE PRSO,FESTERON-POINT
	CALL SAY-THE,PELICAN
	PRINTI " pushes "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " off the "
	PRINTD LIGHTHOUSE
	PRINTR " with its beak and glares at you."
?L9:	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO /?L22
	EQUAL? PRSA,V?PUT \?L21
?L22:	EQUAL? PRSO,LIGHTHOUSE \?L21
	CALL NO-ENTRIES
	RTRUE
?L21:	EQUAL? PRSA,V?STAND-ON,V?LIE-DOWN,V?SIT /?L24
	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON \?L23
?L24:	IN? PELICAN,FESTERON-POINT \?L25
	CALL THIS-IS-IT,PELICAN
	CALL SAY-THE,PELICAN
	PRINTI " rudely nudges you off with its foot"
	JUMP ?L29
?L25:	PRINTI "There isn't enough room"
?L29:	PRINTR "."
?L23:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT NO-ENTRIES
	PRINTI "There aren't any "
	PRINTD ENTRANCE
	PRINTR "s or openings."

	.FUNCT BACK-TO-ROCKY-PATH
	CALL ENABLED?,I-WAKE-SMALL-BOX >STACK
	ZERO? STACK /?L1
	PRINTI "The spectacle of the "
	PRINTD SMALL-BOX
	PRINTI " has you frozen in your tracks."
	CRLF
	RFALSE
?L1:	PRINTI "As the house disappears into the distance, you get the distinct feeling that, someday, you will pass this way again."
	CALL CARRIAGE-RETURNS
	RETURN ROCKY-PATH

	.FUNCT BOARDS-ARE-SECURE
	CALL SAY-THE,HOUSE-DOOR
	PRINTI " is securely closed."
	CRLF
	RFALSE

	.FUNCT WHITE-HOUSE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "This place has seen better days. Its stately colonial architecture reflects the taste and wealth of its builders. But eons of trespassing by thoughtless adventurers have left the once noble edifice in ruins."
?L1:	EQUAL? PRSA,V?MUNG,V?OPEN,V?LOOK-INSIDE /?L6
	EQUAL? PRSA,V?ENTER,V?THROUGH \FALSE
?L6:	CALL PRINT-ID,STR?214
	CALL BOARDS-ARE-SECURE
	RTRUE

	.FUNCT HOUSE-DOOR-F
	CALL HURT?,HOUSE-DOOR >STACK
	ZERO? STACK \?L3
	EQUAL? PRSA,V?OPEN \?L1
?L3:	CALL PRINT-ID,STR?215
	CALL BOARDS-ARE-SECURE
	RTRUE
?L1:	CALL USE-DOOR?,WEST-OF-HOUSE >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT LEAFLET-F
	EQUAL? PRSA,V?EXAMINE,V?LOOK-ON,V?READ \?L1
	IN? LEAFLET,PROTAGONIST \?L3
	PRINTI "It seems to be a junk-mail ad for a primitive computer game. The cancelled stamp on the "
	PRINTD LEAFLET
	CALL TOO-FADED
	RTRUE
?L3:	CALL YOUD-HAVE-TO,STR?216,LEAFLET
	RTRUE
?L1:	CALL HURT?,LEAFLET >STACK
	ZERO? STACK /FALSE
	CALL PRINT-ID,STR?217
	CALL RUIN,LEAFLET
	RTRUE

	.FUNCT FOREST-PSEUDO
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	PRINTI "It's "
	ZERO? HOUSE-VISITED? \?L5
	PRINTI "almost "
?L5:	PRINTR "impenetrable."
?L1:	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?ENTER \?L12
	CALL DO-WALK,P?SOUTH
	RTRUE
?L12:	CALL YOU-DONT-NEED,STR?218,1
	RETURN 2

	.FUNCT ROCKY-PATH-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're on a rocky path that runs east and west along the banks of the"
	CALL WHICH-TOWN,STR?197
	PRINTI ". A "
	ZERO? SKEWED? /?L7
	ZERO? HOUSE-VISITED? \?L7
	PRINTI "shimmering "
	PRINTD TRAIL
	PRINTI " leads south into a dense forest"
	JUMP ?L11
?L7:	PRINTI "dense, impenetrable forest borders the south edge of the path"
?L11:	PRINTR "."

	.FUNCT ENTER-HOUSE?
	ZERO? SKEWED? /?L1
	ZERO? HOUSE-VISITED? \?L1
	PRINTI "As you walk along the shimmering "
	PRINTD TRAIL
	PRINTI " you feel a vague sense of disorientation, then a shock of recognition..."
	CALL CARRIAGE-RETURNS
	RETURN WEST-OF-HOUSE
?L1:	PRINT CANT
	PRINTI " enter an impenetrable forest."
	CRLF
	RFALSE

	.FUNCT RIVER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The current looks swift and "
	ZERO? SKEWED? /?L5
	PRINTI "murky"
	JUMP ?L9
?L5:	PRINTI "clean"
?L9:	PRINTR "."
?L1:	EQUAL? PRSA,V?CROSS \?L14
	EQUAL? HERE,SOUTH-OF-BRIDGE \?L15
	CALL DO-WALK,P?NORTH
	RTRUE
?L15:	EQUAL? HERE,NORTH-OF-BRIDGE \?L17
	CALL DO-WALK,P?SOUTH
	RTRUE
?L17:	CALL V-WALK-AROUND
	RTRUE
?L14:	CALL HANDLE-WATER? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT SOUTH-OF-BRIDGE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is the south side of a "
	PRINTD BRIDGE
	PRINTI " that spans the"
	CALL WHICH-TOWN,STR?197
	PRINTI ". Paths lead off "
	CALL TO-E >STACK
	PRINT STACK
	PRINTI " and west, and a road leads south to the "
	PRINTD FESTERON
	PRINTR "."

	.FUNCT GO-ON-BRIDGE
	SET 'WHERE-FROM,SOUTH-OF-BRIDGE
	RETURN ON-BRIDGE

	.FUNCT ON-BRIDGE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're on a "
	PRINTD BRIDGE
	PRINTI " that spans the"
	CALL WHICH-TOWN,STR?197
	PRINTR ". A sign hangs on an arch overhead."

	.FUNCT OFF-BRIDGE
	ZERO? SKEWED? /?L1
	IN? TROLL,NORTH-OF-BRIDGE \?L1
	FCLEAR TOLL-GATE,OPENBIT
	CALL QUEUE,I-SHUT-GATE,-1 >STACK
	PUT STACK,0,1
?L1:	RETURN NORTH-OF-BRIDGE

	.FUNCT I-SHUT-GATE
	CALL INT,I-SHUT-GATE >STACK
	PUT STACK,0,0
	CRLF
	CALL SAY-THE,TROLL
	PRINTI " lowers the "
	PRINTD TOLL-GATE
	PRINTR " after you pass."

	.FUNCT BRIDGE-F
	EQUAL? PRSA,V?THROUGH,V?WALK-TO,V?CROSS /?L3
	EQUAL? PRSA,V?ENTER \?L1
?L3:	EQUAL? HERE,SOUTH-OF-BRIDGE \?L4
	CALL DO-WALK,P?NORTH
	RTRUE
?L4:	EQUAL? HERE,NORTH-OF-BRIDGE \?L6
	CALL DO-WALK,P?SOUTH
	RTRUE
?L6:	EQUAL? HERE,ON-BRIDGE \FALSE
	CALL V-WALK-AROUND
	RTRUE
?L1:	EQUAL? PRSA,V?LEAP \?L9
	EQUAL? HERE,ON-BRIDGE \?L10
	CALL PRINT-ID,STR?219
	CALL PERFORM,V?KILL,ME
	RTRUE
?L10:	CALL ALREADY-ON,BRIDGE,1
	RTRUE
?L9:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	CALL PERFORM,V?EXAMINE,RIVER
	RTRUE

	.FUNCT BRIDGE-SIGN-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	CRLF
	CALL FIXED-FONT-ON
	PRINTI "   "
	EQUAL? WHERE-FROM,SOUTH-OF-BRIDGE \?L5
	PRINTI "LEAV"
	JUMP ?L9
?L5:	PRINTI "ENTER"
?L9:	PRINTI "ING "
	ZERO? SKEWED? /?L14
	PRINTI "WITCHVILLE"
	JUMP ?L18
?L14:	PRINTI "FESTERON"
?L18:	CRLF
	CRLF
	ZERO? SKEWED? /?L23
	PRINTI "  Curfew Begins At 6 PM
   Boot Patrol On Duty
Violators Will Be Jailed!"
	JUMP ?L27
?L23:	EQUAL? WHERE-FROM,SOUTH-OF-BRIDGE \?L28
	PRINTI "Next Time You're In Town"
	CRLF
?L28:	PRINTI "  Visit Our Fun-Filled"
	CRLF
	PRINTI "     "
	PRINTD PLEASURE-WHARF
?L27:	CRLF
	CALL FIXED-FONT-OFF
	RTRUE

	.FUNCT NORTH-OF-BRIDGE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "This is the north side of the"
	CALL WHICH-TOWN,STR?220
	PRINTI ". Sheer cliff walls rise abruptly "
	CALL TO-N >STACK
	PRINT STACK
	PRINTI " and west. A path wanders east along the shore of the river."
	ZERO? SKEWED? /?L13
	CRLF
	CRLF
	PRINTI "A rickety "
	PRINTD TOLL-GATE
	PRINTI " has been thrown up across the "
	PRINTD ENTRANCE
	PRINTI " to the "
	PRINTD BRIDGE
	PRINTI ". A handpainted sign is nailed to the middle of the"
	CALL OPEN-CLOSED,TOLL-GATE
	PRINTI "gate."
	IN? TROLL,NORTH-OF-BRIDGE \?L13
	CALL THIS-IS-IT,TROLL
	CRLF
	CRLF
	PRINTI "Standing near the "
	PRINTD TOLL-GATE
	PRINTI " is an ugly, gnomelike creature. A less original story would probably refer to it as a troll."
?L13:	CRLF
	RTRUE

	.FUNCT ENTER-BRIDGE?
	SET 'WHERE-FROM,NORTH-OF-BRIDGE
	ZERO? SKEWED? \?L1
	RETURN ON-BRIDGE
?L1:	FSET? TOLL-GATE,OPENBIT \?L3
	LESS? WISDOM,3 \?L8
	FSET? LAKE-SAND,TOOLBIT \?L6
	CALL START-BUZZ,4
	JUMP ?L8
?L6:	CALL START-BUZZ,3
?L8:	FSET TROLL,RMUNGBIT
	RETURN ON-BRIDGE
?L3:	IN? TROLL,NORTH-OF-BRIDGE \?L11
	CALL THIS-IS-IT,TROLL
	PRINTI """"
	CALL PICK-ONE,TOLL-DEMANDS >STACK
	PRINT STACK
	PRINTI """ croaks the troll, palm outstretched."
	CRLF
	RFALSE
?L11:	CALL ITS-CLOSED,TOLL-GATE
	RFALSE

	.FUNCT TROLL-F,CONTEXT=0
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,TROLL
	PRINTI " is staring "
	ZERO? ECLIPSE? /?L5
	PRINTI "fearfully upward"
	JUMP ?L9
?L5:	PRINTI "back at you stupidly"
?L9:	PRINTR "."
?L1:	EQUAL? PRSA,V?GIVE \?L14
	EQUAL? PRSI,TROLL \?L14
	ZERO? ECLIPSE? /?L15
	CALL TROLL-NOT-INTERESTED
	RTRUE
?L15:	EQUAL? PRSO,COIN \?L17
	ZERO? COIN-OFFERED? /?L18
	REMOVE COIN
	CALL SAY-THE,TROLL
	PRINTI " angrily tosses your "
	PRINTD COIN
	PRINTR " into the river and mutters something indelicate about counterfeiters."
?L18:	SET 'COIN-OFFERED?,1
	CALL SAY-THE,TROLL
	PRINTI " snatches away your "
	PRINTD COIN
	PRINTI " with a grunt"
	ZERO? LUCKY? /?L25
	MOVE COIN,TROLL
	FSET TOLL-GATE,OPENBIT
	FCLEAR TROLL,RMUNGBIT
	CALL THIS-IS-IT,BRIDGE
	CALL START-BUZZ,3
	PRINTI ". Luckily, he hides it away without looking at it and opens the "
	PRINTD TOLL-GATE
	PRINTR ". ""Pass."""
?L25:	MOVE COIN,NORTH-OF-BRIDGE
	CALL THIS-IS-IT,COIN
	PRINTI " and squints at it suspiciously. ""Ugh!"" he cries, holding it up to the moonlight. ""This is a fake!"" He points accusingly at the familiar"
	CALL SAY-PROFILE
	PRINTI ", throws your coin to the "
	PRINTD GROUND
	PRINTI " and pulls out another. ""This is what an OFFICIAL "
	PRINTD COIN
	PRINTI " looks like!""

The "
	PRINTD TROLL
	PRINTI " proudly exhibits his coin. It shows the profile of an evil-looking "
	PRINTD OLD-WOMAN
	PRINTI "."
	CRLF
	RETURN 2
?L17:	EQUAL? PRSO,SNAKE-CAN \?L38
	FSET? SNAKE-CAN,OPENBIT /?L38
	CALL SAY-THE,SNAKE-CAN
	PRINTI " rattles as you hand it to the "
	PRINTD TROLL
	PRINTI ". "
	FSET? TROLL,TOOLBIT \?L41
	FCLEAR TROLL,TOOLBIT
	FSET SNAKE-CAN,OPENBIT
	PRINTI """Mmm, yummy!"" he exclaims, peering at the label and then greedily opening the lid..."
	CRLF
	CRLF
?L41:	ZERO? SNAKE-GONE? /?L46
	MOVE SNAKE-CAN,HERE
	PRINTI """Hurumph!"" he growls, pitching the can to the "
	PRINTD GROUND
	PRINTI ". ""Not funny!"""
	CRLF
	CALL PRINT-ID,STR?221
	RETURN 2
?L46:	PRINTI "Yow! As he opens"
	CALL PRINT-ID,STR?222
	CALL SNAKE-LEAPS-OUT-AT,STR?223
	CALL CAN-FALLS
	CALL FRIGHTEN-TROLL
	CRLF
	CALL UPDATE-SCORE,3
	RETURN 2
?L38:	MOVE PRSO,NORTH-OF-BRIDGE
	CALL SAY-THE,TROLL
	PRINTI " studies "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " closely to see if it resembles a "
	PRINTD COIN
	PRINTI ", and pitches it to the "
	PRINTD GROUND
	PRINTR " when he decides that it doesn't."
?L14:	CALL ASKING?,TROLL >STACK
	ZERO? STACK /?L60
	ZERO? ECLIPSE? /?L61
	CALL TROLL-NOT-INTERESTED
	RETURN 2
?L61:	PRINTI """No time for questions,"" "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI " the idle troll."
	CRLF
	RETURN 2
?L60:	EQUAL? PRSA,V?YELL,V?TELL,V?FEED /?L69
	EQUAL? PRSA,V?WAVE-AT,V?HELLO,V?REPLY \?L68
?L69:	ZERO? ECLIPSE? /?L70
	CALL TROLL-NOT-INTERESTED
	RETURN 2
?L70:	CALL SAY-THE,TROLL
	PRINTI " "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTI " something awful and ignores you."
	CRLF
	RETURN 2
?L68:	EQUAL? PRSA,V?FOLLOW \FALSE
	ZERO? TROLL-SCARED? /FALSE
	EQUAL? HERE,NORTH-OF-BRIDGE,ON-BRIDGE \FALSE
	CALL DO-WALK,P?SOUTH
	RTRUE

	.FUNCT TROLL-NOT-INTERESTED
	CALL SAY-THE,TROLL
	PRINTR " is too busy watching the sky to notice."

	.FUNCT TOLL-GATE-F
	ZERO? SKEWED? \?L1
	CALL CANT-SEE-ANY,TOLL-GATE
	RETURN 2
?L1:	EQUAL? PRSA,V?RAISE,V?OPEN \?L5
	FSET? TOLL-GATE,OPENBIT \?L6
	CALL ALREADY-OPEN
	RTRUE
?L6:	CALL NOW-CLOSED-OR-OPEN,TOLL-GATE,1
	IN? TROLL,NORTH-OF-BRIDGE \TRUE
	FSET? TROLL,RMUNGBIT \TRUE
	FCLEAR TOLL-GATE,OPENBIT
	CRLF
	CALL SAY-THE,TROLL
	PRINTI " slams the "
	PRINTD TOLL-GATE
	PRINTI " shut. """
	CALL PICK-ONE,TOLL-DEMANDS >STACK
	PRINT STACK
	PRINTI """ he "
	CALL PICK-ONE,YELL-TYPES >STACK
	PRINT STACK
	PRINTR "."
?L5:	EQUAL? PRSA,V?EXIT,V?ENTER,V?WALK-TO /?L15
	EQUAL? PRSA,V?THROUGH \?L14
?L15:	FSET? TOLL-GATE,OPENBIT \?L16
	CALL DO-WALK,P?SOUTH
	RTRUE
?L16:	CALL ITS-CLOSED,TOLL-GATE
	RTRUE
?L14:	EQUAL? PRSA,V?CLIMB-ON,V?CROSS,V?LEAP /?L20
	EQUAL? PRSA,V?CLIMB-UP \?L19
?L20:	CALL TOO-HIGH,TOLL-GATE
	RTRUE
?L19:	CALL HURT?,TOLL-GATE >STACK
	ZERO? STACK /?L21
	IN? TROLL,NORTH-OF-BRIDGE \?L21
	CALL SAY-THE,TROLL
	CALL MIGHT-NOT-LIKE
	RTRUE
?L21:	EQUAL? PRSA,V?LOWER,V?CLOSE \?L22
	FSET? TOLL-GATE,OPENBIT /?L23
	CALL ALREADY-CLOSED
	RTRUE
?L23:	IN? TROLL,NORTH-OF-BRIDGE \?L25
	PRINTI """That's MY job,"" snaps the "
	PRINTD TROLL
	PRINTR "."
?L25:	CALL NOW-CLOSED-OR-OPEN,TOLL-GATE
	RTRUE
?L22:	EQUAL? PRSA,V?LOOK-ON,V?READ,V?EXAMINE \FALSE
	CALL PERFORM,V?EXAMINE,SIGN
	RTRUE

	.FUNCT CLIFF-BOTTOM-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're at the bottom of a cliff that rises up from the north bank of the river."
	ZERO? SKEWED? \?L5
	PRINTI " "
	CALL TRAIL-WINDS-UP
?L5:	CRLF
	RTRUE

	.FUNCT ENTER-TRAIL?
	ZERO? SKEWED? /?L1
	CALL TRAIL-MISPLACED
	RFALSE
?L1:	FSET? STEEP-TRAIL,RMUNGBIT \?L4
	FCLEAR STEEP-TRAIL,RMUNGBIT
	PRINTI "(The "
	PRINTD TRAIL
	PRINTI " you're climbing is narrow and twisty. It's a good idea to draw a map as you go up.)"
	CRLF
	CRLF
?L4:	SET 'TLOC,1
	RETURN STEEP-TRAIL

	.FUNCT TRAIL-MISPLACED
	PRINTI "The steep "
	PRINTD TRAIL
	PRINTR " seems to have disappeared with the fog."

	.FUNCT TRAIL-WINDS-UP
	PRINTI "A steep "
	PRINTD TRAIL
	PRINTI " winds upward."
	RTRUE

	.FUNCT FEATURELESS-WALL
	PRINTR "It's a sheer, featureless wall, a hundred feet high."

	.FUNCT CLIFF-F
	EQUAL? PRSA,V?LOOK-UP,V?EXAMINE \?L1
	EQUAL? HERE,CLIFF-BOTTOM \?L3
	ZERO? SKEWED? \?L3
	CALL TRAIL-WINDS-UP
	CRLF
	RTRUE
?L3:	CALL FEATURELESS-WALL
	RTRUE
?L1:	EQUAL? PRSA,V?LEAP \FALSE
	EQUAL? HERE,CLIFF-EDGE,STEEP-TRAIL,FOG \?L7
	CALL PERFORM,V?KILL,ME
	RTRUE
?L7:	CALL ALREADY-ON,CLIFF,1
	RTRUE

	.FUNCT DESCRIBE-BRANCH,CONTEXT
	EQUAL? CONTEXT,M-OBJDESC \FALSE
	PRINTI "A "
	PRINTD BRANCH
	PRINTI " is "
	IN? BRANCH,PIT \?L5
	CALL STICKUP
	JUMP ?L7
?L5:	PRINTI "lying on the "
	PRINTD GROUND
?L7:	PRINTI "."
	RTRUE

	.FUNCT STICKUP
	PRINTI "sticking up out of the pit"
	RTRUE

	.FUNCT BRANCH-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,BRANCH
	PRINTI " is "
	IN? BRANCH,PIT \?L5
	CALL STICKUP
	FSET? PLATYPUS,TOOLBIT \?L12
	PRINTI ". A "
	PRINTD PLATYPUS
	PRINTI " is holding on to the bottom end, and looking up at you expectantly"
	JUMP ?L12
?L5:	PRINTI "about six feet long"
?L12:	PRINTR "."
?L1:	EQUAL? PRSA,V?PULL,V?MOVE,V?TAKE /?L18
	EQUAL? PRSA,V?RAISE \?L17
?L18:	EQUAL? PRSO,BRANCH \?L17
	FSET? GNARLED-TREE,RMUNGBIT /?L19
	CALL BRANCH-BREAKS
	RTRUE
?L19:	IN? BRANCH,PIT \FALSE
	FSET? PLATYPUS,TOOLBIT \FALSE
	CALL V-TAKE >STACK
	ZERO? STACK /TRUE
	CRLF
	CALL UPDATE-SCORE,5
	CRLF
	CALL SAY-THE,PLATYPUS
	PRINTI " hangs on to the "
	PRINTD BRANCH
	PRINTI " as you pull it out of the pit. It lets go when the branch clears the edge and waddles joyfully around on the "
	CALL PRINT-ID,STR?224
	ZERO? PIT-FULL? /?L26
	PRINTI "wet "
?L26:	PRINTI "sand."
	CRLF
	CRLF
	CALL DRAW-X
	RTRUE
?L17:	EQUAL? PRSA,V?SIT,V?CLIMB-ON,V?CLIMB-UP /?L36
	EQUAL? PRSA,V?MUNG \FALSE
?L36:	EQUAL? PRSO,BRANCH \FALSE
	FSET? GNARLED-TREE,RMUNGBIT /FALSE
	CALL BRANCH-BREAKS
	RTRUE

	.FUNCT VULTURE-F,CONTEXT=0
	EQUAL? PRSA,V?LOOK-UP,V?EXAMINE \?L1
	PRINTR "Its steady gaze makes you uneasy."
?L1:	CALL IMAGE?,VULTURE >STACK
	ZERO? STACK /?L5
	RETURN 2
?L5:	CALL TALKING-TO?,VULTURE >STACK
	ZERO? STACK \?L9
	EQUAL? PRSA,V?YELL \?L8
?L9:	CALL SAY-THE,VULTURE
	PRINTI " "
	CALL PICK-ONE,IGNORANCE >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	RETURN 2
?L8:	EQUAL? PRSA,V?THROW \?L14
	EQUAL? PRSI,VULTURE \?L14
	CALL SAY-THE,VULTURE
	EQUAL? PRSO,WISHBRINGER \?L15
	CALL ENABLED?,I-VULTURE >STACK
	ZERO? STACK /?L17
	CALL INT,I-VULTURE >STACK
	PUT STACK,0,0
?L17:	REMOVE VULTURE
	REMOVE WISHBRINGER
	PRINTI " eagerly snatches up the "
	PRINTD WISHBRINGER
	PRINTI " in its beak,"
	CALL SOARS-AWAY-OVER
	PRINTI "your head with a croak of delight."
	CRLF
	CRLF
	CALL PRINT-ID,STR?225
	CALL UPDATE-SCORE,-10
	RTRUE
?L15:	PRINTI " ignores you."
	CRLF
	CALL PRINT-ID,STR?226
	RTRUE
?L14:	IN? VULTURE,HERE \?L27
	CALL TOO-HIGH,VULTURE
	RTRUE
?L27:	EQUAL? PRSA,V?GIVE,V?FEED \?L28
	EQUAL? PRSI,VULTURE \?L28
	CALL PERFORM,V?THROW,PRSO,VULTURE
	RTRUE
?L28:	CALL HURT?,VULTURE >STACK
	ZERO? STACK \?L31
	EQUAL? PRSA,V?PLAY,V?EAT,V?KISS /?L31
	EQUAL? PRSA,V?RUB,V?SQUEEZE \FALSE
?L31:	CALL PRINT-ID,STR?227
	REMOVE VULTURE
	CALL SAY-THE,VULTURE
	PRINTI " sees your thought. Before you can do anything, it makes a haughty little croak and flies serenely away."
	CRLF
	RETURN 2

	.FUNCT LIFT-VULTURE
	IN? VULTURE,GNARLED-TREE \?L1
	FCLEAR VULTURE,RMUNGBIT
	REMOVE VULTURE
	CALL QUEUE,I-VULTURE,-1 >STACK
	PUT STACK,0,1
	CALL SAY-THE,VULTURE
	CALL SOARS-AWAY-OVER
	PRINTI "your head."
	CRLF
	CRLF
?L1:	RETURN NORTH-OF-BRIDGE

	.FUNCT SOARS-AWAY-OVER
	PRINTI " spreads its wings and soars away over "
	RTRUE

	.FUNCT SEE-VULTURE
	CALL SAY-THE,VULTURE
	PRINTI " "
	CALL PICK-ONE,SIGHTINGS >STACK
	PRINT STACK
	PRINTR " high overhead."

	.FUNCT DESCRIBE-TREE,CONTEXT
	EQUAL? CONTEXT,M-OBJDESC \FALSE
	PRINTI "A "
	PRINTD GNARLED-TREE
	IN? BRANCH,GNARLED-TREE \?L5
	PRINTI " stands nearby, a lone branch its only adornment."
	JUMP ?L9
?L5:	PRINTI ", stripped of all its branches, stands nearby."
?L9:	IN? VULTURE,GNARLED-TREE \FALSE
	PRINTI " A "
	PRINTD VULTURE
	PRINTI " perched on top is watching every move you make."
	RTRUE

	.FUNCT GNARLED-TREE-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL SAY-THE,GNARLED-TREE
	PRINTR " is rotten to the core."
?L1:	EQUAL? PRSA,V?SIT,V?CLIMB-UP,V?CLIMB-ON \?L5
	FSET? GNARLED-TREE,RMUNGBIT \?L6
	CALL NO-FOOTHOLDS
	RTRUE
?L6:	PRINTI "Done. You're sitting on the rotten, creaking branch..."
	CRLF
	CRLF
	CALL BRANCH-BREAKS
	CRLF
	PRINTI "You're now sitting on the "
	PRINTD GROUND
	PRINTR ". Painfully."
?L5:	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSI,GNARLED-TREE \FALSE
	CALL WASTE-OF-TIME
	RTRUE

	.FUNCT BRANCH-BREAKS
	FCLEAR BRANCH,NDESCBIT
	FSET GNARLED-TREE,RMUNGBIT
	MOVE BRANCH,CLIFF-BOTTOM
	PRINTI "Crack! "
	CALL SAY-THE,BRANCH
	PRINTI " snaps off the "
	PRINTD GNARLED-TREE
	PRINTI " and falls to the "
	PRINTD GROUND
	PRINTI " with a thud. "
	CALL VULTURE-IN-TREE
	CRLF
	RTRUE

	.FUNCT VULTURE-IN-TREE
	IN? VULTURE,GNARLED-TREE \FALSE
	FCLEAR VULTURE,RMUNGBIT
	REMOVE VULTURE
	CALL QUEUE,I-VULTURE,-1 >STACK
	PUT STACK,0,1
	PRINTI "Visibly annoyed, the "
	PRINTD VULTURE
	CALL SOARS-AWAY-OVER
	PRINTI "the river."
	RTRUE

	.FUNCT CAN-FALLS
	MOVE SNAKE-CAN,NORTH-OF-BRIDGE
	CALL CLATTERS,SNAKE-CAN >STACK
	RSTACK

	.FUNCT CLATTERS,THING
	CRLF
	CALL SAY-THE,THING
	PRINTI " clatters to the "
	PRINTD GROUND
	PRINTR "."

	.FUNCT SNAKE-LEAPS-OUT-AT,STR
	SET 'SNAKE-GONE?,1
	PRINTI " the can a "
	ZERO? SKEWED? /?L3
	CALL THIS-IS-IT,SNAKE-CAN
	FSET SNAKE-CAN,OPENBIT
	PRINTI "real, live rattlesnake leaps out! It squirms about angrily for a few moments, turns to hiss at "
	PRINT STR
	PRINTI " and slithers out of sight"
	CALL PRINT-ID,STR?228
	JUMP ?L7
?L3:	PRINTI "three-foot plastic snake springs out! It hits you in the nose and lands harmlessly at your feet.

""Oldest trick in the book,"" remarks the "
	PRINTD OLD-WOMAN
	PRINTI ", chuckling despite herself. ""Try it next time you want to get rid of somebody."" She stuffs the snake back into the "
	PRINTD SNAKE-CAN
	PRINTI ", closes the lid and hands it back to you"
?L7:	PRINTR "."

	.FUNCT FRIGHTEN-TROLL
	SET 'TROLL-SCARED?,1
	EQUAL? WISDOM,2 \?L1
	CALL START-BUZZ,3
?L1:	MOVE TROLL,STEEP-TRAIL
	IN? COIN,TROLL \?L4
	ZERO? LUCKY? /?L4
	FCLEAR COIN,TOUCHBIT
	FCLEAR ON-BRIDGE,TOUCHBIT
	MOVE COIN,ON-BRIDGE
	PUTP COIN,P?FDESC,STR?229
?L4:	CRLF
	PRINTI "A scream of terror echoes off the cliffs as the "
	PRINTD TROLL
	PRINTI " runs away across the "
	PRINTD BRIDGE
	PRINTR "."

	.FUNCT INTO-NIGHT
	PRINTI " into the night."
	RTRUE

	.FUNCT I-FOG-RISING
	ZERO? ECLIPSE? \?L3
	EQUAL? HERE,CLIFF-EDGE /?L1
?L3:	CALL INT,I-FOG-RISING >STACK
	PUT STACK,0,0
	RTRUE
?L1:	INC 'WOMAN-SCRIPT
	ZERO? WOMAN-SCRIPT /TRUE
	CRLF
	EQUAL? WOMAN-SCRIPT,1 \?L8
	PRINTR "The fog in the valley is rising towards you!"
?L8:	EQUAL? WOMAN-SCRIPT,2 \?L12
	PRINTR "Fog is spilling over the edge of the cliff."
?L12:	EQUAL? WOMAN-SCRIPT,3 \?L15
	PRINTR "Fingers of fog are swirling around your feet."
?L15:	CALL INT,I-FOG-RISING >STACK
	PUT STACK,0,0
	MOVE PROTAGONIST,FOG
	SET 'HERE,FOG
	SET 'TLOC,7
	CALL START-BUZZ,1
	PRINTI "The rising mist envelops the cliff in a thick layer of..."
	CRLF
	CRLF
	CALL V-LOOK
	RTRUE

	.FUNCT ENTER-FOG?
	ZERO? ENDING? /?L1
	SET 'WOMAN-SCRIPT,5
	PRINTI "A sudden noise from the "
	PRINTD MAGICK-SHOPPE
	PRINTI " changes your mind."
	CRLF
	RFALSE
?L1:	SET 'TLOC,6
	CALL START-BUZZ,1
	ZERO? SKEWED? /?L6
	PRINTI "As you descend the "
	PRINTD TRAIL
	PRINTI " you are immediately engulfed in..."
	CRLF
	CRLF
	RETURN FOG
?L6:	RETURN STEEP-TRAIL

	.FUNCT FOG-PSEUDO
	EQUAL? PRSA,V?LOOK-INSIDE,V?LOOK-THRU,V?EXAMINE \?L1
	PRINTR "It's so thick you can barely see your own feet!"
?L1:	EQUAL? PRSA,V?ENTER,V?WALK-TO,V?TAKE /?L6
	EQUAL? PRSA,V?THROUGH \?L5
?L6:	PRINTR "There's more than enough right here."
?L5:	CALL YOU-DONT-NEED,STR?230,1
	RETURN 2

	.FUNCT STEEP-TRAIL-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "A steep, rocky "
	PRINTD TRAIL
	PRINTI " winds "
	GET TRAILS,TLOC >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT N-TRAIL
	EQUAL? TLOC,1,3,7 \?L1
	CALL BUMP-CLIFF
	RFALSE
?L1:	EQUAL? TLOC,4,5 \?L3
	CALL PROB-TUMBLE
	RFALSE
?L3:	EQUAL? TLOC,2 \?L4
	CALL NEW-TRAIL,3
	JUMP ?L5
?L4:	CALL NEW-TRAIL,5
?L5:	CALL NEXT-CELL >STACK
	RSTACK

	.FUNCT E-TRAIL
	EQUAL? TLOC,5,6,7 \?L1
	CALL PROB-TUMBLE
	RFALSE
?L1:	EQUAL? TLOC,1,3 \?L3
	CALL BUMP-CLIFF
	RFALSE
?L3:	EQUAL? TLOC,2 \?L4
	CALL NEW-TRAIL,1
	JUMP ?L5
?L4:	CALL NEW-TRAIL,5
?L5:	CALL NEXT-CELL >STACK
	RSTACK

	.FUNCT S-TRAIL
	EQUAL? TLOC,1,2,7 \?L1
	CALL PROB-TUMBLE
	RFALSE
?L1:	EQUAL? TLOC,4,6 \?L3
	CALL BUMP-CLIFF
	RFALSE
?L3:	EQUAL? TLOC,3 \?L4
	CALL NEW-TRAIL,2
	JUMP ?L5
?L4:	CALL NEW-TRAIL,6
?L5:	CALL NEXT-CELL >STACK
	RSTACK

	.FUNCT W-TRAIL
	EQUAL? TLOC,2,3,4 \?L1
	CALL PROB-TUMBLE
	RFALSE
?L1:	EQUAL? TLOC,6 \?L3
	CALL BUMP-CLIFF
	RFALSE
?L3:	EQUAL? TLOC,1 \?L4
	CALL NEW-TRAIL,2
	JUMP ?L6
?L4:	EQUAL? TLOC,5 \?L5
	CALL NEW-TRAIL,4
	JUMP ?L6
?L5:	PRINTI "Crash! "
	CALL BELL-TINKLES
	RFALSE
?L6:	CALL NEXT-CELL >STACK
	RSTACK

	.FUNCT U-TRAIL
	EQUAL? TLOC,1,2,4 /?L3
	EQUAL? TLOC,5,7 \?L1
?L3:	CALL CANT-SEE-ANY,STR?231,1
	RFALSE
?L1:	EQUAL? TLOC,3 \?L4
	CALL NEW-TRAIL,4
	JUMP ?L8
?L4:	ZERO? SKEWED? /?L6
	SET 'TLOC,7
	JUMP ?L8
?L6:	SET 'TLOC,0
	FSET? CLIFF-EDGE,RMUNGBIT \?L9
	FCLEAR CLIFF-EDGE,RMUNGBIT
	CALL UPDATE-SCORE,1
	CRLF
?L9:	RETURN CLIFF-EDGE
?L8:	CALL NEXT-CELL >STACK
	RSTACK

	.FUNCT D-TRAIL
	EQUAL? TLOC,2,3,5 /?L3
	EQUAL? TLOC,6 \?L1
?L3:	CALL CANT-SEE-ANY,STR?232,1
	RFALSE
?L1:	EQUAL? TLOC,1 \?L4
	ZERO? SKEWED? /?L5
	CALL WALK-OUT-OF-FOG
?L5:	SET 'TLOC,0
	RETURN CLIFF-BOTTOM
?L4:	EQUAL? TLOC,4 \?L8
	CALL NEW-TRAIL,3
	JUMP ?L9
?L8:	CALL NEW-TRAIL,6
?L9:	CALL NEXT-CELL >STACK
	RSTACK

	.FUNCT NEXT-CELL
	ZERO? SKEWED? /?L1
	FCLEAR FOG,TOUCHBIT
	RETURN FOG
?L1:	RETURN STEEP-TRAIL

	.FUNCT WALK-OUT-OF-FOG
	CALL START-BUZZ,2
	CALL SUDDEN-GUST
	PRINTI "dissolves the fog and clears your vision."
	CRLF
	CRLF
	RTRUE

	.FUNCT SUDDEN-GUST
	PRINTI "A sudden gust of wind "
	RTRUE

	.FUNCT NEW-TRAIL,NEW-LOC
	FCLEAR FOG,TOUCHBIT
	FCLEAR STEEP-TRAIL,TOUCHBIT
	SET 'TLOC,NEW-LOC
	RETURN TLOC

	.FUNCT BUMP-CLIFF
	CALL PICK-ONE,BUMPS >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	RFALSE

	.FUNCT PROB-TUMBLE
	ADD T-PROB,10 >T-PROB
	EQUAL? T-PROB,100 /?L3
	RANDOM 100 >STACK
	LESS? T-PROB,STACK /?L1
?L3:	PRINTI "Oh, no! You lost your footing and tumbled off the cliff!"
	CALL PRINT-ID,STR?233
	CALL BAD-ENDING >STACK
	RSTACK
?L1:	CALL TUMBLE >STACK
	RSTACK

	.FUNCT TUMBLE
	PRINTI "You'd "
	CALL PICK-ONE,FALLS >STACK
	PRINT STACK
	CALL PRINT-ID,STR?234
	EQUAL? HERE,HILLTOP,LOOKOUT-HILL \?L3
	PRINTI " down the hill"
	JUMP ?L7
?L3:	PRINTI " off the "
	PRINTD CLIFF
?L7:	CALL WENT-THAT-WAY
	RFALSE

	.FUNCT CLIFF-EDGE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "high on a rocky cliff, at the top of a steep "
	PRINTD TRAIL
	PRINTI " leading downward."
	ZERO? SUCCESS? /?L5
	PRINTI " Looking southeast, you see a friendly orange sun rising from a bank of morning clouds."
	CRLF
	CRLF
	PRINTD POST-OFFICE
	PRINTI " Hill is visible "
	CALL TO-S >STACK
	PRINT STACK
	PRINTI ", topped as usual by the Festeron "
	PRINTD POST-OFFICE
	PRINTI "."
?L5:	FSET? MAGICK-SHOPPE,TOUCHBIT \?L10
	CALL SHOPPE-IS-NEARBY >STACK
	RSTACK
?L10:	FSET MAGICK-SHOPPE,TOUCHBIT
	ZERO? ENDING? \TRUE
	ZERO? SKEWED? /?L15
	CRLF
	CRLF
	PRINTI "The surrounding landscape has disappeared under a "
	PRINTD BLANKET
	PRINTI " of evening fog. All the familiar buildings and landmarks are completely hidden; only the summit of "
	PRINTD POST-OFFICE
	PRINTI " Hill is high enough to pierce the cloud, rising like a lonely "
	PRINTD ISLE
	PRINTI " in a sea of mist...

... an "
	PRINTD ISLE
	PRINTI " with a "
	PRINTD TOWER
	PRINTI " on it.

There's a TOWER where the "
	PRINTD POST-OFFICE
	PRINTI " used to be! The massive outline is hard to make out against the twilight sky. But the longer you stare, the clearer and more frightening it becomes."
	CALL SHOPPE-IS-NEARBY >STACK
	RSTACK
?L15:	PRINTI " Looking southwest, you can see the shadow of "
	PRINTD POST-OFFICE
	PRINTI " Hill creeping across the "
	PRINTD FESTERON
	PRINTI " as the sun sinks into a bank of clouds.

The peaceful scenery is disturbed by a tiny figure emerging from the distant "
	PRINTD POST-OFFICE
	PRINTI ". It stares in your direction for a few moments, checks its wrist and shakes a threatening little fist at you.

A little old-fashioned store stands nearby. Its brightly painted shutters and thatched roof remind you of something out of a fairy tale. "
	CALL DESCRIBE-SIGN >STACK
	RSTACK

	.FUNCT SHOPPE-IS-NEARBY
	CRLF
	CRLF
	CALL SAY-THE,MAGICK-SHOPPE
	PRINTR " stands nearby."

	.FUNCT DESCRIBE-SIGN
	PRINTI "A curiously painted sign over the "
	PRINTD HOUSE-DOOR
	PRINTI " reads, ""Ye Olde "
	PRINTD MAGICK-SHOPPE
	PRINTR "."""

	.FUNCT CLIFF-FOG-PSEUDO
	ZERO? SKEWED? /?L3
	ZERO? SUCCESS? /?L1
?L3:	CALL CANT-SEE-ANY
	RETURN 2
?L1:	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE \?L6
	CALL V-LOOK
	RTRUE
?L6:	EQUAL? PRSA,V?ENTER,V?THROUGH,V?WALK-TO \?L7
	CALL DO-WALK,P?DOWN
	RTRUE
?L7:	CALL YOU-DONT-NEED,STR?230,1
	RETURN 2

	.FUNCT MAGICK-SHOPPE-F
	CALL ENTER-FROM?,CLIFF-EDGE,INSIDE-SHOPPE,MAGICK-SHOPPE >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?EXAMINE \?L3
	EQUAL? HERE,INSIDE-SHOPPE \?L4
	CALL V-LOOK
	RTRUE
?L4:	CALL DESCRIBE-SIGN
	RTRUE
?L3:	EQUAL? PRSA,V?LOOK-THRU,V?LOOK-INSIDE \FALSE
	FSET? SHOPPE-DOOR,OPENBIT \?L8
	CALL GO-INSIDE
	RTRUE
?L8:	CALL ITS-CLOSED,SHOPPE-DOOR
	RETURN 2

	.FUNCT SHOPPE-DOOR-F
	EQUAL? PRSA,V?PULL,V?MOVE,V?OPEN /?L3
	EQUAL? PRSA,V?PUSH \?L1
?L3:	EQUAL? PRSO,SHOPPE-DOOR \?L1
	FSET? SHOPPE-DOOR,OPENBIT /?L1
	EQUAL? HERE,INSIDE-SHOPPE /?L6
	ZERO? SKEWED? /?L4
?L6:	CALL BEST-EFFORTS,HOUSE-DOOR,STR?235
	IN? OLD-WOMAN,HERE \TRUE
	CRLF
	PRINTI """That door always sticks this time of year,"" notes the "
	PRINTD OLD-WOMAN
	PRINTR " drily."
?L4:	CALL BELL-TINKLES
	CRLF
	RFALSE
?L1:	EQUAL? PRSA,V?CLOSE \?L13
	FSET? SHOPPE-DOOR,OPENBIT \?L13
	CALL BELL-TINKLES
	RFALSE
?L13:	EQUAL? PRSA,V?KNOCK \?L14
	FSET? SHOPPE-DOOR,OPENBIT \?L15
	CALL ALREADY-OPEN
	RTRUE
?L15:	EQUAL? HERE,INSIDE-SHOPPE \?L17
	CALL WASTE-OF-TIME
	RTRUE
?L17:	ZERO? ENDING? /?L18
	SET 'WOMAN-SCRIPT,5
	RTRUE
?L18:	ZERO? SKEWED? \FALSE
	PRINTR "A voice cries, ""Come in!"""
?L14:	CALL USE-DOOR?,CLIFF-EDGE >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT BELL-TINKLES
	PRINTR "A concealed bell tinkles merrily."

	.FUNCT ENTER-SHOPPE
	FSET? SHOPPE-DOOR,OPENBIT \?L1
	CALL HELD?,ENVELOPE >STACK
	ZERO? STACK /?L3
	CALL QUEUE,I-WOMAN-SCRIPT,-1 >STACK
	PUT STACK,0,1
	CALL INT,I-BEFORE-FIVE >STACK
	PUT STACK,0,0
	RETURN INSIDE-SHOPPE
?L3:	FCLEAR SHOPPE-DOOR,OPENBIT
	CALL SAY-THE,SHOPPE-DOOR
	PRINTI ", sensing that you have no mail to deliver, slams itself shut in your face. "
	CALL BELL-TINKLES
	RFALSE
?L1:	CALL ITS-CLOSED,SHOPPE-DOOR
	RFALSE

	.FUNCT MOBILE?
	ZERO? IMMOBILIZED? /?L1
	CALL UNWILLING-TO-MOVE
	RFALSE
?L1:	CALL ITS-CLOSED,SHOPPE-DOOR
	RFALSE

	.FUNCT UNWILLING-TO-MOVE
	CALL PICK-ONE,FROZENS >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	RFALSE

	.FUNCT APPROACH-CURTAIN
	ZERO? IMMOBILIZED? /?L1
	CALL UNWILLING-TO-MOVE
	RFALSE
?L1:	PRINTI "As you approach the "
	PRINTD CURTAIN
	PRINTI "ed exit, the "
	PRINTD MAGICK-SHOPPE
	PRINTI " subtly rearranges itself until you find yourself facing the other way."
	IN? OLD-WOMAN,INSIDE-SHOPPE \?L6
	PRINTI " The "
	PRINTD OLD-WOMAN
	PRINTI " watches with wry amusement."
?L6:	CRLF
	RFALSE

	.FUNCT INSIDE-SHOPPE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're in the front showroom of the "
	PRINTD MAGICK-SHOPPE
	PRINTI ".

Every inch of wall space is crowded with magic tricks, puzzles and mystical paraphernalia. A glass case offers a selection of obscene jokes and naughty birthday cards.

In the "
	PRINTD CORNER
	PRINTI " stands an ancient "
	PRINTD CLOCK
	PRINTI ", its dial ornamented with a "
	CALL PICK-ONE,FACES >STACK
	PRINT STACK
	PRINTI "ing crescent moon and other celestial symbols.

The "
	PRINTD HOUSE-DOOR
	PRINTI " of the "
	PRINTD MAGICK-SHOPPE
	PRINTI " is "
	FSET? SHOPPE-DOOR,OPENBIT \?L5
	PRINTI "wide open"
	JUMP ?L9
?L5:	PRINTI "closed"
?L9:	PRINTI ". At the west end of the room, you can see another exit concealed by a "
	PRINTD CURTAIN
	PRINTR "."

	.FUNCT CLOCK-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTI "The "
	CALL PICK-ONE,FACES >STACK
	PRINT STACK
	PRINTI "ing "
	PRINTD CLOCK
	PRINTI " "
	FSET? CLOCK,RMUNGBIT \?L5
	PRINTI "says it's "
	JUMP ?L9
?L5:	PRINTI "is stopped at "
?L9:	CALL TELL-TIME
	PRINTR "."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L14
	PRINTI "Inside the "
	PRINTD CLOCK
	PRINTR " you see an intricate brass mechanism."
?L14:	EQUAL? PRSA,V?LISTEN \?L17
	FSET? CLOCK,RMUNGBIT \?L17
	CALL SAY-THE,CLOCK
	PRINTR " is ticking noisily."
?L17:	CALL MOVING?,CLOCK >STACK
	ZERO? STACK /?L20
	CALL PRINT-ID,STR?236
	CALL TOO-LARGE,CLOCK
	RTRUE
?L20:	CALL HURT?,CLOCK >STACK
	ZERO? STACK \?L22
	EQUAL? PRSA,V?OPEN \FALSE
?L22:	CALL PRINT-ID,STR?237
	CALL RUIN,CLOCK
	RTRUE

	.FUNCT RUIN,THING
	PRINTI "You'd probably ruin the "
	PRINTD THING
	CALL IF-YOU-TRIED >STACK
	RSTACK

	.FUNCT STOCK-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?LOOK-ON,V?EXAMINE /?L3
	EQUAL? PRSA,V?READ \?L1
?L3:	PRINTR "They look like fun."
?L1:	CALL TRY-HANDLING-STOCK >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?BUY /FALSE
	CALL YOU-DONT-NEED,STOCK
	RETURN 2

	.FUNCT NAUGHTY-STOCK-F
	EQUAL? PRSA,V?READ,V?LOOK-INSIDE,V?EXAMINE /?L3
	EQUAL? PRSA,V?LOOK-ON \?L1
?L3:	CALL PICK-ONE,NAUGHTY-BITS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	CALL TRY-HANDLING-STOCK >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?BUY /FALSE
	CALL YOU-DONT-NEED,NAUGHTY-STOCK
	RETURN 2

	.FUNCT TRY-HANDLING-STOCK
	EQUAL? PRSA,V?TAKE \?L1
	PRINTD MACGUFFIN
	PRINTI " takes a dim view of shoplifters."
	CRLF
	CALL PRINT-ID,STR?238
	RTRUE
?L1:	CALL HURT?,PRSO >STACK
	ZERO? STACK \?L6
	EQUAL? PRSA,V?EMPTY,V?POUR,V?STAND-ON \FALSE
?L6:	PRINTI "The proprietor of the "
	PRINTD MAGICK-SHOPPE
	CALL PRINT-ID,STR?239
	CALL MIGHT-NOT-LIKE
	RTRUE

	.FUNCT MIGHT-NOT-LIKE
	PRINTI " might not like it"
	CALL IF-YOU-TRIED >STACK
	RSTACK

	.FUNCT GLASS-CASE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The naughty "
	PRINTD GLASS-CASE
	PRINTI " is"
	CALL CLOSED-AND-LOCKED
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE \?L5
	CALL PICK-ONE,NAUGHTY-BITS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L5:	CALL TRY-HANDLING-STOCK >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT CURTAIN-F
	EQUAL? PRSA,V?WALK-TO,V?ENTER,V?THROUGH /?L3
	EQUAL? PRSA,V?OPEN,V?LOOK-BEHIND,V?LOOK-INSIDE /?L3
	EQUAL? PRSA,V?MOVE,V?PUSH,V?CLOSE \?L1
?L3:	CALL DO-WALK,P?IN
	RTRUE
?L1:	CALL TRY-HANDLING-STOCK >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT ENVELOPE-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	CALL FIND-IN-PACKAGE,STR?240
	RTRUE
?L1:	CALL HURT?,ENVELOPE >STACK
	ZERO? STACK /?L3
	CALL PRINT-ID,STR?241
	CALL HOW-WOULD-YOU-LIKE-IT,ENVELOPE
	RTRUE
?L3:	EQUAL? PRSA,V?OPEN \?L4
	CALL DONT-HAVE?,ENVELOPE >STACK
	ZERO? STACK \TRUE
	ZERO? WOMAN-SEEN-ENVELOPE? /?L7
	SET 'ANGER,4
	MOVE ENVELOPE,STEEP-TRAIL
	MOVE OPEN-ENVELOPE,PROTAGONIST
	FSET OPEN-ENVELOPE,TOUCHBIT
	MOVE RANSOM-LETTER,PROTAGONIST
	SET 'L-PRSO,OPEN-ENVELOPE
	SET 'PRSO,OPEN-ENVELOPE
	CALL THIS-IS-IT,RANSOM-LETTER
	PRINTI "(You should now open the "
	PRINTD ENVELOPE
	PRINTI " in your "
	PRINT GAME
	PRINTI " package.)

Opening the "
	PRINTD ENVELOPE
	PRINTR " reveals a letter."
?L7:	PRINTI "(You're not supposed to open the "
	PRINTD ENVELOPE
	PRINTR " until the story tells you to do so.)"
?L4:	EQUAL? PRSA,V?TAKE \FALSE
	FSET? ENVELOPE,TOUCHBIT /FALSE
	SET 'ANGER,4
	RFALSE

	.FUNCT IVE-ALREADY-SEEN-IT
	PRINTR """I've already seen it."""

	.FUNCT OPEN-ENVELOPE-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	CALL FIND-IN-PACKAGE,STR?240
	RTRUE
?L1:	CALL HURT?,OPEN-ENVELOPE >STACK
	ZERO? STACK /?L3
	CALL HOW-WOULD-YOU-LIKE-IT,ENVELOPE
	RTRUE
?L3:	EQUAL? PRSA,V?CLOSE \?L6
	FSET? OPEN-ENVELOPE,OPENBIT /?L5
?L6:	EQUAL? PRSA,V?THROW,V?PUT \FALSE
	EQUAL? PRSI,OPEN-ENVELOPE \FALSE
?L5:	CALL UNFORTUNATELY
	PRINTI "you ripped the "
	PRINTD ENVELOPE
	PRINTR " when you opened it."

	.FUNCT RANSOM-LETTER-F
	EQUAL? PRSA,V?READ \?L1
	CALL DONT-HAVE?,RANSOM-LETTER >STACK
	ZERO? STACK \TRUE
	IN? OLD-WOMAN,HERE \?L5
	PRINTI "(to the "
	PRINTD OLD-WOMAN
	PRINTI ")"
	CRLF
	CALL READ-LETTER-TO-WOMAN
	RETURN 2
?L5:	CALL FIND-IN-PACKAGE,STR?242
	RETURN 2
?L1:	EQUAL? PRSA,V?READ-TO \?L11
	EQUAL? PRSI,OLD-WOMAN \?L12
	CALL READ-LETTER-TO-WOMAN
	RETURN 2
?L12:	EQUAL? PRSI,ME \FALSE
	CALL FIND-IN-PACKAGE,STR?242
	RETURN 2
?L11:	EQUAL? PRSA,V?GIVE \?L20
	EQUAL? PRSI,OLD-WOMAN \?L20
	ZERO? LETTER-READ-TO-WOMAN? /?L21
	CALL READ-LETTER-TO-WOMAN
	RETURN 2
?L21:	PRINTI "She politely refuses your offer."
	CRLF
	RETURN 2
?L20:	EQUAL? PRSA,V?EXAMINE \?L28
	CALL FIND-IN-PACKAGE,STR?242
	RETURN 2
?L28:	CALL HURT?,RANSOM-LETTER >STACK
	ZERO? STACK /FALSE
	CALL PRINT-ID,STR?243
	CALL HOW-WOULD-YOU-LIKE-IT,RANSOM-LETTER
	RETURN 2

	.FUNCT IN-CAN,CONTEXT
	EQUAL? CONTEXT,M-CONT \FALSE
	IN? SNAKE-CAN,PROTAGONIST /FALSE
	CALL SEE-VERB? >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSO,CAN-BOTTOM /FALSE
	CALL YOUD-HAVE-TO,STR?244,SNAKE-CAN
	RTRUE

	.FUNCT SNAKE-CAN-F
	ZERO? BOTTOM? /?L1
	CALL CAN-BOTTOM-F >STACK
	ZERO? STACK \TRUE
?L1:	EQUAL? PRSA,V?READ,V?LOOK-ON,V?EXAMINE \?L3
	PRINTI "It's a round "
	PRINTD SNAKE-CAN
	PRINTI " with a"
	CALL OPEN-CLOSED,SNAKE-CAN,1
	PRINTR "lid, illustrated with a tasty-looking assortment of mixed nuts."
?L3:	EQUAL? PRSA,V?TAKE-OFF,V?OPEN \?L8
	FSET? SNAKE-CAN,OPENBIT /?L8
	CALL DONT-HAVE?,SNAKE-CAN >STACK
	ZERO? STACK \TRUE
	ZERO? SNAKE-GONE? /?L11
	CALL NOW-CLOSED-OR-OPEN,SNAKE-CAN,1
	RTRUE
?L11:	PRINTI "Yow! When you open"
	CALL SNAKE-LEAPS-OUT-AT,STR?245
	ZERO? SKEWED? /TRUE
	EQUAL? HERE,NORTH-OF-BRIDGE \TRUE
	IN? TROLL,NORTH-OF-BRIDGE \TRUE
	CALL CAN-FALLS
	CALL FRIGHTEN-TROLL
	CRLF
	CALL UPDATE-SCORE,3
	RTRUE
?L8:	EQUAL? PRSA,V?SPIN,V?SHAKE,V?LISTEN \?L18
	CALL DONT-HAVE?,SNAKE-CAN >STACK
	ZERO? STACK \TRUE
	CALL SAY-THE,GCAN
	PRINTI " rattles again. It sounds like there are nuts inside"
	FSET? SNAKE-CAN,OPENBIT \?L24
	PRINTI ", although it seems to be empty"
?L24:	PRINTR "."
?L18:	EQUAL? PRSA,V?READ \?L31
	CALL READ-CAN
	RTRUE
?L31:	EQUAL? PRSA,V?LOOK-DOWN,V?SEARCH,V?LOOK-INSIDE \?L32
	CALL LOOK-IN-CAN
	RTRUE
?L32:	EQUAL? PRSA,V?DROP \?L33
	EQUAL? PRSO,SNAKE-CAN \?L33
	PRINTI "It hits the "
	CALL GROUND-OR-FLOOR
	PRINTI " with a rattle"
	CALL AND-DROPS-OUT,SNAKE-CAN
	EQUAL? HERE,INSIDE-SHOPPE \TRUE
	MOVE SNAKE-CAN,PROTAGONIST
	CRLF
	CALL SAY-THE,OLD-WOMAN
	PRINTI " picks up the "
	PRINTD SNAKE-CAN
	PRINTI " and hands it back to you. ""I think you dropped this."""
	CRLF
	CALL PRINT-ID,STR?246
	RTRUE
?L33:	EQUAL? PRSA,V?SQUEEZE \?L43
	CALL PERFORM,V?SQUEEZE,CAN-BOTTOM
	RTRUE
?L43:	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,SNAKE-CAN \FALSE
	IN? SNAKE-CAN,OLD-WOMAN \FALSE
	CALL V-TAKE >STACK
	ZERO? STACK /TRUE
	CALL QUEUE,I-RATTLE,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT LOOK-IN-CAN
	IN? SNAKE-CAN,PROTAGONIST /?L1
	CALL YOUD-HAVE-TO,STR?216,SNAKE-CAN >STACK
	RSTACK
?L1:	FSET? SNAKE-CAN,OPENBIT \?L3
	CALL SAY-THE,SNAKE-CAN
	PRINTI " appears to have a "
	PRINTD CAN-BOTTOM
	PRINTR ". You could probably get it out by squeezing the can."
?L3:	CALL ITS-CLOSED,SNAKE-CAN >STACK
	RSTACK

	.FUNCT SQUASHED-CAN-F
	EQUAL? PRSA,V?EXAMINE,V?CLOSE,V?OPEN /?L3
	EQUAL? PRSA,V?SQUEEZE,V?LOOK-DOWN,V?LOOK-INSIDE /?L3
	EQUAL? PRSA,V?MUNG \?L1
?L3:	EQUAL? PRSO,SQUASHED-CAN \?L1
	CALL SAY-BOTTOM
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \?L4
	EQUAL? PRSI,GCAN \?L4
	CALL NO-ROOM
	CALL SAY-BOTTOM
	RTRUE
?L4:	EQUAL? PRSA,V?READ \?L5
	CALL READ-CAN
	RTRUE
?L5:	EQUAL? PRSA,V?SPIN,V?SHAKE,V?LISTEN \FALSE
	CALL DONT-HAVE?,GCAN >STACK
	ZERO? STACK \TRUE
	CALL SAY-THE,GCAN
	PRINTR " makes no sound."

	.FUNCT READ-CAN
	CALL SAY-THE,GCAN
	PRINTR " says, 'Mixed Nuts.'"

	.FUNCT CAN-BOTTOM-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL LOOK-IN-CAN
	RTRUE
?L1:	EQUAL? PRSA,V?MOVE,V?SQUEEZE,V?OPEN /?L4
	EQUAL? PRSA,V?TAKE-OFF,V?PUSH,V?PULL \?L3
?L4:	EQUAL? PRSO,CAN-BOTTOM,GCAN \?L3
	CALL DONT-HAVE?,GCAN >STACK
	ZERO? STACK \TRUE
	FSET? SNAKE-CAN,OPENBIT /?L7
	CALL YOUD-HAVE-TO,STR?92,SNAKE-CAN
	RTRUE
?L7:	IN? CAN-BOTTOM,SQUASHED-CAN /?L8
	MOVE SQUASHED-CAN,PROTAGONIST
	REMOVE SNAKE-CAN
	SET 'GCAN,SQUASHED-CAN
	CALL INT,I-RATTLE >STACK
	PUT STACK,0,0
	CALL QUEUE,I-GLOW,-1 >STACK
	PUT STACK,0,1
	CALL PRINT-ID,STR?247
	MOVE WISHBRINGER,PROTAGONIST
	CALL THIS-IS-IT,WISHBRINGER
	CALL SAY-THE,CAN-BOTTOM
	PRINTI " is wedged tightly into the "
	PRINTD SNAKE-CAN
	PRINTI ". You might be able to loosen it by squeezing harder... harder!...

Pop! A "
	PRINTD WISHBRINGER
	PRINTI " drops out of the "
	PRINTD SQUASHED-CAN
	CALL AND-DROPS-OUT,WISHBRINGER
	RTRUE
?L8:	CALL SAY-BOTTOM
	RTRUE
?L3:	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,CAN-BOTTOM,GCAN \FALSE
	ZERO? PRSI /FALSE
	CALL DONT-HAVE?,GCAN >STACK
	ZERO? STACK \TRUE
	CALL HOW?
	RTRUE

	.FUNCT SAY-BOTTOM
	PRINTI "You squashed the "
	PRINTD SNAKE-CAN
	PRINTI " flat when you removed the "
	PRINTD CAN-BOTTOM
	PRINTR "."

	.FUNCT I-RATTLE
	IN? SNAKE-CAN,PROTAGONIST \FALSE
	RANDOM 100 >STACK
	LESS? 5,STACK /FALSE
	CRLF
	CALL PICK-ONE,GIVE-AWAYS >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT TO-FINISH
	SET 'ENDING?,1
	SET 'FUZZY?,0
	SET 'FUZZY-FROM,CLIFF-EDGE
	CALL INT,I-GLOW >STACK
	PUT STACK,0,0
	FCLEAR WISHBRINGER,ONBIT
	CALL ENABLED?,I-DRINK >STACK
	ZERO? STACK /?L1
	SET 'MILK-SCRIPT,1
?L1:	CALL ENABLED?,I-DIGEST-CHOCOLATE >STACK
	ZERO? STACK /?L4
	SET 'CHOCOLATE-SCRIPT,1
?L4:	CALL INT,I-VULTURE >STACK
	PUT STACK,0,0
	SET 'WOMAN-SCRIPT,0
	CALL QUEUE,I-FINALE,-1 >STACK
	PUT STACK,0,1
	FSET MAGICK-SHOPPE,TOUCHBIT
	CALL INT,I-BEFORE-MOONSET >STACK
	PUT STACK,0,0
	SET 'HERE,CLIFF-EDGE
	MOVE PROTAGONIST,CLIFF-EDGE
	CALL CARRIAGE-RETURNS >STACK
	RSTACK

	.FUNCT CHAOS-F,CONTEXT=0
	CALL THIS-IS-IT,CHAOS
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL DESCRIBE-CHAOS,1
	PRINTR " right in the middle of her forehead."
?L1:	EQUAL? PRSA,V?TAKE \?L5
	EQUAL? PRSO,CHAOS \?L5
	CALL V-TAKE >STACK
	ZERO? STACK /TRUE
	CRLF
	CALL PERFORM,V?LISTEN,CHAOS
	RTRUE
?L5:	EQUAL? PRSA,V?KISS,V?RUB,V?LISTEN \?L9
	CALL PRINT-ID,STR?248
	CALL NICE-KITTY
	RTRUE
?L9:	CALL TALKING-TO?,CHAOS >STACK
	ZERO? STACK /?L10
	CALL PRINT-ID,STR?249
	CALL NICE-KITTY
	RETURN 2
?L10:	CALL HURT?,CHAOS >STACK
	ZERO? STACK /?L13
	CALL PRINT-ID,STR?250
	CALL V-RAPE
	RTRUE
?L13:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,CHAOS \FALSE
	EQUAL? PRSO,CHAOS \?L15
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L15:	EQUAL? PRSO,MILK \?L19
	CALL READY-MILK
	CALL PRINT-ID,STR?251
	CALL GIVE-MILK-TO-CAT,CHAOS
	RTRUE
?L19:	CALL NOT-LIKELY,KITTY,STR?87
	RTRUE

	.FUNCT NICE-KITTY
	CALL SAY-THE,KITTY
	PRINTI " "
	CALL PICK-ONE,NICES >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT DESCRIBE-CHAOS,SPOT?=0
	PRINTI "She's black as night from head to tail"
	ZERO? SPOT? /FALSE
	PRINTI ", except for one little white spot"
	RTRUE

	.FUNCT I-FINALE
	EQUAL? HERE,CLIFF-EDGE \FALSE
	INC 'WOMAN-SCRIPT
	EQUAL? WOMAN-SCRIPT,1 \?L3
	ZERO? SUCCESS? /?L5
	CALL THIS-IS-IT,CHAOS
	CRLF
	PRINTI "A "
	PRINTD KITTY
	PRINTR " is rubbing against your leg."
?L5:	SET 'WOMAN-SCRIPT,5
	RTRUE
?L3:	ZERO? SUCCESS? /?L11
	EQUAL? WOMAN-SCRIPT,3 \?L11
	CALL ACCESSIBLE?,CHAOS >STACK
	ZERO? STACK /?L11
	CALL THIS-IS-IT,CHAOS
	CRLF
	CALL SAY-THE,KITTY
	IN? CHAOS,PROTAGONIST \?L13
	MOVE CHAOS,CLIFF-EDGE
	PRINTI " leaps from your arms and"
?L13:	PRINTI " begins scratching urgently on the "
	PRINTD SHOPPE-DOOR
	PRINTR "."
?L11:	EQUAL? WOMAN-SCRIPT,6 \FALSE
	CALL THIS-IS-IT,OLD-WOMAN
	FSET SHOPPE-DOOR,OPENBIT
	CRLF
	PRINTI "The door of the "
	PRINTD MAGICK-SHOPPE
	PRINTI " creaks open, and the "
	PRINTD OLD-WOMAN
	PRINTI ", dressed in a nightgown, "
	ZERO? SUCCESS? /?L23
	PRINTI "stands blinking in the morning sun."
	JUMP ?L27
?L23:	PRINTI "peers sleepily"
	CALL INTO-NIGHT
?L27:	PRINTI " ""Who's there?"""
	CRLF
	CRLF
	ZERO? SUCCESS? /?L32
	CALL ACCESSIBLE?,CHAOS >STACK
	ZERO? STACK /?L32
	CALL SAY-THE,KITTY
	IN? CHAOS,PROTAGONIST \?L34
	PRINTI " squirms away from you and"
?L34:	PRINTI " leaps into the woman's arms. """
	PRINTD CHAOS
	PRINTI "!"" she cries, laughing and sobbing all at once as the cat licks tears of joy from her face.

At last the "
	PRINTD OLD-WOMAN
	PRINTI " lowers "
	PRINTD CHAOS
	PRINTI " to the "
	PRINTD GROUND
	PRINTI " and walks over to where you're standing, red with embarrassment."
	CRLF
	CRLF
	CALL LIAR
	PRINTI ","" she chuckles, clasping "
	PRINTD HANDS
	PRINTI "s gratefully in her own. ""I promised to give you "
	PRINT GAME
	PRINTI ", knowing full well that, if you succeeded, its virtue would be lost.

""In truth, the Stone would make a poor reward,"" she continues, stooping to tickle the cat's white forehead. ""As you can see, it brings more joy in the shape of a companion than in any other. This is "
	PRINT GAME
	PRINTI "'s finest Magick. A pity that my sister,"
	PRINT EONE
	PRINTI ", did not know of it."""
	CRLF
	CRLF
	ZERO? HOUSE-VISITED? /?L43
	PRINT YOU-HEAR
	PRINTI "a familiar"
	CALL CLUMP
	PRINTI "behind you. It's the "
	PRINTD SMALL-BOX
	PRINTI ", hopping bravely up the steep "
	PRINTD TRAIL
	PRINTI "! The woman looks on with puzzled amusement as the faithful box"
	CALL HOPS-TO-SIDE
	CRLF
	CRLF
?L43:	CALL SAY-THE,OLD-WOMAN
	IN? VIOLET-NOTE,PROTAGONIST \?L50
	PRINTI " touches the "
	PRINTD VIOLET-NOTE
	PRINTI " in "
	PRINTD HANDS
	JUMP ?L54
?L50:	IN? VIOLET-NOTE,HERE \?L55
	PRINTI " picks up the "
	PRINTD VIOLET-NOTE
	JUMP ?L59
?L55:	PRINTI " pulls "
	PRINTD MISS-VOSS
	PRINTI "'s "
	PRINTD VIOLET-NOTE
	PRINTI " from an obscure pocket"
?L59:	PRINTI " and hands it to you"
?L54:	PRINTI ". ""Make sure you give this to "
	PRINTD CRISP
	PRINTI " when you see him,"" she says with a sly wink. ""And tell him I said hello.""

Cradling "
	PRINTD CHAOS
	PRINTI " in her arms like a child, the "
	PRINTD OLD-WOMAN
	PRINTI " ambles back into the "
	PRINTD MAGICK-SHOPPE
	PRINTI ". ""Farewell!"" she calls from the closing door, and the sunlight makes her face look young. ""Now you are a true Adventurer."""
	CRLF
	CRLF
	CALL BELL-TINKLES
	MOVE PROTAGONIST,END-ROOM
	SET 'HERE,END-ROOM
	CALL CARRIAGE-RETURNS
	PRINTI "Congratulations! You've finished the story of "
	PRINT GAME
	PRINTI "!"
	CRLF
	CRLF
	CALL PRINT-ID,STR?252
	CALL UPDATE-SCORE,1
	CALL V-SCORE
	ZERO? SPELLS /?L68
	CRLF
	PRINTI "Did you know that it's possible to complete the story without using any of the 7 Wishes? It's fun to go back and see if you can solve all of the problems without Wishing."
	CRLF
?L68:	CALL FINISH,1 >STACK
	RSTACK
?L32:	CALL VISIBLE?,KITTY >STACK
	ZERO? STACK /?L74
	PRINTI "A look of joy spreads over the "
	PRINTD OLD-WOMAN
	PRINTI "'s face when she sees the "
	PRINTD KITTY
	IN? KITTY,PROTAGONIST \?L78
	PRINTI " in your arms"
	JUMP ?L82
?L78:	PRINTI " playing at your feet"
?L82:	PRINTI ". ""Here, "
	PRINTD CHAOS
	PRINTI "! Come to mama!""

But the cat pays no attention. Frowning, the woman walks over and peers at it closely. ""This isn't "
	PRINTD CHAOS
	PRINTI ","" she says, her voice now heavy with sadness. ""You did not heed me when I described her to you. See? There's no white spot on her forehead, as I said there would be. You should have examined her before you returned here!"""
	CALL PRINT-ID,STR?253
	JUMP ?L87
?L74:	PRINTI "A hopeful look brightens the "
	PRINTD OLD-WOMAN
	PRINTI "'s face as she sees you. ""Did you find my cat, "
	PRINTD CHAOS
	PRINTI "?"" she cries hopefully. But the guilty look in your eyes turns her brief joy to sadness.

""You have failed, then,"" she sighs. """
	CALL PRINT-ID,STR?254
	CALL THANKS-ANYWAY
?L87:	CALL BAD-ENDING >STACK
	RSTACK

	.FUNCT THANKS-ANYWAY
	PRINTI "Too bad. I should not have placed my hopes upon a simpleton. But thank you for your useless effort."""
	RTRUE

	.FUNCT TOMBS-BLOCK
	CALL THIS-IS-IT,MONUMENTS
	CALL SAY-THE,MONUMENTS
	PRINTI "s block your path."
	CRLF
	RFALSE

	.FUNCT CREEPY-CORNER-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're in a creepy "
	PRINTD CORNER
	PRINTI " of the"
	CALL WHICH-TOWN,STR?128
	PRINTI ", surrounded by silent "
	PRINTD MONUMENTS
	PRINTI "s. A"
	FSET? SOUTH-GATE,OPENBIT \?L7
	PRINTI "n iron gate opens"
	JUMP ?L11
?L7:	PRINTI " closed iron gate stands"
?L11:	PRINTI " "
	CALL TO-E >STACK
	PRINT STACK
	PRINTR ", and a narrow lane wanders north."

	.FUNCT EXIT-TO-OUTSIDE
	FSET? SOUTH-GATE,OPENBIT \?L1
	ZERO? SKEWED? /?L3
	CALL SLAM-THE-GATE
	RFALSE
?L3:	CALL SURE-IS-SPOOKY
	RETURN OUTSIDE-CEMETERY
?L1:	CALL ITS-CLOSED,SOUTH-GATE
	RFALSE

	.FUNCT SURE-IS-SPOOKY
	PRINTI "Whew! That "
	PRINTD CEMETERY
	PRINTI " sure is spooky."
	CRLF
	CRLF
	RTRUE

	.FUNCT SPOOKY-COPSE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "A copse of "
	PRINTD WILLOWS
	PRINTI "s makes this part of the "
	PRINTD CEMETERY
	PRINTI " look really spooky. Narrow lanes wander south and west.

There's an "
	PRINTD OPEN-GRAVE
	PRINTI " nearby, freshly dug, with a "
	PRINTD MONUMENTS
	PRINTI " erected next to it."
	IN? GRAVEDIGGER,SPOOKY-COPSE \?L5
	CRLF
	CRLF
	PRINTI "An old "
	PRINTD GRAVEDIGGER
	PRINTI " is resting under a "
	PRINTD WILLOWS
	PRINTI "."
?L5:	CRLF
	RTRUE

	.FUNCT EXIT-TO-LAKE
	FSET? NORTH-GATE,OPENBIT \?L1
	ZERO? SKEWED? /?L3
	CALL ESCAPE-VAPORS
	RETURN EDGE-OF-LAKE
?L3:	CALL SURE-IS-SPOOKY
	RETURN EDGE-OF-LAKE
?L1:	CALL ITS-CLOSED,NORTH-GATE
	RFALSE

	.FUNCT RETURN-TO-COPSE
	IN? GRAVEDIGGER,EDGE-OF-LAKE \?L1
	REMOVE GRAVEDIGGER
?L1:	RETURN SPOOKY-COPSE

	.FUNCT TWILIGHT-GLEN-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "The trees here are so thick, it's almost too dark to see! You can make out a"
	CALL OPEN-CLOSED,NORTH-GATE,1
	PRINTD NORTH-GATE
	PRINTI " "
	CALL TO-N >STACK
	PRINT STACK
	PRINTI ", and a narrow lane between the "
	PRINTD MONUMENTS
	PRINTI "s winds off "
	CALL TO-E >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT NORTH-GATE-F
	CALL THIS-IS-IT,NORTH-GATE
	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?ENTER /?L3
	EQUAL? PRSA,V?USE \?L1
?L3:	EQUAL? HERE,TWILIGHT-GLEN \?L4
	CALL DO-WALK,P?NORTH
	RTRUE
?L4:	CALL DO-WALK,P?SOUTH
	RTRUE
?L1:	CALL GENERIC-GATE?,NORTH-GATE >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT WALL-OF-DIRT
	PRINTI "You just walked into a wall of dirt."
	CRLF
	RFALSE

	.FUNCT ENTER-HOLE?
	ZERO? SKEWED? \?L1
	CALL CANT-GO
	RFALSE
?L1:	CALL CANT-FIT-INTO?,STR?195 >STACK
	ZERO? STACK \FALSE
	CALL MOVE-ALL,INSIDE-GRAVE,OPEN-GRAVE
	MOVE GRAVE,INSIDE-GRAVE
	RETURN TUNNEL-FORK

	.FUNCT ENTER-GRAVE
	CALL PRINT-ID,STR?255
	CALL CANT-FIT-INTO?,STR?256 >STACK
	ZERO? STACK \FALSE
	ZERO? SKEWED? /?L3
	CALL ESCAPE-VAPORS
	JUMP ?L4
?L3:	IN? GRAVEDIGGER,SPOOKY-COPSE \?L4
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " reaches into the "
	PRINTD OPEN-GRAVE
	PRINTI " and pulls you out. ""Don't go in there!"" he cries. ""You might get buried alive!"""
	CRLF
	CALL PRINT-ID,STR?257
	RFALSE
?L4:	CALL MOVE-ALL,OPEN-GRAVE,INSIDE-GRAVE
	RETURN INSIDE-GRAVE

	.FUNCT ESCAPE-VAPORS
	CALL INT,I-VAPORS >STACK
	PUT STACK,0,0
	FCLEAR VAPORS,RMUNGBIT
	EQUAL? DIGGER-SCRIPT,1,0 \?L1
	EQUAL? HERE,SPOOKY-COPSE /?L1
	CALL SURE-IS-SPOOKY >STACK
	RSTACK
?L1:	CALL SAY-THE,VAPORS
	PRINTI "s "
	CALL PICK-ONE,VAPOR-YELLS >STACK
	PRINT STACK
	PRINTI " as you escape their misty clutches."
	CRLF
	CRLF
	RTRUE

	.FUNCT GRAVE-TO-COPSE
	IN? BRANCH,PROTAGONIST \?L1
	CALL NEVER-GET-OUT-WITH,STR?30
	RFALSE
?L1:	IN? UMBRELLA,PROTAGONIST \?L3
	FSET? UMBRELLA,OPENBIT \?L3
	CALL NEVER-GET-OUT-WITH,STR?31
	RFALSE
?L3:	CALL WEIGHT,PROTAGONIST >STACK
	GRTR? STACK,18 \?L4
	CALL NEVER-GET-OUT-WITH,STR?258
	RFALSE
?L4:	PRINTI "With great difficulty, you manage to climb out of the "
	PRINTD OPEN-GRAVE
	PRINTI "."
	CRLF
	CRLF
	ZERO? SKEWED? /?L8
	SET 'DIGGER-SCRIPT,0
	CALL QUEUE,I-VAPORS,-1 >STACK
	PUT STACK,0,1
?L8:	CALL MOVE-ALL,INSIDE-GRAVE,OPEN-GRAVE
	MOVE GRAVE,INSIDE-GRAVE
	RETURN SPOOKY-COPSE

	.FUNCT NEVER-GET-OUT-WITH,STR
	PRINTI "You'll never climb out of the "
	PRINTD OPEN-GRAVE
	PRINTI " holding "
	PRINT STR
	PRINTR "!"

	.FUNCT ARE-YOU-SURE?
	EQUAL? HERE,OUTSIDE-CEMETERY \?L1
	FSET? SOUTH-GATE,OPENBIT \?L3
	CALL BE-SURE >STACK
	ZERO? STACK /FALSE
	ZERO? SKEWED? /?L7
	CALL SLAM-THE-GATE
	RFALSE
?L7:	RETURN CREEPY-CORNER
?L3:	CALL ITS-CLOSED,SOUTH-GATE
	RFALSE
?L1:	EQUAL? HERE,EDGE-OF-LAKE \FALSE
	FSET? NORTH-GATE,OPENBIT \?L13
	CALL BE-SURE >STACK
	ZERO? STACK /FALSE
	RETURN TWILIGHT-GLEN
?L13:	CALL ITS-CLOSED,NORTH-GATE
	RFALSE

	.FUNCT BE-SURE
	CALL SAY-THE,CEMETERY
	PRINTI " is a "
	CALL PICK-ONE,FRIGHTS >STACK
	PRINT STACK
	PRINTI " place"
	ZERO? SKEWED? /?L3
	PRINTI ", especially at night"
?L3:	PRINTI ". "
	CALL SAY-SURE
	PRINTI "go in there?"
	CALL YES? >STACK
	ZERO? STACK /?L12
	ZERO? SKEWED? /?L14
	SET 'DIGGER-SCRIPT,0
	CALL QUEUE,I-VAPORS,-1 >STACK
	PUT STACK,0,1
?L14:	CRLF
	PRINTI "You have been warned."
	CRLF
	CRLF
	RTRUE
?L12:	CALL THAT-WAS-CLOSE
	RFALSE

	.FUNCT SLAM-THE-GATE
	FCLEAR SOUTH-GATE,OPENBIT
	FSET SOUTH-GATE,LOCKEDBIT
	PRINTI "Clang! "
	CALL SUDDEN-GUST
	PRINTI "blows the "
	PRINTD SOUTH-GATE
	PRINTI " shut in your face."
	CRLF
	CRLF
	PRINT YOU-HEAR
	PRINTI "misty voices giggling "
	EQUAL? HERE,OUTSIDE-CEMETERY \?L5
	PRINTI "on the other side"
	JUMP ?L9
?L5:	PRINTI "all around you"
?L9:	PRINTR ", and a loud ""click"" as the gate locks."

	.FUNCT CEMETERY-F
	EQUAL? PRSA,V?FIND,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL IN-CEMETERY? >STACK
	ZERO? STACK \TRUE
	EQUAL? HERE,OUTSIDE-CEMETERY \?L5
	CALL SEE-IT,STR?259
	RTRUE
?L5:	EQUAL? HERE,EDGE-OF-LAKE \?L6
	CALL SEE-IT,STR?260
	RTRUE
?L6:	CALL REFER-TO-MAP
	RTRUE
?L1:	EQUAL? PRSA,V?ENTER,V?THROUGH,V?WALK-TO \FALSE
	CALL IN-CEMETERY? >STACK
	ZERO? STACK \TRUE
	EQUAL? HERE,OUTSIDE-CEMETERY \?L11
	CALL DO-WALK,P?WEST
	RTRUE
?L11:	EQUAL? HERE,EDGE-OF-LAKE \?L12
	CALL DO-WALK,P?SOUTH
	RTRUE
?L12:	CALL REFER-TO-MAP
	RTRUE

	.FUNCT IN-CEMETERY?
	EQUAL? HERE,CREEPY-CORNER,SPOOKY-COPSE,TWILIGHT-GLEN \FALSE
	PRINTR "It's all around you!"

	.FUNCT SEE-IT,STR
	PRINT YOU-SEE
	PRINTI "it to the "
	PRINT STR
	PRINTR "."

	.FUNCT MONUMENTS-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	EQUAL? HERE,SPOOKY-COPSE \?L3
	CALL SAY-THE,MONUMENTS
	PRINTI " next to the "
	PRINTD OPEN-GRAVE
	ZERO? SKEWED? /?L7
	CALL HAS-YOUR-NAME
	RTRUE
?L7:	PRINTR " is blank."
?L3:	PRINTI "The lettering"
	CALL TOO-FADED
	RTRUE
?L1:	CALL MOVING?,MONUMENTS >STACK
	ZERO? STACK /FALSE
	CALL PRINT-ID,STR?261
	CALL TOO-LARGE,MONUMENTS
	RTRUE

	.FUNCT TOO-FADED
	PRINTR " is too faded to read clearly."

	.FUNCT IN-OPEN-GRAVE,CONTEXT
	EQUAL? CONTEXT,M-CONT \FALSE
	CALL TOUCHING?,PRSO >STACK
	ZERO? STACK /FALSE
	PRINT CANT
	PRINTI " reach "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " from here. The "
	PRINTD OPEN-GRAVE
	PRINTI " is too deep."
	CRLF
	RETURN 2

	.FUNCT OPEN-GRAVE-F
	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO /?L3
	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-DOWN \?L1
?L3:	CALL DO-WALK,P?DOWN
	RTRUE
?L1:	EQUAL? PRSA,V?CLIMB-UP,V?EXIT \?L4
	CALL ALREADY-IN,OPEN-GRAVE,1
	RTRUE
?L4:	EQUAL? PRSA,V?LOOK-DOWN,V?SEARCH,V?EXAMINE /?L6
	EQUAL? PRSA,V?LOOK-INSIDE \?L5
?L6:	PRINTI "It's six feet deep and freshly dug."
	FIRST? OPEN-GRAVE >STACK \?L9
	PRINTI " "
	PRINT YOU-SEE
	CALL PRINT-CONTENTS,OPEN-GRAVE
	PRINTI " inside."
?L9:	CRLF
	RTRUE
?L5:	EQUAL? PRSA,V?THROW,V?PUT \?L16
	EQUAL? PRSI,OPEN-GRAVE \?L16
	EQUAL? PRSO,HANDS \?L17
	CALL NOTHING-EXCITING
	RTRUE
?L17:	EQUAL? PRSO,UMBRELLA \FALSE
	FSET? UMBRELLA,OPENBIT \FALSE
	CALL YOUD-HAVE-TO,STR?73,UMBRELLA
	RTRUE
?L16:	CALL GENERIC-GRAVE? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT GENERIC-GRAVE?
	EQUAL? PRSA,V?DIG \?L1
	PRINTR "It's deep enough already."
?L1:	EQUAL? PRSA,V?CLOSE \FALSE
	CALL HOW?
	RTRUE

	.FUNCT GRAVE-F
	EQUAL? PRSA,V?THROUGH,V?WALK-TO,V?ENTER /?L3
	EQUAL? PRSA,V?CLIMB-DOWN \?L1
?L3:	ZERO? SKEWED? /?L4
	CALL DO-WALK,P?NORTH
	RTRUE
?L4:	CALL ALREADY-AT,GRAVE
	RTRUE
?L1:	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-UP,V?EXIT \?L7
	CALL DO-WALK,P?OUT
	RTRUE
?L7:	EQUAL? PRSA,V?SEARCH,V?EXAMINE,V?LOOK-DOWN /?L9
	EQUAL? PRSA,V?LOOK-INSIDE \?L8
?L9:	CALL V-LOOK
	RTRUE
?L8:	EQUAL? PRSA,V?TAKE \?L10
	EQUAL? PRSI,GRAVE \?L10
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L10:	EQUAL? PRSA,V?THROW,V?PUT \?L11
	EQUAL? PRSI,GRAVE \?L11
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L11:	CALL GENERIC-GRAVE? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT ENTER-SPOOKY-COPSE
	ZERO? SKEWED? \?L1
	ZERO? DIGGER-SCRIPT \?L1
	CALL QUEUE,I-DIGGER-TALK,-1 >STACK
	PUT STACK,0,1
?L1:	RETURN SPOOKY-COPSE

	.FUNCT COPSE-TO-GLEN
	IN? GRAVEDIGGER,TWILIGHT-GLEN \?L1
	CALL QUEUE,I-BYE-DIGGER,-1 >STACK
	PUT STACK,0,1
	RETURN TWILIGHT-GLEN
?L1:	IN? GRAVEDIGGER,SPOOKY-COPSE \?L3
	CALL INT,I-DIGGER-TALK >STACK
	PUT STACK,0,0
	CALL QUEUE,I-DIGGER-FOLLOWS,-1 >STACK
	PUT STACK,0,1
?L3:	RETURN TWILIGHT-GLEN

	.FUNCT I-BYE-DIGGER
	CALL INT,I-BYE-DIGGER >STACK
	PUT STACK,0,0
	CRLF
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " is locking the "
	PRINTD NORTH-GATE
	PRINTI " from the outside as you approach."
	CALL OUT-OF-TROUBLE >STACK
	RSTACK

	.FUNCT OUT-OF-TROUBLE
	CALL THIS-IS-IT,GRAVEDIGGER
	CALL THIS-IS-IT,NORTH-GATE
	MOVE GRAVEDIGGER,EDGE-OF-LAKE
	FCLEAR NORTH-GATE,OPENBIT
	FSET NORTH-GATE,LOCKEDBIT
	PRINTI " ""Keep out of the "
	PRINTD CEMETERY
	PRINTI " after Dark,"" he tells you with a sly wink."
	CRLF
	CRLF
	PRINT YOU-HEAR
	PRINTI "him chuckling as he disappears "
	CALL TO-N >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT I-DIGGER-FOLLOWS
	CALL INT,I-DIGGER-FOLLOWS >STACK
	PUT STACK,0,0
	CRLF
	CALL SAY-THE,GRAVEDIGGER
	PRINTI " follows behind you. "
	IN? ENVELOPE,GRAVEDIGGER /?L5
	IN? ENVELOPE,SPOOKY-COPSE \?L3
?L5:	MOVE ENVELOPE,PROTAGONIST
	CALL FORGOT
	PRINTI " he says, handing it back to you."
	CALL YOU-ARE-HOLDING,ENVELOPE,1
	JUMP ?L8
?L3:	PRINTI """What's your hurry?"" he complains."
?L8:	CRLF
	CRLF
	PRINTI "Throwing a shovel over his shoulder, the "
	PRINTD GRAVEDIGGER
	PRINTI " ambles through the "
	PRINTD NORTH-GATE
	PRINTI " and locks it."
	CALL OUT-OF-TROUBLE >STACK
	RSTACK

	.FUNCT FORGOT
	PRINTI """Hey! You forgot your envelope!"""
	RTRUE

	.FUNCT COPSE-TO-CORNER
	IN? GRAVEDIGGER,SPOOKY-COPSE \?L1
	IN? ENVELOPE,GRAVEDIGGER /?L3
	IN? ENVELOPE,SPOOKY-COPSE \?L1
?L3:	CALL SAY-THE,GRAVEDIGGER
	PRINTI " yells, "
	CALL FORGOT
	CRLF
	CRLF
?L1:	RETURN CREEPY-CORNER

	.FUNCT WILLOWS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The droopy boughs sway eerily in the breeze."
?L1:	CALL GETTING-INTO? >STACK
	ZERO? STACK /FALSE
	CALL NO-FOOTHOLDS
	RTRUE

	.FUNCT NO-FOOTHOLDS
	PRINT CANT
	PRINTR ". There aren't any good footholds."

	.FUNCT VAPORS-F,CONTEXT=0
	ZERO? SKEWED? \?L1
	CALL CANT-SEE-ANY,VAPORS
	RETURN 2
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	CALL SAY-THE,VAPORS
	PRINTR "s stare back at you with translucent curiosity."
?L5:	CALL TOUCHING?,VAPORS >STACK
	ZERO? STACK /?L8
	PRINT CANT
	PRINTI " touch an "
	PRINTD VAPORS
	PRINTR "!"
?L8:	CALL TALKING-TO?,VAPORS >STACK
	ZERO? STACK /?L11
	CALL SAY-THE,VAPORS
	PRINTR "s pay no heed."
?L11:	EQUAL? PRSA,V?LISTEN \?L14
	CALL SAY-THE,VAPORS
	PRINTR "s' voices are hard to hear, but sinister."
?L14:	EQUAL? PRSA,V?THROW,V?FEED,V?GIVE \FALSE
	EQUAL? PRSI,VAPORS \FALSE
	REMOVE PRSO
	PRINTI "Silently, "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " disappears into the ghostly mist."
	CRLF
	EQUAL? PRSO,WISHBRINGER,SHOE \TRUE
	CALL I-LUCK
	RTRUE

	.FUNCT I-VAPORS,OBJ,NXT,DO-LUCK?=0
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,TWILIGHT-GLEN,SPOOKY-COPSE,CREEPY-CORNER \FALSE
	INC 'DIGGER-SCRIPT
	CRLF
	EQUAL? DIGGER-SCRIPT,1 \?L5
	PRINTI "As you glance around you notice luminous ribbons of mist darting among the "
	PRINTD MONUMENTS
	PRINTR "s. The air is filled with sinister voices."
?L5:	EQUAL? DIGGER-SCRIPT,2 \?L9
	FSET? VAPORS,RMUNGBIT \?L10
	FIRST? PROTAGONIST >OBJ /?L12
?L12:	CALL SAY-THE,VAPORS
	ZERO? OBJ /?L13
	PRINTI "s are eyeing "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	FSET? OBJ,WORNBIT \?L19
	PRINTI " you're wearing"
	JUMP ?L26
?L19:	PRINTI " in "
	PRINTD HANDS
	PRINTI "s"
	JUMP ?L26
?L13:	PRINTI "s are hovering around you"
?L26:	PRINTI " fiendishly"
	JUMP ?L31
?L10:	ZERO? LUCKY? /?L32
	FSET VAPORS,RMUNGBIT
	SET 'DIGGER-SCRIPT,1
?L32:	PRINTI "The luminous mists suddenly condense into a cloud of "
	PRINTD VAPORS
	PRINTI "s! Circling like "
	PRINTD SHARKS
	PRINTI ", they stroke your face with ghostly fingers and whisper dreadful secrets into your ears"
?L31:	PRINTR "."
?L9:	FIRST? PROTAGONIST >OBJ /?L40
?L40:	PRINTI "Giggling with mischievous Glee, the "
	PRINTD VAPORS
	PRINTI "s "
	ZERO? LUCKY? /?L45
	ZERO? OBJ \?L43
?L45:	FCLEAR VAPORS,RMUNGBIT
	CALL INT,I-VAPORS >STACK
	PUT STACK,0,0
	PRINTI "clutch your legs and cover your eyes with their luminous hands. "
	CALL SAY-THE,GROUND
	CALL BENEATH-FEET
	PRINTI " as the foggy fiends lift you high above the treetops"
	ZERO? OBJ /?L50
	PRINTI ", scatter your possessions"
?L50:	PRINTI " and carry you screaming"
	CALL INTO-NIGHT
	CALL PICK-ONE,DROP-OFFS >HERE
	MOVE PROTAGONIST,HERE
	CALL PRINT-ID,STR?262
?L57:	ZERO? OBJ /?L58
	NEXT? OBJ >NXT /?L61
?L61:	FCLEAR OBJ,WORNBIT
	CALL PICK-ONE,DROP-OFFS >STACK
	MOVE OBJ,STACK
	EQUAL? OBJ,WISHBRINGER,SHOE \?L62
	SET 'DO-LUCK?,1
?L62:	SET 'OBJ,NXT
	JUMP ?L57
?L58:	CALL COME-TO-SENSES
	ZERO? DO-LUCK? /FALSE
	CALL I-LUCK
	CALL I-GLOW >STACK
	RSTACK
?L43:	SET 'DIGGER-SCRIPT,1
	FCLEAR OBJ,WORNBIT
	CALL PICK-ONE,DROP-OFFS >STACK
	MOVE OBJ,STACK
	CALL PRINT-ID,STR?263
	FSET VAPORS,RMUNGBIT
	PRINTI "snatch "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	PRINTI " out of "
	PRINTD HANDS
	PRINTI "s and carry it away"
	CALL INTO-NIGHT
	CRLF
	EQUAL? OBJ,BROOM \?L74
	SET 'BROOM-SIT?,0
	RETURN BROOM-SIT?
?L74:	EQUAL? OBJ,WISHBRINGER,SHOE \FALSE
	CALL I-LUCK
	CALL I-GLOW >STACK
	RSTACK

	.FUNCT INSIDE-GRAVE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're at the bottom of an "
	PRINTD OPEN-GRAVE
	PRINTI ", surrounded by six-foot walls of dirt."
	ZERO? SKEWED? /?L5
	ZERO? DIGGER-SCRIPT \?L7
	PRINTI " A"
	JUMP ?L11
?L7:	PRINTI " Luminous ribbons of mist are swarming overhead, and a"
?L11:	PRINTI " dark hole is visible in the north wall."
?L5:	CRLF
	RTRUE

	.FUNCT HOLE-F
	ZERO? SKEWED? /?L3
	EQUAL? HERE,LOOKOUT-HILL,UNDER-HILL \?L1
	FSET? STUMP,OPENBIT /?L1
?L3:	CALL CANT-SEE-ANY,HOLE
	RETURN 2
?L1:	EQUAL? PRSA,V?THROUGH,V?ENTER,V?WALK-TO \?L6
	EQUAL? HERE,INSIDE-GRAVE,LOOKOUT-HILL \?L7
	CALL DO-WALK,P?IN
	RTRUE
?L7:	EQUAL? HERE,TUNNEL-FORK \?L9
	CALL DO-WALK,P?SOUTH
	RTRUE
?L9:	CALL DO-WALK,P?OUT
	RTRUE
?L6:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L11
	CALL CANT-MAKE-OUT-ANYTHING
	RTRUE
?L11:	CALL YOU-DONT-NEED,HOLE
	RETURN 2

	.FUNCT UMBRELLA-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The handle of the"
	CALL OPEN-CLOSED,UMBRELLA
	PRINTD UMBRELLA
	PRINTR " is carved like a parrot's head."
?L1:	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-ON,V?LOOK-INSIDE \?L7
	FSET? UMBRELLA,OPENBIT \?L8
	CALL NOTHING-INTERESTING,1
	RTRUE
?L8:	CALL ITS-CLOSED,UMBRELLA
	RTRUE
?L7:	EQUAL? PRSA,V?RAISE,V?OPEN \?L11
	EQUAL? PRSO,UMBRELLA \?L11
	FSET? UMBRELLA,OPENBIT \?L12
	CALL ALREADY-OPEN
	RTRUE
?L12:	IN? UMBRELLA,PROTAGONIST /?L14
	CALL YOUD-HAVE-TO,STR?216,UMBRELLA
	RTRUE
?L14:	EQUAL? HERE,INSIDE-GRAVE \?L15
	PRINTR "There's no room here!"
?L15:	PUTP UMBRELLA,P?SIZE,20
	FSET UMBRELLA,SURFACEBIT
	CALL NOW-CLOSED-OR-OPEN,UMBRELLA,1
	FSET? HERE,INDOORSBIT \TRUE
	CALL BAD-LUCK,STR?264
	RTRUE
?L11:	EQUAL? PRSA,V?LOWER,V?CLOSE \?L22
	FSET? UMBRELLA,OPENBIT \?L22
	IN? UMBRELLA,PROTAGONIST /?L23
	CALL YOUD-HAVE-TO,STR?216,UMBRELLA
	RTRUE
?L23:	PUTP UMBRELLA,P?SIZE,10
	FCLEAR UMBRELLA,SURFACEBIT
	RFALSE
?L22:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L26
	EQUAL? PRSI,UMBRELLA \?L26
	EQUAL? PRSO,UMBRELLA \?L27
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L27:	IN? UMBRELLA,PROTAGONIST /?L31
	CALL YOUD-HAVE-TO,STR?216,UMBRELLA
	RTRUE
?L31:	EQUAL? PRSO,HAT,COAT,SNAKE-CAN \?L32
	PRINTR "That would look silly."
?L32:	EQUAL? PRSA,V?PUT \?L35
	FSET? UMBRELLA,OPENBIT /?L35
	CALL ITS-CLOSED,UMBRELLA
	RTRUE
?L35:	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,5 \?L36
	CALL TOO-LARGE,PRSO
	RTRUE
?L36:	PRINTI "It immediately slides "
	EQUAL? PRSA,V?PUT-ON \?L40
	PRINTI "off"
	JUMP ?L44
?L40:	PRINTI "out"
?L44:	CALL AND-DROPS-OUT,PRSO
	RTRUE
?L26:	EQUAL? PRSA,V?RAISE,V?STAND-UNDER \?L47
	CALL DONT-HAVE?,UMBRELLA >STACK
	ZERO? STACK \TRUE
	FSET? UMBRELLA,OPENBIT /?L50
	CALL YOUD-HAVE-TO,STR?92,UMBRELLA
	RTRUE
?L50:	PRINT OKAY
	PRINTR "you look very cosmopolitan."
?L47:	EQUAL? PRSA,V?LIE-DOWN,V?STAND-ON,V?SIT /?L55
	EQUAL? PRSA,V?BURN,V?MUNG \FALSE
?L55:	EQUAL? PRSO,UMBRELLA \FALSE
	CALL RUIN,UMBRELLA
	RTRUE

	.FUNCT PUTTING-OPEN-UMBRELLA?
	EQUAL? PRSO,UMBRELLA \FALSE
	FSET? UMBRELLA,OPENBIT \FALSE
	CALL YOUD-HAVE-TO,STR?73,UMBRELLA
	RTRUE

	.FUNCT TREE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "This is no time for botanizing."
?L1:	CALL GETTING-INTO? >STACK
	ZERO? STACK /FALSE
	CALL NO-FOOTHOLDS
	RTRUE

	.FUNCT TUNNEL-FORK-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL SAY-CHAMBER
	CALL TO-N >STACK
	PRINT STACK
	PRINTR " and east, and there's a dark hole in the south wall."

	.FUNCT SAY-CHAMBER
	PRINTI "You're in a "
	CALL PICK-ONE,CRAMPS >STACK
	PRINT STACK
	PRINTI " under"
	PRINTD GROUND
	PRINTI " chamber. "
	RANDOM 100 >STACK
	LESS? 50,STACK /?L3
	PRINTI "Long"
	JUMP ?L7
?L3:	PRINTI "Cold"
?L7:	RANDOM 100 >STACK
	LESS? 50,STACK /?L10
	PRINTI ", "
	CALL PICK-ONE,CRAMPS >STACK
	PRINT STACK
?L10:	PRINTI " tunnels wander away "
	RTRUE

	.FUNCT INTO-GRAVE
	CALL CANT-FIT-INTO?,STR?195 >STACK
	ZERO? STACK \FALSE
	CALL MOVE-ALL,OPEN-GRAVE,INSIDE-GRAVE
	RETURN INSIDE-GRAVE

	.FUNCT TUNNEL-CORNER-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL SAY-CHAMBER
	CALL TO-S >STACK
	PRINT STACK
	PRINTR ", east and west."

	.FUNCT ENTER-GRUE-NEST
	ZERO? GRUE-COVERED? \?L1
	CALL ENABLED?,I-GRUE-SLEEP >STACK
	ZERO? STACK \?L1
	SET 'SLEEP-SCRIPT,0
	CALL QUEUE,I-GRUE-SLEEP,-1 >STACK
	PUT STACK,0,1
?L1:	RETURN GRUE-NEST

	.FUNCT UNDER-HILL-F,CONTEXT=0
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL SAY-CHAMBER
	CALL TO-S >STACK
	PRINT STACK
	PRINTI " and east.

The surrounding walls are almost obscured by the roots of a mighty tree. "
	FSET? STUMP,OPENBIT \?L5
	PRINTI "Feeble light streams in from an opening overhead"
	JUMP ?L9
?L5:	PRINTI "Overhead you can see the underside of a large "
	PRINTD STUMP
	PRINTI ". It appears to be hinged"
?L9:	PRINTR "."

	.FUNCT EXIT-NEST
	DEC 'SLEEP-SCRIPT
	RETURN TUNNEL-CORNER

	.FUNCT GRUE-NEST-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You have stumbled into the nesting place of a family of grues. Congratulations. Few indeed are the adventurers who have entered a grue's nest and lived as long as you have.

Everything is littered with rusty swords of elvish workmanship, piles of bones and other debris. A"
	CALL OPEN-CLOSED,REFRIGERATOR,1
	PRINTD REFRIGERATOR
	PRINTI " stands in one "
	PRINTD CORNER
	PRINTI " of the nest, and something"
	IN? BLANKET,BABY \?L7
	PRINTI " is curled up under a "
	PRINTD BLANKET
	JUMP ?L11
?L7:	PRINTI "... a small, dangerous-looking "
	PRINTD BABY
	PRINTI "... is curled up"
?L11:	PRINTI " in the other "
	PRINTD CORNER
	PRINTR ".

The only exit is to the west. Hope you survive long enough to use it."

	.FUNCT BABY-F,CONTEXT=0
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,BABY
	PRINTI " is "
	IN? BLANKET,BABY \?L5
	PRINTI "covered with a "
	PRINTD BLANKET
	JUMP ?L9
?L5:	PRINTI "dressed in swaddling clothes with a pink baby bonnet, has long, slavering fangs and appears to be sleeping"
?L9:	PRINTR "."
?L1:	EQUAL? PRSA,V?REPLY,V?HELLO,V?TELL /?L15
	EQUAL? PRSA,V?ASK-ABOUT,V?YELL,V?ALARM /?L15
	EQUAL? PRSA,V?QUESTION,V?ASK-FOR \?L14
?L15:	EQUAL? PRSO,BABY \?L14
	CALL WAKE-BABY,STR?265
	RETURN 2
?L14:	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT /?L19
	EQUAL? PRSA,V?THROW-OFF \?L18
?L19:	EQUAL? PRSI,BABY \?L18
	EQUAL? PRSO,BLANKET \?L20
	CALL COVER-GRUE
	RTRUE
?L20:	CALL WAKE-BABY
	RTRUE
?L18:	EQUAL? PRSA,V?HIDE \?L23
	EQUAL? PRSO,BABY \?L23
	ZERO? PRSI /?L23
	EQUAL? PRSI,BLANKET \?L24
	CALL COVER-GRUE
	RTRUE
?L24:	CALL PERFORM,V?PUT-ON,PRSI,BABY
	RTRUE
?L23:	EQUAL? PRSA,V?KISS \?L27
	CALL SAY-THE,BABY
	PRINTR " smiles in its sleep."
?L27:	EQUAL? PRSA,V?GIVE,V?FEED \?L30
	CALL YOUD-HAVE-TO,STR?266,BABY
	RTRUE
?L30:	CALL TOUCHING?,BABY >STACK
	ZERO? STACK /?L31
	CALL WAKE-BABY
	RETURN 2
?L31:	EQUAL? PRSA,V?LISTEN \FALSE
	CALL SAY-THE,BABY
	PRINTR " snores gently."

	.FUNCT WAKE-BABY,REASON
	PRINTI "Oh, no! "
	ZERO? REASON /?L3
	PRINT REASON
	JUMP ?L7
?L3:	PRINTI "Your reckless fumbling"
?L7:	PRINTI " woke up the "
	PRINTD BABY
	PRINTI "!

The little creature "
	ZERO? LIT /?L12
	PRINTI "blinks helplessly in the glow of"
	CALL CANDLE-OR-STONE
	JUMP ?L16
?L12:	PRINTI "gurgles angrily in the "
	PRINTD DARKNESS
?L16:	PRINTI "."
	CALL MOTHER-COMES >STACK
	RSTACK

	.FUNCT MOTHER-COMES
	PRINTI " It opens its slavering jaws and"
	CALL SUBWAY
	CRLF
	CRLF
	ZERO? LIT /?L3
	PRINTI "A very large creature, equipped with slavering fangs and wearing a calico apron,"
	JUMP ?L7
?L3:	PRINTI "Something very large"
?L7:	PRINTI " lurks into the nest"
	ZERO? LIT /?L12
	PRINTI ". Its mother-instinct overcomes its overwhelming fear of light long enough to devour"
	JUMP ?L16
?L12:	PRINTI " and devours"
?L16:	PRINTI " you."
	CALL PRINT-ID,STR?267
	CALL BAD-ENDING >STACK
	RSTACK

	.FUNCT SUBWAY
	PRINTI " emits a hideous, plaintive wail that reminds you of a subway screeching to a halt."
	RTRUE

	.FUNCT COVER-GRUE
	SET 'GRUE-COVERED?,1
	CALL INT,I-GRUE-SLEEP >STACK
	PUT STACK,0,0
	MOVE BLANKET,BABY
	PRINT OKAY
	PRINTI "the "
	PRINTD BABY
	PRINTI " is now covered with the "
	PRINTD BLANKET
	PRINTI ".

The creature stirs restlessly for an anxious moment. Then it settles into the comfortable "
	PRINTD DARKNESS
	PRINTI " of the "
	PRINTD BLANKET
	PRINTI ", sighs gently and lies still."
	CRLF
	CRLF
	CALL UPDATE-SCORE,3 >STACK
	RSTACK

	.FUNCT CANDLE-OR-STONE,OBJ
	IN? CANDLE,PROTAGONIST /?L3
	IN? CANDLE,HERE \?L1
?L3:	SET 'OBJ,CANDLE
	JUMP ?L4
?L1:	SET 'OBJ,WISHBRINGER
?L4:	PRINTI " "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	RTRUE

	.FUNCT I-GRUE-SLEEP
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,GRUE-NEST \FALSE
	ZERO? LIT \?L5
	SET 'SLEEP-SCRIPT,0
	RTRUE
?L5:	INC 'SLEEP-SCRIPT
	CRLF
	EQUAL? SLEEP-SCRIPT,1 \?L8
	PRINTI "Snoring fitfully, the "
	PRINTD BABY
	PRINTI " turns away from the light of"
	CALL CANDLE-OR-STONE
	PRINTR " and faces the wall."
?L8:	EQUAL? SLEEP-SCRIPT,2 \?L14
	CALL SAY-THE,BABY
	PRINTR " is stirring restlessly. It looks as if it's about to wake up!"
?L14:	PRINTI "With a toothy yawn, the "
	PRINTD BABY
	PRINTI " opens its big red eyes and blinks at you with surprise and fear."
	CALL MOTHER-COMES >STACK
	RSTACK

	.FUNCT REFRIGERATOR-F
	EQUAL? PRSA,V?READ,V?LOOK-ON,V?EXAMINE \?L1
	PRINTI "A label on the "
	PRINTD REFRIGERATOR
	PRINTI " reads, """
	CALL FROBOZZ,STR?268
	PRINTR "."""
?L1:	EQUAL? PRSA,V?OPEN \?L7
	FSET? REFRIGERATOR,OPENBIT /?L7
	CALL HANDLE-FRIDGE,STR?269
	RFALSE
?L7:	EQUAL? PRSA,V?CLOSE \?L8
	FSET? REFRIGERATOR,OPENBIT \?L8
	CALL HANDLE-FRIDGE,STR?270
	RFALSE
?L8:	EQUAL? PRSA,V?PUT-ON \?L9
	EQUAL? PRSI,REFRIGERATOR \?L9
	CALL NO-ROOM
	PRINTR "It's covered with debris."
?L9:	CALL MOVING?,REFRIGERATOR >STACK
	ZERO? STACK /?L12
	CALL TOO-LARGE,REFRIGERATOR
	RTRUE
?L12:	CALL HURT?,REFRIGERATOR >STACK
	ZERO? STACK /FALSE
	PRINTI "The owners"
	CALL PRINT-ID,STR?271
	CALL MIGHT-NOT-LIKE
	RTRUE

	.FUNCT HANDLE-FRIDGE,STR
	PRINTI "A light inside the "
	PRINTD REFRIGERATOR
	PRINT STR
	PRINTI " it."
	CRLF
	CRLF
	RTRUE

	.FUNCT BOTTLE-F,FULL?=0
	CALL THIS-IS-IT,BOTTLE
	IN? MILK,BOTTLE /?L1
	SET 'FULL?,0
	JUMP ?L2
?L1:	SET 'FULL?,1
?L2:	EQUAL? PRSA,V?READ,V?LOOK-ON,V?EXAMINE \?L3
	PRINTI "The words """
	CALL FROBOZZ,STR?272
	PRINTI """ are etched on the"
	CALL OPEN-CLOSED,BOTTLE
	PRINTD BOTTLE
	PRINTR "."
?L3:	EQUAL? PRSA,V?SEARCH,V?LOOK-DOWN,V?LOOK-INSIDE \?L11
	LOC BOTTLE >STACK
	EQUAL? STACK,HERE,PROTAGONIST /?L12
	CALL YOUD-HAVE-TO,STR?273,BOTTLE
	RTRUE
?L12:	PRINTI "There's "
	ZERO? FULL? /?L17
	PRINTI "a bit of "
	PRINTD MILK
	JUMP ?L21
?L17:	CALL PRINT-CONTENTS,BOTTLE
?L21:	PRINTI " in the "
	PRINTD BOTTLE
	PRINTR "."
?L11:	EQUAL? PRSA,V?DRINK-FROM,V?DRINK \?L24
	ZERO? FULL? /?L25
	CALL PERFORM,V?DRINK,MILK
	RTRUE
?L25:	CALL BOTTLE-EMPTY
	RTRUE
?L24:	EQUAL? PRSA,V?EMPTY,V?POUR \?L28
	ZERO? FULL? /?L29
	CALL PERFORM,V?POUR,MILK
	RTRUE
?L29:	CALL BOTTLE-EMPTY
	RTRUE
?L28:	EQUAL? PRSA,V?SHAKE \?L32
	ZERO? FULL? /?L33
	FSET? BOTTLE,OPENBIT \?L35
	CALL PERFORM,V?POUR,MILK
	RTRUE
?L35:	CALL SAY-THE,MILK
	PRINTR " doesn't look any better."
?L33:	CALL BOTTLE-EMPTY
	RTRUE
?L32:	EQUAL? PRSA,V?PUT \?L41
	EQUAL? PRSI,BOTTLE \?L41
	PRINTI "The mouth of the "
	PRINTD BOTTLE
	PRINTR " is too narrow."
?L41:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L44
	CALL DONT-HAVE?,BOTTLE >STACK
	ZERO? STACK \TRUE
?L44:	CALL HURT?,BOTTLE >STACK
	ZERO? STACK /FALSE
	PRINTI "Maybe you should read the "
	PRINTD BOTTLE
	PRINTI " first."
	CRLF
	CALL PRINT-ID,STR?274
	RTRUE

	.FUNCT BOTTLE-EMPTY
	CALL SAY-THE,BOTTLE
	PRINTR " is empty."

	.FUNCT ACCESS-MILK?
	IN? MILK,BOTTLE /?L1
	CALL BOTTLE-EMPTY
	RFALSE
?L1:	FSET? BOTTLE,OPENBIT /TRUE
	CALL YOUD-HAVE-TO,STR?92,BOTTLE
	RFALSE

	.FUNCT MILK-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL SAY-THE,MILK
	PRINTR " is dark brown, with little icky things lurking in it."
?L1:	IN? BOTTLE,PROTAGONIST /?L5
	CALL YOUD-HAVE-TO,STR?216,BOTTLE
	RTRUE
?L5:	EQUAL? PRSA,V?TASTE,V?DRINK-FROM,V?DRINK \?L6
	CALL ACCESS-MILK? >STACK
	ZERO? STACK /TRUE
	REMOVE MILK
	SET 'MILK-SCRIPT,4
	CALL QUEUE,I-DRINK,-1 >STACK
	PUT STACK,0,1
	PRINTR "Slurp! All gone."
?L6:	EQUAL? PRSA,V?TAKE,V?EMPTY,V?POUR /?L13
	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT /?L13
	EQUAL? PRSA,V?DROP \?L12
?L13:	EQUAL? PRSO,MILK \?L12
	CALL ACCESS-MILK? >STACK
	ZERO? STACK /TRUE
	REMOVE MILK
	CALL SAY-THE,MILK
	PRINTI " splashes all over the place."
	CRLF
	CALL ACCESSIBLE?,KITTY >STACK
	ZERO? STACK /?L18
	FSET? KITTY,RMUNGBIT /?L18
	CRLF
	CALL PRINT-ID,STR?275
	CALL GIVE-MILK-TO-CAT,KITTY
	RTRUE
?L18:	CALL ACCESSIBLE?,CHAOS >STACK
	ZERO? STACK /TRUE
	CRLF
	CALL PRINT-ID,STR?276
	CALL GIVE-MILK-TO-CAT,CHAOS
	RTRUE
?L12:	EQUAL? PRSA,V?GIVE,V?FEED \?L23
	EQUAL? PRSO,MILK \?L23
	FSET? PRSI,ACTORBIT \?L23
	CALL PERFORM,V?POUR,MILK
	RTRUE
?L23:	EQUAL? PRSA,V?SMELL \?L24
	CALL ACCESS-MILK? >STACK
	ZERO? STACK /TRUE
	PRINTR "The fumes make you queasy."
?L24:	EQUAL? PRSA,V?SHAKE \?L30
	CALL MEAN-BOTTLE
	CALL PERFORM,V?SHAKE,BOTTLE
	RTRUE
?L30:	EQUAL? PRSA,V?BITE,V?EAT \FALSE
	CALL NOT-SOLID
	RTRUE

	.FUNCT MEAN-BOTTLE
	PRINT I-ASSUME
	PRINTI " the "
	PRINTD BOTTLE
	PRINTI ".)"
	CRLF
	CRLF
	RTRUE

	.FUNCT I-DRINK
	DEC 'MILK-SCRIPT
	CRLF
	EQUAL? MILK-SCRIPT,3 \?L1
	PRINTI "You can feel little icky things sliding down your throat."
	CALL PRINT-ID,STR?277
	CRLF
	RTRUE
?L1:	EQUAL? MILK-SCRIPT,2 \?L5
	PRINTI "(The "
	PRINTD MILK
	PRINTI " is lurking in your stomach."
	CALL MAKE-IT-SNAPPY
	CRLF
	RTRUE
?L5:	EQUAL? MILK-SCRIPT,1 \?L8
	PRINTI "(The taste of the "
	PRINTD MILK
	PRINTI " is starting to wear off."
	CALL HOLD-YOUR-PEACE
	CRLF
	RTRUE
?L8:	SET 'MILK-SCRIPT,0
	CALL INT,I-DRINK >STACK
	PUT STACK,0,0
	PRINTI "(Thankfully, the icky taste of "
	PRINTD MILK
	PRINTR " is gone.)"

	.FUNCT WORM-F
	EQUAL? PRSA,V?TAKE \?L1
	EQUAL? PRSO,WORM \?L1
	CALL V-TAKE >STACK
	ZERO? STACK /TRUE
	CRLF
	CALL SAY-THE,WORM
	PRINTR " squirms with annoyance at your touch."
?L1:	EQUAL? PRSA,V?EXAMINE \?L8
	CALL SAY-THE,WORM
	PRINTI " is covered with nasty little bits of dirt and slime. It wriggles nervously"
	IN? WORM,PROTAGONIST \?L11
	PRINTI " in "
	PRINTD HANDS
?L11:	PRINTR " as you look at it."
?L8:	CALL TALKING-TO?,WORM >STACK
	ZERO? STACK /?L18
	CALL IT-IGNORES-YOU,WORM
	RETURN 2
?L18:	EQUAL? PRSA,V?KISS,V?TASTE,V?EAT \FALSE
	EQUAL? PRSO,WORM \FALSE
	PRINTI "Yuck! You've got to be kidding."
	CRLF
	CALL PRINT-ID,STR?278
	RTRUE

	.FUNCT DEBRIS-F
	EQUAL? HERE,GRUE-NEST /?L1
	CALL CANT-SEE-ANY
	RETURN 2
?L1:	CALL SEE-VERB? >STACK
	ZERO? STACK /?L5
	PRINTI "Aside from the ominous implications, you see nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTI " about the "
	PRINTD DEBRIS
	PRINTR "."
?L5:	CALL YOU-DONT-NEED,DEBRIS
	RETURN 2

	.FUNCT UNDER-CELL-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL SAY-CHAMBER
	CALL TO-N >STACK
	PRINT STACK
	PRINTI " and west."
	CRLF
	CRLF
	FSET? HIDDEN-HATCH,RMUNGBIT \?L5
	PRINTI "A patch of freshly-dried concrete is visible"
	JUMP ?L14
?L5:	FSET? UNDER-CELL,ONBIT \?L10
	PRINTI "Faint light is streaming in from a narrow hole"
	JUMP ?L14
?L10:	PRINTI "A dark, narrow hole is visible"
?L14:	PRINTR " overhead."

	.FUNCT TOWER-F
	ZERO? SKEWED? /?L3
	ZERO? SUCCESS? /?L1
?L3:	CALL CANT-SEE-ANY,TOWER
	RETURN 2
?L1:	CALL ENTER-FROM?,HILLTOP >STACK
	ZERO? STACK \TRUE
	CALL ENTER-FROM?,VESTIBULE,ROUND-CHAMBER,TOWER >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?EXAMINE \?L8
	CALL IN-TOWER? >STACK
	ZERO? STACK /?L9
	CALL V-LOOK
	RTRUE
?L9:	PRINTR "Its lonely outline fills you with dread."
?L8:	EQUAL? PRSA,V?LOOK-INSIDE \?L14
	CALL IN-TOWER? >STACK
	ZERO? STACK /?L15
	CALL V-LOOK
	RTRUE
?L15:	EQUAL? HERE,HILLTOP \?L18
	FSET? DRAWBRIDGE,OPENBIT \?L20
	CALL GO-INSIDE
	RTRUE
?L20:	CALL ITS-CLOSED,DRAWBRIDGE
	RTRUE
?L18:	PRINT CANT
	PRINTI ". "
	CALL TOO-FAR-AWAY,TOWER
	RTRUE
?L14:	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-BEHIND,V?LOOK-UNDER /?L27
	EQUAL? PRSA,V?LOOK-DOWN \?L26
?L27:	CALL HOW?
	RTRUE
?L26:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON \?L28
	CALL IN-TOWER? >STACK
	ZERO? STACK /?L29
	CALL DO-WALK,P?UP
	RTRUE
?L29:	CALL HOW?
	RTRUE
?L28:	EQUAL? PRSA,V?EXIT \?L32
	CALL IN-TOWER? >STACK
	ZERO? STACK /?L33
	CALL DO-WALK,P?OUT
	RTRUE
?L33:	CALL GET-IN-FIRST
	RTRUE
?L32:	EQUAL? PRSA,V?CLIMB-DOWN \?L36
	CALL IN-TOWER? >STACK
	ZERO? STACK /?L37
	CALL DO-WALK,P?DOWN
	RTRUE
?L37:	CALL HOW?
	RTRUE
?L36:	EQUAL? PRSA,V?THROW \?L40
	EQUAL? PRSI,TOWER \?L40
	CALL PERFORM,V?PUT,PRSO,MOAT
	RTRUE
?L40:	CALL TOUCHING?,TOWER >STACK
	ZERO? STACK /FALSE
	CALL IN-TOWER? >STACK
	ZERO? STACK \FALSE
	CALL TOO-FAR-AWAY,TOWER
	RTRUE

	.FUNCT IN-TOWER?
	EQUAL? HERE,ROUND-CHAMBER,TORTURE-CHAMBER,VESTIBULE /TRUE
	EQUAL? HERE,LABORATORY \FALSE
	RTRUE

	.FUNCT GET-IN-FIRST
	PRINTI "(You'll have to get inside the "
	PRINTD TOWER
	PRINTR " first.)"

	.FUNCT DRAWBRIDGE-F,BOPEN?=0
	ZERO? SKEWED? \?L1
	CALL CANT-SEE-ANY,DRAWBRIDGE
	RETURN 2
?L1:	FSET? DRAWBRIDGE,OPENBIT \?L5
	SET 'BOPEN?,1
?L5:	CALL THIS-IS-IT,DRAWBRIDGE
	EQUAL? PRSA,V?EXAMINE \?L7
	CALL SAY-THE,DRAWBRIDGE
	PRINTI " is "
	ZERO? BOPEN? /?L11
	PRINTI "open, providing a walkway across the moat and into"
	JUMP ?L15
?L11:	PRINTI "closed against the wall of"
?L15:	PRINTI " the "
	PRINTD TOWER
	PRINTR "."
?L7:	EQUAL? PRSA,V?LOWER,V?OPEN \?L20
	ZERO? BOPEN? /?L21
	CALL ITS-ALREADY,STR?279
	RTRUE
?L21:	CALL HIDDEN-MECH
	RTRUE
?L20:	EQUAL? PRSA,V?RAISE,V?CLOSE \?L24
	ZERO? BOPEN? /?L25
	CALL HIDDEN-MECH
	RTRUE
?L25:	CALL ITS-ALREADY,STR?280
	RTRUE
?L24:	EQUAL? PRSA,V?WALK-AROUND,V?CROSS,V?WALK-TO /?L29
	EQUAL? PRSA,V?EXIT,V?THROUGH,V?ENTER /?L29
	EQUAL? PRSA,V?CLIMB-ON \?L28
?L29:	EQUAL? HERE,HILLTOP \?L30
	CALL DO-WALK,P?IN
	RTRUE
?L30:	CALL DO-WALK,P?OUT
	RTRUE
?L28:	EQUAL? PRSA,V?LIE-DOWN,V?STAND-ON,V?SIT \?L33
	ZERO? BOPEN? /?L34
	CALL WASTE-OF-TIME
	RTRUE
?L34:	CALL ITS-CLOSED,DRAWBRIDGE
	RTRUE
?L33:	CALL TOUCHING?,DRAWBRIDGE >STACK
	ZERO? STACK /?L37
	EQUAL? HERE,HILLTOP \?L37
	ZERO? BOPEN? \?L37
	CALL TOO-FAR-AWAY,DRAWBRIDGE
	RTRUE
?L37:	EQUAL? PRSA,V?LOOK-UNDER \?L38
	EQUAL? HERE,HILLTOP \?L38
	CALL PERFORM,V?EXAMINE,MOAT
	RTRUE
?L38:	EQUAL? PRSA,V?THROW \FALSE
	EQUAL? PRSI,DRAWBRIDGE \FALSE
	CALL PERFORM,V?PUT,PRSO,MOAT
	RTRUE

	.FUNCT HIDDEN-MECH
	PRINT CANT
	PRINTI ". The mechanism that controls the "
	PRINTD DRAWBRIDGE
	PRINTI " is"
	IN? CRANK,ROUND-CHAMBER \?L3
	PRINTI "n't here"
	JUMP ?L7
?L3:	PRINTI " hidden"
?L7:	PRINTR "."

	.FUNCT MOAT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,MOAT
	PRINTR " is 20 feet wide and filled with black, oily water."
?L1:	EQUAL? PRSA,V?CROSS \?L5
	CALL PERFORM,V?CROSS,DRAWBRIDGE
	RTRUE
?L5:	CALL HANDLE-WATER? >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT STAIRWAY-F
	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON \?L1
	EQUAL? HERE,ROUND-CHAMBER \?L3
	CALL DO-WALK,P?UP
	RTRUE
?L3:	CALL ALREADY-AT,STAIRWAY,1
	RTRUE
?L1:	EQUAL? PRSA,V?CLIMB-DOWN \?L6
	EQUAL? HERE,LABORATORY \?L7
	CALL DO-WALK,P?DOWN
	RTRUE
?L7:	CALL ALREADY-AT,STAIRWAY
	RTRUE
?L6:	EQUAL? PRSA,V?THROW,V?PUT-ON,V?PUT \?L10
	EQUAL? PRSI,STAIRWAY \?L10
	PRINTI "Don't leave "
	CALL PRINT-ID,STR?281
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " on the "
	PRINTD STAIRWAY
	PRINTR "! Somebody might trip on it and get hurt."
?L10:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L15
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L15:	EQUAL? PRSA,V?LIE-DOWN,V?STAND-ON,V?SIT \?L18
	CALL LOITERING-ON,STAIRWAY
	RTRUE
?L18:	EQUAL? PRSA,V?LOOK-DOWN,V?EXAMINE \FALSE
	PRINTI "The damp, narrow "
	PRINTD STAIRWAY
	PRINTI " circles "
	EQUAL? HERE,ROUND-CHAMBER \?L22
	PRINTI "up"
	JUMP ?L26
?L22:	PRINTI "down"
?L26:	PRINTI "ward into the "
	PRINTD TOWER
	PRINTR "."

	.FUNCT ROUND-CHAMBER-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're in a round chamber at the very heart of the "
	PRINTD TOWER
	PRINTI ". The clammy stone walls are hung with a "
	PRINTD ART
	PRINTI ", all the same size and identically framed. Years of neglect have blackened the art almost beyond recognition."
	IN? CRANK,ROUND-CHAMBER \?L5
	CALL MENTION-CRANK
?L5:	CRLF
	CRLF
	PRINTI "In the "
	PRINTD CORNER
	PRINTI " is a"
	CALL OPEN-CLOSED,HATCH,1
	PRINTD HATCH
	PRINTI "."
	FSET? HATCH,OPENBIT \?L12
	PRINTI " Peering downward, you see a "
	PRINTD LADDER
	PRINTI " descending into gloom."
?L12:	CRLF
	CRLF
	PRINTI "A "
	PRINTD CORRIDOR
	PRINTI " disappears "
	CALL TO-N >STACK
	PRINT STACK
	PRINTI ", and a damp "
	PRINTD STAIRWAY
	PRINTI " winds upward into the "
	PRINTD TOWER
	PRINTR "."

	.FUNCT ENTER-LAB
	SET 'FUZZY-FROM,LABORATORY
	SET 'FUZZY?,1
	RETURN FUZZY

	.FUNCT DOWN-LADDER?
	FSET? HATCH,OPENBIT /?L1
	CALL ITS-CLOSED,HATCH
	RFALSE
?L1:	ZERO? CLAMPED? /?L4
	FCLEAR TORTURE-CHAMBER,TOUCHBIT
	PRINTI """Saved at last!"" mews a familiar voice as you descend."
	CRLF
	CRLF
?L4:	RETURN TORTURE-CHAMBER

	.FUNCT ART-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL COUNT-ART
	PRINTI " It seems to be a tragic sequence involving a beautiful princess and a wicked queen."
	IN? CRANK,ROUND-CHAMBER \?L5
	CALL MENTION-CRANK
?L5:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-BEHIND \?L8
	IN? CRANK,ROUND-CHAMBER \?L9
	CALL THIS-IS-IT,CRANK
	PRINTI "Aside from the "
	PRINTD CRANK
	PRINTI ", you see nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTR "."
?L9:	CALL SHOW-CRANK
	RTRUE
?L8:	EQUAL? PRSA,V?TAKE \?L14
	EQUAL? PRSO,ART \?L14
	PRINT CANT
	PRINTI " take the "
	PRINTD ART
	PRINTI "."
	CRLF
	CALL PRINT-ID,STR?282
	RTRUE
?L14:	CALL MOVING?,ART >STACK
	ZERO? STACK /?L17
	IN? CRANK,ROUND-CHAMBER \?L18
	CALL HACK-HACK,STR?283
	RTRUE
?L18:	CALL SHOW-CRANK
	RTRUE
?L17:	CALL HURT?,ART >STACK
	ZERO? STACK /?L21
	CALL SAY-THE,ART
	PRINTI " is already in pretty bad shape."
	CRLF
	CALL PRINT-ID,STR?284
	RTRUE
?L21:	EQUAL? PRSA,V?COUNT \FALSE
	CALL COUNT-ART
	CRLF
	RTRUE

	.FUNCT COUNT-ART
	PRINTI "There are 13 paintings in the series."
	RTRUE

	.FUNCT SHOW-CRANK
	MOVE CRANK,ROUND-CHAMBER
	CALL THIS-IS-IT,CRANK
	PRINTI "Moving aside one of the paintings reveals"
	CALL SAY-CRANK
	CRLF
	RTRUE

	.FUNCT MENTION-CRANK
	PRINTI " One of the paintings has been moved to reveal"
	CALL SAY-CRANK >STACK
	RSTACK

	.FUNCT SAY-CRANK
	PRINTI " a "
	PRINTD CRANK
	PRINTI " attached to the wall."
	RTRUE

	.FUNCT CRANK-F
	EQUAL? PRSA,V?USE,V?SPIN,V?TURN \?L1
	EQUAL? PRSO,CRANK \?L1
	PRINTI "As you turn the "
	PRINTD CRANK
	PRINTI " you "
	CALL HEAR-BRIDGE
	FSET? CRANK,RMUNGBIT \TRUE
	FCLEAR CRANK,RMUNGBIT
	CRLF
	CALL UPDATE-SCORE,1
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L8
	CALL FIRMLY-ATTACHED
	RTRUE
?L8:	CALL HURT?,CRANK >STACK
	ZERO? STACK \?L10
	EQUAL? PRSA,V?PUSH,V?PULL \FALSE
?L10:	CALL FIRMLY-ATTACHED,1
	RTRUE

	.FUNCT FIRMLY-ATTACHED,STILL?=0
	CALL SAY-THE,CRANK
	PRINTI " is"
	ZERO? STILL? /?L3
	PRINTI " still"
?L3:	PRINTR " firmly attached to the wall."

	.FUNCT HEAR-BRIDGE
	FCLEAR VESTIBULE,TOUCHBIT
	PRINTI "hear the distant rattle of the "
	PRINTD DRAWBRIDGE
	FSET? DRAWBRIDGE,OPENBIT \?L3
	FCLEAR DRAWBRIDGE,OPENBIT
	PRINTI " closing"
	JUMP ?L7
?L3:	FSET DRAWBRIDGE,OPENBIT
	PRINTI " opening"
?L7:	PRINTR "."

	.FUNCT CORRIDOR-F
	EQUAL? PRSA,V?ENTER,V?WALK-TO,V?FOLLOW /?L3
	EQUAL? PRSA,V?EXIT,V?USE,V?THROUGH \?L1
?L3:	EQUAL? HERE,LOBBY,VESTIBULE \?L4
	CALL DO-WALK,P?IN
	RTRUE
?L4:	CALL DO-WALK,P?OUT
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE,V?EXAMINE \?L7
	CALL SAY-THE,CORRIDOR
	PRINTI " leads "
	EQUAL? HERE,LOBBY,VESTIBULE \?L10
	PRINTI "in"
	JUMP ?L14
?L10:	PRINTI "out"
?L14:	PRINTR "side."
?L7:	EQUAL? PRSA,V?LISTEN \?L19
	CALL PERFORM,V?LISTEN,SOUND
	RTRUE
?L19:	CALL YOU-DONT-NEED,CORRIDOR
	RETURN 2

	.FUNCT EXIT-TOWER?
	CALL ESCAPING-CRISP? >STACK
	ZERO? STACK \FALSE
	FSET? DRAWBRIDGE,OPENBIT \?L3
	CALL QUEUE,I-SLAM-BRIDGE,-1 >STACK
	PUT STACK,0,1
	RETURN HILLTOP
?L3:	CALL ITS-CLOSED,DRAWBRIDGE
	RFALSE

	.FUNCT I-SLAM-BRIDGE
	CALL INT,I-SLAM-BRIDGE >STACK
	PUT STACK,0,0
	FCLEAR DRAWBRIDGE,OPENBIT
	CALL START-BUZZ,6
	CRLF
	PRINTI "The moment you take your foot off the "
	PRINTD DRAWBRIDGE
	PRINTI " it swings up over the "
	PRINTD MOAT
	PRINTR " and closes with a mighty thud."

	.FUNCT ESCAPING-CRISP?
	CALL ENABLED?,I-CRISP-CAPTURE >STACK
	ZERO? STACK /FALSE
	PRINTI "Uh-oh! Somebody's closing the "
	PRINTD DRAWBRIDGE
	PRINTR "!"

	.FUNCT INTO-ROUND-CHAMBER
	CALL ESCAPING-CRISP? >STACK
	ZERO? STACK \FALSE
	RETURN ROUND-CHAMBER

	.FUNCT VESTIBULE-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "in a dimly-lit vestibule just inside the "
	PRINTD TOWER
	PRINTI "'s "
	PRINTD ENTRANCE
	PRINTI ". "
	CALL SAY-THE,DRAWBRIDGE
	PRINTI " is "
	FSET? DRAWBRIDGE,OPENBIT \?L7
	PRINTI "opened across the moat "
	CALL TO-N >STACK
	PRINT STACK
	JUMP ?L11
?L7:	PRINTI "closed against the north wall"
?L11:	PRINTI ". A short "
	PRINTD CORRIDOR
	PRINTI " leads south, into the "
	PRINTD TOWER
	PRINTR "."

	.FUNCT CHAIN-PROOF?,OBJ
	ZERO? CHAINED? /FALSE
	CALL TALKING-TO?,OBJ >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?LOOK-THRU,V?LOOK-UNDER,V?EXAMINE /FALSE
	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-ON,V?LOOK-INSIDE /FALSE
	EQUAL? PRSA,V?READ,V?LISTEN,V?LOOK-BEHIND /FALSE
	EQUAL? PRSA,V?YELL /FALSE
	PRINT CANT
	PRINTI " reach "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	CALL WHILE-CHAINED
	RTRUE

	.FUNCT WHILE-CHAINED
	PRINTR " while you're chained up."

	.FUNCT HATCH-F,OPEN?
	CALL THIS-IS-IT,HATCH
	FSET? HATCH,OPENBIT /?L1
	SET 'OPEN?,0
	JUMP ?L2
?L1:	SET 'OPEN?,1
?L2:	CALL CHAIN-PROOF?,HATCH >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L5
	ZERO? OPEN? /?L6
	CALL SAY-THE,HATCH
	PRINTI " leads "
	EQUAL? HERE,ROUND-CHAMBER \?L10
	PRINTI "downward into gloom"
	JUMP ?L14
?L10:	PRINTI "up into the "
	PRINTD TOWER
?L14:	PRINTR "."
?L6:	CALL ITS-CLOSED,HATCH
	RTRUE
?L5:	EQUAL? PRSA,V?RAISE,V?OPEN \?L20
	ZERO? OPEN? /?L21
	CALL ALREADY-OPEN
	RTRUE
?L21:	FSET HATCH,OPENBIT
	PRINTI "The heavy "
	PRINTD HATCH
	PRINTR " opens reluctantly."
?L20:	EQUAL? PRSA,V?LOWER,V?CLOSE \?L26
	ZERO? OPEN? /?L27
	FCLEAR HATCH,OPENBIT
	CALL SAY-THE,HATCH
	PRINTR " closes with a heavy thud."
?L27:	CALL ALREADY-CLOSED
	RTRUE
?L26:	EQUAL? PRSA,V?PUSH \?L32
	EQUAL? HERE,ROUND-CHAMBER \?L33
	CALL PERFORM,V?CLOSE,HATCH
	RTRUE
?L33:	CALL PERFORM,V?OPEN,HATCH
	RTRUE
?L32:	EQUAL? PRSA,V?PULL,V?MOVE \?L36
	EQUAL? HERE,TORTURE-CHAMBER \?L37
	CALL PERFORM,V?CLOSE,HATCH
	RTRUE
?L37:	CALL PERFORM,V?OPEN,HATCH
	RTRUE
?L36:	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?ENTER \?L40
	EQUAL? HERE,ROUND-CHAMBER \?L41
	CALL DO-WALK,P?DOWN
	RTRUE
?L41:	CALL DO-WALK,P?UP
	RTRUE
?L40:	EQUAL? PRSA,V?CLIMB-DOWN \?L44
	CALL DO-WALK,P?DOWN
	RTRUE
?L44:	EQUAL? PRSA,V?CLIMB-UP \FALSE
	CALL DO-WALK,P?UP
	RTRUE

	.FUNCT LADDER-F
	FSET? HATCH,OPENBIT /?L1
	EQUAL? HERE,ROUND-CHAMBER \?L1
	CALL CANT-SEE-ANY,LADDER
	RETURN 2
?L1:	EQUAL? PRSA,V?USE,V?CLIMB-ON \?L5
	FSET? HATCH,OPENBIT \?L6
	EQUAL? HERE,TORTURE-CHAMBER \?L8
	CALL DO-WALK,P?UP
	RTRUE
?L8:	CALL DO-WALK,P?DOWN
	RTRUE
?L6:	CALL ITS-CLOSED,HATCH
	RTRUE
?L5:	EQUAL? PRSA,V?CLIMB-DOWN \?L12
	EQUAL? HERE,ROUND-CHAMBER \?L13
	CALL DO-WALK,P?DOWN
	RTRUE
?L13:	CALL ALREADY-AT,LADDER
	RTRUE
?L12:	EQUAL? PRSA,V?CLIMB-UP \?L16
	EQUAL? HERE,TORTURE-CHAMBER \?L17
	CALL PERFORM,V?CLIMB-ON,LADDER
	RTRUE
?L17:	CALL ALREADY-AT,LADDER,1
	RTRUE
?L16:	EQUAL? PRSA,V?LIE-DOWN,V?STAND-ON,V?SIT \?L20
	CALL LOITERING-ON,LADDER
	RTRUE
?L20:	EQUAL? PRSA,V?THROUGH \FALSE
	EQUAL? HERE,TORTURE-CHAMBER /?L22
	PRINT CANT
	PRINTR " do that here."
?L22:	ZERO? CHAINED? /?L26
	CALL NOT-GOING-ANYWHERE
	RTRUE
?L26:	PRINT OKAY
	PRINTI "you just walked under the "
	PRINTD LADDER
	PRINTI "."
	CRLF
	CALL BAD-LUCK,STR?285
	RTRUE

	.FUNCT EXIT-TORTURE?
	ZERO? CHAINED? /?L1
	CALL NOT-GOING-ANYWHERE
	RFALSE
?L1:	FSET? HATCH,OPENBIT \?L3
	ZERO? CLAMPED? /?L4
	PRINTI """Don't leave me here to die!"" mews "
	PRINTD PRINCESS
	PRINTI "."
	CRLF
	CRLF
	CALL PRINT-ID,STR?286
?L4:	RETURN ROUND-CHAMBER
?L3:	CALL ITS-CLOSED,HATCH
	RFALSE

	.FUNCT NOT-GOING-ANYWHERE
	PRINTI "You're not going anywhere"
	CALL WHILE-CHAINED >STACK
	RSTACK

	.FUNCT TORTURE-CHAMBER-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "You're "
	ZERO? CHAINED? /?L5
	PRINTI "chained up in the "
	PRINTD CORNER
	PRINTI " of"
	JUMP ?L9
?L5:	PRINTI "in"
?L9:	PRINTI " a dim, stuffy chamber, deep within the bowels of the "
	PRINTD TOWER
	PRINTI ". The walls gleam with obscure "
	PRINTD INSTRUMENTS
	PRINTI "s, and a diabolical "
	PRINTD TMACHINE
	PRINTI " occupies most of the opposite "
	PRINTD CORNER
	PRINTI "."
	CRLF
	CRLF
	IN? PRINCESS,TORTURE-CHAMBER \?L14
	PRINTD PRINCESS
	PRINTI " is "
	ZERO? CLAMPED? /?L18
	PRINTI "clamped into the "
	PRINTD TMACHINE
	PRINTI "!"
	JUMP ?L22
?L18:	PRINTI "waddling around the chamber."
?L22:	CRLF
	CRLF
?L14:	PRINTI "A "
	PRINTD LADDER
	PRINTI " rises to meet a"
	CALL OPEN-CLOSED,HATCH,1
	PRINTD HATCH
	PRINTI " in the middle of the ceiling."
	CRLF
	IN? CRISP,TORTURE-CHAMBER \FALSE
	CRLF
	PRINTD CRISP
	PRINTI " is "
	CALL PICK-ONE,STROLLS >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT INSTRUMENTS-F
	CALL CHAIN-PROOF?,INSTRUMENTS >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?READ,V?LOOK-ON,V?EXAMINE \?L3
	PRINTI "One of the "
	PRINTD INSTRUMENTS
	PRINTI "s is labeled, """
	CALL FROBOZZ,STR?287
	PRINTR "."" Gulp!"
?L3:	PRINTI "Better keep away from the "
	PRINTD INSTRUMENTS
	PRINTI "s. You might hurt somebody."
	CRLF
	RETURN 2

	.FUNCT CHAINS-F
	CALL THIS-IS-IT,CHAINS
	EQUAL? HERE,VESTIBULE \?L1
	CALL TAKE-MIND-OFF,CHAINS
	RTRUE
?L1:	EQUAL? PRSA,V?LOCK,V?CLOSE \?L3
	EQUAL? PRSO,CHAINS \?L3
	ZERO? CHAINED? \?L3
	CALL WASTE-OF-TIME
	RTRUE
?L3:	EQUAL? PRSA,V?RELEASE,V?UNLOCK,V?OPEN \?L4
	EQUAL? PRSO,CHAINS \?L4
	ZERO? CHAINED? \?L5
	CALL ALREADY-OPEN
	RTRUE
?L5:	ZERO? PRSI \?L7
	PRINTI "(with "
	PRINTD HANDS
	PRINTI ")"
	CRLF
	CALL THING-WONT-LOCK,HANDS,PRSO,1
	RTRUE
?L7:	EQUAL? PRSI,KEY /?L10
	CALL THING-WONT-LOCK,PRSI,PRSO,1
	RTRUE
?L10:	IN? KEY,PROTAGONIST /?L11
	CALL YOUD-HAVE-TO,STR?216,KEY
	RTRUE
?L11:	CALL OPEN-TORTURE-CHAINS
	CALL SAY-CHAIN-OPEN
	CRLF
	CALL UPDATE-SCORE,1
	RTRUE
?L4:	CALL HURT?,CHAINS >STACK
	ZERO? STACK \?L14
	CALL MOVING?,CHAINS >STACK
	ZERO? STACK \?L14
	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE,V?PICK \FALSE
?L14:	PRINTI "The"
	CALL OPEN-CLOSED,CHAINS
	PRINTD CHAINS
	PRINTR " is securely bolted into the floor."

	.FUNCT OPEN-TORTURE-CHAINS,OBJ
	SET 'CHAINED?,0
	FSET CHAINS,OPENBIT
	FCLEAR CHAINS,LOCKEDBIT
	FIRST? TORTURE-CHAMBER >OBJ \TRUE
?L8:	FCLEAR OBJ,THROWNBIT
	NEXT? OBJ >OBJ /?L8
	RTRUE

	.FUNCT SAY-CHAIN-OPEN
	PRINT OKAY
	PRINTI "the "
	PRINTD CHAINS
	PRINTR " is now unlocked and open."

	.FUNCT IN-COAT,CONTEXT
	EQUAL? CONTEXT,M-CONT \FALSE
	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR \?L3
	ZERO? COAT-WORN? /?L3
	CALL NOT-LIKELY,CRISP,STR?44
	RETURN 2
?L3:	CALL SEE-VERB? >STACK
	ZERO? STACK /?L7
	CALL YOU-CANT-SEE
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."
?L7:	ZERO? COAT-WORN? /?L10
	CALL CRISP-WEARING
	RTRUE
?L10:	IN? COAT,PROTAGONIST /FALSE
	CALL YOUD-HAVE-TO,STR?244,COAT
	RTRUE

	.FUNCT COAT-F,OBJ,NXT
	CALL THIS-IS-IT,COAT
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,COAT
	PRINTR " isn't as clean as the one your doctor wears."
?L1:	ZERO? COAT-WORN? /?L5
	CALL CRISP-WEARING
	RTRUE
?L5:	EQUAL? PRSA,V?LOOK-DOWN,V?SEARCH,V?LOOK-INSIDE \?L6
	IN? COAT,PROTAGONIST /?L6
	CALL YOUD-HAVE-TO,STR?216,COAT
	RTRUE
?L6:	EQUAL? PRSA,V?TAKE \?L7
	EQUAL? PRSO,COAT \?L7
	ZERO? CHAINED? /?L7
	FSET? COAT,TOUCHBIT /?L7
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	CALL SAY-THE,CHAINS
	PRINTI "s cut painfully into your wrist as you strain to grasp the "
	PRINTD COAT
	PRINTI ". Your fingertips brush against the collar... There! You got it!"
	CRLF
	CALL PRINT-ID,STR?288
	RTRUE
?L7:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L13
	PRINTR "You don't need to do that."
?L13:	EQUAL? PRSA,V?LIE-DOWN,V?SIT,V?STAND-ON /?L17
	EQUAL? PRSA,V?CROSS \?L16
?L17:	EQUAL? PRSO,COAT \?L16
	CALL WASTE-OF-TIME
	RTRUE
?L16:	EQUAL? PRSA,V?PUT-UNDER,V?PUT-ON,V?COVER \FALSE
	EQUAL? PRSI,COAT \FALSE
	CALL WASTE-OF-TIME
	RTRUE

	.FUNCT CRISP-WEARING
	PRINT CANT
	PRINTI " do that while "
	PRINTD CRISP
	PRINTR " is wearing the coat!"

	.FUNCT KEY-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	EQUAL? HERE,TORTURE-CHAMBER,LABORATORY \FALSE
	CALL SAY-THE,KEY
	PRINTI " looks as if it would fit into the "
	PRINTD CHAINS
	PRINTR "."

	.FUNCT TMACHINE-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?LOOK-ON,V?EXAMINE \?L1
	CALL SAY-THE,TMACHINE
	PRINTI " has a "
	PRINTD LEVER
	PRINTI " that"
	CALL DESCRIBE-LEVER
	PRINTI " "
	ZERO? CLAMPED? /?L7
	PRINTD PRINCESS
	PRINTI " is clamped"
	JUMP ?L11
?L7:	PRINT YOU-SEE
	CALL PRINT-CONTENTS,TMACHINE
?L11:	PRINTR " inside."
?L1:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L16
	EQUAL? PRSI,TMACHINE \?L16
	EQUAL? PRSO,KITTY \?L16
	ZERO? CLAMPED? /?L16
	PRINTD PRINCESS
	PRINTI " stops you. ""I don't like animals!"""
	CRLF
	CALL PRINT-ID,STR?289
	RTRUE
?L16:	CALL MOVING?,TMACHINE >STACK
	ZERO? STACK /?L19
	CALL TOO-LARGE,TMACHINE
	RTRUE
?L19:	EQUAL? PRSA,V?CLOSE \FALSE
	CALL HOW?
	RTRUE

	.FUNCT LEVER-F
	CALL CHAIN-PROOF?,LEVER >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?EXAMINE \?L3
	CALL SAY-THE,LEVER
	PRINTI " is attached to the "
	PRINTD TMACHINE
	PRINTI " in which "
	PRINTD PRINCESS
	PRINTI " "
	ZERO? CLAMPED? /?L6
	PRINTI "i"
	JUMP ?L10
?L6:	PRINTI "wa"
?L10:	PRINTI "s clamped. It"
	CALL DESCRIBE-LEVER
	CRLF
	RTRUE
?L3:	EQUAL? PRSA,V?RAISE,V?PUSH \?L15
	ZERO? CLAMPED? /?L16
	PRINTI """No!"" screams "
	PRINTD PRINCESS
	PRINTI "."
	CRLF
	CRLF
?L16:	CALL SAY-THE,TMACHINE
	PRINTI " emits a dreadful grinding noise and goes through a series of complicated gyrations. "
	ZERO? CLAMPED? /?L23
	CALL PRINCESS-POOF
	CALL PRINT-ID,STR?290
	CALL TORTURE,PRINCESS
	CRLF
	RTRUE
?L23:	IN? KITTY,TMACHINE \?L25
	CALL INT,I-FRISKY >STACK
	PUT STACK,0,0
	CALL PRINT-ID,STR?291
	CALL TORTURE,KITTY
	CRLF
	RTRUE
?L25:	FIRST? TMACHINE >STACK \?L26
	CALL MOVE-ALL,TMACHINE,STEEP-TRAIL
	PRINTI "When the grinding stops, the mechanism is empty."
	CALL PRINT-ID,STR?292
	CRLF
	RTRUE
?L26:	PRINTI "Good thing "
	PRINTD PRINCESS
	PRINTR " wasn't clamped into that awful thing!"
?L15:	EQUAL? PRSA,V?LOWER,V?PULL \?L32
	PRINTI "The clamps on the "
	PRINTD TMACHINE
	PRINTI " retract"
	ZERO? CLAMPED? /?L35
	CALL PRINCESS-POOF
	PRINTI ", and "
	PRINTD PRINCESS
	PRINTI " leaps off. She's free!

""Again you spare my unworthy life"
	PRINT ADVENTURER
	PRINTI "."" The "
	PRINTD PLATYPUS
	PRINTI " humbly licks your shoe, to your considerable embarrassment. ""My father, "
	PRINTD KING
	PRINTI ", does not forget such kindness.""

The little creature produces a "
	PRINTD WHISTLE
	PRINTI " from her gown and blows into it gently. "
	CALL PRINT-ID,STR?293
	CALL WHISTLE-SOUND
	CRLF
	PRINTI """Your journey is not yet ended,"" she warns as a whirlpool of colored light envelops her. ""But even if you fail, your deeds shall live forever in our legends. Have faith!""

When the colors fade, "
	PRINTD PRINCESS
	PRINTI " is gone"
?L35:	PRINTR "."
?L32:	EQUAL? PRSA,V?MOVE,V?USE \?L44
	CALL SAY-THE,LEVER
	CALL DESCRIBE-LEVER
	CRLF
	RTRUE
?L44:	EQUAL? PRSA,V?MUNG,V?TAKE \FALSE
	EQUAL? PRSO,LEVER \FALSE
	CALL SAY-THE,LEVER
	PRINTI " is firmly attached to the "
	PRINTD TMACHINE
	PRINTR "."

	.FUNCT DESCRIBE-LEVER
	PRINTI " can be pushed up or pulled down."
	RTRUE

	.FUNCT PRINCESS-POOF
	SET 'CLAMPED?,0
	MOVE PRINCESS,THRONE-ROOM
	CALL INT,I-PRINCESS-CALLS >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT TORTURE,THING
	CALL MOVE-ALL,TMACHINE,STEEP-TRAIL
	PRINTI "Mewling piteously, "
	CALL ARTICLE,THING,1
	PRINTD THING
	PRINTI " disappears into the whirling mass of gears. There's not a bone to be seen when the machine stops."
	CRLF
	CRLF
	CALL UPDATE-SCORE,-10
	CRLF
	PRINTI "(You ought to be ashamed of yourself!)"
	RTRUE

	.FUNCT FUZZY-F,CONTEXT,F,S
	EQUAL? CONTEXT,M-BEG \?L1
	CALL SEE-VERB? >STACK
	ZERO? STACK /FALSE
	PRINT CANT
	PRINTI ". "
	CALL ALL-FUZZY
	RETURN 2
?L1:	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL PICK-ONE,BLURS >F
?L11:	CALL PICK-ONE,BLURS >S
	EQUAL? S,F /?L11
	PRINTI "Everything around you appears "
	PRINT F
	PRINTI " and "
	PRINT S
	PRINTI "."
	CRLF
	FCLEAR FUZZY,TOUCHBIT
	RTRUE

	.FUNCT TOO-FUZZY
	PRINTI "It's too "
	CALL PICK-ONE,BLURS >STACK
	PRINT STACK
	PRINTI " in that direction."
	CRLF
	RFALSE

	.FUNCT ALL-FUZZY
	PRINTI "Everything is too "
	CALL PICK-ONE,BLURS >STACK
	PRINT STACK
	PRINTR "!"

	.FUNCT LABORATORY-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	PRINTI "The highest room in the "
	PRINTD TOWER
	PRINTI " is a laboratory, complete with bubbling "
	PRINTD CHEMICALS
	PRINTI " and foul odors. An "
	PRINTD SCOPE
	PRINTI " is mounted near an open "
	PRINTD WINDOW
	PRINTI " "
	CALL TO-N >STACK
	PRINT STACK
	PRINTI ", and a "
	PRINTD PANEL
	PRINTI " occupies most of the south wall.

The only exit is a damp "
	PRINTD STAIRWAY
	PRINTR " leading downward."

	.FUNCT EXIT-LAB
	SET 'FUZZY?,1
	SET 'FUZZY-FROM,ROUND-CHAMBER
	FCLEAR FUZZY,TOUCHBIT
	RETURN FUZZY

	.FUNCT SCOPE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,SCOPE
	PRINTI " is pointing out the "
	PRINTD WINDOW
	PRINTR "."
?L1:	CALL IMAGE?,SCOPE >STACK
	ZERO? STACK /?L5
	RETURN 2
?L5:	EQUAL? PRSA,V?USE,V?LOOK-THRU,V?LOOK-INSIDE /?L9
	EQUAL? PRSA,V?LOOK-DOWN \?L8
?L9:	PRINTI "Peering through the "
	PRINTD SCOPE
	PRINTR " makes everything appear much closer."
?L8:	CALL MOVING?,SCOPE >STACK
	ZERO? STACK /?L12
	CALL SAY-THE,SCOPE
	PRINTI " is bolted securely in place."
	CRLF
	CALL PRINT-ID,STR?294
	RTRUE
?L12:	CALL HURT?,SCOPE >STACK
	ZERO? STACK /?L15
	CALL PRINT-ID,STR?295
	CALL RUIN,SCOPE
	RTRUE
?L15:	CALL YOU-DONT-NEED,SCOPE
	RETURN 2

	.FUNCT IMAGE?,THING
	EQUAL? HERE,INSIDE-THEATER \FALSE
	EQUAL? PRSA,V?THROW \?L3
	EQUAL? PRSI,THING \?L3
	CALL PERFORM,V?THROW,PRSO,SCREEN
	RTRUE
?L3:	PRINT CANT
	CALL DO-TO
	PRINTR "a movie image!"

	.FUNCT WINDOW-F
	EQUAL? HERE,ROTARY-NORTH,INSIDE-CHURCH \?L1
	CALL CHURCH-WINDOWS-F >STACK
	ZERO? STACK /FALSE
	RTRUE
?L1:	ZERO? SKEWED? \?L6
	CALL CANT-SEE-ANY,WINDOW
	RETURN 2
?L6:	EQUAL? PRSA,V?EXAMINE \?L9
	PRINTI "It's wide open, "
	EQUAL? HERE,HILLTOP \?L12
	PRINTI "and located a hundred feet above the moat"
	JUMP ?L16
?L12:	PRINTI "affording a fine view of the "
	PRINTD FESTERON
?L16:	PRINTR "."
?L9:	EQUAL? HERE,HILLTOP \?L21
	CALL TOO-FAR-AWAY,WINDOW
	RTRUE
?L21:	EQUAL? PRSA,V?ENTER,V?LEAP,V?EXIT /?L23
	EQUAL? PRSA,V?THROUGH \?L22
?L23:	CALL PRINT-ID,STR?296
	CALL PERFORM,V?KILL,ME
	RTRUE
?L22:	EQUAL? PRSA,V?USE,V?LOOK-BEHIND,V?LOOK-INSIDE /?L25
	EQUAL? PRSA,V?LOOK-THRU \?L24
?L25:	CALL EXCELLENT-VIEW,WINDOW
	RTRUE
?L24:	EQUAL? PRSA,V?OPEN \?L26
	CALL ALREADY-OPEN
	RTRUE
?L26:	EQUAL? PRSA,V?CLOSE \FALSE
	PRINTI "It's not that kind of "
	PRINTD WINDOW
	PRINTR "."

	.FUNCT DESCRIBE-KITTY,CONTEXT
	EQUAL? CONTEXT,M-OBJDESC \FALSE
	PRINTI "A "
	PRINTD KITTY
	PRINTI " is "
	FSET? KITTY,RMUNGBIT \?L5
	PRINTI "sound asleep in the "
	PRINTD CORNER
	JUMP ?L9
?L5:	PRINTI "playing around your feet"
?L9:	PRINTI "."
	RTRUE

	.FUNCT KITTY-F,CONTEXT=0
	CALL THIS-IS-IT,KITTY
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL DESCRIBE-CHAOS
	PRINTI ", and "
	FSET? KITTY,RMUNGBIT \?L5
	PRINTI "sound asleep"
	JUMP ?L12
?L5:	IN? KITTY,PROTAGONIST \?L9
	PRINTI "squirming in your arms"
	JUMP ?L12
?L9:	PRINTI "playing around your feet"
?L12:	PRINTR "."
?L1:	CALL IMAGE?,KITTY >STACK
	ZERO? STACK /?L17
	RETURN 2
?L17:	EQUAL? PRSA,V?TAKE \?L20
	EQUAL? PRSO,KITTY \?L20
	CALL V-TAKE >STACK
	ZERO? STACK /TRUE
	CRLF
	CALL TOUCH-WAKE
	RTRUE
?L20:	CALL TALKING-TO?,KITTY >STACK
	ZERO? STACK \?L25
	EQUAL? PRSA,V?YELL \?L24
?L25:	CALL SAY-THE,KITTY
	FSET? KITTY,RMUNGBIT \?L26
	CALL WAKE-KITTY
	PRINTI " wakes"
	JUMP ?L30
?L26:	PRINTI " perks up its ears"
?L30:	PRINTI " at the sound of your voice."
	CRLF
	RETURN 2
?L24:	EQUAL? PRSA,V?SQUEEZE,V?KISS,V?RUB /?L38
	EQUAL? PRSA,V?PLAY \?L37
?L38:	CALL PRINT-ID,STR?297
	CALL TOUCH-WAKE
	RTRUE
?L37:	CALL HURT?,KITTY >STACK
	ZERO? STACK /?L39
	CALL PRINT-ID,STR?298
	CALL V-RAPE
	RTRUE
?L39:	EQUAL? PRSA,V?LISTEN \?L40
	PRINTR """Purrrrr..."""
?L40:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,KITTY \FALSE
	EQUAL? PRSO,KITTY \?L44
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L44:	FSET? KITTY,RMUNGBIT \?L48
	CALL BUT-THE,KITTY
	PRINTR "is asleep!"
?L48:	EQUAL? PRSO,MILK \?L51
	ZERO? FUZZY? \?L51
	ZERO? ECLIPSE? \?L51
	CALL READY-MILK
	CALL PRINT-ID,STR?299
	CALL GIVE-MILK-TO-CAT,KITTY
	RTRUE
?L51:	CALL NOT-LIKELY,KITTY,STR?300
	RTRUE

	.FUNCT TOUCH-WAKE
	CALL SAY-THE,KITTY
	PRINTI " "
	FSET? KITTY,RMUNGBIT \?L3
	CALL WAKE-KITTY
	PRINTI "awakens at your touch and "
?L3:	CALL PICK-ONE,NICES >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT WAKE-KITTY
	FCLEAR KITTY,RMUNGBIT
	SET 'HORSE-SCRIPT,5
	CALL QUEUE,I-FRISKY,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT READY-MILK
	REMOVE MILK
	PRINTI "("
	FSET? BOTTLE,OPENBIT /?L3
	FSET BOTTLE,OPENBIT
	PRINTI "opening the "
	PRINTD BOTTLE
	PRINTI " and "
?L3:	PRINTI "pouring out the "
	PRINTD MILK
	PRINTI " first)"
	CRLF
	CRLF
	RTRUE

	.FUNCT GIVE-MILK-TO-CAT,CAT
	CALL SAY-THE,KITTY
	IN? CAT,PROTAGONIST \?L1
	PRINTI " leaps from your arms and"
?L1:	PRINTI " eagerly laps the milk off the "
	CALL GROUND-OR-FLOOR
	PRINTI ". Its eyes turn red. Jets of brown steam issue from its ears, and it"
	CALL SUBWAY
	PRINTI " Then it runs away, yowling with anguish."
	CRLF
	REMOVE CAT
	EQUAL? CAT,CHAOS \?L12
	CRLF
	CALL UPDATE-SCORE,-10 >STACK
	RSTACK
?L12:	CALL INT,I-FRISKY >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT I-FRISKY
	CALL VISIBLE?,KITTY >STACK
	ZERO? STACK /TRUE
	DEC 'HORSE-SCRIPT
	EQUAL? HERE,OUTSIDE-COTTAGE \?L4
	IN? KITTY,PROTAGONIST \?L4
	CRLF
	CALL SAY-THE,KITTY
	PRINTI " scrambles out of your arms and scoots away at the sight of the enormous "
	PRINTD HELLHOUND
	PRINTI "."
	CALL GONE-WITHOUT-A-TRACE >STACK
	RSTACK
?L4:	ZERO? HORSE-SCRIPT \?L8
	CRLF
	CALL SAY-THE,KITTY
	IN? KITTY,PROTAGONIST \?L9
	SET 'HORSE-SCRIPT,3
	PRINTI " squirms out of your arms"
	CALL AND-DROPS-OUT,KITTY >STACK
	RSTACK
?L9:	IN? KITTY,TMACHINE \?L14
	PRINTI " jumps out of the "
	PRINTD TMACHINE
	PRINTI " and"
?L14:	PRINTI " scampers away behind your back."
	CALL GONE-WITHOUT-A-TRACE >STACK
	RSTACK
?L8:	EQUAL? HORSE-SCRIPT,2 \FALSE
	CRLF
	IN? KITTY,PROTAGONIST \?L22
	PRINTR "It's hard to hold the squirming cat!"
?L22:	CALL SAY-THE,KITTY
	IN? KITTY,TMACHINE \?L27
	PRINTI " eagerly explores the "
	PRINTD TMACHINE
	JUMP ?L31
?L27:	PRINTI " scampers restlessly around"
?L31:	PRINTR "."

	.FUNCT GONE-WITHOUT-A-TRACE
	PRINTI " You turn to catch it, but it's gone"
	CALL NO-TRACE
	CALL INT,I-FRISKY >STACK
	PUT STACK,0,0
	MOVE KITTY,STEEP-TRAIL
	RTRUE

	.FUNCT NO-TRACE
	PRINTR " without a trace!"

	.FUNCT CHEMICALS-F
	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL SAY-THE,CHEMICALS
	PRINTI " look dangerous."
	EQUAL? HERE,LABORATORY \?L5
	CALL LEAVE-THEM-ALONE
?L5:	CRLF
	RTRUE
?L1:	CALL IMAGE?,CHEMICALS >STACK
	ZERO? STACK /?L8
	RETURN 2
?L8:	CALL MOVING?,CHEMICALS >STACK
	ZERO? STACK /?L11
	CALL PRINT-ID,STR?301
	CALL CHEM-WARN,STR?302
	RTRUE
?L11:	CALL HURT?,CHEMICALS >STACK
	ZERO? STACK /?L12
	CALL PERFORM,V?TAKE,CHEMICALS
	RTRUE
?L12:	EQUAL? PRSA,V?KISS,V?TASTE,V?DRINK \?L13
	CALL PRINT-ID,STR?303
	CALL CHEM-WARN,STR?304
	RTRUE
?L13:	EQUAL? PRSA,V?SMELL \?L14
	PRINTI "The odor is like old socks and burning rubber."
	CRLF
	CALL PRINT-ID,STR?305
	RTRUE
?L14:	EQUAL? PRSA,V?EAT \?L17
	CALL PRINT-ID,STR?306
	CALL NOT-SOLID
	RTRUE
?L17:	CALL YOU-DONT-NEED,CHEMICALS
	RETURN 2

	.FUNCT CHEM-WARN,STR
	PRINT STR
	PRINTI " strange "
	PRINTD CHEMICALS
	PRINTI " is asking for trouble."
	CALL LEAVE-THEM-ALONE
	CRLF
	RTRUE

	.FUNCT PANEL-F
	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL SAY-THE,PANEL
	PRINTR " is equipped with two large power switches."
?L1:	CALL IMAGE?,PANEL >STACK
	ZERO? STACK /?L5
	RETURN 2
?L5:	EQUAL? PRSA,V?KICK,V?MUNG,V?TAKE \?L8
	EQUAL? PRSO,PANEL \?L8
	CALL SAY-THE,PANEL
	PRINTR " is firmly attached to the wall."
?L8:	CALL YOU-DONT-NEED,PANEL
	RETURN 2

	.FUNCT SW2-F
	CALL EXAM-SWITCH?,SW2,STR?307 >STACK
	ZERO? STACK \TRUE
	CALL IMAGE?,SW2 >STACK
	ZERO? STACK /?L3
	RETURN 2
?L3:	EQUAL? PRSA,V?OPEN,V?LAMP-OFF \?L6
	CALL OFF-SWITCH?,SW2 >STACK
	ZERO? STACK /TRUE
	CALL SAY-SWITCH,SW2
	FSET? SW2,RMUNGBIT \TRUE
	FCLEAR SW2,RMUNGBIT
	CRLF
	CALL UPDATE-SCORE,3
	RTRUE
?L6:	EQUAL? PRSA,V?CLOSE,V?LAMP-ON \?L13
	CALL ON-SWITCH?,SW2 >STACK
	ZERO? STACK /TRUE
	CALL SAY-SWITCH,SW2
	RTRUE
?L13:	CALL GENERIC-SWITCH?,SW2 >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT SW1-F
	CALL EXAM-SWITCH?,SW1,STR?308 >STACK
	ZERO? STACK \TRUE
	CALL IMAGE?,SW1 >STACK
	ZERO? STACK /?L3
	RETURN 2
?L3:	EQUAL? PRSA,V?OPEN,V?LAMP-OFF \?L6
	CALL OFF-SWITCH?,SW1 >STACK
	ZERO? STACK /TRUE
	CALL SAY-SWITCH,SW1
	RTRUE
?L6:	EQUAL? PRSA,V?CLOSE,V?LAMP-ON \?L10
	CALL ON-SWITCH?,SW1 >STACK
	ZERO? STACK /TRUE
	CALL SAY-SWITCH,SW1
	RTRUE
?L10:	CALL GENERIC-SWITCH?,SW1 >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT EXAM-SWITCH?,SW,STR
	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE /?L3
	EQUAL? PRSA,V?READ \FALSE
?L3:	CALL SAY-THE,SW
	PRINTI " is labeled, """
	PRINT STR
	PRINTI ","" and"
	CALL ON-OR-OFF,SW
	RTRUE

	.FUNCT SAY-SWITCH,SW
	PRINT OKAY
	PRINTI "the "
	PRINTD SW
	CALL ON-OR-OFF,SW >STACK
	RSTACK

	.FUNCT ON-OR-OFF,SW
	PRINTI " is turned "
	FSET? SW,OPENBIT \?L3
	PRINTI "off"
	JUMP ?L7
?L3:	PRINTI "on"
?L7:	PRINTR "."

	.FUNCT OFF-SWITCH?,SW
	FSET? SW,OPENBIT \?L1
	CALL BUT-THE,SW
	PRINTI "is already off!"
	CRLF
	RFALSE
?L1:	FSET SW,OPENBIT
	RTRUE

	.FUNCT ON-SWITCH?,SW
	FSET? SW,OPENBIT \?L1
	FCLEAR SW,OPENBIT
	RTRUE
?L1:	CALL BUT-THE,SW
	PRINTI "is already on!"
	CRLF
	RFALSE

	.FUNCT GENERIC-SWITCH?,SW
	CALL HURT?,SW >STACK
	ZERO? STACK \?L3
	EQUAL? PRSA,V?TAKE \?L1
?L3:	PRINTI "The switches are firmly attached to the "
	PRINTD PANEL
	PRINTR "."
?L1:	EQUAL? PRSA,V?PULL,V?MOVE,V?TURN /?L7
	EQUAL? PRSA,V?PUSH \?L6
?L7:	EQUAL? PRSO,SW \?L6
	FSET? SW,OPENBIT \?L8
	CALL PERFORM,V?CLOSE,SW
	RTRUE
?L8:	CALL PERFORM,V?OPEN,SW
	RTRUE
?L6:	EQUAL? PRSA,V?COUNT \FALSE
	CALL PERFORM,V?EXAMINE,PANEL
	RTRUE

	.FUNCT BROOM-F
	EQUAL? PRSA,V?ENTER,V?CLIMB-ON,V?SIT /?L3
	EQUAL? PRSA,V?RIDE \?L1
?L3:	ZERO? BROOM-SIT? /?L4
	PRINTI "But you're already"
	JUMP ?L9
?L4:	IN? BROOM,PROTAGONIST /?L8
	CALL YOUD-HAVE-TO,STR?216,BROOM
	RTRUE
?L8:	SET 'BROOM-SIT?,1
	PRINT OKAY
	PRINTI "you're now"
?L9:	CALL SITTING-ON-BROOM
	RTRUE
?L1:	EQUAL? PRSA,V?CLIMB-DOWN,V?EXIT,V?TAKE-OFF \?L12
	ZERO? BROOM-SIT? /?L13
	SET 'BROOM-SIT?,0
	PRINT OKAY
	PRINTI "you're no longer"
	JUMP ?L17
?L13:	PRINTI "But you're not"
?L17:	CALL SITTING-ON-BROOM
	RTRUE
?L12:	CALL HURT?,BROOM >STACK
	ZERO? STACK /?L20
	CALL PRINT-ID,STR?309
	CALL WASTE-OF-TIME
	RTRUE
?L20:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L21
	EQUAL? PRSI,BROOM \?L21
	EQUAL? PRSO,BROOM \?L22
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L22:	CALL SAY-THE,PRSO
	PRINTI " topples off the narrow broomstick"
	CALL AND-DROPS-OUT,PRSO
	RTRUE
?L21:	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \FALSE
	ZERO? BROOM-SIT? /FALSE
	PRINTI "You're"
	CALL SITTING-ON-BROOM
	RTRUE

	.FUNCT SITTING-ON-BROOM
	PRINTI " sitting on the "
	PRINTD BROOM
	PRINTR "."

	.FUNCT WHISTLE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL SAY-THE,WHISTLE
	PRINTI " is shaped like a "
	PRINTD PLATYPUS
	EQUAL? HERE,EDGE-OF-LAKE /?L7
	EQUAL? HERE,ISLAND,THRONE-ROOM \?L5
	ZERO? RETURN-FROM-ISLAND? /?L5
?L7:	PRINTI ", and twinkles with gentle Magick"
?L5:	PRINTR "."
?L1:	EQUAL? PRSA,V?BLOW-INTO \FALSE
	CALL DONT-HAVE?,WHISTLE >STACK
	ZERO? STACK \TRUE
	CALL WHISTLE-SOUND
	ZERO? BEEN-TO-ISLAND? \?L17
	EQUAL? HERE,EDGE-OF-LAKE \?L17
	SET 'BEEN-TO-ISLAND?,1
	CRLF
	CALL SAY-THE,WHISTLE
	PRINTI "'s music echoes over the lake, rippling the water with gentle Magick. "
	CALL SUDDEN-GUST
	PRINTI "blows through your hair. "
	PRINT YOU-SEE
	PRINTI "the soft outline of "
	PRINTD ISLAND
	PRINTI " drawing closer as you streak across the waves..."
	CALL CARRIAGE-RETURNS
	MOVE PROTAGONIST,ISLAND
	SET 'HERE,ISLAND
	CALL V-LOOK
	RTRUE
?L17:	ZERO? RETURN-FROM-ISLAND? /TRUE
	EQUAL? HERE,ISLAND,THRONE-ROOM \TRUE
	CALL PRINT-ID,STR?310
	REMOVE WHISTLE
	IN? BOOTS,FESTERON-POINT /?L24
	SET 'BOOT-LOC,0
	MOVE BOOTS,FESTERON-POINT
?L24:	MOVE PROTAGONIST,EDGE-OF-LAKE
	SET 'HERE,EDGE-OF-LAKE
	CRLF
	CALL SUDDEN-GUST
	PRINTI "rises out of nowhere, and "
	PRINTD ISLAND
	CALL BENEATH-FEET
	PRINTI ". You feel the "
	PRINTD WHISTLE
	PRINTI " slip from "
	PRINTD HANDS
	PRINTI " as you streak across the lake..."
	CALL CARRIAGE-RETURNS
	CALL V-LOOK
	RTRUE

	.FUNCT WHISTLE-SOUND
	PRINTR "A clear, sweet note stills the night with its beauty."

	.FUNCT ISLAND-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL STANDING
	PRINTI "on a fog-shrouded beach. Sheer cliff walls rise "
	CALL TO-N >STACK
	PRINT STACK
	PRINTI " and south, and the dark waters of the lake stretch eastward.

To the west stands a magnificent "
	PRINTD CASTLE
	PRINTI ", its parapets rising high into the mist. Golden light streams invitingly through the open "
	PRINTD ENTRANCE
	PRINTI ". "
	PRINT YOU-HEAR
	PRINTR "friendly voices and music inside."

	.FUNCT ENTER-THRONE-ROOM
	ZERO? KING-SCRIPT \?L1
	SET 'ANGER,4
	CALL QUEUE,I-KING-BLAB,-1 >STACK
	PUT STACK,0,1
?L1:	RETURN THRONE-ROOM

	.FUNCT PLATS-BLOCK
	CALL THIS-IS-IT,CROWD
	CALL SAY-THE,CROWD
	PRINTI " blocks your path."
	CRLF
	RFALSE

	.FUNCT EXIT-THRONE-ROOM
	CALL ENABLED?,I-KING-BLAB >STACK
	ZERO? STACK /?L1
	LESS? KING-SCRIPT,4 \?L1
	PRINTI """Wait!"" cries the white "
	PRINTD PLATYPUS
	PRINTI ". """
	LOC HAT >STACK
	EQUAL? STACK,KING,THRONE-ROOM \?L5
	PRINTI "You forgot the "
	PRINTD HAT
	JUMP ?L9
?L5:	PRINTI "I wish to speak with you"
?L9:	PRINTI "!"""
	CRLF
	CRLF
?L1:	RETURN ISLAND

	.FUNCT THRONE-ROOM-F,CONTEXT
	EQUAL? CONTEXT,M-LOOK \FALSE
	CALL THIS-IS-IT,CROWD
	CALL THIS-IS-IT,KING
	CALL THIS-IS-IT,PRINCESS
	CALL STANDING
	PRINTI "in a long, high-ceilinged chamber. Hundreds of "
	PRINTD PLATYPUS
	PRINTI "es are "
	GRTR? KING-SCRIPT,1 \?L5
	PRINTI "watching you respectfully"
	JUMP ?L9
?L5:	PRINTI "milling about with teacups in their paws"
?L9:	PRINTI ", their faces illuminated by a roaring fireplace.

At the far end of the chamber stands a mighty throne. It's occupied by a snow-white "
	PRINTD PLATYPUS
	PRINTI " with a gold crown on its head and a jeweled scepter in its paw. On the floor near the throne is another crowned "
	PRINTD PLATYPUS
	PRINTR "... the same one you rescued from the pit."

	.FUNCT I-KING-BLAB
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,THRONE-ROOM \FALSE
	CRLF
	IN? HAT,KING \?L5
	DEC 'ANGER
	ZERO? ANGER \?L7
	CALL KING-ANNOYED
	RTRUE
?L7:	PRINTI """"
	CALL PICK-ONE,KING-OFFERS >STACK
	PRINT STACK
	PRINTI ","" says "
	PRINTD KING
	PRINTR ", holding it out to you."
?L5:	INC 'KING-SCRIPT
	EQUAL? KING-SCRIPT,1 \?L13
	CALL SAY-THE,CROWD
	PRINTI " falls silent as you enter.

""Welcome"
	PRINT ADVENTURER
	PRINTI ","" says the white "
	PRINTD PLATYPUS
	PRINTI ", rising from its throne to greet you. ""I am Anatinus, King of "
	PRINTD ISLAND
	PRINTI ". My court thanks you most humbly for rescuing the life of my daughter, "
	PRINTD PRINCESS
	PRINTI ". Great would our sorrow have been if not for your cunning.""

The "
	PRINTD CROWD
	PRINTI " applauds politely, and "
	PRINTD PRINCESS
	PRINTR " blushes."
?L13:	EQUAL? KING-SCRIPT,2 \?L17
	CALL THIS-IS-IT,HAT
	MOVE HAT,KING
	PRINTI """My messengers have told me of your quest,"" continues "
	PRINTD KING
	PRINTI ". ""Allow me to repay your kindness with words of advice.""

The old "
	PRINTD PLATYPUS
	PRINTI " motions you to his side. ""The Tower of"
	PRINT EONE
	PRINTI " is formidable,"" he begins in a low, serious voice. ""You will never get inside unaided. Legends speak of a Magick Word that can open the gates of the Tower. But what Word it is, none can say.""

The king reaches beneath his throne and takes out a small "
	PRINTD HAT
	PRINTR ". ""Take this,"" he says, holding it out to you."
?L17:	EQUAL? KING-SCRIPT,3 \?L20
	PRINTI """Take it to the sea,"" "
	PRINTD KING
	PRINTI " whispers as you turn the hat in "
	PRINTD HANDS
	PRINTR "s. ""There you will find a creature learned in the lore of Magick. Heed him well! In his wisdom lies your only hope."""
?L20:	EQUAL? KING-SCRIPT,4 \?L23
	SET 'ANGER,4
	SET 'RETURN-FROM-ISLAND?,1
	CALL THIS-IS-IT,WHISTLE
	PRINTI "A fanfare of trumpets breaks the silence, and the "
	PRINTD CROWD
	PRINTI " falls to its knees."
	CRLF
	CRLF
	CALL REAPPEARS
	PRINTI """Good luck to you"
	PRINT ADVENTURER
	PRINTI "!"" cries "
	PRINTD KING
	PRINTI ", bowing deeply. ""Now blow into the "
	PRINTD WHISTLE
	PRINTI " one more time, and deliver us from the horror of"
	PRINT EONE
	PRINTI ".""

The "
	PRINTD PLATYPUS
	PRINTR "es look at you expectantly."
?L23:	CALL REAPPEARS
	DEC 'ANGER
	ZERO? ANGER \?L29
	CALL KING-ANNOYED,1 >STACK
	RSTACK
?L29:	PRINTI """"
	CALL PICK-ONE,SCRAMS >STACK
	PRINT STACK
	PRINTI ","" says "
	PRINTD KING
	PRINTR "."

	.FUNCT REAPPEARS,THING=0
	CALL HELD?,WHISTLE >STACK
	ZERO? STACK \?L1
	SET 'THING,WHISTLE
	JUMP ?L3
?L1:	CALL HELD?,HAT >STACK
	ZERO? STACK \?L3
	SET 'THING,HAT
?L3:	ZERO? THING /FALSE
	MOVE THING,PROTAGONIST
	CALL SAY-THE,THING
	PRINTI " magically reappears in "
	PRINTD HANDS
	PRINTI "."
	CRLF
	CRLF
	RTRUE

	.FUNCT KING-ANNOYED,BLOW?=0
	CALL SAY-THE,KING
	PRINTI " glares at you with annoyance.

""You dare to ignore a royal "
	ZERO? BLOW? /?L3
	PRINTI "command"
	JUMP ?L7
?L3:	PRINTI "gift"
?L7:	PRINTI "?"" he cries, deeply offended. ""I see. Perhaps a short visit to the granola mines will teach you some respect!""

The King turns you into a "
	PRINTD PLATYPUS
	PRINTI " with an angry wave of his scepter, and the guards lead you away to twenty years of backbreaking labor."
	CALL PRINT-ID,STR?311
	CALL BAD-ENDING >STACK
	RSTACK

	.FUNCT HAT-F,TEMP
	EQUAL? PRSA,V?READ,V?LOOK-ON,V?EXAMINE \?L1
	CALL SAY-THE,HAT
	PRINTR " is decorated with foil stars and cheap glitter."
?L1:	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE \?L5
	CALL DONT-HAVE?,HAT >STACK
	ZERO? STACK \TRUE
	FCLEAR HAT,RMUNGBIT
	PRINTR "Weird! It's like peering into an endless well."
?L5:	EQUAL? PRSA,V?TAKE \?L11
	IN? HAT,PELICAN \?L11
	CALL SAY-THE,PELICAN
	PRINTI " would rather you didn't."
	CRLF
	CALL PRINT-ID,STR?312
	RTRUE
?L11:	EQUAL? PRSA,V?WEAR \?L14
	CALL TOO-LARGE,HAT,1
	RTRUE
?L14:	EQUAL? PRSA,V?THROW,V?PUT \?L15
	EQUAL? PRSI,HAT \?L15
	CALL DONT-HAVE?,HAT >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSO,HAT \?L18
	CALL WHAT-A-CONCEPT
	RTRUE
?L18:	EQUAL? PRSO,HANDS \?L19
	PRINTI "You feel "
	PRINTD HANDS
	PRINTR " tingling."
?L19:	GETP PRSO,P?SIZE >TEMP
	GRTR? TEMP,5 \?L23
	CALL TOO-LARGE,PRSO
	RTRUE
?L23:	FSET? HAT,RMUNGBIT \?L25
	PRINTI "Maybe you should look inside the "
	PRINTD HAT
	PRINTR " first."
?L25:	CALL SAY-SURE
	PRINTI "put "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " into the "
	PRINTD HAT
	PRINTI "?"
	CALL YES? >STACK
	ZERO? STACK /?L33
	GETP DCASE,P?CAPACITY >STACK
	ADD TEMP,STACK >TEMP
	PUTP DCASE,P?CAPACITY,TEMP
	MOVE PRSO,DCASE
	CALL SAY-THE,PRSO
	PRINTI " disappears into the "
	PRINTD HAT
	CALL NO-TRACE
	RTRUE
?L33:	PRINT OKAY
	PRINTI "you're still holding "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR "."
?L15:	EQUAL? PRSA,V?REACH-IN \FALSE
	CALL PERFORM,V?PUT,HANDS,HAT
	RTRUE

	.FUNCT PRINCESS-F,CONTEXT=0
	CALL THIS-IS-IT,PRINCESS
	EQUAL? HERE,VESTIBULE \?L1
	CALL TAKE-MIND-OFF,PRINCESS
	RTRUE
?L1:	EQUAL? HERE,TORTURE-CHAMBER \?L3
	EQUAL? PRSA,V?MOVE,V?PUSH,V?TAKE \?L4
	ZERO? CLAMPED? /?L6
	CALL STILL-CLAMPED
	RTRUE
?L6:	PRINTD PRINCESS
	PRINTI " probably wouldn't enjoy being manhandled."
	CRLF
	CALL PRINT-ID,STR?313
	RTRUE
?L4:	CALL ASKING?,PRINCESS >STACK
	ZERO? STACK /?L11
	ZERO? COAT-WORN? /?L12
	CALL NO-TALKING
	RETURN 2
?L12:	CALL HAD-TIME,STR?314
	RETURN 2
?L11:	EQUAL? PRSA,V?HELLO,V?REPLY,V?TELL /?L18
	EQUAL? PRSA,V?WAVE-AT \?L17
?L18:	ZERO? COAT-WORN? /?L19
	CALL NO-TALKING
	RETURN 2
?L19:	CALL HAD-TIME,STR?315
	RETURN 2
?L17:	EQUAL? PRSA,V?RELEASE,V?UNLOCK,V?RESCUE \?L24
	CALL HOW?
	RTRUE
?L24:	CALL HURT?,PRINCESS >STACK
	ZERO? STACK \?L27
	EQUAL? PRSA,V?RUB,V?KISS,V?YELL /?L27
	EQUAL? PRSA,V?SQUEEZE \?L25
?L27:	CALL PRINT-ID,STR?316
	PRINTD PRINCESS
	CALL MIGHT-NOT-LIKE
	RTRUE
?L25:	EQUAL? PRSA,V?GIVE \?L28
	EQUAL? PRSI,PRINCESS \?L28
	ZERO? COAT-WORN? /?L29
	CALL NO-TALKING
	RTRUE
?L29:	PRINTD PRINCESS
	PRINTR " gracefully declines your offer."
?L28:	CALL PRINCESS-SPECIFIC? >STACK
	ZERO? STACK /FALSE
	RTRUE
?L3:	CALL CROWD-F >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT STILL-CLAMPED
	CALL BUT-THE,PRINCESS
	PRINTI "is still clamped into the "
	PRINTD TMACHINE
	PRINTR "!"

	.FUNCT HAD-TIME,STR
	PRINTI """Would that we had time for "
	PRINT STR
	PRINTI ","" sighs "
	PRINTD PRINCESS
	PRINTR "."

	.FUNCT NO-TALKING
	PRINTI """No communication between prisoners!"" barks "
	PRINTD CRISP
	PRINTR "."

	.FUNCT TAKE-MIND-OFF,OBJ
	PRINTI "A rumbling noise calls your attention away from "
	CALL ARTICLE,OBJ,1
	PRINTD OBJ
	PRINTR "."

	.FUNCT PRINCESS-SPECIFIC?
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "Not unexpectedly, "
	EQUAL? PRSO,PRINCESS \?L5
	ZERO? CLAMPED? /?L5
	PRINTI "the Princess clamped into the "
	PRINTD TMACHINE
	JUMP ?L9
?L5:	CALL ARTICLE,PRSO,1
	PRINTD PRSO
?L9:	PRINTI " is arrayed in high "
	PRINTD PLATYPUS
	PRINTR " fashion."
?L1:	EQUAL? PRSA,V?BOW,V?LISTEN \FALSE
	PRINTI "Graciously, "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTR " acknowledges your respectful attention."

	.FUNCT CROWD-F,CONTEXT=0
	CALL PRINCESS-SPECIFIC? >STACK
	ZERO? STACK \TRUE
	CALL TALKING-TO?,PRSO >STACK
	ZERO? STACK /?L3
	PRINTD KING
	PRINTI " interrupts you gently. ""There's little time for chit-chat."""
	CRLF
	RETURN 2
?L3:	CALL HURT?,PRSO >STACK
	ZERO? STACK \?L9
	EQUAL? PRSA,V?KISS,V?YELL \?L8
?L9:	CALL PRINT-ID,STR?317
	CALL NOT-LIKELY,KING,STR?318
	RTRUE
?L8:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,PRINCESS,KING,CROWD \FALSE
	PRINTI "With reluctant dignity, "
	CALL ARTICLE,PRSI,1
	PRINTD PRSI
	PRINTR " refuses your offer."

	.FUNCT CASTLE-F
	CALL ENTER-FROM?,ISLAND,THRONE-ROOM,CASTLE >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L3
	EQUAL? HERE,THRONE-ROOM \?L4
	CALL V-LOOK
	RTRUE
?L4:	CALL GO-INSIDE
	RTRUE
?L3:	CALL YOU-DONT-NEED,CASTLE
	RETURN 2

	.FUNCT CASTLE-JUNK-F
	CALL SEE-VERB? >STACK
	ZERO? STACK /?L1
	PRINT YOU-SEE
	PRINTI "nothing "
	CALL PICK-ONE,YAWNS >STACK
	PRINT STACK
	PRINTR " about it."
?L1:	CALL YOU-DONT-NEED,STR?319,1
	RETURN 2

	.FUNCT IN-MAILBOX,CONTEXT
	EQUAL? CONTEXT,M-CONT \FALSE
	CALL TOUCHING?,PRSO >STACK
	ZERO? STACK /FALSE
	PRINT CANT
	PRINTI " reach into the "
	PRINTD MAILBOX
	PRINTI "."
	CRLF
	RETURN 2

	.FUNCT DESCRIBE-MAILBOX,CONTEXT
	EQUAL? CONTEXT,M-OBJDESC \FALSE
	PRINTI "A big"
	ZERO? BOX-DANGEROUS? /?L5
	PRINTI ", hungry"
?L5:	PRINTI " mailbox is "
	ZERO? BOX-DANGEROUS? /?L12
	PRINTI "threatening you "
?L12:	PRINTI "nearby."
	RTRUE

	.FUNCT BY-ITSELF
	CALL SAY-THE,MAILBOX
	PRINTR " is opening and closing all by itself!"

	.FUNCT MAILBOX-F
	CALL THIS-IS-IT,MAILBOX
	EQUAL? PRSA,V?EXAMINE \?L1
	ZERO? BOX-DANGEROUS? /?L3
	CALL BY-ITSELF
	RTRUE
?L3:	CALL SAY-THE,MAILBOX
	PRINTI " seems ordinary enough."
	ZERO? SKEWED? /?L8
	PRINTI " Or does it?"
?L8:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?OPEN \?L13
	ZERO? BOX-DANGEROUS? /?L14
	CALL BY-ITSELF
	RTRUE
?L14:	FSET? MAILBOX,OPENBIT \?L16
	CALL ALREADY-OPEN
	RTRUE
?L16:	ZERO? SKEWED? /?L17
	PRINTI "It immediately snaps shut. Bang!"
	CRLF
	RETURN 2
?L17:	CALL QUEUE,I-BOX-LID,2 >STACK
	PUT STACK,0,1
	CALL NOW-CLOSED-OR-OPEN,MAILBOX,1
	RTRUE
?L13:	EQUAL? PRSA,V?CLOSE \?L23
	ZERO? BOX-DANGEROUS? /?L24
	CALL BY-ITSELF
	RTRUE
?L24:	FSET? MAILBOX,OPENBIT /?L26
	CALL ALREADY-CLOSED
	RTRUE
?L26:	CALL INT,I-BOX-LID >STACK
	PUT STACK,0,0
	CALL NOW-CLOSED-OR-OPEN,MAILBOX
	RTRUE
?L23:	CALL HURT?,MAILBOX >STACK
	ZERO? STACK /?L28
	CALL PRINT-ID,STR?320
	ZERO? BOX-DANGEROUS? /?L29
	CALL BOX-MOOD
	RTRUE
?L29:	PRINTI "You shouldn't"
	CALL DO-TO
	PRINTR "government property."
?L28:	EQUAL? PRSA,V?REACH-IN,V?LOOK-DOWN,V?LOOK-INSIDE \?L36
	ZERO? BOX-DANGEROUS? /?L36
	CALL BOX-MOOD
	RTRUE
?L36:	EQUAL? PRSA,V?FEED,V?PUT,V?GIVE /?L38
	EQUAL? PRSA,V?THROW \FALSE
?L38:	EQUAL? PRSI,MAILBOX \FALSE
	EQUAL? PRSO,LEAFLET \?L39
	CALL ENABLED?,I-WAKE-BOX >STACK
	ZERO? STACK /?L41
	CALL INT,I-WAKE-BOX >STACK
	PUT STACK,0,0
	JUMP ?L43
?L41:	CALL INT,I-BAD-BOX >STACK
	PUT STACK,0,0
?L43:	MOVE LEAFLET,MAILBOX
	PRINTI "Done."
	CRLF
	ZERO? BOX-DANGEROUS? /TRUE
	SET 'BOX-DANGEROUS?,0
	MOVE MAILBOX,STEEP-TRAIL
	CRLF
	CALL SAY-THE,MAILBOX
	PRINTI " gobbles the "
	PRINTD LEAFLET
	PRINTR " down, smacks its lid and belches. ""Mmmm! Good!""

The satisfied box scrapes slowly out of sight."
?L39:	ZERO? BOX-DANGEROUS? /FALSE
	EQUAL? PRSO,VIOLET-NOTE \?L52
	CALL BOX-SPITS,STR?321
	RTRUE
?L52:	CALL BOX-SPITS,STR?322
	RTRUE

	.FUNCT BOX-MOOD
	PRINTI "Better not. "
	CALL SAY-THE,MAILBOX
	PRINTR " isn't in a very good mood."

	.FUNCT BOX-SPITS,STR
	MOVE PRSO,HERE
	CALL SAY-THE,MAILBOX
	PRINTI " spits out "
	CALL ARTICLE,PRSO,1
	PRINTD PRSO
	PRINTI " on the "
	PRINTD GROUND
	PRINTI ". ""Not "
	PRINT STR
	PRINTR "!"""

	.FUNCT I-BOX-LID
	IN? MAILBOX,HERE \?L1
	CRLF
	PRINTI "The "
	CALL BIG-LID
	PRINTI "squeaks and"
	CALL BANGS
?L1:	FCLEAR MAILBOX,OPENBIT
	RTRUE

	.FUNCT BIG-LID
	PRINTI "lid of the "
	PRINTD MAILBOX
	PRINTI " "
	RTRUE

	.FUNCT BANGS
	PRINTR " snaps shut with a clang."

	.FUNCT HUNGRY
	PRINTI """"
	CALL PICK-ONE,BOX-YELLS >STACK
	PRINT STACK
	PRINTI "!"""
	RTRUE

	.FUNCT I-WAKE-BOX
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,PLEASURE-WHARF \FALSE
	INC 'BOX-SCRIPT
	CALL THIS-IS-IT,MAILBOX
	CRLF
	EQUAL? BOX-SCRIPT,1 \?L5
	PRINTI "A voice behind you growls, "
	CALL HUNGRY
	PRINTR " You turn to face the sound, but there's nobody here except you."
?L5:	EQUAL? BOX-SCRIPT,2 \?L11
	PRINTI "You watch with astonishment as the "
	CALL BIG-LID
	PRINTI "slowly opens by itself, then"
	CALL BANGS >STACK
	RSTACK
?L11:	EQUAL? BOX-SCRIPT,3 \?L16
	SET 'BOX-DANGEROUS?,1
	PRINTI "The "
	CALL BIG-LID
	PRINTI "opens again. "
	CALL HUNGRY
	CRLF
	RTRUE
?L16:	EQUAL? BOX-SCRIPT,4 \FALSE
	CALL INT,I-WAKE-BOX >STACK
	PUT STACK,0,0
	CALL QUEUE,I-BAD-BOX,-1 >STACK
	PUT STACK,0,1
	CALL SAY-THE,MAILBOX
	PRINTI " begins to clatter like a rusty machine. Your astonishment turns to horror as the mindless thing begins to MOVE! Slowly at first, but with increasing confidence, it scrapes across the planks of the "
	PRINTD PLEASURE-WHARF
	PRINTI ", heading straight in your direction!"
	CRLF
	CRLF
	PRINTI "The "
	CALL BIG-LID
	PRINTI "snaps open with a menacing clang. "
	CALL HUNGRY
	CRLF
	RTRUE

	.FUNCT NO-MAILBOX-ALLOWED?
	EQUAL? HERE,WHARF,PLEASURE-WHARF,FESTERON-POINT /FALSE
	EQUAL? HERE,ROTARY-NORTH,ROTARY-SOUTH,ROTARY-EAST /FALSE
	EQUAL? HERE,ROTARY-WEST,EDGE-OF-LAKE,RIVER-OUTLET /FALSE
	EQUAL? HERE,PARK,LOOKOUT-HILL,SOUTH-OF-BRIDGE /FALSE
	EQUAL? HERE,WEST-OF-HOUSE,ROCKY-PATH \TRUE
	RFALSE

	.FUNCT I-BAD-BOX,TEMP
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	IN? MAILBOX,HERE \?L4
	SET 'BOX-COMING,0
	INC 'EAT-SCRIPT
	CALL FIGHT?,SMALL-BOX >STACK
	ZERO? STACK \TRUE
	EQUAL? EAT-SCRIPT,1 \?L7
	CALL SAY-BOX-CLOSER,BOX-CLOSERS >STACK
	RSTACK
?L7:	EQUAL? EAT-SCRIPT,2 \?L8
	CALL SAY-BOX-CLOSER,BOX-EVEN-CLOSERS >STACK
	RSTACK
?L8:	SET 'EAT-SCRIPT,0
	FIRST? PROTAGONIST >TEMP \?L11
	FCLEAR TEMP,WORNBIT
	MOVE TEMP,FOSSIL
	CRLF
	CALL SAY-THE,MAILBOX
	PRINTI " "
	CALL PICK-ONE,SWIPES >STACK
	PRINT STACK
	PRINTI " "
	CALL ARTICLE,TEMP,1
	PRINTD TEMP
	PRINTI " away from you and swallows it! "
	CALL PRINT-ID,STR?323
	RANDOM 100 >STACK
	LESS? 50,STACK /?L17
	CALL HUNGRY
?L17:	CRLF
	EQUAL? TEMP,WISHBRINGER,SHOE \FALSE
	CALL I-LUCK
	CALL I-GLOW >STACK
	RSTACK
?L11:	CALL HUNGRY
	CRLF
	CRLF
	PRINTI "With a triumphant roar, the "
	PRINTD MAILBOX
	PRINTI " trips your feet and sends you sprawling to the "
	PRINTD GROUND
	PRINTI ". Its snapping lid closes in, and you are Sent."
	CALL PRINT-ID,STR?324
	CALL BAD-ENDING >STACK
	RSTACK
?L4:	SET 'EAT-SCRIPT,0
	EQUAL? HERE,WEST-OF-HOUSE /TRUE
	CALL NO-MAILBOX-ALLOWED? >STACK
	ZERO? STACK \TRUE
	EQUAL? HERE,PREVIOUS-LOC /?L31
	SET 'PREVIOUS-LOC,HERE
	SET 'BOX-COMING,0
?L31:	INC 'BOX-COMING
	EQUAL? BOX-COMING,2 \?L34
	CRLF
	CALL PICK-ONE,BAD-BOX-COMINGS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L34:	MOVE MAILBOX,HERE
	CALL SAY-BOX-CLOSER,BAD-BOX-ARRIVALS,1
	CALL FIGHT?,SMALL-BOX >STACK
	RSTACK

	.FUNCT SAY-BOX-CLOSER,LIST,HUNGRY?=0
	CRLF
	CALL SAY-THE,MAILBOX
	CALL PICK-ONE,LIST >STACK
	PRINT STACK
	PRINTI "."
	ZERO? HUNGRY? \?L5
	RANDOM 100 >STACK
	LESS? 50,STACK /?L3
?L5:	PRINTI " "
	CALL HUNGRY
?L3:	CRLF
	RTRUE

	.FUNCT SMALL-BOX-F
	CALL THIS-IS-IT,SMALL-BOX
	EQUAL? HERE,INSIDE-POST-OFFICE \?L1
	CALL PRIVATE-BOXES? >STACK
	ZERO? STACK /FALSE
	RTRUE
?L1:	EQUAL? PRSA,V?OPEN \?L6
	ZERO? HOUSE-VISITED? \?L6
	SET 'HOUSE-VISITED?,1
	CALL QUEUE,I-WAKE-SMALL-BOX,-1 >STACK
	PUT STACK,0,1
	RFALSE
?L6:	EQUAL? PRSA,V?EXAMINE \?L7
	ZERO? BOX-ALIVE? \?L10
	CALL ENABLED?,I-WAKE-SMALL-BOX >STACK
	ZERO? STACK /FALSE
?L10:	PRINTI "It's the strangest "
	PRINTD SMALL-BOX
	PRINTR " you've ever seen."
?L7:	EQUAL? PRSA,V?RUB \?L14
	ZERO? BOX-ALIVE? /?L14
	CALL SAY-THE,SMALL-BOX
	CALL COOS-AT,STR?325
	RTRUE
?L14:	CALL TALKING-TO?,SMALL-BOX >STACK
	ZERO? STACK /FALSE
	ZERO? BOX-ALIVE? /FALSE
	CALL SAY-THE,SMALL-BOX
	PRINTI " doesn't reply, but"
	CALL COOS-AT,STR?326
	RETURN 2

	.FUNCT COOS-AT,STR
	PRINTI " coos with pleasure at "
	PRINT STR
	PRINTR "."

	.FUNCT I-WAKE-SMALL-BOX
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	EQUAL? HERE,WEST-OF-HOUSE \FALSE
	INC 'SMALL-SCRIPT
	CRLF
	EQUAL? SMALL-SCRIPT,1 \?L5
	PRINTI "The edges of the "
	PRINTD SMALL-BOX
	PRINTR " are beginning to twinkle."
?L5:	EQUAL? SMALL-SCRIPT,2 \?L9
	CALL SAY-THE,SMALL-BOX
	PRINTR " is engulfed in a sparkling aurora! Tremors of anticipation run up and down its length, and the air sings with Magick."
?L9:	EQUAL? SMALL-SCRIPT,3 \?L12
	CALL PRINT-ID,STR?327
	SET 'BOX-ALIVE?,1
	PRINTI "With a gentle pop, the "
	PRINTD SMALL-BOX
	PRINTI " pulls itself out of the "
	PRINTD GROUND
	PRINTR " and cavorts about the grass like a happy rabbit!"
?L12:	CALL INT,I-WAKE-SMALL-BOX >STACK
	PUT STACK,0,0
	CALL QUEUE,I-FRIENDLY-BOX,-1 >STACK
	PUT STACK,0,1
	CALL SAY-THE,SMALL-BOX
	PRINTI " notices you and snaps its tiny lid with joy. It makes a silly"
	CALL CLUMP
	PRINTI "as it"
	CALL HOPS-TO-SIDE
	CRLF
	RTRUE

	.FUNCT CLUMP
	PRINTI " ""clump-clump, clump-clump"" sound "
	RTRUE

	.FUNCT HOPS-TO-SIDE
	PRINTI " hops to your side and rubs lovingly against your sleeve."
	RTRUE

	.FUNCT I-FRIENDLY-BOX,TEMP
	ZERO? FUZZY? \TRUE
	ZERO? ECLIPSE? \TRUE
	IN? SMALL-BOX,HERE \?L4
	SET 'SMALL-BOX-COMING,0
	CALL FIGHT?,MAILBOX >STACK
	ZERO? STACK \TRUE
	RANDOM 100 >STACK
	LESS? 50,STACK /FALSE
	CRLF
	CALL SAY-THE,SMALL-BOX
	PRINTI " "
	CALL PICK-ONE,CUDDLES >STACK
	PRINT STACK
	PRINTR "."
?L4:	CALL NO-MAILBOX-ALLOWED? >STACK
	ZERO? STACK \TRUE
	EQUAL? HERE,PREVIOUS-SMALL-LOC /?L15
	SET 'PREVIOUS-SMALL-LOC,HERE
	SET 'SMALL-BOX-COMING,0
?L15:	INC 'SMALL-BOX-COMING
	EQUAL? SMALL-BOX-COMING,1 /TRUE
	EQUAL? SMALL-BOX-COMING,2 \FALSE
	MOVE SMALL-BOX,HERE
	CRLF
	CALL SAY-THE,SMALL-BOX
	PRINTI " ""clump-clumps"" "
	CALL PICK-ONE,SMALL-BOX-ARRIVALS >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	CALL FIGHT?,MAILBOX >STACK
	RSTACK

	.FUNCT FIGHT?,ENEMY
	IN? ENEMY,HERE \FALSE
	GRTR? BOX-SCRIPT,2 \FALSE
	REMOVE SMALL-BOX
	REMOVE MAILBOX
	REMOVE EXHIBITS
	MOVE FOSSIL,MUSEUM
	CALL MOVE-ALL,SMALL-BOX,FOSSIL
	CALL INT,I-FRIENDLY-BOX >STACK
	PUT STACK,0,0
	CALL ENABLED?,I-WAKE-BOX >STACK
	ZERO? STACK /?L3
	CALL INT,I-WAKE-BOX >STACK
	PUT STACK,0,0
?L3:	CALL ENABLED?,I-BAD-BOX >STACK
	ZERO? STACK /?L6
	CALL INT,I-BAD-BOX >STACK
	PUT STACK,0,0
?L6:	SET 'BOX-ALIVE?,0
	CRLF
	PRINTI "The two mailboxes freeze at the sight of one another.

The "
	PRINTD SMALL-BOX
	PRINTI " snarls and stands protectively by your side. The "
	PRINTD MAILBOX
	PRINTI " emits a frightful growl and throws its lid wide open, displaying rows of "
	CALL SHARP-TEETH
	PRINTI ". A crowd of postal meters and stamp dispensers gathers as the metal warriors circle each other with tense, snapping lids.

With a sudden rush, the "
	PRINTD SMALL-BOX
	PRINTI " throws itself at the "
	PRINTD MAILBOX
	PRINTI " and clamps onto its forefoot. The "
	PRINTD MAILBOX
	PRINTI " roars with anger, bites the "
	PRINTD SMALL-BOX
	PRINTI " viciously and tries in vain to shake it off. You stare in wonder as the fighting boxes swell to twice their normal size, then four times larger, eight times!

The "
	PRINTD MAILBOX
	PRINTI " frees itself with a savage twist and bends to finish its foe. The "
	PRINTD SMALL-BOX
	PRINTR " dodges, grips the descending lid and holds on for dear life. Locked in mortal combat, the giant boxes roll over and over, shaking the earth with the thunder of battle.

The scene disappears under a cloud of dust. You hear a terrible scream of agony, then an even more terrible silence. When the air clears, the boxes and spectators are gone."

	.FUNCT DEPOSIT-BRANCH
	IN? BRANCH,PROTAGONIST \?L1
	MOVE BRANCH,HERE
	RTRUE
?L1:	IN? BROOM,PROTAGONIST \FALSE
	SET 'BROOM-SIT?,0
	MOVE BROOM,HERE
	RTRUE

	.FUNCT TRAMP
	PRINTI " tramp of marching "
	PRINTD BOOTS
	PRINTI " "
	RTRUE

	.FUNCT COMING-THIS-WAY
	PRINTI " It sounds as if they're coming this way!"
	RTRUE

	.FUNCT TO-JAIL
	SET 'ON-STUMP?,0
	ZERO? JAIL-VISITS \?L1
	SET 'JAIL-SCRIPT,24
	CALL INT,I-BREAK-IN >STACK
	PUT STACK,0,0
	CALL QUEUE,I-JAIL,-1 >STACK
	PUT STACK,0,1
	JUMP ?L3
?L1:	SET 'JAIL-SCRIPT,16
?L3:	INC 'JAIL-VISITS
	MOVE PROTAGONIST,JAIL-CELL
	SET 'HERE,JAIL-CELL
	CALL MOVE-ALL,PROTAGONIST,JAIL-CELL
	GRTR? JAIL-VISITS,1 \?L4
	FCLEAR BUNK,RMUNGBIT
	FCLEAR UNDER-CELL,ONBIT
	FCLEAR UNDER-CELL,TOUCHBIT
?L4:	CRLF
	CRLF
	CALL V-LOOK
	CALL I-LUCK
	CALL I-GLOW >STACK
	RSTACK

	.FUNCT EVIL-VOICES
	PRINTI "evil voices down the "
	PRINTD CORRIDOR
	RTRUE

	.FUNCT HEAR-WAILS
	PRINT YOU-HEAR
	CALL PICK-ONE,JAIL-SOUNDS >STACK
	PRINT STACK
	PRINTI " from "
	RANDOM 100 >STACK
	LESS? 50,STACK /?L3
	PRINTI "an adjacent cell"
	JUMP ?L7
?L3:	PRINTI "the "
	PRINTD CORRIDOR
	PRINTI " outside"
?L7:	PRINTR "."

	.FUNCT SHARK-SNACK
	PRINTI " with this jailbreaker any more tonight, do we?"" The surrounding "
	PRINTD BOOTS
	PRINTI " grunt in sympathy. ""No, of course not. Let's "
	EQUAL? HERE,WHARF,PLEASURE-WHARF /?L3
	PRINTI "pay a visit to the "
	PRINTD PLEASURE-WHARF
	PRINTI ", and "
?L3:	PRINTI "give the "
	PRINTD SHARKS
	PRINTI " a little bedtime snack!"""
	RTRUE

	.FUNCT THROWN-OVER-SHOULDER
	CRLF
	CRLF
	PRINTI "You're thrown into an especially smelly Boot and carried, kicking and screaming, to "
	RTRUE

	.FUNCT INTO-BAY
	PRINTI "the edge of the "
	PRINTD PLEASURE-WHARF
	PRINTI ". With a mighty swing, you're thrown high into the air and fall with a splash into the churning waters of"
	CALL WHICH-TOWN,STR?200
	PRINTI ".

The "
	PRINTD BOOTS
	PRINTI " on the wharf stomp and hoot as a black fin rises above the waves. It circles slowly, getting closer. You shut your eyes and pray that the end will be quick and not too painful..."
	ZERO? HORSE-SAVED? /?L5
	CALL SAVED-BY-HORSES >STACK
	RSTACK
?L5:	CALL PRINT-ID,STR?328
	CALL BAD-ENDING >STACK
	RSTACK

	.FUNCT SAVED-BY-HORSES
	REMOVE BOOTS
	CALL INT,I-JAIL >STACK
	PUT STACK,0,0
	CALL INT,I-BOOT-PATROL >STACK
	PUT STACK,0,0
	CRLF
	CRLF
	PRINTI """Hop on!""

The tiny voice is somewhere near your left ear. ""Don't just thrash about with your eyes shut. Hop on!""

The "
	PRINTD BOOTS
	PRINTI " on the "
	PRINTD PLEASURE-WHARF
	PRINTI " have stopped hooting and started screaming. Timidly, you open one eye.

The bay is boiling with thousands of "
	PRINTD HORSE
	PRINTI "s! They leap from the waves like wet little rockets, splashing the "
	PRINTD PLEASURE-WHARF
	PRINTI " with black, oily water. Many of the "
	PRINTD BOOTS
	PRINTI " have already slipped and fallen into the sea; and a black fin is gliding confidently in their direction.

""What are you waiting for? Halloween?""

The familiar "
	PRINTD HORSE
	PRINTI " at your ear urges you to a nearby buoy. You grasp it with your last ounce of strength and feel yourself speeding across the bay, propelled by dozens of "
	PRINTD HORSE
	PRINTI "s reined to the buoy with seaweed.

""I don't mind returning a favor,"" remarks the "
	PRINTD HORSE
	PRINTI " as your brain sinks into oblivion, ""but can't you pick a better night to go swimming?"""
	CALL PRINT-ID,STR?329
	FCLEAR POLICE-DOOR,OPENBIT
	FSET POLICE-DOOR,LOCKEDBIT
	MOVE PROTAGONIST,FESTERON-POINT
	SET 'HERE,FESTERON-POINT
	CALL MOVE-ALL,PROTAGONIST,FESTERON-POINT
	CALL COME-TO-SENSES >STACK
	RSTACK

	.FUNCT JAIL-AGAIN
	FSET HIDDEN-HATCH,RMUNGBIT
	REMOVE PSEUDO-BUNK
	FCLEAR HIDDEN-HATCH,TOUCHBIT
	PRINTI """Well, well. If it isn't the disappearing mail clerk."" You open your mouth to reply, but a vicious little kick changes your mind. ""The Tower wants a chat with this troublemaker.""

""The "
	PRINTD SHARKS
	PRINTI " are getting restless,"" remarks the Tall Boot hopefully."
	CRLF
	CRLF
	PRINTD MACGUFFIN
	PRINTI " smirks. ""So is"
	PRINT EONE
	PRINTI "."""
	RTRUE

	.FUNCT WISHBRINGER-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL SAY-THE,WISHBRINGER
	FSET? WISHBRINGER,ONBIT \?L3
	PRINTI " glows"
	CALL SAY-GLOW
	RTRUE
?L3:	PRINTR " is dark and cold."

	.FUNCT SAY-GLOW
	PRINTR " with an eerie violet-white radiance."

	.FUNCT NOT-SATISFIED,CONDITIONS?=0
	CALL REFER-TO-MANUAL
	PRINTI " for a summary of what you must "
	ZERO? CONDITIONS? /?L3
	PRINTI "do "
	JUMP ?L7
?L3:	PRINTI "be holding "
?L7:	PRINTR "to make that Wish come true.)"

	.FUNCT BEFORE-YOU-WISH,STR,OBJ
	CALL THIS-IS-IT,OBJ
	PRINTI "(You probably ought to "
	PRINT STR
	PRINTI " the "
	PRINTD OBJ
	PRINTR " before you make that Wish!)"

	.FUNCT STONE-IGNORES,STR
	PRINTI "The Stone, sensing that "
	PRINT STR
	PRINTR ", decides to ignore your Wish."

	.FUNCT NOT-WISHING?,OBJ
	EQUAL? PRSA,V?WISH \FALSE
	PRINTI "How can you do that "
	EQUAL? OBJ,PRSO \?L5
	PRINTI "to"
	JUMP ?L9
?L5:	PRINTI "with"
?L9:	PRINTI " an abstract concept like """
	PRINTD OBJ
	PRINTR """?"

	.FUNCT FLIGHT-F
	CALL NOT-WISHING?,FLIGHT >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	IN? BROOM,PROTAGONIST /?L5
	CALL NOT-SATISFIED
	RETURN 2
?L5:	ZERO? BROOM-SIT? \?L8
	CALL BEFORE-YOU-WISH,STR?330,BROOM
	RETURN 2
?L8:	FSET? HERE,INDOORSBIT \?L11
	EQUAL? HERE,LABORATORY /?L11
	CALL STONE-IGNORES,STR?331
	RETURN 2
?L11:	FSET FLIGHT,TOUCHBIT
	FSET VULTURE,RMUNGBIT
	INC 'SPELLS
	PRINTI "The Stone begins to pulse with violet Magick. Translucent planes of energy coax the broomstick "
	EQUAL? HERE,LABORATORY \?L17
	PRINTI "out the window and "
?L17:	PRINTI "high into the moonlit sky.

You feel a cool wind whip your face as you streak northward, guided by the steady glow of "
	PRINT GAME
	PRINTI "."
	CALL TO-FINISH
	MOVE BROOM,CLIFF-EDGE
	SET 'BROOM-SIT?,0
	CALL CLATTERS,BROOM
	CRLF
	CALL V-LOOK
	RTRUE

	.FUNCT FREEDOM-F,RM
	CALL NOT-WISHING?,FREEDOM >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	CALL HELD?,CHOCOLATE >STACK
	ZERO? STACK /?L5
	CALL BEFORE-YOU-WISH,STR?332,CHOCOLATE
	RETURN 2
?L5:	ZERO? CHOCOLATE-SCRIPT \?L8
	CALL NOT-SATISFIED,1
	RETURN 2
?L8:	ZERO? CHAINED? /?L11
	EQUAL? HERE,TORTURE-CHAMBER \?L11
	SET 'CHOCOLATE-SCRIPT,1
	FSET FREEDOM,TOUCHBIT
	INC 'SPELLS
	IN? CRISP,TORTURE-CHAMBER \?L12
	FSET WISHBRINGER,NDESCBIT
	MOVE WISHBRINGER,COAT
	PRINTD CRISP
	PRINTI " watches with surprise as a"
	CALL FINGER-OF-LIGHT
	CRLF
	PRINTI """Good trick,"" "
	PRINTD CRISP
	PRINTI " remarks as he relocks your chains, snatches "
	PRINT GAME
	PRINTI " away from you and drops it into his coat pocket. ""You'll have to tell "
	PRINT EONE
	PRINTI " how you did it."""
	CRLF
	RETURN 2
?L12:	CALL OPEN-TORTURE-CHAINS
	PRINTI "A"
	CALL FINGER-OF-LIGHT
	RETURN 2
?L11:	EQUAL? HERE,JAIL-CELL \?L25
	FSET? HIDDEN-HATCH,RMUNGBIT \?L25
	SET 'RM,LOOKOUT-HILL
	LOC BOOTS >STACK
	EQUAL? STACK,LOOKOUT-HILL,RIVER-OUTLET \?L26
	SET 'RM,ROTARY-WEST
?L26:	CALL FREE-TO,RM
	RETURN 2
?L25:	SET 'CHOCOLATE-SCRIPT,2
	CALL STONE-IGNORES,STR?333
	RETURN 2

	.FUNCT FINGER-OF-LIGHT
	PRINTI " wraithlike finger of light jumps out of the Magick Stone! It twists itself into the shape of a "
	PRINTD KEY
	PRINTR ", unlocks your chains and fades away."

	.FUNCT FREE-TO,PLACE
	FSET FREEDOM,TOUCHBIT
	FSET VULTURE,RMUNGBIT
	INC 'SPELLS
	SET 'CHOCOLATE-SCRIPT,1
	MOVE PROTAGONIST,PLACE
	SET 'HERE,PLACE
	FCLEAR PLACE,TOUCHBIT
	PRINTI "The Magick Stone shines brightly as you speak the Wish. You feel a momentary dizziness, then a breath of fresh air..."
	CALL CARRIAGE-RETURNS
	CALL V-LOOK
	RTRUE

	.FUNCT RAIN-F,OBJ,NXT
	EQUAL? PRSA,V?WISH \?L1
	IN? UMBRELLA,PROTAGONIST /?L3
	CALL NOT-SATISFIED
	RETURN 2
?L3:	FSET? UMBRELLA,OPENBIT /?L7
	CALL BEFORE-YOU-WISH,STR?92,UMBRELLA
	RETURN 2
?L7:	FSET? HERE,INDOORSBIT \?L10
	CALL STONE-IGNORES,STR?331
	RETURN 2
?L10:	FSET RAIN,TOUCHBIT
	FSET VULTURE,RMUNGBIT
	INC 'SPELLS
	SET 'RAIN-ROOM,HERE
	PRINTI "A searing bolt of lightning shatters the night! It strikes the glowing Stone of Dreams, and fractures the sky into a billion raindrops.

Everything around you is soaked in a brief but savage downpour."
	EQUAL? HERE,FOG \?L16
	SET 'HERE,CLIFF-BOTTOM
	MOVE PROTAGONIST,CLIFF-BOTTOM
	SET 'TLOC,0
	CALL START-BUZZ,2
	PRINTI " Your vision clears as the thick fog sinks away.

"
	CALL V-LOOK
	RTRUE
?L16:	EQUAL? HERE,EDGE-OF-LAKE \?L20
	SET 'PIT-FULL?,1
	PRINTI " A flood of rainwater cascades down Lookout Hill, quickly filling the narrow pit."
	CRLF
	IN? PLATYPUS,PIT \?L23
	CALL THIS-IS-IT,PLATYPUS
	CRLF
	PRINTI "The platypus swims gracefully out and shakes herself off.

"
	CALL DRAW-X
?L23:	FIRST? PIT >OBJ \TRUE
?L30:	ZERO? OBJ /TRUE
	NEXT? OBJ >NXT /?L35
?L35:	EQUAL? OBJ,BRANCH /?L36
	REMOVE OBJ
?L36:	SET 'OBJ,NXT
	JUMP ?L30
?L20:	CRLF
	CALL REACTOR? >OBJ
	ZERO? OBJ /TRUE
	CRLF
	PRINTI "It's obvious that "
	CALL ARTICLE,OBJ,1
	PRINTR " did not enjoy the sudden bath."
?L1:	FSET? RAIN,TOUCHBIT \?L49
	EQUAL? HERE,RAIN-ROOM /?L48
?L49:	PRINTI "No rain is expected"
	FSET? HERE,INDOORSBIT \?L52
	PRINTI ", especially indoors."
	CRLF
	RETURN 2
?L52:	PRINTI " here."
	CRLF
	RETURN 2
?L48:	ZERO? PIT-FULL? /?L63
	EQUAL? HERE,EDGE-OF-LAKE \?L63
	PRINTI "The only rain here is in the pit."
	CRLF
	RETURN 2
?L63:	PRINTI "Alas. The rain is all gone."
	CRLF
	RETURN 2

	.FUNCT FORESIGHT-F,FROM
	CALL NOT-WISHING?,FORESIGHT >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	IN? GLASSES,PROTAGONIST /?L5
	CALL NOT-SATISFIED
	RETURN 2
?L5:	FSET? GLASSES,WORNBIT /?L8
	CALL BEFORE-YOU-WISH,STR?334,GLASSES
	RETURN 2
?L8:	FSET FORESIGHT,TOUCHBIT
	FSET VULTURE,RMUNGBIT
	INC 'SPELLS
	PRINTI "The "
	ZERO? FUZZY? /?L14
	CALL PICK-ONE,BLURS >STACK
	PRINT STACK
	PRINTI " "
?L14:	FSET? HERE,INDOORSBIT \?L19
	PRINTI "room around you"
	JUMP ?L23
?L19:	PRINTI "moonlight"
?L23:	PRINTI " fades as you speak the Wish."
	SET 'FROM,HERE
	SET 'HERE,MUSEUM
	CALL CARRIAGE-RETURNS
	USL
	PRINTI "A pinprick of brilliance pierces the gloom. It creeps closer, growing more powerful and unearthly as it approaches.

The light is shining from the forehead of a "
	PRINTD KITTY
	PRINTI "! It leaps into your arms and curls comfortably around your neck, purring like an old companion.

Suddenly a pair of gnarled hands closes around the "
	PRINTD KITTY
	PRINTI " and tears it away from you. The glowing spot on the cat's forehead drops into your open palm as the thief disappears with a cackle into the "
	PRINTD DARKNESS
	PRINTI ".

An aged voice in your mind chuckles, "
	CALL LIAR
	PRINTI "."""
	CALL CARRIAGE-RETURNS
	SET 'HERE,FROM
	ZERO? FUZZY \?L34
	CALL ANYONE-HERE? >FROM
	EQUAL? FROM,0,KITTY,BABY /?L34
	FSET? FROM,NARTICLEBIT \?L36
	PRINTI "The "
?L36:	CALL STRANGE-LOOK,FROM
	CRLF
?L34:	RETURN 2

	.FUNCT LIAR
	PRINTI """Now you know me for the old liar I am"
	RTRUE

	.FUNCT STRANGE-LOOK,WHO
	PRINTD WHO
	PRINTR " gives you a strange look."

	.FUNCT LUCK-F
	CALL NOT-WISHING?,LUCK >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	IN? SHOE,PROTAGONIST /?L5
	CALL NOT-SATISFIED
	RETURN 2
?L5:	FSET LUCK,TOUCHBIT
	FSET VULTURE,RMUNGBIT
	INC 'SPELLS
	SET 'LUCKY?,1
	FSET SHOE,ONBIT
	CALL QUEUE,I-LUCK,-1 >STACK
	PUT STACK,0,1
	CALL THIS-IS-IT,SHOE
	PRINTI "The Stone of Dreams brightens as you speak the Wish, and the edges of the "
	PRINTD SHOE
	PRINTI " begin to twinkle with Luck."
	CRLF
	EQUAL? HERE,FOG \?L11
	SET 'TLOC,0
	SET 'HERE,CLIFF-BOTTOM
	MOVE PROTAGONIST,CLIFF-BOTTOM
	CALL WALK-OUT-OF-FOG
	CALL V-LOOK
?L11:	RETURN 2

	.FUNCT BAD-LUCK,STR
	CRLF
	PRINTI "(It's bad luck to "
	PRINT STR
	PRINTI "."
	CALL ENABLED?,I-LUCK >STACK
	ZERO? STACK /?L3
	CALL INT,I-LUCK >STACK
	PUT STACK,0,0
	PRINTI " You've neutralized the Luck Wish!)"
	CRLF
	CALL I-LUCK,1
	RTRUE
?L3:	PRINTR ")"

	.FUNCT ADVICE-F
	CALL NOT-WISHING?,ADVICE >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	IN? CONCH-SHELL,PROTAGONIST /?L5
	CALL NOT-SATISFIED
	RETURN 2
?L5:	FSET ADVICE,TOUCHBIT
	FSET VULTURE,RMUNGBIT
	INC 'SPELLS
	CALL QUEUE,I-SHELL-TALK,-1 >STACK
	PUT STACK,0,1
	PRINT GAME
	PRINTI " emits a violet flash of Magick."
	CRLF
	RETURN 2

	.FUNCT DARKNESS-F,INDOORS?=0,WHO
	EQUAL? PRSA,V?WISH \?L1
	IN? BOTTLE,PROTAGONIST \?L3
	IN? MILK,BOTTLE \?L3
	CALL BEFORE-YOU-WISH,STR?335,MILK
	RETURN 2
?L3:	ZERO? MILK-SCRIPT \?L7
	CALL NOT-SATISFIED,1
	RETURN 2
?L7:	FSET? HERE,ONBIT /?L10
	CALL STONE-IGNORES,STR?336
	RETURN 2
?L10:	FSET DARKNESS,TOUCHBIT
	FSET VULTURE,RMUNGBIT
	INC 'SPELLS
	SET 'DARK-PLACE,HERE
	SET 'MILK-SCRIPT,1
	CALL QUEUE,I-ECLIPSE,2 >STACK
	PUT STACK,0,1
	FCLEAR WISHBRINGER,ONBIT
	FCLEAR SHOE,ONBIT
	SET 'ECLIPSE?,1
	SET 'MOVIE-STATUS,NO-MOVIE?
	SET 'NO-MOVIE?,1
	FSET? HERE,INDOORSBIT \?L14
	SET 'INDOORS?,1
?L14:	CALL REACTOR? >WHO
	PRINTI "The "
	ZERO? INDOORS? /?L19
	PRINTI "air"
	JUMP ?L23
?L19:	PRINTI "night"
?L23:	PRINTI " becomes very still as you speak the Wish. "
	EQUAL? WHO,HELLHOUND,PELICAN \?L28
	CALL SAY-THE,WHO
	EQUAL? WHO,HELLHOUND \?L38
	PRINTI " stops "
	ZERO? HELLHOUND-HAPPY? /?L34
	PRINTI "thumping its tail,"
	JUMP ?L38
?L34:	PRINTI "in mid-roar,"
?L38:	PRINTI " cocks its head and sniffs the air nervously."
	JUMP ?L51
?L28:	EQUAL? WHO,TROLL,GRAVEDIGGER \?L44
	CALL SAY-THE,WHO
	CALL FROWNS
	JUMP ?L51
?L44:	EQUAL? WHO,MACGUFFIN,CRISP,KING \?L45
	PRINTD WHO
	CALL FROWNS
	JUMP ?L51
?L45:	EQUAL? WHO,MISS-VOSS,PRINCESS,EVIL-ONE \?L48
	PRINTD WHO
	CALL FROWNS,1
	JUMP ?L51
?L48:	ZERO? WHO /?L51
	PRINTI "You notice "
	CALL ARTICLE,WHO,1
	PRINTI " looking"
	CALL NERVOUSLY
?L51:	PRINTI "

All at once a terrifying shadow sweeps across the "
	ZERO? INDOORS? /?L59
	PRINTI "surface of "
	PRINT GAME
	JUMP ?L63
?L59:	PRINTI "face of the full moon"
?L63:	FSET? CANDLE,ONBIT \?L68
	FCLEAR CANDLE,ONBIT
	CALL VISIBLE?,CANDLE >STACK
	ZERO? STACK /?L68
	PRINTI ". The candle flame withers and dies"
?L68:	PRINTI ", plunging the "
	ZERO? INDOORS? /?L76
	PRINTI "room"
	JUMP ?L80
?L76:	PRINTI "landscape"
?L80:	PRINTI " into total darkness."
	EQUAL? WHO,HELLHOUND \?L85
	CRLF
	CRLF
	CALL SAY-THE,HELLHOUND
	PRINTI "'s eyes grow wide with terror. It flops itself down on the ground, covers its eyes with its forepaws and moans pitifully"
	CALL IN-GLOOM
	JUMP ?L100
?L85:	EQUAL? WHO,TROLL \?L91
	CRLF
	CALL FRIGHTEN-TROLL
	JUMP ?L100
?L91:	EQUAL? WHO,GRAVEDIGGER \?L92
	PRINTI "

""Who turned out the lights?!"" cries the "
	PRINTD GRAVEDIGGER
	PRINTI ", stumbling around the pitch-black lobby in terror."
	CRLF
	JUMP ?L100
?L92:	ZERO? WHO /?L95
	CRLF
	CRLF
	PRINT YOU-HEAR
	CALL ARTICLE,WHO,1
	PRINTI "making fearful noises"
	CALL IN-GLOOM
	JUMP ?L100
?L95:	CRLF
?L100:	CALL LIT?,HERE >LIT
	RTRUE
?L1:	EQUAL? PRSO,DARKNESS \?L101
	CALL SEE-VERB? >STACK
	ZERO? STACK /?L101
	CALL YOU-CANT-SEE
	PRINTI "anything in darkness!"
	CRLF
	RETURN 2
?L101:	EQUAL? PRSA,V?LISTEN,V?YELL /?L107
	CALL TALKING-TO?,DARKNESS >STACK
	ZERO? STACK /?L106
?L107:	PRINTI "You hear nothing."
	CRLF
	RETURN 2
?L106:	CALL NOT-WISHING?,DARKNESS >STACK
	ZERO? STACK /FALSE
	RETURN 2

	.FUNCT IN-GLOOM
	PRINTR " in the sudden gloom."

	.FUNCT NERVOUSLY
	PRINTI " around nervously."
	RTRUE

	.FUNCT FROWNS,FEMALE?=0
	PRINTI " frowns, blinks "
	ZERO? FEMALE? /?L3
	PRINTI "her"
	JUMP ?L7
?L3:	PRINTI "his"
?L7:	PRINTI " eyes and looks"
	CALL NERVOUSLY
	RTRUE

	.FUNCT REACTOR?,WHO
	EQUAL? HERE,EDGE-OF-LAKE \?L1
	IN? PLATYPUS,PIT \?L1
	RETURN PLATYPUS
?L1:	EQUAL? HERE,THRONE-ROOM \?L3
	RETURN CROWD
?L3:	CALL ANYONE-HERE? >WHO
	EQUAL? WHO,0,BABY /FALSE
	EQUAL? WHO,KITTY \?L7
	FSET? KITTY,RMUNGBIT /FALSE
?L7:	RETURN WHO

	.FUNCT I-ECLIPSE,WHO
	ZERO? LUCKY? /?L1
	FSET SHOE,ONBIT
?L1:	CALL INT,I-ECLIPSE >STACK
	PUT STACK,0,0
	SET 'ECLIPSE?,0
	SET 'NO-MOVIE?,MOVIE-STATUS
	FSET VULTURE,RMUNGBIT
	FSET WISHBRINGER,ONBIT
	CRLF
	PRINTI "As suddenly as it faded, the light "
	FSET? HERE,INDOORSBIT \?L6
	CALL VISIBLE?,WISHBRINGER >STACK
	ZERO? STACK /?L8
	PRINTI "from "
	PRINT GAME
	JUMP ?L15
?L8:	PRINTI "around you"
	JUMP ?L15
?L6:	PRINTI "of the moon"
?L15:	PRINTI " returns"
	FSET? CANDLE,RMUNGBIT /?L22
	FSET? CANDLE,ONBIT /?L22
	FSET CANDLE,ONBIT
	CALL VISIBLE?,CANDLE >STACK
	ZERO? STACK /?L22
	PRINTI ", and the candle flares back to life"
?L22:	PRINTI "."
	CALL REACTOR? >WHO
	EQUAL? WHO,HELLHOUND \?L30
	SET 'DOG-SCRIPT,0
	CRLF
	CRLF
	CALL SAY-THE,HELLHOUND
	PRINTI " recovers from its embarrassing fear of darkness, and "
	ZERO? HELLHOUND-HAPPY? /?L36
	PRINTI "thumps its tail"
	JUMP ?L40
?L36:	PRINTI "snarls at you"
?L40:	PRINTI " with renewed enthusiasm."
	JUMP ?L45
?L30:	ZERO? WHO /?L45
	PRINTI "

With a "
	EQUAL? WHO,CROWD,HUMANOIDS \?L48
	PRINTI "collective "
?L48:	PRINTI "sigh of relief, "
	CALL ARTICLE,WHO,1
	PRINTD WHO
	PRINTI " turn"
	EQUAL? WHO,HUMANOIDS,BOOTS /?L57
	PRINTI "s"
?L57:	PRINTI " to look at you."
?L45:	CRLF
	CALL LIT?,HERE >LIT
	EQUAL? HERE,DARK-PLACE /?L65
	CRLF
	CALL V-LOOK
?L65:	SET 'DARK-PLACE,0
	RTRUE

	.FUNCT MOON-F
	ZERO? SKEWED? /?L3
	FSET? HERE,INDOORSBIT \?L1
?L3:	CALL YOU-CANT-SEE
	PRINTI "the moon right now."
	CRLF
	RETURN 2
?L1:	EQUAL? PRSA,V?EXAMINE,V?LOOK-ON \?L8
	CALL SAY-THE,MOON
	ZERO? ECLIPSE? /?L9
	PRINTI " has disappeared!"
	CRLF
	RETURN 2
?L9:	PRINTR "'s cold light makes you shiver."
?L8:	CALL YOU-DONT-NEED,MOON
	RETURN 2

	.INSERT "annotated_games/wishbringer/wishbringer_str"
	.END
