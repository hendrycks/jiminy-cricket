	.INSERT "./starcross/starcross_freq"
	.INSERT "./starcross/starcross_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	PRINTD OBJ
	RTRUE

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-THEFT?
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,JUNK-SPACESUIT,PINK-KEY,SMOKED-GLASS /TRUE
	EQUAL? PRSO,BROWN-KEY,SKELETON,VIOLET-KEY /TRUE
	EQUAL? PRSO,RED-KEY,ZAP-GUN \FALSE
	RTRUE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,AIRLOCK,AIRLOCK-INNER,AIRLOCK-OUTER /TRUE
	EQUAL? PRSO,ARTIFACT,BABY-BUMP,BLACK-KEY /TRUE
	EQUAL? PRSO,BLACK-SLOT,BLUE-DISK,BLUE-INNER /TRUE
	EQUAL? PRSO,BLUE-KEY,BLUE-OUTER,BLUE-SLOT /TRUE
	EQUAL? PRSO,BROWN-KEY,BROWN-SLOT,BUMP /TRUE
	EQUAL? PRSO,BUMP-2,BUNK,BUTTON /TRUE
	EQUAL? PRSO,CAGES,CARD,CHART /TRUE
	EQUAL? PRSO,CLEAR-KEY,CLEAR-SLOT,COMPUTER /TRUE
	EQUAL? PRSO,CONTROL-BUBBLE,CONTROL-BUBBLE-HATCH,CONTROLS /TRUE
	EQUAL? PRSO,COUCH,COURSE,DEBRIS /TRUE
	EQUAL? PRSO,DETECTOR,DRIVE-BUBBLE,DRIVE-BUBBLE-HATCH /TRUE
	EQUAL? PRSO,DRIVE-CONTROLS,ENUNCIATOR,ENV-COMPUTER /TRUE
	EQUAL? PRSO,EXECUTE-BUTTON,FF-DIAL,GOLD-KEY /TRUE
	EQUAL? PRSO,GOLD-SLOT,GREEN-INNER,GREEN-KEY /TRUE
	EQUAL? PRSO,GREEN-OUTER,GREEN-SLOT,GRUE-SIGN /TRUE
	EQUAL? PRSO,HUTS,INSTRUCTIONS,JUNK-SPACESUIT /TRUE
	EQUAL? PRSO,KNOBS,LASER-BEAM,METAL-DOOR /TRUE
	EQUAL? PRSO,MODEL,MOUSE-HOLE,NEST /TRUE
	EQUAL? PRSO,ON-OFF-SWITCH,PALISADE,PANEL /TRUE
	EQUAL? PRSO,PINK-KEY,PINK-SLOT,PLANTERS /TRUE
	EQUAL? PRSO,PROJECTOR,RED-BUTTON,RED-DISK /TRUE
	EQUAL? PRSO,RED-INNER,RED-KEY,RED-OUTER /TRUE
	EQUAL? PRSO,RED-SLOT,REGISTRATION,RELIEF /TRUE
	EQUAL? PRSO,ROD-RACK,SAFETY-HOOK,SAFETY-LINE /TRUE
	EQUAL? PRSO,SCORCHED-ALIEN,SEAT-BELT,SHIP /TRUE
	EQUAL? PRSO,SILVER-KEY,SILVER-SLOT,SKELETON /TRUE
	EQUAL? PRSO,SLIDE-PROJECTOR,SLOT,SMASHED-NEST /TRUE
	EQUAL? PRSO,SMOKED-GLASS,SPACESUIT,SPEAR /TRUE
	EQUAL? PRSO,SPEED-SELECT,STAIRS,TAPE-PLAYER /TRUE
	EQUAL? PRSO,TARGET-SELECT,TOTEMS,TRANSLATOR /TRUE
	EQUAL? PRSO,TRASH-BIN,TREE,VEGGIES /TRUE
	EQUAL? PRSO,VIEW-SELECT,VIOLET-KEY,VIOLET-SLOT /TRUE
	EQUAL? PRSO,WALL,WHITE-KEY,WHITE-SLOT /TRUE
	EQUAL? PRSO,WINDOW,YELLOW-INNER,YELLOW-KEY /TRUE
	EQUAL? PRSO,YELLOW-OUTER,YELLOW-SLOT,ZAP-GUN /TRUE
	EQUAL? PRSO,ZOOM-IN,ZOOM-OUT \FALSE
	RTRUE

	.FUNCT IS-PERSON?
	EQUAL? PRSO,ALIENS,CHIEF,GLOBAL-CHIEF \FALSE
	RTRUE

	.FUNCT IS-ANIMAL?
	EQUAL? PRSO,GLOBAL-MOUSE,GRUE,MOUSE /TRUE
	EQUAL? PRSO,RAT-ANT,SPIDER,UNICORNS \FALSE
	RTRUE

	.FUNCT IS-SELF?
	EQUAL? PRSO,ADVENTURER,ME \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? PRSO,HANDS \FALSE
	RTRUE

	.FUNCT IS-SELF-OR-PART-OF-SELF?,?TMP
	CALL IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-PART-OF-SELF? >STACK
	RSTACK

	.FUNCT DANGEROUS-FOOD?,?TMP
	CALL IS-PART-OF-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-OBJECT-OR-PROPERTY? >STACK
	RSTACK

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-ANIMAL? >STACK
	RSTACK

	.FUNCT DEMON,RTN,TICK,CINT
	CALL INT,RTN,1 >CINT
	PUT CINT,C-TICK,TICK
	RETURN CINT

	.FUNCT QUEUE,RTN,TICK,CINT
	CALL INT,RTN >CINT
	PUT CINT,C-TICK,TICK
	RETURN CINT

	.FUNCT INT,RTN,DEMON?1=0,E,C,INT?1
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	SUB C-INTS,C-INTLEN >C-INTS
	ZERO? DEMON?1 /?L5
	SUB C-DEMONS,C-INTLEN >C-DEMONS
?L5:	ADD C-TABLE,C-INTS >INT?1
	PUT INT?1,C-RTN,RTN
	RETURN INT?1
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L7
	RETURN C
?L7:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT CLOCKER,C,E,TICK,FLG=0
	ZERO? CLOCK-WAIT /?L1
	SET 'CLOCK-WAIT,0
	RFALSE
?L1:	ZERO? P-WON /?L4
	PUSH C-INTS
	JUMP ?L6
?L4:	PUSH C-DEMONS
?L6:	ADD C-TABLE,STACK >C
	ADD C-TABLE,C-TABLELEN >E
?L7:	EQUAL? C,E \?L9
	RETURN FLG
?L9:	GET C,C-ENABLED? >STACK
	ZERO? STACK /?L15
	GET C,C-TICK >TICK
	ZERO? TICK /?L15
	SUB TICK,1 >STACK
	PUT C,C-TICK,STACK
	GRTR? TICK,1 /?L15
	GET C,C-RTN >STACK
	CALL STACK >STACK
	ZERO? STACK /?L15
	SET 'FLG,1
?L15:	ADD C,C-INTLEN >C
	JUMP ?L7

	.FUNCT ZPROB,BASE
	ZERO? LUCKY /?L1
	RANDOM 100 >STACK
	GRTR? BASE,STACK /TRUE
	RFALSE
?L1:	RANDOM 300 >STACK
	GRTR? BASE,STACK \FALSE
	RTRUE

	.FUNCT PICK-ONE,FROB
	GET FROB,0 >STACK
	RANDOM STACK >STACK
	GET FROB,STACK >STACK
	RSTACK

	.FUNCT GO
START::
?L0:	PUTB P-LEXV,0,59
	CALL QUEUE,I-NIGHT,128 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-ALARM,1 >STACK
	PUT STACK,0,1
	SET 'LIT,1
	SET 'WINNER,ADVENTURER
	SET 'HERE,SPACESHIP-QUARTERS
	MOVE ADVENTURER,BUNK
	SET 'FF-HERE,FORCE-FIELD-2
	PUT MASSES,1,UM08
	PUT MASSES,2,UM12
	PUT MASSES,3,UM24
	PUT MASSES,4,UM28
	PUT MASSES,5,UM31
	PUT MASSES,6,UM52
	PUT MASSES,7,UM70
	PUT MASSES,8,UM91
	PUT KNOWNS,1,AB40
	PUT KNOWNS,2,AX87
	PUT KNOWNS,3,AX32
	PUT KNOWNS,4,AX01
	PUT KNOWNS,5,AX71
	PUT KNOWNS,6,US75
	PUT KNOWNS,7,MARS
	SET 'P-IT-LOC,HERE
	SET 'P-IT-OBJECT,0
	FSET? HERE,TOUCHBIT /?L1
	CALL V-VERSION
	CRLF
	PRINTI "You are sound asleep in your bunk aboard the deep-space black hole prospecting ship ""Starcross,"" operating out of Ceres. Just as your sleep becomes deep and comfortable, an alarm bell begins ringing! It's the mass detector! Instantly you awake. This hasn't been a profitable trip so far, and you don't even have the cash for repairs. This could be the break you've been waiting for. 
"
	CRLF
?L1:	CALL V-LOOK
	CALL MAIN-LOOP
	JUMP ?L0

	.FUNCT MAIN-LOOP,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP
?L1:	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	CALL PARSER >P-WON
	ZERO? P-WON /?L3
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	ZERO? OCNT \?L5
	SET 'NUM,OCNT
	JUMP ?L12
?L5:	GRTR? OCNT,1 \?L7
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L8
	SET 'OBJ,0
	JUMP ?L10
?L8:	GET P-PRSI,1 >OBJ
?L10:	SET 'NUM,OCNT
	JUMP ?L12
?L7:	GRTR? ICNT,1 \?L11
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L12
?L11:	SET 'NUM,1
?L12:	ZERO? OBJ \?L13
	EQUAL? ICNT,1 \?L13
	GET P-PRSI,1 >OBJ
?L13:	EQUAL? PRSA,V?WALK \?L16
	CALL PERFORM,PRSA,PRSO >V
	JUMP ?L31
?L16:	ZERO? NUM \?L18
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	ZERO? STACK \?L19
	CALL PERFORM,PRSA >V
	SET 'PRSO,0
	JUMP ?L31
?L19:	PRINTI "There isn't anything to "
	GET P-ITBL,P-VERBN >TMP
	ZERO? P-OFLAG /?L24
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L26
?L24:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L26:	PRINTI "!"
	CRLF
	SET 'V,0
	JUMP ?L31
?L18:	IGRTR? 'CNT,NUM /?L31
	ZERO? PTBL /?L35
	GET P-PRSO,CNT >OBJ1
	JUMP ?L37
?L35:	GET P-PRSI,CNT >OBJ1
?L37:	GRTR? NUM,1 \?L38
	PRINTD OBJ1
	PRINTI ": "
?L38:	ZERO? PTBL /?L43
	SET 'PRSO,OBJ1
	JUMP ?L45
?L43:	SET 'PRSO,OBJ
?L45:	ZERO? PTBL /?L46
	SET 'PRSI,OBJ
	JUMP ?L48
?L46:	SET 'PRSI,OBJ1
?L48:	CALL PERFORM,PRSA,PRSO,PRSI >V
	EQUAL? V,M-FATAL \?L18
?L31:	EQUAL? PRSA,V?AGAIN /?L52
	SET 'L-PRSA,PRSA
	SET 'L-PRSO,PRSO
	SET 'L-PRSI,PRSI
?L52:	INC 'MOVES
	EQUAL? V,M-FATAL \?L58
	SET 'P-CONT,0
	JUMP ?L58
?L3:	SET 'P-CONT,0
?L58:	ZERO? NOT-AGAIN \?L59
	RETURN V
?L59:	ZERO? P-WON /?L1
	EQUAL? PRSA,V?SUPER-BRIEF,V?BRIEF,V?TELL /?L1
	EQUAL? PRSA,V?VERSION,V?SAVE,V?VERBOSE /?L1
	EQUAL? PRSA,V?SCORE,V?RESTART,V?QUIT /?L1
	EQUAL? PRSA,V?RESTORE,V?UNSCRIPT,V?SCRIPT /?L1
	CALL CLOCKER >V
	JUMP ?L1

	.FUNCT PERFORM,A,O=0,I=0,V,OA,OO,OI
	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	EQUAL? IT,I,O \?L1
	EQUAL? P-IT-LOC,HERE /?L1
	PRINTI "I don't see what you are referring to."
	CRLF
	RETURN 2
?L1:	EQUAL? O,IT \?L8
	SET 'O,P-IT-OBJECT
?L8:	EQUAL? I,IT \?L11
	SET 'I,P-IT-OBJECT
?L11:	SET 'PRSA,A
	SET 'PRSO,O
	ZERO? PRSO /?L14
	EQUAL? PRSA,V?WALK /?L14
	SET 'P-IT-OBJECT,PRSO
	SET 'P-IT-LOC,HERE
?L14:	SET 'PRSI,I
	GETP WINNER,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L24
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-BEG >V
	ZERO? V \?L24
	GET PREACTIONS,A >STACK
	CALL STACK >V
	ZERO? V \?L24
	ZERO? I /?L21
	GETP I,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L24
?L21:	ZERO? O /?L23
	EQUAL? A,V?WALK /?L22
	LOC O >STACK
	ZERO? STACK /?L22
	LOC O >STACK
	GETP STACK,P?CONTFCN >STACK
	CALL STACK >V
	ZERO? V \?L24
?L22:	ZERO? O /?L23
	EQUAL? A,V?WALK /?L23
	GETP O,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L24
?L23:	GET ACTIONS,A >STACK
	CALL STACK >V
	ZERO? V /?L24
?L24:	EQUAL? V,M-FATAL /?L26
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-END >V
?L26:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT TABLE-COPY,SRC,DEST,CNT
	MUL CNT,2 >CNT
?L1:	DLESS? 'CNT,0 /TRUE
	GETB SRC,CNT >STACK
	PUTB DEST,CNT,STACK
	JUMP ?L1

	.FUNCT PARSER,PTR=P-LEXSTART,WORD,VAL=0,VERB=0,LEN,DIR=0,NW=0,LW=0,NUM,SCNT,CNT=-1
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'P-NUMBER,0
	SET 'P-ADVERB,0
	SET 'P-ADJECTIVE,0
	SET 'P-MERGED,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	ZERO? QUOTE-FLAG \?L8
	EQUAL? WINNER,ADVENTURER /?L8
	SET 'WINNER,ADVENTURER
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L8
	LOC WINNER >HERE
?L8:	ZERO? P-CONT /?L12
	SET 'PTR,P-CONT
	SET 'P-CONT,0
	EQUAL? PRSA,V?TELL /?L17
	CRLF
	JUMP ?L17
?L12:	SET 'WINNER,ADVENTURER
	SET 'QUOTE-FLAG,0
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L18
	LOC WINNER >HERE
?L18:	EQUAL? NOT-AGAIN,2 \?L21
	CALL TABLE-COPY,P-INBUF,A-INBUF,50
	CALL TABLE-COPY,P-LEXV,A-LEXV,60
?L21:	SET 'SCNT,P-SPACE
?L24:	DLESS? 'SCNT,0 /?L25
	CRLF
	JUMP ?L24
?L25:	PRINTI ">"
	READ P-INBUF,P-LEXV
?L17:	GETB P-LEXV,P-LEXWORDS >P-LEN
	ZERO? P-LEN \?L31
	PRINTI "I beg your pardon?"
	CRLF
	RFALSE
?L31:	SET 'LEN,P-LEN
	SET 'P-DIR,0
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
	PUT P-ITBL,P-VERBN,0
	EQUAL? NOT-AGAIN,2 \?L36
	SET 'A-PTR,A-PTR2
	EQUAL? PTR,P-LEXSTART /?L41
	CALL TABLE-COPY,P-INBUF,A-INBUF,50
	CALL TABLE-COPY,P-LEXV,A-LEXV,60
	JUMP ?L41
?L36:	EQUAL? NOT-AGAIN,1 \?L41
	SET 'NOT-AGAIN,2
?L41:	SET 'A-PTR2,PTR
?L43:	DLESS? 'P-LEN,0 \?L45
	SET 'QUOTE-FLAG,0
	JUMP ?L44
?L45:	GET P-LEXV,PTR >WORD
	ZERO? WORD \?L48
	CALL NUMBER?,PTR >WORD
	ZERO? WORD /?L47
?L48:	EQUAL? WORD,W?TO \?L49
	EQUAL? VERB,ACT?TELL \?L49
	SET 'WORD,W?$QUOTE
	JUMP ?L51
?L49:	EQUAL? WORD,W?THEN \?L51
	ZERO? VERB \?L51
	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WORD,W?$QUOTE
?L51:	EQUAL? WORD,W?THEN,W?$PERIOD /?L55
	EQUAL? WORD,W?$QUOTE \?L53
?L55:	EQUAL? WORD,W?$QUOTE \?L60
	ZERO? QUOTE-FLAG /?L58
	SET 'QUOTE-FLAG,0
	JUMP ?L60
?L58:	SET 'QUOTE-FLAG,1
?L60:	ZERO? P-LEN /?L62
	ADD PTR,P-LEXELEN >P-CONT
?L62:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L44
?L53:	CALL WT?,WORD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L64
	EQUAL? LEN,1 /?L65
	EQUAL? LEN,2 \?L66
	EQUAL? VERB,ACT?WALK /?L65
?L66:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
	EQUAL? NW,W?THEN,W?$QUOTE \?L67
	EQUAL? VERB,ACT?WALK \?L67
	GRTR? LEN,2 /?L65
?L67:	EQUAL? NW,W?$PERIOD \?L68
	EQUAL? VERB,ACT?WALK,0 \?L68
	GRTR? LEN,1 /?L65
?L68:	ZERO? QUOTE-FLAG /?L69
	EQUAL? LEN,2 \?L69
	EQUAL? NW,W?$QUOTE /?L65
?L69:	GRTR? LEN,2 \?L64
	EQUAL? VERB,ACT?WALK \?L64
	EQUAL? NW,W?$COMMA,W?AND \?L64
?L65:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L70
	ADD PTR,P-LEXELEN >STACK
	PUT P-LEXV,STACK,W?THEN
?L70:	GRTR? LEN,2 /?L98
	SET 'QUOTE-FLAG,0
	JUMP ?L44
?L64:	CALL WT?,WORD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L76
	ZERO? VERB \?L76
	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WORD
	MUL PTR,2 >STACK
	ADD STACK,2 >NUM
	GETB P-LEXV,NUM >STACK
	PUTB P-VTBL,2,STACK
	ADD NUM,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L98
?L76:	CALL WT?,WORD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L78
	EQUAL? WORD,W?ALL,W?ONE,W?A /?L79
	CALL WT?,WORD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L79
	CALL WT?,WORD,PS?OBJECT >STACK
	ZERO? STACK /?L77
?L79:	SET 'VAL,0
?L78:	GRTR? P-LEN,0 \?L80
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?OF \?L80
	ZERO? VAL \?L108
	EQUAL? WORD,W?ALL,W?ONE,W?A \?L98
?L80:	ZERO? VAL /?L82
?L108:	ZERO? P-LEN /?L83
	ADD PTR,2 >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?THEN,W?$PERIOD \?L82
?L83:	LESS? P-NCN,2 \?L98
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WORD
	JUMP ?L98
?L82:	EQUAL? P-NCN,2 \?L87
	PRINTI "I found too many nouns in that sentence."
	CRLF
	RFALSE
?L87:	INC 'P-NCN
	CALL CLAUSE,PTR,VAL,WORD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L98
	SET 'QUOTE-FLAG,0
	JUMP ?L44
?L77:	CALL WT?,WORD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L98
	CALL CANT-USE,PTR
	RFALSE
?L47:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L98:	SET 'LW,WORD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L43
?L44:	ZERO? DIR /?L99
	SET 'PRSA,V?WALK
	SET 'PRSO,DIR
	SET 'P-WALK-DIR,DIR
	RTRUE
?L99:	SET 'P-WALK-DIR,0
	ZERO? P-OFLAG /?L102
	CALL ORPHAN-MERGE
?L102:	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT WT?,PTR,BIT,B1=5,OFFST=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L6
	INC 'OFFST
?L6:	GETB PTR,OFFST >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WORD,OFF,NUM,ANDFLG=0,FIRST??=1,NW,LW=0
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L1
	ADD P-PREP1,OFF >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WORD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'P-LEN
?L3:	ZERO? P-LEN \?L4
	DEC 'P-NCN
	RETURN -1
?L4:	ADD P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L7
	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
?L7:	DLESS? 'P-LEN,0 \?L12
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L12:	GET P-LEXV,PTR >WORD
	ZERO? WORD \?L17
	CALL NUMBER?,PTR >WORD
	ZERO? WORD /?L15
?L17:	ZERO? P-LEN \?L18
	SET 'NW,0
	JUMP ?L20
?L18:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L20:	EQUAL? WORD,W?AND,W?$COMMA \?L21
	SET 'ANDFLG,1
	JUMP ?L40
?L21:	EQUAL? WORD,W?ALL,W?ONE \?L23
	EQUAL? NW,W?OF \?L40
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L40
?L23:	EQUAL? WORD,W?THEN,W?$PERIOD /?L28
	CALL WT?,WORD,PS?PREPOSITION >STACK
	ZERO? STACK /?L27
	ZERO? FIRST?? \?L27
?L28:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L27:	ZERO? ANDFLG /?L29
	CALL WT?,WORD,PS?DIRECTION >STACK
	ZERO? STACK \?L30
	CALL WT?,WORD,PS?VERB >STACK
	ZERO? STACK /?L29
?L30:	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	PUT P-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L40
?L29:	CALL WT?,WORD,PS?OBJECT >STACK
	ZERO? STACK /?L31
	CALL WT?,WORD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L32
	ZERO? NW /?L32
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L40
?L32:	ZERO? ANDFLG \?L34
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L34
	EQUAL? NW,W?$COMMA /?L34
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L34:	SET 'ANDFLG,0
	JUMP ?L40
?L31:	CALL WT?,WORD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L40
	CALL WT?,WORD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L40
	CALL WT?,WORD,PS?PREPOSITION >STACK
	ZERO? STACK \?L40
	CALL CANT-USE,PTR
	RFALSE
?L15:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L40:	SET 'LW,WORD
	SET 'FIRST??,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0,TIM=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L1:	DLESS? 'CNT,0 /?L2
	GETB P-INBUF,BPTR >CHR
	EQUAL? CHR,58 \?L6
	SET 'TIM,SUM
	SET 'SUM,0
	JUMP ?L10
?L6:	GRTR? SUM,10000 /FALSE
	LESS? CHR,58 \FALSE
	GRTR? CHR,47 \FALSE
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
?L10:	INC 'BPTR
	JUMP ?L1
?L2:	PUT P-LEXV,PTR,W?INTNUM
	GRTR? SUM,1000 /FALSE
	ZERO? TIM /?L13
	LESS? TIM,8 \?L14
	ADD TIM,12 >TIM
	JUMP ?L16
?L14:	GRTR? TIM,23 /FALSE
?L16:	MUL TIM,60 >STACK
	ADD SUM,STACK >SUM
?L13:	SET 'P-NUMBER,SUM
	RETURN W?INTNUM

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,WRD
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L1
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L1:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L4
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP1 >STACK
	EQUAL? TEMP,STACK /?L7
	ZERO? TEMP \FALSE
?L7:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L19
?L4:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L9
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP2 >STACK
	EQUAL? TEMP,STACK /?L12
	ZERO? TEMP \FALSE
?L12:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L19
?L9:	ZERO? P-ACLAUSE /?L19
	EQUAL? P-NCN,1 /?L15
	SET 'P-ACLAUSE,0
	RFALSE
?L15:	GET P-ITBL,P-NC1 >BEG
	GET P-ITBL,P-NC1L >END
?L18:	EQUAL? BEG,END \?L20
	ZERO? ADJ /?L22
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L19
?L22:	SET 'P-ACLAUSE,0
	RFALSE
?L20:	ZERO? ADJ \?L25
	GET BEG,0 >WRD
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE \?L25
	SET 'ADJ,WRD
	JUMP ?L30
?L25:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT /?L27
	EQUAL? WRD,W?ONE \?L30
?L27:	EQUAL? WRD,P-ANAM,W?ONE \FALSE
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L19
?L30:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L18
?L19:	IGRTR? 'CNT,P-ITBLLEN \?L35
	SET 'P-MERGED,1
	RTRUE
?L35:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L19

	.FUNCT ACLAUSE-WIN,ADJ
	SET 'P-CCSRC,P-OTBL
	ADD P-ACLAUSE,1 >STACK
	CALL CLAUSE-COPY,P-ACLAUSE,STACK,ADJ
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'P-NCN,2
?L1:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,?TMP
	PRINTI "I don't know the word '"
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI "'."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT CANT-USE,PTR,BUF,?TMP
	PRINTI "I can't use the word '"
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI "' here."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB,TMP
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	PRINTI "I can't find a verb in that sentence!"
	CRLF
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L6:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	LESS? NUM,1 /?L8
	ZERO? P-NCN \?L8
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L10
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L8
?L10:	SET 'DRIVE1,SYN
	JUMP ?L14
?L8:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L14
	EQUAL? NUM,2 \?L12
	EQUAL? P-NCN,1 \?L12
	SET 'DRIVE2,SYN
	JUMP ?L14
?L12:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L14
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L14:	DLESS? 'LEN,1 \?L17
	ZERO? DRIVE1 \?L50
	ZERO? DRIVE2 \?L7
	PRINTI "I don't understand that sentence."
	CRLF
	RFALSE
?L17:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L6
?L7:	ZERO? DRIVE1 /?L26
?L50:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L26
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L26:	ZERO? DRIVE2 /?L28
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L28
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L28:	EQUAL? VERB,ACT?FIND \?L29
	PRINTI "I can't answer that question."
	CRLF
	RFALSE
?L29:	EQUAL? WINNER,ADVENTURER /?L32
	CALL CANT-ORPHAN >STACK
	RSTACK
?L32:	CALL ORPHAN,DRIVE1,DRIVE2
	PRINTI "What do you want to "
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L36
	PRINTI "tell"
	JUMP ?L41
?L36:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L40
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L41
?L40:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L41:	ZERO? DRIVE2 /?L42
	CALL CLAUSE-PRINT,P-NC1,P-NC1L
?L42:	SET 'P-OFLAG,1
	ZERO? DRIVE1 /?L45
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L47
?L45:	GETB DRIVE2,P-SPREP2 >STACK
?L47:	CALL PREP-PRINT,STACK
	PRINTI "?"
	CRLF
	RFALSE

	.FUNCT CANT-ORPHAN
	PRINTI """That command was incomplete. Why don't you try again?"""
	CRLF
	RFALSE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	PUT P-OCLAUSE,P-MATCHLEN,0
	SET 'P-CCSRC,P-ITBL
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L1
?L2:	EQUAL? P-NCN,2 \?L6
	CALL CLAUSE-COPY,P-NC2,P-NC2L
?L6:	LESS? P-NCN,1 /?L9
	CALL CLAUSE-COPY,P-NC1,P-NC1L
?L9:	ZERO? D1 /?L12
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L12:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT CLAUSE-PRINT,BPTR,EPTR
	GET P-ITBL,EPTR >STACK
	GET P-ITBL,BPTR >STACK
	CALL BUFFER-PRINT,STACK,STACK,1 >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=0,WRD,FIRST??=1,PN=0
?L1:	EQUAL? BEG,END /TRUE
	ZERO? NOSP /?L6
	SET 'NOSP,0
	JUMP ?L8
?L6:	PRINTI " "
?L8:	GET BEG,0 >WRD
	EQUAL? WRD,W?$PERIOD \?L11
	SET 'NOSP,1
	JUMP ?L13
?L11:	ZERO? FIRST?? /?L14
	ZERO? PN \?L14
	ZERO? CP /?L14
	PRINTI "the "
?L14:	ZERO? P-OFLAG /?L19
	PRINTB WRD
	JUMP ?L22
?L19:	EQUAL? WRD,W?IT \?L21
	EQUAL? P-IT-LOC,HERE \?L21
	PRINTD P-IT-OBJECT
	JUMP ?L22
?L21:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L22:	SET 'FIRST??,0
?L13:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CAPITALIZE,PTR
	GETB PTR,3 >STACK
	GETB P-INBUF,STACK >STACK
	SUB STACK,32 >STACK
	PRINTC STACK
	GETB PTR,3 >STACK
	INC 'STACK
	GETB PTR,2 >STACK
	DEC 'STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT PREP-PRINT,PREP,WRD
	ZERO? PREP /FALSE
	PRINTI " "
	CALL PREP-FIND,PREP >WRD
	PRINTB WRD
	RTRUE

	.FUNCT CLAUSE-COPY,BPTR,EPTR,INSRT=0,BEG,END
	GET P-CCSRC,BPTR >BEG
	GET P-CCSRC,EPTR >END
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	PUT P-OTBL,BPTR,STACK
?L1:	EQUAL? BEG,END \?L3
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	PUT P-OTBL,EPTR,STACK
	RTRUE
?L3:	ZERO? INSRT /?L6
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L6
	CALL CLAUSE-ADD,INSRT
?L6:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CLAUSE-ADD,WRD,PTR
	GET P-OCLAUSE,P-MATCHLEN >STACK
	ADD STACK,2 >PTR
	SUB PTR,1 >STACK
	PUT P-OCLAUSE,STACK,WRD
	PUT P-OCLAUSE,PTR,0
	PUT P-OCLAUSE,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-FIND,PREP,CNT=0,SIZE
	GET PREPOSITIONS,0 >STACK
	MUL STACK,2 >SIZE
?L1:	IGRTR? 'CNT,SIZE /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L1
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ
	EQUAL? GBIT,RMUNGBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	FSET? OBJ,VEHBIT \?L8
	EQUAL? PREP,PR?DOWN \?L8
	SET 'PREP,PR?ON
?L8:	PRINTI "("
	ZERO? PREP /?L13
	CALL PREP-FIND,PREP >STACK
	PRINTB STACK
	PRINTI " the "
?L13:	PRINTD OBJ
	PRINTI ")"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,PTR
	GET P-ITBL,P-NC1 >PTR
	ZERO? PTR /?L5
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /?L5
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L5:	GET P-ITBL,P-NC2 >PTR
	ZERO? PTR /TRUE
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSI,P-MATCHLEN >STACK
	EQUAL? STACK,1 \?L14
	CALL BUT-MERGE,P-PRSO >P-PRSO
	RTRUE
?L14:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,BUT=0,LEN,WV,WORD,NW
	SET 'P-GETFLAGS,0
	SET 'P-CSPTR,PTR
	SET 'P-CEPTR,EPTR
	PUT P-BUTS,P-MATCHLEN,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WORD
?L1:	EQUAL? PTR,EPTR \?L3
?L49:	ZERO? BUT /?L6
	PUSH BUT
	JUMP ?L5
?L6:	PUSH TBL
?L5:	CALL GET-OBJECT,STACK >STACK
	RSTACK
?L3:	GET PTR,P-LEXELEN >NW
	EQUAL? WORD,W?ALL \?L8
	SET 'P-GETFLAGS,P-ALL
	EQUAL? NW,W?OF \?L44
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L44
?L8:	EQUAL? WORD,W?BUT,W?EXCEPT \?L13
	ZERO? BUT /?L17
	PUSH BUT
	JUMP ?L16
?L17:	PUSH TBL
?L16:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,P-BUTS
	PUT BUT,P-MATCHLEN,0
	JUMP ?L44
?L13:	EQUAL? WORD,W?A,W?ONE \?L18
	ZERO? P-ADJ \?L19
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L44
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L44
?L19:	SET 'P-NAM,P-ONEOBJ
	ZERO? BUT /?L28
	PUSH BUT
	JUMP ?L27
?L28:	PUSH TBL
?L27:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L44
?L18:	EQUAL? WORD,W?AND,W?$COMMA \?L31
	EQUAL? NW,W?AND,W?$COMMA /?L31
	ZERO? BUT /?L35
	PUSH BUT
	JUMP ?L34
?L35:	PUSH TBL
?L34:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L44
?L31:	CALL WT?,WORD,PS?PREPOSITION >STACK
	ZERO? STACK /?L36
	EQUAL? PTR,P-CSPTR \?L36
	ADD P-CSPTR,P-WORDLEN >P-CSPTR
	JUMP ?L44
?L36:	CALL WT?,WORD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L44
	EQUAL? WORD,W?AND,W?$COMMA /?L44
	EQUAL? WORD,W?OF \?L39
	ZERO? P-GETFLAGS \?L44
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L44
?L39:	CALL WT?,WORD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L43
	CALL ADJ-CHECK >STACK
	ZERO? STACK /?L43
	SET 'P-ADJ,WV
	SET 'P-ADJN,WORD
	SET 'P-ADJECTIVE,WORD
	JUMP ?L44
?L43:	CALL WT?,WORD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L44
	SET 'P-NAM,WORD
	SET 'P-ONEOBJ,WORD
?L44:	EQUAL? PTR,EPTR /?L49
	ADD PTR,P-WORDLEN >PTR
	SET 'WORD,NW
	JUMP ?L1

	.FUNCT ADJ-CHECK
	ZERO? P-ADJ /TRUE
	EQUAL? P-ADJ,A?FIRST,A?SECOND,A?THIRD /FALSE
	EQUAL? P-ADJ,A?FOURTH,A?FIFTH,A?SIXTH /FALSE
	EQUAL? P-ADJ,A?SEVENTH,A?EIGHTH,A?NINTH /FALSE
	EQUAL? P-ADJ,A?TENTH,A?SMALL,A?LARGE /FALSE
	EQUAL? P-ADJ,A?INNER,A?OUTER \TRUE
	RFALSE

	.FUNCT GET-OBJECT,TBL,VRB=1,LEN,XBITS,TLEN,GCHECK=0,OLEN=0
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	ZERO? P-NAM \?L7
	ZERO? P-ADJ /?L4
	CALL WT?,P-ADJN,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L4
	SET 'P-NAM,P-ADJN
	SET 'P-ADJECTIVE,0
	SET 'P-ADJ,0
?L4:	ZERO? P-NAM \?L7
	ZERO? P-ADJ \?L7
	EQUAL? P-GETFLAGS,P-ALL /?L84
	ZERO? P-GWIMBIT \?L7
	ZERO? VRB /FALSE
	PRINTI "I think that sentence was missing a noun."
	CRLF
	RFALSE
?L7:	EQUAL? P-GETFLAGS,P-ALL \?L17
?L84:	ZERO? P-SLOCBITS \?L15
?L17:	SET 'P-SLOCBITS,-1
?L15:	SET 'P-TABLE,TBL
?L19:	ZERO? GCHECK /?L21
	CALL GLOBAL-CHECK,TBL
	JUMP ?L23
?L21:	ZERO? LIT /?L24
	CALL DO-SL,HERE,SOG,SIR
?L24:	CALL DO-SL,ADVENTURER,SH,SC
?L23:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL /?L82
	BTST P-GETFLAGS,P-ONE \?L29
	ZERO? LEN /?L29
	EQUAL? LEN,1 /?L30
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "(How about the "
	GET TBL,1 >STACK
	PRINTD STACK
	PRINTI "?)"
	CRLF
?L30:	PUT TBL,P-MATCHLEN,1
	JUMP ?L82
?L29:	GRTR? LEN,1 /?L38
	ZERO? LEN \?L82
	EQUAL? P-SLOCBITS,-1 /?L37
?L38:	EQUAL? P-SLOCBITS,-1 \?L39
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L19
?L39:	ZERO? LEN \?L42
	SET 'LEN,OLEN
?L42:	EQUAL? WINNER,ADVENTURER /?L45
	CALL CANT-ORPHAN
	RFALSE
?L45:	EQUAL? P-NAM,W?BUMP \?L47
	EQUAL? P-NCN,2 \?L47
	ZERO? P-NUMBER /?L47
	PUT TBL,P-MATCHLEN,1
	PUT TBL,1,BUMP
	RTRUE
?L47:	ZERO? VRB /?L52
	ZERO? P-NAM /?L48
	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L49
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L51
?L49:	SET 'P-ACLAUSE,P-NC2
?L51:	SET 'P-AADJ,P-ADJ
	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L52
?L48:	ZERO? VRB /?L52
	PRINTI "You must supply a noun!"
	CRLF
?L52:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L37:	ZERO? LEN \?L82
	ZERO? GCHECK /?L56
	ZERO? VRB /?L78
	ZERO? LIT /?L59
	PRINTI "You can't see any"
	ZERO? P-OFLAG /?L63
	ZERO? P-ADJ /?L65
	ZERO? P-NAM /?L75
	PRINTI " such"
?L65:	ZERO? P-NAM /?L75
	PRINTI " "
	PRINTB P-NAM
	JUMP ?L75
?L63:	CALL BUFFER-PRINT,P-CSPTR,P-CEPTR,0
?L75:	PRINTI " here."
	CRLF
	JUMP ?L78
?L59:	PRINTI "It's too dark to see."
	CRLF
?L78:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L56:	ZERO? LEN \?L82
	SET 'GCHECK,1
	JUMP ?L19
?L82:	SET 'P-ADJ,0
	SET 'P-NAM,0
	SET 'P-SLOCBITS,XBITS
	RTRUE

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	SET 'RLEN,LEN
	PRINTI "Which "
	PRINTB P-NAM
	EQUAL? P-NAM,W?BUMP,W?COLUMN \?L3
	PRINTR " of the ten do you mean?"
?L3:	PRINTI " do you mean, "
?L10:	INC 'TLEN
	GET TBL,TLEN >OBJ
	PRINTI "the "
	PRINTD OBJ
	EQUAL? LEN,2 \?L16
	EQUAL? RLEN,2 /?L18
	PRINTI ","
?L18:	PRINTI " or "
	JUMP ?L25
?L16:	GRTR? LEN,2 \?L25
	PRINTI ", "
?L25:	DLESS? 'LEN,1 \?L10
	PRINTR "?"

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS,FOO
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETPT HERE,P?PSEUDO >RMG
	ZERO? RMG /?L15
	PTSIZE RMG >STACK
	DIV STACK,4 >STACK
	SUB STACK,1 >RMGL
	SET 'CNT,0
?L14:	MUL CNT,2 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L16
	MUL CNT,2 >STACK
	INC 'STACK
	GET RMG,STACK >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	GETPT PSEUDO-OBJECT,P?ACTION >STACK
	SUB STACK,5 >FOO
	GET P-NAM,0 >STACK
	PUT FOO,0,STACK
	GET P-NAM,1 >STACK
	PUT FOO,1,STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L15
?L16:	IGRTR? 'CNT,RMGL \?L14
?L15:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	GET TBL,P-MATCHLEN >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?LOOK-INSIDE,V?SEARCH /?L27
	EQUAL? PRSA,V?EXAMINE,V?FIND,V?THROUGH \FALSE
?L27:	CALL DO-SL,ROOMS,1,1 >STACK
	RSTACK

	.FUNCT DO-SL,OBJ,BIT1,BIT2
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL,FLS,NOBJ
	FIRST? OBJ >OBJ \FALSE
?L3:	EQUAL? LVL,P-SRCBOT /?L5
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L5
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	FSET? OBJ,INVISIBLE /?L14
	EQUAL? LVL,P-SRCTOP \?L10
	FSET? OBJ,SEARCHBIT /?L10
	FSET? OBJ,SURFACEBIT \?L14
?L10:	FIRST? OBJ >NOBJ \?L14
	FSET? OBJ,OPENBIT /?L11
	FSET? OBJ,TRANSBIT \?L14
?L11:	EQUAL? LVL,P-SRCTOP \?L12
	FSET? OBJ,SEARCHBIT \?L12
	EQUAL? P-GETFLAGS,P-ALL /?L14
?L12:	FSET? OBJ,SURFACEBIT \?L15
	PUSH P-SRCALL
	JUMP ?L18
?L15:	FSET? OBJ,SEARCHBIT \?L17
	PUSH P-SRCALL
	JUMP ?L18
?L17:	PUSH P-SRCTOP
?L18:	CALL SEARCH-LIST,OBJ,TBL,STACK >FLS
?L14:	NEXT? OBJ >OBJ /?L3
	RTRUE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,IBITS,PTR,OBJ,TAKEN
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST IBITS,SHAVE /?L3
	BTST IBITS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L9
	SET 'OBJ,P-IT-OBJECT
?L9:	CALL HELD?,OBJ >STACK
	ZERO? STACK \?L3
	EQUAL? OBJ,HANDS /?L3
	SET 'PRSO,OBJ
	FSET? OBJ,TRYTAKEBIT \?L14
	SET 'TAKEN,1
	JUMP ?L18
?L14:	EQUAL? WINNER,ADVENTURER /?L16
	SET 'TAKEN,0
	JUMP ?L18
?L16:	BTST IBITS,STAKE \?L17
	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \?L17
	SET 'TAKEN,0
	JUMP ?L18
?L17:	SET 'TAKEN,1
?L18:	ZERO? TAKEN /?L31
	BTST IBITS,SHAVE \?L19
	PRINTI "You don't have the "
	PRINTD OBJ
	PRINTI "."
	CRLF
	RFALSE
?L19:	ZERO? TAKEN \?L3
?L31:	EQUAL? WINNER,ADVENTURER \?L3
	PRINTI "(Taken)"
	CRLF
	JUMP ?L3

	.FUNCT HELD?,CAN
?L1:	LOC CAN >CAN
	ZERO? CAN /FALSE
	EQUAL? CAN,WINNER \?L1
	RTRUE

	.FUNCT MANY-CHECK,LOSS=0,TMP
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	PRINTI "I can't use multiple "
	EQUAL? LOSS,2 \?L9
	PRINTI "in"
?L9:	PRINTI "direct objects with '"
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L16
	PRINTI "tell"
	JUMP ?L21
?L16:	ZERO? P-OFLAG /?L20
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L21
?L20:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L21:	PRINTI "'."
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT LIT?,RM,OHERE,LIT?1=0
	SET 'P-GWIMBIT,ONBIT
	SET 'OHERE,HERE
	SET 'HERE,RM
	FSET? RM,ONBIT /?L3
	ZERO? ALWAYS-LIT /?L1
?L3:	SET 'LIT?1,1
	JUMP ?L8
?L1:	PUT P-MERGE,P-MATCHLEN,0
	SET 'P-TABLE,P-MERGE
	SET 'P-SLOCBITS,-1
	EQUAL? OHERE,RM \?L5
	CALL DO-SL,WINNER,1,1
?L5:	CALL DO-SL,RM,1,1
	GET P-TABLE,P-MATCHLEN >STACK
	GRTR? STACK,0 \?L8
	SET 'LIT?1,1
?L8:	SET 'HERE,OHERE
	SET 'P-GWIMBIT,0
	RETURN LIT?1

	.FUNCT PRSO-PRINT,PTR
	ZERO? P-MERGED \?L3
	GET P-ITBL,P-NC1 >PTR
	GET PTR,0 >STACK
	EQUAL? STACK,W?IT \?L1
?L3:	PRINTI " "
	PRINTD PRSO
	RTRUE
?L1:	GET P-ITBL,P-NC1L >STACK
	CALL BUFFER-PRINT,PTR,STACK,0 >STACK
	RSTACK

	.FUNCT PRSI-PRINT,PTR
	ZERO? P-MERGED \?L3
	GET P-ITBL,P-NC2 >PTR
	GET PTR,0 >STACK
	EQUAL? STACK,W?IT \?L1
?L3:	PRINTI " "
	PRINTD PRSO
	RTRUE
?L1:	GET P-ITBL,P-NC2L >STACK
	CALL BUFFER-PRINT,PTR,STACK,0 >STACK
	RSTACK

	.FUNCT THIS-IT?,OBJ,TBL,SYNS
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	ZERO? P-ADJ /?L4
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DEC 'STACK
	CALL ZMEMQB,P-ADJ,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L4:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT V-VERBOSE
	SET 'VERBOSE,1
	SET 'SUPER-BRIEF,0
	PRINTR "Maximum verbosity."

	.FUNCT V-BRIEF
	SET 'VERBOSE,0
	SET 'SUPER-BRIEF,0
	PRINTR "Brief descriptions."

	.FUNCT V-SUPER-BRIEF
	SET 'SUPER-BRIEF,1
	PRINTR "Super-brief descriptions."

	.FUNCT V-LOOK
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /FALSE
	CALL DESCRIBE-OBJECTS,1 >STACK
	RSTACK

	.FUNCT V-FIRST-LOOK
	CALL DESCRIBE-ROOM >STACK
	ZERO? STACK /FALSE
	ZERO? SUPER-BRIEF \FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT V-EXAMINE
	GETP PRSO,P?TEXT >STACK
	ZERO? STACK /?L1
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	FSET? PRSO,CONTBIT /?L6
	FSET? PRSO,DOORBIT \?L5
?L6:	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L5:	PRINTI "I see nothing special about the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT DESCRIBE-ROOM,LOOK?=0,V?,STR,AV
	SET 'V?,LOOK?
	ZERO? V? \?L1
	SET 'V?,VERBOSE
?L1:	ZERO? LIT \?L3
	PRINTI "It is pitch black. You are likely to be eaten by a grue."
	CRLF
	CALL PRINT-ID,STR?13
	RFALSE
?L3:	FSET? HERE,TOUCHBIT /?L8
	FSET HERE,TOUCHBIT
	SET 'V?,1
?L8:	IN? HERE,ROOMS \?L11
	PRINTD HERE
	CRLF
?L11:	ZERO? LOOK? \?L18
	ZERO? SUPER-BRIEF \?L30
?L18:	LOC WINNER >AV
	FSET? AV,VEHBIT \?L19
	PRINTI "(You are in the "
	PRINTD AV
	PRINTI ".)"
	CRLF
?L19:	ZERO? V? /?L26
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \TRUE
	ZERO? V? /?L26
	GETP HERE,P?LDESC >STR
	ZERO? STR /?L26
	PRINT STR
	CRLF
	JUMP ?L29
?L26:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-FLASH >STACK
?L29:	EQUAL? HERE,AV /?L30
	FSET AV,VEHBIT
	GETP AV,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
?L30:	FSET? HERE,ONBIT /TRUE
	ZERO? ALWAYS-LIT /TRUE
	PRINTR "The room is lit by an emergency lighting system."

	.FUNCT DESCRIBE-OBJECTS,V?=0
	ZERO? LIT /?L1
	FIRST? HERE >STACK \FALSE
	ZERO? V? \?L5
	SET 'V?,VERBOSE
?L5:	CALL PRINT-CONT,HERE,V?,-1 >STACK
	RSTACK
?L1:	PRINTR "I can't see anything in the dark."

	.FUNCT DESCRIBE-OBJECT,OBJ,V?,LEVEL,STR=0,AV
	ZERO? LEVEL \?L8
	GETP OBJ,P?DESCFCN >STACK
	CALL STACK,M-OBJDESC >STACK
	ZERO? STACK \TRUE
	ZERO? LEVEL \?L8
	FSET? OBJ,TOUCHBIT /?L5
	GETP OBJ,P?FDESC >STR
	ZERO? STR \?L4
?L5:	GETP OBJ,P?LDESC >STR
	ZERO? STR /?L3
?L4:	PRINT STR
	JUMP ?L28
?L3:	ZERO? LEVEL \?L8
	PRINTI "There is a "
	PRINTD OBJ
	PRINTI " here."
	JUMP ?L28
?L8:	GET INDENTS,LEVEL >STACK
	PRINT STACK
	PRINTI "A "
	PRINTD OBJ
	FSET? OBJ,WEARBIT \?L16
	PRINTI " (being worn)"
	JUMP ?L28
?L16:	EQUAL? OBJ,SAFETY-LINE \?L28
	ZERO? THIS-END /?L25
	ZERO? THAT-END /?L21
	PRINTI " (connecting the suit and a hook)"
	JUMP ?L28
?L21:	ZERO? THIS-END /?L25
	PRINTI " (tied to the suit)"
	JUMP ?L28
?L25:	ZERO? THAT-END /?L28
	PRINTI " (tied to a hook)"
?L28:	ZERO? LEVEL \?L33
	LOC WINNER >AV
	ZERO? AV /?L33
	FSET? AV,VEHBIT \?L33
	PRINTI " (outside the "
	PRINTD AV
	PRINTI ")"
?L33:	CRLF
	CALL SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /FALSE
	FIRST? OBJ >STACK \FALSE
	CALL PRINT-CONT,OBJ,V?,LEVEL >STACK
	RSTACK

	.FUNCT PRINT-CONT,OBJ,V?=0,LEVEL=0,Y,1ST?,AV,STR,PV?=0,INV?=0
	FIRST? OBJ >Y \TRUE
	LOC WINNER >AV
	ZERO? AV /?L4
	FSET? AV,VEHBIT /?L6
?L4:	SET 'AV,0
?L6:	SET '1ST?,1
	LOC OBJ >STACK
	EQUAL? WINNER,OBJ,STACK \?L7
	SET 'INV?,1
	JUMP ?L11
?L7:	ZERO? Y \?L12
?L58:	ZERO? 1ST? \?L14
	PUSH 1
	JUMP ?L11
?L14:	PUSH 0
	JUMP ?L11
?L12:	EQUAL? Y,AV \?L16
	SET 'PV?,1
	JUMP ?L24
?L16:	EQUAL? Y,WINNER /?L24
	FSET? Y,INVISIBLE /?L24
	FSET? Y,TOUCHBIT /?L24
	GETP Y,P?FDESC >STR
	ZERO? STR /?L24
	FSET? Y,NDESCBIT /?L19
	PRINT STR
	CRLF
?L19:	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L24
	LOC Y >STACK
	GETP STACK,P?DESCFCN >STACK
	ZERO? STACK \?L24
	FIRST? Y >STACK \?L24
	CALL PRINT-CONT,Y,V?,0
?L24:	NEXT? Y >Y /?L12
	JUMP ?L58
?L11:	FIRST? OBJ >Y /?L32
?L57:	ZERO? PV? /?L34
	ZERO? AV /?L34
	FIRST? AV >STACK \?L34
	CALL PRINT-CONT,AV,V?,LEVEL
?L34:	ZERO? 1ST? \FALSE
	RTRUE
?L32:	EQUAL? Y,AV,ADVENTURER /?L53
	FSET? Y,INVISIBLE /?L53
	ZERO? INV? \?L41
	FSET? Y,TOUCHBIT /?L41
	GETP Y,P?FDESC >STACK
	ZERO? STACK \?L53
?L41:	FSET? Y,NDESCBIT /?L42
	ZERO? 1ST? /?L44
	CALL FIRSTER,OBJ,LEVEL >STACK
	ZERO? STACK /?L48
	LESS? LEVEL,0 \?L48
	SET 'LEVEL,0
?L48:	INC 'LEVEL
	SET '1ST?,0
?L44:	CALL DESCRIBE-OBJECT,Y,V?,LEVEL
	JUMP ?L53
?L42:	FIRST? Y >STACK \?L53
	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L53
	CALL PRINT-CONT,Y,V?,LEVEL
?L53:	NEXT? Y >Y /?L32
	JUMP ?L57

	.FUNCT FIRSTER,OBJ,LEVEL
	EQUAL? OBJ,WINNER \?L1
	PRINTR "You are carrying:"
?L1:	IN? OBJ,ROOMS /?L5
	GRTR? LEVEL,0 \?L6
	GET INDENTS,LEVEL >STACK
	PRINT STACK
?L6:	EQUAL? OBJ,TRASH-BIN \?L11
	PRINTR "Among the trash near the top of the bin you see:"
?L11:	FSET? OBJ,SURFACEBIT \?L15
	PRINTI "Sitting on the "
	PRINTD OBJ
	PRINTR " is:"
?L15:	PRINTI "The "
	PRINTD OBJ
	PRINTR " contains:"
?L5:	FSET? OBJ,RMUNGBIT \FALSE
	PRINTR "Floating nearby is: "

	.FUNCT SCORE-UPD,NUM
	ADD SCORE,NUM >SCORE
	RTRUE

	.FUNCT SCORE-OBJ,OBJ
	GETP OBJ,P?VALUE >STACK
	GRTR? STACK,0 \FALSE
	FSET OBJ,TOUCHBIT
	GETP OBJ,P?VALUE >STACK
	CALL SCORE-UPD,STACK
	PUTP OBJ,P?VALUE,0
	RTRUE

	.FUNCT V-SCORE,ASK?=1
	PRINTI "Your score "
	ZERO? ASK? /?L3
	PRINTI "would be "
	JUMP ?L7
?L3:	PRINTI "is "
?L7:	PRINTN SCORE
	PRINTI " (total of "
	PRINTN SCORE-MAX
	PRINTI " points), in "
	PRINTN MOVES
	EQUAL? MOVES,1 \?L20
	PRINTI " move."
	JUMP ?L24
?L20:	PRINTI " moves."
?L24:	CRLF
	PRINTI "This score gives you the rank of "
	ZERO? WON-FLAG /?L29
	PRINTI "Galactic Overlord"
	JUMP ?L51
?L29:	GRTR? SCORE,360 \?L33
	PRINTI "Cluster Admiral"
	JUMP ?L51
?L33:	GRTR? SCORE,320 \?L36
	PRINTI "System Captain"
	JUMP ?L51
?L36:	GRTR? SCORE,240 \?L39
	PRINTI "Planetary Commodore"
	JUMP ?L51
?L39:	GRTR? SCORE,160 \?L42
	PRINTI "Lieutenant"
	JUMP ?L51
?L42:	GRTR? SCORE,80 \?L45
	PRINTI "Ensign"
	JUMP ?L51
?L45:	GRTR? SCORE,40 \?L48
	PRINTI "Space Cadet"
	JUMP ?L51
?L48:	PRINTI "Beginner"
?L51:	PRINTI "."
	CRLF
	RETURN SCORE

	.FUNCT FINISH
	CALL V-SCORE
	PRINTI "[EVENT: GAME OVER]"
	QUIT

	.FUNCT V-QUIT,ASK?=1,SCOR
	CALL V-SCORE
	ZERO? ASK? /?L3
	PRINTI "Do you wish to leave the game? (Y is affirmative): "
	CALL YES? >STACK
	ZERO? STACK \?L3
	ZERO? ASK? \?L1
?L3:	QUIT
?L1:	PRINTR "Ok."

	.FUNCT YES?
	PRINTI ">"
	READ P-INBUF,P-LEXV
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?YES,W?Y \FALSE
	RTRUE

	.FUNCT V-VERSION,CNT=17
	PRINTI "STARCROSS
Infocom interactive fiction - a science-fiction story
Copyright (c) 1982 by Infocom, Inc. All rights reserved.
STARCROSS is a registered trademark of Infocom, Inc.
Release "
	GET 0,1 >STACK
	BAND STACK,2047 >STACK
	PRINTN STACK
	PRINTI " / Serial number "
?L5:	IGRTR? 'CNT,23 /?L6
	GETB 0,CNT >STACK
	PRINTC STACK
	JUMP ?L5
?L6:	CRLF
	RTRUE

	.FUNCT V-AGAIN,CONT,LEXV,INBUF,V
	SET 'LEXV,T?149
	SET 'INBUF,T?150
	ZERO? P-LEN \?L1
	SET 'CONT,0
	JUMP ?L3
?L1:	SET 'CONT,P-CONT
?L3:	CALL TABLE-COPY,P-LEXV,LEXV,60
	CALL TABLE-COPY,P-INBUF,INBUF,50
	CALL TABLE-COPY,A-LEXV,P-LEXV,60
	CALL TABLE-COPY,A-INBUF,P-INBUF,50
	SET 'P-CONT,A-PTR
	SET 'NOT-AGAIN,0
	CALL MAIN-LOOP >V
	SET 'NOT-AGAIN,1
	SET 'PRSA,V?AGAIN
	EQUAL? V,M-FATAL \?L4
	SET 'P-CONT,0
	JUMP ?L6
?L4:	SET 'P-CONT,CONT
?L6:	CALL TABLE-COPY,LEXV,P-LEXV,60
	CALL TABLE-COPY,INBUF,P-INBUF,50
	RETURN V

	.FUNCT JIGS-UP,DESC,PLAYER?=0
	PRINT DESC
	CRLF
	CALL SCORE-UPD,-10
	PRINTI " 
   ****  You have died  **** 

"
	INC 'DEATHS
	EQUAL? DEATHS,4 \?L7
	ZERO? DOCKED? /?L9
	PRINTI "The expressionless voice seems despairing. ""Four failures. They would not be pleased. Such promising candidates, too. If only..."" The voice trails off into background hiss. Nothing more happens, ever."
	CRLF
	JUMP ?L13
?L9:	PRINTI "This time, you aren't given another chance."
	CRLF
?L13:	CALL FINISH
	JUMP ?L16
?L7:	GRTR? POISON-COUNT,3 \?L16
	PRINTI "An expressionless voice seems to be trying to express outrage, but not successfully. ""The candidate has not made the necessary repairs in time. This is a disaster. All are now dead, and repairs are not possible. They would not approve. This area will be marked, that is certain."" Everything fades to black, and silence reigns."
	CRLF
	CALL FINISH
?L16:	CALL RANDOMIZE-OBJECTS
	FSET? RED-THREE,TOUCHBIT \?L20
	MOVE WINNER,RED-THREE
	JUMP ?L22
?L20:	SET 'IN-ARTIFACT?,0
	FCLEAR AIRLOCK-OUTER,OPENBIT
	FCLEAR AIRLOCK-INNER,OPENBIT
	MOVE WINNER,SPACESHIP-BRIDGE
	MOVE SPACESUIT,SPACESHIP-STORES
?L22:	ZERO? DOCKED? /?L23
	PRINTI "You hear, if that is the right word, an expressionless voice. It seems to be inside your head. ""This is not promising. The candidate does not deserve another chance, but the instructions are explicit. There are not even any more docking ports. They would be disappointed if they knew."" You wake to a brief glimpse of a pallet (on which you are lying) surrounded by metallic threads. The whole apparatus begins to vibrate and you feel very dizzy. As you lose consciousness, you realize that you can't see the rest of your body. There is a feeling of dislocation, and then..."
	CRLF
	JUMP ?L27
?L23:	PRINTI "You wake to find yourself alive, on board the ""Starcross."" It appears you have been given another chance."
	CRLF
?L27:	SET 'LIT,1
	FCLEAR SPACESUIT,WEARBIT
	SET 'SUIT-ON?,0
	SET 'THIS-END,0
	SET 'THAT-END,0
	SET 'P-CONT,0
	SET 'COUNTDOWN,0
	SET 'R-VALUE,0
	SET 'PHI-VALUE,0
	SET 'THETA-VALUE,0
	SET 'LOST,0
	SET 'GIVE-UP,0
	CALL KILL-INTERRUPTS
	RETURN 2

	.FUNCT RANDOMIZE-OBJECTS,R=0,F,N,L
	FIRST? WINNER >N /?L1
?L1:	SET 'F,N
	ZERO? F /TRUE
	NEXT? F >N /?L7
?L7:	FSET? RED-THREE,TOUCHBIT \?L8
	FSET? F,KEYBIT \?L10
	MOVE F,HERE
	JUMP ?L1
?L10:	MOVE F,RED-LOCK
	JUMP ?L1
?L8:	FSET? F,KEYBIT \?L14
	MOVE F,HERE
	JUMP ?L1
?L14:	MOVE F,SPACESHIP-STORES
	JUMP ?L1

	.FUNCT KILL-INTERRUPTS
	CALL INT,I-BURN >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT V-RESTORE
	RESTORE \?L1
	PRINTI "Ok."
	CRLF
	CALL V-FIRST-LOOK >STACK
	RSTACK
?L1:	PRINTR "Failed."

	.FUNCT V-SAVE
	SAVE \?L1
	PRINTR "Ok."
?L1:	PRINTR "Failed."

	.FUNCT V-RESTART
	CALL V-SCORE,1
	PRINTI "Do you wish to restart? (Y is affirmative): "
	CALL YES? >STACK
	ZERO? STACK /FALSE
	PRINTI "Restarting."
	CRLF
	RESTART

	.FUNCT V-WALK-AROUND
	PRINTR "Use directions for movement here."

	.FUNCT V-LAUNCH
	PRINTR "You can't launch that!"

	.FUNCT GO-NEXT,TBL,VAL
	CALL LKP,HERE,TBL >VAL
	ZERO? VAL /FALSE
	CALL GOTO,VAL >STACK
	RSTACK

	.FUNCT LKP,ITM,TBL,CNT=0,LEN
	GET TBL,0 >LEN
?L1:	IGRTR? 'CNT,LEN /FALSE
	GET TBL,CNT >STACK
	EQUAL? STACK,ITM \?L1
	EQUAL? CNT,LEN /FALSE
	ADD CNT,1 >STACK
	GET TBL,STACK >STACK
	RSTACK

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	ZERO? P-WALK-DIR \?L1
	CALL PERFORM,V?WALK-TO,PRSO
	RTRUE
?L1:	GETPT HERE,PRSO >PT
	ZERO? PT /?L3
	PTSIZE PT >PTS
	EQUAL? PTS,UEXIT \?L4
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L4:	EQUAL? PTS,NEXIT \?L6
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L6:	EQUAL? PTS,FEXIT \?L11
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L12
	CALL GOTO,RM >STACK
	RSTACK
?L12:	RETURN 2
?L11:	EQUAL? PTS,CEXIT \?L17
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L18
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L18:	GET PT,CEXITSTR >STR
	ZERO? STR /?L20
	PRINT STR
	CRLF
	RETURN 2
?L20:	PRINTI "You can't go that way."
	CRLF
	RETURN 2
?L17:	EQUAL? PTS,DEXIT \FALSE
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L31
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L31:	GET PT,DEXITSTR >STR
	ZERO? STR /?L33
	PRINT STR
	CRLF
	RETURN 2
?L33:	PRINTI "The "
	PRINTD OBJ
	PRINTI " is closed."
	CRLF
	CALL THIS-IS-IT,OBJ
	RETURN 2
?L3:	ZERO? LIT \?L44
	RANDOM 100 >STACK
	GRTR? 75,STACK \?L44
	CALL PRINT-ID,STR?14
	CALL JIGS-UP,STR?15 >STACK
	RSTACK
?L44:	PRINTI "You can't go that way."
	CRLF
	RETURN 2

	.FUNCT THIS-IS-IT,OBJ
	SET 'P-IT-OBJECT,OBJ
	SET 'P-IT-LOC,HERE
	RETURN P-IT-LOC

	.FUNCT V-INVENTORY
	FIRST? WINNER >STACK \?L1
	CALL PRINT-CONT,WINNER >STACK
	RSTACK
?L1:	PRINTR "You are empty handed."

	.FUNCT PRE-TAKE
	IN? PRSO,WINNER \?L1
	PRINTR "You already have it."
?L1:	LOC PRSO >STACK
	FSET? STACK,CONTBIT \?L5
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L5
	PRINTR "I can't reach that."
?L5:	ZERO? PRSI /?L8
	EQUAL? PRSO,SPEAR /?L8
	LOC PRSO >STACK
	EQUAL? PRSI,STACK /?L9
	PRINTR "It's not in that!"
?L9:	SET 'PRSI,0
	RFALSE
?L8:	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	PRINTR "You are in it, loser!"

	.FUNCT V-TAKE
	CALL ITAKE >STACK
	EQUAL? STACK,1 \FALSE
	PRINTI "Taken."
	CRLF
	CALL IS-THEFT? >STACK
	CALL PRINT-ID,STR?16,STACK >STACK
	RSTACK

	.FUNCT TRYTAKE
	IN? PRSO,WINNER /TRUE
	FSET? PRSO,TRYTAKEBIT \?L3
	GETP PRSO,P?ACTION >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?TAKE,PRSO
	IN? PRSO,WINNER /TRUE
	RFALSE
?L3:	CALL ITAKE >STACK
	RSTACK

	.FUNCT ITAKE,VB=1,CNT,OBJ,WLOC,?TMP
	FSET? PRSO,TAKEBIT /?L1
	ZERO? VB /FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RFALSE
?L1:	LOC PRSO >STACK
	IN? STACK,WINNER /?L8
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,WINNER >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,LOAD-ALLOWED \?L8
	ZERO? VB /?L9
	PRINTI "Your load is too heavy."
	CRLF
?L9:	RETURN 2
?L8:	CALL CCOUNT,WINNER >CNT
	GRTR? CNT,FUMBLE-NUMBER \?L16
	MUL CNT,FUMBLE-PROB >?TMP
	RANDOM 100 >STACK
	GRTR? ?TMP,STACK \?L16
	FIRST? WINNER >OBJ /?L17
?L17:	NEXT? OBJ >OBJ /?L18
?L18:	PRINTI "Oh, no. The "
	PRINTD OBJ
	PRINTI " slips from your arms while taking the "
	PRINTD PRSO
	PRINTI " and both tumble to the floor."
	CRLF
	LOC WINNER >WLOC
	EQUAL? PRSO,UNDER-GLOBE \?L21
	SET 'UNDER-GLOBE,0
	FCLEAR PRSO,NDESCBIT
?L21:	FSET? WLOC,RMUNGBIT /?L26
	EQUAL? WLOC,UP-A-TREE,TREETOP-ROOM,DRIVE-BUBBLE-ENTRANCE /?L26
	EQUAL? WLOC,CONTROL-BUBBLE-ENTRANCE \?L24
?L26:	CALL PERFORM,V?DROP,OBJ
	MOVE PRSO,WINNER
	CALL PERFORM,V?DROP,PRSO
	RETURN 2
?L24:	MOVE OBJ,WLOC
	MOVE PRSO,WLOC
	RETURN 2
?L16:	MOVE PRSO,WINNER
	FCLEAR PRSO,NDESCBIT
	CALL SCORE-OBJ,PRSO
	FSET PRSO,TOUCHBIT
	RTRUE

	.FUNCT PRE-PUT
	IN? PRSO,GLOBAL-OBJECTS /?L3
	FSET? PRSO,TAKEBIT /FALSE
?L3:	PRINTR "Nice try."

	.FUNCT V-PUT,?TMP
	FSET? PRSI,OPENBIT /?L7
	FSET? PRSI,DOORBIT /?L4
	FSET? PRSI,CONTBIT /?L4
	FSET? PRSI,VEHBIT /?L4
	PRINTR "I can't do that."
?L4:	FSET? PRSI,OPENBIT /?L7
	PRINTI "The "
	PRINTD PRSI
	PRINTR " isn't open."
?L7:	EQUAL? PRSI,PRSO \?L11
	PRINTR "How can you do that?"
?L11:	IN? PRSO,PRSI \?L14
	PRINTI "The "
	PRINTD PRSO
	PRINTI " is already in the "
	PRINTD PRSI
	PRINTR "."
?L14:	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \?L17
	PRINTR "There's no room."
?L17:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L20
	CALL TRYTAKE >STACK
	ZERO? STACK /TRUE
?L20:	CALL SCORE-OBJ,PRSO
	MOVE PRSO,PRSI
	FSET PRSO,TOUCHBIT
	PRINTR "Done."

	.FUNCT PRE-DROP
	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE

	.FUNCT PRE-SZAP
	CALL PERFORM,V?ZAP,PRSI,PRSO
	RTRUE

	.FUNCT PRE-ZAP
	ZERO? PRSI \FALSE
	FSET? PRSO,WEAPONBIT /FALSE
	IN? ZAP-GUN,WINNER \?L4
	CALL PERFORM,V?ZAP,ZAP-GUN,PRSO
	RTRUE
?L4:	PRINTI "You have nothing to shoot the "
	PRINTD PRSO
	PRINTR " with."

	.FUNCT DONT-HAVE,OBJ
	PRINTI "You don't have the "
	PRINTD OBJ
	PRINTR "."

	.FUNCT V-ZAP
	IN? PRSO,WINNER /?L1
	CALL DONT-HAVE,PRSO >STACK
	RSTACK
?L1:	FSET? PRSO,WEAPONBIT /?L3
	PRINTI "You can't use a "
	PRINTD PRSO
	PRINTR " as a ray gun!"
?L3:	ZERO? PRSI \?L6
	PRINTR "At what?"
?L6:	PRINTR "Nothing happens."

	.FUNCT V-SZAP
	PRINTR "ZAPPP!!"

	.FUNCT PRE-GIVE
	CALL HELD?,PRSO >STACK
	ZERO? STACK \FALSE
	PRINTR "That's easy for you to say since you don't even have it."

	.FUNCT PRE-SGIVE
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT V-GIVE
	FSET? PRSI,VICBIT /?L1
	PRINTI "You can't give a "
	PRINTD PRSO
	PRINTI " to a "
	PRINTD PRSI
	PRINTR "!"
?L1:	CALL IDROP >STACK
	ZERO? STACK /FALSE
	PRINTR "Given."

	.FUNCT V-SGIVE
	PRINTR "FOOOO!!"

	.FUNCT V-DROP
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	PRINTR "Dropped."

	.FUNCT V-THROW
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	PRINTR "Thrown."

	.FUNCT IDROP
	LOC PRSO >STACK
	EQUAL? STACK,GLOBAL-OBJECTS,LOCAL-GLOBALS \?L1
	PRINTI "You can't throw that."
	CRLF
	RFALSE
?L1:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L5
	PRINTI "You're not carrying the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	RFALSE
?L5:	IN? PRSO,WINNER /?L8
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L8
	PRINTI "The "
	PRINTD PRSO
	PRINTI " is closed."
	CRLF
	RFALSE
?L8:	LOC WINNER >STACK
	MOVE PRSO,STACK
	RTRUE

	.FUNCT ALREADY,ON-OFF,OBJ=0
	ZERO? OBJ /?L1
	PRINTI "The "
	PRINTD OBJ
	PRINTI " is "
	JUMP ?L5
?L1:	PRINTI "It's "
?L5:	PRINTI "already "
	PRINT ON-OFF
	PRINTR "."

	.FUNCT V-OPEN,F,STR
	FSET? PRSO,CONTBIT /?L1
	PRINTI "You must be very clever to do that to the "
	PRINTD PRSO
	PRINTR "."
?L1:	FSET? PRSO,DOORBIT /?L6
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L5
?L6:	FSET? PRSO,OPENBIT \?L7
	CALL ALREADY,STR?17 >STACK
	RSTACK
?L7:	FSET PRSO,OPENBIT
	FSET? PRSO,DOORBIT \?L10
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is now open."
?L10:	FIRST? PRSO >STACK \?L15
	FSET? PRSO,TRANSBIT \?L14
?L15:	PRINTR "Opened."
?L14:	FIRST? PRSO >F \?L18
	NEXT? F >STACK /?L18
	GETP F,P?FDESC >STR
	ZERO? STR /?L18
	PRINTI "The "
	PRINTD PRSO
	PRINTI " opens."
	CRLF
	PRINT STR
	CRLF
	RTRUE
?L18:	PRINTI "Opening the "
	PRINTD PRSO
	PRINTI " reveals "
	CALL PRINT-CONTENTS,PRSO
	PRINTR "."
?L5:	PRINTI "The "
	PRINTD PRSO
	PRINTR " cannot be opened."

	.FUNCT PRINT-CONTENTS,OBJ,F,N,1ST?=1
	FIRST? OBJ >F \FALSE
?L3:	NEXT? F >N /?L5
?L5:	ZERO? 1ST? /?L6
	SET '1ST?,0
	JUMP ?L11
?L6:	PRINTI ", "
	ZERO? N \?L11
	PRINTI "and "
?L11:	PRINTI "a "
	PRINTD F
	SET 'F,N
	ZERO? F \?L3
	RTRUE

	.FUNCT V-CLOSE
	FSET? PRSO,CONTBIT /?L1
	PRINTI "You must tell me how to do that to a "
	PRINTD PRSO
	PRINTR "."
?L1:	FSET? PRSO,SURFACEBIT /?L5
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK \?L6
	FSET? PRSO,DOORBIT \?L5
?L6:	FSET? PRSO,OPENBIT \?L7
	FCLEAR PRSO,OPENBIT
	PRINTR "Closed."
?L7:	CALL ALREADY,STR?18 >STACK
	RSTACK
?L5:	PRINTR "You cannot close that."

	.FUNCT CCOUNT,OBJ,CNT=0,X
	FIRST? OBJ >X \?L4
?L3:	INC 'CNT
	NEXT? X >X /?L3
?L4:	RETURN CNT

	.FUNCT WEIGHT,OBJ,CONT,WT=0
	FIRST? OBJ >CONT \?L4
?L3:	CALL WEIGHT,CONT >STACK
	ADD WT,STACK >WT
	NEXT? CONT >CONT /?L3
?L4:	GETP OBJ,P?SIZE >STACK
	ADD WT,STACK >STACK
	RSTACK

	.FUNCT V-SCRIPT
	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	PRINTI "Here begins"
	PRINT COPR-NOTICE
	CRLF
	RTRUE

	.FUNCT V-UNSCRIPT
	PRINTI "Here ends"
	PRINT COPR-NOTICE
	CRLF
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT PRE-MOVE
	CALL HELD?,PRSO >STACK
	ZERO? STACK /FALSE
	PRINTR "I don't juggle objects!"

	.FUNCT V-MOVE
	FSET? PRSO,TAKEBIT \?L1
	PRINTI "Moving the "
	PRINTD PRSO
	PRINTR " reveals nothing."
?L1:	PRINTI "You can't move the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-LAMP-ON
	FSET? PRSO,LIGHTBIT \?L1
	FSET? PRSO,ONBIT \?L3
	CALL ALREADY,STR?19
	RTRUE
?L3:	FSET PRSO,ONBIT
	PRINTI "The "
	PRINTD PRSO
	PRINTI " is now on."
	CRLF
	ZERO? LIT \TRUE
	CALL LIT?,HERE >LIT
	CALL V-LOOK
	RTRUE
?L1:	PRINTR "You can't turn that on."

	.FUNCT V-LAMP-OFF
	FSET? PRSO,LIGHTBIT \?L1
	FSET? PRSO,ONBIT /?L3
	CALL ALREADY,STR?20
	RTRUE
?L3:	FCLEAR PRSO,ONBIT
	ZERO? LIT /?L6
	CALL LIT?,HERE >LIT
?L6:	PRINTI "The "
	PRINTD PRSO
	PRINTI " is now off."
	CRLF
	CALL LIT?,HERE >LIT
	ZERO? LIT \TRUE
	PRINTR "It is now pitch black."
?L1:	PRINTR "You can't turn that off."

	.FUNCT V-WAIT,NUM=3
	PRINTI "Time passes..."
	CRLF
?L3:	DLESS? 'NUM,0 /?L4
	CALL CLOCKER >STACK
	ZERO? STACK \?L4
	INC 'MOVES
	JUMP ?L3
?L4:	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT

	.FUNCT PRE-BOARD,AV
	LOC WINNER >AV
	FSET? PRSO,VEHBIT \?L1
	FSET? AV,VEHBIT \FALSE
	PRINTI "You are already in it!"
	CRLF
	RETURN 2
?L1:	EQUAL? PRSO,SPACESUIT,JUNK-SPACESUIT,MOUSE /FALSE
	PRINTI "I suppose you have a theory on boarding a "
	PRINTD PRSO
	PRINTI "."
	CRLF
	RETURN 2

	.FUNCT V-BOARD,AV
	PRINTI "You are now in the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	MOVE WINNER,PRSO
	GETP PRSO,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	RTRUE

	.FUNCT V-DISEMBARK
	LOC WINNER >STACK
	EQUAL? STACK,PRSO /?L1
	PRINTI "You're not in that!"
	CRLF
	RETURN 2
?L1:	PRINTI "You are on your own feet again."
	CRLF
	MOVE WINNER,HERE
	RTRUE

	.FUNCT GOTO,RM,V?=1,WLOC,OLIT
	LOC WINNER >WLOC
	SET 'OLIT,LIT
	MOVE WINNER,RM
	SET 'MFOLLOW,0
	SET 'CHFOLLOW,0
	SET 'HERE,RM
	CALL LIT?,HERE >LIT
	ZERO? OLIT \?L1
	ZERO? LIT \?L1
	RANDOM 100 >STACK
	GRTR? 75,STACK \?L1
	CALL PRINT-ID,STR?21
	CALL JIGS-UP,STR?22
	RTRUE
?L1:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	EQUAL? STACK,2 /TRUE
	EQUAL? ADVENTURER,WINNER /?L7
	PRINTI "The "
	PRINTD WINNER
	PRINTI " leaves the room."
	CRLF
	JUMP ?L11
?L7:	ZERO? V? /?L11
	CALL V-FIRST-LOOK
?L11:	CALL SCORE-OBJ,RM
	RTRUE

	.FUNCT V-DRINK
	CALL V-EAT >STACK
	RSTACK

	.FUNCT V-EAT
	PRINTI "I don't think that the "
	PRINTD PRSO
	PRINTI " would agree with you."
	CRLF
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?23,STACK >STACK
	RSTACK

	.FUNCT V-CURSES
	CALL PRINT-ID,STR?24
	ZERO? PRSO /?L1
	FSET? PRSO,VILLAIN \?L3
	PRINTR "Insults won't help you."
?L3:	PRINTR "What a loony!"
?L1:	PRINTR "Such language in a high-class establishment like this!"

	.FUNCT V-LISTEN
	PRINTI "The "
	PRINTD PRSO
	PRINTR " makes no sound."

	.FUNCT V-FOLLOW
	PRINTR "You're nuts!"

	.FUNCT V-LEAP,TX,S
	ZERO? PRSO /?L1
	IN? PRSO,HERE \?L3
	FSET? PRSO,VILLAIN \?L5
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is too big to jump over."
?L5:	CALL V-SKIP >STACK
	RSTACK
?L3:	PRINTR "That would be a good trick."
?L1:	GETPT HERE,P?DOWN >TX
	ZERO? TX /?L13
	PTSIZE TX >S
	EQUAL? S,2 /?L16
	EQUAL? S,4 \?L14
	GETB TX,1 >STACK
	VALUE STACK >STACK
	ZERO? STACK \?L14
?L16:	PRINTI "This was not a safe place to try jumping."
	CRLF
	CALL PRINT-ID,STR?25
	CALL JIGS-UP,STR?26 >STACK
	RSTACK
?L14:	CALL V-SKIP >STACK
	RSTACK
?L13:	CALL V-SKIP >STACK
	RSTACK

	.FUNCT V-SKIP
	CALL PICK-ONE,WHEEEEE >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-LEAVE
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-HELLO
	ZERO? PRSO /?L1
	PRINTI "Only schizophrenics say ""Hello"" to a "
	PRINTD PRSO
	PRINTR "."
?L1:	CALL PICK-ONE,HELLOS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT PRE-READ
	RFALSE

	.FUNCT V-READ
	FSET? PRSO,READBIT /?L1
	PRINTI "How can I read a "
	PRINTD PRSO
	PRINTR "?"
?L1:	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-LOOK-UNDER
	PRINTR "There is nothing but dust there."

	.FUNCT V-LOOK-BEHIND
	CALL V-LOOK-UNDER >STACK
	RSTACK

	.FUNCT V-LOOK-INSIDE
	FSET? PRSO,DOORBIT \?L1
	FSET? PRSO,OPENBIT \?L3
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is open, but I can't tell what's beyond it."
?L3:	PRINTI "The "
	PRINTD PRSO
	PRINTR " is closed."
?L1:	FSET? PRSO,CONTBIT \?L10
	FSET? PRSO,VICBIT \?L11
	PRINTR "There is nothing special to be seen."
?L11:	CALL SEE-INSIDE?,PRSO >STACK
	ZERO? STACK /?L15
	FIRST? PRSO >STACK \?L16
	CALL PRINT-CONT,PRSO >STACK
	ZERO? STACK \TRUE
?L16:	FSET? PRSO,SURFACEBIT \?L18
	PRINTI "There is nothing on the "
	PRINTD PRSO
	PRINTR "."
?L18:	PRINTI "The "
	PRINTD PRSO
	PRINTR " is empty."
?L15:	PRINTI "The "
	PRINTD PRSO
	PRINTR " is closed."
?L10:	FSET? PRSO,TRANSBIT \?L27
	PRINTI "You can see dimly through the "
	PRINTD PRSO
	PRINTR "."
?L27:	PRINTI "I don't know how to look inside a "
	PRINTD PRSO
	PRINTR "."

	.FUNCT SEE-INSIDE?,OBJ
	FSET? OBJ,INVISIBLE /FALSE
	FSET? OBJ,TRANSBIT /TRUE
	FSET? OBJ,OPENBIT /TRUE
	RFALSE

	.FUNCT PRE-TURN
	FSET? PRSO,TURNBIT /?L1
	PRINTR "You can't turn that!"
?L1:	FSET? PRSI,TOOLBIT /FALSE
	PRINTI "You can't turn it with a "
	PRINTD PRSI
	PRINTR "."

	.FUNCT V-TURN
	PRINTR "That doesn't work."

	.FUNCT V-LOCK
	CALL V-TURN >STACK
	RSTACK

	.FUNCT V-PICK
	CALL V-TURN >STACK
	RSTACK

	.FUNCT V-UNLOCK
	CALL V-TURN >STACK
	RSTACK

	.FUNCT V-KILL
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?27,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?28,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?29,STACK
	CALL IKILL,STR?30 >STACK
	RSTACK

	.FUNCT IKILL,STR
	ZERO? PRSO \?L1
	PRINTI "There is nothing here to "
	PRINT STR
	PRINTR "."
?L1:	FSET? PRSO,VILLAIN /?L5
	FSET? PRSO,VICBIT /?L5
	PRINTI "I've known strange people, but fighting a "
	PRINTD PRSO
	PRINTR "?"
?L5:	ZERO? PRSI /?L9
	EQUAL? PRSI,HANDS \?L8
?L9:	CALL FUTILE,STR >STACK
	RSTACK
?L8:	FSET? PRSI,WEAPONBIT /?L10
	PRINTI "Trying to "
	PRINT STR
	PRINTI " the "
	PRINTD PRSO
	PRINTI " with a "
	PRINTD PRSI
	PRINTR " is futile."
?L10:	PRINTR "You can't."

	.FUNCT V-ATTACK,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?31,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?32,STACK
	CALL IKILL,STR?33 >STACK
	RSTACK

	.FUNCT V-KICK,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?34,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?35,STACK
	CALL HACK-HACK,STR?36 >STACK
	RSTACK

	.FUNCT V-WAVE
	CALL HACK-HACK,STR?37 >STACK
	RSTACK

	.FUNCT V-RAISE
	CALL HACK-HACK,STR?38 >STACK
	RSTACK

	.FUNCT V-LOWER
	CALL HACK-HACK,STR?38 >STACK
	RSTACK

	.FUNCT V-RUB
	CALL HACK-HACK,STR?39 >STACK
	RSTACK

	.FUNCT V-PUSH
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?40,STACK
	CALL HACK-HACK,STR?41 >STACK
	RSTACK

	.FUNCT PRE-MUNG,?TMP
	FSET? PRSO,VICBIT /?L1
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L4
	PUSH ?TMP
	JUMP ?L7
?L4:	CALL IS-OBJ-PROP-ANIMAL? >?TMP
	ZERO? ?TMP /?L5
	PUSH ?TMP
	JUMP ?L7
?L5:	EQUAL? PRSO,MARS /?L6
	PUSH 0
	JUMP ?L7
?L6:	PUSH 1
?L7:	CALL PRINT-ID,STR?42,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?43,STACK
	CALL HACK-HACK,STR?44 >STACK
	RSTACK
?L1:	ZERO? PRSI \FALSE
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L10
	PUSH ?TMP
	JUMP ?L13
?L10:	CALL IS-OBJ-PROP-ANIMAL? >?TMP
	ZERO? ?TMP /?L11
	PUSH ?TMP
	JUMP ?L13
?L11:	EQUAL? PRSO,MARS /?L12
	PUSH 0
	JUMP ?L13
?L12:	PUSH 1
?L13:	CALL PRINT-ID,STR?45,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?46,STACK
	CALL FUTILE,STR?47 >STACK
	RSTACK

	.FUNCT FUTILE,STR
	PRINTI "Trying to "
	PRINT STR
	PRINTI " a "
	PRINTD PRSO
	PRINTR " with your bare hands is futile."

	.FUNCT V-MUNG,?TMP
	FSET? PRSO,KEYBIT \?L1
	CALL PRINT-ID,STR?48
	REMOVE PRSO
	PRINTR "It shatters and disappears."
?L1:	PRINTI "You can't."
	CRLF
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L9
	PUSH ?TMP
	JUMP ?L12
?L9:	CALL IS-OBJ-PROP-ANIMAL? >?TMP
	ZERO? ?TMP /?L10
	PUSH ?TMP
	JUMP ?L12
?L10:	EQUAL? PRSO,MARS /?L11
	PUSH 0
	JUMP ?L12
?L11:	PUSH 1
?L12:	CALL PRINT-ID,STR?49,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?50,STACK >STACK
	RSTACK

	.FUNCT HACK-HACK,STR
	PRINT STR
	PRINTD PRSO
	CALL PICK-ONE,HO-HUM >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT WORD-TYPE,OBJ,WORD,SYNS
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,WORD,SYNS,STACK >STACK
	RSTACK

	.FUNCT V-KNOCK
	CALL WORD-TYPE,PRSO,W?DOOR >STACK
	ZERO? STACK /?L1
	PRINTR "Nobody's home."
?L1:	PRINTI "Why knock on a "
	PRINTD PRSO
	PRINTR "?"

	.FUNCT V-FROBOZZ
	PRINTR "The FROBOZZ Corporation sponsored this expedition."

	.FUNCT V-YELL
	PRINTI "Aarrrrggggggghhhhhhhh!"
	CRLF
	CALL PRINT-ID,STR?51 >STACK
	RSTACK

	.FUNCT V-PLUG
	PRINTR "This has no effect."

	.FUNCT V-SHAKE,X
	FSET? PRSO,VILLAIN \?L1
	PRINTR "This seems to have no effect."
?L1:	FSET? PRSO,OPENBIT /?L17
	FIRST? PRSO >STACK \?L5
	PRINTI "It sounds like there is something inside the "
	PRINTD PRSO
	PRINTR "."
?L5:	FSET? PRSO,OPENBIT \FALSE
?L17:	FIRST? PRSO >STACK \FALSE
?L9:	FIRST? PRSO >X \?L10
	MOVE X,HERE
	JUMP ?L9
?L10:	PRINTR "All of the objects spill onto the floor."

	.FUNCT V-DIG
	PRINTR "What a silly idea!"

	.FUNCT V-SMELL
	ZERO? SUIT-ON? /?L1
	SET 'PRSO,SPACESUIT
?L1:	PRINTI "It smells just like a "
	PRINTD PRSO
	PRINTR "."

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,TX
	GETPT OBJ2,P?GLOBAL >TX
	ZERO? TX /FALSE
	PTSIZE TX >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,TX,STACK >STACK
	RSTACK

	.FUNCT HERE??,OBJ
	IN? OBJ,HERE /TRUE
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	RSTACK

	.FUNCT V-SWIM
	FSET? HERE,RAIRBIT \?L1
	PRINTR "Waving your limbs doesn't help much. You move a little, but some stronger impulse is needed."
?L1:	PRINTR "You can't swim here!"

	.FUNCT V-UNTIE
	PRINTR "Unfasten it how?"

	.FUNCT PRE-TIE
	EQUAL? PRSI,WINNER \FALSE
	PRINTR "You can't tie it to yourself."

	.FUNCT V-TIE
	PRINTI "You can't tie the "
	PRINTD PRSO
	PRINTI " to that."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?52,STACK >STACK
	RSTACK

	.FUNCT V-ALARM
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?53,STACK
	FSET? PRSO,VILLAIN \?L1
	PRINTR "He's wide awake, or haven't you noticed..."
?L1:	PRINTI "The "
	PRINTD PRSO
	PRINTR " isn't sleeping."

	.FUNCT V-ZORK
	PRINTR "I see no Zork here."

	.FUNCT V-COMMAND
	FSET? PRSO,VICBIT \?L1
	PRINTI "The "
	PRINTD PRSO
	PRINTR " pays no attention."
?L1:	PRINTR "You cannot talk to that!"

	.FUNCT V-CLIMB-ON
	FSET? PRSO,FURNITURE \?L1
	FSET? PRSO,VEHBIT \?L3
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L1:	FSET? PRSO,VEHBIT \?L3
	CALL V-CLIMB-UP,P?UP,1 >STACK
	RSTACK
?L3:	PRINTI "You can't climb onto the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-CLIMB-FOO
	CALL V-CLIMB-UP,P?UP,1 >STACK
	RSTACK

	.FUNCT V-CLIMB-UP,DIR=P?UP,OBJ=0,X
	GETPT HERE,DIR >STACK
	ZERO? STACK /?L1
	CALL DO-WALK,DIR
	RTRUE
?L1:	ZERO? OBJ \?L3
	PRINTR "You can't go that way."
?L3:	PRINTR "Bizarre!"

	.FUNCT V-CLIMB-DOWN
	FSET? PRSO,FURNITURE \?L1
	FSET? PRSO,VEHBIT \?L1
	CALL V-CLIMB-ON
	RTRUE
?L1:	CALL V-CLIMB-UP,P?DOWN >STACK
	RSTACK

	.FUNCT V-PUT-UNDER
	PRINTR "You can't do that."

	.FUNCT V-ENTER
	CALL DO-WALK,P?IN >STACK
	RSTACK

	.FUNCT V-EXIT
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-SEARCH
	PRINTR "You find nothing unusual."

	.FUNCT V-FIND,L
	LOC PRSO >L
	EQUAL? PRSO,ME,HANDS \?L1
	PRINTR "You're around here somewhere..."
?L1:	EQUAL? L,GLOBAL-OBJECTS \?L5
	PRINTR "You find it."
?L5:	IN? PRSO,WINNER \?L8
	PRINTR "You have it."
?L8:	IN? PRSO,HERE /?L12
	EQUAL? PRSO,PSEUDO-OBJECT \?L11
?L12:	PRINTR "It's right here."
?L11:	FSET? L,VILLAIN \?L15
	PRINTI "The "
	PRINTD L
	PRINTR " has it."
?L15:	FSET? L,CONTBIT \?L18
	PRINTI "It's in the "
	PRINTD L
	PRINTR "."
?L18:	PRINTR "Beats me."

	.FUNCT V-TELL
	FSET? PRSO,VICBIT \?L1
	SET 'WINNER,PRSO
	RETURN WINNER
?L1:	PRINTI "You can't talk to the "
	PRINTD PRSO
	PRINTI "!"
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	RETURN 2

	.FUNCT V-ANSWER
	PRINTI "Nobody is awaiting your answer."
	CRLF
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RTRUE

	.FUNCT V-REPLY
	PRINTI "It is doubtful that the "
	PRINTD PRSO
	PRINTI " is interested."
	CRLF
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RTRUE

	.FUNCT V-IS-IN
	IN? PRSO,PRSI \?L1
	PRINTI "Yes, it is "
	FSET? PRSI,SURFACEBIT \?L5
	PRINTI "on"
	JUMP ?L9
?L5:	PRINTI "in"
?L9:	PRINTI " the "
	PRINTD PRSI
	PRINTR "."
?L1:	PRINTR "No, it isn't."

	.FUNCT V-KISS
	PRINTI "I'd sooner kiss a pig."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?54,STACK >STACK
	RSTACK

	.FUNCT V-RAPE
	PRINTI "What a (ahem!) strange idea."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?55,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?56,STACK >STACK
	RSTACK

	.FUNCT V-DIAGNOSE
	PRINTI "You are in perfect health."
	CRLF
	ZERO? DEATHS /FALSE
	PRINTI "You have been killed "
	EQUAL? DEATHS,1 \?L7
	PRINTR "once."
?L7:	EQUAL? DEATHS,2 \?L11
	PRINTR "twice."
?L11:	PRINTR "three times."

	.FUNCT V-SAY,V
	CALL FIND-IN,HERE,VICBIT >V
	ZERO? V /?L1
	SET 'P-CONT,0
	PRINTI "You must address the "
	PRINTD V
	PRINTR " directly."
?L1:	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	PRINTR "Talking to yourself is a sign of impending mental collapse."

	.FUNCT V-WEAR
	PRINTR "You can't wear that, and besides, it wouldn't fit."

	.FUNCT V-REMOVE
	FSET? PRSO,WEARBIT \?L1
	CALL PERFORM,V?TAKE-OFF,PRSO
	RTRUE
?L1:	CALL PERFORM,V?TAKE,PRSO
	RTRUE

	.FUNCT V-TAKE-OFF
	FSET? PRSO,VEHBIT \?L1
	CALL V-DISEMBARK >STACK
	RSTACK
?L1:	PRINTR "You aren't wearing that."

	.FUNCT V-STEP-ON
	PRINTR "That's a silly thing to do."

	.FUNCT V-PUT-ON
	CALL PERFORM,V?PUT,PRSO,PRSI >STACK
	RSTACK

	.FUNCT V-LAND
	PRINTR "Such complicated tasks are best left to computers."

	.FUNCT ROB,WHO,WHERE=0,HIDE?=0,N,X,ROBBED?=0
	FIRST? WHO >X /?L4
	RETURN ROBBED?
?L1:	ZERO? X \?L4
	RETURN ROBBED?
?L4:	NEXT? X >N /?L7
?L7:	CALL RIPOFF,X,WHERE >STACK
	ZERO? STACK /?L8
	ZERO? HIDE? /?L10
	FSET X,NDESCBIT
?L10:	SET 'ROBBED?,X
?L8:	SET 'X,N
	JUMP ?L1

	.FUNCT RIPOFF,X,WHERE
	EQUAL? X,BLUE-KEY \?L1
	IN? BLUE-KEY,FORCE-FIELD-1 /FALSE
?L1:	IN? X,WHERE /FALSE
	FSET? X,INVISIBLE /FALSE
	FSET? X,TOUCHBIT \FALSE
	FSET? X,TAKEBIT \FALSE
	EQUAL? X,UNDER-GLOBE \?L4
	FCLEAR X,NDESCBIT
	SET 'UNDER-GLOBE,0
?L4:	EQUAL? X,RED-DISK,BLUE-DISK \?L7
	CALL DISK-SWITCH,X,0
?L7:	EQUAL? X,SPACESUIT,SAFETY-LINE \?L10
	ZERO? THAT-END \TRUE
?L10:	ZERO? WHERE /?L13
	MOVE X,WHERE
	RTRUE
?L13:	REMOVE X
	RTRUE

	.FUNCT V-STAND
	LOC WINNER >STACK
	FSET? STACK,VEHBIT \?L1
	LOC WINNER >STACK
	CALL PERFORM,V?DISEMBARK,STACK
	RTRUE
?L1:	PRINTR "You are already standing, I think."

	.FUNCT V-NO
	PRINTR "You sound rather negative."

	.FUNCT V-YES
	PRINTR "You sound rather positive."

	.FUNCT V-POINT
	PRINTR "It's usually impolite to point."

	.FUNCT V-SET
	PRINTI "Setting a "
	PRINTD PRSO
	PRINTR " is a strange concept."

	.FUNCT V-PLAY
	PRINTI "Playing a "
	PRINTD PRSO
	PRINTR "?"

	.FUNCT V-$0024VERIFY
	PRINTI "Verifying game..."
	CRLF
	VERIFY \?L3
	PRINTR "Game correct."
?L3:	CRLF
	PRINTR "** Game File Failure **"

	.FUNCT V-STAND-ON
	PRINTI "Standing on a "
	PRINTD PRSO
	PRINTR " seems like a waste of time."

	.FUNCT V-REPORT
	PRINTR "Report?!? Wait until you've accomplished something..."

	.FUNCT V-LOOK-SAFELY
	FSET? PRSI,TRANSBIT \?L1
	PRINTI "The "
	PRINTD PRSO
	PRINTI " looks as before"
	EQUAL? PRSI,CLEAR-KEY /?L5
	PRINTI ", only tinged by the color of the "
	PRINTD PRSI
?L5:	PRINTR "."
?L1:	PRINTI "The "
	PRINTD PRSI
	PRINTR " isn't transparent."

	.FUNCT V-REACH
	FIRST? PRSO >STACK \?L1
	PRINTI "There is something"
	JUMP ?L5
?L1:	PRINTI "There is nothing"
?L5:	PRINTI " inside the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-REACH-FOR
	FSET? PRSO,TAKEBIT \?L1
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L1:	IN? PRSO,HERE \?L3
	PRINTR "It's here! Now what?"
?L3:	PRINTR "It is out of reach."

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR >STACK
	RSTACK

	.FUNCT V-WALK-TO
	IN? PRSO,HERE /?L3
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK /?L1
?L3:	PRINTR "It's here!"
?L1:	PRINTR "You should supply a direction!"

	.FUNCT V-FLY
	PRINTR "Humans are not usually equipped for flying."

	.FUNCT V-SMILE
	PRINTR "How pleasant!"

	.FUNCT V-EMPTY
	PRINTR "There's nothing to empty."

	.FUNCT BRIDGE-FCN,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the control room of the Starcross. There are exits labelled (arbitrarily) ""Port,"" ""Starboard,"" and ""Out."" The latter exit has a heavy bulkhead which is "
	FSET? AIRLOCK-INNER,OPENBIT \?L5
	PUSH STR?57
	JUMP ?L7
?L5:	PUSH STR?58
?L7:	PRINT STACK
	CRLF
	PRINTI "Your ship's computer does the routine tasks of navigation and life support. A control couch is mounted before a control panel and a large viewport. The ship's registration is affixed nearby."
	CRLF
	PRINTR "Your mass detector, essential in the search for black holes, sits to one side. On the detector are a red button, a blue button, and a small screen on which something is displayed."

	.FUNCT DETECTOR-FCN
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	PRINTI "The display reads: """
	PRINTD MASS
	PRINTR "."""

	.FUNCT I-ALARM,HEAR?=0
	ZERO? ALARM? /FALSE
	ZERO? MASS \?L3
	RANDOM 8 >MASSNUM
	GET MASSES,MASSNUM >MASS
?L3:	CALL QUEUE,I-ALARM,1 >STACK
	PUT STACK,0,1
	EQUAL? HERE,SPACESHIP-BRIDGE,SPACESHIP-QUARTERS,SPACESHIP-STORES \?L6
	SET 'HEAR?,1
	JUMP ?L8
?L6:	EQUAL? HERE,SPACESHIP-AIRLOCK \?L8
	FSET? AIRLOCK-INNER,OPENBIT \?L8
	SET 'HEAR?,1
?L8:	ZERO? HEAR? /?L10
	PRINTI "The alarm bell on the mass detector is ringing stridently."
	CRLF
?L10:	EQUAL? MOVES,15 \?L15
	SET 'ALARM?,0
	SET 'COMPUTER-ON,1
	ZERO? HEAR? /TRUE
	PRINTI """If you won't turn it off, I will. I can't take the noise any more."""
	CRLF
	CALL PRINT-ID,STR?59
	RTRUE
?L15:	ZERO? HEAR? /TRUE
	EQUAL? MOVES,10 \TRUE
	SET 'COMPUTER-ON,1
	PRINTR "An expressionless but nonetheless surly voice issues from the computer: ""Please turn that alarm off! We'll both have headaches if you don't."""

	.FUNCT ALARM-FCN
	EQUAL? PRSA,V?LISTEN \?L1
	PRINTI "The alarm is "
	ZERO? ALARM? /?L5
	PRINTR "ringing."
?L5:	PRINTR "off."
?L1:	EQUAL? HERE,SPACESHIP-BRIDGE /?L12
	PRINTR "The alarm is on the bridge, not here."
?L12:	EQUAL? PRSA,V?EXAMINE \?L15
	PRINTI "The alarm is "
	ZERO? ALARM? /?L18
	PRINTR "ringing."
?L18:	PRINTR "off."
?L15:	EQUAL? PRSA,V?PUSH,V?LAMP-OFF \?L25
	ZERO? ALARM? /?L26
	SET 'ALARM?,0
	PRINTR "The alarm goes silent."
?L26:	PRINTR "The alarm's already off. Your ears must be ringing."
?L25:	EQUAL? PRSA,V?LAMP-ON \FALSE
	PRINTR "Only the mass detector can turn the alarm on."

	.FUNCT MASS-FCN
	EQUAL? PRSA,V?SET \?L1
	CALL KVETCH >STACK
	ZERO? STACK \TRUE
	PRINTR "The computer must be used to set courses, as navigation is fully automated."
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL HELD?,CHART >STACK
	ZERO? STACK /?L9
	PRINTR "It's still here on the output."
?L9:	PRINTR "You don't have the output."

	.FUNCT BUNK-FCN,RARG=0
	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	IN? ADVENTURER,BUNK \FALSE
	PRINTR "You must get up first!"

	.FUNCT BUTTON-FCN
	EQUAL? PRSA,V?PUSH \FALSE
	FSET? CHART,TOUCHBIT \?L3
	PRINTR "Nothing happens."
?L3:	MOVE CHART,HERE
	FSET CHART,TOUCHBIT
	PRINTR "The mass detector produces some output."

	.FUNCT V-R
	EQUAL? WINNER,COMPUTER \?L1
	EQUAL? PRSO,INTNUM \?L3
	ZERO? P-NUMBER /?L7
	GRTR? P-NUMBER,360 \?L5
?L7:	CALL NOT-IN-RANGE,STR?60
	RTRUE
?L5:	CALL OK-TELL,R-VALUE,STR?60
	SET 'R-VALUE,P-NUMBER
	CALL COURSE-SET >STACK
	RSTACK
?L3:	CALL NON-NUMERIC,STR?60 >STACK
	RSTACK
?L1:	CALL EXPLAIN-COORDINATES >STACK
	RSTACK

	.FUNCT V-THETA
	EQUAL? WINNER,COMPUTER \?L1
	EQUAL? PRSO,INTNUM \?L3
	ZERO? P-NUMBER /?L7
	GRTR? P-NUMBER,360 \?L5
?L7:	CALL NOT-IN-RANGE,STR?61
	RTRUE
?L5:	CALL OK-TELL,THETA-VALUE,STR?62
	SET 'THETA-VALUE,P-NUMBER
	CALL COURSE-SET >STACK
	RSTACK
?L3:	CALL NON-NUMERIC,STR?61 >STACK
	RSTACK
?L1:	CALL EXPLAIN-COORDINATES >STACK
	RSTACK

	.FUNCT V-PHI
	EQUAL? WINNER,COMPUTER \?L1
	EQUAL? PRSO,INTNUM \?L3
	ZERO? P-NUMBER /?L7
	GRTR? P-NUMBER,360 \?L5
?L7:	CALL NOT-IN-RANGE,STR?63
	RTRUE
?L5:	CALL OK-TELL,PHI-VALUE,STR?64
	SET 'PHI-VALUE,P-NUMBER
	CALL COURSE-SET >STACK
	RSTACK
?L3:	CALL NON-NUMERIC,STR?63 >STACK
	RSTACK
?L1:	CALL EXPLAIN-COORDINATES >STACK
	RSTACK

	.FUNCT OK-TELL,VAL,STR
	PRINTI """"
	ZERO? VAL /?L3
	PRINTI "Changing your mind, eh? "
?L3:	PRINT STR
	PRINTI " set."
	RTRUE

	.FUNCT NOT-IN-RANGE,STR
	PRINTI """That value for "
	PRINT STR
	PRINTR " is out of range."""

	.FUNCT NON-NUMERIC,STR
	PRINTI """You must give me a numerical value for "
	PRINT STR
	PRINTR "."""

	.FUNCT EXPLAIN-COORDINATES
	CALL KVETCH >STACK
	ZERO? STACK \TRUE
	PRINTR "Set a course by telling the computer the R, theta, and phi values of your destination."

	.FUNCT KVETCH
	INC 'COMPUTER-COUNT
	EQUAL? COMPUTER-COUNT,3 \FALSE
	SET 'COMPUTER-COUNT,0
	PRINTR "Please consult the manual for the proper computer operating procedure."

	.FUNCT COURSE-SET
	ZERO? R-VALUE /?L1
	ZERO? THETA-VALUE /?L1
	ZERO? PHI-VALUE /?L1
	SET 'GOT-INSTRUCTIONS,1
	SET 'DESTINATION,0
	SET 'LOST,0
	PRINTI """ Lights blink furiously for a moment. The computer speaks: "
	CALL FIND-DESTINATION,KNOWN-LOCS,KNOWNS >GIVE-UP
	ZERO? GIVE-UP /?L5
	PRINTI """Navigational program for "
	PRINTD GIVE-UP
	PRINTI " is ready. Giving up, huh? Figures, just when we get a good strike. "
	JUMP ?L12
?L5:	CALL FIND-DESTINATION,MASS-LOCS,MASSES >DESTINATION
	ZERO? DESTINATION /?L9
	EQUAL? DESTINATION,MASS \?L9
	PRINTI """Sequence for intercept of mass concentration is programmed and ready. "
	JUMP ?L12
?L9:	SET 'LOST,1
	PRINTI """I know my instruments aren't as good as the mass detector, but I see nothing at that location. Well, if you say so. "
?L12:	PRINTR "Please confirm new navigational program. I'm waiting..."""
?L1:	PRINTR " Waiting for additional values."""

	.FUNCT FIND-DESTINATION,X,M,C=0,N
	GET X,0 >N
?L1:	INC 'C
	GET X,1 >STACK
	EQUAL? STACK,R-VALUE \?L3
	GET X,2 >STACK
	EQUAL? STACK,THETA-VALUE \?L3
	GET X,3 >STACK
	EQUAL? STACK,PHI-VALUE \?L3
	GET M,C >STACK
	RSTACK
?L3:	EQUAL? C,N /FALSE
	ADD X,6 >X
	JUMP ?L1

	.FUNCT KNOWN-COURSE,D,SET?,X,N,C=0
	SET 'X,KNOWN-LOCS
	GET X,0 >N
?L1:	INC 'C
	GET KNOWNS,C >STACK
	EQUAL? STACK,D \?L7
	ZERO? SET? /?L5
	GET X,1 >R-VALUE
	GET X,2 >THETA-VALUE
	GET X,3 >PHI-VALUE
	RETURN D
?L5:	RETURN X
?L7:	EQUAL? C,N /FALSE
	ADD X,6 >X
	JUMP ?L1

	.FUNCT REPORT-LOCATION,M,ML,N
	PRINTI """Coordinates for "
	PRINTD M
	PRINTI ": R is "
	GET ML,N >STACK
	PRINTN STACK
	PRINTI ", theta is "
	ADD N,1 >STACK
	GET ML,STACK >STACK
	PRINTN STACK
	PRINTI ", phi is "
	ADD N,2 >STACK
	GET ML,STACK >STACK
	PRINTN STACK
	PRINTR "."""

	.FUNCT CONTROLS-FCN
	EQUAL? HERE,THRONE-ROOM \?L1
	EQUAL? PRSA,V?EXAMINE \?L3
	CALL AS-ADVERTISED >STACK
	RSTACK
?L3:	PRINTR "The controls look in no way operational."
?L1:	EQUAL? PRSA,V?EXAMINE \?L8
	PRINTI "This is a standard control panel for this class of single-passenger mining ship. Most controls are for emergencies only, as the Starcross is normally controlled by verbal instructions to the computer."
	IN? COMPUTER,HERE /?L11
	PRINTI " This set of controls is non-functional."
?L11:	CRLF
	RTRUE
?L8:	EQUAL? PRSA,V?LAMP-ON,V?SET,V?RUB /?L17
	EQUAL? PRSA,V?PLAY,V?LAMP-OFF \FALSE
?L17:	IN? COMPUTER,HERE /?L18
	PRINTR "The controls are no longer functional."
?L18:	ZERO? COMPUTER-ON /?L22
	ZERO? GOT-INSTRUCTIONS /?L23
	PRINTR "As you reach for the controls, the computer blares: ""Warning! Warning! Course is set! Remember what happened last time you played with the controls in mid-course..."""
?L23:	PRINTR "The computer's voice intrudes. ""Do you really want to touch the controls just now? Not to impugn your piloting ability, but shouldn't I execute any course corrections? I'm very good at it, you know."""
?L22:	SET 'COMPUTER-ON,1
	PRINTR "The computer comes on and chides, ""Manual operation when the ship's computer is functional is not recommended. Ship's controls are not currently enabled."""

	.FUNCT BRIDGE-EXITS
	EQUAL? PRSO,P?WEST \?L1
	RETURN SPACESHIP-QUARTERS
?L1:	EQUAL? PRSO,P?EAST \?L3
	RETURN SPACESHIP-STORES
?L3:	EQUAL? PRSO,P?OUT,P?SOUTH \FALSE
	FSET? AIRLOCK-INNER,OPENBIT \?L5
	RETURN SPACESHIP-AIRLOCK
?L5:	CALL ITS-CLOSED,AIRLOCK-INNER >STACK
	RSTACK

	.FUNCT OPEN-CLOSE,OBJ,STROPN,STRCLS
	EQUAL? PRSA,V?OPEN \?L1
	FSET? OBJ,OPENBIT \?L3
	CALL PICK-ONE,DUMMY >STACK
	PRINT STACK
	CRLF
	RTRUE
?L3:	PRINT STROPN
	FSET OBJ,OPENBIT
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? OBJ,OPENBIT \?L11
	PRINT STRCLS
	FCLEAR OBJ,OPENBIT
	CRLF
	RTRUE
?L11:	CALL PICK-ONE,DUMMY >STACK
	PRINT STACK
	CRLF
	CRLF
	RTRUE

	.FUNCT OBJECT-PSEUDO
	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL PERFORM,V?LOOK-INSIDE,WINDOW
	RTRUE

	.FUNCT PORTHOLE-FCN
	EQUAL? PRSA,V?THROUGH \?L1
	PRINTR "There is glass in that porthole, dummy!"
?L1:	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \FALSE
	EQUAL? HERE,SPACESHIP-BRIDGE \?L6
	CALL DESCRIBE-SPACE >STACK
	RSTACK
?L6:	EQUAL? HERE,THRONE-ROOM \FALSE
	PRINTR "You see the green dock, and the stars wheeling by above."

	.FUNCT V-THROUGH,OBJ=0,M
	ZERO? OBJ \?L7
	FSET? PRSO,VEHBIT \?L1
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L1:	ZERO? OBJ \?L7
	FSET? PRSO,TAKEBIT /?L3
	PRINTI "You hit your head against the "
	PRINTD PRSO
	PRINTR " as you attempt this feat."
?L3:	ZERO? OBJ /?L6
?L7:	PRINTR "You can't do that!"
?L6:	IN? PRSO,WINNER \?L9
	PRINTR "That would involve quite a contortion!"
?L9:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT ROOM?,OBJ,NOBJ
?L1:	LOC OBJ >NOBJ
	EQUAL? NOBJ,0,WINNER /FALSE
	EQUAL? NOBJ,ROOMS \?L6
	RETURN OBJ
?L6:	SET 'OBJ,NOBJ
	JUMP ?L1

	.FUNCT GRUE-FUNCTION
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The grue is a sinister, lurking presence in the dark places of the earth. Its favorite diet is spacers, but its insatiable appetite is tempered by its fear of light. No grue has ever been seen by the light of day, and few have survived its fearsome jaws to tell the tale."
?L1:	EQUAL? PRSA,V?FIND \?L5
	PRINTR "There is no grue here, but I'm sure there is at least one lurking in the darkness nearby. I'd stay in lighted areas if I were you!"
?L5:	EQUAL? PRSA,V?LISTEN \FALSE
	PRINTR "It makes no sound but is always lurking in the darkness nearby."

	.FUNCT GROUND-FCN
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,GROUND \?L1
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?DIG \FALSE
	PRINTR "The ground is too hard for digging here."

	.FUNCT DEBRIS-FCN
	ZERO? DOCKED? /FALSE
	ZERO? SEEN-MOUSE? /FALSE
	EQUAL? PRSA,V?EXAMINE,V?TAKE \FALSE
	PRINTR "You should leave debris for the maintenance mice."

	.FUNCT ADVENTURER-FCN
	EQUAL? ADVENTURER,WINNER \FALSE
	ZERO? THAT-END /FALSE
	ZERO? THIS-END /?L3
	IN? SPACESUIT,WINNER \?L3
	EQUAL? PRSA,V?WALK \?L3
	EQUAL? HERE,YELLOW-DOCK \?L5
	EQUAL? PRSO,P?WEST /?L3
?L5:	EQUAL? HERE,YELLOW-DOCK-EDGE \?L6
	EQUAL? PRSO,P?EAST /?L3
?L6:	EQUAL? HERE,SPACESHIP-AIRLOCK \?L7
	EQUAL? PRSO,P?SOUTH,P?OUT,P?DOWN /?L3
?L7:	EQUAL? HERE,DEEP-SPACE \?L8
	EQUAL? PRSO,P?IN /?L3
?L8:	PRINTR "The safety line prevents you from leaving, as it is only about five meters long. You must detach it to leave."
?L3:	ZERO? THAT-END /FALSE
	ZERO? THIS-END \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	IN? SAFETY-LINE,WINNER \FALSE
	MOVE SAFETY-LINE,HERE
	PRINTI "You leave the half-secured safety line behind."
	CRLF
	RFALSE

	.FUNCT CRETIN
	EQUAL? PRSA,V?GIVE \?L1
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?EAT \?L3
	PRINTI "Auto-cannibalism is not the answer."
	CRLF
	CALL PRINT-ID,STR?65 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?MUNG,V?KILL \?L6
	EQUAL? PRSO,ME \?L7
	CALL PRINT-ID,STR?66
	CALL JIGS-UP,STR?67 >STACK
	RSTACK
?L7:	PRINTR "What a silly idea!"
?L6:	EQUAL? PRSA,V?TAKE \?L12
	PRINTR "How romantic!"
?L12:	EQUAL? PRSA,V?DISEMBARK \?L15
	PRINTR "You'll have to do that on your own."
?L15:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "That's hard unless your eyes are prehensile."

	.FUNCT FIND-IN,WHERE,WHAT,W
	FIRST? WHERE >W \FALSE
?L2:	FSET? W,WHAT \?L7
	RETURN W
?L7:	NEXT? W >W /?L2
	RFALSE

	.FUNCT FIND-TARGET,TARGET?1,P,TX,L,ROOM
	IN? TARGET?1,HERE \?L1
	RETURN HERE
?L1:	SET 'P,0
?L4:	NEXTP HERE,P >P
	ZERO? P /FALSE
	LESS? P,P?CROSS /?L4
	GETPT HERE,P >TX
	PTSIZE TX >L
	EQUAL? L,UEXIT /?L11
	EQUAL? L,CEXIT \?L12
	GETB TX,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK \?L11
?L12:	EQUAL? L,DEXIT \?L4
	GETB TX,DEXITOBJ >STACK
	FSET? STACK,OPENBIT \?L4
?L11:	GETB TX,0 >ROOM
	IN? TARGET?1,ROOM \?L4
	RETURN ROOM

	.FUNCT COMPUTER-FCN,N
	EQUAL? WINNER,COMPUTER \?L1
	ZERO? COMPUTER-ON \?L3
	SET 'COMPUTER-ON,1
	PRINTI "The computer turns itself on."
	CRLF
?L3:	EQUAL? PRSA,V?WALK-TO /?L190
	EQUAL? PRSA,V?SET \?L8
	EQUAL? PRSO,COURSE \?L8
	EQUAL? PRSA,V?WALK-TO \?L11
?L190:	SET 'PRSI,PRSO
?L11:	ZERO? DOCKED? /?L14
	PRINT ROPES-OFF
	CRLF
	RTRUE
?L14:	ZERO? ORBIT-MATCHED /?L18
	PRINTR """We just got here! I think we should look around first!"""
?L18:	ZERO? COUNTDOWN /?L21
	PRINT BURN-COMING
	CRLF
	RTRUE
?L21:	ZERO? COURSE-SELECTED /?L24
	PRINT IN-TRANSIT
	CRLF
	RTRUE
?L24:	CALL KNOWN-COURSE,PRSI,1 >STACK
	ZERO? STACK /?L28
	PRINTI """Course being set for "
	PRINTD PRSI
	PRINTI "."
	CALL COURSE-SET >STACK
	RSTACK
?L28:	PRINTR "The computer sounds surly. ""I told you to buy those additional I/O options. You know as well as I do that I can't talk to that stupid mass detector, so you'll just have to tell me the coordinates from its output. Maybe next time you'll listen."""
?L8:	EQUAL? PRSA,V?PHI,V?THETA,V?R \?L35
	GRTR? VIEW-COUNT,0 \?L36
	PRINTR """We just got here. You wouldn't be scared, would you?"""
?L36:	GRTR? TRIP-COUNT,0 \?L40
	PRINT IN-TRANSIT
	CRLF
	RTRUE
?L40:	ZERO? DOCKED? /?L43
	PRINT ROPES-OFF
	CRLF
	RTRUE
?L43:	ZERO? COUNTDOWN /FALSE
	PRINT BURN-COMING
	CRLF
	RTRUE
?L35:	EQUAL? PRSA,V?NO \?L50
	SET 'GOT-INSTRUCTIONS,0
	SET 'R-VALUE,0
	SET 'THETA-VALUE,0
	SET 'PHI-VALUE,0
	SET 'GIVE-UP,0
	SET 'LOST,0
	PRINTR """Okay."""
?L50:	EQUAL? PRSA,V?YES \?L53
	EQUAL? PRSO,0,COURSE /?L54
	PRINTR """You can't confirm that!"""
?L54:	ZERO? GOT-INSTRUCTIONS /?L58
	SET 'GOT-INSTRUCTIONS,0
	SET 'COUNTDOWN,1
	CALL QUEUE,I-BURN,3 >STACK
	PUT STACK,0,1
	PRINTI """Thank you. New navigational program will initiate in fifteen seconds. There will be a course correction burn of "
	RANDOM 30 >STACK
	ADD 30,STACK >STACK
	PRINTN STACK
	PRINTR " seconds duration. I advise you to fasten your seat belt."""
?L58:	PRINTR """No pending program. Confirmation ignored."""
?L53:	EQUAL? PRSA,V?LAND \?L64
	ZERO? PRSO /?L65
	EQUAL? PRSO,ARTIFACT \?L67
	CALL PERFORM,V?LAND
	RTRUE
?L67:	CALL PERFORM,V?SET,COURSE,PRSO
	RTRUE
?L65:	ZERO? DOCKED? /?L70
	PRINTR """Error. I am already landed. Program cancelled."""
?L70:	GRTR? VIEW-COUNT,0 \?L73
	PRINTR """Working...working...program aborted. The object is spinning too fast for a safe landing. I can maintain current synchronized course indefinitely."""
?L73:	PRINTR """Program cancelled. There is nothing nearby to land on."""
?L64:	EQUAL? PRSA,V?EXAMINE \?L79
	EQUAL? PRSO,MISSION-STATUS,COURSE \?L80
	CALL PERFORM,V?REPORT,MISSION-STATUS
	RTRUE
?L80:	PRINTR """Your eyes are better than mine for that."""
?L79:	EQUAL? PRSA,V?HELLO \?L85
	PRINTR """Hello, astronaut."""
?L85:	EQUAL? PRSA,V?FIND \?L88
	EQUAL? PRSO,ME \?L89
	CALL PERFORM,V?REPORT,MISSION-STATUS
	RTRUE
?L89:	CALL KNOWN-COURSE,PRSO,0 >N
	ZERO? N /?L91
	CALL REPORT-LOCATION,PRSO,N,1 >STACK
	RSTACK
?L91:	PRINTR """I don't know where that is."""
?L88:	EQUAL? PRSA,V?REPORT \?L97
	EQUAL? PRSO,MISSION-STATUS /?L96
?L97:	EQUAL? PRSA,V?GIVE,V?SGIVE \?L95
	EQUAL? MISSION-STATUS,PRSO,PRSI \?L95
?L96:	ZERO? LOST /?L98
	PRINTR """We're on our way somewhere unpromising, that's all I can tell you."""
?L98:	ZERO? GIVE-UP /?L102
	PRINTI """You've given up and are heading for "
	PRINTD GIVE-UP
	PRINTR ", remember?"""
?L102:	ZERO? DOCKED? /?L105
	PRINTR """We've docked with this odd object. I think those tentacles may have broken something; I don't feel too well."""
?L105:	GRTR? VIEW-COUNT,0 \?L108
	PRINTR """We're on a parallel course with a strange, rotating artifact."""
?L108:	GRTR? TRIP-COUNT,0 \?L111
	PRINTI """We're heading towards that newly reported unknown mass."
	GRTR? TRIP-COUNT,2 \?L114
	PRINTI " We are being scanned by radiation emanating from that mass."
?L114:	PRINTR """"
?L111:	ZERO? COUNTDOWN /?L121
	PRINTR """Counting down to course correction."""
?L121:	ZERO? GOT-INSTRUCTIONS /?L124
	PRINTR """Waiting for confirmation of new course."""
?L124:	ZERO? R-VALUE \?L127
	ZERO? THETA-VALUE \?L127
	ZERO? PHI-VALUE \?L127
	PRINTR """The mass detector has reported discovery of a new mass concentration. Other than that, things have been pretty dull around here."""
?L127:	PRINTI """We have a partially specified new course:"
	ZERO? R-VALUE /?L133
	PRINTI " R is "
	PRINTN R-VALUE
	PRINTI "."
?L133:	ZERO? THETA-VALUE /?L138
	PRINTI " Theta is "
	PRINTN THETA-VALUE
	PRINTI "."
?L138:	ZERO? PHI-VALUE /?L143
	PRINTI " Phi is "
	PRINTN PHI-VALUE
	PRINTI "."""
?L143:	CRLF
	RTRUE
?L95:	EQUAL? PRSA,V?LAMP-OFF \?L148
	EQUAL? PRSO,ALARM \?L148
	ZERO? ALARM? \?L149
	PRINTR """It's not on..."""
?L149:	PRINTI """And about time..."""
	CRLF
	SET 'ALARM?,0
	CALL QUEUE,I-ALARM,0 >STACK
	RSTACK
?L148:	EQUAL? PRSA,V?WAIT \?L156
	PRINTR """I can wait quite easily. Probably more easily than you."""
?L156:	EQUAL? PRSA,V?MUNG,V?ATTACK,V?KILL \?L159
	EQUAL? PRSO,ME \?L159
	PRINTI """That is not among my capabilities. Sigh."""
	CRLF
	CALL PRINT-ID,STR?68 >STACK
	RSTACK
?L159:	RANDOM 100 >STACK
	GRTR? 25,STACK \?L162
	PRINTR """That is not among my capabilities. Perhaps if you were to invest in a few upgrades I could do some of these things, but no..."""
?L162:	PRINTR """I'm only a navigational computer. That is not one of my functions."""
?L1:	EQUAL? PRSA,V?HELLO \?L168
	PRINTR """I haven't the patience for small talk."""
?L168:	EQUAL? PRSA,V?LAMP-ON \?L171
	ZERO? COMPUTER-ON /?L172
	CALL ALREADY,STR?19,COMPUTER >STACK
	RSTACK
?L172:	SET 'COMPUTER-ON,1
	PRINTR "The computer comes on."
?L171:	EQUAL? PRSA,V?LAMP-OFF \?L177
	ZERO? COMPUTER-ON /?L178
	SET 'COMPUTER-ON,0
	PRINTR """If you insist, but my programming impels me to come back on if anything important happens."""
?L178:	CALL ALREADY,STR?20,COMPUTER >STACK
	RSTACK
?L177:	EQUAL? PRSA,V?GIVE \?L183
	PRINTR """I might be able to take that if you had bought the extensors I asked for, but no..."""
?L183:	EQUAL? PRSA,V?TELL \FALSE
	ZERO? P-CONT \FALSE
	PRINTR """Yes?"""

	.FUNCT I-BURN
	SET 'COUNTDOWN,0
	CALL ROB,DEEP-SPACE
	PRINTI "The ship's thrusters spin it into a proper attitude, and then the engines begin their course correction burn. There are significant G's and not a little vibration."
	CRLF
	ZERO? SEAT-BELT? /?L3
	PRINTI "Fortunately, you are securely belted in."
	CRLF
	SET 'COURSE-SELECTED,1
	CALL QUEUE,I-TRIP,3 >STACK
	PUT STACK,0,1
	RTRUE
?L3:	SET 'R-VALUE,0
	SET 'THETA-VALUE,0
	SET 'PHI-VALUE,0
	SET 'GOT-INSTRUCTIONS,0
	SET 'WINNER,ADVENTURER
	CALL PRINT-ID,STR?69
	CALL JIGS-UP,STR?70 >STACK
	RSTACK

	.FUNCT I-TRIP
	PRINTI "Time passes as you journey towards your destination."
	CRLF
	INC 'TRIP-COUNT
	ZERO? GIVE-UP /?L3
	PRINTI "
You arrive at "
	PRINTD GIVE-UP
	PRINTI " safe and sound. It would be tedious to continue, as "
	PRINTD GIVE-UP
	PRINTI " has no prospects as a locale for quantum black holes, so this is the end.
"
	CALL FINISH
	RTRUE
?L3:	EQUAL? HERE,SPACESHIP-BRIDGE,SPACESHIP-AIRLOCK,DEEP-SPACE \?L15
	ZERO? LOST \?L12
	EQUAL? DESTINATION,MASS /?L10
?L12:	PRINTI "There is nothing interesting visible ahead."
	CRLF
	JUMP ?L15
?L10:	GET TRIP-DESCS,TRIP-COUNT >STACK
	PRINT STACK
	CRLF
?L15:	EQUAL? TRIP-COUNT,5 \?L19
	ZERO? LOST /?L21
	PRINTI "You have reached your destination. The computer speaks: ""There's nothing here, as I predicted. You never listen do you? This trip is over; See if I'll ever work with you again...""

"
	CRLF
	CALL FINISH >STACK
	RSTACK
?L21:	EQUAL? DESTINATION,MASS \?L25
	PRINTI "There is a brief burn as the ship matches course with the artifact. You are hanging in space about half a kilometer away from the waist of the object. The Starcross's engines shut down. The computer speaks: ""Program completed. We are being scanned by low level radiation. Awaiting instructions."""
	CRLF
	SET 'VIEW-COUNT,1
	CALL QUEUE,I-VIEW,2 >STACK
	PUT STACK,0,1
	SET 'ORBIT-MATCHED,1
	RETURN ORBIT-MATCHED
?L25:	PRINTI "Ahead is a nondescript nickel-iron asteroid, rather a small one too. Obviously, you have picked the wrong destination.

"
	CRLF
	CALL FINISH >STACK
	RSTACK
?L19:	ZERO? LOST \?L38
	EQUAL? DESTINATION,MASS \?L38
	EQUAL? TRIP-COUNT,3 \?L34
	PRINTI "The computer says, ""Telescopic observations reveal the object ahead to be extremely regular in shape. This is not your usual asteroid."""
	CRLF
	JUMP ?L38
?L34:	EQUAL? TRIP-COUNT,4 \?L38
	PRINTI "The computer remarks: ""I detect low-level scanning taking place. The radiation is not dangerous. I think we may be getting into something more than we expected here."""
	CRLF
?L38:	CALL QUEUE,I-TRIP,3 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT I-VIEW
	EQUAL? HERE,SPACESHIP-BRIDGE,SPACESHIP-AIRLOCK \?L1
	PRINTI "As the object rotates below, the features of a different area become visible through the viewport."
	CRLF
	SUB VIEW-COUNT,1 >STACK
	MOD STACK,4 >STACK
	GET VIEW-TABLE,STACK >STACK
	PRINT STACK
	CRLF
?L1:	INC 'VIEW-COUNT
	EQUAL? VIEW-COUNT,5 \?L8
	CALL TENTACLE-APPEARS >STACK
	RSTACK
?L8:	CALL QUEUE,I-VIEW,2 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT TENTACLE-APPEARS
	CALL QUEUE,I-MOUSE,1 >STACK
	PUT STACK,0,1
	RANDOM 50 >STACK
	ADD 75,STACK >STACK
	CALL QUEUE,I-BAD-AIR,STACK >STACK
	PUT STACK,0,1
	PRINTI "Suddenly an odd protrusion near the red dome splits open and a huge articulated metal tentacle issues from it at great speed."
	EQUAL? HERE,DEEP-SPACE \?L3
	CRLF
	CALL PRINT-ID,STR?71
	CALL JIGS-UP,STR?72
	JUMP ?L22
?L3:	EQUAL? HERE,SPACESHIP-BRIDGE,SPACESHIP-AIRLOCK \?L5
	PRINTI " It approaches the ship and delicately wraps itself around the hull."
	ZERO? SEAT-BELT? /?L8
	PRINTI " You are slammed against your seat"
	CALL PRINT-ID,STR?73
	JUMP ?L12
?L8:	PRINTI " You are smashed against the bulkhead"
	CALL PRINT-ID,STR?74
?L12:	PRINTI " as the tentacle accelerates the Starcross to the artifact's speed of rotation. Inexorably, your ship is drawn toward the dome. When you are a few tens of meters away, three smaller tentacles issue forth and grapple the ship solidly to the surface of the artifact. The large tentacle retreats into its housing, which closes.
"
	ZERO? SEAT-BELT? /?L17
	PRINTI "
You are disoriented: now that you are attached to the artifact, which is rotating, ""up"" and ""down"" have taken on new meanings. Your sense of balance tells you that your ship is clinging to the underside of some enormous object, and if you aren't careful you will fall! ""Up"" now refers to the center of the object, ""down"" to the immensities of space."
	CRLF
	CALL PRINT-ID,STR?75
	JUMP ?L22
?L17:	CALL PRINT-ID,STR?76
	CALL JIGS-UP,STR?77
	JUMP ?L22
?L5:	CALL PRINT-ID,STR?78
	CALL JIGS-UP,STR?79
?L22:	SET 'DOCKED?,1
	RETURN DOCKED?

	.FUNCT TAPE-FCN
	EQUAL? PRSA,V?TAKE \?L1
	IN? TAPE-PLAYER,SPIDER \FALSE
	PRINTR "The spider refuses to part with it."
?L1:	IN? TAPE-PLAYER,WINNER /?L8
	CALL DONT-HAVE,TAPE-PLAYER >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?LAMP-ON \?L9
	ZERO? TAPE-ON /?L10
	CALL ALREADY,STR?19,TAPE-PLAYER >STACK
	RSTACK
?L10:	SET 'TAPE-ON,1
	PRINTI "The "
	PRINTD PRSO
	PRINTR " comes on."
?L9:	EQUAL? PRSA,V?LAMP-OFF \?L15
	ZERO? TAPE-ON /?L16
	SET 'TAPE-ON,0
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is now off."
?L16:	CALL ALREADY,STR?20,TAPE-PLAYER >STACK
	RSTACK
?L15:	EQUAL? PRSA,V?WEAR,V?PLAY \?L21
	ZERO? TAPE-ON \?L22
	PRINTR "First, you must turn on the tape player."
?L22:	PRINTI "The player picks a recently referenced selection: "
	CALL PICK-ONE,TAPES >STACK
	PRINT STACK
	CRLF
	RTRUE
?L21:	EQUAL? PRSA,V?LISTEN \FALSE
	ZERO? TAPE-ON /?L32
	PRINTR "The tape player continues with the previous selection."
?L32:	PRINTR "The player isn't on."

	.FUNCT MOUSE-CONT
	EQUAL? PRSA,V?TAKE \FALSE
	PRINTI "The maintenance mouse buzzes briefly, then rotates its ""ears"" in your direction as you take the "
	PRINTD PRSO
	PRINTI ". It seems profoundly puzzled at your behavior."
	CRLF
	RFALSE

	.FUNCT MOUSE-GOODIES
	FIRST? MOUSE >STACK \TRUE
	PRINTI " It has already collected "
	CALL PRINT-CONTENTS,MOUSE
	PRINTI "."
	RTRUE

	.FUNCT MOUSE-FCN,RARG=0
	EQUAL? RARG,M-OBJDESC \?L1
	IN? MOUSE,GARAGE \?L3
	PRINTR "There is a maintenance mouse here."
?L3:	ZERO? SEEN-MOUSE? /?L7
	PRINTI "There is a maintenance mouse here, cheerfully scouring the area for garbage."
	CALL MOUSE-GOODIES
	CRLF
	RTRUE
?L7:	SET 'SEEN-MOUSE?,1
	PRINTI "A small metal contraption about a meter long and half a meter high enters the room."
	PRINT LONG-MOUSE
	CRLF
	RTRUE
?L1:	IN? MOUSE,HERE /?L13
	EQUAL? GLOBAL-MOUSE,PRSO,PRSI /?L14
	EQUAL? MOUSE,PRSO,PRSI \?L13
?L14:	EQUAL? PRSA,V?FOLLOW \?L15
	ZERO? LIT \?L17
	PRINTR "It's too dark to follow the mouse."
?L17:	ZERO? GARAGED? /?L21
	PRINTR "You can't go through the hole."
?L21:	ZERO? MFOLLOW /?L24
	CALL DO-WALK,MFOLLOW
	RTRUE
?L24:	PRINTR "You've lost him."
?L15:	PRINTR "There is no mouse here."
?L13:	EQUAL? PRSA,V?FOLLOW \?L31
	PRINTR "He's right here!"
?L31:	EQUAL? PRSA,V?ZAP \?L34
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L34
	CALL INT,I-MOUSE >STACK
	PUT STACK,0,0
	REMOVE MOUSE
	PRINTI "The mouse is obliterated, squealing piteously."
	CRLF
	CALL PRINT-ID,STR?80 >STACK
	RSTACK
?L34:	EQUAL? PRSA,V?MUNG \?L37
	PRINTI "The maintenance mouse is unscathed."
	CRLF
	CALL PRINT-ID,STR?81 >STACK
	RSTACK
?L37:	EQUAL? PRSA,V?EMPTY \?L40
	CALL ROB,MOUSE,WINNER >STACK
	ZERO? STACK /FALSE
	PRINTI "You get some booty!"
	CRLF
	CALL PRINT-ID,STR?82 >STACK
	RSTACK
?L40:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L46
	EQUAL? PRSA,V?EXAMINE \?L47
	PRINTI "The maintenance mouse is a boxy machine with a large receptacle on top in which garbage it collects can be stored. It is buzzing around cleaning the area, diligently polishing the floor, and waving its ""ears"" (small dish antennae) about."
	CRLF
?L47:	FIRST? MOUSE >STACK \?L52
	PRINTI "The receptacle on the mouse's back contains: "
	CALL PRINT-CONTENTS,MOUSE
	PRINTR "."
?L52:	PRINTR "The receptacle is empty."
?L46:	EQUAL? PRSA,V?LOOK-UNDER \?L61
	PRINTR "There is no dirt there."
?L61:	EQUAL? PRSA,V?BOARD \?L64
	PRINTR "The mouse buzzes piteously from the overload until you get back off. It only wants to collect small pieces of debris."
?L64:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTR "The mouse has no lid, just an open receptacle on its back."

	.FUNCT OUT-OF-HOLE
	ZERO? SEEN-MOUSE? /?L1
	ZERO? LIT /?L1
	PRINTI "A maintenance mouse"
	PRINT HOLE-SHUTS
	PRINTR "."
?L1:	SET 'SEEN-MOUSE?,1
	PRINTI "A small metal contraption"
	PRINT HOLE-SHUTS
	PRINTI ". The device stops in its tracks and buzzes briefly, allowing you a closer look."
	PRINT LONG-MOUSE
	CRLF
	RTRUE

	.FUNCT I-MOUSE,OLDM,HERE?,ROBBED?
	LOC MOUSE >OLDM
	IN? MOUSE,HERE /?L1
	SET 'HERE?,0
	JUMP ?L2
?L1:	SET 'HERE?,1
?L2:	CALL QUEUE,I-MOUSE,2 >STACK
	PUT STACK,0,1
	REMOVE MOUSE-HOLE
	SET 'GARAGED?,0
	LOC MOUSE >STACK
	CALL ROB,STACK,MOUSE >ROBBED?
	ZERO? ROBBED? /?L9
	ZERO? HERE? /?L9
	IN? MOUSE,GARAGE /?L92
	ZERO? LIT /?L5
	PRINTI "The maintenance mouse, buzzing happily, picks up some refuse."
	CRLF
	JUMP ?L9
?L5:	PRINTI "You hear a cheerful buzzing nearby."
	CRLF
?L9:	IN? MOUSE,GARAGE \?L13
?L92:	FIRST? MOUSE >STACK \?L23
	CALL ROB,MOUSE,TRASH-BIN
	IN? BLUE-DISK,TRASH-BIN \?L17
	MOVE BLUE-DISK,GARAGE
?L17:	IN? RED-DISK,TRASH-BIN \?L20
	MOVE RED-DISK,GARAGE
?L20:	ZERO? HERE? /?L23
	ZERO? LIT /?L23
	PRINTI "The mouse rolls up to the trash bin and dumps some stuff into it."
	CRLF
?L23:	RANDOM 100 >STACK
	GRTR? 40,STACK \?L86
	ZERO? HERE? /?L31
	ZERO? LIT /?L31
	PRINTI "The mouse leaves as unobtrusively as it arrived."
	CRLF
?L31:	MOVE MOUSE,MOUSE-LOC
	EQUAL? MOUSE-LOC,HERE \?L86
	MOVE MOUSE-HOLE,HERE
	CALL OUT-OF-HOLE
	JUMP ?L86
?L13:	ZERO? HERE? /?L40
	RANDOM 100 >STACK
	GRTR? 30,STACK \?L40
	ZERO? LIT /?L41
	PRINTI "The maintenance mouse sits in the middle of the room, buzzing contentedly."
	CRLF
	JUMP ?L86
?L41:	PRINTI "There is buzzing nearby."
	CRLF
	JUMP ?L86
?L40:	FIRST? MOUSE >STACK \?L48
	RANDOM 100 >STACK
	GRTR? 15,STACK \?L48
	LOC MOUSE >MOUSE-LOC
	MOVE MOUSE,GARAGE
	SET 'GARAGED?,1
	EQUAL? HERE,GARAGE \?L49
	ZERO? LIT /?L86
	PRINTI "A maintenance mouse enters the garage, preparing to dump a load of trash."
	CRLF
	JUMP ?L86
?L49:	ZERO? HERE? /?L86
	MOVE MOUSE-HOLE,HERE?
	ZERO? LIT /?L86
	PRINTI "The mouse disappears into a heretofore unnoticed hole in the wall, which closes and becomes nearly invisible."
	CRLF
	JUMP ?L86
?L48:	CALL MOVE-MOUSE
	LOC MOUSE >STACK
	CALL ROB,STACK,MOUSE >ROBBED?
	IN? MOUSE,HERE /?L64
	ZERO? HERE? /?L72
	ZERO? LIT /?L72
	PRINTR "The maintenance mouse glides happily away, looking for new dirt to conquer."
?L64:	ZERO? SEEN-MOUSE? \?L71
	ZERO? LIT /?L72
	CALL MOUSE-FCN,M-OBJDESC
	JUMP ?L72
?L71:	ZERO? LIT /?L72
	PRINTI "A maintenance mouse buzzes into the room, intent on trash."
	CALL MOUSE-GOODIES
	CRLF
?L72:	IN? MOUSE,HERE /?L76
	SET 'HERE?,0
	JUMP ?L77
?L76:	SET 'HERE?,1
?L77:	ZERO? LIT /?L86
	ZERO? ROBBED? /?L80
	ZERO? HERE? /?L86
	PRINTI "The mouse collects some discarded items."
	CRLF
	JUMP ?L86
?L80:	ZERO? HERE? /?L86
	PRINTI "The mouse is diligently cleaning the floor and looking for garbage."
	CRLF
?L86:	IN? MOUSE,HERE \FALSE
	RTRUE

	.FUNCT MOVE-MOUSE,H,P=0,TX,L,D=0
	LOC MOUSE >H
?L1:	NEXTP H,P >P
	LESS? P,P?CROSS \?L3
	ZERO? D /TRUE
	EQUAL? D,UP-A-TREE \?L7
	IN? MOUSE,HERE \FALSE
	PRINTI "The mouse tries to climb a tree, but fails dismally."
	CRLF
	RFALSE
?L7:	EQUAL? D,MAZE \?L14
	IN? MOUSE,HERE \FALSE
	PRINTI "The mouse tries to enter the warren, but is prodded away by several aliens."
	CRLF
	RFALSE
?L14:	MOVE MOUSE,D
	RTRUE
?L3:	GETPT H,P >TX
	PTSIZE TX >L
	EQUAL? L,UEXIT /?L25
	EQUAL? L,CEXIT \?L1
	GETB TX,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L1
?L25:	ZERO? D /?L28
	RANDOM 100 >STACK
	GRTR? 50,STACK \?L1
?L28:	IN? MOUSE,HERE \?L29
	SET 'MFOLLOW,P
?L29:	GETB TX,REXIT >D
	JUMP ?L1

	.FUNCT DOOR-PSEUDO
	EQUAL? PRSA,V?THROUGH \?L1
	PRINTR "Please specify a direction."
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL AS-ADVERTISED >STACK
	RSTACK

	.FUNCT HOLE-FCN
	EQUAL? PRSA,V?OPEN \?L1
	PRINTR "There is no apparent way to open the mouse hole. You can barely even see the seam between it and the wall."
?L1:	EQUAL? PRSA,V?MUNG \FALSE
	PRINTI "This has no effect except making it even less obvious where the hole is."
	CRLF
	CALL PRINT-ID,STR?83 >STACK
	RSTACK

	.FUNCT TRASH-BIN-FCN
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L1
	PRINTI "The bin is filled with all sorts of flotsam and jetsam. Bones, clothing, and broken spears are just some of the items visible on the top layer."
	FIRST? TRASH-BIN >STACK \?L5
	PRINTI " The bin also contains: "
	CALL PRINT-CONTENTS,TRASH-BIN
	PRINTI "."
?L5:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?SHAKE \?L12
	PRINTI "The bin is solidly affixed to the floor."
	CRLF
	CALL PRINT-ID,STR?84 >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?EMPTY,V?REACH \?L15
	PRINTR "There's a lot of stuff inside the bin."
?L15:	EQUAL? PRSA,V?THROUGH,V?DIG,V?SEARCH \FALSE
	FSET? GREEN-KEY,TOUCHBIT \?L19
	PRINTR "You find nothing else of interest."
?L19:	ZERO? TRASH-COUNT \?L23
	PRINTI "You have searched through part of the bin, but have found nothing of interest."
	CRLF
	SET 'TRASH-COUNT,25
	RETURN TRASH-COUNT
?L23:	RANDOM 100 >STACK
	GRTR? TRASH-COUNT,STACK \?L26
	MOVE GREEN-KEY,TRASH-BIN
	FSET GREEN-KEY,TOUCHBIT
	CALL THIS-IS-IT,GREEN-KEY
	PRINTR "Ahah, there's something! It appears to be a green crystal rod."
?L26:	ADD TRASH-COUNT,25 >TRASH-COUNT
	PRINTR "You continue sifting through the junk; nothing of interest turns up."

	.FUNCT HOLE-PSEUDO
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The chute seems bottomless and warm air rises from it."
?L1:	EQUAL? PRSA,V?DROP \?L5
	EQUAL? PRSI,PSEUDO-OBJECT \?L5
	CALL IDROP >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSO,SPACESUIT,SAFETY-LINE \?L8
	GETP PRSO,P?ACTION >STACK
	CALL STACK >STACK
	ZERO? STACK \TRUE
?L8:	REMOVE PRSO
	PRINTI "The "
	PRINTD PRSO
	PRINTR " falls down the chute and disappears."
?L5:	EQUAL? PRSA,V?THROUGH,V?CLIMB-DOWN \FALSE
	CALL PRINT-ID,STR?85
	CALL JIGS-UP,STR?86 >STACK
	RSTACK

	.FUNCT SPHERE-SHIP-FCN,RARG
	EQUAL? RARG,M-ENTER \FALSE
	CALL QUEUE,I-SPIDER,1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT BUBBLE-ROOM-FCN,RARG
	EQUAL? RARG,M-ENTER \FALSE
	CALL INT,I-SPIDER >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT BUBBLE-PSEUDO
	EQUAL? PRSA,V?MUNG \?L1
	PRINTI "The bubble is made of indestructible plastic."
	CRLF
	CALL PRINT-ID,STR?87 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "You can see the dock area quite clearly."

	.FUNCT I-SPIDER
	IN? SPIDER,SPHERE-SHIP \FALSE
	IN? ADVENTURER,SPHERE-SHIP \FALSE
	CALL QUEUE,I-SPIDER,1 >STACK
	PUT STACK,0,1
	ZERO? REFERRED? \?L5
	IN? TAPE-PLAYER,SPIDER \?L7
	PRINTR "The spider, oblivious to all else, is fiddling with the tape player. Every so often, he makes a happy little noise."
?L7:	ZERO? TALKED? \?L11
	RANDOM 100 >STACK
	GRTR? 25,STACK \?L12
	CALL SPIDER-GREETING >STACK
	RSTACK
?L12:	PRINTR "The spider watches you with multifaceted eyes."
?L11:	PRINTI "The spider sidles along the wires towards you. "
	PRINTI "He asks "
	CALL PICK-ONE,SPIDER-QUESTIONS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L5:	SET 'REFERRED?,0
	RETURN REFERRED?

	.FUNCT TRANSLATOR-FCN
	EQUAL? PRSA,V?ZAP \FALSE
	CALL PERFORM,V?ZAP,ZAP-GUN,SPIDER
	RTRUE

	.FUNCT SPIDER-FCN
	SET 'REFERRED?,1
	EQUAL? SPIDER,WINNER \?L1
	ZERO? TALKED? \?L3
	CALL SPIDER-GREETING
?L3:	IN? TAPE-PLAYER,SPIDER \?L6
	PRINT ENGROSSED
	CRLF
	RTRUE
?L6:	EQUAL? PRSA,V?IS-IN,V?FIND,V?EXAMINE /?L11
	EQUAL? PRSA,V?FOLLOW \?L10
?L11:	PRINTR """I can't help you there, I'm afraid. I'm quite a stay-at-home, I haven't left my ship for ages; nothing interesting out there any more. Those furry ones were interesting for a while but they're stagnant now."""
?L10:	EQUAL? PRSA,V?TAKE \?L14
	EQUAL? PRSO,TAPE-PLAYER \?L14
	SET 'WINNER,ADVENTURER
	CALL PERFORM,V?GIVE,PRSO,SPIDER
	RTRUE
?L14:	EQUAL? PRSA,V?ATTACK,V?DROP,V?TAKE /?L16
	EQUAL? PRSA,V?MUNG,V?KILL \?L15
?L16:	PRINTI """I couldn't do that. You're just joking, of course. You humans have a strange idea of humor."
	CRLF
	EQUAL? PRSA,V?MUNG,V?KILL /?L19
	PUSH 0
	JUMP ?L20
?L19:	PUSH 1
?L20:	CALL PRINT-ID,STR?88,STACK
	EQUAL? PRSA,V?ATTACK /?L21
	PUSH 0
	JUMP ?L22
?L21:	PUSH 1
?L22:	CALL PRINT-ID,STR?89,STACK >STACK
	RSTACK
?L15:	EQUAL? PRSA,V?SGIVE,V?GIVE \?L23
	PRINTR """No, thank you."" He seems offended that you would ask for an outright gift."
?L23:	PRINTR """I see. Thank you."" He seems quite pleased."
?L1:	EQUAL? PRSA,V?EXAMINE \?L29
	GETP SPIDER,P?LDESC >STACK
	PRINT STACK
	CRLF
	RTRUE
?L29:	EQUAL? PRSA,V?ZAP,V?MUNG \?L32
	CALL PRINT-ID,STR?90
	CALL JIGS-UP,STR?91 >STACK
	RSTACK
?L32:	IN? TAPE-PLAYER,SPIDER \?L33
	SET 'P-CONT,0
	PRINT ENGROSSED
	CRLF
	RTRUE
?L33:	EQUAL? PRSA,V?TELL,V?HELLO \?L36
	ZERO? TALKED? \?L37
	CALL SPIDER-GREETING
	EQUAL? PRSA,V?TELL /FALSE
	SET 'P-CONT,0
	RTRUE
?L37:	EQUAL? PRSA,V?HELLO \FALSE
	PRINTR """Hello, again."""
?L36:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSO,TAPE-PLAYER \?L47
	SET 'TALKED?,1
	MOVE YELLOW-KEY,HERE
	MOVE PRSO,SPIDER
	FSET PRSO,NDESCBIT
	FCLEAR PRSO,TAKEBIT
	PUTP SPIDER,P?LDESC,STR?92
	PRINTR "The spider examines the tape player and discovers the controls. A random song begins playing. Agitated, he fiddles with the controls again, and a lecture begins. He becomes even more agitated. ""What a wonderful gift, human! This will alleviate my boredom for a while. Your culture is young, but you have amassed enough of interest to keep me sane for a few more years. I thank you."" He fishes in a pouch and comes up with something. ""Perhaps you may find some use for this; I long ago grew bored with such baubles."" He tosses a yellow crystal rod at your feet."
?L47:	PRINTI "He takes the "
	PRINTD PRSO
	PRINTR " politely, looks it over for a moment, and gives it back. ""No, thank you,"" he sighs."

	.FUNCT SPIDER-GREETING
	SET 'TALKED?,1
	PRINTR "The spider draws forth an object from a wire clump. He fiddles with it and a voice issues from it: ""Greetings, creature from Earth. Are you afraid of me? Come closer, I won't harm you.""

The spider tells you his name is ""Gurthark-tun-Besnap,"" (or something more-or-less that). Like yourself, he landed here to explore. He failed to control the artifact before it left his system, and has been stranded here for centuries. He sighs. ""It's getting a little boring. The other inhabitants of this place are not too stimulating. The computer was some company until it malfunctioned. When we began to approach your system, I got excited! A whole new culture to learn! The end of boredom, for a while at least. I fed your language to my translator, from your radio broadcasts, and have eagerly awaited your arrival."" He grins broadly, a fairly horrific sight."

	.FUNCT GLOBE-SIZE,N
	PRINTI "The silvery globe is the size of "
	EQUAL? N,1 \?L3
	PRINTI "an orange"
	IN? BLUE-KEY,FORCE-FIELD-1 \?L18
	PRINTI ". Imbedded in the silver globe is a blue crystal rod"
	JUMP ?L18
?L3:	EQUAL? N,2 \?L12
	PRINTI "a basketball"
	JUMP ?L18
?L12:	EQUAL? N,3 \?L15
	PRINTI "a beachball"
	JUMP ?L18
?L15:	PRINTI "four feet and seems embedded in the floor"
?L18:	PRINTI "."
	RTRUE

	.FUNCT FF-FCN,RARG=0,F
	EQUAL? RARG,M-OBJDESC \?L1
	CALL GLOBE-SIZE,FF-STRENGTH
	CRLF
	FIRST? FF-HERE >STACK \TRUE
	CALL PRINT-CONT,FF-HERE,0,0
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L6
	PRINTR "The globe won't budge no matter how hard you try."
?L6:	EQUAL? PRSA,V?PUSH,V?RUB \?L9
	PRINTR "The globe feels neither hot nor cold. The globe doesn't move no matter how hard you press."
?L9:	EQUAL? PRSA,V?BOARD,V?CLIMB-ON,V?CLIMB-UP \?L12
	PRINTR "Climbing it gives you a strange feeling, so you get back down."
?L12:	EQUAL? PRSA,V?PUT-UNDER \?L15
	FSET? PRSO,TOUCHBIT /?L16
	CALL TRYTAKE >STACK
	ZERO? STACK /TRUE
?L16:	EQUAL? FF-STRENGTH,4 \?L18
	PRINTR "The globe is now touching the floor (in fact encompassing part of the floor), so you can't put anything under it."
?L18:	ZERO? UNDER-GLOBE /?L21
	PRINTI "The "
	PRINTD UNDER-GLOBE
	PRINTR " is already under the globe."
?L21:	FSET? PRSO,TAKEBIT \?L24
	EQUAL? PRSO,RED-DISK,BLUE-DISK \?L25
	CALL PERFORM,V?DROP,PRSO
	JUMP ?L27
?L25:	MOVE PRSO,HERE
?L27:	SET 'UNDER-GLOBE,PRSO
	FSET PRSO,NDESCBIT
	PRINTI "The "
	PRINTD PRSO
	PRINTR " slides under the globe."
?L24:	PRINTR "Be serious!"
?L15:	EQUAL? PRSA,V?PUT-ON \?L33
	CALL TRYTAKE >STACK
	ZERO? STACK /TRUE
	FIRST? FF-HERE >F \?L36
	EQUAL? F,BLUE-KEY \?L37
	PRINTI "The blue rod sticks out of the globe, preventing you from placing the "
	PRINTD PRSO
	PRINTR " there."
?L37:	PRINTI "The "
	PRINTD F
	PRINTR " is already on the globe, rather precariously balanced."
?L36:	MOVE PRSO,FF-HERE
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is now on the globe."
?L33:	EQUAL? PRSA,V?ZAP \FALSE
	CALL CAN-ZAP? >STACK
	ZERO? STACK /FALSE
	ZERO? UNDER-GLOBE \?L52
	CALL ROB,FF-HERE >STACK
	ZERO? STACK /?L50
?L52:	PRINTI "The blast destroys some carelessly stored objects."
	CRLF
	CALL PRINT-ID,STR?93
?L50:	ZERO? UNDER-GLOBE /?L56
	REMOVE UNDER-GLOBE
	SET 'UNDER-GLOBE,0
?L56:	PRINTI "The blast washes over the globe, which grows brighter and brighter as it overloads, then with a sinister shiver, it disappears!"
	CALL PRINT-ID,STR?94
	IN? BLUE-KEY,FORCE-FIELD-1 \?L68
	EQUAL? FF-HERE,FORCE-FIELD-1 \?L63
	REMOVE BLUE-KEY
	PRINTI " The blue rod is destroyed by the blast!"
	CALL PRINT-ID,STR?95
	JUMP ?L68
?L63:	EQUAL? WAS-UNDER-GLOBE,RED-DISK,BLUE-DISK \?L67
	CALL DISKS-OFF?,WAS-UNDER-GLOBE >STACK
	ZERO? STACK \?L67
	SET 'P-NUMBER,4
	CALL JUNK-INSIDE,4,2,1
	JUMP ?L68
?L67:	MOVE BLUE-KEY,HERE
	PRINTI " A blue rod drops to the floor from the globe's center!"
?L68:	PRINTI " Moments later, the projector builds up enough energy to restore the globe, and it reappears."
	CRLF
	CALL ROB,FORCE-FIELD-1,HERE >STACK
	ZERO? STACK \?L76
	CALL ROB,FORCE-FIELD-2,HERE >STACK
	ZERO? STACK \?L76
	CALL ROB,FORCE-FIELD-3,HERE >STACK
	ZERO? STACK \?L76
	CALL ROB,FORCE-FIELD-4,HERE >STACK
	ZERO? STACK \?L76
	CALL ROB,FF-BOWL-2,HERE >STACK
	ZERO? STACK \?L76
	CALL ROB,FF-BOWL-3,HERE >STACK
	ZERO? STACK \?L76
	CALL ROB,FF-BOWL-4,HERE >STACK
	ZERO? STACK /TRUE
?L76:	PRINTR "(The rod wasn't the only thing which dropped.)"

	.FUNCT FF-ROOM-FCN,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is a glaringly lit room filled with strange devices, most completely incomprehensible. For example, a huge projector of some sort points menacingly at a silvery globe floating in midair in the center of the room. "
	CALL GLOBE-SIZE,FF-STRENGTH
	PRINTI " Beneath the projector is a dial with four positions."
	CRLF
	ZERO? UNDER-GLOBE /TRUE
	PRINTI "Lying beneath the globe is a "
	PRINTD UNDER-GLOBE
	PRINTR "."
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,UNDER-GLOBE \FALSE
	SET 'UNDER-GLOBE,0
	RFALSE

	.FUNCT BLUE-KEY-FCN
	EQUAL? PRSA,V?TAKE \FALSE
	IN? PRSO,FORCE-FIELD-1 \FALSE
	FSET? PRSO,TOUCHBIT /FALSE
	PRINTR "The blue rod is solidly held by the silvery globe."

	.FUNCT FF-DIAL-FCN,OLD
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The dial has four positions. It is currently set to "
	GET NUMTAB,FF-STRENGTH >STACK
	PRINT STACK
	PRINTR "."
?L1:	EQUAL? PRSA,V?SET \FALSE
	EQUAL? PRSI,INTNUM \FALSE
	EQUAL? FF-STRENGTH,P-NUMBER \?L6
	PRINTR "That's where it's set now!"
?L6:	GRTR? P-NUMBER,4 /?L11
	LESS? P-NUMBER,1 \?L10
?L11:	PRINTR "The dial is clearly labelled with the numbers 1 to 4."
?L10:	PRINTI "The globe flickers out for an instant and then reappears, "
	GRTR? P-NUMBER,FF-STRENGTH \?L17
	PRINTI "expanded"
	JUMP ?L21
?L17:	PRINTI "shrunken"
?L21:	PRINTI ". "
	CALL GLOBE-SIZE,P-NUMBER
	CRLF
	EQUAL? FF-STRENGTH,4 \?L26
	ZERO? WAS-UNDER-GLOBE /?L26
	SET 'UNDER-GLOBE,WAS-UNDER-GLOBE
	FCLEAR WAS-UNDER-GLOBE,INVISIBLE
	SET 'WAS-UNDER-GLOBE,0
	JUMP ?L28
?L26:	EQUAL? P-NUMBER,4 \?L28
	ZERO? UNDER-GLOBE /?L28
	SET 'WAS-UNDER-GLOBE,UNDER-GLOBE
	FSET WAS-UNDER-GLOBE,INVISIBLE
	SET 'UNDER-GLOBE,0
?L28:	SET 'OLD,FF-HERE
	REMOVE FF-HERE
	SUB P-NUMBER,1 >STACK
	GET FF-TABLE,STACK >FF-HERE
	MOVE FF-HERE,FF-ROOM
	GRTR? P-NUMBER,FF-STRENGTH \?L30
	CALL JUNK-INSIDE,P-NUMBER,FF-STRENGTH
	JUMP ?L32
?L30:	CALL JUNK-OUTSIDE,P-NUMBER,FF-STRENGTH
?L32:	SET 'FF-STRENGTH,P-NUMBER
	RETURN FF-STRENGTH

	.FUNCT V-FALL
	PRINTR "Fallen."

	.FUNCT JUNK-INSIDE,NEW,OLD,KEY?=0,DEST,RO,RI
	SUB NEW,1 >STACK
	GET FF-FALLS,STACK >DEST
	EQUAL? P-NUMBER,4 \?L1
	EQUAL? WAS-UNDER-GLOBE,BLUE-DISK /?L3
	EQUAL? WAS-UNDER-GLOBE,RED-DISK \?L1
?L3:	SET 'DEST,WAS-UNDER-GLOBE
?L1:	SUB OLD,1 >STACK
	GET FF-TABLE,STACK >STACK
	CALL ROB,STACK,DEST >RO
	SUB OLD,1 >STACK
	GET FF-FALLS,STACK >RI
	ZERO? RI /?L5
	CALL ROB,RI,DEST >RI
?L5:	ZERO? RO \?L10
	ZERO? RI \?L10
	ZERO? KEY? /TRUE
?L10:	EQUAL? P-NUMBER,4 \?L11
	EQUAL? WAS-UNDER-GLOBE,BLUE-DISK,RED-DISK \?L11
	CALL DISKS-OFF?,WAS-UNDER-GLOBE >STACK
	ZERO? STACK \?L11
	PRINTI "You hear the hum of the transporter disk activating."
	CRLF
	ZERO? RI /?L15
	CALL PERFORM,V?FALL,RI,WAS-UNDER-GLOBE
?L15:	ZERO? RO /?L18
	CALL PERFORM,V?FALL,RO,WAS-UNDER-GLOBE
?L18:	ZERO? KEY? /?L21
	MOVE BLUE-KEY,WAS-UNDER-GLOBE
	CALL PERFORM,V?FALL,BLUE-KEY,WAS-UNDER-GLOBE
?L21:	IN? BLUE-KEY,FORCE-FIELD-1 \TRUE
	CALL OTHER-DISK,WAS-UNDER-GLOBE >STACK
	LOC STACK >STACK
	IN? STACK,ROOMS \TRUE
	CALL SCORE-OBJ,BLUE-KEY
	FSET BLUE-KEY,TOUCHBIT
	CALL OTHER-DISK,WAS-UNDER-GLOBE >STACK
	MOVE BLUE-KEY,STACK
	RTRUE
?L11:	PRINTR "You hear something fall inside the sphere."

	.FUNCT JUNK-OUTSIDE,NEW,OLD,R
	SUB OLD,1 >STACK
	GET FF-TABLE,STACK >STACK
	CALL ROB,STACK,FF-ROOM >R
	ZERO? R /?L1
	PRINT SPHERE-SHRINKS
	PRINTD R
	PRINTI " falls to the new surface and then slides to the floor."
	CRLF
?L1:	SUB OLD,1 >STACK
	GET FF-FALLS,STACK >STACK
	CALL ROB,STACK,FF-ROOM >R
	ZERO? R /TRUE
	PRINT SPHERE-SHRINKS
	PRINTD R
	PRINTI " falls"
	EQUAL? UNDER-GLOBE,RED-DISK,BLUE-DISK \?L10
	PRINTI ". "
	MOVE R,WINNER
	CALL PERFORM,V?DROP,R,UNDER-GLOBE
	CRLF
	RTRUE
?L10:	PRINTR " onto the floor."

	.FUNCT DISK-FCN,THERE,OTHER
	EQUAL? PRSA,V?TAKE \?L1
	EQUAL? PRSO,RED-DISK,BLUE-DISK \?L1
	CALL ROB,PRSO,HERE >STACK
	ZERO? STACK /?L3
	PRINTI "The stuff on the disk falls to the ground."
	CRLF
?L3:	CALL DISK-SWITCH,PRSO,0
	RFALSE
?L1:	EQUAL? PRSA,V?DROP \?L8
	EQUAL? PRSO,RED-DISK,BLUE-DISK \?L8
	FSET? HERE,RLANDBIT \?L8
	ZERO? PRSI \?L8
	CALL DISK-SWITCH,PRSO,1
	MOVE PRSO,HERE
	PRINTI "The "
	PRINTD PRSO
	PRINTR " drops to the ground. There is an almost inaudible click as it comes to rest."
?L8:	EQUAL? PRSA,V?BOARD,V?STEP-ON,V?STAND-ON /?L12
	EQUAL? PRSA,V?CLIMB-ON \?L11
?L12:	EQUAL? PRSO,RED-DISK,BLUE-DISK \?L11
	CALL OTHER-DISK,PRSO >OTHER
	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L13
	PRINTR "You're holding it!"
?L13:	IN? PRSO,MOUSE \?L17
	PRINTR "The mouse skitters out of the way."
?L17:	CALL DISKS-OFF?,PRSO >STACK
	ZERO? STACK /?L20
	PRINTR "Nothing happens."
?L20:	PRINTI "There is a loud click as you step on the disk, and then a moment of disorientation."
	CRLF
	CALL DISK-SWITCH,RED-DISK,0
	CALL DISK-SWITCH,BLUE-DISK,0
	CALL FIND-ROOM,OTHER >THERE
	EQUAL? OTHER,UNDER-GLOBE,WAS-UNDER-GLOBE \?L26
	CALL PRINT-ID,STR?96
	CALL JIGS-UP,STR?97
	RTRUE
?L26:	IN? OTHER,PRSO \?L29
	REMOVE RED-DISK
	REMOVE BLUE-DISK
	CALL PRINT-ID,STR?98
	CALL JIGS-UP,STR?99
	RTRUE
?L29:	CALL ROB,PRSO,OTHER
	EQUAL? HERE,THERE \?L32
	PRINTR "You reappear in the same room, but on the other disk!"
?L32:	CRLF
	CALL GOTO,THERE >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?FALL,V?PUT-ON \FALSE
	EQUAL? PRSI,RED-DISK,BLUE-DISK \FALSE
	FSET? PRSI,TOUCHBIT /?L38
	PRINTR "It's on the wall!"
?L38:	EQUAL? PRSA,V?PUT-ON \?L43
	CALL TRYTAKE >STACK
	ZERO? STACK /TRUE
?L43:	MOVE PRSO,PRSI
	FSET PRSO,TOUCHBIT
	CALL OTHER-DISK,PRSI >OTHER
	CALL DISKS-OFF?,PRSI >STACK
	ZERO? STACK /?L47
	PRINTR "Nothing happens."
?L47:	EQUAL? PRSO,OTHER \?L51
	REMOVE RED-DISK
	REMOVE BLUE-DISK
	EQUAL? PRSI,WAS-UNDER-GLOBE \?L52
	SET 'WAS-UNDER-GLOBE,0
	CALL ROB,FF-BOWL-2
	CALL ROB,FF-BOWL-3
	CALL ROB,FF-BOWL-4
	IN? BLUE-KEY,FORCE-FIELD-1 \?L54
	REMOVE BLUE-KEY
?L54:	PRINTR "You hear a muffled explosion."
?L52:	SET 'UNDER-GLOBE,0
	SET 'WAS-UNDER-GLOBE,0
	PRINTI "The "
	PRINTD PRSI
	PRINTI " activates as the "
	PRINTD PRSO
	PRINTR " touches it. It disappears for a fraction of a second, then a flash of light fills the room as both disks explode!"
?L51:	MOVE PRSO,OTHER
	IN? OTHER,PRSI \?L63
	REMOVE RED-DISK
	REMOVE BLUE-DISK
	PRINTR "There is a tremendous explosion as the disk tries to transport the other disk into itself."
?L63:	CALL ROB,PRSI,OTHER
	CALL DISK-SWITCH,RED-DISK,0
	CALL DISK-SWITCH,BLUE-DISK,0
	IN? OTHER,HERE \?L68
	EQUAL? OTHER,WAS-UNDER-GLOBE /?L68
	EQUAL? PRSI,WAS-UNDER-GLOBE \?L70
	EQUAL? P-NUMBER,4 \?L70
	PRINTI "There is a loud click, and then the "
	PRINTD PRSO
	PRINTI " appears resting comfortably on the "
	CALL OTHER-DISK,PRSI >STACK
	PRINTD STACK
	PRINTI "."
	IN? BLUE-KEY,FORCE-FIELD-1 \?L74
	PRINTI " The blue rod must have been in range of the disk, because it appeared as well!"
?L74:	CRLF
	RTRUE
?L70:	PRINTI "There is a loud click from the "
	PRINTD PRSI
	PRINTI ", and the "
	PRINTD PRSO
	PRINTI " disappears for a fraction of a second, then reappears resting comfortably on the "
	PRINTD OTHER
	PRINTR "."
?L68:	PRINTI "There is a loud click from the "
	PRINTD PRSI
	PRINTI " and the "
	PRINTD PRSO
	PRINTR " disappears!"

	.FUNCT DISKS-OFF?,DISK,OTHER
	CALL OTHER-DISK,DISK >OTHER
	FSET? RED-DISK,TOUCHBIT \TRUE
	FSET? BLUE-DISK,TOUCHBIT \TRUE
	EQUAL? DISK,RED-DISK \?L4
	ZERO? RED-DISK-ON /TRUE
?L4:	EQUAL? DISK,BLUE-DISK \?L5
	ZERO? BLUE-DISK-ON /TRUE
?L5:	LOC OTHER >STACK
	FSET? STACK,RLANDBIT /FALSE
	IN? OTHER,DISK \TRUE
	RFALSE

	.FUNCT FIND-ROOM,X
?L1:	ZERO? X \?L3
	RETURN SPACESHIP-BRIDGE
?L3:	IN? X,ROOMS \?L5
	RETURN X
?L5:	LOC X >X
	JUMP ?L1

	.FUNCT DISK-SWITCH,WHICH,NEW
	FSET WHICH,TOUCHBIT
	EQUAL? WHICH,RED-DISK \?L1
	SET 'RED-DISK-ON,NEW
	RETURN RED-DISK-ON
?L1:	SET 'BLUE-DISK-ON,NEW
	RETURN BLUE-DISK-ON

	.FUNCT OTHER-DISK,DISK
	EQUAL? DISK,RED-DISK \?L1
	RETURN BLUE-DISK
?L1:	RETURN RED-DISK

	.FUNCT PROJECTOR-FCN
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It is a formidable looking apparatus that beams some sort of beam directly at the silvery globe."
?L1:	EQUAL? PRSA,V?ZAP \?L5
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L5
	PRINTI "The projector, of the sturdiest construction, is unscathed."
	CRLF
	CALL PRINT-ID,STR?100 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?MUNG \FALSE
	PRINTI "The projector is made of extremely tough plastic (yes, plastic) and is unscathed."
	CRLF
	CALL PRINT-ID,STR?101 >STACK
	RSTACK

	.FUNCT BEAM-FCN
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The beam transfers some sort of energy to the globe. It is impossible to tell any more."
?L1:	EQUAL? PRSA,V?ZAP \?L5
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L5
	PRINTR "The beam is pure energy, and is therefore unscathed."
?L5:	EQUAL? PRSA,V?MUNG \FALSE
	PRINTR "The beam seems impervious to that."

	.FUNCT AIRLOCK-EXIT-FCN
	FSET? AIRLOCK-OUTER,OPENBIT /?L1
	CALL ITS-CLOSED,AIRLOCK-OUTER >STACK
	RSTACK
?L1:	ZERO? DOCKED? /?L3
	PRINTI "You exit gingerly, climbing ""up"" to the surface of the artifact, where your magnetic boots hold you securely as you hang ""upside-down."""
	CRLF
	CRLF
	RETURN RED-DOCK
?L3:	RETURN DEEP-SPACE

	.FUNCT AIRLOCK-FCN,RARG=M-BEG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is the airlock of the Starcross. The inner door is "
	CALL DDESC,AIRLOCK-INNER >STACK
	PRINT STACK
	PRINTI ", and the outer door is "
	CALL DDESC,AIRLOCK-OUTER >STACK
	PRINT STACK
	PRINTI ". Neither door has a viewport."
	FSET? AIRLOCK-OUTER,OPENBIT \?L5
	PRINTI " Just outside the airlock is a hook."
?L5:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROUGH \?L11
	EQUAL? PRSO,AIRLOCK \?L11
	EQUAL? HERE,SPACESHIP-BRIDGE \?L13
	CALL DO-WALK,P?OUT
	RTRUE
?L13:	EQUAL? HERE,DEEP-SPACE \?L15
	CALL DO-WALK,P?IN
	RTRUE
?L15:	PRINTR "You are in it."
?L11:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	EQUAL? HERE,SPACESHIP-BRIDGE \FALSE
	CALL PERFORM,PRSA,AIRLOCK-INNER
	RTRUE

	.FUNCT RED-LOCK-FCN,RARG=M-BEG
	EQUAL? RARG,M-ENTER \?L1
	SET 'IN-ARTIFACT?,1
	RFALSE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	CALL DESCRIBE-LOCK,STR?102,RED-INNER,RED-OUTER >STACK
	RSTACK

	.FUNCT BLUE-LOCK-FCN,RARG=M-BEG
	EQUAL? RARG,M-LOOK \FALSE
	CALL DESCRIBE-LOCK,STR?103,BLUE-INNER,BLUE-OUTER >STACK
	RSTACK

	.FUNCT GREEN-LOCK-FCN,RARG=M-BEG
	EQUAL? RARG,M-LOOK \FALSE
	CALL DESCRIBE-LOCK,STR?104,GREEN-INNER,GREEN-OUTER >STACK
	RSTACK

	.FUNCT YELLOW-LOCK-FCN,RARG=M-BEG
	EQUAL? RARG,M-ENTER \?L1
	SET 'IN-ARTIFACT?,1
	RFALSE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	CALL DESCRIBE-LOCK,STR?105,YELLOW-INNER,YELLOW-OUTER
	ZERO? ALWAYS-LIT /TRUE
	PRINTR "The room is lit by an emergency lighting system."

	.FUNCT DESCRIBE-LOCK,COLOR,INNER,OUTER
	PRINTI "This is the main airlock of the "
	PRINT COLOR
	PRINTI " docking port. The inner door leading up to the interior is "
	CALL DDESC,INNER >STACK
	PRINT STACK
	PRINTI ", and the outer door leading down to the surface is "
	CALL DDESC,OUTER >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT DDESC,D
	FSET? D,OPENBIT \?L1
	RETURN STR?17
?L1:	RETURN STR?18

	.FUNCT AIRLOCK-DOORS-FCN,DIR
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,SPACESHIP-AIRLOCK \?L3
	EQUAL? PRSO,AIRLOCK-INNER \?L5
	SET 'DIR,P?WEST
	JUMP ?L9
?L5:	SET 'DIR,P?UP
	JUMP ?L9
?L3:	EQUAL? PRSO,AIRLOCK-INNER \?L8
	SET 'DIR,P?EAST
	JUMP ?L9
?L8:	SET 'DIR,P?DOWN
?L9:	CALL DO-WALK,DIR
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L10
	ZERO? PRSO /?L11
	ZERO? PRSI /?L11
	EQUAL? PRSO,AIRLOCK \?L11
	CALL PERFORM,PRSA,PRSI
	RTRUE
?L11:	EQUAL? PRSO,AIRLOCK-INNER \?L13
	EQUAL? PRSA,V?OPEN \?L14
	IN? WINNER,COUCH \?L16
	PRINTR "You'll have to get out of the couch first."
?L16:	FSET? PRSO,OPENBIT \?L20
	CALL ALREADY,STR?17 >STACK
	RSTACK
?L20:	FSET? AIRLOCK-OUTER,OPENBIT \?L21
	PRINTR "Fortunately the safety interlock prevents you from evacuating the spaceship by opening both doors of the airlock at once."
?L21:	CALL DOOR-OPENS >STACK
	RSTACK
?L14:	IN? WINNER,COUCH \?L25
	PRINTR "You'll have to get out of the couch first."
?L25:	FSET? PRSO,OPENBIT /?L28
	CALL ALREADY,STR?18 >STACK
	RSTACK
?L28:	CALL DOOR-CLOSES >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?OPEN \?L30
	FSET? PRSO,OPENBIT \?L31
	CALL ALREADY,STR?17 >STACK
	RSTACK
?L31:	FSET? AIRLOCK-INNER,OPENBIT \?L33
	PRINTI "A safety interlock prevents you from opening both doors of the airlock simultaneously."
	CRLF
	CALL PRINT-ID,STR?106 >STACK
	RSTACK
?L33:	FSET PRSO,OPENBIT
	CALL VACUUM-HERE
	ZERO? DOCKED? \?L37
	PRINTI " Outside the airlock is deep space. Beside the airlock is a safety hook to prevent you from drifting away into space."
?L37:	CRLF
	ZERO? SUIT-ON? \TRUE
	CALL PRINT-ID,STR?107
	CALL JIGS-UP,ACADEMY-DEATH
	RTRUE
?L30:	FSET? PRSO,OPENBIT /?L45
	CALL ALREADY,STR?18 >STACK
	RSTACK
?L45:	FCLEAR PRSO,OPENBIT
	CALL AIR-HERE >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	FSET? PRSO,OPENBIT /?L48
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is closed and there is no viewport."
?L48:	EQUAL? PRSO,AIRLOCK-INNER \?L52
	PRINTR "You see the bridge."
?L52:	ZERO? DOCKED? /?L55
	PRINTR "You see the red docking area of the artifact, including a dome with an airlock."
?L55:	CALL DESCRIBE-SPACE >STACK
	RSTACK

	.FUNCT DOOR-OPENS
	FSET PRSO,OPENBIT
	PRINTI "The "
	PRINTD PRSO
	PRINTR " opens."

	.FUNCT DOOR-CLOSES
	FCLEAR PRSO,OPENBIT
	PRINTI "The "
	PRINTD PRSO
	PRINTR " closes."

	.FUNCT DEEP-SPACE-FCN,RARG=0
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are floating outside the Starcross. The airlock door is "
	FSET? AIRLOCK-OUTER,OPENBIT \?L5
	PUSH STR?17
	JUMP ?L7
?L5:	PUSH STR?18
?L7:	PRINT STACK
	ZERO? THAT-END /?L8
	PRINTI ". One end of your safety line is attached to a hook next to the airlock."
	JUMP ?L12
?L8:	PRINTI ". There is a hook next to the airlock."
?L12:	PRINTI " This is deep space, outside the plane of the ecliptic and far beyond the orbit of Earth. The sun seems small but still intolerably bright to look at directly."
	CRLF
	CALL DESCRIBE-SPACE >STACK
	RSTACK
?L1:	EQUAL? RARG,M-END \?L17
	ZERO? THIS-END /?L20
	ZERO? THAT-END \FALSE
?L20:	PRINTI "You have left the Starcross in deep space without a safety line, a good way to drift into space and eventually run out of air."
	CRLF
	RANDOM 100 >STACK
	GRTR? 40,STACK \?L23
	PRINTR "So far you've been lucky and not drifted very far."
?L23:	CALL PRINT-ID,STR?108
	CALL JIGS-UP,STR?109
	RTRUE
?L17:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROW \?L30
	CALL THROW-AWAY >STACK
	RSTACK
?L30:	EQUAL? PRSA,V?REACH-FOR \FALSE
	EQUAL? PRSO,AIRLOCK-OUTER \FALSE
	FSET? AIRLOCK-OUTER,OPENBIT \?L33
	PRINTI "Just in time you pull yourself back into the airlock.
"
	CRLF
	CALL GOTO,SPACESHIP-AIRLOCK >STACK
	RSTACK
?L33:	PRINTR "You grab for the hatch, but can't find a handhold!"

	.FUNCT OUTER-SPACE-FCN,RARG=0
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are floating in space above the artifact, giving you a panoramic view of its surface. Unfortunately you will soon run out of air, which will ruin the experience."
	CRLF
	CALL PRINT-ID,STR?110 >STACK
	RSTACK
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROW \?L6
	CALL THROW-AWAY >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?ZAP \FALSE
	CALL CAN-ZAP? >STACK
	ZERO? STACK /FALSE
	CALL PRINT-ID,STR?111
	CALL JIGS-UP,STR?112 >STACK
	RSTACK

	.FUNCT THROW-AWAY
	CALL IDROP >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSO,SPACESUIT,SAFETY-LINE \?L3
	GETP PRSO,P?ACTION >STACK
	CALL STACK >STACK
	ZERO? STACK \TRUE
?L3:	REMOVE PRSO
	PRINTI "The "
	PRINTD PRSO
	PRINTR " sails away into space."

	.FUNCT DESCRIBE-SPACE
	ZERO? DOCKED? /?L1
	PRINT COLOR-CODED
	PRINTR "Your ship is tethered securely next to a large dome with an airlock. The surface looks metallic."
?L1:	GRTR? VIEW-COUNT,0 \?L5
	ADD VIEW-COUNT,2 >STACK
	MOD STACK,4 >STACK
	GET VIEW-TABLE,STACK >STACK
	PRINT STACK
	CRLF
	RTRUE
?L5:	GRTR? TRIP-COUNT,0 \?L8
	ZERO? LOST \?L11
	EQUAL? DESTINATION,MASS /?L9
?L11:	PRINTR "There is nothing interesting visible."
?L9:	GET TRIP-DESCS,TRIP-COUNT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L8:	PRINTR "You see the emptiness of space."

	.FUNCT SHIP-FCN
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,SPACESHIP-BRIDGE,SPACESHIP-AIRLOCK,SPACESHIP-STORES /?L5
	EQUAL? HERE,SPACESHIP-QUARTERS,RED-DOCK,DEEP-SPACE \?L3
?L5:	PRINTR "The Starcross looks the same as always."
?L3:	EQUAL? HERE,BLUE-DOCK,BUBBLE-ROOM,SPHERE-SHIP \?L8
	PRINTR "This ship looks like a huge crystalline bubble."
?L8:	EQUAL? HERE,UMBILICAL \?L11
	PRINTR "It looks like something out of a Buck Rogers movie."
?L11:	PRINTR "The Starcross is where you left it, presumably."
?L1:	EQUAL? PRSA,V?THROUGH,V?BOARD \FALSE
	EQUAL? HERE,RED-DOCK \FALSE
	CALL DO-WALK,P?SOUTH
	RTRUE

	.FUNCT ARTIFACT-FCN
	ZERO? DOCKED? \?L1
	PRINTR "What artifact?"
?L1:	EQUAL? PRSA,V?FIND,V?EXAMINE \FALSE
	ZERO? IN-ARTIFACT? /?L6
	PRINTR "It's all around!"
?L6:	PRINTR "It's right here.!"

	.FUNCT SPACESUIT-FCN
	EQUAL? PRSA,V?ZAP \?L1
	IN? SPACESUIT,CHIEF \?L1
	CALL PERFORM,V?ZAP,ZAP-GUN,CHIEF
	RTRUE
?L1:	EQUAL? PRSA,V?BOARD,V?WEAR \?L3
	ZERO? SUIT-ON? /?L4
	PRINTR "You are already wearing it."
?L4:	CALL TRYTAKE >STACK
	ZERO? STACK /TRUE
	SET 'SUIT-ON?,1
	FSET SPACESUIT,WEARBIT
	MOVE SPACESUIT,WINNER
	PRINTR "You are now wearing the space suit, breathing internal oxygen."
?L3:	EQUAL? PRSA,V?DISEMBARK,V?TAKE-OFF \?L12
	ZERO? SUIT-ON? /?L13
	SET 'SUIT-ON?,0
	SET 'THIS-END,0
	FCLEAR SPACESUIT,WEARBIT
	FSET? HERE,SPACEBIT \?L15
	CALL PRINT-ID,STR?113
	CALL JIGS-UP,STR?114 >STACK
	RSTACK
?L15:	EQUAL? POISON-COUNT,4 \?L17
	CALL PRINT-ID,STR?115
	CALL JIGS-UP,STR?116 >STACK
	RSTACK
?L17:	PRINTI "You have removed the space suit."
	CALL ON-ARTIFACT? >STACK
	ZERO? STACK /?L21
	CALL DESCRIBE-AIR,STR?117 >STACK
	RSTACK
?L21:	CRLF
	RTRUE
?L13:	PRINTR "You aren't wearing it."
?L12:	EQUAL? PRSA,V?THROW,V?GIVE,V?DROP /?L28
	EQUAL? PRSA,V?PUT \?L27
?L28:	ZERO? SUIT-ON? /?L29
	PRINTR "You'll have to take it off first!"
?L29:	SET 'THIS-END,0
	RFALSE
?L27:	IN? SPACESUIT,CHIEF \FALSE
	EQUAL? PRSA,V?POINT,V?TAKE \FALSE
	PRINTR "The chief jumps back, annoyed. He assumes you are trying to go back on your word."

	.FUNCT JUNK-SPACESUIT-FCN
	IN? PRSO,CHIEF \?L1
	EQUAL? PRSA,V?BOARD,V?WEAR,V?TAKE \?L1
	PRINTR "The chief jumps back, annoyed. He points at you and makes a long speech in his own language."
?L1:	EQUAL? PRSA,V?BOARD,V?WEAR \?L5
	FSET? PRSO,WEARBIT \?L6
	PRINTR "You are already wearing it."
?L6:	FSET PRSO,WEARBIT
	MOVE PRSO,WINNER
	PRINTR "You are now wearing the tattered old suit, which smells of alien."
?L5:	EQUAL? PRSA,V?DISEMBARK,V?TAKE-OFF \?L13
	FSET? PRSO,WEARBIT \?L14
	FCLEAR PRSO,WEARBIT
	PRINTR "You are no longer wearing the tattered suit."
?L14:	PRINTR "You aren't wearing it."
?L13:	EQUAL? PRSA,V?GIVE,V?DROP \FALSE
	FSET? PRSO,WEARBIT \FALSE
	PRINTR "You'll have to take it off first!"

	.FUNCT SAFETY-LINE-FCN,RARG=0
	EQUAL? RARG,M-OBJDESC \?L1
	PRINTI "A safety line"
	ZERO? THIS-END /?L5
	IN? SPACESUIT,WINNER /?L5
	SET 'THIS-END,0
?L5:	FSET? SAFETY-LINE,TOUCHBIT /?L8
	PRINTR " hangs on the wall."
?L8:	ZERO? THIS-END /?L12
	PRINTI " (attached to your space suit"
	ZERO? THAT-END /?L15
	PRINTI " and a hook"
?L15:	PRINTI ")"
	JUMP ?L22
?L12:	ZERO? THAT-END /?L22
	PRINTI " (attached to a hook)"
?L22:	PRINTR " is here."
?L1:	EQUAL? PRSA,V?EXAMINE \?L28
	ZERO? THIS-END /?L29
	PRINTI "One end of the line is attached to your space suit"
	ZERO? THAT-END /?L33
	PRINTI ", and one end to a hook"
?L33:	PRINTR "."
?L29:	ZERO? THAT-END /?L40
	PRINTR "One end of the line is attached to a hook."
?L40:	PRINTR "The line is not attached to anything."
?L28:	EQUAL? PRSA,V?UNTIE,V?TIE \?L46
	IN? SAFETY-LINE,WINNER /?L47
	CALL DONT-HAVE,SAFETY-LINE
	RTRUE
?L47:	EQUAL? PRSA,V?TIE \?L49
	EQUAL? PRSI,SPACESUIT \?L50
	CALL HELD?,SPACESUIT >STACK
	ZERO? STACK \?L52
	CALL DONT-HAVE,SPACESUIT
	RTRUE
?L52:	ZERO? THIS-END /?L54
	CALL ALREADY,STR?118,SPACESUIT
	RTRUE
?L54:	SET 'THIS-END,SPACESUIT
	JUMP ?L63
?L50:	EQUAL? PRSI,SAFETY-HOOK \?L56
	ZERO? THAT-END /?L57
	CALL ALREADY,STR?118,SAFETY-HOOK
	RTRUE
?L57:	SET 'THAT-END,SAFETY-HOOK
	JUMP ?L63
?L56:	ZERO? PRSI /?L60
	PRINTR "You can't attach the safety line to that."
?L60:	PRINTR "You must tell what to attach it to."
?L63:	PRINTI "Attached to the "
	PRINTD PRSI
	PRINTR "."
?L49:	EQUAL? PRSA,V?UNTIE \TRUE
	ZERO? PRSI /?L69
	EQUAL? PRSI,THAT-END \?L71
	SET 'THAT-END,0
	JUMP ?L74
?L71:	EQUAL? PRSI,THIS-END \?L73
	SET 'THIS-END,0
	JUMP ?L74
?L73:	PRINTI "It's not attached to the "
	PRINTD PRSI
	PRINTR "."
?L74:	PRINTI "Detached from the "
	PRINTD PRSI
	PRINTR "."
?L69:	ZERO? THAT-END /?L79
	PRINTI "Detached from the "
	PRINTD THAT-END
	PRINTI "."
	CRLF
	SET 'THAT-END,0
	RTRUE
?L79:	ZERO? THIS-END /?L82
	PRINTI "Detached from the "
	PRINTD THIS-END
	PRINTI "."
	CRLF
	SET 'THIS-END,0
	RTRUE
?L82:	PRINTR "It's not attached to anything."
?L46:	EQUAL? PRSA,V?THROW,V?DROP,V?PUT /?L90
	EQUAL? PRSA,V?TAKE,V?PUT-ON,V?GIVE \FALSE
?L90:	ZERO? THIS-END \?L93
	ZERO? THAT-END /FALSE
?L93:	PRINTR "You should detach it first."

	.FUNCT CORIOLIS
	EQUAL? PRSA,V?THROW,V?DROP \FALSE
	CALL IDROP >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSO,SPACESUIT,SAFETY-LINE \?L5
	GETP PRSO,P?ACTION >STACK
	CALL STACK >STACK
	ZERO? STACK \TRUE
?L5:	REMOVE PRSO
	PRINTI "As the "
	PRINTD PRSO
	PRINTR " leaves your hand, it is thrown into space by the rotation of the artifact."

	.FUNCT RED-DOCK-FCN,RARG
	EQUAL? RARG,M-BEG \?L1
	CALL CORIOLIS >STACK
	RSTACK
?L1:	EQUAL? RARG,M-ENTER \?L3
	SET 'IN-ARTIFACT?,0
	RFALSE
?L3:	EQUAL? RARG,M-LOOK \FALSE
	PRINT COLOR-CODED
	PRINTI "All around are strange protrusions, one of which could be a hook for a safety line. The surface here is metallic, but gets stony further from the dock. On one side (""Down"") is your ship, tethered to the surface of the artifact by thick silvery ropes. On the other (""Up"") is a large dome with an airlock"
	FSET? RED-OUTER,OPENBIT \?L7
	PRINTR ", which is open."
?L7:	PRINTR "."

	.FUNCT BLACK-KEY-FCN
	EQUAL? PRSA,V?TAKE \FALSE
	IN? BLACK-KEY,RELIEF \FALSE
	FSET RED-OUTER,OPENBIT
	MOVE BLACK-KEY,WINNER
	CALL SCORE-OBJ,BLACK-KEY
	SET 'DOOR-SOLVED?,1
	PRINTR "When you take the black rod, the airlock door opens!"

	.FUNCT RELIEF-FCN
	EQUAL? PRSA,V?EXAMINE \FALSE
	IN? BUMP,RED-DOCK /?L3
	PRINTR "The relief is no longer a relief. It is completely flattened out."
?L3:	PRINTI "A closer examination reveals that there are exactly ten circular bumps or columns on the sculpture: the first is large and centrally located, the second through tenth are smaller and scattered at various distances and orientations. As you go outward from the large bump in the center there are four small bumps, two rather large ones, two medium-sized ones, and finally a small one which sticks out quite far."
	CRLF
	IN? BABY-BUMP,HERE \TRUE
	PRINTI "There is also a tiny bump"
	PRINT ABOUT-SAME
	CRLF
	RTRUE

	.FUNCT INTNUM-FCN
	EQUAL? HERE,RED-DOCK \FALSE
	EQUAL? PRSO,INTNUM \FALSE
	CALL PERFORM,PRSA,BUMP,PRSI
	RTRUE

	.FUNCT ORDINAL,WRD
	EQUAL? WRD,W?FIRST,W?CENTER /TRUE
	EQUAL? WRD,W?SECOND \?L3
	RETURN 2
?L3:	EQUAL? WRD,W?THIRD \?L4
	RETURN 3
?L4:	EQUAL? WRD,W?FOURTH \?L5
	RETURN 4
?L5:	EQUAL? WRD,W?FIFTH \?L6
	RETURN 5
?L6:	EQUAL? WRD,W?SIXTH \?L7
	RETURN 6
?L7:	EQUAL? WRD,W?SEVENTH \?L8
	RETURN 7
?L8:	EQUAL? WRD,W?EIGHTH \?L9
	RETURN 8
?L9:	EQUAL? WRD,W?NINTH \?L10
	RETURN 9
?L10:	EQUAL? WRD,W?TENTH,W?OUTER,W?LAST \FALSE
	RETURN 10

	.FUNCT BUMP-FCN,N
	EQUAL? PRSA,V?RUB,V?PUSH \FALSE
	EQUAL? PRSO,BUMP,BUMP-2,BABY-BUMP \FALSE
	EQUAL? PRSO,BUMP,BUMP-2 \?L11
	EQUAL? PRSI,0,INTNUM \?L11
	EQUAL? PRSI,INTNUM /?L11
	ZERO? P-ADJECTIVE \?L7
	PRINTR "You didn't say which one."
?L7:	CALL ORDINAL,P-ADJECTIVE >N
	ZERO? N /?L10
	SET 'P-NUMBER,N
	JUMP ?L11
?L10:	PRINTR "Lose, lose!"
?L11:	EQUAL? PRSO,BABY-BUMP /?L17
	EQUAL? P-NUMBER,11 \?L15
	IN? BABY-BUMP,HERE \?L15
?L17:	REMOVE BABY-BUMP
	REMOVE BUMP
	REMOVE BUMP-2
	MOVE BLACK-KEY,RELIEF
	PUTP RELIEF,P?LDESC,STR?119
	PRINTR "The sculpture flattens out completely, except at the former location of the tiny bump, where a hexagonal rod of black crystal is extruded."
?L15:	ZERO? P-NUMBER \?L20
	PRINTR "You must specify which one."
?L20:	EQUAL? P-NUMBER,4 \?L23
	IN? BABY-BUMP,HERE /?L23
	MOVE BABY-BUMP,HERE
	PRINTI "A tiny column made up of only one hexagon appears at"
	PRINT ABOUT-SAME
	CRLF
	RTRUE
?L23:	REMOVE BABY-BUMP
	REMOVE BUMP
	REMOVE BUMP-2
	PUTP RELIEF,P?LDESC,STR?119
	PRINTR "All of the hexagons extend to full length, then retract into the surface, leaving the sculpture completely smooth."

	.FUNCT RED-DOORS-FCN,DIR
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,RED-LOCK \?L3
	EQUAL? PRSO,RED-INNER \?L5
	SET 'DIR,P?UP
	JUMP ?L9
?L5:	SET 'DIR,P?DOWN
	JUMP ?L9
?L3:	EQUAL? PRSO,RED-INNER \?L8
	SET 'DIR,P?DOWN
	JUMP ?L9
?L8:	SET 'DIR,P?UP
?L9:	CALL DO-WALK,DIR
	RTRUE
?L1:	ZERO? DOOR-SOLVED? /?L10
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L11
	CALL AIRLOCK-OPEN,RED-INNER,RED-OUTER,RED-DOCK >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL AIRLOCK-LOOK,RED-INNER,RED-THREE,RED-DOCK >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTR "The airlock door won't budge."

	.FUNCT BLUE-DOORS-FCN,DIR
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,BLUE-LOCK \?L3
	EQUAL? PRSO,BLUE-INNER \?L5
	SET 'DIR,P?UP
	JUMP ?L9
?L5:	SET 'DIR,P?DOWN
	JUMP ?L9
?L3:	EQUAL? PRSO,BLUE-INNER \?L8
	SET 'DIR,P?DOWN
	JUMP ?L9
?L8:	SET 'DIR,P?UP
?L9:	CALL DO-WALK,DIR
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L10
	CALL AIRLOCK-OPEN,BLUE-INNER,BLUE-OUTER,BLUE-DOCK >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL AIRLOCK-LOOK,BLUE-INNER,BLUE-THREE,BLUE-DOCK >STACK
	RSTACK

	.FUNCT YELLOW-DOORS-FCN,DIR
	ZERO? LIT \?L1
	PRINTR "It is too dark here to see."
?L1:	EQUAL? PRSA,V?THROUGH \?L5
	EQUAL? HERE,YELLOW-LOCK \?L6
	EQUAL? PRSO,YELLOW-INNER \?L8
	SET 'DIR,P?UP
	JUMP ?L12
?L8:	SET 'DIR,P?DOWN
	JUMP ?L12
?L6:	EQUAL? PRSO,YELLOW-INNER \?L11
	SET 'DIR,P?DOWN
	JUMP ?L12
?L11:	SET 'DIR,P?UP
?L12:	CALL DO-WALK,DIR
	RTRUE
?L5:	EQUAL? PRSO,YELLOW-OUTER \?L13
	EQUAL? PRSA,V?PUSH,V?OPEN \?L13
	ZERO? YELLOW-OPEN? \?L13
	FSET? YELLOW-INNER,OPENBIT /?L13
	PRINTI "The door appears to be jammed. There may be debris outside blocking it. Perhaps if you pushed again."
	CRLF
	SET 'YELLOW-OPEN?,1
	RETURN YELLOW-OPEN?
?L13:	EQUAL? PRSA,V?PUSH,V?CLOSE,V?OPEN \?L16
	CALL AIRLOCK-OPEN,YELLOW-INNER,YELLOW-OUTER,YELLOW-DOCK >STACK
	RSTACK
?L16:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL AIRLOCK-LOOK,YELLOW-INNER,YELLOW-THREE,YELLOW-DOCK >STACK
	RSTACK

	.FUNCT YELLOW-DOCK-FCN,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This dock area is severely scorched and damaged where other docks have rope housings. There was apparently a major explosion here, or possibly a chemically fueled rocket attempted to leave without taking proper precautions. There is a hook beside the airlock."
	CRLF
	IN? SCORCHED-ALIEN,YELLOW-DOCK-EDGE \TRUE
	PRINTR "Entangled in debris at the edge of the dock, to port, is what might be a body. It is out of reach from here."
?L1:	EQUAL? RARG,M-BEG \?L10
	CALL BRODY >STACK
	RSTACK
?L10:	EQUAL? RARG,M-ENTER \FALSE
	SET 'IN-ARTIFACT?,0
	RFALSE

	.FUNCT BRODY
	EQUAL? PRSA,V?LEAP \?L1
	ZERO? THIS-END /?L3
	ZERO? THAT-END /?L3
	PRINTR "You sail into space as far as your safety line allows, and then back again."
?L3:	CALL QUEUE,I-SUFFOCATE,5 >STACK
	PUT STACK,0,1
	PRINTI "You fly into space like a super-hero. Unfortunately, you keep going indefinitely, and eventually you will run out of air."
	CRLF
	CALL PRINT-ID,STR?120
	CRLF
	CALL GOTO,OUTER-SPACE >STACK
	RSTACK
?L1:	CALL CORIOLIS >STACK
	RSTACK

	.FUNCT YELLOW-DOCK-EXITS
	ZERO? THIS-END /?L1
	ZERO? THAT-END /?L1
	PRINTI "You crawl across dock area, your magnetic boots overcoming the effect of centripetal force. The metal area they can cling to ends before you reach the edge of the dock, but thanks to your safety line you make it successfully to the tangle of debris."
	CRLF
	CRLF
	RETURN YELLOW-DOCK-EDGE
?L1:	PRINTI "You crawl across the dock area, your magnetic boots holding you safe. Unfortunately, the metallic area ends short of the tangle of debris. If you went further, you would be thrown into space by centripetal force."
	CRLF
	RFALSE

	.FUNCT YELLOW-DOCK-EDGE-FCN,RARG
	EQUAL? RARG,M-BEG \?L1
	CALL BRODY >STACK
	RSTACK
?L1:	EQUAL? RARG,M-END \FALSE
	ZERO? THIS-END /?L4
	ZERO? THAT-END \FALSE
?L4:	CALL QUEUE,I-SUFFOCATE,5 >STACK
	PUT STACK,0,1
	PRINTI "Now that you are no longer moored by the safety line, centripetal force throws you into space in a lovely trajectory which (as a matter of academic interest) looks curved from your perspective as the artifact rapidly rotates away under you."
	CRLF
	CRLF
	CALL GOTO,OUTER-SPACE >STACK
	RSTACK

	.FUNCT I-SUFFOCATE
	EQUAL? HERE,OUTER-SPACE \FALSE
	CALL PRINT-ID,STR?121
	CALL JIGS-UP,STR?122 >STACK
	RSTACK

	.FUNCT SCORCHED-PSEUDO
	EQUAL? PRSA,V?EXAMINE,V?TAKE \FALSE
	PRINTR "It's too far away."

	.FUNCT GREEN-DOORS-FCN,DIR
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,GREEN-LOCK \?L3
	EQUAL? PRSO,GREEN-INNER \?L5
	SET 'DIR,P?UP
	JUMP ?L9
?L5:	SET 'DIR,P?DOWN
	JUMP ?L9
?L3:	EQUAL? PRSO,GREEN-INNER \?L8
	SET 'DIR,P?DOWN
	JUMP ?L9
?L8:	SET 'DIR,P?UP
?L9:	CALL DO-WALK,DIR
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L10
	CALL AIRLOCK-OPEN,GREEN-INNER,GREEN-OUTER,GREEN-DOCK >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL AIRLOCK-LOOK,GREEN-INNER,GREEN-THREE,GREEN-DOCK >STACK
	RSTACK

	.FUNCT AIRLOCK-OPEN,INNER,OUTER,OUTLOC
	EQUAL? PRSO,INNER \?L1
	EQUAL? PRSA,V?PUSH,V?OPEN \?L3
	FSET? PRSO,OPENBIT \?L5
	CALL ALREADY,STR?17 >STACK
	RSTACK
?L5:	FSET? OUTER,OPENBIT \?L7
	PRINTR "It refuses to open and a bright light flashes incessantly until you remove your hand from the door."
?L7:	CALL DOOR-OPENS >STACK
	RSTACK
?L3:	FSET? PRSO,OPENBIT /?L11
	CALL ALREADY,STR?18 >STACK
	RSTACK
?L11:	CALL DOOR-CLOSES >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUSH,V?OPEN \?L13
	FSET? PRSO,OPENBIT \?L14
	CALL ALREADY,STR?17 >STACK
	RSTACK
?L14:	FSET? INNER,OPENBIT \?L16
	PRINTR "A bright light over the door flashes menacingly until you remove your hand."
?L16:	FSET PRSO,OPENBIT
	FSET? OUTLOC,SPACEBIT \?L20
	CALL VACUUM-HERE
	CRLF
	ZERO? SUIT-ON? \TRUE
	CRLF
	CALL PRINT-ID,STR?123
	CALL JIGS-UP,ACADEMY-DEATH
	RTRUE
?L20:	CALL DOOR-OPENS
	RTRUE
?L13:	FSET? PRSO,OPENBIT /?L26
	CALL ALREADY,STR?18 >STACK
	RSTACK
?L26:	FCLEAR PRSO,OPENBIT
	CALL AIR-HERE >STACK
	RSTACK

	.FUNCT IN-AIRLOCK?
	EQUAL? HERE,RED-LOCK,GREEN-LOCK,YELLOW-LOCK /TRUE
	EQUAL? HERE,BLUE-LOCK,SPACESHIP-AIRLOCK /TRUE
	RFALSE

	.FUNCT AIR-HERE
	PRINTI "The outer door closes"
	CALL IN-AIRLOCK? >STACK
	ZERO? STACK /?L3
	FCLEAR HERE,SPACEBIT
	PRINTI " and air rushes into the airlock"
?L3:	PRINTR "."

	.FUNCT VACUUM-HERE
	PRINTI "The outer door opens"
	CALL IN-AIRLOCK? >STACK
	ZERO? STACK /?L3
	FSET HERE,SPACEBIT
	PRINTI " and air rushes out of the airlock"
?L3:	PRINTI "."
	RTRUE

	.FUNCT AIRLOCK-LOOK,INNER,INNEXT,OUTNEXT
	FSET? PRSO,OPENBIT /?L1
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is closed and there is no viewport."
?L1:	EQUAL? PRSO,INNER \?L5
	CALL GO$0026LOOK,INNEXT >STACK
	RSTACK
?L5:	CALL GO$0026LOOK,OUTNEXT >STACK
	RSTACK

	.FUNCT GO$0026LOOK,RM,OHERE,OLIT,OSEEN=0
	SET 'OHERE,HERE
	FSET? OHERE,TOUCHBIT \?L1
	SET 'OSEEN,1
?L1:	SET 'OLIT,LIT
	SET 'HERE,RM
	CALL LIT?,RM >LIT
	CALL PERFORM,V?LOOK
	ZERO? OSEEN \?L4
	FCLEAR OHERE,TOUCHBIT
?L4:	SET 'HERE,OHERE
	SET 'LIT,OLIT
	RTRUE

	.FUNCT COUCH-FCN,RARG=0
	EQUAL? HERE,SPACESHIP-BRIDGE /?L1
	EQUAL? PRSA,V?BOARD,V?CLIMB-DOWN,V?CLIMB-ON \?L3
	PRINTR "That seat is taken...."
?L3:	CALL EX-CHECK >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L8
	EQUAL? RARG,M-BEG \?L9
	EQUAL? PRSO,COUCH \?L8
	CALL DESCRIBE-SEAT-BELT
	RTRUE
?L8:	EQUAL? RARG,M-BEG \?L9
	EQUAL? PRSA,V?WALK \?L10
	PRINTR "You'll have to stand up first."
?L10:	EQUAL? PRSA,V?DISEMBARK,V?STAND \?L14
	ZERO? SEAT-BELT? /?L14
	PRINTR "You must unfasten your seat belt first."
?L14:	EQUAL? PRSA,V?CLIMB-DOWN,V?CLIMB-ON \?L17
	CALL PERFORM,V?BOARD,COUCH
	RTRUE
?L17:	EQUAL? PRSA,V?TAKE-OFF \?L18
	EQUAL? PRSO,COUCH \?L18
	CALL PERFORM,V?DISEMBARK,COUCH
	RTRUE
?L18:	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "You can't reach it."
?L9:	EQUAL? RARG,M-ENTER \FALSE
	CALL DESCRIBE-SEAT-BELT >STACK
	RSTACK

	.FUNCT DESCRIBE-SEAT-BELT
	PRINTI "The couch has a seat belt which is currently "
	ZERO? SEAT-BELT? /?L3
	PRINTR "fastened."
?L3:	PRINTR "unfastened."

	.FUNCT SEAT-BELT-FCN
	IN? WINNER,COUCH /?L1
	PRINTR "You must sit down first."
?L1:	EQUAL? PRSA,V?LOCK,V?WEAR,V?TIE \?L5
	ZERO? SEAT-BELT? /?L6
	PRINTR "It's already fastened."
?L6:	SET 'SEAT-BELT?,1
	PRINTR "Click."
?L5:	EQUAL? PRSA,V?OPEN,V?TAKE-OFF,V?UNTIE /?L14
	EQUAL? PRSA,V?REMOVE,V?UNLOCK \?L13
?L14:	ZERO? SEAT-BELT? \?L15
	PRINTR "It's already unfastened."
?L15:	SET 'SEAT-BELT?,0
	PRINTR "Click."
?L13:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "The seat belt is "
	ZERO? SEAT-BELT? /?L25
	PRINTR "fastened."
?L25:	PRINTR "unfastened."

	.FUNCT BUREAU-PSEUDO
	EQUAL? PRSA,V?LOOK-INSIDE,V?OPEN \FALSE
	PRINTR "There is nothing in the bureau but some clothes."

	.FUNCT VILLAGE-NW-EDGE-FCN,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is the edge of a populated area, growing denser as you move starboard. Primitive huts line the corridor, which is blocked ahead by a palisade built of mud and wood. An open gate, guarded by several spear-bearing aliens, leads into the structure. A small crowd of aliens has gathered to watch you."
	CRLF
	ZERO? ALIENS-DESCRIBED? \?L5
	SET 'ALIENS-DESCRIBED?,1
	CALL DESCRIBE-WEASELS
	RANDOM 3 >STACK
	ADD 3,STACK >STACK
	CALL QUEUE,I-CHIEF-APPEARS,STACK >STACK
	PUT STACK,0,1
?L5:	ZERO? ALIENS-FRIENDLY? /?L8
	PRINTI "They gesture in a way intended to show friendship (they bare their huge razor-sharp teeth)."
	CRLF
	ZERO? HUSTLED? \?L20
	PRINTI "The smaller ones are hustled away, but almost immediately begin to sneak back."
	CRLF
	JUMP ?L20
?L8:	PRINTI "They stare at you with mingled awe and belligerence."
	CRLF
	ZERO? HUSTLED? \?L20
	PRINTI "The smaller ones are hustled away, leaving only the better-armed members of the tribe."
	CRLF
?L20:	SET 'HUSTLED?,1
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?GIVE \?L29
	EQUAL? PRSI,CHIEF /?L28
?L29:	EQUAL? PRSA,V?DROP \FALSE
	IN? CHIEF,HERE \FALSE
?L28:	CALL GIVE-TO-CHIEF >STACK
	RSTACK

	.FUNCT PALISADE-FCN
	EQUAL? PRSA,V?ZAP \?L1
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L1
	SET 'ALIENS-FRIENDLY?,0
	PRINTR "The palisade smolders a bit, but is otherwise undamaged."
?L1:	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-UP \FALSE
	PRINTR "The palisade is unclimbable."

	.FUNCT VILLAGE-FCN,RARG
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?WALK \?L3
	IN? SPACESUIT,CHIEF \?L3
	EQUAL? PRSO,P?EAST \?L3
	IN? CHIEF,VILLAGE /?L3
	LESS? CHFOLLOW,2 \?L3
	CALL PERFORM,V?FOLLOW,CHIEF
	RTRUE
?L3:	FSET? VIOLET-KEY,TOUCHBIT \FALSE
	CALL PRINT-ID,STR?124
	CALL JIGS-UP,STR?125 >STACK
	RSTACK
?L1:	EQUAL? RARG,M-ENTER \FALSE
	IN? SPACESUIT,VILLAGE \FALSE
	REMOVE JUNK-SPACESUIT
	MOVE SPACESUIT,CHIEF
	RFALSE

	.FUNCT ENTER-WARREN
	ZERO? ALIENS-FRIENDLY? /?L1
	RETURN MAZE
?L1:	PRINTI "Hostile weasels bar your way."
	CRLF
	RFALSE

	.FUNCT GIVE-TO-CHIEF
	EQUAL? PRSO,SPACESUIT \?L1
	ZERO? SUIT-ON? \FALSE
	MOVE JUNK-SPACESUIT,HERE
	FCLEAR JUNK-SPACESUIT,NDESCBIT
	MOVE SPACESUIT,CHIEF
	FSET SPACESUIT,NDESCBIT
	SET 'THIS-END,0
	SET 'THAT-END,0
	SET 'SUIT-ON?,0
	PRINTI "The chieftain removes his suit and dons yours. He is clearly delighted with the gift, and his people are truly impressed by his new wardrobe. He moves about, pointing at various objects (including some of his lesser wives and children) and glancing at you quizzically."
	CRLF
	CALL QUEUE,I-CHIEF,2 >STACK
	PUT STACK,0,1
	ZERO? POINTED? /TRUE
	PRINTR "He tries (somewhat sheepishly) to conceal the brown rod in the space suit, hoping you won't notice it."
?L1:	ZERO? ALIENS-FRIENDLY? \?L13
	PRINTR "He snarls at you, exposing razor-sharp teeth."
?L13:	IN? SPACESUIT,ADVENTURER \?L16
	PRINTR "The chief refuses your gift but gazes hungrily at your space suit."
?L16:	IN? SPACESUIT,CHIEF \?L19
	PRINTR "The chief considers the space suit to have been enough, and graciously refuses the gift."
?L19:	PRINTR "The chief looks pleased by the offer (as a token of your submission, no doubt), but turns it down."

	.FUNCT I-CHIEF-APPEARS
	EQUAL? HERE,VILLAGE \?L1
	FCLEAR GLOBAL-CHIEF,INVISIBLE
	MOVE CHIEF,HERE
	PRINTI "From down a passage between the hovels appears a large, almost all-grey alien."
	CRLF
	IN? SPACESUIT,CHIEF \?L5
	PRINTI "He is wearing a human space suit and grinning cheerfully."
	CRLF
	JUMP ?L9
?L5:	PRINTI "He is dressed in the tattered remains of a space suit of alien manufacture. Only the helmet and scraps of the body material remain."
	CRLF
?L9:	IN? BROWN-KEY,CHIEF \?L12
	PRINTI "Around his neck hangs a brown crystal rod!"
	CRLF
?L12:	PRINTI "The crowd parts to let him through."
	CRLF
	IN? SPACESUIT,ADVENTURER \?L19
	PRINTI "He looks at you in awe, staring at your space suit. He points to it, and then at himself, and brandishes his spear menacingly."
	CRLF
	JUMP ?L23
?L19:	ZERO? ALIENS-FRIENDLY? /?L23
	PRINTI "He greets you warmly."
	CRLF
?L23:	CALL QUEUE,I-CHIEF,2 >STACK
	PUT STACK,0,1
	RTRUE
?L1:	ZERO? ACTIVITY? \?L30
	SET 'ACTIVITY?,1
	EQUAL? HERE,VILLAGE,VILLAGE-NW-EDGE \?L30
	PRINTI "There seems to be activity in the village center."
	CRLF
?L30:	CALL QUEUE,I-CHIEF-APPEARS,1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT DESCRIBE-WEASELS
	PRINTR "They resemble human-sized weasels. Their bodies are thin, flexible, and covered with several colors of hair. There are all sizes and ages, and the stronger ones are armed with spears, knives, and other nasty hardware."

	.FUNCT ALIENS-FCN
	IN? CHIEF,HERE \?L1
	EQUAL? PRSA,V?ATTACK,V?ZAP /?L1
	EQUAL? ALIENS,WINNER \?L3
	SET 'WINNER,CHIEF
	CALL PERFORM,PRSA,PRSO,PRSI
	RTRUE
?L3:	EQUAL? PRSO,CHIEF \?L5
	CALL PERFORM,PRSA,CHIEF,PRSI
	RTRUE
?L5:	EQUAL? PRSI,CHIEF \?L6
	CALL PERFORM,PRSA,PRSO,CHIEF
	RTRUE
?L6:	PRINTR "You are ignored."
?L1:	EQUAL? PRSA,V?SMILE \?L10
	ZERO? ALIENS-FRIENDLY? /?L11
	PRINTR "It smiles back."
?L11:	PRINTR "It snarls at you."
?L10:	EQUAL? PRSA,V?TELL \?L18
	SET 'P-CONT,0
	PRINTR "The aliens pay no heed."
?L18:	EQUAL? HERE,GRASSLAND-2 \?L21
	GRTR? HUNTER-COUNT,0 \?L22
	EQUAL? PRSA,V?EXAMINE,V?FIND /FALSE
	CALL SPOILED-HUNT
	EQUAL? PRSA,V?ZAP \TRUE
	CRLF
	CALL ZAP-ALIENS
	PRINTR "The hunting party scatters."
?L22:	PRINTR "There are no aliens here."
?L21:	EQUAL? PRSA,V?ZAP \?L35
	CALL ZAP-ALIENS >STACK
	RSTACK
?L35:	EQUAL? PRSA,V?FOLLOW \?L36
	PRINTR "They aren't going anywhere."
?L36:	EQUAL? PRSA,V?MUNG,V?KILL,V?ATTACK /?L40
	EQUAL? PRSA,V?THROW \FALSE
?L40:	SET 'ALIENS-FRIENDLY?,0
	PRINTI "The weasels shy away in fright."
	CRLF
	CALL PRINT-ID,STR?126 >STACK
	RSTACK

	.FUNCT ZAP-ALIENS,ZAP-CHIEF?=0
	SET 'ALIENS-FRIENDLY?,0
	ZERO? ZAP-CNT \?L1
	PRINTI "Nothing happens. Emboldened, the aliens surround you."
	CRLF
	CALL PRINT-ID,STR?127 >STACK
	RSTACK
?L1:	FIRST? ZAP-GUN >STACK \?L5
	CALL ZAP-GUN-FCN
	PRINTI "The aliens are impressed and terrified."
	CRLF
	CALL PRINT-ID,STR?128 >STACK
	RSTACK
?L5:	DEC 'ZAP-CNT
	ZERO? ZAP-CHIEF? /?L9
	IN? CHIEF,HERE \?L9
	PRINTI "The chief is"
	CALL INT,I-CHIEF >STACK
	PUT STACK,0,0
	REMOVE CHIEF
	JUMP ?L13
?L9:	PRINTI "Many aliens are"
?L13:	PRINTI " disintegrated, in the best tradition of the 1930s pulps. The remainder of the tribe attacks you, seeking revenge. You fire the ray gun at them. "
	CALL PRINT-ID,STR?129
	GRTR? ZAP-CNT,0 \?L18
	PRINTI "It fires "
	SUB ZAP-CNT,1 >STACK
	GET ZAP-STRS,STACK >STACK
	PRINT STACK
	PRINTI ". Each time many aliens are dispatched, but more appear."
	CRLF
	CALL PRINT-ID,STR?130
	JUMP ?L22
?L18:	PRINTI "Nothing happens."
	CRLF
	CALL PRINT-ID,STR?131
?L22:	SET 'ZAP-CNT,0
	CALL PRINT-ID,STR?132
	CALL JIGS-UP,STR?133 >STACK
	RSTACK

	.FUNCT CHIEF-FCN,RARG=0,SUIT?
	EQUAL? RARG,M-OBJDESC \?L1
	PRINTI "The chief alien"
	IN? JUNK-SPACESUIT,CHIEF /?L7
	SET 'SUIT?,0
	JUMP ?L5
?L7:	SET 'SUIT?,1
	PRINTI ", wearing a tattered space suit"
	JUMP ?L11
?L5:	IN? SPACESUIT,CHIEF /?L12
	SET 'SUIT?,0
	JUMP ?L11
?L12:	SET 'SUIT?,1
	PRINTI ", wearing your space suit"
?L11:	IN? BROWN-KEY,CHIEF \?L17
	PRINTI " and a brown crystal rod,"
	JUMP ?L21
?L17:	ZERO? SUIT? /?L21
	PRINTI ","
?L21:	PRINTR " is here."
?L1:	EQUAL? PRSA,V?FOLLOW \?L27
	IN? CHIEF,HERE \?L28
	PRINTR "You can't follow him until he leaves..."
?L28:	LESS? CHFOLLOW,2 \?L32
	SET 'CHFOLLOW,0
	DEC 'CHPATH
	ZERO? CHPATH \?L33
	CALL QUEUE,I-CHIEF,1 >STACK
	PUT STACK,0,1
	MOVE CHIEF,GREEN-THREE
	CALL GOTO,GREEN-THREE
	RTRUE
?L33:	MOVE CHIEF,MAZE
	CALL GOTO,MAZE
	RTRUE
?L32:	EQUAL? HERE,VILLAGE \?L36
	CALL DO-WALK,P?EAST
	RTRUE
?L36:	PRINTR "You have lost track of him in the maze of twists and turns."
?L27:	IN? CHIEF,HERE /?L40
	PRINTR "There is no chief here."
?L40:	EQUAL? PRSA,V?HELLO,V?TELL /?L44
	EQUAL? CHIEF,WINNER \?L43
	IN? CHIEF,HERE \?L43
?L44:	SET 'P-CONT,0
	PRINTR "The chief listens intently, then responds in his own language, probably saying something like ""That's Greek to me."""
?L43:	EQUAL? PRSA,V?EXAMINE \?L47
	PRINTI "The chief is a perfect example of barbarian dignity and splendor."
	IN? SPACESUIT,CHIEF \?L50
	PRINTR " He is wearing your space suit with the same dignity and aplomb which which a dandy would wear his evening clothes."
?L50:	IN? BROWN-KEY,CHIEF \?L54
	PRINTI " Tied around his neck with a string is a brown crystal rod."
?L54:	CRLF
	RTRUE
?L47:	EQUAL? PRSA,V?SMILE \?L58
	ZERO? ALIENS-FRIENDLY? /?L59
	PRINTR "He smiles back."
?L59:	PRINTR "He snarls at you."
?L58:	EQUAL? PRSA,V?ZAP \?L66
	CALL ZAP-ALIENS,1 >STACK
	RSTACK
?L66:	EQUAL? PRSA,V?MUNG,V?ATTACK \?L67
	CALL PRINT-ID,STR?134
	SET 'ALIENS-FRIENDLY?,0
	RFALSE
?L67:	EQUAL? PRSA,V?POINT \?L68
	PRINTR "The chief seems puzzled."
?L68:	EQUAL? PRSA,V?GIVE \FALSE
	CALL GIVE-TO-CHIEF >STACK
	RSTACK

	.FUNCT BROWN-KEY-FCN
	IN? BROWN-KEY,CHIEF \FALSE
	EQUAL? PRSA,V?ZAP \?L3
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?ZAP,CHIEF
	RTRUE
?L3:	EQUAL? PRSA,V?TAKE \?L5
	PRINTI "The chief jumps back and waves his spear at you angrily!"
	CRLF
	CALL PRINT-ID,STR?135 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?POINT \FALSE
	SET 'POINTED?,1
	IN? SPACESUIT,CHIEF \?L9
	FCLEAR BROWN-KEY,NDESCBIT
	CALL SCORE-OBJ,BROWN-KEY
	MOVE BROWN-KEY,ADVENTURER
	SET 'ALIENS-FRIENDLY?,1
	PRINTR "The chief hesitates, understanding you all too well, then reluctantly removes the rod from its string and hands it to you."
?L9:	IN? SPACESUIT,ADVENTURER \?L13
	PRINTR "The chief looks at you shrewdly, then points at your space suit."
?L13:	PRINTI "The chief is offended."
	CRLF
	CALL PRINT-ID,STR?136 >STACK
	RSTACK

	.FUNCT WIFE-PSEUDO
	EQUAL? PRSA,V?ZAP \?L1
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L1
	SET 'ALIENS-FRIENDLY?,0
	PRINTI "She is vaporized by the blast! Fortunately, the chief, has many wives, and this was a lesser one."
	CRLF
	CALL PRINT-ID,STR?137 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?POINT,V?TAKE \FALSE
	IN? BROWN-KEY,CHIEF \FALSE
	IN? SPACESUIT,CHIEF \FALSE
	PRINTR "She snarls at her husband and grimaces at you. The chief waves his hands as if to say ""Never mind."""

	.FUNCT CHILD-PSEUDO
	EQUAL? PRSA,V?ZAP \?L1
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L1
	SET 'ALIENS-FRIENDLY?,0
	PRINTR "The agile young weasel dodges the blast, laughing at you."
?L1:	EQUAL? PRSA,V?POINT,V?TAKE \FALSE
	IN? BROWN-KEY,CHIEF \FALSE
	IN? SPACESUIT,CHIEF \FALSE
	PRINTR "The child sticks its tongue at you and scampers off. Other young weasels caper about, making noises that sound much like laughter."

	.FUNCT MAZE-FCN,RARG
	FCLEAR MAZE,TOUCHBIT
	IN? CHIEF,VILLAGE \?L1
	CALL QUEUE,I-CHIEF,0
	REMOVE CHIEF
?L1:	EQUAL? RARG,M-BEG \?L4
	EQUAL? PRSA,V?WALK \?L6
	RANDOM 100 >STACK
	GRTR? 5,STACK \?L6
	CALL GOTO,VILLAGE >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?DROP \FALSE
	PRINTI "As soon as you drop the "
	PRINTD PRSO
	PRINTI ", one of the smaller creatures rushes over and grabs it! He charges out of the room, squeaking with glee."
	CRLF
	RANDOM 100 >STACK
	GRTR? 25,STACK \?L11
	PRINTI "With a roar, an older weasel grabs the young one before it escapes and cuffs it soundly about the ears. The elder creature hands you back the "
	PRINTD PRSO
	PRINTR ", grinning and grunting in a friendly way."
?L11:	REMOVE PRSO
	RTRUE
?L4:	EQUAL? RARG,M-ENTER \FALSE
	CALL ROB,HERE,THRONE-ROOM >STACK
	RSTACK

	.FUNCT I-CHIEF,OLDP
	LOC CHIEF >OLDP
	IN? CHIEF,VILLAGE \?L1
	IN? BROWN-KEY,CHIEF \?L1
	GRTR? CHWAIT,10 /?L1
	INC 'CHWAIT
	IN? CHIEF,HERE \?L3
	PRINTI "The chief gestures impatiently at "
	IN? SPACESUIT,ADVENTURER /?L9
	IN? SPACESUIT,HERE \?L7
?L9:	PRINTI "your space suit."
	JUMP ?L15
?L7:	IN? SPACESUIT,CHIEF \?L12
	PRINTI "various objects."
	JUMP ?L15
?L12:	PRINTI "you."
?L15:	CRLF
?L3:	CALL QUEUE,I-CHIEF,2 >STACK
	PUT STACK,0,1
	RTRUE
?L1:	IN? CHIEF,GREEN-THREE \?L19
	PRINTI "The chief grins, exposing his pointy teeth, and points portentiously at the ladder. He curls up on the dirt floor and waits, watching you with interest."
	CRLF
	CALL INT,I-CHIEF >STACK
	PUT STACK,0,0
	RTRUE
?L19:	REMOVE CHIEF
	INC 'CHFOLLOW
	GRTR? CHWAIT,10 \?L23
	IN? WINNER,OLDP \?L25
	PRINTI "The chief appears insulted and disappears into the warren. The others appear to be upset."
	CRLF
?L25:	SET 'ALIENS-FRIENDLY?,0
	SET 'CHFOLLOW,2
	RTRUE
?L23:	IN? WINNER,OLDP \?L31
	SET 'CHFOLLOW,0
	EQUAL? OLDP,VILLAGE \?L33
	RANDOM 5 >STACK
	ADD 5,STACK >CHPATH
?L33:	CALL PICK-ONE,CHIEF-MOVES >STACK
	PRINT STACK
	CRLF
	JUMP ?L43
?L31:	IN? WINNER,MAZE \?L43
	RANDOM 100 >STACK
	GRTR? 5,STACK \?L39
	MOVE CHIEF,MAZE
	SET 'CHFOLLOW,0
	PRINTI "The chief enters the room and seems surprised but pleased to see you."
	CRLF
	JUMP ?L43
?L39:	INC 'CHWAIT
?L43:	RANDOM 100 >STACK
	GRTR? 75,STACK \?L45
	PUSH 1
	JUMP ?L47
?L45:	PUSH 2
?L47:	CALL QUEUE,I-CHIEF,STACK >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT SKELETON-FCN
	EQUAL? PRSA,V?MOVE,V?RUB,V?TAKE \?L1
	FSET? VIOLET-KEY,INVISIBLE \?L3
	MOVE VIOLET-KEY,THRONE-ROOM
	FCLEAR VIOLET-KEY,INVISIBLE
	CALL THIS-IS-IT,VIOLET-KEY
	PRINTR "When you touch the skeleton, its arm falls off the armrest. Something slides out of the space suit and onto the floor."
?L3:	SET 'ALIENS-FRIENDLY?,0
	CALL PRINT-ID,STR?138
	CALL JIGS-UP,STR?139 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?ZAP \FALSE
	CALL CAN-ZAP? >STACK
	ZERO? STACK /FALSE
	SET 'ALIENS-FRIENDLY?,0
	CALL PRINT-ID,STR?140
	CALL JIGS-UP,STR?141 >STACK
	RSTACK

	.FUNCT ITS-CLOSED,OBJ
	PRINTI "The "
	PRINTD OBJ
	PRINTI " is closed."
	CRLF
	CALL THIS-IS-IT,OBJ
	RFALSE

	.FUNCT GREEN-LOCK-EXIT
	FSET? GREEN-INNER,OPENBIT /?L1
	CALL ITS-CLOSED,GREEN-INNER >STACK
	RSTACK
?L1:	FSET? VIOLET-KEY,INVISIBLE \?L3
	RETURN GREEN-THREE
?L3:	ZERO? CAUGHT? /?L4
	PRINTI "Outraged aliens bar your way."
	CRLF
	RFALSE
?L4:	CALL ALIEN-GUARDS
	RFALSE

	.FUNCT GREEN-THREE-FCN,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FSET? VIOLET-KEY,INVISIBLE /FALSE
	CALL ALIEN-GUARDS
	RETURN 2

	.FUNCT ALIEN-GUARDS
	SET 'CAUGHT?,1
	SET 'ALIENS-FRIENDLY?,0
	REMOVE VIOLET-KEY
	CALL PRINT-ID,STR?142
	CALL JIGS-UP,STR?143
	RETURN 2

	.FUNCT NEST-CAGE-FCN,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The force projectors here aren't working, but the cage is nonetheless inhabited by many creatures who resemble crosses between a rat and an ant. They are multi-legged with chitinous shells and pincers around their mouths, but they have long ratlike tails and sparse tufts of hair. Some of them are armed with tiny spears and walk precariously on their hind legs."
	IN? NEST,NEST-CAGE \?L5
	PRINTI " In one corner is a very large mud and stick nest."
	FIRST? NEST >STACK \?L24
	PRINTI " The nest is constructed of all sorts of odds and ends, including "
	CALL PRINT-CONTENTS,NEST
	PRINTI "."
	IN? RED-KEY,NEST \?L24
	PRINTI " The rod is embedded in the mud near one of the entrances of the nest."
	JUMP ?L24
?L5:	IN? SMASHED-NEST,NEST-CAGE \?L24
	PRINTI " In one corner is a ruined nest which has been broken into many smaller pieces."
	FIRST? SMASHED-NEST >STACK \?L24
	PRINTI " Resting among the fragments of the nest can be seen "
	CALL PRINT-CONTENTS,SMASHED-NEST
	PRINTI "."
?L24:	ZERO? RATS-MAD? /?L32
	PRINTI " The rat-ants are extremely agitated by your presence, and a detail follows you just out of reach, hissing and clicking their mandibles."
	CALL PRINT-ID,STR?144
?L32:	CRLF
	RTRUE

	.FUNCT RAT-ANT-FCN
	EQUAL? PRSA,V?TELL \?L1
	PRINTI "The rat-ant ignores you."
	CRLF
	SET 'P-CONT,0
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	PRINTR "They look like a cross between a rat and an ant. They have chitinous shells, mandibles, and exhibit an ant-like social order. They also have hair, bear live young, and are roughly the size of rats. They have a crude intelligence, evidenced by the spears of the warrior caste. The cage has many rat-ants of varying sizes, ages, and social roles."
?L5:	EQUAL? PRSA,V?ZAP \?L8
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L8
	SET 'RATS-MAD?,1
	PRINTR "Several rat-ant warriors are reduced to ash, but many more rush out to replace them, and these look mad!"
?L8:	EQUAL? PRSA,V?MUNG \?L11
	SET 'RATS-MAD?,1
	PRINTR "The rat-ants become ferocious, rushing about clicking their mandibles and squeaking."
?L11:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,RAT-ANT \FALSE
	FSET PRSO,NDESCBIT
	IN? NEST,HERE \?L15
	PUSH NEST
	JUMP ?L18
?L15:	IN? SMASHED-NEST,HERE \?L17
	PUSH SMASHED-NEST
	JUMP ?L18
?L17:	PRINTR "The rat-ants ignore you in their grief."
?L18:	MOVE PRSO,STACK
	PRINTI "A rat-ant takes the "
	PRINTD PRSO
	PRINTR " and incorporates it into the nest."

	.FUNCT NEST-FCN,TOOL=0
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The nest is a jerry-built construction of odds and ends precariously stuck together. Rat-ants swarm all over it."
?L1:	EQUAL? PRSA,V?KICK \?L5
	PRINTI "Rat-ants nip at your toes and prevent it."
	CRLF
	CALL PRINT-ID,STR?145 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?MUNG \?L10
	EQUAL? PRSO,NEST \?L10
	ZERO? PRSI \?L9
?L10:	EQUAL? PRSA,V?THROW \?L8
	EQUAL? PRSI,NEST \?L8
	ZERO? PRSO /?L8
?L9:	EQUAL? PRSA,V?MUNG \?L11
	SET 'TOOL,PRSI
	JUMP ?L13
?L11:	SET 'TOOL,PRSO
?L13:	EQUAL? TOOL,HANDS \?L14
	PRINTR "Rat-ants snap at you with their nasty sharp mandibles."
?L14:	IN? TOOL,WINNER /?L18
	CALL DONT-HAVE,TOOL
	RTRUE
?L18:	GETP TOOL,P?SIZE >STACK
	GRTR? STACK,5 \?L19
	FSET TOOL,NDESCBIT
	MOVE TOOL,SMASHED-NEST
	IN? RED-KEY,NEST \?L20
	FSET RED-KEY,TOUCHBIT
	FSET RED-KEY,NDESCBIT
	MOVE RED-KEY,SMASHED-NEST
?L20:	MOVE SMASHED-NEST,NEST-CAGE
	CALL ROB,NEST,SMASHED-NEST,1
	REMOVE NEST
	CALL QUEUE,I-NEST,15 >STACK
	PUT STACK,0,1
	PRINTI "The nest smashes into fragments and the rat-ants stop dead in their tracks! They frantically evacuate the nest and immediately begin constructing a new nest at the opposite end of the cage. Rat-ant babies are being carried across the cage, and warriors watch you suspiciously."
	CRLF
	CALL PRINT-ID,STR?146 >STACK
	RSTACK
?L19:	FSET TOOL,NDESCBIT
	MOVE TOOL,NEST
	PRINTI "The "
	PRINTD TOOL
	PRINTI " doesn't damage the nest very much, and in fact a rat-ant quickly incorporates it into the nest."
	CRLF
	CALL PRINT-ID,STR?147 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?ZAP \FALSE
	REMOVE NEST
	CALL INT,I-NEST >STACK
	PUT STACK,0,0
	PRINTI "The nest and all it contains is destroyed."
	CRLF
	CALL PRINT-ID,STR?148 >STACK
	RSTACK

	.FUNCT I-NEST
	MOVE NEST,NEST-CAGE
	CALL ROB,SMASHED-NEST,NEST,1
	CALL ROB,NEST-CAGE,NEST,1
	REMOVE SMASHED-NEST
	EQUAL? HERE,NEST-CAGE \FALSE
	PRINTR "The rat-ants have completed their new nest, frugally incorporating all the materials from the old nest. They leave a few guards to watch you while the others retire inside for a well-earned rest."

	.FUNCT NEST-CONT
	EQUAL? PRSA,V?TAKE \FALSE
	PRINTI "As you reach for the "
	PRINTD PRSO
	PRINTI ", a rat-ant pokes its head out of the nest and snaps at you with its needle-sharp mandibles. You draw back just in time."
	CRLF
	CALL PRINT-ID,STR?149 >STACK
	RSTACK

	.FUNCT SMASHED-NEST-CONT
	EQUAL? PRSA,V?TAKE \FALSE
	FCLEAR PRSO,NDESCBIT
	RFALSE

	.FUNCT PANEL-FCN
	EQUAL? PRSA,V?OPEN \FALSE
	FSET? PANEL,OPENBIT /FALSE
	FSET PANEL,OPENBIT
	PRINTI "Opening the access panel reveals rack upon rack of metallic cards."
	IN? CARD,SLOT \?L5
	PRINTR " All the slots have cards in them."
?L5:	PRINTR " There is one slot that has no card in it."

	.FUNCT SLOT-FCN
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,CARD \?L3
	IN? CARD,SLOT \?L5
	PRINTR "It's already there."
?L5:	MOVE CARD,SLOT
	PRINTI "The card slides snugly into the slot."
	ZERO? SWITCH-ON? /?L12
	SET 'FRIED?,1
	CALL QUEUE,I-MELTDOWN,2 >STACK
	PUT STACK,0,1
	PRINTI " Almost immediately the smell of burning components assaults your nostrils, and smoke pours from the card."
	CALL PRINT-ID,STR?150
?L12:	CRLF
	RTRUE
?L3:	CALL WONT-FIT >STACK
	RSTACK

	.FUNCT I-MELTDOWN
	ZERO? SWITCH-ON? /FALSE
	SET 'MELTED?,1
	SET 'SWITCH-ON?,0
	REMOVE CARD
	PRINTI "The computer has now been completely fried by this electrical fire. Congratulations!"
	CRLF
	CALL PRINT-ID,STR?151 >STACK
	RSTACK

	.FUNCT CAN-ZAP?
	ZERO? ZAP-CNT /FALSE
	IN? SILVER-KEY,ZAP-GUN /FALSE
	DEC 'ZAP-CNT
	RTRUE

	.FUNCT ZAP-GUN-FCN,I
	FIRST? ZAP-GUN >I /?L1
?L1:	EQUAL? PRSA,V?EXAMINE \?L2
	PRINTR "It looks like the heavy duty model. It's got quite a bit of heft to it, and you really need two hands to aim it properly. The barrel is long and festooned with strange knobs and antennae. There is a charge indicator which is unfortunately unreadable."
?L2:	EQUAL? PRSA,V?OPEN \?L6
	PRINTR "You can't open that."
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \?L9
	ZERO? I /?L10
	FSET ZAP-GUN,OPENBIT
	PRINTI "In the barrel is a "
	PRINTD I
	PRINTI "!"
	CRLF
	CALL SCORE-OBJ,I
	RTRUE
?L10:	PRINTR "There is nothing inside the barrel."
?L9:	EQUAL? PRSA,V?SHAKE \?L17
	ZERO? I /?L17
	PRINTR "It rattles loudly."
?L17:	EQUAL? PRSA,V?PUT \?L20
	EQUAL? ZAP-GUN,PRSI \?L20
	ZERO? I /?L21
	PRINTR "There is already something inside it."
?L21:	FSET? PRSO,KEYBIT /FALSE
	CALL WONT-FIT >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?POINT \?L27
	PRINTR "Why don't you just fire it instead?"
?L27:	EQUAL? PRSA,V?ATTACK,V?MUNG \?L30
	PRINTI "Firing the ray gun is more efficient than smashing things with it."
	CRLF
	CALL PRINT-ID,STR?152 >STACK
	RSTACK
?L30:	EQUAL? PRSA,V?ZAP \?L33
	IN? ZAP-GUN,WINNER /?L34
	PRINTR "You are firing it by mental force, I assume?"
?L34:	ZERO? ZAP-CNT \?L38
	PRINTR """Click."""
?L38:	DEC 'ZAP-CNT
	ZERO? I /?L42
	REMOVE I
	FSET ZAP-GUN,OPENBIT
	ZERO? ZAP-CNT /?L44
	DEC 'ZAP-CNT
?L44:	PRINTI "A giant blast"
	EQUAL? I,SILVER-KEY \?L49
	PRINTI " of silvery rays"
?L49:	PRINTR " issues from the barrel, but it doesn't go very far. In fact, there is a secondary explosion about a foot from the barrel, scattering dust motes in the air. There is almost no recoil: instead the gun vibrated almost painfully. This felt like a misfire."
?L42:	FSET? HERE,RAIRBIT \?L56
	CALL JATO >STACK
	RSTACK
?L56:	ZERO? PRSI \?L57
	PRINTI "A giant blast of searing orange rays issues from the barrel, and the recoil knocks you flat on your back. Fortunately no one was standing in front of you or it would have been curtains."
	CRLF
	CALL PRINT-ID,STR?153 >STACK
	RSTACK
?L57:	EQUAL? PRSI,ME,HANDS \?L60
	CALL ROB,WINNER
	CALL PRINT-ID,STR?154
	CALL JIGS-UP,STR?155 >STACK
	RSTACK
?L60:	EQUAL? PRSI,ZAP-GUN \?L61
	PRINTR "That would involve a higher technology than even the builders of the ray gun possessed."
?L61:	FSET? PRSI,VILLAIN \?L64
	CALL PRINT-ID,STR?156
	REMOVE PRSI
	PRINTI "A mighty wash of orange rays and smoke covers the "
	PRINTD PRSI
	PRINTI ". The powerful blast knocks you down as the poor "
	PRINTD PRSI
	PRINTR " is utterly disintegrated."
?L64:	IN? PRSI,WINNER \?L67
	CALL ROB,WINNER
	PRINTI "A huge explosion of orange rays destroys the "
	PRINTD PRSI
	PRINTI " utterly."
	CRLF
	CALL PRINT-ID,STR?157
	CALL JIGS-UP,STR?158 >STACK
	RSTACK
?L67:	FSET? PRSI,TAKEBIT /?L71
	FSET? PRSI,VICBIT \?L70
?L71:	CALL PRINT-ID,STR?159
	REMOVE PRSI
	PRINTI "There is a horrendous explosion from the ray gun, and a huge gout of orange rays envelops the "
	PRINTD PRSI
	PRINTI ". You are knocked spinning by the recoil, and when you recover, you see no sign of the "
	PRINTD PRSI
	PRINTR " but a tiny drift of dust."
?L70:	PRINTI "An explosion of orange rays sweeps over the "
	PRINTD PRSI
	PRINTI ", but when the smoke clears, it is still there (though perhaps a bit singed)."
	CRLF
	CALL PRINT-ID,STR?160 >STACK
	RSTACK
?L33:	EQUAL? PRSA,V?ATTACK,V?MUNG,V?KILL \FALSE
	EQUAL? ZAP-GUN,PRSI \FALSE
	CALL PERFORM,V?ZAP,PRSI,PRSO
	RTRUE

	.FUNCT TREE-FCN
	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-ON,V?CLIMB-UP \?L1
	CALL DO-WALK,P?UP
	RTRUE
?L1:	EQUAL? HERE,SCRUB,SCRUB-2 /FALSE
	EQUAL? PRSA,V?CLIMB-DOWN \FALSE
	CALL DO-WALK,P?DOWN
	RTRUE

	.FUNCT UP-A-TREE-EXIT
	IN? SPACESUIT,WINNER /?L3
	IN? JUNK-SPACESUIT,WINNER \?L1
?L3:	PRINTI "You can't climb with that bulky suit."
	CRLF
	RFALSE
?L1:	RETURN UP-A-TREE

	.FUNCT UP-A-TREE-FCN,RARG
	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROW,V?DROP \?L3
	MOVE PRSO,BASE-OF-TREE
	PRINTI "The "
	PRINTD PRSO
	PRINTR " drops out of sight."
?L3:	EQUAL? PRSA,V?FLY \?L7
	CALL PRINT-ID,STR?161
	CALL JIGS-UP,STR?162 >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?LEAP \FALSE
	CALL PRINT-ID,STR?163
	CALL JIGS-UP,STR?164 >STACK
	RSTACK

	.FUNCT TREETOP-FCN,RARG
	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROW,V?DROP \?L3
	CALL IDROP >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSO,SPACESUIT,SAFETY-LINE \?L7
	GETP PRSO,P?ACTION >STACK
	CALL STACK >STACK
	ZERO? STACK \TRUE
?L7:	MOVE PRSO,BASE-OF-TREE
	PRINTI "The "
	PRINTD PRSO
	PRINTR " drops out of sight."
?L3:	EQUAL? PRSA,V?FLY \?L13
	CALL PRINT-ID,STR?165
	CALL JIGS-UP,STR?162 >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?LEAP \FALSE
	PRINTI "Gravity is almost non-existent here, so your jump easily carries you to the hatch of the drive bubble."
	CRLF
	CRLF
	CALL GOTO,DRIVE-BUBBLE-ENTRANCE >STACK
	RSTACK

	.FUNCT DRIVE-BUBBLE-ENTRANCE-FCN,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are floating (clinging?) outside the drive bubble, a crystalline half-sphere covering the aft end of the artifact's axis of rotation. Small knobs like handholds lead up the surface of the bubble, away from the end of the cylinder. The drive bubble is transparent and through it you can see the controls for the main engines of the artifact, which must be aft of here. The only way in is a hatch which is "
	FSET? DRIVE-BUBBLE-HATCH,OPENBIT \?L5
	PRINTI "open."
	JUMP ?L9
?L5:	PRINTI "closed."
?L9:	PRINTI " Beside the hatch is a silver slot"
	IN? SILVER-KEY,SILVER-SLOT \?L14
	PRINTI " containing a silver rod"
?L14:	PRINTR "."
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROW,V?DROP \?L22
	CALL BOMBS-AWAY >STACK
	RSTACK
?L22:	CALL SWAN-DIVE,DRIVE-BUBBLE >STACK
	RSTACK

	.FUNCT SWAN-DIVE,BUB
	EQUAL? PRSA,V?LEAP /?L3
	EQUAL? PRSA,V?PUSH \FALSE
	EQUAL? PRSO,BUB \FALSE
?L3:	CALL PRINT-ID,STR?166
	CALL JIGS-UP,STR?167 >STACK
	RSTACK

	.FUNCT DRIVE-BUBBLE-FCN
	EQUAL? PRSA,V?BOARD,V?CLIMB-ON,V?CLIMB-UP \FALSE
	CALL DO-WALK,P?UP
	RTRUE

	.FUNCT CONTROL-BUBBLE-FCN
	EQUAL? PRSA,V?BOARD,V?CLIMB-ON,V?CLIMB-UP \FALSE
	CALL DO-WALK,P?UP
	RTRUE

	.FUNCT OUT-OF-REACH
	PRINTR "It's out of reach above you."

	.FUNCT DRIVE-BUBBLE-ROOM-FCN,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "The drive bubble is on the axis of rotation at the aft end of the artifact, so there is no ""gravity"" here. It is transparent and you can see the tips of the tallest trees of the forest beyond. Far off, at the opposite end of the axis, is another bubble much like this one. "
	IN? WHITE-KEY,WHITE-SLOT \?L5
	PRINTI "The room's gray walls are covered with traceries of white outlining controls, buttons, dials, and indicators. In addition, a black slot surrounded by an ominous dead-black circle is next to a white slot containing a white rod."
	JUMP ?L9
?L5:	PRINTI "The room is a featureless gray except for one small white slot."
?L9:	PRINTI " One way out is the hatch, which is "
	FSET? DRIVE-BUBBLE-HATCH,OPENBIT \?L14
	PRINTR "open."
?L14:	PRINTR "closed."
?L1:	EQUAL? RARG,M-BEG \FALSE
	CALL BUBBLE-BOUNCE >STACK
	RSTACK

	.FUNCT BUBBLE-BOUNCE
	EQUAL? PRSA,V?WALK \?L1
	EQUAL? PRSO,P?UP,P?NORTH \?L1
	PRINTR "You can't walk in that direction, as there is no gravity here. You could jump, perhaps..."
?L1:	EQUAL? PRSA,V?LEAP \FALSE
	PRINTR "You push off the floor, and because there is no weight you zoom into the air and rebound against the transparent surface of the bubble!"

	.FUNCT WHITE-KEY-FCN
	EQUAL? PRSA,V?TAKE \?L1
	IN? WHITE-KEY,WHITE-SLOT \?L1
	REMOVE BLACK-SLOT
	FCLEAR WHITE-KEY,NDESCBIT
	MOVE WHITE-KEY,WINNER
	PRINTR "When you remove the rod, the displays fade and the wall becomes featureless gray, except for the white slot."
?L1:	EQUAL? PRSA,V?PUT \FALSE
	CALL TRYTAKE >STACK
	ZERO? STACK /FALSE
	EQUAL? PRSO,WHITE-KEY \FALSE
	EQUAL? PRSI,WHITE-SLOT \FALSE
	FSET WHITE-KEY,TOUCHBIT
	FSET WHITE-KEY,NDESCBIT
	MOVE BLACK-SLOT,DRIVE-BUBBLE-ROOM
	MOVE WHITE-KEY,WHITE-SLOT
	PRINTR "As you insert the rod, the walls come alive with a white tracery of controls, dials, and gauges. In addition, a black slot surrounded by an ominous dead-black circle appears."

	.FUNCT ON-DRIVE-BUBBLE-FCN,RARG
	EQUAL? RARG,M-BEG \FALSE
	CALL ON-BUBBLE-FCN,DRIVE-BUBBLE,AXIS-1 >STACK
	RSTACK

	.FUNCT SILVER-SLOT-CONT
	CALL HATCH-CLOSE,DRIVE-BUBBLE-HATCH >STACK
	RSTACK

	.FUNCT GOLD-SLOT-CONT
	CALL HATCH-CLOSE,CONTROL-BUBBLE-HATCH >STACK
	RSTACK

	.FUNCT HATCH-CLOSE,HATCH,CONT
	EQUAL? PRSA,V?TAKE \FALSE
	FIRST? HATCH >CONT /?L3
?L3:	CALL TRYTAKE >STACK
	ZERO? STACK /FALSE
	PRINTI "The "
	PRINTD HATCH
	PRINTI " closes silently."
	CRLF
	FCLEAR CONT,NDESCBIT
	FCLEAR HATCH,OPENBIT
	RTRUE

	.FUNCT SILVER-SLOT-FCN
	CALL SLOT-DOOR,SILVER-SLOT,SILVER-KEY,DRIVE-BUBBLE-HATCH >STACK
	RSTACK

	.FUNCT GOLD-SLOT-FCN
	CALL SLOT-DOOR,GOLD-SLOT,GOLD-KEY,CONTROL-BUBBLE-HATCH >STACK
	RSTACK

	.FUNCT SLOT-DOOR,SLOT?1,KEY,DOOR
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,KEY \?L3
	FSET? DOOR,OPENBIT /?L5
	FSET DOOR,OPENBIT
	FSET KEY,NDESCBIT
	MOVE KEY,SLOT?1
	PRINTI "The "
	PRINTD PRSO
	PRINTI " slides into the slot and the "
	PRINTD DOOR
	PRINTR " opens."
?L5:	CALL ALREADY,STR?17 >STACK
	RSTACK
?L3:	FSET? PRSO,KEYBIT \?L10
	CALL WRONG-KEY >STACK
	RSTACK
?L10:	CALL WONT-FIT >STACK
	RSTACK

	.FUNCT WHITE-SLOT-FCN
	EQUAL? PRSA,V?PUT \FALSE
	CALL TRYTAKE >STACK
	ZERO? STACK /TRUE
	FSET? PRSO,KEYBIT /?L5
	PRINTR "You can't do that."
?L5:	EQUAL? PRSO,WHITE-KEY /FALSE
	IN? WHITE-KEY,WHITE-SLOT \?L9
	PRINTR "The white crystal rod is already in the slot."
?L9:	FSET? PRSO,KEYBIT \FALSE
	CALL WRONG-KEY >STACK
	RSTACK

	.FUNCT BLACK-SLOT-FCN
	EQUAL? PRSA,V?PUT \FALSE
	CALL TRYTAKE >STACK
	ZERO? STACK /TRUE
	FSET? PRSO,KEYBIT /?L5
	PRINTR "You can't do that."
?L5:	EQUAL? PRSO,BLACK-KEY \?L8
	PRINTI "As the rod slides easily into the slot, the lights go out in the bubble. Outside, you can see dead black night settling over everything. An expressionless voice speaks inside your head: ""Emergency shutoff mechanism activated..."" The voice gets quieter and quieter, and finally silence rules over all.
"
	CALL FINISH >STACK
	RSTACK
?L8:	FSET? PRSO,KEYBIT \FALSE
	CALL WRONG-KEY >STACK
	RSTACK

	.FUNCT CONTROL-BUBBLE-ENTRANCE-FCN,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are floating outside a 100 meter crystal dome which protrudes from the fore end of the cylinder. Inside, you can discern shadowy mechanisms and odd constructions. Near you is an entrance which is "
	FSET? CONTROL-BUBBLE-HATCH,OPENBIT \?L5
	PRINTI "open."
	JUMP ?L9
?L5:	PRINTI "closed."
?L9:	PRINTI " A small slot surrounded by gold crystal is next to the hatch."
	IN? GOLD-KEY,GOLD-SLOT \?L14
	PRINTI " The slot contains a gold rod."
?L14:	PRINTR " Small knobs which might make good handholds dot the surface of the bubble from the axis to the hatch."
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROW,V?DROP \?L22
	CALL BOMBS-AWAY >STACK
	RSTACK
?L22:	CALL SWAN-DIVE,CONTROL-BUBBLE >STACK
	RSTACK

	.FUNCT CONTROL-BUBBLE-ROOM-FCN,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This room must be the main control room of the artifact. The control bubble itself is transparent and you can look out upon the interior of the artifact. Far off, hidden among the tallest trees of the forest, is the matching drive bubble. One way out is the hatch, which is "
	FSET? CONTROL-BUBBLE-HATCH,OPENBIT \?L5
	PRINTI "open."
	JUMP ?L9
?L5:	PRINTI "closed."
?L9:	CRLF
	PRINTI "The walls are gray "
	IN? CLEAR-KEY,CLEAR-SLOT \?L14
	PRINTI "except for five small color-coded slots (pink, brown, violet, green, and blue) "
	IN? CLEAR-SLOT,HERE \?L18
	PRINTI "surrounding a small clear one."
	JUMP ?L25
?L18:	PRINTI "arranged in a pentagon."
	JUMP ?L25
?L14:	PRINTI "except for a single small slot surrounded by clear crystal."
?L25:	CRLF
	CALL SLOTS-AND-SPOTS
	IN? VIEW-SELECT,HERE \TRUE
	GETP VIEW-SELECT,P?ACTION >STACK
	CALL STACK,M-OBJDESC >STACK
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	CALL BUBBLE-BOUNCE >STACK
	RSTACK

	.FUNCT PLANTER-FCN
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL AS-ADVERTISED >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?DIG \FALSE
	PRINTR "You find nothing of interest."

	.FUNCT METAL-BAND-EXIT
	FSET? GRASSLAND,TOUCHBIT /?L1
	CALL QUEUE,I-HUNTERS,2 >STACK
	PUT STACK,0,1
?L1:	PRINTI "You climb a vertical shaft for a considerable distance. The shaft opens into a gigantic space which obviously occupies most of the interior of the artifact. The area is "
	ZERO? NIGHT? /?L6
	PUSH STR?168
	JUMP ?L8
?L6:	PUSH STR?169
?L8:	PRINT STACK
	PRINTI " lit and has an interesting geography...
"
	CRLF
	RETURN GRASSLAND

	.FUNCT SEES-HUNTERS?
	EQUAL? HERE,GRASSLAND,GRASSLAND-2,FORE-END /TRUE
	EQUAL? HERE,METAL-BAND,METAL-BAND-2,FORE-END-2 /TRUE
	EQUAL? HERE,SCRUB,SCRUB-2 /TRUE
	RFALSE

	.FUNCT I-HUNTERS
	ZERO? HUNTER-COUNT \?L30
	RANDOM 100 >STACK
	GRTR? 40,STACK \?L3
	CALL SEES-HUNTERS? >STACK
	ZERO? STACK /?L3
	SET 'HUNTER-COUNT,1
	JUMP ?L5
?L3:	CALL QUEUE,I-HUNTERS,2 >STACK
	PUT STACK,0,1
?L5:	ZERO? HUNTER-COUNT /FALSE
?L30:	CALL SEES-HUNTERS? >STACK
	ZERO? STACK /?L9
	PRINTI "There is activity "
	EQUAL? HERE,GRASSLAND \?L13
	PRINTI "above, across the cylinder: "
	JUMP ?L20
?L13:	EQUAL? HERE,GRASSLAND-2 \?L17
	PRINTI "nearby: "
	JUMP ?L20
?L17:	PRINTI "on the grassy plain: "
?L20:	GET HUNTER-TABLE,HUNTER-COUNT >STACK
	PRINT STACK
	CRLF
?L9:	GET HUNTER-TABLE,0 >STACK
	LESS? HUNTER-COUNT,STACK \?L26
	INC 'HUNTER-COUNT
	CALL QUEUE,I-HUNTERS,2 >STACK
	PUT STACK,0,1
	RTRUE
?L26:	SET 'HUNTER-COUNT,0
	CALL QUEUE,I-HUNTERS,200 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT UNICORNS-FCN
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,GRASSLAND \?L3
	PRINTR "They are over on the other side of the cylinder."
?L3:	PRINTR "They are nearby, cropping grass."
?L1:	EQUAL? PRSA,V?FOLLOW \?L10
	PRINTR "They aren't going anywhere."
?L10:	EQUAL? PRSA,V?ZAP \?L13
	CALL CAN-ZAP? >STACK
	ZERO? STACK /FALSE
	PRINTI "Many unicorns are incinerated; the rest scatter in terror, then slowly form back into a herd some distance away."
	CRLF
	CALL PRINT-ID,STR?170
	CALL SPOILED-HUNT >STACK
	RSTACK
?L13:	PRINTI "The creatures move off as you approach, so you can't get very close to them."
	CRLF
	CALL SPOILED-HUNT
	RFALSE

	.FUNCT SPOILED-HUNT
	GRTR? HUNTER-COUNT,0 \TRUE
	LESS? HUNTER-COUNT,4 \TRUE
	SET 'HUNTER-COUNT,0
	CALL QUEUE,I-HUNTERS,200 >STACK
	PUT STACK,0,1
	PRINTI "You have disturbed the hunters, who are annoyed, and the unicorns, who are now more wary. The hunt is spoiled."
	CRLF
	CALL PRINT-ID,STR?171
	RTRUE

	.FUNCT I-NIGHT
	CALL QUEUE,I-NIGHT,128 >STACK
	PUT STACK,0,1
	CALL SEES-HUNTERS? >STACK
	ZERO? STACK \?L3
	EQUAL? HERE,FOREST,BASE-OF-TREE,UP-A-TREE /?L3
	EQUAL? HERE,TREETOP-ROOM,DRIVE-BUBBLE-ENTRANCE,CONTROL-BUBBLE-ENTRANCE /?L3
	EQUAL? HERE,AXIS-1,AXIS-2,AXIS-3 /?L3
	EQUAL? HERE,ON-DRIVE-BUBBLE,ON-CONTROL-BUBBLE \?L8
?L3:	ZERO? NIGHT? /?L4
	PRINTI "The lights come on: it is now full daylight."
	CRLF
	JUMP ?L8
?L4:	PRINTI "The lights dim: it is now nighttime. There is still enough light to see by; it's like a clear, moonlit night back on earth."
	CRLF
?L8:	ZERO? NIGHT? \?L12
	SET 'NIGHT?,1
	RETURN NIGHT?
?L12:	SET 'NIGHT?,0
	RETURN NIGHT?

	.FUNCT BOMBS-AWAY,A,B
	EQUAL? PRSO,RED-DISK,BLUE-DISK \?L1
	CALL DISK-SWITCH,PRSO,1
?L1:	CALL IDROP >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSO,SPACESUIT,SAFETY-LINE \?L6
	GETP PRSO,P?ACTION >STACK
	CALL STACK >STACK
	ZERO? STACK \TRUE
?L6:	EQUAL? PRSI,DRIVE-BUBBLE,CONTROL-BUBBLE \?L7
	EQUAL? PRSI,DRIVE-BUBBLE \?L8
	PUSH FOREST
	JUMP ?L10
?L8:	PUSH FORE-END
?L10:	MOVE PRSO,STACK
	PRINTI "Throwing the "
	PRINTD PRSO
	PRINTI " provides some impulse away from the "
	PRINTD PRSI
	PRINTR ", but air resistance slows you quickly."
?L7:	EQUAL? HERE,ON-DRIVE-BUBBLE,DRIVE-BUBBLE-ENTRANCE \?L14
	SET 'A,FOREST
	SET 'B,BASE-OF-TREE
	JUMP ?L19
?L14:	EQUAL? HERE,AXIS-1 \?L16
	SET 'A,SCRUB
	SET 'B,SCRUB-2
	JUMP ?L19
?L16:	EQUAL? HERE,AXIS-2 \?L17
	SET 'A,GRASSLAND
	SET 'B,GRASSLAND-2
	JUMP ?L19
?L17:	EQUAL? HERE,AXIS-3 \?L18
	SET 'A,METAL-BAND
	SET 'B,METAL-BAND-2
	JUMP ?L19
?L18:	EQUAL? HERE,ON-CONTROL-BUBBLE,CONTROL-BUBBLE-ENTRANCE \?L19
	SET 'A,FORE-END
	SET 'B,FORE-END-2
?L19:	RANDOM 100 >STACK
	GRTR? 50,STACK \?L21
	PUSH A
	JUMP ?L23
?L21:	PUSH B
?L23:	MOVE PRSO,STACK
	PRINTI "The "
	PRINTD PRSO
	PRINTR " sails away, drifting in a long arc towards the ground."

	.FUNCT ON-BUBBLE-FCN,BUB,DEST
	EQUAL? PRSA,V?THROW,V?DROP \?L1
	CALL BOMBS-AWAY >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LEAP /?L4
	EQUAL? PRSA,V?PUSH \FALSE
	EQUAL? PRSO,BUB \FALSE
?L4:	PRINTI "You push against the surface of the bubble, and because there is no weight here, you shoot into the air and away along the axis!"
	CRLF
	CRLF
	CALL GOTO,DEST
	RTRUE

	.FUNCT ON-CONTROL-BUBBLE-FCN,RARG
	EQUAL? RARG,M-BEG \FALSE
	CALL ON-BUBBLE-FCN,CONTROL-BUBBLE,AXIS-3 >STACK
	RSTACK

	.FUNCT AXIS-FCN,RARG=0
	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \?L3
	PRINTR "You are floating in midair near the axis of rotation. Given this fact, it's hard to see how you are going to walk anywhere."
?L3:	EQUAL? PRSA,V?THROW,V?DROP \?L7
	CALL BOMBS-AWAY >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?LEAP \FALSE
	PRINTR "That was a good idea when you had something to push against. Here it has no effect."

	.FUNCT JATO,TARGET?1
	SET 'TARGET?1,PRSI
	EQUAL? TARGET?1,DRIVE-BUBBLE,CONTROL-BUBBLE,GROUND /?L6
	RANDOM 100 >STACK
	GRTR? 40,STACK \?L3
	SET 'TARGET?1,DRIVE-BUBBLE
	JUMP ?L6
?L3:	RANDOM 100 >STACK
	GRTR? 40,STACK \?L5
	SET 'TARGET?1,CONTROL-BUBBLE
	JUMP ?L6
?L5:	SET 'TARGET?1,GROUND
?L6:	PRINTI "A blast of orange flame issues from the gun, and the recoil propels you at an impressive speed through the air."
	CALL PRINT-ID,STR?172
	EQUAL? HERE,DRIVE-BUBBLE-ROOM,CONTROL-BUBBLE-ROOM \?L10
	PRINTI " You hit the bulkhead rather hard. Ouch!"
	CRLF
	CALL PRINT-ID,STR?173 >STACK
	RSTACK
?L10:	EQUAL? TARGET?1,DRIVE-BUBBLE,CONTROL-BUBBLE \?L14
	PRINTI " Eventually, air resistance slows you down, but you are still in the weightless area near the center of the cylinder."
	CRLF
	EQUAL? TARGET?1,DRIVE-BUBBLE \?L17
	CRLF
	EQUAL? HERE,ON-DRIVE-BUBBLE \?L19
	CALL GOTO,AXIS-1
	RTRUE
?L19:	EQUAL? HERE,AXIS-1 \?L21
	CALL GOTO,AXIS-2
	RTRUE
?L21:	EQUAL? HERE,AXIS-2 \?L22
	CALL GOTO,AXIS-3
	RTRUE
?L22:	EQUAL? HERE,AXIS-3 \?L23
	CALL GOTO,ON-CONTROL-BUBBLE
	RTRUE
?L23:	EQUAL? HERE,ON-CONTROL-BUBBLE \TRUE
	PRINTR "You are still outside the control bubble."
?L17:	CRLF
	EQUAL? HERE,ON-DRIVE-BUBBLE \?L29
	PRINTR "You are still outside the drive bubble."
?L29:	EQUAL? HERE,AXIS-1 \?L33
	CALL GOTO,ON-DRIVE-BUBBLE
	RTRUE
?L33:	EQUAL? HERE,AXIS-2 \?L34
	CALL GOTO,AXIS-1
	RTRUE
?L34:	EQUAL? HERE,AXIS-3 \?L35
	CALL GOTO,AXIS-2
	RTRUE
?L35:	EQUAL? HERE,ON-CONTROL-BUBBLE \TRUE
	CALL GOTO,AXIS-3
	RTRUE
?L14:	EQUAL? TARGET?1,GROUND \FALSE
	CALL PRINT-ID,STR?174
	CALL JIGS-UP,STR?175 >STACK
	RSTACK

	.FUNCT OBSERVATORY-FCN,RARG,X
	EQUAL? RARG,M-LOOK \FALSE
	FIRST? SLIDE-PROJECTOR >X /?L3
?L3:	PRINTI "This is the interior part of the artifact's observatory, with an exit to starboard. There are no telescopes or other instruments visible"
	ZERO? X /?L8
	FSET? X,KEYBIT \?L6
?L8:	PRINTI ", but in the center of the room is an image of space in the vicinity. Examining the image, you see a tiny model of the solar system. The sun is a bright dot in the center; Jupiter and Saturn are easily discovered."
	ZERO? X /?L24
	PRINTI " The colors of the dots are not what you would expect, though,"
	IN? CLEAR-KEY,SLIDE-PROJECTOR \?L15
	PRINTR " and range throughout the spectrum."
?L15:	FSET? X,KEYBIT \?L24
	PRINTI " as they are filtered through a "
	PRINTD X
	PRINTR "."
?L6:	PRINTI ", only a holographic projector."
?L24:	CRLF
	RTRUE

	.FUNCT SLIDE-PROJECTOR-FCN,X
	EQUAL? PRSA,V?EXAMINE \?L1
	FIRST? SLIDE-PROJECTOR >X \?L4
	FSET? X,KEYBIT /?L4
	PRINTI "The projector is a type of laser, currently blocked by a "
	PRINTD X
	PRINTR " from projecting any light."
?L4:	PRINTR "The projector is a type of laser, producing a continuous holographic view of space outside the artifact. The light issues from the front of the projector, and is blindingly bright."
?L1:	EQUAL? PRSA,V?LOOK-SAFELY \?L11
	EQUAL? PRSI,SMOKED-GLASS,BLACK-KEY \?L12
	PRINTI "The light is very bright, but the "
	PRINTD PRSI
	PRINTI " filters it enough so that you are not blinded."
	CRLF
	IN? CLEAR-KEY,SLIDE-PROJECTOR \FALSE
	FCLEAR CLEAR-KEY,INVISIBLE
	PRINTR "Inside the projector is a clear crystal rod, which has a prismatic effect on the light being emitted."
?L12:	CALL PRINT-ID,STR?176
	CALL JIGS-UP,STR?177 >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?LOOK-INSIDE \?L22
	CALL PRINT-ID,STR?178
	CALL JIGS-UP,STR?179 >STACK
	RSTACK
?L22:	EQUAL? PRSA,V?TAKE \?L23
	IN? PRSO,SLIDE-PROJECTOR \?L23
	MOVE PRSO,WINNER
	PRINTI "Taken. "
	FSET? PRSO,KEYBIT \?L26
	CALL SCORE-OBJ,PRSO
	PRINTR "The image displayed is now clear and correctly colored."
?L26:	PRINTR "The displayed image becomes visible again."
?L23:	EQUAL? PRSA,V?PUT \?L33
	EQUAL? PRSI,SLIDE-PROJECTOR \?L33
	FIRST? PRSI >STACK \?L34
	PRINTR "There is already something there."
?L34:	EQUAL? PRSO,CLEAR-KEY \?L38
	MOVE PRSO,PRSI
	PRINTR "The displayed image is now prismatic and multi-colored."
?L38:	FSET? PRSO,KEYBIT \?L41
	MOVE PRSO,PRSI
	PRINTI "The displayed image is now filtered through a "
	PRINTD PRSO
	PRINTR ", and becomes that color."
?L41:	CALL WONT-FIT >STACK
	RSTACK
?L33:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTI "You can't do that to the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT LASER-BEAM-FCN
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The beam projects a view of some outside location."
?L1:	EQUAL? PRSA,V?ZAP \?L5
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L5
	PRINTR "Zapping a light beam is a waste of time."
?L5:	EQUAL? PRSA,V?MUNG \FALSE
	PRINTR "The image vanishes while the beam is broken."

	.FUNCT CANT-DAMAGE
	PRINTI "It's hard to see how you expect to damage a "
	PRINTD PRSO
	PRINTR "."

	.FUNCT CONTROL-SLOT-FCN,F
	EQUAL? PRSA,V?PUT \?L1
	FSET? PRSO,KEYBIT \?L5
	FIRST? PRSI >STACK \?L3
?L5:	CALL WONT-FIT
	RTRUE
?L3:	GETP PRSI,P?KEY >F
	ZERO? F /?L12
	ZERO? SWITCH-ON? /?L9
	IN? CARD,SLOT /?L7
?L9:	PRINTI "The "
	PRINTD PRSI
	PRINTI " rejects the "
	PRINTD PRSO
	PRINTR ", and the slot flashes as if indicating a fault somewhere in the system."
?L7:	EQUAL? PRSO,F /?L12
	CALL WRONG-KEY
	RTRUE
?L12:	MOVE PRSO,PRSI
	FSET PRSO,NDESCBIT
	EQUAL? PRSO,CLEAR-KEY \?L15
	EQUAL? PRSI,CLEAR-SLOT \?L15
	MOVE BROWN-SLOT,HERE
	MOVE PINK-SLOT,HERE
	MOVE GREEN-SLOT,HERE
	MOVE BLUE-SLOT,HERE
	MOVE VIOLET-SLOT,HERE
	MOVE CLEAR-KEY,CLEAR-SLOT
	PRINTR "As you insert the clear rod, five other slots appear evenly ranged around the clear one. These are colored brown, green, blue, violet and pink respectively."
?L15:	EQUAL? PRSO,BROWN-KEY \?L19
	EQUAL? PRSI,BROWN-SLOT \?L19
	SET 'F,TARGET-SELECT
	JUMP ?L24
?L19:	EQUAL? PRSO,PINK-KEY \?L20
	EQUAL? PRSI,PINK-SLOT \?L20
	SET 'F,VIEW-SELECT
	JUMP ?L24
?L20:	EQUAL? PRSO,GREEN-KEY \?L21
	EQUAL? PRSI,GREEN-SLOT \?L21
	SET 'F,SPEED-SELECT
	JUMP ?L24
?L21:	EQUAL? PRSO,BLUE-KEY \?L22
	EQUAL? PRSI,BLUE-SLOT \?L22
	SET 'F,EXECUTE-BUTTON
	JUMP ?L24
?L22:	EQUAL? PRSO,VIOLET-KEY \FALSE
	EQUAL? PRSI,VIOLET-SLOT \FALSE
	SET 'F,COURSE-SELECT
?L24:	MOVE F,HERE
	PRINTI "When the "
	PRINTD PRSO
	PRINTI " is inserted into the "
	PRINTD PRSI
	PRINTI ", a ghostly image appears on the wall alongside it"
	IN? CLEAR-SLOT,CONTROL-BUBBLE-ROOM \?L27
	REMOVE CLEAR-SLOT
	PRINTI ", but the clear slot and its contents fade from view."
	CRLF
	JUMP ?L31
?L27:	PRINTI "."
	CRLF
?L31:	EQUAL? F,VIEW-SELECT \?L34
	CALL PERFORM,V?EXAMINE,F
	RTRUE
?L34:	PRINTI "The image is a "
	PRINTD F
	PRINTR " which almost seems to project out of the wall."
?L1:	EQUAL? PRSA,V?TAKE-OFF,V?TAKE \FALSE
	EQUAL? PRSO,CLEAR-KEY \?L40
	IN? PRSO,CLEAR-SLOT \?L40
	SET 'VIEW-STATUS,0
	SET 'TARGET,0
	SET 'COURSE-SHAPE,0
	SET 'SPEED-VALUE,0
	REMOVE VIEW-SELECT
	REMOVE TARGET-SELECT
	REMOVE SPEED-SELECT
	REMOVE COURSE-SELECT
	REMOVE EXECUTE-BUTTON
	REMOVE BROWN-SLOT
	REMOVE PINK-SLOT
	REMOVE GREEN-SLOT
	REMOVE BLUE-SLOT
	REMOVE VIOLET-SLOT
	MOVE CLEAR-KEY,WINNER
	PRINTR "When you remove the clear rod, the room returns to its original featureless state."
?L40:	EQUAL? PRSO,BROWN-KEY \?L44
	IN? PRSO,BROWN-SLOT \?L44
	SET 'TARGET,0
	SET 'F,TARGET-SELECT
	JUMP ?L49
?L44:	EQUAL? PRSO,PINK-KEY \?L45
	IN? PRSO,PINK-SLOT \?L45
	SET 'VIEW-STATUS,0
	SET 'TARGET,0
	SET 'COURSE-SHAPE,0
	SET 'SPEED-VALUE,0
	SET 'F,VIEW-SELECT
	JUMP ?L49
?L45:	EQUAL? PRSO,GREEN-KEY \?L46
	IN? PRSO,GREEN-SLOT \?L46
	SET 'SPEED-VALUE,0
	SET 'F,SPEED-SELECT
	JUMP ?L49
?L46:	EQUAL? PRSO,BLUE-KEY \?L47
	IN? PRSO,BLUE-SLOT \?L47
	SET 'F,EXECUTE-BUTTON
	JUMP ?L49
?L47:	EQUAL? PRSO,VIOLET-KEY \FALSE
	IN? PRSO,VIOLET-SLOT \FALSE
	SET 'COURSE-SHAPE,0
	SET 'F,COURSE-SELECT
?L49:	REMOVE F
	MOVE PRSO,WINNER
	FCLEAR PRSO,NDESCBIT
	PRINTI "The "
	PRINTD F
	PRINTI " fades from view as you take the "
	PRINTD PRSO
	IN? BROWN-KEY,BROWN-SLOT /?L54
	IN? BLUE-KEY,BLUE-SLOT /?L54
	IN? GREEN-KEY,GREEN-SLOT /?L54
	IN? PINK-KEY,PINK-SLOT /?L54
	IN? VIOLET-KEY,VIOLET-SLOT \?L52
?L54:	PRINTR "."
?L52:	MOVE CLEAR-SLOT,CONTROL-BUBBLE-ROOM
	PRINTR ", and a moment later the clear slot and its contents reappear."

	.FUNCT SLOTS-AND-SPOTS,CNT=0,OFF=0,SCNT,TBL
	IN? CLEAR-KEY,CLEAR-SLOT \TRUE
	IN? CLEAR-SLOT,HERE \?L4
	PRINTI "A clear rod is in the clear slot. Of the surrounding slots, "
	JUMP ?L8
?L4:	PRINTI "Of the colored slots, "
?L8:	IN? PINK-KEY,PINK-SLOT \?L11
	PRINTI "the pink one contains a pink rod and "
?L11:	IN? BROWN-KEY,BROWN-SLOT \?L16
	INC 'CNT
?L16:	IN? GREEN-KEY,GREEN-SLOT \?L19
	INC 'CNT
?L19:	IN? BLUE-KEY,BLUE-SLOT \?L22
	INC 'CNT
?L22:	IN? VIOLET-KEY,VIOLET-SLOT \?L25
	INC 'CNT
?L25:	ZERO? CNT \?L28
	IN? PINK-KEY,PINK-SLOT \?L30
	PRINTI "the others"
	JUMP ?L34
?L30:	PRINTI "all"
?L34:	PRINTR " are empty."
?L28:	PRINTI "the "
	SET 'TBL,SLOT-TABLE
	SET 'SCNT,CNT
?L42:	GET TBL,OFF >STACK
	ZERO? STACK /?L43
	ADD OFF,1 >STACK
	GET TBL,STACK >STACK
	GET TBL,OFF >STACK
	IN? STACK,STACK \?L57
	ADD OFF,2 >STACK
	GET TBL,STACK >STACK
	PRINT STACK
	GRTR? CNT,2 \?L49
	PRINTI ", "
	JUMP ?L53
?L49:	EQUAL? CNT,2 \?L53
	PRINTI " and "
?L53:	DLESS? 'CNT,1 /?L43
?L57:	ADD OFF,3 >OFF
	JUMP ?L42
?L43:	PRINTI " rod"
	EQUAL? SCNT,1 \?L63
	PRINTI " is"
	JUMP ?L67
?L63:	PRINTI "s are"
?L67:	PRINTI " in place in the like-colored slot"
	EQUAL? SCNT,1 \?L72
	PRINTI ". Alongside it is a spot"
	JUMP ?L76
?L72:	PRINTI "s. Alongside each of those are spots"
?L76:	PRINTR " of the same color."

	.FUNCT VIEW-SELECT-FCN,RARG=0
	EQUAL? RARG,M-OBJDESC /?L3
	EQUAL? PRSA,V?EXAMINE \?L1
?L3:	PRINTI "The pink screen includes a small square, a large square, and a display showing nearby space. This view shows "
	GET VIEW-SCREEN-VIEWS,VIEW-STATUS >STACK
	PRINT STACK
	PRINTI "."
	EQUAL? VIEW-STATUS,1 \?L14
	ZERO? TARGET /?L14
	PRINTI " The symbol representing "
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTI " is lit."
	ZERO? COURSE-SHAPE /?L14
	PRINTI " A line on the display connects the position of the artifact with that of "
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTI ", and terminating "
	GET COURSES,COURSE-SHAPE >STACK
	PRINT STACK
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTI "."
	ZERO? SPEED-VALUE /?L14
	PRINTI " The line is made of dots, blinking "
	GET SPEEDS,SPEED-VALUE >STACK
	PRINT STACK
	PRINTI ", starting with the dot at the artifact and ending at the one next to "
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTI "."
?L14:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?PUSH,V?RUB \FALSE
	EQUAL? PRSO,ZOOM-IN \?L22
	GRTR? VIEW-STATUS,0 \?L24
	DEC 'VIEW-STATUS
	PRINTI "The view screen now shows "
	GET VIEW-SCREEN-VIEWS,VIEW-STATUS >STACK
	PRINT STACK
	PRINTR "."
?L24:	PRINTR "The view is unchanged."
?L22:	EQUAL? PRSO,ZOOM-OUT \?L31
	LESS? VIEW-STATUS,4 \?L32
	INC 'VIEW-STATUS
	PRINTI "The view screen now shows "
	GET VIEW-SCREEN-VIEWS,VIEW-STATUS >STACK
	PRINT STACK
	PRINTR "."
?L32:	PRINTR "The view is unchanged."
?L31:	PRINTR "The display flashes briefly."

	.FUNCT TARGET-SELECT-FCN
	EQUAL? PRSA,V?PUSH,V?RUB \FALSE
	IN? VIEW-SELECT,HERE \?L3
	EQUAL? VIEW-STATUS,1 \?L3
	ADD TARGET,1 >STACK
	MOD STACK,7 >TARGET
	ZERO? TARGET \?L5
	PRINTR "Now nothing is highlighted on the view screen."
?L5:	PRINTI "The view screen now shows "
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTR " brightly highlighted."
?L3:	CALL SPOT-FLASH >STACK
	RSTACK

	.FUNCT SPEED-SELECT-FCN
	EQUAL? PRSA,V?PUSH,V?RUB \FALSE
	IN? VIEW-SELECT,HERE \?L3
	ZERO? COURSE-SHAPE /?L5
	ZERO? TARGET /?L5
	IN? WHITE-KEY,WHITE-SLOT /?L7
	PRINTR "The line on the display flashes brightly, insistently, for about five seconds, and then returns to its former state."
?L7:	ADD SPEED-VALUE,1 >STACK
	MOD STACK,3 >SPEED-VALUE
	ZERO? SPEED-VALUE /?L12
	PRINTI "The line on the display now consists of dots which flash "
	GET SPEEDS,SPEED-VALUE >STACK
	PRINT STACK
	PRINTI ", one at a time, starting with a dot at the artifact and concluding at "
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTR "."
?L12:	PRINTR "The line on the display is now a solid line."
?L5:	CALL SPOT-FLASH >STACK
	RSTACK
?L3:	CALL SPOT-FLASH >STACK
	RSTACK

	.FUNCT COURSE-SELECT-FCN
	EQUAL? PRSA,V?PUSH,V?RUB \FALSE
	IN? VIEW-SELECT,HERE \?L3
	ADD COURSE-SHAPE,1 >STACK
	MOD STACK,5 >COURSE-SHAPE
	ZERO? TARGET /?L5
	ZERO? COURSE-SHAPE /?L7
	PRINTI "The highlighted image of "
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTI " now is connected to that of the artifact. The line terminates "
	GET COURSES,COURSE-SHAPE >STACK
	PRINT STACK
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTR "."
?L7:	PRINTI "A line no longer connects the artifact and "
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTR "."
?L5:	CALL SPOT-FLASH >STACK
	RSTACK
?L3:	CALL SPOT-FLASH >STACK
	RSTACK

	.FUNCT EXECUTE-BUTTON-FCN,RARG=0
	EQUAL? PRSA,V?RUB,V?PUSH \FALSE
	IN? VIEW-SELECT,HERE \?L3
	ZERO? COURSE-SHAPE /?L5
	ZERO? TARGET /?L5
	ZERO? SPEED-VALUE /?L5
	EQUAL? VIEW-STATUS,1 \?L5
	GRTR? CONTROL-SCORE,0 \?L7
	CALL SCORE-UPD,CONTROL-SCORE
	SET 'CONTROL-SCORE,0
	PRINTI "All the displays flash once. There is a sensation of movement as the artifact positions itself to follow the course you have set."
	CRLF
	CALL WIN-GAME >STACK
	RSTACK
?L7:	CALL SPOT-FLASH >STACK
	RSTACK
?L5:	CALL SPOT-FLASH >STACK
	RSTACK
?L3:	CALL SPOT-FLASH >STACK
	RSTACK

	.FUNCT SPOT-FLASH
	PRINTR "The spot flashes briefly."

	.FUNCT WIN-GAME
	CRLF
	EQUAL? TARGET,4 \?L1
	EQUAL? COURSE-SHAPE,3,4 \?L3
	CALL SCORE-UPD,25
	SET 'WON-FLAG,1
	PRINTI "The artifact, under your assured control, moves serenely toward Earth, where the knowledge it contains will immeasureably benefit mankind. Within a few years, there could be human ships flying out to the stars, and all because of your daring and cunning...

A holographic projection of a humanoid figure appears before you. The being, tall and thin, swathed in shimmering robes, speaks in your own language. ""Congratulations, you who have passed our test. You have succeeded where others failed. Your race shall benefit thereby."" He smiles. ""I expect to see you in person, someday."" The projection fades.
"
	CRLF
	CALL PRINT-ID,STR?180
	JUMP ?L13
?L3:	PRINTI "The artifact approaches Earth, where the plaudits of humanity await you. Unfortunately, the course you have chosen "
	EQUAL? COURSE-SHAPE,1 \?L10
	PUSH STR?181
	JUMP ?L12
?L10:	PUSH STR?182
?L12:	PRINT STACK
	CALL PRINT-ID,STR?183
	CRLF
	JUMP ?L13
?L1:	PRINTI "The artifact moves confidently towards "
	GET TARGETS,TARGET >STACK
	PRINT STACK
	PRINTI ", but its computer system is smart enough to know where you came from, so it realizes that you have made the wrong choice. All systems shut down, and silence settles over all."
	CRLF
	CALL PRINT-ID,STR?184
?L13:	CALL FINISH >STACK
	RSTACK

	.FUNCT ON-ARTIFACT?
	EQUAL? HERE,SPACESHIP-BRIDGE,SPACESHIP-STORES,SPACESHIP-QUARTERS /FALSE
	EQUAL? HERE,SPACESHIP-AIRLOCK,DEEP-SPACE,RED-DOCK /FALSE
	EQUAL? HERE,BLUE-DOCK,YELLOW-DOCK,GREEN-DOCK /FALSE
	EQUAL? HERE,OUTER-SPACE \TRUE
	RFALSE

	.FUNCT CARD-F
	IN? CARD,SLOT \FALSE
	EQUAL? PRSA,V?ZAP \?L3
	CALL CAN-ZAP? >STACK
	ZERO? STACK /?L3
	SET 'SWITCH-ON?,0
	SET 'MELTED?,1
	RFALSE
?L3:	EQUAL? PRSA,V?TAKE \FALSE
	ZERO? SWITCH-ON? /FALSE
	PRINTR "You get a giant shock as you try to take it."

	.FUNCT ROD-RACK-FCN
	EQUAL? PRSA,V?TAKE \?L1
	IN? PRSO,ROD-RACK \?L1
	PRINTI "When you take the "
	PRINTD PRSO
	PRINTI ", the hole it was in closes up as though it had never existed."
	CRLF
	MOVE PRSO,WINNER
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,ROD-RACK \FALSE
	IN? PRSO,ROD-RACK \?L6
	PRINTR "It's already there."
?L6:	CALL TRYTAKE >STACK
	ZERO? STACK /TRUE
	FSET? PRSO,KEYBIT \?L11
	MOVE PRSO,ROD-RACK
	CALL SCORE-OBJ,PRSO
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is inserted, and immediately another hole opens beside it."
?L11:	CALL WONT-FIT >STACK
	RSTACK

	.FUNCT HATCH-DOOR-F
	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTR "You can't manually open or close the hatch."

	.FUNCT SPEAR-F,OBJ
	EQUAL? HERE,NEST-CAGE \?L1
	SET 'OBJ,RAT-ANT
	JUMP ?L3
?L1:	SET 'OBJ,ALIENS
?L3:	EQUAL? PRSA,V?TAKE \?L4
	PRINTI "Every "
	PRINTD OBJ
	PRINTR " regards you with suspicion and won't give you a weapon."
?L4:	EQUAL? PRSA,V?ZAP \FALSE
	CALL PERFORM,V?ZAP,OBJ
	RTRUE

	.FUNCT HUTS-F
	EQUAL? PRSA,V?ZAP \?L1
	PRINTI "A few huts are destroyed; many remain."
	CRLF
	SET 'ALIENS-FRIENDLY?,0
	RETURN ALIENS-FRIENDLY?
?L1:	CALL EX-CHECK >STACK
	RSTACK

	.FUNCT AS-ADVERTISED
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is as described."

	.FUNCT WALL-F
	EQUAL? HERE,FORE-END,FORE-END-2 \FALSE
	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-UP,V?CLIMB-FOO \FALSE
	PRINTR "The wall is unscalable!"

	.FUNCT DISTANT-BUBBLE-F
	EQUAL? PRSA,V?LOOK-INSIDE \?L1
	PRINTR "No details are visible."
?L1:	CALL EX-CHECK >STACK
	RSTACK

	.FUNCT EX-CHECK
	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL AS-ADVERTISED >STACK
	RSTACK

	.FUNCT VEGGIES-F
	EQUAL? PRSA,V?EAT \?L1
	PRINTI "Yechh!"
	CRLF
	CALL PRINT-ID,STR?185 >STACK
	RSTACK
?L1:	CALL EX-CHECK >STACK
	RSTACK

	.FUNCT DRIVE-CONTROLS-F
	CALL EX-CHECK >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?ZAP /FALSE
	PRINTR "You can't do anything with them."

	.FUNCT CAGES-F
	CALL EX-CHECK >STACK
	RSTACK

	.FUNCT TOTEMS-F
	CALL EX-CHECK >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?EAT \?L3
	CALL VEGGIES-F >STACK
	RSTACK
?L3:	PRINTI "It would be impolite to fool with these."
	CRLF
	CALL PRINT-ID,STR?186 >STACK
	RSTACK

	.FUNCT KNOBS-F
	EQUAL? PRSA,V?TAKE \?L1
	PRINTR "It is firmly attached."
?L1:	EQUAL? PRSA,V?CLIMB-DOWN,V?CLIMB-UP,V?REACH /?L6
	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-FOO \FALSE
?L6:	EQUAL? HERE,DRIVE-BUBBLE-ENTRANCE,CONTROL-BUBBLE-ENTRANCE \?L7
	CALL DO-WALK,P?UP
	RTRUE
?L7:	CALL DO-WALK,P?DOWN
	RTRUE

	.FUNCT SWITCH-FCN
	EQUAL? PRSA,V?THROW,V?TURN,V?LAMP-ON \?L1
	ZERO? MELTED? /?L3
	PRINTR "There is a sickening wheeze, but nothing else happens."
?L3:	ZERO? SWITCH-ON? /?L7
	PRINTR "It's already on."
?L7:	PRINTI "The lights in the room come on and there is a deafening FOOOOM! noise as the computer starts up."
	CRLF
	SET 'SWITCH-ON?,1
	IN? CARD,SLOT \?L13
	ZERO? FRIED? \?L13
	ZERO? GOT-KEY? /?L15
	PRINTR "The main display blinks and displays the word ""Ready""."
?L15:	SET 'GOT-KEY?,1
	MOVE GOLD-KEY,HERE
	FCLEAR ENUNCIATOR,INVISIBLE
	PRINTI "The main display blinks twice, a bell rings, and a gold rod falls from the output hopper onto the floor! A moment later, a previously unseen enunciator panel comes on."
	CRLF
	CALL PERFORM,V?EXAMINE,ENUNCIATOR
	RTRUE
?L13:	PRINTR "Lights blink on the main display and the word ""Fault"" appears."
?L1:	EQUAL? PRSA,V?LAMP-OFF \FALSE
	SET 'SWITCH-ON?,0
	FSET ENUNCIATOR,INVISIBLE
	PRINTR "The computer is off."

	.FUNCT COMPUTER-ROOM-FCN,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the main computer room. The builders of this ship were obviously still wedded to large mainframes: this one fills the room and is thirty meters high. There is an overlarge switch at about eye-level and an access panel below it, which is "
	FSET? PANEL,OPENBIT \?L5
	PRINTI "open"
	JUMP ?L9
?L5:	PRINTI "closed"
?L9:	PRINTI ". The power seems to be "
	ZERO? SWITCH-ON? /?L14
	PRINTI "on."
	CRLF
	JUMP ?L18
?L14:	PRINTI "off."
	CRLF
?L18:	ZERO? FRIED? /TRUE
	PRINTI "There is a strong smell of burning components."
	CRLF
	CALL PRINT-ID,STR?187
	RTRUE

	.FUNCT ENUNCIATOR-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	ZERO? SWITCH-ON? /?L3
	PRINTI "The panel has three banks of four colored lights: red, yellow, green, and blue. The first is labelled with a symbol of the emission of rays: of the lights underneath, the red one is flashing and the yellow one is brightly lit. The second bank is labelled with a stylized docking port and the third with an airlock. Of these two banks, the first yellow one is brightly lit and the other yellow one is flashing. The panel also contains six other lights, each bearing a stylized picture. The first four, all dark, represent navigation, engine, library, and defenses. A fifth, picturing a cage, is brightly lit. The sixth is "
	GET AIR-FLASH,AIR-COUNT >STACK
	PRINT STACK
	PRINTI ". It"
	PRINT REPAIR-PANEL
	CRLF
	RTRUE
?L3:	PRINTR "The panel is dark."

	.FUNCT REPAIR-ROOM-FCN,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This room is taken up by two large pieces of machinery. The leftmost has a symbol depicting the emission of rays beside a yellow slot. The other machine"
	PRINT REPAIR-PANEL
	PRINTR " Beside it are three diagrams; under each one is a red slot. The first diagram shows four single dots equally spaced around a six-dot cluster. The second shows two eight-dot clusters in close proximity. The third has three single dots equally spaced around a seven-dot cluster. The only exit is up some stairs."

	.FUNCT YELLOW-SLOT-F
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,YELLOW-SLOT \FALSE
	EQUAL? PRSO,YELLOW-KEY \?L3
	SET 'ALWAYS-LIT,1
	CALL RIGHT-KEY
	CRLF
	RTRUE
?L3:	FSET? PRSO,KEYBIT \?L5
	CALL WRONG-KEY >STACK
	RSTACK
?L5:	CALL WONT-FIT >STACK
	RSTACK

	.FUNCT WONT-FIT
	PRINTI "The "
	PRINTD PRSO
	PRINTI " doesn't fit in the "
	PRINTD PRSI
	PRINTR "."

	.FUNCT RED-SLOT-F,NUM
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,RED-SLOT \FALSE
	CALL ORDINAL,P-ADJECTIVE >NUM
	GRTR? NUM,3 /?L5
	ZERO? NUM \?L3
?L5:	PRINTR "You must specify which red slot."
?L3:	EQUAL? PRSO,RED-KEY /?L8
	CALL WRONG-KEY >STACK
	RSTACK
?L8:	REMOVE RED-KEY
	CALL RIGHT-KEY
	PRINTI " You hear a subdued hum of machinery coming to life."
	CRLF
	EQUAL? NUM,2 \?L12
	CALL QUEUE,I-FRESH-AIR,30 >STACK
	PUT STACK,0,1
	CALL INT,I-BAD-AIR >STACK
	PUT STACK,0,0
	RTRUE
?L12:	CALL QUEUE,I-POISON-AIR,20 >STACK
	PUT STACK,0,1
	CALL INT,I-BAD-AIR >STACK
	PUT STACK,0,0
	EQUAL? NUM,3 \TRUE
	SET 'AMMONIA?,1
	RTRUE

	.FUNCT RIGHT-KEY
	REMOVE PRSO
	PRINTI "The "
	PRINTD PRSO
	PRINTI " disappears into the slot."
	RTRUE

	.FUNCT WRONG-KEY
	REMOVE PRSO
	PRINTI "The "
	PRINTD PRSO
	PRINTR " slides into the slot and disappears."

	.FUNCT I-FRESH-AIR
	SET 'POISON-COUNT,0
	ZERO? AIR-COUNT /TRUE
	DLESS? 'AIR-COUNT,1 \?L3
	ZERO? SUIT-ON? \TRUE
	ZERO? IN-ARTIFACT? /TRUE
	PRINTR "The air seems fine now."
?L3:	ZERO? SUIT-ON? \?L10
	ZERO? IN-ARTIFACT? /?L10
	CALL DESCRIBE-AIR,STR?188
?L10:	CALL QUEUE,I-FRESH-AIR,20 >STACK
	RSTACK

	.FUNCT I-POISON-AIR
	IGRTR? 'POISON-COUNT,3 \?L1
	ZERO? IN-ARTIFACT? \?L3
	CALL QUEUE,I-POISON-AIR,1 >STACK
	PUT STACK,0,1
	RTRUE
?L3:	ZERO? SUIT-ON? /?L5
	CALL PRINT-ID,STR?189
	CALL JIGS-UP,STUPID-AIRGONE-MESSAGE >STACK
	RSTACK
?L5:	CALL PRINT-ID,STR?190
	CALL JIGS-UP,STR?191 >STACK
	RSTACK
?L1:	ZERO? SUIT-ON? \?L8
	ZERO? IN-ARTIFACT? /?L8
	CALL DESCRIBE-AIR,STR?192
?L8:	CALL QUEUE,I-POISON-AIR,30 >STACK
	RSTACK

	.FUNCT I-BAD-AIR
	IGRTR? 'AIR-COUNT,3 \?L1
	SET 'POISON-COUNT,4
	ZERO? IN-ARTIFACT? \?L3
	CALL QUEUE,I-BAD-AIR,1 >STACK
	PUT STACK,0,1
	RTRUE
?L3:	ZERO? SUIT-ON? \?L5
	CALL PRINT-ID,STR?193
	CALL JIGS-UP,STR?194 >STACK
	RSTACK
?L5:	CALL PRINT-ID,STR?195
	CALL JIGS-UP,STUPID-AIRGONE-MESSAGE >STACK
	RSTACK
?L1:	ZERO? SUIT-ON? \?L8
	ZERO? IN-ARTIFACT? /?L8
	CALL DESCRIBE-AIR,STR?196
?L8:	CALL QUEUE,I-BAD-AIR,40 >STACK
	RSTACK

	.FUNCT DESCRIBE-AIR,STR
	EQUAL? POISON-COUNT,4 \?L1
	EQUAL? AIR-COUNT,4 \?L3
	CALL PRINT-ID,STR?197
	CALL JIGS-UP,STR?194 >STACK
	RSTACK
?L3:	CALL PRINT-ID,STR?198
	CALL JIGS-UP,STR?191 >STACK
	RSTACK
?L1:	GRTR? POISON-COUNT,0 \?L6
	PRINT STR
	GET POISON-AIRS,POISON-COUNT >STACK
	PRINT STACK
	ZERO? AMMONIA? /?L9
	PUSH AMMONIA-TABLE
	JUMP ?L11
?L9:	PUSH METHANE-TABLE
?L11:	GET STACK,POISON-COUNT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L6:	PRINT STR
	GET LIGHT-AIRS,AIR-COUNT >STACK
	PRINT STACK
	CRLF
	RTRUE

	.INSERT "./starcross/starcross_str"
	.END
