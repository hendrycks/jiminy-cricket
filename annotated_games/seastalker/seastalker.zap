	.INSERT "annotated_games/seastalker/seastalker_freq"
	.INSERT "annotated_games/seastalker/seastalker_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	PRINTD OBJ
	RTRUE

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-THEFT?
	EQUAL? PRSO,DIARY,PHOTO \FALSE
	RTRUE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,ACCESS-PLATE,AIR-SUPPLY-SYSTEM,AIR-SUPPLY-SYSTEM-GLOBAL /TRUE
	EQUAL? PRSO,AIRLOCK,AIRLOCK-ELECTRICITY,AIRLOCK-HATCH /TRUE
	EQUAL? PRSO,AIRLOCK-LADDER,AIRLOCK-RAMP,AIRLOCK-ROOF /TRUE
	EQUAL? PRSO,AIRLOCK-WALL,ALARM,ALARM-SUB /TRUE
	EQUAL? PRSO,AQUADOME,ARROW,ARTICLE /TRUE
	EQUAL? PRSO,BADGE-GLOBAL,BADGE-GLOBAL-2,BADGE-GLOBAL-3 /TRUE
	EQUAL? PRSO,BADGE-PLAYER,BADGE-SHARON,BADGE-TIP /TRUE
	EQUAL? PRSO,BAZOOKA,BLACK-BOX,BLACK-CIRCUITRY /TRUE
	EQUAL? PRSO,BLY-DESK,BLY-DOOR,CAPSULE-LEVER /TRUE
	EQUAL? PRSO,CATALYST-CAPSULE,CHAIR,CHEMICAL-SUPPLY-SHELVES /TRUE
	EQUAL? PRSO,CHEMICALS,CIRCUIT-BREAKER,CLAW /TRUE
	EQUAL? PRSO,COMM-BLDG-DOOR,COMPUTESTOR,CONTROL-CIRCUITS /TRUE
	EQUAL? PRSO,CONTROL-CIRCUITS-GAUGE,CONTROLS,CONTROLS-OFFICE /TRUE
	EQUAL? PRSO,CONTROLS-SUB,DART,DEPTH-CONTROL /TRUE
	EQUAL? PRSO,DEPTHFINDER,DEPTHFINDER-LIGHT,DESK /TRUE
	EQUAL? PRSO,DIARY,DOCKING-TANK,DOME-LAB-DOOR /TRUE
	EQUAL? PRSO,DOME-STORAGE-DOOR,ELECTRICAL-CONTROL-PANEL,ELECTROLYTE-RELAY /TRUE
	EQUAL? PRSO,ELECTRONIC-SUPPLY-SHELVES,ELECTRONICS,ENGINE /TRUE
	EQUAL? PRSO,ENGINE-ACCESS-HATCH,ENGINE-BUTTON,ESCAPE-POD-UNIT /TRUE
	EQUAL? PRSO,EXERCISE-TRACK,FILE-DRAWER,FILL-TANK-BUTTON /TRUE
	EQUAL? PRSO,FLOOR,FREIGHTER,GALLEY-DOOR /TRUE
	EQUAL? PRSO,GANGPLANK,GLOBAL-EXPLOSIVE,GLOBAL-SONAR /TRUE
	EQUAL? PRSO,GLOBAL-SUB,GLOBAL-SUB-2,GLOBAL-WEAPON /TRUE
	EQUAL? PRSO,GREENUP-LADDER,HOOK,HORVAK-KEY /TRUE
	EQUAL? PRSO,HORVAK-LOCKER,HYDROPHONE,INSTRUMENTS /TRUE
	EQUAL? PRSO,INTERCOM,JOYSTICK,KEMP-DESK /TRUE
	EQUAL? PRSO,LIGHTS,LOCAL-SUB,MAGAZINE /TRUE
	EQUAL? PRSO,MECHANICAL-SUPPLY-SHELVES,MECHANICALS,MENS-FURNITURE /TRUE
	EQUAL? PRSO,MENS-LOCKER,MENS-QUARTERS-DOOR,MICROPHONE /TRUE
	EQUAL? PRSO,MICROPHONE-DOME,MICROWAVE-SECURITY-SCANNER,NOTEBOOK /TRUE
	EQUAL? PRSO,OFFICE-DOOR,OPEN-GATE-BUTTON,ORE-NODULES /TRUE
	EQUAL? PRSO,OXYGEN-GEAR,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER /TRUE
	EQUAL? PRSO,OXYGEN-GEAR-OTHER,PAPERS,PHOTO /TRUE
	EQUAL? PRSO,PILOT-SEAT,POWER-SUPPLY,REACTOR /TRUE
	EQUAL? PRSO,REACTOR-SWITCH,SEA-WALL,SEARCH-BEAM /TRUE
	EQUAL? PRSO,SONAR-EQUIPMENT,SONARPHONE,SONARSCOPE /TRUE
	EQUAL? PRSO,SONARSCOPE-LIGHT,SPECIAL-TOOL,SPECIAL-TOOL-GLOBAL /TRUE
	EQUAL? PRSO,STATION-MONITOR,STORAGE-DOOR,SUB /TRUE
	EQUAL? PRSO,SUB-DOOR,SUB-PLANS,SUB-WINDOW /TRUE
	EQUAL? PRSO,SYRINGE,TANK-CONTROL-GEAR-1,TANK-CONTROL-GEAR-2 /TRUE
	EQUAL? PRSO,TANK-GATE,TEST-BUTTON,TEST-TANK /TRUE
	EQUAL? PRSO,THORPE-SUB,THROTTLE,UNIVERSAL-TOOL /TRUE
	EQUAL? PRSO,VIDEOPHONE,VIDEOPHONE-2,VIDEOPHONE-CABLE /TRUE
	EQUAL? PRSO,VIDEOPHONE-RECEIVER,VIDEOPHONE-SATELLITE,VIDEOPHONE-TRANSMITTER /TRUE
	EQUAL? PRSO,VOLTAGE-REGULATOR,WINDOW,WOMENS-FURNITURE /TRUE
	EQUAL? PRSO,WOMENS-QUARTERS-DOOR,WORK-COUNTER,WORKBENCH /TRUE
	EQUAL? PRSO,WORKSHOP-DOOR,WORKSHOP-STUFF \FALSE
	RTRUE

	.FUNCT IS-PERSON?
	EQUAL? PRSO,PLAYER /FALSE
	FSET? PRSO,PERSON /TRUE
	EQUAL? PRSO,CREW,SONAR-MAN /TRUE
	RFALSE

	.FUNCT IS-PERSON-ANIMAL-PROPERTY-PRSI?
	EQUAL? PRSI,PLAYER /?L4
	FSET? PRSI,PERSON /TRUE
	EQUAL? PRSI,CREW,SONAR-MAN /TRUE
?L4:	EQUAL? PRSI,ACCESS-PLATE,AIR-SUPPLY-SYSTEM,AIR-SUPPLY-SYSTEM-GLOBAL /TRUE
	EQUAL? PRSI,AIRLOCK,AIRLOCK-ELECTRICITY,AIRLOCK-HATCH /TRUE
	EQUAL? PRSI,AIRLOCK-LADDER,AIRLOCK-RAMP,AIRLOCK-ROOF /TRUE
	EQUAL? PRSI,AIRLOCK-WALL,ALARM,ALARM-SUB /TRUE
	EQUAL? PRSI,AQUADOME,ARROW,ARTICLE /TRUE
	EQUAL? PRSI,BADGE-GLOBAL,BADGE-GLOBAL-2,BADGE-GLOBAL-3 /TRUE
	EQUAL? PRSI,BADGE-PLAYER,BADGE-SHARON,BADGE-TIP /TRUE
	EQUAL? PRSI,BAZOOKA,BLACK-BOX,BLACK-CIRCUITRY /TRUE
	EQUAL? PRSI,BLY-DESK,BLY-DOOR,CAPSULE-LEVER /TRUE
	EQUAL? PRSI,CATALYST-CAPSULE,CHAIR,CHEMICAL-SUPPLY-SHELVES /TRUE
	EQUAL? PRSI,CHEMICALS,CIRCUIT-BREAKER,CLAW /TRUE
	EQUAL? PRSI,COMM-BLDG-DOOR,COMPUTESTOR,CONTROL-CIRCUITS /TRUE
	EQUAL? PRSI,CONTROL-CIRCUITS-GAUGE,CONTROLS,CONTROLS-OFFICE /TRUE
	EQUAL? PRSI,CONTROLS-SUB,DART,DEPTH-CONTROL /TRUE
	EQUAL? PRSI,DEPTHFINDER,DEPTHFINDER-LIGHT,DESK /TRUE
	EQUAL? PRSI,DIARY,DOCKING-TANK,DOME-LAB-DOOR /TRUE
	EQUAL? PRSI,DOME-STORAGE-DOOR,ELECTRICAL-CONTROL-PANEL,ELECTROLYTE-RELAY /TRUE
	EQUAL? PRSI,ELECTRONIC-SUPPLY-SHELVES,ELECTRONICS,ENGINE /TRUE
	EQUAL? PRSI,ENGINE-ACCESS-HATCH,ENGINE-BUTTON,ESCAPE-POD-UNIT /TRUE
	EQUAL? PRSI,EXERCISE-TRACK,FILE-DRAWER,FILL-TANK-BUTTON /TRUE
	EQUAL? PRSI,FLOOR,FREIGHTER,GALLEY-DOOR /TRUE
	EQUAL? PRSI,GANGPLANK,GLOBAL-EXPLOSIVE,GLOBAL-SONAR /TRUE
	EQUAL? PRSI,GLOBAL-SUB,GLOBAL-SUB-2,GLOBAL-WEAPON /TRUE
	EQUAL? PRSI,GREENUP-LADDER,HOOK,HORVAK-KEY /TRUE
	EQUAL? PRSI,HORVAK-LOCKER,HYDROPHONE,INSTRUMENTS /TRUE
	EQUAL? PRSI,INTERCOM,JOYSTICK,KEMP-DESK /TRUE
	EQUAL? PRSI,LIGHTS,LOCAL-SUB,MAGAZINE /TRUE
	EQUAL? PRSI,MECHANICAL-SUPPLY-SHELVES,MECHANICALS,MENS-FURNITURE /TRUE
	EQUAL? PRSI,MENS-LOCKER,MENS-QUARTERS-DOOR,MICROPHONE /TRUE
	EQUAL? PRSI,MICROPHONE-DOME,MICROWAVE-SECURITY-SCANNER,NOTEBOOK /TRUE
	EQUAL? PRSI,OFFICE-DOOR,OPEN-GATE-BUTTON,ORE-NODULES /TRUE
	EQUAL? PRSI,OXYGEN-GEAR,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER /TRUE
	EQUAL? PRSI,OXYGEN-GEAR-OTHER,PAPERS,PHOTO /TRUE
	EQUAL? PRSI,PILOT-SEAT,POWER-SUPPLY,REACTOR /TRUE
	EQUAL? PRSI,REACTOR-SWITCH,SEA-WALL,SEARCH-BEAM /TRUE
	EQUAL? PRSI,SONAR-EQUIPMENT,SONARPHONE,SONARSCOPE /TRUE
	EQUAL? PRSI,SONARSCOPE-LIGHT,SPECIAL-TOOL,SPECIAL-TOOL-GLOBAL /TRUE
	EQUAL? PRSI,STATION-MONITOR,STORAGE-DOOR,SUB /TRUE
	EQUAL? PRSI,SUB-DOOR,SUB-PLANS,SUB-WINDOW /TRUE
	EQUAL? PRSI,SYRINGE,TANK-CONTROL-GEAR-1,TANK-CONTROL-GEAR-2 /TRUE
	EQUAL? PRSI,TANK-GATE,TEST-BUTTON,TEST-TANK /TRUE
	EQUAL? PRSI,THORPE-SUB,THROTTLE,UNIVERSAL-TOOL /TRUE
	EQUAL? PRSI,VIDEOPHONE,VIDEOPHONE-2,VIDEOPHONE-CABLE /TRUE
	EQUAL? PRSI,VIDEOPHONE-RECEIVER,VIDEOPHONE-SATELLITE,VIDEOPHONE-TRANSMITTER /TRUE
	EQUAL? PRSI,VOLTAGE-REGULATOR,WINDOW,WOMENS-FURNITURE /TRUE
	EQUAL? PRSI,WOMENS-QUARTERS-DOOR,WORK-COUNTER,WORKBENCH /TRUE
	EQUAL? PRSI,WORKSHOP-DOOR,WORKSHOP-STUFF,WHALE /TRUE
	EQUAL? PRSI,SNARK /TRUE
	RFALSE

	.FUNCT DANGEROUS-DRINK?
	EQUAL? PRSO,CHEMICALS,SEA,UNDERWATER /TRUE
	EQUAL? PRSO,GLOBAL-WATER \FALSE
	RTRUE

	.FUNCT THROWING-AT-GLASS?
	EQUAL? PRSO,AQUADOME,WINDOW,SUB-WINDOW \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?,?TMP
	CALL IS-PART-OF-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-OBJECT-OR-PROPERTY? >STACK
	RSTACK

	.FUNCT IS-ANIMAL?
	EQUAL? PRSO,WHALE,SNARK \FALSE
	RTRUE

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-ANIMAL? >STACK
	RSTACK

	.FUNCT IS-SELF?
	EQUAL? PRSO,PLAYER \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? PRSO,ARM \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF-OR-SELF?,?TMP
	CALL IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-PART-OF-SELF? >STACK
	RSTACK

	.FUNCT QUEUE,RTN,TICK,CINT
	CALL INT,RTN >CINT
	PUT CINT,C-TICK,TICK
	RETURN CINT

	.FUNCT INT,RTN,E,C,INT?1
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	SUB C-INTS,C-INTLEN >C-INTS
	ADD C-TABLE,C-INTS >INT?1
	PUT INT?1,C-RTN,RTN
	RETURN INT?1
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L5
	RETURN C
?L5:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT CLOCKER,C,E,TICK,FLG=0,VAL
	ZERO? CLOCK-WAIT /?L1
	SET 'CLOCK-WAIT,0
	RFALSE
?L1:	ZERO? P-WON /?L4
	PUSH C-INTS
	JUMP ?L5
?L4:	PUSH 0
?L5:	ADD C-TABLE,STACK >C
	ADD C-TABLE,C-TABLELEN >E
?L7:	EQUAL? C,E \?L9
	INC 'MOVES
	RETURN FLG
?L9:	GET C,C-ENABLED? >STACK
	ZERO? STACK /?L17
	GET C,C-TICK >TICK
	ZERO? TICK /?L17
	SUB TICK,1 >STACK
	PUT C,C-TICK,STACK
	GRTR? TICK,1 /?L17
	GET C,C-RTN >STACK
	CALL STACK >VAL
	ZERO? VAL /?L17
	ZERO? FLG /?L19
	EQUAL? VAL,M-FATAL \?L17
?L19:	SET 'FLG,VAL
?L17:	ADD C,C-INTLEN >C
	JUMP ?L7

	.FUNCT PRINTT,O
	EQUAL? O,TURN \?L1
	PRINTI " "
	PRINTN P-NUMBER
	PRINTI " turns"
	RTRUE
?L1:	CALL THE?,O
	PRINTI " "
	PRINTD O
	RTRUE

	.FUNCT PRINTA,O
	FSET? O,PERSON /?L7
	FSET? O,NARTICLEBIT /?L7
	FSET? O,VOWELBIT \?L4
	PRINTI "an "
	JUMP ?L7
?L4:	PRINTI "a "
?L7:	PRINTD O
	RTRUE

	.FUNCT PICK-ONE,FROB
	GET FROB,0 >STACK
	RANDOM STACK >STACK
	GET FROB,STACK >STACK
	RSTACK

	.FUNCT SPLIT-SCREEN?
	GETB 0,1 >STACK
	BTST STACK,32 /TRUE
	RFALSE

	.FUNCT GO
START::
?L0:	SET 'LIT,1
	PUTB P-LEXV,0,59
	PUTB YES-LEXV,0,4
	SET 'SCORE,0
	SET 'HERE,GAME
	PUTB FIRST-NAME,0,3
	PUTB FIRST-NAME,1,45
	PUTB FIRST-NAME,2,45
	PUTB FIRST-NAME,3,45
	PUTB LAST-NAME,0,3
	PUTB LAST-NAME,1,45
	PUTB LAST-NAME,2,45
	PUTB LAST-NAME,3,45
	SET 'WINNER,PLAYER
	CALL THIS-IS-IT,VIDEOPHONE
	CALL THIS-IS-IT,TIP
	CALL THIS-IS-IT,SHARON
	FSET? CENTER-OF-LAB,TOUCHBIT /?L1
	CALL INTRO
	CALL QUEUE-MAIN-EVENTS
?L1:	SET 'HERE,CENTER-OF-LAB
	MOVE TIP,HERE
	MOVE PLAYER,HERE
	CALL MAIN-LOOP
	JUMP ?L0

	.FUNCT INTRO,N
	PRINTI "Copyright (c) 1984, 1985 Infocom, Inc. All rights reserved.

Welcome to interactive fiction from Infocom!

In this story, you're the hero or heroine, so we'll use your name!"
	CRLF
?L3:	CRLF
	CALL READ-NAME,FIRST-NAME,STR?5 >N
	EQUAL? N,M-FATAL /FALSE
	PRINTI "Hello "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! "
	CALL READ-NAME,LAST-NAME,STR?6 >N
	EQUAL? N,M-FATAL /FALSE
	PRINTI "Is "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI " "
	CALL PRINT-NAME,LAST-NAME
	PRINTI " right?"
	CALL YES? >STACK
	ZERO? STACK /?L3
	PRINTI "Then let the story begin!"
	SET 'N,24
?L22:	DLESS? 'N,0 /?L23
	CRLF
	JUMP ?L22
?L23:	CALL V-VERSION
	CRLF
	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", snap out of it!"" cries "
	PRINTD GLOBAL-TIP
	PRINTI ", bursting into "
	PRINTD YOUR-LABORATORY
	PRINTI ". ""The alert signal is on!""
You look up from your plans for the "
	PRINTD SUB
	PRINTI ", a top-secret submarine that's still being tested. It's designed for capturing marine life on the ocean floor. You notice the "
	PRINTD ALARM
	PRINTI " on the "
	PRINTD VIDEOPHONE
	PRINTI " ringing. Someone's trying to reach you over the private "
	PRINTD VIDEOPHONE
	PRINTI " network of "
	PRINTD IU-GLOBAL
	PRINTR "!
"

	.FUNCT QUEUE-MAIN-EVENTS
	SET 'ALARM-RINGING,1
	CALL QUEUE,I-ALARM-RINGING,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-SHOW-SONAR,0
	CALL QUEUE,I-UPDATE-FREIGHTER,0
	CALL QUEUE,I-UPDATE-SUB-POSITION,0
	SET 'OLD-HERE,CENTER-OF-LAB
	SET 'TIP-FOLLOWS-YOU?,1
	RANDOM 250 >STACK
	ADD 250,STACK >STACK
	CALL QUEUE,I-SNARK-ATTACKS,STACK >STACK
	PUT STACK,0,1
	CALL QUEUE,I-LAMP-ON-SCOPE,5 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-PROMPT-1,1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-PROMPT-2,10 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-SHARON-GONE,25 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT MAIN-LOOP,TRASH
?L1:	CALL MAIN-LOOP-1 >TRASH
	JUMP ?L1

	.FUNCT MAIN-LOOP-1,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP
	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	EQUAL? QCONTEXT-ROOM,HERE /?L1
	SET 'QCONTEXT,0
?L1:	CALL PARSER >P-WON
	ZERO? P-WON /?L4
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	ZERO? OCNT \?L6
	SET 'NUM,OCNT
	JUMP ?L13
?L6:	GRTR? OCNT,1 \?L8
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L9
	SET 'OBJ,0
	JUMP ?L11
?L9:	GET P-PRSI,1 >OBJ
?L11:	SET 'NUM,OCNT
	JUMP ?L13
?L8:	GRTR? ICNT,1 \?L12
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L13
?L12:	SET 'NUM,1
?L13:	ZERO? OBJ \?L14
	EQUAL? ICNT,1 \?L14
	GET P-PRSI,1 >OBJ
?L14:	EQUAL? PRSA,V?WALK \?L17
	CALL PERFORM,PRSA,PRSO >V
	JUMP ?L33
?L17:	ZERO? NUM \?L19
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	ZERO? STACK \?L20
	CALL PERFORM,PRSA >V
	SET 'PRSO,0
	JUMP ?L33
?L20:	PRINTI "(There isn't anything to "
	GET P-ITBL,P-VERBN >TMP
	ZERO? P-OFLAG /?L25
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L27
?L25:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L27:	PRINTI "!)"
	CRLF
	SET 'V,0
	JUMP ?L33
?L19:	ZERO? PTBL /?L30
	GRTR? NUM,1 \?L30
	EQUAL? PRSA,V?COMPARE \?L30
	CALL PERFORM,PRSA,OBJECT-PAIR >V
	JUMP ?L33
?L30:	SET 'TMP,0
?L32:	IGRTR? 'CNT,NUM \?L34
	GRTR? TMP,0 \?L33
	PRINTI "The other thing"
	EQUAL? TMP,1 /?L40
	PRINTI "s"
?L40:	PRINTI " that you mentioned "
	EQUAL? TMP,1 /?L47
	PRINTI "are"
	JUMP ?L51
?L47:	PRINTI "is"
?L51:	PRINTI "n't here."
	CRLF
	JUMP ?L33
?L34:	ZERO? PTBL /?L58
	GET P-PRSO,CNT >OBJ1
	JUMP ?L60
?L58:	GET P-PRSI,CNT >OBJ1
?L60:	GRTR? NUM,1 \?L66
	EQUAL? OBJ1,NOT-HERE-OBJECT \?L63
	INC 'TMP
	JUMP ?L32
?L63:	EQUAL? OBJ1,PLAYER /?L32
	EQUAL? OBJ1,IT \?L67
	PRINTD P-IT-OBJECT
	JUMP ?L69
?L67:	PRINTD OBJ1
?L69:	PRINTI ": "
?L66:	ZERO? PTBL /?L73
	PUSH OBJ1
	JUMP ?L75
?L73:	PUSH OBJ
?L75:	CALL QCONTEXT-CHECK,STACK >V
	ZERO? PTBL /?L76
	PUSH OBJ
	JUMP ?L78
?L76:	PUSH OBJ1
?L78:	ZERO? PTBL /?L79
	PUSH OBJ1
	JUMP ?L81
?L79:	PUSH OBJ
?L81:	CALL PERFORM,PRSA,STACK,STACK >V
	EQUAL? V,M-FATAL \?L32
?L33:	EQUAL? V,M-FATAL \?L88
	SET 'P-CONT,0
	JUMP ?L88
?L4:	SET 'P-CONT,0
?L88:	ZERO? P-WON /FALSE
	CALL GAME-VERB? >STACK
	ZERO? STACK \FALSE
	CALL CLOCKER >V
	RETURN V

	.FUNCT QCONTEXT-CHECK,PRSO?1,OTHER,WHO=0,N=0
	EQUAL? PRSA,V?WHAT,V?HELP /?L3
	EQUAL? PRSA,V?TELL-ABOUT,V?SHOW \FALSE
	EQUAL? PRSO?1,PLAYER \FALSE
?L3:	FIRST? HERE >OTHER \?L6
?L7:	FSET? OTHER,PERSON \?L9
	FSET? OTHER,INVISIBLE /?L9
	EQUAL? OTHER,PLAYER /?L9
	INC 'N
	SET 'WHO,OTHER
?L9:	NEXT? OTHER >OTHER /?L7
?L6:	EQUAL? 1,N \?L12
	ZERO? QCONTEXT \?L12
	CALL SAID-TO,WHO
?L12:	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /FALSE
	EQUAL? WINNER,PLAYER \FALSE
	SET 'WINNER,QCONTEXT
	PRINTI "(said to "
	PRINTD QCONTEXT
	PRINTR ")"

	.FUNCT QCONTEXT-GOOD?,?TMP
	ZERO? QCONTEXT /FALSE
	FSET? QCONTEXT,INVISIBLE /FALSE
	EQUAL? HERE,QCONTEXT-ROOM \FALSE
	SET '?TMP,HERE
	CALL META-LOC,QCONTEXT >STACK
	EQUAL? ?TMP,STACK /TRUE
	RFALSE

	.FUNCT SAID-TO,WHO
	SET 'QCONTEXT,WHO
	SET 'QCONTEXT-ROOM,HERE
	RETURN QCONTEXT-ROOM

	.FUNCT OBJECT-PAIR-F,P1,P2
	GET P-PRSO,P-MATCHLEN >STACK
	LESS? 2,STACK \?L1
	EQUAL? PRSA,V?COMPARE \TRUE
	PRINTR "That's too many things to compare all at once!"
?L1:	EQUAL? PRSA,V?COMPARE \FALSE
	GET P-PRSO,2 >STACK
	GET P-PRSO,1 >STACK
	CALL PERFORM,PRSA,STACK,STACK
	RTRUE

	.FUNCT THIS-IS-IT,OBJ
	ZERO? OBJ /TRUE
	EQUAL? PRSA,V?WALK \?L4
	EQUAL? OBJ,PRSO /TRUE
?L4:	FSET? OBJ,PERSON /?L7
	EQUAL? OBJ,GLOBAL-HERE,INTDIR /TRUE
	SET 'P-IT-OBJECT,OBJ
	RTRUE
?L7:	FSET? OBJ,FEMALE \?L12
	SET 'P-HER-OBJECT,OBJ
	RTRUE
?L12:	SET 'P-HIM-OBJECT,OBJ
	RTRUE

	.FUNCT FAKE-ORPHAN,TMP
	CALL ORPHAN,P-SYNTAX,0
	PRINTI "(Be specific: what thing do you want to "
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L3
	PRINTI "tell"
	JUMP ?L8
?L3:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L7
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L8
?L7:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L8:	SET 'P-OFLAG,1
	SET 'P-WON,0
	PRINTR "?)"

	.FUNCT TELL-D-LOC,OBJ
	PRINTD OBJ
	IN? OBJ,GLOBAL-OBJECTS \?L3
	PRINTI "(gl)"
	RTRUE
?L3:	IN? OBJ,LOCAL-GLOBALS \?L7
	PRINTI "(lg)"
	RTRUE
?L7:	IN? OBJ,ROOMS \FALSE
	PRINTI "(rm)"
	RTRUE

	.FUNCT FIX-HIM-HER,HEM-OBJECT,V
	GETP HEM-OBJECT,P?CHARACTER >V
	CALL ACCESSIBLE?,HEM-OBJECT >STACK
	ZERO? STACK \?L1
	GET GLOBAL-CHARACTER-TABLE,V >STACK
	RSTACK
?L1:	GET CHARACTER-TABLE,V >V
	LOC V >STACK
	EQUAL? HERE,STACK \FALSE
	RETURN V

	.FUNCT PERFORM,A,O=0,I=0,V,OA,OO,OI
	ZERO? DEBUG /?L1
	PRINTI "[Perform: "
	PRINTN A
	ZERO? O /?L15
	PRINTI "/"
	EQUAL? A,V?WALK \?L11
	PRINTN O
	JUMP ?L15
?L11:	CALL TELL-D-LOC,O
?L15:	ZERO? I /?L17
	PRINTI "/"
	CALL TELL-D-LOC,I
?L17:	PRINTI "]"
	CRLF
?L1:	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	SET 'PRSA,A
	EQUAL? A,V?WALK /?L69
	EQUAL? IT,I,O \?L27
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK \?L27
	ZERO? I \?L29
	CALL FAKE-ORPHAN
	RETURN 2
?L29:	PRINTI "(Sorry, but"
	CALL PRINTT,P-IT-OBJECT
	PRINTI " isn't here!)"
	CRLF
	RETURN 2
?L27:	EQUAL? HER,I,O \?L44
	CALL FIX-HIM-HER,P-HER-OBJECT >V
	ZERO? V /?L44
	EQUAL? HER,O \?L41
	SET 'O,V
?L41:	EQUAL? HER,I \?L44
	SET 'I,V
?L44:	EQUAL? HIM,I,O \?L56
	CALL FIX-HIM-HER,P-HIM-OBJECT >V
	ZERO? V /?L56
	EQUAL? HIM,O \?L53
	SET 'O,V
?L53:	EQUAL? HIM,I \?L56
	SET 'I,V
?L56:	EQUAL? O,IT \?L61
	SET 'O,P-IT-OBJECT
	JUMP ?L64
?L61:	EQUAL? O,HER \?L63
	SET 'O,P-HER-OBJECT
	JUMP ?L64
?L63:	EQUAL? O,HIM \?L64
	SET 'O,P-HIM-OBJECT
?L64:	EQUAL? I,IT \?L66
	SET 'I,P-IT-OBJECT
	JUMP ?L69
?L66:	EQUAL? I,HER \?L68
	SET 'I,P-HER-OBJECT
	JUMP ?L69
?L68:	EQUAL? I,HIM \?L69
	SET 'I,P-HIM-OBJECT
?L69:	SET 'PRSI,I
	SET 'PRSO,O
	SET 'V,0
	EQUAL? A,V?WALK /?L74
	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \?L74
	CALL D-APPLY,STR?7,NOT-HERE-OBJECT-F >V
	ZERO? V /?L74
	SET 'P-WON,0
?L74:	CALL THIS-IS-IT,PRSI
	CALL THIS-IS-IT,PRSO
	SET 'O,PRSO
	SET 'I,PRSI
	ZERO? V \?L84
	GETP WINNER,P?ACTION >STACK
	CALL DD-APPLY,STR?8,WINNER,STACK >V
	ZERO? V \?L84
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL D-APPLY,STR?9,STACK,M-BEG >V
	ZERO? V \?L84
	GET PREACTIONS,A >STACK
	CALL D-APPLY,STR?10,STACK >V
?L84:	SET 'NOW-PRSI,1
	ZERO? V \?L87
	ZERO? I /?L87
	GETP I,P?ACTION >STACK
	CALL D-APPLY,STR?11,STACK >V
?L87:	SET 'NOW-PRSI,0
	ZERO? V \?L99
	ZERO? O /?L92
	EQUAL? A,V?WALK /?L92
	LOC O >STACK
	ZERO? STACK /?L92
	LOC O >STACK
	GETP STACK,P?CONTFCN >V
	ZERO? V /?L108
	LOC O >STACK
	CALL DD-APPLY,STR?12,STACK,V >V
?L92:	ZERO? V \?L99
?L108:	ZERO? O /?L96
	EQUAL? A,V?WALK /?L96
	GETP O,P?ACTION >STACK
	CALL D-APPLY,STR?13,STACK >V
?L96:	ZERO? V \?L99
	GET ACTIONS,A >STACK
	CALL D-APPLY,0,STACK >V
?L99:	EQUAL? V,M-FATAL /?L104
	CALL GAME-VERB? >STACK
	ZERO? STACK \?L104
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL D-APPLY,STR?14,STACK,M-END >V
?L104:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT DD-APPLY,STR,OBJ,FCN
	ZERO? DEBUG /?L1
	PRINTI "["
	PRINTD OBJ
	PRINTI "=]"
?L1:	CALL D-APPLY,STR,FCN >STACK
	RSTACK

	.FUNCT D-APPLY,STR,FCN,FOO=0,RES
	ZERO? FCN /FALSE
	ZERO? DEBUG /?L10
	ZERO? STR \?L6
	PRINTI "[Action:]"
	CRLF
	JUMP ?L10
?L6:	PRINTI "["
	PRINT STR
	PRINTI ": "
?L10:	ZERO? FOO /?L14
	CALL FCN,FOO >RES
	JUMP ?L16
?L14:	CALL FCN >RES
?L16:	ZERO? DEBUG /?L26
	ZERO? STR /?L26
	EQUAL? RES,M-FATAL \?L19
	PRINTI "Fatal]"
	CRLF
	RETURN RES
?L19:	ZERO? RES \?L23
	PRINTI "Not handled]"
	CRLF
	RETURN RES
?L23:	PRINTI "Handled]"
	CRLF
?L26:	RETURN RES

	.FUNCT I-PROMPT-1
	SET 'P-PROMPT,1
	RFALSE

	.FUNCT I-PROMPT-2
	ZERO? P-PROMPT /FALSE
	SET 'P-PROMPT,0
	CRLF
	PRINTI "(Are you tired of seeing ""What next?"" Well, you won't see it any more.)"
	CRLF
	EQUAL? PRSA,V?WAIT-UNTIL,V?WAIT-FOR \?L5
	CRLF
?L5:	CALL INT,I-PROMPT-2 >STACK
	PUT STACK,0,0
	RFALSE

	.FUNCT PARSER,PTR=P-LEXSTART,WRD,VAL=0,VERB=0,OF-FLAG=0,LEN,DIR=0,NW=0,LW=0,NUM,SCNT,CNT=-1
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'P-NUMBER,-1
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADVERB,0
	SET 'P-MERGED,0
	SET 'P-WHAT-IGNORED,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	ZERO? QUOTE-FLAG \?L8
	EQUAL? WINNER,PLAYER /?L8
	SET 'WINNER,PLAYER
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L8
	LOC WINNER >HERE
?L8:	ZERO? P-CONT /?L12
	SET 'PTR,P-CONT
	SET 'P-CONT,0
	EQUAL? PRSA,V?TELL /?L17
	CRLF
	JUMP ?L17
?L12:	SET 'WINNER,PLAYER
	SET 'QUOTE-FLAG,0
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L18
	LOC WINNER >HERE
?L18:	SET 'SCNT,P-SPACE
?L21:	DLESS? 'SCNT,0 /?L22
	CRLF
	JUMP ?L21
?L22:	ZERO? P-PROMPT /?L26
	ZERO? P-OFLAG \?L26
	EQUAL? P-PROMPT,2 \?L28
	PRINTI "Okay, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", what do you want to do now?"
	JUMP ?L32
?L28:	PRINTI "What next?"
?L32:	CRLF
?L26:	PRINTI ">"
	READ P-INBUF,P-LEXV
?L17:	GETB P-LEXV,P-LEXWORDS >P-LEN
	GET P-LEXV,PTR >STACK
	EQUAL? W?THEN,STACK \?L38
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L38:	LESS? 1,P-LEN \?L41
	GET P-LEXV,PTR >STACK
	EQUAL? W?GO,STACK \?L41
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
	ZERO? NW /?L41
	CALL WT?,NW,PS?VERB,P1?VERB >STACK
	ZERO? STACK /?L41
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L41:	ZERO? P-LEN \?L44
	PRINTI "I beg your pardon?"
	CRLF
	RFALSE
?L44:	SET 'LEN,P-LEN
	SET 'P-DIR,0
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
	PUT P-ITBL,P-VERBN,0
?L49:	DLESS? 'P-LEN,0 \?L51
	SET 'QUOTE-FLAG,0
	JUMP ?L50
?L51:	GET P-LEXV,PTR >WRD
	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	ZERO? WRD \?L55
	CALL NUMBER?,PTR >WRD
	ZERO? WRD \?L55
	CALL NAME?,PTR >WRD
	ZERO? WRD /?L54
?L55:	EQUAL? WRD,W?TO \?L56
	EQUAL? VERB,ACT?TELL,ACT?ASK \?L56
	SET 'VERB,ACT?TELL
	SET 'WRD,W?$QUOTE
	JUMP ?L58
?L56:	EQUAL? WRD,W?THEN \?L58
	ZERO? VERB \?L58
	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WRD,W?$QUOTE
?L58:	EQUAL? WRD,W?THEN,W?$PERIOD /?L62
	EQUAL? WRD,W?$QUOTE \?L60
?L62:	EQUAL? WRD,W?$QUOTE \?L67
	ZERO? QUOTE-FLAG /?L65
	SET 'QUOTE-FLAG,0
	JUMP ?L67
?L65:	SET 'QUOTE-FLAG,1
?L67:	ZERO? P-LEN /?L69
	ADD PTR,P-LEXELEN >P-CONT
?L69:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L50
?L60:	CALL WT?,WRD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L71
	EQUAL? LEN,1 /?L72
	EQUAL? LEN,2 \?L73
	EQUAL? VERB,ACT?WALK /?L72
?L73:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
	EQUAL? NW,W?THEN,W?$QUOTE \?L74
	GRTR? LEN,2 /?L72
?L74:	EQUAL? NW,W?$PERIOD \?L75
	GRTR? LEN,1 /?L72
?L75:	ZERO? QUOTE-FLAG /?L76
	EQUAL? LEN,2 \?L76
	EQUAL? NW,W?$QUOTE /?L72
?L76:	GRTR? LEN,2 \?L71
	EQUAL? NW,W?$COMMA,W?AND \?L71
?L72:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L77
	ADD PTR,P-LEXELEN >STACK
	PUT P-LEXV,STACK,W?THEN
?L77:	GRTR? LEN,2 /?L117
	SET 'QUOTE-FLAG,0
	JUMP ?L50
?L71:	CALL WT?,WRD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L83
	ZERO? VERB /?L84
	EQUAL? VERB,ACT?NAME \?L83
?L84:	EQUAL? VERB,ACT?NAME \?L85
	SET 'P-WHAT-IGNORED,1
?L85:	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WRD
	MUL PTR,2 >STACK
	ADD STACK,2 >NUM
	GETB P-LEXV,NUM >STACK
	PUTB P-VTBL,2,STACK
	ADD NUM,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L117
?L83:	CALL WT?,WRD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L90
	EQUAL? WRD,W?ONE,W?A /?L90
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L90
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L88
?L90:	GRTR? P-LEN,1 \?L91
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?OF \?L91
	EQUAL? VERB,ACT?MAKE /?L91
	ZERO? VAL \?L130
	EQUAL? WRD,W?ONE,W?A /?L91
	SET 'OF-FLAG,1
	JUMP ?L117
?L91:	ZERO? VAL /?L93
?L130:	ZERO? P-LEN /?L94
	ADD PTR,2 >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?THEN,W?$PERIOD \?L93
?L94:	LESS? P-NCN,2 \?L117
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WRD
	JUMP ?L117
?L93:	EQUAL? P-NCN,2 \?L98
	PRINTI "(I found too many nouns in that sentence!)"
	CRLF
	RFALSE
?L98:	INC 'P-NCN
	CALL CLAUSE,PTR,VAL,WRD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L117
	SET 'QUOTE-FLAG,0
	JUMP ?L50
?L88:	EQUAL? WRD,W?CLOSELY \?L107
	SET 'P-ADVERB,W?CAREFULLY
	JUMP ?L117
?L107:	EQUAL? WRD,W?CAREFULLY,W?QUIETLY,W?PRIVATELY /?L109
	EQUAL? WRD,W?SLOWLY,W?QUICKLY,W?BRIEFLY \?L108
?L109:	SET 'P-ADVERB,WRD
	JUMP ?L117
?L108:	EQUAL? WRD,W?OF \?L110
	ZERO? OF-FLAG /?L113
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?THEN \?L111
?L113:	CALL CANT-USE,PTR
	RFALSE
?L111:	SET 'OF-FLAG,0
	JUMP ?L117
?L110:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L117
	CALL CANT-USE,PTR
	RFALSE
?L54:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L117:	SET 'LW,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L49
?L50:	ZERO? DIR /?L118
	SET 'PRSA,V?WALK
	SET 'PRSO,DIR
	SET 'P-WALK-DIR,DIR
	RTRUE
?L118:	SET 'P-WALK-DIR,0
	ZERO? P-OFLAG /?L121
	CALL ORPHAN-MERGE
?L121:	GET P-ITBL,P-VERB >STACK
	ZERO? STACK \?L124
	PUT P-ITBL,P-VERB,ACT?$0024CALL
?L124:	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT WT?,PTR,BIT,B1=5,OFFSET=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L6
	INC 'OFFSET
?L6:	GETB PTR,OFFSET >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WRD,OFF?1,NUM,ANDFLG=0,FIRST??=1,NW,LW=0
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF?1
	ZERO? VAL /?L1
	ADD P-PREP1,OFF?1 >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'P-LEN
?L3:	ZERO? P-LEN \?L4
	DEC 'P-NCN
	RETURN -1
?L4:	ADD P-NC1,OFF?1 >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L7
	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
?L7:	DLESS? 'P-LEN,0 \?L12
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L12:	GET P-LEXV,PTR >WRD
	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	ZERO? WRD \?L18
	CALL NUMBER?,PTR >WRD
	ZERO? WRD \?L18
	CALL NAME?,PTR >WRD
	ZERO? WRD /?L17
?L18:	ZERO? P-LEN \?L19
	SET 'NW,0
	JUMP ?L21
?L19:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L21:	EQUAL? WRD,W?OF \?L22
	GET P-ITBL,P-VERB >STACK
	EQUAL? STACK,ACT?MAKE \?L22
	PUT P-LEXV,PTR,W?WITH
	SET 'WRD,W?WITH
?L22:	EQUAL? WRD,W?AND,W?$COMMA \?L25
	SET 'ANDFLG,1
	JUMP ?L44
?L25:	EQUAL? WRD,W?ONE \?L27
	EQUAL? NW,W?OF \?L44
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L44
?L27:	EQUAL? WRD,W?THEN,W?$PERIOD /?L32
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L31
	ZERO? FIRST?? \?L31
?L32:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L31:	ZERO? ANDFLG /?L33
	GET P-ITBL,P-VERBN >STACK
	ZERO? STACK /?L34
	CALL WT?,WRD,PS?DIRECTION >STACK
	ZERO? STACK \?L34
	CALL WT?,WRD,PS?VERB >STACK
	ZERO? STACK /?L33
?L34:	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	PUT P-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L44
?L33:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L35
	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L36
	ZERO? NW /?L36
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L44
?L36:	ZERO? ANDFLG \?L38
	EQUAL? NW,W?AND,W?$COMMA /?L38
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L38:	SET 'ANDFLG,0
	JUMP ?L44
?L35:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L44
	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L44
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK \?L44
	CALL CANT-USE,PTR
	RFALSE
?L17:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L44:	SET 'LW,WRD
	SET 'FIRST??,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0,TIM=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L1:	DLESS? 'CNT,0 /?L2
	GETB P-INBUF,BPTR >CHR
	EQUAL? CHR,58 \?L6
	SET 'TIM,SUM
	SET 'SUM,0
	JUMP ?L11
?L6:	GRTR? SUM,9999 /FALSE
	GRTR? CHR,57 /FALSE
	LESS? CHR,48 /FALSE
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
?L11:	INC 'BPTR
	JUMP ?L1
?L2:	PUT P-LEXV,PTR,W?NUMBER
	GRTR? SUM,9999 /FALSE
	ZERO? TIM /?L14
	GRTR? TIM,23 /FALSE
	GRTR? TIM,19 /?L20
	GRTR? TIM,12 /FALSE
	GRTR? TIM,7 /?L20
	ADD 12,TIM >TIM
?L20:	MUL TIM,60 >STACK
	ADD SUM,STACK >SUM
?L14:	SET 'P-NUMBER,SUM
	RETURN W?NUMBER

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,WRD
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L1
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L1:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L4
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP1 >STACK
	EQUAL? TEMP,STACK /?L7
	ZERO? TEMP \FALSE
?L7:	ZERO? ADJ /?L8
	ADD P-LEXV,2 >STACK
	PUT P-OTBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L22
?L8:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L22
?L4:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L12
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP2 >STACK
	EQUAL? TEMP,STACK /?L15
	ZERO? TEMP \FALSE
?L15:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L22
?L12:	ZERO? P-ACLAUSE /?L22
	EQUAL? P-NCN,1 /?L18
	SET 'P-ACLAUSE,0
	RFALSE
?L18:	GET P-ITBL,P-NC1 >BEG
	GET P-ITBL,P-NC1L >END
?L21:	EQUAL? BEG,END \?L23
	ZERO? ADJ /?L25
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L22
?L25:	SET 'P-ACLAUSE,0
	RFALSE
?L23:	ZERO? ADJ \?L28
	GET BEG,0 >WRD
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE \?L28
	SET 'ADJ,WRD
	JUMP ?L33
?L28:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT /?L30
	EQUAL? WRD,W?ONE \?L33
?L30:	EQUAL? WRD,P-ANAM,W?ONE \FALSE
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L22
?L33:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L21
?L22:	IGRTR? 'CNT,P-ITBLLEN \?L38
	SET 'P-MERGED,1
	RTRUE
?L38:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L22

	.FUNCT ACLAUSE-WIN,ADJ
	GET P-OTBL,P-VERB >STACK
	PUT P-ITBL,P-VERB,STACK
	SET 'P-CCSRC,P-OTBL
	ADD P-ACLAUSE,1 >STACK
	CALL CLAUSE-COPY,P-ACLAUSE,STACK,ADJ
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'P-NCN,2
?L1:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,?TMP
	PRINTI "(I don't know the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	PRINTR """.)"

	.FUNCT CANT-USE,PTR,BUF,?TMP
	PRINTI "(Sorry, but I don't understand the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI """ when you use it that way.)"
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	CALL MISSING-VERB
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L4:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	GRTR? P-NCN,NUM /?L13
	LESS? NUM,1 /?L8
	ZERO? P-NCN \?L8
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L9
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L8
?L9:	SET 'DRIVE1,SYN
	JUMP ?L13
?L8:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L13
	EQUAL? NUM,2 \?L11
	EQUAL? P-NCN,1 \?L11
	SET 'DRIVE2,SYN
	JUMP ?L13
?L11:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L13
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L13:	DLESS? 'LEN,1 \?L16
	ZERO? DRIVE1 \?L58
	ZERO? DRIVE2 \?L5
	PRINTI "(Sorry, but I don't understand. Please reword that or try something else.)"
	CRLF
	RFALSE
?L16:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L4
?L5:	ZERO? DRIVE1 /?L25
?L58:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L25
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L25:	ZERO? DRIVE2 /?L27
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L27
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L27:	EQUAL? VERB,ACT?FIND,ACT?NAME \?L28
	PRINTI "(Sorry, but I can't answer that question.)"
	CRLF
	RFALSE
?L28:	EQUAL? WINNER,PLAYER \?L32
	CALL ORPHAN,DRIVE1,DRIVE2
	PRINTI "(Wh"
	EQUAL? VERB,ACT?WALK \?L36
	PUSH STR?15
	JUMP ?L38
?L36:	PUSH STR?16
?L38:	PRINT STACK
	PRINTI " do you want to "
	JUMP ?L39
?L32:	PRINTI "(Your command was not complete. Next time, type wh"
	EQUAL? VERB,ACT?WALK \?L42
	PUSH STR?15
	JUMP ?L44
?L42:	PUSH STR?16
?L44:	PRINT STACK
	PRINTI " you want "
	PRINTD WINNER
	PRINTI " to "
?L39:	CALL VERB-PRINT
	ZERO? DRIVE2 /?L45
	CALL CLAUSE-PRINT,P-NC1,P-NC1L
?L45:	ZERO? DRIVE1 /?L48
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L50
?L48:	GETB DRIVE2,P-SPREP2 >STACK
?L50:	CALL PREP-PRINT,STACK
	EQUAL? WINNER,PLAYER \?L51
	SET 'P-OFLAG,1
	PRINTI "?)"
	CRLF
	RFALSE
?L51:	SET 'P-OFLAG,0
	PRINTI ".)"
	CRLF
	RFALSE

	.FUNCT VERB-PRINT,TMP
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	RTRUE
?L1:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L5
	GET TMP,0 >STACK
	PRINTB STACK
	RTRUE
?L5:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
	RTRUE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	PUT P-OCLAUSE,P-MATCHLEN,0
	SET 'P-CCSRC,P-ITBL
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L1
?L2:	EQUAL? P-NCN,2 \?L6
	CALL CLAUSE-COPY,P-NC2,P-NC2L
?L6:	LESS? P-NCN,1 /?L9
	CALL CLAUSE-COPY,P-NC1,P-NC1L
?L9:	ZERO? D1 /?L12
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L12:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT CLAUSE-PRINT,BPTR,EPTR,THE??1=1
	GET P-ITBL,EPTR >STACK
	GET P-ITBL,BPTR >STACK
	CALL BUFFER-PRINT,STACK,STACK,THE??1 >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=0,WRD,FIRST??=1,PN=0
?L1:	EQUAL? BEG,END /TRUE
	ZERO? NOSP /?L6
	SET 'NOSP,0
	JUMP ?L8
?L6:	PRINTI " "
?L8:	GET BEG,0 >WRD
	EQUAL? WRD,W?$PERIOD \?L11
	SET 'NOSP,1
	JUMP ?L18
?L11:	EQUAL? WRD,W?DR \?L13
	PRINTI "Dr."
	SET 'PN,1
	JUMP ?L18
?L13:	EQUAL? WRD,W?HIM,W?HER,W?ME \?L16
	SET 'PN,1
	JUMP ?L18
?L16:	CALL CAPITAL-NOUN?,WRD >STACK
	ZERO? STACK /?L17
	CALL CAPITALIZE,BEG
	SET 'PN,1
	JUMP ?L18
?L17:	ZERO? FIRST?? /?L19
	ZERO? PN \?L19
	ZERO? CP /?L19
	PRINTI "the "
?L19:	ZERO? P-OFLAG \?L26
	ZERO? P-MERGED /?L24
?L26:	PRINTB WRD
	JUMP ?L30
?L24:	EQUAL? WRD,W?IT \?L27
	CALL VISIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L27
	PRINTD P-IT-OBJECT
	JUMP ?L30
?L27:	EQUAL? WRD,W?HER \?L28
	CALL VISIBLE?,P-HER-OBJECT >STACK
	ZERO? STACK /?L28
	PRINTD P-HER-OBJECT
	JUMP ?L30
?L28:	EQUAL? WRD,W?HIM \?L29
	CALL VISIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK /?L29
	PRINTD P-HIM-OBJECT
	JUMP ?L30
?L29:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L30:	SET 'FIRST??,0
?L18:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CAPITALIZE,PTR
	GETB PTR,3 >STACK
	GETB P-INBUF,STACK >STACK
	SUB STACK,32 >STACK
	PRINTC STACK
	GETB PTR,3 >STACK
	INC 'STACK
	GETB PTR,2 >STACK
	DEC 'STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT PREP-PRINT,PREP,SP?=1,WRD
	ZERO? PREP /FALSE
	ZERO? SP? /?L3
	PRINTI " "
?L3:	CALL PREP-FIND,PREP >WRD
	EQUAL? WRD,W?AGAINST \?L8
	PRINTI "against"
	JUMP ?L15
?L8:	EQUAL? WRD,W?THROUGH \?L12
	PRINTI "through"
	JUMP ?L15
?L12:	PRINTB WRD
?L15:	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?SIT,STACK \?L16
	EQUAL? W?DOWN,WRD \?L16
	PRINTI " on"
?L16:	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?GET,STACK \TRUE
	EQUAL? W?OUT,WRD \TRUE
	PRINTI " of"
	RTRUE

	.FUNCT CLAUSE-COPY,BPTR,EPTR,INSERT=0,BEG,END
	GET P-CCSRC,BPTR >BEG
	GET P-CCSRC,EPTR >END
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	PUT P-OTBL,BPTR,STACK
?L1:	EQUAL? BEG,END \?L3
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	PUT P-OTBL,EPTR,STACK
	RTRUE
?L3:	ZERO? INSERT /?L6
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L6
	CALL CLAUSE-ADD,INSERT
?L6:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CLAUSE-ADD,WRD,PTR
	GET P-OCLAUSE,P-MATCHLEN >STACK
	ADD STACK,2 >PTR
	SUB PTR,1 >STACK
	PUT P-OCLAUSE,STACK,WRD
	PUT P-OCLAUSE,PTR,0
	PUT P-OCLAUSE,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-FIND,PREP,CNT=0,SIZE
	GET PREPOSITIONS,0 >STACK
	MUL STACK,2 >SIZE
?L1:	IGRTR? 'CNT,SIZE /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L1
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ,WPREP
	EQUAL? GBIT,RMUNGBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	PRINTI "("
	CALL PREP-PRINT,PREP,0 >STACK
	ZERO? STACK /?L10
	CALL THE?,OBJ
	PRINTI " "
?L10:	PRINTD OBJ
	PRINTI ")"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,PTR
	GET P-ITBL,P-NC1 >PTR
	ZERO? PTR /?L5
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /?L5
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L5:	GET P-ITBL,P-NC2 >PTR
	ZERO? PTR /TRUE
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSI,P-MATCHLEN >STACK
	EQUAL? STACK,1 \?L14
	CALL BUT-MERGE,P-PRSO >P-PRSO
	RTRUE
?L14:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,BUT=0,LEN,WV,WRD,NW
	SET 'P-AND,0
	SET 'P-GETFLAGS,0
	SET 'P-CSPTR,PTR
	SET 'P-CEPTR,EPTR
	PUT P-BUTS,P-MATCHLEN,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WRD
?L1:	EQUAL? PTR,EPTR \?L3
?L40:	ZERO? BUT /?L6
	PUSH BUT
	JUMP ?L5
?L6:	PUSH TBL
?L5:	CALL GET-OBJECT,STACK >STACK
	RSTACK
?L3:	GET PTR,P-LEXELEN >NW
	CALL BUZZER-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	EQUAL? WRD,W?A,W?ONE \?L10
	ZERO? P-ADJ \?L11
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L35
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L35
?L11:	SET 'P-NAM,P-ONEOBJ
	ZERO? BUT /?L20
	PUSH BUT
	JUMP ?L19
?L20:	PUSH TBL
?L19:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L35
?L10:	EQUAL? WRD,W?AND,W?$COMMA \?L23
	EQUAL? NW,W?AND,W?$COMMA /?L23
	SET 'P-AND,1
	ZERO? BUT /?L27
	PUSH BUT
	JUMP ?L26
?L27:	PUSH TBL
?L26:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L35
?L23:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L35
	EQUAL? WRD,W?AND,W?$COMMA /?L35
	EQUAL? WRD,W?OF \?L30
	ZERO? P-GETFLAGS \?L35
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L35
?L30:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L34
	ZERO? P-ADJ \?L34
	SET 'P-ADJ,WV
	SET 'P-ADJN,WRD
	JUMP ?L35
?L34:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L35
	SET 'P-NAM,WRD
	SET 'P-ONEOBJ,WRD
?L35:	EQUAL? PTR,EPTR /?L40
	ADD PTR,P-WORDLEN >PTR
	SET 'WRD,NW
	JUMP ?L1

	.FUNCT GET-OBJECT,TBL,VRB=1,BTS,LEN,XBITS,TLEN,GCHECK=0,OLEN=0,OBJ,ADJ
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	SET 'ADJ,P-ADJN
	ZERO? P-NAM \?L11
	ZERO? P-ADJ /?L8
	CALL WT?,P-ADJN,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L6
	SET 'P-NAM,P-ADJN
	SET 'P-ADJ,0
	JUMP ?L8
?L6:	CALL WT?,P-ADJN,PS?DIRECTION,P1?DIRECTION >BTS
	ZERO? BTS /?L8
	SET 'P-ADJ,0
	PUT TBL,P-MATCHLEN,1
	PUT TBL,1,INTDIR
	SET 'P-DIRECTION,BTS
	RTRUE
?L8:	ZERO? P-NAM \?L11
	ZERO? P-ADJ \?L11
	EQUAL? P-GETFLAGS,P-ALL /?L72
	ZERO? P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	CALL MISSING-NOUN,ADJ
	RFALSE
?L11:	EQUAL? P-GETFLAGS,P-ALL \?L19
?L72:	ZERO? P-SLOCBITS \?L17
?L19:	SET 'P-SLOCBITS,-1
?L17:	SET 'P-TABLE,TBL
?L21:	ZERO? GCHECK /?L23
	CALL GLOBAL-CHECK,TBL
	JUMP ?L25
?L23:	ZERO? LIT /?L26
	FCLEAR PLAYER,TRANSBIT
	CALL DO-SL,HERE,SOG,SIR
	FSET PLAYER,TRANSBIT
?L26:	CALL DO-SL,PLAYER,SH,SC
?L25:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL /?L65
	BTST P-GETFLAGS,P-ONE \?L31
	ZERO? LEN /?L31
	EQUAL? LEN,1 /?L32
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "(How about"
	GET TBL,1 >STACK
	CALL PRINTT,STACK
	PRINTI "?)"
	CRLF
?L32:	PUT TBL,P-MATCHLEN,1
	JUMP ?L65
?L31:	GRTR? LEN,1 /?L38
	ZERO? LEN \?L65
	EQUAL? P-SLOCBITS,-1 /?L37
?L38:	EQUAL? P-SLOCBITS,-1 \?L39
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L21
?L39:	ZERO? LEN \?L42
	SET 'LEN,OLEN
?L42:	ZERO? P-NAM /?L45
	ADD TLEN,1 >STACK
	GET TBL,STACK >OBJ
	ZERO? OBJ /?L45
	GETP OBJ,P?GENERIC >STACK
	CALL STACK,OBJ >OBJ
	ZERO? OBJ /?L45
	EQUAL? OBJ,NOT-HERE-OBJECT /FALSE
	PUT TBL,1,OBJ
	PUT TBL,P-MATCHLEN,1
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE
?L45:	ZERO? VRB /?L54
	ZERO? P-NAM /?L50
	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L51
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L53
?L51:	SET 'P-ACLAUSE,P-NC2
?L53:	SET 'P-AADJ,P-ADJ
	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L54
?L50:	ZERO? VRB /?L54
	CALL MISSING-NOUN,ADJ
?L54:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L37:	ZERO? LEN \?L65
	ZERO? GCHECK /?L56
	ZERO? VRB /?L61
	SET 'P-SLOCBITS,XBITS
	ZERO? LIT /?L59
	CALL OBJ-FOUND,NOT-HERE-OBJECT,TBL
	SET 'P-XNAM,P-NAM
	SET 'P-XADJ,P-ADJ
	SET 'P-XADJN,P-ADJN
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	RTRUE
?L59:	PRINTI "(It's too dark to see!)"
	CRLF
?L61:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L56:	ZERO? LEN \?L65
	SET 'GCHECK,1
	JUMP ?L21
?L65:	ZERO? P-ADJ /?L67
	ZERO? P-NAM \?L67
	PRINT I-ASSUME
	ADD TLEN,1 >STACK
	GET TBL,STACK >STACK
	CALL PRINTT,STACK
	PRINTI ".)"
	CRLF
?L67:	SET 'P-SLOCBITS,XBITS
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE

	.FUNCT MISSING-NOUN,ADJ
	EQUAL? ADJ,W?NUMBER \?L1
	PRINTR "(Please use units with numbers.)"
?L1:	PRINTR "(I couldn't find enough nouns in that sentence!)"

	.FUNCT MISSING-VERB
	PRINTR "(I couldn't find a verb in that sentence!)"

	.FUNCT MOBY-FIND,TBL,FOO,LEN
	SET 'P-SLOCBITS,-1
	SET 'P-NAM,P-XNAM
	SET 'P-ADJ,P-XADJ
	PUT TBL,P-MATCHLEN,0
	FIRST? ROOMS >FOO \?L3
?L4:	CALL SEARCH-LIST,FOO,TBL,P-SRCALL
	NEXT? FOO >FOO /?L4
?L3:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L8
	CALL DO-SL,LOCAL-GLOBALS,1,1
?L8:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L11
	CALL DO-SL,ROOMS,1,1
?L11:	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L14
	GET TBL,1 >P-MOBY-FOUND
?L14:	RETURN LEN

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	SET 'RLEN,LEN
	PRINTI "(Which"
	ZERO? P-OFLAG \?L5
	ZERO? P-MERGED \?L5
	ZERO? P-AND /?L3
?L5:	PRINTI " "
	PRINTB P-NAM
	JUMP ?L9
?L3:	EQUAL? TBL,P-PRSO \?L8
	CALL CLAUSE-PRINT,P-NC1,P-NC1L,0
	JUMP ?L9
?L8:	CALL CLAUSE-PRINT,P-NC2,P-NC2L,0
?L9:	PRINTI " do you mean,"
?L12:	INC 'TLEN
	GET TBL,TLEN >OBJ
	CALL PRINTT,OBJ
	EQUAL? LEN,2 \?L16
	EQUAL? RLEN,2 /?L18
	PRINTI ","
?L18:	PRINTI " or"
	JUMP ?L25
?L16:	GRTR? LEN,2 \?L25
	PRINTI ","
?L25:	DLESS? 'LEN,1 \?L12
	PRINTR "?)"

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS,FOO
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETPT HERE,P?PSEUDO >RMG
	ZERO? RMG /?L15
	PTSIZE RMG >STACK
	DIV STACK,4 >STACK
	SUB STACK,1 >RMGL
	SET 'CNT,0
?L14:	MUL CNT,2 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L16
	SET 'LAST-PSEUDO-LOC,HERE
	MUL CNT,2 >STACK
	INC 'STACK
	GET RMG,STACK >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	GETPT PSEUDO-OBJECT,P?ACTION >STACK
	SUB STACK,5 >FOO
	GET P-NAM,0 >STACK
	PUT FOO,0,STACK
	GET P-NAM,1 >STACK
	PUT FOO,1,STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L15
?L16:	IGRTR? 'CNT,RMGL \?L14
?L15:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	GET TBL,P-MATCHLEN >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?SMELL /?L27
	EQUAL? PRSA,V?SEARCH-FOR,V?SEARCH,V?LOOK-INSIDE /?L27
	EQUAL? PRSA,V?LEAVE /?L27
	EQUAL? PRSA,V?FOLLOW,V?FIND,V?EXAMINE \FALSE
?L27:	CALL DO-SL,ROOMS,1,1 >STACK
	RSTACK

	.FUNCT DO-SL,OBJ,BIT1,BIT2,BITS
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL,FLS
	FIRST? OBJ >OBJ \FALSE
?L3:	EQUAL? LVL,P-SRCBOT /?L5
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L5
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	EQUAL? LVL,P-SRCTOP \?L10
	FSET? OBJ,SEARCHBIT /?L10
	FSET? OBJ,SURFACEBIT \?L8
?L10:	FIRST? OBJ >STACK \?L8
	EQUAL? OBJ,PLAYER,LOCAL-GLOBALS /?L8
	FSET? OBJ,SURFACEBIT \?L11
	PUSH P-SRCALL
	JUMP ?L14
?L11:	FSET? OBJ,SEARCHBIT \?L13
	PUSH P-SRCALL
	JUMP ?L14
?L13:	PUSH P-SRCTOP
?L14:	CALL SEARCH-LIST,OBJ,TBL,STACK >FLS
?L8:	NEXT? OBJ >OBJ /?L3
	RTRUE

	.FUNCT THIS-IT?,OBJ,TBL,SYNS
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	ZERO? P-ADJ /?L4
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DEC 'STACK
	CALL ZMEMQB,P-ADJ,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L4:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,BITS,PTR,OBJ,TAKEN
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST BITS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L8
	SET 'OBJ,P-IT-OBJECT
	JUMP ?L11
?L8:	EQUAL? OBJ,HER \?L10
	SET 'OBJ,P-HER-OBJECT
	JUMP ?L11
?L10:	EQUAL? OBJ,HIM \?L11
	SET 'OBJ,P-HIM-OBJECT
?L11:	IN? OBJ,WINNER /?L3
	SET 'PRSO,OBJ
	FSET? OBJ,TRYTAKEBIT \?L15
	SET 'TAKEN,1
	JUMP ?L18
?L15:	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \?L17
	SET 'TAKEN,0
	JUMP ?L18
?L17:	SET 'TAKEN,1
?L18:	ZERO? TAKEN /?L31
	BTST BITS,SHAVE \?L19
	PRINTI "(You aren't holding"
	EQUAL? OBJ,NOT-HERE-OBJECT \?L23
	PRINTI " that!)"
	CRLF
	RFALSE
?L23:	CALL PRINTT,OBJ
	PRINTI "!)"
	CRLF
	RFALSE
?L19:	ZERO? TAKEN \?L3
?L31:	PRINTI "(taking"
	CALL THE-PRSO-PRINT
	ZERO? ITAKE-LOC /?L33
	PRINTI " from "
	PRINTD ITAKE-LOC
?L33:	PRINTI " first)"
	CRLF
	JUMP ?L3

	.FUNCT MANY-CHECK,LOSS=0,TMP
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	PRINTI "(You can't use more than one "
	EQUAL? LOSS,2 \?L9
	PRINTI "in"
?L9:	PRINTI "direct object with """
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L16
	PRINTI "tell"
	JUMP ?L21
?L16:	ZERO? P-OFLAG /?L20
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L21
?L20:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L21:	PRINTI """!)"
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT ZMEMQBIT,ITM,TBL,SIZE,CNT=0,X
?L1:	GETB TBL,CNT >X
	FSET? X,ITM \?L3
	RETURN X
?L3:	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT PRSO-PRINT,PTR
	PRINTI " "
	PRINTD PRSO
	RTRUE

	.FUNCT THE-PRSO-PRINT
	CALL THE?,PRSO
	CALL PRSO-PRINT >STACK
	RSTACK

	.FUNCT PRSI-PRINT,PTR
	PRINTI " "
	PRINTD PRSI
	RTRUE

	.FUNCT THE-PRSI-PRINT
	CALL THE?,PRSI
	CALL PRSI-PRINT >STACK
	RSTACK

	.FUNCT DO-INSTEAD-OF,OBJ1,OBJ2
	EQUAL? PRSI,OBJ2 \?L1
	CALL PERFORM,PRSA,PRSO,OBJ1 >STACK
	RSTACK
?L1:	EQUAL? PRSO,OBJ2 \?L3
	CALL PERFORM,PRSA,OBJ1,PRSI >STACK
	RSTACK
?L3:	CALL V-FOO >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT TURN-F
	EQUAL? PRSA,V?USE \FALSE
	CALL PERFORM,V?WAIT-FOR,PRSO
	RTRUE

	.FUNCT IT-F
	EQUAL? PRSI,IT \?L4
	EQUAL? PRSA,V?TELL-ABOUT,V?SEARCH-FOR,V?ASK-FOR /?L5
	EQUAL? PRSA,V?ASK-ABOUT /?L5
?L4:	EQUAL? PRSO,IT \FALSE
	EQUAL? PRSA,V?WHAT /?L5
	EQUAL? PRSA,V?FIND,V?ASK-CONTEXT-FOR,V?ASK-CONTEXT-ABOUT \FALSE
?L5:	PRINTR """I'm not sure what you're talking about."""

	.FUNCT FLOOR-F
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,FLOOR \?L1
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?WALK-TO,V?THROUGH \?L3
	ZERO? SUB-IN-TANK /FALSE
	CALL PERFORM,PRSA,TEST-TANK
	RTRUE
?L3:	EQUAL? PRSA,V?LOOK-ON,V?SEARCH,V?EXAMINE \FALSE
	PRINTR "You don't find anything new there."

	.FUNCT GLOBAL-SNARK-F
	EQUAL? PRSA,V?FIND,V?EXAMINE \?L1
	ZERO? SNARK-ATTACK-COUNT \TRUE
?L1:	EQUAL? PRSA,V?FIND \FALSE
	ZERO? MONSTER-GONE \FALSE
	PRINTI "It's attacking the "
	PRINTD AQUADOME
	PRINTR "!"

	.FUNCT MIKE-3-F,OBJ
	PRINTI "The "
	PRINTD OBJ
	PRINTI " is mounted on "
	CALL PRINTA,CLAW
	PRINTR "."

	.FUNCT CANT-SEND
	PRINTR "You can't send it. Only you can pilot it there."

	.FUNCT LOCAL-SUB-F
	EQUAL? PRSA,V?TURN,V?PUT \?L1
	CALL MORE-SPECIFIC >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?SEARCH-FOR,V?SEARCH \?L3
	CALL DO-INSTEAD-OF,SUB,LOCAL-SUB
	RTRUE
?L3:	EQUAL? PRSA,V?EXAMINE \?L4
	GET ON-SUB,0 >STACK
	ZERO? STACK \?L5
	GET ON-SUB,1 >STACK
	ZERO? STACK \?L5
	GETP LOCAL-SUB,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L5:	GET ON-SUB,0 >STACK
	ZERO? STACK /?L10
	GET ON-SUB,0 >STACK
	CALL MIKE-3-F,STACK
?L10:	GET ON-SUB,1 >STACK
	ZERO? STACK /TRUE
	GET ON-SUB,1 >STACK
	CALL MIKE-3-F,STACK
	RTRUE
?L4:	EQUAL? PRSA,V?FIND \?L16
	CALL INT,I-SEND-SUB >STACK
	PUT STACK,0,0
	PRINTR "It's right here!"
?L16:	EQUAL? PRSA,V?LOOK-BEHIND /?L20
	EQUAL? PRSA,V?LOOK-OUTSIDE \?L19
	EQUAL? HERE,SUB \?L19
?L20:	CALL PERFORM,V?LOOK-OUTSIDE,SUB-WINDOW
	RTRUE
?L19:	EQUAL? PRSA,V?LOOK-INSIDE \?L21
	EQUAL? HERE,SUB,CRAWL-SPACE \?L22
	CALL PERFORM,V?LOOK
	RTRUE
?L22:	PRINTR "You can't see much from here."
?L21:	EQUAL? PRSA,V?SEND-TO,V?SEND-OUT,V?SEND \?L27
	EQUAL? PRSO,LOCAL-SUB \?L27
	CALL CANT-SEND >STACK
	RSTACK
?L27:	EQUAL? PRSA,V?BOARD,V?THROUGH \?L28
	EQUAL? HERE,SUB,CRAWL-SPACE \?L29
	CALL ALREADY,WINNER,STR?17 >STACK
	RSTACK
?L29:	EQUAL? HERE,AIRLOCK-WALL \?L31
	CALL GOTO,AIRLOCK >STACK
	ZERO? STACK /FALSE
	CALL GOTO,SUB >STACK
	ZERO? STACK /TRUE
	EQUAL? WINNER,PLAYER /TRUE
	CALL OKAY
	RTRUE
?L31:	EQUAL? HERE,WEST-TANK-AREA,SOUTH-TANK-AREA \?L38
	GETP WEST-TANK-AREA,P?EAST >STACK
	PRINT STACK
	CRLF
	RTRUE
?L38:	CALL DO-WALK,P?IN
	RTRUE
?L28:	EQUAL? PRSA,V?RAISE,V?DROP,V?DISEMBARK \?L42
	EQUAL? HERE,SUB,CRAWL-SPACE /?L43
	PRINTR "You're not in it!"
?L43:	EQUAL? PRSA,V?DROP \?L47
	CALL DO-WALK,P?DOWN
	RTRUE
?L47:	EQUAL? PRSA,V?RAISE \?L48
	CALL DO-WALK,P?UP
	RTRUE
?L48:	CALL DO-WALK,P?OUT
	RTRUE
?L42:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L50
	EQUAL? HERE,CRAWL-SPACE,AIRLOCK-WALL /?L50
	CALL PERFORM,PRSA,SUB-DOOR
	RTRUE
?L50:	EQUAL? PRSA,V?ANALYZE \?L51
	EQUAL? PRSI,DAMAGE,GLOBAL-SABOTAGE,0 \?L51
	PRINTI "You can do this by pushing the "
	PRINTD TEST-BUTTON
	EQUAL? HERE,SUB,CRAWL-SPACE /?L54
	PRINTI " on the "
	PRINTD CONTROLS
	PRINTI " inside"
?L54:	PRINTR "."
?L51:	EQUAL? PRSA,V?LAMP-ON \?L61
	EQUAL? HERE,SUB /?L62
	CALL THIS-IS-IT,SUB
	PRINTI "You have to be in the "
	PRINTD SUB
	PRINTR " to start it."
?L62:	FSET? REACTOR,ONBIT /?L66
	CALL THIS-IS-IT,REACTOR
	PRINTR "The reactor is off!"
?L66:	ZERO? SUB-IN-TANK /?L71
	ZERO? TEST-TANK-FULL \?L71
	CALL THIS-IS-IT,TEST-TANK >STACK
	ZERO? STACK \?L70
?L71:	ZERO? SUB-IN-DOME /?L69
	ZERO? AIRLOCK-FULL \?L69
	CALL THIS-IS-IT,AIRLOCK >STACK
	ZERO? STACK /?L69
?L70:	PRINTR "The tank is empty!"
?L69:	ZERO? SUB-IN-TANK /?L76
	FSET? TANK-GATE,OPENBIT /?L76
	CALL THIS-IS-IT,TANK-GATE >STACK
	ZERO? STACK \?L75
?L76:	ZERO? SUB-IN-DOME /?L74
	FSET? AIRLOCK-HATCH,OPENBIT /?L74
	CALL THIS-IS-IT,AIRLOCK-HATCH >STACK
	ZERO? STACK /?L74
?L75:	PRINTR "The gate is closed!"
?L74:	FSET? ENGINE,ONBIT /?L79
	CALL THIS-IS-IT,ENGINE
	PRINTR "The engine is off!"
?L79:	PRINTI "You can do this by setting the throttle to the speed you want (slow, medium, or fast) and by moving the "
	PRINTD JOYSTICK
	PRINTI " in the "
	PRINTD INTDIR
	PRINTR " you wish to go."
?L61:	EQUAL? PRSA,V?STOP \FALSE
	EQUAL? HERE,SUB /?L86
	CALL THIS-IS-IT,SUB
	PRINTI "You have to be in the "
	PRINTD SUB
	PRINTR " to stop it."
?L86:	FSET? ENGINE,ONBIT /?L90
	PRINTR "The engine is off!"
?L90:	SET 'TARGET-DEPTH,SUB-DEPTH
	PRINT I-ASSUME
	PRINTI " close the "
	PRINTD THROTTLE
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?CLOSE,THROTTLE
	RTRUE

	.FUNCT GLOBAL-SUB-2-F
	CALL DO-INSTEAD-OF,GLOBAL-SUB,GLOBAL-SUB-2
	RTRUE

	.FUNCT GLOBAL-SUB-F
	ZERO? SUB-IN-TANK /?L1
	ZERO? BLY-TOLD-PROBLEM \?L3
	EQUAL? PRSO,GLOBAL-BLY /?L1
?L3:	EQUAL? PRSA,V?FIND /?L4
	EQUAL? PRSA,V?ASK-ABOUT \?L1
	FSET? PRSO,PERSON \?L1
?L4:	CALL INT,I-SEND-SUB >STACK
	PUT STACK,0,0
	PRINTI "The only sub at"
	CALL RESEARCH-LAB
	PRINTI " is your new "
	PRINTD GLOBAL-SUB
	PRINTI ". It's located in the test tank just south of "
	PRINTD YOUR-LABORATORY
	PRINTR "."
?L1:	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?BOARD \?L9
	CALL CHEERS?
	CALL GOTO,SUB >STACK
	ZERO? STACK /TRUE
	EQUAL? WINNER,PLAYER /TRUE
	CALL OKAY
	RTRUE
?L9:	EQUAL? PRSA,V?PUT \?L13
	FSET? PRSO,WEAPONBIT /FALSE
	CALL MORE-SPECIFIC >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?SEND-TO,V?SEND-OUT,V?SEND \FALSE
	EQUAL? PRSO,GLOBAL-SUB \FALSE
	CALL CANT-SEND >STACK
	RSTACK

	.FUNCT CONTROLS-F
	EQUAL? HERE,CENTER-OF-LAB \?L1
	EQUAL? PRSA,V?LAMP-OFF,V?LAMP-ON,V?EXAMINE /?L1
	CALL DO-INSTEAD-OF,VIDEOPHONE,CONTROLS
	RTRUE
?L1:	EQUAL? HERE,WEST-TANK-AREA \FALSE
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "These are valves, gauges and control gear needed to make full use of the tank. Two important controls are the "
	PRINTD OPEN-GATE-BUTTON
	PRINTI " and the "
	PRINTD FILL-TANK-BUTTON
	PRINTI ". This gear can be operated by remote control from all "
	CALL PRINT-NAME,LAST-NAME
	PRINTR " subs."

	.FUNCT PHONE-ON,PER,PWHERE,ON
	SET 'REMOTE-PERSON,PER
	SET 'QCONTEXT,PER
	CALL THIS-IS-IT,PER
	SET 'REMOTE-PERSON-REMLOC,PWHERE
	SET 'REMOTE-PERSON-ON,ON
	SET 'REMOTE-PERSON-LOC,HERE
	SET 'QCONTEXT-ROOM,HERE
	MOVE REMOTE-PERSON,REMOTE-PERSON-LOC
	RTRUE

	.FUNCT PHONE-OFF
	ZERO? REMOTE-PERSON /FALSE
	MOVE REMOTE-PERSON,GLOBAL-OBJECTS
	SET 'REMOTE-PERSON,0
	SET 'REMOTE-PERSON-LOC,0
	SET 'REMOTE-PERSON-ON,0
	RETURN REMOTE-PERSON-ON

	.FUNCT INTERCOM-F,P,L
	EQUAL? PRSA,V?SAY-INTO,V?LAMP-ON \?L1
	PRINTR "Try the command: CALL (someone) ON THE INTERCOM."
?L1:	EQUAL? PRSA,V?PHONE \FALSE
	FSET? PRSO,PERSON \?L6
	GETP PRSO,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >P
	LOC P >L
	JUMP ?L8
?L6:	CALL HAR-HAR
	RTRUE
?L8:	EQUAL? L,EAST-WALL \?L12
	EQUAL? HERE,OFFICE /?L11
?L12:	EQUAL? HERE,EAST-WALL \?L9
	EQUAL? L,OFFICE \?L9
?L11:	EQUAL? P,SHARON \?L13
	IN? SHARON,OFFICE \?L13
	FCLEAR SHARON,NDESCBIT
	FCLEAR FILE-DRAWER,NDESCBIT
	FCLEAR PAPERS,NDESCBIT
?L13:	MOVE P,HERE
	PRINTI "Here "
	JUMP ?L18
?L9:	PRINTI "There's no "
	PRINTD INTERCOM
	PRINTI " line to where "
?L18:	CALL HE-SHE-IT,P
	PRINTR " is."

	.FUNCT A-O-K
	PRINTR "All systems A-O-K."

	.FUNCT TEST-BUTTON-F
	EQUAL? PRSA,V?LAMP-ON /?L3
	EQUAL? PRSA,V?LAMP-OFF,V?TURN,V?PUSH \FALSE
?L3:	EQUAL? HERE,CENTER-OF-LAB \?L4
	FSET? VIDEOPHONE,MUNGBIT \?L6
	CALL TELL-HINT,83,POWER-SUPPLY,0
	RTRUE
?L6:	EQUAL? P-XADJN,W?TEST \?L8
	CALL A-O-K
	RTRUE
?L8:	IN? MICROPHONE,PLAYER \?L9
	EQUAL? PRSA,V?LAMP-ON,V?LAMP-OFF \?L10
	CALL PERFORM,PRSA,MICROPHONE
	RTRUE
?L10:	FSET? MICROPHONE,ONBIT \?L12
	CALL PERFORM,V?LAMP-OFF,MICROPHONE
	RTRUE
?L12:	CALL PERFORM,V?LAMP-ON,MICROPHONE
	RTRUE
?L9:	EQUAL? PRSA,V?LAMP-OFF \?L14
	CALL PERFORM,V?LAMP-OFF,VIDEOPHONE
	RTRUE
?L14:	CALL PERFORM,V?LAMP-ON,VIDEOPHONE
	RTRUE
?L4:	EQUAL? HERE,SUB,CRAWL-SPACE \?L16
	ZERO? TEST-BUTTON-READOUT /FALSE
	PRINTI "Readout display says:
"
	EQUAL? TEST-BUTTON-READOUT,TEST-BUTTON-NORMAL \?L21
	CALL A-O-K
	RTRUE
?L21:	EQUAL? TEST-BUTTON-READOUT,GATE-CRASHED-MSG \?L23
	PRINTR "No damage. Hull still watertight."
?L23:	EQUAL? TEST-BUTTON-READOUT,REGULATOR-MSG \?L26
	SET 'REGULATOR-MSG-SEEN,1
	PRINTI "Lasers in operational computers are over-charging.
To correct, adjust "
	PRINTD VOLTAGE-REGULATOR
	PRINTI ".
WARNING: "
	PRINTD VOLTAGE-REGULATOR
	PRINTI " is reachable only from "
	PRINTD CRAWL-SPACE
	PRINTI ", behind the "
	PRINTD ENGINE-ACCESS-HATCH
	PRINTR ". This is a hazardous operation at sea!"
?L26:	EQUAL? TEST-BUTTON-READOUT,TEST-BUTTON-POD \?L29
	PRINTD ESCAPE-POD-UNIT
	PRINTR " is not properly connected."
?L29:	EQUAL? TEST-BUTTON-READOUT,CLAW-MUNGED-MSG \?L32
	PRINTI "The "
	PRINTD CLAW
	PRINTI " is damaged."
?L32:	CRLF
	RTRUE
?L16:	EQUAL? P-XADJN,W?TEST \?L37
	CALL A-O-K >STACK
	RSTACK
?L37:	EQUAL? HERE,EAST-WALL \?L38
	EQUAL? PRSA,V?LAMP-OFF \?L39
	CALL PERFORM,V?LAMP-OFF,MICROWAVE-SECURITY-SCANNER
	RTRUE
?L39:	CALL PERFORM,V?LAMP-ON,MICROWAVE-SECURITY-SCANNER
	RTRUE
?L38:	EQUAL? HERE,NORTH-WALL \FALSE
	EQUAL? PRSA,V?LAMP-OFF \?L43
	CALL PERFORM,V?LAMP-OFF,COMPUTESTOR
	RTRUE
?L43:	CALL PERFORM,V?LAMP-ON,COMPUTESTOR
	RTRUE

	.FUNCT GLOBAL-SONAR-F
	EQUAL? HERE,SUB,CRAWL-SPACE \?L1
	CALL DO-INSTEAD-OF,SONARSCOPE,GLOBAL-SONAR
	RTRUE
?L1:	ZERO? SUB-IN-DOME /?L3
	CALL DO-INSTEAD-OF,SONAR-EQUIPMENT,GLOBAL-SONAR
	RTRUE
?L3:	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	CALL NOT-HERE,GLOBAL-SONAR >STACK
	RSTACK

	.FUNCT ALARM-F
	EQUAL? PRSA,V?STOP /?L3
	EQUAL? PRSA,V?REPLY,V?LISTEN,V?LAMP-OFF \FALSE
?L3:	ZERO? ALARM-RINGING /?L4
	CALL WHY-NOT-VP >STACK
	RSTACK
?L4:	PRINTR "It's not ringing!"

	.FUNCT WHY-NOT-VP
	PRINTI "Why not turn on the "
	PRINTD VIDEOPHONE
	PRINTR "?"

	.FUNCT VIDEOPHONE-2-F
	PRINT I-ASSUME
	PRINTI " the "
	PRINTD VIDEOPHONE
	PRINTI ".)"
	CRLF
	CALL DO-INSTEAD-OF,VIDEOPHONE,VIDEOPHONE-2
	RTRUE

	.FUNCT VIDEOPHONE-F,ARG,V
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	EQUAL? REMOTE-PERSON-ON,VIDEOPHONE \?L3
	PRINTI "You can see "
	PRINTD REMOTE-PERSON
	PRINTI " on"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L3:	ZERO? WOMAN-ON-SCREEN /?L7
	PRINTI "You can see a fuzzy picture of a woman on"
	CALL THE-PRSO-PRINT
	PRINTR ". Maybe you should turn the knob."
?L7:	FSET? VIDEOPHONE,ONBIT \?L10
	PRINTI "The "
	PRINTD VIDEOPHONE
	PRINTR " is on, but no one's on the screen."
?L10:	PRINTR "The screen is dark."
?L1:	EQUAL? PRSA,V?LISTEN \?L16
	EQUAL? REMOTE-PERSON-ON,VIDEOPHONE \?L17
	CALL PERFORM,PRSA,REMOTE-PERSON
	RTRUE
?L17:	ZERO? WOMAN-ON-SCREEN /?L19
	PRINTI "You can hear fuzzy sound from"
	CALL THE-PRSO-PRINT
	PRINTR ". Maybe you should turn the knob."
?L19:	ZERO? ALARM-RINGING /FALSE
	PRINTI "An "
	PRINTD ALARM
	PRINTI " on the "
	PRINTD VIDEOPHONE
	PRINTR " is ringing."
?L16:	EQUAL? PRSA,V?ANALYZE \?L26
	EQUAL? PRSI,GLOBAL-SABOTAGE \?L26
	ZERO? SUB-IN-TANK /?L26
	PRINTI "If you wish to determine at once whether any saboteur or other intruder may have penetrated"
	CALL RESEARCH-LAB
	PRINTI ", activate the "
	PRINTD MICROWAVE-SECURITY-SCANNER
	PRINTR "."
?L26:	EQUAL? PRSA,V?WALK-TO \?L31
	ZERO? SUB-IN-TANK \?L32
	ZERO? SUB-IN-DOME /?L31
?L32:	EQUAL? HERE,CENTER-OF-LAB,COMM-BLDG /?L31
	ZERO? SUB-IN-TANK /?L33
	CALL PERFORM,V?WALK-TO,CENTER-OF-LAB
	RTRUE
?L33:	CALL PERFORM,V?WALK-TO,COMM-BLDG
	RTRUE
?L31:	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	EQUAL? HERE,CENTER-OF-LAB,COMM-BLDG /?L37
	PRINTI "You must be in the "
	ZERO? SUB-IN-TANK /?L40
	PRINTD CENTER-OF-LAB
	JUMP ?L44
?L40:	PRINTD COMM-BLDG
?L44:	PRINTR " to do that."
?L37:	EQUAL? PRSA,V?TURN,V?FIX,V?ADJUST \?L49
	FSET? VIDEOPHONE,MUNGBIT \?L50
	PRINTI "You can't fix the "
	PRINTD VIDEOPHONE
	PRINTI " until you know what is wrong. The simplest way to find out is to consult your "
	CALL PRINT-NAME,LAST-NAME
	PRINTI " "
	PRINTD COMPUTESTOR
	PRINTI ", which is programmed to troubleshoot many of your inventions. Or, alternately, you may have the "
	PRINTD VIDEOPHONE
	PRINTI " repaired by a "
	PRINTD GLOBAL-TECHNICIAN
	PRINTR "."
?L50:	FSET? VIDEOPHONE,ONBIT /?L54
	CALL WHY-NOT-VP
	RTRUE
?L54:	ZERO? WOMAN-ON-SCREEN \?L55
	PRINTR "Nothing changes."
?L55:	SET 'WOMAN-ON-SCREEN,0
	CALL PHONE-ON,GLOBAL-BLY,AQUADOME,VIDEOPHONE
	CALL THIS-IS-IT,PROBLEM
	PRINTI "Ah, that's better! You recognize the woman as "
	PRINTD BLY
	PRINTI ", who's in charge of the "
	PRINT URS
	PRINTI " of "
	PRINTD IU-GLOBAL
	PRINTI ", called the "
	PRINTD AQUADOME
	PRINTI ", just off the Atlantic coast. """
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"" she's saying. ""This is the "
	PRINTD AQUADOME
	PRINTI " calling"
	CALL RESEARCH-LAB
	PRINTI "! We have an urgent problem!"""
	CRLF
	CALL SCORE-OBJ,VIDEOPHONE-2
	RTRUE
?L49:	EQUAL? PRSA,V?LAMP-OFF \?L63
	FSET? VIDEOPHONE,ONBIT \FALSE
	SET 'WOMAN-ON-SCREEN,0
	FCLEAR VIDEOPHONE,ONBIT
	EQUAL? REMOTE-PERSON-ON,VIDEOPHONE \?L67
	FSET? MICROPHONE,ONBIT \?L67
	CALL PERFORM,V?GOODBYE,REMOTE-PERSON
	RTRUE
?L67:	CALL PHONE-OFF
	PRINTR "The screen goes dark."
?L63:	EQUAL? PRSA,V?REPLY,V?LAMP-ON \?L72
	ZERO? SUB-IN-TANK /?L72
	FSET? VIDEOPHONE,ONBIT \?L73
	CALL ALREADY,VIDEOPHONE,STR?18
	RTRUE
?L73:	FSET? CIRCUIT-BREAKER,OPENBIT /?L76
	FSET? VIDEOPHONE,MUNGBIT \?L75
?L76:	PRINTR "You can't. It's conked out."
?L75:	CALL INT,I-LAMP-ON-SCOPE >STACK
	PUT STACK,0,0
	FSET VIDEOPHONE,ONBIT
	ZERO? ALARM-RINGING /?L80
	SET 'ALARM-RINGING,0
	CALL QUEUE,I-ALARM-RINGING,0
	SET 'WOMAN-ON-SCREEN,1
	CALL THIS-IS-IT,GLOBAL-BLY
	PRINTI "As the "
	PRINTD ALARM
	PRINTI " stops ringing, a picture of a woman holding a "
	PRINTD MICROPHONE
	PRINTI " appears, and you can hear her voice from the speaker. But both sound and picture are fuzzy."
	CRLF
	CALL SCORE-OBJ,VIDEOPHONE
	RTRUE
?L80:	PRINTR "A test pattern appears."
?L72:	EQUAL? PRSA,V?PHONE \FALSE
	ZERO? WOMAN-ON-SCREEN \?L90
	EQUAL? REMOTE-PERSON-ON,VIDEOPHONE \?L88
?L90:	PRINTI "You should finish talking with "
	ZERO? WOMAN-ON-SCREEN /?L93
	PRINTI "the woman"
	JUMP ?L97
?L93:	PRINTD REMOTE-PERSON
?L97:	PRINTR " first."
?L88:	EQUAL? PRSO,YOUR-LABORATORY \?L103
	ZERO? SUB-IN-DOME /?L103
	PRINTR "There's no answer."
?L103:	EQUAL? PRSO,GLOBAL-BLY,AQUADOME \FALSE
	ZERO? SUB-IN-TANK /FALSE
	ZERO? BLY-TOLD-PROBLEM /?L108
	PRINTI "There's no answer. The crew must be busy with the "
	PRINTD SNARK
	PRINTR "."
?L108:	ZERO? ALARM-RINGING /FALSE
	CALL PERFORM,V?LAMP-ON,VIDEOPHONE
	RTRUE

	.FUNCT GLOBAL-SABOTAGE-F
	EQUAL? PRSA,V?ANALYZE \FALSE
	EQUAL? PRSO,VIDEOPHONE \FALSE
	CALL INT,I-TIP-SAYS >STACK
	PUT STACK,0,0
	RFALSE

	.FUNCT WATER-F
	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	ZERO? SUB-IN-TANK /?L3
	CALL IN-TANK-AREA?,HERE >STACK
	ZERO? STACK /FALSE
	ZERO? TEST-TANK-FULL /FALSE
	CALL DO-INSTEAD-OF,TEST-TANK,GLOBAL-WATER
	RTRUE
?L3:	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \?L7
	CALL GLOBAL-IN?,WINDOW,HERE >STACK
	ZERO? STACK /?L8
	CALL PERFORM,V?LOOK-OUTSIDE,WINDOW
	RTRUE
?L8:	EQUAL? HERE,SUB \FALSE
	CALL PERFORM,V?LOOK-OUTSIDE,SUB-WINDOW
	RTRUE
?L7:	EQUAL? PRSA,V?THROUGH,V?SWIM \FALSE
	PRINTI "This is no time for a swim, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"

	.FUNCT SEA-F
	EQUAL? PRSA,V?ANALYZE,V?EXAMINE \?L1
	ZERO? SUB-IN-DOME \?L5
	ZERO? SUB-IN-OPEN-SEA \?L5
	EQUAL? NOW-TERRAIN,SEA-TERRAIN \FALSE
?L5:	CALL PLENTY-WATER >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?FIND \FALSE
	ZERO? SUB-IN-DOME \?L10
	ZERO? SUB-IN-OPEN-SEA \?L10
	EQUAL? NOW-TERRAIN,SEA-TERRAIN \?L8
?L10:	PRINTR "You're in it!"
?L8:	EQUAL? HERE,SUB,CRAWL-SPACE \?L13
	PRINTR "The nautical chart in your SEASTALKER package should help."
?L13:	PRINTI "First you must get in the "
	PRINTD SUB
	PRINTR "."

	.FUNCT YOU-F
	EQUAL? WINNER,PLAYER /?L1
	CALL DO-INSTEAD-OF,WINNER,YOU
	RTRUE
?L1:	EQUAL? PRSA,V?ASK-ABOUT \FALSE
	EQUAL? PRSI,YOU \FALSE
	CALL PERFORM,V?ASK-ABOUT,PRSO,PRSO
	RTRUE

	.FUNCT HINT-F
	EQUAL? PRSA,V?FIND \?L1
	PRINT HELP-TEXT
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE,V?ASK-CONTEXT-FOR,V?ASK-FOR \FALSE
	EQUAL? TIP,PRSO,PRSI,WINNER \?L6
	PRINT HELP-TEXT
	CRLF
	RTRUE
?L6:	CALL MORE-SPECIFIC >STACK
	RSTACK

	.FUNCT DIRNS-F
	EQUAL? PRSA,V?ASK-FOR \FALSE
	EQUAL? PRSO,GLOBAL-BLY \FALSE
	SET 'WINNER,GLOBAL-BLY
	CALL PERFORM,V?FIND,AQUADOME
	RTRUE

	.FUNCT GLOBAL-HERE-F,FLG=0,F,HR,TIM,VAL
	EQUAL? PRSA,V?KNOCK \?L1
	PRINTR "Knocking on the walls reveals nothing unusual."
?L1:	EQUAL? PRSA,V?TIE-TO,V?PUT \?L5
	CALL MORE-SPECIFIC >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?EXAMINE,V?SEARCH \?L6
	GETP HERE,P?CORRIDOR >STACK
	ZERO? STACK /?L7
	SET 'TIM,3
	JUMP ?L9
?L7:	GETP HERE,P?SIZE >STACK
	ADD 2,STACK >TIM
?L9:	EQUAL? P-ADVERB,W?CAREFULLY \?L10
	MUL 2,TIM >TIM
?L10:	PRINTI "(It's better to examine or search one thing at a time. It would take a long time to search a whole room or area thoroughly. A "
	EQUAL? P-ADVERB,W?CAREFULLY \?L15
	PRINTI "careful"
	JUMP ?L19
?L15:	PRINTI "brief"
?L19:	PRINTI " search would take "
	PRINTN TIM
	PRINTI " turns, and it might not reveal much. Would you like to do it anyway?)"
	CALL YES? >STACK
	ZERO? STACK /?L24
	CALL INT-WAIT,TIM >VAL
	EQUAL? M-FATAL,VAL /TRUE
	ZERO? VAL /?L28
	PRINTI "Your "
	EQUAL? P-ADVERB,W?CAREFULLY \?L31
	PUSH STR?19
	JUMP ?L33
?L31:	PUSH STR?20
?L33:	PRINT STACK
	PRINTR " search reveals nothing exciting."
?L28:	PRINTR "You didn't finish looking over the place."
?L24:	PRINTR "Okay."
?L6:	EQUAL? PRSA,V?ANALYZE,V?WHAT \FALSE
	FIRST? HERE >F \?L43
?L44:	FSET? F,CONTBIT \?L46
	CALL INHABITED?,F >STACK
	ZERO? STACK /?L46
	SET 'FLG,1
	SET 'HR,HERE
	SET 'HERE,F
	CALL GLOBAL-HERE-F
	SET 'HERE,HR
	JUMP ?L47
?L46:	FSET? F,PERSON \?L47
	EQUAL? F,PLAYER /?L47
	SET 'FLG,1
	CALL DESCRIBE-OBJECT,F,1,0
?L47:	NEXT? F >F /?L44
?L43:	ZERO? FLG \TRUE
	PRINTR "There's nobody else here."

	.FUNCT AIR-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "You can see through the air around you."
?L1:	EQUAL? PRSA,V?WALK-TO \?L5
	PRINTR "It's all around you!"
?L5:	EQUAL? PRSA,V?SMELL \FALSE
	CALL FRESH-AIR?,HERE >STACK
	ZERO? STACK \TRUE
	PRINTR "The air is rather musty."

	.FUNCT GENERIC-TANK-F,OBJ
	ZERO? SUB-IN-TANK /?L1
	RETURN TEST-TANK
?L1:	ZERO? SUB-IN-DOME \?L4
	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK /FALSE
?L4:	RETURN DOCKING-TANK

	.FUNCT TOO-FAR-AWAY,OBJ
	CALL TOO-BAD-BUT,OBJ,STR?21 >STACK
	RSTACK

	.FUNCT TEST-TANK-F
	EQUAL? PRSA,V?WALK-TO \?L1
	CALL IN-TANK-AREA?,HERE >STACK
	ZERO? STACK /?L3
	CALL ALREADY,PLAYER,STR?17 >STACK
	RSTACK
?L3:	ZERO? SUB-IN-TANK /FALSE
	CALL PERFORM,PRSA,NORTH-TANK-AREA
	RTRUE
?L1:	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L8
	CALL TOO-FAR-AWAY,TEST-TANK >STACK
	RSTACK
?L8:	ZERO? SUB-IN-TANK \?L9
	PRINTI "You're nowhere near"
	CALL RESEARCH-LAB
	PRINTR "!"
?L9:	EQUAL? HERE,SUB \?L15
	ZERO? SUB-IN-TANK \?L14
?L15:	EQUAL? HERE,NORTH-TANK-AREA,WEST-TANK-AREA,SOUTH-TANK-AREA /?L14
	CALL NOT-HERE,TEST-TANK >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?BOARD \?L16
	PRINTR "That won't do any good."
?L16:	EQUAL? PRSA,V?LEAVE \?L19
	PRINTI "You can either walk north, or get in the "
	PRINTD SUB
	PRINTR " and go east."
?L19:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE,V?ANALYZE \?L22
	CALL FILL-TANK-BUTTON-F >STACK
	RSTACK
?L22:	EQUAL? PRSA,V?FILL,V?EMPTY \?L23
	EQUAL? HERE,WEST-TANK-AREA,SUB /?L23
	PRINTR "You'll have to go west to do that."
?L23:	EQUAL? PRSA,V?EMPTY \?L26
	FSET? TANK-GATE,OPENBIT \?L27
	CALL YOU-CANT,STR?23,TANK-GATE,STR?22 >STACK
	RSTACK
?L27:	FSET? ENGINE,ONBIT \?L29
	CALL YOU-CANT,STR?23,ENGINE,STR?18 >STACK
	RSTACK
?L29:	ZERO? TEST-TANK-FULL /?L30
	SET 'TEST-TANK-FULL,0
	PRINTI "The "
	PRINTD GLOBAL-WATER
	PRINTR " quickly drains from the tank."
?L30:	CALL ALREADY,TEST-TANK,STR?23 >STACK
	RSTACK
?L26:	EQUAL? PRSA,V?FILL \?L34
	ZERO? TEST-TANK-FULL /?L35
	CALL ALREADY,TEST-TANK,STR?24 >STACK
	RSTACK
?L35:	SET 'TEST-TANK-FULL,1
	PRINTI "The "
	PRINTD GLOBAL-WATER
	PRINTR " quickly fills the tank, up to the level of the walkway."
?L34:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L40
	CALL PERFORM,PRSA,TANK-GATE
	RTRUE
?L40:	EQUAL? PRSA,V?THROUGH,V?SWIM \FALSE
	PRINTI "This is no time for a swim, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"

	.FUNCT FILL-TANK-BUTTON-F,OBJ,FLAG
	ZERO? SUB-IN-TANK /?L1
	SET 'FLAG,TEST-TANK-FULL
	SET 'OBJ,TEST-TANK
	JUMP ?L5
?L1:	ZERO? SUB-IN-DOME \?L4
	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK /FALSE
?L4:	SET 'FLAG,AIRLOCK-FULL
	SET 'OBJ,AIRLOCK
?L5:	EQUAL? PRSA,V?EMPTY /?L8
	EQUAL? PRSA,V?FILL,V?CLOSE,V?OPEN \?L6
?L8:	CALL PERFORM,PRSA,OBJ
	RTRUE
?L6:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE,V?ANALYZE \?L9
	PRINTI "The "
	PRINTD OBJ
	PRINTI " is "
	CALL TANK-STATUS >STACK
	PRINT STACK
	PRINTR "."
?L9:	EQUAL? PRSA,V?USE,V?PUSH,V?MOVE \FALSE
	ZERO? FLAG /?L13
	PRINT I-ASSUME
	PRINTI " empty"
	CALL PRINTT,OBJ
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?EMPTY,OBJ
	RTRUE
?L13:	PRINT I-ASSUME
	PRINTI " fill"
	CALL PRINTT,OBJ
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?FILL,OBJ
	RTRUE

	.FUNCT TANK-GATE-F
	EQUAL? PRSA,V?FIND \?L1
	PRINTR "It's on the east wall of the test tank."
?L1:	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	EQUAL? HERE,SUB /?L6
	CALL IN-TANK-AREA?,HERE >STACK
	ZERO? STACK \?L6
	CALL NOT-HERE,TANK-GATE >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \?L7
	PRINTI "This gate "
	FSET? TANK-GATE,OPENBIT \?L10
	PUSH STR?25
	JUMP ?L12
?L10:	PUSH STR?26
?L12:	PRINT STACK
	PRINTI " raised to permit submarines to go in or out of the tank. The gate can be raised or lowered by wall controls or by remote control from all "
	CALL PRINT-NAME,LAST-NAME
	PRINTR " subs."
?L7:	EQUAL? PRSA,V?DROP /?L14
	EQUAL? PRSA,V?RAISE,V?CLOSE,V?OPEN \FALSE
?L14:	EQUAL? HERE,WEST-TANK-AREA,SUB /?L15
	PRINTR "You'll have to go west to do that."
?L15:	CALL OPEN-CLOSE-GATE,TANK-GATE,TEST-TANK-FULL,TEST-TANK >STACK
	RSTACK

	.FUNCT OPEN-GATE-BUTTON-F,OBJ
	ZERO? SUB-IN-TANK /?L1
	SET 'OBJ,TANK-GATE
	JUMP ?L5
?L1:	ZERO? SUB-IN-DOME \?L4
	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK /FALSE
?L4:	SET 'OBJ,AIRLOCK-HATCH
?L5:	EQUAL? PRSA,V?DROP /?L8
	EQUAL? PRSA,V?RAISE,V?CLOSE,V?OPEN \?L6
?L8:	CALL PERFORM,PRSA,OBJ
	RTRUE
?L6:	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \?L9
	PRINTI "The "
	PRINTD OBJ
	PRINTI " is "
	CALL GATE-STATUS >STACK
	PRINT STACK
	PRINTR "."
?L9:	EQUAL? PRSA,V?USE,V?PUSH,V?MOVE \FALSE
	FSET? OBJ,OPENBIT \?L13
	PRINT I-ASSUME
	PRINTI " close"
	CALL PRINTT,OBJ
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?CLOSE,OBJ
	RTRUE
?L13:	PRINT I-ASSUME
	PRINTI " open"
	CALL PRINTT,OBJ
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?OPEN,OBJ
	RTRUE

	.FUNCT GATE-STATUS
	ZERO? SUB-IN-TANK /?L1
	FSET? TANK-GATE,OPENBIT \?L3
	RETURN STR?22
?L3:	RETURN STR?27
?L1:	ZERO? SUB-IN-DOME \?L7
	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK /?L6
?L7:	FSET? AIRLOCK-HATCH,OPENBIT \?L8
	RETURN STR?22
?L8:	RETURN STR?27
?L6:	RETURN STR?28

	.FUNCT TANK-STATUS
	ZERO? SUB-IN-TANK /?L1
	ZERO? TEST-TANK-FULL /?L3
	RETURN STR?24
?L3:	RETURN STR?23
?L1:	ZERO? SUB-IN-DOME \?L7
	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK /?L6
?L7:	ZERO? AIRLOCK-FULL /?L8
	RETURN STR?24
?L8:	RETURN STR?23
?L6:	RETURN STR?28

	.FUNCT AIRLOCK-HATCH-F
	EQUAL? PRSA,V?FIND \?L1
	PRINTI "It's on the south wall of the "
	PRINTD AQUADOME
	PRINTI " "
	PRINTD AIRLOCK
	PRINTR "."
?L1:	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	ZERO? SUB-IN-DOME /?L7
	EQUAL? HERE,SUB,AIRLOCK,BLY-OFFICE /?L6
?L7:	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK \?L6
	CALL TOO-FAR-AWAY,AIRLOCK-HATCH >STACK
	RSTACK
?L6:	ZERO? SNARK-ATTACK-COUNT /?L8
	PRINTR "It's too late now! The machinery is jammed!"
?L8:	EQUAL? PRSA,V?DROP /?L12
	EQUAL? PRSA,V?RAISE,V?CLOSE,V?OPEN \FALSE
?L12:	CALL OPEN-CLOSE-GATE,AIRLOCK-HATCH,AIRLOCK-FULL,AIRLOCK >STACK
	RSTACK

	.FUNCT OPEN-CLOSE-GATE,GATE,FULL,TANK
	EQUAL? PRSA,V?RAISE,V?OPEN \?L1
	FSET? GATE,OPENBIT \?L3
	CALL ALREADY,GATE,STR?22
	RTRUE
?L3:	ZERO? FULL \?L5
	PRINTI "You'd better fill the "
	PRINTD TANK
	PRINTR " first, unless you want to go surfing!"
?L5:	EQUAL? GATE,TANK-GATE \?L9
	EQUAL? HERE,SUB \?L9
	SET 'OPENED-GATE-FROM-SUB,1
?L9:	FSET GATE,OPENBIT
	JUMP ?L15
?L1:	FSET? GATE,OPENBIT \?L13
	FCLEAR GATE,OPENBIT
	JUMP ?L15
?L13:	CALL ALREADY,GATE,STR?27
	RTRUE
?L15:	FSET? GATE,OPENBIT \?L16
	PRINTI "Opened"
	JUMP ?L20
?L16:	PRINTI "Closed"
?L20:	EQUAL? HERE,SUB \?L23
	PRINTI " (by remote control)"
?L23:	PRINTR "."

	.FUNCT AIRLOCK-POP?
	ZERO? GREENUP-ESCAPE /?L1
	CALL FIND-FLAG,AIRLOCK,PERSON,GREENUP >STACK
	RSTACK
?L1:	CALL FIND-FLAG,AIRLOCK,PERSON >STACK
	RSTACK

	.FUNCT GENERIC-GATE-F,OBJ
	ZERO? SUB-IN-TANK /?L1
	RETURN TANK-GATE
?L1:	ZERO? SUB-IN-DOME \?L4
	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK /FALSE
?L4:	RETURN AIRLOCK-HATCH

	.FUNCT SUB-OUTSIDE-AIRLOCK?
	EQUAL? SUB-DEPTH,AIRLOCK-DEPTH \FALSE
	ZERO? SUB-LON \FALSE
	ZERO? FINE-SONAR /?L4
	EQUAL? -2,SUB-LAT /TRUE
	RFALSE
?L4:	EQUAL? -1,SUB-LAT /TRUE
	RFALSE

	.FUNCT AIRLOCK-ROOF-F
	EQUAL? PRSA,V?FIND \?L1
	PRINTI "It covers the "
	PRINTD AQUADOME
	PRINTI " "
	PRINTD AIRLOCK
	PRINTR "."
?L1:	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	ZERO? SUB-IN-DOME /?L7
	EQUAL? HERE,SUB,AIRLOCK,BLY-OFFICE /?L6
	EQUAL? HERE,AIRLOCK-WALL /?L6
?L7:	CALL TOO-FAR-AWAY,AIRLOCK-ROOF >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?OPEN \?L8
	FSET? AIRLOCK-ROOF,OPENBIT \?L9
	CALL ALREADY,AIRLOCK-ROOF,STR?22
	RTRUE
?L9:	FSET? AIRLOCK-HATCH,OPENBIT \?L11
	CALL THIS-IS-IT,AIRLOCK-HATCH
	PRINTI "A safety mechanism prevents it. The "
	PRINTD AIRLOCK-HATCH
	PRINTR " is open!"
?L11:	FSET AIRLOCK-ROOF,OPENBIT
	PRINTI "Opened"
	EQUAL? HERE,SUB \?L17
	PRINTI " (by remote control)"
?L17:	PRINTR "."
?L8:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? AIRLOCK-ROOF,OPENBIT /?L25
	CALL ALREADY,AIRLOCK-ROOF,STR?27
	RTRUE
?L25:	FCLEAR AIRLOCK-ROOF,OPENBIT
	PRINTI "Closed"
	EQUAL? HERE,SUB \?L30
	PRINTI " (by remote control)"
?L30:	PRINTI "."
	CRLF
	ZERO? GREENUP-ESCAPE /TRUE
	GRTR? 3,GREENUP-ESCAPE \TRUE
	PRINTI "Greenup can't get into the "
	PRINTD SUB
	PRINTI " and escape any more. "
	CALL GREENUP-CUFF
	RTRUE

	.FUNCT EVIDENCE-F
	ZERO? ZOE-MENTIONED-EVIDENCE /FALSE
	EQUAL? PRSA,V?TAKE \FALSE
	CALL PERFORM,PRSA,BLACK-BOX
	RTRUE

	.FUNCT LAB-ASSISTANT-F
	EQUAL? PRSA,V?WALK-TO,V?FIND \FALSE
	CALL DO-INSTEAD-OF,LOWELL,LAB-ASSISTANT >STACK
	RSTACK

	.FUNCT DOC-LABORATORY-F
	EQUAL? PRSA,V?THROUGH,V?WALK-TO \FALSE
	CALL PERFORM,V?WALK-TO,DOME-LAB
	RTRUE

	.FUNCT YOUR-LABORATORY-F
	CALL IN-LAB?,HERE >STACK
	ZERO? STACK /?L1
	CALL DO-INSTEAD-OF,HERE,YOUR-LABORATORY
	RTRUE
?L1:	EQUAL? PRSA,V?THROUGH,V?WALK-TO \FALSE
	CALL PERFORM,V?WALK-TO,CENTER-OF-LAB
	RTRUE

	.FUNCT GENERIC-LABORATORY-F,OBJ
	ZERO? SUB-IN-TANK /?L1
	RETURN YOUR-LABORATORY
?L1:	ZERO? SUB-IN-DOME /FALSE
	RETURN DOME-LAB

	.FUNCT TRAITOR-F,X
	EQUAL? PRSA,V?ASK-ABOUT \?L4
	FSET? PRSO,PERSON /?L3
?L4:	EQUAL? PRSA,V?WHAT,V?FIND \FALSE
?L3:	SET 'X,QCONTEXT
	ZERO? X \?L22
	EQUAL? PRSA,V?ASK-ABOUT /?L7
	SET 'X,0
	JUMP ?L8
?L7:	SET 'X,1
?L8:	ZERO? X /?L9
?L22:	PRINTI """"
?L9:	PRINTI "I guess you'll have to figure that out, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "."
	ZERO? X /?L16
	PRINTI """"
?L16:	CRLF
	RTRUE

	.FUNCT CHAIR-F
	EQUAL? PRSA,V?CLIMB-DOWN /?L3
	EQUAL? PRSA,V?CLIMB-ON,V?LOOK-UNDER,V?SIT \FALSE
?L3:	PRINTR "That's just a waste of time."

	.FUNCT UNDERWATER-F
	EQUAL? PRSA,V?WALK \FALSE
	PRINTI "You must be in the "
	PRINTD SUB
	PRINTR " to do that."

	.FUNCT GAME-F
	EQUAL? PRSA,V?READ,V?PLAY,V?EXAMINE \FALSE
	SET 'P-WON,0
	PRINTR "(You're doing it!)"

	.FUNCT SOMETHING-F
	SET 'P-WON,0
	PRINTI "(Type a real word instead of "
	PRINTD SOMETHING
	PRINTR ".)"

	.FUNCT LEFT-RIGHT-F
	EQUAL? PRSA,V?LOOK-OUTSIDE,V?LOOK-INSIDE,V?EXAMINE \?L1
	EQUAL? HERE,SUB \?L3
	CALL PERFORM,PRSA,SUB-WINDOW
	RTRUE
?L3:	CALL PERFORM,PRSA,WINDOW
	RTRUE
?L1:	EQUAL? PRSA,V?WALK,V?TURN \FALSE
	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT CAPITAL-NOUN?,WRD
	EQUAL? WRD,W?DOC,W?TIP,W?RANDALL /TRUE
	EQUAL? WRD,W?DOC$0027S,W?TIP$0027S,W?BILL$0027S /TRUE
	EQUAL? WRD,W?KEMP$0027S,W?ZOE$0027S,W?MARV$0027S /TRUE
	EQUAL? WRD,W?SHARON,W?KEMP,W?ZOE /TRUE
	EQUAL? WRD,W?BLY$0027S,W?AMY$0027S,W?FROBTON /TRUE
	EQUAL? WRD,W?BLY,W?AMY,W?LOWELL /TRUE
	EQUAL? WRD,W?MICK$0027S,W?WALT$0027S,W?MICK /TRUE
	EQUAL? WRD,W?ANTRIM,W?WALT,W?DOCTOR /TRUE
	EQUAL? WRD,W?DR,W?MARV,W?SIEGEL /TRUE
	EQUAL? WRD,W?BILL,W?GREENUP,W?HORVAK /TRUE
	EQUAL? WRD,W?JEROME,W?THORPE /TRUE
	RFALSE

	.FUNCT BUZZER-WORD?,WORD
	CALL QUESTION-WORD?,WORD >STACK
	ZERO? STACK \TRUE
	CALL NUMBER-WORD?,WORD >STACK
	ZERO? STACK \TRUE
	CALL NAUGHTY-WORD?,WORD >STACK
	ZERO? STACK \TRUE
	EQUAL? WORD,W?ALL,W?AGAIN,W?G \FALSE
	PRINTI "(Sorry, but in this story you can't use the word """
	PRINTB WORD
	PRINTR """.)"

	.FUNCT QUESTION-WORD?,WORD
	EQUAL? WORD,W?WHERE \?L1
	PRINTI "(To locate something, use the command: FIND "
	PRINTD SOMETHING
	PRINTR ".)"
?L1:	EQUAL? WORD,W?WHAT,W?WHAT$0027S /?L6
	EQUAL? WORD,W?WHO,W?WHO$0027S \?L5
?L6:	PRINTI "(To ask about something, use the command: TELL ME ABOUT "
	PRINTD SOMETHING
	PRINTR ".)"
?L5:	EQUAL? WORD,W?THAT$0027S,W?IT$0027S,W?WHY /?L10
	EQUAL? WORD,W?HOW,W?WHEN,W?IS /?L10
	EQUAL? WORD,W?DID,W?ARE,W?DO /?L10
	EQUAL? WORD,W?HAVE,W?ANY,W?AM /?L10
	EQUAL? WORD,W?I$0027M,W?WE$0027RE,W?WILL /?L10
	EQUAL? WORD,W?WAS,W?WERE,W?I$0027LL /?L10
	EQUAL? WORD,W?CAN,W?WHICH,W?I$0027VE /?L10
	EQUAL? WORD,W?WON$0027T,W?HAS,W?YOU$0027RE /?L10
	EQUAL? WORD,W?HE$0027S,W?SHE$0027S,W?SHOULD /?L10
	EQUAL? WORD,W?WOULD,W?WHEN$0027S /?L10
	EQUAL? WORD,W?THEY$0027RE,W?COULD,W?SHALL \FALSE
?L10:	PRINTI "(Please use commands"
	IGRTR? 'QUESTION-WORD-COUNT,9 \?L13
	SET 'QUESTION-WORD-COUNT,0
	PRINTR "! Your commands tell the computer what you want to do in the story. You can give commands to other people in the story, too. Here are examples of commands:
   TURN ON THE LAMP
   LOOK UNDER THE RUG
   SHARON, GIVE THE BOOK TO TIP
   BILL, HELP ME
Now you can try again.)"
?L13:	PRINTR ", not statements or questions.)"

	.FUNCT NUMBER-WORD?,WRD
	EQUAL? WRD,W?ZERO,W?TWO,W?THREE /?L3
	EQUAL? WRD,W?FOUR,W?FIVE,W?SIX /?L3
	EQUAL? WRD,W?SEVEN,W?EIGHT,W?NINE /?L3
	EQUAL? WRD,W?TEN,W?ELEVEN,W?TWELVE /?L3
	EQUAL? WRD,W?THIRTE,W?FOURTE,W?FIFTEE /?L3
	EQUAL? WRD,W?SIXTEE,W?SEVENT,W?EIGHTE /?L3
	EQUAL? WRD,W?NINETE,W?TWENTY,W?THIRTY /?L3
	EQUAL? WRD,W?FORTY,W?FIFTY,W?SIXTY /?L3
	EQUAL? WRD,W?EIGHTY,W?NINETY,W?HUNDRE /?L3
	EQUAL? WRD,W?THOUSA /?L3
	EQUAL? WRD,W?MILLIO,W?BILLIO,W?ONE \FALSE
?L3:	PRINTR "(Use numerals for numbers, for example ""10."")"

	.FUNCT NAUGHTY-WORD?,WORD
	EQUAL? WORD,W?CURSE,W?CURSES,W?CUSS /?L3
	EQUAL? WORD,W?DAMN,W?SHIT,W?FUCK /?L3
	EQUAL? WORD,W?FUDGE,W?PISS,W?PEE /?L3
	EQUAL? WORD,W?SUCK /?L3
	EQUAL? WORD,W?POO,W?SNOT,W?BASTARD \FALSE
?L3:	PRINTC 40
	CALL PICK-ONE,OFFENDED >STACK
	PRINT STACK
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?29,STACK
	CALL IS-PERSON? >STACK
	ZERO? STACK \?L6
	PUSH 1
	JUMP ?L7
?L6:	PUSH 0
?L7:	CALL PRINT-ID,STR?30,STACK
	PRINTC 41
	CRLF
	RTRUE

	.FUNCT TRANSCRIPT,STR
	PRINTI "Here "
	PRINT STR
	PRINTR "s a transcript of interaction with"

	.FUNCT V-SCRIPT
	ZERO? SCREEN-NOW-SPLIT /?L1
	SPLIT 0
?L1:	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	CALL TRANSCRIPT,STR?31
	CALL V-VERSION
	CALL START-SONAR?
	RTRUE

	.FUNCT V-UNSCRIPT
	CALL TRANSCRIPT,STR?32
	CALL V-VERSION
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT V-$0024VERIFY
	PRINTI "Verifying disk..."
	CRLF
	VERIFY \?L3
	PRINTR "The disk is correct."
?L3:	PRINTR "Oh, oh! The disk seems to have a defect. Try verifying again. (If you've already done that, the disk surely has a defect.)"

	.FUNCT V-DEBUG
	ZERO? DEBUG \?L3
	SET 'DEBUG,1
	JUMP ?L4
?L3:	SET 'DEBUG,0
?L4:	ZERO? DEBUG /?L1
	PRINTR "Find them bugs, boss!"
?L1:	PRINTR "No bugs left, eh?"

	.FUNCT YOU-WILL-GET,STR
	PRINTI "(Okay, you will get "
	PRINT STR
	PRINTR " descriptions.)"

	.FUNCT V-BRIEF
	SET 'VERBOSE,0
	SET 'SUPER-BRIEF,0
	SET 'P-SPACE,1
	CALL YOU-WILL-GET,STR?20 >STACK
	RSTACK

	.FUNCT V-SUPER-BRIEF
	SET 'SUPER-BRIEF,1
	SET 'P-SPACE,0
	CALL YOU-WILL-GET,STR?33 >STACK
	RSTACK

	.FUNCT V-VERBOSE
	SET 'VERBOSE,1
	SET 'SUPER-BRIEF,0
	SET 'P-SPACE,1
	CALL YOU-WILL-GET,STR?34
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT V-INVENTORY
	ZERO? P-WHAT-IGNORED /?L1
	EQUAL? WINNER,PLAYER /?L3
	PRINTI """"
?L3:	PRINTI "You're the inventor!"
	EQUAL? WINNER,PLAYER /?L10
	PRINTI """"
?L10:	CRLF
	RTRUE
?L1:	CALL PRINT-CONT,WINNER >STACK
	ZERO? STACK \FALSE
	EQUAL? WINNER,PLAYER \?L16
	PRINTI "You're"
	JUMP ?L20
?L16:	CALL HE-SHE-IT,WINNER,1
	PRINTI "'s"
?L20:	PRINTR " not holding anything."

	.FUNCT V-QUIT,ASK?=1
	CALL V-SCORE
	ZERO? ASK? /?L3
	PRINTI "(If you want to continue from this point at another time, you must ""SAVE"" first.)
Do you want to stop playing now?"
	CALL YES? >STACK
	ZERO? STACK \?L3
	ZERO? ASK? \?L1
?L3:	QUIT
?L1:	PRINTR "Okay."

	.FUNCT V-RESTART
	CALL V-SCORE
	PRINTI "Do you want to start over from the beginning?"
	CALL YES? >STACK
	ZERO? STACK /FALSE
	RESTART

	.FUNCT V-SAVE
	ZERO? SCREEN-NOW-SPLIT /?L1
	SPLIT 0
?L1:	SAVE \?L4
	PRINTI "Okay."
	CRLF
	CALL V-FIRST-LOOK
	JUMP ?L8
?L4:	PRINT FAILED
	CRLF
?L8:	CALL START-SONAR?
	RTRUE

	.FUNCT V-RESTORE
	ZERO? SCREEN-NOW-SPLIT /?L1
	SPLIT 0
?L1:	RESTORE /FALSE
	PRINT FAILED
	CRLF
	CALL START-SONAR?
	RFALSE

	.FUNCT V-FIRST-LOOK
	CALL DESCRIBE-ROOM >STACK
	ZERO? STACK /FALSE
	ZERO? SUPER-BRIEF \FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT V-VERSION,CNT=17,V
	GET 0,1 >STACK
	BAND STACK,2047 >V
	PRINTI "SEASTALKER: "
	CALL PRINT-NAME,FIRST-NAME,1
	PRINTC 32
	CALL PRINT-NAME,LAST-NAME,1
	PRINTI " AND THE ULTRAMARINE BIOCEPTOR
Infocom interactive fiction - an adventure story
Copyright (c) 1984, 1985 by Infocom, Inc. All rights reserved.
"
	PRINTI "SEASTALKER is a registered trademark of Infocom, Inc.
Release number "
	PRINTN V
	PRINTI " / Serial number "
?L7:	IGRTR? 'CNT,23 /?L8
	GETB 0,CNT >STACK
	PRINTC STACK
	JUMP ?L7
?L8:	CRLF
	RTRUE

	.FUNCT YES?,WORD,VAL
?L1:	PRINTI " >"
	READ YES-INBUF,YES-LEXV
	GET YES-LEXV,P-LEXSTART >WORD
	GETB YES-LEXV,P-LEXWORDS >STACK
	ZERO? STACK /?L8
	ZERO? WORD /?L8
	CALL WT?,WORD,PS?VERB,P1?VERB >VAL
	EQUAL? VAL,ACT?YES \?L6
	SET 'VAL,1
	RETURN VAL
?L6:	EQUAL? VAL,ACT?NO /?L9
	EQUAL? WORD,W?N \?L8
?L9:	SET 'VAL,0
	RETURN VAL
?L8:	PRINTI "(Please type YES or NO.)"
	JUMP ?L1

	.FUNCT YOU-CANT,STR=0,WHILE=0,STR1=0
	EQUAL? WINNER,PLAYER \?L1
	PRINTI "You"
	JUMP ?L5
?L1:	CALL HE-SHE-IT,WINNER,1
?L5:	PRINTI " can't "
	ZERO? STR /?L8
	PRINT STR
	JUMP ?L12
?L8:	CALL VERB-PRINT
?L12:	EQUAL? STR,STR?35 \?L13
	PRINTR " in that direction."
?L13:	ZERO? STR1 /?L17
	PRINTI " it while"
	ZERO? WHILE /?L20
	CALL THIS-IS-IT,WHILE
	CALL PRINTT,WHILE
	JUMP ?L24
?L20:	PRINTI " it"
?L24:	PRINTI " is "
	PRINT STR1
	PRINTR "."
?L17:	CALL THE-PRSO-PRINT
	PRINTR " now."

	.FUNCT DESCRIBE-OBJECT,OBJ,V?,LEVEL,STR=0,AV,NO-CR=0
	CALL THIS-IS-IT,OBJ
	ZERO? LEVEL \?L10
	GETP OBJ,P?DESCFCN >STACK
	CALL STACK,M-OBJDESC >STACK
	ZERO? STACK \TRUE
	ZERO? LEVEL \?L10
	FSET? OBJ,TOUCHBIT /?L7
	GETP OBJ,P?FDESC >STR
	ZERO? STR \?L6
?L7:	GETP OBJ,P?LDESC >STR
	ZERO? STR /?L4
?L6:	PRINT STR
	JUMP ?L44
?L4:	ZERO? LEVEL \?L10
	FSET? OBJ,PERSON \?L11
	CALL IS-CREW?,OBJ >STACK
	ZERO? STACK /?L13
	CALL CREW-5-TOGETHER? >STACK
	ZERO? STACK /?L13
	FSET? BLY,MUNGBIT /?L13
	EQUAL? OBJ,LOWELL \?L15
	PRINTI "The five "
	PRINTD CREW
	PRINTI " members are here."
	JUMP ?L44
?L15:	SET 'NO-CR,1
	JUMP ?L44
?L13:	PRINTD OBJ
	PRINTI " is here."
	JUMP ?L44
?L11:	PRINTI "There's "
	CALL PRINTA,OBJ
	PRINTI " here."
	JUMP ?L44
?L10:	GET INDENTS,LEVEL >STACK
	PRINT STACK
	FSET? OBJ,PERSON \?L29
	CALL IS-CREW?,OBJ >STACK
	ZERO? STACK /?L31
	CALL CREW-5-TOGETHER? >STACK
	ZERO? STACK /?L31
	FSET? BLY,MUNGBIT /?L31
	EQUAL? OBJ,LOWELL \?L33
	PRINTI "the five "
	PRINTD CREW
	PRINTI " members"
	JUMP ?L41
?L33:	SET 'NO-CR,1
	JUMP ?L41
?L31:	PRINTD OBJ
	JUMP ?L41
?L29:	CALL PRINTA,OBJ
?L41:	EQUAL? OBJ,OXYGEN-GEAR \?L44
	IN? OXYGEN-GEAR,PLAYER \?L44
	PRINTI " (being worn)"
?L44:	ZERO? LEVEL \?L49
	LOC WINNER >AV
	ZERO? AV /?L49
	FSET? AV,VEHBIT \?L49
	PRINTI " (outside"
	CALL PRINTT,AV
	PRINTI ")"
?L49:	ZERO? NO-CR \?L54
	CRLF
?L54:	CALL SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /FALSE
	FIRST? OBJ >STACK \FALSE
	CALL PRINT-CONT,OBJ,V?,LEVEL >STACK
	RSTACK

	.FUNCT DESCRIBE-OBJECTS,V?=0
	FIRST? HERE >STACK \FALSE
	ZERO? V? \?L5
	SET 'V?,VERBOSE
?L5:	CALL PRINT-CONT,HERE,V?,-1 >STACK
	RSTACK

	.FUNCT DESCRIBE-ROOM,LOOK?=0,V?,STR,L
	SET 'V?,LOOK?
	ZERO? V? \?L1
	SET 'V?,VERBOSE
?L1:	FSET? HERE,TOUCHBIT /?L3
	SET 'V?,1
?L3:	IN? HERE,ROOMS \?L6
	PRINTI "("
	PRINTD HERE
	PRINTI ")"
	CRLF
?L6:	ZERO? LOOK? \?L13
	ZERO? SUPER-BRIEF \?L37
?L13:	LOC WINNER >L
	FSET? L,VEHBIT \?L14
	PRINTI "(You're "
	FSET? L,SURFACEBIT \?L18
	PRINTI "sitting o"
	JUMP ?L22
?L18:	PRINTI "standing i"
?L22:	PRINTI "n"
	CALL PRINTT,L
	PRINTI ".)"
	CRLF
?L14:	ZERO? V? /?L33
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK /?L28
	FSET HERE,TOUCHBIT
	RTRUE
?L28:	ZERO? V? /?L33
	GETP HERE,P?FDESC >STR
	ZERO? STR /?L30
	PRINT STR
	CRLF
	JUMP ?L36
?L30:	ZERO? V? /?L33
	GETP HERE,P?LDESC >STR
	ZERO? STR /?L33
	PRINT STR
	CRLF
	JUMP ?L36
?L33:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-FLASH >STACK
?L36:	EQUAL? HERE,L /?L37
	GETP L,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
?L37:	GETP HERE,P?CORRIDOR >STACK
	ZERO? STACK /?L41
	CALL CORRIDOR-LOOK
?L41:	FSET HERE,TOUCHBIT
	RTRUE

	.FUNCT FAR-AWAY?,L
	EQUAL? L,GLOBAL-OBJECTS /TRUE
	CALL IN-LAB-AREA?,HERE >STACK
	ZERO? STACK /?L3
	CALL IN-LAB-AREA?,L >STACK
	ZERO? STACK \FALSE
	RTRUE
?L3:	CALL IN-DOME?,HERE >STACK
	ZERO? STACK /?L6
	CALL IN-DOME?,L >STACK
	ZERO? STACK \FALSE
	RTRUE
?L6:	EQUAL? HERE,SUB,CRAWL-SPACE \?L9
	EQUAL? L,SUB,CRAWL-SPACE /FALSE
	RTRUE
?L9:	PRINTR "[Foo! Where is HERE?]"

	.FUNCT FIRSTER,OBJ,LEVEL
	EQUAL? OBJ,PLAYER \?L1
	PRINTR "You're holding:"
?L1:	FSET? OBJ,PERSON \?L5
	PRINTD OBJ
	PRINTR " is holding:"
?L5:	IN? OBJ,ROOMS /FALSE
	GRTR? LEVEL,0 \?L9
	GET INDENTS,LEVEL >STACK
	PRINT STACK
?L9:	FSET? OBJ,SURFACEBIT \?L14
	PRINTI "Sitting on"
	CALL PRINTT,OBJ
	PRINTR " is:"
?L14:	FSET? OBJ,NARTICLEBIT /?L19
	PRINTI "The "
?L19:	PRINTD OBJ
	PRINTR " contains:"

	.FUNCT GO-NEXT,TBL,VAL
	CALL LKP,HERE,TBL >VAL
	ZERO? VAL /FALSE
	CALL GOTO,VAL >STACK
	RSTACK

	.FUNCT HAR-HAR
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT HE-SHE-IT,OBJ,CAP=0,VERB=0
	FSET? OBJ,PERSON \?L1
	EQUAL? OBJ,PLAYER \?L3
	ZERO? CAP /?L5
	PRINTI "You"
	JUMP ?L33
?L5:	PRINTI "you"
	JUMP ?L33
?L3:	FSET? OBJ,FEMALE \?L12
	ZERO? CAP /?L13
	PRINTI "She"
	JUMP ?L33
?L13:	PRINTI "she"
	JUMP ?L33
?L12:	ZERO? CAP /?L21
	PRINTI "He"
	JUMP ?L33
?L21:	PRINTI "he"
	JUMP ?L33
?L1:	ZERO? CAP /?L29
	PRINTI "It"
	JUMP ?L33
?L29:	PRINTI "it"
?L33:	ZERO? VERB /FALSE
	PRINTC 32
	EQUAL? VERB,STR?25 \?L38
	EQUAL? OBJ,PLAYER /?L40
	PRINTI "is"
	RTRUE
?L40:	PRINTI "are"
	RTRUE
?L38:	PRINT VERB
	EQUAL? OBJ,PLAYER /FALSE
	PRINTI "s"
	RTRUE

	.FUNCT HIM-HER-IT,OBJ,CAP=0,POSSESS?=0
	FSET? OBJ,PERSON \?L1
	EQUAL? OBJ,PLAYER \?L3
	ZERO? CAP /?L5
	PRINTI "You"
	JUMP ?L9
?L5:	PRINTI "you"
?L9:	ZERO? POSSESS? /TRUE
	PRINTI "r"
	RTRUE
?L3:	FSET? OBJ,FEMALE \?L17
	ZERO? CAP /?L18
	PRINTI "Her"
	RTRUE
?L18:	PRINTI "her"
	RTRUE
?L17:	ZERO? POSSESS? /?L26
	ZERO? CAP /?L28
	PRINTI "His"
	RTRUE
?L28:	PRINTI "his"
	RTRUE
?L26:	ZERO? CAP /?L36
	PRINTI "Him"
	RTRUE
?L36:	PRINTI "him"
	RTRUE
?L1:	ZERO? CAP /?L44
	PRINTI "It"
	JUMP ?L48
?L44:	PRINTI "it"
?L48:	ZERO? POSSESS? /TRUE
	PRINTI "s"
	RTRUE

	.FUNCT NOT-HOLDING?,OBJ
	IN? OBJ,WINNER /FALSE
	LOC OBJ >STACK
	IN? STACK,WINNER /FALSE
	CALL HE-SHE-IT,WINNER,1
	EQUAL? WINNER,PLAYER \?L3
	PRINTI "'re"
	JUMP ?L7
?L3:	PRINTI "'s"
?L7:	PRINTI " not holding"
	CALL PRINTT,OBJ
	PRINTR "."

	.FUNCT LKP,ITM,TBL,CNT=0,LEN
	GET TBL,0 >LEN
?L1:	IGRTR? 'CNT,LEN /FALSE
	GET TBL,CNT >STACK
	EQUAL? STACK,ITM \?L1
	EQUAL? CNT,LEN /FALSE
	ADD CNT,1 >STACK
	GET TBL,STACK >STACK
	RSTACK

	.FUNCT GOTO,RM,V?=1,L,ITARM,ILRM
	IN? WINNER,RM \?L1
	CALL HAR-HAR
	RFALSE
?L1:	CALL AIR-ROOM?,HERE >STACK
	ZERO? STACK /?L4
	CALL AIR-ROOM?,RM >STACK
	ZERO? STACK \?L4
	CALL BAD-AIR? >STACK
	ZERO? STACK \FALSE
?L4:	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L7
	EQUAL? RM,DOME-LAB,BLY-OFFICE \?L7
	PRINTI "You should wait for someone to invite you."
	CRLF
	RFALSE
?L7:	LOC WINNER >L
	ZERO? SUB-IN-DOME /?L12
	FSET? AIRLOCK-ROOF,OPENBIT /?L12
	CALL THROUGH-ROOF?,RM,L >STACK
	ZERO? STACK /?L12
	CALL THIS-IS-IT,AIRLOCK-ROOF
	CALL TOO-BAD-BUT,AIRLOCK-ROOF,STR?27
	RFALSE
?L12:	EQUAL? WINNER,PLAYER \?L15
	CALL TIP-FOLLOWS-YOU,RM
	JUMP ?L20
?L15:	FSET? WINNER,MUNGBIT \?L17
	PRINTI """I wish I could!"""
	CRLF
	RFALSE
?L17:	EQUAL? RM,CRAWL-SPACE /?L21
	EQUAL? RM,SUB \?L20
	EQUAL? WINNER,TIP,SHARON /?L20
?L21:	PRINTI """You belong in there, not I!"""
	CRLF
	RFALSE
?L20:	ZERO? SUB-IN-TANK \?L25
	CALL OPEN-DOOR,L
	CALL OPEN-DOOR,RM
	JUMP ?L66
?L25:	CALL IN-TANK-AREA?,RM >ITARM
	CALL IN-LAB?,RM >ILRM
	CALL IN-TANK-AREA?,L >STACK
	ZERO? STACK /?L28
	ZERO? ITARM \?L30
	FSET SOUTH-DOORWAY,OPENBIT
?L30:	ZERO? ILRM \?L33
	FSET EAST-DOORWAY,OPENBIT
?L33:	EQUAL? RM,LAB-STORAGE \?L66
	FSET STORAGE-DOOR,OPENBIT
	JUMP ?L66
?L28:	CALL IN-LAB?,L >STACK
	ZERO? STACK /?L39
	ZERO? ITARM /?L40
	FSET SOUTH-DOORWAY,OPENBIT
	JUMP ?L66
?L40:	ZERO? ILRM \?L43
	FSET EAST-DOORWAY,OPENBIT
?L43:	EQUAL? RM,LAB-STORAGE \?L66
	FSET STORAGE-DOOR,OPENBIT
	JUMP ?L66
?L39:	EQUAL? L,HALLWAY,OFFICE \?L49
	ZERO? ITARM /?L50
	FSET EAST-DOORWAY,OPENBIT
	FSET SOUTH-DOORWAY,OPENBIT
?L50:	ZERO? ILRM /?L53
	FSET EAST-DOORWAY,OPENBIT
?L53:	EQUAL? RM,LAB-STORAGE \?L66
	FSET STORAGE-DOOR,OPENBIT
	JUMP ?L66
?L49:	EQUAL? L,LAB-STORAGE \?L66
	ZERO? ITARM /?L60
	FSET EAST-DOORWAY,OPENBIT
	FSET SOUTH-DOORWAY,OPENBIT
?L60:	ZERO? ILRM /?L63
	FSET EAST-DOORWAY,OPENBIT
?L63:	FSET STORAGE-DOOR,OPENBIT
?L66:	MOVE WINNER,RM
	EQUAL? WINNER,SHARON \?L73
	EQUAL? RM,OFFICE \?L71
	FSET SHARON,NDESCBIT
	FSET FILE-DRAWER,NDESCBIT
	FSET PAPERS,NDESCBIT
	JUMP ?L73
?L71:	FCLEAR SHARON,NDESCBIT
	FCLEAR FILE-DRAWER,NDESCBIT
	FCLEAR PAPERS,NDESCBIT
?L73:	SET 'LIT,1
	EQUAL? WINNER,PLAYER \TRUE
	SET 'HERE,RM
	ZERO? V? /?L77
	CALL V-FIRST-LOOK
?L77:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-FLASH >STACK
	RTRUE

	.FUNCT OPEN-DOOR,RM,TBL,DR
	EQUAL? RM,OFFICE,SUB /TRUE
	EQUAL? RM,AIRLOCK \?L3
	FSET AIRLOCK-ROOF,OPENBIT
	RTRUE
?L3:	GETPT RM,P?GLOBAL >TBL
	ZERO? TBL /FALSE
	PTSIZE TBL >STACK
	DEC 'STACK
	CALL ZMEMQBIT,DOORBIT,TBL,STACK >DR
	ZERO? DR /FALSE
	FSET DR,OPENBIT
	RTRUE

	.FUNCT HACK-HACK,STR
	PRINT STR
	CALL THE-PRSO-PRINT
	CALL PICK-ONE,HO-HUM >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT HELD?,OBJ
?L1:	LOC OBJ >STACK
	ZERO? STACK /FALSE
	LOC OBJ >STACK
	EQUAL? STACK,ROOMS,GLOBAL-OBJECTS /FALSE
	IN? OBJ,WINNER /TRUE
	LOC OBJ >OBJ
	JUMP ?L1

	.FUNCT IDROP
	FSET? PRSO,PERSON \?L1
	EQUAL? PRSO,PLAYER \?L3
	PRINTI "You"
	JUMP ?L7
?L3:	PRINTD PRSO
?L7:	PRINTI " wouldn't enjoy that."
	CRLF
	RFALSE
?L1:	CALL NOT-HOLDING?,PRSO >STACK
	ZERO? STACK \FALSE
	IN? PRSO,WINNER /?L13
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L13
	LOC PRSO >STACK
	CALL TOO-BAD-BUT,STACK,STR?27
	RFALSE
?L13:	MOVE PRSO,HERE
	FCLEAR PRSO,NDESCBIT
	FCLEAR PRSO,INVISIBLE
	RTRUE

	.FUNCT ITAKE,VB=1,CNT,OBJ,TEMP,?TMP
	FSET? PRSO,TAKEBIT /?L1
	ZERO? VB /FALSE
	CALL YOU-CANT,STR?36
	RFALSE
?L1:	CALL CCOUNT,WINNER >CNT
	GRTR? CNT,FUMBLE-NUMBER \?L6
	MUL CNT,FUMBLE-PROB >?TMP
	RANDOM 100 >STACK
	GRTR? ?TMP,STACK \?L6
	FIRST? WINNER >OBJ /?L7
?L7:	CALL TOO-BAD-BUT,OBJ
	PRINTI " slips from "
	CALL HIM-HER-IT,WINNER,0,1
	PRINTI " arms while "
	CALL HE-SHE-IT,WINNER,0,STR?25
	PRINTI " taking"
	CALL THE-PRSO-PRINT
	PRINTI ", and both tumble "
	CALL GROUND-DESC >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	MOVE OBJ,HERE
	MOVE PRSO,HERE
	RETURN 2
?L6:	SET 'ITAKE-LOC,0
	LOC PRSO >OBJ
	FSET? OBJ,PERSON \?L25
	ZERO? VB /?L19
	PRINTD OBJ
	PRINTI " gives it to "
	CALL HIM-HER-IT,WINNER
	PRINTI ". "
	JUMP ?L25
?L19:	SET 'ITAKE-LOC,OBJ
?L25:	MOVE PRSO,WINNER
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	FCLEAR PRSO,INVISIBLE
	EQUAL? WINNER,PLAYER \TRUE
	CALL SCORE-OBJ,PRSO
	RTRUE

	.FUNCT CCOUNT,OBJ,CNT=0,X
	FIRST? OBJ >X \?L4
?L3:	INC 'CNT
	NEXT? X >X /?L3
?L4:	RETURN CNT

	.FUNCT CHECK-DOOR,DR
	FSET? DR,NARTICLEBIT /?L1
	PRINTI "The "
?L1:	PRINTD DR
	PRINTI " is "
	FSET? DR,OPENBIT \?L8
	PUSH STR?22
	JUMP ?L10
?L8:	PUSH STR?27
?L10:	PRINT STACK
	PRINTR "."

	.FUNCT CHECK-ON-OFF
	FSET? PRSO,NARTICLEBIT /?L1
	PRINTI "The "
?L1:	PRINTD PRSO
	PRINTI " is o"
	FSET? PRSO,ONBIT \?L8
	PUSH STR?37
	JUMP ?L10
?L8:	PUSH STR?38
?L10:	PRINT STACK
	PRINTR "."

	.FUNCT NOT-HERE,OBJ
	PRINTI "You can't see"
	CALL PRINTT,OBJ
	PRINTR " here."

	.FUNCT PRINT-CONT,OBJ,V?=0,LEVEL=0,Y,1ST?,AV,STR=0,PV?=0,INV?=0,VAL=0
	FIRST? OBJ >Y \FALSE
	LOC WINNER >AV
	ZERO? AV /?L4
	FSET? AV,VEHBIT /?L6
?L4:	SET 'AV,0
?L6:	SET '1ST?,1
	LOC OBJ >STACK
	EQUAL? WINNER,OBJ,STACK \?L7
	SET 'INV?,1
	JUMP ?L11
?L7:	ZERO? Y \?L12
?L74:	ZERO? 1ST? \?L14
	PUSH 1
	JUMP ?L11
?L14:	PUSH 0
	JUMP ?L11
?L12:	EQUAL? Y,AV \?L16
	SET 'PV?,1
	JUMP ?L32
?L16:	EQUAL? Y,WINNER /?L32
	FSET? Y,INVISIBLE /?L32
	FSET? Y,TOUCHBIT /?L32
	GETP Y,P?FDESC >STR
	ZERO? STR /?L32
	FSET? Y,NDESCBIT \?L21
	ZERO? DEBUG /?L24
	PRINTI "[ndescbit] "
?L21:	SET '1ST?,0
	SET 'LEVEL,0
	ZERO? STR /?L24
	PRINT STR
	CRLF
	SET 'STR,0
	SET 'VAL,1
	CALL THIS-IS-IT,Y
?L24:	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L32
	LOC Y >STACK
	GETP STACK,P?DESCFCN >STACK
	ZERO? STACK \?L32
	FIRST? Y >STACK \?L32
	CALL PRINT-CONT,Y,V?,0 >STACK
	ZERO? STACK /?L32
	SET 'VAL,1
?L32:	NEXT? Y >Y /?L12
	JUMP ?L74
?L11:	FIRST? OBJ >Y /?L41
?L73:	ZERO? PV? /?L45
	ZERO? AV /?L45
	FIRST? AV >STACK \?L45
	CALL PRINT-CONT,AV,V?,LEVEL >STACK
	ZERO? STACK /?L45
	SET 'VAL,1
?L45:	RETURN VAL
?L41:	EQUAL? Y,AV,PLAYER /?L67
	FSET? Y,INVISIBLE /?L67
	ZERO? INV? \?L51
	FSET? Y,TOUCHBIT /?L51
	GETP Y,P?FDESC >STACK
	ZERO? STACK \?L67
?L51:	FSET? Y,NDESCBIT \?L54
	ZERO? DEBUG /?L52
	PRINTI "[ndescbit] "
?L54:	ZERO? 1ST? /?L57
	CALL FIRSTER,OBJ,LEVEL >STACK
	ZERO? STACK /?L61
	LESS? LEVEL,0 \?L61
	SET 'LEVEL,0
?L61:	INC 'LEVEL
	SET '1ST?,0
?L57:	SET 'VAL,1
	CALL DESCRIBE-OBJECT,Y,V?,LEVEL
	JUMP ?L67
?L52:	FIRST? Y >STACK \?L67
	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L67
	CALL PRINT-CONT,Y,V?,LEVEL >STACK
	ZERO? STACK /?L67
	SET 'VAL,1
?L67:	NEXT? Y >Y /?L41
	JUMP ?L73

	.FUNCT PRINT-CONTENTS,OBJ,F,N,1ST?=1
	FIRST? OBJ >F \FALSE
?L3:	NEXT? F >N /?L5
?L5:	ZERO? 1ST? /?L6
	SET '1ST?,0
	JUMP ?L11
?L6:	PRINTI ", "
	ZERO? N \?L11
	PRINTI "and "
?L11:	FSET? F,PERSON \?L16
	PRINTD F
	JUMP ?L20
?L16:	CALL PRINTA,F
?L20:	CALL THIS-IS-IT,F
	SET 'F,N
	ZERO? F \?L3
	RTRUE

	.FUNCT ROOM-CHECK,P
	SET 'P,PRSO
	EQUAL? P,DOCKING-TANK \?L1
	EQUAL? HERE,AIRLOCK \?L1
	SET 'P,HERE
?L1:	IN? P,ROOMS \?L4
	EQUAL? P,HERE \?L6
	CALL PERFORM,PRSA,GLOBAL-HERE,PRSI
	RTRUE
?L6:	EQUAL? P,AIRLOCK \?L8
	CALL GLOBAL-IN?,FILL-TANK-BUTTON,HERE >STACK
	ZERO? STACK \FALSE
?L8:	PRINTR "You aren't in that place!"
?L4:	EQUAL? P,PSEUDO-OBJECT /FALSE
	CALL META-LOC,P >STACK
	EQUAL? STACK,HERE,GLOBAL-OBJECTS,LOCAL-GLOBALS /FALSE
	CALL CORRIDOR-LOOK,P >STACK
	ZERO? STACK \FALSE
	FSET? P,PERSON \?L15
	IN? P,GLOBAL-OBJECTS \?L15
	GETP P,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >P
	CALL CORRIDOR-LOOK,P >STACK
	ZERO? STACK \FALSE
	CALL NOT-HERE,P >STACK
	RSTACK
?L15:	CALL NOT-HERE,P >STACK
	RSTACK

	.FUNCT SEE-INSIDE?,OBJ
	FSET? OBJ,INVISIBLE /FALSE
	FSET? OBJ,TRANSBIT /TRUE
	FSET? OBJ,OPENBIT /TRUE
	FSET? OBJ,SURFACEBIT /TRUE
	RFALSE

	.FUNCT ARENT-TALKING
	PRINTR "You aren't talking to anyone!"

	.FUNCT ALREADY,OBJ,STR=0
	CALL HE-SHE-IT,OBJ,1,STR?25
	PRINTI " already "
	ZERO? STR /TRUE
	PRINT STR
	PRINTR "!"

	.FUNCT NOT-CLEAR-WHOM
	PRINTR "It's not clear whom you're talking to."

	.FUNCT OKAY,OBJ=0,STR=0
	EQUAL? WINNER,PLAYER \?L1
	EQUAL? PRSA,V?WALK-TO,V?WALK,V?THROUGH \?L6
	RTRUE
?L1:	PRINTI """"
?L6:	PRINTI "Okay"
	ZERO? OBJ /?L24
	PRINTI ","
	CALL PRINTT,OBJ
	ZERO? STR /?L15
	PRINTI " is now "
	PRINT STR
?L15:	EQUAL? STR,STR?18 \?L20
	FSET OBJ,ONBIT
	JUMP ?L24
?L20:	EQUAL? STR,STR?39 \?L22
	FCLEAR OBJ,ONBIT
	JUMP ?L24
?L22:	EQUAL? STR,STR?22 \?L23
	FSET OBJ,OPENBIT
	JUMP ?L24
?L23:	EQUAL? STR,STR?27 \?L24
	FCLEAR OBJ,OPENBIT
?L24:	ZERO? STR \?L29
	ZERO? OBJ \TRUE
?L29:	PRINTI "."
	EQUAL? WINNER,PLAYER /?L32
	PRINTI """"
?L32:	CRLF
	RTRUE

	.FUNCT WONT-HELP-TO-TALK-TO,OBJ
	PRINTI "It won't help to talk to "
	CALL PRINTA,OBJ
	PRINTR "!"

	.FUNCT TOO-BAD-BUT,OBJ,STR=0
	PRINTI "Too bad, but"
	CALL PRINTT,OBJ
	ZERO? STR /TRUE
	PRINTI " is "
	PRINT STR
	PRINTR "."

	.FUNCT VISIBLE?,OBJ,L
	LOC OBJ >L
	CALL ACCESSIBLE?,OBJ >STACK
	ZERO? STACK \TRUE
	CALL CORRIDOR-LOOK,OBJ >STACK
	ZERO? STACK \TRUE
	ZERO? L /FALSE
	CALL VISIBLE?,L >STACK
	ZERO? STACK /FALSE
	CALL SEE-INSIDE?,L >STACK
	RSTACK

	.FUNCT ACCESSIBLE?,OBJ,L
	LOC OBJ >L
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? OBJ,PSEUDO-OBJECT \?L3
	EQUAL? LAST-PSEUDO-LOC,HERE \FALSE
	RTRUE
?L3:	ZERO? L /FALSE
	EQUAL? L,GLOBAL-OBJECTS /TRUE
	EQUAL? L,LOCAL-GLOBALS \?L9
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	ZERO? STACK \TRUE
?L9:	CALL META-LOC,OBJ >STACK
	EQUAL? STACK,HERE \FALSE
	EQUAL? L,WINNER,HERE /TRUE
	CALL ACCESSIBLE?,L >STACK
	ZERO? STACK /FALSE
	FSET? L,PERSON /TRUE
	FSET? L,OPENBIT /TRUE
	RFALSE

	.FUNCT WEIGHT,OBJ,CONT,WT=0
	FIRST? OBJ >CONT \?L4
?L3:	CALL WEIGHT,CONT >STACK
	ADD WT,STACK >WT
	NEXT? CONT >CONT /?L3
?L4:	GETP OBJ,P?SIZE >STACK
	ADD WT,STACK >STACK
	RSTACK

	.FUNCT V-ADJUST
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-SAIM
	CALL PERFORM,V?AIM,PRSI,PRSO
	RTRUE

	.FUNCT V-SAIM
	CALL V-FOO >STACK
	RSTACK

	.FUNCT PRE-AIM
	EQUAL? PRSI,RIGHT,LEFT \?L1
	EQUAL? PRSO,BAZOOKA,DART \FALSE
	PRINTR "You can aim that only at an enemy."
?L1:	EQUAL? PRSI,GLOBAL-SNARK \?L8
	ZERO? SNARK-ATTACK-COUNT \FALSE
	PRINTR "You can't see the Snark!"
?L8:	EQUAL? PRSI,SNARK,GLOBAL-THORPE,THORPE-SUB /FALSE
	EQUAL? PRSO,JOYSTICK \?L15
	CALL PERFORM,V?MOVE-DIR,PRSO,PRSI
	RTRUE
?L15:	PRINTI "You can aim something only to the left (port) or right (starboard), or at an enemy."
	CRLF
	CALL PRINT-ID,STR?40 >STACK
	RSTACK

	.FUNCT V-AIM
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-SANALYZE
	CALL PERFORM,V?ANALYZE,PRSI,PRSO
	RTRUE

	.FUNCT V-SANALYZE
	CALL V-FOO >STACK
	RSTACK

	.FUNCT V-ANALYZE
	FSET? PRSO,PERSON \?L1
	PRINTR "How?"
?L1:	IN? COMPUTESTOR,HERE \?L5
	CALL PERFORM,V?ASK-ABOUT,COMPUTESTOR,PRSO
	RTRUE
?L5:	FSET? PRSO,ON?BIT \?L6
	CALL CHECK-ON-OFF >STACK
	RSTACK
?L6:	FSET? PRSO,DOORBIT \?L7
	CALL CHECK-DOOR,PRSO >STACK
	RSTACK
?L7:	PRINTR "It looks normal."

	.FUNCT V-ANSWER
	PRINTI "Nobody seems to be waiting for an answer."
	CRLF
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RTRUE

	.FUNCT V-REPLY
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	FSET? PRSO,PERSON \?L1
	CALL WAITING-FOR-YOU-TO-SPEAK >STACK
	RSTACK
?L1:	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT WAITING-FOR-YOU-TO-SPEAK
	CALL HE-SHE-IT,PRSO,1,STR?41
	PRINTR " to be waiting for you to speak."

	.FUNCT V-ARM
	EQUAL? PRSO,GLOBAL-SUB,LOCAL-SUB \?L1
	PRINTR "How?"
?L1:	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-ARREST
	FSET? PRSO,PERSON \?L3
	EQUAL? PRSI,0,GLOBAL-SABOTAGE /?L1
?L3:	PRINTI "What a detective! ""Quick! Arrest that "
	PRINTD PRSO
	ZERO? PRSI /?L6
	PRINTI " for "
	PRINTD PRSI
?L6:	PRINTI " before "
	CALL HE-SHE-IT,PRSO,0,STR?42
	PRINTR "!"""
?L1:	ZERO? DOME-AIR-CRIME \?L15
	ZERO? GREENUP-GUILT \?L15
	PRINTI "For what? You have no evidence of a crime yet."
	CRLF
	CALL PRINT-ID,STR?43 >STACK
	RSTACK
?L15:	IN? PRSO,GLOBAL-OBJECTS \FALSE
	GETP PRSO,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >PRSO
	RFALSE

	.FUNCT V-ARREST
	EQUAL? PRSO,GLOBAL-GREENUP,GREENUP \?L1
	ZERO? GREENUP-ESCAPE \?L5
	ZERO? GREENUP-TRAPPED \?L5
	ZERO? GREENUP-CUFFED /?L3
?L5:	PRINTR "Once is enough!"
?L3:	ZERO? GREENUP-GUILT \?L8
	PRINTI "You don't have any evidence."
	CRLF
	CALL PRINT-ID,STR?44 >STACK
	RSTACK
?L8:	ZERO? SUB-IN-DOME /?L12
	ZERO? AIRLOCK-FULL /?L11
?L12:	CALL TOO-BAD-BUT,PRSO,STR?21 >STACK
	RSTACK
?L11:	EQUAL? PRSO,GLOBAL-GREENUP \?L14
	PRINTI "You barely issue this order when"
	JUMP ?L18
?L14:	PRINTI "Greenup turns and runs away. Then"
?L18:	REMOVE GREENUP
	FSET GREENUP,MUNGBIT
	PRINTI " a crew member reports seeing Greenup running behind the dormitory. ""He's going to try to escape in the "
	PRINTD SUB
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!""
"
	PRINTD BLY
	PRINTI " adds: """
	EQUAL? HERE,BLY-OFFICE /?L23
	PRINTI "Come to my office, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! "
?L23:	PRINTI "We can see him on the "
	PRINTD STATION-MONITOR
	PRINTI "! The "
	PRINTD CONTROLS-OFFICE
	PRINTI " is "
	EQUAL? HERE,BLY-OFFICE /?L30
	PRINTI "t"
?L30:	PRINTI "here, too!"""
	CRLF
	MOVE BLY,BLY-OFFICE
	SET 'WINNER,PLAYER
	CALL QUEUE,I-GREENUP-ESCAPE,3 >STACK
	PUT STACK,0,1
	EQUAL? HERE,BLY-OFFICE /?L39
	CALL GOTO,BLY-OFFICE >STACK
	ZERO? STACK /TRUE
?L39:	SET 'GREENUP-ESCAPE,1
	CALL SCORE-OBJ,GREENUP
	RTRUE
?L1:	PRINTI "You don't have enough evidence to arrest"
	CALL THE-PRSO-PRINT
	PRINTI "."
	CRLF
	CALL PRINT-ID,STR?45 >STACK
	RSTACK

	.FUNCT PRE-ASK
	CALL PRE-ASK-ABOUT >STACK
	RSTACK

	.FUNCT V-ASK
	ZERO? P-CONT /?L1
	FSET? PRSO,PERSON \?L1
	SET 'WINNER,PRSO
	SET 'QCONTEXT,PRSO
	SET 'QCONTEXT-ROOM,HERE
	RETURN QCONTEXT-ROOM
?L1:	CALL V-ASK-ABOUT >STACK
	RSTACK

	.FUNCT PRE-ASK-ABOUT,L
	CALL META-LOC,PRSO >L
	EQUAL? L,CENTER-OF-LAB \?L1
	EQUAL? PRSO,REMOTE-PERSON \?L1
	FSET? MICROPHONE,ONBIT /?L1
	CALL THIS-IS-IT,MICROPHONE
	PRINTI "She can't hear you while your "
	PRINTD MICROPHONE
	PRINTR " is off."
?L1:	EQUAL? PRSO,COMPUTESTOR \?L5
	FSET? COMPUTESTOR,ONBIT /?L5
	CALL THIS-IS-IT,COMPUTESTOR
	PRINTI "The "
	PRINTD COMPUTESTOR
	PRINTR " is off!"
?L5:	EQUAL? L,HERE /FALSE
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK \FALSE
	PRINTI "Sorry, but"
	CALL THE-PRSO-PRINT
	CALL NOT-HERE-PERSON,PRSO
	RTRUE

	.FUNCT V-ASK-ABOUT
	EQUAL? PRSO,PLAYER /?L3
	FSET? PRSO,PERSON /?L1
?L3:	CALL WONT-HELP-TO-TALK-TO,PRSO
	RETURN 2
?L1:	EQUAL? PRSA,V?ASK \?L6
	PRINTI """Ask me about something in particular, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L6:	PRINTD PRSO
	PRINTR " doesn't seem to know about that."

	.FUNCT PRE-ASK-CONTEXT-ABOUT,P
	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?ASK-ABOUT,QCONTEXT,PRSO
	RTRUE
?L1:	IN? COMPUTESTOR,HERE \?L3
	FSET? COMPUTESTOR,ONBIT \?L3
	CALL PERFORM,V?ASK-ABOUT,COMPUTESTOR,PRSO
	RTRUE
?L3:	CALL FIND-FLAG,HERE,PERSON,WINNER >P
	ZERO? P /FALSE
	CALL PERFORM,V?ASK-ABOUT,P,PRSO
	RTRUE

	.FUNCT V-ASK-CONTEXT-ABOUT
	CALL ARENT-TALKING >STACK
	RSTACK

	.FUNCT PRE-ASK-FOR
	CALL PRE-ASK-ABOUT >STACK
	RSTACK

	.FUNCT V-ASK-FOR
	FSET? PRSO,PERSON \?L1
	EQUAL? PRSO,PLAYER /?L1
	PRINTD PRSO
	IN? PRSI,PRSO \?L5
	PRINTI " hands you"
	CALL THE-PRSI-PRINT
	PRINTI "."
	CRLF
	MOVE PRSI,WINNER
	RTRUE
?L5:	PRINTR " doesn't have that."
?L1:	CALL HAR-HAR >STACK
	RSTACK

	.FUNCT PRE-ASK-CONTEXT-FOR,P
	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?ASK-FOR,QCONTEXT,PRSO
	RTRUE
?L1:	CALL FIND-FLAG,HERE,PERSON,WINNER >P
	ZERO? P /FALSE
	CALL PERFORM,V?ASK-FOR,P,PRSO
	RTRUE

	.FUNCT V-ASK-CONTEXT-FOR
	CALL ARENT-TALKING >STACK
	RSTACK

	.FUNCT V-ATTACK
	CALL IKILL,STR?46 >STACK
	RSTACK

	.FUNCT PRE-BRING
	EQUAL? PRSI,0,PLAYER,GLOBAL-HERE /FALSE
	SET 'P-WON,0
	PRINTR "(Sorry, but I don't understand.)"

	.FUNCT V-BRING
	CALL V-TAKE >STACK
	RSTACK

	.FUNCT PRE-SBRING
	CALL PERFORM,V?BRING,PRSI,PRSO
	RTRUE

	.FUNCT V-SBRING
	CALL V-FOO >STACK
	RSTACK

	.FUNCT V-BRUSH
	PRINTR """Cleanliness is next to Godliness,"" but here it's next to Impossible."

	.FUNCT V-$0024CALL,PER
	SET 'PER,PRSO
	EQUAL? PER,PLAYER \?L1
	CALL WONT-HELP-TO-TALK-TO,PER >STACK
	RSTACK
?L1:	FSET? PER,PERSON \?L3
	EQUAL? PRSO,REMOTE-PERSON /?L4
	GETP PRSO,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >PER
?L4:	CALL META-LOC,PER >STACK
	EQUAL? STACK,HERE /?L9
	CALL CORRIDOR-LOOK,PER >STACK
	ZERO? STACK /?L7
?L9:	CALL GRAB-ATTENTION,PER >STACK
	ZERO? STACK /TRUE
	PRINTD PER
	PRINTR " is listening."
?L7:	CALL NOT-HERE,PER >STACK
	RSTACK
?L3:	SET 'P-WON,0
	CALL MISSING-VERB >STACK
	RSTACK

	.FUNCT PRE-PHONE,P,PP
	ZERO? PRSI /?L16
	EQUAL? PRSI,MICROPHONE-DOME,MICROPHONE \?L1
	CALL PERFORM,PRSA,PRSO,VIDEOPHONE
	RTRUE
?L1:	ZERO? PRSI /?L16
	EQUAL? PRSI,SONARPHONE,VIDEOPHONE,INTERCOM \?L3
	EQUAL? REMOTE-PERSON-ON,PRSI \?L4
	PRINTI "You're still on the line to "
	PRINTD REMOTE-PERSON
	PRINTR "."
?L4:	FSET? PRSI,MUNGBIT \?L8
	PRINTI "The "
	PRINTD PRSI
	PRINTR "'s conked out!"
?L8:	EQUAL? PRSI,SONARPHONE /FALSE
	CALL GLOBAL-IN?,PRSI,HERE >STACK
	ZERO? STACK \FALSE
	PRINTI "There's no "
	PRINTD PRSI
	PRINTR " here."
?L3:	ZERO? PRSI /?L16
	CALL TOO-BAD-BUT,PRSI,STR?47 >STACK
	RSTACK
?L16:	FSET? PRSO,PERSON \?L19
	IN? PRSO,HERE \?L19
	CALL BITE-YOU >STACK
	RSTACK
?L19:	EQUAL? PRSO,PLAYER \?L20
	CALL HAR-HAR >STACK
	RSTACK
?L20:	FSET? PRSO,PERSON \?L21
	GETP PRSO,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >P
	ZERO? P /?L21
	CALL META-LOC,P >STACK
	CALL FAR-AWAY?,STACK >STACK
	ZERO? STACK \?L21
	FSET? P,BUSYBIT /?L24
	FSET? P,MUNGBIT \?L22
?L24:	CALL HE-SHE-IT,P,1
	PRINTR "'s busy right now."
?L22:	CALL MOVE-HERE-NOT-SUB,P
	CALL SAID-TO,P
	PRINTI """Right here, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ","" "
	CALL HE-SHE-IT,P
	LOC P >STACK
	EQUAL? HERE,STACK \?L30
	PRINTR " replies. ""What would you like me to do?"""
?L30:	PRINTR " shouts. ""Come outside to talk!"""
?L21:	ZERO? PRSI \FALSE
	CALL GLOBAL-IN?,VIDEOPHONE,HERE >STACK
	ZERO? STACK /?L38
	CALL PERFORM,PRSA,PRSO,VIDEOPHONE
	RTRUE
?L38:	IN? SONARPHONE,HERE \?L40
	CALL PERFORM,PRSA,PRSO,SONARPHONE
	RTRUE
?L40:	CALL GLOBAL-IN?,INTERCOM,HERE >STACK
	ZERO? STACK /?L41
	CALL PERFORM,PRSA,PRSO,INTERCOM
	RTRUE
?L41:	PRINTR "There's nothing to phone with here."

	.FUNCT V-PHONE,PER
	FSET? PRSO,PERSON \?L1
	GETP PRSO,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >PER
	ZERO? PER /?L1
	CALL META-LOC,PER >STACK
	EQUAL? STACK,HERE /?L3
	CALL CORRIDOR-LOOK,PER >STACK
	ZERO? STACK /?L1
?L3:	CALL PERFORM,V?$0024CALL,PRSO
	RTRUE
?L1:	EQUAL? -1,P-NUMBER /?L4
	PRINTR "There's no point in calling that number."
?L4:	EQUAL? PRSO,YOUR-LABORATORY,DOME-LAB,AQUADOME \?L7
	PRINTR "There's no answer."
?L7:	FSET? PRSO,PERSON /?L10
	CALL TOO-BAD-BUT,PRSO
	PRINTR " has no phone."
?L10:	CALL META-LOC,PRSO >STACK
	EQUAL? STACK,HERE \?L13
	CALL BITE-YOU >STACK
	RSTACK
?L13:	PRINTI "There's no sense in phoning "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-BOARD
	IN? PRSO,ROOMS /?L3
	FSET? PRSO,DOORBIT \?L1
?L3:	CALL V-THROUGH >STACK
	RSTACK
?L1:	CALL YOU-CANT,STR?48 >STACK
	RSTACK

	.FUNCT V-CLIMB-ON
	CALL YOU-CANT,STR?49 >STACK
	RSTACK

	.FUNCT V-CLIMB-UP,DIR=P?UP,OBJ=0,X
	GETPT HERE,DIR >STACK
	ZERO? STACK /?L1
	CALL DO-WALK,DIR
	RTRUE
?L1:	ZERO? OBJ \?L8
	CALL YOU-CANT,STR?35 >STACK
	RSTACK
?L8:	GETPT PRSO,P?SYNONYM >X
	PTSIZE X >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,W?WALL,X,STACK >STACK
	ZERO? STACK /?L4
	PRINTR "Climbing the walls is no help."
?L4:	CALL HAR-HAR >STACK
	RSTACK

	.FUNCT V-CLIMB-DOWN
	CALL V-CLIMB-UP,P?DOWN >STACK
	RSTACK

	.FUNCT V-CLOSE
	FSET? PRSO,CONTBIT /?L1
	FSET? PRSO,DOORBIT /?L4
	FSET? PRSO,WINDOWBIT /?L1
	CALL YOU-CANT >STACK
	RSTACK
?L1:	FSET? PRSO,DOORBIT /?L4
	FSET? PRSO,WINDOWBIT \?L3
?L4:	FSET? PRSO,OPENBIT \?L5
	FSET? PRSO,MUNGBIT \?L7
	PRINTR "It won't stay closed. The latch is broken."
?L7:	CALL OKAY,PRSO,STR?27 >STACK
	RSTACK
?L5:	CALL ALREADY,PRSO,STR?27 >STACK
	RSTACK
?L3:	FSET? PRSO,SURFACEBIT /?L13
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L13
	FSET? PRSO,OPENBIT \?L14
	CALL OKAY,PRSO,STR?27 >STACK
	RSTACK
?L14:	CALL ALREADY,PRSO,STR?27 >STACK
	RSTACK
?L13:	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-COME-WITH
	CALL PERFORM,V?WALK-TO,PRSI
	RTRUE

	.FUNCT V-COME-WITH
	CALL V-FOO >STACK
	RSTACK

	.FUNCT PRE-COMPARE
	ZERO? PRSI \?L1
	GET P-PRSO,0 >STACK
	EQUAL? 1,STACK \?L1
	PRINTI "Use the command: COMPARE IT TO "
	PRINTD SOMETHING
	PRINTR "."
?L1:	GET P-PRSO,0 >STACK
	EQUAL? 2,STACK \FALSE
	PUT P-PRSO,0,1
	GET P-PRSO,2 >STACK
	GET P-PRSO,1 >STACK
	CALL PERFORM,PRSA,STACK,STACK
	RTRUE

	.FUNCT V-COMPARE
	EQUAL? PRSO,PRSI \?L1
	PRINTR "They're the same thing!"
?L1:	PRINTR "They're not a bit alike."

	.FUNCT V-CONFRONT
	EQUAL? PRSO,PLAYER \?L1
	CALL ARENT-TALKING >STACK
	RSTACK
?L1:	FSET? PRSO,PERSON /?L3
	PRINTI "That ought to put a scare into"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L3:	PRINTD PRSO
	CALL PICK-ONE,WHO-CARES >STACK
	PRINT STACK
	PRINTI "."
	CRLF
	FSET? PRSI,WEAPONBIT /?L9
	PUSH 0
	JUMP ?L10
?L9:	PUSH 1
?L10:	CALL PRINT-ID,STR?50,STACK >STACK
	RSTACK

	.FUNCT V-CUT
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?51,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?52,STACK
	CALL IS-PART-OF-SELF-OR-SELF? >STACK
	CALL PRINT-ID,STR?53,STACK
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-MUNG
	FSET? PRSO,DOORBIT \?L1
	ZERO? PRSI \?L1
	FSET? PRSO,OPENBIT \?L3
	PRINTI "You'd fly through the open door if you tried."
	CRLF
	CALL PRINT-ID,STR?54 >STACK
	RSTACK
?L3:	PRINTI "Why don't you just open it instead?"
	CRLF
	CALL PRINT-ID,STR?55 >STACK
	RSTACK
?L1:	FSET? PRSO,PERSON /?L10
	CALL PRINT-ID,STR?56
	CALL YOU-CANT >STACK
	RSTACK
?L10:	ZERO? PRSI \?L11
	PRINTI "Trying to destroy "
	PRINTD PRSO
	PRINTI " with your bare hands is suicidal."
	CRLF
	CALL PRINT-ID,STR?57 >STACK
	RSTACK
?L11:	FSET? PRSI,WEAPONBIT /?L14
	PRINTI "You can't destroy"
	CALL THE-PRSO-PRINT
	PRINTI " with"
	CALL THE-PRSI-PRINT
	PRINTI "."
	CRLF
	CALL PRINT-ID,STR?58 >STACK
	RSTACK
?L14:	CALL PRINT-ID,STR?59
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-DIAGNOSE
	ZERO? PRSO /?L1
	CALL YOU-CANT >STACK
	RSTACK
?L1:	FSET? ARM,MUNGBIT \?L3
	PRINTR "Your arm is seriously gashed."
?L3:	PRINTR "You're wide awake and in good health."

	.FUNCT PRE-DISCUSS
	ZERO? PRSI \?L1
	SET 'PRSI,PLAYER
?L1:	CALL PERFORM,V?TELL-ABOUT,PRSI,PRSO
	RTRUE

	.FUNCT V-DISCUSS
	CALL V-FOO >STACK
	RSTACK

	.FUNCT V-DIVE
	ZERO? SUB-IN-TANK /?L1
	CALL WHY-NEED,DEPTH-CONTROL,TEST-TANK >STACK
	ZERO? STACK \TRUE
?L1:	ZERO? SUB-IN-DOME /?L3
	CALL WHY-NEED,DEPTH-CONTROL,AIRLOCK >STACK
	ZERO? STACK \TRUE
?L3:	EQUAL? PRSO,0,ROOMS /?L5
	EQUAL? PRSO,SEA,BAY,GLOBAL-WATER \?L4
?L5:	ZERO? SUB-DEPTH /?L8
	ZERO? PRSO \?L6
?L8:	CALL DO-WALK,P?DOWN
	RTRUE
?L6:	PRINTI "You're already "
	PRINTD UNDERWATER
	PRINTR "."
?L4:	FSET? PRSO,UNITBIT \?L12
	CALL PERFORM,V?SET,DEPTH-CONTROL,PRSO
	RTRUE
?L12:	PRINTI "You can do this by setting the "
	PRINTD DEPTH-CONTROL
	PRINTR " to the desired depth of your dive."

	.FUNCT V-DOCK
	EQUAL? PRSO,LOCAL-SUB,GLOBAL-SUB,ROOMS \?L1
	PRINTI "You can't dock the "
	PRINTD SUB
	PRINTR " now."
?L1:	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-DRINK
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?60,STACK
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-DROP,?TMP
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	SET '?TMP,PRSO
	CALL GROUND-DESC >STACK
	CALL OKAY,?TMP,STACK >STACK
	RSTACK

	.FUNCT GROUND-DESC
	EQUAL? HERE,SUB \?L1
	RETURN STR?61
?L1:	RETURN STR?62

	.FUNCT V-EAT
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?63,STACK
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-EMPTY
	ZERO? PRSI \?L1
	CALL PERFORM,V?EMPTY,PRSO,GLOBAL-WATER
	RTRUE
?L1:	PRINTR "You may know how to do that, but this program doesn't."

	.FUNCT V-ENTER
	CALL DO-WALK,P?IN
	RTRUE

	.FUNCT PRE-THROUGH
	FSET? PRSO,PERSON \FALSE
	CALL PERFORM,V?FOLLOW,PRSO
	RTRUE

	.FUNCT V-THROUGH,OBJ=0,RM,DIR
	IN? PRSO,ROOMS \?L1
	CALL PERFORM,V?WALK-TO,PRSO
	RTRUE
?L1:	FSET? PRSO,DOORBIT \?L3
	FSET? PRSO,OPENBIT \?L3
	CALL DOOR-ROOM,HERE,PRSO >RM
	ZERO? RM /?L4
	CALL GOTO,RM >STACK
	ZERO? STACK /?L4
	CALL OKAY >STACK
	RSTACK
?L4:	PRINTI "Sorry, but the """
	PRINTD PRSO
	PRINTR """ must be somewhere else."
?L3:	ZERO? OBJ \?L13
	FSET? PRSO,TAKEBIT /?L9
	CALL HE-SHE-IT,WINNER,1,STR?64
	PRINTI " into it trying to go through"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L9:	ZERO? OBJ /?L12
?L13:	PRINTR "You can't do that!"
?L12:	IN? PRSO,WINNER \?L15
	PRINTR "You must think you're a contortionist!"
?L15:	CALL HAR-HAR >STACK
	RSTACK

	.FUNCT PRE-EXAMINE,VAL
	CALL ROOM-CHECK >STACK
	ZERO? STACK \TRUE
	EQUAL? P-ADVERB,W?CAREFULLY \FALSE
	CALL INT-WAIT,3 >VAL
	ZERO? VAL \?L4
	PRINTI "You never got to finish looking over"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L4:	EQUAL? VAL,M-FATAL /TRUE
	RFALSE

	.FUNCT V-EXAMINE,TBL
	EQUAL? PRSO,INTDIR \?L1
	PRINTR "If you want to see what's there, go there!"
?L1:	EQUAL? PRSO,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER,OXYGEN-GEAR-OTHER \?L5
	CALL NOTHING-SPECIAL >STACK
	RSTACK
?L5:	IN? PRSO,GLOBAL-OBJECTS \?L6
	CALL NOT-HERE,PRSO
	RTRUE
?L6:	CALL META-LOC,PRSO >STACK
	EQUAL? STACK,HERE,LOCAL-GLOBALS /?L7
	CALL TOO-BAD-BUT,PRSO,STR?21 >STACK
	RSTACK
?L7:	GETP PRSO,P?TEXT >TBL
	ZERO? TBL /?L8
	PRINT TBL
	CRLF
	RTRUE
?L8:	FSET? PRSO,CONTBIT \?L11
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L11:	FSET? PRSO,ON?BIT \?L12
	CALL CHECK-ON-OFF >STACK
	RSTACK
?L12:	FSET? PRSO,DOORBIT \?L13
	CALL CHECK-DOOR,PRSO >STACK
	RSTACK
?L13:	CALL NOTHING-SPECIAL >STACK
	RSTACK

	.FUNCT NOTHING-SPECIAL
	PRINTI "There's nothing special about"
	CALL THE-PRSO-PRINT
	PRINTR "."

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,TBL
	GETPT OBJ2,P?GLOBAL >TBL
	ZERO? TBL /FALSE
	PTSIZE TBL >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,TBL,STACK >STACK
	RSTACK

	.FUNCT PRE-FILL
	EQUAL? PRSI,0,GLOBAL-WATER /FALSE
	CALL HAR-HAR >STACK
	RSTACK

	.FUNCT V-FILL
	PRINTR "You may know how to do that, but this program doesn't."

	.FUNCT PRE-FIND,CHR,?TMP
	EQUAL? PRSO,PLAYER /FALSE
	IN? PRSO,ROOMS \?L4
	EQUAL? PRSO,HERE \?L6
	CALL ALREADY,PLAYER,STR?65 >STACK
	RSTACK
?L6:	FSET? PRSO,TOUCHBIT \?L8
	PRINTR "You should know - you've been there!"
?L8:	GETP LOCAL-SUB,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L4:	FSET? PRSO,PERSON \FALSE
	EQUAL? PRSO,REMOTE-PERSON \?L15
	ZERO? REMOTE-PERSON-REMLOC /?L15
	CALL HE-SHE-IT,REMOTE-PERSON,1
	PRINTI "'s in the "
	PRINTD REMOTE-PERSON-REMLOC
	PRINTR "."
?L15:	GETP PRSO,P?CHARACTER >CHR
	IN? PRSO,GLOBAL-OBJECTS \?L20
	GET CHARACTER-TABLE,CHR >PRSO
?L20:	LOC PRSO >STACK
	ZERO? STACK /?L25
	LOC PRSO >STACK
	CALL FAR-AWAY?,STACK >STACK
	ZERO? STACK /?L31
?L25:	EQUAL? PRSO,BLY /?L28
	CALL IS-CREW?,PRSO >STACK
	ZERO? STACK /?L26
?L28:	CALL HE-SHE-IT,PRSO,1
	PRINTI "'s probably at the "
	PRINTD AQUADOME
	PRINTR "."
?L26:	PRINTI "Who knows where "
	CALL HE-SHE-IT,PRSO
	PRINTR " is now?"
?L31:	CALL META-LOC,WINNER >?TMP
	CALL META-LOC,PRSO >STACK
	EQUAL? ?TMP,STACK \?L37
	EQUAL? WINNER,PLAYER \?L39
	CALL BITE-YOU
	RTRUE
?L39:	PRINTR """Ahem..."""
?L37:	EQUAL? WINNER,PLAYER /?L45
	PRINTI """I think "
	CALL HE-SHE-IT,PRSO
	JUMP ?L49
?L45:	CALL HE-SHE-IT,PRSO,1
?L49:	PRINTI "'s in"
	CALL META-LOC,PRSO >STACK
	CALL PRINTT,STACK
	PRINTI "."
	EQUAL? WINNER,PLAYER /?L52
	PRINTI """"
?L52:	CRLF
	RTRUE

	.FUNCT BITE-YOU
	PRINTI "If "
	CALL HE-SHE-IT,PRSO
	PRINTI " were any closer, "
	CALL HE-SHE-IT,PRSO
	PRINTR "'d bite you!"

	.FUNCT V-FIND,L
	LOC PRSO >L
	EQUAL? PLAYER,WINNER /?L1
	PRINTI """"
?L1:	EQUAL? PRSO,PLAYER \?L6
	PRINTI "You're right here, "
	FSET? L,SURFACEBIT \?L10
	PRINTI "on"
	JUMP ?L14
?L10:	PRINTI "in"
?L14:	CALL PRINTT,L
	PRINTI "."
	JUMP ?L46
?L6:	IN? PRSO,PLAYER \?L19
	PRINTI "You have it."
	JUMP ?L46
?L19:	IN? PRSO,WINNER \?L22
	PRINTI """I have it, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "."""
	JUMP ?L46
?L22:	EQUAL? L,LOCAL-GLOBALS \?L27
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK \?L26
?L27:	IN? PRSO,HERE /?L26
	EQUAL? PRSO,PSEUDO-OBJECT \?L25
?L26:	PRINTI "It's right here."
	JUMP ?L46
?L25:	EQUAL? L,GLOBAL-OBJECTS,LOCAL-GLOBALS \?L30
	PRINTI "It's around somewhere."
	JUMP ?L46
?L30:	CALL META-LOC,PRSO >STACK
	CALL FAR-AWAY?,STACK >STACK
	ZERO? STACK /?L33
	PRINTI "It's far away from here."
	JUMP ?L46
?L33:	FSET? L,PERSON \?L36
	PRINTD L
	PRINTI " has it."
	JUMP ?L46
?L36:	FSET? L,SURFACEBIT \?L39
	PRINTI "It's on"
	CALL PRINTT,L
	PRINTI "."
	JUMP ?L46
?L39:	FSET? L,CONTBIT /?L43
	IN? L,ROOMS \?L42
?L43:	PRINTI "It's in"
	CALL PRINTT,L
	PRINTI "."
	JUMP ?L46
?L42:	PRINTI "It's nowhere in particular."
?L46:	EQUAL? PLAYER,WINNER /?L49
	PRINTI """"
?L49:	CRLF
	RTRUE

	.FUNCT V-FIND-WITH
	CALL V-FIND >STACK
	RSTACK

	.FUNCT V-FIX
	CALL MORE-SPECIFIC >STACK
	RSTACK

	.FUNCT V-FOLLOW,CN,CHR,COR,PCOR,L,?TMP
	EQUAL? PRSO,PLAYER \?L1
	CALL NOT-CLEAR-WHOM >STACK
	RSTACK
?L1:	FSET? PRSO,PERSON /?L3
	PRINTI "How tragic to see a formerly great inventor stalking "
	CALL PRINTA,PRSO
	PRINTR "!"
?L3:	SET '?TMP,HERE
	GETP PRSO,P?CHARACTER >CN
	GET CHARACTER-TABLE,CN >CHR
	CALL META-LOC,CHR >L
	EQUAL? ?TMP,L \?L6
	PRINTI "You're in the same place as "
	PRINTD PRSO
	PRINTR "!"
?L6:	ZERO? L \?L9
	PRINTD PRSO
	PRINTR " has left the grounds."
?L9:	CALL PERFORM,V?WALK-TO,CHR
	RTRUE

	.FUNCT V-FOO
	PRINTR "[Foo!! This is a bug!!]"

	.FUNCT PRE-GIVE
	CALL HELD?,PRSO >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSI,PLAYER /FALSE
	PRINTI "That's easy for you to say, since "
	CALL HE-SHE-IT,WINNER
	PRINTI " do"
	EQUAL? WINNER,PLAYER /?L7
	PRINTI "es"
?L7:	PRINTR "n't even have it."

	.FUNCT V-GIVE
	ZERO? PRSI \?L1
	CALL YOU-CANT >STACK
	RSTACK
?L1:	FSET? PRSI,PERSON /?L3
	PRINTI "You can't give "
	CALL PRINTA,PRSO
	PRINTI " to "
	CALL PRINTA,PRSI
	PRINTR "!"
?L3:	EQUAL? PRSI,PLAYER \?L6
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L6:	MOVE PRSO,PRSI
	PRINTD PRSI
	PRINTR " accepts the offer."

	.FUNCT PRE-SGIVE
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT V-SGIVE
	CALL V-FOO >STACK
	RSTACK

	.FUNCT PRE-GOODBYE
	CALL PRE-HELLO >STACK
	RSTACK

	.FUNCT V-GOODBYE
	ZERO? REMOTE-PERSON /?L1
	EQUAL? PRSO,0,REMOTE-PERSON \?L1
	CALL PHONE-OFF
	PRINTI """I hope to see you soon, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L1:	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT /?L5
	CALL FINE-SEQUENCE >STACK
	ZERO? STACK \TRUE
?L5:	CALL V-HELLO,0 >STACK
	RSTACK

	.FUNCT PRE-HANGUP
	EQUAL? PRSO,MICROPHONE-DOME,MICROPHONE \?L1
	CALL PERFORM,PRSA,VIDEOPHONE
	RTRUE
?L1:	EQUAL? PRSO,SONARPHONE,VIDEOPHONE,INTERCOM \?L3
	EQUAL? REMOTE-PERSON-ON,PRSO \?L4
	PRINTI "You're still on the line to "
	PRINTD REMOTE-PERSON
	PRINTR "."
?L4:	FSET? PRSO,MUNGBIT \?L8
	PRINTI "The "
	PRINTD PRSO
	PRINTR "'s conked out!"
?L8:	EQUAL? PRSO,SONARPHONE /FALSE
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK \FALSE
	PRINTI "There's no "
	PRINTD PRSO
	PRINTR " here."
?L3:	EQUAL? HERE,CENTER-OF-DOME \?L16
	CALL PERFORM,V?PUT,PRSO,HOOK
	RTRUE
?L16:	EQUAL? PRSO,ROOMS /FALSE
	CALL TOO-BAD-BUT,PRSO,STR?47 >STACK
	RSTACK

	.FUNCT V-HANGUP
	ZERO? REMOTE-PERSON /?L1
	CALL PERFORM,V?GOODBYE
	RTRUE
?L1:	PRINTR "You're not talking to anyone!"

	.FUNCT PRE-HELLO,P
	ZERO? PRSO \FALSE
	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L3
	CALL PERFORM,PRSA,QCONTEXT
	RTRUE
?L3:	EQUAL? WINNER,PLAYER \?L4
	CALL FIND-FLAG,HERE,PERSON,WINNER >P
	ZERO? P /?L4
	FSET? P,INVISIBLE /?L4
	CALL PERFORM,PRSA,P
	RTRUE
?L4:	CALL NOT-CLEAR-WHOM >STACK
	RSTACK

	.FUNCT V-HELLO,HELL=1
	FSET? PRSO,PERSON \?L1
	ZERO? HELL /?L3
	PRINTD PRSO
	PRINTR " nods at you."
?L3:	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK /?L7
	PRINTR """Good hunting!"""
?L7:	PRINTR """Don't tell me you're leaving already!"""
?L1:	ZERO? PRSO /?L13
	PRINTI "Only nuts say """
	ZERO? HELL /?L16
	PUSH STR?66
	JUMP ?L18
?L16:	PUSH STR?67
?L18:	PRINT STACK
	PRINTI """ to "
	CALL PRINTA,PRSO
	PRINTR "."
?L13:	CALL NOT-CLEAR-WHOM >STACK
	RSTACK

	.FUNCT V-HELP
	ZERO? PRSO \?L1
	SET 'P-WON,0
	PRINT HELP-TEXT
	CRLF
	RTRUE
?L1:	EQUAL? PRSO,PLAYER \?L5
	CALL PERFORM,V?GIVE,HINT,PLAYER
	RTRUE
?L5:	CALL MORE-SPECIFIC >STACK
	RSTACK

	.FUNCT V-KILL
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?68,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?69,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?70,STACK
	CALL IKILL,STR?71 >STACK
	RSTACK

	.FUNCT IKILL,STR
	ZERO? PRSO \?L1
	PRINTI "There's nothing here to "
	PRINT STR
	PRINTR "."
?L1:	ZERO? PRSI \?L5
	FSET? PRSO,WEAPONBIT \?L5
	PRINTI "You didn't say what to "
	PRINT STR
	PRINTR " at."
?L5:	IN? PRSO,GLOBAL-OBJECTS \?L8
	PRINTR "You can't do it from here."
?L8:	PRINTR "You think it over. It's not worth the trouble."

	.FUNCT V-KISS
	FSET? PRSO,PERSON \?L1
	CALL PRINT-ID,STR?72
	CALL FACE-RED,STR?73 >STACK
	RSTACK
?L1:	PRINTR "What a (ahem!) strange idea!"

	.FUNCT V-KNOCK
	FSET? PRSO,DOORBIT /?L3
	FSET? PRSO,WINDOWBIT \?L1
?L3:	CALL DOOR-ROOM,HERE,PRSO >STACK
	CALL INHABITED?,STACK >STACK
	ZERO? STACK /?L4
	PRINTR "Someone shouts ""Come in!"""
?L4:	PRINTR "There's no answer."
?L1:	PRINTI "Why knock on "
	CALL PRINTA,PRSO
	PRINTR "?"

	.FUNCT V-LAUNCH
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-STAND,P
	LOC WINNER >STACK
	FSET? STACK,SURFACEBIT \?L1
	MOVE WINNER,HERE
	PRINTR "You're on your own feet again."
?L1:	CALL ALREADY,PLAYER,STR?74 >STACK
	RSTACK

	.FUNCT V-LEAVE
	ZERO? PRSO /?L1
	LOC WINNER >STACK
	EQUAL? STACK,PRSO /?L1
	PRINTI "You're not in"
	CALL THE-PRSO-PRINT
	PRINTI "!"
	CRLF
	RETURN 2
?L1:	CALL DO-WALK,P?OUT
	RTRUE

	.FUNCT V-LEVEL
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-LISTEN
	FSET? PRSO,PERSON \?L1
	CALL WAITING-FOR-YOU-TO-SPEAK
	RTRUE
?L1:	CALL TOO-BAD-BUT,PRSO
	PRINTR " makes no sound."

	.FUNCT V-LOCK
	PRINTR "That won't help."

	.FUNCT V-LOOK
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /FALSE
	CALL DESCRIBE-OBJECTS,1 >STACK
	RSTACK

	.FUNCT V-LOOK-BEHIND
	FSET? PRSO,DOORBIT \?L1
	FSET? PRSO,OPENBIT /?L1
	CALL THIS-IS-IT,PRSO
	CALL TOO-BAD-BUT,PRSO,STR?27 >STACK
	RSTACK
?L1:	PRINTI "There's nothing behind"
	CALL THE-PRSO-PRINT
	PRINTR "."

	.FUNCT V-LOOK-DOWN
	EQUAL? PRSO,ROOMS \?L1
	PRINTI "There's nothing interesting "
	CALL GROUND-DESC >STACK
	PRINT STACK
	PRINTR "."
?L1:	CALL HAR-HAR >STACK
	RSTACK

	.FUNCT PRE-LOOK-INSIDE
	CALL ROOM-CHECK >STACK
	RSTACK

	.FUNCT V-LOOK-INSIDE,DIR=P?IN,RM
	EQUAL? PRSO,GLOBAL-HERE \?L1
	CALL PERFORM,V?LOOK
	RTRUE
?L1:	FSET? PRSO,RLANDBIT \?L3
	CALL ROOM-PEEK,PRSO >STACK
	RSTACK
?L3:	FSET? PRSO,DOORBIT \?L4
	FSET? PRSO,OPENBIT \?L5
	CALL DOOR-ROOM,HERE,PRSO >RM
	ZERO? RM /?L7
	CALL ROOM-PEEK,RM >STACK
	RSTACK
?L7:	PRINTI "The "
	PRINTD PRSO
	PRINTR " is open, but you can't tell what's beyond it."
?L5:	CALL THIS-IS-IT,PRSO
	CALL TOO-BAD-BUT,PRSO,STR?27 >STACK
	RSTACK
?L4:	FSET? PRSO,WINDOWBIT \?L13
	PRINTI "You can't tell what's beyond"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L13:	FSET? PRSO,CONTBIT /?L19
	FSET? PRSO,SURFACEBIT \?L18
?L19:	CALL SEE-INSIDE?,PRSO >STACK
	ZERO? STACK /?L20
	FIRST? PRSO >STACK \?L22
	CALL PRINT-CONT,PRSO >STACK
	ZERO? STACK \TRUE
?L22:	FSET? PRSO,SURFACEBIT \?L24
	PRINTI "There's nothing on"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L24:	CALL TOO-BAD-BUT,PRSO,STR?23 >STACK
	RSTACK
?L20:	CALL TOO-BAD-BUT,PRSO,STR?27 >STACK
	RSTACK
?L18:	FSET? PRSO,PERSON \?L29
	PRINTR "You forgot to bring your X-ray glasses."
?L29:	EQUAL? DIR,P?IN \?L32
	CALL YOU-CANT,STR?75 >STACK
	RSTACK
?L32:	EQUAL? DIR,P?OUT \FALSE
	CALL YOU-CANT,STR?76 >STACK
	RSTACK

	.FUNCT ROOM-PEEK,RM,OLD-HERE?1,TXT
	SET 'OLD-HERE?1,HERE
	CALL SEE-INTO?,RM >STACK
	ZERO? STACK /FALSE
	SET 'HERE,RM
	PRINTI "You take a quick peek into"
	CALL PRINTT,RM
	PRINTI ":"
	CRLF
	CALL DESCRIBE-OBJECTS,1 >STACK
	ZERO? STACK \?L10
	GETP RM,P?LDESC >TXT
	ZERO? TXT /?L7
	PRINT TXT
	CRLF
	JUMP ?L10
?L7:	PRINTI "You can't see anything interesting."
	CRLF
?L10:	SET 'HERE,OLD-HERE?1
	RETURN HERE

	.FUNCT SEE-INTO?,THERE,P,L,TBL,O
	SET 'P,0
?L1:	NEXTP HERE,P >P
	ZERO? P \?L3
	PRINTI "You can't seem to find that room."
	CRLF
	RFALSE
?L3:	EQUAL? P,P?IN,P?OUT /TRUE
	LESS? P,P?OUT /?L1
	GETPT HERE,P >TBL
	PTSIZE TBL >L
	EQUAL? L,UEXIT \?L9
	GETB TBL,REXIT >STACK
	EQUAL? STACK,THERE /TRUE
?L9:	EQUAL? L,DEXIT \?L11
	GETB TBL,REXIT >STACK
	EQUAL? STACK,THERE \?L11
	GETB TBL,DEXITOBJ >STACK
	FSET? STACK,OPENBIT /TRUE
	PRINTI "The door to that room is closed."
	CRLF
	RFALSE
?L11:	EQUAL? L,CEXIT \?L1
	GETB TBL,REXIT >STACK
	EQUAL? STACK,THERE \?L1
	GETB TBL,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK \TRUE
	PRINTI "You can't seem to find that room."
	CRLF
	RFALSE

	.FUNCT V-LOOK-ON
	FSET? PRSO,SURFACEBIT \?L1
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L1:	PRINTI "There's no good surface on"
	CALL THE-PRSO-PRINT
	PRINTR "."

	.FUNCT V-LOOK-OUTSIDE
	CALL V-LOOK-INSIDE,P?OUT >STACK
	RSTACK

	.FUNCT V-LOOK-UNDER
	FSET? PRSO,PERSON \?L1
	PRINTI "Nope. Nothing hiding under "
	PRINTD PRSO
	PRINTR "."
?L1:	LOC PRSO >STACK
	EQUAL? STACK,HERE,LOCAL-GLOBALS \?L5
	PRINTR "There's nothing there but dust."
?L5:	PRINTR "That's not a bit useful."

	.FUNCT V-LOOK-UP
	ZERO? PRSI /?L1
	PRINTI "There's no information in"
	CALL THE-PRSI-PRINT
	PRINTR " about that."
?L1:	EQUAL? PRSO,ROOMS \?L5
	PRINTR "You can see the ceiling."
?L5:	IN? NOTEBOOK,WINNER \?L10
	CALL PERFORM,V?LOOK-UP,PRSO,NOTEBOOK
	RTRUE
?L10:	PRINTI "Huh? Without the "
	PRINTD NOTEBOOK
	PRINTR "?"

	.FUNCT V-MAKE
	PRINTR """Eat, drink, and make merry, for tomorrow we shall die!"""

	.FUNCT PRE-MOVE
	CALL HELD?,PRSO >STACK
	ZERO? STACK /FALSE
	PRINTR "Juggling isn't one of your talents."

	.FUNCT V-MOVE
	FSET? PRSO,TAKEBIT \?L1
	PRINTI "Moving"
	CALL THE-PRSO-PRINT
	PRINTR " reveals nothing."
?L1:	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-MOVE-DIR
	EQUAL? PRSI,FAST,MEDIUM,SLOW /FALSE
	EQUAL? PRSI,OFF,INTDIR /FALSE
	SET 'P-WON,0
	PRINTR "(Sorry, but I don't understand that sentence.)"

	.FUNCT V-MOVE-DIR
	PRINTI "You can't move"
	CALL THE-PRSO-PRINT
	PRINTR " in any particular direction."

	.FUNCT V-OPEN,F,STR
	FSET? PRSO,CONTBIT /?L1
	FSET? PRSO,DOORBIT /?L4
	FSET? PRSO,WINDOWBIT /?L1
	CALL YOU-CANT >STACK
	RSTACK
?L1:	FSET? PRSO,DOORBIT /?L4
	FSET? PRSO,WINDOWBIT /?L4
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L3
?L4:	FSET? PRSO,OPENBIT \?L5
	CALL ALREADY,PRSO,STR?22 >STACK
	RSTACK
?L5:	FSET? PRSO,LOCKED \?L7
	CALL TOO-BAD-BUT,PRSO,STR?77 >STACK
	RSTACK
?L7:	FSET? PRSO,MUNGBIT \?L8
	PRINTR "You can't open it. The latch is broken."
?L8:	FSET PRSO,OPENBIT
	FSET? PRSO,DOORBIT /?L14
	FSET? PRSO,WINDOWBIT /?L14
	FIRST? PRSO >STACK \?L14
	FSET? PRSO,TRANSBIT \?L12
?L14:	CALL OKAY,PRSO,STR?22 >STACK
	RSTACK
?L12:	FIRST? PRSO >F \?L15
	NEXT? F >STACK /?L15
	GETP F,P?FDESC >STR
	ZERO? STR /?L15
	PRINTI "You open"
	CALL THE-PRSO-PRINT
	PRINTI "."
	CRLF
	PRINT STR
	CRLF
	RTRUE
?L15:	PRINTI "You open"
	CALL THE-PRSO-PRINT
	PRINTI " and see "
	CALL PRINT-CONTENTS,PRSO
	PRINTR "."
?L3:	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-OPEN-WITH
	CALL NOT-HOLDING?,PRSI >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT V-OPEN-WITH
	CALL PERFORM,V?OPEN,PRSO
	RTRUE

	.FUNCT V-PICK
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-PLAY
	SET 'P-WON,0
	PRINTR "(Speaking of playing, you ought to try Infocom's other products.)"

	.FUNCT V-PUSH
	CALL HACK-HACK,STR?78 >STACK
	RSTACK

	.FUNCT PRE-PUT
	EQUAL? PRSO,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER,OXYGEN-GEAR-OTHER \?L1
	CALL YOU-CANT,STR?79 >STACK
	RSTACK
?L1:	EQUAL? PRSO,SONARSCOPE \?L3
	EQUAL? PRSI,MANUAL,AUTOMATIC /FALSE
?L3:	EQUAL? PRSO,THROTTLE \?L4
	EQUAL? PRSI,FAST,MEDIUM,SLOW /FALSE
	EQUAL? PRSI,OFF /FALSE
?L4:	IN? PRSO,GLOBAL-OBJECTS \?L6
	CALL NOT-HERE,PRSO >STACK
	RSTACK
?L6:	EQUAL? PRSI,TEST-TANK,GLOBAL-WATER,GLOBAL-HERE /FALSE
	EQUAL? PRSI,FLOOR,CLAW,GLOBAL-SUB /FALSE
	EQUAL? PRSI,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER,OXYGEN-GEAR-OTHER \?L9
	CALL HAR-HAR >STACK
	RSTACK
?L9:	IN? PRSI,GLOBAL-OBJECTS \?L10
	CALL NOT-HERE,PRSI >STACK
	RSTACK
?L10:	FSET? PRSO,TAKEBIT /FALSE
	CALL YOU-CANT,STR?79 >STACK
	RSTACK

	.FUNCT V-PUT,?TMP
	FSET? PRSI,OPENBIT /?L1
	FSET? PRSI,VEHBIT /?L1
	FSET? PRSI,DOORBIT /?L5
	FSET? PRSI,CONTBIT \?L3
?L5:	CALL TOO-BAD-BUT,PRSI,STR?27
	RTRUE
?L3:	PRINTI "You can't open"
	CALL THE-PRSI-PRINT
	PRINTR "."
?L1:	ZERO? PRSI \?L10
	CALL YOU-CANT >STACK
	RSTACK
?L10:	FSET? PRSI,OPENBIT /?L12
	CALL TOO-BAD-BUT,PRSI,STR?27 >STACK
	RSTACK
?L12:	EQUAL? PRSI,PRSO \?L13
	CALL HAR-HAR >STACK
	RSTACK
?L13:	IN? PRSO,PRSI \?L14
	CALL TOO-BAD-BUT,PRSO
	PRINTI " is already "
	FSET? PRSI,SURFACEBIT \?L17
	PUSH STR?18
	JUMP ?L19
?L17:	PUSH STR?80
?L19:	PRINT STACK
	CALL THE-PRSI-PRINT
	PRINTR "."
?L14:	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \?L20
	PRINTR "There's no room."
?L20:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L23
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
?L23:	MOVE PRSO,PRSI
	FSET PRSO,TOUCHBIT
	PRINTR "Okay."

	.FUNCT V-PUT-UNDER
	PRINTR "There's not enough room."

	.FUNCT V-RAISE
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-READ,VAL
	ZERO? LIT \?L1
	PRINTR "It's impossible to read in the dark."
?L1:	EQUAL? PRSO,BADGE-GLOBAL-3,BADGE-GLOBAL-2,BADGE-GLOBAL /FALSE
	EQUAL? PRSO,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER,OXYGEN-GEAR-OTHER \?L6
	CALL YOU-CANT >STACK
	RSTACK
?L6:	IN? PRSO,GLOBAL-OBJECTS \?L7
	CALL NOT-HERE,PRSO >STACK
	RSTACK
?L7:	ZERO? PRSI /?L8
	FSET? PRSI,TRANSBIT /?L8
	EQUAL? -1,P-NUMBER \?L8
	PRINTI "You must have a swell method of looking through"
	CALL THE-PRSI-PRINT
	PRINTR "."
?L8:	EQUAL? P-ADVERB,W?CAREFULLY \FALSE
	CALL INT-WAIT,3 >VAL
	ZERO? VAL \?L12
	PRINTI "You never got to finish reading"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L12:	EQUAL? VAL,M-FATAL /TRUE
	RFALSE

	.FUNCT V-READ
	FSET? PRSO,READBIT /?L1
	CALL YOU-CANT >STACK
	RSTACK
?L1:	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-RING
	PRINTR """DING-DONG!"""

	.FUNCT V-RISE
	EQUAL? PRSO,BAY \?L1
	CALL PERFORM,V?SURFACE
	RTRUE
?L1:	CALL DO-WALK,P?UP
	RTRUE

	.FUNCT V-RUB
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?81,STACK
	CALL HACK-HACK,STR?82 >STACK
	RSTACK

	.FUNCT PRE-RUB-OVER
	CALL PERFORM,V?RUB,PRSI,PRSO
	RTRUE

	.FUNCT V-RUB-OVER
	CALL V-FOO >STACK
	RSTACK

	.FUNCT V-SAY,P
	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?TELL,QCONTEXT
	RTRUE
?L1:	IN? COMPUTESTOR,HERE \?L3
	FSET? COMPUTESTOR,ONBIT \?L3
	CALL PERFORM,V?TELL,COMPUTESTOR
	RTRUE
?L3:	CALL FIND-FLAG,HERE,PERSON,WINNER >P
	ZERO? P /?L4
	CALL PERFORM,V?TELL,P
	RTRUE
?L4:	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	PRINTR "(To talk to someone, type their name, then a comma, then what you want them to do.)"

	.FUNCT PRE-SAY-INTO
	EQUAL? PRSO,INTERCOM /FALSE
	FSET? PRSO,ONBIT /FALSE
	PRINTI "Sorry, but"
	CALL THE-PRSO-PRINT
	PRINTR " isn't on!"

	.FUNCT V-SAY-INTO
	CALL YOU-CANT,STR?83 >STACK
	RSTACK

	.FUNCT V-SCREW
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?84,STACK
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-SCREW-IN
	CALL YOU-CANT,STR?85 >STACK
	RSTACK

	.FUNCT PRE-SEARCH
	CALL ROOM-CHECK >STACK
	RSTACK

	.FUNCT V-SEARCH,OBJ
	FSET? PRSO,PERSON \?L1
	FIRST? PRSO >OBJ \?L3
	CALL THIS-IS-IT,OBJ
	PRINTI "You find "
	CALL PRINTA,OBJ
	PRINTR "."
?L3:	PRINTR "You don't find anything interesting."
?L1:	FSET? PRSO,CONTBIT \?L10
	FSET? PRSO,OPENBIT /?L11
	PRINTR "You'll have to open it first."
?L11:	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE
?L10:	PRINTR "You find nothing unusual."

	.FUNCT PRE-SEARCH-FOR,OBJ
	CALL ROOM-CHECK >STACK
	ZERO? STACK \TRUE
	IN? PRSI,PLAYER \?L3
	GETP PRSI,P?GENERIC >STACK
	CALL STACK,PRSI >OBJ
	ZERO? OBJ /?L3
	SET 'PRSI,OBJ
?L3:	EQUAL? PRSO,GLOBAL-HERE \FALSE
	SET 'PRSO,HERE
	RFALSE

	.FUNCT V-SEARCH-FOR
	FSET? PRSO,PERSON \?L1
	IN? PRSI,PRSO \?L3
	PRINTI "Indeed, "
	PRINTD PRSO
	PRINTI " has"
	CALL THE-PRSI-PRINT
	PRINTR "."
?L3:	EQUAL? PRSI,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER,OXYGEN-GEAR-OTHER \?L7
	CALL HAR-HAR >STACK
	RSTACK
?L7:	IN? PRSI,GLOBAL-OBJECTS \?L8
	PRINTD PRSO
	PRINTI " doesn't have "
	CALL PRINTA,PRSI
	PRINTR "."
?L8:	ZERO? PRSI \?L11
	PRINTD PRSO
	PRINTR " doesn't have that."
?L11:	PRINTD PRSO
	PRINTI " doesn't have"
	CALL THE-PRSI-PRINT
	PRINTI " concealed on "
	FSET? PRSO,FEMALE \?L17
	PUSH STR?86
	JUMP ?L19
?L17:	PUSH STR?87
?L19:	PRINT STACK
	PRINTR " person."
?L1:	FSET? PRSO,CONTBIT \?L20
	FSET? PRSO,OPENBIT /?L20
	PRINTI "You'll have to open"
	CALL THE-PRSO-PRINT
	PRINTR " first."
?L20:	IN? PRSI,PRSO \?L23
	PRINTI "How observant you are! There "
	CALL HE-SHE-IT,PRSI,0,STR?25
	PRINTR "!"
?L23:	ZERO? PRSI \?L28
	CALL YOU-CANT >STACK
	RSTACK
?L28:	PRINTI "You don't find"
	CALL THE-PRSI-PRINT
	PRINTR " there."

	.FUNCT V-SEND
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-SSEND
	CALL PERFORM,V?SEND,PRSI,PRSO
	RTRUE

	.FUNCT V-SSEND
	CALL V-FOO >STACK
	RSTACK

	.FUNCT V-SEND-OUT
	CALL V-SEND >STACK
	RSTACK

	.FUNCT PRE-SEND-TO
	EQUAL? PRSI,0,PLAYER,GLOBAL-HERE /FALSE
	EQUAL? PRSI,GLOBAL-SUB,AQUADOME /FALSE
	FSET? PRSO,PERSON \?L4
	CALL PERFORM,V?$0024CALL,PRSO
	EQUAL? WINNER,PLAYER /TRUE
	CALL PERFORM,V?WALK-TO,PRSI
	RTRUE
?L4:	SET 'P-WON,0
	PRINTR "(Sorry, but I don't understand.)"

	.FUNCT V-SEND-TO
	CALL V-SEND >STACK
	RSTACK

	.FUNCT PRE-SET
	EQUAL? PRSI,FAST,MEDIUM,SLOW /FALSE
	EQUAL? PRSI,OFF,AUTOMATIC,MANUAL /FALSE
	EQUAL? PRSI,AQUADOME /FALSE
	EQUAL? -1,P-NUMBER /?L1
	EQUAL? PRSI,0,ROOMS /FALSE
	ZERO? PRSI /?L1
	FSET? PRSI,UNITBIT /FALSE
?L1:	EQUAL? PRSI,RIGHT,LEFT \?L5
	CALL PERFORM,V?AIM,PRSO,PRSI
	RTRUE
?L5:	EQUAL? PRSO,PRSI \?L6
	CALL PERFORM,V?TURN,PRSO
	RTRUE
?L6:	PRINTI "You can set something only to a number with units, or to "
	PRINTD MEDIUM
	PRINTI ", "
	PRINTD AUTOMATIC
	PRINTR ", and so on."

	.FUNCT V-SET
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT PRE-SHOOT
	ZERO? PRSI \FALSE
	FSET? PRSO,WEAPONBIT \FALSE
	SET 'PRSI,PRSO
	EQUAL? PRSO,DART \?L3
	PUSH 1
	JUMP ?L5
?L3:	PUSH 0
?L5:	GET OBJ-AIMED-AT,STACK >PRSO
	RFALSE

	.FUNCT V-SHOOT
	CALL FIND-FLAG,WINNER,WEAPONBIT >STACK
	ZERO? STACK \?L1
	PRINTI "You don't have anything to shoot with."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?88,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?89,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?90,STACK >STACK
	RSTACK
?L1:	CALL IKILL,STR?91 >STACK
	RSTACK

	.FUNCT PRE-SSHOOT
	CALL PERFORM,V?SHOOT,PRSI,PRSO
	RTRUE

	.FUNCT V-SSHOOT
	CALL V-FOO >STACK
	RSTACK

	.FUNCT V-SHOW
	EQUAL? PRSO,PLAYER \?L1
	SET 'WINNER,PLAYER
	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?EXAMINE,PRSI
	RTRUE
?L3:	CALL PERFORM,V?FIND,PRSI
	RTRUE
?L1:	FSET? PRSO,PERSON /?L6
	PRINTI "Don't wait for"
	CALL THE-PRSO-PRINT
	PRINTR " to applaud."
?L6:	PRINTD PRSO
	CALL PICK-ONE,WHO-CARES >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT PRE-SSHOW
	SET 'P-MERGED,1
	CALL PERFORM,V?SHOW,PRSI,PRSO
	RTRUE

	.FUNCT V-SSHOW
	RTRUE

	.FUNCT V-SIT
	PRINTR "That won't help your mission!"

	.FUNCT V-SLAP
	ZERO? PRSI /?L1
	CALL NOT-HOLDING?,PRSI >STACK
	ZERO? STACK \TRUE
?L1:	EQUAL? PRSO,PLAYER \?L3
	PRINTI "That sounds like a sign that you could wear on your back."
	CRLF
	CALL PRINT-ID,STR?92 >STACK
	RSTACK
?L3:	FSET? PRSO,PERSON \?L6
	FSET? PRSO,MUNGBIT \?L7
	PRINTD PRSO
	PRINTI "'s eyes are full of hate, and "
	CALL HE-SHE-IT,PRSO
	PRINTI " says something unprintable."
	CRLF
	CALL PRINT-ID,STR?93 >STACK
	RSTACK
?L7:	CALL PRINT-ID,STR?94
	CALL FACE-RED,STR?95 >STACK
	RSTACK
?L6:	PRINTI "You should see Mick. He breaks boards with the edge of his hand!"
	CRLF
	CALL PRINT-ID,STR?96 >STACK
	RSTACK

	.FUNCT FACE-RED,STR
	PRINTD PRSO
	PRINTI " "
	PRINT STR
	PRINTR "s you right back. Wow, is your face red!"

	.FUNCT V-SMELL
	CALL HE-SHE-IT,PRSO,1,STR?97
	PRINTI " just like "
	CALL PRINTA,PRSO
	PRINTR "!"

	.FUNCT V-SMILE
	FSET? PRSO,PERSON \?L1
	IN? PRSO,GLOBAL-OBJECTS /?L1
	PRINTD PRSO
	PRINTR " smiles back at you."
?L1:	CALL HAR-HAR >STACK
	RSTACK

	.FUNCT V-SMOKE
	EQUAL? PRSO,CHEMICALS /?L1
	PUSH 0
	JUMP ?L2
?L1:	PUSH 1
?L2:	CALL PRINT-ID,STR?98,STACK
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-STOP
	EQUAL? PRSO,ROOMS \?L1
	EQUAL? HERE,SUB \?L1
	CALL PERFORM,V?STOP,LOCAL-SUB
	RTRUE
?L1:	ZERO? PRSO /?L3
	FSET? PRSO,ON?BIT \?L3
	CALL PERFORM,V?LAMP-OFF,PRSO
	RTRUE
?L3:	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-SURFACE
	EQUAL? PRSO,0,LOCAL-SUB /?L1
	CALL YOU-CANT >STACK
	RSTACK
?L1:	SET 'P-NUMBER,0
	CALL PERFORM,V?SET,DEPTH-CONTROL,METER
	RTRUE

	.FUNCT V-SWIM
	PRINTI "You can't swim "
	ZERO? PRSO /?L3
	PRINTI "in"
	CALL THE-PRSO-PRINT
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."
?L3:	CALL GROUND-DESC >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT PRE-TAKE
	EQUAL? PRSO,BADGE-GLOBAL-3,BADGE-GLOBAL-2,BADGE-GLOBAL /?L3
	EQUAL? PRSO,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER,OXYGEN-GEAR-OTHER \?L1
?L3:	CALL YOU-CANT >STACK
	RSTACK
?L1:	ZERO? PRSI /?L4
	EQUAL? PRSO,TRAITOR,ORE-NODULES,GLOBAL-SNARK /?L7
	EQUAL? PRSO,SEA-WALL,LOCAL-SUB,GLOBAL-SUB \?L5
?L7:	EQUAL? PRSI,GAME,AQUADOME,AIRLOCK /?L8
	EQUAL? PRSI,TEST-TANK,DOCKING-TANK,UNDERWATER /?L8
	EQUAL? PRSI,GLOBAL-HERE /?L8
	EQUAL? PRSI,SEA,BAY,GLOBAL-WATER \?L5
?L8:	CALL MORE-SPECIFIC >STACK
	RSTACK
?L5:	LOC PRSO >STACK
	EQUAL? PRSI,STACK /?L9
	FSET? PRSI,PERSON /?L10
	CALL HE-SHE-IT,PRSO,1
	PRINTI "'s not "
	EQUAL? PRSI,HOOK \?L14
	PUSH STR?18
	JUMP ?L16
?L14:	PUSH STR?80
?L16:	PRINT STACK
	PRINTR " that!"
?L10:	CALL HE-SHE-IT,PRSI,1
	PRINTI " doesn't have "
	CALL HIM-HER-IT,PRSO
	PRINTR "!"
?L9:	SET 'PRSI,0
	RFALSE
?L4:	EQUAL? PRSO,PLAYER-NAME,TEST-TANK,YOU /FALSE
	EQUAL? PRSO,GLOBAL-GREENUP,GREENUP \?L24
	FSET? GREENUP,MUNGBIT /FALSE
	CALL PERFORM,V?ARREST,PRSO
	RTRUE
?L24:	CALL META-LOC,PRSO >STACK
	EQUAL? STACK,GLOBAL-OBJECTS \?L28
	FSET? PRSO,PERSON /FALSE
	CALL NOT-HERE,PRSO >STACK
	RSTACK
?L28:	IN? PRSO,WINNER \?L32
	CALL ALREADY,PLAYER,STR?99 >STACK
	RSTACK
?L32:	LOC PRSO >STACK
	FSET? STACK,CONTBIT \?L33
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L33
	CALL YOU-CANT,STR?100 >STACK
	RSTACK
?L33:	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	PRINTR "You're in it, nitwit!"

	.FUNCT V-TAKE
	CALL ITAKE >STACK
	EQUAL? STACK,1 \FALSE
	CALL HE-SHE-IT,WINNER,1,STR?25
	PRINTI " now holding"
	CALL THE-PRSO-PRINT
	PRINTI "."
	CRLF
	CALL IS-THEFT? >STACK
	CALL PRINT-ID,STR?101,STACK >STACK
	RSTACK

	.FUNCT V-TAKE-TO
	CALL PERFORM,V?WALK-TO,PRSI
	RTRUE

	.FUNCT V-TAKE-WITH
	PRINTI "You can't remove"
	CALL THE-PRSO-PRINT
	PRINTI " with"
	CALL THE-PRSI-PRINT
	PRINTR "!"

	.FUNCT V-DISEMBARK
	LOC PRSO >STACK
	EQUAL? STACK,WINNER \?L1
	PRINTI "You don't need to take out"
	CALL THE-PRSO-PRINT
	PRINTR " to use it."
?L1:	EQUAL? PRSO,SEA,BAY,GLOBAL-WATER /?L6
	EQUAL? PRSO,GLOBAL-HERE,HERE,ROOMS \?L5
?L6:	CALL DO-WALK,P?OUT
	RTRUE
?L5:	LOC WINNER >STACK
	EQUAL? STACK,PRSO /?L7
	PRINTI "You're not in"
	CALL THE-PRSO-PRINT
	PRINTI "!"
	CRLF
	RETURN 2
?L7:	CALL OWN-FEET >STACK
	RSTACK

	.FUNCT OWN-FEET
	MOVE WINNER,HERE
	PRINTR "You're on your own feet again."

	.FUNCT V-TELL,P
	EQUAL? PRSO,PLAYER \?L1
	EQUAL? WINNER,PLAYER /?L3
	SET 'P,WINNER
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK,P
	RTRUE
?L3:	ZERO? QCONTEXT /?L5
	SET 'QCONTEXT,0
	ZERO? P-CONT /?L6
	SET 'WINNER,PLAYER
	RETURN WINNER
?L6:	PRINTR "Okay, you're not talking to anyone else."
?L5:	CALL WONT-HELP-TO-TALK-TO,PLAYER
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	RETURN 2
?L1:	FSET? PRSO,PERSON /?L15
	EQUAL? PRSO,COMPUTESTOR \?L14
?L15:	ZERO? P-CONT /?L16
	SET 'WINNER,PRSO
	JUMP ?L18
?L16:	PRINTD PRSO
	PRINTI " is listening."
	CRLF
?L18:	SET 'QCONTEXT,PRSO
	SET 'QCONTEXT-ROOM,HERE
	RETURN QCONTEXT-ROOM
?L14:	CALL YOU-CANT,STR?102
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	RETURN 2

	.FUNCT PRE-TELL-ABOUT,P
	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L1
	EQUAL? PRSO,PLAYER \?L3
	CALL PERFORM,V?ASK-ABOUT,QCONTEXT,PRSI
	RTRUE
?L1:	EQUAL? PRSO,PLAYER \?L3
	CALL FIND-FLAG,HERE,PERSON,WINNER >P
	ZERO? P /?L3
	FSET? P,INVISIBLE /?L3
	CALL PERFORM,V?ASK-ABOUT,P,PRSI
	RTRUE
?L3:	CALL PRE-ASK-ABOUT >STACK
	RSTACK

	.FUNCT V-TELL-ABOUT,P
	GETP PRSI,P?TEXT >STACK
	ZERO? STACK /?L1
	GETP PRSI,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? PRSO,PLAYER \?L5
	CALL ARENT-TALKING >STACK
	RSTACK
?L5:	CALL PERFORM,V?ASK-ABOUT,PRSO,PRSI
	RTRUE

	.FUNCT PRE-TALK-ABOUT,P
	EQUAL? WINNER,PLAYER /?L1
	CALL PERFORM,V?TELL-ABOUT,PLAYER,PRSO
	RTRUE
?L1:	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?ASK-ABOUT,QCONTEXT,PRSO
	RTRUE
?L3:	CALL FIND-FLAG,HERE,PERSON,WINNER >P
	ZERO? P /FALSE
	CALL PERFORM,V?ASK-ABOUT,P,PRSO
	RTRUE

	.FUNCT V-TALK-ABOUT
	CALL ARENT-TALKING >STACK
	RSTACK

	.FUNCT V-THANKS,P=0
	ZERO? PRSO /?L1
	FSET? PRSO,PERSON \?L1
	SET 'P,PRSO
	JUMP ?L4
?L1:	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L3
	SET 'P,QCONTEXT
	JUMP ?L4
?L3:	CALL FIND-FLAG,HERE,PERSON,WINNER >P
	ZERO? P /?L6
	JUMP ?L8
?L4:	ZERO? P /?L6
?L8:	PRINTD P
	PRINTR " acknowledges your thanks."
?L6:	PRINTR "You're more than welcome."

	.FUNCT V-THROW
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	PRINTR "Thrown."

	.FUNCT V-THROW-AT
	CALL IDROP >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSI,PLAYER \?L4
	PRINTI "Don't be silly!"
	CRLF
	CALL PRINT-ID,STR?103
	RTRUE
?L4:	FSET? PRSI,PERSON /?L9
	FSET? PRSI,NARTICLEBIT /?L9
	PRINTI "The "
?L9:	PRINTD PRSI
	FSET? PRSI,PERSON \?L16
	PUSH STR?104
	JUMP ?L18
?L16:	PUSH STR?105
?L18:	PRINT STACK
	PRINTI " as"
	CALL THE-PRSO-PRINT
	PRINTI " flies by."
	CRLF
	FSET? PRSI,PERSON \?L20
	PUSH 0
	JUMP ?L19
?L20:	CALL THROWING-AT-GLASS? >STACK
?L19:	CALL PRINT-ID,STR?106,STACK
	FSET? PRSI,PERSON /?L21
	PUSH 0
	JUMP ?L22
?L21:	PUSH 1
?L22:	CALL PRINT-ID,STR?107,STACK >STACK
	RSTACK

	.FUNCT V-THROW-THROUGH
	FSET? PRSO,PERSON /?L1
	PRINTI "Let's not resort to violence, please."
	CRLF
	CALL PRINT-ID,STR?108 >STACK
	RSTACK
?L1:	CALL V-THROW >STACK
	RSTACK

	.FUNCT PRE-TIE-TO
	EQUAL? PRSI,SONAR-EQUIPMENT,GLOBAL-SONAR,CLAW /FALSE
	EQUAL? PRSI,LOCAL-SUB,GLOBAL-SUB /FALSE
	FSET? PRSO,PERSON /FALSE
	PRINTR "That won't do any good."

	.FUNCT V-TIE-TO
	PRINTI "You can't tie"
	CALL THE-PRSO-PRINT
	PRINTI " to that."
	CRLF
	CALL PRINT-ID,STR?109 >STACK
	RSTACK

	.FUNCT PRE-TIE-WITH
	FSET? PRSO,PERSON \?L3
	FSET? PRSI,TOOLBIT /FALSE
?L3:	PRINTR "That won't do any good."

	.FUNCT V-TIE-WITH
	PRINTI """If you don't formally arrest me first, I'll sue!"""
	CRLF
	CALL PRINT-ID,STR?110 >STACK
	RSTACK

	.FUNCT V-TURN
	EQUAL? PRSO,OXYGEN-GEAR-BLY,OXYGEN-GEAR-DIVER,OXYGEN-GEAR-OTHER \?L1
	CALL HAR-HAR >STACK
	RSTACK
?L1:	CALL META-LOC,PRSO >STACK
	EQUAL? STACK,GLOBAL-OBJECTS \?L3
	CALL NOT-HERE,PRSO >STACK
	RSTACK
?L3:	FSET? PRSO,DOORBIT \?L4
	FSET? PRSO,OPENBIT \?L4
	CALL PERFORM,V?CLOSE,PRSO
	RTRUE
?L4:	PRINTR "What do you want that to do?"

	.FUNCT V-LAMP-OFF
	FSET? PRSO,PERSON \?L1
	PRINTI "Your vulgar ways would turn anyone off."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?111,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?112,STACK >STACK
	RSTACK
?L1:	FSET? PRSO,ON?BIT /?L5
	CALL YOU-CANT,STR?113 >STACK
	RSTACK
?L5:	FSET? PRSO,ONBIT /?L6
	CALL ALREADY,PRSO,STR?39 >STACK
	RSTACK
?L6:	EQUAL? PRSO,OXYGEN-GEAR,MICROPHONE-DOME,MICROPHONE \?L7
	CALL NOT-HOLDING?,PRSO >STACK
	ZERO? STACK \TRUE
?L7:	CALL OKAY,PRSO,STR?39 >STACK
	RSTACK

	.FUNCT V-LAMP-ON
	FSET? PRSO,ONBIT \?L1
	CALL ALREADY,PRSO,STR?18 >STACK
	RSTACK
?L1:	EQUAL? PRSO,OXYGEN-GEAR,MICROPHONE-DOME,MICROPHONE \?L3
	CALL NOT-HOLDING?,PRSO >STACK
	ZERO? STACK \TRUE
?L3:	FSET? PRSO,ON?BIT \?L4
	CALL OKAY,PRSO,STR?18 >STACK
	RSTACK
?L4:	FSET? PRSO,PERSON \?L5
	CALL HAR-HAR >STACK
	RSTACK
?L5:	CALL YOU-CANT,STR?114 >STACK
	RSTACK

	.FUNCT V-UNLOCK
	FSET? PRSO,CONTBIT /?L1
	CALL YOU-CANT >STACK
	RSTACK
?L1:	FSET? PRSO,DOORBIT /?L4
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L3
?L4:	FSET? PRSO,OPENBIT \?L5
	CALL YOU-CANT,0,PRSO,STR?22 >STACK
	RSTACK
?L5:	FSET? PRSO,LOCKED /?L7
	CALL ALREADY,PRSO,STR?115 >STACK
	RSTACK
?L7:	FCLEAR PRSO,LOCKED
	CALL OKAY,PRSO,STR?115 >STACK
	RSTACK
?L3:	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT V-UNTIE
	PRINTI "You can't tie "
	CALL HIM-HER-IT,PRSO
	PRINTI ", so you can't untie "
	CALL HIM-HER-IT,PRSO
	PRINTR "!"

	.FUNCT MORE-SPECIFIC
	PRINTR "How do you want to do that?"

	.FUNCT V-USE
	CALL MORE-SPECIFIC >STACK
	RSTACK

	.FUNCT V-USE-AGAINST
	FSET? PRSO,WEAPONBIT /?L2
	PUSH 0
	JUMP ?L1
?L2:	CALL IS-PERSON-ANIMAL-PROPERTY-PRSI? >STACK
?L1:	CALL PRINT-ID,STR?116,STACK
	FSET? PRSO,WEAPONBIT /?L4
	PUSH 0
	JUMP ?L6
?L4:	EQUAL? PRSI,PLAYER,ARM /?L5
	PUSH 0
	JUMP ?L6
?L5:	PUSH 1
?L6:	CALL PRINT-ID,STR?117,STACK
	CALL MORE-SPECIFIC >STACK
	RSTACK

	.FUNCT HAS-ARRIVED,WHO
	FSET WHO,TOUCHBIT
	PRINTD WHO
	PRINTR ", for whom you're waiting, has arrived."

	.FUNCT V-WAIT,NUM=-1,WHO=0,INT?1=0,VAL,HR,RESULT=1
	EQUAL? -1,NUM \?L1
	SET 'NUM,10
	PRINT I-ASSUME
	PRINTI " wait 10 turns.)"
	CRLF
?L1:	SET 'HR,HERE
	SET 'WHO-WAIT,0
	ZERO? INT?1 \?L6
	PRINTI "Time passes..."
	CRLF
?L6:	DLESS? 'NUM,0 /?L12
	CALL CLOCKER >VAL
	ZERO? VAL /?L15
	EQUAL? VAL,M-FATAL /?L18
	EQUAL? HR,HERE /?L16
?L18:	SET 'RESULT,M-FATAL
	JUMP ?L12
?L16:	ZERO? WHO /?L19
	IN? WHO,HERE \?L19
	CALL HAS-ARRIVED,WHO
	JUMP ?L12
?L19:	ZERO? NUM /?L12
	INC 'WHO-WAIT
	ZERO? INT?1 /?L22
	PRINTI "Do you want to continue what you were doing?"
	JUMP ?L26
?L22:	PRINTI "Do you want to keep waiting?"
?L26:	CALL YES? >STACK
	ZERO? STACK /?L12
	USL
	JUMP ?L6
?L15:	ZERO? WHO /?L33
	IN? WHO,HERE \?L32
	CALL HAS-ARRIVED,WHO
	JUMP ?L12
?L32:	ZERO? WHO /?L33
	IGRTR? 'WHO-WAIT,30 \?L33
	PRINTD WHO
	PRINTI " still hasn't arrived. Do you want to keep waiting?"
	CALL YES? >STACK
	ZERO? STACK /?L12
	SET 'WHO-WAIT,0
	USL
	JUMP ?L6
?L33:	USL
	JUMP ?L6
?L12:	SET 'CLOCK-WAIT,1
	RETURN RESULT

	.FUNCT INT-WAIT,N,TIM,REQ,VAL
	SET 'TIM,MOVES
	MUL N,2 >STACK
	RANDOM STACK >REQ
	CALL V-WAIT,REQ,0,1 >STACK
	EQUAL? M-FATAL,STACK \?L1
	RETURN 2
?L1:	SUB MOVES,TIM >STACK
	LESS? STACK,REQ /FALSE
	RTRUE

	.FUNCT V-WAIT-FOR,WHO
	EQUAL? -1,P-NUMBER /?L1
	EQUAL? PRSO,TURN,ROOMS \?L1
	GRTR? P-NUMBER,180 \?L3
	PRINTR "That's too long to wait."
?L3:	CALL V-WAIT,P-NUMBER >STACK
	RSTACK
?L1:	EQUAL? PRSO,GLOBAL-HERE,TURN,ROOMS \?L8
	CALL V-WAIT
	RTRUE
?L8:	EQUAL? PRSO,PLAYER \?L9
	CALL ALREADY,PLAYER,STR?65 >STACK
	RSTACK
?L9:	FSET? PRSO,PERSON \?L10
	GETP PRSO,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >WHO
	CALL META-LOC,WHO >STACK
	EQUAL? STACK,HERE \?L11
	CALL ALREADY,WHO,STR?65 >STACK
	RSTACK
?L11:	CALL V-WAIT,10000,WHO >STACK
	RSTACK
?L10:	PRINTR "Not a good idea. You might wait forever."

	.FUNCT V-WAIT-UNTIL
	EQUAL? -1,P-NUMBER /?L1
	EQUAL? PRSO,TURN \?L1
	GRTR? P-NUMBER,MOVES \?L3
	SUB P-NUMBER,MOVES >STACK
	CALL V-WAIT,STACK >STACK
	RSTACK
?L3:	PRINTR "It's already past that time."
?L1:	CALL YOU-CANT,STR?118 >STACK
	RSTACK

	.FUNCT V-ALARM
	FSET? PRSO,PERSON \?L1
	CALL HE-SHE-IT,PRSO,1
	PRINTR "'s wide awake, or haven't you noticed?"
?L1:	CALL TOO-BAD-BUT,PRSO,STR?119 >STACK
	RSTACK

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR >STACK
	RSTACK

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	EQUAL? PRSO,RIGHT,LEFT \?L1
	CALL PERFORM,V?TURN,PRSO
	RTRUE
?L1:	ZERO? P-WALK-DIR \?L3
	CALL V-WALK-AROUND
	RETURN 2
?L3:	LOC WINNER >STACK
	GETPT STACK,PRSO >PT
	ZERO? PT /?L7
	PTSIZE PT >PTS
	EQUAL? PTS,UEXIT \?L9
	GETB PT,REXIT >RM
	CALL GOTO,RM >STACK
	ZERO? STACK /TRUE
	CALL OKAY
	RTRUE
?L9:	EQUAL? PTS,NEXIT \?L14
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L14:	EQUAL? PTS,FEXIT \?L19
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L20
	CALL GOTO,RM >STACK
	ZERO? STACK /TRUE
	CALL OKAY
	RTRUE
?L20:	RETURN 2
?L19:	EQUAL? PTS,CEXIT \?L28
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L29
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	ZERO? STACK /TRUE
	CALL OKAY
	RTRUE
?L29:	GET PT,CEXITSTR >STR
	ZERO? STR /?L34
	PRINT STR
	CRLF
	RETURN 2
?L34:	CALL YOU-CANT,STR?35
	RETURN 2
?L28:	EQUAL? PTS,DEXIT \FALSE
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L43
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	ZERO? STACK /TRUE
	CALL OKAY
	RTRUE
?L43:	FSET? OBJ,INVISIBLE \?L48
	ZERO? DEBUG /?L49
	PRINTI "[invisible] "
	JUMP ?L48
?L49:	CALL YOU-CANT,STR?35 >STACK
	RSTACK
?L48:	GET PT,DEXITSTR >STR
	ZERO? STR /?L52
	PRINT STR
	CRLF
	RETURN 2
?L52:	CALL TOO-BAD-BUT,OBJ,STR?27
	CALL THIS-IS-IT,OBJ
	RETURN 2
?L7:	EQUAL? PRSO,P?IN,P?OUT \?L61
	CALL V-WALK-AROUND >STACK
	RSTACK
?L61:	CALL YOU-CANT,STR?35
	RETURN 2

	.FUNCT V-WALK-AROUND
	SET 'P-WON,0
	PRINTI "(What "
	PRINTD INTDIR
	PRINTI " do you want to go in?)"
	CRLF
	RETURN 2

	.FUNCT V-WALK-TO,O,L
	SET 'O,PRSO
	EQUAL? O,LOCAL-SUB,GLOBAL-SUB \?L1
	SET 'O,SUB
	JUMP ?L3
?L1:	FSET? O,PERSON \?L3
	IN? O,GLOBAL-OBJECTS \?L3
	GETP O,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >O
?L3:	CALL META-LOC,O >L
	EQUAL? HERE,SUB \?L5
	FSET? PRSO,UNITBIT \?L5
	CALL PERFORM,V?SET,DEPTH-CONTROL,PRSO
	RTRUE
?L5:	LOC WINNER >STACK
	EQUAL? HERE,STACK \?L7
	EQUAL? L,HERE /?L8
	EQUAL? L,LOCAL-GLOBALS \?L20
	CALL GLOBAL-IN?,O,HERE >STACK
	ZERO? STACK /?L7
?L8:	CALL HE-SHE-IT,WINNER,1
	EQUAL? WINNER,PLAYER \?L9
	PRINTI " do"
	JUMP ?L13
?L9:	PRINTI " does"
?L13:	PRINTI "n't need to walk around within a "
	PUSH STR?120
	PRINT STACK
	CRLF
	RTRUE
?L7:	EQUAL? L,LOCAL-GLOBALS \?L20
	CALL MORE-SPECIFIC >STACK
	RSTACK
?L20:	EQUAL? PRSO,JOB \?L21
	EQUAL? WINNER,PLAYER /?L22
	PRINTI """"
?L22:	CALL MORE-SPECIFIC
	EQUAL? WINNER,PLAYER /?L27
	PRINTI """"
?L27:	CRLF
	RTRUE
?L21:	EQUAL? PRSO,INTDIR \?L32
	CALL V-WALK-AROUND >STACK
	RSTACK
?L32:	CALL FAR-AWAY?,L >STACK
	ZERO? STACK /?L33
	CALL HE-SHE-IT,WINNER,1
	PRINTI " can't go from here to there"
	EQUAL? L,GLOBAL-OBJECTS /?L36
	PRINTI ", at least not directly"
?L36:	PRINTR "."
?L33:	EQUAL? WINNER,PLAYER /?L43
	CALL GOTO,L >STACK
	ZERO? STACK /FALSE
	PRINTI """Okay."
	EQUAL? WINNER,TIP \?L48
	PRINTI " But I'll still follow you if you move!"
?L48:	PRINTR """"
?L43:	ZERO? SUB-IN-DOME /?L56
	FSET? FOOT-OF-RAMP,TOUCHBIT /?L56
	EQUAL? L,FOOT-OF-RAMP,SUB,AIRLOCK /?L56
	EQUAL? L,AIRLOCK-WALL /?L56
	PRINTI "You should go to the "
	PRINTD FOOT-OF-RAMP
	PRINTR " first."
?L56:	IN? O,ROOMS \?L59
	CALL GOTO,O >STACK
	ZERO? STACK /TRUE
	CALL OKAY
	RTRUE
?L59:	CALL HE-SHE-IT,O,1
	PRINTI "'s in"
	CALL PRINTT,L
	PRINTI "."
	CRLF
	CALL GOTO,L >STACK
	ZERO? STACK /TRUE
	CALL OKAY
	RTRUE

	.FUNCT V-WALK-UNDER
	EQUAL? PRSO,BAY,SEA,GLOBAL-WATER \?L1
	CALL PERFORM,V?DIVE
	RTRUE
?L1:	CALL YOU-CANT,STR?121 >STACK
	RSTACK

	.FUNCT V-RUN-OVER,?TMP
	PRINTI "That doesn't make much sense."
	CRLF
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L4
	PUSH ?TMP
	JUMP ?L3
?L4:	CALL IS-THEFT? >STACK
?L3:	CALL PRINT-ID,STR?122,STACK >STACK
	RSTACK

	.FUNCT V-WHAT,P
	EQUAL? PRSO,PLAYER \?L1
	EQUAL? WINNER,PLAYER /?L3
	PRINTI """"
?L3:	PRINTI "You're the inventor!"
	EQUAL? WINNER,PLAYER /?L10
	PRINTI """"
?L10:	CRLF
	RTRUE
?L1:	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L17
	SET 'P,QCONTEXT
	FSET? P,PERSON /?L16
?L17:	CALL FIND-FLAG,HERE,PERSON,WINNER >P
	ZERO? P /?L15
?L16:	CALL PERFORM,V?ASK-ABOUT,P,PRSO >STACK
	RSTACK
?L15:	FSET? PRSO,PERSON \?L18
	GETP TIP,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L18:	CALL WONT-HELP-TO-TALK-TO,PLAYER >STACK
	RSTACK

	.FUNCT V-YELL
	CALL V-YES >STACK
	RSTACK

	.FUNCT V-YELL-FOR
	ZERO? DOME-AIR-BAD? /?L1
	EQUAL? PRSO,SPECIAL-TOOL-GLOBAL,SPECIAL-TOOL,UNIVERSAL-TOOL \?L1
	PRINTI "The three crew members who are still on their feet shout back that the "
	PRINTD SPECIAL-TOOL
	PRINTR " should be there on the hook."
?L1:	CALL V-YES >STACK
	RSTACK

	.FUNCT V-YES,NO?=0
	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L1
	EQUAL? WINNER,PLAYER \?L1
	SET 'WINNER,QCONTEXT
	ZERO? NO? /?L3
	CALL PERFORM,V?NO
	RTRUE
?L3:	CALL PERFORM,V?YES
	RTRUE
?L1:	CALL ARENT-TALKING >STACK
	RSTACK

	.FUNCT V-NO
	CALL V-YES,1 >STACK
	RSTACK

	.FUNCT SCORE-UPD,NUM
	ADD SCORE,NUM >SCORE
	PRINTI "("
	GRTR? 0,NUM \?L3
	PRINTI "Oh no! "
?L3:	PRINTI "Your score just went "
	LESS? 0,NUM \?L10
	PRINTI "up"
	JUMP ?L14
?L10:	SUB 0,NUM >NUM
	PRINTI "down"
?L14:	PRINTI " by "
	PRINTN NUM
	PRINTI " point"
	EQUAL? NUM,1 /?L19
	PRINTI "s"
?L19:	PRINTR "!)"

	.FUNCT SCORE-OBJ,OBJ,TEMP
	GETP OBJ,P?VALUE >TEMP
	ZERO? TEMP /FALSE
	GRTR? TEMP,0 \FALSE
	CALL SCORE-UPD,TEMP
	PUTP OBJ,P?VALUE,0
	RTRUE

	.FUNCT V-SCORE
	PRINTI "Your score is "
	PRINTN SCORE
	PRINTI " point"
	EQUAL? SCORE,1 /?L3
	PRINTI "s"
?L3:	PRINTI " out of 105, in "
	PRINTN MOVES
	PRINTI " turn"
	EQUAL? MOVES,1 \?L10
	PRINTI "."
	JUMP ?L14
?L10:	PRINTI "s."
?L14:	CRLF
	PRINTI "This score gives you the rank of a "
	GRTR? 0,SCORE \?L19
	GET RANKS,0 >STACK
	JUMP ?L21
?L19:	DIV SCORE,20 >STACK
	GET RANKS,STACK >STACK
?L21:	PRINT STACK
	PRINTI " adventurer."
	CRLF
	RETURN SCORE

	.FUNCT FINISH,REPEATING=0,VAL
	ZERO? DEBUG \TRUE
	CRLF
	CRLF
	ZERO? REPEATING \?L4
	CALL V-SCORE
	CRLF
?L4:	PRINTI "[EVENT: GAME OVER]Would you like to:
   RESTORE your place from where you saved it,
   RESTART the story from the beginning, or
   QUIT for now?
"
?L9:	PRINTI ">"
	READ P-INBUF,P-LEXV
	GET P-LEXV,P-LEXSTART >VAL
	ZERO? VAL /?L21
	CALL WT?,VAL,PS?VERB,P1?VERB >VAL
	EQUAL? VAL,ACT?RESTART \?L15
	RESTART
?L15:	EQUAL? VAL,ACT?RESTORE \?L17
	CALL V-RESTORE >STACK
	ZERO? STACK \TRUE
	CALL FINISH,1
	JUMP ?L21
?L17:	EQUAL? VAL,ACT?QUIT \?L21
	QUIT
?L21:	PRINTI "(Type RESTORE, RESTART, or QUIT.) "
	JUMP ?L9

	.FUNCT DIVESTMENT?,OBJ
	EQUAL? PRSO,OBJ \FALSE
	EQUAL? PRSA,V?THROW-THROUGH,V?THROW-AT,V?PUT /TRUE
	EQUAL? PRSA,V?GIVE,V?DROP /TRUE
	RFALSE

	.FUNCT EXIT-VERB?,?TMP
	EQUAL? PRSA,V?WALK /TRUE
	EQUAL? PRSA,V?THROUGH,V?FOLLOW,V?WALK-TO \FALSE
	SET '?TMP,HERE
	CALL META-LOC,PRSO >STACK
	EQUAL? ?TMP,STACK \TRUE
	RFALSE

	.FUNCT GAME-VERB?
	EQUAL? PRSA,V?DEBUG,V?$0024VERIFY,V?SCORE /TRUE
	EQUAL? PRSA,V?UNSCRIPT,V?SCRIPT,V?VERSION /TRUE
	EQUAL? PRSA,V?RESTART,V?QUIT,V?RESTORE /TRUE
	EQUAL? PRSA,V?SAVE,V?VERBOSE,V?SUPER-BRIEF /TRUE
	EQUAL? PRSA,V?BRIEF,V?TELL /TRUE
	RFALSE

	.FUNCT REMOTE-VERB?
	EQUAL? PRSA,V?WHAT,V?WALK-TO,V?TELL-ABOUT /TRUE
	EQUAL? PRSA,V?TAKE-WITH,V?SGIVE,V?SEARCH-FOR /TRUE
	EQUAL? PRSA,V?SEARCH,V?MAKE,V?LOOK-UP /TRUE
	EQUAL? PRSA,V?GIVE,V?FIND,V?DROP /TRUE
	EQUAL? PRSA,V?DISEMBARK,V?ASK-FOR,V?ASK-CONTEXT-FOR /TRUE
	EQUAL? PRSA,V?ASK-CONTEXT-ABOUT,V?ASK-ABOUT /TRUE
	RFALSE

	.FUNCT SPEAKING-VERB?
	EQUAL? PRSA,V?YES,V?WHAT,V?TELL-ABOUT /TRUE
	EQUAL? PRSA,V?TELL,V?NO,V?HELLO /TRUE
	EQUAL? PRSA,V?GOODBYE,V?ASK-FOR,V?ASK-ABOUT /TRUE
	EQUAL? PRSA,V?ASK,V?$0024CALL /TRUE
	RFALSE

	.FUNCT SUB-EXIT-F,X
	FSET? SUB-DOOR,OPENBIT /?L1
	CALL THIS-IS-IT,SUB-DOOR
	PRINTI "The "
	PRINTD SUB-DOOR
	PRINTI " is closed."
	CRLF
	RFALSE
?L1:	ZERO? SUB-IN-TANK /?L5
	GET ON-SUB,0 >X
	ZERO? X /?L6
	MOVE X,NORTH-TANK-AREA
?L6:	GET ON-SUB,1 >X
	ZERO? X /?L9
	MOVE X,NORTH-TANK-AREA
?L9:	RETURN NORTH-TANK-AREA
?L5:	ZERO? SUB-IN-DOME /?L12
	ZERO? AIRLOCK-FULL /?L13
	PRINTI "You can't go out while the "
	PRINTD AIRLOCK
	PRINTI " is full of water!"
	CRLF
	RFALSE
?L13:	ZERO? DOME-AIR-BAD? \?L20
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L20
	CALL QUEUE,I-DOME-AIR,DOME-AIR-ONSET >STACK
	PUT STACK,0,1
	IN? OXYGEN-GEAR,PLAYER /?L20
	CALL TELL-HINT,53,OXYGEN-GEAR,0
	CRLF
?L20:	GET ON-SUB,0 >X
	ZERO? X /?L24
	MOVE X,AIRLOCK
?L24:	GET ON-SUB,1 >X
	ZERO? X /?L27
	MOVE X,AIRLOCK
?L27:	IN? MAGAZINE,TIP \?L30
	MOVE MAGAZINE,SUB
?L30:	CALL QUEUE,I-POISON-JAB,0
	RETURN AIRLOCK
?L12:	PRINTI "You can't go out of the "
	PRINTD SUB
	PRINTI " here!"
	CRLF
	RFALSE

	.FUNCT DOCKING-VERB?
	EQUAL? NOW-TERRAIN,BAY-TERRAIN,SEA-TERRAIN \FALSE
	EQUAL? PRSA,V?DOCK /TRUE
	EQUAL? PRSA,V?WALK \?L4
	EQUAL? PRSO,P?IN /TRUE
?L4:	EQUAL? PRSA,V?WALK-TO,V?THROUGH \FALSE
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L6
	EQUAL? PRSO,YOUR-LABORATORY,TANK-GATE,TEST-TANK \FALSE
	RTRUE
?L6:	EQUAL? PRSO,AIRLOCK-HATCH,AQUADOME,AIRLOCK /TRUE
	EQUAL? PRSO,DOCKING-TANK /TRUE
	RFALSE

	.FUNCT SOMEONE-WORKING?
	CALL POPULATION,CRAWL-SPACE,PLAYER >STACK
	ZERO? STACK \TRUE
	CALL POPULATION,SUB,TIP,PLAYER >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT CANT-GO-TO-THRU-CLOSED-HATCH?,X
	SET 'X,PRSO
	FSET? PRSO,PERSON \?L1
	GETP PRSO,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >X
?L1:	CALL GLOBAL-IN?,PRSO,SUB >STACK
	ZERO? STACK \FALSE
	CALL GLOBAL-IN?,PRSO,CRAWL-SPACE >STACK
	ZERO? STACK \FALSE
	EQUAL? X,DOCKING-TANK,TEST-TANK /?L7
	CALL META-LOC,X >STACK
	EQUAL? STACK,SUB,CRAWL-SPACE,GLOBAL-OBJECTS /FALSE
?L7:	CALL SUB-EXIT-F >STACK
	ZERO? STACK /TRUE
	RFALSE

	.FUNCT SUB-F,RARG=0,RM,X
	EQUAL? RARG,M-BEG \?L1
	ZERO? SUB-IN-TANK \?L5
	ZERO? SUB-IN-DOME /?L3
?L5:	EQUAL? PRSA,V?LAUNCH /?L6
	EQUAL? PRSA,V?LEAVE \?L3
	EQUAL? PRSO,TEST-TANK,AIRLOCK \?L3
?L6:	CALL PERFORM,V?LAMP-ON,LOCAL-SUB
	RTRUE
?L3:	EQUAL? PRSA,V?STAND \?L7
	PRINTR "There's no room in here!"
?L7:	EQUAL? PRSA,V?$0024CALL \?L10
	EQUAL? PRSO,FAST,MEDIUM,SLOW \FALSE
	CALL PERFORM,V?SET,THROTTLE,PRSO
	RTRUE
?L10:	EQUAL? PRSA,V?LEAVE,V?DISEMBARK \?L14
	ZERO? PRSO /?L15
	EQUAL? PRSO,LOCAL-SUB \?L14
?L15:	CALL SUB-EXIT-F >RM
	ZERO? RM /TRUE
	CALL GOTO,RM >STACK
	ZERO? STACK /TRUE
	EQUAL? WINNER,PLAYER /TRUE
	CALL OKAY
	RTRUE
?L14:	CALL DOCKING-VERB? >STACK
	ZERO? STACK /?L22
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L23
	PRINTI "You can't go back to the "
	PRINTD TEST-TANK
	PRINTR " now!"
?L23:	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK \?L27
	CALL TOO-BAD-BUT,AIRLOCK,STR?21 >STACK
	RSTACK
?L27:	FSET? AIRLOCK-HATCH,OPENBIT /?L28
	CALL TOO-BAD-BUT,AIRLOCK-HATCH,STR?27 >STACK
	RSTACK
?L28:	SET 'THROTTLE-SETTING,1
	SET 'JOYSTICK-DIR,P?NORTH
	SET 'SUB-DLON,0
	SET 'SUB-DLAT,1
	RTRUE
?L22:	ZERO? SUB-IN-DOME \?L30
	EQUAL? PRSA,V?WALK-TO,V?FIND \?L30
	EQUAL? PRSO,DOCKING-TANK,AQUADOME,LOCAL-SUB \?L30
	EQUAL? NOW-TERRAIN,BAY-TERRAIN,SEA-TERRAIN \FALSE
	CALL PERFORM,V?FIND,PLAYER
	RTRUE
?L30:	EQUAL? PRSA,V?LEVEL,V?CLIMB-UP,V?CLIMB-DOWN \?L34
	ZERO? SUB-IN-TANK \?L37
	ZERO? SUB-IN-DOME /?L35
?L37:	PRINTI "You can't do that while the "
	PRINTD SUB
	PRINTR " is here."
?L35:	EQUAL? PRSA,V?LEVEL \?L40
	SET 'TARGET-DEPTH,SUB-DEPTH
	RTRUE
?L40:	FSET? PRSO,UNITBIT \FALSE
	EQUAL? PRSA,V?CLIMB-DOWN \?L42
	MUL 5,SUB-DEPTH >STACK
	ADD STACK,P-NUMBER >P-NUMBER
	JUMP ?L45
?L42:	EQUAL? PRSA,V?CLIMB-UP \?L45
	MUL 5,SUB-DEPTH >STACK
	SUB STACK,P-NUMBER >P-NUMBER
	GRTR? 0,P-NUMBER \?L45
	PRINTR "You're not deep enough!"
?L45:	CALL PERFORM,V?DIVE,PRSO
	RTRUE
?L34:	EQUAL? PRSA,V?WALK \?L52
	EQUAL? PRSO,UNDERWATER \?L53
	SET 'PRSO,P?DOWN
?L53:	LESS? PRSO,P?OUT \?L56
	CALL V-WALK-AROUND
	RTRUE
?L56:	EQUAL? PRSO,P?OUT,P?IN /FALSE
	EQUAL? PRSO,P?UP,P?DOWN \?L62
	SET 'P-NUMBER,5
	EQUAL? PRSO,P?UP \?L64
	CALL PERFORM,V?CLIMB-UP,METER
	RTRUE
?L64:	CALL PERFORM,V?CLIMB-DOWN,METER
	RTRUE
?L62:	EQUAL? PRSO,FAST,MEDIUM,SLOW \?L68
	CALL PERFORM,V?SET,THROTTLE,PRSO
	RTRUE
?L68:	EQUAL? PRSO,P?EAST,P?SE,P?NE \?L71
	SET 'SUB-DLON,1
	JUMP ?L74
?L71:	EQUAL? PRSO,P?WEST,P?SW,P?NW \?L73
	SET 'SUB-DLON,-1
	JUMP ?L74
?L73:	SET 'SUB-DLON,0
?L74:	EQUAL? PRSO,P?NORTH,P?NW,P?NE \?L75
	SET 'SUB-DLAT,1
	JUMP ?L78
?L75:	EQUAL? PRSO,P?SOUTH,P?SW,P?SE \?L77
	SET 'SUB-DLAT,-1
	JUMP ?L78
?L77:	SET 'SUB-DLAT,0
?L78:	FSET? AUTO-PILOT,ONBIT \?L79
	PRINTI "Let the "
	PRINTD AUTO-PILOT
	PRINTI " handle that."
	CRLF
	JUMP ?L88
?L79:	ZERO? SUB-IN-TANK /?L83
	CALL TRY-TO-EMERGE,P?EAST,TANK-GATE,TEST-TANK-FULL
	JUMP ?L88
?L83:	ZERO? SUB-IN-DOME /?L84
	CALL TRY-TO-EMERGE,P?SOUTH,AIRLOCK-HATCH,AIRLOCK-FULL
	JUMP ?L88
?L84:	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK /?L85
	ZERO? TOLD-SNARK-WENT /?L85
	FSET? SNARK,INVISIBLE \?L85
	EQUAL? SUB-DEPTH,AIRLOCK-DEPTH \?L85
	EQUAL? PRSO,P?SE \?L85
	EQUAL? JOYSTICK-DIR,PRSO /?L85
	PRINTI "Pulses racing and hearts thumping, you and Tip at last set out to capture the monstrous Snark!"
	CRLF
	JUMP ?L88
?L85:	CALL SUB-NOW-HEADING
?L88:	SET 'JOYSTICK-DIR,PRSO
	RTRUE
?L52:	EQUAL? PRSA,V?WALK-UNDER \?L89
	EQUAL? PRSO,SEA,BAY,GLOBAL-WATER \?L89
	ZERO? SUB-DEPTH \?L90
	CALL DO-WALK,P?DOWN
	RTRUE
?L90:	PRINTI "You're already "
	PRINTD UNDERWATER
	PRINTR "."
?L89:	CALL EXIT-VERB? >STACK
	ZERO? STACK /?L95
	CALL CANT-GO-TO-THRU-CLOSED-HATCH? >STACK
	ZERO? STACK \TRUE
	RFALSE
?L95:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L99
	EQUAL? PRSO,DOCKING-TANK,TEST-TANK \?L99
	PRINT I-ASSUME
	PRINTI " look through the "
	PRINTD SUB-WINDOW
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?LOOK-INSIDE,SUB-WINDOW
	RTRUE
?L99:	EQUAL? PRSA,V?EXAMINE \?L102
	EQUAL? PRSO,GLOBAL-SNARK,SNARK /?L103
	EQUAL? PRSO,GLOBAL-SHARON,GLOBAL-THORPE,THORPE-SUB \?L102
?L103:	FSET? SNARK,INVISIBLE /?L104
	PRINTI "The "
	PRINTD GLOBAL-WATER
	PRINTR " is too cloudy to see anything."
?L104:	CALL TOO-BAD-BUT,PRSO,STR?21 >STACK
	RSTACK
?L102:	EQUAL? PRSA,V?DROP \?L109
	GET ON-SUB,1 >STACK
	GET ON-SUB,0 >STACK
	EQUAL? PRSO,STACK,STACK \?L109
	GET ON-SUB,0 >STACK
	EQUAL? PRSO,STACK \?L110
	PUT ON-SUB,0,0
	JUMP ?L112
?L110:	GET ON-SUB,1 >STACK
	EQUAL? PRSO,STACK \?L112
	PUT ON-SUB,1,0
?L112:	ZERO? SUB-IN-TANK /?L114
	MOVE PRSO,NORTH-TANK-AREA
	JUMP ?L117
?L114:	ZERO? SUB-IN-DOME /?L116
	MOVE PRSO,AIRLOCK
	JUMP ?L117
?L116:	REMOVE PRSO
?L117:	FCLEAR PRSO,NDESCBIT
	FSET PRSO,TAKEBIT
	FCLEAR PRSO,TRYTAKEBIT
	PRINTR "Dropped."
?L109:	EQUAL? PRSA,V?TAKE-WITH \FALSE
	EQUAL? PRSI,CLAW \FALSE
	LOC PRSO >STACK
	EQUAL? STACK,AIRLOCK,NORTH-TANK-AREA /?L121
	CALL TOO-BAD-BUT,PRSO,STR?123 >STACK
	RSTACK
?L121:	FSET? PRSO,TAKEBIT /?L123
	CALL YOU-CANT,STR?36 >STACK
	RSTACK
?L123:	CALL MOUNT-WEAPON,PRSO >STACK
	ZERO? STACK /TRUE
	PRINTR "Taken."
?L1:	EQUAL? RARG,M-ENTER \?L129
	CALL POPULATION,SUB,TIP,PLAYER >STACK
	ZERO? STACK /?L130
	CALL TOO-CROWDED
	ZERO? SUB-IN-DOME /?L132
	CALL GOTO,AIRLOCK
	RTRUE
?L132:	ZERO? SUB-IN-TANK /TRUE
	CALL GOTO,NORTH-TANK-AREA
	RTRUE
?L130:	CALL QUEUE,I-POISON-JAB,9 >STACK
	PUT STACK,0,1
	GET ON-SUB,0 >X
	ZERO? X /?L137
	MOVE X,SUB
?L137:	GET ON-SUB,1 >X
	ZERO? X /?L140
	MOVE X,SUB
?L140:	IN? ESCAPE-POD-UNIT,SUB \?L143
	FSET? SYRINGE,MUNGBIT \?L143
	FSET? SYRINGE,TOUCHBIT /?L143
	CALL QUEUE,I-CHECK-POD,1 >STACK
	PUT STACK,0,1
?L143:	ZERO? SUB-IN-DOME /?L154
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK /?L154
	CALL SOMEONE-WORKING? >STACK
	ZERO? STACK \?L154
	FCLEAR SUB-DOOR,OPENBIT
	MOVE TIP,HERE
	PRINTI "As you and Tip take your places in your seats, "
	FSET? AIRLOCK-ROOF,OPENBIT \?L150
	CALL AIRLOCK-POP? >STACK
	ZERO? STACK \?L150
	FCLEAR AIRLOCK-ROOF,OPENBIT
	PRINTI "and close the hatch, the "
	PRINTD AIRLOCK-ROOF
	PRINTI " is also sliding shut."
	CRLF
	JUMP ?L154
?L150:	PRINTI "Tip closes the hatch."
	CRLF
?L154:	CALL SCORE-OBJ,SUB
	RTRUE
?L129:	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You're in the pilot's seat of the "
	PRINTD SUB
	PRINTI ", its operating "
	PRINTD CONTROLS-SUB
	PRINTI " before you."
	FSET? ENGINE-ACCESS-HATCH,OPENBIT \?L161
	PRINTI " The "
	PRINTD ENGINE-ACCESS-HATCH
	PRINTI " is open."
?L161:	PRINTI "
A wraparound "
	PRINTD SUB-WINDOW
	PRINTI ", both fore and aft, provides a view ahead and astern."
	ZERO? SUB-DEPTH \?L168
	ZERO? SUB-IN-TANK \?L168
	PRINTI " Sunlight pours in through the "
	PRINTD SUB-WINDOW
	PRINTI "."
?L168:	PRINTI " You can also observe your surroundings with a "
	PRINTD SONARSCOPE
	PRINTI " and a "
	PRINTD HYDROPHONE
	PRINTI " listening device. There's a "
	PRINTD SONARPHONE
	PRINTR " for communication. You'll discover other features when you need them."

	.FUNCT TOO-CROWDED
	PRINTR "It's too crowded in here! You'll have to wait outside."

	.FUNCT TRY-TO-EMERGE,DIR,GATE,FULL?
	ZERO? FULL? \?L1
	PRINTI "You can't turn the sub around while the "
	EQUAL? DIR,P?EAST \?L5
	PRINTD TEST-TANK
	JUMP ?L9
?L5:	PRINTD AIRLOCK
?L9:	PRINTR " is empty."
?L1:	EQUAL? PRSO,DIR \?L14
	ZERO? THROTTLE-SETTING /?L15
	FSET? ENGINE,ONBIT /?L17
	PRINTI "Nothing happens when you push the "
	PRINTD JOYSTICK
	PRINTI ". The engine is off."
	ZERO? GATE-CRASHED /?L21
	PRINTI " It was stopped by Automatic Shutoff when you crashed into the sea gate."
?L21:	CRLF
	RTRUE
?L17:	CALL HATCH-GATE-NOT-READY?,GATE >STACK
	ZERO? STACK \TRUE
	EQUAL? DIR,P?SOUTH \?L27
	CALL SUB-LEAVES,0,P?SOUTH >STACK
	RSTACK
?L27:	CALL SUB-LEAVES,1,P?EAST >STACK
	RSTACK
?L15:	CALL SUB-NOW-HEADING >STACK
	RSTACK
?L14:	PRINTI "Okay, the "
	PRINTD JOYSTICK
	PRINTI " is now pointing to "
	CALL DIR-PRINT,PRSO
	PRINTI ". But the only way the sub can leave the tank is to "
	CALL DIR-PRINT,DIR
	PRINTR "."

	.FUNCT HATCH-GATE-NOT-READY?,GATE
	FSET? SUB-DOOR,OPENBIT \?L1
	CALL THIS-IS-IT,SUB-DOOR
	PRINTR "You shouldn't leave the tank with the hatch open!"
?L1:	FSET? GATE,OPENBIT /FALSE
	CALL GATE-CRASH,STR?124,JOYSTICK,GATE
	RTRUE

	.FUNCT READY-FOR-SNARK?
	GET ON-SUB,0 >STACK
	EQUAL? BAZOOKA,STACK /?L2
	GET ON-SUB,1 >STACK
	EQUAL? DART,STACK \FALSE
?L2:	RETURN FINE-SONAR

	.FUNCT SUB-LEAVES,FROM-LAB?,DIR
	ZERO? FROM-LAB? /?L1
	SET 'GATE-CRASHED,0
	SET 'SUB-IN-TANK,0
	REMOVE SHARON
	CALL ROB,SHARON,GLOBAL-SHARON
	SET 'ALARM-RINGING,0
	GETPT VIDEOPHONE-2,P?SYNONYM >STACK
	PUT STACK,0,W?ZZZZLG
	CALL QUEUE,I-UPDATE-SUB-POSITION,-1 >STACK
	PUT STACK,0,1
	SET 'MONSTER-GONE,1
	SET 'NOW-TERRAIN,BAY-TERRAIN
	JUMP ?L3
?L1:	SET 'SUB-IN-DOME,0
	SET 'NOW-TERRAIN,SEA-TERRAIN
	SET 'SUB-LON,0
	SET 'SUB-LAT,-1
	SET 'SUB-DEPTH,AIRLOCK-DEPTH
	SET 'TARGET-DEPTH,AIRLOCK-DEPTH
?L3:	ZERO? AUTOMATIC-SONAR /?L4
	CALL SPLIT-SCREEN? >STACK
	ZERO? STACK /?L4
	SET 'SCREEN-NOW-SPLIT,1
	CALL START-SONAR?
?L4:	PRINTI "The "
	PRINTD SUB
	PRINTI " glides smoothly out of the tank "
	ZERO? FROM-LAB? /?L9
	PRINTI "onto the surface of "
	PRINTD BAY
	JUMP ?L13
?L9:	PRINTI "into the ocean"
?L13:	PRINTI ". You're heading "
	CALL DIR-PRINT,DIR,0
	PRINTI " at "
	PRINTN THROTTLE-SETTING
	PRINTI " "
	PRINTD GRID-UNIT
	EQUAL? 1,THROTTLE-SETTING /?L20
	PRINTI "s"
?L20:	PRINTI " per turn."
	CRLF
	ZERO? FROM-LAB? /?L27
	CALL SCORE-OBJ,BAY
	JUMP ?L42
?L27:	FSET? TIP,BUSYBIT \?L30
	CALL I-TIP-REPORTS
?L30:	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK /?L33
	CALL SCORE-OBJ,AIRLOCK
	SET 'LEFT-DOME,MOVES
	CALL QUEUE,I-THORPE-APPEARS,-1 >STACK
	PUT STACK,0,1
	JUMP ?L42
?L33:	CALL TIP-SAYS
	PRINTI "I've got a bad feeling about this. I don't think we should go out there without a "
	ZERO? FINE-SONAR /?L38
	PRINTI "weapon of some kind."""
	CRLF
	JUMP ?L42
?L38:	PRINTD FINE-GRID
	PRINTI "."""
	CRLF
?L42:	CALL SAVE-HINT
	RTRUE

	.FUNCT HEADING-FOR-SEAWALL?,Y-X
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \FALSE
	CALL OBSTACLE-AHEAD?,SUB-DEPTH,SUB-LON,SUB-LAT >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSO,P?NORTH \?L4
	GRTR? SUB-LON,29 \FALSE
	LESS? SUB-LON,35 /TRUE
	RFALSE
?L4:	EQUAL? PRSO,P?EAST \?L8
	GRTR? SUB-LAT,35 \FALSE
	LESS? SUB-LAT,41 /TRUE
	RFALSE
?L8:	EQUAL? PRSO,P?NE \FALSE
	SUB SUB-LAT,SUB-LON >Y-X
	GRTR? Y-X,0 \FALSE
	LESS? Y-X,12 /TRUE
	RFALSE

	.FUNCT SUB-NOW-HEADING
	PRINTI "Okay, the "
	PRINTD SUB
	PRINTI " is "
	EQUAL? JOYSTICK-DIR,PRSO \?L3
	ZERO? SUB-IN-BATTLE \?L5
	INC 'SUB-STILL-HEADING
?L5:	PRINTI "still "
	JUMP ?L10
?L3:	PRINTI "now "
?L10:	ZERO? THROTTLE-SETTING \?L13
	PRINTI "facing"
	JUMP ?L17
?L13:	PRINTI "moving"
?L17:	PRINTI " toward "
	CALL DIR-PRINT,PRSO
	CALL HEADING-FOR-SEAWALL? >STACK
	ZERO? STACK /?L22
	PRINTI ", straight toward the opening in the "
	PRINTD SEA-WALL
?L22:	ZERO? THROTTLE-SETTING \?L27
	CALL THIS-IS-IT,THROTTLE
	PRINTI ". But it won't go that way unless you open the "
	PRINTD THROTTLE
?L27:	PRINTI "."
	CRLF
	EQUAL? SUB-STILL-HEADING,9 \FALSE
	SET 'SUB-STILL-HEADING,0
	PRINTI "(You didn't change the "
	PRINTD SUB
	PRINTI "'s heading. Remember, you don't have to type a "
	PRINTD INTDIR
	PRINTR " every turn if you want to WAIT or do something else.)"

	.FUNCT SUB-DOOR-F
	EQUAL? PRSA,V?CLOSE \?L1
	ZERO? SUB-IN-DOME /?L3
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L3
	PRINTR "It's too soon for that!"
?L3:	CALL SOMEONE-WORKING? >STACK
	ZERO? STACK /?L7
	PRINTR "There are too many people inside."
?L7:	EQUAL? HERE,SUB /?L10
	PRINTI "You should board the "
	PRINTD SUB
	PRINTR " first."
?L10:	LOC TIP >STACK
	EQUAL? STACK,SUB,CRAWL-SPACE /FALSE
	FSET? TIP,BUSYBIT \?L14
	CALL I-TIP-REPORTS
	RFALSE
?L14:	MOVE TIP,SUB
	PRINTI "Tip rushes in just before you close it. ""Wait for me, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"""
	CRLF
	RFALSE
?L1:	EQUAL? PRSA,V?OPEN \FALSE
	GRTR? SUB-DEPTH,0 \?L21
	ZERO? SUB-IN-DOME /?L23
	ZERO? AIRLOCK-FULL /?L21
?L23:	CALL PRINT-ID,STR?125
	CALL YOU-CANT,STR?22,SUB,STR?126 >STACK
	RSTACK
?L21:	ZERO? SUB-IN-OPEN-SEA /?L24
	PRINTR "This is no time for a swim!"
?L24:	EQUAL? HERE,SUB,NORTH-TANK-AREA,AIRLOCK /?L27
	PRINTI "You can't reach"
	CALL THE-PRSO-PRINT
	PRINTR " from here."
?L27:	ZERO? GREENUP-ESCAPE \?L31
	ZERO? GREENUP-TRAPPED /FALSE
?L31:	FSET SUB-DOOR,OPENBIT
	PRINTI "Before the crew can carry out your order, the hatch opens. Greenup rises into view from the pilot's seat and gives himself up. "
	CALL GREENUP-CUFF
	RTRUE

	.FUNCT SUB-WINDOW-F,POP
	EQUAL? PRSA,V?BRUSH \?L1
	CALL ALREADY,SUB-WINDOW,STR?127 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-OUTSIDE,V?LOOK-INSIDE \?L3
	ZERO? SUB-IN-TANK /?L6
	PRINTR "You can see the test tank outside."
?L6:	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L10
	ZERO? SUB-DEPTH \?L11
	PRINTI "Frobton is a busy seaport full of constantly moving pleasure boats, fishing craft and commercial shipping. The biggest ships move in the shipping lanes, but you can dive to 15 meters and go under them. Observe all ""Rules of the Road"", unless you want to submerge. When you're "
	PRINTD UNDERWATER
	PRINTR ", you should avoid shallow areas called shoals."
?L11:	CALL PLENTY-WATER
	RTRUE
?L10:	ZERO? SUB-IN-OPEN-SEA /?L16
	LESS? DISTANCE-FROM-BAY,AQUADOME-VISIBLE /?L17
	PRINTI "You can see the "
	PRINTD AQUADOME
	PRINTR "."
?L17:	FSET? WHALE,INVISIBLE /?L21
	PRINTR "The whale is still following you."
?L21:	FSET? SEARCH-BEAM,ONBIT \?L24
	PRINTI "Your sub's "
	PRINTD SEARCH-BEAM
	PRINTI " lights up the "
	PRINTD GLOBAL-WATER
	PRINTR " outside."
?L24:	CALL PLENTY-WATER
	RTRUE
?L16:	EQUAL? NOW-TERRAIN,SEA-TERRAIN \?L28
	EQUAL? SUB-DEPTH,AIRLOCK-DEPTH \?L28
	MUL SUB-LAT,SUB-LAT >STACK
	MUL SUB-LON,SUB-LON >STACK
	ADD STACK,STACK >STACK
	GRTR? 4,STACK \?L28
	PRINTI "You can see the "
	PRINTD AQUADOME
	PRINTR "."
?L28:	ZERO? SUB-IN-DOME /?L31
	CALL ROOM-PEEK,AIRLOCK
	RTRUE
?L31:	FSET? SNARK,INVISIBLE /?L32
	ZERO? SUB-IN-BATTLE /?L33
	CALL TOO-CLOUDY
	RTRUE
?L33:	PRINTI "You can see the "
	PRINTD SNARK
	PRINTI " and the "
	PRINTD THORPE-SUB
	PRINTI " in the "
	PRINTD SEARCH-BEAM
	PRINTR " beam."
?L32:	CALL PLENTY-WATER
	RTRUE
?L3:	EQUAL? PRSA,V?MUNG \?L39
	PRINTI "Vandalism is for vandals, not famous inventors!"
	CRLF
	CALL PRINT-ID,STR?128 >STACK
	RSTACK
?L39:	EQUAL? PRSA,V?UNLOCK /?L43
	EQUAL? PRSA,V?LOCK,V?CLOSE,V?OPEN \?L42
?L43:	PRINTR "You can't."
?L42:	EQUAL? PRSA,V?STOP \FALSE
	CALL PERFORM,V?LEVEL
	RTRUE

	.FUNCT TOO-CLOUDY
	PRINTI "The "
	PRINTD GLOBAL-WATER
	PRINTR " is too cloudy to see much."

	.FUNCT PLENTY-WATER
	PRINTI "You can see plenty of "
	PRINTD GLOBAL-WATER
	PRINTR "."

	.FUNCT ENGINE-ACCESS-HATCH-F
	EQUAL? PRSA,V?TAKE \?L1
	ZERO? PRSI \FALSE
	CALL PERFORM,V?OPEN,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE-WITH \?L6
	EQUAL? PRSI,UNIVERSAL-TOOL \FALSE
	CALL PERFORM,V?OPEN-WITH,PRSO,PRSI
	RTRUE
?L6:	EQUAL? PRSA,V?OPEN-WITH,V?OPEN \?L10
	EQUAL? PRSO,ENGINE-ACCESS-HATCH \?L10
	IN? WINNER,SUB \?L10
	IN? UNIVERSAL-TOOL,WINNER /?L10
	PRINTR "Suggest you read the stenciled sign."
?L10:	EQUAL? PRSA,V?ANALYZE,V?EXAMINE,V?READ \FALSE
	IN? WINNER,SUB \FALSE
	PRINTI """THIS REQUIRES SPECIAL ULTRA WRENCH FROM SUB TOOL KIT."""
	CRLF
	IN? UNIVERSAL-TOOL,TIP \TRUE
	CALL THIS-IS-IT,UNIVERSAL-TOOL
	CALL TELL-HINT,61,TIP,0
	RTRUE

	.FUNCT CRAWL-SPACE-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	CALL EXIT-VERB? >STACK
	ZERO? STACK /?L3
	MOVE ENGINE,SUB
	RFALSE
?L3:	CALL GAME-VERB? >STACK
	ZERO? STACK \FALSE
	EQUAL? P-ADVERB,W?CAREFULLY /FALSE
	RANDOM 100 >STACK
	GRTR? 20,STACK \?L12
	FSET? ENGINE,ONBIT \?L12
	ZERO? SUB-IN-TANK \?L12
	ZERO? SUB-IN-DOME \?L12
	PRINTI "
Suddenly the "
	PRINTD SUB
	PRINTI " begins to shake violently! Your foot has knocked an engine bearing out of alignment! It will be necessary to surface at once and await rescue! Your mission must be aborted."
	CALL FINISH >STACK
	RSTACK
?L12:	RANDOM 100 >STACK
	GRTR? 20,STACK \FALSE
	FSET? GASH,INVISIBLE \FALSE
	FSET ARM,MUNGBIT
	FCLEAR GASH,INVISIBLE
	PRINTI "There's a sharp pain in your right arm! A flood of wet warmth and a spreading red stain mean you've seriously gashed your arm on a sharp metal corner!"
	CRLF
	CALL PRINT-ID,STR?129
	RFALSE
?L1:	EQUAL? RARG,M-ENTER \?L20
	CALL POPULATION,CRAWL-SPACE,PLAYER >STACK
	ZERO? STACK /?L21
	CALL TOO-CROWDED
	CALL GOTO,SUB >STACK
	RSTACK
?L21:	MOVE ENGINE,CRAWL-SPACE
	RFALSE
?L20:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?FIND \?L25
	EQUAL? HERE,CRAWL-SPACE \?L26
	PRINTR "You're in it!"
?L26:	PRINTI "It's located beyond an "
	PRINTD ENGINE-ACCESS-HATCH
	PRINTR " in the bulkhead just below and to the right of control panel."
?L25:	EQUAL? PRSA,V?LOOK-INSIDE,V?OPEN \?L33
	EQUAL? PRSO,CRAWL-SPACE \FALSE
	CALL PERFORM,PRSA,ENGINE-ACCESS-HATCH,PRSI
	RTRUE
?L33:	EQUAL? PRSA,V?WALK-TO,V?THROUGH \FALSE
	FSET? ENGINE-ACCESS-HATCH,OPENBIT \?L38
	CALL GOTO,CRAWL-SPACE >STACK
	ZERO? STACK /TRUE
	PRINTI "BE CAREFUL: Too much wriggling may pose SERIOUS DANGERS!"
	FSET? ENGINE,ONBIT \?L44
	PRINTI " And wouldn't it be safer to stop the engine first?"
?L44:	CRLF
	RTRUE
?L38:	CALL TOO-BAD-BUT,ENGINE-ACCESS-HATCH,STR?27
	CALL THIS-IS-IT,ENGINE-ACCESS-HATCH
	RETURN 2

	.FUNCT VOLTAGE-REGULATOR-F
	EQUAL? PRSA,V?WALK-TO \?L1
	EQUAL? HERE,CRAWL-SPACE /FALSE
	CALL PERFORM,PRSA,CRAWL-SPACE
	RTRUE
?L1:	EQUAL? PRSA,V?FIND \?L6
	EQUAL? HERE,CRAWL-SPACE \FALSE
	FCLEAR VOLTAGE-REGULATOR,NDESCBIT
	PRINTR "You find it in the middle of some complicated machinery."
?L6:	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \?L12
	FSET? VOLTAGE-REGULATOR,MUNGBIT \FALSE
	PRINTR "It's hard to tell anything by looking at it."
?L12:	EQUAL? PRSA,V?FIX,V?ADJUST \FALSE
	FSET? ARM,MUNGBIT \?L19
	PRINTR "You can't do that since you gashed your arm!"
?L19:	FSET? VOLTAGE-REGULATOR,MUNGBIT /?L23
	CALL ALREADY,VOLTAGE-REGULATOR,STR?130 >STACK
	RSTACK
?L23:	SET 'TEST-BUTTON-READOUT,TEST-BUTTON-NORMAL
	PRINTI "Fixed."
	CRLF
	CALL COOL-BACK
	FCLEAR VOLTAGE-REGULATOR,MUNGBIT
	RTRUE

	.FUNCT COOL-BACK,X
	LESS? 20,CIRCUIT-TEMP \FALSE
	FSET? VOLTAGE-REGULATOR,MUNGBIT \FALSE
	SUB CIRCUIT-TEMP,15 >X
	PRINTI "It will take about "
	PRINTN X
	PRINTI " turn"
	EQUAL? X,1 /?L5
	PRINTI "s"
?L5:	PRINTI " for the "
	PRINTD CONTROL-CIRCUITS
	PRINTR " to cool to a normal operating temperature."

	.FUNCT GET5,TBL5,NUM,NUM1
	SUB NUM,1 >NUM1
	MOD NUM1,5 >STACK
	GET TBL5-SHIFT,STACK >STACK
	DIV NUM1,5 >STACK
	INC 'STACK
	GET TBL5,STACK >STACK
	MOD NUM1,5 >STACK
	GET TBL5-MASK,STACK >STACK
	BAND STACK,STACK >STACK
	DIV STACK,STACK >STACK
	RSTACK

	.FUNCT ADD-WARNING,MSG,RTRUE?=0,TBL,LEN,N,M
	ZERO? RTRUE? /?L1
	SET 'WARNINGS-RTRUE,1
?L1:	SET 'TBL,WARNINGS-THIS-TURN
	GET TBL,0 >STACK
	EQUAL? STACK,WARNINGS-USED /TRUE
	GET TBL,0 >LEN
	SET 'N,0
?L7:	IGRTR? 'N,LEN /TRUE
	GET TBL,N >M
	EQUAL? MSG,M /TRUE
	EQUAL? MSG,5 \?L14
	EQUAL? M,3,9 /TRUE
?L14:	EQUAL? MSG,6 \?L15
	EQUAL? M,4,11 /TRUE
?L15:	EQUAL? MSG,8 \?L16
	EQUAL? M,7 /TRUE
?L16:	GET TBL,N >STACK
	ZERO? STACK \?L7
	PUT TBL,N,MSG
	SET 'WARNINGS-USED,N
	RTRUE

	.FUNCT GIVE-WARNINGS,TBL,LEN,N,MSG,SONAR?=0
	SET 'TBL,WARNINGS-THIS-TURN
	SET 'LEN,WARNINGS-USED
	SET 'N,0
?L1:	IGRTR? 'N,LEN /?L2
	GET TBL,N >MSG
	ZERO? MSG /?L2
	SET 'WARNINGS-USED,0
	PUT TBL,N,0
	ZERO? SUB-IN-OPEN-SEA \?L1
	EQUAL? MSG,1 \?L10
	PRINTI "
A speedboat came out of nowhere and almost hit you! It's dangerous on the surface of the bay."
	CALL PRINT-ID,STR?131
	JUMP ?L65
?L10:	EQUAL? MSG,2 \?L14
	SET 'SONAR?,1
	PRINTI "
If you don't change course or stop, you'll crash!"
	CALL PRINT-ID,STR?132
	JUMP ?L65
?L14:	EQUAL? MSG,3,4 \?L17
	CALL THIS-IS-IT,DEPTHFINDER-LIGHT
	PRINTI "Suddenly a loud "
	PRINTD ALARM-SUB
	PRINTI " begins to ring! The "
	PRINTD DEPTHFINDER-LIGHT
	PRINTI " has begun to glow "
	EQUAL? MSG,3 \?L20
	PUSH STR?133
	JUMP ?L22
?L20:	PUSH STR?134
?L22:	PRINT STACK
	PRINTI "."
	JUMP ?L65
?L17:	EQUAL? MSG,5,6 \?L23
	CALL THIS-IS-IT,ALARM-SUB
	PRINTI "The "
	PRINTD DEPTHFINDER-LIGHT
	PRINTI " is still glowing "
	EQUAL? MSG,5 \?L26
	PUSH STR?133
	JUMP ?L28
?L26:	PUSH STR?134
?L28:	PRINT STACK
	PRINTI ", and the "
	PRINTD ALARM-SUB
	PRINTI " is still ringing."
	JUMP ?L65
?L23:	EQUAL? MSG,7,8 \?L29
	SET 'SONAR?,1
	PRINTI "The "
	PRINTD SONARSCOPE
	EQUAL? MSG,8 \?L32
	CALL THIS-IS-IT,SONARSCOPE
	PRINTI " still"
?L32:	PRINTI " shows an obstacle ahead!"
	EQUAL? MSG,7 \?L65
	CALL THIS-IS-IT,SUB
	PRINTI " Unless you change course, you will crash the "
	PRINTD SUB
	PRINTI "!"
	JUMP ?L65
?L29:	EQUAL? MSG,9,10,11 \?L44
	CALL THIS-IS-IT,ALARM-SUB
	PRINTI "The "
	PRINTD DEPTHFINDER-LIGHT
	PRINTI " "
	EQUAL? MSG,9 \?L47
	PUSH STR?135
	JUMP ?L50
?L47:	EQUAL? MSG,10 \?L49
	PUSH STR?136
	JUMP ?L50
?L49:	PUSH STR?137
?L50:	PRINT STACK
	PRINTI ", and the "
	PRINTD ALARM-SUB
	PRINTI " "
	EQUAL? MSG,9 \?L51
	PUSH STR?138
	JUMP ?L54
?L51:	EQUAL? MSG,10 \?L53
	PUSH STR?139
	JUMP ?L54
?L53:	PUSH STR?140
?L54:	PRINT STACK
	JUMP ?L65
?L44:	EQUAL? MSG,12,13 \?L55
	SET 'SONAR?,1
	CALL THIS-IS-IT,FREIGHTER
	PRINTI "The "
	PRINTD SONARSCOPE-LIGHT
	PRINTI " is flashing yellow! A"
	EQUAL? MSG,13 \?L58
	PRINTI "nother"
?L58:	PRINTI " ship is approaching!"
	JUMP ?L65
?L55:	EQUAL? MSG,14 \?L65
	SET 'SONAR?,1
	PRINTI "
The yellow "
	PRINTD SONARSCOPE-LIGHT
	PRINTI " just turned red! A loud "
	PRINTD ALARM-SUB
	PRINTI " is sending chills up and down your spine! The keel of the approaching ship is visible in your "
	PRINTD SUB-WINDOW
	FSET? HYDROPHONE,ONBIT \?L68
	PRINTI ", and the noise of its screws booms over the "
	PRINTD HYDROPHONE
?L68:	PRINTI "!"
?L65:	CRLF
	JUMP ?L1
?L2:	ZERO? SONAR? /?L76
	ZERO? AUTOMATIC-SONAR \?L76
	ZERO? LOOKED-AT-SONAR \?L76
	CALL THIS-IS-IT,SONARSCOPE
	CALL TIP-SAYS
	PRINTI "Hey, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", maybe you should look at the "
	PRINTD SONARSCOPE
	PRINTI "."""
	CRLF
?L76:	ZERO? WARNINGS-RTRUE /FALSE
	SET 'WARNINGS-RTRUE,0
	RTRUE

	.FUNCT SAVE-HINT
	PRINTR "(This might be a good time to use the command: SAVE.)"

	.FUNCT FALL-FROM-CLAW,NUM,X
	GET ON-SUB,NUM >X
	ZERO? X /FALSE
	PRINTI "You can see"
	CALL PRINTT,X
	PRINTI " fall out of the "
	PRINTD CLAW
	PRINTI " and sink."
	CRLF
	REMOVE X
	RTRUE

	.FUNCT I-UPDATE-SUB-POSITION,LON,LAT,DEP,TH,VAL=0,?TMP
	ZERO? SUB-IN-TANK \FALSE
	LESS? 0,CIRCUIT-TEMP \?L4
	DEC 'CIRCUIT-TEMP
?L4:	FSET? VOLTAGE-REGULATOR,MUNGBIT \?L7
	ADD CIRCUIT-TEMP,THROTTLE-SETTING >CIRCUIT-TEMP
?L7:	LESS? 20,CIRCUIT-TEMP \?L137
	ZERO? CIRCUIT-TIP \?L10
	SET 'CIRCUIT-TIP,1
	MOVE OVERHEATING,GLOBAL-OBJECTS
	CRLF
	PRINTI "Suddenly "
	CALL TIP-SAYS
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! Look at the way that "
	PRINTD CONTROL-CIRCUITS
	PRINTI " "
	PRINTD CONTROL-CIRCUITS-GAUGE
	PRINTI " is rising!"""
	CRLF
	SET 'VAL,1
	JUMP ?L26
?L10:	LESS? 20,CIRCUIT-TEMP /?L16
?L137:	ZERO? CIRCUIT-TIP /?L16
	SET 'CIRCUIT-TIP,0
	JUMP ?L26
?L16:	LESS? 25,CIRCUIT-TEMP /?L138
	ZERO? CIRCUIT-RED /?L17
	SET 'CIRCUIT-RED,0
	EQUAL? HERE,SUB \?L26
	CRLF
	PRINTI "The "
	PRINTD CONTROL-CIRCUITS-GAUGE
	PRINTI " drops below the red danger zone."
	CRLF
	JUMP ?L26
?L17:	LESS? 25,CIRCUIT-TEMP \?L23
?L138:	ZERO? CIRCUIT-RED \?L23
	SET 'CIRCUIT-RED,1
	CRLF
	PRINTI "The "
	PRINTD CONTROL-CIRCUITS-GAUGE
	PRINTI " has entered the red danger zone!
The circuit tester is activated. Push "
	PRINTD TEST-BUTTON
	PRINTI " for readout."
	CRLF
	SET 'TEST-BUTTON-READOUT,REGULATOR-MSG
	SET 'VAL,1
	JUMP ?L26
?L23:	LESS? 30,CIRCUIT-TEMP \?L26
	CRLF
	PRINTI "The "
	PRINTD CONTROL-CIRCUITS-GAUGE
	PRINTI " has gone off the scale!
The engine grinds to a halt. Your mission is finished."
	CALL FINISH
?L26:	ZERO? SUB-IN-DOME /?L30
	RETURN VAL
?L30:	FSET? AUTO-PILOT,ONBIT \?L32
	SET 'TH,THROTTLE-SETTING
?L33:	DLESS? 'TH,0 /?L34
	INC 'DISTANCE-FROM-BAY
	DIV DISTANCE-FROM-BAY,2 >DEP
	SET 'TARGET-DEPTH,DEP
	SET 'SUB-DEPTH,DEP
	EQUAL? DISTANCE-FROM-BAY,20 \?L40
	CALL FALL-FROM-CLAW,0
	CALL FALL-FROM-CLAW,1
	JUMP ?L33
?L40:	EQUAL? DISTANCE-FROM-BAY,30 \?L42
	CRLF
	PRINTI "The ocean has been getting darker as you dive toward the "
	PRINTD AQUADOME
	PRINTI ", turning from blue-green to dark green to a dull gray-green. It's becoming duskier and murkier with every minute."
	CRLF
	JUMP ?L33
?L42:	EQUAL? DISTANCE-FROM-BAY,39 \?L45
	FSET? SEARCH-BEAM,ONBIT /?L46
	FSET SEARCH-BEAM,ONBIT
	CRLF
	PRINTI "A yellow cone of light now illumines the water ahead. The "
	PRINTD SUB
	PRINTI "'s "
	PRINTD SEARCH-BEAM
	PRINTI " was "
	PRINTD AUTOMATIC
	PRINTI "ally switched on by an electronic eye, now that you're too deep for the sun to light the water."
	CRLF
?L46:	CRLF
	PRINTI "Colorful sea life swims through the "
	PRINTD SEARCH-BEAM
	PRINTI " beam: a playful dolphin, a school of herring... Oh, oh! Here comes a hammerhead shark. And now a huge manta ray is gracefully gliding and flapping toward you."
	CRLF
	JUMP ?L33
?L45:	EQUAL? DISTANCE-FROM-BAY,45 \?L53
	MOVE WHALE,SUB
	FSET? HYDROPHONE,ONBIT \?L54
	SET 'WHALE-HEARD,1
	PRINTI "
A crooning noise comes over the "
	PRINTD HYDROPHONE
	PRINTI " loudspeaker, punctuated by sighs and moans and a few weird whistles."
	CRLF
?L54:	EQUAL? HERE,SUB \?L33
	IN? TIP,HERE \?L33
	PRINTI "
""There's a blip on the "
	PRINTD SONARSCOPE
	PRINTI " at three o'clock!"" yells Tip. ""Aim the "
	PRINTD SEARCH-BEAM
	PRINTI " to starboard, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"""
?L53:	EQUAL? DISTANCE-FROM-BAY,50 \?L64
	FSET? VOLTAGE-REGULATOR,MUNGBIT \?L64
	ZERO? CIRCUIT-TIP \?L33
	SET 'CIRCUIT-TEMP,28
	JUMP ?L33
?L64:	EQUAL? DISTANCE-FROM-BAY,AQUADOME-VISIBLE \?L68
	REMOVE WHALE
	FSET WHALE,INVISIBLE
	SET 'BLY-CALLING,1
	CALL THIS-IS-IT,SONARPHONE
	FCLEAR SEARCH-BEAM,ONBIT
	PRINTI "The amazing "
	PRINTD AQUADOME
	PRINTI " looms ahead"
	FSET? SEARCH-BEAM,ONBIT \?L71
	FCLEAR SEARCH-BEAM,ONBIT
	PRINTI ". Your "
	PRINTD SEARCH-BEAM
	PRINTI " switches off since the "
	PRINTD AQUADOME
	PRINTI "'s own"
	JUMP ?L75
?L71:	PRINTI ". Its"
?L75:	PRINTI " bright lights suffuse the "
	PRINTD GLOBAL-WATER
	PRINTI " around it with a glowing radiance.
The "
	PRINTD SONARPHONE
	PRINTR " is ringing."
?L68:	LESS? DISTANCE-FROM-BAY,AQUADOME-DISTANCE /?L33
	SET 'SUB-IN-OPEN-SEA,0
	FCLEAR AUTO-PILOT,ONBIT
	MOVE HORVAK-KEY,HORVAK
	SET 'NOW-TERRAIN,SEA-TERRAIN
	SET 'SUB-LON,0
	SET 'SUB-LAT,-1
	SET 'SUB-DEPTH,AIRLOCK-DEPTH
	SET 'TARGET-DEPTH,AIRLOCK-DEPTH
	SET 'DIVING?,0
	SET 'THROTTLE-SETTING,0
	SET 'JOYSTICK-DIR,P?NORTH
	SET 'SUB-DLON,0
	SET 'SUB-DLAT,1
	SET 'DEPTH-WARNING,0
	FCLEAR DEPTHFINDER,ONBIT
	FSET AIRLOCK-HATCH,OPENBIT
	CRLF
	PRINTI "The "
	PRINTD SUB
	PRINTI " slows to a gentle stop, with engine idling and the "
	PRINTD JOYSTICK
	PRINTI " pointing north. The "
	PRINTD AUTO-PILOT
	PRINTI " has brought you to the "
	PRINTD AIRLOCK
	PRINTI " on the south side of the "
	PRINTD AQUADOME
	PRINTI ". It also turned off the "
	PRINTD DEPTHFINDER
	PRINTI " for you.
At "
	PRINTD BLY
	PRINTI "'s order, the "
	PRINTD AIRLOCK-HATCH
	PRINTI " slides open, but you could have done it by remote control, just as you "
	ZERO? OPENED-GATE-FROM-SUB /?L83
	PRINTI "did "
	JUMP ?L87
?L83:	PRINTI "could have "
?L87:	PRINTI "the "
	PRINTD TANK-GATE
	PRINTI ".
The "
	PRINTD AIRLOCK
	PRINTI " is filling up with tons of "
	PRINTD GLOBAL-WATER
	PRINTI ".
The "
	PRINTD AIRLOCK
	PRINTI " lies north. You can enter it by opening the "
	PRINTD THROTTLE
	PRINTI ". The bottom of the "
	PRINTD AIRLOCK
	PRINTI " has an adjustable plastic cradle, which adjusts to the keel of any submarine."
	CRLF
	RETURN 2
?L34:	RETURN VAL
?L32:	SET 'LON,SUB-LON
	SET 'LAT,SUB-LAT
	SET 'DEP,SUB-DEPTH
	SET 'TH,THROTTLE-SETTING
?L96:	CALL CHANGE-DEPTH,DEP >DEP
	ZERO? TH /?L98
	ADD LON,SUB-DLON >LON
	ADD LAT,SUB-DLAT >LAT
?L98:	CALL COLLISION?,DEP,LON,LAT >STACK
	ZERO? STACK \?L97
	EQUAL? NOW-TERRAIN,SEA-TERRAIN /?L125
	ZERO? DEP \?L104
	RANDOM 100 >STACK
	GRTR? 20,STACK \?L104
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L104
	ZERO? SPEEDBOAT-WARNING-GIVEN? /?L105
	EQUAL? MOVES,SPEEDBOAT-WARNING-GIVEN? /?L105
	CALL GIVE-WARNINGS
	CRLF
	PRINTI "A speedboat came out of nowhere, hit your rudder, and ended your mission. Too bad you were "
	CALL PRINT-ID,STR?141
	ZERO? EVER-SUBMERGED? \?L109
	PRINTI "still "
?L109:	PRINTI "on the surface."
	CALL FINISH
	JUMP ?L125
?L105:	SET 'SPEEDBOAT-WARNING-GIVEN?,MOVES
	CALL ADD-WARNING,1,1
	JUMP ?L125
?L104:	CALL TIME-FOR-FREIGHTER?,DEP,LON,LAT >STACK
	ZERO? STACK /?L117
	EQUAL? JOYSTICK-DIR,P?NORTH \?L118
	SET 'FREIGHTER-LON,LON
	SET 'FREIGHTER-DLON,0
	ADD LAT,SONAR-RANGE >FREIGHTER-LAT
	SET 'FREIGHTER-DLAT,-1
	JUMP ?L121
?L118:	EQUAL? JOYSTICK-DIR,P?EAST \?L120
	ADD LON,SONAR-RANGE >FREIGHTER-LON
	SET 'FREIGHTER-DLON,-1
	SET 'FREIGHTER-LAT,LAT
	SET 'FREIGHTER-DLAT,0
	JUMP ?L121
?L120:	ADD LON,SONAR-RANGE >FREIGHTER-LON
	SET 'FREIGHTER-DLON,-1
	ADD LAT,SONAR-RANGE >FREIGHTER-LAT
	SET 'FREIGHTER-DLAT,-1
?L121:	GET NOW-TERRAIN,FREIGHTER-LAT >STACK
	CALL GET5,STACK,FREIGHTER-LON >STACK
	LESS? 1,STACK \?L125
	CALL FREIGHTER-WARNING
	JUMP ?L125
?L117:	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L125
	EQUAL? LON,7 \?L127
	EQUAL? LAT,15 /?L126
?L127:	EQUAL? LON,13 \?L128
	EQUAL? LAT,17 /?L126
?L128:	EQUAL? LON,16 \?L125
	EQUAL? LAT,31 \?L125
?L126:	PRINTI "A submerged wreck on the floor of the bay to starboard will be cleared safely."
	CRLF
?L125:	CALL CHECK-FOR-OBSTACLE,DEP,LON,LAT
	DLESS? 'TH,1 \?L96
?L97:	SET 'SUB-LON,LON
	SET 'SUB-LAT,LAT
	SET 'SUB-DEPTH,DEP
	CALL GIVE-WARNINGS >?TMP
	ZERO? ?TMP /?L136
	RETURN ?TMP
?L136:	RETURN VAL

	.FUNCT TIME-FOR-FREIGHTER?,DEP,LON,LAT
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \FALSE
	FSET? FREIGHTER,INVISIBLE \FALSE
	LESS? DEP,3 \FALSE
	GET NOW-TERRAIN,LAT >STACK
	CALL GET5,STACK,LON >STACK
	EQUAL? 5,STACK \FALSE
	CALL OBSTACLE-AHEAD?,SUB-DEPTH,SUB-LON,SUB-LAT >STACK
	ZERO? STACK \FALSE
	EQUAL? JOYSTICK-DIR,P?NE,P?EAST /TRUE
	EQUAL? JOYSTICK-DIR,P?NORTH \FALSE
	EQUAL? SUB-LON,SPIRE-LON \TRUE
	RFALSE

	.FUNCT CHECK-FOR-OBSTACLE,DEP,LON,LAT,X
	CALL OBSTACLE-AHEAD?,DEP,LON,LAT >X
	ZERO? X /?L1
	ZERO? OLD-OBSTACLE? /?L3
	GRTR? X,THROTTLE-SETTING /?L5
	SET 'SONAR-WARNING,SONAR-RED
	CALL ADD-WARNING,2,1 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?WAIT-UNTIL,V?WAIT-FOR /FALSE
	CALL ADD-WARNING,8 >STACK
	RSTACK
?L3:	SET 'OLD-OBSTACLE?,1
	GRTR? X,THROTTLE-SETTING /?L10
	SET 'SONAR-WARNING,SONAR-RED
	JUMP ?L12
?L10:	SET 'SONAR-WARNING,SONAR-YELLOW
?L12:	CALL ADD-WARNING,7,1 >STACK
	RSTACK
?L1:	SET 'OLD-OBSTACLE?,0
	ZERO? SONAR-WARNING /FALSE
	SET 'SONAR-WARNING,0
	ZERO? SHIP-WARNING \FALSE
	PRINTI "The "
	PRINTD SONARSCOPE-LIGHT
	PRINTR " goes out."

	.FUNCT OBSTACLE-AHEAD?,DEP,LON,LAT,XLON,XLAT,RANGE,X
	EQUAL? NOW-TERRAIN,BAY-TERRAIN,SEA-TERRAIN \FALSE
	ADD LON,SUB-DLON >XLON
	ADD LAT,SUB-DLAT >XLAT
	SET 'RANGE,1
?L4:	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L6
	CALL TOO-DEEP?,DEP,XLON,XLAT >X
	EQUAL? X,0,OPEN-SEA-CODE /?L6
	RETURN RANGE
?L6:	EQUAL? NOW-TERRAIN,SEA-TERRAIN \?L11
	CALL DOME-ON-SONAR?,DEP,XLON,XLAT >STACK
	ZERO? STACK /?L11
	CALL HEADING-INTO-DOME?,SUB-DEPTH,SUB-LON,SUB-LAT >STACK
	ZERO? STACK /?L5
?L11:	IGRTR? 'RANGE,SONAR-RANGE /FALSE
	ADD XLON,SUB-DLON >XLON
	ADD XLAT,SUB-DLAT >XLAT
	JUMP ?L4
?L5:	RETURN RANGE

	.FUNCT HEADING-INTO-DOME?,DEP,LON,LAT
	EQUAL? DEP,AIRLOCK-DEPTH \FALSE
	ZERO? LON \FALSE
	LESS? LAT,1 \FALSE
	ZERO? SUB-DLON \FALSE
	LESS? 0,SUB-DLAT \FALSE
	FSET? AIRLOCK-HATCH,OPENBIT \FALSE
	RTRUE

	.FUNCT CHANGE-DEPTH,DEP
	LESS? DEP,TARGET-DEPTH \?L1
	CALL DIVE-DESC,DEP,1
	INC 'DEP
	RETURN DEP
?L1:	GRTR? DEP,TARGET-DEPTH \?L3
	CALL DIVE-DESC,DEP,0
	DEC 'DEP
	RETURN DEP
?L3:	ZERO? DIVING? /?L4
	SET 'DIVING?,0
	PRINTI "The "
	PRINTD SUB
	PRINTI " quickly levels out at the "
	ZERO? DEP \?L7
	PRINTI "surface."
	JUMP ?L11
?L7:	PRINTI "desired depth of "
	MUL 5,DEP >STACK
	PRINTN STACK
	PRINTI " meters."
?L11:	ZERO? THROTTLE-SETTING \?L14
	PRINTI " It's now standing still in the water."
	JUMP ?L18
?L14:	PRINTI " It's still moving toward "
	CALL DIR-PRINT,JOYSTICK-DIR
	PRINTI " at a speed of "
	PRINTN THROTTLE-SETTING
	PRINTI " "
	PRINTD GRID-UNIT
	EQUAL? 1,THROTTLE-SETTING /?L23
	PRINTI "s"
?L23:	PRINTI " per turn."
?L18:	CRLF
?L4:	RETURN DEP

	.FUNCT DIVE-DESC,DEP,DOWN?
	ZERO? DEP \FALSE
	PRINTI "The "
	PRINTD GLOBAL-WATER
	PRINTI " darkens to a deeper green as you descend from the sunlit surface."
	FSET? HYDROPHONE,ONBIT \?L5
	PRINTI " Engine and propeller noises come over the "
	PRINTD HYDROPHONE
	PRINTI " loudspeaker."
?L5:	CRLF
	RTRUE

	.FUNCT SEA-WALL-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL TOO-FAR-AWAY,SEA-WALL >STACK
	RSTACK

	.FUNCT FREIGHTER-F
	EQUAL? PRSA,V?ANALYZE,V?EXAMINE \FALSE
	CALL FREIGHTER-SIZE >STACK
	RSTACK

	.FUNCT FREIGHTER-SIZE
	PRINTI "Sonar shows the object reaching from the surface of the bay downward to a depth of 10 meters. This must be the keel of a freighter entering the harbor. It's moving toward the waterfront at the rate of 1 "
	PRINTD GRID-UNIT
	PRINTR " per turn."

	.FUNCT FREIGHTER-WARNING
	FCLEAR FREIGHTER,INVISIBLE
	CALL QUEUE,I-UPDATE-FREIGHTER,-1 >STACK
	PUT STACK,0,1
	INC 'FREIGHTER-COUNT
	SET 'SHIP-WARNING,SONAR-YELLOW
	EQUAL? 1,FREIGHTER-COUNT \?L1
	CALL ADD-WARNING,12,1 >STACK
	RSTACK
?L1:	CALL ADD-WARNING,13,1 >STACK
	RSTACK

	.FUNCT I-UPDATE-FREIGHTER,DLAT,DLON
	ADD FREIGHTER-LON,FREIGHTER-DLON >FREIGHTER-LON
	ADD FREIGHTER-LAT,FREIGHTER-DLAT >FREIGHTER-LAT
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L3
	SUB FREIGHTER-LAT,SUB-LAT >DLAT
	LESS? DLAT,0 \?L4
	SUB FREIGHTER-LAT,SUB-LAT >DLAT
	SUB 0,DLAT >STACK
	JUMP ?L6
?L4:	SUB FREIGHTER-LAT,SUB-LAT >DLAT
	PUSH DLAT
?L6:	LESS? SONAR-RANGE,STACK /?L3
	SUB FREIGHTER-LON,SUB-LON >DLON
	LESS? DLON,0 \?L7
	SUB FREIGHTER-LON,SUB-LON >DLON
	SUB 0,DLON >STACK
	JUMP ?L9
?L7:	SUB FREIGHTER-LON,SUB-LON >DLON
	PUSH DLON
?L9:	LESS? SONAR-RANGE,STACK /?L3
	GET NOW-TERRAIN,FREIGHTER-LAT >STACK
	CALL GET5,STACK,FREIGHTER-LON >STACK
	GRTR? 2,STACK \?L1
?L3:	CALL QUEUE,I-UPDATE-FREIGHTER,0
	FSET FREIGHTER,INVISIBLE
	RFALSE
?L1:	ZERO? DLAT \?L10
	ZERO? DLON \?L10
	LESS? SUB-DEPTH,3 \?L11
	CALL FREIGHTER-COLLIDED
	CALL FINISH >STACK
	RSTACK
?L10:	LESS? SUB-DEPTH,3 \?L11
	EQUAL? JOYSTICK-DIR,P?NORTH \?L13
	ZERO? DLON \?L13
	GRTR? DLAT,0 /?L12
?L13:	EQUAL? JOYSTICK-DIR,P?EAST \?L14
	ZERO? DLAT \?L14
	GRTR? DLON,0 /?L12
?L14:	EQUAL? JOYSTICK-DIR,P?NE \?L11
	EQUAL? DLON,DLAT \?L11
	GRTR? DLAT,0 \?L11
?L12:	EQUAL? JOYSTICK-DIR,P?NORTH \?L19
	LESS? DLAT,THROTTLE-SETTING /?L22
	EQUAL? DLAT,THROTTLE-SETTING /?L22
	ZERO? THROTTLE-SETTING \?L19
	LESS? DLAT,2 /?L22
?L19:	EQUAL? JOYSTICK-DIR,P?EAST \?L21
	LESS? DLON,THROTTLE-SETTING /?L22
	EQUAL? DLON,THROTTLE-SETTING /?L22
	ZERO? THROTTLE-SETTING \?L21
	LESS? DLON,2 /?L22
?L21:	EQUAL? JOYSTICK-DIR,P?NE \?L15
	LESS? DLAT,THROTTLE-SETTING /?L22
	EQUAL? DLAT,THROTTLE-SETTING /?L22
	ZERO? THROTTLE-SETTING \?L15
	LESS? DLAT,2 \?L15
?L22:	EQUAL? SHIP-WARNING,SONAR-RED \?L23
	CALL TELL-SONAR-WARNING,SHIP-WARNING >STACK
	RSTACK
?L23:	SET 'SHIP-WARNING,SONAR-RED
	CALL ADD-WARNING,14,1 >STACK
	RSTACK
?L15:	ZERO? SHIP-WARNING /FALSE
	CALL TELL-SONAR-WARNING,SHIP-WARNING >STACK
	RSTACK
?L11:	ZERO? SHIP-WARNING /FALSE
	ZERO? SONAR-WARNING \FALSE
	PRINTI "The "
	PRINTD SONARSCOPE-LIGHT
	PRINTI " goes out and your heartbeat gradually slows to normal"
	EQUAL? SHIP-WARNING,SONAR-RED \?L31
	PRINTI ", now that the noise from the "
	PRINTD ALARM-SUB
	PRINTI " and the ship have gone"
?L31:	SET 'SHIP-WARNING,0
	PRINTR "."

	.FUNCT DOME-ON-SONAR?,DEP,LON,LAT,HYPOT,X
	LESS? 1,LON /FALSE
	LESS? 1,LAT /FALSE
	GRTR? -1,LON /FALSE
	GRTR? -1,LAT /FALSE
	SUB SEA-DEPTH,DEP >X
	LESS? 2,X /FALSE
	ZERO? FINE-SONAR /?L7
	MUL LAT,LAT >STACK
	MUL LON,LON >STACK
	ADD STACK,STACK >HYPOT
	ADD X,HYPOT >STACK
	GRTR? 3,STACK \FALSE
	RTRUE
?L7:	ZERO? LON \FALSE
	ZERO? LAT \FALSE
	RTRUE

	.FUNCT FREIGHTER-COLLIDED
	PRINTI "
You and Tip are hurled from your seats as the "
	PRINTD SUB
	PRINTI " and the ship collide! The sub is up-ended and swept aside by the momentum of the ship. Thanks to the strength of your revolutionary hull design, the "
	PRINTD SUB
	PRINTI " is still okay, but its machinery is hopelessly damaged.

Because you didn't change heading or dive under the ship, you and Tip are now adrift and must wait to be rescued by"
	CALL PRINT-ID,STR?142
	CALL RESEARCH-LAB
	PRINTI ". Your mission to save the "
	PRINTD AQUADOME
	PRINTI " and its crew from attack by the "
	PRINTD GLOBAL-SNARK
	PRINTI " will have to be abandoned."
	RTRUE

	.FUNCT SONAR-TO-MANUAL
	ZERO? AUTOMATIC-SONAR /FALSE
	CALL SPLIT-SCREEN? >STACK
	ZERO? STACK /FALSE
	SET 'AUTOMATIC-SONAR,0
	SET 'SCREEN-NOW-SPLIT,0
	SPLIT 0
	CALL INT,I-SHOW-SONAR >STACK
	PUT STACK,0,0
	PRINTI "The "
	PRINTD SONARSCOPE
	PRINTI " "
	PRINTD AUTOMATIC
	PRINTR "ally sets itself to manual."

	.FUNCT COLLISION?,DEP,LON,LAT,X
	ZERO? SUB-IN-OPEN-SEA \FALSE
	FSET? SNARK,INVISIBLE /?L3
	CALL THORPE-POS?,LON,LAT >STACK
	ZERO? STACK /?L4
	PRINTI "
CRR-R-RAAASSSHHH-H-H!

With a deafening clang, the "
	PRINTD THORPE-SUB
	PRINTI " and your sub collide! The "
	PRINTD SUB
	PRINTI " shudders, and you and Tip are hurled to the deck!
You claw your way to the controls, but there's no power, no matter how you gun the throttle! The engine's been damaged by the collision!
"
	CALL PRINT-ID,STR?143
	FSET? THORPE,MUNGBIT /?L8
	PRINTI "Through the "
	PRINTD SUB-WINDOW
	PRINTI " you see the "
	PRINTD THORPE-SUB
	PRINTI ", and it looks helpless too. Its hull is intact, but . . . UH-OH! Its rocket weapon is swinging slowly in your direction!
"
?L8:	PRINTI "As you and Tip eye each other despairingly, one thing's for sure: THE ADVENTURE'S OVER!"
	JUMP ?L34
?L4:	CALL SNARK-POS?,LON,LAT >STACK
	ZERO? STACK /FALSE
	PRINTI "There's a sudden jolt! Your "
	PRINTD SUB
	PRINTI " stops moving for a moment, as if you hit some huge mass. Tip looks "
	CALL PRINT-ID,STR?144
	FSET? SONARSCOPE,ONBIT \?L18
	PRINTI "at the "
	PRINTD SONARSCOPE
	JUMP ?L22
?L18:	PRINTI "out the "
	PRINTD SUB-WINDOW
?L22:	PRINTI " and gulps, ""We've rammed the "
	PRINTD SNARK
	FSET? CLAW,MUNGBIT \?L27
	PRINTI " again!"""
	CRLF
	RFALSE
?L27:	FSET CLAW,MUNGBIT
	SET 'TEST-BUTTON-READOUT,CLAW-MUNGED-MSG
	PRINTI "! I hope the "
	PRINTD CLAW
	PRINTI "s aren't damaged!"""
	CRLF
	RFALSE
?L34:	CALL FINISH
	JUMP ?L35
?L3:	FSET? FREIGHTER,INVISIBLE /?L35
	EQUAL? FREIGHTER-LAT,LAT \?L35
	EQUAL? FREIGHTER-LON,LON \?L35
	LESS? DEP,3 \?L35
	CALL FREIGHTER-COLLIDED
	CALL FINISH
?L35:	CALL TOO-DEEP?,DEP,LON,LAT >X
	ZERO? X /?L37
	EQUAL? X,HIT-BOTTOM-CODE,HIT-SHORE-CODE \?L39
	ZERO? SCREEN-NOW-SPLIT /?L41
	SCREEN 1
	CALL SHOW-SONARSCOPE
	SCREEN 0
?L41:	PRINTI "
Suddenly you're thrown out of your seat by a thunderous crash, and the "
	PRINTD SUB
	PRINTI " comes to a shuddering halt!
"
	CALL TIP-SAYS
	PRINTI "Skipper! You've plowed into the "
	EQUAL? LON,SPIRE-LON \?L48
	EQUAL? LAT,SPIRE-LAT \?L48
	PRINTI "rock spire"
	JUMP ?L62
?L48:	EQUAL? X,HIT-SHORE-CODE \?L52
	PRINTI "shore"
	JUMP ?L62
?L52:	PRINTI "floor of the "
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L58
	PRINTI "bay"
	JUMP ?L62
?L58:	PRINTI "ocean"
?L62:	PRINTI "! Jumpin' jets, let's hope your new "
	PRINTD SUB
	PRINTI " isn't wrecked!""
Unfortunately, the "
	PRINTD SUB
	PRINTI " is now disabled. You must call"
	CALL RESEARCH-LAB
	PRINTI " for help, and the situation forces you to abandon hope of saving the "
	PRINTD AQUADOME
	PRINTI " from attacks by the "
	PRINTD SNARK
	PRINTI "."
	CALL PRINT-ID,STR?145
	JUMP ?L77
?L39:	EQUAL? X,OPEN-SEA-CODE \?L69
	SET 'NOW-TERRAIN,0
	SET 'SUB-IN-OPEN-SEA,1
	FCLEAR CATALYST-CAPSULE,TAKEBIT
	FSET CATALYST-CAPSULE,TRYTAKEBIT
	MOVE BLACK-BOX,BLY-DESK
	SET 'DEPTH-WARNING,0
	SET 'SONAR-WARNING,0
	SET 'SHIP-WARNING,0
	FSET FREIGHTER,INVISIBLE
	CALL THIS-IS-IT,AUTO-PILOT
	PRINTI "You have just passed through the opening in the "
	PRINTD SEA-WALL
	PRINTI " across the mouth of "
	PRINTD BAY
	PRINTI ", and you're now in the "
	PRINTD SEA
	PRINTI "."
	CRLF
	CALL QUEUE,I-AUTO-PILOT,1 >STACK
	PUT STACK,0,1
	CALL SONAR-TO-MANUAL
	CALL SCORE-OBJ,SEA-WALL
	CALL SAVE-HINT
	RETURN 2
?L69:	EQUAL? X,HIT-DOME-CODE \?L74
	PRINTI "Oh, oh! The "
	PRINTD SUB
	PRINTI " has crashed into the "
	PRINTD AQUADOME
	PRINTI "!
""We've cracked the dome, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"" gulps Tip as he surveys the damage.
You're speechless. The "
	PRINTD AQUADOME
	PRINTI " is flooding fast, and soon it will break apart under zillions of tons of "
	PRINTD GLOBAL-WATER
	PRINTI "!
You try to shut out the scattered screams for help coming over the sonarphone.

There's nothing left but to report that the "
	PRINTD AQUADOME
	PRINTI " was accidentally destroyed, and your mission has failed."
	CALL PRINT-ID,STR?146
	JUMP ?L77
?L74:	EQUAL? X,IN-DOME-CODE \?L77
	SET 'NOW-TERRAIN,0
	SET 'SUB-IN-DOME,1
	SET 'BLY-CALLING,0
	CALL PHONE-OFF
	CALL SONAR-TO-MANUAL
	SET 'THROTTLE-SETTING,0
	SET 'SHIP-WARNING,0
	SET 'SONAR-WARNING,0
	SET 'DEPTH-WARNING,0
	PRINTI "
The "
	PRINTD SUB
	PRINTI " is now resting in the cradle in the rectangular "
	PRINTD AIRLOCK
	PRINTI ". The "
	PRINTD AIRLOCK-HATCH
	PRINTI " closes, and so does the "
	PRINTD THROTTLE
	PRINTI ".
Through the "
	PRINTD SUB-WINDOW
	PRINTI " you can see the water level going down inside the "
	PRINTD AIRLOCK
	PRINTI ". The docking crew is pumping out the "
	PRINTD GLOBAL-WATER
	PRINTI ". This will take 1 turn."
	CRLF
	FCLEAR AIRLOCK-HATCH,OPENBIT
	CALL QUEUE,I-THORPE-APPEARS,0
	CALL QUEUE,I-AIRLOCK-EMPTY,1 >STACK
	PUT STACK,0,1
	CALL SCORE-OBJ,AQUADOME
	RTRUE
?L77:	CALL FINISH >STACK
	RSTACK
?L37:	FSET? DEPTHFINDER,ONBIT \FALSE
	CALL CHECK-DEPTH,DEP,LON,LAT >STACK
	ZERO? STACK \FALSE
	ZERO? DEPTH-WARNING /FALSE
	SET 'DEPTH-WARNING,0
	CALL ADD-WARNING,10
	RFALSE

	.FUNCT TOO-DEEP?,DEP,LON,LAT,X
	EQUAL? NOW-TERRAIN,SEA-TERRAIN \?L1
	CALL HEADING-INTO-DOME?,DEP,LON,LAT >STACK
	ZERO? STACK /?L3
	ZERO? FINE-SONAR /?L6
	GRTR? LAT,-2 /?L5
?L6:	ZERO? LAT \?L3
?L5:	RETURN IN-DOME-CODE
?L3:	CALL DOME-ON-SONAR?,DEP,LON,LAT >STACK
	ZERO? STACK /?L7
	RETURN HIT-DOME-CODE
?L7:	EQUAL? DEP,SEA-DEPTH \FALSE
	RETURN HIT-BOTTOM-CODE
?L1:	GET NOW-TERRAIN,LAT >STACK
	CALL GET5,STACK,LON >X
	EQUAL? X,6 \?L11
	RETURN OPEN-SEA-CODE
?L11:	LESS? DEP,X /FALSE
	ZERO? X \?L14
	RETURN HIT-SHORE-CODE
?L14:	RETURN HIT-BOTTOM-CODE

	.FUNCT GATE-CRASH,STR,OBJ,GATE
	EQUAL? GATE,AIRLOCK-HATCH \?L1
	PRINTI "You can't leave the "
	PRINTD AIRLOCK
	PRINTI " with the "
	PRINTD AIRLOCK-HATCH
	PRINTR " closed!"
?L1:	SET 'GATE-CRASHED,1
	FCLEAR ENGINE,ONBIT
	SET 'TEST-BUTTON-READOUT,GATE-CRASHED-MSG
	PRINTI "As you "
	PRINT STR
	CALL PRINTT,OBJ
	PRINTI ", you hear a loud boom! The "
	PRINTD SUB
	PRINTI " shivers. You have crashed into the Repelatron Safety Bumper on the "
	PRINTD TANK-GATE
	PRINTI ". The turbine stops "
	PRINTD AUTOMATIC
	PRINTI "ally. Too bad the gate was closed!"
	CRLF
	CALL PRINT-ID,STR?147 >STACK
	RSTACK

	.FUNCT CAPSULE-LEVER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL PERFORM,PRSA,REACTOR
	RTRUE
?L1:	EQUAL? PRSA,V?USE,V?PUSH,V?MOVE \FALSE
	FSET? REACTOR,ONBIT \?L4
	PRINT I-ASSUME
	PRINTI " turn off the "
	PRINTD REACTOR
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?LAMP-OFF,REACTOR
	RTRUE
?L4:	PRINT I-ASSUME
	PRINTI " turn on the "
	PRINTD REACTOR
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?LAMP-ON,REACTOR
	RTRUE

	.FUNCT DEPTHFINDER-F,N
	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	ZERO? SUB-IN-TANK /?L3
	CALL WHY-NEED,DEPTHFINDER,TEST-TANK >STACK
	ZERO? STACK \TRUE
?L3:	ZERO? SUB-IN-DOME /?L4
	CALL WHY-NEED,DEPTHFINDER,AIRLOCK >STACK
	ZERO? STACK \TRUE
?L4:	EQUAL? PRSA,V?LAMP-OFF \?L5
	SET 'DEPTH-WARNING,0
	RFALSE
?L5:	EQUAL? PRSA,V?LAMP-ON \?L6
	CALL CHECK-DEPTH,SUB-DEPTH,SUB-LON,SUB-LAT
	RFALSE
?L6:	EQUAL? PRSA,V?READ /?L8
	EQUAL? PRSA,V?WHAT,V?EXAMINE,V?ANALYZE \FALSE
?L8:	FSET? DEPTHFINDER,ONBIT /?L9
	PRINTR "It's not on!"
?L9:	PRINTI "You're now "
	ZERO? SUB-DEPTH \?L16
	PRINTI "on the surface"
	JUMP ?L20
?L16:	PRINTI "at a depth of "
	MUL 5,SUB-DEPTH >STACK
	PRINTN STACK
	PRINTI " meters"
?L20:	ZERO? NOW-TERRAIN \?L23
	PRINTR "."
?L23:	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L28
	GET NOW-TERRAIN,SUB-LAT >STACK
	CALL GET5,STACK,SUB-LON >STACK
	JUMP ?L30
?L28:	PUSH SEA-DEPTH
?L30:	SUB STACK,SUB-DEPTH >N
	PRINTI ", "
	MUL 5,N >STACK
	PRINTN STACK
	PRINTI " meters above the "
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L33
	PRINTR "floor of the bay."
?L33:	PRINTR "bottom of the sea."

	.FUNCT CHECK-DEPTH,DEP,LON,LAT
	ZERO? DEP /FALSE
	ADD 1,DEP >STACK
	CALL TOO-DEEP?,STACK,LON,LAT >STACK
	ZERO? STACK /?L1
	EQUAL? DEPTH-WARNING,DEPTH-ORANGE \?L3
	CALL ADD-WARNING,11,1
	JUMP ?L9
?L3:	EQUAL? DEPTH-WARNING,DEPTH-RED \?L5
	EQUAL? PRSA,V?WAIT-UNTIL,V?WAIT-FOR /?L9
	CALL ADD-WARNING,DEPTH-RED
	JUMP ?L9
?L5:	CALL ADD-WARNING,4,1
?L9:	SET 'DEPTH-WARNING,DEPTH-RED
	RTRUE
?L1:	ZERO? DEP /FALSE
	ADD 2,DEP >STACK
	CALL TOO-DEEP?,STACK,LON,LAT >STACK
	ZERO? STACK /FALSE
	EQUAL? DEPTH-WARNING,DEPTH-ORANGE \?L11
	EQUAL? PRSA,V?WAIT-UNTIL,V?WAIT-FOR /?L17
	CALL ADD-WARNING,DEPTH-ORANGE
	JUMP ?L17
?L11:	EQUAL? DEPTH-WARNING,DEPTH-RED \?L16
	CALL ADD-WARNING,9
	JUMP ?L17
?L16:	CALL ADD-WARNING,3,1
?L17:	SET 'DEPTH-WARNING,DEPTH-ORANGE
	RTRUE

	.FUNCT DEPTHFINDER-LIGHT-F
	EQUAL? PRSA,V?REPLY /?L3
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
?L3:	ZERO? DEPTH-WARNING \?L4
	PRINTI "The "
	PRINTD DEPTHFINDER-LIGHT
	PRINTI " is off."
	CRLF
?L4:	PRINTI "During a dive, the "
	PRINTD DEPTHFINDER-LIGHT
	PRINTI " turns orange and a "
	PRINTD ALARM-SUB
	PRINTI " sounds if the "
	PRINTD SUB
	PRINTI " comes within 10 meters of the bottom.
The light turns red and the "
	PRINTD ALARM-SUB
	PRINTI " becomes louder if the "
	PRINTD SUB
	PRINTR " comes within 5 meters of the bottom."

	.FUNCT TELL-SONAR-WARNING,W=0
	PRINTI "The "
	PRINTD SONARSCOPE-LIGHT
	PRINTI " continues to glow "
	ZERO? W \?L3
	SET 'W,SONAR-WARNING
?L3:	EQUAL? W,1 \?L6
	PRINTR "yellow."
?L6:	PRINTI "red, and the "
	PRINTD ALARM-SUB
	PRINTR " also continues to sound."

	.FUNCT AUTOMATIC-F
	EQUAL? PRSA,V?LAMP-OFF,V?LAMP-ON \FALSE
	CALL PERFORM,PRSA,AUTO-PILOT
	RTRUE

	.FUNCT MANUAL-F
	EQUAL? PRSA,V?LAMP-ON \?L1
	CALL PERFORM,V?LAMP-OFF,AUTO-PILOT
	RTRUE
?L1:	EQUAL? PRSA,V?LAMP-OFF \?L3
	CALL PERFORM,V?LAMP-ON,AUTO-PILOT
	RTRUE
?L3:	EQUAL? PRSA,V?TURN,V?OPEN,V?TAKE /?L5
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
?L5:	PRINTR "It's not that kind of manual."

	.FUNCT NOT-AVAILABLE
	PRINTI "Sorry, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR ", but that feature isn't available."

	.FUNCT SONARSCOPE-F,DEP,N
	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?LAMP-ON \?L3
	CALL SPLIT-SCREEN? >STACK
	ZERO? STACK /FALSE
	FSET SONARSCOPE,ONBIT
	CALL PERFORM,V?SET,SONARSCOPE,AUTOMATIC
	RTRUE
?L3:	FSET? SONARSCOPE,ONBIT /?L9
	CALL THIS-IS-IT,SONARSCOPE
	PRINTR "It's not turned on!"
?L9:	EQUAL? PRSA,V?LAMP-OFF \?L12
	ZERO? AUTOMATIC-SONAR /FALSE
	CALL PERFORM,V?SET,SONARSCOPE,MANUAL
	SET 'AUTOMATIC-SONAR,0
	RTRUE
?L12:	ZERO? SUB-IN-TANK /?L16
	CALL WHY-NEED,SONARSCOPE,TEST-TANK >STACK
	ZERO? STACK \TRUE
?L16:	ZERO? SUB-IN-OPEN-SEA /?L17
	CALL WHY-NEED,SONARSCOPE,SEA >STACK
	ZERO? STACK \TRUE
?L17:	ZERO? SUB-IN-DOME /?L18
	CALL WHY-NEED,SONARSCOPE,AIRLOCK >STACK
	ZERO? STACK \TRUE
?L18:	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE /?L20
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \?L19
?L20:	SET 'P-WON,0
	INC 'LOOKED-AT-SONAR
	CALL SPLIT-SCREEN? >STACK
	ZERO? STACK /?L21
	MOD LOOKED-AT-SONAR,4 >STACK
	ZERO? STACK \?L21
	CALL TIP-SAYS
	PRINTI "You wouldn't have to keep looking at the "
	PRINTD SONARSCOPE
	PRINTI " if you set it to "
	PRINTD AUTOMATIC
	PRINTI "."""
	CRLF
?L21:	SET 'DEP,SUB-DEPTH
	ZERO? SONAR-WARNING /?L26
	CALL TELL-SONAR-WARNING
?L26:	ZERO? SHIP-WARNING /?L29
	CALL TELL-SONAR-WARNING,SHIP-WARNING
?L29:	LESS? DEP,3 \?L32
	FSET? FREIGHTER,INVISIBLE /?L32
	CALL FREIGHTER-SIZE
	CRLF
?L32:	CALL FIXED-FONT-ON
	PRINTI "(+=you, .=open water, *=obstacle)"
	CRLF
	SET 'N,10
?L37:	PRINTI "--"
	DLESS? 'N,0 \?L37
	CRLF
	ZERO? SCREEN-NOW-SPLIT /?L44
	CALL FIXED-FONT-OFF
	CALL ALREADY,PLAYER,STR?148
	RTRUE
?L44:	CALL SHOW-SONARSCOPE
	RTRUE
?L19:	EQUAL? PRSA,V?MOVE-DIR,V?PUT,V?SET \FALSE
	EQUAL? PRSO,SONARSCOPE \FALSE
	EQUAL? PRSI,AUTOMATIC \?L48
	ZERO? AUTOMATIC-SONAR /?L50
	CALL ALREADY,SONARSCOPE,STR?149 >STACK
	RSTACK
?L50:	CALL SPLIT-SCREEN? >STACK
	ZERO? STACK /?L52
	SET 'AUTOMATIC-SONAR,1
	SET 'SCREEN-NOW-SPLIT,1
	CALL START-SONAR?
	CALL OKAY,SONARSCOPE,STR?149 >STACK
	RSTACK
?L52:	CALL NOT-AVAILABLE >STACK
	RSTACK
?L48:	EQUAL? PRSI,MANUAL \FALSE
	ZERO? AUTOMATIC-SONAR \?L55
	CALL ALREADY,SONARSCOPE,STR?150 >STACK
	RSTACK
?L55:	CALL SPLIT-SCREEN? >STACK
	ZERO? STACK /?L57
	SET 'AUTOMATIC-SONAR,0
	SET 'SCREEN-NOW-SPLIT,0
	SPLIT 0
	CALL INT,I-SHOW-SONAR >STACK
	PUT STACK,0,0
	CALL OKAY,SONARSCOPE,STR?150 >STACK
	RSTACK
?L57:	CALL NOT-AVAILABLE >STACK
	RSTACK

	.FUNCT SHOW-SONARSCOPE,DEP,N,RANGE,LAT,MINLAT,LON,MAXLON,X,Y,LATP2,LATP1,LATM1
	SET 'DEP,SUB-DEPTH
	CALL FIXED-FONT-ON
	FSET? SNARK,INVISIBLE /?L1
	PRINTI "@@=SEACAT Oooo=MONSTER"
	ZERO? SUB-IN-BATTLE /?L5
	PRINTI " #=DANGER"
	JUMP ?L43
?L5:	PRINTI "         "
	JUMP ?L43
?L1:	EQUAL? SHIP-WARNING,SONAR-RED /?L15
	EQUAL? SONAR-WARNING,SONAR-RED \?L13
?L15:	PRINTI "SONAR:*RED*"
	CALL PRINT-ID,STR?151
	JUMP ?L22
?L13:	EQUAL? SHIP-WARNING,SONAR-YELLOW /?L19
	EQUAL? SONAR-WARNING,SONAR-YELLOW \?L18
?L19:	PRINTI "SONAR:YELLO"
	JUMP ?L22
?L18:	PRINTI "           "
?L22:	PRINTI " "
	EQUAL? DEPTH-WARNING,DEPTH-ORANGE \?L27
	PRINTI "DEPTH:ORANGE"
	JUMP ?L34
?L27:	EQUAL? DEPTH-WARNING,DEPTH-RED \?L31
	PRINTI "DEPTH:*RED* "
	CALL PRINT-ID,STR?152
	JUMP ?L34
?L31:	PRINTI "            "
?L34:	PRINTI " "
	LESS? DEP,3 \?L39
	FSET? FREIGHTER,INVISIBLE /?L39
	PRINTI "@=SHIP"
	JUMP ?L43
?L39:	PRINTI "      "
?L43:	CRLF
	SET 'RANGE,SONAR-RANGE
	ADD SUB-LAT,RANGE >LAT
	SUB SUB-LAT,RANGE >MINLAT
	ADD SUB-LON,RANGE >MAXLON
	SET 'X,39
	GET NOW-TERRAIN,0 >Y
	ADD SUB-LAT,2 >LATP2
	ADD SUB-LAT,1 >LATP1
	SUB SUB-LAT,1 >LATM1
?L46:	SUB SUB-LON,RANGE >LON
?L48:	EQUAL? LAT,SUB-LAT \?L50
	EQUAL? LON,SUB-LON \?L50
	PRINTI " +"
	JUMP ?L94
?L50:	FSET? SNARK,INVISIBLE /?L54
	CALL THORPE-POS?,LON,LAT >STACK
	ZERO? STACK /?L55
	PRINTI " @"
	JUMP ?L94
?L55:	CALL SNARK-HEAD-POS?,LON,LAT >STACK
	ZERO? STACK /?L59
	PRINTI " O"
	JUMP ?L94
?L59:	CALL SNARK-TAIL-POS?,LON,LAT >STACK
	ZERO? STACK /?L62
	PRINTI " o"
	JUMP ?L94
?L62:	ZERO? SUB-IN-BATTLE /?L65
	CALL THORPE-SHOOT?,LON,LAT >STACK
	ZERO? STACK /?L65
	PRINTI " #"
	JUMP ?L94
?L65:	PRINTI " ."
	JUMP ?L94
?L54:	EQUAL? NOW-TERRAIN,SEA-TERRAIN \?L71
	CALL DOME-ON-SONAR?,DEP,LON,LAT >STACK
	ZERO? STACK /?L72
	PRINTI " *"
	JUMP ?L94
?L72:	PRINTI " ."
	JUMP ?L94
?L71:	FSET? FREIGHTER,INVISIBLE /?L79
	LESS? DEP,3 \?L79
	EQUAL? LAT,FREIGHTER-LAT \?L79
	EQUAL? LON,FREIGHTER-LON \?L79
	PRINTI " @"
	JUMP ?L94
?L79:	GRTR? LAT,Y \?L84
	GET NOW-TERRAIN,Y >STACK
	CALL GET5,STACK,LON >STACK
	EQUAL? 6,STACK /?L83
?L84:	GRTR? LON,X \?L82
	GET NOW-TERRAIN,LAT >STACK
	CALL GET5,STACK,X >STACK
	EQUAL? 6,STACK \?L82
?L83:	PRINTI " ."
	JUMP ?L94
?L82:	LESS? LAT,1 /?L88
	LESS? LON,1 /?L88
	GRTR? LAT,Y /?L88
	GRTR? LON,X \?L87
?L88:	PRINTI " *"
	JUMP ?L94
?L87:	GET NOW-TERRAIN,LAT >STACK
	CALL GET5,STACK,LON >STACK
	LESS? DEP,STACK \?L91
	PRINTI " ."
	JUMP ?L94
?L91:	PRINTI " *"
?L94:	IGRTR? 'LON,MAXLON \?L48
	EQUAL? LAT,LATP2 \?L99
	PRINTI " HDG:"
	EQUAL? SUB-DLAT,1 \?L103
	PRINTI "N"
	JUMP ?L107
?L103:	EQUAL? SUB-DLAT,-1 \?L107
	PRINTI "S"
?L107:	EQUAL? SUB-DLON,1 \?L111
	PRINTI "E"
	JUMP ?L115
?L111:	EQUAL? SUB-DLON,-1 \?L115
	PRINTI "W"
?L115:	PRINTI " "
	JUMP ?L165
?L99:	EQUAL? LAT,LATP1 \?L121
	EQUAL? JOYSTICK-DIR,P?NW \?L122
	PRINTI "  \  "
	JUMP ?L165
?L122:	EQUAL? JOYSTICK-DIR,P?NORTH \?L126
	PRINTI "   ! "
	JUMP ?L165
?L126:	EQUAL? JOYSTICK-DIR,P?NE \?L129
	PRINTI "    /"
	JUMP ?L165
?L129:	PRINTI "     "
	JUMP ?L165
?L121:	EQUAL? LAT,SUB-LAT \?L135
	PRINTI " "
	EQUAL? JOYSTICK-DIR,P?WEST \?L138
	PRINTI "--"
	JUMP ?L142
?L138:	PRINTI "  "
?L142:	PRINTI "+"
	EQUAL? JOYSTICK-DIR,P?EAST \?L147
	PRINTI "--"
	JUMP ?L165
?L147:	PRINTI "  "
	JUMP ?L165
?L135:	EQUAL? LAT,LATM1 \?L165
	EQUAL? JOYSTICK-DIR,P?SW \?L155
	PRINTI "  /  "
	JUMP ?L165
?L155:	EQUAL? JOYSTICK-DIR,P?SOUTH \?L159
	PRINTI "   ! "
	JUMP ?L165
?L159:	EQUAL? JOYSTICK-DIR,P?SE \?L162
	PRINTI "    \"
	JUMP ?L165
?L162:	PRINTI "     "
?L165:	CRLF
	DLESS? 'LAT,MINLAT \?L46
	MUL 2,RANGE >N
?L173:	PRINTI "--"
	DLESS? 'N,0 \?L173
	CRLF
	CALL FIXED-FONT-OFF
	RTRUE

	.FUNCT START-SONAR?
	ZERO? SCREEN-NOW-SPLIT /FALSE
	SPLIT 13
	SET 'SONAR-DIR,0
	CALL I-SHOW-SONAR
	CALL QUEUE,I-SHOW-SONAR,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT SONARSCOPE-LIGHT-F
	EQUAL? PRSA,V?REPLY /?L3
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
?L3:	ZERO? SONAR-WARNING \?L4
	ZERO? SHIP-WARNING \?L4
	PRINTI "The "
	PRINTD SONARSCOPE-LIGHT
	PRINTI " is off."
	CRLF
?L4:	PRINTI "A yellow "
	PRINTD SONARSCOPE-LIGHT
	PRINTI " shows that the bearing of a blip is NOT CHANGING, even if you and/or the object causing the blip are moving. This means you're on a COLLISION COURSE!
The light will turn red and a loud "
	PRINTD ALARM-SUB
	PRINTI " will sound if you and the approaching object are within ONE TURN of a collision!"
	RTRUE

	.FUNCT ALARM-SUB-F
	EQUAL? PRSA,V?STOP /?L3
	EQUAL? PRSA,V?REPLY,V?LISTEN,V?LAMP-OFF \FALSE
?L3:	PRINTR "Why not avoid the obstacle?"

	.FUNCT BLY-WELCOME
	PRINTI "Welcome to the "
	PRINTD AQUADOME
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! You're a sight for sore eyes! We've been anxiously awaiting your arrival!"
	RTRUE

	.FUNCT SONARPHONE-F
	EQUAL? PRSA,V?LAMP-OFF \?L1
	FSET? PRSO,ONBIT /?L3
	PRINTR "It's not on!"
?L3:	FCLEAR PRSO,ONBIT
	ZERO? REMOTE-PERSON /?L8
	CALL PERFORM,V?GOODBYE
	RTRUE
?L8:	CALL OKAY,SONARPHONE,STR?39 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LISTEN \?L11
	ZERO? BLY-CALLING /?L11
	PRINTR "It's ringing."
?L11:	EQUAL? PRSA,V?TAKE /?L15
	EQUAL? PRSA,V?SAY-INTO,V?REPLY,V?LAMP-ON \FALSE
?L15:	ZERO? BLY-CALLING \?L16
	PRINTR "The sonarphone isn't ringing!"
?L16:	SET 'BLY-CALLING,0
	CALL PHONE-ON,GLOBAL-BLY,AQUADOME,SONARPHONE
	FSET SONARPHONE,ONBIT
	MOVE PRIVATE-MATTER,GLOBAL-OBJECTS
	INC 'BLY-PRIVATELY-COUNT
	SET 'BLY-WELCOMED,1
	PRINTI """This is Zoe Bly speaking. "
	CALL BLY-WELCOME
	CALL DISCUSS-PRIVATE >STACK
	RSTACK

	.FUNCT DISCUSS-PRIVATE
	CALL THIS-IS-IT,PRIVATE-MATTER
	PRINTI " I'd like to discuss a "
	PRINTD PRIVATE-MATTER
	PRINTR " with you, as soon as possible!"""

	.FUNCT HYDROPHONE-F
	EQUAL? PRSA,V?LISTEN \FALSE
	FSET? HYDROPHONE,ONBIT \FALSE
	PRINTI "You can hear "
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L5
	PRINTR "various engine noises."
?L5:	FSET? WHALE,INVISIBLE /?L9
	PRINTR "the whale."
?L9:	PRINTR "nothing interesting."

	.FUNCT REACTOR-F,ARG=0
	ZERO? ARG \?L3
	EQUAL? PRSA,V?ANALYZE,V?EXAMINE \?L1
?L3:	EQUAL? P-ADVERB,W?CAREFULLY \?L4
	ZERO? ARG \?L37
	GETP LOCAL-SUB,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L4:	ZERO? ARG /?L8
?L37:	FSET? REACTOR,ONBIT \?L8
	FSET? REACTOR,OPENBIT \TRUE
?L8:	PRINTI "The power reactor is o"
	FSET? REACTOR,ONBIT \?L12
	PUSH STR?37
	JUMP ?L14
?L12:	PUSH STR?38
?L14:	PRINT STACK
	PRINTI " and "
	FSET? REACTOR,OPENBIT \?L15
	PUSH STR?22
	JUMP ?L17
?L15:	PUSH STR?27
?L17:	PRINT STACK
	PRINTR "."
?L1:	EQUAL? PRSA,V?LAMP-ON \?L18
	FSET? REACTOR,ONBIT \?L19
	CALL ALREADY,REACTOR,STR?18 >STACK
	RSTACK
?L19:	IN? CATALYST-CAPSULE,REACTOR /?L21
	FCLEAR CATALYST-CAPSULE,NDESCBIT
	CALL TELL-HINT,33,CATALYST-CAPSULE,0 >STACK
	RSTACK
?L21:	FSET? REACTOR,OPENBIT \?L22
	CALL YOU-CANT,STR?153,0,STR?22 >STACK
	RSTACK
?L22:	FSET REACTOR,ONBIT
	PRINTI "Electrical systems now activated."
	CRLF
	CALL SCORE-OBJ,REACTOR
	RTRUE
?L18:	EQUAL? PRSA,V?LAMP-OFF \?L26
	FSET? REACTOR,ONBIT /?L27
	CALL ALREADY,REACTOR,STR?39 >STACK
	RSTACK
?L27:	FSET? ENGINE,ONBIT \?L29
	PRINTR "You can't turn it off while the engine is on."
?L29:	FCLEAR REACTOR,ONBIT
	PRINTR "Electrical systems now de-activated."
?L26:	EQUAL? PRSA,V?OPEN \FALSE
	FSET? REACTOR,ONBIT \FALSE
	CALL YOU-CANT,STR?22,0,STR?154 >STACK
	RSTACK

	.FUNCT REACTOR-SWITCH-F
	EQUAL? PRSA,V?EXAMINE,V?LAMP-OFF,V?LAMP-ON \?L1
	CALL PERFORM,PRSA,REACTOR
	RTRUE
?L1:	EQUAL? PRSA,V?TURN,V?PUSH,V?MOVE \FALSE
	PRINT I-ASSUME
	PRINTI " turn on the "
	PRINTD REACTOR
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?LAMP-ON,REACTOR
	RTRUE

	.FUNCT ENGINE-F
	EQUAL? PRSA,V?STOP,V?LAMP-OFF \?L1
	ZERO? THROTTLE-SETTING /FALSE
	CALL YOU-CANT,STR?155,THROTTLE,STR?22 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LAMP-ON \FALSE
	ZERO? SUB-IN-TANK /?L10
	ZERO? TEST-TANK-FULL /?L9
?L10:	ZERO? SUB-IN-DOME /?L7
	ZERO? AIRLOCK-FULL \?L7
?L9:	PRINTI "The "
	PRINTD SUB
	PRINTI " can't go when it's out of the water. You should fill the "
	ZERO? SUB-IN-TANK /?L13
	CALL THIS-IS-IT,TEST-TANK
	PRINTD TEST-TANK
	JUMP ?L17
?L13:	CALL THIS-IS-IT,AIRLOCK
	PRINTD AIRLOCK
?L17:	PRINTR " first."
?L7:	FSET? REACTOR,ONBIT /?L22
	CALL YOU-CANT,STR?153,REACTOR,STR?39 >STACK
	RSTACK
?L22:	FSET? ENGINE,ONBIT \?L23
	CALL ALREADY,ENGINE,STR?18 >STACK
	RSTACK
?L23:	SET 'GATE-CRASHED,0
	FSET ENGINE,ONBIT
	FSET ENGINE,TOUCHBIT
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK /?L25
	PRINTI "Your revolutionary craft thrums with power, matching your own excited heartbeat!"
	CRLF
	JUMP ?L29
?L25:	PRINTI "You can immediately hear the powerful thrum of the hydrojet turbine."
	CRLF
?L29:	CALL SCORE-OBJ,ENGINE
	RTRUE

	.FUNCT ENGINE-BUTTON-F
	EQUAL? PRSA,V?EXAMINE,V?LAMP-OFF,V?LAMP-ON \?L1
	CALL PERFORM,PRSA,ENGINE
	RTRUE
?L1:	EQUAL? PRSA,V?TURN,V?PUSH,V?MOVE \FALSE
	PRINT I-ASSUME
	PRINTI " turn on the "
	PRINTD ENGINE
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?LAMP-ON,ENGINE
	RTRUE

	.FUNCT JOYSTICK-F
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \?L1
	PRINTI "The "
	PRINTD JOYSTICK
	PRINTI " is like the kind used with personal computers, only bigger. It's now "
	ZERO? JOYSTICK-DIR \?L5
	PRINTR "sitting at dead center."
?L5:	PRINTI "pointing to "
	CALL DIR-PRINT,JOYSTICK-DIR
	PRINTR "."
?L1:	EQUAL? PRSA,V?TURN,V?PUSH,V?MOVE \?L14
	CALL V-WALK-AROUND
	RTRUE
?L14:	EQUAL? PRSA,V?MOVE-DIR \FALSE
	EQUAL? P-DIRECTION,P?IN \?L16
	CALL V-WALK-AROUND
	RTRUE
?L16:	EQUAL? P-DIRECTION,P?OUT \?L24
	ZERO? SUB-IN-TANK /?L21
	SET 'P-DIRECTION,P?EAST
	JUMP ?L24
?L21:	ZERO? SUB-IN-DOME /?L23
	SET 'P-DIRECTION,P?SOUTH
	JUMP ?L24
?L23:	CALL V-WALK-AROUND
	RTRUE
?L24:	CALL DO-WALK,P-DIRECTION
	RTRUE

	.FUNCT THROTTLE-F,TH
	EQUAL? PRSA,V?LAMP-ON,V?PUSH,V?OPEN \?L1
	ADD 1,THROTTLE-SETTING >P-NUMBER
	GRTR? P-NUMBER,THROTTLE-MAX \?L3
	PRINTR "You're going as fast as you can!"
?L3:	CALL PERFORM,V?SET,THROTTLE
	RTRUE
?L1:	EQUAL? PRSA,V?LAMP-OFF,V?CLOSE \?L8
	ZERO? THROTTLE-SETTING \?L9
	CALL ALREADY,THROTTLE,STR?27
	RTRUE
?L9:	SET 'THROTTLE-SETTING,0
	ZERO? SUB-IN-TANK \?L14
	ZERO? SUB-IN-DOME /?L12
?L14:	PRINTI "The throttle is now closed. You must open it to make the "
	PRINTD SUB
	PRINTR " go anywhere."
?L12:	PRINTI "The "
	PRINTD SUB
	PRINTI " slows to a halt."
	CRLF
	CALL COOL-BACK
	RTRUE
?L8:	EQUAL? PRSA,V?TURN,V?MOVE \?L20
	PRINTR "Set it to the speed you want: fast, medium, slow, or off."
?L20:	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \?L23
	PRINTI "The throttle is set to "
	GET THROTTLE-DESCS,THROTTLE-SETTING >STACK
	PRINT STACK
	PRINTR "."
?L23:	EQUAL? PRSA,V?MOVE-DIR,V?PUT,V?SET \FALSE
	EQUAL? PRSO,THROTTLE \FALSE
	EQUAL? PRSI,FAST /?L29
	EQUAL? PRSI,MEDIUM,SLOW,OFF \?L27
?L29:	EQUAL? PRSI,OFF \?L30
	SET 'TH,0
	JUMP ?L37
?L30:	EQUAL? PRSI,SLOW \?L32
	SET 'TH,1
	JUMP ?L37
?L32:	EQUAL? PRSI,MEDIUM \?L33
	SET 'TH,2
	JUMP ?L37
?L33:	EQUAL? PRSI,FAST \?L37
	SET 'TH,3
	JUMP ?L37
?L27:	EQUAL? PRSI,0,GRID-UNIT \?L36
	GRTR? P-NUMBER,-1 \?L36
	GRTR? P-NUMBER,THROTTLE-MAX /?L36
	SET 'TH,P-NUMBER
	JUMP ?L37
?L36:	PRINTR "Set it off, slow, medium, or fast."
?L37:	ZERO? TH \?L40
	PRINT I-ASSUME
	PRINTI " close the "
	PRINTD THROTTLE
	PRINTI ".)"
	CRLF
	CALL PERFORM,V?CLOSE,THROTTLE
	RTRUE
?L40:	FSET? ENGINE,ONBIT /?L45
	PRINTI "Nothing happens when you open the throttle. "
	ZERO? GATE-CRASHED /?L49
	PRINTI "The turbine was stopped by Automatic Shutoff when you crashed into the sea gate."
	JUMP ?L53
?L49:	PRINTI "The engine is off."
?L53:	CALL THIS-IS-IT,ENGINE
	CRLF
	RTRUE
?L45:	ZERO? SUB-IN-TANK /?L56
	CALL HATCH-GATE-NOT-READY?,TANK-GATE >STACK
	ZERO? STACK \TRUE
	EQUAL? JOYSTICK-DIR,P?EAST \?L60
	FSET? TANK-GATE,OPENBIT /?L62
	CALL GATE-CRASH,STR?22,THROTTLE,TANK-GATE
	RTRUE
?L62:	SET 'THROTTLE-SETTING,TH
	CALL SUB-LEAVES,1,P?EAST
	RTRUE
?L60:	SET 'THROTTLE-SETTING,TH
	CALL OKAY-THROTTLE,P?EAST
	RTRUE
?L56:	ZERO? SUB-IN-DOME /?L66
	CALL HATCH-GATE-NOT-READY?,AIRLOCK-HATCH >STACK
	ZERO? STACK \TRUE
	SET 'THROTTLE-SETTING,TH
	EQUAL? JOYSTICK-DIR,P?SOUTH \?L70
	CALL SUB-LEAVES,0,P?SOUTH
	RTRUE
?L70:	CALL OKAY-THROTTLE,P?SOUTH
	RTRUE
?L66:	EQUAL? THROTTLE-SETTING,TH \?L74
	PRINTI "Okay, you're still "
	JUMP ?L78
?L74:	LESS? THROTTLE-SETTING,TH \?L79
	PRINTI "You feel the seat press "
	ZERO? THROTTLE-SETTING /?L83
	PRINTI "harder "
?L83:	PRINTI "against you, and the "
	PRINTD ENGINE
	PRINTI " gets loud"
	JUMP ?L90
?L79:	PRINTI "The "
	PRINTD ENGINE
	PRINTI " gets quiet"
?L90:	PRINTI "er. You're now "
?L78:	PRINTI "travelling at a speed of "
	PRINTN TH
	PRINTI " "
	PRINTD GRID-UNIT
	EQUAL? 1,TH /?L97
	PRINTI "s"
?L97:	SET 'THROTTLE-SETTING,TH
	PRINTR " per turn."

	.FUNCT OKAY-THROTTLE,DIR
	PRINTI "Okay, now that the throttle is set, try pushing the "
	PRINTD JOYSTICK
	PRINTI " to "
	CALL DIR-PRINT,DIR
	PRINTR "."

	.FUNCT I-SHOW-SONAR
	FSET? SNARK,INVISIBLE \?L1
	FSET? FREIGHTER,INVISIBLE \?L1
	EQUAL? SONAR-LON,SUB-LON \?L1
	EQUAL? SONAR-LAT,SUB-LAT \?L1
	EQUAL? SONAR-DEP,SUB-DEPTH \?L1
	EQUAL? SONAR-DIR,JOYSTICK-DIR \?L1
	ZERO? DEBUG /FALSE
	PRINTI "[no sonar update]"
	CRLF
	RFALSE
?L1:	SCREEN 1
	CALL SHOW-SONARSCOPE
	SCREEN 0
	SET 'SONAR-LON,SUB-LON
	SET 'SONAR-LAT,SUB-LAT
	SET 'SONAR-DEP,SUB-DEPTH
	SET 'SONAR-DIR,JOYSTICK-DIR
	RFALSE

	.FUNCT DEPTH-F
	CALL DO-INSTEAD-OF,DEPTH-CONTROL,DEPTH
	RTRUE

	.FUNCT DEPTH-CONTROL-F,DEP,NEW-DIVING?
	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	ZERO? SUB-IN-TANK /?L3
	CALL YOU-CANT,STR?156,SUB,STR?65
	RTRUE
?L3:	ZERO? SUB-IN-DOME /?L4
	CALL WHY-NEED,DEPTH-CONTROL,AIRLOCK >STACK
	ZERO? STACK \TRUE
?L4:	EQUAL? PRSA,V?WHAT /?L6
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \?L5
?L6:	PRINTI "It's set for a desired depth of "
	MUL 5,TARGET-DEPTH >STACK
	PRINTN STACK
	PRINTR " meters."
?L5:	EQUAL? PRSA,V?SET \FALSE
	SET 'DEP,P-NUMBER
	FSET? AUTO-PILOT,ONBIT \?L10
	PRINTI "Let the "
	PRINTD AUTO-PILOT
	PRINTR " handle that."
?L10:	FSET? DEPTHFINDER,ONBIT /?L14
	CALL THIS-IS-IT,DEPTHFINDER
	PRINTI "You'd better turn on the "
	PRINTD DEPTHFINDER
	PRINTR " first."
?L14:	GRTR? DEP,-1 /?L17
	PRINTR "You must set it to at least zero!"
?L17:	ZERO? SUB-IN-BATTLE /?L20
	GRTR? SUB-DEPTH,DEP \?L20
	PRINTR "If you go above the Snark, Thorpe will shoot you!"
?L20:	GRTR? DEP,0 \?L23
	FSET? SUB-DOOR,OPENBIT \?L23
	CALL YOU-CANT,STR?156,SUB-DOOR,STR?22
	RTRUE
?L23:	EQUAL? PRSI,METER \?L25
	ADD 2,DEP >STACK
	DIV STACK,5 >DEP
	MUL 5,DEP >STACK
	EQUAL? P-NUMBER,STACK /?L25
	PRINTI "(That rounds off to "
	MUL 5,DEP >STACK
	PRINTN STACK
	PRINTI " meters.)"
	CRLF
?L25:	SET 'TARGET-DEPTH,DEP
	ZERO? DEP /?L31
	SET 'EVER-SUBMERGED?,1
?L31:	EQUAL? SUB-DEPTH,DEP \?L34
	ZERO? DIVING? \?L36
	CALL ALREADY,PLAYER,STR?157
	JUMP ?L38
?L36:	PRINTI "Your "
	EQUAL? 1,DIVING? \?L41
	PUSH STR?158
	JUMP ?L43
?L41:	PUSH STR?159
?L43:	PRINT STACK
	PRINTI "scent ceases."
?L38:	CRLF
	SET 'DIVING?,0
	RTRUE
?L34:	LESS? SUB-DEPTH,TARGET-DEPTH \?L45
	SET 'NEW-DIVING?,1
	JUMP ?L47
?L45:	SET 'NEW-DIVING?,-1
?L47:	EQUAL? DIVING?,NEW-DIVING? /?L48
	PRINTI "The "
	PRINTD SUB
	PRINTI " noses "
	EQUAL? NEW-DIVING?,1 \?L52
	PRINTI "down"
	JUMP ?L56
?L52:	PRINTI "up"
?L56:	PRINTI "ward"
	ZERO? SUB-DEPTH \?L61
	PRINTI ", and "
	PRINTD GLOBAL-WATER
	PRINTI " begins to wash over your forward "
	PRINTD SUB-WINDOW
?L61:	PRINTI ". You're now "
	JUMP ?L68
?L48:	PRINTI "Okay, you're still "
?L68:	SET 'DIVING?,NEW-DIVING?
	EQUAL? 1,DIVING? \?L71
	PRINTI "div"
	JUMP ?L75
?L71:	PRINTI "ris"
?L75:	PRINTI "ing at a speed of 5 meters per "
	ZERO? THROTTLE-SETTING \?L80
	PRINTR "turn."
?L80:	PRINTD GRID-UNIT
	PRINTR "."

	.FUNCT METER-F
	EQUAL? PRSA,V?BOARD \FALSE
	CALL PERFORM,V?CLIMB-UP,PRSO
	RTRUE

	.FUNCT AUTO-PILOT-F
	EQUAL? PRSA,V?LAMP-OFF \?L1
	FSET? AUTO-PILOT,ONBIT /?L3
	CALL ALREADY,AUTO-PILOT,STR?39 >STACK
	RSTACK
?L3:	PRINTI "If you do, you'll never reach the "
	PRINTD AQUADOME
	PRINTR "!"
?L1:	EQUAL? PRSA,V?PUSH,V?LAMP-ON /?L9
	EQUAL? PRSA,V?SET \FALSE
	EQUAL? PRSI,AQUADOME \FALSE
?L9:	FSET? AUTO-PILOT,ONBIT \?L10
	CALL ALREADY,AUTO-PILOT,STR?18 >STACK
	RSTACK
?L10:	ZERO? SUB-IN-OPEN-SEA \?L12
	PRINTR "You must be your own pilot for now."
?L12:	FSET? SUB-DOOR,OPENBIT \?L15
	CALL YOU-CANT,STR?156,SUB-DOOR,STR?22
	RTRUE
?L15:	FSET AUTO-PILOT,ONBIT
	SET 'JOYSTICK-DIR,P?EAST
	SET 'TIP-SAYS-1,23
	SET 'TIP-SAYS-2,MAGAZINE
	CALL QUEUE,I-TIP-SAYS,6 >STACK
	PUT STACK,0,1
	PRINTI "Okay, your trip to the "
	PRINTD AQUADOME
	PRINTI " will take "
	ZERO? THROTTLE-SETTING \?L19
	PRINTI "forever"
	JUMP ?L23
?L19:	DIV AQUADOME-DISTANCE,THROTTLE-SETTING >STACK
	PRINTN STACK
	PRINTI " turns"
?L23:	PRINTI " at your current speed. But you can set the throttle to a different speed, if you want."
	CRLF
	CALL SCORE-OBJ,AUTO-PILOT
	RTRUE

	.FUNCT I-AUTO-PILOT
	FSET? AUTO-PILOT,ONBIT /FALSE
	CALL QUEUE,I-AUTO-PILOT,2
	EQUAL? PRSA,V?LAMP-ON \?L3
	EQUAL? PRSO,AUTO-PILOT /FALSE
?L3:	CALL TIME-FOR-PILOT >STACK
	RSTACK

	.FUNCT TIME-FOR-PILOT
	CALL TIP-SAYS
	PRINTI "I think it's time to turn on the "
	PRINTD AUTO-PILOT
	PRINTR "."""

	.FUNCT CONTROL-CIRCUITS-F
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	ZERO? SUB-IN-OPEN-SEA /FALSE
	PRINTI "Sorry. There's no way to do this while the "
	PRINTD SUB
	PRINTR " is submerged and underway. You need ship-repair or test-tank facilities."

	.FUNCT CONTROL-CIRCUITS-GAUGE-F
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	PRINTI "The "
	PRINTD CONTROL-CIRCUITS-GAUGE
	PRINTI " needle is "
	LESS? 20,CIRCUIT-TEMP \?L7
	LESS? 25,CIRCUIT-TEMP \?L9
	PRINTI "pointing to"
	JUMP ?L13
?L9:	PRINTI "near"
?L13:	PRINTI " the red danger zone."
	JUMP ?L18
?L7:	PRINTI "in the green safety zone."
?L18:	FSET? ENGINE,TOUCHBIT \?L30
	FSET? VOLTAGE-REGULATOR,MUNGBIT \?L30
	LESS? 1,THROTTLE-SETTING \?L24
	PRINTR " And rising."
?L24:	ZERO? THROTTLE-SETTING \?L27
	PRINTR " And falling."
?L27:	PRINTI " And steady."
?L30:	CRLF
	RTRUE

	.FUNCT SEARCH-BEAM-F
	EQUAL? PRSA,V?TURN \?L1
	PRINTR "You didn't tell what direction to aim it."
?L1:	EQUAL? PRSA,V?AIM \FALSE
	FSET? SEARCH-BEAM,ONBIT /?L6
	PRINTR "It's not on!"
?L6:	ZERO? SUB-IN-BATTLE /?L10
	CALL TOO-CLOUDY >STACK
	RSTACK
?L10:	EQUAL? PRSI,RIGHT \?L11
	IN? WHALE,SUB \?L11
	FSET? WHALE,INVISIBLE \?L12
	FCLEAR WHALE,INVISIBLE
	PRINTI "An enormous whale can be seen, lolling comfortably in the deep."
	ZERO? WHALE-HEARD /?L16
	PRINTI " Obviously this is what has been making those noises over the hydrophone."
?L16:	CRLF
	PRINTI "The whale swims closer as you pass, curious about this strange fish -- the "
	PRINTD SUB
	PRINTR ". But, thankfully, it shows no danger of accidental collision."
?L12:	PRINTR "The whale is still following you."
?L11:	PRINTI "Nothing new appears in the "
	PRINTD SEARCH-BEAM
	PRINTR " beam."

	.FUNCT GENERIC-LIGHT-F,OBJ
	ZERO? DEPTH-WARNING /?L1
	RETURN DEPTHFINDER-LIGHT
?L1:	ZERO? SONAR-WARNING \?L4
	ZERO? SHIP-WARNING /?L3
?L4:	RETURN SONARSCOPE-LIGHT
?L3:	EQUAL? PRSA,V?SAIM,V?AIM /?L6
	EQUAL? PRSA,V?TURN,V?LAMP-OFF,V?LAMP-ON \FALSE
?L6:	RETURN SEARCH-BEAM

	.FUNCT WHALE-F
	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?FIND \FALSE
	PRINTR "You shouldn't get any closer!"

	.FUNCT BAY-F
	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?FIND \?L1
	ZERO? SUB-IN-TANK /?L3
	PRINTI "First you must launch the "
	PRINTD SUB
	PRINTR "."
?L3:	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L7
	PRINTR "You're in it!"
?L7:	PRINTR "This is no time to go back!"
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L14
	CALL PERFORM,V?LOOK-OUTSIDE,SUB-WINDOW
	RTRUE
?L14:	CALL NOT-HERE,BAY >STACK
	RSTACK

	.FUNCT CLAW-F
	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \?L1
	CALL LOCAL-SUB-F >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?FIND \?L3
	PRINTI "It's part of the "
	PRINTD SUB
	PRINTR "."
?L3:	EQUAL? PRSA,V?MOVE-DIR,V?MOVE,V?AIM \FALSE
	GET ON-SUB,0 >STACK
	EQUAL? BAZOOKA,STACK \?L7
	GET ON-SUB,1 >STACK
	EQUAL? DART,STACK \?L9
	PRINTR "You should do that to one weapon or the other."
?L9:	CALL PERFORM,PRSA,BAZOOKA,PRSI
	RTRUE
?L7:	GET ON-SUB,1 >STACK
	EQUAL? DART,STACK \?L14
	CALL PERFORM,PRSA,DART,PRSI
	RTRUE
?L14:	PRINTR "The claw moves just where you want it. Well done!"

	.FUNCT WHY-NEED,OBJ,WHERE
	EQUAL? PRSA,V?SET \?L1
	EQUAL? PRSI,MANUAL /FALSE
?L1:	EQUAL? PRSA,V?MUNG,V?LAMP-OFF /FALSE
	PRINTI "Why would you need the "
	PRINTD OBJ
	PRINTI "? The "
	PRINTD SUB
	PRINTI " is in the "
	PRINTD WHERE
	PRINTR "."

	.FUNCT PILOT-SEAT-F,VAL=0
	EQUAL? PRSA,V?SIT,V?EXAMINE,V?ANALYZE \?L1
	PRINTR "You're sitting in it."
?L1:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	FSET? OXYGEN-GEAR,TOUCHBIT /?L6
	SET 'VAL,1
	PRINTI "You can see "
	PRINTD OXYGEN-GEAR
	PRINTI "."
	CRLF
?L6:	IN? ESCAPE-POD-UNIT,HERE \?L11
	SET 'VAL,1
	PRINTI "You can see the "
	PRINTD ESCAPE-POD-UNIT
	PRINTI "."
	CRLF
?L11:	RETURN VAL

	.FUNCT INSTRUMENTS-F
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	PRINTI "Main instruments:
"
	PRINTD DEPTHFINDER
	PRINTI ", "
	PRINTD HYDROPHONE
	PRINTI ", "
	PRINTD SONARSCOPE
	PRINTI ", and "
	PRINTD CONTROL-CIRCUITS-GAUGE
	PRINTR "."

	.FUNCT CONTROLS-SUB-F
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	PRINTI "MAIN OPERATING CONTROLS:
"
	CALL FIXED-FONT-ON
	PRINTD REACTOR
	PRINTI "        : "
	FSET? REACTOR,OPENBIT \?L7
	PUSH STR?22
	JUMP ?L9
?L7:	PUSH STR?27
?L9:	PRINT STACK
	CRLF
	PRINTD REACTOR-SWITCH
	PRINTI ": "
	FSET? REACTOR,ONBIT \?L10
	PUSH STR?18
	JUMP ?L12
?L10:	PUSH STR?39
?L12:	PRINT STACK
	CRLF
	PRINTD FILL-TANK-BUTTON
	PRINTI "   : "
	CALL TANK-STATUS >STACK
	PRINT STACK
	CRLF
	PRINTD OPEN-GATE-BUTTON
	PRINTI "   : "
	CALL GATE-STATUS >STACK
	PRINT STACK
	CRLF
	PRINTD ENGINE-BUTTON
	PRINTI " : "
	FSET? ENGINE,ONBIT \?L13
	PUSH STR?18
	JUMP ?L15
?L13:	PUSH STR?39
?L15:	PRINT STACK
	CRLF
	PRINTD THROTTLE
	PRINTI "       : "
	GET THROTTLE-DESCS,THROTTLE-SETTING >STACK
	PRINT STACK
	CRLF
	PRINTD JOYSTICK
	PRINTI "       : "
	CALL DIR-PRINT,JOYSTICK-DIR,0
	CRLF
	PRINTD DEPTH-CONTROL
	PRINTI "  : "
	MUL 5,TARGET-DEPTH >STACK
	PRINTN STACK
	PRINTI " meters
"
	PRINTD AUTO-PILOT
	PRINTI "      : "
	FSET? AUTO-PILOT,ONBIT \?L18
	PUSH STR?18
	JUMP ?L20
?L18:	PUSH STR?39
?L20:	PRINT STACK
	CRLF
	CALL FIXED-FONT-OFF
	RTRUE

	.FUNCT FIXED-FONT-ON
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT FIXED-FONT-OFF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT THORPE-SHOOT?,X,Y
	ZERO? SNARK-TRANKED /?L1
	CALL FORWARD-OF-THORPE?,X,Y >STACK
	RSTACK
?L1:	CALL STARBOARD-OF-THORPE?,X,Y >STACK
	ZERO? STACK /FALSE
	CALL FORWARD-OF-THORPE?,X,Y >STACK
	RSTACK

	.FUNCT STARBOARD-OF-THORPE?,X,Y
	SUB Y,THORPE-LAT >STACK
	MUL THORPE-HLON,STACK >STACK
	SUB X,THORPE-LON >STACK
	MUL THORPE-HLAT,STACK >STACK
	SUB STACK,STACK >STACK
	GRTR? 0,STACK /FALSE
	RTRUE

	.FUNCT FORWARD-OF-THORPE?,X,Y
	SUB THORPE-LAT,Y >STACK
	MUL THORPE-HLAT,STACK >STACK
	SUB X,THORPE-LON >STACK
	MUL THORPE-HLON,STACK >STACK
	SUB STACK,STACK >STACK
	GRTR? 0,STACK /FALSE
	RTRUE

	.FUNCT THORPE-POS?,LON,LAT
	EQUAL? SUB-DEPTH,AIRLOCK-DEPTH \FALSE
	SUB THORPE-LAT,THORPE-HLAT >STACK
	EQUAL? LAT,STACK \?L3
	SUB THORPE-LON,THORPE-HLON >STACK
	EQUAL? LON,STACK /TRUE
?L3:	EQUAL? LAT,THORPE-LAT \FALSE
	EQUAL? LON,THORPE-LON /TRUE
	RFALSE

	.FUNCT SNARK-POS?,LON,LAT,?TMP
	CALL SNARK-HEAD-POS?,LON,LAT >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL SNARK-TAIL-POS?,LON,LAT >STACK
	RSTACK

	.FUNCT SNARK-HEAD-POS?,LON,LAT
	EQUAL? SUB-DEPTH,AIRLOCK-DEPTH \FALSE
	EQUAL? LAT,SNARK-LAT \FALSE
	EQUAL? LON,SNARK-LON /TRUE
	RFALSE

	.FUNCT SNARK-TAIL-POS?,LON,LAT,X,Y,HLON,HLAT
	EQUAL? SUB-DEPTH,AIRLOCK-DEPTH \FALSE
	ZERO? SNARK-TRANKED /?L3
	SET 'HLON,SNARK-HLON
	SET 'HLAT,SNARK-HLAT
	JUMP ?L4
?L3:	SET 'HLON,THORPE-HLON
	SET 'HLAT,THORPE-HLAT
?L4:	SUB SNARK-LON,HLON >X
	SUB SNARK-LAT,HLAT >Y
	EQUAL? LAT,Y \?L5
	EQUAL? LON,X /TRUE
?L5:	SUB X,HLON >X
	SUB Y,HLAT >Y
	EQUAL? LAT,Y \?L8
	EQUAL? LON,X /TRUE
?L8:	SUB Y,HLAT >STACK
	EQUAL? LAT,STACK \FALSE
	SUB X,HLON >STACK
	EQUAL? LON,STACK /TRUE
	RFALSE

	.FUNCT THORPE-SUB-F
	EQUAL? PRSA,V?FIND \?L1
	PRINTR "It's not far away!"
?L1:	EQUAL? PRSA,V?PUSH,V?MOVE \?L5
	PRINTR "It's too big!"
?L5:	EQUAL? PRSA,V?ATTACK,V?KILL,V?SHOOT \?L8
	PRINTI "You have to shoot"
	CALL THE-PRSO-PRINT
	PRINTI " with a weapon."
	CRLF
	CALL PRINT-ID,STR?160 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?WALK-TO \FALSE
	PRINTR "You're the pilot!"

	.FUNCT I-UPDATE-THORPE,DLAT,DLON,Z
	ZERO? SUB-IN-BATTLE /?L24
	MUL THORPE-HLON,THORPE-HLAT >Z
	CALL THORPE-SHOOT?,SUB-LON,SUB-LAT >STACK
	ZERO? STACK \?L3
	ZERO? THORPE-DLON \?L5
	ZERO? THORPE-DLAT \?L5
	ZERO? THORPE-TURNING? \?L7
	SET 'THORPE-TURNING?,1
	JUMP ?L8
?L7:	SET 'THORPE-TURNING?,0
?L8:	ZERO? THORPE-TURNING? \?L24
	CALL STARBOARD-OF-THORPE?,SUB-LON,SUB-LAT >STACK
	ZERO? STACK /?L11
	ZERO? THORPE-HLON \?L12
	SET 'THORPE-HLON,THORPE-HLAT
	JUMP ?L24
?L12:	EQUAL? -1,Z \?L14
	SET 'THORPE-HLON,0
	JUMP ?L24
?L14:	EQUAL? 1,Z \?L15
	SET 'THORPE-HLAT,0
	JUMP ?L24
?L15:	SUB 0,THORPE-HLON >THORPE-HLAT
	JUMP ?L24
?L11:	ZERO? THORPE-HLON \?L18
	SUB 0,THORPE-HLAT >THORPE-HLON
	JUMP ?L24
?L18:	EQUAL? -1,Z \?L20
	SET 'THORPE-HLAT,0
	JUMP ?L24
?L20:	EQUAL? 1,Z \?L21
	SET 'THORPE-HLON,0
	JUMP ?L24
?L21:	SET 'THORPE-HLAT,THORPE-HLON
	JUMP ?L24
?L5:	SET 'THORPE-DLON,0
	SET 'THORPE-DLAT,0
	JUMP ?L24
?L3:	PRINTI "Thorpe zeroed in on you and fired his rocket! It streaks through the water toward the "
	PRINTD SUB
	PRINTI "! In an instant your sub will be just twisted metal, trapping you and Tip forever in Davy Jones's locker!"
	CALL FINISH
?L24:	ADD THORPE-LON,THORPE-DLON >THORPE-LON
	ADD THORPE-LAT,THORPE-DLAT >THORPE-LAT
	MUL THORPE-HLON,THORPE-HLAT >Z
	ZERO? Z \?L28
	ZERO? THORPE-HLAT \?L30
	ADD THORPE-LAT,THORPE-HLON >SNARK-LAT
	ADD THORPE-LON,THORPE-HLON >SNARK-LON
	RFALSE
?L30:	ADD THORPE-LAT,THORPE-HLAT >SNARK-LAT
	SUB THORPE-LON,THORPE-HLAT >SNARK-LON
	RFALSE
?L28:	EQUAL? -1,Z \?L33
	ADD THORPE-LON,THORPE-HLON >SNARK-LON
	SET 'SNARK-LAT,THORPE-LAT
	RFALSE
?L33:	EQUAL? 1,Z \FALSE
	ADD THORPE-LAT,THORPE-HLAT >SNARK-LAT
	SET 'SNARK-LON,THORPE-LON
	RFALSE

	.FUNCT DART-F
	CALL WEAPON-F,DART >STACK
	RSTACK

	.FUNCT MOUNTING-VERB?,OBJ
	ZERO? SUB-IN-DOME /FALSE
	EQUAL? PRSO,OBJ \FALSE
	EQUAL? PRSA,V?USE /TRUE
	EQUAL? PRSA,V?SHOW \?L5
	EQUAL? PRSO,BLY \?L5
	EQUAL? PRSI,BAZOOKA /TRUE
?L5:	EQUAL? PRSA,V?PUT-UNDER \?L6
	EQUAL? PRSO,ESCAPE-POD-UNIT \?L6
	EQUAL? PRSI,PILOT-SEAT,CHAIR /TRUE
?L6:	EQUAL? PRSA,V?TIE-TO,V?PUT \FALSE
	EQUAL? PRSI,CLAW,LOCAL-SUB,GLOBAL-SUB /TRUE
	RFALSE

	.FUNCT NO-GOOD-MUNGED
	PRINTD HORVAK
	PRINTR " has to fix it first."

	.FUNCT WEAPON-F,OBJ,WHICH=0,O,NOT-ON-SUB=0,SOMEONE=0,?TMP
	CALL BAD-AIR? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?TAKE,V?SEARCH-FOR,V?FIND /?L5
	CALL MOUNTING-VERB?,OBJ >STACK
	ZERO? STACK \?L5
	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
?L5:	EQUAL? OBJ,DART \?L7
	SET 'WHICH,1
?L7:	GET ON-SUB,WHICH >STACK
	EQUAL? OBJ,STACK /?L10
	SET 'NOT-ON-SUB,1
?L10:	ZERO? SUB-IN-DOME \?L13
	ZERO? NOT-ON-SUB /?L18
	PRINTI "You can't use"
	CALL PRINTT,OBJ
	PRINTR " now!"
?L13:	ZERO? NOT-ON-SUB /?L18
	EQUAL? PRSA,V?SEARCH-FOR,V?FIND \?L20
	LOC OBJ >STACK
	EQUAL? HERE,STACK \FALSE
	FSET? OBJ,TOUCHBIT /FALSE
	FCLEAR OBJ,NDESCBIT
	CALL HE-SHE-IT,WINNER,1,STR?161
	PRINTR " it among lots of equipment and supplies."
?L20:	EQUAL? PRSA,V?TAKE \?L27
	EQUAL? WHICH,1 \FALSE
	FCLEAR DART,NDESCBIT
	FSET? DART,MUNGBIT \FALSE
	CALL NO-GOOD-MUNGED >STACK
	RSTACK
?L27:	CALL MOUNTING-VERB?,OBJ >STACK
	ZERO? STACK /FALSE
	EQUAL? WINNER,PLAYER /?L35
	SET 'SOMEONE,WINNER
	JUMP ?L37
?L35:	CALL FIND-FLAG,HERE,PERSON,PLAYER >SOMEONE
	ZERO? SOMEONE /?L155
	JUMP ?L43
?L37:	ZERO? SOMEONE \?L43
?L155:	SET '?TMP,HERE
	CALL META-LOC,OBJ >STACK
	EQUAL? ?TMP,STACK /?L41
	CALL NOT-HERE,OBJ
	RTRUE
?L41:	EQUAL? HERE,AIRLOCK /?L43
	CALL NOT-HERE,CLAW
	RTRUE
?L43:	ZERO? WHICH \?L46
	ZERO? SOMEONE /?L48
	EQUAL? HERE,AIRLOCK /?L48
	PRINTI """Good idea! That should stop the "
	PRINTD SNARK
	PRINTI "! It could disable an enemy sub, too! Shall I "
	EQUAL? PRSA,V?PUT \?L52
	PRINTI "do it"
	JUMP ?L59
?L52:	PRINTI "have it mounted"
	EQUAL? PRSI,CLAW /?L59
	PRINTI " on an "
	PRINTD CLAW
	PRINTI " of the "
	PRINTD SUB
?L59:	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	CALL PRINT-ID,STR?162
	CALL MOUNT-WEAPON,BAZOOKA
	CALL FINE-SEQUENCE
	RTRUE
?L48:	CALL PRINT-ID,STR?163
	CALL MOUNT-WEAPON,BAZOOKA
	CALL OKAY,BAZOOKA,STR?164
	CALL FINE-SEQUENCE
	RTRUE
?L46:	FSET? DART,MUNGBIT \?L70
	CALL NO-GOOD-MUNGED >STACK
	RSTACK
?L70:	CALL PRINT-ID,STR?165
	CALL MOUNT-WEAPON,DART
	ZERO? SOMEONE /?L72
	EQUAL? HERE,AIRLOCK /?L72
	PRINTD SOMEONE
	PRINTI " promptly mounts the "
	PRINTD DART
	PRINTI " on an "
	PRINTD CLAW
	PRINTI "."
	CRLF
	JUMP ?L76
?L72:	CALL OKAY,DART,STR?164
?L76:	GET ON-SUB,0 >STACK
	EQUAL? BAZOOKA,STACK \TRUE
	CALL FINE-SEQUENCE
	RTRUE
?L18:	EQUAL? PRSA,V?EXAMINE,V?FIND \?L82
	PRINTI "It's mounted on one of the "
	PRINTD SUB
	PRINTI "'s "
	PRINTD CLAW
	PRINTR "s."
?L82:	EQUAL? PRSA,V?TAKE /?L87
	CALL MOUNTING-VERB?,OBJ >STACK
	ZERO? STACK /?L86
?L87:	PRINTI "You'd better leave it mounted on the "
	PRINTD CLAW
	PRINTR "."
?L86:	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?MOVE-DIR,V?MOVE \?L91
	PRINTR "You should type where you want to aim it."
?L91:	EQUAL? PRSA,V?AIM \?L94
	FSET? CLAW,MUNGBIT \?L95
	PRINTI "Nothing happens. Either the "
	PRINTD CLAW
	PRINTI " or the "
	PRINTD OBJ
	PRINTI " was damaged when you rammed the "
	PRINTD SNARK
	PRINTR "!"
?L95:	EQUAL? PRSI,GLOBAL-THORPE,THORPE-SUB \?L99
	CALL STARBOARD-OF-THORPE?,SUB-LON,SUB-LAT >STACK
	ZERO? STACK \?L100
	CALL YOU-CANT,STR?167,GLOBAL-SNARK,STR?166
	RTRUE
?L100:	ZERO? SUB-IN-BATTLE /?L103
	CALL SCORE-OBJ,THORPE-SUB
?L103:	PUT OBJ-AIMED-AT,WHICH,THORPE-SUB
	PUT LON-AIMED-AT,WHICH,THORPE-LON
	PUT LAT-AIMED-AT,WHICH,THORPE-LAT
	JUMP ?L107
?L99:	EQUAL? PRSI,GLOBAL-SNARK,SNARK \FALSE
	PUT OBJ-AIMED-AT,WHICH,SNARK
	PUT LON-AIMED-AT,WHICH,SNARK-LON
	PUT LAT-AIMED-AT,WHICH,SNARK-LAT
?L107:	PRINTI "Aimed."
	CRLF
	CALL PRINT-ID,STR?168 >STACK
	RSTACK
?L94:	EQUAL? PRSA,V?ATTACK,V?KILL,V?SHOOT \FALSE
	GET OBJ-AIMED-AT,WHICH >O
	CALL PRINT-ID,STR?169
	GET ALREADY-SHOT,WHICH >STACK
	ZERO? STACK /?L111
	PRINTI "You already shot"
	CALL THE-PRSI-PRINT
	PRINTR "!"
?L111:	ZERO? O \?L115
	PRINTR "You have to aim it first!"
?L115:	EQUAL? THORPE-SUB,O \?L122
	EQUAL? PRSO,GLOBAL-THORPE,THORPE-SUB \?L121
?L122:	EQUAL? SNARK,O \?L119
	EQUAL? PRSO,GLOBAL-SNARK,SNARK /?L119
?L121:	PRINTI "You didn't aim it at"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L119:	EQUAL? PRSO,GLOBAL-THORPE,THORPE-SUB \?L126
	GET LON-AIMED-AT,WHICH >STACK
	EQUAL? STACK,THORPE-LON \?L128
	GET LAT-AIMED-AT,WHICH >STACK
	EQUAL? STACK,THORPE-LAT \?L128
	PUT ALREADY-SHOT,WHICH,1
	ZERO? WHICH \?L130
	CALL MUNG-TARGET >STACK
	RSTACK
?L130:	PRINTI "Fudge! Your tranquilizer dart hit the "
	PRINTD THORPE-SUB
	PRINTI ", and its metal hull can't be put to sleep! Tough luck, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."
?L128:	CALL TOO-BAD-BUT,PRSO
	PRINTR " moved since you aimed."
?L126:	EQUAL? PRSO,GLOBAL-SNARK,SNARK \FALSE
	GET LON-AIMED-AT,WHICH >STACK
	EQUAL? STACK,SNARK-LON \?L139
	GET LAT-AIMED-AT,WHICH >STACK
	EQUAL? STACK,SNARK-LAT \?L139
	PUT ALREADY-SHOT,WHICH,1
	SET 'SNARK-TRANKED,1
	SET 'SNARK-HLON,THORPE-HLON
	SET 'SNARK-HLAT,THORPE-HLAT
	ZERO? WHICH \?L141
	PRINTI "KA-VOOOM! The "
	PRINTD SNARK
	PRINTI " shudders and stops moving! You scored a clean hit with your "
	PRINTD BAZOOKA
	PRINTI "!
"
	CALL PRINT-ID,STR?170
	CALL TIP-SAYS
	PRINTI "Rats! There goes our safety shield!"" And he's right. Even though you've saved the "
	PRINTD AQUADOME
	PRINTI " from further danger of monster attack, the "
	PRINTD SUB
	PRINTI " is now exposed to the "
	PRINTD THORPE-SUB
	PRINTR "'s rocket weapon!"
?L141:	PRINTI "Right on! The dart hits the "
	PRINTD SNARK
	PRINTI " and sticks out of its side. The tranquilizer spreads through the "
	PRINTD SNARK
	PRINTI ", sending it to Slumberland.
But this may have been a bad move. With the "
	PRINTD SNARK
	PRINTI " fast asleep, its huge body can't hide you from the "
	PRINTD THORPE-SUB
	PRINTI "'s rocket attack!"
	CRLF
	CALL PRINT-ID,STR?171 >STACK
	RSTACK
?L139:	CALL TOO-BAD-BUT,PRSO
	PRINTR " moved since you aimed."

	.FUNCT MUNG-TARGET
	CALL SCORE-UPD,5
	FSET PRSO,MUNGBIT
	PRINTI "Great! You and Tip can see"
	CALL THE-PRSI-PRINT
	PRINTI " slam into the "
	PRINTD THORPE-SUB
	PRINTI "'s power pod!
""Hooray! That crippled the "
	PRINTD THORPE-SUB
	PRINTI " for keeps!"" Tip cheers.
You hear a voice come over the "
	PRINTD SONARPHONE
	PRINTI ": "
	CALL PRINT-ID,STR?172
?L3:	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", this is Sharon! Do you read me?"""
	CALL YES? >STACK
	ZERO? STACK /?L3
	PRINTI """Something hit us, and Thorpe's out cold! He cracked his skull on the bulkhead! I was waking up when I saw it all happen. I'll tie him up so he can't cause any trouble.
The "
	PRINTD THORPE-SUB
	PRINTI "'s regular engine is kaput, but he installed a backup engine for emergencies. And the sonar control's still working. If you like, I'll guide the monster to its cavern.""
"
	GETP GREENUP,P?VALUE >STACK
	ZERO? STACK /?L12
	CALL TIP-SAYS
	PRINTI "It's too bad we didn't find the "
	PRINTD TRAITOR
	PRINTI " at the "
	PRINTD AQUADOME
	PRINTI ".""
"
?L12:	PRINTI "
CONGRATULATIONS, "
	CALL PRINT-NAME,FIRST-NAME,1
	PRINTI "! YOU'VE COMPLETED YOUR MISSION!!"
	CALL SCORE-UPD,5
	CALL FINISH >STACK
	RSTACK

	.FUNCT MOUNT,WHICH,WEAPON,OBJ
	GET ON-SUB,WHICH >OBJ
	ZERO? OBJ /?L1
	MOVE OBJ,AIRLOCK
?L1:	PUT ON-SUB,WHICH,WEAPON
	RTRUE

	.FUNCT MOUNT-WEAPON,OBJ
	EQUAL? OBJ,BAZOOKA \?L1
	CALL SCORE-OBJ,BLY
	PUTP BAZOOKA,P?LDESC,STR?173
	GETP BAZOOKA,P?VALUE >STACK
	ZERO? STACK /?L3
	PRINTI """Of course I'll have to get it first."""
	CRLF
	CALL SCORE-OBJ,BAZOOKA
?L3:	CALL MOUNT,0,BAZOOKA
	JUMP ?L15
?L1:	EQUAL? OBJ,DART \?L8
	PUTP DART,P?LDESC,STR?174
	CALL SCORE-OBJ,HORVAK
	CALL MOUNT,1,DART
	JUMP ?L15
?L8:	GET ON-SUB,0 >STACK
	ZERO? STACK /?L9
	GET ON-SUB,1 >STACK
	ZERO? STACK /?L10
	PRINTI "The claws are holding all they can."
	CRLF
	RFALSE
?L10:	PUT ON-SUB,1,OBJ
	JUMP ?L15
?L9:	PUT ON-SUB,0,OBJ
?L15:	EQUAL? HERE,SUB,CRAWL-SPACE \?L16
	MOVE OBJ,SUB
	JUMP ?L19
?L16:	ZERO? SUB-IN-DOME /?L18
	MOVE OBJ,AIRLOCK
	JUMP ?L19
?L18:	MOVE OBJ,NORTH-TANK-AREA
?L19:	FSET OBJ,NDESCBIT
	FCLEAR OBJ,TAKEBIT
	FSET OBJ,TRYTAKEBIT
	RTRUE

	.FUNCT FINE-SEQUENCE
	ZERO? TIP-FOLLOWS-YOU? /FALSE
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK \FALSE
	CALL MOVE-HERE-NOT-SUB,BLY
	PRINTI """Are you ready to take off now, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "?"" Zoe Bly "
	IN? BLY,HERE \?L7
	PUSH STR?175
	JUMP ?L9
?L7:	PUSH STR?176
?L9:	PRINT STACK
	PRINTI "s anxiously."
	CALL YES? >STACK
	ZERO? STACK /FALSE
	PRINTI """Wait!"" Tip cuts in. "
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,TIP,FINE-GRID >STACK
	RSTACK

	.FUNCT BAZOOKA-F
	CALL WEAPON-F,BAZOOKA >STACK
	RSTACK

	.FUNCT I-THORPE-APPEARS
	GRTR? 17,SUB-LON /?L3
	LESS? -17,SUB-LAT /?L3
	EQUAL? SUB-DEPTH,AIRLOCK-DEPTH /?L1
?L3:	SUB MOVES,LEFT-DOME >STACK
	LESS? 40,STACK \FALSE
	SET 'LEFT-DOME,MOVES
	PRINTI "Suddenly "
	CALL TIP-SAYS
	CALL PRINT-NAME,FIRST-NAME
	EQUAL? SUB-DEPTH,AIRLOCK-DEPTH \?L10
	PRINTI ", what "
	PRINTD INTDIR
	PRINTI " do you think the "
	PRINTD SNARK
	PRINTR " went, anyway?"""
?L10:	PRINTR ", I wonder if we're at the right depth?"""
?L1:	CALL QUEUE,I-SNARK-ATTACKS,0
	CALL QUEUE,I-THORPE-APPEARS,0
	CALL QUEUE,I-THORPE-AWAKES,9 >STACK
	PUT STACK,0,1
	FSET SEARCH-BEAM,ONBIT
	PRINTI """Holy halibut!"" cries Tip. ""There's a big cloud of silt ahead in the "
	PRINTD SEARCH-BEAM
	PRINTI ". It's out of sonar range. This could be the "
	PRINTD SNARK
	PRINTI "! Want to hold course till we find out?"""
	CALL YES?
	PRINTI "However you steer, the cloud holds steady. You may be on a collision course with the behemoth that almost wrecked the "
	PRINTD AQUADOME
	PRINTI "!
"
	PRINTI "Your "
	PRINTD SEARCH-BEAM
	PRINTI " reveals TWO objects dead ahead!
One is the "
	PRINTD SNARK
	PRINTI ". To the left of the tentacled creature -- YOUR left -- you can make out a vehicle crawling along the ocean floor.
"
	CALL TIP-SAYS
	PRINTI "That's one of your Sea Cats!""
A voice crackles over the "
	PRINTD SONARPHONE
	PRINTI ": ""This is "
	PRINTD GLOBAL-THORPE
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! Do you read me?"""
	CALL YES?
	PRINTI "Your answer brings a rasping laugh. ""Of course you read me, or you wouldn't be answering! Your "
	PRINTD LAB-ASSISTANT
	PRINTI ", "
	PRINTD SHARON
	PRINTI ", is seated behind me. She'll enjoy what's about to happen as much as I will. Would you like to hear what's in store for you?"""
	CALL YES? >STACK
	ZERO? STACK \?L29
	PRINTI """You'll soon find out -- like it or not! "
	JUMP ?L33
?L29:	PRINTI """"
?L33:	PRINTI "I'll blast your sub with a rocket! Then I'll guide my synthetic monster to the "
	PRINTD AQUADOME
	PRINTI " to destroy it! Can you guess what sealed your doom, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK \?L38
	PRINTI """"
	JUMP ?L42
?L38:	PRINTI """I'll tell you anyhow. "
?L42:	PRINTI "I want to own the "
	PRINTD ORE-NODULES
	PRINTI " near the "
	PRINTD AQUADOME
	PRINTI "! Sharon and I consider it a wedding present from you and your dad ...""
Thorpe breaks off with a sudden gulp, followed by some noise and then a soft female voice:
"
?L47:	PRINTI """This is "
	PRINTD SHARON
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! Do you read me?"""
	CALL YES? >STACK
	ZERO? STACK /?L47
	CALL PHONE-ON,GLOBAL-SHARON,THORPE-SUB,SONARPHONE
	CALL QUEUE,I-UPDATE-THORPE,-1 >STACK
	PUT STACK,0,1
	FCLEAR SNARK,INVISIBLE
	FCLEAR THORPE-SUB,INVISIBLE
	ADD SUB-LON,SONAR-RANGE >STACK
	ADD 2,STACK >THORPE-LON
	SUB SUB-LAT,SONAR-RANGE >THORPE-LAT
	ADD THORPE-LON,THORPE-HLON >SNARK-LON
	SET 'SNARK-LAT,THORPE-LAT
	FSET THORPE,MUNGBIT
	PRINTI """Thank goodness! I conked Thorpe with a wrench! He fell onto the microphone, and he's too heavy for me to move!"""
	CRLF
	CALL SCORE-OBJ,SNARK
	RETURN 2

	.FUNCT SHARON-EXPLAINS
	EQUAL? PRSA,V?SAY /?L1
	PRINTI """Wait a second, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", till I catch my breath!"" Sharon cuts in. "
?L1:	CALL SHARON-ABOUT-THORPE
	PRINTI """Can I interrupt, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "?"" asks Tip."
	CALL YES? >STACK
	ZERO? STACK \?L8
	CALL TIP-SAYS
	PRINTI "Sorry, but I have to. This is important.""
"
?L8:	PRINTI """Sharon, how does Thorpe control the monster?""
""By sonar pulse signals,"" she replies. "
	CALL SHARON-ABOUT-MONSTER
	PRINTI """Is the transducer sending out signals now?"" Tip asks her.
""Yes, it operates all the time. Can you make out our position on your "
	PRINTD SONARSCOPE
	PRINTI "?""
""Thanks to the "
	PRINTD FINE-GRID
	PRINTI "!"" says Tip."
	ZERO? THROTTLE-SETTING /?L17
	SET 'THROTTLE-SETTING,0
	PRINTI " ""Maybe we'd better stop the "
	PRINTD SUB
	PRINTI " before we collide with you!""
Tip uses his dual-control throttle to stop your sub. Then he adds apologetically: ""This isn't mutiny, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! I just figured we should stop now."""
?L17:	CRLF
	CALL SHARON-ABOUT-CAT
	PRINTI """Was it out of control when it attacked the "
	PRINTD AQUADOME
	PRINTI "?"" asks Tip.
""Oh no!"" Sharon replies. "
?L24:	PRINTI """Thorpe has a helper at the "
	PRINTD AQUADOME
	PRINTI " who put a "
	PRINTD BLACK-BOX
	PRINTI " on the "
	PRINTD SONAR-EQUIPMENT
	PRINTI ", which made it emit signals to ATTRACT the monster and make it attack. Do you follow me so far, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK /?L24
	PRINTI """Good. Before that first attack, Thorpe got the monster close enough for the "
	PRINTD BLACK-BOX
	PRINTI " to take over. Then he surfaced near "
	PRINTD BAY
	PRINTI " to get me. By the time we went back to the ocean floor, something had gone wrong: the "
	PRINTD AQUADOME
	PRINTI " was okay, and the monster had wandered off to its cavern. That reminds me, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". "
?L33:	PRINTI "Do you want to take the monster to its cavern peacefully? (With no more sonar pulse input, it'll stay there until you're ready to study it scientifically.)"""
	CALL YES? >STACK
	ZERO? STACK \?L34
	PRINTI "(Better listen, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". Sharon's trying to show you how to deal with this threat to the "
	PRINTD AQUADOME
	PRINTI ".)
"""
	JUMP ?L33
?L34:	PRINTI """First tell me, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ": do you have any tranquilizer or weapon to use against it?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	PRINTI """Do you want to capture it for scientific study?"""
	CALL YES? >STACK
	ZERO? STACK /?L48
	PRINTI """Then try the following:
Position your sub on the other side of the monster -- on the monster's LEFT side -- just 5 meters from it. If anything goes wrong and it gets out of control, you can tranquilize it immediately."""
	CRLF
	CALL PRINT-ID,STR?177
	RTRUE
?L48:	PRINTR """That's odd! I thought you would."""

	.FUNCT SHARON-ABOUT-THORPE
	PRINTI """I'm not in on Thorpe's plot, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". I'm playing along, trying to wreck his plans. I know it was risky for me to leave that "
	PRINTD CATALYST-CAPSULE
	PRINTI " out of the "
	PRINTD SUB
	ZERO? SHARON-BROKE-CIRCUIT /?L3
	PRINTI ", and to open that "
	PRINTD CIRCUIT-BREAKER
?L3:	PRINTI ", but it was part of my plan, and you got to the "
	PRINTD AQUADOME
	PRINTR " anyway."""

	.FUNCT SHARON-ABOUT-MONSTER
	PRINTI """It's sensitive to the signals on its RIGHT side. Thorpe has installed a sonar transducer on the LEFT or PORT side of this sub. He has to stay on the same side of the monster all the time."""
	RTRUE

	.FUNCT SHARON-ABOUT-CAT
	PRINTI "Sharon says, ""Notice how we keep 5 meters to the monster's right and 5 meters behind its nose. The Sea Cat is programmed that way, so the signals reach the monster with enough strength to keep it in control."""
	RTRUE

	.FUNCT I-THORPE-AWAKES
	FCLEAR THORPE,MUNGBIT
	SET 'SUB-IN-BATTLE,1
	CALL PHONE-OFF
	CALL PHONE-ON,GLOBAL-THORPE,THORPE-SUB,SONARPHONE
	PRINTI "
Suddenly the sonarphone gets louder.
"
	CALL TIP-SAYS
	PRINTI "That could mean Thorpe is awake and has moved away from the microphone!""
You hear a sharp cry of pain from Sharon, then Thorpe yelling: ""That'll take care of you, my little double-crosser!""
Thorpe speaks into the microphone: ""Now then, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI " "
	CALL PRINT-NAME,LAST-NAME
	PRINTI ", I'm stopping my "
	PRINTD THORPE-SUB
	PRINTI " so I can blow you into Kingdom Come as soon as you're in my sights!""
"
	CALL STARBOARD-OF-THORPE?,SUB-LON,SUB-LAT >STACK
	ZERO? STACK \?L5
	CALL TIP-SAYS
	PRINTI "He'll have to go around the "
	PRINTD SNARK
	PRINTI " to fire at us, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! And we'll have to go around its tail to shoot at HIM!""
"
?L5:	CALL TELL-HINT,42,THORPE-SUB,0
	RETURN 2

	.FUNCT RANDOM-PSEUDO
	PRINTR "You can't do anything useful with that."

	.FUNCT NOT-HERE-OBJECT-F,TBL,PRSO?=1,OBJ
	EQUAL? PRSO,NOT-HERE-OBJECT \?L7
	EQUAL? PRSI,NOT-HERE-OBJECT \?L1
	PRINTI "(Those things aren't here!)"
	CRLF
	RETURN 2
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L7
	SET 'TBL,P-PRSO
	JUMP ?L8
?L7:	SET 'TBL,P-PRSI
	SET 'PRSO?,0
?L8:	EQUAL? PRSA,V?SEARCH-FOR,V?ASK-FOR,V?ASK-ABOUT \?L9
	FSET? PRSO,PERSON \?L9
	IN? PRSO,GLOBAL-OBJECTS \?L9
	PRINTD PRSO
	CALL NOT-HERE-PERSON,PRSO
?L9:	ZERO? PRSO? /?L14
	EQUAL? PRSA,V?ASK-CONTEXT-ABOUT,V?BOARD,V?ASK-CONTEXT-FOR /?L18
	EQUAL? PRSA,V?TAKE-WITH,V?FIND,V?FOLLOW /?L18
	EQUAL? PRSA,V?USE,V?LEAVE,V?DISEMBARK /?L18
	EQUAL? PRSA,V?PHONE,V?THROUGH,V?WALK-TO /?L18
	EQUAL? PRSA,V?WHAT /?L18
	EQUAL? PRSA,V?BRING,V?TAKE,V?SSHOW \?L39
	EQUAL? WINNER,PLAYER /?L39
?L18:	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT /?L39
	RETURN 2
?L14:	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR,V?TAKE-TO /?L31
	EQUAL? PRSA,V?SEARCH-FOR,V?TELL-ABOUT /?L31
	EQUAL? PRSA,V?SBRING,V?SHOW \?L39
	EQUAL? WINNER,PLAYER /?L39
?L31:	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT /?L39
	RETURN 2
?L39:	PRINTI "(You can't see any"
	CALL NOT-HERE-PRINT
	PRINTI " here!)"
	CRLF
	RETURN 2

	.FUNCT FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ,PERSON?=1
	CALL MOBY-FIND,TBL >M-F
	ZERO? DEBUG /?L1
	PRINTI "[Found "
	PRINTN M-F
	PRINTI " objects]"
	CRLF
?L1:	EQUAL? 1,M-F \?L6
	ZERO? DEBUG /?L8
	PRINTI "[Namely: "
	PRINTD P-MOBY-FOUND
	PRINTI "]"
	CRLF
?L8:	ZERO? PRSO? /?L13
	SET 'PRSO,P-MOBY-FOUND
	RFALSE
?L13:	SET 'PRSI,P-MOBY-FOUND
	RFALSE
?L6:	LESS? 1,M-F \?L16
	GET TBL,1 >OBJ
	GETP OBJ,P?GENERIC >STACK
	CALL STACK,OBJ >OBJ
	ZERO? OBJ /?L16
	ZERO? DEBUG /?L17
	PRINTI "[Generic: "
	PRINTD OBJ
	PRINTI "]"
	CRLF
?L17:	EQUAL? OBJ,NOT-HERE-OBJECT /TRUE
	ZERO? PRSO? /?L24
	SET 'PRSO,OBJ
	RFALSE
?L24:	SET 'PRSI,OBJ
	RFALSE
?L16:	ZERO? PRSO? \?L80
	IN? PRSO,HERE \?L28
	EQUAL? PRSA,V?TELL-ABOUT,V?ASK-FOR,V?ASK-ABOUT /?L30
?L28:	ZERO? PRSO? /?L29
?L80:	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L29
	EQUAL? PRSA,V?ASK-CONTEXT-FOR,V?ASK-CONTEXT-ABOUT /?L30
?L29:	EQUAL? WINNER,PLAYER /?L26
	EQUAL? PRSA,V?SGIVE /?L30
	EQUAL? PRSA,V?GIVE,V?WHAT,V?FIND \?L26
?L30:	EQUAL? PRSA,V?ASK-FOR,V?ASK-ABOUT \?L31
	FSET? PRSO,PERSON /?L33
	SET 'PERSON?,0
	PRINTI "The "
?L33:	PRINTD PRSO
	JUMP ?L57
?L31:	CALL QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L40
	FSET? QCONTEXT,PERSON /?L41
	SET 'PERSON?,0
	PRINTI "The "
?L41:	PRINTD QCONTEXT
	JUMP ?L57
?L40:	EQUAL? WINNER,PLAYER /?L48
	PRINTD WINNER
	JUMP ?L57
?L48:	CALL FIND-FLAG,HERE,PERSON,PLAYER >OBJ
	ZERO? OBJ /?L51
	PRINTD OBJ
	JUMP ?L57
?L51:	CALL VISIBLE?,TIP >STACK
	ZERO? STACK /?L54
	PRINTI "Tip"
	JUMP ?L57
?L54:	PRINTI "Someone"
?L57:	ZERO? PERSON? \?L60
	PRINTI " isn't connected to any"
	JUMP ?L64
?L60:	PRINTI " looks confused. ""I don't know anything about any"
?L64:	CALL NOT-HERE-PRINT
	PRINTI "!"
	ZERO? PERSON? /?L69
	PRINTI """"
?L69:	CRLF
	RTRUE
?L26:	ZERO? PRSO? \?L74
	PRINTI "You wouldn't find any"
	CALL NOT-HERE-PRINT
	PRINTR " there."
?L74:	RETURN NOT-HERE-OBJECT

	.FUNCT NOT-HERE-PRINT
	ZERO? P-OFLAG \?L3
	ZERO? P-MERGED /?L1
?L3:	ZERO? P-XADJ /?L4
	PRINTI " "
	PRINTB P-XADJN
?L4:	ZERO? P-XNAM /FALSE
	PRINTI " "
	PRINTB P-XNAM
	RTRUE
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L14
	GET P-ITBL,P-NC1L >STACK
	GET P-ITBL,P-NC1 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK
?L14:	GET P-ITBL,P-NC2L >STACK
	GET P-ITBL,P-NC2 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK

	.FUNCT THE?,NOUN
	FSET? NOUN,PERSON \?L4
	EQUAL? NOUN,PLAYER \TRUE
?L4:	FSET? NOUN,NARTICLEBIT /TRUE
	PRINTI " the"
	RTRUE

	.FUNCT NOTEBOOK-F
	EQUAL? PRSA,V?TELL-ABOUT,V?ANALYZE /?L3
	EQUAL? PRSA,V?EXAMINE,V?READ,V?OPEN \FALSE
?L3:	PRINTI "(You'll find the "
	PRINTD NOTEBOOK
	PRINTI " in your "
	PRINTD GAME
	PRINTR " package.)"

	.FUNCT MAGAZINE-F
	EQUAL? PRSA,V?OPEN,V?LOOK-INSIDE \?L1
	CALL NOT-HOLDING?,MAGAZINE >STACK
	ZERO? STACK \TRUE
	RFALSE
?L1:	EQUAL? PRSA,V?LOOK-UP \?L6
	EQUAL? PRSO,GLOBAL-THORPE \?L6
	CALL PERFORM,V?READ,ARTICLE
	RTRUE
?L6:	EQUAL? PRSA,V?ANALYZE,V?EXAMINE,V?READ \FALSE
	CALL NOT-HOLDING?,MAGAZINE >STACK
	ZERO? STACK \TRUE
	PRINTI """Science World"" is a popular "
	PRINTD MAGAZINE
	PRINTI " about new scientific developments.
The cover shows "
	PRINTD GLOBAL-THORPE
	PRINTR ", marine biologist, surrounded by imaginative drawings of weird undersea life forms. The cover says:
""HOT FLASH FROM THE MARINE BIOLOGY FRONT!
... NEW SEA CREATURES SPAWNED BY TEST TUBE?
(SEE ARTICLE INSIDE)"""

	.FUNCT ARTICLE-F
	CALL DIVESTMENT?,ARTICLE >STACK
	ZERO? STACK /?L1
	CALL PERFORM,PRSA,MAGAZINE,PRSI
	RTRUE
?L1:	EQUAL? PRSA,V?ANALYZE /?L4
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE,V?READ \FALSE
?L4:	CALL NOT-HOLDING?,MAGAZINE >STACK
	ZERO? STACK \TRUE
	PRINTI "It says that "
	PRINTD GLOBAL-THORPE
	PRINTI " may have created synthetic forms of marine life by genetic engineering. You learn that Thorpe went into hiding to duck publicity, but before that he told friends he would soon marry "
	PRINTD SHARON
	PRINTR ".
The form of the creatures is unknown. They may be stimulated by ultrasonic pulses and might be trained to respond to such pulses.
Some scientists are skeptical, but Thorpe has claimed that one-celled organisms had evolved in his lab from AMINO-HYDROPHASE or A.H. If rumors are true, these synthetic sea creatures should be based on the A.H. molecule."

	.FUNCT CATALYST-CAPSULE-F
	EQUAL? PRSA,V?COMPARE \?L1
	EQUAL? PRSI,CATALYST-CAPSULE \?L4
	EQUAL? PRSO,REACTOR /?L3
?L4:	EQUAL? PRSO,CATALYST-CAPSULE \?L1
	EQUAL? PRSI,REACTOR \?L1
?L3:	PRINTI "It looks as if the "
	PRINTD CATALYST-CAPSULE
	PRINTI " fits perfectly into the "
	PRINTD REACTOR
	PRINTR "."
?L1:	EQUAL? PRSA,V?FIND \?L7
	FSET? CATALYST-CAPSULE,TOUCHBIT /?L7
	PRINTI "The capsule is usually stored on a "
	PRINTD WORK-COUNTER
	PRINTR " on the west wall of the tank area."
?L7:	EQUAL? PRSA,V?PUT \?L10
	EQUAL? PRSI,LOCAL-SUB,GLOBAL-SUB \?L10
	PRINTR "You'll have to take it there yourself."
?L10:	EQUAL? PRSA,V?TAKE \FALSE
	FSET? CATALYST-CAPSULE,TRYTAKEBIT \FALSE
	PRINTR "It's too hot to pick up."

	.FUNCT GENERIC-OXYGEN-GEAR-F,OBJ
	CALL REMOTE-VERB? >STACK
	ZERO? STACK /?L1
	RETURN OXYGEN-GEAR
?L1:	EQUAL? PRSA,V?TAKE \FALSE
	ZERO? PRSI /FALSE
	FSET? PRSI,PERSON \FALSE
	EQUAL? PRSI,ANTRIM,SIEGEL,HORVAK \?L4
	RETURN OXYGEN-GEAR-OTHER
?L4:	EQUAL? PRSI,LOWELL,GREENUP \?L6
	RETURN OXYGEN-GEAR-DIVER
?L6:	EQUAL? PRSI,BLY \FALSE
	RETURN OXYGEN-GEAR-BLY

	.FUNCT OXYGEN-GEAR-GLOBAL-F
	ZERO? SUB-IN-DOME /?L3
	CALL FIND-FLAG,HERE,PERSON,WINNER >STACK
	ZERO? STACK \?L1
?L3:	CALL NOT-HERE,OXYGEN-GEAR-OTHER >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE,V?TELL-ABOUT,V?SEARCH-FOR /FALSE
	EQUAL? PRSA,V?FIND,V?ASK-CONTEXT-ABOUT,V?ASK-ABOUT /FALSE
	CALL YOU-CANT >STACK
	RSTACK

	.FUNCT OXYGEN-GEAR-F
	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	FCLEAR OXYGEN-GEAR,NDESCBIT
	EQUAL? PRSA,V?TAKE \?L4
	EQUAL? PRSO,OXYGEN-GEAR \?L4
	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
	PRINTI "You're now wearing"
	CALL THE-PRSO-PRINT
	PRINTR " around your neck."
?L4:	EQUAL? PRSA,V?OPEN /?L12
	EQUAL? PRSA,V?USE,V?TURN,V?LAMP-ON \?L11
?L12:	FSET? OXYGEN-GEAR,ONBIT \?L13
	CALL ALREADY,OXYGEN-GEAR,STR?18
	RTRUE
?L13:	CALL NOT-HOLDING?,OXYGEN-GEAR >STACK
	ZERO? STACK \TRUE
	ZERO? DOME-AIR-BAD? \?L16
	PRINTR "You don't need it now!"
?L16:	FSET OXYGEN-GEAR,ONBIT
	PRINTI "As you open the valve and suck on the rubber straw, you feel your lungs filling with pure oxygen."
	ZERO? DOME-AIR-BAD? /?L22
	CALL CORRIDOR-LOOK,BLY >STACK
	ZERO? STACK /?L22
	CRLF
	PRINTI "But you notice Zoe Bly collapsing, and you realize she has no "
	PRINTD OXYGEN-GEAR
	PRINTI "!"
?L22:	CRLF
	RTRUE
?L11:	EQUAL? PRSA,V?CLOSE \FALSE
	CALL PERFORM,V?LAMP-OFF,OXYGEN-GEAR
	RTRUE

	.FUNCT BADGE-PLAYER-F
	CALL DIVESTMENT?,BADGE-PLAYER >STACK
	ZERO? STACK /?L1
	PRINTI "That wouldn't be good for security."
	CRLF
	CALL PRINT-ID,STR?178 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	PRINTI "It's a special identification badge for"
	CALL RESEARCH-LAB
	PRINTR "."

	.FUNCT GENERIC-TOOL-F,OBJ
	EQUAL? PRSA,V?TAKE-WITH,V?OPEN-WITH \FALSE
	RETURN UNIVERSAL-TOOL

	.FUNCT V-$0024BAY
	ZERO? SUB-IN-TANK \?L1
	PRINTR "too late"
?L1:	SET 'HERE,SUB
	MOVE PLAYER,SUB
	MOVE TIP,SUB
	MOVE CATALYST-CAPSULE,REACTOR
	FCLEAR REACTOR,OPENBIT
	FSET REACTOR,ONBIT
	FSET ENGINE,ONBIT
	FCLEAR SUB-DOOR,OPENBIT
	SET 'MONSTER-GONE,1
	SET 'JOYSTICK-DIR,P?EAST
	SET 'SUB-DLON,1
	SET 'SUB-DLAT,0
	SET 'NOW-TERRAIN,BAY-TERRAIN
	SET 'SUB-IN-TANK,0
	CALL QUEUE,I-UPDATE-SUB-POSITION,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT AQUADOME-F
	EQUAL? PRSA,V?WHAT,V?FIND /?L3
	EQUAL? PRSA,V?ASK-ABOUT \?L1
	FSET? PRSO,PERSON \?L1
?L3:	EQUAL? NOW-TERRAIN,SEA-TERRAIN \?L4
	EQUAL? HERE,SUB \?L4
	CALL PERFORM,V?FIND,PLAYER
	RTRUE
?L4:	ZERO? SUB-IN-OPEN-SEA /?L6
	PRINTI "Its location is stored in the "
	PRINTD AUTO-PILOT
	PRINTR "'s computer memory."
?L6:	ZERO? SUB-IN-DOME \FALSE
	EQUAL? NOW-TERRAIN,SEA-TERRAIN /FALSE
	PRINTI """The "
	PRINTD AQUADOME
	PRINTI " encloses the "
	PRINT URS
	PRINTI " of "
	PRINTD IU-GLOBAL
	PRINTI ", on the ocean floor off the Atlantic coast. Most "
	CALL PRINT-NAME,LAST-NAME
	PRINTI " subs can reach it by "
	PRINTD AUTO-PILOT
	PRINTR "."""
?L1:	EQUAL? PRSA,V?EXAMINE \?L13
	LESS? DISTANCE-FROM-BAY,AQUADOME-VISIBLE /?L13
	SET 'P-WON,0
	GETP LOCAL-SUB,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L13:	EQUAL? PRSA,V?LOOK-OUTSIDE,V?LOOK-INSIDE \?L16
	CALL PERFORM,PRSA,WINDOW
	RTRUE
?L16:	EQUAL? PRSA,V?THROUGH \?L17
	EQUAL? HERE,SUB,CRAWL-SPACE \FALSE
	PRINTR "Wait until you're close enough."
?L17:	EQUAL? PRSA,V?WALK-AROUND \?L23
	CALL GO-NEXT,IN-DOME-AROUND >STACK
	ZERO? STACK /TRUE
	EQUAL? WINNER,PLAYER /TRUE
	CALL OKAY
	RTRUE
?L23:	EQUAL? PRSA,V?WALK-TO \FALSE
	ZERO? SUB-IN-DOME /?L28
	PRINTR "You're in it!"
?L28:	ZERO? SUB-IN-OPEN-SEA /?L32
	PRINTI "Let the "
	PRINTD AUTO-PILOT
	PRINTR " handle that."
?L32:	PRINTR "First you must reach the open sea."

	.FUNCT IN-DOME?,RM
	EQUAL? RM,SUB,CRAWL-SPACE \?L1
	RETURN SUB-IN-DOME
?L1:	CALL ZMEMQ,RM,IN-DOME-AROUND >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT AIR-ROOM?,RM
	EQUAL? RM,FOOT-OF-RAMP,AIRLOCK,AIRLOCK-WALL /TRUE
	EQUAL? RM,CENTER-OF-DOME,OUTSIDE-ADMIN-BLDG,BLY-OFFICE /TRUE
	EQUAL? RM,SUB /TRUE
	RFALSE

	.FUNCT THROUGH-ROOF?,RM,HR=0
	ZERO? HR \?L1
	SET 'HR,HERE
?L1:	EQUAL? HR,SUB,CRAWL-SPACE,AIRLOCK \?L4
	EQUAL? RM,SUB,CRAWL-SPACE,AIRLOCK /FALSE
	RTRUE
?L4:	EQUAL? RM,SUB,CRAWL-SPACE,AIRLOCK \FALSE
	RTRUE

	.FUNCT WINDOW-F,POP
	EQUAL? PRSA,V?BRUSH \?L1
	PRINTI "The window is clean enough without your interference."
	CRLF
	CALL PRINT-ID,STR?179 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	PRINTR "The window is a simple plastic sheet, giving a view of the dome outside."
?L5:	EQUAL? PRSA,V?LOOK-OUTSIDE,V?LOOK-INSIDE \?L8
	ZERO? SNARK-ATTACK-COUNT \?L9
	PRINTR "You can see the dome outside."
?L9:	MOVE BLY,HERE
	PRINTI "The "
	PRINTD AQUADOME
	PRINTI "'s search lights probe the ocean, but the "
	PRINTD GLOBAL-WATER
	PRINTI " is too murky for the beams to penetrate.
""Tip's right!"" "
	PRINTD BLY
	PRINTI " says. ""That must be the "
	PRINTD SNARK
	PRINTI " out there. Its tentacles churned up silt from the seabed that way during its first attack, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"""
?L8:	EQUAL? PRSA,V?MUNG \?L16
	PRINTI "Vandalism is for vandals, not famous inventors!"
	CRLF
	CALL PRINT-ID,STR?180 >STACK
	RSTACK
?L16:	EQUAL? PRSA,V?UNLOCK /?L20
	EQUAL? PRSA,V?LOCK,V?CLOSE,V?OPEN \FALSE
?L20:	PRINTR "The window can't be opened."

	.FUNCT EXERCISE-TRACK-F
	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?FIND \FALSE
	ZERO? SUB-IN-DOME /FALSE
	PRINTI "You don't need exercise!"
	CRLF
	CALL PRINT-ID,STR?181 >STACK
	RSTACK

	.FUNCT AIRLOCK-F,RARG=0
	EQUAL? RARG,M-ENTER \?L1
	ZERO? GREENUP-ESCAPE \?L5
	ZERO? GREENUP-TRAPPED /FALSE
?L5:	MOVE LOWELL,HERE
	MOVE ANTRIM,HERE
	PRINTR "Two of the crew are with you."
?L1:	EQUAL? RARG,M-LOOK \?L9
	PRINTI "You're now in the "
	PRINTD AIRLOCK
	PRINTR ", at the foot of the ramp."
?L9:	ZERO? RARG \FALSE
	CALL REMOTE-VERB? >STACK
	ZERO? STACK /?L13
	EQUAL? PRSA,V?WALK-TO,V?THROUGH \FALSE
?L13:	ZERO? SUB-IN-DOME \?L14
	CALL SUB-OUTSIDE-AIRLOCK? >STACK
	ZERO? STACK \?L14
	CALL NOT-HERE,AIRLOCK >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?EMPTY \?L15
	ZERO? AIRLOCK-FULL \?L16
	CALL ALREADY,AIRLOCK,STR?23 >STACK
	RSTACK
?L16:	FSET? AIRLOCK-HATCH,OPENBIT \?L18
	CALL YOU-CANT,0,AIRLOCK-HATCH,STR?22 >STACK
	RSTACK
?L18:	EQUAL? HERE,SUB,CRAWL-SPACE /?L20
	EQUAL? HERE,BLY-OFFICE,FOOT-OF-RAMP \FALSE
?L20:	CALL QUEUE,I-AIRLOCK-EMPTY,2 >STACK
	PUT STACK,0,1
	PRINTR "This will take 1 turn."
?L15:	EQUAL? PRSA,V?FILL \?L24
	ZERO? AIRLOCK-FULL /?L25
	CALL ALREADY,AIRLOCK,STR?24
	RTRUE
?L25:	FSET? AIRLOCK-ELECTRICITY,ONBIT /?L27
	CALL YOU-CANT,0,AIRLOCK-ELECTRICITY,STR?39
	RTRUE
?L27:	CALL AIRLOCK-POP? >STACK
	ZERO? STACK /?L28
	CALL PRINT-ID,STR?182
	CALL YOU-CANT,0,AIRLOCK,STR?183
	RTRUE
?L28:	ZERO? GREENUP-ESCAPE \?L58
	FSET? SUB-DOOR,OPENBIT \?L32
	CALL PRINT-ID,STR?184
	CALL YOU-CANT,0,SUB-DOOR,STR?22
	RTRUE
?L32:	FSET? AIRLOCK-ROOF,OPENBIT \?L35
	CALL THIS-IS-IT,AIRLOCK-ROOF
	PRINTI "A safety mechanism prevents it. The "
	PRINTD AIRLOCK-ROOF
	PRINTR " is open!"
?L35:	ZERO? GREENUP-ESCAPE /?L41
?L58:	GRTR? 4,GREENUP-ESCAPE \?L41
	PRINTI "Greenup is frantically scrambling back up the ladder to avoid being swept off and drowned! "
	CALL GREENUP-CUFF
	PRINTI "Tip immediately empties the "
	PRINTD AIRLOCK
	PRINTR " again."
?L41:	EQUAL? HERE,SUB,CRAWL-SPACE /?L48
	EQUAL? HERE,BLY-OFFICE,FOOT-OF-RAMP \FALSE
?L48:	CALL QUEUE,I-AIRLOCK-EMPTY,2 >STACK
	PUT STACK,0,1
	PRINTR "This will take 1 turn."
?L24:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L52
	CALL PERFORM,PRSA,AIRLOCK-HATCH
	RTRUE
?L52:	EQUAL? PRSA,V?WALK-TO,V?THROUGH \FALSE
	ZERO? SUB-IN-DOME \?L54
	EQUAL? HERE,SUB,CRAWL-SPACE \?L54
	CALL TOO-BAD-BUT,PRSO,STR?21
	RTRUE
?L54:	SET 'PRSO,AIRLOCK
	CALL CHEERS?
	RFALSE

	.FUNCT CHEERS?
	EQUAL? WINNER,PLAYER \FALSE
	CALL ZMEMQ,HERE,IN-DOME-AROUND >STACK
	ZERO? STACK /FALSE
	EQUAL? HERE,AIRLOCK,AIRLOCK-WALL /FALSE
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK /FALSE
	PRINTI "Cheers follow as you start up the ladder into the "
	PRINTD AIRLOCK
	PRINTI "."
	CRLF
	CALL PRINT-ID,STR?185 >STACK
	RSTACK

	.FUNCT I-AIRLOCK-EMPTY
	ZERO? AIRLOCK-FULL /?L1
	FSET? AIRLOCK-HATCH,OPENBIT /FALSE
	SET 'AIRLOCK-FULL,0
	CRLF
	PRINTI "The "
	PRINTD AIRLOCK
	PRINTI " is now clear of "
	PRINTD GLOBAL-WATER
	PRINTI " and filled with air at sea-level pressure."
	FSET? ENGINE,ONBIT \?L8
	FCLEAR ENGINE,ONBIT
	PRINTI " The engine shuts off."
?L8:	FSET AIRLOCK-ROOF,OPENBIT
	CALL THIS-IS-IT,SUB-DOOR
	CRLF
	PRINTI "The roof of the "
	PRINTD AIRLOCK
	PRINTI " is sliding open, and the "
	PRINTD SUB
	PRINTI " is in dry dock.
A ramp swings down from the top of the "
	PRINTD AIRLOCK
	PRINTI "'s north wall to your "
	PRINTD SUB-DOOR
	PRINTI "."
	CRLF
	RETURN 2
?L1:	SET 'AIRLOCK-FULL,1
	CRLF
	PRINTI "The "
	PRINTD AIRLOCK
	PRINTI " is now filled with "
	PRINTD GLOBAL-WATER
	PRINTI "."
	CRLF
	ZERO? SUB-IN-DOME /FALSE
	PRINTI "The adjustable cradle then releases the "
	PRINTD SUB
	PRINTR "'s keel from its grip."

	.FUNCT GREENUP-LADDER-F
	EQUAL? PRSA,V?THROUGH,V?CLIMB-UP /?L3
	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-DOWN,V?BOARD \FALSE
?L3:	PRINTI "The "
	PRINTD GREENUP-LADDER
	PRINTR " is only for emergencies."

	.FUNCT AIRLOCK-RAMP-F
	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-DOWN,V?BOARD \?L1
	EQUAL? HERE,AIRLOCK-WALL \?L1
	CALL DO-WALK,P?SOUTH
	RTRUE
?L1:	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-UP,V?BOARD \FALSE
	EQUAL? HERE,AIRLOCK \FALSE
	CALL DO-WALK,P?NORTH
	RTRUE

	.FUNCT AIRLOCK-WALL-F,ARG=0
	EQUAL? ARG,M-LOOK \FALSE
	PRINTI "You're now atop the north wall of the "
	PRINTD AQUADOME
	PRINTI "'s "
	PRINTD AIRLOCK
	PRINTI "."
	CRLF
	PRINTI "This gives you a bird's-eye view of the whole "
	PRINT URS
	PRINTI " of "
	PRINTD IU-GLOBAL
	PRINTI ".

The dome is a transparent hemisphere made of plastic of great strength, developed by you for this specific purpose. The dome encloses the four attached buildings of the "
	PRINT URS
	PRINTI ": the workshop/lab and dormitory in the western half of the dome, and the administration and communication buildings in the eastern half.
"
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L7
	PRINTI "In the very center is the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI ". This is in a cylinder that runs from the floor to the top of the dome. It extracts oxygen from "
	PRINTD GLOBAL-WATER
	PRINTI " and emits it through small holes around its base to keep the air fresh at all times.
"
?L7:	PRINTI "A ladder goes from here down to the floor of the "
	PRINTD AQUADOME
	PRINTI ", outside the "
	PRINTD AIRLOCK
	PRINTI "'s north wall.
"
	CALL CREW-5-TOGETHER? >STACK
	ZERO? STACK /FALSE
	IN? CREW,FOOT-OF-RAMP \FALSE
	FSET? BLY,MUNGBIT /FALSE
	PRINTD BLY
	PRINTI " and her five "
	PRINTD CREW
	PRINTI " are"
	FSET? FOOT-OF-RAMP,TOUCHBIT /?L18
	PRINTI " waiting to greet you"
?L18:	PRINTR " at the foot of this ladder."

	.FUNCT AIRLOCK-LADDER-F
	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-DOWN,V?BOARD \?L1
	EQUAL? HERE,AIRLOCK-WALL \?L1
	CALL DO-WALK,P?NORTH
	RTRUE
?L1:	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-UP,V?BOARD \FALSE
	EQUAL? HERE,FOOT-OF-RAMP \FALSE
	CALL DO-WALK,P?SOUTH
	RTRUE

	.FUNCT CREW-F
	ZERO? DOME-AIR-BAD? /?L3
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT /?L1
?L3:	EQUAL? PRSA,V?ASK-ABOUT \?L5
	FSET? PRSO,PERSON \?L5
	EQUAL? PRSI,CREW-GLOBAL,CREW /?L4
?L5:	EQUAL? PRSA,V?WHAT \?L6
	EQUAL? PRSO,CREW-GLOBAL,CREW /?L4
?L6:	EQUAL? PRSA,V?TELL-ABOUT \?L1
	EQUAL? PRSO,PLAYER \?L1
?L4:	PRINTI """The crew consists of:
Doctor Walt Horvak, marine biologist and first-aid medic;
"
	PRINTD ANTRIM
	PRINTI ", laser expert and frogman;
"
	PRINTD SIEGEL
	PRINTI ", electronics expert in charge of communications; and
"
	PRINTD GREENUP
	PRINTI " and "
	PRINTD LOWELL
	PRINTR ", diver-technicians."""
?L1:	EQUAL? PRSA,V?TELL-ABOUT,V?TELL /?L10
	EQUAL? PRSA,V?ASK-FOR,V?ASK-ABOUT,V?ASK \?L9
?L10:	EQUAL? PRSO,CREW \?L9
	PRINTI "You'd better talk to one crew member at a time."
	CRLF
	RETURN 2
?L9:	EQUAL? PRSA,V?HELLO,V?GOODBYE \?L15
	EQUAL? PRSO,CREW \?L15
	PRINTD PRSO
	PRINTR " nods at you."
?L15:	EQUAL? PRSA,V?EXAMINE,V?DIAGNOSE \FALSE
	ZERO? DOME-AIR-BAD? /?L19
	PRINTD BLY
	PRINTR " and the two divers, Greenup and Lowell, are without oxygen."
?L19:	PRINTR "All the crew members are okay now."

	.FUNCT CREW-GLOBAL-F,L
	CALL SPEAKING-VERB? >STACK
	ZERO? STACK /?L1
	EQUAL? PRSO,CREW-GLOBAL \?L1
	PRINTI "The "
	PRINTD CREW-GLOBAL
	CALL NOT-HERE-PERSON,CREW
	SET 'P-CONT,0
	RTRUE
?L1:	EQUAL? PRSA,V?WALK-TO \?L5
	CALL PERFORM,PRSA,CREW
	RTRUE
?L5:	CALL CREW-F >STACK
	RSTACK

	.FUNCT GENERIC-BADGE-F,OBJ
	RETURN BADGE-GLOBAL

	.FUNCT BADGE-GLOBAL-F
	ZERO? SUB-IN-DOME /?L3
	CALL FIND-FLAG,HERE,PERSON,WINNER >STACK
	ZERO? STACK \?L1
?L3:	CALL NOT-HERE,BADGE-GLOBAL-3 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	CALL EXAMINE-BADGE
	CRLF
	RTRUE

	.FUNCT EXAMINE-BADGE
	ZERO? DOME-AIR-BAD? /?L1
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L3
	PRINTI "The badge is turning red! The air is becoming unbreathable!"
	RTRUE
?L3:	PRINTI "The badge is less red now. The air is improving."
	RTRUE
?L1:	PRINTI "When a badge turns red, the air is no longer breathable. It's not red now."
	RTRUE

	.FUNCT BAD-AIR?
	ZERO? DOME-AIR-BAD? /FALSE
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \FALSE
	CALL AIR-SUPPLY-VERB? >STACK
	ZERO? STACK \FALSE
	PRINTI "Shouldn't you fix the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTR " first?"

	.FUNCT TROUBLE-BREATHING?
	EQUAL? PRSA,V?WAIT-UNTIL,V?WAIT-FOR /FALSE
	IN? OXYGEN-GEAR,PLAYER \?L4
	FSET? OXYGEN-GEAR,ONBIT /FALSE
?L4:	PRINTI "You are having "
	GRTR? 13,DOME-AIR-BAD? /?L7
	PRINTI "real "
?L7:	PRINTI "trouble breathing."
	CRLF
	CALL PRINT-ID,STR?186 >STACK
	RSTACK

	.FUNCT TIP-REPORTS?
	EQUAL? HERE,CENTER-OF-DOME /FALSE
	CALL CORRIDOR-LOOK,AIR-SUPPLY-SYSTEM >STACK
	ZERO? STACK \FALSE
	EQUAL? HERE,SUB,CRAWL-SPACE,AIRLOCK \?L3
	MOVE TIP,AIRLOCK-WALL
?L3:	PRINTI "Tip, who is standing near the exit, reports that "
	RTRUE

	.FUNCT I-DOME-AIR,CALLED?=0,X
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L1
	ZERO? DOME-AIR-BAD? \?L3
	SET 'DOME-AIR-BAD?,INITIAL-DOME-AIR-BAD
	SET 'DOME-AIR-CRIME,1
	CALL QUEUE,I-DOME-AIR,-1 >STACK
	PUT STACK,0,1
	CALL VISIBLE?,BLY >X
	FSET BLY,MUNGBIT
	FSET GREENUP,MUNGBIT
	FSET LOWELL,MUNGBIT
	CALL TIP-REPORTS? >STACK
	ZERO? STACK \?L5
	PRINTI "Suddenly you realize that "
?L5:	PRINTI "Zoe is literally gasping for breath. Her face is turning reddish-purple! She clutches her throat...
Everyone"
	ZERO? CALLED? \?L17
	IN? OXYGEN-GEAR,PLAYER \?L14
	FSET? OXYGEN-GEAR,ONBIT \?L14
	PRINTI ", except you,"
	JUMP ?L17
?L14:	PRINTI ", including yourself,"
?L17:	PRINTR " is having trouble breathing!"
?L3:	CALL TROUBLE-BREATHING?
	INC 'DOME-AIR-BAD?
	EQUAL? 7,DOME-AIR-BAD? \?L23
	CRLF
	PRINTI "In 10 turns Bly, Greenup and Lowell, who were not carrying "
	PRINTD OXYGEN-GEAR
	PRINTI ", will suffocate from lack of oxygen. In 20 turns, "
	IN? OXYGEN-GEAR,PLAYER \?L27
	PRINTI "you and the others"
	JUMP ?L31
?L27:	PRINTI "those"
?L31:	PRINTI " who do have "
	PRINTD OXYGEN-GEAR
	PRINTR " will have exhausted their supply of oxygen. Need we say more?"
?L23:	EQUAL? 13,DOME-AIR-BAD? \?L36
	CRLF
	PRINTI "Zoe Bly and the two crew members without "
	PRINTD OXYGEN-GEAR
	PRINTI " now have only 4 TURNS left to live! Their lives depend on you, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"
	CRLF
	FSET? ACCESS-PLATE,OPENBIT /TRUE
	FSET? UNIVERSAL-TOOL,TOUCHBIT /TRUE
	FSET UNIVERSAL-TOOL,TOUCHBIT
	FCLEAR UNIVERSAL-TOOL,NDESCBIT
	MOVE UNIVERSAL-TOOL,PLAYER
	PRINTI "Tip"
	IN? TIP,HERE /?L43
	MOVE TIP,HERE
	PRINTI " runs up and"
?L43:	PRINTI " gives you a "
	PRINTD UNIVERSAL-TOOL
	PRINTI " and says, ""Here, "
	CALL PRINT-NAME,FIRST-NAME
	FSET? CENTER-OF-DOME,TOUCHBIT \?L50
	PRINTR ", open the cylinder with this! It'll fit anything!"""
?L50:	PRINTR ", maybe you can use this somehow."""
?L36:	EQUAL? 17,DOME-AIR-BAD? \FALSE
	LOC SPECIAL-TOOL >STACK
	EQUAL? STACK,BLY-OFFICE,HORVAK /?L59
	SET 'X,0
	JUMP ?L60
?L59:	SET 'X,1
?L60:	MOVE HORVAK,CENTER-OF-DOME
	PRINTI "
At this desperate moment, "
	CALL TIP-REPORTS?
	PRINTD HORVAK
	PRINTI " runs from the "
	PRINTD BLY-OFFICE
	ZERO? X /?L65
	LOC ELECTROLYTE-RELAY >STACK
	EQUAL? STACK,AIR-SUPPLY-SYSTEM,CENTER-OF-DOME,HORVAK \?L65
	CALL QUEUE,I-BLY-PRIVATELY,3 >STACK
	PUT STACK,0,1
	MOVE SPECIAL-TOOL,HORVAK
	FCLEAR SPECIAL-TOOL,INVISIBLE
	FSET SPECIAL-TOOL,TOUCHBIT
	REMOVE SPECIAL-TOOL-GLOBAL
	CALL FIX-AIR-SUPPLY
	SET 'HORVAK-FIXED-AIR,1
	PRINTI ". He's clutching an oddly-shaped gadget.
"
	CALL TIP-SAYS
	PRINTI "Hey, that's the "
	PRINTD SPECIAL-TOOL
	PRINTI "!""
"
	FSET? ACCESS-PLATE,OPENBIT /?L71
	FSET ACCESS-PLATE,OPENBIT
	FSET AIR-SUPPLY-SYSTEM,OPENBIT
	PRINTI "Using the "
	PRINTD SPECIAL-TOOL
	PRINTI ", "
	PRINTD HORVAK
	PRINTI " quickly opens the "
	PRINTD ACCESS-PLATE
	PRINTI ". "
?L71:	PRINTI "Inside the cylinder, the "
	PRINTD ELECTROLYTE-RELAY
	PRINTI " has come unscrewed and fallen out of its socket. Horvak"
	IN? ELECTROLYTE-RELAY,HORVAK /?L78
	PRINTI " takes it and"
?L78:	PRINTI " screws it back in place; and within seconds, a fresh supply of oxygen is flowing out into the "
	PRINTD AQUADOME
	PRINTR "."
?L65:	PRINTI ". He "
	LOC HORVAK >STACK
	EQUAL? HERE,STACK \?L88
	PUSH STR?187
	JUMP ?L90
?L88:	PUSH STR?176
?L90:	PRINT STACK
	PRINTI "s, ""I never wanted it to go this far! I sabotaged the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI " to embarrass "
	PRINTD BLY
	PRINTI ", but now I can't find the "
	ZERO? X /?L91
	PRINTD ELECTROLYTE-RELAY
	JUMP ?L95
?L91:	PRINTD SPECIAL-TOOL
?L95:	PRINTI " to fix it!""
As Doc breaks down in tears and Bly suffocates, you realize there's no point in continuing your mission."
	IN? OXYGEN-GEAR,PLAYER /?L100
	PUSH 0
	JUMP ?L101
?L100:	PUSH 1
?L101:	CALL PRINT-ID,STR?188,STACK
	IN? OXYGEN-GEAR,PLAYER /?L102
	PUSH 1
	JUMP ?L103
?L102:	PUSH 0
?L103:	CALL PRINT-ID,STR?189,STACK
	CALL FINISH >STACK
	RSTACK
?L1:	SUB DOME-AIR-BAD?,DOME-AIR-FIX-RATE >DOME-AIR-BAD?
	LESS? 0,DOME-AIR-BAD? /FALSE
	CALL INT,I-DOME-AIR >STACK
	PUT STACK,0,0
	CALL QUEUE,I-ANTRIM-TO-SUB,10 >STACK
	PUT STACK,0,1
	SET 'DOME-AIR-BAD?,0
	FSET? BLY,MUNGBIT \FALSE
	FCLEAR BLY,MUNGBIT
	FCLEAR GREENUP,MUNGBIT
	FCLEAR LOWELL,MUNGBIT
	CALL VISIBLE?,BLY >STACK
	ZERO? STACK /FALSE
	CALL VISIBLE?,GREENUP >STACK
	ZERO? STACK /FALSE
	CALL VISIBLE?,LOWELL >STACK
	ZERO? STACK /FALSE
	ZERO? HORVAK-FIXED-AIR \?L112
	CRLF
	PRINTD HORVAK
	PRINTI " has just returned from the "
	PRINTD BLY-OFFICE
	PRINTI ", where he went to get Bly's "
	PRINTD OXYGEN-GEAR
	PRINTI ", but it's no longer needed."
	CRLF
?L112:	CRLF
	PRINTD BLY
	PRINTI " is sitting up and her normal color has returned. Ditto for Greenup and Lowell, who collapsed. All are recovering from their temporary lack of air."
	CRLF
	CALL TELL-HINT,41,ELECTROLYTE-RELAY
	RTRUE

	.FUNCT FOOT-OF-RAMP-F,ARG=0
	EQUAL? ARG,M-BEG \?L1
	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? PRSO,P?UP,P?SOUTH \FALSE
	CALL CHEERS?
	RFALSE
?L1:	EQUAL? ARG,M-ENTER \?L9
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK \?L12
	ZERO? GREENUP-ESCAPE \?L12
	ZERO? GREENUP-TRAPPED /?L10
?L12:	MOVE BLY,HERE
	MOVE ANTRIM,HERE
	MOVE HORVAK,HERE
	MOVE SIEGEL,HERE
	MOVE LOWELL,HERE
	ZERO? GREENUP-ESCAPE \?L15
	ZERO? GREENUP-TRAPPED /?L13
?L15:	PRINTI "The rest of the "
	PRINTD CREW
	PRINTR " are with you."
?L13:	PRINTD BLY
	PRINTR " and the others gather to shake your hand and wish you luck on your perilous mission."
?L10:	ZERO? BLY-WELCOMED \FALSE
	SET 'BLY-WELCOMED,1
	PRINTD BLY
	PRINTI " says, """
	CALL BLY-WELCOME
	PRINTR """"
?L9:	EQUAL? ARG,M-LOOK \?L27
	CALL CREW-5-TOGETHER? >STACK
	ZERO? STACK /?L28
	IN? CREW,FOOT-OF-RAMP \?L28
	FSET? BLY,MUNGBIT /?L28
	FSET? CREW,TOUCHBIT /?L30
	FSET CREW,TOUCHBIT
	CALL QUEUE,I-BLY-PRIVATELY,15 >STACK
	PUT STACK,0,1
	PRINTI "You're now face-to-face with Zoe Bly and the "
	PRINTD CREW
	PRINTI ". They are wearing badges which show the air quality in the "
	PRINTD AQUADOME
	PRINTR "."
?L30:	PRINTI "You're at the foot of the ladder. "
	IN? BLY,FOOT-OF-RAMP \?L37
	PRINTI "Zoe Bly and t"
	JUMP ?L41
?L37:	PRINTI "T"
?L41:	PRINTI "he "
	PRINTD CREW
	PRINTR " are still here."
?L28:	PRINTR "You're now at the foot of the ladder."
?L27:	EQUAL? ARG,M-END \FALSE
	EQUAL? EXCLAM-DOME-AIR-BAD,DOME-AIR-BAD? \FALSE
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \FALSE
	CRLF
	CALL BADGES-RED,1
	RTRUE

	.FUNCT BADGES-RED,SHOUT?=0
	ZERO? BADGES-RED-SAID? \FALSE
	SET 'BADGES-RED-SAID?,1
	ZERO? SHOUT? /?L3
	PRINTI "Someone shouts, "
?L3:	PRINTI """Our badges are turning red! The air's bad! Everyone use your "
	PRINTD OXYGEN-GEAR
	PRINTR "!"""

	.FUNCT OUTSIDE-DORM-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	CALL FROM-HERE,P?WEST,P?SOUTH >STACK
	RSTACK

	.FUNCT FROM-HERE,DIR1,DIR2
	PRINTI "From here, you can go "
	CALL DIR-PRINT,DIR1,0
	PRINTI " or "
	CALL DIR-PRINT,DIR2,0
	PRINTR " into the building."

	.FUNCT WOMENS-QUARTERS-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	CALL QUARTERS-F,WOMENS-QUARTERS,STR?190 >STACK
	RSTACK

	.FUNCT GENERIC-FURNITURE-F,OBJ
	ZERO? SUB-IN-TANK /?L1
	RETURN WORKBENCH
?L1:	RETURN HORVAK-LOCKER

	.FUNCT MENS-QUARTERS-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	CALL QUARTERS-F,MENS-QUARTERS,STR?191 >STACK
	RSTACK

	.FUNCT QUARTERS-F,RM,STR
	PRINTI "You're in the "
	PRINTD RM
	PRINTI ". "
	PRINT STR
	PRINTR " of the room is a bunk and locker. In the center of the room are a table and chairs."

	.FUNCT HORVAK-LOCKER-F
	EQUAL? PRSA,V?LOOK-INSIDE \?L1
	FSET? HORVAK-LOCKER,OPENBIT \?L1
	PRINTI "The locker contains mostly clothing, toilet articles and books."
	CALL PRINT-ID,STR?192
	IN? DIARY,HORVAK-LOCKER \?L9
	PRINTI " One of the books is labeled DIARY."
	IN? PHOTO,DIARY \?L9
	FCLEAR PHOTO,INVISIBLE
	PRINTI " Something has been inserted between its pages."
?L9:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?UNLOCK,V?OPEN-WITH,V?OPEN \FALSE
	EQUAL? PRSO,HORVAK-LOCKER \FALSE
	FSET? HORVAK-LOCKER,OPENBIT /FALSE
	FSET? HORVAK-LOCKER,LOCKED \?L18
	EQUAL? PRSI,UNIVERSAL-TOOL /?L18
	CALL THIS-IS-IT,HORVAK-KEY
	PRINTI "It's locked. The normal way to open its lock (which you yourself designed, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR ") is with a key."
?L18:	FCLEAR HORVAK-LOCKER,LOCKED
	CALL PRINT-ID,STR?193
	FSET HORVAK-LOCKER,OPENBIT
	FSET DIARY,TAKEBIT
	CALL PERFORM,V?LOOK-INSIDE,HORVAK-LOCKER
	RTRUE

	.FUNCT HORVAK-KEY-F
	EQUAL? PRSI,HORVAK \?L4
	EQUAL? PRSA,V?TAKE /?L3
?L4:	EQUAL? PRSO,HORVAK \FALSE
	EQUAL? PRSA,V?SEARCH-FOR,V?ASK-FOR \FALSE
?L3:	EQUAL? WINNER,PLAYER \?L5
	PRINTI "Be warned, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", that he will never willingly surrender it. You have no right to demand it without a search warrant. The "
	PRINTD AQUADOME
	PRINTR " is neither a military establishment nor a ship at sea, so you could get in legal trouble."
?L5:	CALL HE-SHE-IT,WINNER,1,STR?194
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". Do not pursue this any further, or you will lose the respect and cooperation of the "
	PRINTD CREW
	PRINTR ", and thereby abort your rescue mission. If you attempt to use force, they may even mutiny and place you under arrest."

	.FUNCT DIARY-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? DIARY,OPENBIT /?L1
	IN? PHOTO,DIARY \?L1
	FSET DIARY,OPENBIT
	MOVE PHOTO,HERE
	PRINTI "As you do so, a picture falls out. Oh, oh! It's a snapshot of Zoe Bly!"
	CRLF
	CALL PRINT-ID,STR?195 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?READ \FALSE
	FSET? DIARY,OPENBIT /?L6
	PRINTI "You must open it first."
	CRLF
	CALL PRINT-ID,STR?196 >STACK
	RSTACK
?L6:	PRINTI "You quickly discover references to Zoe Bly. It seems clear that "
	PRINTD HORVAK
	PRINTI " has fallen for Zoe. But her unsentimental manner is a large obstacle.
The last entry reads:
""If only I could find some way to break down that icy reserve of Zoe's, and make her realize she's not just a scientific thinking machine or a commanding officer...!
There must be some way! She doesn't do everything by the rule book. She even breaks regulations at times. If I can prove this and embarrass her, maybe she'll realize she's just a human being like the rest of us -- and not only a human being, but a warm, desirable woman...!""
"
	CALL PRINT-ID,STR?197
	FSET? SPECIAL-TOOL,TOUCHBIT \TRUE
	PRINTI "
Well! It sounds as if "
	PRINTD HORVAK
	PRINTI " found the answer to his problem by sabotaging the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI " -- at a time when "
	PRINTD BLY
	PRINTI " was breaking regulations by not wearing her "
	PRINTD OXYGEN-GEAR
	PRINTR "!"

	.FUNCT PHOTO-F
	EQUAL? PRSA,V?TELL-ABOUT,V?EXAMINE,V?ANALYZE \FALSE
	PRINTI "It's a "
	PRINTD PHOTO
	PRINTI " of "
	PRINTD BLY
	PRINTR "."

	.FUNCT OUTSIDE-WORKSHOP-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	CALL FROM-HERE,P?WEST,P?NORTH >STACK
	RSTACK

	.FUNCT WORKSHOP-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The "
	PRINTD WORKSHOP
	PRINTR " is equipped for mechanical repair work. It contains assorted hand tools, machine tools, and spare parts."

	.FUNCT WORKSHOP-STUFF-F
	EQUAL? PRSA,V?MAKE \FALSE
	PRINTR "That's too difficult, even for a famous young inventor."

	.FUNCT DOME-LAB-F,RARG=0,MAGLOC
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "The "
	PRINTD DOME-LAB
	PRINTI " is equipped for all sorts of marine biochemical research. "
	CALL ROOM-IS-CROWDED >STACK
	RSTACK
?L1:	EQUAL? RARG,M-ENTER \FALSE
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT /FALSE
	IN? BLY,DOME-LAB /?L6
	MOVE BLY,DOME-LAB
	PRINTD BLY
	PRINTI " comes too."
	CRLF
?L6:	FSET? HORVAK,BUSYBIT /?L11
	IN? HORVAK,DOME-LAB /?L11
	MOVE HORVAK,DOME-LAB
	PRINTD HORVAK
	PRINTI " comes too."
	CRLF
?L11:	ZERO? HORVAK-TOLD-AH \TRUE
	FSET? DART,MUNGBIT \TRUE
	FSET? HORVAK,BUSYBIT /TRUE
	SET 'HORVAK-TOLD-AH,1
	CRLF
	PRINTD HORVAK
	PRINTI " says:
"""
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", right after the Snark ceased its attack, I detected a high concentration of A.H. molecules in the "
	PRINTD GLOBAL-WATER
	PRINTI " around the "
	PRINTD AQUADOME
	PRINTI ". Have you ever heard of such a phenomenon before?"""
	CALL YES? >STACK
	ZERO? STACK \?L22
	PRINTI """I can make up an intense tranquilizer to subdue the "
	PRINTD SNARK
	PRINTI ","" "
	PRINTD HORVAK
	PRINTI " continues. ""You could use one of our aquatic dart guns to inject it into the creature. You could mount the gun on one of the "
	PRINTD SUB
	PRINTI "'s "
	PRINTD CLAW
	PRINTI "s.
But without knowing the creature's biochemistry, there's no guarantee the 'trank' will work. Shall I go ahead and make some up, anyhow?"""
	CALL YES? >MAGLOC
	CALL PRINT-ID,STR?198,MAGLOC
?L22:	CALL META-LOC,MAGAZINE >MAGLOC
	CALL IN-DOME?,MAGLOC >STACK
	ZERO? STACK /TRUE
	CALL TIP-SAYS
	PRINTI "Wait a minute! Wasn't there something about A.H. molecules in that "
	PRINTD MAGAZINE
	PRINTI "? Shall "
	EQUAL? MAGLOC,HERE \?L32
	PRINTI "we"
	JUMP ?L36
?L32:	PRINTI "I get it and"
?L36:	PRINTI " see?"""
	CALL THIS-IS-IT,MAGAZINE
	CALL YES? >STACK
	ZERO? STACK /TRUE
	IN? MAGAZINE,PLAYER /?L43
	MOVE MAGAZINE,PLAYER
	PRINTI "Tip "
	EQUAL? MAGLOC,HERE /?L47
	PRINTI "returns quickly and "
?L47:	PRINTI "hands you the "
	PRINTD MAGAZINE
	PRINTI ". "
?L43:	CALL THIS-IS-IT,HORVAK
	PRINTD HORVAK
	PRINTR " looks interested. ""I'd like to see that."""

	.FUNCT OUTSIDE-COMM-BLDG-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	CALL FROM-HERE,P?EAST,P?NORTH >STACK
	RSTACK

	.FUNCT COMM-BLDG-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The "
	PRINTD COMM-BLDG
	PRINTI " has both a "
	PRINTD VIDEOPHONE
	PRINTI " for communicating with other places and the "
	PRINTD SONAR-EQUIPMENT
	PRINTI " for detecting objects in the "
	PRINTD GLOBAL-WATER
	PRINTR " around the dome."

	.FUNCT SONAR-EQUIPMENT-F
	EQUAL? PRSA,V?LAMP-OFF \?L1
	PRINTR "It should stay on all the time."
?L1:	EQUAL? PRSA,V?TELL-ABOUT,V?LOOK-ON,V?LOOK-INSIDE /?L6
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \?L5
?L6:	PRINTI "The "
	PRINTD SONAR-EQUIPMENT
	PRINTI " detects objects in the "
	PRINTD GLOBAL-WATER
	PRINTI " near the "
	PRINTD AQUADOME
	PRINTR "."
?L5:	EQUAL? PRSA,V?TIE-TO \FALSE
	EQUAL? PRSI,SONAR-EQUIPMENT \FALSE
	CALL PERFORM,V?PUT,PRSO,PRSI
	RTRUE

	.FUNCT MICROPHONE-DOME-F
	CALL MICROPHONE-F,1 >STACK
	RSTACK

	.FUNCT GALLEY-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	PRINTR "This room serves as both galley and mess; the crew can both prepare food and eat it here."

	.FUNCT OUTSIDE-ADMIN-BLDG-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	CALL FROM-HERE,P?EAST,P?SOUTH >STACK
	RSTACK

	.FUNCT BLY-OFFICE-F,ARG=0
	EQUAL? ARG,M-LOOK \?L1
	PRINTI "The "
	PRINTD BLY-OFFICE
	PRINTI " is small but tidy, with a single door leading out and a good view of the ocean through the "
	PRINTD WINDOW
	PRINTR "."
?L1:	EQUAL? ARG,M-ENTER \?L5
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT /?L5
	IN? BLY,BLY-OFFICE \?L6
	ZERO? GREENUP-ESCAPE \?L27
	ZERO? GREENUP-TRAPPED \?L6
	ZERO? GREENUP-CUFFED \?L6
	ZERO? ZOE-MENTIONED-EVIDENCE \?L6
	FCLEAR BLY,NDESCBIT
	PRINTI "As you enter the office, "
	CALL ZOE-MENTIONS-EVIDENCE >STACK
	RSTACK
?L6:	ZERO? GREENUP-ESCAPE /FALSE
?L27:	IN? BLY,BLY-OFFICE /FALSE
	MOVE BLY,BLY-OFFICE
	PRINTR "Zoe comes with you."
?L5:	EQUAL? ARG,M-BEG \?L14
	CALL EXIT-VERB? >STACK
	ZERO? STACK /?L14
	ZERO? GREENUP-ESCAPE /?L15
	CALL HE-SHE-IT,WINNER,1
	PRINTR "'d better stay here and trap Greenup."
?L15:	FSET? SPECIAL-TOOL,INVISIBLE \FALSE
	EQUAL? WINNER,PLAYER \FALSE
	PRINTI "As you start to leave, you notice "
	CALL SPECIAL-TOOL-VISIBLE >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?SEARCH-FOR,V?SEARCH \FALSE
	FSET? SPECIAL-TOOL,INVISIBLE \FALSE
	PRINTI "You find "
	CALL SPECIAL-TOOL-VISIBLE >STACK
	RSTACK

	.FUNCT SPECIAL-TOOL-VISIBLE
	FCLEAR SPECIAL-TOOL,INVISIBLE
	FSET SPECIAL-TOOL,TOUCHBIT
	REMOVE SPECIAL-TOOL-GLOBAL
	CALL THIS-IS-IT,SPECIAL-TOOL
	PRINTI "an oddly shaped metallic object lying under Zoe's desk. It must be the "
	PRINTD SPECIAL-TOOL
	PRINTR "!"

	.FUNCT ZOE-MENTIONS-EVIDENCE
	SET 'ZOE-MENTIONED-EVIDENCE,1
	MOVE TRAITOR,GLOBAL-OBJECTS
	CALL THIS-IS-IT,EVIDENCE
	CALL QUEUE,I-BLY-SAYS,6 >STACK
	PUT STACK,0,1
	CALL SAID-TO,BLY
	PRINTI "Zoe"
	FSET? BLY-DOOR,OPENBIT \?L3
	FCLEAR BLY-DOOR,OPENBIT
	PRINTI " closes the door and"
?L3:	PRINTI " says:
""There's a "
	PRINTD TRAITOR
	PRINTI " here at the "
	PRINTD AQUADOME
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! "
	ZERO? DOME-AIR-CRIME /?L10
	PRINTI "I'm not saying that just because the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI " was sabotaged. "
?L10:	PRINTI "I discovered "
	ZERO? DOME-AIR-CRIME /?L17
	PUSH STR?199
	JUMP ?L19
?L17:	PUSH STR?200
?L19:	PRINT STACK
	PRINTD EVIDENCE
	PRINTI " after we talked on the "
	PRINTD VIDEOPHONE
	PRINTR "!"""

	.FUNCT BLY-DESK-F
	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	FSET? SPECIAL-TOOL,TOUCHBIT /FALSE
	PRINTI "There's "
	CALL SPECIAL-TOOL-VISIBLE >STACK
	RSTACK

	.FUNCT BLACK-BOX-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	FSET? BLACK-BOX,OPENBIT \?L3
	SET 'BLACK-BOX-EXAMINED,1
	PRINTI "After a brief study of the "
	PRINTD BLACK-CIRCUITRY
	PRINTR ", you deduce its purpose: it was designed to change the sonar output so the ultrasonic pulses make a more complex pattern (for example BURPETY BURP B'DURP) instead of just a simple, clear-cut BURP. This would also make fuzzier blips."
?L3:	PRINTR "You'll need a suitable tool to open its cover."
?L1:	EQUAL? PRSA,V?OPEN-WITH,V?OPEN \FALSE
	FSET? BLACK-BOX,OPENBIT \?L11
	CALL ALREADY,BLACK-BOX,STR?22 >STACK
	RSTACK
?L11:	EQUAL? PRSI,UNIVERSAL-TOOL \?L13
	CALL OKAY,BLACK-BOX,STR?22 >STACK
	RSTACK
?L13:	PRINTI "You can't open it with"
	ZERO? PRSI /?L17
	CALL THE-PRSI-PRINT
	JUMP ?L21
?L17:	PRINTI " your bare hands"
?L21:	PRINTR "!"

	.FUNCT BLACK-CIRCUITRY-F
	CALL DIVESTMENT?,BLACK-CIRCUITRY >STACK
	ZERO? STACK /FALSE
	CALL PERFORM,PRSA,BLACK-BOX,PRSI
	RTRUE

	.FUNCT STATION-MONITOR-F
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	ZERO? GREENUP-ESCAPE /?L3
	CALL QUEUE,I-GREENUP-ESCAPE,-1 >STACK
	PUT STACK,0,1
	EQUAL? GREENUP-ESCAPE,1 \TRUE
	PRINTI "The monitor screen shows Greenup's head just coming into view above the top of the "
	PRINTD AIRLOCK
	PRINTI "'s west wall, as he climbs the outside ladder.
"
	FSET? AIRLOCK-ROOF,OPENBIT /?L9
	PRINTI "But since the "
	PRINTD AIRLOCK-ROOF
	PRINTI " is closed, Greenup can't get into the "
	PRINTD SUB
	PRINTI " to escape. "
	CALL GREENUP-CUFF
	RTRUE
?L9:	PRINTI "Once he reaches the top of this wall, he will come down the inside ladder to the "
	PRINTD SUB
	PRINTR "."
?L3:	PRINTD BLY
	PRINTI " uses this monitor to check on activities in the "
	PRINTD AQUADOME
	PRINTR "."

	.FUNCT AIRLOCK-ELECTRICITY-F
	EQUAL? PRSA,V?CUT \?L1
	CALL PERFORM,V?LAMP-OFF,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?LAMP-OFF \FALSE
	ZERO? GREENUP-ESCAPE /FALSE
	FCLEAR AIRLOCK-ELECTRICITY,ONBIT
	PRINTI "Very good, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! With the "
	PRINTD AIRLOCK-ELECTRICITY
	PRINTI " off, the "
	PRINTD AIRLOCK-HATCH
	PRINTI " won't respond to command signals from the "
	PRINTD SUB
	PRINTI " and will remain closed.
"
	CALL GREENUP-CUFF
	RTRUE

	.FUNCT CONTROLS-OFFICE-F
	EQUAL? PRSA,V?LAMP-OFF,V?CUT \?L1
	CALL PERFORM,V?LAMP-OFF,AIRLOCK-ELECTRICITY
	RTRUE
?L1:	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	PRINTI "MAIN OPERATING CONTROLS:
"
	CALL FIXED-FONT-ON
	PRINTD AIRLOCK-ROOF
	PRINTI ": "
	FSET? AIRLOCK-ROOF,OPENBIT \?L8
	PUSH STR?22
	JUMP ?L10
?L8:	PUSH STR?27
?L10:	PRINT STACK
	CRLF
	PRINTD FILL-TANK-BUTTON
	PRINTI "     : "
	CALL TANK-STATUS >STACK
	PRINT STACK
	CRLF
	PRINTD OPEN-GATE-BUTTON
	PRINTI "     : "
	CALL GATE-STATUS >STACK
	PRINT STACK
	CRLF
	CALL FIXED-FONT-OFF
	RTRUE

	.FUNCT DOME-STORAGE-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	CALL ROOM-IS-CROWDED >STACK
	RSTACK

	.FUNCT ROOM-IS-CROWDED
	PRINTR "The room is crowded with supplies and equipment. If you want to find something, you'll have to search for it."

	.FUNCT I-CHECK-POD
	IN? SYRINGE,ESCAPE-POD-UNIT \FALSE
	FSET? SYRINGE,MUNGBIT \FALSE
	ZERO? SUB-IN-DOME /?L3
	CALL TELL-HINT,51,ESCAPE-POD-UNIT
?L3:	CALL QUEUE,I-CHECK-POD,7 >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT ESCAPE-POD-UNIT-F
	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	IN? ESCAPE-POD-UNIT,SUB \FALSE
	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \?L4
	PRINTI "A brief inspection under your seat leads to a horrifying discovery! A body-heat sensor was substituted for the electronic monitor, and a wire leads from the sensor to "
	CALL PRINT-ID,STR?201
	IN? SYRINGE,ESCAPE-POD-UNIT \?L8
	PRINTI "the "
	PRINTD SYRINGE
	JUMP ?L12
?L8:	PRINTI "where the "
	PRINTD SYRINGE
	PRINTI " was"
?L12:	PRINTI ".
Tip reports that the part under his seat appears to be okay."
	FSET? SYRINGE,MUNGBIT \?L17
	IN? SYRINGE,ESCAPE-POD-UNIT \?L17
	PRINTI " ""But I sure don't like the looks of that "
	PRINTD SYRINGE
	PRINTI " in YOUR part, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"" he adds. ""Let's take it to "
	PRINTD HORVAK
	PRINTI " to analyze it."""
?L17:	CRLF
	RTRUE
?L4:	EQUAL? PRSA,V?FIX \FALSE
	PRINTI "Maybe "
	PRINTD HORVAK
	PRINTR " can do that."

	.FUNCT SYRINGE-F
	EQUAL? PRSO,SYRINGE \FALSE
	EQUAL? PRSA,V?FIX,V?EXAMINE,V?ANALYZE \?L3
	PRINTI "Maybe "
	PRINTD HORVAK
	PRINTR " can do that."
?L3:	EQUAL? PRSA,V?TAKE \?L7
	FSET ESCAPE-POD-UNIT,NDESCBIT
	SET 'TEST-BUTTON-READOUT,TEST-BUTTON-NORMAL
	RFALSE
?L7:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,ESCAPE-POD-UNIT \FALSE
	FCLEAR ESCAPE-POD-UNIT,NDESCBIT
	SET 'TEST-BUTTON-READOUT,TEST-BUTTON-POD
	RFALSE

	.FUNCT FINE-GRID-F
	EQUAL? PRSA,V?FIND \FALSE
	ZERO? FINE-SONAR /FALSE
	PRINTI "It's installed in the "
	PRINTD SUB
	PRINTR "."

	.FUNCT CENTER-OF-DOME-F,ARG=0
	EQUAL? ARG,M-LOOK \FALSE
	PRINTI "You're in the very center of the "
	PRINTD AQUADOME
	PRINTI ", where the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTR " rises like a tower, almost to the top of the dome itself."

	.FUNCT AIR-SUPPLY-SYSTEM-F
	EQUAL? PRSA,V?ANALYZE \?L1
	PRINTR "How do you propose to do that?"
?L1:	EQUAL? PRSA,V?READ,V?LOOK-INSIDE,V?EXAMINE \?L5
	EQUAL? HERE,CENTER-OF-DOME \?L6
	FSET? ACCESS-PLATE,OPENBIT \?L8
	FSET? ELECTROLYTE-RELAY,MUNGBIT \?L10
	PRINTI "You notice an "
	PRINTD EMPTY-SPACE
	PRINTI " in the complicated assembly facing you. Something has been unscrewed from this space!"
	CRLF
	IN? ELECTROLYTE-RELAY,AIR-SUPPLY-SYSTEM \FALSE
	CALL THIS-IS-IT,ELECTROLYTE-RELAY
	PRINTR "Something is lying at the base of the cylinder, just inside the housing."
?L10:	PRINTR "There's a lot of complicated machinery inside."
?L8:	PRINTI "The first thing you notice is a stenciled sign saying: "
	CALL READ-AIR-SUPPLY >STACK
	RSTACK
?L6:	CALL TOO-FAR-AWAY,AIR-SUPPLY-SYSTEM >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?WALK-TO,V?FIND \?L26
	EQUAL? PRSO,AIR-SUPPLY-SYSTEM-GLOBAL \FALSE
	CALL PERFORM,PRSA,AIR-SUPPLY-SYSTEM,PRSI
	RTRUE
?L26:	EQUAL? PRSA,V?FIX \?L30
	PRINTI "How do you propose doing that, when you don't know what's wrong with it?"
	CRLF
	CALL PRINT-ID,STR?202 >STACK
	RSTACK
?L30:	EQUAL? PRSA,V?CLOSE,V?OPEN-WITH,V?OPEN \FALSE
	CALL PERFORM,PRSA,ACCESS-PLATE,PRSI
	RTRUE

	.FUNCT READ-AIR-SUPPLY
	PRINTI """To repair "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI ", first open "
	PRINTD ACCESS-PLATE
	PRINTI " with "
	PRINTD SPECIAL-TOOL
	PRINTR " hanging on hook at right."" An arrow points to this hook."

	.FUNCT AIR-SUPPLY-VERB?
	EQUAL? PRSA,V?YELL-FOR /?L3
	EQUAL? PRSA,V?TAKE,V?FIND,V?GIVE \?L1
?L3:	EQUAL? PRSO,AIR-SUPPLY-SYSTEM-GLOBAL,AIR-SUPPLY-SYSTEM,SPECIAL-TOOL-GLOBAL /TRUE
	EQUAL? PRSO,SPECIAL-TOOL,UNIVERSAL-TOOL /TRUE
	RFALSE
?L1:	EQUAL? PRSA,V?TELL-ABOUT /?L9
	EQUAL? PRSA,V?ASK-FOR,V?ASK-ABOUT,V?SGIVE \FALSE
?L9:	EQUAL? PRSI,AIR-SUPPLY-SYSTEM-GLOBAL,AIR-SUPPLY-SYSTEM,SPECIAL-TOOL-GLOBAL /TRUE
	EQUAL? PRSI,SPECIAL-TOOL,UNIVERSAL-TOOL /TRUE
	RFALSE

	.FUNCT ACCESS-PLATE-F
	EQUAL? PRSA,V?READ \?L1
	CALL READ-AIR-SUPPLY >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?ANALYZE,V?EXAMINE \?L3
	FSET? ACCESS-PLATE,OPENBIT \?L4
	PRINTR "It's open."
?L4:	PRINTI "It's held in place on the cylinder by curiously-shaped fram bolts, which no ordinary wrench will fit."
	FSET? AIR-SUPPLY-SYSTEM,TOUCHBIT /TRUE
	PRINTI " To open it, you need a "
	PRINTD SPECIAL-TOOL
	PRINTR ", or something like it."
?L3:	EQUAL? PRSA,V?LOOK-INSIDE \?L16
	CALL PERFORM,PRSA,AIR-SUPPLY-SYSTEM,PRSI
	RTRUE
?L16:	EQUAL? PRSA,V?CLOSE \?L17
	FSET? ACCESS-PLATE,OPENBIT \?L18
	FCLEAR ACCESS-PLATE,OPENBIT
	CALL OKAY,AIR-SUPPLY-SYSTEM,STR?27 >STACK
	RSTACK
?L18:	CALL ALREADY,AIR-SUPPLY-SYSTEM,STR?27 >STACK
	RSTACK
?L17:	EQUAL? PRSA,V?TAKE-WITH,V?OPEN-WITH,V?OPEN \?L21
	EQUAL? PRSI,SPECIAL-TOOL,UNIVERSAL-TOOL \?L21
	FSET? ACCESS-PLATE,OPENBIT \?L22
	CALL ALREADY,ACCESS-PLATE,STR?22 >STACK
	RSTACK
?L22:	CALL OKAY,ACCESS-PLATE,STR?22
	FSET AIR-SUPPLY-SYSTEM,OPENBIT
	FSET AIR-SUPPLY-SYSTEM,TOUCHBIT
	CALL PERFORM,V?LOOK-INSIDE,AIR-SUPPLY-SYSTEM
	CALL SCORE-OBJ,AIR-SUPPLY-SYSTEM
	RTRUE
?L21:	EQUAL? PRSA,V?TAKE-WITH,V?TAKE,V?OPEN \FALSE
	FSET? ACCESS-PLATE,OPENBIT \?L26
	CALL ALREADY,ACCESS-PLATE,STR?22 >STACK
	RSTACK
?L26:	EQUAL? PRSI,SPECIAL-TOOL-GLOBAL \?L28
	CALL NOT-HERE,PRSI
	RTRUE
?L28:	PRINTI "You can't remove"
	CALL THE-PRSO-PRINT
	PRINTR " with your bare hands!"

	.FUNCT HOOK-F
	FIRST? HOOK >STACK /?L1
	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \?L3
	PRINTI "There's nothing hanging on the "
	PRINTD HOOK
	PRINTR "."
?L3:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,SPECIAL-TOOL \?L8
	MOVE PRSO,HOOK
	PRINTR "Okay."
?L8:	PRINTI "It won't fit on the "
	PRINTD HOOK
	PRINTR "."
?L1:	EQUAL? PRSA,V?LOOK-ON,V?EXAMINE \FALSE
	PRINTI "There's "
	CALL PRINTA,SPECIAL-TOOL
	PRINTI " hanging on the "
	PRINTD HOOK
	PRINTR "."

	.FUNCT ARROW-F
	EQUAL? PRSA,V?ANALYZE,V?EXAMINE,V?FOLLOW \FALSE
	PRINTR "It points to the hook."

	.FUNCT ELECTROLYTE-RELAY-F
	EQUAL? PRSA,V?TAKE \?L1
	FSET? PRSO,TAKEBIT /FALSE
	PRINTI "What!? You don't want to spoil the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI " again!"
	CRLF
	CALL PRINT-ID,STR?203 >STACK
	RSTACK
?L1:	CALL REMOTE-VERB? >STACK
	ZERO? STACK \FALSE
	CALL NOT-HOLDING?,ELECTROLYTE-RELAY >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSA,V?COMPARE \?L10
	EQUAL? PRSI,ELECTROLYTE-RELAY \?L12
	EQUAL? PRSO,EMPTY-SPACE /?L11
?L12:	EQUAL? PRSO,ELECTROLYTE-RELAY \?L10
	EQUAL? PRSI,EMPTY-SPACE \?L10
?L11:	PRINTI "It looks as if the "
	PRINTD ELECTROLYTE-RELAY
	PRINTI " fits perfectly into the "
	PRINTD EMPTY-SPACE
	PRINTR "."
?L10:	EQUAL? PRSA,V?EXAMINE \?L15
	PRINTI "It has screw threads and, judging by its size and shape, it should screw very neatly into that "
	PRINTD EMPTY-SPACE
	PRINTI " in the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTR " assembly."
?L15:	EQUAL? PRSA,V?SCREW,V?PUT \?L20
	EQUAL? PRSI,EMPTY-SPACE,AIR-SUPPLY-SYSTEM /?L19
?L20:	EQUAL? PRSA,V?SCREW-IN \FALSE
	EQUAL? HERE,CENTER-OF-DOME \FALSE
?L19:	FSET? ACCESS-PLATE,OPENBIT /?L21
	CALL TOO-BAD-BUT,ACCESS-PLATE,STR?27
	RTRUE
?L21:	CALL FIX-AIR-SUPPLY
	PRINTI "It fits!"
	CRLF
	CALL SCORE-OBJ,ACCESS-PLATE
	RTRUE

	.FUNCT FIX-AIR-SUPPLY
	FCLEAR AIR-SUPPLY-SYSTEM,MUNGBIT
	REMOVE EMPTY-SPACE
	MOVE ELECTROLYTE-RELAY,AIR-SUPPLY-SYSTEM
	FCLEAR ELECTROLYTE-RELAY,TAKEBIT
	FSET ELECTROLYTE-RELAY,NDESCBIT
	FCLEAR ELECTROLYTE-RELAY,MUNGBIT
	PUTP ELECTROLYTE-RELAY,P?TEXT,STR?204
	RTRUE

	.FUNCT EMPTY-SPACE-F
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,EMPTY-SPACE \FALSE
	PRINTI "Sorry, but"
	CALL THE-PRSO-PRINT
	PRINTR " won't stay unless you screw it in."

	.FUNCT READ-NAME,TBL,STR,PTR,LEN,N,NUMTOKENS,TOK
?L1:	PRINT STR
	CRLF
	PRINTI ">"
	READ P-INBUF,P-LEXV
	GETB P-LEXV,P-LEXWORDS >STACK
	ZERO? STACK \?L5
	PRINTI "I beg your pardon?"
	CRLF
	JUMP ?L1
?L5:	GET P-LEXV,P-LEXSTART >N
	ZERO? N /?L23
	CALL WT?,N,PS?VERB,P1?VERB >N
	EQUAL? ACT?RESTART,N \?L12
	RESTART
?L12:	EQUAL? N,ACT?$0024VERIFY \?L16
	CALL V-$0024VERIFY
	JUMP ?L1
?L16:	EQUAL? N,ACT?RELEASE \?L17
	CALL V-VERSION
	JUMP ?L1
?L17:	EQUAL? N,ACT?RESTORE \?L23
	CALL V-RESTORE >STACK
	ZERO? STACK /?L1
	RETURN 2
?L23:	GETB P-LEXV,1 >NUMTOKENS
	SET 'TOK,NUMTOKENS
	SET 'NAME-OUTLEN,1
	SET 'N,4
?L26:	DLESS? 'TOK,0 /?L27
	GETB P-LEXV,N >LEN
	ADD 1,N >STACK
	GETB P-LEXV,STACK >PTR
	CALL READ-NAME-REPEAT,TBL,PTR,LEN
	GRTR? NAME-OUTLEN,NAME-LENGTH /?L47
	PUTB TBL,NAME-OUTLEN,32
	IGRTR? 'NAME-OUTLEN,NAME-LENGTH /?L27
	EQUAL? TBL,FIRST-NAME \?L37
	ZERO? FN-SPACE \?L42
	SUB NAME-OUTLEN,1 >FN-SPACE
	JUMP ?L42
?L37:	ZERO? LN-SPACE \?L42
	SUB NAME-OUTLEN,1 >LN-SPACE
?L42:	ADD 4,N >N
	JUMP ?L26
?L27:	GRTR? NAME-OUTLEN,NAME-LENGTH \?L44
?L47:	PUTB TBL,0,NAME-LENGTH
	RTRUE
?L44:	SUB NAME-OUTLEN,2 >STACK
	PUTB TBL,0,STACK
	RTRUE

	.FUNCT READ-NAME-REPEAT,TBL,PTR,LEN,CH
?L1:	GETB P-INBUF,PTR >CH
	DLESS? 'LEN,0 /TRUE
	EQUAL? CH,45,39,38 /?L6
	MOD CH,32 >STACK
	ADD 96,STACK >CH
?L6:	PUTB TBL,NAME-OUTLEN,CH
	IGRTR? 'NAME-OUTLEN,NAME-LENGTH /TRUE
	INC 'PTR
	JUMP ?L1

	.FUNCT PRINT-NAME,TBL,CAP=0,PTR=0,LEN,CH,SP?=1
	GETB TBL,0 >LEN
?L1:	IGRTR? 'PTR,LEN /TRUE
	GETB TBL,PTR >CH
	ZERO? CAP \?L8
	ZERO? SP? /?L6
?L8:	EQUAL? CH,32,45,39 /?L6
	EQUAL? CH,38 /?L6
	SUB CH,32 >STACK
	PRINTC STACK
	JUMP ?L9
?L6:	PRINTC CH
?L9:	EQUAL? CH,32,45,39 \?L10
	SET 'SP?,1
	JUMP ?L1
?L10:	EQUAL? CH,38 \?L12
	SET 'SP?,1
	JUMP ?L1
?L12:	SET 'SP?,0
	JUMP ?L1

	.FUNCT NAME?,PTR,?TMP
	CALL XNAME?,PTR,FIRST-NAME,FN-SPACE >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL XNAME?,PTR,LAST-NAME,LN-SPACE >STACK
	RSTACK

	.FUNCT XNAME?,PTR,TBL,MAX,CNT,BPTR,CHR,N?=1,NCNT=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	GRTR? CNT,6 \?L1
	SET 'CNT,6
?L1:	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
	ZERO? MAX \?L4
	GETB TBL,0 >MAX
?L4:	DLESS? 'MAX,7 /?L7
	SET 'MAX,6
?L7:	IGRTR? 'NCNT,MAX \?L12
	ZERO? CNT /?L11
	SET 'N?,0
	JUMP ?L11
?L12:	DLESS? 'CNT,0 \?L17
	SET 'N?,0
	JUMP ?L11
?L17:	GETB P-INBUF,BPTR >CHR
	EQUAL? CHR,45,38,39 /?L19
	MOD CHR,32 >STACK
	ADD 96,STACK >CHR
?L19:	GETB TBL,NCNT >STACK
	EQUAL? CHR,STACK /?L22
	SET 'N?,0
?L22:	INC 'BPTR
	JUMP ?L7
?L11:	ZERO? N? /FALSE
	EQUAL? TBL,FIRST-NAME \?L27
	PUT P-LEXV,PTR,W?$0024FN
	RETURN W?$0024FN
?L27:	PUT P-LEXV,PTR,W?$0024LN
	RETURN W?$0024LN

	.FUNCT PLAYER-NAME-F
	CALL DO-INSTEAD-OF,PLAYER,PLAYER-NAME
	RTRUE

	.FUNCT PLAYER-F,LON,LAT
	EQUAL? PRSO,PLAYER \FALSE
	EQUAL? PRSA,V?GOODBYE,V?HELLO \?L3
	CALL HAR-HAR >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?EXAMINE \?L5
	CALL PERFORM,V?INVENTORY
	RTRUE
?L5:	EQUAL? PRSA,V?FIND \?L6
	EQUAL? NOW-TERRAIN,BAY-TERRAIN,SEA-TERRAIN \FALSE
	PRINTI "The "
	EQUAL? NOW-TERRAIN,BAY-TERRAIN \?L11
	SUB SUB-LON,SEA-WALL-LON >LON
	SUB SUB-LAT,SEA-WALL-LAT >LAT
	PRINTD SEA-WALL
	JUMP ?L15
?L11:	SET 'LON,SUB-LON
	SET 'LAT,SUB-LAT
	ZERO? FINE-SONAR /?L16
	INC 'LAT
?L16:	PRINTD AIRLOCK
?L15:	PRINTI " is "
	ZERO? LON /?L40
	LESS? LON,0 \?L27
	SUB 0,LON >STACK
	JUMP ?L29
?L27:	PUSH LON
?L29:	MUL 5,STACK >STACK
	PRINTN STACK
	ZERO? FINE-SONAR \?L30
	PRINTI "00"
?L30:	PRINTI " meters "
	GRTR? 0,LON \?L37
	PUSH STR?205
	JUMP ?L39
?L37:	PUSH STR?206
?L39:	PRINT STACK
	PRINTI "st "
	ZERO? LAT /?L46
	PRINTI "and "
?L40:	ZERO? LAT /?L46
	LESS? LAT,0 \?L50
	SUB 0,LAT >STACK
	JUMP ?L52
?L50:	PUSH LAT
?L52:	MUL 5,STACK >STACK
	PRINTN STACK
	ZERO? FINE-SONAR \?L53
	PRINTI "00"
?L53:	PRINTI " meters "
	GRTR? 0,LAT \?L60
	PUSH STR?207
	JUMP ?L62
?L60:	PUSH STR?208
?L62:	PRINT STACK
	PRINTI "th "
?L46:	PRINTI "of here."
	CRLF
	SUB AIRLOCK-DEPTH,SUB-DEPTH >LON
	EQUAL? NOW-TERRAIN,SEA-TERRAIN \TRUE
	ZERO? LON /TRUE
	PRINTI "It's also "
	MUL 5,LON >STACK
	PRINTN STACK
	PRINTR " meters below you."
?L6:	EQUAL? PRSA,V?SEARCH \FALSE
	CALL PERFORM,V?INVENTORY
	RTRUE

	.FUNCT ARM-F
	CALL DIVESTMENT?,ARM >STACK
	ZERO? STACK \?L3
	CALL DIVESTMENT?,GASH >STACK
	ZERO? STACK /?L1
?L3:	CALL HAR-HAR >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \FALSE
	FSET? ARM,MUNGBIT \?L5
	PRINTR "Your arm is seriously gashed."
?L5:	CALL NOTHING-SPECIAL >STACK
	RSTACK

	.FUNCT TIP-IS-PLAYING
	EQUAL? TIP-PLAYS,WINDOW \?L3
	PUSH STR?209
	JUMP ?L5
?L3:	PUSH STR?210
?L5:	PRINT STACK
	PRINTI " the "
	PRINTD TIP-PLAYS
	RTRUE

	.FUNCT TIP-F,ARG=0,OBJ,X,L
	LOC TIP >L
	EQUAL? ARG,M-OBJDESC \?L1
	FSET? TIP,TOUCHBIT /?L3
	FSET TIP,TOUCHBIT
	CRLF
	PRINTD TIP
	PRINTI " follows you into"
	CALL PRINTT,L
	EQUAL? L,BLY-OFFICE \?L7
	CALL PICK-ONE,TIP-PICKS >TIP-PLAYS
	PRINTI " and begins "
	CALL TIP-IS-PLAYING
?L7:	PRINTR "."
?L3:	EQUAL? L,SUB \?L14
	PRINTD TIP
	PRINTI " is sitting behind you, "
	IN? MAGAZINE,TIP \?L17
	PRINTI "reading a "
	PRINTD MAGAZINE
	PRINTR "."
?L17:	ZERO? TIP-FOLLOWS-YOU? \?L21
	PRINTI "installing a "
	PRINTD FINE-GRID
	PRINTR "."
?L21:	PRINTR "checking the instruments."
?L14:	EQUAL? L,BLY-OFFICE \?L27
	PRINTD TIP
	PRINTI " is "
	CALL TIP-IS-PLAYING
	PRINTR "."
?L27:	CALL DESCRIBE-COLLAPSE,TIP
	RTRUE
?L1:	EQUAL? WINNER,TIP \?L33
	CALL GRAB-ATTENTION,TIP >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSO,FINE-GRID \?L39
	EQUAL? PRSA,V?TAKE /?L37
	EQUAL? PRSA,V?TIE-TO,V?PUT \?L39
	EQUAL? PRSI,SONARSCOPE,GLOBAL-SONAR,THROTTLE /?L37
?L39:	CALL MOUNTING-VERB?,FINE-GRID >STACK
	ZERO? STACK /?L36
?L37:	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,TIP,FINE-GRID
	RTRUE
?L36:	EQUAL? PRSA,V?WAIT-FOR \?L42
	EQUAL? PRSO,HERE /?L41
?L42:	EQUAL? PRSA,V?FOLLOW \?L40
	EQUAL? PRSO,PLAYER \?L40
?L41:	PRINTI """I won't let you out of my sight, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"""
?L40:	CALL COM-CHECK,TIP >X
	ZERO? X /?L45
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L45:	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L33:	CALL ASK-ABOUT?,TIP >OBJ
	ZERO? OBJ /?L54
	CALL GRAB-ATTENTION,TIP >STACK
	ZERO? STACK /TRUE
	CALL SAID-TO,TIP
	EQUAL? OBJ,AUTO-PILOT \?L58
	ZERO? SUB-IN-OPEN-SEA /?L58
	FSET? AUTO-PILOT,ONBIT /?L58
	CALL TIME-FOR-PILOT >STACK
	RSTACK
?L58:	EQUAL? OBJ,REACTOR,CATALYST-CAPSULE \?L60
	IN? CATALYST-CAPSULE,REACTOR /FALSE
	CALL TELL-HINT,33,CATALYST-CAPSULE,0 >STACK
	RSTACK
?L60:	EQUAL? OBJ,SPECIAL-TOOL-GLOBAL,SPECIAL-TOOL \?L64
	EQUAL? HERE,SUB \FALSE
	CALL TELL-HINT,61,TIP,0 >STACK
	RSTACK
?L64:	EQUAL? OBJ,TRAITOR,BLACK-BOX \?L68
	CALL TIP-COMES >STACK
	ZERO? STACK \TRUE
?L68:	EQUAL? OBJ,TIP-IDEA,GLOBAL-SONAR,GLOBAL-SIEGEL \?L69
	IN? TIP-IDEA,GLOBAL-OBJECTS \?L69
	ZERO? SIEGEL-TESTED \?L69
	FSET? SIEGEL,BUSYBIT /?L69
	CALL TELL-HINT,13,SIEGEL,0 >STACK
	RSTACK
?L69:	EQUAL? OBJ,STATION-MONITOR \?L70
	PRINTR """I just like to play with it."""
?L70:	EQUAL? OBJ,FINE-GRID \?L73
	ZERO? FINE-SONAR \?L76
	ZERO? SUB-IN-DOME \?L74
	EQUAL? NOW-TERRAIN,SEA-TERRAIN /?L74
?L76:	PRINTR """I think it's swell!"""
?L74:	PRINTI """If the "
	PRINTD SNARK
	PRINTI " stays near the sea floor, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", it may churn up silt. Even with our "
	PRINTD SEARCH-BEAM
	PRINTI " on, we might have trouble aiming a weapon. Wouldn't it be easier if we could spot its exact position by sonar?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", our "
	PRINTD SONARSCOPE
	PRINTI " shows each "
	PRINTD GRID-UNIT
	PRINTI " as 500 meters across. A blip indicates the APPROXIMATE position of an object. That's not good enough to hit the broad side of a barn! "
	ZERO? SUB-IN-DOME \?L86
	IN? FINE-GRID,TIP /?L86
	PRINTI "When we're in the "
	PRINTD AQUADOME
	PRINTI ", ask me about a "
	PRINTD FINE-GRID
	PRINTR "."""
?L86:	PRINTI "Let me install a "
	PRINTD FINE-GRID
	PRINTI " on the "
	PRINTD SONARSCOPE
	PRINTI " that'll show a blip's position to within 5 meters, okay?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	CALL QUEUE,I-TIP-REPORTS,5 >STACK
	PUT STACK,0,1
	FSET TIP,BUSYBIT
	ZERO? SUB-IN-DOME /TRUE
	EQUAL? HERE,SUB,AIRLOCK,AIRLOCK-WALL \?L97
	MOVE TIP,DOME-STORAGE
	JUMP ?L99
?L97:	MOVE TIP,SUB
?L99:	MOVE FINE-GRID,TIP
	SET 'TIP-FOLLOWS-YOU?,0
	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", I checked"
	EQUAL? HERE,DOME-STORAGE /?L102
	PRINTI " the "
	PRINTD DOME-STORAGE
?L102:	PRINTI " and found a "
	PRINTD FINE-GRID
	PRINTI " that'll fit our "
	PRINTD SONARSCOPE
	PRINTI ". I can install it quickly! I'll have someone install a fine throttle control, too, for tight maneuvering. It has the same 3 settings, but for small "
	PRINTD GRID-UNIT
	PRINTR "s -- 0, 5, 10, or 15 meters per turn."""
?L73:	CALL COMMON-ASK-ABOUT,TIP,OBJ >X
	ZERO? X /?L112
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L112:	PRINTI """You know as much as I do, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L54:	EQUAL? PRSA,V?TELL-ABOUT \?L119
	EQUAL? PRSO,GLOBAL-SNARK \FALSE
	PRINTI """I know, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! We'd better go there fast in the "
	PRINTD GLOBAL-SUB
	PRINTR "!"""
?L119:	CALL COMMON-OTHER,TIP >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT ASK-ABOUT?,PER
	EQUAL? PRSA,V?CONFRONT,V?ASK-ABOUT \?L1
	EQUAL? PRSO,PER \?L1
	ZERO? PRSI /?L1
	RETURN PRSI
?L1:	EQUAL? PRSA,V?WHAT,V?FIND \FALSE
	ZERO? PRSO /FALSE
	IN? PRSO,GLOBAL-OBJECTS \FALSE
	RETURN PRSO

	.FUNCT GLOBAL-SHARON-F,ARG=0,OBJ,L,X
	SET 'L,REMOTE-PERSON-LOC
	ZERO? SHARON-EXPLAINED \?L1
	EQUAL? REMOTE-PERSON,GLOBAL-SHARON \?L1
	SET 'SHARON-EXPLAINED,1
	CALL SHARON-EXPLAINS
	RETURN 2
?L1:	EQUAL? WINNER,GLOBAL-SHARON \?L5
	EQUAL? PRSA,V?FIND \?L10
	EQUAL? PRSO,GLOBAL-SHARON \?L6
	PRINTI """I'm in the "
	PRINTD THORPE-SUB
	PRINTR "."""
?L6:	EQUAL? PRSA,V?FIND \?L10
	EQUAL? PRSO,GLOBAL-SNARK \?L10
	PRINTR """It's right here, next to me."""
?L10:	EQUAL? PRSA,V?SET,V?PUSH /?L14
	EQUAL? PRSA,V?MOVE-DIR,V?MOVE,V?STOP \?L13
?L14:	EQUAL? PRSO,THORPE-SUB,SNARK,ROOMS \?L13
	PRINTR """I'm afraid I can't control it that well."""
?L13:	CALL COM-CHECK,GLOBAL-SHARON >X
	ZERO? X /?L17
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L17:	PRINTI """Sorry, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", but I'm too busy driving this "
	PRINTD THORPE-SUB
	PRINTI "."""
	CRLF
	RETURN 2
?L5:	EQUAL? REMOTE-PERSON,GLOBAL-SHARON \?L26
	CALL ASK-ABOUT?,GLOBAL-SHARON >OBJ
	ZERO? OBJ /?L26
	CALL SAID-TO,GLOBAL-SHARON
	EQUAL? OBJ,SNARK \?L27
	CALL SHARON-ABOUT-MONSTER
	RTRUE
?L27:	EQUAL? OBJ,THORPE-SUB \?L29
	CALL SHARON-ABOUT-CAT
	RTRUE
?L29:	EQUAL? OBJ,GLOBAL-THORPE \?L30
	CALL SHARON-ABOUT-THORPE
	RTRUE
?L30:	CALL COMMON-ASK-ABOUT,GLOBAL-SHARON,OBJ >X
	ZERO? X /?L31
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L31:	CALL DONT-KNOW,GLOBAL-SHARON,OBJ >STACK
	RSTACK
?L26:	EQUAL? PRSO,GLOBAL-SHARON \?L43
	EQUAL? PRSA,V?HELLO \?L36
	EQUAL? REMOTE-PERSON-ON,SONARPHONE,INTERCOM \?L36
	PRINTI "You hear "
	PRINTD PRSO
	PRINTR " nodding at you."
?L36:	EQUAL? PRSO,GLOBAL-SHARON \?L43
	EQUAL? PRSA,V?REPLY,V?LISTEN \?L39
	CALL WAITING-FOR-YOU-TO-SPEAK
	RTRUE
?L39:	EQUAL? PRSO,GLOBAL-SHARON \?L43
	EQUAL? PRSA,V?PHONE \?L40
	EQUAL? HERE,SUB,CRAWL-SPACE /?L40
	ZERO? SUB-IN-DOME \?L40
	PRINTR "There's no phone line to where she is."
?L40:	EQUAL? PRSO,GLOBAL-SHARON \?L43
	EQUAL? PRSA,V?READ \?L43
	CALL FIGURE-OF-SPEECH
	RTRUE
?L43:	CALL GLOBAL-PERSON >STACK
	RSTACK

	.FUNCT FIGURE-OF-SPEECH
	PRINTR "That's just a figure of speech! Try the command: SAY ""HELLO."""

	.FUNCT DONT-KNOW-ANYTHING
	PRINTR """Uh . . . I don't know anything about it."""

	.FUNCT SHARON-F,ARG=0,OBJ,L,X
	LOC SHARON >L
	EQUAL? ARG,M-OBJDESC \?L1
	IN? SHARON,OFFICE \?L3
	PRINTR "Sharon is looking through the file drawer."
?L3:	IN? SHARON,HERE \?L7
	IN? HERE,ROOMS \?L7
	PRINTR "Sharon is pacing back and forth."
?L7:	PRINTI "Sharon is sitting on the "
	LOC SHARON >STACK
	PRINTD STACK
	PRINTR "."
?L1:	EQUAL? WINNER,SHARON \?L13
	EQUAL? PRSA,V?FIND \?L14
	EQUAL? PRSO,MAGAZINE \?L16
	CALL PERFORM,V?ASK-ABOUT,SHARON,MAGAZINE
	RTRUE
?L16:	EQUAL? PRSO,GLOBAL-THORPE \FALSE
	PRINTI "Sharon looks surprised. ""I don't know, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L14:	EQUAL? PRSA,V?LOOK-INSIDE \?L22
	EQUAL? PRSO,FILE-DRAWER \?L22
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,SHARON,FILE-DRAWER
	RTRUE
?L22:	CALL COM-CHECK,SHARON >X
	ZERO? X /?L23
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L23:	PRINTR """I'm too busy right now."""
?L13:	EQUAL? PRSA,V?ASK \?L30
	IN? SHARON,OFFICE \?L30
	CALL PERFORM,V?ASK-ABOUT,SHARON,FILE-DRAWER
	RTRUE
?L30:	CALL ASK-ABOUT?,SHARON >OBJ
	ZERO? OBJ /?L31
	CALL GRAB-ATTENTION,SHARON >STACK
	ZERO? STACK /TRUE
	CALL SAID-TO,SHARON
	EQUAL? OBJ,MAGAZINE,ARTICLE \?L35
	LOC MAGAZINE >STACK
	EQUAL? STACK,SHARON,PLAYER \?L35
	PRINTI """Uh . . . That's not the "
	PRINTD MAGAZINE
	PRINTR " I'm looking for."""
?L35:	EQUAL? OBJ,CIRCUIT-BREAKER,ELECTRICAL-CONTROL-PANEL \?L39
	ZERO? SHARON-BROKE-CIRCUIT /?L39
	CALL DONT-KNOW-ANYTHING >STACK
	RSTACK
?L39:	EQUAL? OBJ,CATALYST-CAPSULE \?L40
	PRINTR """Uh . . . I guess I forgot about it. Sorry."""
?L40:	EQUAL? OBJ,GLOBAL-SHARON,SHARON \?L43
	PRINTR """You know me well and trust me completely."""
?L43:	EQUAL? OBJ,PROBLEM \?L46
	PRINTI """Sorry, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", but I just got word that my mother is ill. They want me to come to the hospital at once."
	PRINTR """"
?L46:	EQUAL? OBJ,ARTICLE /?L52
	EQUAL? OBJ,FILE-DRAWER,PAPERS,MAGAZINE \?L51
?L52:	PRINTI """I can't find the "
	PRINTD MAGAZINE
	PRINTI " I bought for my mother this morning. I thought it might be in the "
	PRINTD FILE-DRAWER
	PRINTI ". I wanted to take it to the hospital for her to read. I really must rush off, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"""
?L51:	EQUAL? OBJ,THORPE,GLOBAL-THORPE \?L55
	CALL PERFORM,V?ASK-ABOUT,SHARON,PRIVATE-MATTER
	RTRUE
?L55:	CALL COMMON-ASK-ABOUT,SHARON,OBJ >X
	ZERO? X /?L56
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L56:	CALL PICK-ONE,SHARON-ASKED >STACK
	PRINT STACK
	CRLF
	RTRUE
?L31:	EQUAL? PRSA,V?GOODBYE \?L63
	PRINTI """I'm going as soon as I find that "
	PRINTD MAGAZINE
	PRINTR "."""
?L63:	CALL COMMON-OTHER,SHARON >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT BLY-TELLS-PROBLEM
	SET 'BLY-TOLD-PROBLEM,1
	CALL QUEUE,I-SHARON-TO-HALLWAY,6 >STACK
	PUT STACK,0,1
	CALL SAID-TO,GLOBAL-BLY
	CALL THIS-IS-IT,GLOBAL-SNARK
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! Our transparent dome enclosing the "
	PRINT URS
	PRINTR " is being battered by a huge monster!"""

	.FUNCT MIKE-2-F
	PRINTI """The "
	PRINTD SNARK
	PRINTI "'s gone for now, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". It's no longer in sight."
	RTRUE

	.FUNCT GLOBAL-BLY-F,ARG=0,OBJ,L,X
	SET 'L,REMOTE-PERSON-LOC
	EQUAL? ARG,M-OBJDESC \?L1
	EQUAL? L,CENTER-OF-LAB \FALSE
	ZERO? WOMAN-ON-SCREEN /?L5
	PRINTR "You can't tell who the woman is."
?L5:	PRINTI "You can see a picture of "
	PRINTD BLY
	PRINTI " on the "
	PRINTD REMOTE-PERSON-ON
	PRINTR "."
?L1:	EQUAL? L,CENTER-OF-LAB \?L13
	CALL SPEAKING-VERB? >STACK
	ZERO? STACK /?L13
	EQUAL? PRSO,0,GLOBAL-BLY,PLAYER \?L13
	IN? MICROPHONE,PLAYER \?L14
	FSET? MICROPHONE,ONBIT /?L13
?L14:	SET 'P-CONT,0
	CALL THIS-IS-IT,MICROPHONE
	PRINTI "She can't hear you unless you "
	IN? MICROPHONE,PLAYER /?L17
	PRINTI "pick up your "
	PRINTD MICROPHONE
	FSET? MICROPHONE,ONBIT /?L21
	PRINTI " and switch it on"
?L21:	PRINTR "."
?L17:	PRINTI "switch on your "
	PRINTD MICROPHONE
	PRINTR "."
?L13:	ZERO? BLY-TOLD-PROBLEM \?L31
	EQUAL? PRSA,V?LISTEN,V?GOODBYE /?L31
	ZERO? MONSTER-GONE \?L31
	IN? MICROPHONE,PLAYER \?L31
	EQUAL? REMOTE-PERSON,GLOBAL-BLY \?L31
	CALL QUEUE,I-SEND-SUB,8 >STACK
	PUT STACK,0,1
	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! "
	CALL BLY-TELLS-PROBLEM
	RETURN 2
?L31:	EQUAL? WINNER,GLOBAL-BLY \?L40
	EQUAL? PRSA,V?FIND \?L41
	EQUAL? PRSO,GLOBAL-BLY \?L41
	PRINTI """I'm at the "
	PRINTD AQUADOME
	PRINTR "."""
?L41:	EQUAL? PRSO,PLAYER \?L45
	EQUAL? P-ADVERB,W?PRIVATELY \?L45
	EQUAL? PRSA,V?TELL /?L46
	EQUAL? PRSA,V?TELL-ABOUT \?L45
	EQUAL? PRSI,PRIVATE-MATTER \?L45
?L46:	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,GLOBAL-BLY,PRIVATE-MATTER
	RTRUE
?L45:	EQUAL? PRSA,V?EXAMINE \?L49
	EQUAL? PRSO,GLOBAL-SNARK /?L48
?L49:	EQUAL? PRSA,V?SHOW \?L47
	EQUAL? PRSO,PLAYER \?L47
	EQUAL? PRSI,GLOBAL-SNARK \?L47
?L48:	ZERO? MONSTER-GONE /?L50
	CALL MIKE-2-F
	PRINTR """"
?L50:	PRINTI "The "
	PRINTD AQUADOME
	PRINTI "'s camera pans, and the monster comes into view on your "
	PRINTD VIDEOPHONE
	PRINTR " screen. It resembles a huge sea slug, about 5 meters tall. Its clawed tentacles pound and scratch at the dome."
?L47:	EQUAL? PRSA,V?KILL \?L59
	EQUAL? PRSO,GLOBAL-SNARK /?L61
?L59:	EQUAL? PRSA,V?SHOOT,V?ATTACK \?L60
	EQUAL? PRSO,GLOBAL-SNARK \?L60
	EQUAL? PRSI,0,GLOBAL-WEAPON,GLOBAL-EXPLOSIVE /?L61
?L60:	EQUAL? PRSO,GLOBAL-EXPLOSIVE,GLOBAL-WEAPON \?L57
	EQUAL? PRSA,V?USE /?L61
	EQUAL? PRSA,V?USE-AGAINST \?L57
	EQUAL? PRSI,GLOBAL-SNARK \?L57
?L61:	ZERO? MONSTER-GONE /?L62
	CALL MIKE-2-F
	PRINTR """"
?L62:	EQUAL? PRSO,GLOBAL-EXPLOSIVE /?L67
	EQUAL? PRSI,GLOBAL-EXPLOSIVE \?L66
?L67:	PRINTI """Setting off explosions so close might damage the "
	PRINTD AQUADOME
	PRINTI " even worse than the Snark is doing."""
	CRLF
	CALL PRINT-ID,STR?211 >STACK
	RSTACK
?L66:	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", this is a peaceful research facility. We have no weapons."""
	CRLF
	CALL PRINT-ID,STR?212 >STACK
	RSTACK
?L57:	EQUAL? PRSA,V?SEND-OUT,V?SEND \?L73
	EQUAL? PRSO,GLOBAL-SUB \?L73
	PRINTI """No subs are stationed here at the "
	PRINTD AQUADOME
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L73:	EQUAL? PRSO,DISTRESS-CALL \?L76
	EQUAL? PRSA,V?SEND /?L77
	EQUAL? PRSA,V?SEND-TO \?L76
	EQUAL? PRSI,GLOBAL-SUB \?L76
?L77:	PRINTI """No response to our "
	PRINTD SONARPHONE
	PRINTI " "
	PRINTD DISTRESS-CALL
	PRINTR "s."""
?L76:	EQUAL? PRSO,GLOBAL-SUB \?L80
	EQUAL? PRSA,V?FIND /?L81
	EQUAL? PRSA,V?FIND-WITH \?L80
	EQUAL? PRSI,GLOBAL-SONAR \?L80
?L81:	PRINTI """No blips appear on the "
	PRINTD SONAR-EQUIPMENT
	PRINTR "."""
?L80:	EQUAL? PRSA,V?DISEMBARK,V?LEAVE /?L85
	EQUAL? PRSA,V?WALK-TO \?L84
	EQUAL? PRSO,GLOBAL-HERE,YOUR-LABORATORY,GLOBAL-SURFACE \?L84
?L85:	PRINTR """Our emergency escape bell would be vulnerable to a monster as big as the Snark. Ditto for SCUBA gear, deep-sea diving suits, or jet-propelled observation bubbles."""
?L84:	EQUAL? PRSA,V?ASK-FOR,V?ASK-ABOUT \?L88
	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L88:	EQUAL? PRSA,V?TELL,V?REPLY \?L93
	EQUAL? PRSO,PLAYER \?L93
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK,GLOBAL-BLY
	RTRUE
?L93:	EQUAL? PRSA,V?WAIT-FOR /?L95
	EQUAL? PRSA,V?FIND \?L94
	EQUAL? PRSO,PLAYER \?L94
?L95:	PRINTI """Okay, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR ", but hurry!"""
?L94:	CALL COM-CHECK,GLOBAL-BLY >X
	ZERO? X /?L98
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L98:	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L40:	EQUAL? REMOTE-PERSON,GLOBAL-BLY \?L107
	CALL ASK-ABOUT?,GLOBAL-BLY >OBJ
	ZERO? OBJ /?L107
	CALL SAID-TO,GLOBAL-BLY
	EQUAL? OBJ,PROBLEM \?L108
	EQUAL? L,SUB \?L110
	PRINTR """I'll tell you when we can talk privately."""
?L110:	PRINTI """"
	CALL BLY-TELLS-PROBLEM >STACK
	RSTACK
?L108:	EQUAL? OBJ,GLOBAL-SNARK \?L117
	EQUAL? REMOTE-PERSON-ON,SONARPHONE \?L118
	MOVE PRIVATE-MATTER,GLOBAL-OBJECTS
	INC 'BLY-PRIVATELY-COUNT
	PRINTI """There have been no new attacks, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". But the creature may come back. And"
	CALL DISCUSS-PRIVATE
	RTRUE
?L118:	PRINTI """Some of our divers saw it while exploring the undersea environment. They nicknamed it the Snark. This is the first time it has approached the "
	PRINTD AQUADOME
	PRINTI ", and it may be the last time, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! I'm not sure how long our plastic dome enclosure c"
	ZERO? MONSTER-GONE /?L125
	PRINTI "ould"
	JUMP ?L129
?L125:	PRINTI "an"
?L129:	PRINTR " withstand such a battering!"""
?L117:	CALL COMMON-ASK-ABOUT,GLOBAL-BLY,OBJ >X
	ZERO? X /?L134
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L134:	CALL DONT-KNOW,GLOBAL-BLY,OBJ >STACK
	RSTACK
?L107:	EQUAL? PRSA,V?$0024CALL,V?ASK \?L139
	PRINTI """Ask me about something in particular, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L139:	ZERO? WOMAN-ON-SCREEN /?L142
	EQUAL? PRSA,V?EXAMINE \?L142
	PRINTR "You can't tell who the woman is."
?L142:	EQUAL? PRSO,GLOBAL-BLY \?L145
	EQUAL? PRSA,V?HELLO \?L145
	EQUAL? REMOTE-PERSON-ON,SONARPHONE,INTERCOM \?L145
	PRINTI "You hear "
	PRINTD PRSO
	PRINTR " nodding at you."
?L145:	EQUAL? PRSA,V?GOODBYE \?L148
	PRINTI """I hope to see you soon, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "."""
	CRLF
	EQUAL? REMOTE-PERSON-ON,VIDEOPHONE \?L151
	CALL I-SHARON-TO-HALLWAY
?L151:	CALL PHONE-OFF
	RTRUE
?L148:	EQUAL? PRSO,GLOBAL-BLY \?L156
	EQUAL? PRSA,V?REPLY,V?LISTEN \?L154
	CALL WAITING-FOR-YOU-TO-SPEAK
	RTRUE
?L154:	EQUAL? PRSO,GLOBAL-BLY \?L156
	EQUAL? PRSA,V?PHONE \?L155
	EQUAL? HERE,SUB,CRAWL-SPACE /?L155
	ZERO? SUB-IN-DOME /FALSE
?L155:	EQUAL? PRSO,GLOBAL-BLY \?L156
	EQUAL? PRSA,V?READ \?L156
	CALL FIGURE-OF-SPEECH
	RTRUE
?L156:	EQUAL? PRSA,V?TELL-ABOUT \?L157
	EQUAL? PRSI,GLOBAL-SUB \FALSE
	PRINTI """The only submarine capable of hunting it at such depths is your "
	PRINTD GLOBAL-SUB
	PRINTR ". Please send us that!"""
?L157:	CALL COMMON-OTHER,GLOBAL-BLY >STACK
	ZERO? STACK \TRUE
	CALL GLOBAL-PERSON >STACK
	RSTACK

	.FUNCT BLY-F,ARG=0,OBJ,L,X
	LOC BLY >L
	EQUAL? ARG,M-OBJDESC \?L1
	CALL DESCRIBE-COLLAPSE,BLY >STACK
	RSTACK
?L1:	ZERO? DOME-AIR-BAD? /?L3
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L3
	PRINTI """Never mind me, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"" she cries. ""S-S-Something's wrong with the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI "! ... F-Fix it -- or we'll all s-s-soon be ..."""
	CRLF
	RETURN 2
?L3:	EQUAL? WINNER,BLY \?L8
	CALL GRAB-ATTENTION,BLY >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?FIND \?L11
	EQUAL? PRSO,PHOTO \?L11
	ZERO? BLY-SAW-PHOTO \?L11
	PRINTR """It's either on his person or in his locker, in the dormitory."""
?L11:	EQUAL? PRSA,V?GIVE \?L14
	EQUAL? PRSO,JOB \?L14
	EQUAL? PRSI,GLOBAL-SIEGEL,SIEGEL \?L14
	PRINTI """I'll have him check the "
	PRINTD SONAR-EQUIPMENT
	PRINTI ". Okay?"""
	CALL YES? >STACK
	ZERO? STACK /?L17
	CALL ZOE-SENDS-MARV,COMM-BLDG
	RTRUE
?L17:	PRINTI """Should I give him some chore that's close to the "
	PRINTD SONAR-EQUIPMENT
	PRINTI " so he can keep an eye on it?"""
	CALL YES? >STACK
	ZERO? STACK /?L22
	CALL ZOE-SENDS-MARV,COMM-BLDG
	RTRUE
?L22:	PRINTI """Then somewhere out of sight of the "
	PRINTD COMM-BLDG
	PRINTI "? That's where the "
	PRINTD SONAR-EQUIPMENT
	PRINTI "is."""
	CALL YES? >STACK
	ZERO? STACK /?L27
	SET 'SIEGEL-OUT-OF-SIGHT,1
	CALL ZOE-SENDS-MARV,AIRLOCK
	RTRUE
?L27:	PRINTI """Then, you'd better do it, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L14:	EQUAL? PRSA,V?TIE-TO,V?PUT \?L32
	EQUAL? PRSO,BLACK-BOX \?L32
	EQUAL? PRSI,SONAR-EQUIPMENT,GLOBAL-SONAR \?L32
	MOVE BLACK-BOX,SONAR-EQUIPMENT
	PRINTI """Wilco, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR ". Consider it done."""
?L32:	EQUAL? PRSA,V?EXAMINE,V?READ \?L35
	EQUAL? PRSO,DIARY \?L35
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,BLY,DIARY
	RTRUE
?L35:	EQUAL? PRSA,V?SHOW \?L36
	EQUAL? PRSO,PLAYER \?L37
	EQUAL? PRSI,EVIDENCE \?L36
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,BLY,PRSI
	RTRUE
?L36:	EQUAL? PRSO,PLAYER \?L37
	EQUAL? P-ADVERB,W?PRIVATELY \?L37
	EQUAL? PRSA,V?TELL /?L38
	EQUAL? PRSA,V?TELL-ABOUT \?L37
	EQUAL? PRSI,PRIVATE-MATTER \?L37
?L38:	SET 'WINNER,PLAYER
	CALL ASK-BLY-ABOUT-PRIVATE-MATTER
	RTRUE
?L37:	EQUAL? PRSA,V?ASK \?L39
	EQUAL? PRSO,PLAYER \?L39
	CALL I-BLY-SAYS,1 >STACK
	ZERO? STACK \TRUE
?L39:	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L40
	CALL EXIT-VERB? >STACK
	ZERO? STACK /?L40
	PRINTI """Not now, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L40:	CALL COM-CHECK,BLY >X
	ZERO? X /?L43
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L43:	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L8:	EQUAL? PRSA,V?ASK /?L53
	EQUAL? PRSO,BLY \?L52
	EQUAL? PRSA,V?TELL \?L52
	EQUAL? P-ADVERB,W?PRIVATELY \?L52
?L53:	CALL ASK-BLY-ABOUT-PRIVATE-MATTER
	RTRUE
?L52:	EQUAL? PRSA,V?TELL-ABOUT,V?ASK-ABOUT \?L54
	EQUAL? PRSI,CONTROL-CIRCUITS-GAUGE,CONTROL-CIRCUITS,OVERHEATING /?L55
	EQUAL? PRSI,VOLTAGE-REGULATOR,LOCAL-SUB,GLOBAL-SUB \?L54
?L55:	PRINTI """You mean the problem you had on the way here? Shall I ask Mick to check on it?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	MOVE ANTRIM,HERE
	SET 'WINNER,ANTRIM
	CALL PERFORM,V?FIX,GLOBAL-SUB
	RTRUE
?L54:	CALL ASK-ABOUT?,BLY >OBJ
	ZERO? OBJ /?L61
	CALL GRAB-ATTENTION,BLY >STACK
	ZERO? STACK /TRUE
	CALL SAID-TO,BLY
	FSET BLY,TOUCHBIT
	EQUAL? OBJ,PRIVATE-MATTER \?L65
	CALL ASK-BLY-ABOUT-PRIVATE-MATTER >STACK
	RSTACK
?L65:	EQUAL? OBJ,PROBLEM \?L67
	ZERO? DOME-AIR-BAD? /?L68
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L68
	CALL BADGES-RED
	RTRUE
?L68:	ZERO? ZOE-MENTIONED-EVIDENCE \?L70
	SET 'WINNER,PLAYER
	CALL ASK-BLY-ABOUT-PRIVATE-MATTER
	RTRUE
?L70:	EQUAL? HERE,BLY-OFFICE \?L71
	ZERO? ZOE-BLUSHING /?L71
	CALL DOC-IN-LOVE >STACK
	RSTACK
?L71:	PRINTI """I'm worried that the "
	PRINTD SNARK
	PRINTI " may attack again, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L67:	EQUAL? OBJ,DIARY \?L75
	PRINTR """I think that I can guess what's in it."""
?L75:	EQUAL? OBJ,REASON,PHOTO \?L78
	EQUAL? OBJ,PHOTO \?L79
	SET 'BLY-SAW-PHOTO,1
?L79:	CALL DISCRETION,BLY,HORVAK
	PRINTI """A friend took a picture of me just before I was assigned here. I usually keep it on my desk, but a few days after Doc came on to me, I realized it was gone."
	ZERO? BLY-SAW-PHOTO \?L84
	PRINTI " It still hasn't turned up."
?L84:	PRINTR " I think Doc took it. He wanted a picture of me."""
?L78:	EQUAL? OBJ,EVIDENCE,BLACK-BOX \?L91
	ZERO? ZOE-MENTIONED-EVIDENCE \?L92
	CALL ASK-BLY-ABOUT-PRIVATE-MATTER
	RTRUE
?L92:	PRINTI """I wanted to make sure the "
	PRINTD SONAR-EQUIPMENT
	PRINTI " would warn us if the "
	PRINTD SNARK
	PRINTI " approached again. I was worried because the blips on the scope looked fuzzy, as if the system was out of alignment. When I inspected it, I found someone had secretly attached "
	IN? BLACK-BOX,BLY-DESK /?L97
	IN? BLACK-BOX,BLY \?L101
	PUSH STR?213
	JUMP ?L103
?L101:	PUSH STR?214
?L103:	PRINT STACK
	PRINTD BLACK-BOX
	JUMP ?L104
?L97:	PRINTI "this device"
?L104:	PRINTI " to it!"""
	CRLF
	IN? BLACK-BOX,BLY-DESK \?L109
	MOVE BLACK-BOX,BLY
	CALL THIS-IS-IT,BLACK-BOX
	PRINTI "Zoe takes a small """
	PRINTD BLACK-BOX
	PRINTI """ device from her desk drawer."
	CRLF
?L109:	CALL QUEUE,I-TIP-SONAR-PLAN,-1 >STACK
	PUT STACK,0,1
	MOVE TIP-IDEA,GLOBAL-OBJECTS
	RTRUE
?L91:	EQUAL? OBJ,SIEGEL,GLOBAL-SIEGEL \?L114
	ZERO? SIEGEL-TESTED \?L117
	FSET? SIEGEL,BUSYBIT /?L117
	IN? BLACK-BOX,BLY-DESK \?L115
?L117:	CALL DISCRETION,BLY,SIEGEL
	PRINTI """"
	JUMP ?L120
?L115:	CALL DISCRETION,BLY,SIEGEL,ANTRIM
	PRINTI """I bet you're wondering if he could have attached that "
	PRINTD BLACK-BOX
	PRINTI " to the "
	PRINTD SONAR-EQUIPMENT
	PRINTI ".
I agree that he had the opportunity, but all I can say, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", is that he's no troublemaker like "
	PRINTD ANTRIM
	PRINTI "."
	CRLF
?L120:	PRINTI "He's a great diver and a skilled electronics engineer.
I think he really enjoys exploring the undersea environment. He discovered that "
	PRINTD ORE-NODULES
	PRINTI " on the sea floor near the "
	PRINTD AQUADOME
	PRINTI ".
I have no reason to suspect him of trying to sabotage the "
	PRINT URS
	PRINTI " of "
	PRINTD IU-GLOBAL
	PRINTI "."
	ZERO? SIEGEL-TESTED \?L127
	FSET? SIEGEL,BUSYBIT /?L127
	IN? BLACK-BOX,BLY-DESK \?L125
?L127:	PRINTR """"
?L125:	PRINTI " But I do have a plan that will help us find out. Do you want to hear it, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "?"""
	MOVE BLY-PLAN,GLOBAL-OBJECTS
	CALL YES? >STACK
	ZERO? STACK /TRUE
	CALL QUEUE,I-TIP-SONAR-PLAN,0
	CALL TELL-HINT,13,SIEGEL,0
	RTRUE
?L114:	EQUAL? OBJ,BLY-PLAN \?L136
	CALL TELL-HINT,13,SIEGEL,0 >STACK
	RSTACK
?L136:	EQUAL? OBJ,ANTRIM,GLOBAL-ANTRIM \?L137
	PRINTI "Just hearing Antrim's name makes her eyes flash fire, and she clenches her fists. You can tell she's had a hard time keeping her temper when dealing with Antrim.
"
	CALL DISCRETION,BLY,ANTRIM
	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", that redheaded troublemaker's been nothing but bad news since the day I arrived! He's always got a chip on his shoulder and looks for ways to embarrass me or start a fight."
	ZERO? ANTRIM-EXPLODED /?L142
	PRINTI " You heard his remarks about the "
	PRINTD OXYGEN-GEAR
	PRINTI "."
?L142:	PRINTR " Most of the time he complains about discipline, but whenever I ease up he's always the first to accuse me of laxity!"""
?L137:	EQUAL? OBJ,ORE-NODULES \?L149
	PRINTI """Oops, I forgot you hadn't heard about it, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". I was about to report it when we were attacked. "
	PRINTD SIEGEL
	PRINTI " discovered it by accident. The ore is mostly manganese and iron, but there's gold and platinum, and there may be traces of rare earths, too. This could be the richest payoff yet from the "
	PRINTD AQUADOME
	PRINTR "!"""
?L149:	EQUAL? OBJ,SPECIAL-TOOL \?L152
	PRINTI """That belongs on the "
	PRINTD HOOK
	PRINTI "!"
	IN? SPECIAL-TOOL,BLY-OFFICE \?L155
	PRINTI " Why is it in my office? It hasn't been there long! When I "
	EQUAL? HERE,BLY-OFFICE \?L159
	PRINTI "came back "
	JUMP ?L163
?L159:	PRINTI "went back t"
?L163:	PRINTI "here to put something in a drawer, I knocked a pen off my desk. I had to stoop down to find it. Had that wrench been lying under my desk, I would have seen it!"
?L155:	PRINTR """"
?L152:	EQUAL? OBJ,GLOBAL-HORVAK,HORVAK \?L171
	FSET? SPECIAL-TOOL,TOUCHBIT /?L172
	CALL DOC-IN-LOVE >STACK
	RSTACK
?L172:	SET 'ZOE-BLUSHING,1
	CALL DISCRETION,BLY,HORVAK
	PRINTI """I wonder if he sabotaged the "
	PRINTD AIR-SUPPLY-SYSTEM
	ZERO? HORVAK-FIXED-AIR \?L177
	PRINTI " and then ditched the wrench there"
?L177:	PRINTI "?"
	ZERO? HORVAK-FIXED-AIR \?L184
	PRINTI " He had the opportunity: he could have tossed it there when he came to get my "
	PRINTD OXYGEN-GEAR
	PRINTI ". But"
?L184:	PRINTR " I just can't BELIEVE Doc would cut off our air supply!""
Zoe blushes and her voice trembles with emotion as she speaks."
?L171:	EQUAL? OBJ,LOWELL,GLOBAL-LOWELL /?L192
	EQUAL? OBJ,GREENUP,GLOBAL-GREENUP \?L197
	ZERO? GREENUP-GUILT \?L191
?L192:	PRINTI """"
	CALL HE-SHE-IT,OBJ,1
	PRINTR "'s an excellent diver."""
?L191:	EQUAL? OBJ,GREENUP,GLOBAL-GREENUP \?L197
	PRINTR """I never would have suspected him!"""
?L197:	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT /?L200
	EQUAL? OBJ,AIR-SUPPLY-SYSTEM,AIR-SUPPLY-SYSTEM-GLOBAL,GLOBAL-SABOTAGE \?L200
	IN? CREW,HERE \?L201
	PRINTI "Zoe shoots a troubled glance at her five crew members.
"
?L201:	PRINTI """Once we saw your "
	PRINTD SEARCH-BEAM
	PRINTI " beam, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", we were all watching for your arrival outside the dome. Any one of us could have tampered with the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI " without being noticed.""
"
	CALL TIP-SAYS
	PRINTI "One thing's for sure. Whoever did it also took that "
	PRINTD SPECIAL-TOOL
	PRINTI "!""
"
	IN? ANTRIM,HERE \TRUE
	SET 'ANTRIM-EXPLODED,1
	PRINTD ANTRIM
	PRINTI " explodes: ""That shows you what kind of a commander Bly is! Regulations state that EVERYONE has to wear "
	PRINTD OXYGEN-GEAR
	PRINTR " all the time. But neither of those two divers were wearing theirs! Bly wasn't even wearing HER OWN!"""
?L200:	CALL COMMON-ASK-ABOUT,BLY,OBJ >X
	ZERO? X /?L215
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L215:	CALL DONT-KNOW,BLY,OBJ >STACK
	RSTACK
?L61:	CALL COMMON-OTHER,BLY >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT ASK-BLY-ABOUT-PRIVATE-MATTER
	CALL QUEUE,I-BLY-PRIVATELY,0
	EQUAL? HERE,BLY-OFFICE \?L1
	CALL ZOE-MENTIONS-EVIDENCE
	RTRUE
?L1:	PRINTI """Come to my office"
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ".""
"
	ZERO? DOME-AIR-BAD? \?L6
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L6
	MOVE ANTRIM,HERE
	PRINTI "As you turn to leave with "
	PRINTD BLY
	PRINTI ", "
	PRINTD ANTRIM
	PRINTI " explodes angrily:
""What's so private, 'Captain Bly'? If you have a complaint, why not spill it now? Or are you afraid we might complain about YOU?!""
Before you can say anything, Zoe yells:
""That's enough, Antrim! Maybe I have some complaints about the way the crew performs. When I make any about you, or hand out disciplinary action, you'll be the first to -- to --""
"
	CALL I-DOME-AIR,1 >STACK
	RSTACK
?L6:	MOVE BLY,BLY-OFFICE
	FSET BLY,NDESCBIT
	SET 'WINNER,PLAYER
	CALL GOTO,BLY-OFFICE >STACK
	RSTACK

	.FUNCT DOC-IN-LOVE
	CALL DISCRETION,BLY,HORVAK
	PRINTI """This is embarrassing. Doc's in love with me, or so he says.
When he said he loved me, I didn't handle it well. I lost my poise and told him this was a scientific research station, not a singles resort, and that I was his commanding officer -- so cut the romantic stuff and go back to work.
"
	FSET? SPECIAL-TOOL,TOUCHBIT \?L3
	MOVE REASON,GLOBAL-OBJECTS
	PRINTI "Maybe you'll say Doc was angry over that, and hurting the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI " was his way of getting revenge. But I don't think so. I've reason to think he still loves me.
"
?L3:	PRINTI "Anyhow, if "
	FSET? SPECIAL-TOOL,TOUCHBIT \?L10
	PRINTI "you still suspect him, and "
?L10:	PRINTI "you want another slant on what makes him tick, you should talk to his "
	PRINTD LAB-ASSISTANT
	PRINTR "."""

	.FUNCT ZOE-SENDS-MARV,PLACE
	PRINTI """Wilco, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "."
	ZERO? SIEGEL-OUT-OF-SIGHT \?L3
	PRINTI " I'm afraid he may have seen me going there to put the "
	PRINTD BLACK-BOX
	PRINTI " on the "
	PRINTD SONAR-EQUIPMENT
	PRINTI "."
?L3:	MOVE SIEGEL,PLACE
	EQUAL? PLACE,COMM-BLDG \?L8
	IN? BLACK-BOX,SONAR-EQUIPMENT \?L8
	FSET SIEGEL,BUSYBIT
	CALL QUEUE,I-SIEGEL-REPORTS,4 >STACK
	PUT STACK,0,1
?L8:	PRINTI """"
	CRLF
	PRINTI "Zoe sends "
	PRINTD SIEGEL
	PRINTI " into the "
	PRINTD PLACE
	PRINTR "."

	.FUNCT IS-CREW?,PER
	EQUAL? PER,LOWELL,ANTRIM,HORVAK /TRUE
	EQUAL? PER,SIEGEL,GREENUP /TRUE
	RFALSE

	.FUNCT CREW-5-TOGETHER?,L
	LOC LOWELL >L
	LOC ANTRIM >STACK
	EQUAL? L,STACK \?L1
	LOC HORVAK >STACK
	EQUAL? L,STACK \?L1
	LOC SIEGEL >STACK
	EQUAL? L,STACK \?L1
	LOC GREENUP >STACK
	EQUAL? L,STACK \?L1
	MOVE CREW,L
	RTRUE
?L1:	REMOVE CREW
	RFALSE

	.FUNCT ANTRIM-F,ARG=0,OBJ,X,SUB0,SUB1
	EQUAL? ARG,M-OBJDESC \?L1
	IN? ANTRIM,AIRLOCK \?L3
	CALL DESCRIBE-PERSON,ANTRIM,STR?215
	RTRUE
?L3:	CALL DESCRIBE-COLLAPSE,ANTRIM
	RTRUE
?L1:	EQUAL? WINNER,ANTRIM \?L6
	CALL GRAB-ATTENTION,ANTRIM >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?FIX /?L10
	EQUAL? PRSA,V?EXAMINE,V?ANALYZE,V?ADJUST \?L9
?L10:	EQUAL? PRSO,CONTROL-CIRCUITS-GAUGE,CONTROL-CIRCUITS,OVERHEATING /?L11
	EQUAL? PRSO,VOLTAGE-REGULATOR,LOCAL-SUB,GLOBAL-SUB \?L9
?L11:	ZERO? ANTRIM-CHECKED-SUB /?L12
	PRINTR """I already did that!"""
?L12:	MOVE BLY,HERE
	SET 'ASKED-ANTRIM,1
	CALL I-ANTRIM-TO-SUB,STR?216
	PRINTI "But "
	PRINTD BLY
	PRINTI " has heard your order. ""Please remember, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ","" she says, ""while Mick is working on your "
	PRINTD SUB
	PRINTI ", it'll be out of action. The "
	PRINTD SNARK
	PRINTI " may return at any time, and we'll be defenseless! Are you sure you want to repair the "
	PRINTD SUB
	PRINTI " now?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	GET ON-SUB,0 >SUB0
	GET ON-SUB,1 >SUB1
	EQUAL? BAZOOKA,SUB0 \?L23
	EQUAL? DART,SUB1 /TRUE
?L23:	PRINTI """Then why not use the time to arm the "
	PRINTD SUB
	EQUAL? BAZOOKA,SUB0 /?L28
	EQUAL? DART,SUB1 \?L26
?L28:	PRINTI " better"
?L26:	PRINTI "?"" Zoe goes on."
	CRLF
	EQUAL? BAZOOKA,SUB0 /?L34
	CALL TELL-HINT,73,CLAW,0
?L34:	EQUAL? DART,SUB1 /?L37
	CALL TELL-HINT,72,DART
?L37:	SET 'BLY-PRIVATELY-DELAY,1
	PRINTI "
""If you want to consider your options"
	PRINTI ", let's go to"
	EQUAL? DART,SUB1 /?L44
	PRINTI " the "
	PRINTD DOME-LAB
	JUMP ?L48
?L44:	EQUAL? BAZOOKA,SUB0 /?L48
	LOC BAZOOKA >STACK
	CALL PRINTT,STACK
?L48:	PRINTR "."""
?L9:	CALL COM-CHECK,ANTRIM >X
	ZERO? X /?L56
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L56:	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L6:	CALL ASK-ABOUT?,ANTRIM >OBJ
	ZERO? OBJ /?L65
	CALL GRAB-ATTENTION,ANTRIM >STACK
	ZERO? STACK /TRUE
	CALL SAID-TO,ANTRIM
	EQUAL? OBJ,GLOBAL-BLY \?L69
	PRINTR """What a slave driver! Sometimes I call her 'Captain Bly'!"""
?L69:	CALL COMMON-ASK-ABOUT,ANTRIM,OBJ >X
	ZERO? X /?L73
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L73:	CALL DONT-KNOW,ANTRIM,OBJ >STACK
	RSTACK
?L65:	CALL COMMON-OTHER,ANTRIM >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT HORVAK-F,ARG=0,OBJ,X,L
	LOC HORVAK >L
	EQUAL? ARG,M-OBJDESC \?L1
	CALL DESCRIBE-COLLAPSE,HORVAK >STACK
	RSTACK
?L1:	EQUAL? WINNER,HORVAK \?L3
	CALL GRAB-ATTENTION,HORVAK >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?FIX,V?EXAMINE,V?ANALYZE \?L6
	EQUAL? PRSO,ESCAPE-POD-UNIT,SYRINGE \?L6
	MOVE SYRINGE,HORVAK
	FCLEAR SYRINGE,TAKEBIT
	FSET HORVAK,BUSYBIT
	CALL QUEUE,I-ANALYSIS,4 >STACK
	PUT STACK,0,1
	IN? HORVAK,DOME-LAB /?L7
	MOVE HORVAK,DOME-LAB
	PRINTI "He heads for the "
	PRINTD DOME-LAB
	PRINTI ". "
?L7:	PRINTI "It will take "
	PRINTD HORVAK
	PRINTI " 4 turns to analyze the chemical contents of"
	CALL THE-PRSO-PRINT
	PRINTR "."
?L6:	EQUAL? PRSA,V?TAKE,V?FIX \?L14
	EQUAL? PRSO,DART \?L14
	FCLEAR PRSO,NDESCBIT
	EQUAL? PRSA,V?TAKE \?L15
	MOVE PRSO,HORVAK
	PRINTR """Okay."""
?L15:	CALL FIX-DART >STACK
	RSTACK
?L14:	EQUAL? PRSO,HORVAK-LOCKER \?L22
	EQUAL? PRSA,V?OPEN /?L21
?L22:	EQUAL? PRSO,HORVAK-KEY \?L23
	EQUAL? PRSA,V?GIVE /?L21
?L23:	EQUAL? PRSI,HORVAK-KEY \?L20
	EQUAL? PRSA,V?SGIVE \?L20
?L21:	SET 'WINNER,PLAYER
	CALL PERFORM,V?SEARCH,HORVAK
	RTRUE
?L20:	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \?L24
	EQUAL? PRSO,ARTICLE,MAGAZINE \?L24
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,HORVAK,MAGAZINE
	RTRUE
?L24:	CALL COM-CHECK,HORVAK >X
	ZERO? X /?L25
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L25:	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L3:	CALL ASK-ABOUT?,HORVAK >OBJ
	ZERO? OBJ /?L34
	CALL GRAB-ATTENTION,HORVAK >STACK
	ZERO? STACK /TRUE
	CALL SAID-TO,HORVAK
	EQUAL? OBJ,SPECIAL-TOOL,SPECIAL-TOOL-GLOBAL \?L38
	ZERO? HORVAK-FIXED-AIR /?L40
	PRINTI """I found it in the "
	PRINTD BLY-OFFICE
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", when I ran in there to get her "
	PRINTD OXYGEN-GEAR
	PRINTR ". I spotted it under her desk."""
?L40:	CALL DONT-KNOW-ANYTHING >STACK
	RSTACK
?L38:	EQUAL? OBJ,BLY,GLOBAL-BLY \?L45
	IN? REASON,GLOBAL-OBJECTS \?L46
	PRINTR """It's true. I can't hide my love for her any longer."""
?L46:	PRINTR """I have no complaints."""
?L45:	EQUAL? OBJ,HORVAK-LOCKER,HORVAK-KEY \?L53
	SET 'WINNER,PLAYER
	CALL PERFORM,V?SEARCH,HORVAK
	RTRUE
?L53:	EQUAL? OBJ,PHOTO \?L54
	PRINTR """I took it because I wanted a picture of her."""
?L54:	EQUAL? OBJ,SYRINGE,ESCAPE-POD-UNIT \?L57
	ZERO? GREENUP-GUILT /?L58
	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", the "
	PRINTD SYRINGE
	PRINTI " contains a lot of arsenic, and some arsenic is missing from my "
	PRINTD CHEMICAL-SUPPLY-SHELVES
	PRINTI "! If you'd been jabbed with that "
	PRINTD SYRINGE
	PRINTR ", you'd be dead!"""
?L58:	SET 'WINNER,HORVAK
	CALL PERFORM,V?ANALYZE,SYRINGE
	RTRUE
?L57:	EQUAL? OBJ,MAGAZINE,ARTICLE \?L63
	FSET? DART,MUNGBIT \?L63
	PRINTI "Doc quickly reads the "
	PRINTD ARTICLE
	PRINTI ", then flashes you an excited glance.
"""
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", Thorpe's sea creatures evolved from AMINO-HYDROPHASE. If the Snark's his creation, then I know exactly what drug will tranquilize it! Shall I make some up?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	CALL FIX-DART
	GET ON-SUB,0 >STACK
	EQUAL? BAZOOKA,STACK /TRUE
	CALL META-LOC,BLY >STACK
	EQUAL? STACK,HERE \TRUE
	PRINTD BLY
	PRINTI " still looks worried. """
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", you should have a really high-powered weapon, too. You may run up against an enemy sub, if Thorpe himself is operating around here. Can you think of any device to use as a weapon of last resort?"""
	CALL YES? >STACK
	ZERO? STACK /?L75
	PRINTI """Show me what device you have in mind, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L75:	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT /TRUE
	CALL SAID-TO,TIP
	CALL THIS-IS-IT,BAZOOKA
	PRINTI "Once again, Tip has an idea."
	CRLF
	CALL TELL-HINT,71,BAZOOKA
	PRINTI """Shall I have it mounted on the other "
	PRINTD CLAW
	PRINTI " of the "
	PRINTD SUB
	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	CALL MOUNT-WEAPON,BAZOOKA
	CALL FINE-SEQUENCE
	RTRUE
?L63:	CALL COMMON-ASK-ABOUT,HORVAK,OBJ >X
	ZERO? X /?L90
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L90:	CALL DONT-KNOW,HORVAK,OBJ >STACK
	RSTACK
?L34:	EQUAL? PRSA,V?GIVE \?L95
	IN? PRSO,PLAYER \?L95
	EQUAL? PRSI,HORVAK \?L95
	EQUAL? PRSO,MAGAZINE \?L96
	MOVE PRSO,HORVAK
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,HORVAK,MAGAZINE
	RTRUE
?L96:	EQUAL? PRSO,SYRINGE \FALSE
	MOVE PRSO,HORVAK
	PRINTI """Want me to analyze this, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK /FALSE
	SET 'WINNER,HORVAK
	CALL PERFORM,V?ANALYZE,SYRINGE
	RTRUE
?L95:	EQUAL? PRSA,V?SEARCH \?L105
	PRINTI """Certainly not! The contents of my locker are my private property!"""
	CRLF
	CALL PRINT-ID,STR?217 >STACK
	RSTACK
?L105:	CALL COMMON-OTHER,HORVAK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT FIX-DART
	FSET? DART,MUNGBIT /?L1
	PRINTR """Hey, I already did that!"""
?L1:	MOVE HORVAK,DOME-LAB
	MOVE DART,HORVAK
	CALL QUEUE,I-SYNTHESIS,5 >STACK
	PUT STACK,0,1
	FSET HORVAK,BUSYBIT
	PRINTR "This will take 5 turns."

	.FUNCT SIEGEL-F,ARG=0,OBJ,X,L
	LOC SIEGEL >L
	EQUAL? ARG,M-OBJDESC \?L1
	FSET? SIEGEL,BUSYBIT \?L3
	CALL DESCRIBE-PERSON,SIEGEL,STR?218 >STACK
	RSTACK
?L3:	CALL DESCRIBE-COLLAPSE,SIEGEL >STACK
	RSTACK
?L1:	EQUAL? WINNER,SIEGEL \?L6
	CALL GRAB-ATTENTION,SIEGEL >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?FIX /?L10
	EQUAL? PRSA,V?EXAMINE,V?ANALYZE,V?ADJUST \?L9
?L10:	EQUAL? PRSO,SONAR-EQUIPMENT,GLOBAL-SONAR \?L9
	PRINTI """Right, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". No doubt you're testing all systems. I'll "
	EQUAL? HERE,COMM-BLDG /?L15
	PRINTI "report back and "
?L15:	PRINTI "let you know if the sonar's working okay."""
	CRLF
	MOVE SIEGEL,COMM-BLDG
	FSET SIEGEL,BUSYBIT
	CALL QUEUE,I-SIEGEL-REPORTS,4 >STACK
	PUT STACK,0,1
	RTRUE
?L9:	CALL COM-CHECK,SIEGEL >X
	ZERO? X /?L22
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L22:	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L6:	CALL ASK-ABOUT?,SIEGEL >OBJ
	ZERO? OBJ /?L31
	CALL GRAB-ATTENTION,SIEGEL >STACK
	ZERO? STACK /TRUE
	CALL SAID-TO,SIEGEL
	EQUAL? OBJ,GLOBAL-SONAR,SONAR-EQUIPMENT,SONAR-MAN \?L35
	PRINTI """I operate the "
	PRINTD SONAR-EQUIPMENT
	PRINTR "."""
?L35:	EQUAL? OBJ,BLACK-BOX \?L39
	FSET? SIEGEL,BUSYBIT \?L40
	CALL I-SIEGEL-REPORTS >STACK
	ZERO? STACK \TRUE
?L40:	PRINTI """"
	CALL SIEGEL-BOX
	RTRUE
?L39:	CALL COMMON-ASK-ABOUT,SIEGEL,OBJ >X
	ZERO? X /?L45
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L45:	CALL DONT-KNOW,SIEGEL,OBJ >STACK
	RSTACK
?L31:	CALL COMMON-OTHER,SIEGEL >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT GREENUP-F,ARG=0,OBJ,X,L
	LOC GREENUP >L
	EQUAL? ARG,M-OBJDESC \?L1
	ZERO? GREENUP-CUFFED /?L3
	PRINTR "Greenup is handcuffed to a pipe."
?L3:	CALL DESCRIBE-COLLAPSE,GREENUP >STACK
	RSTACK
?L1:	EQUAL? WINNER,GREENUP \?L8
	CALL GRAB-ATTENTION,GREENUP >STACK
	ZERO? STACK /TRUE
	CALL MOUNTING-VERB?,ESCAPE-POD-UNIT >STACK
	ZERO? STACK /?L11
	FSET? ESCAPE-POD-UNIT,TAKEBIT \?L11
	CALL INSTALL-ESCAPE-POD-UNIT,GREENUP >STACK
	RSTACK
?L11:	CALL COM-CHECK,GREENUP >X
	ZERO? X /?L12
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L12:	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L8:	CALL ASK-ABOUT?,GREENUP >OBJ
	ZERO? OBJ /?L21
	CALL GRAB-ATTENTION,GREENUP >STACK
	ZERO? STACK /TRUE
	CALL SAID-TO,GREENUP
	EQUAL? OBJ,SYRINGE,ESCAPE-POD-UNIT \?L25
	IN? ESCAPE-POD-UNIT,SUB \?L25
	ZERO? GREENUP-GUILT /?L27
	FSET? GREENUP,MUNGBIT /?L27
	CALL PERFORM,V?ARREST,GREENUP
	RTRUE
?L27:	CALL DONT-KNOW-ANYTHING
	RTRUE
?L25:	ZERO? GREENUP-TRAPPED \?L31
	ZERO? GREENUP-CUFFED /?L30
?L31:	PRINTR "His only response is a sneer and silence."
?L30:	CALL COMMON-ASK-ABOUT,GREENUP,OBJ >X
	ZERO? X /?L34
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L34:	CALL DONT-KNOW,GREENUP,OBJ >STACK
	RSTACK
?L21:	EQUAL? PRSA,V?ASK \?L39
	ZERO? GREENUP-TRAPPED /FALSE
	CALL PERFORM,V?ASK-ABOUT,GREENUP,MOTIVE
	RTRUE
?L39:	CALL COMMON-OTHER,GREENUP >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT LOWELL-F,ARG=0,OBJ,X,L
	LOC LOWELL >L
	EQUAL? ARG,M-OBJDESC \?L1
	CALL DESCRIBE-COLLAPSE,LOWELL >STACK
	RSTACK
?L1:	EQUAL? WINNER,LOWELL \?L3
	CALL GRAB-ATTENTION,LOWELL >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?FIND \?L6
	EQUAL? PRSO,DIARY \FALSE
	CALL PERFORM,V?ASK-ABOUT,LOWELL,DIARY
	RTRUE
?L6:	CALL MOUNTING-VERB?,ESCAPE-POD-UNIT >STACK
	ZERO? STACK /?L10
	FSET? ESCAPE-POD-UNIT,TAKEBIT \?L10
	CALL INSTALL-ESCAPE-POD-UNIT,LOWELL >STACK
	RSTACK
?L10:	CALL COM-CHECK,LOWELL >X
	ZERO? X /?L11
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L11:	CALL PICK-ONE,WHY-ME >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L3:	CALL ASK-ABOUT?,LOWELL >OBJ
	ZERO? OBJ /?L20
	CALL GRAB-ATTENTION,LOWELL >STACK
	ZERO? STACK /TRUE
	CALL SAID-TO,LOWELL
	EQUAL? OBJ,HORVAK,GLOBAL-HORVAK \?L24
	CALL DISCRETION,LOWELL,HORVAK
	PRINTI """He's dedicated to scientific research. He's a great marine biologist and enjoys his work here at the "
	PRINTD AQUADOME
	PRINTI ", or he HAS enjoyed it until recently.
I don't know why, but "
	PRINTD HORVAK
	PRINTR " has become moody and introverted. I've seen him writing in a private diary."""
?L24:	EQUAL? OBJ,DIARY \?L28
	FSET? DIARY,TOUCHBIT /?L28
	CALL DISCRETION,LOWELL,HORVAK
	PRINTI """It's not in the lab. "
	PRINTD HORVAK
	PRINTR "'s always secretive about his diary. He would never leave it around where anyone might find it. It's probably in his locker, in the crew's dormitory."""
?L28:	EQUAL? OBJ,LAB-ASSISTANT \?L31
	PRINTI """I'm "
	PRINTD HORVAK
	PRINTI "'s "
	PRINTD LAB-ASSISTANT
	PRINTR "."""
?L31:	CALL COMMON-ASK-ABOUT,LOWELL,OBJ >X
	ZERO? X /?L34
	EQUAL? X,M-FATAL \TRUE
	RFALSE
?L34:	CALL DONT-KNOW,LOWELL,OBJ >STACK
	RSTACK
?L20:	CALL COMMON-OTHER,LOWELL >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT GLOBAL-THORPE-F
	EQUAL? PRSA,V?AIM \?L4
	EQUAL? PRSO,BAZOOKA,DART /FALSE
?L4:	EQUAL? PRSA,V?ATTACK,V?KILL,V?SHOOT \?L1
	EQUAL? PRSI,BAZOOKA,DART /FALSE
?L1:	EQUAL? PRSA,V?TELL-ABOUT \?L5
	EQUAL? PRSO,PLAYER \?L5
	IN? MAGAZINE,PLAYER \?L6
	PRINTI "He is a noted marine biologist.
The "
	PRINTD ARTICLE
	PRINTI " mentions that he may have created synthetic forms of sea life by genetic engineering.
He can't be located to discuss this. He apparently has gone into hiding to evade the resulting publicity.
He has told close friends he will soon marry an American woman named "
	PRINTD SHARON
	PRINTR "."
?L6:	FSET? MAGAZINE,TOUCHBIT \FALSE
	PRINTI "Try looking in the "
	PRINTD MAGAZINE
	PRINTR "."
?L5:	CALL GLOBAL-PERSON >STACK
	RSTACK

	.FUNCT BRING-ME,WHAT,WHO,L
	IN? WHAT,GLOBAL-OBJECTS \?L1
	FSET? WHAT,PERSON \?L1
	GETP WHAT,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >WHAT
?L1:	CALL META-LOC,WHAT >L
	IN? L,ROOMS \?L4
	CALL FAR-AWAY?,L >STACK
	ZERO? STACK \?L4
	FSET? WHAT,PERSON \?L7
	FSET? WHAT,MUNGBIT /?L7
	FSET? WHAT,BUSYBIT \?L6
?L7:	FSET? WHAT,TAKEBIT \?L4
	EQUAL? HERE,CRAWL-SPACE,SUB /?L4
?L6:	EQUAL? L,HERE \?L8
	FSET? WHAT,PERSON \?L8
	CALL ALREADY,WHAT,STR?65
	RTRUE
?L8:	MOVE WHO,HERE
	MOVE WHAT,WHO
	FCLEAR WHAT,NDESCBIT
	FCLEAR WHAT,INVISIBLE
	FSET WHAT,TOUCHBIT
	EQUAL? L,HERE \?L11
	PRINTI """Okay."""
	JUMP ?L15
?L11:	PRINTI """Here is"
	CALL PRINTT,WHAT
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "."" "
?L15:	FSET? WHAT,PERSON \?L18
	MOVE WHAT,HERE
	CALL HE-SHE-IT,WHAT,1
	PRINTI "'s wondering why you want to see "
	CALL HIM-HER-IT,WHAT
	PRINTI "."
?L18:	CRLF
	RTRUE
?L4:	ZERO? ZOE-MENTIONED-EVIDENCE /?L25
	EQUAL? WHAT,EVIDENCE /FALSE
?L25:	PRINTI """Sorry, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR ", but I don't think I can."""

	.FUNCT CARRY-CHECK,PER
	CALL PRINT-CONT,PER,1,0 >STACK
	RSTACK

	.FUNCT COM-CHECK,PER
	CALL GRAB-ATTENTION,PER >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?ARM \?L3
	EQUAL? PRSO,GLOBAL-SUB,LOCAL-SUB \FALSE
	PRINTI """Good idea, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "! How do you want to do that?"""
?L3:	EQUAL? PRSA,V?WALK-TO \?L9
	EQUAL? PRSO,GLOBAL-HERE \FALSE
	PRINTI """I am here, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"""
?L9:	EQUAL? PRSO,BAZOOKA,DART \?L15
	CALL MOUNTING-VERB?,PRSO >STACK
	ZERO? STACK /?L15
	SET 'WINNER,PLAYER
	CALL PERFORM,PRSA,PRSO,PRSI
	RTRUE
?L15:	EQUAL? PRSA,V?FIND \?L16
	EQUAL? PRSO,GLOBAL-SNARK \?L17
	ZERO? MONSTER-GONE /?L17
	CALL IS-CREW?,PER >STACK
	ZERO? STACK \?L19
	EQUAL? PER,BLY,GLOBAL-BLY \?L17
?L19:	SET 'TOLD-SNARK-WENT,1
	CALL TELL-HINT,62,SNARK,0 >STACK
	RSTACK
?L17:	RETURN 2
?L16:	EQUAL? PRSA,V?FIX \?L23
	EQUAL? PRSO,ARM,GASH \FALSE
	FSET? ARM,MUNGBIT \FALSE
	EQUAL? WINNER,HORVAK \?L26
	FCLEAR ARM,MUNGBIT
	FSET GASH,INVISIBLE
	PRINTD HORVAK
	PRINTR " quickly bandages your gash. Your arm is as good as new."
?L26:	PRINTR """I think Doc can do that better himself."""
?L23:	EQUAL? PRSA,V?THANKS \?L34
	RETURN 2
?L34:	EQUAL? PRSA,V?TAKE /?L38
	EQUAL? PRSA,V?SEND-TO,V?SEND,V?BRING \?L37
?L38:	IN? PRSO,PLAYER \?L39
	SET 'WINNER,PLAYER
	CALL PERFORM,V?GIVE,PRSO,PER
	RTRUE
?L39:	FSET? PRSO,TRYTAKEBIT /FALSE
	CALL BRING-ME,PRSO,PER >STACK
	RSTACK
?L37:	EQUAL? PRSA,V?EXAMINE \?L43
	SET 'WINNER,PLAYER
	CALL PERFORM,V?SHOW,PER,PRSO
	RTRUE
?L43:	EQUAL? PRSA,V?FOLLOW \?L44
	EQUAL? PRSO,PLAYER \FALSE
	PRINTR """If you want me to go somewhere, just say so."""
?L44:	EQUAL? PRSA,V?GIVE \?L50
	EQUAL? PRSI,PLAYER \?L50
	SET 'WINNER,PLAYER
	CALL PERFORM,V?TAKE,PRSO,PER
	RTRUE
?L50:	EQUAL? PRSA,V?SGIVE \?L51
	EQUAL? PRSO,PLAYER \?L51
	SET 'WINNER,PLAYER
	CALL PERFORM,V?TAKE,PRSI,PER
	RTRUE
?L51:	EQUAL? PRSA,V?THROUGH,V?LEAVE,V?WALK-TO /?L53
	EQUAL? PRSA,V?WALK /?L53
	EQUAL? PRSA,V?SGIVE,V?GIVE,V?DROP \?L52
?L53:	EQUAL? PER,REMOTE-PERSON /FALSE
	RETURN 2
?L52:	EQUAL? PRSA,V?GOODBYE,V?HELLO \?L59
	ZERO? PRSO /?L62
	EQUAL? PRSO,PER \FALSE
?L62:	SET 'WINNER,PLAYER
	CALL PERFORM,PRSA,PER
	RTRUE
?L59:	EQUAL? PRSA,V?HELP \?L64
	EQUAL? PRSO,0,PLAYER \?L65
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK,PER
	RTRUE
?L65:	RETURN 2
?L64:	EQUAL? PRSA,V?INVENTORY \?L70
	CALL CARRY-CHECK,PER >STACK
	ZERO? STACK \TRUE
	PRINTD PER
	PRINTR " isn't holding anything."
?L70:	EQUAL? PRSA,V?LISTEN \?L76
	EQUAL? PRSO,PLAYER-NAME /?L79
	IN? PRSO,GLOBAL-OBJECTS /FALSE
?L79:	PRINTI """I'm trying to, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"""
?L76:	EQUAL? PRSA,V?SHOW \?L83
	EQUAL? PRSO,PLAYER \FALSE
	IN? PRSI,PER \?L86
	SET 'WINNER,PLAYER
	CALL PERFORM,V?TAKE,PRSI,PER
	RTRUE
?L86:	PRINTI """I'm sure you can find "
	CALL HIM-HER-IT,PRSI
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L83:	EQUAL? PRSA,V?TELL \?L94
	EQUAL? PRSO,PLAYER \FALSE
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK,PER
	RTRUE
?L94:	EQUAL? PRSA,V?TELL-ABOUT \?L98
	EQUAL? PRSO,PLAYER \FALSE
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,PER,PRSI
	RTRUE
?L98:	EQUAL? PRSA,V?WAIT-FOR \?L102
	EQUAL? PRSO,PLAYER \?L102
	SET 'WINNER,PLAYER
	CALL PERFORM,V?$0024CALL,PER
	RTRUE
?L102:	EQUAL? PRSA,V?TALK-ABOUT,V?WHAT \?L103
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,PER,PRSO
	RTRUE
?L103:	EQUAL? PRSA,V?NO,V?YES \FALSE
	PRINTC 34
	EQUAL? PRSA,V?YES \?L105
	PRINTI "Glad"
	JUMP ?L109
?L105:	PRINTI "Sorry"
?L109:	PRINTI " to hear it, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""

	.FUNCT COMMON-ASK-ABOUT,PER,OBJ
	EQUAL? OBJ,DEPTH,CREW,CREW-GLOBAL \?L1
	RETURN 2
?L1:	EQUAL? OBJ,DEPTHFINDER \?L5
	RETURN 2
?L5:	EQUAL? OBJ,GLOBAL-WEAPON,MORE \?L8
	PRINTI """Ask me about something specific, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L8:	EQUAL? OBJ,BAY,GLOBAL-SONAR,SONAR-EQUIPMENT /?L12
	EQUAL? OBJ,GLOBAL-SUB,LOCAL-SUB,CLAW \?L11
?L12:	PRINTI """You know more about it than I do, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L11:	EQUAL? OBJ,PER \?L15
	PRINTR """I have no secrets. Anyone can see what I am."""
?L15:	EQUAL? OBJ,PLAYER \?L18
	PRINTI """You're "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI " "
	CALL PRINT-NAME,LAST-NAME
	PRINTR ", the famous young inventor."""
?L18:	EQUAL? OBJ,AIRLOCK-ELECTRICITY \?L21
	PRINTI """It powers the "
	PRINTD AIRLOCK-HATCH
	PRINTR "."""
?L21:	EQUAL? OBJ,VIDEOPHONE \?L24
	CALL GLOBAL-IN?,VIDEOPHONE,HERE >STACK
	ZERO? STACK /FALSE
	SET 'P-WON,0
	GETP OBJ,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L24:	FSET? OBJ,PERSON /FALSE
	GETP OBJ,P?TEXT >STACK
	EQUAL? STACK,STR?219 \?L31
	SET 'P-WON,0
	GETP OBJ,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L31:	EQUAL? OBJ,DIARY \?L34
	FSET? DIARY,TOUCHBIT \FALSE
	PRINTR """I think that it's pretty obvious."""
?L34:	EQUAL? OBJ,EVIDENCE,BLACK-BOX \?L40
	CALL SHOULD-ASK,BLY,PER >STACK
	RSTACK
?L40:	EQUAL? OBJ,FINE-GRID \?L41
	CALL SHOULD-ASK,TIP,PER >STACK
	RSTACK
?L41:	EQUAL? OBJ,MAGAZINE,ARTICLE \?L42
	PRINTI """It's a "
	PRINTD MAGAZINE
	PRINTR " called 'SCIENCE WORLD.'"""
?L42:	EQUAL? OBJ,CONTROL-CIRCUITS-GAUGE \?L45
	PRINTI "The "
	PRINTD CONTROL-CIRCUITS-GAUGE
	PRINTR " is a thermometer for an important part of the engine."
?L45:	EQUAL? OBJ,OXYGEN-GEAR \?L48
	PRINTI """Your Dad made the rule about it, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". Everyone in the "
	PRINTD AQUADOME
	PRINTI " should carry one at all times, remember?
They're little canisters of oxygen that you can wear around your neck. When you turn the valve, you can suck air through the rubber straw at the top."
	IN? OXYGEN-GEAR,SUB \?L51
	PRINTI "
The canister is in the "
	PRINTD SUB
	PRINTI ", just like in all "
	CALL PRINT-NAME,LAST-NAME
	PRINTI " submarines."
?L51:	PRINTR """"
?L48:	IN? OBJ,PER \?L58
	PRINTI """I have it right here, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L58:	EQUAL? OBJ,BLACK-CIRCUITRY,GLOBAL-SABOTAGE /?L62
	EQUAL? OBJ,AIR-SUPPLY-SYSTEM,AIR-SUPPLY-SYSTEM-GLOBAL \?L61
?L62:	PRINTR """You know as much as I do."""
?L61:	EQUAL? OBJ,PRIVATE-MATTER \?L65
	EQUAL? PER,REMOTE-PERSON \?L66
	PRINTI """Wait until you see me, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L66:	MOVE PRIVATE-MATTER,GLOBAL-OBJECTS
	PRINTD PER
	PRINTI " says, ""I'm sorry, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", but that's a "
	PRINTD PRIVATE-MATTER
	PRINTI "."""
	CRLF
	CALL PRINT-ID,STR?220 >STACK
	RSTACK
?L65:	EQUAL? OBJ,PROBLEM /?L74
	ZERO? DEPTH-WARNING /?L75
	EQUAL? OBJ,DEPTHFINDER-LIGHT,ALARM-SUB /?L74
?L75:	ZERO? SONAR-WARNING \?L76
	ZERO? SHIP-WARNING /?L73
?L76:	EQUAL? OBJ,SONARSCOPE-LIGHT,ALARM-SUB \?L73
?L74:	ZERO? DEPTH-WARNING \?L79
	ZERO? SONAR-WARNING \?L79
	ZERO? SHIP-WARNING /?L77
?L79:	PRINTI """I think you're going too close to "
	ZERO? DEPTH-WARNING /?L82
	PUSH STR?221
	JUMP ?L84
?L82:	PUSH STR?222
?L84:	PRINT STACK
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L77:	ZERO? DOME-AIR-BAD? /?L85
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L85
	CALL BADGES-RED
	RTRUE
?L85:	PRINTD PER
	PRINTI " says, ""I don't know, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L73:	EQUAL? OBJ,BADGE-GLOBAL,BADGE-GLOBAL-2,BADGE-GLOBAL-3 \?L89
	PRINTC 34
	CALL EXAMINE-BADGE
	PRINTR """"
?L89:	EQUAL? OBJ,GLOBAL-SONAR,SONAR-MAN \?L92
	PRINTI """"
	PRINTD SIEGEL
	PRINTI " operates the "
	PRINTD SONAR-EQUIPMENT
	PRINTR "."""
?L92:	EQUAL? OBJ,LAB-ASSISTANT \?L95
	PRINTI """"
	PRINTD LOWELL
	PRINTI " is "
	PRINTD HORVAK
	PRINTI "'s "
	PRINTD LAB-ASSISTANT
	PRINTR "."""
?L95:	EQUAL? OBJ,ALARM \?L98
	ZERO? ALARM-RINGING /FALSE
	CALL WHY-NOT-VP >STACK
	RSTACK
?L98:	EQUAL? OBJ,SYRINGE,ESCAPE-POD-UNIT,GLOBAL-GREENUP \?L102
	ZERO? GREENUP-GUILT /?L103
	PRINTI """I never suspected "
	PRINTD GREENUP
	PRINTI " of being a "
	PRINTD TRAITOR
	PRINTI "."""
	CRLF
	IN? GREENUP,HERE \TRUE
	FSET? GREENUP,MUNGBIT /TRUE
	CALL PERFORM,V?ARREST,GREENUP
	RTRUE
?L103:	EQUAL? OBJ,SYRINGE,ESCAPE-POD-UNIT \FALSE
	PRINTI """Maybe "
	PRINTD HORVAK
	PRINTR " can analyze it."""
?L102:	FSET? ARM,MUNGBIT \?L114
	EQUAL? OBJ,ARM,GASH \?L114
	PRINTI """That looks pretty serious, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L114:	CALL IS-CREW?,PER >STACK
	ZERO? STACK \?L118
	EQUAL? PER,BLY \FALSE
?L118:	EQUAL? OBJ,ELECTROLYTE-RELAY \?L119
	ZERO? SUB-IN-DOME /?L119
	PRINTI """It belongs in the "
	PRINTD EMPTY-SPACE
	PRINTR "."""
?L119:	EQUAL? OBJ,SPECIAL-TOOL-GLOBAL,SPECIAL-TOOL \?L123
	ZERO? SUB-IN-DOME /?L123
	FSET? SPECIAL-TOOL,INVISIBLE /?L126
	FSET? ELECTROLYTE-RELAY,MUNGBIT \?L124
?L126:	PRINTI """The "
	PRINTD SPECIAL-TOOL
	PRINTR " should be on that hook."""
?L124:	PRINTI """I'm sure glad "
	ZERO? HORVAK-FIXED-AIR /?L132
	EQUAL? PRSO,HORVAK \?L134
	PRINTI "I"
	JUMP ?L141
?L134:	PRINTI "Doc"
	JUMP ?L141
?L132:	PRINTI "you"
?L141:	PRINTI " fixed the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "!"""
?L123:	EQUAL? OBJ,GLOBAL-SNARK \FALSE
	ZERO? MONSTER-GONE /FALSE
	SET 'TOLD-SNARK-WENT,1
	CALL TELL-HINT,62,SNARK,0 >STACK
	RSTACK

	.FUNCT SHOULD-ASK,WHO,PER=0
	ZERO? PER /?L1
	PRINTD PER
	PRINTI " says, "
?L1:	PRINTI """I think you should ask "
	PRINTD WHO
	PRINTR " about that."""

	.FUNCT COMMON-OTHER,PER,LPER=0
	IN? PER,GLOBAL-OBJECTS \?L1
	GETP PER,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >LPER
	JUMP ?L3
?L1:	SET 'LPER,PER
?L3:	EQUAL? PRSA,V?ASK /FALSE
	EQUAL? PRSA,V?EXAMINE \?L6
	CALL CARRY-CHECK,LPER >STACK
	ZERO? STACK \TRUE
	GETP LOCAL-SUB,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L6:	EQUAL? PRSI,LPER \?L12
	IN? PRSO,PLAYER \?L12
	EQUAL? PRSO,BADGE-PLAYER /?L12
	EQUAL? PRSA,V?GIVE \?L12
	MOVE PRSO,LPER
	PRINTI """Hey, thanks, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"""
	CRLF
	CALL PRINT-ID,STR?223 >STACK
	RSTACK
?L12:	EQUAL? PRSO,PER \FALSE
	EQUAL? PRSA,V?HELP \?L15
	ZERO? DOME-AIR-BAD? /?L16
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L16
	PRINTI "It would help more to fix the "
	PRINTD AIR-SUPPLY-SYSTEM
	PRINTR "."
?L16:	IN? PER,GLOBAL-OBJECTS /FALSE
	PRINTD PER
	PRINTR " looks offended. ""I'm quite capable by myself, you know."""
?L15:	EQUAL? PRSO,PER \FALSE
	EQUAL? PRSA,V?RUB \?L24
	PRINTD PER
	PRINTI " looks bewildered. ""What are you trying to do?"""
	CRLF
	CALL PRINT-ID,STR?224 >STACK
	RSTACK
?L24:	EQUAL? PRSO,PER \FALSE
	EQUAL? PRSA,V?SHOW \FALSE
	CALL PERFORM,V?ASK-ABOUT,PRSO,PRSI
	RTRUE

	.FUNCT DESCRIBE-COLLAPSE,PER
	FSET? BLY,MUNGBIT \?L1
	EQUAL? PER,TIP \?L3
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L5
	CALL DESCRIBE-PERSON,PER,STR?225 >STACK
	RSTACK
?L5:	CALL DESCRIBE-PERSON,PER >STACK
	RSTACK
?L3:	EQUAL? PER,BLY,LOWELL,GREENUP \?L8
	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L9
	CALL DESCRIBE-PERSON,PER,STR?226 >STACK
	RSTACK
?L9:	CALL DESCRIBE-PERSON,PER,STR?227 >STACK
	RSTACK
?L8:	FSET? AIR-SUPPLY-SYSTEM,MUNGBIT \?L13
	ZERO? BADGES-RED-SAID? /?L15
	CALL DESCRIBE-PERSON,PER,STR?228 >STACK
	RSTACK
?L15:	CALL DESCRIBE-PERSON,PER,STR?225 >STACK
	RSTACK
?L13:	CALL DESCRIBE-PERSON,PER >STACK
	RSTACK
?L1:	CALL DESCRIBE-PERSON,PER >STACK
	RSTACK

	.FUNCT DESCRIBE-PERSON,PER,STR=0
	CALL IS-CREW?,PER >STACK
	ZERO? STACK /?L1
	CALL CREW-5-TOGETHER? >STACK
	ZERO? STACK /?L1
	FSET? BLY,MUNGBIT /?L1
	EQUAL? PER,LOWELL \FALSE
	PRINTI "The five "
	PRINTD CREW
	PRINTR " members are here."
?L1:	PRINTD PER
	PRINTI " is "
	ZERO? STR \?L11
	PUSH STR?65
	JUMP ?L13
?L11:	PUSH STR
?L13:	PRINT STACK
	PRINTR "."

	.FUNCT DISCRETION,P1,P2,P3=0,?TMP
	SET '?TMP,HERE
	CALL META-LOC,P2 >STACK
	EQUAL? ?TMP,STACK \?L1
	ZERO? P3 /?L1
	SET '?TMP,HERE
	CALL META-LOC,P3 >STACK
	EQUAL? ?TMP,STACK \?L1
	PRINTD P1
	PRINTI " looks briefly toward "
	PRINTD P2
	PRINTI " and "
	PRINTD P3
	PRINTR " and then speaks in a whisper."
?L1:	SET '?TMP,HERE
	CALL META-LOC,P2 >STACK
	EQUAL? ?TMP,STACK \?L5
	PRINTD P1
	PRINTI " looks briefly toward "
	PRINTD P2
	PRINTR " and then speaks in a whisper."
?L5:	ZERO? P3 /FALSE
	SET '?TMP,HERE
	CALL META-LOC,P3 >STACK
	EQUAL? ?TMP,STACK \FALSE
	PRINTD P1
	PRINTI " looks briefly toward "
	PRINTD P3
	PRINTR " and then speaks in a whisper."

	.FUNCT DONT-KNOW,CHAR,OBJ
	PRINTD CHAR
	PRINTI " says, ""I don't think that's important right now, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""

	.FUNCT GLOBAL-PERSON,L
	EQUAL? PRSA,V?WHAT,V?WALK-TO,V?WAIT-FOR /FALSE
	EQUAL? PRSA,V?PHONE,V?LOOK-UP,V?FOLLOW /FALSE
	EQUAL? PRSA,V?FIND,V?ARREST /FALSE
	EQUAL? PRSA,V?EXAMINE \?L4
	FSET? PRSO,PERSON \?L4
	GETP PRSO,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >L
	ZERO? L /?L4
	CALL CORRIDOR-LOOK,L >STACK
	ZERO? STACK \FALSE
	CALL NOT-HERE,PRSO >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?TELL-ABOUT,V?TELL,V?REPLY /?L9
	EQUAL? PRSA,V?HELLO,V?ASK-FOR,V?ASK-ABOUT \?L8
?L9:	ZERO? PRSO /?L8
	FSET? PRSO,PERSON \?L8
	IN? PRSO,GLOBAL-OBJECTS /?L8
	EQUAL? PRSA,V?REPLY \FALSE
	SET 'PRSA,V?TELL
	RFALSE
?L8:	EQUAL? PRSA,V?TELL-ABOUT,V?ASK-ABOUT \?L13
	ZERO? PRSI /?L13
	FSET? PRSI,PERSON \?L13
	IN? PRSI,GLOBAL-OBJECTS \?L13
	GETP PRSI,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >STACK
	CALL PERFORM,PRSA,PRSO,STACK
	RTRUE
?L13:	SET 'P-CONT,0
	EQUAL? PRSA,V?TELL-ABOUT,V?ASK-ABOUT /?L17
	ZERO? NOW-PRSI \?L15
?L17:	PRINTD PRSO
	JUMP ?L23
?L15:	ZERO? PRSI /?L20
	PRINTD PRSI
	JUMP ?L23
?L20:	PRINTD WINNER
?L23:	CALL NOT-HERE-PERSON,PRSO
	RTRUE

	.FUNCT NOT-HERE-PERSON,PER,L
	FSET? PER,PERSON \?L1
	GETP PER,P?CHARACTER >STACK
	GET CHARACTER-TABLE,STACK >STACK
	LOC STACK >L
	JUMP ?L3
?L1:	LOC PER >L
?L3:	ZERO? L /?L4
	GETP L,P?CORRIDOR >STACK
	GETP HERE,P?CORRIDOR >STACK
	BAND STACK,STACK >STACK
	ZERO? STACK /?L4
	PRINTI " isn't close enough"
	CALL SPEAKING-VERB? >STACK
	ZERO? STACK /?L8
	PRINTI " to hear you"
?L8:	PRINTR "."
?L4:	PRINTR " isn't here!"

	.FUNCT INHABITED?,RM
	CALL POPULATION,RM >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT POPULATION,RM,NOT1=0,NOT2=0,CNT=0,OBJ
	FIRST? RM >OBJ /?L1
	RETURN CNT
?L1:	FSET? OBJ,PERSON \?L6
	FSET? OBJ,INVISIBLE /?L6
	ZERO? NOT1 /?L8
	EQUAL? OBJ,NOT1 /?L6
?L8:	ZERO? NOT2 /?L9
	EQUAL? OBJ,NOT2 /?L6
?L9:	INC 'CNT
	JUMP ?L10
?L6:	FSET? OBJ,CONTBIT \?L10
	CALL POPULATION,OBJ,NOT1,NOT2 >STACK
	ADD CNT,STACK >CNT
?L10:	NEXT? OBJ >OBJ /?L1
	RETURN CNT

	.FUNCT DIR-PRINT,DIR,THE??1=1,CNT=0
?L1:	GET DIR-STRINGS,CNT >STACK
	EQUAL? STACK,DIR \?L3
	ZERO? THE??1 /?L5
	PRINTI "the "
?L5:	ADD CNT,1 >STACK
	GET DIR-STRINGS,STACK >STACK
	PRINT STACK
	RTRUE
?L3:	INC 'CNT
	JUMP ?L1

	.FUNCT NULL-F,A1,A2
	RFALSE

	.FUNCT DOOR-ROOM,RM,DR,P=0,TBL
?L1:	NEXTP RM,P >P
	ZERO? P /FALSE
	LESS? P,P?OUT /FALSE
	GETPT RM,P >TBL
	PTSIZE TBL >STACK
	EQUAL? DEXIT,STACK \?L1
	GETB TBL,DEXITOBJ >STACK
	EQUAL? DR,STACK \?L1
	GETB TBL,REXIT >STACK
	RSTACK

	.FUNCT FIND-FLAG,RM,FLAG,EXCLUDED=0,O
	FIRST? RM >O \FALSE
?L4:	FSET? O,FLAG \?L6
	EQUAL? O,EXCLUDED /?L6
	RETURN O
?L6:	NEXT? O >O /?L4
	RFALSE

	.FUNCT META-LOC,OBJ,L
	LOC OBJ >L
?L1:	ZERO? L /FALSE
	EQUAL? L,LOCAL-GLOBALS,GLOBAL-OBJECTS \?L5
	RETURN L
?L5:	IN? OBJ,ROOMS \?L6
	RETURN OBJ
?L6:	SET 'OBJ,L
	LOC OBJ >L
	JUMP ?L1

	.FUNCT IN-LAB-AREA?,RM
	ZERO? SUB-IN-TANK /?L1
	EQUAL? RM,SUB,CRAWL-SPACE /TRUE
?L1:	EQUAL? RM,HALLWAY,LAB-STORAGE,OFFICE /TRUE
	CALL IN-LAB?,RM >STACK
	ZERO? STACK \TRUE
	CALL IN-TANK-AREA?,RM >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT IN-LAB?,RM
	EQUAL? RM,NORTH-WALL,EAST-WALL,SOUTH-WALL /TRUE
	EQUAL? RM,WEST-WALL,CENTER-OF-LAB /TRUE
	RFALSE

	.FUNCT IN-TANK-AREA?,RM
	EQUAL? RM,SOUTH-TANK-AREA,WEST-TANK-AREA,NORTH-TANK-AREA \FALSE
	RTRUE

	.FUNCT SHARON-PASSES-YOU?,L,?TMP
	EQUAL? HERE,OFFICE /TRUE
	EQUAL? HERE,HALLWAY /?L4
	EQUAL? HERE,LAB-STORAGE \?L7
	FSET? STORAGE-DOOR,OPENBIT \?L3
?L4:	EQUAL? L,OFFICE /FALSE
	RTRUE
?L3:	EQUAL? HERE,LAB-STORAGE \?L7
	EQUAL? L,LAB-STORAGE /TRUE
	RFALSE
?L7:	CALL IN-LAB?,HERE >STACK
	ZERO? STACK /?L10
	EQUAL? L,OFFICE,HALLWAY,LAB-STORAGE /FALSE
	RTRUE
?L10:	CALL IN-TANK-AREA?,HERE >STACK
	ZERO? STACK /?L13
	CALL IN-TANK-AREA?,L >?TMP
	ZERO? ?TMP /?L15
	RETURN ?TMP
?L15:	EQUAL? L,SUB,CRAWL-SPACE /TRUE
	RFALSE
?L13:	EQUAL? HERE,SUB \?L18
	EQUAL? L,SUB,CRAWL-SPACE /TRUE
	RFALSE
?L18:	EQUAL? L,CRAWL-SPACE \FALSE
	RTRUE

	.FUNCT RESEARCH-LAB
	PRINTI " the "
	CALL PRINT-NAME,LAST-NAME
	PRINTI " Research Lab"
	RTRUE

	.FUNCT NORTH-WALL-F,RARG=0
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You're in the "
	PRINTD NORTH-WALL
	PRINTI " of "
	PRINTD YOUR-LABORATORY
	PRINTI ". A "
	PRINTD COMPUTESTOR
	PRINTR " stands here to help test your inventions."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL VIDEOPHONE-WORKING >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT COMPUTESTOR-F
	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-ON,V?LOOK-INSIDE /FALSE
	EQUAL? PRSA,V?LOOK-BEHIND,V?WALK-TO,V?TAKE /FALSE
	EQUAL? PRSA,V?EXAMINE \?L4
	PRINTI "The "
	PRINTD COMPUTESTOR
	PRINTI " is o"
	FSET? COMPUTESTOR,ONBIT \?L7
	PUSH STR?37
	JUMP ?L9
?L7:	PUSH STR?38
?L9:	PRINT STACK
	PRINTR "."
?L4:	EQUAL? PRSA,V?LAMP-ON \?L10
	FSET? COMPUTESTOR,ONBIT /FALSE
	FSET COMPUTESTOR,ONBIT
	PRINTI "The "
	PRINTD COMPUTESTOR
	PRINTR " is ready for questions."
?L10:	CALL REMOTE-VERB? >STACK
	ZERO? STACK /?L16
	EQUAL? PRSA,V?ASK-ABOUT \FALSE
	EQUAL? PRSO,COMPUTESTOR \FALSE
?L16:	FSET? COMPUTESTOR,ONBIT /?L18
	PRINTI "The "
	PRINTD COMPUTESTOR
	PRINTR " is off!"
?L18:	EQUAL? PRSA,V?USE,V?ASK \?L21
	FSET? VIDEOPHONE,MUNGBIT \?L22
	CALL PERFORM,V?ASK-ABOUT,COMPUTESTOR,VIDEOPHONE
	RTRUE
?L22:	IN? CATALYST-CAPSULE,REACTOR /FALSE
	CALL PERFORM,V?ASK-ABOUT,COMPUTESTOR,GLOBAL-SUB
	RTRUE
?L21:	EQUAL? PRSA,V?ASK-ABOUT \FALSE
	EQUAL? PRSO,COMPUTESTOR \FALSE
	EQUAL? PRSI,CIRCUIT-BREAKER \?L27
	FSET? CIRCUIT-BREAKER,OPENBIT \?L27
	PRINTI """A "
	PRINTD CIRCUIT-BREAKER
	PRINTR " is open."""
?L27:	EQUAL? PRSI,VIDEOPHONE \?L31
	FSET? VIDEOPHONE,MUNGBIT \?L31
	SET 'TIP-SAYS-1,32
	SET 'TIP-SAYS-2,VIDEOPHONE
	CALL QUEUE,I-TIP-SAYS,3 >STACK
	PUT STACK,0,1
	PRINTI """Symptoms: no picture, no sound.
Possible causes:
1) Failure of the "
	PRINTD VIDEOPHONE-TRANSMITTER
	PRINTI " at source.
2) A short in the "
	PRINTD VIDEOPHONE-CABLE
	PRINTI " linking "
	PRINTD VIDEOPHONE-TRANSMITTER
	PRINTI " to"
	CALL RESEARCH-LAB
	PRINTI ", if signal is coming from "
	PRINTD AQUADOME
	PRINTI ".
3) Sunspot interference or "
	PRINTD VIDEOPHONE-SATELLITE
	PRINTI " malfunction if "
	PRINTD VIDEOPHONE-TRANSMITTER
	PRINTI " is at earth's surface.
4) Failure of the video receiver.
5) Overload in the "
	PRINTD ELECTRICAL-CONTROL-PANEL
	PRINTI " ("
	PRINTD CIRCUIT-BREAKER
	PRINTI " popped).
6) Sabotage ("
	PRINTD CIRCUIT-BREAKER
	PRINTR " open)."""
?L31:	EQUAL? PRSI,VIDEOPHONE-TRANSMITTER \?L36
	FSET? VIDEOPHONE,MUNGBIT \?L36
	PRINTI "Impossible. It's located "
	PRINTD UNDERWATER
	PRINTI " at the "
	PRINTD AQUADOME
	PRINTI ", beyond your control. Right now you have no communication with the "
	PRINTD AQUADOME
	PRINTR "."
?L36:	EQUAL? PRSI,VIDEOPHONE-CABLE \?L39
	PRINTR "This can be done only by submarine."
?L39:	EQUAL? PRSI,VIDEOPHONE-SATELLITE \?L42
	PRINTI "You're goofing off, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". Video signals from the "
	PRINTD AQUADOME
	PRINTI " to"
	CALL RESEARCH-LAB
	PRINTI " are NOT relayed by a space "
	PRINTD VIDEOPHONE-SATELLITE
	PRINTR "."
?L42:	EQUAL? PRSI,VIDEOPHONE-RECEIVER \?L47
	PRINTI "You can do this by pushing the "
	PRINTD TEST-BUTTON
	PRINTI " on the "
	PRINTD VIDEOPHONE
	PRINTR "."
?L47:	EQUAL? PRSI,REACTOR,GLOBAL-SUB \?L50
	IN? CATALYST-CAPSULE,REACTOR /?L50
	PRINTI """Symptom: "
	PRINTD ENGINE
	PRINTI " won't start.
Possible causes:
1) The "
	PRINTD CATALYST-CAPSULE
	PRINTI " is not inserted in the "
	PRINTD REACTOR
	PRINTI ".
2) The "
	PRINTD REACTOR
	PRINTI " is not turned on.
3) The "
	PRINTD TEST-TANK
	PRINTR " is not filled."""
?L50:	PRINTI """This device is designed only to troubleshoot operating problems.""
(Maybe you can find information about"
	CALL THE-PRSI-PRINT
	PRINTR " in your SEASTALKER package.)"

	.FUNCT VIDEOPHONE-TEST-F
	EQUAL? PRSA,V?ANALYZE \FALSE
	CALL PERFORM,V?ASK-ABOUT,COMPUTESTOR,PRSO
	RTRUE

	.FUNCT EAST-WALL-F,RARG=0
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You're in the "
	PRINTD EAST-WALL
	PRINTI " of "
	PRINTD YOUR-LABORATORY
	PRINTI ". A doorway leads out through a "
	PRINTD HALLWAY
	PRINTI " to the office of your "
	PRINTD LAB-ASSISTANT
	PRINTI ", "
	PRINTD GLOBAL-SHARON
	PRINTI ". A "
	PRINTD MICROWAVE-SECURITY-SCANNER
	PRINTI " stands against the wall. An "
	PRINTD INTERCOM
	PRINTI " sits on the "
	PRINTD DESK
	PRINTR "."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL VIDEOPHONE-WORKING >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT VIDEOPHONE-WORKING
	ZERO? BREAKER-JUST-FIXED /FALSE
	FSET? CIRCUIT-BREAKER,OPENBIT /FALSE
	SET 'BREAKER-JUST-FIXED,0
	PRINTI "As you re-enter the lab, "
	CALL TIP-SAYS
	PRINTI "Look, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! The "
	PRINTD VIDEOPHONE
	PRINTR "'s working again! There's a normal test pattern on the screen!"""

	.FUNCT MICROWAVE-SECURITY-SCANNER-F
	EQUAL? PRSA,V?LAMP-ON \FALSE
	PRINTR "No beep occurs. Scanner displays: ""NO INTRUDER PRESENT ON GROUNDS."""

	.FUNCT DESK-F
	CALL COMMON-DESK-F,DESK >STACK
	RSTACK

	.FUNCT COMMON-DESK-F,OBJ
	EQUAL? PRSA,V?OPEN \?L1
	PRINTR "It has no drawers."
?L1:	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE \FALSE
	EQUAL? PRSO,OBJ \FALSE
	PRINTI "An "
	PRINTD INTERCOM
	PRINTI " is on the desk"
	FIRST? OBJ >STACK \?L8
	PRINTI ", as well as "
	CALL PRINT-CONTENTS,OBJ
?L8:	PRINTR "."

	.FUNCT GENERIC-DESK-F,OBJ
	CALL IN-LAB?,HERE >STACK
	ZERO? STACK /?L1
	RETURN DESK
?L1:	EQUAL? HERE,OFFICE \?L3
	RETURN KEMP-DESK
?L3:	ZERO? SUB-IN-DOME /FALSE
	RETURN BLY-DESK

	.FUNCT HALLWAY-F,RARG=0
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You're in a "
	PRINTD HALLWAY
	PRINTI ", with "
	PRINTD YOUR-LABORATORY
	PRINTI " to the west, a "
	PRINTD LAB-STORAGE
	PRINTI " to the south, and "
	PRINTD OFFICE
	PRINTI " to the east. An "
	PRINTD ELECTRICAL-CONTROL-PANEL
	PRINTR " fills most of the north wall."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	FSET? CIRCUIT-BREAKER,MUNGBIT \FALSE
	CALL TELL-HINT,31,ELECTRICAL-CONTROL-PANEL,0 >STACK
	RSTACK

	.FUNCT ELECTRICAL-CONTROL-PANEL-F
	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \?L1
	FSET? CIRCUIT-BREAKER,OPENBIT \?L1
	CALL THIS-IS-IT,CIRCUIT-BREAKER
	PRINTI "A "
	PRINTD CIRCUIT-BREAKER
	PRINTI " on the "
	PRINTD ELECTRICAL-CONTROL-PANEL
	PRINTI " is open. This "
	PRINTD CIRCUIT-BREAKER
	PRINTI " controls the "
	PRINTD POWER-SUPPLY
	PRINTI " to the "
	PRINTD VIDEOPHONE
	PRINTI " and other equipment in the private "
	PRINTD VIDEOPHONE
	PRINTI " network."
	CRLF
	IN? TIP,HERE \TRUE
	CALL TIP-SAYS
	PRINTR "How did that happen? You didn't overload the circuit."""
?L1:	EQUAL? PRSA,V?OPEN \FALSE
	PRINTI "You don't need to open the "
	PRINTD ELECTRICAL-CONTROL-PANEL
	PRINTR "."

	.FUNCT CIRCUIT-BREAKER-F,V
	EQUAL? PRSA,V?EXAMINE,V?ANALYZE \?L1
	FSET? PRSO,OPENBIT \?L1
	CALL TELL-HINT,31,ELECTRICAL-CONTROL-PANEL,0 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LAMP-ON,V?TURN,V?MOVE /?L4
	EQUAL? PRSA,V?FIX,V?PUSH,V?CLOSE \?L3
?L4:	FSET? PRSO,OPENBIT \?L5
	FSET PRSO,NDESCBIT
	CALL OKAY,CIRCUIT-BREAKER,STR?27
	FSET? PRSO,MUNGBIT \TRUE
	SET 'BREAKER-JUST-FIXED,1
	FCLEAR PRSO,MUNGBIT
	FCLEAR VIDEOPHONE,MUNGBIT
	FSET VIDEOPHONE,ONBIT
	CALL SCORE-OBJ,CIRCUIT-BREAKER
	RTRUE
?L5:	CALL ALREADY,CIRCUIT-BREAKER,STR?27 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?LAMP-OFF,V?OPEN \FALSE
	FSET? PRSO,OPENBIT \?L12
	CALL ALREADY,CIRCUIT-BREAKER,STR?22 >STACK
	RSTACK
?L12:	PRINTR "You shouldn't do that."

	.FUNCT GENERIC-STORAGE-ROOM-F,OBJ
	ZERO? SUB-IN-DOME /?L1
	RETURN DOME-STORAGE
?L1:	ZERO? SUB-IN-TANK /FALSE
	RETURN LAB-STORAGE

	.FUNCT GENERIC-OFFICE-F,OBJ
	ZERO? SUB-IN-DOME /?L1
	RETURN BLY-OFFICE
?L1:	ZERO? SUB-IN-TANK /FALSE
	RETURN OFFICE

	.FUNCT OFFICE-F,ARG=0
	EQUAL? ARG,M-LOOK \?L1
	PRINTI "You're in the office of your "
	PRINTD LAB-ASSISTANT
	PRINTI ", "
	PRINTD GLOBAL-SHARON
	PRINTI ". There is a desk and chair here, and the "
	PRINTD OFFICE-DOOR
	PRINTI " leading out to the parking lot. To the west, a "
	PRINTD HALLWAY
	PRINTI " leads back to "
	PRINTD YOUR-LABORATORY
	PRINTR "."
?L1:	IN? SHARON,OFFICE \?L5
	EQUAL? ARG,M-BEG \?L5
	CALL EXIT-VERB? >STACK
	ZERO? STACK /?L5
	FSET SHARON,NDESCBIT
	FSET FILE-DRAWER,NDESCBIT
	FSET PAPERS,NDESCBIT
	RFALSE
?L5:	EQUAL? ARG,M-ENTER \FALSE
	FCLEAR SHARON,NDESCBIT
	FCLEAR FILE-DRAWER,NDESCBIT
	FCLEAR PAPERS,NDESCBIT
	IN? SHARON,OFFICE \FALSE
	CALL THIS-IS-IT,SHARON
	CALL THIS-IS-IT,FILE-DRAWER
	PRINTI "As you enter, Sharon is hastily going through the contents of an open "
	PRINTD FILE-DRAWER
	PRINTR ". She turns with a startled expression as you appear in the doorway. Her face is flushed and her manner seems slightly emotional."

	.FUNCT OFFICE-DOOR-F
	EQUAL? PRSA,V?OPEN \FALSE
	PRINTR "There's nothing outside to help your mission!"

	.FUNCT PAPERS-F,X
	EQUAL? PRSA,V?LOOK-UP \?L1
	EQUAL? PRSI,PAPERS,FILE-DRAWER \?L1
	FSET? PRSO,PERSON \?L3
	GETP LOCAL-SUB,P?TEXT >STACK
	PRINT STACK
	CRLF
	CRLF
	RTRUE
?L3:	PRINTR "There's no information in the drawer about that."
?L1:	EQUAL? PRSA,V?CLOSE \?L10
	IN? SHARON,OFFICE \?L10
	PRINTI "Sharon stops you from closing it. ""Hey, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! I can't do my job here if you interfere!"""
	CRLF
	CALL PRINT-ID,STR?229 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?SEARCH-FOR,V?SEARCH,V?TAKE /?L14
	EQUAL? PRSA,V?READ,V?LOOK-INSIDE,V?EXAMINE \FALSE
?L14:	FSET? FILE-DRAWER,OPENBIT /?L15
	CALL TOO-BAD-BUT,FILE-DRAWER,STR?27
	RTRUE
?L15:	FSET PAPERS,TOUCHBIT
	PRINTI "You look "
	EQUAL? P-ADVERB,W?CAREFULLY \?L20
	PRINTI "more thoroughly through the drawer and still"
	JUMP ?L24
?L20:	PRINTI "quickly through the drawer but"
?L24:	PRINTR " find nothing suspicious, so you decide to leave the papers alone."

	.FUNCT KEMP-DESK-F
	CALL COMMON-DESK-F,KEMP-DESK >STACK
	RSTACK

	.FUNCT SOUTH-WALL-F,RARG=0
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You're in the "
	PRINTD SOUTH-WALL
	PRINTI " of "
	PRINTD YOUR-LABORATORY
	PRINTI ", next to shelves full of chemical and electronic supplies. A door leads south to the "
	PRINTD TEST-TANK
	PRINTR "."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL VIDEOPHONE-WORKING >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT CHEMICAL-SUPPLY-SHELVES-F
	EQUAL? PRSA,V?PUT /?L3
	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE \FALSE
?L3:	FCLEAR CHEMICALS,NDESCBIT
	RFALSE

	.FUNCT ELECTRONIC-SUPPLY-SHELVES-F
	EQUAL? PRSA,V?PUT /?L3
	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE \FALSE
?L3:	FCLEAR ELECTRONICS,NDESCBIT
	RFALSE

	.FUNCT WEST-WALL-F,RARG=0
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You're in the "
	PRINTD WEST-WALL
	PRINTI " of "
	PRINTD YOUR-LABORATORY
	PRINTR ", next to a shelf full of mechanical supplies."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL VIDEOPHONE-WORKING >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT MECHANICAL-SUPPLY-SHELVES-F
	EQUAL? PRSA,V?PUT /?L3
	EQUAL? PRSA,V?LOOK-ON,V?LOOK-INSIDE,V?EXAMINE \FALSE
?L3:	FCLEAR MECHANICALS,NDESCBIT
	RFALSE

	.FUNCT GENERIC-CENTER-F,OBJ
	ZERO? SUB-IN-TANK /?L1
	RETURN CENTER-OF-LAB
?L1:	ZERO? SUB-IN-DOME /FALSE
	RETURN CENTER-OF-DOME

	.FUNCT CENTER-OF-LAB-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	LOC MICROPHONE >STACK
	EQUAL? STACK,WINNER \?L1
	CALL EXIT-VERB? >STACK
	ZERO? STACK /?L1
	CALL THIS-IS-IT,MICROPHONE
	CALL HE-SHE-IT,WINNER,1
	PRINTI " can't walk away while "
	CALL HE-SHE-IT,WINNER,0,STR?25
	PRINTI " holding the "
	PRINTD MICROPHONE
	PRINTR "!"
?L1:	EQUAL? RARG,M-LOOK \?L7
	PRINTI "You're at your workbench in the center of "
	PRINTD YOUR-LABORATORY
	PRINTI ", a small part of"
	CALL RESEARCH-LAB
	PRINTI " in the town of Frobton. The "
	PRINTD VIDEOPHONE
	PRINTI " screen looms overhead"
	ZERO? ALARM-RINGING /?L12
	PRINTI ", with its "
	PRINTD ALARM
	PRINTI " ringing"
?L12:	PRINTR "."
?L7:	EQUAL? RARG,M-ENTER \FALSE
	CALL VIDEOPHONE-WORKING >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT WORKBENCH-F
	EQUAL? PRSA,V?PUT,V?LOOK-ON,V?LOOK-INSIDE /?L3
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
?L3:	FCLEAR SUB-PLANS,NDESCBIT
	RFALSE

	.FUNCT SCREENPLAY
	PRINTR "Screenplay by Jim Lawrence"

	.FUNCT SUB-PLANS-F,X
	EQUAL? PRSA,V?READ,V?EXAMINE,V?ANALYZE \FALSE
	PRINTI "Written in one corner is the legend:

"
	RANDOM 2 >X
	EQUAL? X,1 \?L5
	CALL SCREENPLAY
?L5:	PRINTI "  Directed by Stu Galley
"
	EQUAL? X,1 /?L10
	CALL SCREENPLAY
?L10:	CRLF
	CALL V-VERSION >STACK
	RSTACK

	.FUNCT GENERIC-MICROPHONE-F,OBJ
	ZERO? SUB-IN-TANK /?L1
	RETURN MICROPHONE
?L1:	ZERO? SUB-IN-DOME /FALSE
	RETURN MICROPHONE-DOME

	.FUNCT MICROPHONE-F,DOME?=0
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The "
	PRINTD MICROPHONE
	PRINTI " is connected to the "
	PRINTD VIDEOPHONE
	PRINTI " by a coiled cord. At the moment, it is turned o"
	ZERO? DOME? /?L43
	FSET? MICROPHONE-DOME,ONBIT /?L7
	ZERO? DOME? \?L5
?L43:	FSET? MICROPHONE,ONBIT \?L5
?L7:	PRINTR "n."
?L5:	PRINTR "ff."
?L1:	EQUAL? PRSA,V?LAMP-OFF /?L15
	CALL DIVESTMENT?,MICROPHONE >STACK
	ZERO? STACK \?L15
	CALL DIVESTMENT?,MICROPHONE-DOME >STACK
	ZERO? STACK /?L14
?L15:	EQUAL? PRSO,MICROPHONE-DOME,MICROPHONE \?L14
	EQUAL? VIDEOPHONE,REMOTE-PERSON-ON \?L14
	PRINTI "You'd better say ""Good-bye"" to "
	PRINTD REMOTE-PERSON
	PRINTR " first."
?L14:	EQUAL? PRSA,V?SAY-INTO,V?REPLY \?L18
	FSET? VIDEOPHONE,ONBIT /?L18
	PRINTI "That won't do any good while the "
	PRINTD VIDEOPHONE
	PRINTR " is off."
?L18:	EQUAL? PRSA,V?SAY-INTO \?L21
	EQUAL? REMOTE-PERSON-ON,VIDEOPHONE \?L22
	PRINTD REMOTE-PERSON
	PRINTR " nods at you."
?L22:	ZERO? WOMAN-ON-SCREEN /?L26
	PRINTR "That won't do any good while the sound is fuzzy."
?L26:	PRINTR "It's not clear whom you're talking to."
?L21:	EQUAL? PRSA,V?LAMP-ON \FALSE
	IN? MICROPHONE,PLAYER /?L33
	IN? MICROPHONE-DOME,PLAYER \FALSE
?L33:	ZERO? DOME? /?L44
	FSET? MICROPHONE-DOME,ONBIT /?L36
	ZERO? DOME? \?L45
?L44:	FSET? MICROPHONE,ONBIT \?L34
?L36:	CALL ALREADY,MICROPHONE,STR?18
	RTRUE
?L34:	ZERO? DOME? /?L39
?L45:	CALL OKAY,MICROPHONE-DOME,STR?18 >STACK
	RSTACK
?L39:	CALL OKAY,MICROPHONE,STR?18 >STACK
	RSTACK

	.FUNCT TECHNICIAN-F
	EQUAL? PRSA,V?$0024CALL /?L3
	EQUAL? PRSA,V?TAKE,V?PHONE,V?FIND \FALSE
?L3:	PRINTI "How can you do that? By telepathy or carrier pigeon? "
	IN? SHARON,OFFICE \?L6
	PRINTI "Seriously, your "
	PRINTD LAB-ASSISTANT
	PRINTI ", "
	PRINTD SHARON
	PRINTI ", is in her office, which is through a doorway to the east. Or, you could summon her by the "
	PRINTD INTERCOM
	PRINTI " on your desk."
?L6:	CRLF
	RTRUE

	.FUNCT GANGPLANK-F
	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-DOWN,V?BOARD \FALSE
	CALL DO-WALK,P?SOUTH
	RTRUE

	.FUNCT GENERIC-TANK-CONTROL-GEAR-F,OBJ
	RETURN TANK-CONTROL-GEAR-1

	.FUNCT GENERIC-TANK-AREA-F,OBJ
	RETURN NORTH-TANK-AREA

	.FUNCT TANK-AREA-F,RARG=0
	EQUAL? RARG,M-LOOK \FALSE
	USL
	FSET NORTH-TANK-AREA,TOUCHBIT
	FSET WEST-TANK-AREA,TOUCHBIT
	FSET SOUTH-TANK-AREA,TOUCHBIT
	EQUAL? HERE,NORTH-TANK-AREA \?L3
	PRINTI "You're at a temporary runway or gangplank that leads from the walkway to the "
	PRINTD SUB-DOOR
	PRINTI " of the "
	PRINTD GLOBAL-SUB
	PRINTI ". "
	CALL CHECK-DOOR,SUB-DOOR
	JUMP ?L7
?L3:	EQUAL? HERE,WEST-TANK-AREA \?L7
	PRINTI "You're at a "
	PRINTD WORK-COUNTER
	PRINTI ", next to the "
	PRINTD TANK-CONTROL-GEAR-1
	PRINTI " used to operate the "
	PRINTD TEST-TANK
	PRINTI ".
"
?L7:	PRINTI "The test tank (which is now "
	ZERO? TEST-TANK-FULL /?L13
	PRINTI "filled with "
	JUMP ?L17
?L13:	PRINTI "empty of "
?L17:	PRINTD GLOBAL-WATER
	PRINTI ") is located in a large work room, just south of "
	PRINTD YOUR-LABORATORY
	PRINTI ", with concrete-block walls on three sides and a high metal roof. Most of its floor is dug out and lined with steel, to form the huge tank used for developing and testing "
	PRINTD UNDERWATER
	PRINTR " gear and the pilot models of your submarine craft.
There's a walkway around the tank on three sides -- north, west and south. On the east side, a steel gate forms the wall of the room."

	.FUNCT FRESH-AIR?,RM,P,L,TBL,O
	ZERO? DOME-AIR-BAD? /?L1
	ZERO? SUB-IN-DOME /?L1
	PRINTR "It's impossible to tell that way whether the air is good."
?L1:	SET 'P,0
?L6:	NEXTP HERE,P >P
	ZERO? P /FALSE
	LESS? P,P?OUT /?L6
	GETPT HERE,P >TBL
	PTSIZE TBL >L
	EQUAL? L,DEXIT \?L6
	GETB TBL,DEXITOBJ >O
	FSET? O,OPENBIT \?L6
	PRINTI "There's a pleasant breeze coming through the "
	PRINTD O
	PRINTR "."

	.FUNCT CORRIDOR-LOOK,ITM=0,C,Z,COR,VAL,FOUND=0
	GETP HERE,P?CORRIDOR >C
	ZERO? C /FALSE
?L3:	SUB C,8192 >Z
	LESS? Z,0 /?L5
	SET 'COR,COR-20000
	JUMP ?L20
?L5:	SUB C,4096 >Z
	LESS? Z,0 /?L7
	SET 'COR,COR-10000
	JUMP ?L20
?L7:	SUB C,2048 >Z
	LESS? Z,0 /?L8
	SET 'COR,COR-4000
	JUMP ?L20
?L8:	SUB C,1024 >Z
	LESS? Z,0 /?L9
	SET 'COR,COR-2000
	JUMP ?L20
?L9:	SUB C,512 >Z
	LESS? Z,0 /?L10
	SET 'COR,COR-1000
	JUMP ?L20
?L10:	SUB C,256 >Z
	LESS? Z,0 /?L11
	SET 'COR,COR-400
	JUMP ?L20
?L11:	SUB C,128 >Z
	LESS? Z,0 /?L12
	SET 'COR,COR-200
	JUMP ?L20
?L12:	SUB C,64 >Z
	LESS? Z,0 /?L13
	SET 'COR,COR-64
	JUMP ?L20
?L13:	SUB C,32 >Z
	LESS? Z,0 /?L14
	SET 'COR,COR-32
	JUMP ?L20
?L14:	SUB C,16 >Z
	LESS? Z,0 /?L15
	SET 'COR,COR-16
	JUMP ?L20
?L15:	SUB C,8 >Z
	LESS? Z,0 /?L16
	SET 'COR,COR-8
	JUMP ?L20
?L16:	SUB C,4 >Z
	LESS? Z,0 /?L17
	SET 'COR,COR-4
	JUMP ?L20
?L17:	SUB C,2 >Z
	LESS? Z,0 /?L18
	SET 'COR,COR-2
	JUMP ?L20
?L18:	SUB C,1 >Z
	LESS? Z,0 /?L4
	SET 'COR,COR-1
?L20:	CALL CORRIDOR-CHECK,COR,ITM >VAL
	ZERO? FOUND \?L21
	SET 'FOUND,VAL
?L21:	SET 'C,Z
	JUMP ?L3
?L4:	RETURN FOUND

	.FUNCT CORRIDOR-CHECK,COR,ITM,CNT=2,PAST=0,FOUND=0,RM,OBJ
?L1:	GET COR,CNT >RM
	ZERO? RM /FALSE
	EQUAL? RM,HERE \?L5
	SET 'PAST,1
	JUMP ?L39
?L5:	FIRST? RM >OBJ \?L39
?L7:	ZERO? ITM /?L9
	EQUAL? OBJ,ITM \?L29
	GET COR,PAST >FOUND
	JUMP ?L8
?L9:	FSET? OBJ,PERSON \?L29
	FSET? OBJ,INVISIBLE /?L29
	FSET? OBJ,NDESCBIT /?L29
	CALL IS-CREW?,OBJ >STACK
	ZERO? STACK /?L15
	CALL CREW-5-TOGETHER? >STACK
	ZERO? STACK /?L15
	FSET? BLY,MUNGBIT /?L15
	EQUAL? OBJ,LOWELL \?L29
	PRINTI "The five "
	PRINTD CREW
	PRINTI " members are off to "
	GET COR,PAST >STACK
	CALL DIR-PRINT,STACK
	PRINTI "."
	CRLF
	JUMP ?L29
?L15:	FSET? OBJ,TOUCHBIT /?L24
	PRINTI "Someone is off to "
	GET COR,PAST >STACK
	CALL DIR-PRINT,STACK
	PRINTI "."
	CRLF
	JUMP ?L29
?L24:	PRINTD OBJ
	PRINTI " is off to "
	GET COR,PAST >STACK
	CALL DIR-PRINT,STACK
	PRINTI "."
	CRLF
?L29:	NEXT? OBJ >OBJ /?L7
?L8:	ZERO? FOUND /?L39
	RETURN FOUND
?L39:	INC 'CNT
	JUMP ?L1

	.FUNCT I-ALARM-RINGING
	CALL IN-LAB?,HERE >STACK
	ZERO? STACK /FALSE
	PRINTI "The "
	PRINTD ALARM
	PRINTR " continues to ring."

	.FUNCT GRAB-ATTENTION,X,OBJ=0
	CALL BAD-AIR? >STACK
	ZERO? STACK \FALSE
	FSET? X,BUSYBIT \?L3
	CALL TOO-BAD-BUT,X,STR?230
	RFALSE
?L3:	ZERO? SNARK-ATTACK-COUNT /TRUE
	CALL DONT-KNOW,X,OBJ
	RFALSE

	.FUNCT TELL-HINT,CARDNUM,OBJ,CR?=1
	ZERO? CR? /?L1
	CRLF
?L1:	PRINTI "(If you want a clue, find Infocard #"
	DIV CARDNUM,10 >STACK
	PRINTN STACK
	PRINTI " in your "
	PRINTD GAME
	PRINTI " package. Read hidden clue #"
	MOD CARDNUM,10 >STACK
	PRINTN STACK
	PRINTI " and put """
	PRINTD OBJ
	PRINTR """ in the blank space.)"

	.FUNCT I-LAMP-ON-SCOPE
	CALL GLOBAL-IN?,VIDEOPHONE,HERE >STACK
	ZERO? STACK /?L1
	ZERO? ALARM-RINGING /FALSE
	FSET? VIDEOPHONE,ONBIT /FALSE
	CALL QUEUE,I-LAMP-ON-SCOPE,7 >STACK
	PUT STACK,0,1
	CALL TELL-HINT,82,VIDEOPHONE >STACK
	RSTACK
?L1:	ZERO? SUB-IN-TANK /FALSE
	CALL QUEUE,I-LAMP-ON-SCOPE,1 >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT I-SEND-SUB
	FSET? VIDEOPHONE,ONBIT \FALSE
	ZERO? WOMAN-ON-SCREEN \FALSE
	CALL TELL-HINT,81,LOCAL-SUB >STACK
	RSTACK

	.FUNCT TIP-FOLLOWS-YOU,RM
	ZERO? TIP-FOLLOWS-YOU? /FALSE
	CALL IN-LAB?,RM >STACK
	ZERO? STACK /?L3
	CALL IN-LAB?,OLD-HERE >STACK
	ZERO? STACK \FALSE
?L3:	CALL IN-TANK-AREA?,RM >STACK
	ZERO? STACK /?L4
	CALL IN-TANK-AREA?,OLD-HERE >STACK
	ZERO? STACK \FALSE
?L4:	EQUAL? RM,CRAWL-SPACE /FALSE
	EQUAL? OLD-HERE,RM /FALSE
	SET 'OLD-HERE,RM
	IN? MICROPHONE,TIP \?L7
	MOVE MICROPHONE,CENTER-OF-LAB
	JUMP ?L9
?L7:	IN? MICROPHONE-DOME,TIP \?L9
	MOVE MICROPHONE-DOME,COMM-BLDG
?L9:	LOC TIP >STACK
	EQUAL? RM,SUB,STACK /?L11
	FCLEAR TIP,TOUCHBIT
?L11:	MOVE TIP,RM
	RTRUE

	.FUNCT I-SHARON-GONE,L
	ZERO? MONSTER-GONE \?L1
	CALL QUEUE,I-SHARON-GONE,4
	RFALSE
?L1:	CALL META-LOC,SHARON >L
	REMOVE SHARON
	CALL ROB,SHARON,GLOBAL-SHARON
	FCLEAR FILE-DRAWER,NDESCBIT
	FCLEAR PAPERS,NDESCBIT
	CALL SHARON-PASSES-YOU?,L >STACK
	ZERO? STACK /FALSE
	CALL SUDDENLY-SHARON,L
	PRINTI "really must go now, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ". I'll see you later."""
	CRLF
	EQUAL? HERE,OFFICE \TRUE
	PRINTI "She leaves through the "
	PRINTD OFFICE-DOOR
	PRINTR "."

	.FUNCT ROB,WHAT,THIEF,N,X
	FIRST? WHAT >X /?L4
	RTRUE
?L1:	ZERO? X /TRUE
?L4:	NEXT? X >N /?L7
?L7:	MOVE X,THIEF
	FCLEAR X,TAKEBIT
	SET 'X,N
	JUMP ?L1

	.FUNCT SUDDENLY-SHARON,L
	PRINTI "
Suddenly Sharon "
	EQUAL? L,HERE /?L3
	PRINTI "passes by and says"
	JUMP ?L7
?L3:	PRINTI "leaves, saying"
?L7:	PRINTI ", ""I "
	RTRUE

	.FUNCT I-SHARON-TO-HALLWAY,L
	CALL QUEUE,I-SHARON-TO-HALLWAY,0
	CALL META-LOC,SHARON >L
	MOVE SHARON,HALLWAY
	CALL SHARON-PASSES-YOU?,L >STACK
	ZERO? STACK /?L1
	CALL SUDDENLY-SHARON,L
	PRINTI "must go back to my office now, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "."""
	CRLF
?L1:	CALL I-SHARON,G-REACHED >STACK
	RSTACK

	.FUNCT I-SHARON,GARG=0,L
	LOC SHARON >L
	EQUAL? GARG,G-REACHED \FALSE
	EQUAL? L,HALLWAY \FALSE
	MOVE SHARON,OFFICE
	FSET SHARON,NDESCBIT
	FSET FILE-DRAWER,NDESCBIT
	FSET PAPERS,NDESCBIT
	FSET? VIDEOPHONE,ONBIT \FALSE
	FCLEAR VIDEOPHONE,ONBIT
	FSET VIDEOPHONE,MUNGBIT
	CALL PHONE-OFF
	SET 'SHARON-BROKE-CIRCUIT,1
	FSET CIRCUIT-BREAKER,MUNGBIT
	FSET CIRCUIT-BREAKER,OPENBIT
	SET 'MONSTER-GONE,1
	CALL IN-LAB?,HERE >STACK
	ZERO? STACK /?L7
	CRLF
	PRINTI "Something's wrong! The picture vanished from your "
	PRINTD VIDEOPHONE
	PRINTI " screen, and the sound conked out!
"
	CALL TIP-SAYS
	PRINTI "That's strange! Maybe you should use the "
	PRINTD COMPUTESTOR
	PRINTI "."""
	CRLF
?L7:	CALL SCORE-UPD,-3
	RTRUE

	.FUNCT TIP-SAYS,QUIET=0
	PRINTI "Tip s"
	IN? TIP,HERE \?L3
	PRINTI "ays"
	JUMP ?L7
?L3:	PRINTI "houts"
?L7:	ZERO? QUIET /?L10
	PRINTI " quietly"
?L10:	PRINTI ", """
	RTRUE

	.FUNCT NOT-NOW?,BLY?=1
	ZERO? BLY? /?L1
	ZERO? BLY-PRIVATELY-DELAY \TRUE
?L1:	FSET? BLY,MUNGBIT /TRUE
	ZERO? GREENUP-ESCAPE \TRUE
	EQUAL? HERE,CRAWL-SPACE,SUB /TRUE
	RFALSE

	.FUNCT I-BLY-PRIVATELY
	ZERO? SNARK-ATTACK-COUNT \FALSE
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK \FALSE
	ZERO? ZOE-MENTIONED-EVIDENCE \FALSE
	CALL NOT-NOW? >STACK
	ZERO? STACK /?L10
	SET 'BLY-PRIVATELY-DELAY,0
	CALL QUEUE,I-BLY-PRIVATELY,7
	RFALSE
?L10:	SET 'BLY-PRIVATELY-DELAY,1
	MOVE PRIVATE-MATTER,GLOBAL-OBJECTS
	CRLF
	PRINTI "Suddenly "
	PRINTD BLY
	PRINTI " "
	CALL META-LOC,BLY >STACK
	EQUAL? STACK,HERE /?L15
	MOVE BLY,HERE
	PRINTI "comes over and "
?L15:	ZERO? BLY-PRIVATELY-COUNT \?L20
	PRINTI "say"
	JUMP ?L24
?L20:	PRINTI "repeat"
?L24:	PRINTI "s, """
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", can we discuss a "
	PRINTD PRIVATE-MATTER
	PRINTI " now?"""
	INC 'BLY-PRIVATELY-COUNT
	CALL YES? >STACK
	ZERO? STACK \?L29
	CALL QUEUE,I-BLY-PRIVATELY,7
	RFALSE
?L29:	CALL ASK-BLY-ABOUT-PRIVATE-MATTER
	RTRUE

	.FUNCT I-BLY-SAYS,ASKED?=0,L
	ZERO? ASKED? /?L1
	CALL QUEUE,I-BLY-SAYS,0
	JUMP ?L4
?L1:	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK \FALSE
	CALL NOT-NOW? >STACK
	ZERO? STACK /?L4
	SET 'BLY-PRIVATELY-DELAY,0
	CALL QUEUE,I-BLY-SAYS,7
	RFALSE
?L4:	SET 'BLY-PRIVATELY-DELAY,1
	CALL META-LOC,BLY >L
	ZERO? ASKED? \?L9
	EQUAL? L,BLY-OFFICE \?L6
	EQUAL? L,HERE \?L6
	ZERO? ASKED? \?L9
	CRLF
?L9:	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ","" says Zoe, ""we could be in danger! The Snark may attack again any time! Would you answer some questions?"""
	CALL YES? >STACK
	ZERO? STACK \?L18
	ZERO? ASKED? \TRUE
	CALL QUEUE,I-BLY-SAYS,3 >STACK
	PUT STACK,0,1
	RFALSE
?L18:	PRINTI """Can you use the "
	PRINTD SUB
	PRINTI " to hunt the "
	PRINTD GLOBAL-SNARK
	PRINTI ", instead of waiting for it to attack?"""
	CALL YES? >STACK
	ZERO? STACK /?L39
	PRINTI """Do you wish to arm the "
	PRINTD SUB
	PRINTI " for attacking?"""
	CALL YES? >STACK
	ZERO? STACK /?L39
	CALL TELL-HINT,73,CLAW,0
	CALL TELL-HINT,72,DART
	EQUAL? HERE,DOME-LAB /?L39
	PRINTI "
""If you want to think it over, we should go to the "
	PRINTD DOME-LAB
	PRINTI ". Shall we go now?"""
	CALL YES? >STACK
	ZERO? STACK /?L39
	PRINTI """Okay, let's go.""

"
	IN? BLACK-BOX,BLY \?L36
	MOVE BLACK-BOX,HERE
?L36:	SET 'WINNER,PLAYER
	CALL GOTO,DOME-LAB >STACK
	ZERO? STACK /?L39
	MOVE BLY,DOME-LAB
?L39:	RETURN 2
?L6:	CALL QUEUE,I-BLY-SAYS,3 >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT I-TIP-SAYS
	EQUAL? TIP-SAYS-2,MAGAZINE \?L1
	FSET? MAGAZINE,TOUCHBIT /FALSE
?L1:	ZERO? TIP-SAYS-1 /FALSE
	CALL META-LOC,MAGAZINE >STACK
	EQUAL? STACK,SUB,CRAWL-SPACE \FALSE
	CALL TELL-HINT,TIP-SAYS-1,TIP-SAYS-2 >STACK
	RSTACK

	.FUNCT I-TIP-SONAR-PLAN,P
	FSET? TIP,BUSYBIT \?L1
	CALL QUEUE,I-TIP-SONAR-PLAN,3
	RFALSE
?L1:	ZERO? SNARK-ATTACK-COUNT \?L4
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK /?L3
?L4:	CALL QUEUE,I-TIP-SONAR-PLAN,0
	RFALSE
?L3:	CALL FIND-FLAG,HERE,PERSON,PLAYER >P
	ZERO? P \?L6
	CALL TIP-COMES >STACK
	RSTACK
?L6:	EQUAL? P,TIP \?L8
	REMOVE PLAYER
	CALL FIND-FLAG,HERE,PERSON,TIP >P
	MOVE PLAYER,HERE
	CALL TIP-COMES,P >STACK
	RSTACK
?L8:	CALL TIP-COMES,1 >STACK
	RSTACK

	.FUNCT MIKE-1-F,OBJ,FOO=0
	ZERO? FOO \?L1
	PRINTI """Is "
	PRINTD OBJ
	PRINTI " a suspect?"""
	RTRUE
?L1:	PRINTI """Do you think "
	PRINTD OBJ
	PRINTI " could be the "
	PRINTD TRAITOR
	PRINTI "?"""
	RTRUE

	.FUNCT TIP-COMES,ALMOST=0
	ZERO? SIEGEL-TESTED \FALSE
	FSET? SIEGEL,BUSYBIT /FALSE
	ZERO? GREENUP-ESCAPE \FALSE
	ZERO? GREENUP-TRAPPED \FALSE
	ZERO? GREENUP-CUFFED \FALSE
	EQUAL? HERE,SUB,CRAWL-SPACE /?L7
	FSET? TIP,BUSYBIT \?L6
?L7:	CALL QUEUE,I-TIP-SONAR-PLAN,3
	RFALSE
?L6:	ZERO? ALMOST /?L17
	MOVE TIP,HERE
	CALL INT,I-TIP-SONAR-PLAN >STACK
	GET STACK,1 >ALMOST
	GRTR? ALMOST,-1 /?L11
	SUB 0,ALMOST >STACK
	MOD STACK,7 >STACK
	EQUAL? STACK,2 \FALSE
?L11:	CALL TIP-SAYS,1
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", I'd like to talk with you alone."""
	CRLF
	GRTR? ALMOST,-1 \TRUE
	CALL QUEUE,I-TIP-SONAR-PLAN,-1
	RTRUE
?L17:	CALL QUEUE,I-TIP-SONAR-PLAN,0
	CRLF
	ZERO? BLACK-BOX-EXAMINED \?L19
	CALL TELL-HINT,11,BLACK-BOX
?L19:	MOVE TIP,HERE
	CALL TIP-SAYS,1
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", did "
	PRINTD BLY
	PRINTI " mention any troublemakers among the "
	PRINTD CREW
	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	PRINTI """Do you suspect "
	PRINTD ANTRIM
	PRINTI " or "
	PRINTD HORVAK
	PRINTI " or "
	PRINTD SIEGEL
	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	PRINTI """Marv maintains the "
	PRINTD SONAR-EQUIPMENT
	PRINTI ","" "
	CALL TIP-SAYS
	PRINTI "and we'll need it to warn us if the "
	PRINTD SNARK
	PRINTI " comes back. Didn't Zoe say something is wrong with it?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	PRINTI """"
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", do you think someone tampered with it?"""
	CALL YES? >STACK
	ZERO? STACK /TRUE
	PRINTI """Does Marv suspect you've discovered signs of tampering?"""
	CALL YES? >STACK
	ZERO? STACK \TRUE
	CALL THIS-IS-IT,TIP-IDEA
	PRINTI """Then I have an idea how to trap Marv and find out if he's the "
	PRINTD TRAITOR
	PRINTR "!"""

	.FUNCT REACTION-MAY-BE,PER
	PRINTD PER
	PRINTI "'s reaction may be all you need to prove he's NOT the "
	PRINTD TRAITOR
	PRINTR ". But you'll have to decide for yourself."

	.FUNCT SIEGEL-BOX
	PRINTR "It will modulate the sonar's ultrasonic pulses!"""

	.FUNCT I-SIEGEL-REPORTS
	ZERO? DOME-AIR-BAD? /?L1
	CALL QUEUE,I-SIEGEL-REPORTS,3 >STACK
	PUT STACK,0,1
	RFALSE
?L1:	FCLEAR SIEGEL,BUSYBIT
	IN? SIEGEL,COMM-BLDG \FALSE
	CALL MOVE-HERE-NOT-SUB,SIEGEL
	IN? BLACK-BOX,SONAR-EQUIPMENT /?L7
	PRINTI "Suddenly "
	PRINTD SIEGEL
	PRINTI " reports: ""The "
	PRINTD SONAR-EQUIPMENT
	PRINTI " looks okay to me, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "."""
?L7:	EQUAL? HERE,COMM-BLDG \?L12
	PRINTI "Suddenly "
	PRINTD SIEGEL
	PRINTI " turns to you"
	JUMP ?L16
?L12:	IN? TIP,HERE \?L17
	CALL TIP-SAYS
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", here comes Marv, and he looks excited!""
"
?L17:	PRINTI "Marv comes running up to you"
?L16:	PRINTI " with the "
	PRINTD BLACK-BOX
	PRINTI " and says: ""Look"
	MOVE BLACK-BOX,SIEGEL
	ZERO? SIEGEL-TESTED /?L26
	PRINTI "! I found the same "
	PRINTD BLACK-BOX
	PRINTI " on the "
	PRINTD SONAR-EQUIPMENT
	PRINTR " again!"""
?L26:	SET 'SIEGEL-TESTED,1
	PRINTI " what I found attached to the "
	PRINTD SONAR-EQUIPMENT
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! "
	CALL SIEGEL-BOX
	IN? TIP,HERE \TRUE
	CALL TIP-FLASHES
	CALL REACTION-MAY-BE,SIEGEL
	PRINTI "
Tip snaps his fingers and says: """
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! Didn't that article in the "
	PRINTD MAGAZINE
	PRINTI " say "
	PRINTD THORPE
	PRINTI "'s synthetic sea creatures reacted to ultrasonic pulses in a special way?"""
	CALL QUEUE,I-TIP-PRIVATELY,1 >STACK
	PUT STACK,0,1
	CALL YES? >STACK
	ZERO? STACK /?L37
	PRINTR """That's what I thought."""
?L37:	PRINTR """I think you should check that."""

	.FUNCT I-TIP-PRIVATELY
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK \?L3
	ZERO? ANTRIM-CHECKED-SUB /?L1
?L3:	CALL QUEUE,I-TIP-PRIVATELY,0
	RFALSE
?L1:	FSET? TIP,BUSYBIT \?L4
	CALL QUEUE,I-TIP-PRIVATELY,3 >STACK
	PUT STACK,0,1
	RFALSE
?L4:	MOVE TIP,HERE
	CRLF
	PRINTI "Tip draws you aside. ""Could I speak to you privately, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK \?L8
	CALL QUEUE,I-TIP-PRIVATELY,3 >STACK
	PUT STACK,0,1
	CALL PRINT-ID,STR?231
	RFALSE
?L8:	PRINTI """The Snark could be a synthetic monster created by "
	PRINTD THORPE
	PRINTI "!"" he says when you're alone. ""I read about them in that "
	PRINTD MAGAZINE
	PRINTI ". If I'm right, whoever attached the "
	PRINTD BLACK-BOX
	PRINTI " to the "
	PRINTD SONAR-EQUIPMENT
	PRINTI " could be working for Thorpe! That way the "
	PRINTD GLOBAL-SNARK
	PRINTI " would be lured into attacking the "
	PRINTD AQUADOME
	PRINTI "! Do you agree, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "?"""
	CALL YES? >STACK
	ZERO? STACK \?L13
	PRINT RECONSIDER?
	PRINTI """"
	CRLF
?L13:	CALL MIKE-1-F,ANTRIM,1
	CALL YES? >STACK
	ZERO? STACK \?L18
	PRINT RECONSIDER?
	PRINTI " In fact "
	JUMP ?L22
?L18:	PRINTI """Then "
?L22:	PRINTI "why not test him"
	ZERO? SIEGEL-TESTED /?L27
	PRINTI ", since you tested "
	PRINTD SIEGEL
?L27:	PRINTI "?"" Tip asks. ""Mick is a laser expert in charge of maintenance on subs at the "
	PRINTD AQUADOME
	PRINTI "."""
	CRLF
	IN? PRIVATE-MATTER,GLOBAL-OBJECTS \?L36
	CALL TELL-HINT,12,OVERHEATING,0
	ZERO? REGULATOR-MSG-SEEN /?L36
	CALL TELL-HINT,43,ANTRIM,0
?L36:	CALL TELL-HINT,22,ANTRIM,0 >STACK
	RSTACK

	.FUNCT I-ANTRIM-TO-SUB,STR=0
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK \FALSE
	ZERO? ANTRIM-CHECKED-SUB \FALSE
	ZERO? STR \?L5
	CALL NOT-NOW?,0 >STACK
	ZERO? STACK /?L5
	CALL QUEUE,I-ANTRIM-TO-SUB,3
	RFALSE
?L5:	FSET? VOLTAGE-REGULATOR,MUNGBIT \?L7
	CALL QUEUE,I-ANTRIM-REPORTS,9 >STACK
	PUT STACK,0,1
	JUMP ?L9
?L7:	CALL QUEUE,I-ANTRIM-REPORTS,19 >STACK
	PUT STACK,0,1
?L9:	SET 'ANTRIM-CHECKED-SUB,1
	IN? BLY,HERE \?L10
	SET 'BLY-HEARD-ANTRIM,1
?L10:	FSET ANTRIM,BUSYBIT
	ZERO? STR /?L13
	PRINT STR
	JUMP ?L17
?L13:	PRINTI "
Suddenly "
	PRINTD ANTRIM
	IN? ANTRIM,HERE /?L20
	PRINTI " appears and"
?L20:	PRINTI " says, ""I'm going to check out your new "
	PRINTD SUB
	PRINTI ", "
?L17:	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"" Mick turns and "
	MOVE ANTRIM,CRAWL-SPACE
	FSET ENGINE-ACCESS-HATCH,OPENBIT
	EQUAL? HERE,SUB,CRAWL-SPACE \?L29
	PRINTR "goes to work."
?L29:	EQUAL? HERE,AIRLOCK \?L33
	PRINTI "climbs aboard the "
	PRINTD SUB
	PRINTR "."
?L33:	PRINTI "hurries toward the "
	PRINTD AIRLOCK
	PRINTR "."

	.FUNCT TIP-FLASHES
	IN? TIP,HERE \FALSE
	ZERO? TIP-FLASHED /?L4
	PRINTI "Once again "
?L4:	SET 'TIP-FLASHED,1
	PRINTI "Tip flashes you a meaningful glance. "
	RTRUE

	.FUNCT I-ANTRIM-REPORTS
	ZERO? DOME-AIR-BAD? /?L1
	CALL QUEUE,I-ANTRIM-REPORTS,3
	RFALSE
?L1:	FCLEAR ANTRIM,BUSYBIT
	CALL MOVE-HERE-NOT-SUB,ANTRIM
	CRLF
	ZERO? ASKED-ANTRIM /?L4
	PRINTD ANTRIM
	PRINTI " reports back "
	EQUAL? HERE,SUB,AIRLOCK \?L8
	PRINTI "to you"
	JUMP ?L12
?L8:	PRINTI "from the "
	PRINTD AIRLOCK
?L12:	FSET? VOLTAGE-REGULATOR,MUNGBIT \?L15
	PRINTI ".
""I think I found your "
	PRINTD OVERHEATING
	PRINTI " problem. The "
	PRINTD VOLTAGE-REGULATOR
	PRINTI " was making the lasers overcharge.
I've adjusted it, but I could replace it. Want me to?"""
	CALL YES? >STACK
	ZERO? STACK /?L25
	FCLEAR VOLTAGE-REGULATOR,MUNGBIT
	JUMP ?L25
?L15:	PRINTI ", looking somewhat puzzled.
"""
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", I ran the "
	PRINTD ENGINE
	PRINTI " on full, but it didn't overheat.
The "
	PRINTD VOLTAGE-REGULATOR
	PRINTI " PROBABLY got out of adjustment and overcharged the lasers, but it seems okay now. Just to be safe, I installed a new "
	PRINTD VOLTAGE-REGULATOR
	PRINTI ".
"
	JUMP ?L25
?L4:	ZERO? BLY-HEARD-ANTRIM \?L28
	LOC BLY >STACK
	EQUAL? HERE,SUB,BLY-OFFICE,STACK \?L26
?L28:	PRINTI "Suddenly "
	JUMP ?L31
?L26:	CALL MOVE-HERE-NOT-SUB,BLY
	PRINTD BLY
	PRINTI " is approaching.
"""
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", did you send "
	PRINTD ANTRIM
	PRINTI " to work on the "
	PRINTD SUB
	PRINTI "?"" she asks. ""I was just "
	EQUAL? HERE,BLY-OFFICE /?L34
	PRINTI "in my office, "
?L34:	PRINTI "checking the "
	PRINTD STATION-MONITOR
	PRINTI " to see what each of the crew was doing, and I discovered Mick had gone to the "
	PRINTD AIRLOCK
	PRINTI ". When I saw him on the "
	PRINTD STATION-MONITOR
	PRINTI ", he had just come out of the "
	PRINTD SUB
	PRINTI "'s hatch.
Wait -- here he is now!""
"
?L31:	PRINTI "Mick appears and says, ""I thought maybe you had a problem on the way here, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", so I wanted to check on it. Everything seems to be okay now."""
	CRLF
?L25:	CALL TIP-FLASHES
	FSET? VOLTAGE-REGULATOR,MUNGBIT \?L43
	SET 'TEST-BUTTON-READOUT,TEST-BUTTON-NORMAL
	PRINTI "It now looks as though "
	PRINTD ANTRIM
	PRINTI " can be eliminated as the "
	PRINTD TRAITOR
	PRINTI ", but you'll want to confirm this by pushing the "
	PRINTD TEST-BUTTON
	PRINTI " before you set out again in the "
	PRINTD SUB
	PRINTI ".
"
	JUMP ?L47
?L43:	CALL REACTION-MAY-BE,ANTRIM
?L47:	FCLEAR VOLTAGE-REGULATOR,MUNGBIT
	CALL READY-FOR-SNARK? >STACK
	ZERO? STACK \TRUE
	IN? ESCAPE-POD-UNIT,SUB /TRUE
	CRLF
	PRINTD ANTRIM
	PRINTI " turns away, then stops and says:
"""
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", there's no "
	PRINTD ESCAPE-POD-UNIT
	PRINTI " under your seats in the "
	PRINTD SUB
	PRINTI ". I hear you're planning a new type of unit for the Ultramarine Bioceptor. But the standard unit will fit, and we have one in the "
	PRINTD DOME-STORAGE
	PRINTI ".
Would you like one installed, just in case? "
	PRINTD GREENUP
	PRINTI " and "
	PRINTD LOWELL
	PRINTI " could do it in a few minutes. Shall I tell 'em to?"""
	CALL YES? >STACK
	ZERO? STACK /?L56
	CALL META-LOC,LOWELL >STACK
	MOVE ANTRIM,STACK
	CALL INSTALL-ESCAPE-POD-UNIT,ANTRIM
	RTRUE
?L56:	PRINTR """I sure hope you don't need it."""

	.FUNCT INSTALL-ESCAPE-POD-UNIT,PER,X=0
	PRINTI """Okay"
	LOC GREENUP >STACK
	LOC LOWELL >STACK
	EQUAL? HERE,STACK,STACK \?L3
	PRINTI ", we'll install it"
?L3:	PRINTI "."""
	CRLF
	LOC SYRINGE >STACK
	EQUAL? STACK,LOWELL,GREENUP,ESCAPE-POD-UNIT \?L10
	SET 'X,1
?L10:	ZERO? X /?L13
	LOC ESCAPE-POD-UNIT >STACK
	EQUAL? STACK,LOWELL,GREENUP,DOME-STORAGE \?L13
	CALL SCORE-OBJ,ESCAPE-POD-UNIT
	MOVE GREENUP,SUB
	MOVE LOWELL,SUB
	FSET GREENUP,BUSYBIT
	FSET LOWELL,BUSYBIT
	MOVE ESCAPE-POD-UNIT,LOWELL
	MOVE SYRINGE,GREENUP
	FSET SYRINGE,MUNGBIT
	CALL QUEUE,I-LOWELL-REPORTS,12 >STACK
	PUT STACK,0,1
	RTRUE
?L13:	PRINTI "But "
	CALL HE-SHE-IT,PER
	MOVE PER,HERE
	PRINTI " returns a moment later and says, ""We can't find the "
	ZERO? X /?L20
	PRINTD ESCAPE-POD-UNIT
	JUMP ?L24
?L20:	PRINTD SYRINGE
?L24:	PRINTR "."""

	.FUNCT I-LOWELL-REPORTS
	CALL NOT-NOW?,0 >STACK
	ZERO? STACK /?L1
	CALL QUEUE,I-LOWELL-REPORTS,3
	RFALSE
?L1:	MOVE ESCAPE-POD-UNIT,SUB
	FCLEAR ESCAPE-POD-UNIT,TAKEBIT
	FSET ESCAPE-POD-UNIT,OPENBIT
	MOVE SYRINGE,ESCAPE-POD-UNIT
	SET 'TEST-BUTTON-READOUT,TEST-BUTTON-POD
	MOVE GREENUP,HERE
	MOVE LOWELL,HERE
	FCLEAR GREENUP,BUSYBIT
	FCLEAR LOWELL,BUSYBIT
	PRINTI "
Suddenly "
	PRINTD GREENUP
	PRINTI " and "
	PRINTD LOWELL
	PRINTI " report back from the "
	EQUAL? HERE,AIRLOCK \?L6
	PRINTD SUB
	JUMP ?L10
?L6:	PRINTD AIRLOCK
?L10:	CALL SAID-TO,LOWELL
	PRINTI ".
""That "
	PRINTD ESCAPE-POD-UNIT
	PRINTI " is in place, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR ","" says Amy. ""Bill installed the part under your pilot's seat, and I installed the rest."""

	.FUNCT I-ANALYSIS
	FCLEAR HORVAK,BUSYBIT
	FSET SYRINGE,TAKEBIT
	CALL MOVE-HERE-NOT-SUB,HORVAK >STACK
	ZERO? STACK /?L1
	CRLF
	FSET? SYRINGE,MUNGBIT /?L3
	PRINTI "Suddenly "
	PRINTD HORVAK
	PRINTI " appears. ""I couldn't find anything unusual about the "
	PRINTD SYRINGE
	PRINTR "."""
?L3:	SET 'GREENUP-GUILT,1
	PRINTD HORVAK
	PRINTI "'s face is grim and pale as he reports the result of his analysis.
"
	CALL PERFORM,V?ASK-ABOUT,HORVAK,SYRINGE
	IN? TIP,HERE \FALSE
	PRINTI "
Tip turns to you with a gasp. ""Holy smoke, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTR "! That's exactly what would have happened once you warmed up the pilot's seat enough to trigger the sensor relay!"""
?L1:	CALL QUEUE,I-ANALYSIS,2
	RFALSE

	.FUNCT I-SYNTHESIS
	FCLEAR HORVAK,BUSYBIT
	MOVE DART,HORVAK
	FCLEAR DART,TRYTAKEBIT
	FSET DART,TAKEBIT
	FCLEAR DART,NDESCBIT
	FCLEAR DART,MUNGBIT
	CALL THIS-IS-IT,DART
	CALL SAID-TO,HORVAK
	PRINTI "Doc Horvak "
	CALL MOVE-HERE-NOT-SUB,HORVAK,STR?233,STR?232
	PRINTI " holding an aquatic dart gun. "
	IN? HORVAK,HERE /?L5
	PRINTI "He shouts from outside, "
?L5:	PRINTI """Okay, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI ", I've made a special 'trank' to use against an A.H.-type organism! It's loaded in the dart gun. What shall I do with it?"""
	CRLF
	CALL SCORE-OBJ,DART
	RTRUE

	.FUNCT MOVE-HERE-NOT-SUB,PER,HERE-STR=0,NOT-HERE-STR=0
	IN? PER,HERE \?L1
	ZERO? HERE-STR /TRUE
	PRINT HERE-STR
	RTRUE
?L1:	LOC PER >STACK
	CALL THROUGH-ROOF?,STACK >STACK
	ZERO? STACK /?L9
	FSET AIRLOCK-ROOF,OPENBIT
?L9:	EQUAL? PER,SHARON \?L12
	FCLEAR SHARON,NDESCBIT
	FCLEAR FILE-DRAWER,NDESCBIT
	FCLEAR PAPERS,NDESCBIT
?L12:	ZERO? NOT-HERE-STR /?L15
	PRINT NOT-HERE-STR
?L15:	EQUAL? HERE,CRAWL-SPACE,SUB \?L20
	ZERO? SUB-IN-TANK /?L22
	MOVE PER,NORTH-TANK-AREA
	RFALSE
?L22:	MOVE PER,AIRLOCK
	RFALSE
?L20:	MOVE PER,HERE
	RTRUE

	.FUNCT I-GREENUP-ESCAPE
	CALL QUEUE,I-GREENUP-ESCAPE,-1 >STACK
	PUT STACK,0,1
	INC 'GREENUP-ESCAPE
	EQUAL? 3,GREENUP-ESCAPE \?L1
	MOVE GREENUP,AIRLOCK
	CRLF
	PRINTI "Greenup has reached the top of the wall and is climbing down the ladder into the "
	PRINTD AIRLOCK
	PRINTI ". In a moment he'll reach the floor and head for the "
	PRINTD SUB
	PRINTI "."
	CRLF
	RFALSE
?L1:	EQUAL? 4,GREENUP-ESCAPE \?L5
	CRLF
	PRINTI "Greenup is scrambling aboard the "
	PRINTD SUB
	PRINTI ". Tip groans. ""There's no way to stop him now, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! All he has to do is open the "
	PRINTD AIRLOCK-HATCH
	PRINTI " and shove off!"""
	CRLF
	CALL TELL-HINT,52,AIRLOCK-ELECTRICITY,0
	RTRUE
?L5:	EQUAL? 9,GREENUP-ESCAPE \FALSE
	FCLEAR AIRLOCK-ROOF,OPENBIT
	FSET AIRLOCK-HATCH,OPENBIT
	SET 'AIRLOCK-FULL,1
	CALL QUEUE,I-SNARK-ATTACKS,1
	PRINTI "
Better not raise any false hopes. As the "
	PRINTD SUB
	PRINTI " glides out, a pall of gloom settles over the "
	PRINTD AQUADOME
	PRINTI ". All hands sense that there's little hope, that Greenup has scuttled their last chance of fighting off another attack by the "
	PRINTD GLOBAL-SNARK
	PRINTI ".
A "
	PRINTD VIDEOPHONE
	PRINTI " call to "
	PRINTD IU-GLOBAL
	PRINTI " confirms that no other subs are available for a rescue expedition, even if there were time. And a general S.O.S. to any craft in the vicinity isn't answered."
	CALL FINISH
	RFALSE

	.FUNCT GREENUP-CUFF
	SET 'GREENUP-ESCAPE,0
	SET 'GREENUP-TRAPPED,0
	CALL QUEUE,I-GREENUP-ESCAPE,0
	MOVE GREENUP,GALLEY
	FSET GREENUP,MUNGBIT
	SET 'GREENUP-CUFFED,1
	PRINTI "Knowing he's trapped, "
	PRINTD GREENUP
	PRINTI " gives up without a fight. "
	PRINTD BLY
	PRINTI " orders him handcuffed to a pipe in the "
	PRINTD GALLEY
	PRINTI "."
	CRLF
	CALL SCORE-OBJ,GLOBAL-GREENUP
	RTRUE

	.FUNCT I-POISON-JAB
	EQUAL? HERE,SUB \FALSE
	IN? ESCAPE-POD-UNIT,SUB \FALSE
	FSET? SYRINGE,MUNGBIT \FALSE
	IN? SYRINGE,ESCAPE-POD-UNIT \FALSE
	CRLF
	PRINTI "A sudden jab in your right buttock makes you realize that the "
	PRINTD SYRINGE
	PRINTI " in the "
	PRINTD ESCAPE-POD-UNIT
	PRINTI " has been activated, even though no alarm sounded.
You realize that the "
	PRINTD SYRINGE
	PRINTI " did NOT contain a stimulant. Instead of feeling more alert, you're already feeling doomed.
The truth is that you have been fatally poisoned, and the promising career of a brilliant young inventor will be cut short.
An investigation into your death would reveal that the "
	PRINTD ESCAPE-POD-UNIT
	PRINTI " under your seat had been tampered with.
A body-heat sensor had been substituted for the electronic monitor, and a wire was connected from the sensor to the "
	PRINTD SYRINGE
	PRINTI ". The stimulant in the "
	PRINTD SYRINGE
	PRINTI " had been replaced with arsenic stolen from the "
	PRINTD CHEMICAL-SUPPLY-SHELVES
	PRINTI " of the "
	PRINTD DOME-LAB
	PRINTI ".
As soon as you heated up your pilot's seat, the sensor triggered the "
	PRINTD SYRINGE
	PRINTI ", and it injected you with the poison.
Most regrettable!"
	CALL PRINT-ID,STR?234
	CALL FINISH >STACK
	RSTACK

	.FUNCT I-TIP-REPORTS,B,D
	FSET? BLY,MUNGBIT \?L1
	CALL QUEUE,I-TIP-REPORTS,3
	RFALSE
?L1:	EQUAL? HERE,CRAWL-SPACE \?L4
	MOVE TIP,SUB
	JUMP ?L6
?L4:	MOVE TIP,HERE
?L6:	FCLEAR TIP,BUSYBIT
	SET 'TIP-FOLLOWS-YOU?,1
	SET 'FINE-SONAR,1
	MOVE FINE-GRID,SUB
	FCLEAR FINE-GRID,TAKEBIT
	CALL TIP-SAYS
	PRINTI "All set, "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "! The "
	PRINTD FINE-GRID
	PRINTI " is installed on both the "
	PRINTD SONARSCOPE
	PRINTI " and the "
	PRINTD THROTTLE
	GET ON-SUB,0 >STACK
	EQUAL? BAZOOKA,STACK /?L9
	SET 'B,0
	JUMP ?L10
?L9:	SET 'B,1
?L10:	GET ON-SUB,1 >STACK
	EQUAL? DART,STACK /?L11
	SET 'D,0
	JUMP ?L12
?L11:	SET 'D,1
?L12:	ZERO? B \?L15
	ZERO? D /?L35
?L15:	PRINTI " -- and so "
	ZERO? B /?L18
	ZERO? D /?L18
	PRINTI "are"
	JUMP ?L22
?L18:	PRINTI "is"
?L22:	ZERO? D /?L25
	PRINTI " the "
	PRINTD DART
?L25:	ZERO? B /?L35
	ZERO? D /?L30
	PRINTI " and"
?L30:	ZERO? B /?L35
	PRINTI " the "
	PRINTD BAZOOKA
?L35:	PRINTI "! Let's shove off and find the "
	PRINTD GLOBAL-SNARK
	PRINTR "!"""

	.FUNCT USE-FEWER-TURNS
	PRINTI "

(You'll probably do better if you restart and use fewer turns next time.)"
	RTRUE

	.FUNCT I-SNARK-ATTACKS
	ZERO? SNARK-ATTACK-COUNT \?L26
	ZERO? SUB-IN-DOME \?L3
	EQUAL? JOYSTICK-DIR,P?SE /?L7
	LESS? SUB-LON,0 \?L8
	SUB 0,SUB-LON >STACK
	JUMP ?L10
?L8:	PUSH SUB-LON
?L10:	LESS? SONAR-RANGE,STACK /?L5
	LESS? SUB-LAT,0 \?L11
	SUB 0,SUB-LAT >STACK
	JUMP ?L13
?L11:	PUSH SUB-LAT
?L13:	LESS? SONAR-RANGE,STACK /?L5
?L7:	CALL QUEUE,I-SNARK-ATTACKS,3
	RFALSE
?L5:	PRINTI "A call comes on the "
	EQUAL? HERE,SUB,CRAWL-SPACE \?L17
	PRINTD SONARPHONE
	JUMP ?L21
?L17:	PRINTD VIDEOPHONE
?L21:	PRINTI " from the "
	PRINTD AQUADOME
	PRINTI ": the "
	PRINTD GLOBAL-SNARK
	PRINTI " is attacking and destroying it! You're too late!"
	CALL USE-FEWER-TURNS
	CALL FINISH
	JUMP ?L26
?L3:	CALL QUEUE,I-SNARK-ATTACKS,-1 >STACK
	PUT STACK,0,1
?L26:	INC 'SNARK-ATTACK-COUNT
	EQUAL? 1,SNARK-ATTACK-COUNT \?L28
	MOVE SIEGEL,COMM-BLDG
	MOVE TIP,HERE
	PRINTI "
Suddenly an alarm rings through the "
	PRINTD AQUADOME
	PRINTI "! "
	PRINTD SIEGEL
	PRINTI " yells over the squawk box:
""Now hear this! Two blips have appeared on the "
	PRINTD SONAR-EQUIPMENT
	PRINTI "! No definite form, but they're large, and they're coming closer."
	PRINTI """
"
	CALL TIP-SAYS
	PRINTI "One of them must be the "
	PRINTD GLOBAL-SNARK
	PRINTI "!"" "
	EQUAL? HERE,SUB,CRAWL-SPACE,AIRLOCK \?L36
	FSET? AIRLOCK-HATCH,OPENBIT \?L43
	FCLEAR AIRLOCK-HATCH,OPENBIT
	PRINTI "The "
	PRINTD AIRLOCK-HATCH
	PRINTI " closes in defense."
	JUMP ?L43
?L36:	CALL GLOBAL-IN?,WINDOW,HERE >STACK
	ZERO? STACK /?L44
	PRINTI """Look out the "
	JUMP ?L48
?L44:	PRINTI """Let's find a "
?L48:	PRINTD WINDOW
	PRINTI ", "
	CALL PRINT-NAME,FIRST-NAME
	PRINTI "!"""
?L43:	CRLF
	RETURN 2
?L28:	EQUAL? 2,SNARK-ATTACK-COUNT \?L55
	PRINTI "
Even as you try this, the undersea nightmare takes shape!
""Holy spaghetti! LOOK at that thing!"" cries Tip.
A hideous creature, with bulblike eyes near its snout, rears out of the murk, its tentacles flailing the "
	PRINTD GLOBAL-WATER
	PRINTI "! In this moment of terror, the "
	PRINTD GLOBAL-SNARK
	PRINTI " seems as big as a house, and it's just outside the "
	PRINTD AQUADOME
	PRINTI "!"
	CRLF
	RETURN 2
?L55:	EQUAL? 3,SNARK-ATTACK-COUNT \FALSE
	PRINTI "
No more time for that! The "
	PRINTD SNARK
	PRINTI " has flopped down on the "
	PRINTD AQUADOME
	PRINTI "! There's a sound like thunder as the plastic hemisphere cracks under the impact! The crew's screams of fear are drowned by the roar of the sea!
The Atlantic Ocean is pouring into the "
	PRINTD AQUADOME
	PRINTI "! And your last thought, before a zillion tons of "
	PRINTD GLOBAL-WATER
	PRINTI " crushes you to jelly, is ""Oh gosh! I wonder if I shut off the Bunsen burner in the lab?"""
	CALL PRINT-ID,STR?235
	CALL USE-FEWER-TURNS
	CALL FINISH >STACK
	RSTACK

	.INSERT "annotated_games/seastalker/seastalker_str"
	.END
