	.INSERT "annotated_games/infidel/infidel_freq"
	.INSERT "annotated_games/infidel/infidel_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	PRINTD OBJ
	RTRUE

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-FRAGILE-OBJECT?
	EQUAL? PRSO,BLACK-BOX,CRATE,CRUMBLED-BOOK /TRUE
	EQUAL? PRSO,DEAD-BOOK,GOLD-CUP,HERRING-JEWEL /TRUE
	EQUAL? PRSO,ISIS-JEWEL,NEITH-JEWEL,NEPHTH-JEWEL /TRUE
	EQUAL? PRSO,OIL-JAR,SCARAB,SCROLL /TRUE
	EQUAL? PRSO,SELKIS-JEWEL,SILVER-CUP,SKELETON \FALSE
	RTRUE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,ALTAR,ANNEX-DOOR,ARMS /TRUE
	EQUAL? PRSO,BEAM,BLACK-BOX,BOAT /TRUE
	EQUAL? PRSO,BRICK-EIGHT,BRICK-FIVE,BRICK-FOUR /TRUE
	EQUAL? PRSO,BRICK-NINE,BRICK-ONE,BRICK-SEVEN /TRUE
	EQUAL? PRSO,BRICK-SIX,BRICK-THREE,BRICK-TWO /TRUE
	EQUAL? PRSO,BROKEN-LOCK,BULKHEADS,BUTTON /TRUE
	EQUAL? PRSO,CANTEEN,CEILING,COT /TRUE
	EQUAL? PRSO,CRATE,CRUMBLED-BOOK,DEAD-BOOK /TRUE
	EQUAL? PRSO,DECK,DIGITS,EAST-STAIRS /TRUE
	EQUAL? PRSO,FEW-STEPS,FIREPIT,FLAPS /TRUE
	EQUAL? PRSO,FOLDED-COT,FOO-TOOL,FOOD /TRUE
	EQUAL? PRSO,GEMS,GEMS-2,GOLD-CUP /TRUE
	EQUAL? PRSO,GOLD-LEAF,GOLD-TABLE,HEAD /TRUE
	EQUAL? PRSO,HERRING-JEWEL,HIEROGLYPHS,HUGE-STATUE /TRUE
	EQUAL? PRSO,INNER-DOOR,ISIS,ISIS-DOOR /TRUE
	EQUAL? PRSO,ISIS-JEWEL,KEY,KNAPSACK /TRUE
	EQUAL? PRSO,LEFT-DISC,LINE,LINTEL /TRUE
	EQUAL? PRSO,LOCK,MANUAL,MANY-MATCHES /TRUE
	EQUAL? PRSO,MAP,MAST-HOLE,MATCHES /TRUE
	EQUAL? PRSO,MID-DISC,N-ANTE-SEAL,NEEDLE /TRUE
	EQUAL? PRSO,NEITH,NEITH-DOOR,NEITH-JEWEL /TRUE
	EQUAL? PRSO,NEPHTH-DOOR,NEPHTH-JEWEL,NEPHTHYS /TRUE
	EQUAL? PRSO,NICHES,NORTH-ANTE-DOOR,NORTH-STAIRS /TRUE
	EQUAL? PRSO,NOTE,OIL-JAR,ONE-MATCH /TRUE
	EQUAL? PRSO,PAGE,PARACHUTE,PEN-PENCIL /TRUE
	EQUAL? PRSO,PETROL,PICK-AXE,PICTURE-PANELS /TRUE
	EQUAL? PRSO,PICTURES,PILLARS,PIT /TRUE
	EQUAL? PRSO,PLANE,PLANK,PLASTER /TRUE
	EQUAL? PRSO,PLASTER1,PYRAMID,RIGHT-DISC /TRUE
	EQUAL? PRSO,RING,ROCK-LOCK,ROCK-S /TRUE
	EQUAL? PRSO,ROPE,SARCOPH,SARCOPH-COVER /TRUE
	EQUAL? PRSO,SCARAB,SCARAB-TABLE,SCROLL /TRUE
	EQUAL? PRSO,SELKIS,SELKIS-DOOR,SELKIS-JEWEL /TRUE
	EQUAL? PRSO,SHIM,SHOVEL,SILVER-CUP /TRUE
	EQUAL? PRSO,SILVER-TABLE,SINGLE-MATCH,SKELETON /TRUE
	EQUAL? PRSO,SLAB,SLAB-SEAM,SLOT /TRUE
	EQUAL? PRSO,SMALL-SLIP,SOUTH-STAIRS,SPATULA /TRUE
	EQUAL? PRSO,STAIRS,STONE-KEY,T-LINTEL /TRUE
	EQUAL? PRSO,TENT-OBJ,THICKET,THICKETS /TRUE
	EQUAL? PRSO,TILES,TORCH,TORCH-HOLDER /TRUE
	EQUAL? PRSO,TRUNK,TWINKLERS,WALLS /TRUE
	EQUAL? PRSO,WATER,WEST-STAIRS \FALSE
	RTRUE

	.FUNCT IS-ANIMAL?
	EQUAL? PRSO,NASTY-CROC \FALSE
	RTRUE

	.FUNCT IS-SELF?
	EQUAL? PRSO,ADVENTURER,ME \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? PRSO,FINGER,HANDS \FALSE
	RTRUE

	.FUNCT IS-SELF-OR-PART-OF-SELF?,?TMP
	CALL IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-PART-OF-SELF? >STACK
	RSTACK

	.FUNCT DANGEROUS-DRINK?
	EQUAL? PRSO,LIQUID \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?
	CALL IS-PART-OF-SELF? >STACK
	ZERO? STACK \?L2
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	ZERO? STACK /FALSE
?L2:	EQUAL? PRSO,FOOD \TRUE
	RFALSE

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-ANIMAL? >STACK
	RSTACK

	.FUNCT THIS-IT?,OBJ,TBL,SYNS
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	ZERO? P-ADJ /?L4
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DEC 'STACK
	CALL ZMEMQB,P-ADJ,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L4:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT DEMON,RTN,TICK,CINT
	CALL INT,RTN,1 >CINT
	PUT CINT,C-TICK,TICK
	RETURN CINT

	.FUNCT QUEUE,RTN,TICK,CINT
	CALL INT,RTN >CINT
	PUT CINT,C-TICK,TICK
	RETURN CINT

	.FUNCT INT,RTN,DEMON?1=0,E,C,INT?1
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	SUB C-INTS,C-INTLEN >C-INTS
	ZERO? DEMON?1 /?L5
	SUB C-DEMONS,C-INTLEN >C-DEMONS
?L5:	ADD C-TABLE,C-INTS >INT?1
	PUT INT?1,C-RTN,RTN
	RETURN INT?1
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L7
	RETURN C
?L7:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT CLOCKER,C,E,TICK,FLG=0
	ZERO? CLOCK-WAIT /?L1
	SET 'CLOCK-WAIT,0
	RFALSE
?L1:	ZERO? P-WON /?L4
	PUSH C-INTS
	JUMP ?L6
?L4:	PUSH C-DEMONS
?L6:	ADD C-TABLE,STACK >C
	ADD C-TABLE,C-TABLELEN >E
?L7:	EQUAL? C,E \?L9
	INC 'MOVES
	RETURN FLG
?L9:	GET C,C-ENABLED? >STACK
	ZERO? STACK /?L15
	GET C,C-TICK >TICK
	ZERO? TICK /?L15
	SUB TICK,1 >STACK
	PUT C,C-TICK,STACK
	GRTR? TICK,1 /?L15
	GET C,C-RTN >STACK
	CALL STACK >STACK
	ZERO? STACK /?L15
	SET 'FLG,1
?L15:	ADD C,C-INTLEN >C
	JUMP ?L7

	.FUNCT ZPROB,BASE
	ZERO? LUCKY /?L1
	RANDOM 100 >STACK
	GRTR? BASE,STACK /TRUE
	RFALSE
?L1:	RANDOM 300 >STACK
	GRTR? BASE,STACK \FALSE
	RTRUE

	.FUNCT PICK-ONE,FROB
	GET FROB,0 >STACK
	RANDOM STACK >STACK
	GET FROB,STACK >STACK
	RSTACK

	.FUNCT ABS,NUM
	GRTR? NUM,0 \?L1
	RETURN NUM
?L1:	SUB 0,NUM >STACK
	RSTACK

	.FUNCT GO
START::
?L0:	CALL RANDOMIZE-HOLES
	CALL QUEUE,I-GINANDTONIC,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-PARACHUTE,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-GROWL,-1 >STACK
	PUT STACK,0,1
	REMOVE WATER
	SET 'LIT,1
	SET 'WINNER,ADVENTURER
	SET 'PLAYER,WINNER
	SET 'HERE,TENT
	SET 'P-IT-LOC,HERE
	SET 'P-IT-OBJECT,0
	FSET? HERE,TOUCHBIT /?L1
	PRINT START-STR
	CRLF
	CRLF
	CALL V-VERSION
	CRLF
?L1:	MOVE WINNER,COT
	CALL V-LOOK
	CALL MAIN-LOOP
	JUMP ?L0

	.FUNCT MAIN-LOOP,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP
?L1:	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	CALL PARSER >P-WON
	ZERO? P-WON /?L3
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	ZERO? OCNT \?L5
	SET 'NUM,OCNT
	JUMP ?L12
?L5:	GRTR? OCNT,1 \?L7
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L8
	SET 'OBJ,0
	JUMP ?L10
?L8:	GET P-PRSI,1 >OBJ
?L10:	SET 'NUM,OCNT
	JUMP ?L12
?L7:	GRTR? ICNT,1 \?L11
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L12
?L11:	SET 'NUM,1
?L12:	ZERO? OBJ \?L13
	EQUAL? ICNT,1 \?L13
	GET P-PRSI,1 >OBJ
?L13:	EQUAL? PRSA,V?WALK \?L16
	CALL PERFORM,PRSA,PRSO >V
	JUMP ?L50
?L16:	ZERO? NUM \?L18
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	ZERO? STACK \?L19
	CALL PERFORM,PRSA >V
	SET 'PRSO,0
	JUMP ?L50
?L19:	ZERO? LIT \?L21
	PRINTI "It's too dark to see."
	CRLF
	JUMP ?L50
?L21:	ZERO? OBJ /?L25
	FSET? OBJ,CONTBIT \?L32
	FSET? OBJ,OPENBIT /?L27
	PRINTI "Better open the "
	PRINTD OBJ
	PRINTI " first."
	CRLF
	CALL THIS-IS-IT,OBJ
	SET 'V,0
	JUMP ?L50
?L27:	FSET? OBJ,CONTBIT /?L31
?L32:	PRINTI "There's nothing in that."
	CRLF
	SET 'V,0
	JUMP ?L50
?L31:	PRINTI "It's not in that."
	CRLF
	SET 'V,0
	JUMP ?L50
?L25:	PRINTI "There isn't anything to "
	GET P-ITBL,P-VERBN >TMP
	ZERO? P-OFLAG /?L40
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L42
?L40:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L42:	PRINTI "!"
	CRLF
	SET 'V,0
	JUMP ?L50
?L18:	SET 'P-NOT-HERE,0
	SET 'P-MULT,0
	GRTR? NUM,1 \?L46
	SET 'P-MULT,1
?L46:	SET 'TMP,0
?L49:	IGRTR? 'CNT,NUM \?L51
	GRTR? P-NOT-HERE,0 \?L53
	PRINTI "The "
	EQUAL? P-NOT-HERE,NUM /?L57
	PRINTI "other "
?L57:	PRINTI "object"
	EQUAL? P-NOT-HERE,1 /?L64
	PRINTI "s"
?L64:	PRINTI " that you mentioned "
	EQUAL? P-NOT-HERE,1 /?L71
	PRINTI "are"
	JUMP ?L75
?L71:	PRINTI "is"
?L75:	PRINTI "n't here."
	CRLF
	JUMP ?L50
?L53:	ZERO? TMP \?L50
	PRINTI "I don't know what you're referring to."
	CRLF
	JUMP ?L50
?L51:	ZERO? PTBL /?L85
	GET P-PRSO,CNT >OBJ1
	JUMP ?L87
?L85:	GET P-PRSI,CNT >OBJ1
?L87:	ZERO? PTBL /?L88
	SET 'PRSO,OBJ1
	JUMP ?L90
?L88:	SET 'PRSO,OBJ
?L90:	ZERO? PTBL /?L91
	SET 'PRSI,OBJ
	JUMP ?L93
?L91:	SET 'PRSI,OBJ1
?L93:	EQUAL? PRSA,V?COMPARE /?L104
	GRTR? NUM,1 \?L104
	EQUAL? OBJ1,NOT-HERE-OBJECT \?L97
	INC 'P-NOT-HERE
	JUMP ?L49
?L97:	EQUAL? PRSA,V?TAKE \?L99
	ZERO? PRSI /?L99
	GET P-ITBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL \?L99
	IN? PRSO,PRSI \?L49
?L99:	EQUAL? P-GETFLAGS,P-ALL \?L103
	EQUAL? PRSA,V?TAKE \?L100
	LOC OBJ1 >STACK
	EQUAL? STACK,WINNER,HERE /?L102
	LOC OBJ1 >STACK
	FSET? STACK,TRANSBIT \?L49
?L102:	FSET? OBJ1,DONTTAKE /?L49
	EQUAL? OBJ1,PLASTER,PLASTER1 /?L49
?L100:	EQUAL? P-GETFLAGS,P-ALL \?L103
	EQUAL? PRSA,V?DROP \?L103
	IN? OBJ1,WINNER /?L103
	IN? P-IT-OBJECT,WINNER \?L49
?L103:	EQUAL? OBJ1,IT \?L105
	PRINTD P-IT-OBJECT
	JUMP ?L107
?L105:	PRINTD OBJ1
?L107:	PRINTI ": "
?L104:	SET 'TMP,1
	CALL PERFORM,PRSA,PRSO,PRSI >V
	EQUAL? V,M-FATAL \?L49
?L50:	EQUAL? V,M-FATAL /?L114
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-END >V
?L114:	EQUAL? PRSA,V?SAVE,V?WALK,V?AGAIN /?L120
	EQUAL? PRSA,V?VERSION,V?SCORE,V?RESTORE /?L120
	EQUAL? PRSA,V?WAIT /?L120
	SET 'L-PRSA,PRSA
	SET 'L-PRSO,PRSO
	SET 'L-PRSI,PRSI
?L120:	EQUAL? V,M-FATAL \?L124
	SET 'P-CONT,0
	JUMP ?L124
?L3:	SET 'P-CONT,0
?L124:	ZERO? P-WON /?L1
	EQUAL? PRSA,V?SUPER-BRIEF,V?BRIEF,V?TELL /?L1
	EQUAL? PRSA,V?VERSION,V?SAVE,V?VERBOSE /?L1
	CALL CLOCKER >V
	JUMP ?L1

	.FUNCT PERFORM,A,O=0,I=0,V,OA,OO,OI
	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	EQUAL? IT,I,O \?L1
	EQUAL? P-IT-LOC,HERE /?L1
	PRINTI "I don't see what you are referring to."
	CRLF
	RETURN 2
?L1:	EQUAL? O,IT \?L8
	SET 'O,P-IT-OBJECT
?L8:	EQUAL? I,IT \?L11
	SET 'I,P-IT-OBJECT
?L11:	SET 'PRSA,A
	SET 'PRSO,O
	ZERO? PRSO /?L14
	EQUAL? PRSI,IT /?L14
	EQUAL? PRSA,V?WALK /?L14
	SET 'P-IT-OBJECT,PRSO
	SET 'P-IT-LOC,HERE
?L14:	SET 'PRSI,I
	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \?L17
	CALL NOT-HERE-OBJECT-F >V
	ZERO? V /?L17
	SET 'P-WON,0
	JUMP ?L27
?L17:	SET 'O,PRSO
	SET 'I,PRSI
	GETP WINNER,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L27
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-BEG >V
	ZERO? V \?L27
	GET PREACTIONS,A >STACK
	CALL STACK >V
	ZERO? V \?L27
	ZERO? I /?L24
	GETP I,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L27
?L24:	ZERO? O /?L26
	EQUAL? A,V?WALK /?L25
	LOC O >STACK
	ZERO? STACK /?L25
	LOC O >STACK
	GETP STACK,P?CONTFCN >STACK
	CALL STACK >V
	ZERO? V \?L27
?L25:	ZERO? O /?L26
	EQUAL? A,V?WALK /?L26
	GETP O,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L27
?L26:	GET ACTIONS,A >STACK
	CALL STACK >V
	ZERO? V /?L27
?L27:	EQUAL? V,M-FATAL /?L29
	LOC WINNER >STACK
	EQUAL? STACK,PRSO \?L31
	SET 'PRSO,0
?L31:	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-END >V
?L29:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT PARSER,PTR=P-LEXSTART,WRD,VAL=0,VERB=0,LEN,DIR=0,NW=0,LW=0,NUM,SCNT,CNT=-1
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'P-ADVERB,0
	SET 'P-MERGED,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	ZERO? QUOTE-FLAG \?L8
	EQUAL? WINNER,ADVENTURER /?L8
	SET 'WINNER,ADVENTURER
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L8
	LOC WINNER >HERE
?L8:	ZERO? P-CONT /?L12
	SET 'PTR,P-CONT
	ZERO? SUPER-BRIEF \?L14
	EQUAL? PLAYER,WINNER \?L14
	CRLF
?L14:	SET 'P-CONT,0
	JUMP ?L17
?L12:	SET 'WINNER,ADVENTURER
	SET 'QUOTE-FLAG,0
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L18
	LOC WINNER >HERE
?L18:	ZERO? SUPER-BRIEF \?L21
	CRLF
?L21:	PRINTI ">"
	READ P-INBUF,P-LEXV
?L17:	GETB P-LEXV,P-LEXWORDS >P-LEN
	ZERO? P-LEN \?L26
	PRINTI "I beg your pardon?"
	CRLF
	RFALSE
?L26:	SET 'LEN,P-LEN
	SET 'P-DIR,0
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
?L31:	DLESS? 'P-LEN,0 \?L33
	SET 'QUOTE-FLAG,0
	JUMP ?L32
?L33:	GET P-LEXV,PTR >WRD
	ZERO? WRD \?L36
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L35
?L36:	EQUAL? WRD,W?TO \?L37
	EQUAL? VERB,ACT?TELL \?L37
	SET 'WRD,W?$QUOTE
	JUMP ?L39
?L37:	EQUAL? WRD,W?THEN \?L39
	ZERO? VERB \?L39
	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WRD,W?$QUOTE
?L39:	EQUAL? WRD,W?THEN,W?$PERIOD /?L43
	EQUAL? WRD,W?$QUOTE \?L41
?L43:	EQUAL? WRD,W?$QUOTE \?L48
	ZERO? QUOTE-FLAG /?L46
	SET 'QUOTE-FLAG,0
	JUMP ?L48
?L46:	SET 'QUOTE-FLAG,1
?L48:	ZERO? P-LEN /?L50
	ADD PTR,P-LEXELEN >P-CONT
?L50:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L32
?L41:	CALL WT?,WRD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L52
	EQUAL? VERB,0,ACT?WALK \?L52
	EQUAL? LEN,1 /?L53
	EQUAL? LEN,2 \?L54
	EQUAL? VERB,ACT?WALK /?L53
?L54:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
	EQUAL? NW,W?THEN,W?$PERIOD,W?$QUOTE \?L55
	LESS? LEN,2 \?L53
?L55:	ZERO? QUOTE-FLAG /?L56
	EQUAL? LEN,2 \?L56
	EQUAL? NW,W?$QUOTE /?L53
?L56:	GRTR? LEN,2 \?L52
	EQUAL? NW,W?$COMMA,W?AND \?L52
?L53:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L57
	ADD PTR,P-LEXELEN >STACK
	PUT P-LEXV,STACK,W?THEN
?L57:	GRTR? LEN,2 /?L85
	SET 'QUOTE-FLAG,0
	JUMP ?L32
?L52:	CALL WT?,WRD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L63
	ZERO? VERB \?L63
	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WRD
	MUL PTR,2 >STACK
	ADD STACK,2 >NUM
	GETB P-LEXV,NUM >STACK
	PUTB P-VTBL,2,STACK
	ADD NUM,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L85
?L63:	CALL WT?,WRD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L65
	EQUAL? WRD,W?ALL,W?ONE,W?A /?L66
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L66
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L64
?L66:	SET 'VAL,0
?L65:	GRTR? P-LEN,0 \?L67
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?OF \?L67
	ZERO? VAL \?L95
	EQUAL? WRD,W?ALL,W?ONE,W?A \?L85
?L67:	ZERO? VAL /?L69
?L95:	ZERO? P-LEN /?L70
	ADD PTR,2 >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?THEN,W?$PERIOD \?L69
?L70:	LESS? P-NCN,2 \?L85
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WRD
	JUMP ?L85
?L69:	EQUAL? P-NCN,2 \?L74
	PRINTI "I found too many nouns in that sentence."
	CRLF
	RFALSE
?L74:	INC 'P-NCN
	CALL CLAUSE,PTR,VAL,WRD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L85
	SET 'QUOTE-FLAG,0
	JUMP ?L32
?L64:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L85
	CALL CANT-USE,PTR
	RFALSE
?L35:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L85:	SET 'LW,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L31
?L32:	ZERO? DIR /?L86
	SET 'PRSA,V?WALK
	SET 'PRSO,DIR
	SET 'P-WALK-DIR,DIR
	RTRUE
?L86:	SET 'P-WALK-DIR,0
	ZERO? P-OFLAG /?L89
	CALL ORPHAN-MERGE
?L89:	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT WT?,PTR,BIT,B1=5,OFFS=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L6
	INC 'OFFS
?L6:	GETB PTR,OFFS >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WRD,OFF,NUM,ANDFLG=0,FIRST??=1,NW,LW=0
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L1
	ADD P-PREP1,OFF >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'P-LEN
?L3:	ZERO? P-LEN \?L4
	DEC 'P-NCN
	RETURN -1
?L4:	ADD P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L7
	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
?L7:	DLESS? 'P-LEN,0 \?L12
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L12:	GET P-LEXV,PTR >WRD
	ZERO? WRD \?L17
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L15
?L17:	ZERO? P-LEN \?L18
	SET 'NW,0
	JUMP ?L20
?L18:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L20:	EQUAL? WRD,W?AND,W?$COMMA \?L21
	SET 'ANDFLG,1
	JUMP ?L40
?L21:	EQUAL? WRD,W?ALL,W?ONE \?L23
	EQUAL? NW,W?OF \?L40
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L40
?L23:	EQUAL? WRD,W?THEN,W?$PERIOD /?L28
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L27
	ZERO? FIRST?? \?L27
?L28:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L27:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L29
	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L30
	ZERO? NW /?L30
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L40
?L30:	ZERO? ANDFLG \?L32
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L32
	EQUAL? NW,W?$COMMA /?L32
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L32:	SET 'ANDFLG,0
	JUMP ?L40
?L29:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L40
	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L40
	ZERO? ANDFLG /?L36
	CALL WT?,WRD,PS?DIRECTION >STACK
	ZERO? STACK \?L37
	CALL WT?,WRD,PS?VERB >STACK
	ZERO? STACK /?L36
?L37:	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	PUT P-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L40
?L36:	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK \?L40
	CALL CANT-USE,PTR
	RFALSE
?L15:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L40:	SET 'LW,WRD
	SET 'FIRST??,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0,TIM=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L1:	DLESS? 'CNT,0 /?L2
	GETB P-INBUF,BPTR >CHR
	EQUAL? CHR,58 \?L6
	SET 'TIM,SUM
	SET 'SUM,0
	JUMP ?L10
?L6:	GRTR? SUM,10000 /FALSE
	LESS? CHR,58 \FALSE
	GRTR? CHR,47 \FALSE
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
?L10:	INC 'BPTR
	JUMP ?L1
?L2:	PUT P-LEXV,PTR,W?INTNUM
	GRTR? SUM,1000 /FALSE
	ZERO? TIM /?L13
	LESS? TIM,8 \?L14
	ADD TIM,12 >TIM
	JUMP ?L16
?L14:	GRTR? TIM,23 /FALSE
?L16:	MUL TIM,60 >STACK
	ADD SUM,STACK >SUM
?L13:	SET 'P-NUMBER,SUM
	RETURN W?INTNUM

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,WRD
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L1
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L1:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L4
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP1 >STACK
	EQUAL? TEMP,STACK /?L7
	ZERO? TEMP \FALSE
?L7:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L19
?L4:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L9
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP2 >STACK
	EQUAL? TEMP,STACK /?L12
	ZERO? TEMP \FALSE
?L12:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L19
?L9:	ZERO? P-ACLAUSE /?L19
	EQUAL? P-NCN,1 /?L15
	SET 'P-ACLAUSE,0
	RFALSE
?L15:	GET P-ITBL,P-NC1 >BEG
	GET P-ITBL,P-NC1L >END
?L18:	EQUAL? BEG,END \?L20
	ZERO? ADJ /?L22
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L19
?L22:	SET 'P-ACLAUSE,0
	RFALSE
?L20:	ZERO? ADJ \?L25
	GET BEG,0 >WRD
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE \?L25
	SET 'ADJ,WRD
	JUMP ?L30
?L25:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT /?L27
	EQUAL? WRD,W?ONE \?L30
?L27:	EQUAL? WRD,P-ANAM,W?ONE \FALSE
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L19
?L30:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L18
?L19:	IGRTR? 'CNT,P-ITBLLEN \?L35
	SET 'P-MERGED,1
	RTRUE
?L35:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L19

	.FUNCT ACLAUSE-WIN,ADJ
	SET 'P-CCSRC,P-OTBL
	ADD P-ACLAUSE,1 >STACK
	CALL CLAUSE-COPY,P-ACLAUSE,STACK,ADJ
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'P-NCN,2
?L1:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,?TMP
	PRINTI "I don't know the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI """."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT CANT-USE,PTR,BUF,?TMP
	PRINTI "I can't use the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI """ here."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB,TMP
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	PRINTI "I can't find a verb in that sentence!"
	CRLF
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L6:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	GRTR? P-NCN,NUM /?L15
	LESS? NUM,1 /?L10
	ZERO? P-NCN \?L10
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L11
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L10
?L11:	SET 'DRIVE1,SYN
	JUMP ?L15
?L10:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L15
	EQUAL? NUM,2 \?L13
	EQUAL? P-NCN,1 \?L13
	SET 'DRIVE2,SYN
	JUMP ?L15
?L13:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L15
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L15:	DLESS? 'LEN,1 \?L18
	ZERO? DRIVE1 \?L50
	ZERO? DRIVE2 \?L7
	PRINTI "I don't understand that sentence."
	CRLF
	RFALSE
?L18:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L6
?L7:	ZERO? DRIVE1 /?L27
?L50:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L27
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L27:	ZERO? DRIVE2 /?L29
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L29
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L29:	EQUAL? VERB,ACT?FIND \?L30
	PRINTI "I can't answer that question."
	CRLF
	RFALSE
?L30:	CALL ORPHAN,DRIVE1,DRIVE2
	PRINTI "What do you want to "
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L36
	PRINTI "tell"
	JUMP ?L41
?L36:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L40
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L41
?L40:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L41:	ZERO? DRIVE2 /?L42
	CALL CLAUSE-PRINT,P-NC1,P-NC1L
?L42:	SET 'P-OFLAG,1
	ZERO? DRIVE1 /?L45
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L47
?L45:	GETB DRIVE2,P-SPREP2 >STACK
?L47:	CALL PREP-PRINT,STACK
	PRINTI "?"
	CRLF
	RFALSE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	PUT P-OCLAUSE,P-MATCHLEN,0
	SET 'P-CCSRC,P-ITBL
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L1
?L2:	EQUAL? P-NCN,2 \?L6
	CALL CLAUSE-COPY,P-NC2,P-NC2L
?L6:	LESS? P-NCN,1 /?L9
	CALL CLAUSE-COPY,P-NC1,P-NC1L
?L9:	ZERO? D1 /?L12
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L12:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT CLAUSE-PRINT,BPTR,EPTR,THE?=1
	GET P-ITBL,EPTR >STACK
	GET P-ITBL,BPTR >STACK
	CALL BUFFER-PRINT,STACK,STACK,THE? >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=0,WRD,FIRST??=1,PN=0
?L1:	EQUAL? BEG,END /TRUE
	ZERO? NOSP /?L6
	SET 'NOSP,0
	JUMP ?L8
?L6:	PRINTI " "
?L8:	GET BEG,0 >WRD
	EQUAL? WRD,W?$PERIOD \?L11
	SET 'NOSP,1
	JUMP ?L13
?L11:	ZERO? FIRST?? /?L14
	ZERO? PN \?L14
	ZERO? CP /?L14
	PRINTI "the "
?L14:	ZERO? P-OFLAG /?L19
	PRINTB WRD
	JUMP ?L22
?L19:	EQUAL? WRD,W?IT \?L21
	EQUAL? P-IT-LOC,HERE \?L21
	PRINTD P-IT-OBJECT
	JUMP ?L22
?L21:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L22:	SET 'FIRST??,0
?L13:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CAPITALIZE,PTR
	GETB PTR,3 >STACK
	GETB P-INBUF,STACK >STACK
	SUB STACK,32 >STACK
	PRINTC STACK
	GETB PTR,3 >STACK
	INC 'STACK
	GETB PTR,2 >STACK
	DEC 'STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT PREP-PRINT,PREP,WRD
	ZERO? PREP /FALSE
	PRINTI " "
	CALL PREP-FIND,PREP >WRD
	PRINTB WRD
	RTRUE

	.FUNCT CLAUSE-COPY,BPTR,EPTR,INSRT=0,BEG,END
	GET P-CCSRC,BPTR >BEG
	GET P-CCSRC,EPTR >END
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	PUT P-OTBL,BPTR,STACK
?L1:	EQUAL? BEG,END \?L3
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	PUT P-OTBL,EPTR,STACK
	RTRUE
?L3:	ZERO? INSRT /?L6
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L6
	CALL CLAUSE-ADD,INSRT
?L6:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CLAUSE-ADD,WRD,PTR
	GET P-OCLAUSE,P-MATCHLEN >STACK
	ADD STACK,2 >PTR
	SUB PTR,1 >STACK
	PUT P-OCLAUSE,STACK,WRD
	PUT P-OCLAUSE,PTR,0
	PUT P-OCLAUSE,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-FIND,PREP,CNT=0,SIZE
	GET PREPOSITIONS,0 >STACK
	MUL STACK,2 >SIZE
?L1:	IGRTR? 'CNT,SIZE /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L1
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ
	EQUAL? GBIT,RMUNGBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	PRINTI "("
	ZERO? PREP /?L12
	CALL PREP-FIND,PREP >STACK
	PRINTB STACK
	PRINTI " the "
?L12:	PRINTD OBJ
	PRINTI ")"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,PTR
	GET P-ITBL,P-NC1 >PTR
	ZERO? PTR /?L5
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /?L5
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L5:	GET P-ITBL,P-NC2 >PTR
	ZERO? PTR /TRUE
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSI,P-MATCHLEN >STACK
	EQUAL? STACK,1 \?L14
	CALL BUT-MERGE,P-PRSO >P-PRSO
	RTRUE
?L14:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES?1=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES?1,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES?1
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES?1
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,BUT=0,LEN,WV,WRD,NW
	SET 'P-GETFLAGS,0
	SET 'P-CSPTR,PTR
	SET 'P-CEPTR,EPTR
	PUT P-BUTS,P-MATCHLEN,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WRD
?L1:	EQUAL? PTR,EPTR \?L3
?L48:	ZERO? BUT /?L6
	PUSH BUT
	JUMP ?L5
?L6:	PUSH TBL
?L5:	CALL GET-OBJECT,STACK >STACK
	RSTACK
?L3:	GET PTR,P-LEXELEN >NW
	EQUAL? WRD,W?ALL \?L8
	SET 'P-GETFLAGS,P-ALL
	EQUAL? NW,W?OF \?L43
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L43
?L8:	EQUAL? WRD,W?BUT,W?EXCEPT \?L13
	ZERO? BUT /?L17
	PUSH BUT
	JUMP ?L16
?L17:	PUSH TBL
?L16:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,P-BUTS
	PUT BUT,P-MATCHLEN,0
	JUMP ?L43
?L13:	EQUAL? WRD,W?A,W?ONE \?L18
	ZERO? P-ADJ \?L19
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L43
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L43
?L19:	SET 'P-NAM,P-ONEOBJ
	ZERO? BUT /?L28
	PUSH BUT
	JUMP ?L27
?L28:	PUSH TBL
?L27:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L43
?L18:	EQUAL? WRD,W?AND,W?$COMMA \?L31
	EQUAL? NW,W?AND,W?$COMMA /?L31
	ZERO? BUT /?L35
	PUSH BUT
	JUMP ?L34
?L35:	PUSH TBL
?L34:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L43
?L31:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L43
	EQUAL? WRD,W?AND,W?$COMMA /?L43
	EQUAL? WRD,W?OF \?L38
	ZERO? P-GETFLAGS \?L43
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L43
?L38:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L42
	ZERO? P-ADJ \?L42
	SET 'P-ADJ,WV
	SET 'P-ADJN,WRD
	JUMP ?L43
?L42:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L43
	SET 'P-NAM,WRD
	SET 'P-ONEOBJ,WRD
?L43:	EQUAL? PTR,EPTR /?L48
	ADD PTR,P-WORDLEN >PTR
	SET 'WRD,NW
	JUMP ?L1

	.FUNCT GET-OBJECT,TBL,VRB=1,BTS,LEN,XBITS,TLEN,GCHECK=0,OLEN=0,OBJ
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	ZERO? P-NAM \?L11
	ZERO? P-ADJ /?L8
	CALL WT?,P-ADJN,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L6
	SET 'P-NAM,P-ADJN
	SET 'P-ADJ,0
	JUMP ?L8
?L6:	CALL WT?,P-ADJN,PS?DIRECTION,P1?DIRECTION >BTS
	ZERO? BTS /?L8
	SET 'P-ADJ,0
	PUT TBL,P-MATCHLEN,1
	PUT TBL,1,INTDIR
	SET 'P-DIRECTION,BTS
	RTRUE
?L8:	ZERO? P-NAM \?L11
	ZERO? P-ADJ \?L11
	EQUAL? P-GETFLAGS,P-ALL /?L77
	ZERO? P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	PRINTI "I think that sentence was missing a noun."
	CRLF
	RFALSE
?L11:	EQUAL? P-GETFLAGS,P-ALL \?L21
?L77:	ZERO? P-SLOCBITS \?L19
?L21:	SET 'P-SLOCBITS,-1
?L19:	SET 'P-TABLE,TBL
?L23:	ZERO? GCHECK /?L25
	CALL GLOBAL-CHECK,TBL
	JUMP ?L31
?L25:	ZERO? LIT /?L28
	CALL DO-SL,HERE,SOG,SIR
?L28:	CALL DO-SL,WINNER,SH,SC
	EQUAL? WINNER,PLAYER /?L31
	CALL DO-SL,PLAYER,SH,SC
?L31:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL /?L75
	BTST P-GETFLAGS,P-ONE \?L36
	ZERO? LEN /?L36
	EQUAL? LEN,1 /?L37
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "(How about the "
	GET TBL,1 >STACK
	PRINTD STACK
	PRINTI "?)"
	CRLF
?L37:	PUT TBL,P-MATCHLEN,1
	JUMP ?L75
?L36:	GRTR? LEN,1 /?L45
	ZERO? LEN \?L75
	EQUAL? P-SLOCBITS,-1 /?L44
?L45:	EQUAL? P-SLOCBITS,-1 \?L46
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L23
?L46:	ZERO? LEN \?L49
	SET 'LEN,OLEN
?L49:	ZERO? P-NAM /?L52
	EQUAL? PRSA,V?LAMP-ON,V?TAKE,V?EXAMINE /?L54
	EQUAL? PRSA,V?FIND,V?DROP,V?BURN \?L52
?L54:	ADD TLEN,1 >STACK
	GET TBL,STACK >OBJ
	ZERO? OBJ /?L52
	GETP OBJ,P?GENERIC >STACK
	CALL STACK,OBJ >OBJ
	ZERO? OBJ /?L52
	PUT TBL,1,OBJ
	PUT TBL,P-MATCHLEN,1
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE
?L52:	ZERO? VRB /?L59
	ZERO? P-NAM /?L55
	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L56
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L58
?L56:	SET 'P-ACLAUSE,P-NC2
?L58:	SET 'P-AADJ,P-ADJ
	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L59
?L55:	ZERO? VRB /?L59
	PRINTI "I couldn't find enough nouns in that sentence!"
	CRLF
?L59:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L44:	ZERO? LEN \?L75
	ZERO? GCHECK /?L63
	ZERO? VRB /?L71
	EQUAL? WINNER,PLAYER /?L66
	PRINTI """I can't see that here!"""
	CRLF
	JUMP ?L71
?L66:	ZERO? LIT /?L70
	CALL OBJ-FOUND,NOT-HERE-OBJECT,TBL
	SET 'P-XNAM,P-NAM
	SET 'P-XADJ,P-ADJ
	SET 'P-XADJN,P-ADJN
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	RTRUE
?L70:	PRINTI "It's too dark to see!"
	CRLF
?L71:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L63:	ZERO? LEN \?L75
	SET 'GCHECK,1
	JUMP ?L23
?L75:	SET 'P-ADJ,0
	SET 'P-NAM,0
	SET 'P-SLOCBITS,XBITS
	RTRUE

	.FUNCT MOBY-FIND,TBL,FOO,LEN
	SET 'P-SLOCBITS,-1
	SET 'P-NAM,P-XNAM
	SET 'P-ADJ,P-XADJ
	PUT TBL,P-MATCHLEN,0
	FIRST? ROOMS >FOO \?L3
?L4:	CALL SEARCH-LIST,FOO,TBL,P-SRCALL
	NEXT? FOO >FOO /?L4
?L3:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L8
	CALL DO-SL,LOCAL-GLOBALS,1,1
?L8:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L11
	CALL DO-SL,ROOMS,1,1
?L11:	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L14
	GET TBL,1 >P-MOBY-FOUND
?L14:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RETURN LEN

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	SET 'RLEN,LEN
	PRINTI "Which"
	ZERO? P-OFLAG \?L5
	ZERO? P-MERGED /?L3
?L5:	PRINTI " "
	PRINTB P-NAM
	JUMP ?L9
?L3:	EQUAL? TBL,P-PRSO \?L8
	CALL CLAUSE-PRINT,P-NC1,P-NC1L,0
	JUMP ?L9
?L8:	CALL CLAUSE-PRINT,P-NC2,P-NC2L,0
?L9:	PRINTI " do you mean, "
?L12:	INC 'TLEN
	GET TBL,TLEN >OBJ
	PRINTI "the "
	PRINTD OBJ
	EQUAL? LEN,2 \?L16
	EQUAL? RLEN,2 /?L18
	PRINTI ","
?L18:	PRINTI " or "
	JUMP ?L25
?L16:	GRTR? LEN,2 \?L25
	PRINTI ", "
?L25:	DLESS? 'LEN,1 \?L12
	PRINTR "?"

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS,FOO
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETPT HERE,P?PSEUDO >RMG
	ZERO? RMG /?L15
	PTSIZE RMG >STACK
	DIV STACK,4 >STACK
	SUB STACK,1 >RMGL
	SET 'CNT,0
?L14:	MUL CNT,2 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L16
	MUL CNT,2 >STACK
	INC 'STACK
	GET RMG,STACK >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	GETPT PSEUDO-OBJECT,P?ACTION >STACK
	SUB STACK,5 >FOO
	GET P-NAM,0 >STACK
	PUT FOO,0,STACK
	GET P-NAM,1 >STACK
	PUT FOO,1,STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L15
?L16:	IGRTR? 'CNT,RMGL \?L14
?L15:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	GET TBL,P-MATCHLEN >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?LOOK-INSIDE,V?SEARCH,V?EXAMINE \FALSE
	CALL DO-SL,ROOMS,1,1 >STACK
	RSTACK

	.FUNCT DO-SL,OBJ,BIT1,BIT2,BTS
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL,FLS,NOBJ
	FIRST? OBJ >OBJ \FALSE
?L3:	EQUAL? LVL,P-SRCBOT /?L5
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L5
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	EQUAL? LVL,P-SRCTOP \?L10
	FSET? OBJ,SEARCHBIT /?L10
	FSET? OBJ,SURFACEBIT \?L8
?L10:	FIRST? OBJ >NOBJ \?L8
	FSET? OBJ,OPENBIT \?L8
	FSET? OBJ,SURFACEBIT \?L11
	PUSH P-SRCALL
	JUMP ?L14
?L11:	FSET? OBJ,SEARCHBIT \?L13
	PUSH P-SRCALL
	JUMP ?L14
?L13:	PUSH P-SRCTOP
?L14:	CALL SEARCH-LIST,OBJ,TBL,STACK >FLS
?L8:	NEXT? OBJ >OBJ /?L3
	RTRUE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,BTS,PTR,OBJ,TAKEN
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST BTS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L8
	SET 'OBJ,P-IT-OBJECT
?L8:	IN? OBJ,WINNER /?L3
	SET 'PRSO,OBJ
	FSET? OBJ,TRYTAKEBIT \?L13
	SET 'TAKEN,1
	JUMP ?L16
?L13:	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \?L15
	SET 'TAKEN,0
	JUMP ?L16
?L15:	SET 'TAKEN,1
?L16:	ZERO? TAKEN /?L22
	BTST BTS,SHAVE \?L17
	PRINTI "You don't have that."
	CRLF
	RFALSE
?L17:	ZERO? TAKEN \?L3
?L22:	PRINTI "(Taken)"
	CRLF
	JUMP ?L3

	.FUNCT MANY-CHECK,LOSS=0,TMP
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	PRINTI "I can't use multiple "
	EQUAL? LOSS,2 \?L9
	PRINTI "in"
?L9:	PRINTI "direct objects with """
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L16
	PRINTI "tell"
	JUMP ?L21
?L16:	ZERO? P-OFLAG /?L20
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L21
?L20:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L21:	PRINTI """."
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT LIT?,RM,OHERE,LIT?1=0
	SET 'P-GWIMBIT,ONBIT
	SET 'OHERE,HERE
	SET 'HERE,RM
	FSET? RM,ONBIT \?L1
	SET 'LIT?1,1
	JUMP ?L7
?L1:	PUT P-MERGE,P-MATCHLEN,0
	SET 'P-TABLE,P-MERGE
	SET 'P-SLOCBITS,-1
	EQUAL? OHERE,RM \?L4
	CALL DO-SL,WINNER,1,1
?L4:	CALL DO-SL,RM,1,1
	GET P-TABLE,P-MATCHLEN >STACK
	GRTR? STACK,0 \?L7
	SET 'LIT?1,1
?L7:	SET 'HERE,OHERE
	SET 'P-GWIMBIT,0
	RETURN LIT?1

	.FUNCT PRSO-PRINT,PTR
	ZERO? P-MERGED \?L3
	GET P-ITBL,P-NC1 >PTR
	GET PTR,0 >STACK
	EQUAL? STACK,W?IT \?L1
?L3:	PRINTI " "
	PRINTD PRSO
	RTRUE
?L1:	GET P-ITBL,P-NC1L >STACK
	CALL BUFFER-PRINT,PTR,STACK,0 >STACK
	RSTACK

	.FUNCT PRSI-PRINT,PTR
	ZERO? P-MERGED \?L3
	GET P-ITBL,P-NC2 >PTR
	GET PTR,0 >STACK
	EQUAL? STACK,W?IT \?L1
?L3:	PRINTI " "
	PRINTD PRSI
	RTRUE
?L1:	GET P-ITBL,P-NC2L >STACK
	CALL BUFFER-PRINT,PTR,STACK,0 >STACK
	RSTACK

	.FUNCT FINGER-FCN
	EQUAL? PRSA,V?PUT-ON \?L1
	EQUAL? PRSI,FINGER \?L1
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	FSET? RING,WEARBIT \?L4
	PRINTR "Sitting on your finger is a ring."
?L4:	PRINTR "It's part of your hands."

	.FUNCT AIR-FCN
	EQUAL? PRSA,V?TASTE,V?SMELL,V?EXAMINE \?L1
	GETP HERE,P?MAP >STACK
	ZERO? STACK \FALSE
	PRINTR "It's stale and musty"
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L8
	PRINTR "I think you're an air head."
?L8:	EQUAL? PRSI,AIR \?L12
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L11
	CALL PERFORM,V?LOOK-UP
	RTRUE
?L11:	EQUAL? PRSI,AIR \?L12
	EQUAL? PRSA,V?DROP,V?THROW \?L12
	CALL PERFORM,PRSA,PRSO,GROUND
	RTRUE
?L12:	EQUAL? PRSA,V?WAVE \FALSE
	EQUAL? PRSO,AIR \FALSE
	PRINTR "Don't expect me to tell you the sky waves back."

	.FUNCT READ-FLOOR-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	EQUAL? HERE,CENTRAL-ROOM \FALSE
	CALL PERFORM,V?READ,HIEROGLYPHS
	RTRUE

	.FUNCT CRACK-FCN
	GETP HERE,P?MAP >STACK
	ZERO? STACK \?L3
	GETP HERE,P?ACTION >STACK
	EQUAL? STACK,BURN-THE-BARGE /?L3
	EQUAL? HERE,WEST-END-OF-PASSAGE \?L1
	FSET? PIT,INVISIBLE /?L1
?L3:	PRINTR "I see no crack here."
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L6
	CALL HOW?,PRSO
	RTRUE
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "Get real. There's nothing worth looking at in there."

	.FUNCT HOLE-FCN
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	EQUAL? HERE,P8 \?L3
	IN? PYRAMID,HERE \?L3
	PRINTR "You can see the block and the opening in there."
?L3:	GETP HERE,P?CAPACITY >STACK
	GRTR? STACK,0 \?L7
	PRINTR "Never mind that -- Here's a better problem: You dig a hole 52 feet by 20 feet by .105 yards. It takes you 5 hours, 11 minutes and 2 seconds. You sweat off thirty grams of water per hour. And your best friend just ran off with the rent money. Now: How much sand is in the hole you dug?"
?L7:	PRINTR "I don't see any hole here."
?L1:	EQUAL? PRSA,V?FIND \?L13
	GETP HERE,P?CAPACITY >STACK
	ZERO? STACK /FALSE
	PRINTR "It's right here."
?L13:	EQUAL? PRSI,HOLE \FALSE
	EQUAL? PRSA,V?PUT \FALSE
	GETP HERE,P?CAPACITY >STACK
	ZERO? STACK /FALSE
	PRINTR "It's just a hole in the sand from your excavation attempts. There's no need to put anything into it."

	.FUNCT WALL-FCN,RMG,RMGL
	EQUAL? HERE,STAIRS-BOTTOM \?L1
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	IN? PLASTER1,STAIRS-BOTTOM \?L3
	CALL PERFORM,V?EXAMINE,PLASTER1
	RTRUE
?L3:	PRINTR "I see nothing special about the wall."
?L1:	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	CALL GLOBAL-IN?,HIEROGLYPHS,HERE >STACK
	ZERO? STACK /FALSE
	EQUAL? HERE,CENTRAL-ROOM /FALSE
	CALL PERFORM,V?READ,HIEROGLYPHS
	RTRUE

	.FUNCT READ-PALMS-F
	EQUAL? PRSA,V?READ \FALSE
	PRINTR "I don't read palms."

	.FUNCT CRETIN
	EQUAL? PRSO,WINNER,ME \FALSE
	EQUAL? PRSA,V?EAT \?L4
	PRINTR "I've heard of biting one's knuckles, chewing one's fingernails, but don't you think that's a little extreme?"
?L4:	EQUAL? PRSA,V?DRINK \?L8
	PRINTR "Find me a blender, jump in it, and once you're liquified, we'll talk."
?L8:	EQUAL? PRSA,V?ALARM \?L11
	PRINTR "Good morning!"
?L11:	EQUAL? PRSA,V?KILL,V?ATTACK,V?MUNG \?L14
	PRINTR "Hey, I know just how you feel. And I'm sure you think you deserve it -- I've been there myself. But take heart -- let nature take care of you. I'm sure it will, in time."
?L14:	EQUAL? PRSA,V?PRAY \?L17
	PRINTR "Save yourself. Don't look to me, man."
?L17:	EQUAL? PRSA,V?FIND \?L20
	PRINTR "Take a course in Zen."
?L20:	EQUAL? PRSA,V?TAKE \?L23
	PRINTR "Auto-eroticism is not the answer."
?L23:	EQUAL? PRSA,V?BURN \?L26
	PRINTR "Come on. Don't you have enough troubles?"
?L26:	EQUAL? PRSA,V?THROW,V?LOOK-INSIDE,V?EXAMINE \?L29
	PRINTR "Hmmm. How do you propose I accomplish that? (And they told me in AI school the intelligent creatures were on the other side of the keyboard!)"
?L29:	EQUAL? PRSA,V?RUB \?L32
	PRINTR "Go rub yourself. You're starting to rub me the wrong way."
?L32:	EQUAL? PRSA,V?PLAY \?L35
	PRINTR "Who do you think you're playing around with?"
?L35:	EQUAL? PRSA,V?BOARD,V?CLIMB-ON \?L38
	PRINTR "I'll get on your case is what I'll do, turkey."
?L38:	EQUAL? PRSA,V?CLEAN \?L41
	PRINTR "Take a bath. Leave me out of this."
?L41:	EQUAL? PRSA,V?CLOSE \?L44
	PRINTR "Better yet, close your mouth."
?L44:	EQUAL? PRSA,V?CROSS \?L47
	PRINTR "Crossed and double-crossed, sucker."
?L47:	EQUAL? PRSA,V?DISEMBARK \?L50
	PRINTR "What makes you think you deserve it?"
?L50:	EQUAL? PRSA,V?DROP \?L53
	PRINTR "Like a hot potato."
?L53:	EQUAL? PRSA,V?OPEN,V?LEAN-ON \?L56
	PRINTR "I think you've got enough troubles."
?L56:	EQUAL? PRSA,V?FOLLOW \?L59
	PRINTR "What makes you think you know where you're going?"
?L59:	EQUAL? PRSA,V?LISTEN \?L62
	PRINTR "Do I have a choice?"
?L62:	EQUAL? PRSA,V?SEARCH \?L65
	PRINTR "Okay. I found one empty head but a strong heart."
?L65:	EQUAL? PRSA,V?MAKE \?L68
	PRINTR "I doubt anyone could make you do anything with that attitude."
?L68:	EQUAL? PRSA,V?SHAKE \?L71
	PRINTR "Shake, rattle and roll."
?L71:	EQUAL? PRSA,V?SMELL \?L74
	PRINTR "Phew! When was the last time you bathed?"
?L74:	EQUAL? PRSA,V?SQUEEZE \?L77
	PRINTR "Like a python, eh?"
?L77:	EQUAL? PRSA,V?THROW \?L80
	PRINTR "For a loop?"
?L80:	EQUAL? PRSA,V?WEAR \FALSE
	PRINTR "How many layers of skin does one human need?"

	.FUNCT DOORWAY-FCN
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	EQUAL? HERE,NORTH-ANTECHAMBER,BURIAL-CHAMBER \?L3
	EQUAL? BEAM-PLACED,4 \?L3
	PRINTR "The mast is in the doorway, running from top to bottom."
?L3:	EQUAL? HERE,SOUTH-ANTECHAMBER,ANNEX \FALSE
	EQUAL? BEAM-PLACED,2,3 \FALSE
	PRINTR "The beam is wedged in the doorway from side to side."

	.FUNCT PANEL-ON-WALL-FCN
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	PRINTI "The panels are beautiful pieces of art, to be appreciated by the Queen on her journey through the Netherworld."
	CRLF
	CALL GLOBAL-IN?,HIEROGLYPHS,HERE >STACK
	ZERO? STACK /TRUE
	CALL PERFORM,V?READ,HIEROGLYPHS
	RTRUE

	.FUNCT DESC-STAIRS-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	EQUAL? HERE,AFT-CABIN,BELOW-DECK \FALSE
	PRINTR "The ladder is made of wood, and it looks fairly sturdy."

	.FUNCT PLANE-FCN
	EQUAL? PRSA,V?WAVE \?L1
	LESS? MOVES,8 \?L7
	CALL IN-A-TENT? >STACK
	ZERO? STACK \?L3
	PRINTR "The plane dips its wings in salute."
?L3:	LESS? MOVES,8 \?L7
	PRINTR "You wave at the plane through the top of the tent. Somehow, I doubt it noticed."
?L7:	PRINTR "The plane's returned to its home base."
?L1:	EQUAL? PRSA,V?FIND \?L13
	GRTR? MOVES,8 \?L14
	PRINTR "I suppose it's up in the air, somewhere."
?L14:	PRINTR "It's somewhere up over your head."
?L13:	EQUAL? PRSA,V?EXAMINE \?L21
	CALL IN-A-TENT? >STACK
	ZERO? STACK \?L22
	LESS? MOVES,8 \?L24
	RFALSE
?L22:	LESS? MOVES,8 \?L24
	PRINTR "All I can tell you about it is that it's out there."
?L24:	PRINTR "The plane's far gone, amigo."
?L21:	EQUAL? PRSA,V?LISTEN \?L30
	LESS? MOVES,9 \?L30
	PRINTR "RRRRRRRrrrrrrr r r r r r   r    r     r."
?L30:	GRTR? MOVES,8 \?L34
	PRINTR "What plane? It's gone!"
?L34:	PRINTR "Leave the plane alone. It's not bothering you."

	.FUNCT GOOD-LUCK-FCN
	EQUAL? PRSA,V?FIND \?L1
	LESS? MOVES,8 \?L3
	PRINTR "Look up!"
?L3:	PRINTR "It's gone with the wind, never to be seen again."
?L1:	EQUAL? PRSA,V?EXAMINE \?L10
	GRTR? MOVES,4 \?L11
	LESS? MOVES,8 \?L11
	PRINTR "It's white."
?L11:	LESS? MOVES,5 \?L15
	PRINTR "What parachute?"
?L15:	PRINTR "The most I can tell you is that it was white."
?L10:	EQUAL? PRSA,V?STAND-UNDER /FALSE
	GRTR? MOVES,7 \?L23
	PRINTR "Forget the chute, amigo. It's history. And if you don't get on with this, you will be too."
?L23:	PRINTR "Leave the parachute alone."

	.FUNCT SIP-FCN
	EQUAL? PRSO,SIP \?L1
	EQUAL? PRSA,V?TAKE \?L1
	ZERO? PRSI /?L5
	EQUAL? PRSI,WATER \?L3
?L5:	CALL PERFORM,V?DRINK,WATER
	RTRUE
?L3:	EQUAL? PRSI,LIQUID \?L6
	CALL PERFORM,V?DRINK,LIQUID >STACK
	RSTACK
?L6:	PRINTR "No, I don't think I quite understand."
?L1:	PRINTR "Now that's an interesting thought."

	.FUNCT HIERO-FCN,TEMP,COUNTER=0,OFFSET
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	IN? WINNER,STAIRS-BOTTOM \?L4
	IN? PLASTER1,STAIRS-BOTTOM \?L4
	CALL PLASTER1-GLYPHS
	RTRUE
?L4:	IN? WINNER,WEST-END-OF-PASSAGE \?L6
	FSET? PIT,INVISIBLE \?L7
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
             .
<-*  #  /!\  -  #  (=  =)

::  *->  #  !!!
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L7:	PRINTR "They're gone with the plaster."
?L6:	EQUAL? HERE,NORTH-ANTECHAMBER \?L14
	FSET? BURIAL-CHAMBER,RMUNGBIT /?L14
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
             -     !=!
<-*  #  /!\  .  #  ! !

::  *->  #  !!!
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L14:	EQUAL? HERE,SOUTH-ANTECHAMBER \?L17
	FSET? ANNEX-DOOR,OPENBIT /?L17
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
                      -
<-*  #  /!\  (.)  #  ! !
                      -

           -
::  (  #  ! !
           -
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L17:	EQUAL? HERE,ROOM-OF-SELKIS,ROOM-OF-ISIS,ROOM-OF-NEPHTHYS /?L21
	EQUAL? HERE,ROOM-OF-NEITH \?L20
?L21:	EQUAL? HERE,ROOM-OF-NEPHTHYS \?L22
	SET 'TEMP,NEPHTHYS
	SET 'OFFSET,4
	JUMP ?L26
?L22:	EQUAL? HERE,ROOM-OF-NEITH \?L24
	SET 'TEMP,NEITH
	SET 'OFFSET,2
	JUMP ?L26
?L24:	EQUAL? HERE,ROOM-OF-SELKIS \?L25
	SET 'TEMP,SELKIS
	SET 'OFFSET,1
	JUMP ?L26
?L25:	SET 'TEMP,ISIS
	SET 'OFFSET,3
?L26:	INC 'COUNTER
	GET ORDER-LTBL,COUNTER >STACK
	EQUAL? TEMP,STACK \?L26
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	CRLF
	PRINTI "       "
	GET STAR-LTBL,COUNTER >STACK
	PRINT STACK
	CRLF
	CRLF
	PRINTI "          "
	GET COMPASS-POINTS-LTBL,OFFSET >STACK
	PRINT STACK
	CRLF
	PRINTI "))  /  #  "
	GET COMPASS-TAILS-LTBL,OFFSET >STACK
	PRINT STACK
	PRINTI "  ::

<-*  "
	GET STAR-LTBL,COUNTER >STACK
	PRINT STACK
	PRINTI "  =!=  /  *"
	CRLF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L20:	IN? WINNER,BEND-HALL \?L38
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "           .     =  - -
!@!  ...>  -  #  *   =   ::  <... ;

#  *
   =
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L38:	IN? WINNER,CENTRAL-ROOM \?L41
	PRINTI "The hieroglyphs look like this:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
                    !-!
...>  -. >... #  !  ! !
                    !-!

/  ...>  /  #  !@!
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L41:	EQUAL? HERE,SOUTH-CENTER \?L46
	PRINTI "The hieroglyphs look like this:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
 <.>     <:>     <:.>

 <::>    <::.>   <:::>

 <:::.>  <::::>  <::::.>
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L46:	LOC WINNER >STACK
	EQUAL? STACK,SKELETON-ROOM,SILVER-ROOM,GOLDEN-ROOM \?L51
	PRINTI "The hieroglyphs look like this:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
-!-  #  !*  ::  #  *!  ::

*->  #  !@!  >*>
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L51:	PRINTR "I don't see them here."

	.FUNCT BOARD-BARGE-F
	EQUAL? PRSA,V?BOARD \?L1
	EQUAL? HERE,BARGE-ENTRANCE \?L3
	CALL DO-WALK,P?UP
	RTRUE
?L3:	EQUAL? HERE,NW-CORNER,NE-CORNER /?L6
	EQUAL? HERE,SW-CORNER,SE-CORNER \?L5
?L6:	PRINTR "There's no way to do that from here."
?L5:	EQUAL? HERE,FORE-CABIN,AFT-CABIN,BELOW-DECK /?L10
	EQUAL? HERE,BELOW-MAST,BARGE-CENTER \FALSE
?L10:	PRINTR "Just where do you think you are?"
?L1:	EQUAL? PRSA,V?DISEMBARK \FALSE
	EQUAL? HERE,BARGE-CENTER \?L15
	CALL DO-WALK,P?DOWN
	RTRUE
?L15:	EQUAL? HERE,NW-CORNER,NE-CORNER /?L18
	EQUAL? HERE,SW-CORNER,SE-CORNER \?L17
?L18:	PRINTR "You're not on the barge!"
?L17:	EQUAL? HERE,FORE-CABIN,AFT-CABIN,BELOW-DECK /?L22
	EQUAL? HERE,BELOW-MAST,BARGE-CENTER \FALSE
?L22:	PRINTR "I can't do that from here."

	.FUNCT JUMP-OFF-FCN
	EQUAL? HERE,BARGE-CENTER \?L1
	EQUAL? PRSA,V?LEAP \?L5
	PRINTR "Don't you think using the plank would be safer?"
?L1:	EQUAL? PRSA,V?LEAP \?L5
	PRINTR "It might be easier without these bulkheads around."
?L5:	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L8
	FIRST? HERE >STACK \?L9
	CALL DESCRIBE-OBJECTS,1
	RTRUE
?L9:	PRINTR "There's nothing on the deck."
?L8:	EQUAL? PRSA,V?COUNT \FALSE
	PRINTR "What a cahd! (52 to be exact!)"

	.FUNCT FLAP-FCN
	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	EQUAL? HERE,TENT,TENT2,SUPPLY-TENT \?L3
	PRINTR "You can make out a lot of sand and a small firepit."
?L3:	EQUAL? HERE,P2 \?L6
	PRINTR "You can make out your cot and the trunk inside the tent."
?L6:	EQUAL? HERE,P7,P4 \TRUE
	PRINTR "You can see nothing distinguishable by trying to look in through the bright sunlight."

	.FUNCT THICKET-FCN
	EQUAL? HERE,RIVER-BANK,P4,P6 /?L1
	PRINTR "I see no thickets here."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	PRINTR "Thicker thickets have never been thicker."

	.FUNCT NOT-HERE-OBJECT-F,TBL,PRSO?=1,OBJ
	EQUAL? PRSO,NOT-HERE-OBJECT \?L5
	EQUAL? PRSI,NOT-HERE-OBJECT \?L1
	PRINTR "Those things aren't here!"
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L5
	SET 'TBL,P-PRSO
	JUMP ?L6
?L5:	SET 'TBL,P-PRSI
	SET 'PRSO?,0
?L6:	ZERO? PRSO? /?L7
	EQUAL? PRSA,V?LAMP-OFF,V?BURN,V?LAMP-ON \?L26
	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT /?L26
	RTRUE
?L7:	EQUAL? PRSA,V?LAMP-OFF,V?BURN,V?LAMP-ON \?L26
	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT \TRUE
?L26:	EQUAL? WINNER,ADVENTURER \?L28
	PRINTI "You can't see any"
	CALL NOT-HERE-PRINT,PRSO?
	PRINTR " here!"
?L28:	PRINTI "The "
	PRINTD WINNER
	PRINTI " seems confused. ""I don't see any"
	CALL NOT-HERE-PRINT,PRSO?
	PRINTR " here!"""

	.FUNCT FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ
	CALL MOBY-FIND,TBL >M-F
	GRTR? M-F,1 \?L1
	GET TBL,1 >STACK
	GETP STACK,P?GLOBAL >OBJ
	ZERO? OBJ /?L1
	SET 'M-F,1
	SET 'P-MOBY-FOUND,OBJ
?L1:	EQUAL? 1,M-F \?L4
	ZERO? PRSO? /?L6
	SET 'PRSO,P-MOBY-FOUND
	RFALSE
?L6:	SET 'PRSI,P-MOBY-FOUND
	RFALSE
?L4:	ZERO? PRSO? \?L9
	PRINTI "You wouldn't find any"
	CALL NOT-HERE-PRINT,PRSO?
	PRINTR " there."
?L9:	RETURN NOT-HERE-OBJECT

	.FUNCT GLOBAL-NOT-HERE-PRINT,OBJ
	ZERO? P-MULT /?L1
	INC 'P-NOT-HERE
	JUMP ?L3
?L1:	PRINTI "You can't see any"
	EQUAL? OBJ,PRSO \?L6
	CALL PRSO-PRINT
	JUMP ?L8
?L6:	CALL PRSI-PRINT
?L8:	PRINTI " here."
	CRLF
?L3:	SET 'P-WON,0
	RETURN P-WON

	.FUNCT NOT-HERE-PRINT,PRSO?
	ZERO? P-OFLAG /?L1
	ZERO? P-XADJ /?L3
	PRINTI " "
	PRINTB P-XADJN
?L3:	ZERO? P-XNAM /?L14
	PRINTI " "
	PRINTB P-XNAM
	JUMP ?L14
?L1:	ZERO? PRSO? /?L13
	GET P-ITBL,P-NC1L >STACK
	GET P-ITBL,P-NC1 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0
	JUMP ?L14
?L13:	GET P-ITBL,P-NC2L >STACK
	GET P-ITBL,P-NC2 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0
?L14:	SET 'P-WON,0
	RETURN P-WON

	.FUNCT V-VERBOSE
	SET 'VERBOSE,1
	SET 'SUPER-BRIEF,0
	PRINTR "Maximum verbosity."

	.FUNCT V-BRIEF
	SET 'VERBOSE,0
	SET 'SUPER-BRIEF,0
	PRINTR "Brief descriptions."

	.FUNCT V-SUPER-BRIEF
	SET 'SUPER-BRIEF,1
	PRINTR "Super-brief descriptions."

	.FUNCT V-LOOK
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /FALSE
	CALL DESCRIBE-OBJECTS,1 >STACK
	RSTACK

	.FUNCT V-FIRST-LOOK
	CALL DESCRIBE-ROOM >STACK
	ZERO? STACK /FALSE
	ZERO? SUPER-BRIEF \FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT V-EXAMINE
	GETP PRSO,P?TEXT >STACK
	ZERO? STACK /?L1
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	FSET? PRSO,CONTBIT /?L6
	FSET? PRSO,DOORBIT \?L5
?L6:	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE
?L5:	PRINTI "I see nothing special about the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT DESCRIBE-ROOM,LOOK?=0,V?,STR,AV
	SET 'V?,LOOK?
	ZERO? V? \?L1
	SET 'V?,VERBOSE
?L1:	ZERO? LIT \?L3
	PRINTI "It is pitch black. Off in the distance you hear hideous squealing and what can only be the sound of thousands of tiny, clawed feet coming closer."
	CRLF
	RFALSE
?L3:	FSET? HERE,TOUCHBIT /?L8
	FSET HERE,TOUCHBIT
	SET 'V?,1
?L8:	IN? HERE,ROOMS \?L11
	PRINTD HERE
	CRLF
?L11:	ZERO? LOOK? \?L18
	ZERO? SUPER-BRIEF \TRUE
?L18:	LOC WINNER >AV
	FSET? AV,VEHBIT \?L19
	PRINTI "(You are "
	EQUAL? AV,ALTAR \?L23
	PRINTI "on"
	JUMP ?L27
?L23:	PRINTI "in"
?L27:	PRINTI " the "
	PRINTD AV
	PRINTI ".)"
	CRLF
?L19:	ZERO? V? /?L35
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \TRUE
	ZERO? V? /?L35
	GETP HERE,P?LDESC >STR
	ZERO? STR /?L35
	PRINT STR
	CRLF
	JUMP ?L38
?L35:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-FLASH >STACK
?L38:	EQUAL? HERE,AV /TRUE
	FSET AV,VEHBIT
	GETP AV,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	RTRUE

	.FUNCT DESCRIBE-OBJECTS,V?=0
	ZERO? LIT /?L1
	FIRST? HERE >STACK \FALSE
	ZERO? V? \?L5
	SET 'V?,VERBOSE
?L5:	CALL PRINT-CONT,HERE,V?,-1 >STACK
	RSTACK
?L1:	PRINTR "I can't see anything in the dark."

	.FUNCT DESCRIBE-OBJECT,OBJ,V?,LEVEL,STR=0,AV
	SET 'DESC-OBJECT,OBJ
	ZERO? LEVEL \?L8
	GETP OBJ,P?DESCFCN >STACK
	CALL STACK,M-OBJDESC >STACK
	ZERO? STACK \TRUE
	ZERO? LEVEL \?L8
	FSET? OBJ,TOUCHBIT /?L5
	GETP OBJ,P?FDESC >STR
	ZERO? STR \?L4
?L5:	GETP OBJ,P?LDESC >STR
	ZERO? STR /?L3
?L4:	PRINT STR
	JUMP ?L40
?L3:	ZERO? LEVEL \?L8
	PRINTI "There is a"
	CALL VOWEL?,OBJ
	PRINTD OBJ
	CALL FLAMING?,OBJ >STACK
	ZERO? STACK /?L13
	EQUAL? OBJ,MANY-MATCHES /?L13
	PRINTI " (lit and burning)"
	JUMP ?L17
?L13:	EQUAL? OBJ,ROPE \?L17
	ZERO? ROPE-TIED /?L17
	EQUAL? HERE,CHAMBER-OF-RA \?L17
	PRINTI " (tied to the altar)"
?L17:	PRINTI " here."
	JUMP ?L40
?L8:	GET INDENTS,LEVEL >STACK
	PRINT STACK
	PRINTI "A"
	CALL VOWEL?,OBJ
	PRINTD OBJ
	FSET? OBJ,WEARBIT \?L30
	PRINTI " (being worn)"
?L30:	CALL FLAMING?,OBJ >STACK
	ZERO? STACK /?L35
	EQUAL? OBJ,MANY-MATCHES /?L35
	PRINTI " (lit and burning)"
?L35:	EQUAL? OBJ,ROPE \?L40
	ZERO? ROPE-TIED /?L40
	PRINTI " (tied to the "
	PRINTD ROPE-TIED
	PRINTI ")"
?L40:	ZERO? LEVEL \?L45
	LOC WINNER >AV
	ZERO? AV /?L45
	FSET? AV,VEHBIT \?L45
	PRINTI " (outside the "
	PRINTD AV
	PRINTI ")"
?L45:	CRLF
	CALL SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /FALSE
	FIRST? OBJ >STACK \FALSE
	CALL PRINT-CONT,OBJ,V?,LEVEL >STACK
	RSTACK

	.FUNCT PRINT-CONT,OBJ,V?=0,LEVEL=0,Y,1ST?,AV,STR,PV?=0,INV?=0,FLG=0
	FIRST? OBJ >Y \TRUE
	LOC WINNER >AV
	ZERO? AV /?L4
	FSET? AV,VEHBIT /?L6
?L4:	SET 'AV,0
?L6:	SET '1ST?,1
	LOC OBJ >STACK
	EQUAL? WINNER,OBJ,STACK \?L7
	SET 'INV?,1
	JUMP ?L11
?L7:	ZERO? Y \?L12
?L58:	ZERO? 1ST? \?L14
	PUSH 1
	JUMP ?L11
?L14:	PUSH 0
	JUMP ?L11
?L12:	EQUAL? Y,AV \?L16
	SET 'PV?,1
	JUMP ?L24
?L16:	EQUAL? Y,WINNER /?L24
	FSET? Y,INVISIBLE /?L24
	FSET? Y,TOUCHBIT /?L24
	GETP Y,P?FDESC >STR
	ZERO? STR /?L24
	FSET? Y,NDESCBIT /?L19
	PRINT STR
	CRLF
	SET 'FLG,1
?L19:	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L24
	LOC Y >STACK
	GETP STACK,P?DESCFCN >STACK
	ZERO? STACK \?L24
	FIRST? Y >STACK \?L24
	CALL PRINT-CONT,Y,V?,0
?L24:	NEXT? Y >Y /?L12
	JUMP ?L58
?L11:	FIRST? OBJ >Y /?L32
?L57:	ZERO? PV? /?L34
	ZERO? AV /?L34
	FIRST? AV >STACK \?L34
	CALL PRINT-CONT,AV,V?,LEVEL
?L34:	ZERO? 1ST? \?L37
	PUSH 1
	RETURN FLG
?L37:	PUSH 0
	RETURN FLG
?L32:	EQUAL? Y,AV,ADVENTURER /?L53
	FSET? Y,INVISIBLE /?L53
	ZERO? INV? \?L41
	FSET? Y,TOUCHBIT /?L41
	GETP Y,P?FDESC >STACK
	ZERO? STACK \?L53
?L41:	FSET? Y,NDESCBIT /?L42
	ZERO? 1ST? /?L44
	CALL FIRSTER,OBJ,LEVEL >STACK
	ZERO? STACK /?L48
	SET 'FLG,1
	LESS? LEVEL,0 \?L48
	SET 'LEVEL,0
?L48:	INC 'LEVEL
	SET '1ST?,0
?L44:	CALL DESCRIBE-OBJECT,Y,V?,LEVEL
	JUMP ?L53
?L42:	FIRST? Y >STACK \?L53
	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L53
	CALL PRINT-CONT,Y,V?,LEVEL
?L53:	NEXT? Y >Y /?L32
	JUMP ?L57

	.FUNCT FIRSTER,OBJ,LEVEL
	EQUAL? OBJ,WINNER \?L1
	PRINTR "You are carrying:"
?L1:	IN? OBJ,ROOMS /FALSE
	GRTR? LEVEL,0 \?L6
	GET INDENTS,LEVEL >STACK
	PRINT STACK
?L6:	FSET? OBJ,SURFACEBIT \?L11
	PRINTI "Sitting on the "
	PRINTD OBJ
	PRINTR " is:"
?L11:	PRINTI "The "
	PRINTD OBJ
	PRINTR " contains:"

	.FUNCT SCORE-UPD,NUM
	ADD BASE-SCORE,NUM >BASE-SCORE
	ADD SCORE,NUM >SCORE
	RTRUE

	.FUNCT SCORE-OBJ,OBJ,TEMP
	GETP OBJ,P?VALUE >STACK
	ZERO? STACK /FALSE
	GETP OBJ,P?VALUE >TEMP
	GRTR? TEMP,0 \FALSE
	CALL SCORE-UPD,TEMP
	PUTP OBJ,P?VALUE,0
	RTRUE

	.FUNCT V-SCORE,ASK?=1
	PRINTI "Your score is "
	PRINTN SCORE
	PRINTI " out of a possible "
	PRINTN SCORE-MAX
	PRINTI ", in "
	PRINTN MOVES
	EQUAL? MOVES,1 \?L7
	PRINTI " move."
	JUMP ?L11
?L7:	PRINTI " moves."
?L11:	CRLF
	PRINTI "This score gives you the rank of a "
	GRTR? SCORE,390 \?L16
	PRINTI "master adventurer"
	JUMP ?L29
?L16:	GRTR? SCORE,320 \?L20
	PRINTI "very good adventurer"
	JUMP ?L29
?L20:	GRTR? SCORE,200 \?L23
	PRINTI "fairly good looter"
	JUMP ?L29
?L23:	GRTR? SCORE,100 \?L26
	PRINTI "poor professor"
	JUMP ?L29
?L26:	PRINTI "fumbling beginner"
?L29:	PRINTI "."
	CRLF
	RETURN SCORE

	.FUNCT FINISH
	CALL V-SCORE
	QUIT

	.FUNCT V-QUIT,ASK?=1,SCOR
	CALL V-SCORE
	ZERO? ASK? /?L3
	PRINTI "Do you wish to leave the game? (Y is affirmative): "
	CALL YES? >STACK
	ZERO? STACK \?L3
	ZERO? ASK? \?L1
?L3:	QUIT
?L1:	PRINTR "Ok."

	.FUNCT PRE-FINISH
	CALL V-SCORE
	PRINTI "[EVENT: GAME OVER]Do you wish to start the game again? (Y is affirmative): "
	CALL YES? >STACK
	ZERO? STACK /?L3
	PRINTI "Okay. Restarting..."
	CRLF
	RESTART
?L3:	PRINTI "Ok. See you next time!"
	CRLF
	QUIT

	.FUNCT YES?
	PRINTI ">"
	READ P-INBUF,P-LEXV
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?YES,W?Y \FALSE
	RTRUE

	.FUNCT V-VERSION,CNT=17
	PRINTI "INFIDEL
Copyright 1983 by Infocom, Inc. All rights reserved.
INFIDEL is a trademark of Infocom, Inc.
Release "
	GET 0,1 >STACK
	BAND STACK,2047 >STACK
	PRINTN STACK
	PRINTI " / Serial number "
?L5:	IGRTR? 'CNT,23 /?L6
	GETB 0,CNT >STACK
	PRINTC STACK
	JUMP ?L5
?L6:	CRLF
	RTRUE

	.FUNCT IN-HERE?,OBJ
	IN? OBJ,HERE /TRUE
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	RSTACK

	.FUNCT V-AGAIN,OBJ
	EQUAL? L-PRSA,V?WALK \?L1
	CALL PERFORM,L-PRSA,L-PRSO >STACK
	RSTACK
?L1:	ZERO? L-PRSO /?L4
	LOC L-PRSO >STACK
	ZERO? STACK \?L4
	SET 'OBJ,L-PRSO
	JUMP ?L5
?L4:	ZERO? L-PRSI /?L6
	LOC L-PRSO >STACK
	ZERO? STACK \?L6
	SET 'OBJ,L-PRSI
	JUMP ?L5
?L6:	SET 'OBJ,0
?L5:	EQUAL? OBJ,0,PSEUDO-OBJECT,ROOMS /?L8
	PRINTI "I can't see the "
	PRINTD OBJ
	PRINTI " anymore."
	CRLF
	RETURN 2
?L8:	CALL PERFORM,L-PRSA,L-PRSO,L-PRSI >STACK
	RSTACK

	.FUNCT JIGS-UP,DESC,PLAYER?=0
	PRINT DESC
	CRLF
	PRINTI " 
   ****  You have died  **** 

"
	CALL PRINT-ID,STR?13
	ZERO? PYRAMID-OPENED \?L5
	PRINTI "You feel yourself disembodied in a deep blackness. A voice from the void, or perhaps it's just your dying thoughts, rings in your ears.

""Obsessions are the torment of men's souls, reaching out for something greater than life has offered. Perhaps this is what makes the difference between an ordinary mortal and an adventurer!"" It is the last thing you hear."
	CRLF
	JUMP ?L9
?L5:	PRINTI "The great mysteries of the ancient pyramid remain unsolved. Although your desperation has served you well in getting this far, to get farther requires a wisdom, tempered by experience."
	CRLF
?L9:	CRLF
	CALL PRE-FINISH >STACK
	RSTACK

	.FUNCT V-RESTORE
	RESTORE \?L1
	PRINTI "Ok."
	CRLF
	CALL V-FIRST-LOOK >STACK
	RSTACK
?L1:	PRINTR "Failed."

	.FUNCT V-SAVE
	SAVE \?L1
	PRINTR "Ok."
?L1:	PRINTR "Failed."

	.FUNCT V-RESTART
	CALL V-SCORE,1
	PRINTI "Do you wish to restart? (Y is affirmative): "
	CALL YES? >STACK
	ZERO? STACK /FALSE
	PRINTI "Restarting."
	CRLF
	RESTART

	.FUNCT V-WALK-AROUND
	PRINTR "Use directions for movement here."

	.FUNCT V-LAUNCH
	PRINTR "How in blazes does one launch that?"

	.FUNCT GO-NEXT,TBL,VAL
	CALL LKP,HERE,TBL >VAL
	ZERO? VAL /FALSE
	CALL GOTO,VAL >STACK
	RSTACK

	.FUNCT LKP,ITM,TBL,CNT=0,LEN
	GET TBL,0 >LEN
?L1:	IGRTR? 'CNT,LEN /FALSE
	GET TBL,CNT >STACK
	EQUAL? STACK,ITM \?L1
	EQUAL? CNT,LEN /FALSE
	ADD CNT,1 >STACK
	GET TBL,STACK >STACK
	RSTACK

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	ZERO? P-WALK-DIR \?L1
	CALL PERFORM,V?WALK-TO,PRSO
	RTRUE
?L1:	GETPT HERE,PRSO >PT
	ZERO? PT /?L3
	PTSIZE PT >PTS
	EQUAL? PTS,UEXIT \?L4
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L4:	EQUAL? PTS,NEXIT \?L6
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L6:	EQUAL? PTS,FEXIT \?L11
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L12
	CALL GOTO,RM >STACK
	RSTACK
?L12:	RETURN 2
?L11:	EQUAL? PTS,CEXIT \?L17
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L18
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L18:	GET PT,CEXITSTR >STR
	ZERO? STR /?L20
	PRINT STR
	CRLF
	RETURN 2
?L20:	PRINTI "You can't go that way."
	CRLF
	RETURN 2
?L17:	EQUAL? PTS,DEXIT \FALSE
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L31
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L31:	GET PT,DEXITSTR >STR
	ZERO? STR /?L33
	PRINT STR
	CRLF
	CALL THIS-IS-IT,OBJ
	RETURN 2
?L33:	PRINTI "The "
	PRINTD OBJ
	PRINTI " is closed."
	CRLF
	CALL THIS-IS-IT,OBJ
	RETURN 2
?L3:	ZERO? LIT \?L44
	RANDOM 100 >STACK
	GRTR? 90,STACK \?L44
	CALL PRINT-ID,STR?14
	CALL JIGS-UP,STR?15 >STACK
	RSTACK
?L44:	PRINTI "You can't go that way."
	CRLF
	RETURN 2

	.FUNCT THIS-IS-IT,OBJ
	SET 'P-IT-OBJECT,OBJ
	SET 'P-IT-LOC,HERE
	RETURN P-IT-LOC

	.FUNCT V-INVENTORY
	FIRST? WINNER >STACK \?L1
	CALL PRINT-CONT,WINNER >STACK
	RSTACK
?L1:	PRINTR "You are empty-handed."

	.FUNCT PRE-TAKE
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	IN? PRSO,WINNER \?L4
	FSET? PRSO,WEARBIT \?L6
	EQUAL? PRSO,KNAPSACK /FALSE
	PRINTR "You are already wearing it."
?L6:	EQUAL? PRSO,ONE-MATCH \?L13
	PRINTR "You already have one. One at a time, now!"
?L13:	PRINTR "You already have it."
?L4:	LOC PRSO >STACK
	FSET? STACK,CONTBIT \?L19
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L19
	PRINTR "You can't reach that."
?L19:	ZERO? PRSI /?L22
	LOC PRSO >STACK
	EQUAL? PRSI,STACK /?L23
	EQUAL? PRSO,NOT-HERE-OBJECT \?L25
	FSET? PRSI,CONTBIT \?L25
	FSET? PRSI,OPENBIT /?L25
	PRINTI "You'd better open the "
	PRINTD PRSI
	PRINTI " first."
	CRLF
	CALL THIS-IS-IT,PRSI
	RTRUE
?L25:	EQUAL? PRSO,LOCK /FALSE
	EQUAL? PRSO,SHOVEL \?L30
	EQUAL? PRSI,SAND \?L30
	SET 'PRSI,0
	RFALSE
?L30:	PRINTI "The "
	PRINTD PRSO
	PRINTI " isn't in the "
	PRINTD PRSI
	PRINTR "."
?L23:	SET 'PRSI,0
	RFALSE
?L22:	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	PRINTR "You are in it, loser!"

	.FUNCT V-TAKE
	CALL ITAKE >STACK
	EQUAL? STACK,1 \FALSE
	FSET? PRSO,WEARBIT \?L3
	PRINTI "You are now wearing the "
	PRINTD PRSO
	PRINTR "."
?L3:	PRINTR "Taken."

	.FUNCT ITAKE,VB=1,CNT,OBJ,TEMP,?TMP
	FSET? PRSO,TAKEBIT /?L1
	ZERO? VB /FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RFALSE
?L1:	LOC PRSO >STACK
	IN? STACK,WINNER /?L8
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,WINNER >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,LOAD-ALLOWED \?L8
	ZERO? VB /FALSE
	PRINTI "Your load is too heavy."
	CRLF
	CRLF
	RFALSE
?L8:	CALL CCOUNT,WINNER >CNT
	GRTR? CNT,FUMBLE-NUMBER \?L14
	PRINTI "You're carrying too many individual items already!"
	CRLF
	RFALSE
?L14:	MOVE PRSO,WINNER
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	CALL SCORE-OBJ,PRSO
	RTRUE

	.FUNCT V-PUT-ACROSS
	PRINTR "You can't do that."

	.FUNCT V-PUT-ON
	FSET? PRSI,SURFACEBIT \?L1
	CALL V-PUT
	RTRUE
?L1:	PRINTI "There's no good surface on the "
	PRINTD PRSI
	PRINTR "."

	.FUNCT PRE-PUT,OBJ
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSO,LINTEL,PLASTER1,PLASTER \?L3
	PRINTR "That's weird."
?L3:	EQUAL? PRSI,GROUND,SAND \?L6
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L6:	EQUAL? PRSO,ONE-MATCH /FALSE
	IN? PRSO,GLOBAL-OBJECTS /?L9
	FSET? PRSO,TAKEBIT /?L8
?L9:	PRINTR "Nice try."
?L8:	EQUAL? PRSI,MID-DISC,RIGHT-DISC,LEFT-DISC \?L12
	FIRST? PRSI >STACK \?L12
	FIRST? PRSI >OBJ /?L13
?L13:	EQUAL? OBJ,PRSO \?L14
	PRINTR "Better have your eyes checked."
?L14:	PRINTI "There's no room. The "
	PRINTD OBJ
	PRINTI " is already on the "
	PRINTD PRSI
	PRINTR "."
?L12:	CALL STAIRWAY-CHECK? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSI,TORCH \FALSE
	CALL PERFORM,V?DROP,PRSO,PRSI
	RTRUE

	.FUNCT STAIRWAY-CHECK?
	EQUAL? PRSO,ROPE \?L1
	ZERO? ROPE-TIED \FALSE
?L1:	EQUAL? PRSI,NORTH-STAIRS,SOUTH-STAIRS /?L4
	EQUAL? PRSI,WEST-STAIRS,EAST-STAIRS \FALSE
?L4:	LOC WINNER >STACK
	EQUAL? STACK,CHAMBER-OF-RA,TINY-LANDING \FALSE
	PRINTI "You hear the "
	PRINTD PRSO
	PRINTI " crash below."
	CRLF
	IN? PRSO,WINNER /?L7
	PRINTI "You're not holding the "
	PRINTD PRSO
	PRINTR "."
?L7:	EQUAL? PRSI,NORTH-STAIRS \?L11
	MOVE PRSO,LANDING-ZERO
	RTRUE
?L11:	EQUAL? PRSI,EAST-STAIRS \?L12
	MOVE PRSO,LANDING-ONE
	RTRUE
?L12:	EQUAL? PRSI,WEST-STAIRS \?L13
	MOVE PRSO,LANDING-THREE
	RTRUE
?L13:	EQUAL? PRSI,SOUTH-STAIRS \FALSE
	MOVE PRSO,LANDING-TWO
	RTRUE

	.FUNCT V-PUT,?TMP
	FSET? PRSI,OPENBIT /?L7
	FSET? PRSI,DOORBIT /?L4
	FSET? PRSI,CONTBIT /?L4
	FSET? PRSI,VEHBIT /?L4
	PRINTR "You can't do that."
?L4:	FSET? PRSI,OPENBIT /?L7
	PRINTI "The "
	PRINTD PRSI
	PRINTI " isn't open."
	CRLF
	JUMP ?L21
?L7:	EQUAL? PRSI,PRSO \?L11
	PRINTI "How can you do that?"
	CRLF
	JUMP ?L21
?L11:	IN? PRSO,PRSI \?L14
	PRINTI "The "
	PRINTD PRSO
	PRINTI " is already in the "
	PRINTD PRSI
	PRINTI "."
	CRLF
	JUMP ?L21
?L14:	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \?L17
	PRINTI "There's no room."
	CRLF
	JUMP ?L21
?L17:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L20
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
?L20:	MOVE PRSO,PRSI
	FSET PRSO,TOUCHBIT
	EQUAL? PRSI,PUNCH-PANEL /?L22
	FSET? PRSO,NDESCBIT \?L22
	FCLEAR PRSO,NDESCBIT
?L22:	PRINTI "Done."
	CRLF
?L21:	EQUAL? PRSO,BEAM \?L27
	ZERO? BEAM-PLACED /?L27
	EQUAL? PRSI,NICHES /?L27
	SET 'BEAM-PLACED,0
	SET 'ON-BEAM,0
	RTRUE
?L27:	EQUAL? PRSO,DEAD-BOOK,SCARAB \FALSE
	EQUAL? PRSI,L-AREA,S-AREA /FALSE
	SET 'CAN-TURN-STATUES,0
	RETURN CAN-TURN-STATUES

	.FUNCT PRE-DROP
	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE

	.FUNCT PRE-GIVE
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	CALL HELD?,PRSO >STACK
	ZERO? STACK \FALSE
	PRINTR "That's easy for you to say since you don't even have it."

	.FUNCT PRE-SGIVE
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT HELD?,OBJ
	ZERO? OBJ /FALSE
	IN? OBJ,WINNER /TRUE
	LOC OBJ >STACK
	CALL HELD?,STACK >STACK
	RSTACK

	.FUNCT V-GIVE
	PRINTI "You can't give the "
	PRINTD PRSO
	PRINTI " to a"
	CALL VOWEL?,PRSI
	PRINTD PRSI
	PRINTR "!"

	.FUNCT V-SGIVE
	PRINTR "FOOOO!!"

	.FUNCT V-DROP,SUPPRESS=0
	CALL IDROP >STACK
	ZERO? STACK \FALSE
	RFALSE

	.FUNCT V-THROW
	ZERO? PRSI /?L1
	FSET? PRSI,CONTBIT /?L3
	FSET? PRSI,CLIMBBIT \?L1
?L3:	CALL PERFORM,V?PUT,PRSO,PRSI
	RTRUE
?L1:	CALL IDROP
	PRINTR "Thrown."

	.FUNCT IDROP
	IN? PRSO,WINNER /?L5
	LOC PRSO >STACK
	IN? STACK,WINNER /?L1
	PRINTI "You're not carrying the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	RFALSE
?L1:	IN? PRSO,WINNER /?L5
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L5
	PRINTI "The "
	PRINTD PRSO
	PRINTI " is closed."
	CRLF
	RFALSE
?L5:	LOC WINNER >STACK
	MOVE PRSO,STACK
	RTRUE

	.FUNCT V-OPEN,F,STR
	FSET? PRSO,CONTBIT /?L1
	PRINTI "You must tell me how to do that to the "
	PRINTD PRSO
	PRINTR "."
?L1:	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L5
	FSET? PRSO,OPENBIT \?L6
	PRINTR "It is already open."
?L6:	FSET PRSO,OPENBIT
	FIRST? PRSO >STACK /?L11
	PRINTR "Opened."
?L11:	FIRST? PRSO >F \?L15
	NEXT? F >STACK /?L15
	GETP F,P?FDESC >STR
	ZERO? STR /?L15
	PRINTI "The "
	PRINTD PRSO
	PRINTI " opens."
	CRLF
	PRINT STR
	CRLF
	RTRUE
?L15:	EQUAL? PRSO,MAP /?L21
	PRINTI "Opening"
	JUMP ?L25
?L21:	PRINTI "Unfolding"
?L25:	PRINTI " the "
	PRINTD PRSO
	PRINTI " reveals "
	CALL PRINT-CONTENTS,PRSO
	PRINTR "."
?L5:	FSET? PRSO,DOORBIT \?L32
	FSET? PRSO,OPENBIT \?L33
	PRINTR "It is already open."
?L33:	PRINTI "The "
	PRINTD PRSO
	PRINTI " opens."
	CRLF
	FSET PRSO,OPENBIT
	RTRUE
?L32:	PRINTI "The "
	PRINTD PRSO
	PRINTR " fails to open."

	.FUNCT PRINT-CONTENTS,OBJ,F,N,1ST?=1
	FIRST? OBJ >F \FALSE
?L3:	NEXT? F >N /?L5
?L5:	ZERO? 1ST? /?L6
	SET '1ST?,0
	JUMP ?L11
?L6:	PRINTI ", "
	ZERO? N \?L11
	PRINTI "and "
?L11:	PRINTI "a"
	CALL VOWEL?,F
	PRINTD F
	SET 'F,N
	ZERO? F \?L3
	RTRUE

	.FUNCT V-CLOSE
	FSET? PRSO,CONTBIT /?L1
	PRINTI "You must tell me how to do that to the "
	PRINTD PRSO
	PRINTR "."
?L1:	FSET? PRSO,SURFACEBIT /?L5
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L5
	FSET? PRSO,OPENBIT \?L6
	FCLEAR PRSO,OPENBIT
	PRINTR "Closed."
?L6:	PRINTR "It is already closed."
?L5:	FSET? PRSO,DOORBIT \?L13
	FSET? PRSO,OPENBIT \?L14
	PRINTI "The "
	PRINTD PRSO
	PRINTI " is now closed."
	CRLF
	FCLEAR PRSO,OPENBIT
	RTRUE
?L14:	PRINTR "It is already closed."
?L13:	PRINTR "You cannot close that."

	.FUNCT CCOUNT,OBJ,CNT=0,X
	FIRST? OBJ >X \?L4
?L3:	FSET? X,WEARBIT /?L5
	INC 'CNT
?L5:	NEXT? X >X /?L3
?L4:	RETURN CNT

	.FUNCT WEIGHT,OBJ,CONT,WT=0
	FIRST? OBJ >CONT \?L4
?L3:	EQUAL? OBJ,WINNER \?L5
	FSET? CONT,WEARBIT \?L5
	INC 'WT
	JUMP ?L7
?L5:	CALL WEIGHT,CONT >STACK
	ADD WT,STACK >WT
?L7:	NEXT? CONT >CONT /?L3
?L4:	GETP OBJ,P?SIZE >STACK
	ADD WT,STACK >STACK
	RSTACK

	.FUNCT V-BUG
	PRINTR "If there is a problem here, it is unintentional. You may report your problem to the address provided in your documentation."

	.FUNCT V-SCRIPT
	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	PRINTI "Here begins"
	PRINT COPR-NOTICE
	CRLF
	RTRUE

	.FUNCT V-UNSCRIPT
	PRINTI "Here ends"
	PRINT COPR-NOTICE
	CRLF
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT PRE-MOVE
	CALL HELD?,PRSO >STACK
	ZERO? STACK /FALSE
	PRINTR "I don't juggle objects!"

	.FUNCT V-MOVE
	EQUAL? PRSO,BEAM \?L1
	FSET? BEAM,TOUCHBIT /?L1
	PRINTR "Sure. But it might be better to be a little more specific in how you want it moved."
?L1:	FSET? PRSO,TAKEBIT \?L5
	PRINTI "Moving the "
	PRINTD PRSO
	PRINTR " reveals nothing."
?L5:	PRINTI "You can't move the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-LAMP-ON
	FSET? PRSO,BURNBIT \?L1
	CALL FLAMING?,PRSO >STACK
	ZERO? STACK /?L3
	EQUAL? PRSO,ONE-MATCH \?L5
	PRINTI "One"
	JUMP ?L9
?L5:	PRINTI "It"
?L9:	PRINTR " is already lit."
?L3:	EQUAL? PRSO,TORCH \?L14
	ZERO? PRSI \?L14
	IN? ONE-MATCH,WINNER /?L14
	PRINTR "You expect to light the torch with your glowing intellect?"
?L14:	EQUAL? PRSI,MATCHES,ONE-MATCH,SINGLE-MATCH /?L18
	IN? ONE-MATCH,WINNER \?L17
?L18:	EQUAL? PRSO,TORCH \?L17
	CALL QUEUE,I-TORCH,-1 >STACK
	PUT STACK,0,1
	CALL LIGHT-THE,TORCH,0
	FSET TORCH,TOUCHBIT
	RTRUE
?L17:	EQUAL? PRSO,MANY-MATCHES,SINGLE-MATCH,EMPTY-MATCHES /?L20
	EQUAL? PRSO,ONE-MATCH \?L19
?L20:	IN? ONE-MATCH,WINNER /?L19
	IN? MATCHES,WINNER /?L19
	PRINTR "I see no match here."
?L19:	EQUAL? PRSO,MANY-MATCHES,SINGLE-MATCH,EMPTY-MATCHES /?L24
	EQUAL? PRSO,ONE-MATCH \?L23
?L24:	LESS? MATCH-COUNT,1 \?L25
	PRINTR "That's a little tough to do with an empty book of matches."
?L25:	IN? ONE-MATCH,WINNER /?L30
	CALL MATCH-MOVER
?L30:	PRINTI "You have now lit a match."
	CRLF
	CALL LIGHT-THE,ONE-MATCH,1
	CALL QUEUE,I-MATCH-OUT,3 >STACK
	PUT STACK,0,1
	RTRUE
?L23:	PRINTI "I don't know how to light the "
	PRINTD PRSO
	PRINTR "."
?L1:	PRINTR "You can't light that."

	.FUNCT FLAMING?,OBJ
	FSET? OBJ,FLAMEBIT /TRUE
	RFALSE

	.FUNCT LIGHT-THE,OBJECT,SUPPRESS?
	FSET OBJECT,ONBIT
	FSET OBJECT,FLAMEBIT
	EQUAL? OBJECT,ONE-MATCH \?L5
	FSET? MATCHES,OPENBIT \?L5
	RANDOM 100 >STACK
	GRTR? 10,STACK \?L5
	PRINTI "Ooops! You didn't remember to close the cover before striking! The matchbook bursts into flames, burning your fingertips."
	CRLF
	CALL PRINT-ID,STR?16
	LOC MATCHES >STACK
	MOVE BURNED-MATCHBOOK,STACK
	FSET BURNED-MATCHBOOK,OPENBIT
	REMOVE MATCHES
	REMOVE MANUAL
	REMOVE ONE-MATCH
	SET 'MATCH-COUNT,0
	SET 'SUPPRESS?,1
?L5:	ZERO? SUPPRESS? \?L12
	PRINTI "The "
	PRINTD OBJECT
	PRINTI " is now lit."
	CRLF
?L12:	ZERO? LIT \FALSE
	CALL LIT?,HERE >LIT
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT V-LAMP-OFF
	FSET? PRSO,BURNBIT \?L1
	CALL FLAMING?,PRSO >STACK
	ZERO? STACK \?L3
	PRINTR "It is already out."
?L3:	EQUAL? PRSO,MATCHES,ONE-MATCH \?L7
	CALL INT,I-MATCH-OUT >STACK
	PUT STACK,0,0
	CALL I-MATCH-OUT,1
	RTRUE
?L7:	PRINTI "The "
	PRINTD PRSO
	PRINTI " is now out."
	CRLF
	CALL KILL-TORCH
	RTRUE
?L1:	PRINTR "You can't extinguish that."

	.FUNCT V-WAIT,NUM=3
	PRINTI "Time passes..."
	CRLF
?L3:	DLESS? 'NUM,0 /?L4
	CALL CLOCKER >STACK
	ZERO? STACK \?L4
	INC 'MOVES
	JUMP ?L3
?L4:	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT

	.FUNCT PRE-BOARD,AV
	LOC WINNER >AV
	EQUAL? PRSO,TENT-OBJ,BOAT /FALSE
	EQUAL? PRSO,BEAM \?L4
	CALL PERFORM,V?CLIMB-ON,BEAM
	RTRUE
?L4:	FSET? PRSO,VEHBIT \?L5
	FSET? AV,VEHBIT \FALSE
	PRINTI "You are already on the "
	PRINTD AV
	PRINTI ", cretin!"
	CRLF
	RETURN 2
?L5:	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	PRINTI "I suppose you have a theory on getting into the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	RETURN 2

	.FUNCT V-BOARD,OBJ,AV
	PRINTI "You are now "
	EQUAL? PRSO,ALTAR \?L3
	PRINTI "on"
	JUMP ?L7
?L3:	PRINTI "in"
?L7:	PRINTI " the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	MOVE WINNER,PRSO
	EQUAL? PRSO,ALTAR,CRATE,SLAB /TRUE
	GETP PRSO,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	RTRUE

	.FUNCT V-DISEMBARK
	LOC WINNER >STACK
	EQUAL? STACK,PRSO /?L1
	PRINTI "You're not in that!"
	CRLF
	RETURN 2
?L1:	FSET? HERE,RLANDBIT \?L7
	ZERO? STOOD-UP \?L8
	PRINTI "You push yourself up and manage to get out of the cot. Your legs are a little wobbly, though, and your head swims."
	CRLF
	SET 'STOOD-UP,1
	JUMP ?L12
?L8:	PRINTI "You are on your feet again."
	CRLF
?L12:	MOVE WINNER,HERE
	RTRUE
?L7:	PRINTI "You realize, just in time, that getting out here would probably be fatal."
	CRLF
	CALL PRINT-ID,STR?17
	RETURN 2

	.FUNCT V-BLAST
	PRINTR "You can't blast anything by using words."

	.FUNCT GOTO,RM,V?=1,LB,WLOC,AV=0,OLIT
	FSET? RM,RLANDBIT /?L1
	SET 'LB,0
	JUMP ?L2
?L1:	SET 'LB,1
?L2:	LOC WINNER >WLOC
	SET 'OLIT,LIT
	FSET? WLOC,VEHBIT \?L3
	PRINTI "You'd better get "
	EQUAL? WLOC,ALTAR \?L7
	PRINTI "off"
	JUMP ?L11
?L7:	PRINTI "out"
?L11:	PRINTI " of the "
	PRINTD WLOC
	PRINTR " first."
?L3:	ZERO? LB \?L20
	ZERO? AV /?L21
	FSET? RM,AV \?L19
?L20:	FSET? HERE,RLANDBIT \?L17
	ZERO? LB /?L17
	EQUAL? AV,0,RLANDBIT /?L17
	FSET? RM,AV /?L17
?L19:	ZERO? AV /?L21
	PRINTI "You can't go there in a"
	CALL VOWEL?,WLOC
	PRINTD WLOC
	PRINTI "."
	JUMP ?L27
?L21:	PRINTI "You can't go there without a vehicle."
?L27:	CRLF
	RFALSE
?L17:	FSET? RM,RMUNGBIT \?L30
	GETP RM,P?LDESC >STACK
	PRINT STACK
	CRLF
	RFALSE
?L30:	ZERO? AV /?L34
	MOVE WLOC,RM
	JUMP ?L36
?L34:	MOVE WINNER,RM
?L36:	SET 'HERE,RM
	CALL LIT?,HERE >LIT
	ZERO? OLIT \?L37
	ZERO? LIT \?L37
	RANDOM 100 >STACK
	GRTR? 85,STACK \?L37
	CALL PRINT-ID,STR?18
	CALL JIGS-UP,STR?19
?L37:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	EQUAL? HERE,RM \TRUE
	EQUAL? ADVENTURER,WINNER /?L42
	PRINTI "The "
	PRINTD WINNER
	PRINTR " leaves the room."
?L42:	ZERO? V? /TRUE
	CALL V-FIRST-LOOK
	RTRUE

	.FUNCT V-BACK
	PRINTR "Sorry, my memory isn't that good. You'll have to give a direction."

	.FUNCT V-POUR
	EQUAL? PRSO,OIL-JAR,LIQUID,WATER /?L1
	EQUAL? PRSO,C-SAND /?L1
	PRINTR "You can't pour that."
?L1:	PRINTI "Poured."
	CRLF
	EQUAL? PRSO,OIL-JAR,LIQUID \?L8
	SET 'OIL-LEFT,0
	REMOVE LIQUID
	RTRUE
?L8:	EQUAL? PRSO,C-SAND \?L10
	SET 'SAND-FILLED,0
	REMOVE C-SAND
	RTRUE
?L10:	REMOVE WATER
	SET 'WATER-LEFT,0
	RETURN WATER-LEFT

	.FUNCT V-POUR-IN,L
	EQUAL? PRSO,OIL-JAR,LIQUID,WATER /?L1
	EQUAL? PRSO,C-SAND /?L1
	PRINTR "You can't pour that into anything."
?L1:	FSET? PRSI,CONTBIT /?L5
	PRINTI "You'd have a lot of trouble pouring the "
	PRINTD PRSO
	PRINTI " into the "
	PRINTD PRSI
	PRINTR "."
?L5:	EQUAL? PRSI,GOLD-CUP,SILVER-CUP \?L8
	EQUAL? PRSO,WATER \?L12
	LOC LIQUID >STACK
	EQUAL? STACK,PRSI /?L11
?L12:	EQUAL? PRSO,LIQUID \?L9
	LOC WATER >STACK
	EQUAL? STACK,PRSI \?L9
?L11:	PRINTR "Oil and water never mixed together well."
?L9:	LOC PRSO >L
	PRINTI "Okay. The "
	PRINTD PRSI
	PRINTI " has been filled, but the "
	PRINTD L
	PRINTI " is now empty."
	CRLF
	MOVE PRSO,PRSI
	EQUAL? PRSO,WATER \?L18
	SET 'WATER-LEFT,0
	RETURN WATER-LEFT
?L18:	EQUAL? PRSO,C-SAND \FALSE
	SET 'SAND-FILLED,0
	RETURN SAND-FILLED
?L8:	PRINTR "Why bother?"

	.FUNCT PRE-POUR-ON,LIQ
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSO,WATER,C-SAND \?L3
	SET 'LIQ,PRSO
	LOC LIQ >STACK
	FSET? STACK,OPENBIT /?L4
	PRINTI "You'd better open the "
	LOC LIQ >STACK
	PRINTD STACK
	PRINTR " first."
?L4:	CALL FLAMING?,PRSI >STACK
	ZERO? STACK /?L8
	PRINTI "Poured."
	CRLF
	ZERO? LIT /?L11
	CALL LIT?,HERE >LIT
?L11:	CALL LIT?,HERE >LIT
	ZERO? LIT \?L14
	PRINTI " It is now pitch black."
?L14:	EQUAL? LIQ,WATER \?L19
	SUB WATER-LEFT,10 >WATER-LEFT
	LESS? WATER-LEFT,10 \?L24
	REMOVE WATER
	JUMP ?L24
?L19:	SET 'SAND-FILLED,0
	REMOVE C-SAND
?L24:	FCLEAR PRSI,FLAMEBIT
	FCLEAR PRSI,ONBIT
	RTRUE
?L8:	PRINTI "Poured."
	CRLF
	EQUAL? LIQ,WATER \?L28
	SUB WATER-LEFT,10 >WATER-LEFT
	LESS? WATER-LEFT,10 \?L30
	REMOVE WATER
?L30:	PRINTI "The "
	PRINTD PRSI
	PRINTR " gets wet, but quickly dries."
?L28:	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L36
	PRINTI "The sand is gone with the wind."
	CRLF
	JUMP ?L40
?L36:	PRINTI "The sand falls through the cracks in the stone floor."
	CRLF
?L40:	SET 'SAND-FILLED,0
	RTRUE
?L3:	EQUAL? PRSO,OIL-JAR,LIQUID /?L43
	PRINTR "You can't pour that on anything."
?L43:	ZERO? OIL-LEFT \?L46
	PRINTR "Why bother? The jar is empty."
?L46:	EQUAL? PRSI,TORCH /?L49
	PRINTI "Why waste precious liquid? But, if you insist, done! The liquid evaporates in a few moments."
	CRLF
	CALL PRINT-ID,STR?20
	SET 'OIL-LEFT,0
	REMOVE LIQUID
	RTRUE
?L49:	FSET? OIL-JAR,OPENBIT /?L52
	PRINTR "A little tough to get that wick through the closed jar, eh?"
?L52:	PRINTI "The tip of the torch has been covered with the liquid."
	CALL FLAMING?,TORCH >STACK
	ZERO? STACK /?L58
	PRINTI " The torch flares up, singeing your eyebrows. Phew! Close call, there!"
	CALL PRINT-ID,STR?21
	SET 'TORCH-TURNS,0
?L58:	CRLF
	SUB OIL-LEFT,20 >OIL-LEFT
	SET 'OIL-SOAKED,1
	SET 'OILED-TORCH,1
	RETURN OILED-TORCH

	.FUNCT V-POUR-ON
	PRINTR "Foo!"

	.FUNCT V-SPRAY
	CALL V-SQUEEZE >STACK
	RSTACK

	.FUNCT V-SSPRAY
	CALL PERFORM,V?SPRAY,PRSI,PRSO >STACK
	RSTACK

	.FUNCT V-SQUEEZE
	PRINTR "How singularly useless."

	.FUNCT PRE-OIL
	PRINTR "You probably put spinach in your gas tank, too."

	.FUNCT V-OIL
	PRINTR "That's not very useful."

	.FUNCT PRE-FILL,T
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	ZERO? PRSI \?L6
	GETPT HERE,P?GLOBAL >T
	ZERO? T /?L6
	PTSIZE T >STACK
	CALL ZMEMQB,GLOBAL-WATER,T,STACK >STACK
	ZERO? STACK /?L4
	SET 'PRSI,GLOBAL-WATER
	RFALSE
?L4:	PRINTI "There is nothing to fill it with."
	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L9
	PRINTI " Except for some sand."
?L9:	CRLF
	RTRUE
?L6:	EQUAL? PRSI,GLOBAL-WATER /FALSE
	CALL PERFORM,V?PUT,PRSI,PRSO
	RTRUE

	.FUNCT V-FILL
	ZERO? PRSI \?L1
	CALL GLOBAL-IN?,GLOBAL-WATER,HERE >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?FILL,PRSO,GLOBAL-WATER >STACK
	RSTACK
?L3:	PRINTI "There's nothing to fill it with."
	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L8
	PRINTI " Except for maybe some sand."
?L8:	CRLF
	RTRUE
?L1:	EQUAL? PRSI,GLOBAL-WATER \?L13
	EQUAL? WATER-LEFT,40 /?L16
	IN? C-SAND,PRSO \?L14
?L16:	PRINTR "It's already full."
?L14:	FSET? PRSO,CONTBIT /?L19
	CALL HOW?,PRSO
	RTRUE
?L19:	FSET? PRSO,OPENBIT /?L20
	PRINTI "Tough to do when the "
	PRINTD PRSO
	PRINTR " is closed."
?L20:	EQUAL? PRSO,SILVER-CUP,GOLD-CUP,CANTEEN /?L23
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L23:	IN? LIQUID,PRSO \?L26
	PRINTR "Oil and water don't mix."
?L26:	MOVE WATER,PRSO
	EQUAL? HERE,RIVER-BANK \?L30
	SET 'WATER-LEFT,40
	JUMP ?L32
?L30:	SET 'WATER-LEFT,0
?L32:	PRINTI "Okay, you have filled the "
	PRINTD PRSO
	PRINTR "."
?L13:	EQUAL? PRSI,WATER \?L35
	IN? LIQUID,PRSO \?L36
	PRINTR "Oil and water don't mix."
?L36:	CALL PERFORM,V?POUR-IN,WATER,PRSO
	CALL THIS-IS-IT,PRSO
	RTRUE
?L35:	EQUAL? PRSI,LIQUID,OIL-JAR \?L41
	IN? WATER,PRSO \?L42
	PRINTR "Water and oil don't mix."
?L42:	CALL PERFORM,V?POUR-IN,LIQUID,PRSO
	RTRUE
?L41:	PRINTR "You may know how to do that, but I don't."

	.FUNCT V-ADVENTURE
	PRINTR "A hollow voice says ""Fool."""

	.FUNCT V-DRINK
	CALL PRE-EAT >STACK
	ZERO? STACK \TRUE
	CALL V-EAT >STACK
	RSTACK

	.FUNCT PRE-EAT
	IN? PRSO,WINNER /FALSE
	FSET? PRSO,FOODBIT \?L1
	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \TRUE
	PRINTI "(Taken)"
	CRLF
	RFALSE
?L1:	IN? PRSO,WINNER /FALSE
	EQUAL? PRSO,ME,WINNER,ADVENTURER /FALSE
	FSET? PRSO,FOODBIT \FALSE
	PRINTI "You're not holding the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-EAT,EAT?=0,DRINK?=0,NOBJ=0
	FSET? PRSO,FOODBIT /?L3
	SET 'EAT?,0
	JUMP ?L1
?L3:	SET 'EAT?,1
	IN? PRSO,WINNER \?L1
	EQUAL? PRSA,V?DRINK \?L5
	PRINTI "How can you drink that?"
	CALL PRINT-ID,STR?22
	CRLF
	RTRUE
?L5:	PRINTI "That really hit the spot. It did make you a little thirstier, though."
	CALL PRINT-ID,STR?23
	REMOVE PRSO
	ADD THIRST,10 >THIRST
	CALL INT,I-GROWL >STACK
	PUT STACK,0,0
	GETP HERE,P?MAP >STACK
	ZERO? STACK \?L12
	CALL QUEUE,I-PYRAMID-DRINK,-1 >STACK
	PUT STACK,0,1
?L12:	CRLF
	RTRUE
?L1:	FSET? PRSO,DRINKBIT /?L16
	SET 'DRINK?,0
	JUMP ?L15
?L16:	SET 'DRINK?,1
	IN? PRSO,GLOBAL-OBJECTS /?L20
	LOC PRSO >NOBJ
	ZERO? NOBJ /?L18
	IN? NOBJ,WINNER \?L18
	FSET? NOBJ,OPENBIT \?L18
?L20:	PRINTI "You feel much refreshed."
	CALL PRINT-ID,STR?24
	ZERO? SANDY-CANTEEN /?L23
	PRINTI " Some sand from the bottom of the canteen is gritty in your mouth, though."
?L23:	CRLF
	SUB WATER-LEFT,10 >WATER-LEFT
	LESS? WATER-LEFT,10 \?L28
	REMOVE PRSO
?L28:	SET 'THIRST,0
	SET 'PYR-THIRST,0
	CALL INT,I-PYRAMID-DRINK >STACK
	PUT STACK,0,0
	RTRUE
?L18:	IN? PRSO,LOCAL-GLOBALS \?L31
	GRTR? NILE-DRINKS,3 \?L32
	PRINTI "You're going to start sloshing around soon."
	CRLF
	CALL PRINT-ID,STR?25
	RTRUE
?L32:	PRINTI "You kneel down and drink deeply from the Nile and feel refreshed."
	CRLF
	CALL PRINT-ID,STR?26
	INC 'NILE-DRINKS
	SET 'THIRST,0
	SET 'PYR-THIRST,0
	CALL INT,I-PYRAMID-DRINK >STACK
	PUT STACK,0,0
	RTRUE
?L31:	PRINTR "I'd like to oblige, but it's not within easy reach."
?L15:	ZERO? EAT? \FALSE
	ZERO? DRINK? \FALSE
	PRINTI "I don't think that the "
	PRINTD PRSO
	PRINTI " would agree with you."
	CRLF
	CALL PRINT-ID,STR?27 >STACK
	RSTACK

	.FUNCT V-CURSES
	CALL PRINT-ID,STR?28
	ZERO? PRSO /?L1
	FSET? PRSO,VILLAIN \?L3
	PRINTR "Insults of this nature won't help you."
?L3:	PRINTR "What a loony!"
?L1:	PRINTR "Such language in a high-class establishment like this!"

	.FUNCT V-LISTEN
	PRINTI "The "
	PRINTD PRSO
	PRINTR " makes no sound."

	.FUNCT V-FOLLOW
	PRINTR "Give me a break!"

	.FUNCT V-STAY
	PRINTR "You will be lost without me!"

	.FUNCT V-PRAY
	INC 'PRAYER-HACK
	LESS? PRAYER-HACK,3 \?L1
	PRINTR "If you pray enough, your prayers may be answered."
?L1:	PRINTR "No one is listening..."

	.FUNCT V-LEAP,T,S
	EQUAL? PRSO,0,INTDIR /?L1
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L1:	GETPT HERE,P?DOWN >T
	ZERO? T /?L3
	PTSIZE T >S
	EQUAL? S,2 /?L6
	EQUAL? S,4 \?L4
	GETB T,1 >STACK
	VALUE STACK >STACK
	ZERO? STACK \?L4
?L6:	PRINTI "This was not a very safe place to try jumping."
	CRLF
	CALL PRINT-ID,STR?29
	CALL PICK-ONE,JUMPLOSS >STACK
	CALL JIGS-UP,STACK >STACK
	RSTACK
?L4:	CALL V-SKIP >STACK
	RSTACK
?L3:	CALL V-SKIP >STACK
	RSTACK

	.FUNCT V-SKIP
	CALL PICK-ONE,WHEEEEE >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-LEAVE
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-HELLO
	ZERO? PRSO /?L1
	PRINTI "I think that only schizophrenics say ""Hello"" to a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "."
?L1:	CALL PICK-ONE,HELLOS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT PRE-READ
	ZERO? LIT \?L1
	PRINTR "It is impossible to read in the dark."
?L1:	ZERO? PRSI /FALSE
	PRINTI "How does one look through a"
	CALL VOWEL?,PRSI
	PRINTD PRSI
	PRINTR "?"

	.FUNCT V-READ
	FSET? PRSO,READBIT /?L1
	EQUAL? PRSO,WALLS /?L8
	PRINTI "How can I read a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "?"
?L1:	EQUAL? PRSO,WALLS \?L7
?L8:	PRINTR "There's nothing on the walls worth reading."
?L7:	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-LOOK-UNDER
	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L1
	PRINTR "There is nothing but sand there."
?L1:	PRINTR "There is nothing but dust there."

	.FUNCT V-LOOK-DOWN
	PRINTR "You can't see anything down there."

	.FUNCT V-LOOK-BEHIND
	PRINTI "There is nothing behind the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-LOOK-INSIDE,REACH?=0
	FSET? PRSO,DOORBIT \?L1
	FSET? PRSO,OPENBIT \?L3
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is open."
?L3:	PRINTI "The "
	PRINTD PRSO
	PRINTR " is closed."
?L1:	FSET? PRSO,CONTBIT \?L10
	FSET? PRSO,VICBIT \?L11
	PRINTI "There is nothing special to be "
	ZERO? REACH? /?L15
	PRINTI "felt"
	JUMP ?L19
?L15:	PRINTI "seen"
?L19:	PRINTR "."
?L11:	CALL SEE-INSIDE?,PRSO >STACK
	ZERO? STACK /?L24
	FIRST? PRSO >STACK \?L25
	CALL PRINT-CONT,PRSO >STACK
	ZERO? STACK \TRUE
?L25:	FSET? PRSO,SURFACEBIT \?L27
	IN? WINNER,PRSO \?L28
	PRINTR "You're on it!"
?L28:	PRINTI "There is nothing on the "
	PRINTD PRSO
	PRINTR "."
?L27:	PRINTI "The "
	PRINTD PRSO
	PRINTR " is empty."
?L24:	PRINTI "The "
	PRINTD PRSO
	PRINTR " is closed."
?L10:	PRINTI "I don't know how to "
	ZERO? REACH? \?L44
	PRINTI "look inside a"
	JUMP ?L48
?L44:	PRINTI "feel inside a"
?L48:	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "."

	.FUNCT SEE-INSIDE?,OBJ
	FSET? OBJ,INVISIBLE /FALSE
	FSET? OBJ,OPENBIT \FALSE
	RTRUE

	.FUNCT V-REPENT
	PRINTR "It could very well be too late!"

	.FUNCT PRE-BURN
	EQUAL? PRSO,TORCH \?L19
	EQUAL? PRSI,ONE-MATCH,MANY-MATCHES \?L1
	IN? ONE-MATCH,WINNER /?L3
	IN? MATCHES,WINNER \?L1
?L3:	CALL FLAMING?,PRSI >STACK
	ZERO? STACK \?L10
	LESS? MATCH-COUNT,1 \?L6
	PRINTR "You're out of matches. Sorry."
?L6:	IN? ONE-MATCH,WINNER /?L11
	PRINTI "(lighting a match first)"
	CRLF
	CALL MATCH-MOVER
	JUMP ?L15
?L11:	PRINTI "(lighting the match first)"
	CRLF
?L15:	CALL LIGHT-THE,ONE-MATCH,1
	CALL QUEUE,I-MATCH-OUT,3 >STACK
	PUT STACK,0,1
?L10:	CALL PERFORM,V?LAMP-ON,TORCH,ONE-MATCH
	RTRUE
?L1:	EQUAL? PRSO,TORCH \?L19
	IN? PRSI,WINNER \?L41
	CALL FLAMING?,PRSI >STACK
	ZERO? STACK /?L19
	CALL PERFORM,V?LAMP-ON,PRSO,PRSI
	RTRUE
?L19:	IN? PRSI,WINNER /?L20
?L41:	IN? PRSI,HERE /?L20
	LOC PRSI >STACK
	LOC STACK >STACK
	EQUAL? STACK,HERE /?L20
	PRINTI "I see no "
	PRINTD PRSI
	PRINTR " here."
?L20:	CALL FLAMING?,PRSI >STACK
	ZERO? STACK \FALSE
	FSET? PRSI,BURNBIT \?L24
	PRINTI "You'd better light "
	EQUAL? PRSI,MANY-MATCHES \?L27
	PRINTI "a match"
	JUMP ?L31
?L27:	PRINTI "the "
	PRINTD PRSI
?L31:	PRINTR " first."
?L24:	PRINTI "With a"
	CALL VOWEL?,PRSI
	PRINTD PRSI
	PRINTR "??!?"

	.FUNCT V-BURN
	EQUAL? PRSO,BOAT,DECK \?L1
	CALL PRINT-ID,STR?30
	CALL JIGS-UP,BARGE-BURN-STR
	RETURN 2
?L1:	FSET? PRSO,BURNBIT \?L5
	IN? PRSO,WINNER \?L6
	PRINTI "The "
	PRINTD PRSO
	PRINTI " catches fire and is consumed."
	CALL PRINT-ID,STR?31
	CALL EMPTY-THE,PRSO
	REMOVE PRSO
	SET 'P-IT-LOC,0
	EQUAL? PRSO,ROPE \FALSE
	SET 'ROPE-TIED,0
	SET 'ROPE-PLACED,0
	RETURN ROPE-PLACED
?L6:	EQUAL? PRSO,BEAM,SHIM \?L17
	LOC PRSO >STACK
	EQUAL? STACK,HERE,BELOW-MAST \?L13
	EQUAL? HERE,BARGE-CENTER,FORE-CABIN,AFT-CABIN /?L14
	EQUAL? HERE,BELOW-DECK,BELOW-MAST \?L13
?L14:	PRINTI "The "
	PRINTD PRSO
	PRINTI " catches fire, but before you have a chance to react, the fire spreads."
	CRLF
	CALL PRINT-ID,STR?32
	CALL JIGS-UP,BARGE-BURN-STR >STACK
	RSTACK
?L13:	EQUAL? PRSO,BEAM,SHIM \?L17
	REMOVE PRSO
	SET 'P-IT-LOC,0
	PRINTI "The "
	PRINTD PRSO
	PRINTI " catches fire and is consumed."
	CRLF
	CALL PRINT-ID,STR?33
	EQUAL? PRSO,BEAM \TRUE
	ZERO? ON-BEAM /?L22
	EQUAL? HERE,WEST-END-OF-PASSAGE \?L22
	IN? PLASTER,HERE /?L22
	CALL PRINT-ID,STR?34
	CALL JIGS-UP,AIR-WALK
	RTRUE
?L22:	ZERO? BEAM-PLACED /TRUE
	IN? WINNER,ANNEX \?L25
	CALL PRINT-ID,STR?35
	CALL JIGS-UP,ANNEX-BEAM-STR
	RETURN 2
?L25:	IN? WINNER,BURIAL-CHAMBER \?L29
	CALL PRINT-ID,STR?36
	CALL JIGS-UP,BURIAL-BEAM-STR
	RTRUE
?L29:	IN? WINNER,NORTH-ANTECHAMBER \?L30
	CALL DROP-THE-BLOCKS
	RTRUE
?L30:	IN? WINNER,SOUTH-ANTECHAMBER \TRUE
	CALL CLOSE-THE-ANNEX
	RTRUE
?L17:	PRINTI "You don't have the "
	PRINTD PRSO
	PRINTR "."
?L5:	EQUAL? PRSO,OIL-JAR,LIQUID \?L38
	CALL FLAMING?,PRSI >STACK
	ZERO? STACK /?L38
	CALL PERFORM,V?DIP-IN,PRSI,OIL-JAR
	RTRUE
?L38:	PRINTI "I don't think you can burn the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?37,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?38,STACK >STACK
	RSTACK

	.FUNCT PRE-TURN
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	FSET? PRSO,TURNBIT /?L3
	PRINTR "You can't turn that!"
?L3:	ZERO? PRSI /FALSE
	EQUAL? PRSI,INTDIR \FALSE
	PRINTR "You can't turn things to a specific direction."

	.FUNCT V-TURN
	PRINTR "This has no effect."

	.FUNCT V-PUMP
	PRINTR "I really don't see how."

	.FUNCT V-INFLATE
	PRINTR "How can you inflate that?"

	.FUNCT V-DEFLATE
	PRINTR "Come on, now!"

	.FUNCT V-LOCK
	PRINTR "It doesn't seem to work."

	.FUNCT V-PICK
	PRINTR "You can't pick that."

	.FUNCT V-UNLOCK
	CALL V-LOCK >STACK
	RSTACK

	.FUNCT V-CUT
	FSET? PRSI,WEAPONBIT /?L1
	EQUAL? PRSI,HANDS \?L3
	PRINTR "Be serious. Karate chop it? Come on!"
?L3:	PRINTI "I doubt that the ""cutting edge"" of a"
	CALL VOWEL?,PRSI
	PRINTD PRSI
	PRINTR " is adequate."
?L1:	PRINTI "Strange concept, cutting the "
	PRINTD PRSO
	PRINTI "...."
	CRLF
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?39,STACK
	CALL IS-SELF-OR-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?40,STACK >STACK
	RSTACK

	.FUNCT V-KILL
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?41,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?42,STACK
	CALL IKILL,STR?43 >STACK
	RSTACK

	.FUNCT IKILL,STR
	ZERO? PRSO \?L1
	PRINTI "There is nothing here to "
	PRINT STR
	PRINTR "."
?L1:	FSET? PRSO,VILLAIN /?L5
	FSET? PRSO,VICBIT /?L5
	PRINTI "I've known strange people, but fighting a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "?"
?L5:	ZERO? PRSI /?L11
	EQUAL? PRSI,HANDS \?L10
?L11:	PRINTI "Trying to "
	PRINT STR
	PRINTI " a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTI " with your bare hands is suicidal."
	CRLF
	CALL PRINT-ID,STR?44 >STACK
	RSTACK
?L10:	IN? PRSI,WINNER /?L16
	PRINTI "You aren't even holding the "
	PRINTD PRSI
	PRINTR "."
?L16:	FSET? PRSI,WEAPONBIT /?L19
	PRINTI "Trying to "
	PRINT STR
	PRINTI " the "
	PRINTD PRSO
	PRINTI " with a"
	CALL VOWEL?,PRSI
	PRINTD PRSI
	PRINTI " is suicidal."
	CRLF
	CALL PRINT-ID,STR?45 >STACK
	RSTACK
?L19:	PRINTR "You can't."

	.FUNCT V-ATTACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?46,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?47,STACK
	CALL IKILL,STR?48 >STACK
	RSTACK

	.FUNCT V-SWING
	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L1
	PRINTR "Who do you think you are, Benny Goodman?"
?L1:	PRINTR "Whoosh!"

	.FUNCT V-KICK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?49,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?50,STACK
	CALL HACK-HACK,STR?51 >STACK
	RSTACK

	.FUNCT V-WAVE
	CALL HACK-HACK,STR?52 >STACK
	RSTACK

	.FUNCT V-RAISE
	CALL HACK-HACK,STR?53 >STACK
	RSTACK

	.FUNCT V-LOWER
	CALL HACK-HACK,STR?53 >STACK
	RSTACK

	.FUNCT V-RUB
	CALL HACK-HACK,STR?54 >STACK
	RSTACK

	.FUNCT V-PUSH
	CALL HACK-HACK,STR?55 >STACK
	RSTACK

	.FUNCT PRE-PUSH-TO
	IN? PRSO,GLOBAL-OBJECTS /?L3
	IN? PRSO,LOCAL-GLOBALS \?L1
?L3:	PRINTR "Nice try."
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSO,SARCOPH \?L7
	PRINTR "Be serious. Any idea what that must weigh?"
?L7:	LOC WINNER >STACK
	IN? PRSO,STACK /FALSE
	IN? PRSO,WINNER /FALSE
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	PRINTI "Huh? The "
	PRINTD PRSO
	PRINTR "? Get serious."

	.FUNCT V-PUSH-TO,OFFS=-3,FLG=0
	EQUAL? PRSO,HUGE-STATUE /?L1
	FSET? PRSO,TAKEBIT \?L6
	PRINTR "There's no need for that. Why not just pick it up and then carry it there?"
?L1:	FSET? PRSO,TAKEBIT /?L5
?L6:	PRINTI "You push and strain, but can't budge the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	JUMP ?L14
?L5:	EQUAL? PRSI,INTDIR /?L8
	PRINTR "You can't push things to that."
?L8:	EQUAL? HERE,LANDING-ZERO \?L14
	EQUAL? P-DIRECTION,P?NE,P?NW,P?SE /?L12
	EQUAL? P-DIRECTION,P?SW /?L12
	SET 'FLG,1
	JUMP ?L14
?L12:	SET 'FLG,3
?L14:	ZERO? FLG \?L19
?L18:	ADD OFFS,3 >OFFS
	GRTR? OFFS,9 /?L19
	GET PUSH-TBL,OFFS >STACK
	EQUAL? HERE,STACK \?L18
	ADD OFFS,1 >STACK
	GET PUSH-TBL,STACK >STACK
	EQUAL? P-DIRECTION,STACK \?L23
	SET 'FLG,2
	JUMP ?L18
?L23:	ADD OFFS,2 >STACK
	GET PUSH-TBL,STACK >STACK
	EQUAL? P-DIRECTION,STACK /?L25
	SET 'FLG,1
	JUMP ?L18
?L25:	SET 'FLG,3
	JUMP ?L18
?L19:	EQUAL? FLG,1 \?L29
	PRINTR "The statue bumps into a wall."
?L29:	EQUAL? FLG,2 \?L33
	PRINTR "It won't fit through the door."
?L33:	EQUAL? FLG,3 \FALSE
	CALL DO-WALK,P-DIRECTION
	MOVE HUGE-STATUE,HERE
	CALL THIS-IS-IT,HUGE-STATUE
	PRINTR "The pushed statue rests on the floor."

	.FUNCT PRE-MUNG
	EQUAL? PRSO,WINNER,ME,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSO,ADVENTURER /FALSE
	EQUAL? PRSO,N-ANTE-SEAL \?L4
	CALL BREAK-SEAL >STACK
	ZERO? STACK \TRUE
	PRINTR "You scratch at the seals but accomplish little."
?L4:	EQUAL? PRSO,LOCK,PLASTER1,PLASTER /FALSE
	EQUAL? PRSO,CRATE,HEAD,HUGE-STATUE /FALSE
	EQUAL? PRSO,BEAM,BLACK-BOX /FALSE
	FSET? PRSO,VICBIT /?L12
	CALL HACK-HACK,STR?56 >STACK
	RSTACK
?L12:	ZERO? PRSI \?L13
	PRINTI "Trying to destroy the "
	PRINTD PRSO
	PRINTI " with your bare hands is suicidal."
	CRLF
	CALL PRINT-ID,STR?57 >STACK
	RSTACK
?L13:	FSET? PRSI,WEAPONBIT /FALSE
	PRINTI "Trying to destroy the "
	PRINTD PRSO
	PRINTI " with a"
	CALL VOWEL?,PRSI
	PRINTD PRSI
	PRINTI " is quite self-destructive."
	CRLF
	CALL PRINT-ID,STR?58 >STACK
	RSTACK

	.FUNCT V-MUNG
	PRINTR "Nothing much happens."

	.FUNCT HACK-HACK,STR
	IN? PRSO,GLOBAL-OBJECTS \?L1
	EQUAL? PRSA,V?LOWER,V?RAISE,V?WAVE \?L1
	PRINTI "The "
	PRINTD PRSO
	PRINTR " isn't here!"
?L1:	PRINT STR
	PRINTD PRSO
	CALL PICK-ONE,HO-HUM >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT WORD-TYPE,OBJ,WORD,SYNS
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,WORD,SYNS,STACK >STACK
	RSTACK

	.FUNCT V-KNOCK
	PRINTI "Why knock on a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "?"

	.FUNCT V-CHOMP
	PRINTR "I don't know how to do that. I win in all cases!"

	.FUNCT V-FROBOZZ
	PRINTR "The FROBOZZ Corporation created, owns, and operates this programmer."

	.FUNCT V-WIN
	PRINTR "Naturally!"

	.FUNCT V-YELL
	PRINTR "Aarrrrrgggggggghhhhhhhhhhh!"

	.FUNCT V-PLUG
	PRINTR "This has no effect."

	.FUNCT V-EXORCISE
	PRINTR "What a bizarre concept!"

	.FUNCT V-SHAKE,X
	FSET? PRSO,VILLAIN \?L1
	PRINTR "This seems to have no effect."
?L1:	EQUAL? PRSO,HANDS \?L5
	PRINTR "Nice to meet me. Funny, you think I look like myself."
?L5:	FSET? PRSO,TAKEBIT /?L8
	PRINTR "You can't take it; thus, you can't shake it!"
?L8:	FSET? PRSO,OPENBIT /?L11
	FIRST? PRSO >STACK \?L11
	PRINTI "It sounds as if there is something inside the "
	PRINTD PRSO
	PRINTR "."
?L11:	EQUAL? PRSO,LIQUID,OIL-JAR \?L14
	IN? LIQUID,OIL-JAR \?L14
	PRINTR "The liquid sloshes around."
?L14:	FSET? PRSO,OPENBIT \?L17
	FIRST? PRSO >STACK \?L17
?L18:	FIRST? PRSO >X \?L19
	MOVE X,HERE
	JUMP ?L18
?L19:	PRINTI "All of the objects spill onto the "
	CALL SPILL-WHERE? >STACK
	RSTACK
?L17:	PRINTI "There's nothing in the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT SPILL-WHERE?
	IN? WINNER,COT \?L1
	PRINTR "ground by the cot."
?L1:	EQUAL? HERE,RIVER-BANK \?L5
	PRINTR "river bank."
?L5:	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L8
	PRINTR "sand."
?L8:	GETP HERE,P?ACTION >STACK
	EQUAL? STACK,BURN-THE-BARGE \?L11
	PRINTR "wooden decking."
?L11:	PRINTR "stone floor."

	.FUNCT PRE-DIG
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	ZERO? PRSI \?L11
	IN? SHOVEL,WINNER \?L4
	SET 'PRSI,SHOVEL
	PRINTI "(with the shovel)"
	CRLF
	JUMP ?L11
?L4:	IN? PICK-AXE,WINNER \?L8
	SET 'PRSI,PICK-AXE
	PRINTI "(with the axe)"
	CRLF
	JUMP ?L11
?L8:	SET 'PRSI,HANDS
	PRINTI "(with your hands)"
	CRLF
?L11:	FSET? PRSI,TOOLBIT /FALSE
	PRINTI "Digging with the "
	PRINTD PRSI
	PRINTR " is very silly."

	.FUNCT V-DIG,COUNTER
	EQUAL? PRSO,PLASTER1,PLASTER,WALLS \?L1
	CALL PERFORM,V?MUNG,PRSO,PRSI
	RTRUE
?L1:	EQUAL? PRSO,SAND,GROUND,HOLE /?L3
	PRINTR "You can't dig in that."
?L3:	EQUAL? HERE,RIVER-BANK \?L6
	PRINTR "You dig a small hole, but it quickly fills in with water and sand, almost immediately disappearing."
?L6:	GETP HERE,P?CAPACITY >STACK
	ZERO? STACK \?L9
	PRINTR "The ground is too hard here."
?L9:	EQUAL? PRSI,HANDS \?L12
	PRINTR "I suppose you also excavate tunnels with a teaspoon?!"
?L12:	EQUAL? PRSI,PICK-AXE \?L15
	PRINTR "Let's face it, for digging in the sand, the axe is cute but ineffective."
?L15:	GETP HERE,P?CAPACITY >COUNTER
	INC 'COUNTER
	ADD THIRST,4 >THIRST
	GRTR? COUNTER,5 \?L19
	EQUAL? HERE,EX8 /?L19
	CALL PRINT-ID,STR?59
	CALL JIGS-UP,STR?60
	RETURN 2
?L19:	PUTP HERE,P?CAPACITY,COUNTER
	EQUAL? COUNTER,6 \?L24
	EQUAL? HERE,EX8 \?L24
	PRINTI "You've uncovered what could only be the top of a pyramid. After clearing it away with your hands, you notice a square opening in the top of it."
	CRLF
	PUTP HERE,P?CAPACITY,6
	PUTP HERE,P?LDESC,STR?61
	FCLEAR ROCK-LOCK,INVISIBLE
	MOVE PYRAMID,HERE
	ADD SCORE,25 >SCORE
	RETURN SCORE
?L24:	GET DIGGER-LTBL,COUNTER >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-SMELL
	EQUAL? PRSO,LIQUID \?L1
	PRINTR "It smells like a mixture of gasoline and embalming fluid. Yum Yum."
?L1:	CALL FLAMING?,PRSO >STACK
	ZERO? STACK /?L5
	PRINTI "Nice way to singe your nostrils!"
	CRLF
	CALL PRINT-ID,STR?62 >STACK
	RSTACK
?L5:	EQUAL? PRSO,SKELETON \?L8
	PRINTR "It smells quite dead."
?L8:	EQUAL? PRSO,MAP \?L11
	PRINTR "It smells a little musty."
?L11:	PRINTI "It smells just like a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "."

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,T
	GETPT OBJ2,P?GLOBAL >T
	ZERO? T /FALSE
	PTSIZE T >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,T,STACK >STACK
	RSTACK

	.FUNCT V-SWIM
	EQUAL? HERE,RIVER-BANK \?L1
	CALL PRINT-ID,STR?63
	CALL JIGS-UP,CROC-STR
	RETURN 2
?L1:	EQUAL? PRSO,NILE-RIBBAH /?L5
	PRINTR "Now that's a cute idea. Maybe I'll try it next century."
?L5:	PRINTR "Go jump in a lake!"

	.FUNCT V-UNTIE
	PRINTR "This cannot be tied, so it cannot be untied!"

	.FUNCT PRE-TIE
	EQUAL? PRSI,WINNER \FALSE
	PRINTR "You can't tie it to yourself."

	.FUNCT V-TIE
	EQUAL? PRSI,SCARAB \?L1
	PRINTR "The rope's too clumsy to tie to that."
?L1:	EQUAL? PRSI,BEAM /?L5
	PRINTI "You can't tie the "
	PRINTD PRSO
	PRINTR " to that."
?L5:	PRINTR "Don't bother."

	.FUNCT V-TIE-UP
	PRINTR "You could certainly never tie it with that!"

	.FUNCT V-MELT
	PRINTI "I'm not sure that a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR " can be melted."

	.FUNCT V-MUMBLE
	PRINTR "You'll have to speak up if you expect me to hear you!"

	.FUNCT V-ALARM
	FSET? PRSO,VILLAIN \?L1
	PRINTR "He's wide awake, or haven't you noticed..."
?L1:	PRINTI "The "
	PRINTD PRSO
	PRINTR " isn't sleeping."

	.FUNCT V-ZORK
	PRINTR "Who?"

	.FUNCT MUNG-ROOM,RM,STR
	FSET RM,RMUNGBIT
	PUTP RM,P?LDESC,STR
	RTRUE

	.FUNCT V-COMMAND
	FSET? PRSO,VICBIT \?L1
	PRINTI "The "
	PRINTD PRSO
	PRINTR " pays no attention."
?L1:	PRINTR "You cannot talk to that!"

	.FUNCT V-CLIMB-ON
	EQUAL? PRSO,ALTAR \?L1
	CALL PERFORM,V?BOARD,ALTAR
	RTRUE
?L1:	FSET? PRSO,VEHBIT /?L4
	EQUAL? PRSO,BEAM \?L3
?L4:	CALL V-CLIMB-UP,P?UP,1 >STACK
	RSTACK
?L3:	EQUAL? PRSO,ROPE \?L5
	CALL PERFORM,V?TAKE,ROPE
	RTRUE
?L5:	PRINTI "You can't climb onto the "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-CLIMB-FOO
	EQUAL? PRSO,ROPE /?L3
	EQUAL? PRSI,ROPE \?L1
?L3:	IN? ROPE,WINNER \?L1
	PRINTI "You can't do that while you're holding the rope."
	CRLF
	RETURN 2
?L1:	EQUAL? PRSO,ALTAR \?L8
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L8:	EQUAL? PRSO,INTDIR \?L9
	PRINTI "You can't climb a direction!"
	CRLF
	RETURN 2
?L9:	FSET? PRSO,CLIMBBIT /?L14
	FSET? PRSO,VEHBIT /?L14
	PRINTI "You can't climb that!"
	CRLF
	RETURN 2
?L14:	EQUAL? HERE,CHAMBER-OF-RA \?L20
	PUSH P?DOWN
	JUMP ?L23
?L20:	EQUAL? PRSO,PLANK \?L22
	PUSH P?NORTH
	JUMP ?L23
?L22:	PUSH P?UP
?L23:	CALL V-CLIMB-UP,STACK,1 >STACK
	RSTACK

	.FUNCT V-CLIMB-UP,DIR=P?UP,OBJ=0,X
	ZERO? OBJ /?L1
	GETPT PRSO,P?SYNONYM >X
	PTSIZE X >STACK
	CALL ZMEMQ,W?BEAM,X,STACK >STACK
	ZERO? STACK /?L1
	ZERO? ON-BEAM /?L3
	IN? BEAM,WEST-END-OF-PASSAGE \?L7
	PRINTI "You're already on the beam."
	CRLF
	JUMP ?L13
?L3:	IN? BEAM,WEST-END-OF-PASSAGE \?L7
	PRINTI "You are now standing on the beam."
	CRLF
	JUMP ?L13
?L7:	FSET? BEAM,TOUCHBIT \?L10
	IN? BEAM,HERE \?L10
	ZERO? BEAM-PLACED \?L10
	PRINTR "You step onto it, see no sense in remaining on it, then step off it."
?L10:	PRINTR "Get real. You don't have fly feet."
?L13:	SET 'ON-BEAM,1
	RETURN ON-BEAM
?L1:	GETPT HERE,DIR >STACK
	ZERO? STACK /?L16
	CALL DO-WALK,DIR
	RTRUE
?L16:	ZERO? OBJ \?L26
	PRINTR "You can't go that way."
?L26:	GETPT PRSO,P?SYNONYM >X
	PTSIZE X >STACK
	CALL ZMEMQ,W?WALLS,X,STACK >STACK
	ZERO? STACK /?L20
	PRINTR "Climbing the walls is to no avail."
?L20:	PRINTR "Bizarre!"

	.FUNCT V-CLIMB-DOWN
	EQUAL? PRSO,ROPE,P?NORTH,P?DOWN \?L1
	ZERO? LANDING \?L1
	PRINTR "It would help if the rope led someplace."
?L1:	CALL V-CLIMB-UP,P?DOWN >STACK
	RSTACK

	.FUNCT V-SEND
	FSET? PRSO,VILLAIN \?L1
	PRINTI "Why would you send for the "
	PRINTD PRSO
	PRINTR "?"
?L1:	PRINTR "That doesn't make sends."

	.FUNCT V-WIND
	PRINTI "You cannot wind up a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-COUNT,OBJS,CNT
	EQUAL? PRSO,STONES \?L1
	PRINTR "There are a lot of stones in the pyramid (about 90,000,000 cubic feet)."
?L1:	EQUAL? PRSO,DRACULA,BLESSINGS,FINGER /?L6
	EQUAL? PRSO,BASIE \?L5
?L6:	PRINTR "What a maroon! What a cahd!"
?L5:	PRINTI "You have "
	EQUAL? PRSO,MATCHES,MANY-MATCHES \?L12
	SUB MATCH-COUNT,1 >CNT
	PRINTN CNT
	PRINTI " match"
	EQUAL? CNT,1 /?L16
	PRINTR "es."
?L16:	PRINTR "."
?L12:	PRINTR "a weird sense of counting!"

	.FUNCT V-PUT-UNDER
	PRINTR "You can't do that."

	.FUNCT V-PLAY
	FSET? PRSO,VILLAIN \?L1
	PRINTI "You are so engrossed in the role of the "
	PRINTD PRSO
	PRINTI " that you kill yourself, just as he would have done!"
	CRLF
	CALL PRINT-ID,STR?64
	CALL JIGS-UP,STR?65 >STACK
	RSTACK
?L1:	PRINTR "How peculiar!"

	.FUNCT V-MAKE
	PRINTR "You can't do that."

	.FUNCT V-ENTER
	CALL DO-WALK,P?IN >STACK
	RSTACK

	.FUNCT V-EXIT
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-CROSS
	PRINTR "You can't cross that!"

	.FUNCT V-SEARCH
	PRINTR "You find nothing unusual."

	.FUNCT V-FIND,L
	LOC PRSO >L
	EQUAL? PRSO,HANDS \?L1
	PRINTR "Within six feet of your head, assuming you haven't left that somewhere."
?L1:	EQUAL? L,GLOBAL-OBJECTS \?L5
	PRINTR "Why don't you try finding it yourself?"
?L5:	IN? PRSO,WINNER \?L8
	PRINTR "You have it."
?L8:	IN? PRSO,ENDLESS-DESERT \?L11
	PRINTR "With all this sand around here? Give me a break!"
?L11:	IN? PRSO,HERE /?L15
	EQUAL? PRSO,PSEUDO-OBJECT \?L14
?L15:	PRINTR "It's right here."
?L14:	FSET? L,VILLAIN \?L18
	PRINTI "The "
	PRINTD L
	PRINTR " has it."
?L18:	FSET? L,CONTBIT \?L21
	PRINTI "It's "
	FSET? L,SURFACEBIT \?L24
	PRINTI "on"
	JUMP ?L28
?L24:	PRINTI "in"
?L28:	PRINTI " the "
	PRINTD L
	PRINTR "."
?L21:	PRINTR "Beats me."

	.FUNCT V-TELL
	FSET? PRSO,VICBIT \?L1
	SET 'WINNER,PRSO
	LOC WINNER >HERE
	RETURN HERE
?L1:	EQUAL? PRSO,ME,WINNER \?L3
	PRINTI "Talking to yourself is diverting, but unnecessary."
	CRLF
	RETURN 2
?L3:	PRINTI "You can't talk to the "
	PRINTD PRSO
	PRINTI "!"
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	RETURN 2

	.FUNCT V-ANSWER
	PRINTI "Nobody seems to be awaiting your answer."
	CRLF
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RTRUE

	.FUNCT V-REPLY
	PRINTI "It is hardly likely that the "
	PRINTD PRSO
	PRINTI " is interested."
	CRLF
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RTRUE

	.FUNCT V-IS-IN
	IN? PRSO,PRSI \?L1
	PRINTI "Yes, it is "
	FSET? PRSI,SURFACEBIT \?L5
	PRINTI "on"
	JUMP ?L9
?L5:	PRINTI "in"
?L9:	PRINTI " the "
	PRINTD PRSI
	PRINTR "."
?L1:	PRINTR "No, it isn't."

	.FUNCT V-KISS
	PRINTI "I'd sooner kiss a pig."
	CRLF
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?66,STACK >STACK
	RSTACK

	.FUNCT V-RAPE
	PRINTI "An ugly idea from an ugly human."
	CRLF
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?67,STACK >STACK
	RSTACK

	.FUNCT FIND-IN,WHERE,WHAT,W
	FIRST? WHERE >W \FALSE
?L2:	FSET? W,WHAT \?L7
	RETURN W
?L7:	NEXT? W >W /?L2
	RFALSE

	.FUNCT V-SAY,V
	CALL FIND-IN,HERE,VICBIT >V
	ZERO? V /?L1
	PRINTI "You must address the "
	PRINTD V
	PRINTR " directly."
?L1:	GET P-LEXV,P-CONT >STACK
	EQUAL? STACK,W?HELLO \?L5
	SET 'QUOTE-FLAG,0
	RTRUE
?L5:	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	PRINTR "Talking to yourself is said to be a sign of impending mental collapse."

	.FUNCT V-INCANT
	PRINTI "The incantation echoes back faintly, but nothing else happens."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	RTRUE

	.FUNCT V-SPIN
	PRINTR "You can't spin that!"

	.FUNCT V-THROUGH,M
	FSET? PRSO,DOORBIT \?L1
	CALL OTHER-SIDE,PRSO >STACK
	CALL DO-WALK,STACK
	RTRUE
?L1:	FSET? PRSO,VEHBIT \?L3
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L3:	FSET? PRSO,TAKEBIT /?L4
	PRINTI "You hit your head against the "
	PRINTD PRSO
	PRINTI " as you attempt this feat."
	CRLF
	CALL PRINT-ID,STR?68 >STACK
	RSTACK
?L4:	IN? PRSO,WINNER \?L7
	PRINTR "That would involve quite a contortion!"
?L7:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-WEAR
	FSET? PRSO,WEARBIT /?L1
	PRINTI "You can't wear the "
	PRINTD PRSO
	PRINTR "."
?L1:	CALL PERFORM,V?TAKE,PRSO
	RTRUE

	.FUNCT V-THROW-OFF
	EQUAL? PRSI,BOAT,ALTAR,DECK /?L1
	PRINTR "You can't throw anything off of that!"
?L1:	EQUAL? PRSI,DECK,BOAT \?L5
	EQUAL? HERE,BARGE-CENTER /?L6
	PRINTR "From where you are now? Get serious."
?L6:	PRINTI "Thrown. You hear it land in the darkness to the south."
	CRLF
	CALL IS-FRAGILE-OBJECT? >STACK
	CALL PRINT-ID,STR?69,STACK
	MOVE PRSO,BARGE-ENTRANCE
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	RTRUE
?L5:	EQUAL? PRSI,ALTAR \FALSE
	IN? WINNER,ALTAR /?L14
	PRINTR "Don't you think you should be standing on the altar first?"
?L14:	CALL PERFORM,V?THROW,PRSO
	RTRUE

	.FUNCT V-$0024VERIFY
	PRINTI "Verifying game..."
	CRLF
	VERIFY \?L3
	PRINTR "Game correct. Don't panic yet."
?L3:	CRLF
	PRINTR "** Game File Failure ** (Panic)"

	.FUNCT V-STAND
	LOC WINNER >STACK
	FSET? STACK,VEHBIT \?L1
	LOC WINNER >STACK
	CALL PERFORM,V?DISEMBARK,STACK
	RTRUE
?L1:	PRINTR "You are already standing, I think."

	.FUNCT V-PUT-BEHIND
	PRINTR "That hiding place is too obvious."

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR >STACK
	RSTACK

	.FUNCT V-WALK-TO
	EQUAL? PRSO,PLANK \?L1
	IN? PRSO,HERE \?L15
	PRINTI "Yo ho."
	CRLF
	EQUAL? HERE,BARGE-ENTRANCE \?L5
	CALL DO-WALK,P?UP
	RTRUE
?L5:	CALL DO-WALK,P?DOWN
	RTRUE
?L1:	IN? PRSO,HERE /?L9
?L15:	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK /?L8
?L9:	PRINTR "It's here!"
?L8:	PRINTR "You should supply a direction!"

	.FUNCT OTHER-SIDE,DOBJ,P=0,T
?L1:	NEXTP HERE,P >P
	LESS? P,P?NW /FALSE
	GETPT HERE,P >T
	PTSIZE T >STACK
	EQUAL? STACK,DEXIT \?L1
	GETB T,DEXITOBJ >STACK
	EQUAL? STACK,DOBJ \?L1
	RETURN P

	.FUNCT V-DRINK-FROM,OBJ
	ZERO? PRSI \?L1
	EQUAL? PRSO,NILE-RIBBAH \?L3
	SET 'OBJ,GLOBAL-WATER
	JUMP ?L17
?L3:	EQUAL? PRSO,CANTEEN \?L5
	SET 'OBJ,WATER
	JUMP ?L17
?L5:	EQUAL? PRSO,OIL-JAR \?L6
	SET 'OBJ,LIQUID
	JUMP ?L17
?L6:	FSET? PRSO,CONTBIT /?L8
	PRINTR "How peculiar!"
?L8:	FIRST? PRSO >STACK /?L12
	PRINTI "There's nothing to drink in the "
	PRINTD PRSO
	PRINTR "."
?L12:	FIRST? PRSO >OBJ /?L16
?L16:	FSET? OBJ,DRINKBIT /?L17
	PRINTI "I don't think there's anything worth drinking in the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?70,STACK
	RTRUE
?L17:	CALL PERFORM,V?DRINK,OBJ
	RTRUE
?L1:	EQUAL? PRSO,GLOBAL-WATER,WATER \?L22
	EQUAL? PRSI,NILE-RIBBAH \?L22
	EQUAL? HERE,RIVER-BANK /?L23
	PRINTI "I see no "
	PRINTD PRSO
	PRINTR " here."
?L23:	CALL PERFORM,V?DRINK,PRSO
	RTRUE
?L22:	FSET? PRSI,OPENBIT /?L28
	PRINTI "Better open the "
	PRINTD PRSI
	PRINTR " first."
?L28:	IN? PRSO,PRSI /?L31
	PRINTI "I can't see any "
	PRINTD PRSO
	PRINTI " in the "
	PRINTD PRSI
	PRINTR "."
?L31:	CALL PERFORM,V?DRINK,PRSO
	RTRUE

	.FUNCT V-LEAN-ON
	PRINTR "Are you so very tired, then?"

	.FUNCT V-DIP-IN
	EQUAL? PRSI,GLOBAL-WATER,NILE-RIBBAH \?L1
	EQUAL? PRSO,CANTEEN \?L1
	CALL PERFORM,V?FILL,PRSO,GLOBAL-WATER
	RTRUE
?L1:	EQUAL? PRSI,OIL-JAR,LIQUID /?L3
	PRINTI "You can't dip the "
	PRINTD PRSO
	PRINTR " in that!"
?L3:	CALL FLAMING?,PRSO >STACK
	ZERO? STACK \?L7
	CALL FLAMING?,PRSI >STACK
	ZERO? STACK /?L6
?L7:	CALL PRINT-ID,STR?71
	CALL JIGS-UP,STR?72 >STACK
	RSTACK
?L6:	EQUAL? PRSO,TORCH /?L8
	PRINTI "Huh? Dip the "
	PRINTD PRSO
	PRINTR "!?"
?L8:	CALL PERFORM,V?POUR-ON,OIL-JAR,TORCH
	RTRUE

	.FUNCT V-PUT-AGAINST
	PRINTR "You can't do that."

	.FUNCT BREAK-SEAL
	EQUAL? PRSI,PICK-AXE /?L1
	IN? WINNER,PICK-AXE \FALSE
?L1:	EQUAL? BEAM-PLACED,4 \?L4
	PRINTI "You manage to destroy the seal. You glance to the right and see fine sand running from a crack in the stone. The beam creaks and groans under tremendous pressure as the 3 ton stone block above your head starts to lower. The beam holds the weight, saving you from a flattening fate."
	CRLF
	CALL PRINT-ID,STR?73
	SET 'ANTE-SEAL,0
	CALL THIS-IS-IT,NORTH-ANTE-DOOR
	RTRUE
?L4:	IN? BEAM,NORTH-ANTECHAMBER \?L9
	ZERO? BEAM-PLACED \FALSE
?L9:	CALL JIGS-UP,STR?74
	CALL PRINT-ID,STR?75 >STACK
	RSTACK

	.FUNCT V-TASTE
	PRINTI "It tastes just like a"
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?76,STACK
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "!"

	.FUNCT V-ROLL
	EQUAL? PRSO,HUGE-STATUE /?L1
	PRINTR "Why bother?"
?L1:	PRINTI "The statue bumps into a wall."
	CRLF
	CALL PRINT-ID,STR?77 >STACK
	RSTACK

	.FUNCT V-PUSH-THROUGH
	PRINTI "Pushing the "
	PRINTD PRSO
	PRINTR " in that way isn't particularly helpful."

	.FUNCT HOW?,OBJ
	PRINTI "I don't know how to do that to a"
	CALL VOWEL?,OBJ
	PRINTD OBJ
	PRINTR "."

	.FUNCT VOWEL?,OBJ
	FSET? OBJ,VOWELBIT \?L1
	PRINTI "n"
?L1:	PRINTI " "
	RTRUE

	.FUNCT HUH?,RARG=0
	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL HOW?,PRSO
	RTRUE

	.FUNCT V-SMOKE
	PRINTI "Smoking is bad for your health."
	CRLF
	CALL PRINT-ID,STR?78 >STACK
	RSTACK

	.FUNCT V-UNFOLD
	EQUAL? PRSO,MAP /?L1
	CALL HOW?,PRSO >STACK
	RSTACK
?L1:	CALL PERFORM,V?OPEN,MAP
	RTRUE

	.FUNCT V-FOLD
	EQUAL? PRSO,MAP /?L1
	CALL HOW?,PRSO >STACK
	RSTACK
?L1:	FSET? PRSO,OPENBIT /?L3
	PRINTR "It's already folded up."
?L3:	PRINTI "Okay. The map has been folded."
	CRLF
	FCLEAR MAP,OPENBIT
	RTRUE

	.FUNCT V-HOLE-DIG
	EQUAL? PRSO,HOLE /?L1
	PRINTI "I don't know how to dig a"
	CALL VOWEL?,PRSO
	PRINTD PRSO
	PRINTR "."
?L1:	EQUAL? PRSI,SAND \?L7
	CALL PERFORM,V?DIG,SAND
	RTRUE
?L7:	PRINTI "I can't dig in the "
	PRINTD PRSI
	PRINTR "."

	.FUNCT V-DIG-WITH
	CALL PERFORM,V?DIG,SAND,PRSO
	RTRUE

	.FUNCT V-TURN-OVER
	IN? PRSO,WINNER \?L1
	PRINTR "Okay. There's nothing of interest there."
?L1:	FSET? PRSO,TAKEBIT \?L5
	PRINTR "You'd better pick it up first."
?L5:	PRINTR "Good luck!"

	.FUNCT V-READ-INSIDE
	PRINTR "There's nothing to read there."

	.FUNCT PRE-REACH-IN
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	FSET? PRSO,CONTBIT /?L3
	PRINTR "You can't reach into that."
?L3:	FSET? PRSO,OPENBIT /FALSE
	PRINTI "The "
	PRINTD PRSO
	PRINTR " is closed."

	.FUNCT V-REACH-IN
	CALL PERFORM,V?LOOK-INSIDE,PRSO >STACK
	RSTACK

	.FUNCT V-CLEAN
	PRINTR "Cleanliness may be next to godliness, but there are limits."

	.FUNCT PRE-PULL-UP
	EQUAL? PRSO,BEAM /FALSE
	CALL PERFORM,V?MOVE,PRSO
	RTRUE

	.FUNCT V-PULL-UP
	FSET? BEAM,TOUCHBIT \?L1
	PRINTR "Why bother?"
?L1:	EQUAL? HERE,BARGE-CENTER /?L5
	PRINTR "That's a little tough to do from here."
?L5:	CALL PERFORM,V?PUSH-THROUGH,BEAM,MAST-HOLE >STACK
	RSTACK

	.FUNCT V-THROW-DOWN,FOO
	CALL STAIRWAY-CHECK? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSO,ROPE /?L3
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L3:	EQUAL? PRSI,INTDIR \?L7
	EQUAL? P-DIRECTION,P?NORTH \?L4
	SET 'FOO,NORTH-STAIRS
	JUMP ?L8
?L4:	EQUAL? PRSI,INTDIR \?L7
	EQUAL? P-DIRECTION,P?SOUTH \?L5
	SET 'FOO,SOUTH-STAIRS
	JUMP ?L8
?L5:	EQUAL? PRSI,INTDIR \?L7
	EQUAL? P-DIRECTION,P?EAST \?L6
	SET 'FOO,EAST-STAIRS
	JUMP ?L8
?L6:	EQUAL? PRSI,INTDIR \?L7
	EQUAL? P-DIRECTION,P?WEST \?L7
	SET 'FOO,WEST-STAIRS
	JUMP ?L8
?L7:	SET 'FOO,GROUND
?L8:	CALL PERFORM,V?PUT,PRSO,FOO
	RTRUE

	.FUNCT V-TIME
	PRINTR "Tickity tockity, sprickity sprockety."

	.FUNCT PRE-COMPARE,FLG=0
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	GETP PRSO,P?MAP >STACK
	ZERO? STACK \?L3
	SET 'FLG,1
	JUMP ?L4
?L3:	GETP PRSI,P?MAP >STACK
	GETP PRSO,P?MAP >STACK
	EQUAL? STACK,STACK /?L4
	SET 'FLG,1
?L4:	ZERO? FLG /FALSE
	PRINTI "Comparisons between the "
	PRINTD PRSO
	PRINTI " and the "
	PRINTD PRSI
	PRINTR " would not really help."

	.FUNCT V-COMPARE
	EQUAL? PRSO,STONE-KEY,ROCK-LOCK \?L1
	PRINTR "It looks as if the small cube would fit into the opening almost exactly."
?L1:	GETP PRSO,P?MAP >STACK
	EQUAL? STACK,1 \?L5
	PRINTR "The two chalices are of exactly the same size and dimensions, though empty they have different weights."
?L5:	GETP PRSO,P?MAP >STACK
	EQUAL? STACK,3,4 \?L8
	GETP PRSI,P?MAP >STACK
	GETP PRSO,P?MAP >STACK
	EQUAL? STACK,STACK \?L8
	PRINTR "Looks as if the area is just big enough to hold it."
?L8:	GETP PRSO,P?MAP >STACK
	EQUAL? STACK,3,4 \?L11
	GETP PRSI,P?MAP >STACK
	GETP PRSO,P?MAP >STACK
	EQUAL? STACK,STACK /?L11
	PRINTR "Well, the match up between them wasn't made in heaven."
?L11:	PRINTI "The "
	PRINTD PRSO
	PRINTI " and the "
	PRINTD PRSI
	PRINTR " are the same size."

	.FUNCT V-FOO-COMPARE
	GET P-PRSO,0 >STACK
	LESS? STACK,2 \?L1
	PRINTI "You have to compare the "
	PRINTD PRSO
	PRINTR " to something else."
?L1:	GET P-PRSO,2 >STACK
	GET P-PRSO,1 >STACK
	CALL PERFORM,V?COMPARE,STACK,STACK
	RETURN 2

	.FUNCT V-WEIGH
	FSET? PRSO,TAKEBIT \?L1
	PRINTR "Tough to do without a scale."
?L1:	PRINTR "Now that's bizarre!"

	.FUNCT V-FILL-OUT
	EQUAL? PRSO,MANUAL /?L1
	PRINTR "There's no need for filling that out."
?L1:	PRINTR "Okay. Find me a pen or a pencil and I'll do the best I can."

	.FUNCT V-PLASTER-REMOVE
	EQUAL? PRSO,PLASTER1,PLASTER,N-ANTE-SEAL \?L1
	EQUAL? PRSI,DOORWAY,ANNEX-DOOR,WALLS /?L3
	EQUAL? PRSI,INNER-DOOR,NORTH-ANTE-DOOR \?L1
?L3:	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L1:	CALL PERFORM,V?CLEAN,PRSO >STACK
	RSTACK

	.FUNCT V-CHASTISE
	PRINTI "Please be more specific. LOOKing AT, BEHIND, UNDER, THROUGH, INSIDE, ON, DOWN, FOR, or any other method of LOOKing mean different things to me. Please specify which preposition you'd like to use next time, like LOOK AT THE "
	PRINTD PRSO
	PRINTI ", or LOOK INSIDE THE "
	PRINTD PRSO
	PRINTR "."

	.FUNCT V-LOOK-UP
	LESS? MOVES,8 \?L1
	CALL IN-A-TENT? >STACK
	ZERO? STACK \?L1
	PRINTR "You see a pretty plane. Oh boy!"
?L1:	LOC WINNER >STACK
	EQUAL? STACK,COT \?L5
	MOVE WINNER,HERE
	CALL PERFORM,V?LOOK-UP
	MOVE WINNER,COT
	RTRUE
?L5:	CALL IN-A-TENT? >STACK
	ZERO? STACK /?L6
	PRINTR "You see canvas. What else?"
?L6:	GETP HERE,P?MAP >STACK
	ZERO? STACK \?L10
	EQUAL? HERE,CHAMBER-OF-RA \?L9
?L10:	PRINTR "You see a blue sky with wisps of billowy clouds."
?L9:	EQUAL? HERE,BELOW-MAST,BELOW-DECK,AFT-CABIN /?L14
	EQUAL? HERE,FORE-CABIN \?L13
?L14:	PRINTR "You see wood. What else?"
?L13:	EQUAL? HERE,TEMPLE-ENTER \?L17
	PRINTR "You see inky blackness."
?L17:	PRINTR "You see stones. What else?"

	.FUNCT V-HELP
	EQUAL? PRSO,0,WINNER /?L3
	PRINTI "The "
	PRINTD PRSO
	PRINTR " doesn't need any help."
?L3:	PRINTR "You got yourself into this -- now get yourself out of it."

	.FUNCT V-STAND-UNDER
	EQUAL? PRSO,CRATE,PLANE,PARACHUTE \?L1
	IN? PRSO,GLOBAL-OBJECTS \?L1
	CALL IN-A-TENT? >STACK
	ZERO? STACK \?L3
	PRINTR "It looks like that's just where you are."
?L3:	PRINTR "Better get out of the tent first."
?L1:	PRINTR "You can't stand under that!"

	.FUNCT V-SLEEP
	IN? WINNER,COT \?L1
	PRINTR "You close your eyes, but your mind is too active to let you sleep."
?L1:	IN? COT,HERE \?L5
	MOVE WINNER,COT
	PRINTI "You get into the cot and try to get comfy. "
	CALL PRINT-ID,STR?79
	CALL V-SLEEP
	RTRUE
?L5:	ZERO? PRSO /?L8
	PRINTR "That doesn't sound too comfortable to me."
?L8:	PRINTR "Better find a good place to lie down."

	.FUNCT V-FILL-IN
	EQUAL? PRSO,HOLE,MANUAL /?L1
	PRINTI "I don't know how to fill in the "
	PRINTD PRSO
	PRINTR "."
?L1:	EQUAL? PRSO,HOLE \?L5
	PRINTR "Let time and Mother Nature take care of that."
?L5:	CALL PERFORM,V?FILL-OUT,MANUAL
	RTRUE

	.FUNCT V-WET
	CALL PERFORM,V?POUR-ON,PRSI,PRSO
	RTRUE

	.FUNCT V-SIT-ON
	EQUAL? PRSO,CRATE \?L1
	PRINTI "You easily weigh enough to make the crate's life-cycle far shorter than it would have liked. Needless to say, after having been crushed flat by your heartless attempt, it decides to move on, find what the next life-cycle has in store for it, and vanishes into the mystical unknown."
	CRLF
	CALL PRINT-ID,STR?80
	REMOVE CRATE
	SET 'P-IT-LOC,0
	RTRUE
?L1:	FSET? PRSO,VEHBIT \?L5
	CALL PERFORM,V?CLIMB-ON,PRSO
	RTRUE
?L5:	EQUAL? PRSO,GROUND,SAND,DECK \?L6
	PRINTR "No sitting down on the job, now."
?L6:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT TBL-TO-INSIDE,OBJ,TBL,STR,OFFS=0,MAX
	FSET? OBJ,SURFACEBIT /?L1
	PRINTI "The "
	PRINTD OBJ
	PRINTR " is already open."
?L1:	FIRST? OBJ >STACK \?L6
	CALL OBJS-SLIDE-OFF,OBJ
?L6:	GET TBL,0 >MAX
	ZERO? STR \?L9
	PRINTI "Opened."
	JUMP ?L13
?L9:	PRINT STR
?L13:	FCLEAR OBJ,SURFACEBIT
?L16:	IGRTR? 'OFFS,MAX /?L17
	GET TBL,OFFS >STACK
	ZERO? STACK /?L16
	GET TBL,OFFS >STACK
	MOVE STACK,OBJ
	PUT TBL,OFFS,0
	JUMP ?L16
?L17:	FIRST? OBJ >STACK \?L22
	PRINTI " Opening the "
	PRINTD OBJ
	PRINTI " reveals "
	CALL PRINT-CONTENTS,OBJ
	PRINTI "."
?L22:	CRLF
	RTRUE

	.FUNCT INSIDE-OBJ-TO,TBL,OBJ,OFFS=0,F,N
	FSET? OBJ,SURFACEBIT \?L1
	PRINTI "The "
	PRINTD OBJ
	PRINTR " is already closed."
?L1:	FSET OBJ,SURFACEBIT
	PRINTI "Closed."
	CRLF
	FIRST? OBJ >STACK \TRUE
	FIRST? OBJ >F /?L14
	RTRUE
?L11:	ZERO? F /TRUE
?L14:	SET 'N,F
	NEXT? N >F /?L17
?L17:	REMOVE N
?L18:	INC 'OFFS
	GET TBL,OFFS >STACK
	ZERO? STACK \?L18
	PUT TBL,OFFS,N
	JUMP ?L11

	.FUNCT OBJS-SLIDE-OFF,OBJ,F,N,THERE
	LOC OBJ >THERE
	EQUAL? THERE,WINNER \?L1
	SET 'THERE,HERE
?L1:	FIRST? OBJ >F /?L7
	JUMP ?L6
?L4:	ZERO? F /?L6
?L7:	SET 'N,F
	NEXT? N >F /?L10
?L10:	MOVE N,THERE
	JUMP ?L4
?L6:	PRINTI "Everything on the "
	PRINTD OBJ
	PRINTI " slides off its top."
	CRLF
	CRLF
	RTRUE

	.FUNCT V-JUMP-ROPE
	EQUAL? PRSO,ROPE /?L1
	PRINTR "I can jump rope, and that's about all."
?L1:	PRINTR "Well, it takes all kinds of weirdos..."

	.FUNCT EMPTY-THE,OBJ,BURN?=1,F,N,FLG=0
	FIRST? OBJ >F /?L4
	JUMP ?L3
?L1:	ZERO? F /?L3
?L4:	SET 'N,F
	NEXT? N >F /?L7
?L7:	EQUAL? HERE,WEST-END-OF-PASSAGE \?L8
	FSET? PIT,INVISIBLE /?L8
	REMOVE N
	SET 'FLG,1
	JUMP ?L1
?L8:	MOVE N,HERE
	SET 'FLG,2
	JUMP ?L1
?L3:	ZERO? FLG /TRUE
	PRINTI " Whatever was inside the "
	PRINTD OBJ
	EQUAL? FLG,1 \?L16
	PRINTR " has fallen out."
?L16:	EQUAL? FLG,2 \FALSE
	PRINTI " falls into the pit."
	CRLF
	CALL PRINT-ID,STR?81 >STACK
	RSTACK

	.FUNCT NORTH-ANTE-FCN,RARG
	EQUAL? RARG,M-BEG,M-ENTER,M-LOOK \FALSE
	EQUAL? BEAM-PLACED,4 \FALSE
	MOVE BEAM,HERE
	RFALSE

	.FUNCT PIT-FCN
	EQUAL? PRSA,V?THROUGH \?L1
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE,V?LOOK-DOWN,V?LOOK-INSIDE \?L3
	PRINTR "It's too deep and dark to see much of anything."
?L3:	EQUAL? PRSA,V?LISTEN \FALSE
	PRINTR "You hear the squealing of rats. Hungry rats."

	.FUNCT MOVE-PLANK-FCN,RARG
	EQUAL? RARG,M-BEG,M-ENTER,M-LOOK \FALSE
	EQUAL? BEAM-PLACED,1,5 \?L3
	MOVE BEAM,HERE
?L3:	EQUAL? HERE,MID-ANTECHAMBER,MID-PASSAGE \?L6
	SET 'ON-BEAM,0
?L6:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?PUT,V?THROW,V?DROP \FALSE
	EQUAL? PRSA,V?PUT \?L12
	EQUAL? PRSI,PIT \FALSE
?L12:	FSET? PIT,INVISIBLE /FALSE
	EQUAL? HERE,WEST-END-OF-PASSAGE \FALSE
	EQUAL? PRSO,WINNER,ME,ADVENTURER /FALSE
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	IN? PRSO,WINNER \FALSE
	EQUAL? RARG,M-BEG \FALSE
	REMOVE PRSO
	PRINTI "You hear the "
	PRINTD PRSO
	PRINTI " hit the bottom of the deep pit."
	CRLF
	SET 'P-IT-LOC,0
	EQUAL? PRSO,TORCH \TRUE
	CALL KILL-TORCH
	RTRUE

	.FUNCT WALK-BEAM-FCN
	EQUAL? BEAM-PLACED,1,5 /?L1
	CALL PRINT-ID,STR?82
	CALL JIGS-UP,STR?83 >STACK
	RSTACK
?L1:	SET 'ON-BEAM,1
	MOVE BEAM,WEST-END-OF-PASSAGE
	RETURN WEST-END-OF-PASSAGE

	.FUNCT BURN-FRAME-FCN
	EQUAL? PRSA,V?BURN \FALSE
	PRINTI "You light the timber frame surrounding the door. The wood is slow to catch, but then, in a bursting flash, the entire frame is consumed. You shield your eyes and move back to keep from being burned, but as you take a step back, "
	CALL PRINT-ID,STR?84
	ZERO? ON-BEAM \?L5
	CALL PRINT-ID,STR?85
	CALL JIGS-UP,STR?86 >STACK
	RSTACK
?L5:	CALL PRINT-ID,STR?87
	CALL JIGS-UP,STR?88 >STACK
	RSTACK

	.FUNCT ROCKS-FCN
	EQUAL? PRSA,V?PUT,V?PUT-AGAINST,V?PUT-UNDER \?L1
	EQUAL? PRSI,ROCKS \?L1
	EQUAL? PRSO,BEAM /?L1
	PRINTR "Weird!"
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L5
	EQUAL? BEAM-PLACED,2,3 \?L6
	PRINTR "The rocks support the beam."
?L6:	PRINTR "I see nothing special about the rocks."
?L5:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTR "Huh? The rocks? Come on! They're on either side of the doorway!"

	.FUNCT TAKE-A-CHIP-FCN
	EQUAL? PRSA,V?MOVE,V?PUT,V?TAKE /?L3
	EQUAL? PRSA,V?MUNG,V?PULL-UP,V?RAISE /?L3
	EQUAL? PRSA,V?PUT \FALSE
?L3:	PRINTR "Be serious. Have you any acquaintance with particle physics? How about quarks? Know anything about quarks? Let me put it to you this way: There are more pieces of plaster dust and chips here than you have seconds in your life."

	.FUNCT ANNEX-BEAM-MOVER,RARG
	EQUAL? RARG,M-BEG,M-ENTER,M-LOOK \FALSE
	EQUAL? BEAM-PLACED,2,3 \FALSE
	MOVE BEAM,HERE
	RFALSE

	.FUNCT SEAM-FCN
	EQUAL? PRSO,SLAB-SEAM \?L1
	FSET? SLAB,SURFACEBIT /?L1
	PRINTR "I see no seam here."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L5
	PRINTR "The seam is barely visible. It goes into the edge of the slab no more than an eighth of an inch."
?L5:	EQUAL? PRSA,V?PUT-ON,V?PUT-ACROSS,V?PUT \?L8
	EQUAL? PRSI,SLAB-SEAM \?L8
	PRINTR "It's not deep enough to wedge anything into it."
?L8:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL HOW?,SLAB-SEAM
	RTRUE

	.FUNCT OPEN-SLAB-FCN,FLG=0
	EQUAL? PRSA,V?MOVE,V?RAISE,V?OPEN \?L1
	FSET? SLAB,SURFACEBIT /?L3
	PRINTR "It's already open."
?L3:	IN? ISIS-JEWEL,HOLE-3 \?L7
	IN? NEPHTH-JEWEL,HOLE-1 \?L7
	IN? SELKIS-JEWEL,HOLE-2 \?L7
	IN? NEITH-JEWEL,HOLE-4 \?L7
	CALL TBL-TO-INSIDE,SLAB,SLAB-TBL,STR?89
	RTRUE
?L7:	PRINTR "It won't budge."
?L1:	EQUAL? PRSA,V?CLOSE \?L11
	FSET? SLAB,SURFACEBIT /?L11
	IN? TORCH,SLAB \?L12
	CALL FLAMING?,TORCH >STACK
	ZERO? STACK /?L12
	SET 'FLG,1
?L12:	CALL INSIDE-OBJ-TO,SLAB-TBL,SLAB
	ZERO? FLG /TRUE
	CALL KILL-TORCH,1
	RTRUE
?L11:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	CALL DESCRIBE-SLAB-FCN,M-OBJDESC
	RTRUE

	.FUNCT HOLEY,H,X?=0,OBJ
	FIRST? H >OBJ /?L8
	EQUAL? X?,1 \TRUE
	PRINTI " The "
	PRINTD H
	PRINTI " is empty."
	RTRUE
?L8:	PRINTI " Sitting in the "
	PRINTD H
	PRINTI " is a"
	CALL VOWEL?,OBJ
	PRINTD OBJ
	PRINTI "."
	RTRUE

	.FUNCT DESCRIBE-SLAB-FCN,RARG
	EQUAL? RARG,M-OBJDESC \FALSE
	PRINTI "Sitting in the middle of this room is a huge stone slab."
	FSET? SLAB,SURFACEBIT \?L5
	PRINTI " Around its side runs a seam which is barely detectable. On top of the slab are four round holes, one in each corner."
	CALL HOLEY,HOLE-1
	CALL HOLEY,HOLE-2
	CALL HOLEY,HOLE-3
	CALL HOLEY,HOLE-4
	FIRST? SLAB >STACK \?L9
	PRINTI " Sitting on the top of the slab "
	CALL CCOUNT,SLAB >STACK
	GRTR? STACK,1 \?L13
	PRINTI "are "
	JUMP ?L17
?L13:	PRINTI "is "
?L17:	CALL PRINT-CONTENTS,SLAB
	PRINTI "."
?L9:	CRLF
	RTRUE
?L5:	PRINTI " The slab is open"
	FIRST? SLAB >STACK \?L26
	PRINTI " and holds "
	CALL PRINT-CONTENTS,SLAB
	JUMP ?L30
?L26:	PRINTI " and quite empty"
?L30:	PRINTR "."

	.FUNCT D-HOLE-FCN
	EQUAL? PRSA,V?TAKE \FALSE
	LOC PRSO >STACK
	EQUAL? STACK,HOLE-1,HOLE-2 /?L3
	LOC PRSO >STACK
	EQUAL? STACK,HOLE-3,HOLE-4 \FALSE
?L3:	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	FCLEAR PRSO,NDESCBIT
	PRINTR "Taken."

	.FUNCT DIAMOND-HOLE-FCN,FLG=0
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	EQUAL? PRSO,HOLE-3,HOLE-2,HOLE-1 /?L3
	EQUAL? PRSO,HOLE-4 \?L1
?L3:	PRINTI "The hole sits in the "
	EQUAL? PRSO,HOLE-1 \?L6
	PRINTI "northwest"
	JUMP ?L16
?L6:	EQUAL? PRSO,HOLE-2 \?L10
	PRINTI "northeast"
	JUMP ?L16
?L10:	EQUAL? PRSO,HOLE-3 \?L13
	PRINTI "southwest"
	JUMP ?L16
?L13:	PRINTI "southeast"
?L16:	PRINTI " corner of the slab."
	CALL HOLEY,PRSO,1
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,HOLE-3,HOLE-2,HOLE-1 /?L22
	EQUAL? PRSI,HOLE-4 \FALSE
?L22:	FIRST? PRSI >STACK \?L23
	PRINTR "The hole is already filled."
?L23:	EQUAL? PRSI,HOLE-1 \?L27
	EQUAL? PRSO,NEPHTH-JEWEL \?L27
	SET 'FLG,1
	JUMP ?L30
?L27:	EQUAL? PRSI,HOLE-2 \?L28
	EQUAL? PRSO,SELKIS-JEWEL \?L28
	SET 'FLG,1
	JUMP ?L30
?L28:	EQUAL? PRSI,HOLE-3 \?L29
	EQUAL? PRSO,ISIS-JEWEL \?L29
	SET 'FLG,1
	JUMP ?L30
?L29:	EQUAL? PRSI,HOLE-4 \?L30
	EQUAL? PRSO,NEITH-JEWEL \?L30
	SET 'FLG,1
?L30:	FSET PRSO,NDESCBIT
	ZERO? FLG /FALSE
	PRINTI "Done. A light click comes from beneath the corner."
	CRLF
	MOVE PRSO,PRSI
	RTRUE

	.FUNCT BURIAL-CHAMBER-DESC,RARG,OFFSET=-1,HOLDING=0,TEMP-HOLD
	EQUAL? RARG,M-BEG,M-LOOK,M-ENTER \?L3
	LOC BEAM >STACK
	EQUAL? STACK,BURIAL-CHAMBER,NORTH-ANTECHAMBER \?L3
	ZERO? BEAM-PLACED /?L3
	MOVE BEAM,HERE
?L3:	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You have entered the Chamber of Departure Towards the Funeral Destinies, the Burial Chamber. There is a doorway leading into a small room off to the east. In the middle of the chamber, stretching almost from wall to wall, is a huge, ancient sarcophagus. Its cover is composed of pure quartz and through the shining light you can see the golden, gleaming mummiform coffin. "
	CALL DESCRIBE-COVER
?L12:	IGRTR? 'OFFSET,3 /?L13
	GET STATUE-TBL,OFFSET >STACK
	FSET? STACK,CLAMPBIT \?L12
	INC 'HOLDING
	JUMP ?L12
?L13:	PRINTI " Four statues surround the sarcophagus, one in each corner: Isis, Nephthys, Neith and Selkis. "
	EQUAL? HOLDING,4 \?L20
	PRINTR "Their outstretched arms clamp down tightly on the quartz cover."
?L20:	ZERO? HOLDING \?L24
	PRINTR "All four statues face away from the quartz cover, their grip on it released."
?L24:	SET 'OFFSET,-1
	SET 'TEMP-HOLD,HOLDING
?L28:	ZERO? HOLDING /?L29
	INC 'OFFSET
	GET STATUE-TBL,OFFSET >STACK
	FSET? STACK,CLAMPBIT \?L28
	GET STATUE-NAME-TBL,OFFSET >STACK
	PRINT STACK
	GRTR? HOLDING,2 \?L37
	PRINTI ", "
	JUMP ?L41
?L37:	GRTR? HOLDING,1 \?L41
	PRINTI " and "
?L41:	DEC 'HOLDING
	JUMP ?L28
?L29:	GRTR? TEMP-HOLD,1 \?L46
	PRINTI " are "
	JUMP ?L50
?L46:	PRINTI " is "
?L50:	PRINTI "facing inward, "
	GRTR? TEMP-HOLD,1 \?L55
	PRINTI "their"
	JUMP ?L59
?L55:	PRINTI "its"
?L59:	PRINTR " heavy arms clamping down tightly over the quartz cover of the sarcophagus."

	.FUNCT SCARAB-TABLE-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	CALL PROB-DESC,15
	RTRUE

	.FUNCT DISC-CONTFCN
	EQUAL? PRSA,V?TAKE \FALSE
	LOC PRSO >STACK
	EQUAL? STACK,LEFT-DISC,RIGHT-DISC \FALSE
	IN? SCARAB,MID-DISC /FALSE
	CALL JIGS-UP,STR?90
	RETURN 2

	.FUNCT PUSH-DISC-FCN,LEFT-STATUS,RIGHT-STATUS,L-WEIGHT,R-WEIGHT
	EQUAL? PRSO,LEFT-DISC,RIGHT-DISC,MID-DISC \FALSE
	EQUAL? PRSA,V?MOVE,V?PUSH \?L3
	PRINTR "The discs float up and down several times until they come back into balance."
?L3:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L6
	CALL HOW?,PRSO
	RTRUE
?L6:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	FIRST? LEFT-DISC >LEFT-STATUS /?L8
?L8:	FIRST? RIGHT-DISC >RIGHT-STATUS /?L9
?L9:	ZERO? LEFT-STATUS /?L10
	CALL WEIGHT,LEFT-STATUS >L-WEIGHT
?L10:	ZERO? RIGHT-STATUS /?L13
	CALL WEIGHT,RIGHT-STATUS >R-WEIGHT
?L13:	EQUAL? PRSO,LEFT-DISC \?L16
	CALL TELL-ABOUT,LEFT-DISC,L-WEIGHT,R-WEIGHT
	CRLF
	RTRUE
?L16:	EQUAL? PRSO,MID-DISC \?L18
	CALL TELL-ABOUT,MID-DISC,L-WEIGHT,R-WEIGHT
	CRLF
	RTRUE
?L18:	CALL TELL-ABOUT,RIGHT-DISC,R-WEIGHT,L-WEIGHT
	RTRUE

	.FUNCT PROB-DESC,RARG,LEFT-STATUS,RIGHT-STATUS,L-WEIGHT=0,R-WEIGHT=0
	EQUAL? RARG,M-OBJDESC,15 \FALSE
	FIRST? LEFT-DISC >LEFT-STATUS /?L4
?L4:	FIRST? RIGHT-DISC >RIGHT-STATUS /?L5
?L5:	ZERO? LEFT-STATUS /?L6
	CALL WEIGHT,LEFT-STATUS >L-WEIGHT
?L6:	ZERO? RIGHT-STATUS /?L9
	CALL WEIGHT,RIGHT-STATUS >R-WEIGHT
?L9:	EQUAL? RARG,M-OBJDESC \?L12
	PRINTI "In the room is a large, granite table. Cut out from the top of this table are three circles of polished granite. "
?L12:	CALL TELL-ABOUT,LEFT-DISC,L-WEIGHT,R-WEIGHT
	PRINTI " "
	CALL TELL-ABOUT,MID-DISC,L-WEIGHT,R-WEIGHT
	PRINTI " "
	CALL TELL-ABOUT,RIGHT-DISC,R-WEIGHT,L-WEIGHT >STACK
	RSTACK

	.FUNCT TELL-ABOUT,DISC,W-1,W-2,BALANCED=0,SAFE=0,EMPTY=0,OBJ,OFFSET,POSITION,INCHES
	SET 'POSITION,STR?91
	ZERO? W-1 \?L1
	ZERO? W-2 \?L1
	SET 'EMPTY,1
?L1:	FIRST? DISC >STACK /?L4
	PRINTI "The "
	PRINTD DISC
	PRINTI " is empty, and it is "
	JUMP ?L8
?L4:	FIRST? DISC >OBJ /?L9
?L9:	PRINTI "Sitting on the "
	PRINTD DISC
	PRINTI " is a"
	CALL VOWEL?,OBJ
	PRINTD OBJ
	PRINTI ", and the "
	PRINTD DISC
	PRINTI " is "
?L8:	EQUAL? W-2,W-1 \?L14
	ZERO? EMPTY \?L14
	SET 'BALANCED,1
?L14:	ZERO? BALANCED /?L19
	EQUAL? W-1,8 \?L19
	SET 'SAFE,1
?L19:	GRTR? W-1,W-2 \?L23
	SET 'POSITION,STR?92
	JUMP ?L27
?L23:	GRTR? W-2,W-1 \?L25
	SET 'POSITION,STR?93
	JUMP ?L27
?L25:	ZERO? EMPTY /?L26
	SET 'POSITION,STR?93
	JUMP ?L27
?L26:	ZERO? BALANCED /?L59
	ZERO? SAFE \?L27
	SET 'POSITION,STR?92
?L27:	ZERO? BALANCED \?L29
?L59:	ZERO? EMPTY \?L60
	SUB W-1,W-2 >STACK
	CALL ABS,STACK >OFFSET
	JUMP ?L32
?L29:	ZERO? EMPTY /?L31
?L60:	SET 'OFFSET,1
	JUMP ?L32
?L31:	ZERO? SAFE \?L61
	SUB W-1,8 >STACK
	CALL ABS,STACK >OFFSET
?L32:	ZERO? SAFE /?L34
?L61:	SET 'INCHES,STR?94
	JUMP ?L37
?L34:	GRTR? OFFSET,8 \?L36
	SET 'INCHES,STR?95
	JUMP ?L37
?L36:	GET INCH-LTBL,OFFSET >INCHES
?L37:	EQUAL? DISC,MID-DISC \?L38
	ZERO? SAFE /?L40
	FIRST? DISC >STACK \?L44
	PRINTI "slightly above"
	JUMP ?L50
?L40:	FIRST? DISC >STACK \?L44
	PRINTI "slightly below"
	JUMP ?L50
?L44:	PRINTI "exactly even with"
	JUMP ?L50
?L38:	EQUAL? DISC,LEFT-DISC,RIGHT-DISC \?L50
	PRINT INCHES
	PRINTI " "
	PRINT POSITION
?L50:	PRINTI " the top of the table."
	EQUAL? DISC,RIGHT-DISC \FALSE
	CRLF
	RTRUE

	.FUNCT JERRY-HACK-F
	FSET? INNER-DOOR,OPENBIT \?L1
	RETURN MID-ANTECHAMBER
?L1:	PRINTI "You can't walk through a closed door."
	CRLF
	CALL THIS-IS-IT,INNER-DOOR
	RFALSE

	.FUNCT NICHE-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	GETP NICHES,P?TEXT >STACK
	PRINT STACK
	EQUAL? BEAM-PLACED,1 \?L5
	PRINTI " Resting in the niches is the wooden beam."
?L5:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL HOW?,PRSO >STACK
	RSTACK

	.FUNCT PLASTER1-GLYPHS
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
   *->  #  !!!  ::  ...>  .-
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT PLASTER1-FCN
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTI "Some hieroglyphics on the plaster say:
"
	CALL PLASTER1-GLYPHS
	RTRUE
?L1:	EQUAL? PRSA,V?ATTACK,V?MUNG,V?TAKE \FALSE
	ZERO? PRSI \?L6
	IN? PICK-AXE,WINNER \?L8
	SET 'PRSI,PICK-AXE
	JUMP ?L11
?L8:	IN? SHOVEL,WINNER \?L10
	SET 'PRSI,SHOVEL
	JUMP ?L11
?L10:	SET 'PRSI,HANDS
?L11:	PRINTI "(with your "
	PRINTD PRSI
	PRINTI ")"
	CRLF
?L6:	EQUAL? PRSI,PICK-AXE \?L15
	REMOVE PLASTER1
	SET 'P-IT-LOC,0
	MOVE PLASTER,WEST-END-OF-PASSAGE
	ADD SCORE,10 >SCORE
	PRINTI "The chips fly where they may as you relentlessly flail at the plaster with your trusty pick axe. In just a few minutes you manage to clear all the plaster from the doorway."
	CRLF
	CALL PRINT-ID,STR?96
	SET 'PLASTER-GONE,1
	PUTP STAIRS-BOTTOM,P?LDESC,STR?97
	MOVE CHIPS1,HERE
	RTRUE
?L15:	PRINTR "You scratch at the plaster but accomplish little."

	.FUNCT INNER-DOOR-FCN
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	IN? PLASTER,HERE \?L1
	PRINTR "The door is surrounded by a heavy timber frame and is entirely blocked up with plaster. There are some hieroglyphs on the plaster."
?L1:	EQUAL? PRSA,V?OPEN \?L5
	FSET? PRSO,OPENBIT \?L6
	PRINTR "It's already open."
?L6:	ZERO? INNER-DOOR-SEALED /?L10
	PRINTR "The door is covered with plaster, which is in turn covered with hieroglyphs."
?L10:	PRINTI "The door opens and you are overwhelmed by a musky odor."
	CRLF
	FSET INNER-DOOR,OPENBIT
	RTRUE
?L5:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? INNER-DOOR,OPENBIT /?L17
	PRINTR "It isn't open."
?L17:	PRINTI "Okay. The door is closed."
	CRLF
	FCLEAR INNER-DOOR,OPENBIT
	RTRUE

	.FUNCT PLASTER-FCN,FLG=0
	EQUAL? PRSA,V?ATTACK,V?MUNG,V?TAKE \FALSE
	ZERO? PRSI \?L8
	SET 'FLG,1
	IN? PICK-AXE,WINNER \?L5
	SET 'PRSI,PICK-AXE
	JUMP ?L8
?L5:	IN? SHOVEL,WINNER \?L7
	SET 'PRSI,SHOVEL
	JUMP ?L8
?L7:	SET 'PRSI,HANDS
?L8:	ZERO? FLG /?L10
	PRINTI "(with your "
	PRINTD PRSI
	PRINTI ")"
	CRLF
?L10:	EQUAL? PRSI,PICK-AXE \?L15
	ZERO? BEAM-PLACED \?L17
	CALL JIGS-UP,DEATH-BEAM-STR >STACK
	RSTACK
?L17:	ZERO? ON-BEAM \?L19
	PRINT DEATH-BEAM-STR
	CALL JIGS-UP,STR?98 >STACK
	RSTACK
?L19:	PRINTI "The plaster chips fly from the door as the incessant tapping of your pick axe does its work. The tapping has started some sand flowing out of the bottom of the doorway and the floor starts to give away. In a few short moments, the floor has disappeared, but thankfully you're safe while standing on the beam."
	CRLF
	SET 'INNER-DOOR-SEALED,0
	REMOVE PLASTER
	SET 'P-IT-LOC,0
	FCLEAR PIT,INVISIBLE
	CALL DUMP-ALL-ON-GROUND
	ADD SCORE,25 >SCORE
	PUTP HERE,P?LDESC,STR?99
	CALL THIS-IS-IT,INNER-DOOR
	MOVE CHIPS2,HERE
	RTRUE
?L15:	PRINTR "You scratch at the plaster but accomplish little."

	.FUNCT NORTH-ANTE-DOOR-FCN
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	FSET? BURIAL-CHAMBER,RMUNGBIT \?L3
	PRINTR "It's buried behind 3 tons of stones. Forget it."
?L3:	PRINTR "The door is surrounded by small seals and has a hieroglyph on it."
?L1:	EQUAL? PRSA,V?OPEN \?L10
	FSET? PRSO,OPENBIT \?L11
	PRINTR "It's already open."
?L11:	FSET? BURIAL-CHAMBER,RMUNGBIT \?L15
	PRINTR "With all the stones which fell in the doorway, there's not a chance of ever getting through again."
?L15:	ZERO? ANTE-SEAL /?L18
	PRINTR "I don't think it's that simple. Not only isn't there a doorknob, but the door is also covered with a seal."
?L18:	PRINTI "The door creaks open and you are assaulted by a deep, musty dead smell."
	CRLF
	FSET NORTH-ANTE-DOOR,OPENBIT
	ADD SCORE,40 >SCORE
	RTRUE
?L10:	EQUAL? PRSA,V?CLOSE \?L24
	FSET? NORTH-ANTE-DOOR,OPENBIT /?L25
	PRINTR "It isn't open."
?L25:	PRINTR "Closing the door isn't the best of ideas."
?L24:	EQUAL? PRSA,V?READ \FALSE
	FSET? NORTH-ANTE-DOOR,OPENBIT /FALSE
	CALL PERFORM,V?READ,HIEROGLYPHS
	RTRUE

	.FUNCT ANNEX-DOOR-FCN
	EQUAL? PRSA,V?OPEN \?L1
	FSET? PRSO,OPENBIT \?L3
	PRINTR "It's already open."
?L3:	ZERO? BEAM-PLACED /?L7
	IN? BEAM,SOUTH-ANTECHAMBER \?L7
	PRINTI "You open the door and two huge stones start to close in on you from either side. Thankfully, you had the foresight to wedge the beam in the doorway to prevent a flattening experience."
	CRLF
	FSET ANNEX-DOOR,OPENBIT
	RTRUE
?L7:	CALL PRINT-ID,STR?100
	CALL JIGS-UP,STR?101 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L11
	FSET? ANNEX-DOOR,OPENBIT /?L11
	PRINTR "This door seems to present no difficulty in opening. Lightly etched into it are some faint symbols."
?L11:	EQUAL? PRSA,V?READ \?L14
	FSET? ANNEX-DOOR,OPENBIT /?L14
	CALL PERFORM,V?READ,HIEROGLYPHS
	RTRUE
?L14:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? ANNEX-DOOR,OPENBIT \FALSE
	PRINTR "Closing this door isn't a very good idea."

	.FUNCT TURN-STATUES-FCN,OFFSET=0
	EQUAL? PRSA,V?TURN \FALSE
	ZERO? CAN-TURN-STATUES \?L3
	PRINTR "Nothing happens. These statues seem to be beyond all hope."
?L3:	PRINTI "The "
	PRINTD PRSO
	PRINTI " moves slowly, pivoting about its base, "
	FSET? PRSO,CLAMPBIT \?L10
	FCLEAR PRSO,CLAMPBIT
	CALL DO-THE-OFFSET
	PRINTR "releasing its hold on the quartz cover."
?L10:	FSET PRSO,CLAMPBIT
	PRINTR "once more clamping down on the quartz cover."

	.FUNCT DO-THE-OFFSET,OFFSET=0
?L1:	EQUAL? OFFSET,4 /?L2
	INC 'OFFSET
	GET TURNED-LTBL,OFFSET >STACK
	EQUAL? STACK,PRSO \?L1
	RTRUE
?L2:	INC 'TURN-OFFSET
	PUT TURNED-LTBL,TURN-OFFSET,PRSO
	EQUAL? TURN-OFFSET,4 \FALSE
	CALL QUEUE,I-RESET-STATUES,1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT SARCOPH-FCN
	EQUAL? PRSA,V?OPEN \?L1
	CALL PERFORM,V?OPEN,SARCOPH-COVER
	RTRUE
?L1:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSI,SARCOPH \FALSE
	PRINTI "The "
	PRINTD PRSO
	PRINTI " sits on the sarcophagus for a moment, but it quickly slides off its rounded top."
	CRLF
	MOVE PRSO,HERE
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	RTRUE

	.FUNCT SETBIT-FCN,OBJ
	EQUAL? PRSA,V?PUT-ON,V?PUT \?L8
	EQUAL? PRSI,S-AREA,L-AREA \?L1
	FIRST? PRSI >STACK \?L1
	PRINTR "There's already something on it."
?L1:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L8
	EQUAL? PRSI,S-AREA,L-AREA \?L5
	EQUAL? PRSO,BEAM \?L5
	PRINTR "I don't think the beam would fit in there. It's a little too long."
?L5:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L8
	EQUAL? PRSI,S-AREA,L-AREA \?L8
	FSET PRSO,NDESCBIT
	RFALSE
?L8:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L9
	CALL HOW?,PRSO
	RTRUE
?L9:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	PRINTI "The area is recessed about an inch below the quartz cover."
	CRLF
	FIRST? PRSO >OBJ \?L13
	PRINTI "Sitting in the "
	PRINTD PRSO
	PRINTI " is a"
	CALL VOWEL?,OBJ
	PRINTD OBJ
	PRINTR "."
?L13:	PRINTI "The "
	PRINTD PRSO
	PRINTR " is empty."

	.FUNCT RECESS-CONTFCN
	EQUAL? PRSA,V?TAKE \FALSE
	LOC PRSO >STACK
	EQUAL? STACK,S-AREA,L-AREA \FALSE
	FCLEAR PRSO,NDESCBIT
	RFALSE

	.FUNCT DESCRIBE-COVER,S-OBJ,L-OBJ
	PRINTI "There is a small recess and a large recess on the top of the cover which you can make out as thin, outlined areas."
	FIRST? S-AREA >S-OBJ /?L3
?L3:	FIRST? L-AREA >L-OBJ /?L4
?L4:	ZERO? S-OBJ /?L5
	PRINTI " Resting in the smaller recess is a"
	CALL VOWEL?,S-OBJ
	PRINTD S-OBJ
	PRINTI "."
?L5:	ZERO? L-OBJ /FALSE
	PRINTI " Sitting in the larger recess is the "
	PRINTD L-OBJ
	PRINTI "."
	RTRUE

	.FUNCT SARCOPH-COVER-FCN,STR,COUNTER=0,OFFS=-1
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	CALL DESCRIBE-COVER
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L3
	EQUAL? PRSI,SARCOPH-COVER \?L3
	PRINTI "You place the "
	PRINTD PRSO
	PRINTI " on the cover, but it slides right off onto the ground."
	CRLF
	MOVE PRSO,HERE
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	RTRUE
?L3:	EQUAL? PRSA,V?MOVE,V?OPEN \FALSE
	ZERO? STATUES-SET \?L6
	SET 'STR,STR?102
?L7:	IGRTR? 'OFFS,3 /?L8
	GET STATUE-TBL,OFFS >STACK
	FSET? STACK,CLAMPBIT \?L7
	INC 'COUNTER
	JUMP ?L7
?L8:	GRTR? COUNTER,1 \?L13
	SET 'STR,STR?103
?L13:	PRINTI "You tug, push, pull, yank and generally tire yourself out trying to open the cover until you take a moment, wipe your brow, and look around. You notice that the cover is being held in place by "
	PRINT STR
	CRLF
	RTRUE
?L6:	EQUAL? PRSA,V?MOVE,V?OPEN \FALSE
	ZERO? STATUES-SET /FALSE
	CALL ENDING
	ADD SCORE,10 >SCORE
	CRLF
	PRINTI "[EVENT: GAME OVER]"
	CALL FINISH >STACK
	RSTACK

	.FUNCT SCARAB-CHECK-FCN,L-W,R-W,L-OBJ=0,R-OBJ=0
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTI "Etched onto its back is the following:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
              >*>
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L7
	SET 'CAN-TURN-STATUES,0
	FIRST? LEFT-DISC >L-OBJ /?L8
?L8:	FIRST? RIGHT-DISC >R-OBJ /?L9
?L9:	IN? SCARAB,MID-DISC \FALSE
	ZERO? L-OBJ /?L14
	ZERO? R-OBJ \?L12
?L14:	CALL JIGS-UP,SCARAB-DEATH-STR
	RETURN 2
?L12:	CALL WEIGHT,L-OBJ >L-W
	CALL WEIGHT,R-OBJ >R-W
	EQUAL? L-W,8 \?L18
	EQUAL? R-W,8 /FALSE
?L18:	CALL JIGS-UP,SCARAB-DEATH-STR >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L23
	IN? SCARAB,MID-DISC \?L22
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L22:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L23
	EQUAL? PRSI,L-AREA,S-AREA \?L23
	FIRST? PRSI >STACK \?L23
	PRINTR "There's already something on it."
?L23:	EQUAL? PRSA,V?MOVE \?L26
	PRINTI "You'd better not. Not until you know what's going on here."
	CRLF
	CALL PRINT-ID,STR?104
	RTRUE
?L26:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSI,S-AREA \FALSE
	MOVE SCARAB,S-AREA
	PRINTI "Done."
	CRLF
	FSET SCARAB,NDESCBIT
	IN? DEAD-BOOK,L-AREA \TRUE
	SET 'CAN-TURN-STATUES,1
	PRINTR "You hear a clicking sound come from beneath all of the statues as you place the scarab within the smaller outlined area on the cover."

	.FUNCT PAGE-FCN
	EQUAL? PRSA,V?TURN \?L1
	PRINTI "Unnecessary page turning may destroy the book."
	CRLF
	CALL PRINT-ID,STR?105
	RTRUE
?L1:	EQUAL? PRSA,V?BURN \?L5
	CALL PERFORM,V?BURN,DEAD-BOOK >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	PRINTI "Hieroglyphs can be seen as follows:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
        =  .          !   !
<-*  #  =  -  #  !@!  !---!

            .          !  !
::  #  >*>  -  #  !@!  !--!
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT DEAD-BOOK-FCN
	EQUAL? PRSA,V?TAKE \?L1
	FCLEAR DEAD-BOOK,NDESCBIT
	SET 'CAN-TURN-STATUES,0
	RFALSE
?L1:	EQUAL? PRSA,V?PUT \?L3
	EQUAL? PRSI,CRUMBLED-BOOK,DEAD-BOOK \?L3
	PRINTI "You'd do more damage putting things on the "
	PRINTD PRSI
	PRINTI " than it would be worth."
	CRLF
	CALL PRINT-ID,STR?106
	RTRUE
?L3:	EQUAL? PRSA,V?EXAMINE,V?READ \?L6
	FSET? DEAD-BOOK,OPENBIT /?L7
	PRINTI "The book isn't open. On the cover is the following, though:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
       =
       ="
	CRLF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L7:	CALL PERFORM,V?READ,PAGE
	RTRUE
?L6:	EQUAL? PRSA,V?OPEN \?L14
	ZERO? PRSI /?L15
	EQUAL? PRSI,SPATULA \?L15
	PRINTI "You open the book carefully using the spatula. You can see some faint writing on the page."
	CRLF
	FSET PRSO,OPENBIT
	RTRUE
?L15:	PRINTI "Oops! The ancient papyrus pages crumble due to your less-than-delicate touch."
	CRLF
	CALL PRINT-ID,STR?107
	LOC DEAD-BOOK >STACK
	MOVE CRUMBLED-BOOK,STACK
	REMOVE DEAD-BOOK
	CALL THIS-IS-IT,CRUMBLED-BOOK
	FCLEAR CRUMBLED-BOOK,INVISIBLE
	RTRUE
?L14:	EQUAL? PRSA,V?READ \?L22
	FSET? DEAD-BOOK,OPENBIT \?L22
	CALL PERFORM,V?READ,PAGE
	RTRUE
?L22:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSI,L-AREA,S-AREA \?L23
	FIRST? PRSI >STACK \?L23
	PRINTR "There's already something on it."
?L23:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSI,L-AREA \FALSE
	MOVE DEAD-BOOK,L-AREA
	FSET DEAD-BOOK,NDESCBIT
	PRINTI "The book now rests in the larger area on the cover of the sarcophagus."
	CRLF
	IN? SCARAB,S-AREA \TRUE
	SET 'CAN-TURN-STATUES,1
	PRINTR "From beneath each of the four statues there comes a loud click."

	.FUNCT ENDING
	PRINTI "You lift the cover with great care, and in an instant you see all your dreams come true. The interior of the sarcophagus is lined with gold, inset with jewels, glistening in your torchlight. The riches and their dazzling beauty overwhelm you. You take a deep breath, amazed that all of this is yours. You tremble with excitement, then realize the ground beneath your feet is trembling, too.

As a knife cuts through butter, this realization cuts through your mind, makes your hands shake and cold sweat appear on your forehead. The Burial Chamber is collapsing, the walls closing in. You will never get out of this pyramid alive. You earned this treasure. But it cost you your life.

And as you sit there, gazing into the glistening wealth of the inner sarcophagus, you can't help but feel a little empty, a little foolish. If someone were on the other side of the quickly-collapsing wall, they could have dug you out. If only you'd treated the workers better. If only you'd cut Craige in on the find. If only you'd hired a reliable guide.

Well, someday, someone will discover your bones here. And then you will get your fame."
	CRLF
	CALL PRINT-ID,STR?108 >STACK
	RSTACK

	.FUNCT DUMP-ALL-ON-GROUND,L,LOCB,N,F,FLG=0
	LOC WINNER >L
	REMOVE WINNER
	REMOVE INNER-DOOR
	REMOVE NICHES
	REMOVE LINTEL
	ZERO? BEAM-PLACED /?L1
	LOC BEAM >LOCB
	REMOVE BEAM
?L1:	FIRST? HERE >F /?L7
	JUMP ?L6
?L4:	ZERO? F /?L6
?L7:	SET 'N,F
	NEXT? N >F /?L10
?L10:	REMOVE N
	SET 'FLG,1
	JUMP ?L4
?L6:	ZERO? FLG /?L11
	CRLF
	PRINTI "Everything on the floor falls into the pit."
	CRLF
?L11:	MOVE WINNER,L
	ZERO? LOCB /?L16
	MOVE BEAM,LOCB
?L16:	MOVE INNER-DOOR,WEST-END-OF-PASSAGE
	MOVE NICHES,WEST-END-OF-PASSAGE
	MOVE LINTEL,WEST-END-OF-PASSAGE
	RTRUE

	.FUNCT MOVE-THE-PLANK-FCN,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FSET? PLANK,TOUCHBIT \?L5
	IN? PLANK,BARGE-CENTER \FALSE
?L5:	MOVE PLANK,HERE
	RFALSE

	.FUNCT PLANK-FCN
	EQUAL? PRSA,V?MOVE,V?TAKE \FALSE
	PRINTI "The plank is a permanent part of the barge. To remove it might create far more destruction than you think."
	CRLF
	CALL PRINT-ID,STR?109
	RTRUE

	.FUNCT BURN-THE-BARGE,RARG
	EQUAL? RARG,M-END \?L1
	EQUAL? PRSA,V?THROW,V?DROP \?L3
	CALL FLAMING?,PRSO >STACK
	ZERO? STACK /?L3
	CALL JIGS-UP,BARGE-BURN-STR
	RETURN 2
?L3:	EQUAL? PRSA,V?PUT \FALSE
	CALL FLAMING?,PRSO >STACK
	ZERO? STACK /FALSE
	LOC PRSI >STACK
	EQUAL? STACK,HERE \FALSE
	EQUAL? PRSI,TORCH-HOLDER /FALSE
	CALL JIGS-UP,BARGE-BURN-STR
	RETURN 2
?L1:	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? HERE,BELOW-MAST \?L11
	MOVE MAST-HOLE,HERE
	FSET? BEAM,TOUCHBIT /FALSE
	PUTP BEAM,P?FDESC,STR?110
	ZERO? PUSHED-BEAM \FALSE
	MOVE BEAM,SLOT
	RFALSE
?L11:	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? HERE,BARGE-CENTER \FALSE
	FSET? PLANK,TOUCHBIT \?L21
	IN? PLANK,BARGE-ENTRANCE \?L19
?L21:	MOVE PLANK,HERE
?L19:	MOVE MAST-HOLE,HERE
	ZERO? PUSHED-BEAM /?L30
	FSET? BEAM,TOUCHBIT /?L23
	PUTP BEAM,P?FDESC,STR?111
?L23:	ZERO? PUSHED-BEAM \FALSE
?L30:	MOVE BEAM,HERE
	PUTP BEAM,P?FDESC,STR?112
	RTRUE

	.FUNCT MAST-HOLE-FCN
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	CALL HOW?,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?THROUGH,V?CLIMB-UP,V?CLIMB-DOWN \?L3
	ZERO? PUSHED-BEAM \?L4
	PRINTR "I think the mast hole is already being used."
?L4:	PRINTR "You'd never squeeze through it."
?L3:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L11
	ZERO? PUSHED-BEAM \?L11
	PRINTR "The mast is going through the hole."
?L11:	EQUAL? PRSA,V?PUT \?L14
	EQUAL? PRSI,MAST-HOLE \FALSE
	ZERO? PUSHED-BEAM \?L14
	PRINTI "There isn't room for the "
	PRINTD PRSO
	PRINTR " and the mast, too."
?L14:	EQUAL? PRSI,MAST-HOLE \FALSE
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? HERE,BARGE-CENTER \?L18
	PRINTI "The "
	PRINTD PRSO
	PRINTI " drops through the hole."
	CRLF
	JUMP ?L22
?L18:	PRINTI "You try to reach up that high, but fail. The "
	PRINTD PRSO
	PRINTI " falls to the deck."
	CRLF
?L22:	MOVE PRSO,BELOW-MAST
	FSET PRSO,TOUCHBIT
	CALL FLAMING?,PRSO >STACK
	ZERO? STACK /TRUE
	CALL JIGS-UP,BARGE-BURN-STR
	RTRUE

	.FUNCT TORCH-HOLDER-FCN,FROB
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	CALL HOW?,TORCH-HOLDER >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	FIRST? PRSO >FROB \?L4
	PRINTI "All I can see is a "
	PRINTD FROB
	PRINTR " in there."
?L4:	PRINTR "Through the knothole is inky blackness."

	.FUNCT SLOT-FCN
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	IN? BEAM,SLOT \FALSE
	FSET? SHIM,NDESCBIT \?L3
	PRINTR "A shim is wedged between the slot and the beam."
?L3:	IN? BEAM,SLOT \FALSE
	PRINTR "The beam is resting in the slot."
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL HOW?,SLOT >STACK
	RSTACK

	.FUNCT SHIM-FCN
	EQUAL? PRSA,V?TAKE \FALSE
	FSET? SHIM,NDESCBIT \FALSE
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	PRINTI "Taken."
	CRLF
	FCLEAR SHIM,NDESCBIT
	FCLEAR SHIM,DONTTAKE
	RTRUE

	.FUNCT DROP-THE-BLOCKS
	PRINTI "When you remove the beam, you remove the only thing between you and three tons of solid rock, poised over your head. Knowing the situation, though, has saved your life: you leap out of the way just in time."
	CRLF
	SET 'BEAM-PLACED,0
	CALL MUNG-ROOM,BURIAL-CHAMBER,STR?113
	REMOVE NORTH-ANTE-DOOR
	SET 'P-IT-LOC,0
	SET 'ANTE-SEAL,1
	REMOVE N-ANTE-SEAL
	RTRUE

	.FUNCT CLOSE-THE-ANNEX
	CALL MUNG-ROOM,ANNEX,STR?114
	PRINTI "The doorway disappears behind two huge stones which slide horizontally from the doorway. Luckily, you stepped out of their way just in time."
	CRLF
	SET 'BEAM-PLACED,0
	REMOVE ROCKS
	PUTP SOUTH-ANTECHAMBER,P?LDESC,STR?115
	RTRUE

	.FUNCT SET-THE-BEAM,CASE
	ZERO? BEAM-PLACED /?L8
	EQUAL? BEAM-PLACED,CASE \?L3
	PRINTR "It's already been done."
?L3:	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	PRINTI "(taken)"
	CRLF
?L8:	PRINTI "Consider it done."
	CRLF
	SET 'BEAM-PLACED,CASE
	CALL DESCRIBE-BEAM-FCN,M-OBJDESC
	MOVE BEAM,HERE
	EQUAL? HERE,SOUTH-ANTECHAMBER \FALSE
	CALL THIS-IS-IT,ANNEX-DOOR >STACK
	RSTACK

	.FUNCT BEAM-FCN
	EQUAL? BEAM,PRSI \?L1
	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSO,ME,WINNER,ADVENTURER \?L5
	PRINTR "Why not just stand on it?"
?L5:	CALL HELD?,BEAM >STACK
	ZERO? STACK /?L9
	PRINTI "Better drop the "
	PRINTD PRSI
	PRINTR " first."
?L9:	EQUAL? PRSO,BEAM \?L12
	PRINTR "How recursive!"
?L12:	PRINTI "Done. But the "
	PRINTD PRSO
	PRINTI " falls off the beam and lands"
	FSET? PIT,INVISIBLE /?L18
	EQUAL? HERE,MID-ANTECHAMBER,WEST-END-OF-PASSAGE \?L18
	ZERO? BEAM-PLACED /?L18
	PRINTI " in the pit."
	CRLF
	REMOVE PRSO
	RTRUE
?L18:	PRINTI " on the ground."
	CRLF
	MOVE PRSO,HERE
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L26
	EQUAL? HERE,NORTH-ANTECHAMBER \?L27
	FSET? NORTH-ANTE-DOOR,OPENBIT \?L27
	CALL ITAKE >STACK
	ZERO? STACK /?L27
	CALL DROP-THE-BLOCKS
	RTRUE
?L27:	EQUAL? HERE,BURIAL-CHAMBER \?L29
	CALL ITAKE >STACK
	ZERO? STACK /FALSE
	PRINTI "Taken. Oh oh...."
	CRLF
	CALL JIGS-UP,BURIAL-BEAM-STR >STACK
	RSTACK
?L29:	EQUAL? HERE,ANNEX \?L35
	CALL ITAKE >STACK
	ZERO? STACK /FALSE
	CALL JIGS-UP,ANNEX-BEAM-STR
	RETURN 2
?L35:	EQUAL? HERE,SOUTH-ANTECHAMBER \?L41
	FSET? ANNEX,RMUNGBIT /?L41
	FSET? ANNEX-DOOR,OPENBIT \?L41
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	CALL CLOSE-THE-ANNEX
	RTRUE
?L41:	EQUAL? HERE,BARGE-CENTER \?L45
	FSET? SHIM,NDESCBIT \?L45
	IN? BEAM,HERE \?L45
	PRINTR "It seems to be securely wedged in the mast hole."
?L45:	EQUAL? HERE,BELOW-MAST \?L51
	FSET? SHIM,NDESCBIT \?L48
	IN? BEAM,SLOT \?L48
	PRINTR "It's wedged into the slot."
?L48:	EQUAL? HERE,BELOW-MAST \?L51
	IN? BEAM,SLOT \?L51
	PRINTR "The mast hole won't allow a steep enough angle for removing it."
?L51:	ZERO? ON-BEAM /?L54
	CALL ITAKE >STACK
	ZERO? STACK /FALSE
	SET 'ON-BEAM,0
	PRINTI "(getting off the beam first)"
	CRLF
	PRINTI "Taken."
	CRLF
	IN? PLASTER,HERE /?L59
	CALL PRINT-ID,STR?116
	CALL JIGS-UP,STR?117
?L59:	SET 'BEAM-PLACED,0
	RTRUE
?L54:	SET 'BEAM-PLACED,0
	RFALSE
?L26:	EQUAL? PRSA,V?PUT-ON,V?PUT-ACROSS,V?PUT /?L65
	EQUAL? PRSA,V?PUT-AGAINST \?L64
?L65:	EQUAL? PRSI,NICHES \?L64
	EQUAL? HERE,WEST-END-OF-PASSAGE \?L64
	IN? PIT,HERE /?L64
	CALL SET-THE-BEAM,1
	RTRUE
?L64:	EQUAL? PRSA,V?PUT-ON \?L66
	EQUAL? PRSI,ROCKS \?L66
	EQUAL? HERE,SOUTH-ANTECHAMBER \?L66
	CALL SET-THE-BEAM,2
	RTRUE
?L66:	EQUAL? PRSA,V?PUT \?L67
	EQUAL? PRSI,ROCKS \?L67
	EQUAL? HERE,SOUTH-ANTECHAMBER \?L67
	PRINTI "Done. The beam immediately falls to the floor, though."
	CRLF
	MOVE BEAM,HERE
	RTRUE
?L67:	EQUAL? PRSA,V?PUT,V?PUT-ACROSS \?L70
	EQUAL? PRSI,DOORWAY,ANNEX-DOOR \?L70
	EQUAL? HERE,SOUTH-ANTECHAMBER \?L70
	IN? ROCKS,HERE \?L70
	CALL SET-THE-BEAM,3
	RTRUE
?L70:	EQUAL? PRSA,V?PUT-UNDER \?L71
	EQUAL? PRSI,T-LINTEL,DOORWAY \?L71
	EQUAL? HERE,NORTH-ANTECHAMBER \?L71
	CALL SET-THE-BEAM,4
	RTRUE
?L71:	EQUAL? PRSA,V?PUT,V?PUT-ACROSS \?L72
	EQUAL? PRSI,PIT \?L72
	EQUAL? HERE,MID-ANTECHAMBER \?L72
	CALL SET-THE-BEAM,5
	RTRUE
?L72:	ZERO? ON-BEAM /?L73
	EQUAL? PRSA,V?CLIMB-DOWN,V?DISEMBARK \?L73
	SET 'ON-BEAM,0
	IN? PLASTER,WEST-END-OF-PASSAGE \?L74
	EQUAL? HERE,WEST-END-OF-PASSAGE \?L74
	PRINTR "You're now standing on the ground."
?L74:	CALL JIGS-UP,AIR-WALK
	RTRUE
?L73:	EQUAL? PRSA,V?PUSH-THROUGH,V?PULL-UP,V?RAISE \?L79
	EQUAL? HERE,BELOW-MAST,BARGE-CENTER \?L79
	FSET? SHIM,NDESCBIT \?L79
	PRINTR "You try to raise the mast but it seems to be wedged into something."
?L79:	EQUAL? PRSA,V?PULL-UP,V?RAISE,V?PUSH-THROUGH \?L82
	EQUAL? HERE,BELOW-MAST,BARGE-CENTER \?L82
	FSET? SHIM,NDESCBIT /?L82
	CALL CCOUNT,WINNER >STACK
	ZERO? STACK /?L83
	PRINTR "You'll need two hands to do that. Better put everything down."
?L83:	MOVE BEAM,BARGE-CENTER
	SET 'PUSHED-BEAM,1
	PUTP BEAM,P?FDESC,STR?111
	PRINTR "You have managed to lift the beam up through the hole and you hear it land on the deck with a thud."
?L82:	EQUAL? PRSA,V?PUSH-THROUGH \?L90
	EQUAL? PRSI,MAST-HOLE \?L90
	EQUAL? HERE,BELOW-MAST \?L90
	PRINTR "It's wedged too tightly in the slot."
?L90:	EQUAL? PRSA,V?PUSH \?L93
	FSET? BEAM,TOUCHBIT /?L93
	PRINTR "Nice try."
?L93:	EQUAL? PRSA,V?MUNG \FALSE
	PRINTR "This piece of wood is virtually petrified due to its age and original strength."

	.FUNCT DESCRIBE-BEAM-FCN,RARG,STR
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTI "This wooden beam is made of an extremely hard wood. It's 10 feet long and has a diameter of 12 inches. Scratched into it is the following symbol:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
     /!\
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L1:	EQUAL? RARG,M-OBJDESC \FALSE
	ZERO? BEAM-PLACED /FALSE
	EQUAL? BEAM-PLACED,4 \?L9
	PRINTR "Wedged under the top of the doorway, perpendicular to the floor, is the wooden beam."
?L9:	EQUAL? BEAM-PLACED,5,1 \?L12
	EQUAL? HERE,MID-ANTECHAMBER \?L13
	PRINTR "Through the doorway you can see the beam spanning the pit."
?L13:	EQUAL? HERE,WEST-END-OF-PASSAGE \TRUE
	PRINTI "Stretching across the floor"
	EQUAL? BEAM-PLACED,1 \?L20
	PRINTI " from niche to niche"
?L20:	ZERO? INNER-DOOR-SEALED \?L25
	PRINTI ", spanning a deep pit,"
?L25:	PRINTI " is the wooden beam."
	ZERO? ON-BEAM /?L32
	PRINTI " You are standing on the beam."
?L32:	CRLF
	RTRUE
?L12:	EQUAL? BEAM-PLACED,2,3 \FALSE
	EQUAL? BEAM-PLACED,2 \?L39
	SET 'STR,STR?118
	JUMP ?L41
?L39:	SET 'STR,STR?119
?L41:	PRINTI "Wedged between the "
	PRINT STR
	PRINTR ", from side to side, is the stout beam."

	.FUNCT READ-SCROLL-FCN
	EQUAL? PRSA,V?READ \FALSE
	PRINTI "The scroll reads as follows:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
*->  <.>  <:.>  ... <::.>

::  :  **  --->>  -)  (*)"
	CRLF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT GET-LOST-FCN,OFFS=-3
	GETP HERE,P?ENDLESS >STACK
	ZERO? STACK /FALSE
?L1:	ADD OFFS,3 >OFFS
	GRTR? OFFS,54 /?L5
	GET MAP-TBL,OFFS >STACK
	EQUAL? HERE,STACK \?L1
	ADD OFFS,1 >STACK
	GET MAP-TBL,STACK >SECS-LON
	ADD OFFS,2 >STACK
	GET MAP-TBL,STACK >SECS-LAT
	JUMP ?L1
?L5:	SET 'DEGS-LON,32
	SET 'DEGS-LAT,24
	SET 'MINS-LON,12
	SET 'MINS-LAT,11
	GETP HERE,P?ENDLESS >DESERT-LOC
	CALL CHANGE-DESERT-POSITION
	FCLEAR ENDLESS-DESERT,TOUCHBIT
	RETURN ENDLESS-DESERT

	.FUNCT CROC-FCN
	EQUAL? PRSI,NASTY-CROC \FALSE
	EQUAL? PRSA,V?THROW \FALSE
	CALL PERFORM,V?PUT,PRSO,NILE-RIBBAH
	RTRUE

	.FUNCT GET-WET-FCN
	EQUAL? PRSA,V?THROUGH \?L1
	CALL PERFORM,V?SWIM,NILE-RIBBAH
	RTRUE
?L1:	EQUAL? PRSA,V?DROP \?L3
	CALL PERFORM,V?LEAVE
	RTRUE
?L3:	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L4
	PRINTR "Hmmm. Looks potable. And dangerous."
?L4:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L7
	CALL HOW?,PRSO
	RTRUE
?L7:	EQUAL? PRSO,NILE-RIBBAH \?L8
	EQUAL? PRSA,V?DRINK \?L8
	CALL PERFORM,V?DRINK-FROM,PRSO
	RTRUE
?L8:	EQUAL? PRSI,NILE-RIBBAH \FALSE
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,WINNER \?L10
	CALL PERFORM,V?SWIM
	RETURN 2
?L10:	REMOVE PRSO
	SET 'P-IT-LOC,0
	PRINTI "The "
	PRINTD PRSO
	PRINTI " quickly "
	CALL HEAVY? >STACK
	ZERO? STACK /?L17
	PRINTI "sinks"
	JUMP ?L21
?L17:	PRINTI "floats away on the current"
?L21:	PRINTI ". Another example of your fine management abilities."
	CRLF
	CALL PRINT-ID,STR?120
	RTRUE

	.FUNCT HEAVY?,OBJ=0
	ZERO? OBJ \?L1
	SET 'OBJ,PRSO
?L1:	EQUAL? OBJ,FOLDED-COT,BROKEN-LOCK,ROCK /TRUE
	EQUAL? OBJ,STONE-KEY,PICK-AXE,SHOVEL /TRUE
	EQUAL? OBJ,ROPE,CRATE,BLACK-BOX /TRUE
	EQUAL? OBJ,TORCH,OIL-JAR /TRUE
	GETP OBJ,P?BRICK >STACK
	ZERO? STACK \TRUE
	EQUAL? OBJ,KNAPSACK \FALSE
	CALL WEIGHT,KNAPSACK >STACK
	GRTR? STACK,15 \FALSE
	RTRUE

	.FUNCT TAKE-ROCK-FCN
	EQUAL? PRSA,V?TAKE \FALSE
	FCLEAR ROCK,NDESCBIT
	PUTP MATCHES,P?FDESC,STR?121
	RFALSE

	.FUNCT FIREPIT-FCN
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	CALL HOW?,PRSO >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?THROUGH \?L3
	PRINTR "There's no need to get yourself all dirty."
?L3:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	PRINTI "The pit's just a pit. Nothing more. "
	FIRST? PIT >STACK \?L9
	PRINTI "Sitting in the pit is "
	CALL PRINT-CONTENTS,PIT
	JUMP ?L13
?L9:	PRINTI "The pit is empty"
?L13:	PRINTR "."

	.FUNCT ENTER-TENT-FCN
	EQUAL? PRSA,V?DISEMBARK,V?DROP \?L1
	EQUAL? PRSO,TENT-OBJ \?L1
	CALL IN-A-TENT? >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?LEAVE
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	EQUAL? HERE,P2,P4,P7 /FALSE
	CALL IN-A-TENT? >STACK
	ZERO? STACK /?L6
	PRINTR "Looks like a canvas tent to me."
?L6:	GETP HERE,P?MAP >STACK
	ZERO? STACK \?L9
	PRINTR "Get serious."
?L9:	PRINTR "I can't see it from here!"
?L3:	EQUAL? PRSA,V?LOOK-INSIDE \?L15
	CALL PERFORM,V?LOOK-INSIDE,FLAPS
	RTRUE
?L15:	EQUAL? PRSA,V?LAMP-ON \?L16
	PRINTI "I don't think that striking the tent would do any good."
	CRLF
	CALL PRINT-ID,STR?122
	RTRUE
?L16:	EQUAL? PRSA,V?BOARD,V?THROUGH \FALSE
	GETP HERE,P?MAP >STACK
	ZERO? STACK \?L20
	PRINTR "Get serious."
?L20:	CALL IN-A-TENT? >STACK
	ZERO? STACK /?L23
	PRINTR "What are those canvas walls around you? Just where do you think you are? Maybe I should send for Craige, eh?"
?L23:	EQUAL? HERE,P2,P7,P4 \?L26
	CALL PERFORM,V?ENTER
	RTRUE
?L26:	PRINTR "You can't enter the tent from here."

	.FUNCT ENTER-PYRAMID-FCN
	EQUAL? PRSA,V?DROP \?L1
	EQUAL? HERE,CHAMBER-OF-RA \?L1
	CALL PERFORM,V?LEAVE
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L3
	ZERO? PYRAMID-OPENED \?L37
	IN? ROCK-LOCK,HERE \?L4
	PRINTR "There's not much to see of it yet -- just the tip of it is exposed showing the block and its small opening."
?L4:	ZERO? PYRAMID-OPENED /?L8
?L37:	EQUAL? HERE,EX8 \?L8
	PRINTR "You can see down into what looks like a large chamber."
?L8:	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L11
	PRINTR "You can't see any pyramid here."
?L11:	PRINTR "Where do you think you are, Times Square?"
?L3:	EQUAL? PRSA,V?OPEN \?L20
	ZERO? PYRAMID-OPENED \?L17
	IN? ROCK-LOCK,HERE \?L17
	PRINTR "The stone blocks don't move."
?L17:	EQUAL? PRSA,V?OPEN \?L20
	PRINTR "It looks open to me."
?L20:	EQUAL? PYRAMID,PRSI \?L23
	EQUAL? HERE,EX8 \?L23
	EQUAL? PRSA,V?THROW,V?PUT \?L23
	ZERO? PYRAMID-OPENED /?L23
	PRINTI "You hear the "
	PRINTD PRSO
	PRINTI " fall down below."
	CRLF
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	EQUAL? PRSO,KNAPSACK \?L26
	FCLEAR PRSO,WEARBIT
	FSET PRSO,OPENBIT
?L26:	MOVE PRSO,CHAMBER-OF-RA
	RTRUE
?L23:	EQUAL? PRSA,V?THROUGH \FALSE
	GETP HERE,P?MAP >STACK
	ZERO? STACK \?L30
	PRINTR "Get serious. Let's find it first."
?L30:	EQUAL? HERE,EX8 \?L33
	CALL PERFORM,V?ENTER
	RTRUE
?L33:	PRINTR "You can't enter the pyramid from here."

	.FUNCT CREATE-THIRST-FCN,RARG
	EQUAL? RARG,M-ENTER \?L1
	ADD THIRST,6 >THIRST
	RFALSE
?L1:	EQUAL? RARG,M-BEG \?L3
	INC 'THIRST
	RFALSE
?L3:	EQUAL? RARG,M-LOOK \FALSE
	CALL DESCRIBE-HOLE-FCN,M-LOOK >STACK
	RSTACK

	.FUNCT DESCRIBE-HOLE-FCN,RARG,DEPTH
	EQUAL? RARG,M-LOOK \?L1
	GETP HERE,P?LDESC >STACK
	PRINT STACK
	GETP HERE,P?CAPACITY >DEPTH
	GRTR? DEPTH,5 \?L5
	EQUAL? HERE,EX8 \?L5
	CRLF
	RTRUE
?L5:	GRTR? DEPTH,0 \?L7
	PRINTI " There's a"
	GET DESC-HOLE-LTBL,DEPTH >STACK
	PRINT STACK
	PRINTI " in the sand, a remnant of your excavation attempts."
?L7:	EQUAL? HERE,ENDLESS-DESERT \?L11
	GRTR? THIRST,300 \?L13
	PRINTI " "
	CALL PICK-ONE,SPACE-TALES-LTBL >STACK
	PRINT STACK
	CRLF
	RTRUE
?L13:	RANDOM 100 >STACK
	GRTR? 50,STACK \?L34
	RANDOM 100 >STACK
	GRTR? 35,STACK \?L20
	PRINTI " "
	CALL PICK-ONE,SPACE-TALES-LTBL >STACK
	PRINT STACK
	CRLF
	RTRUE
?L20:	PRINTI " "
	CALL PICK-ONE,MIRAGE-LTBL >STACK
	PRINT STACK
	CRLF
	RTRUE
?L11:	GETP HERE,P?DESERT >STACK
	ZERO? STACK /?L34
	GRTR? THIRST,300 \?L29
	PRINTI " "
	CALL PICK-ONE,MIRAGE-LTBL >STACK
	PRINT STACK
	CRLF
	RTRUE
?L29:	RANDOM 100 >STACK
	GRTR? 20,STACK \?L34
	PRINTI " "
	CALL PICK-ONE,MIRAGE-LTBL >STACK
	PRINT STACK
?L34:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \?L40
	ADD THIRST,15 >THIRST
	RFALSE
?L40:	EQUAL? RARG,M-BEG \FALSE
	ADD THIRST,3 >THIRST
	RFALSE

	.FUNCT ENTER-OPENING-FCN
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTI "The opening sits in the upper right-hand corner of the block. It's a small square opening, about four inches square, far too small for you to enter, and rather shallow. Some hieroglyphs travel across the block, cut off by the opening:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
       !-!        !-!
->  #. ! !  -  #  ! !  /
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L7
	CALL HOW?,PRSO >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?THROUGH \FALSE
	PRINTR "I think the opening is a little too small to get through. Unless your ethics and morals are an accurate representation of your stature."

	.FUNCT COT-FCN,RARG=M-OBJECT,F
	EQUAL? RARG,M-OBJECT \FALSE
	EQUAL? PRSO,COT \?L3
	FIRST? COT >F /?L4
?L4:	EQUAL? PRSA,V?PUT-ON,V?PUT,V?TAKE \?L5
	PRINTR "It's too bulky and unstable a structure to be carrying around."
?L5:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON \?L9
	IN? WINNER,COT \?L10
	PRINTR "Where do you think you are?"
?L10:	PRINTI "This is no time for sitting down on the job, especially after what you've been through to get here!"
	CRLF
	CALL PRINT-ID,STR?123
	RTRUE
?L9:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L17
	PRINTI "It's just an army cot."
	ZERO? F /?L24
	EQUAL? F,WINNER \?L20
	PRINTR " And you're in it!"
?L20:	ZERO? F /?L24
	PRINTI " Sitting on the cot "
	CALL CCOUNT,COT >STACK
	GRTR? STACK,1 \?L27
	PRINTI "are "
	JUMP ?L31
?L27:	PRINTI "is "
?L31:	CALL PRINT-CONTENTS,COT
	PRINTI "."
?L24:	CRLF
	RTRUE
?L17:	EQUAL? PRSA,V?CLOSE,V?FOLD \?L37
	ZERO? F \?L38
	PRINTI "Folded."
	CRLF
	LOC COT >STACK
	MOVE FOLDED-COT,STACK
	REMOVE COT
	CALL THIS-IS-IT,FOLDED-COT
	RTRUE
?L38:	EQUAL? F,WINNER \?L42
	PRINTR "Don't you think it would be wise to get out of the cot first? Or are you waiting for a valet to help?"
?L42:	ZERO? F /FALSE
	PRINTR "You'd better take everything off of it first."
?L37:	EQUAL? PRSA,V?UNFOLD,V?OPEN \?L49
	PRINTR "It's already unfolded."
?L49:	EQUAL? PRSA,V?DROP \?L52
	LOC WINNER >STACK
	EQUAL? STACK,COT \?L52
	CALL PERFORM,V?DISEMBARK,COT
	RTRUE
?L52:	EQUAL? PRSA,V?THROUGH,V?WALK \FALSE
	LOC WINNER >STACK
	EQUAL? STACK,COT \FALSE
	PRINTI "You'd better get out of the cot first."
	CRLF
	RETURN 2
?L3:	EQUAL? PRSO,FOLDED-COT \FALSE
	EQUAL? PRSA,V?UNFOLD,V?OPEN \?L60
	IN? FOLDED-COT,HERE /?L62
	PRINTR "Better put it down on the ground first."
?L62:	PRINTI "Unfolded."
	CRLF
	LOC FOLDED-COT >STACK
	MOVE COT,STACK
	REMOVE FOLDED-COT
	CALL THIS-IS-IT,COT
	RTRUE
?L60:	EQUAL? PRSA,V?CLOSE,V?FOLD \FALSE
	PRINTR "Hmmm. Looks like you beat yourself to it. It's already folded up."

	.FUNCT READ-MATCHES-FCN,OBJ
	ZERO? OBJ \?L1
	SET 'OBJ,MATCHES
?L1:	EQUAL? PRSA,V?READ-INSIDE \?L4
	FSET? OBJ,OPENBIT /?L6
	PRINTR "You'd better open the matchbook first."
?L6:	CALL PERFORM,V?READ,OBJ
	RTRUE
?L4:	EQUAL? PRSA,V?LOOK-BEHIND,V?READ \?L11
	FSET? OBJ,OPENBIT \?L12
	PRINTR "The inside says: Send away now!! Mushrooms can be taught a foreign language, and make fine pets! Easy to feed and they can be walked on a leash! Read and fill out the enclosed coupon now!"
?L12:	PRINTR "Printed on the outside is a small coupon for an instruction manual, ""GROW MUSHROOMS IN YOUR BASEMENT FOR FUN & PROFIT"". Close Before Striking."
?L11:	EQUAL? PRSA,V?LAMP-ON \FALSE
	PRINTR "One match at a time, eh?"

	.FUNCT LAST-MATCH-FCN
	EQUAL? PRSA,V?DROP \?L1
	IN? ONE-MATCH,WINNER \?L1
	CALL DROP-ONE-FCN
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L3
	PRINTR "Why? There's no match left in the matchbook."
?L3:	EQUAL? PRSA,V?LAMP-ON \?L6
	IN? ONE-MATCH,WINNER /FALSE
	PRINTR "There's no match to light!"
?L6:	EQUAL? PRSA,V?READ \FALSE
	CALL READ-MATCHES-FCN,EMPTY-MATCHES
	RTRUE

	.FUNCT DROP-ONE-FCN
	EQUAL? PRSA,V?PUT,V?DROP \?L1
	IN? ONE-MATCH,WINNER /?L3
	PRINTR "Better take one first."
?L3:	MOVE ONE-MATCH,GLOBAL-OBJECTS
	PRINTI "Dropped. "
	CALL BUT-WHERE?
	PRINTI " "
	CALL I-MATCH-OUT
	CALL INT,I-MATCH-OUT >STACK
	PUT STACK,0,0
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L12
	IN? MATCHES,WINNER \?L13
	CALL MATCH-MOVER,0
	RTRUE
?L13:	PRINTR "I see no match here."
?L12:	EQUAL? ONE-MATCH,PRSI \FALSE
	IN? MATCHES,WINNER /?L19
	IN? ONE-MATCH,WINNER /?L19
	PRINTR "You're not holding the match."
?L19:	CALL MATCH-MOVER,1
	RFALSE

	.FUNCT BUT-WHERE?
	IN? WINNER,COT \?L1
	PRINTI "The match disappears somewhere beneath the cot."
	JUMP ?L17
?L1:	EQUAL? HERE,RIVER-BANK \?L5
	PRINTI "The current of the river sweeps it away."
	JUMP ?L17
?L5:	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L8
	PRINTI "The match, however, is quickly covered by the sand."
	JUMP ?L17
?L8:	GETP HERE,P?ACTION >STACK
	EQUAL? STACK,BURN-THE-BARGE \?L11
	PRINTI "The match, however, falls between the wooden decking."
	JUMP ?L17
?L11:	FSET? PIT,INVISIBLE /?L14
	EQUAL? HERE,WEST-END-OF-PASSAGE \?L14
	PRINTI "The match flutters down into the abyss."
	JUMP ?L17
?L14:	PRINTI "The match falls into a crack in the stone floor."
?L17:	CALL FLAMING?,ONE-MATCH >STACK
	ZERO? STACK \FALSE
	CRLF
	RTRUE

	.FUNCT TAKE-ONE-MATCH-FCN
	EQUAL? PRSA,V?TAKE \?L1
	IN? ONE-MATCH,WINNER /?L3
	CALL MATCH-MOVER,0
	RTRUE
?L3:	PRINTR "You're already holding one."
?L1:	EQUAL? PRSA,V?DROP \?L8
	CALL PERFORM,V?DROP,ONE-MATCH
	RTRUE
?L8:	EQUAL? PRSA,V?PUT-UNDER,V?PUT-ON,V?PUT /?L10
	EQUAL? PRSA,V?PUT-ACROSS,V?PUT-AGAINST,V?PUT-BEHIND \FALSE
?L10:	IN? ONE-MATCH,WINNER \?L11
	MOVE ONE-MATCH,GLOBAL-OBJECTS
	PRINTR "Well, I tried, but the match seems to have missed the mark entirely."
?L11:	PRINTR "One match at a time!"

	.FUNCT MATCH-MOVER,SUPPRESS?=1
	GRTR? MATCH-COUNT,0 \?L1
	DEC 'MATCH-COUNT
?L1:	LESS? MATCH-COUNT,1 \?L4
	SET 'MATCH-COUNT,0
	REMOVE SINGLE-MATCH
	RFALSE
?L4:	EQUAL? MATCH-COUNT,1 \?L6
	LOC MATCHES >STACK
	MOVE EMPTY-MATCHES,STACK
	REMOVE MATCHES
	REMOVE MANY-MATCHES
	FSET SINGLE-MATCH,NDESCBIT
	JUMP ?L7
?L6:	EQUAL? MATCH-COUNT,2 \?L7
	LOC MANY-MATCHES >STACK
	MOVE SINGLE-MATCH,STACK
	REMOVE MANY-MATCHES
?L7:	MOVE ONE-MATCH,WINNER
	ZERO? SUPPRESS? \TRUE
	PRINTR "Taken."

	.FUNCT SEND-FOR-IT-FCN
	EQUAL? PRSA,V?SEND \?L1
	IN? MATCHES,WINNER \?L1
	PRINTR "Sure. As soon as a postman walks by, I'd be glad to give the coupon to him."
?L1:	EQUAL? PRSA,V?READ \FALSE
	IN? MATCHES,WINNER \?L5
	PRINTR "The coupon for the manual is as clear as any coupon ever was:

Fill in Last Name first, unless First Name is Last. Check the box beside the dotted line unless you want the manual shipped via alternate shipping. Include your address unless your mailing address and shipping address differ from your postal delivery route. If you are having the manual air-freighted, fill in your airport's zip code unless you're within thirty miles of a large corn field. After checking whether that box has been checked, check it.

Before you mail this, be certain you've read the instructions and have filled out all three sides of the form. In case of doubt, contact the Coupon Customer Service Department, 122 East Accardi Street, Youknow, Alaska. If you live west of the Atlantic or the Pacific, this offer is null and void except where prohibited by law."
?L5:	EQUAL? PRSA,V?READ \FALSE
	PRINTR "There's not much to read unless you're holding the matchbook."

	.FUNCT BURN-FOO-FCN
	EQUAL? PRSA,V?LAMP-ON,V?BURN \?L1
	EQUAL? PRSO,CIG-WRAPPER \?L1
	IN? MATCHES,WINNER /?L3
	IN? ONE-MATCH,WINNER \?L1
	CALL FLAMING?,ONE-MATCH >STACK
	ZERO? STACK /?L1
?L3:	PRINTI "It tries valiantly to burn, but the inside of it is made of foil, and you manage to burn your fingertips instead of the package."
	CRLF
	CALL PRINT-ID,STR?124
	LOC CIG-WRAPPER >STACK
	MOVE BURNED-PACK,STACK
	FCLEAR BURNED-PACK,INVISIBLE
	FCLEAR BURNED-PACK,NDESCBIT
	REMOVE CIG-WRAPPER
	CALL THIS-IS-IT,BURNED-PACK
	RTRUE
?L1:	EQUAL? PRSA,V?READ \FALSE
	GETP CIG-WRAPPER,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT DESCRIBE-TRUNK-FCN,RARG
	EQUAL? RARG,M-OBJDESC \FALSE
	IN? COT,HERE \?L3
	PRINTI "At the foot of the cot is a large, unwieldy trunk."
	JUMP ?L7
?L3:	PRINTI "A large, unwieldy trunk sits on the sand."
?L7:	FSET? BROKEN-LOCK,INVISIBLE \?L10
	PRINTI " The trunk is closed and locked with a padlock."
	JUMP ?L14
?L10:	FSET? BROKEN-LOCK,TOUCHBIT /?L14
	PRINTI " The trunk is closed with a broken padlock."
?L14:	CRLF
	FIRST? TRUNK >STACK \TRUE
	CALL PRINT-CONT,TRUNK
	RTRUE

	.FUNCT TRUNK-FCN,FLG=0
	EQUAL? PRSA,V?OPEN \?L1
	IN? LOCK,TENT \?L3
	PRINTR "A padlock holds it shut."
?L3:	FSET? BROKEN-LOCK,TOUCHBIT /?L7
	PRINTR "You'd better remove the broken lock first."
?L7:	CALL TBL-TO-INSIDE,TRUNK,TRUNK-TBL
	RTRUE
?L1:	EQUAL? PRSA,V?UNLOCK \?L11
	FSET? TRUNK,SURFACEBIT /?L12
	PRINTR "Better have your eyes checked."
?L12:	PRINTR "You don't have a key."
?L11:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L19
	FSET? TRUNK,SURFACEBIT \?L19
	PRINTI "It's an old steamer trunk, very heavy and too clumsy for one person to carry."
	CRLF
	FIRST? TRUNK >STACK \TRUE
	CALL PRINT-CONT,TRUNK
	RTRUE
?L19:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? TRUNK,SURFACEBIT /FALSE
	IN? TORCH,TRUNK \?L26
	CALL FLAMING?,TORCH >STACK
	ZERO? STACK /?L26
	SET 'FLG,1
?L26:	CALL INSIDE-OBJ-TO,TRUNK-TBL,TRUNK
	ZERO? FLG /TRUE
	CALL KILL-TORCH,1
	RTRUE

	.FUNCT LOCK-FCN
	EQUAL? PRSA,V?OPEN \?L1
	ZERO? PRSI /?L3
	CALL PERFORM,V?MUNG,PRSO,PRSI
	RTRUE
?L3:	PRINTR "You can't. It's locked."
?L1:	EQUAL? PRSA,V?MUNG \?L11
	EQUAL? PRSI,ROCK,SHOVEL,PICK-AXE \?L8
	PRINTI "The padlock breaks open."
	CRLF
	CALL PRINT-ID,STR?125
	FCLEAR BROKEN-LOCK,INVISIBLE
	REMOVE LOCK
	CALL THIS-IS-IT,BROKEN-LOCK
	ADD SCORE,5 >SCORE
	RETURN SCORE
?L8:	EQUAL? PRSA,V?MUNG \?L11
	PRINTI "You'll have to hit the lock with something stronger."
	CRLF
	CALL PRINT-ID,STR?126
	RTRUE
?L11:	EQUAL? PRSA,V?DISEMBARK,V?TAKE \?L14
	PRINTR "It's locked."
?L14:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	IN? LOCK,HERE \FALSE
	PRINTR "It's made of hardened steel and is very sturdy. It's also very locked."

	.FUNCT STONE-KEY-FCN
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTI "This is a small stone cube, almost four inches on a side, with ancient markings on it. The markings look like this:
"
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "
#  !@!  ::  (())  !@!  //\\
"
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,ROCK-LOCK \FALSE
	PRINTI "The ancient stones beneath your feet shake and tremble as they move the sands. You leap out of the way and manage to avoid being sucked down into the vortex. Through the sands, an entrance down into the pyramid is revealed. The entire experience sends a jolt of adrenaline through your body as your lips form a sneer. You've found it. And without any help from those idiots."
	CRLF
	SET 'PYRAMID-OPENED,1
	REMOVE STONE-KEY
	REMOVE ROCK-LOCK
	SET 'P-IT-LOC,0
	PUTP HERE,P?LDESC,STR?127
	ADD SCORE,20 >SCORE
	RETURN SCORE

	.FUNCT EDIBLE-FCN
	EQUAL? PRSO,FOOD \FALSE
	EQUAL? PRSA,V?TASTE,V?SMELL \FALSE
	PRINTR "Mmmm good!"

	.FUNCT MAP-FCN
	IN? MAP,WINNER /?L1
	EQUAL? PRSA,V?EXAMINE,V?READ,V?OPEN \?L1
	PRINTR "You're not carrying the map."
?L1:	EQUAL? PRSA,V?EXAMINE,V?READ \?L8
	FSET? MAP,OPENBIT /?L5
	PRINTR "You'd better unfold it first."
?L5:	EQUAL? PRSA,V?EXAMINE,V?READ \?L8
	PRINTR "This is a reproduction of the map the Professor made while on his expedition. It indicates where he hoped to find the lost pyramid. It is included in your game package."
?L8:	EQUAL? PRSA,V?TAKE \FALSE
	FSET? MAP,TOUCHBIT /FALSE
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	PRINTR "Taken. It feels fairly heavy, though, as though it were folded around something solid."

	.FUNCT DESCRIBE-ROPE-FCN,RARG
	EQUAL? RARG,M-OBJDESC \FALSE
	EQUAL? HERE,LANDING-ZERO,LANDING-ONE,LANDING-TWO /?L3
	EQUAL? HERE,LANDING-THREE,TINY-LANDING \FALSE
?L3:	ZERO? ROPE-PLACED /FALSE
	PRINTI "Descending from above is the end of a long rope."
	EQUAL? HERE,TINY-LANDING \?L6
	PRINTI " It travels down into the darkness."
?L6:	CRLF
	RTRUE

	.FUNCT ROPE-FCN
	EQUAL? PRSA,V?TIE \?L1
	EQUAL? PRSI,ALTAR \?L1
	ZERO? ROPE-TIED /?L3
	PRINTI "It's already tied to the "
	PRINTD ROPE-TIED
	PRINTR "."
?L3:	EQUAL? PRSI,ALTAR \FALSE
	PRINTI "The rope has been tied to the "
	PRINTD PRSI
	PRINTI "."
	CRLF
	SET 'ROPE-TIED,PRSI
	FSET ROPE,TRYTAKEBIT
	RTRUE
?L1:	EQUAL? PRSA,V?UNTIE \?L11
	ZERO? ROPE-TIED \?L12
	PRINTR "That's cute. It's not tied!"
?L12:	EQUAL? HERE,CHAMBER-OF-RA /?L16
	PRINTR "Your arms aren't quite that long."
?L16:	PRINTI "Untied."
	SET 'ROPE-TIED,0
	FCLEAR ROPE,TRYTAKEBIT
	ZERO? ROPE-PLACED /?L22
	MOVE ROPE,LANDING
	PRINTI " You hear it fall down below."
	SET 'LANDING,0
	SET 'ROPE-PLACED,0
?L22:	CRLF
	RTRUE
?L11:	EQUAL? PRSA,V?PUT,V?TAKE \?L27
	ZERO? ROPE-PLACED /?L27
	EQUAL? HERE,CHAMBER-OF-RA \?L27
	SET 'ROPE-PLACED,0
	FCLEAR ROPE,NDESCBIT
	PRINTI "(free end of rope)"
	CRLF
	RFALSE
?L27:	EQUAL? PRSA,V?TAKE \?L30
	ZERO? ROPE-PLACED /?L30
	EQUAL? HERE,LANDING-ZERO,LANDING-ONE,TINY-LANDING /?L31
	EQUAL? HERE,LANDING-TWO,LANDING-THREE \?L30
?L31:	PRINTR "It seems to be tied to something up overhead."
?L30:	EQUAL? PRSA,V?MOVE \?L34
	ZERO? ROPE-PLACED /?L34
	PRINTR "The rope is securely fastened to the altar."
?L34:	EQUAL? PRSA,V?PUT \?L37
	ZERO? PRSI /FALSE
	FSET? PRSI,CLIMBBIT \FALSE
	EQUAL? PRSI,FEW-STEPS \?L40
	SET 'PRSI,NORTH-STAIRS
?L40:	SET 'ROPE-PLACED,PRSI
	PRINTI "The rope descends into the "
	PRINTD PRSI
	PRINTI "."
	CRLF
	MOVE ROPE,HERE
	EQUAL? PRSI,NORTH-STAIRS \?L45
	SET 'LANDING,LANDING-ZERO
	RTRUE
?L45:	EQUAL? PRSI,SOUTH-STAIRS \?L47
	SET 'LANDING,LANDING-TWO
	RTRUE
?L47:	EQUAL? PRSI,EAST-STAIRS \?L48
	SET 'LANDING,LANDING-ONE
	RTRUE
?L48:	EQUAL? PRSI,WEST-STAIRS \?L49
	SET 'LANDING,LANDING-THREE
	RTRUE
?L49:	SET 'LANDING,LANDING-ZERO
	RTRUE
?L37:	EQUAL? PRSA,V?TAKE \?L52
	FCLEAR ROPE,NDESCBIT
	RFALSE
?L52:	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-DOWN,V?CLIMB-UP \FALSE
	EQUAL? PRSA,V?CLIMB-UP \?L54
	EQUAL? HERE,CHAMBER-OF-RA \?L54
	PRINTI "The rope doesn't go up."
	CRLF
	RETURN 2
?L54:	SET 'ROPE-HACK,1
	RFALSE

	.FUNCT CANTEEN-FCN
	EQUAL? PRSA,V?SHAKE \?L1
	FSET? CANTEEN,OPENBIT /?L3
	IN? WATER,CANTEEN \?L5
	GRTR? WATER-LEFT,9 \?L5
	PRINTR "Some water sloshes around inside."
?L5:	ZERO? SAND-FILLED /?L9
	PRINTR "Some sand shakes around inside."
?L9:	PRINTR "It's empty."
?L3:	IN? WATER,CANTEEN \?L15
	PRINTI "All the water spills out and quickly evaporates. Another smart move."
	CRLF
	CALL PRINT-ID,STR?128
	REMOVE WATER
	SET 'WATER-LEFT,0
	RTRUE
?L15:	ZERO? SAND-FILLED /?L18
	PRINTI "You empty the canteen of most of the sand."
	CRLF
	SET 'SAND-FILLED,0
	REMOVE C-SAND
	FSET C-SAND,NDESCBIT
	RTRUE
?L18:	PRINTR "Okay, but shaking an empty canteen will get you nowhere fast."
?L1:	EQUAL? PRSA,V?FILL \?L24
	EQUAL? PRSI,SAND \?L24
	GETP HERE,P?MAP >STACK
	ZERO? STACK \?L25
	PRINTR "I see no sand here."
?L25:	FSET? CANTEEN,OPENBIT /?L29
	PRINTR "It would help if you opened the canteen first."
?L29:	PRINTI "Okay. The canteen has been filled with sand."
	ZERO? WATER-LEFT /?L35
	SET 'WATER-LEFT,0
	REMOVE WATER
	PRINTI " So much for the water that was left in it."
	CALL PRINT-ID,STR?129
?L35:	CRLF
	SET 'SANDY-CANTEEN,1
	SET 'SAND-FILLED,1
	MOVE C-SAND,CANTEEN
	FCLEAR C-SAND,NDESCBIT
	RTRUE
?L24:	EQUAL? PRSI,CANTEEN \FALSE
	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,SAND,GLOBAL-WATER,C-SAND /FALSE
	PRINTR "That would void the manufacturer's warranty on the canteen."

	.FUNCT MIRAGES-F
	PRINTR "Come on! This life you're leading is bad enough -- don't waste your life on illusions."

	.FUNCT DESERT-EXIT-FCN,RARG,END-OF-TBL=26,OFFS=0,NEW-ROOM=0,OLD-DESERT
	EQUAL? RARG,M-END \?L1
	EQUAL? PRSA,V?DROP \TRUE
	RANDOM 100 >STACK
	GRTR? 33,STACK \TRUE
	ZERO? TOLD-IT \TRUE
	CALL TABLE-TO-DESERT,DESERT-LOC
	REMOVE PRSO
	PRINTI "A brief but strong gust of wind comes up off a dune, whipping sand in your face, blinding you for long enough to lose track of the "
	PRINTD PRSO
	PRINTI "."
	CRLF
	SET 'TOLD-IT,1
	RTRUE
?L1:	EQUAL? RARG,M-LOOK \?L8
	CALL DESCRIBE-HOLE-FCN,M-LOOK
	SET 'TOLD-IT,0
	RTRUE
?L8:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \?L11
	EQUAL? PRSO,P?UP,P?DOWN \?L10
?L11:	SET 'TOLD-IT,0
	RFALSE
?L10:	SET 'TOLD-IT,0
	ADD THIRST,15 >THIRST
	SET 'OLD-DESERT,DESERT-LOC
	CALL CHANGE-DESERT-POSITION
?L13:	EQUAL? OFFS,END-OF-TBL /?L14
	GET REENTRY-TBL,OFFS >STACK
	EQUAL? DESERT-LOC,STACK \?L18
	ADD OFFS,1 >STACK
	GET REENTRY-TBL,STACK >NEW-ROOM
	JUMP ?L14
?L18:	ADD OFFS,2 >OFFS
	JUMP ?L13
?L14:	CALL DESERT-TO-TABLE,OLD-DESERT
	CALL PROP-TO-TBL,OLD-DESERT
	ZERO? NEW-ROOM \?L21
	FCLEAR HERE,TOUCHBIT
	SET 'NEW-ROOM,ENDLESS-DESERT
	CALL TABLE-TO-DESERT,DESERT-LOC
	CALL TBL-TO-PROP,DESERT-LOC
	JUMP ?L23
?L21:	CALL TBL-TO-PROP,OLD-DESERT
?L23:	CALL GOTO,NEW-ROOM
	RTRUE

	.FUNCT DESERT-TO-TABLE,SLOC,TBL,CNT=0,F,N
	SET 'TBL,DESERT-TABLE
	FIRST? ENDLESS-DESERT >F /?L17
	RTRUE
?L1:	ZERO? F /TRUE
?L17:	NEXT? F >N /?L7
?L7:	EQUAL? F,WINNER /?L12
	FSET? F,TAKEBIT \?L12
?L11:	GET TBL,CNT >STACK
	ZERO? STACK \?L13
	PUT TBL,CNT,SLOC
	ADD CNT,1 >STACK
	PUT TBL,STACK,F
	ADD CNT,2 >CNT
	REMOVE F
	JUMP ?L12
?L13:	ADD CNT,2 >CNT
	JUMP ?L11
?L12:	SET 'F,N
	JUMP ?L1

	.FUNCT TABLE-TO-DESERT,SLOC,TBL,CNT=0
	SET 'TBL,DESERT-TABLE
?L1:	LESS? CNT,100 \TRUE
	GET TBL,CNT >STACK
	EQUAL? STACK,SLOC \?L5
	PUT TBL,CNT,0
	ADD CNT,1 >STACK
	GET TBL,STACK >STACK
	MOVE STACK,ENDLESS-DESERT
?L5:	ADD CNT,2 >CNT
	JUMP ?L1

	.FUNCT CHANGE-DESERT-POSITION
	INC 'DESERT-HACK
	EQUAL? DESERT-HACK,10 \?L1
	PRINTI "WARNING: The Surgeon General has determined that wandering about like this is dangerous to your health."
	CRLF
	CALL PRINT-ID,STR?130
	CRLF
	JUMP ?L6
?L1:	EQUAL? DESERT-HACK,20 \?L6
	CALL ROB-HIM-BLIND >STACK
	ZERO? STACK /?L6
	PRINTI "You start dropping things to lighten your load. Before you know it, you're empty-handed. A gust of wind comes up off the dune before you, covering over what you've dropped. So much for that."
	CRLF
	CALL PRINT-ID,STR?131
	CRLF
?L6:	EQUAL? PRSO,P?NORTH \?L12
	SUB DESERT-LOC,50 >DESERT-LOC
	CALL FIX-LON-LAT,0,2 >STACK
	RSTACK
?L12:	EQUAL? PRSO,P?NE \?L14
	SUB DESERT-LOC,49 >DESERT-LOC
	CALL FIX-LON-LAT,2,2 >STACK
	RSTACK
?L14:	EQUAL? PRSO,P?EAST \?L15
	INC 'DESERT-LOC
	CALL FIX-LON-LAT,2,0 >STACK
	RSTACK
?L15:	EQUAL? PRSO,P?SE \?L16
	ADD DESERT-LOC,51 >DESERT-LOC
	CALL FIX-LON-LAT,2,-2 >STACK
	RSTACK
?L16:	EQUAL? PRSO,P?SOUTH \?L17
	ADD DESERT-LOC,50 >DESERT-LOC
	CALL FIX-LON-LAT,0,-2 >STACK
	RSTACK
?L17:	EQUAL? PRSO,P?SW \?L18
	ADD DESERT-LOC,49 >DESERT-LOC
	CALL FIX-LON-LAT,-2,-2 >STACK
	RSTACK
?L18:	EQUAL? PRSO,P?WEST \?L19
	DEC 'DESERT-LOC
	CALL FIX-LON-LAT,-2,0 >STACK
	RSTACK
?L19:	EQUAL? PRSO,P?NW \FALSE
	SUB DESERT-LOC,51 >DESERT-LOC
	CALL FIX-LON-LAT,-2,2 >STACK
	RSTACK

	.FUNCT FIX-LON-LAT,INC-LON,INC-LAT
	ZERO? INC-LON /?L9
	ADD SECS-LON,INC-LON >SECS-LON
	GRTR? SECS-LON,60 \?L3
	SET 'SECS-LON,1
	IGRTR? 'MINS-LON,59 \?L9
	SET 'MINS-LON,0
	INC 'DEGS-LON
	JUMP ?L9
?L3:	LESS? SECS-LON,1 \?L9
	SET 'SECS-LON,59
	DLESS? 'MINS-LON,0 \?L9
	SET 'MINS-LON,59
	DEC 'DEGS-LON
?L9:	ZERO? INC-LAT /FALSE
	ADD SECS-LAT,INC-LAT >SECS-LAT
	GRTR? SECS-LAT,60 \?L16
	SET 'SECS-LAT,1
	IGRTR? 'MINS-LAT,59 \FALSE
	SET 'MINS-LAT,0
	INC 'DEGS-LAT
	RETURN DEGS-LAT
?L16:	LESS? SECS-LAT,1 \FALSE
	SET 'SECS-LAT,59
	DLESS? 'MINS-LAT,0 \FALSE
	SET 'MINS-LAT,59
	DEC 'DEGS-LAT
	RETURN DEGS-LAT

	.FUNCT ROB-HIM-BLIND,F,N,FLG=0
	FIRST? WINNER >F /?L4
	RETURN FLG
?L1:	ZERO? F \?L4
	RETURN FLG
?L4:	SET 'N,F
	NEXT? N >F /?L7
?L7:	REMOVE N
	SET 'FLG,1
	JUMP ?L1

	.FUNCT PROP-TO-TBL,SLOC,TBL,CNT=0,DUG
	SET 'TBL,PROP-TBL
	GETP HERE,P?CAPACITY >DUG
	ZERO? DUG /FALSE
?L1:	GET TBL,CNT >STACK
	ZERO? STACK \?L6
	PUT TBL,CNT,SLOC
	ADD CNT,1 >STACK
	PUT TBL,STACK,DUG
	PUTP HERE,P?CAPACITY,0
	ADD CNT,2 >CNT
	RTRUE
?L6:	ADD CNT,2 >CNT
	JUMP ?L1

	.FUNCT TBL-TO-PROP,SLOC,TBL,CNT=0
	SET 'TBL,PROP-TBL
?L1:	LESS? CNT,120 \TRUE
	GET TBL,CNT >STACK
	EQUAL? STACK,SLOC \?L5
	PUT TBL,CNT,0
	ADD CNT,1 >STACK
	GET TBL,STACK >STACK
	PUTP HERE,P?CAPACITY,STACK
?L5:	ADD CNT,2 >CNT
	JUMP ?L1

	.FUNCT WEAR-THE-SACK,ON-IN?
	SET 'ON-IN?,STR?132
	EQUAL? KNAPSACK,PRSO \?L1
	EQUAL? PRSA,V?WEAR \?L3
	IN? KNAPSACK,WINNER /?L14
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSI,NASTY-CROC /?L10
	PRINTI "(taken)"
	CRLF
	JUMP ?L14
?L10:	PRINTI "(wearing it)"
	CRLF
?L14:	PRINTI "You swing the knapsack over your shoulders and it settles on your back as its cover flap closes."
	CRLF
	FCLEAR KNAPSACK,OPENBIT
	FSET KNAPSACK,WEARBIT
	CALL THIS-IS-IT,KNAPSACK >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L21
	EQUAL? PRSI,ME \?L20
	CALL PERFORM,V?WEAR,KNAPSACK
	CALL THIS-IS-IT,KNAPSACK
	RTRUE
?L20:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L21
	ZERO? PRSI /?L21
	EQUAL? PRSI,KNAPSACK \?L22
	PRINTR "Sure. Just like a Klein Bottle, eh?"
?L22:	EQUAL? PRSI,CRACK \?L26
	CALL PERFORM,PRSA,PRSO,GROUND
	RTRUE
?L26:	EQUAL? PRSI,FOLDED-COT \?L27
	PRINTR "Bizarre!"
?L27:	FSET? KNAPSACK,WEARBIT \FALSE
	EQUAL? PRSI,GROUND \?L32
	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L32
	CALL IN-A-TENT? >STACK
	ZERO? STACK \?L32
	SET 'PRSI,SAND
?L32:	FSET? PRSI,SURFACEBIT \?L35
	SET 'ON-IN?,STR?133
?L35:	EQUAL? HERE,WEST-END-OF-PASSAGE \?L38
	FSET? PIT,INVISIBLE /?L38
	EQUAL? PRSI,PIT,GROUND \?L38
	PRINTI "Dropped."
	CRLF
	SET 'P-IT-LOC,0
	JUMP ?L42
?L38:	PRINTI "You take the knapsack off and place it "
	PRINT ON-IN?
	PRINTI " the "
	PRINTD PRSI
	PRINTI ". As it settles "
	PRINT ON-IN?
	PRINTI " the "
	PRINTD PRSI
	PRINTI ", the cover flaps open."
	CRLF
?L42:	FCLEAR KNAPSACK,WEARBIT
	FSET KNAPSACK,OPENBIT
	EQUAL? PRSI,GROUND,SAND \?L45
	CALL IDROP
	JUMP ?L47
?L45:	MOVE KNAPSACK,PRSI
?L47:	CALL THIS-IS-IT,KNAPSACK
	RTRUE
?L21:	EQUAL? PRSA,V?OPEN \?L48
	FSET? KNAPSACK,WEARBIT \?L48
	PRINTI "You reach around behind to lift the flap on the top of the knapsack, but it keeps falling back down."
	CRLF
	CALL THIS-IS-IT,KNAPSACK
	RTRUE
?L48:	EQUAL? PRSA,V?SHAKE \?L51
	FSET? KNAPSACK,WEARBIT \?L51
	PRINTI "Better take it off first. Unless you want to do a few headstands."
	CRLF
	CALL THIS-IS-IT,KNAPSACK
	RTRUE
?L51:	EQUAL? PRSA,V?FIND \?L54
	FSET? KNAPSACK,WEARBIT \FALSE
	PRINTR "It's on your back!"
?L54:	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L60
	FSET? KNAPSACK,WEARBIT \?L60
	PRINTI "Your neck doesn't crane back that far. Better take it off first."
	CRLF
	CALL THIS-IS-IT,KNAPSACK
	RTRUE
?L60:	EQUAL? PRSA,V?DROP,V?DISEMBARK \?L63
	FSET? KNAPSACK,WEARBIT /?L64
	PRINTR "You aren't wearing it!"
?L64:	EQUAL? HERE,WEST-END-OF-PASSAGE \?L69
	FSET? PIT,INVISIBLE /?L69
	PRINTI "Dropped."
	CRLF
	SET 'P-IT-LOC,0
	JUMP ?L73
?L69:	PRINTI "You take the knapsack off and place it down. As it settles, the cover flaps open."
	CRLF
?L73:	FCLEAR KNAPSACK,WEARBIT
	FSET KNAPSACK,OPENBIT
	CALL IDROP
	CALL THIS-IS-IT,KNAPSACK
	RTRUE
?L63:	EQUAL? PRSA,V?TAKE \FALSE
	FSET? PRSO,WEARBIT \?L112
	GET P-VTBL,0 >STACK
	EQUAL? STACK,W?REMOVE /?L79
	EQUAL? PRSI,ME \?L77
?L79:	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L77:	FSET? PRSO,WEARBIT /?L81
?L112:	CALL PERFORM,V?WEAR,PRSO,NASTY-CROC
	RTRUE
?L81:	PRINTR "You already have it."
?L1:	EQUAL? KNAPSACK,PRSI \FALSE
	EQUAL? PRSA,V?PUT \?L88
	CALL FLAMING?,PRSO >STACK
	ZERO? STACK /?L90
	PRINTI "Don't you think you should put out the "
	PRINTD PRSO
	PRINTI " first?"
	CRLF
	CALL PRINT-ID,STR?134
	RTRUE
?L90:	EQUAL? PRSO,CRATE,BEAM,SHOVEL \?L94
	PRINTR "That's like trying to fit a Beethoven Symphony into a music box."
?L94:	EQUAL? PRSO,GLOBAL-WATER,WATER,SAND \?L97
	PRINTR "It would only seep through the roughly-stitched seams, so why bother?"
?L97:	FSET PRSO,TOUCHBIT
	RFALSE
?L88:	EQUAL? PRSA,V?TAKE \FALSE
	FSET? KNAPSACK,OPENBIT /FALSE
	FSET? KNAPSACK,WEARBIT \?L104
	PRINTI "Your arms don't reach back that far, and groping around in the sack isn't the best of ideas. It would help if you took it off first."
	CRLF
	CALL THIS-IS-IT,KNAPSACK
	RTRUE
?L104:	PRINTI "The knapsack isn't open."
	CRLF
	CALL THIS-IS-IT,KNAPSACK
	RTRUE

	.FUNCT CRATE-FCN,FLG=0
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	LOC WINNER >STACK
	IN? CRATE,STACK /?L3
	IN? CRATE,HERE /?L3
	IN? CRATE,WINNER /?L3
	LOC WINNER >STACK
	LOC CRATE >STACK
	EQUAL? STACK,STACK /?L3
	LOC CRATE >STACK
	EQUAL? STACK,WINNER /?L3
	IN? CRATE,KNAPSACK \?L1
	LOC KNAPSACK >STACK
	EQUAL? STACK,HERE \?L1
?L3:	PRINTR "The crate is slightly beaten up from the landing, but it seems to have held together fairly well. There's a small label on it that says ""This crate contains 1 (one) black box (tm)."""
?L1:	EQUAL? PRSA,V?EXAMINE \?L9
	IN? CRATE,GLOBAL-OBJECTS \?L6
	CALL IN-A-TENT? >STACK
	ZERO? STACK \?L6
	GRTR? MOVES,4 \?L6
	PRINTR "It's coming down, and it looks like it should land near you!"
?L6:	EQUAL? PRSA,V?EXAMINE \?L9
	IN? CRATE,GLOBAL-OBJECTS \?L9
	CALL IN-A-TENT? >STACK
	ZERO? STACK /?L9
	PRINTR "I think you've got crates on the mind!"
?L9:	EQUAL? PRSA,V?MUNG \?L12
	IN? CRATE,GLOBAL-OBJECTS /?L21
	EQUAL? PRSI,PICK-AXE,SHOVEL \FALSE
	PRINTI "Wood chips fly from the crate, hurtling into the sand all around, as the crate suffers your frenzied attack. The defenseless packing crate looks as if to flee but before it can react (growing legs is a time-consuming task) there is nothing left of it but a mere memory. (You really should seek some psychological counselling.)"
	CRLF
	CALL PRINT-ID,STR?135
	FSET? BLACK-BOX,TOUCHBIT /?L17
	MOVE BLACK-BOX,HERE
	FSET BLACK-BOX,RMUNGBIT
?L17:	REMOVE PRSO
	SET 'P-IT-LOC,0
	RTRUE
?L12:	IN? CRATE,GLOBAL-OBJECTS /?L21
	EQUAL? PRSA,V?BURN /?L22
	EQUAL? PRSA,V?DROP \?L21
	EQUAL? PRSI,CRATE \?L21
	CALL FLAMING?,PRSO >STACK
	ZERO? STACK /?L21
?L22:	PRINTI "Well, who would have thought it? The crate catches fire quickly, the flames leaping about in mad abandon, gaily changing color as the heat becomes more and more intense. You hear a sizzling"
	FSET? BLACK-BOX,TOUCHBIT /?L25
	CALL PRINT-ID,STR?136
	CALL JIGS-UP,STR?137
	RTRUE
?L25:	PRINTI " as the crate consumes itself in gleeful merriment."
	CRLF
	CALL PRINT-ID,STR?138
	REMOVE CRATE
	SET 'P-IT-LOC,0
	RTRUE
?L21:	EQUAL? PRSA,V?STAND-UNDER /FALSE
	EQUAL? PRSA,V?BOARD \?L31
	IN? CRATE,GLOBAL-OBJECTS /?L35
	PRINTR "You couldn't fit in there unless you put yourself through a trash compacter."
?L31:	IN? CRATE,GLOBAL-OBJECTS \?L34
?L35:	PRINTI "Hey, give it a chance to get here. I know you're impatient to get on with this, but be reasonable!"
	CRLF
	CALL PRINT-ID,STR?139
	RTRUE
?L34:	EQUAL? PRSA,V?OPEN \?L37
	CALL TBL-TO-INSIDE,CRATE,CRATE-TBL,STR?140
	RTRUE
?L37:	EQUAL? PRSA,V?CLOSE \?L38
	FSET? CRATE,SURFACEBIT /?L38
	IN? TORCH,CRATE \?L39
	CALL FLAMING?,TORCH >STACK
	ZERO? STACK /?L39
	SET 'FLG,1
?L39:	CALL INSIDE-OBJ-TO,CRATE-TBL,CRATE
	ZERO? FLG /TRUE
	CALL KILL-TORCH,1
	RTRUE
?L38:	EQUAL? PRSA,V?SHAKE \FALSE
	GET CRATE-TBL,1 >STACK
	ZERO? STACK /FALSE
	PRINTR "Hmm. Something's in there."

	.FUNCT BOX-OPENER-FCN
	EQUAL? PRSA,V?OPEN \?L1
	PRINTI "To do that to the "
	PRINTD BLACK-BOX
	PRINTI " would most probably ruin the delicate equipment inside."
	CRLF
	CALL PRINT-ID,STR?141
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE \?L5
	PRINTR "I didn't know it was open."
?L5:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L8
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L8:	EQUAL? PRSA,V?LAMP-ON \?L11
	CALL PERFORM,V?PUSH,BUTTON
	RTRUE
?L11:	EQUAL? PRSA,V?LAMP-OFF \?L12
	PRINTR "It turns itself off after each button press."
?L12:	EQUAL? PRSA,V?MUNG,V?THROW-DOWN,V?THROW /?L16
	EQUAL? PRSA,V?SHAKE,V?ATTACK \FALSE
?L16:	EQUAL? PRSO,BLACK-BOX \FALSE
	PRINTI "Rattle, rattle, jostle, crunch. Oh oh..."
	CRLF
	CALL PRINT-ID,STR?142
	FSET BLACK-BOX,RMUNGBIT
	EQUAL? PRSA,V?THROW-DOWN,V?THROW \TRUE
	MOVE PRSO,HERE
	RTRUE

	.FUNCT PRESS-BUTTON-FCN,OFFS=-3,LAT-S,LON-S,H-CK
	EQUAL? PRSA,V?PUSH \?L1
	FSET? BLACK-BOX,RMUNGBIT \?L3
	CALL PICK-ONE,NOISES-LTBL >STACK
	PRINT STACK
	PRINTR "!"
?L3:	EQUAL? HERE,ENDLESS-DESERT \?L7
	PRINTI "The box comes to life, its L.E.D.s lighting, and then flashes "
	PRINTN DEGS-LAT
	PRINTI " degree"
	EQUAL? DEGS-LAT,1 /?L12
	PRINTI "s"
?L12:	PRINTI " "
	PRINTN MINS-LAT
	PRINTI " minute"
	EQUAL? MINS-LAT,1 /?L19
	PRINTI "s"
?L19:	PRINTI " "
	PRINTN SECS-LAT
	PRINTI " seconds N latitude, "
	PRINTN DEGS-LON
	PRINTI " degree"
	EQUAL? DEGS-LON,1 /?L30
	PRINTI "s"
?L30:	PRINTI " "
	PRINTN MINS-LON
	PRINTI " minute"
	EQUAL? MINS-LON,1 /?L37
	PRINTI "s"
?L37:	PRINTI " "
	PRINTN SECS-LON
	PRINTR " seconds E longitude."
?L7:	GETP HERE,P?MAP >STACK
	ZERO? STACK \?L44
	PRINTR "There's no need for that here. It's obvious where you are."
?L44:	EQUAL? HERE,TENT \?L48
	SET 'H-CK,P2
	JUMP ?L52
?L48:	EQUAL? HERE,TENT2 \?L50
	SET 'H-CK,P7
	JUMP ?L52
?L50:	EQUAL? HERE,SUPPLY-TENT \?L51
	SET 'H-CK,P4
	JUMP ?L52
?L51:	SET 'H-CK,HERE
?L52:	ADD OFFS,3 >OFFS
	GRTR? OFFS,54 /?L54
	GET MAP-TBL,OFFS >STACK
	EQUAL? H-CK,STACK \?L52
	ADD OFFS,1 >STACK
	GET MAP-TBL,STACK >LON-S
	ADD OFFS,2 >STACK
	GET MAP-TBL,STACK >LAT-S
?L54:	PRINTI "The box comes to life, its L.E.D.s lighting, and then flashes 24 degrees 11 minutes "
	PRINTN LAT-S
	PRINTI " seconds N latitude, 32 degrees 12 minutes "
	PRINTN LON-S
	PRINTR " seconds E longitude."
?L1:	EQUAL? PRSA,V?FIND \FALSE
	PRINTR "It's on the top of the box."

	.FUNCT DIASMBIGUATE-FCN,OBJECT
	IN? ONE-MATCH,WINNER \?L1
	RETURN ONE-MATCH
?L1:	IN? MATCHES,WINNER \?L3
	FSET? MATCHES,OPENBIT /?L4
	PRINTI "(opening matchbook first)"
	CRLF
	FSET MATCHES,OPENBIT
?L4:	GRTR? MATCH-COUNT,1 \?L9
	RETURN MANY-MATCHES
?L9:	EQUAL? MATCH-COUNT,1 \?L11
	RETURN SINGLE-MATCH
?L11:	RETURN EMPTY-MATCHES
?L3:	RETURN ONE-MATCH

	.FUNCT SOUTH-CENTER-F,RARG,OFFS=-1,BK
	EQUAL? RARG,M-END \FALSE
?L1:	IGRTR? 'OFFS,8 /FALSE
	GET BRICKS-TBL,OFFS >BK
	IN? BK,PUNCH-PANEL \?L1
	FSET BK,NDESCBIT
	JUMP ?L1

	.FUNCT MOVE-PANEL-HERE,RARG
	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? HERE,LANDING-ONE,LANDING-THREE,TINY-LANDING \FALSE
	CALL MOVE-ROPE-HERE,M-ENTER
	FCLEAR ROPE,NDESCBIT
	RFALSE

	.FUNCT PUNCH-PANEL-FCN,NUM
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,PUNCH-PANEL \?L1
	GETP PRSO,P?BRICK >STACK
	ZERO? STACK \?L1
	PRINTR "It won't fit in there."
?L1:	EQUAL? PRSA,V?READ,V?LOOK-INSIDE,V?EXAMINE \?L5
	SUB 9,BRICKS-TAKEN >NUM
	PRINTI "There "
	EQUAL? NUM,1 \?L8
	PRINTI "is "
	JUMP ?L12
?L8:	PRINTI "are "
?L12:	GET NUM-TBL,NUM >STACK
	PRINT STACK
	PRINTI " brick"
	EQUAL? NUM,1 /?L17
	PRINTI "s"
?L17:	PRINTI " recessed into the panel"
	EQUAL? NUM,0,1 \?L24
	PRINTI "."
	CRLF
	JUMP ?L28
?L24:	PRINTI ", three rows by three columns. These bricks look as if they could be easily removed and are marked with numerical symbols."
	CRLF
?L28:	CRLF
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINT DASH-STR
	CRLF
	PRINT EX-SP-EX-STR
	CRLF
	PRINTI "!  "
	IN? BRICK-ONE,PUNCH-PANEL \?L37
	PRINTI "<.>"
	JUMP ?L41
?L37:	PRINTI "   "
?L41:	PRINTI "     "
	IN? BRICK-TWO,PUNCH-PANEL \?L46
	PRINTI "<:>"
	JUMP ?L50
?L46:	PRINTI "   "
?L50:	PRINTI "     "
	IN? BRICK-THREE,PUNCH-PANEL \?L55
	PRINTI "<:.>"
	JUMP ?L59
?L55:	PRINTI "    "
?L59:	PRINTI "     !"
	CRLF
	PRINT EX-SP-EX-STR
	CRLF
	PRINTI "!  "
	IN? BRICK-FOUR,PUNCH-PANEL \?L68
	PRINTI "<::>"
	JUMP ?L72
?L68:	PRINTI "    "
?L72:	PRINTI "    "
	IN? BRICK-FIVE,PUNCH-PANEL \?L77
	PRINTI "<::.>"
	JUMP ?L81
?L77:	PRINTI "     "
?L81:	PRINTI "   "
	IN? BRICK-SIX,PUNCH-PANEL \?L86
	PRINTI "<:::>"
	JUMP ?L90
?L86:	PRINTI "     "
?L90:	PRINTI "    !"
	CRLF
	PRINT EX-SP-EX-STR
	CRLF
	PRINTI "!  "
	IN? BRICK-SEVEN,PUNCH-PANEL \?L99
	PRINTI "<:::.>"
	JUMP ?L103
?L99:	PRINTI "      "
?L103:	PRINTI "  "
	IN? BRICK-EIGHT,PUNCH-PANEL \?L108
	PRINTI "<::::>"
	JUMP ?L112
?L108:	PRINTI "      "
?L112:	PRINTI "  "
	IN? BRICK-NINE,PUNCH-PANEL \?L117
	PRINTI "<::::.>"
	JUMP ?L121
?L117:	PRINTI "       "
?L121:	PRINTI "  !"
	CRLF
	PRINT EX-SP-EX-STR
	CRLF
	PRINT DASH-STR
	CRLF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L5:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL HOW?,PUNCH-PANEL
	RTRUE

	.FUNCT TAKE-BRICK-FCN
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \?L5
	EQUAL? PRSI,PUNCH-PANEL \?L5
	FSET PRSO,NDESCBIT
	DEC 'BRICKS-TAKEN
	RFALSE
?L5:	EQUAL? PRSA,V?TAKE \FALSE
	IN? PRSO,PUNCH-PANEL \FALSE
	CALL ITAKE >STACK
	ZERO? STACK \?L9
	RETURN 2
?L9:	ZERO? BRICKS-TAKEN \?L14
	EQUAL? PRSO,BRICK-ONE /?L14
	SET 'WRONG-BRICK,1
	JUMP ?L17
?L14:	EQUAL? BRICKS-TAKEN,1 \?L16
	EQUAL? PRSO,BRICK-THREE /?L16
	SET 'WRONG-BRICK,1
	JUMP ?L17
?L16:	EQUAL? BRICKS-TAKEN,2 \?L17
	EQUAL? PRSO,BRICK-FIVE /?L17
	SET 'WRONG-BRICK,1
?L17:	INC 'BRICKS-TAKEN
	IN? PRSO,PUNCH-PANEL /?L19
	FCLEAR PRSO,NDESCBIT
?L19:	EQUAL? BRICKS-TAKEN,3 \?L22
	ZERO? BRICKS-PRESSED \?L22
	ZERO? WRONG-BRICK \?L22
	PRINTI "As soon as you grasp this brick a square doorway swings open. You leap back, unsure of what might happen, but quickly realize you've discovered a hidden passageway, making eastern movement from this cube room possible."
	CRLF
	SET 'BRICKS-PRESSED,1
	ADD SCORE,25 >SCORE
	PUTP SOUTH-CENTER,P?LDESC,STR?143
	RTRUE
?L22:	PRINTR "Taken."

	.FUNCT SCORE-RMS,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FSET? HERE,TOUCHBIT /FALSE
	ADD SCORE,25 >SCORE
	RFALSE

	.FUNCT LOOK-DOWN-HALLS
	PRINTI "As you peer down the dimly-lit hallways, you "
	CALL STATUE-OPPOSITE? >STACK
	ZERO? STACK \?L3
	PRINTI "see that the doors in all four hallways are balanced halfway open."
	CRLF
	JUMP ?L7
?L3:	PRINTI "notice that the door to the "
	PRINT HALL-DIR
	PRINTI " is closed, while the one in the opposite hallway is all the way open. The other two are halfway open."
	CRLF
?L7:	FSET ROPE,NDESCBIT
	RTRUE

	.FUNCT CIRCULAR-ROOM-FCN,RARG
	EQUAL? RARG,M-ENTER \?L1
	MOVE ROPE,HERE
	FCLEAR ROPE,NDESCBIT
	REMOVE ISIS-DOOR
	REMOVE NEPHTH-DOOR
	REMOVE NEITH-DOOR
	REMOVE SELKIS-DOOR
	ZERO? CIRCLE-SCORED \?L3
	ADD SCORE,30 >SCORE
	SET 'CIRCLE-SCORED,1
?L3:	ZERO? VERBOSE \FALSE
	FSET? HERE,TOUCHBIT \FALSE
	CALL LOOK-DOWN-HALLS
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	FCLEAR ROPE,NDESCBIT
	GETP LANDING-ZERO,P?LDESC >STACK
	PRINT STACK
	CRLF
	CALL DESCRIBE-ROPE-FCN,M-OBJDESC
	CALL LOOK-DOWN-HALLS >STACK
	RSTACK

	.FUNCT HEAD-FCN
	EQUAL? PRSA,V?RAISE \?L1
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?SHAKE \?L3
	PRINTR "It's as empty as yours."
?L3:	EQUAL? PRSA,V?CLIMB-ON \FALSE
	PRINTR "Next you'll be asking for tumbling lessons."

	.FUNCT HUGE-STATUE-FCN
	EQUAL? PRSA,V?PUSH,V?TAKE,V?MOVE /?L3
	EQUAL? PRSA,V?PUSH-TO \?L1
?L3:	FSET? HEAD,INVISIBLE \?L1
	PRINTI "The statue teeters, swaying and rocking back and forth, then falls over, its top-heavy structure striking the floor with a dull, loud thud. As you look over the damage, you see the head has separated from the statue."
	CRLF
	CALL PRINT-ID,STR?144
	MOVE HEAD,HERE
	FCLEAR HEAD,INVISIBLE
	FSET HUGE-STATUE,TOUCHBIT
	RTRUE
?L1:	EQUAL? PRSA,V?RAISE,V?TAKE \?L6
	PRINTR "It's far too heavy."
?L6:	EQUAL? PRSA,V?MOVE,V?RAISE,V?PUSH \?L9
	PRINTR "The statue rocks over and back on its back. Looks like it's headed nowhere fast."
?L9:	EQUAL? PRSA,V?MUNG \?L12
	CALL PRINT-ID,STR?145
	FSET? HEAD,INVISIBLE \?L13
	CALL PERFORM,V?PUSH,HUGE-STATUE
	RTRUE
?L13:	PRINTR "Haven't you done enough damage to that beautiful relic?"
?L12:	EQUAL? PRSA,V?EXAMINE \FALSE
	FSET? HEAD,INVISIBLE /FALSE
	PRINTR "The statue lies on the floor, its head broken off. In this state, the statue weighs a little less than you but it's still far too heavy to carry."

	.FUNCT STONE-DOOR-FCN
	EQUAL? PRSA,V?RAISE,V?OPEN \FALSE
	PRINTR "You can't. It's got to weigh 50 tons."

	.FUNCT STATUE-OPPOSITE?,OFFS=-3,H-CHK,T-CHK,FLG=0
?L1:	ADD OFFS,3 >OFFS
	GRTR? OFFS,9 \?L3
	RETURN FLG
?L3:	GET STATUE-CHK-TBL,OFFS >H-CHK
	ADD OFFS,1 >STACK
	GET STATUE-CHK-TBL,STACK >T-CHK
	EQUAL? HERE,H-CHK,LANDING-ZERO \?L1
	CALL WEIGHT,T-CHK >STACK
	GRTR? STACK,300 \?L1
	SET 'FLG,1
	ADD OFFS,2 >STACK
	GET STATUE-CHK-TBL,STACK >HALL-DIR
	JUMP ?L1

	.FUNCT CLOSE-DEM-DOOAHS,RARG
	EQUAL? RARG,M-ENTER \?L1
	SET 'KLUDGE-FLG,0
	CALL STATUE-OPPOSITE? >STACK
	ZERO? STACK /?L3
	EQUAL? HERE,A-PRIME \?L5
	FSET NEPHTH-DOOR,OPENBIT
	RTRUE
?L5:	EQUAL? HERE,B-PRIME \?L7
	FSET SELKIS-DOOR,OPENBIT
	RTRUE
?L7:	EQUAL? HERE,D-PRIME \?L8
	FSET ISIS-DOOR,OPENBIT
	RTRUE
?L8:	FSET NEITH-DOOR,OPENBIT
	RTRUE
?L3:	CALL WEIGHT,HERE >STACK
	GRTR? STACK,300 /FALSE
	PRINTI "As you enter the corridor, a huge stone door begins to slide down from the ceiling closing off any further progress. The closer you come to the door, the further down the door descends until, eventually, it is close to the floor. When you turn around, you can barely see beyond the Circular Room where an identical door has risen off the floor an equal amount."
	CRLF
	CRLF
	EQUAL? HERE,A-PRIME,E-PRIME \?L14
	MOVE NEPHTH-DOOR,A-PRIME
	FCLEAR NEPHTH-DOOR,OPENBIT
	MOVE NEITH-DOOR,E-PRIME
	FCLEAR NEITH-DOOR,OPENBIT
	JUMP ?L16
?L14:	EQUAL? HERE,B-PRIME,D-PRIME \?L16
	MOVE SELKIS-DOOR,B-PRIME
	MOVE ISIS-DOOR,D-PRIME
	FCLEAR SELKIS-DOOR,OPENBIT
	FCLEAR ISIS-DOOR,OPENBIT
?L16:	SET 'KLUDGE-FLG,1
	RETURN KLUDGE-FLG
?L1:	EQUAL? RARG,M-END \FALSE
	CALL STATUE-OPPOSITE? >STACK
	ZERO? STACK /FALSE
	ZERO? KLUDGE-FLG \FALSE
	PRINTI "The path before you remains open, the stone door having risen to the ceiling, counterbalanced by the door in the opposite corridor."
	CRLF
	SET 'KLUDGE-FLG,1
	RTRUE

	.FUNCT I-RING-KILL
	INC 'RING-COUNTER
	EQUAL? RING-COUNTER,3 \?L1
	PRINTI "You're starting to feel a little woozy. You blink your eyes, but can't seem to focus correctly. You think you see Craige standing by a wall."
	CRLF
	CALL PRINT-ID,STR?146 >STACK
	RSTACK
?L1:	EQUAL? RING-COUNTER,5 \?L5
	PRINTI "Your ring finger is starting to throb painfully."
	CRLF
	CALL PRINT-ID,STR?147 >STACK
	RSTACK
?L5:	GRTR? RING-COUNTER,7 \FALSE
	CALL PRINT-ID,STR?148
	CALL JIGS-UP,STR?149 >STACK
	RSTACK

	.FUNCT I-GINANDTONIC
	GRTR? THIRST,400 \?L1
	CALL PRINT-ID,STR?150
	CALL JIGS-UP,STR?151 >STACK
	RSTACK
?L1:	GRTR? THIRST,380 \?L3
	LESS? THIRST,387 \?L3
	SET 'NILE-DRINKS,0
	PRINTI "If you don't drink something, and now, you're gonna be history."
	CRLF
	CALL PRINT-ID,STR?152 >STACK
	RSTACK
?L3:	GRTR? THIRST,300 \?L6
	LESS? THIRST,317 \?L6
	SET 'NILE-DRINKS,0
	CALL PRINT-ID,STR?153
	EQUAL? HERE,SUPPLY-TENT,TENT2,TENT /?L7
	PRINTR "You'd better drink something, and soon!"
?L7:	PRINTR "You wipe your fevered brow."
?L6:	GRTR? THIRST,200 \FALSE
	LESS? THIRST,217 \FALSE
	SET 'NILE-DRINKS,0
	CALL PRINT-ID,STR?154
	EQUAL? HERE,SUPPLY-TENT,TENT2,TENT /?L15
	PRINTR "You scowl at the sun, cursing its searing heat."
?L15:	PRINTR "Even in the tent the heat starts to get to you."

	.FUNCT I-MATCH-OUT,BLOWN?,FLG=0
	FSET? ONE-MATCH,FLAMEBIT \?L1
	ZERO? BLOWN? \?L8
	PRINTI "Your match went out."
	JUMP ?L7
?L8:	PRINTI "You blow out the match and toss it aside."
?L7:	SET 'FLG,1
?L1:	FCLEAR ONE-MATCH,ONBIT
	FCLEAR ONE-MATCH,FLAMEBIT
	FCLEAR MANY-MATCHES,FLAMEBIT
	IN? ONE-MATCH,WINNER \?L12
	ZERO? BLOWN? \?L12
	PRINTI " And it burned your fingers, too! You drop it. "
	CALL PRINT-ID,STR?155
	CALL BUT-WHERE?
	SET 'FLG,0
?L12:	MOVE ONE-MATCH,GLOBAL-OBJECTS
	ZERO? LIT /?L17
	CALL LIT?,HERE >LIT
?L17:	CALL LIT?,HERE >LIT
	ZERO? LIT \?L20
	PRINTI " It is now pitch black."
	SET 'FLG,1
?L20:	ZERO? FLG /FALSE
	CRLF
	RTRUE

	.FUNCT I-TORCH,FLG=0
	INC 'TORCH-TURNS
	ZERO? OILED-TORCH \?L1
	PRINTI "Your torch is too dry and burns itself out quickly."
	CRLF
	CALL KILL-TORCH
	SET 'FLG,1
?L1:	IN? TORCH,WINNER /?L8
	LOC WINNER >STACK
	LOC TORCH >STACK
	EQUAL? STACK,STACK \?L6
?L8:	EQUAL? TORCH-TURNS,150 \?L9
	PRINTI "Your torch is beginning to sputter."
	CRLF
	SET 'FLG,1
	RETURN FLG
?L9:	EQUAL? TORCH-TURNS,162 \?L13
	PRINTI "Your torch is getting very, very dim."
	CRLF
	SET 'FLG,1
	RETURN FLG
?L13:	EQUAL? TORCH-TURNS,175 \?L20
	PRINTI "With a final blaze of glory, your torch goes out."
	CRLF
	CALL KILL-TORCH
	SET 'FLG,1
	RETURN FLG
?L6:	GRTR? TORCH-TURNS,174 \?L20
	CALL KILL-TORCH
?L20:	RETURN FLG

	.FUNCT KILL-TORCH,IN-SLAB?=0
	FCLEAR TORCH,ONBIT
	FCLEAR TORCH,FLAMEBIT
	ZERO? IN-SLAB? \?L1
	SET 'OIL-SOAKED,0
	SET 'OILED-TORCH,0
	SET 'TORCH-TURNS,0
?L1:	ZERO? LIT /?L4
	CALL LIT?,HERE >LIT
?L4:	CALL LIT?,HERE >LIT
	ZERO? LIT \?L7
	PRINTI "It is now pitch black."
	CRLF
?L7:	CALL INT,I-TORCH >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT I-RESET-STATUES,CHECK-OFF=0,COUNTER=0,CLEAR-OFF=0,FLG=0,STR
?L1:	EQUAL? CHECK-OFF,4 /?L2
	INC 'CHECK-OFF
	GET TURNED-LTBL,CHECK-OFF >STACK
	GET ORDER-LTBL,CHECK-OFF >STACK
	EQUAL? STACK,STACK \?L8
	GET TURNED-LTBL,CHECK-OFF >STACK
	FSET? STACK,CLAMPBIT \?L1
?L8:	SET 'TURN-OFFSET,0
?L9:	INC 'CLEAR-OFF
	EQUAL? CLEAR-OFF,5 /?L10
	PUT TURNED-LTBL,CLEAR-OFF,0
	SUB CLEAR-OFF,1 >STACK
	GET STATUE-TBL,STACK >STACK
	FSET? STACK,CLAMPBIT /?L14
	INC 'COUNTER
?L14:	SUB CLEAR-OFF,1 >STACK
	GET STATUE-TBL,STACK >STACK
	FSET STACK,CLAMPBIT
	JUMP ?L9
?L10:	GET NUM-TBL,COUNTER >STR
	ZERO? COUNTER \?L17
	PRINTI "A loud click comes from beneath the four statues as they clamp down on the cover again."
	CRLF
	JUMP ?L28
?L17:	PRINTI "The "
	PRINT STR
	PRINTI " statue"
	GRTR? COUNTER,1 \?L24
	PRINTI "s, heavy though they are, effortlessly swing back in unison to clamp down on the quartz cover again."
	CRLF
	JUMP ?L28
?L24:	PRINTI ", heavy though it is, effortlessly swings back to clamp down on the quartz cover again."
	CRLF
?L28:	SET 'FLG,1
?L2:	ZERO? FLG \FALSE
	PRINTI "The statues freeze in their current positions and you hear a light click come from the cover of the sarcophagus."
	CRLF
	SET 'CAN-TURN-STATUES,0
	SET 'STATUES-SET,1
	ADD SCORE,35 >SCORE
	RETURN SCORE

	.FUNCT I-GROWL
	IGRTR? 'HUNGER,70 \?L1
	LESS? HUNGER,73 \?L1
	PRINTI "Your stomach growls in hunger."
	CRLF
	CALL PRINT-ID,STR?156 >STACK
	RSTACK
?L1:	GRTR? HUNGER,100 \?L5
	LESS? HUNGER,103 \?L5
	PRINTI "You feel yourself growing weaker. Without nourishment, this is a losing cause!"
	CRLF
	CALL PRINT-ID,STR?157 >STACK
	RSTACK
?L5:	GRTR? HUNGER,140 \FALSE
	CALL PRINT-ID,STR?158
	CALL JIGS-UP,STR?159 >STACK
	RSTACK

	.FUNCT I-PARACHUTE
	LESS? MOVES,3 \?L1
	CALL IN-A-TENT? >STACK
	ZERO? STACK /?L3
	CRLF
	PRINTR "You hear a plane flying high overhead, outside the tent."
?L3:	CRLF
	PRINTR "You crane your neck and see a plane, high overhead, circling the encampment."
?L1:	LESS? MOVES,5 \?L10
	CALL IN-A-TENT? >STACK
	ZERO? STACK /?L11
	CRLF
	PRINTR "It sounds as if the plane is circling."
?L11:	CRLF
	PRINTR "The plane seems to be circling right overhead."
?L10:	EQUAL? MOVES,5 \?L18
	CALL IN-A-TENT? >STACK
	ZERO? STACK \?L19
	CRLF
	PRINTR "You look up to see a small speck appear right beneath the plane -- probably a parachute. The plane heads off far to the northwest, dipping its wings in a salute."
?L19:	CRLF
	PRINTR "It sounds as if the plane is flying off."
?L18:	EQUAL? MOVES,6 \?L26
	CALL IN-A-TENT? >STACK
	ZERO? STACK \?L27
	CRLF
	PRINTR "A small speck descending from the plane overhead gets larger until you see a crate, dangling from a parachute."
?L27:	CRLF
	PRINTR "You can barely hear the plane."
?L26:	EQUAL? MOVES,7 \FALSE
	CALL IN-A-TENT? >STACK
	ZERO? STACK /?L35
	CALL PICK-ONE,ROOM-LTBL >STACK
	MOVE CRATE,STACK
	CRLF
	PRINTI "The sound of something heavy landing comes from nearby."
	CRLF
	JUMP ?L39
?L35:	CRLF
	PRINTI "At last, your luck seems to be changing. A large crate lands right before you, its parachute flapping in the breeze. The parachute breaks away from the crate and drifts off in the wind."
	CRLF
	MOVE CRATE,HERE
?L39:	FSET CRATE,VEHBIT
	CALL INT,I-PARACHUTE >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT IN-A-TENT?,COT-TOO?=1
	ZERO? COT-TOO? /?L12
	LOC WINNER >STACK
	EQUAL? STACK,TENT,TENT2,SUPPLY-TENT /TRUE
	LOC WINNER >STACK
	EQUAL? STACK,COT \FALSE
	RTRUE
?L12:	LOC WINNER >STACK
	EQUAL? STACK,TENT,TENT2,SUPPLY-TENT \FALSE
	RTRUE

	.FUNCT RANDOMIZE-HOLES,OFFS=0,MAX,?TMP
	GET RANDOM-ROOM-LTBL,0 >MAX
?L1:	IGRTR? 'OFFS,MAX /TRUE
	GET RANDOM-ROOM-LTBL,OFFS >?TMP
	RANDOM 2 >STACK
	PUTP ?TMP,P?CAPACITY,STACK
	JUMP ?L1

	.FUNCT I-PYRAMID-DRINK
	GETP HERE,P?MAP >STACK
	ZERO? STACK /?L1
	CALL INT,I-PYRAMID-DRINK >STACK
	PUT STACK,0,0
	RFALSE
?L1:	INC 'PYR-THIRST
	SET 'NILE-DRINKS,0
	EQUAL? PYR-THIRST,1 \?L4
	PRINTI "Even in this pyramid, you need to drink something, and soon."
	CRLF
	CALL PRINT-ID,STR?160 >STACK
	RSTACK
?L4:	EQUAL? PYR-THIRST,10 \?L8
	PRINTI "Your throat feels as if it's coated with razor blades. Some water would be in order."
	CRLF
	CALL PRINT-ID,STR?161 >STACK
	RSTACK
?L8:	EQUAL? PYR-THIRST,19 \?L11
	PRINTI "Better drink something. NOW!"
	CRLF
	CALL PRINT-ID,STR?162 >STACK
	RSTACK
?L11:	EQUAL? PYR-THIRST,25 \FALSE
	CALL PRINT-ID,STR?163
	CALL JIGS-UP,STR?164 >STACK
	RSTACK

	.FUNCT TELL-STAIRS-FCN,PLACE,FLG=0,R-FLG=0
	IN? WINNER,ALTAR \?L1
	RETURN LANDING-ONE
?L1:	PRINTI "(down the "
	ZERO? ROPE-TIED /?L6
	IN? ROPE,WINNER \?L6
	MOVE ROPE,HERE
	SET 'R-FLG,1
?L6:	EQUAL? PRSO,P?EAST \?L9
	PRINTI "wide staircase)"
	CRLF
	SET 'PLACE,LANDING-ONE
	SET 'FLG,1
	JUMP ?L19
?L9:	EQUAL? PRSO,P?WEST \?L13
	PRINTI "narrow staircase)"
	CRLF
	SET 'PLACE,LANDING-THREE
	SET 'FLG,1
	JUMP ?L19
?L13:	EQUAL? PRSO,P?NORTH \?L16
	PRINTI "steep staircase)"
	CRLF
	SET 'PLACE,LANDING-ZERO
	JUMP ?L19
?L16:	EQUAL? PRSO,P?SOUTH \?L19
	PRINTI "winding staircase)"
	CRLF
	SET 'PLACE,LANDING-TWO
?L19:	ZERO? R-FLG /?L23
	PRINTI "You release the free end of the rope as you walk."
	CRLF
?L23:	ZERO? FLG /?L28
	PRINTI "The staircase winds as you walk down, turning you around so you face in the opposite direction."
	CRLF
	CRLF
?L28:	RETURN PLACE

	.FUNCT RE-ENABLE-FCN
	IN? WINNER,ALTAR /?L1
	CALL QUEUE,I-GINANDTONIC,-1 >STACK
	PUT STACK,0,1
?L1:	ZERO? ROPE-TIED /?L4
	IN? ROPE,WINNER \?L4
	MOVE ROPE,CHAMBER-OF-RA
	PRINTI "You release the free end of the rope as you walk."
	CRLF
?L4:	RETURN EX8

	.FUNCT ROPE-HOOK-FCN
	IN? WINNER,ALTAR \?L1
	RETURN LANDING-ONE
?L1:	ZERO? ROPE-TIED /?L9
	EQUAL? LANDING,LANDING-ZERO \?L3
	PRINTI "(down the rope)"
	CRLF
	RETURN LANDING-ZERO
?L3:	ZERO? ROPE-TIED /?L9
	ZERO? LANDING /?L6
	PRINTI "(down the steep staircase)"
	CRLF
	CALL JIGS-UP,PLUNGE-STR >STACK
	RSTACK
?L6:	ZERO? ROPE-TIED /?L9
	CALL PRINT-ID,STR?165
	CALL JIGS-UP,STR?166 >STACK
	RSTACK
?L9:	CALL JIGS-UP,PLUNGE-STR >STACK
	RSTACK

	.FUNCT ROPE-DOWN-FCN
	ZERO? ROPE-TIED /?L3
	ZERO? ROPE-PLACED \?L1
?L3:	IN? WINNER,ALTAR \?L4
	RETURN LANDING-TWO
?L4:	EQUAL? HERE,CHAMBER-OF-RA \?L6
	PRINTI "Since there are four staircases going down, you'd better say which staircase."
	CRLF
	RFALSE
?L6:	CALL JIGS-UP,PLUNGE-STR
	RFALSE
?L1:	ZERO? ROPE-HACK \?L11
	PRINTI "(down the rope)"
	CRLF
?L11:	RETURN LANDING

	.FUNCT MOVE-ROPE-RA,RARG
	EQUAL? RARG,M-ENTER \?L3
	EQUAL? ROPE-TIED,ALTAR \?L1
	CALL INT,I-GINANDTONIC >STACK
	PUT STACK,0,0
	MOVE ROPE,HERE
	FCLEAR ROPE,NDESCBIT
	RFALSE
?L1:	EQUAL? RARG,M-ENTER \?L3
	CALL INT,I-GINANDTONIC >STACK
	PUT STACK,0,0
	RTRUE
?L3:	EQUAL? RARG,M-LOOK \?L4
	PRINT RA-STR
	ZERO? ROPE-PLACED /?L7
	FSET ROPE,NDESCBIT
	PRINTI " Descending the "
	PRINTD ROPE-PLACED
	PRINTI " is one end of the rope."
?L7:	PRINTI " In the center of the room is a large red sandstone altar mounted solidly in the floor."
	ZERO? ROPE-TIED /?L22
	PRINTI " The rope is tied to the "
	PRINTD ROPE-TIED
	PRINTI "."
	IN? ROPE,CHAMBER-OF-RA \?L18
	ZERO? ROPE-PLACED \?L18
	PRINTR " The other end of the rope rests on the floor."
?L18:	IN? ROPE,ALTAR \?L22
	PRINTI " The other end rests on the altar."
?L22:	CRLF
	RTRUE
?L4:	EQUAL? RARG,M-END \?L27
	FCLEAR ROPE,NDESCBIT
	SET 'ROPE-HACK,0
	RFALSE
?L27:	EQUAL? RARG,M-BEG \FALSE
	ZERO? ROPE-TIED \?L29
	ZERO? ROPE-PLACED /FALSE
?L29:	IN? ROPE,WINNER /FALSE
	FSET ROPE,NDESCBIT
	RFALSE

	.FUNCT RA-STAIRS-FCN
	EQUAL? PRSA,V?EXAMINE,V?LOOK-DOWN \?L1
	CALL FLAMING?,TORCH >STACK
	ZERO? STACK \?L3
	CALL FLAMING?,MATCHES >STACK
	ZERO? STACK \?L3
	PRINTR "There's just enough light to see the first few steps."
?L3:	CALL FLAMING?,TORCH >STACK
	ZERO? STACK \?L8
	CALL FLAMING?,MATCHES >STACK
	ZERO? STACK /TRUE
?L8:	EQUAL? PRSO,NORTH-STAIRS /?L9
	PRINTR "You can see far enough down the stairs to make out a landing below."
?L9:	PRINTR "You can see the first few steps and then what could only be a sheer dropoff, going down into total darkness."
?L1:	EQUAL? PRSA,V?CLIMB-DOWN \FALSE
	EQUAL? PRSO,NORTH-STAIRS \?L18
	EQUAL? ROPE-PLACED,NORTH-STAIRS \?L20
	CALL PERFORM,V?CLIMB-DOWN,ROPE
	RTRUE
?L20:	CALL JIGS-UP,PLUNGE-STR
	RETURN 2
?L18:	EQUAL? PRSO,EAST-STAIRS \?L25
	CALL GOTO,LANDING-ONE >STACK
	RSTACK
?L25:	EQUAL? PRSO,SOUTH-STAIRS \?L26
	CALL GOTO,LANDING-TWO >STACK
	RSTACK
?L26:	EQUAL? PRSO,WEST-STAIRS \FALSE
	CALL GOTO,LANDING-THREE >STACK
	RSTACK

	.FUNCT FEW-STEPS-FCN
	EQUAL? PRSA,V?CLIMB-ON,V?BOARD,V?CLIMB-DOWN \FALSE
	CALL GOTO,TINY-LANDING
	CALL MOVE-ROPE-HERE,M-ENTER
	IN? ROPE,HERE \?L3
	FCLEAR ROPE,NDESCBIT
	CALL DESCRIBE-ROPE-FCN,M-OBJDESC
?L3:	RETURN 2

	.FUNCT ALTAR-FCN,RARG=M-OBJECT
	EQUAL? RARG,M-OBJECT \FALSE
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L11
	FIRST? ALTAR >STACK \?L4
	FIRST? ALTAR >STACK /?L5
?L5:	EQUAL? STACK,WINNER,ADVENTURER \?L3
?L4:	EQUAL? PRSO,ALTAR \?L3
	GETP ALTAR,P?TEXT >STACK
	PRINT STACK
	PRINTR " There is nothing on the altar."
?L3:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L11
	IN? WINNER,ALTAR \?L8
	EQUAL? PRSO,ALTAR \?L8
	CALL CCOUNT,ALTAR >STACK
	LESS? STACK,2 \?L8
	GETP ALTAR,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L8:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L11
	EQUAL? PRSO,ALTAR \?L11
	CALL PRINT-CONT,ALTAR
	RTRUE
?L11:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	EQUAL? PRSO,ALTAR \FALSE
	CALL HOW?,ALTAR
	RTRUE

	.FUNCT MOVE-ROPE-HERE,RARG
	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? LANDING,HERE /?L3
	EQUAL? LANDING,LANDING-ZERO \FALSE
	EQUAL? HERE,TINY-LANDING \FALSE
?L3:	MOVE ROPE,HERE
	FCLEAR ROPE,NDESCBIT
	RFALSE

	.FUNCT TORCH-FCN
	EQUAL? PRSI,TORCH \?L1
	CALL FLAMING?,TORCH >STACK
	ZERO? STACK /?L1
	IN? TORCH,HERE \?L1
	EQUAL? PRSA,V?THROW,V?DROP \?L1
	IN? PRSO,WINNER \?L1
	FSET? PRSO,BURNBIT \?L1
	EQUAL? PRSA,V?DROP \?L3
	PRINTI "Dropped. "
	JUMP ?L7
?L3:	PRINTI "Thrown. "
?L7:	CALL V-BURN
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	GETP TORCH,P?TEXT >STACK
	PRINT STACK
	PRINTI " The torch is "
	CALL FLAMING?,TORCH >STACK
	ZERO? STACK \?L13
	PRINTI "not lit"
	JUMP ?L23
?L13:	LESS? TORCH-TURNS,125 \?L17
	PRINTI "burning brightly"
	JUMP ?L23
?L17:	LESS? TORCH-TURNS,160 \?L20
	PRINTI "burning dimly"
	JUMP ?L23
?L20:	LESS? TORCH-TURNS,175 \?L23
	PRINTI "barely lit"
?L23:	PRINTR "."

	.FUNCT OIL-FCN
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	FSET? OIL-JAR,OPENBIT \FALSE
	GRTR? OIL-LEFT,0 \?L6
	PRINTR "Inside the small pink jar is some liquid."
?L6:	PRINTR "The jar is empty."
?L1:	EQUAL? PRSA,V?OPEN \FALSE
	FSET? OIL-JAR,OPENBIT /FALSE
	GRTR? OIL-LEFT,0 \?L14
	PRINTI "Opening the jar reveals a small amount of liquid."
	CRLF
	JUMP ?L18
?L14:	PRINTI "Opened."
	CRLF
?L18:	FSET OIL-JAR,OPENBIT
	RTRUE

	.FUNCT LIQUID-FCN
	EQUAL? PRSA,V?EXAMINE /FALSE
	EQUAL? PRSA,V?POUR-ON,V?POUR \?L3
	IN? OIL-JAR,WINNER /?L4
	CALL ITAKE >STACK
	ZERO? STACK /?L6
	PRINTI "(taken)"
	CRLF
	CALL PERFORM,PRSA,OIL-JAR
	RTRUE
?L6:	PRINTR "Hmm. It would be easier if you were holding it."
?L4:	CALL PERFORM,PRSA,OIL-JAR
	RTRUE
?L3:	EQUAL? PRSA,V?TASTE \FALSE
	FSET? OIL-JAR,OPENBIT \FALSE
	PRINTI "It tastes horrible."
	CRLF
	CALL PRINT-ID,STR?167 >STACK
	RSTACK

	.FUNCT LINE-FCN
	CALL HELD?,SILVER-CUP >STACK
	ZERO? STACK \FALSE
	IN? SILVER-CUP,HERE /FALSE
	PRINTI "I can't see any "
	PRINTD PRSO
	PRINTR " here."

	.FUNCT CUP-FCN
	EQUAL? PRSO,SILVER-CUP \?L1
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	IN? WATER,SILVER-CUP /?L3
	IN? LIQUID,SILVER-CUP \?L1
?L3:	PRINTI "The "
	IN? WATER,SILVER-CUP \?L6
	PRINTI "water"
	JUMP ?L10
?L6:	PRINTI "oily liquid"
?L10:	PRINTR " fills the cup up to the line."
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL HOW?,PRSO
	RTRUE

	.FUNCT SKELETON-FCN
	EQUAL? PRSA,V?MOVE,V?SHAKE,V?TAKE /?L3
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSO,SKELETON \?L1
?L3:	PRINTI "If you tried that, the skeleton would fall apart, bone by bone."
	CRLF
	CALL PRINT-ID,STR?168
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L6
	CALL HOW?,PRSO
	RTRUE
?L6:	EQUAL? PRSA,V?ALARM \?L7
	PRINTI "Let the dead rest."
	CRLF
	CALL PRINT-ID,STR?169
	RTRUE
?L7:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L10
	IN? RING,DIGITS \?L11
	PRINTR "On the bony digits of one hand is a jeweled ring."
?L11:	PRINTI "I see nothing special about the "
	PRINTD PRSO
	PRINTR "."
?L10:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL HOW?,PRSO
	RTRUE

	.FUNCT DIGIT-FCN
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	CALL HOW?,PRSO
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL PERFORM,V?EXAMINE,SKELETON
	RTRUE

	.FUNCT WEAR-RING-FCN
	EQUAL? PRSA,V?WEAR \?L5
	IN? RING,WINNER \?L1
	PRINTI "Ouch! It seems you've pricked your finger while putting on the ring."
	CRLF
	CALL QUEUE,I-RING-KILL,-1 >STACK
	PUT STACK,0,1
	FSET RING,WEARBIT
	RTRUE
?L1:	EQUAL? PRSA,V?WEAR \?L5
	PRINTI "(Taken)"
	CRLF
	MOVE RING,WINNER
	CALL PERFORM,V?WEAR,RING
	RTRUE
?L5:	EQUAL? PRSA,V?TAKE \?L8
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	PRINTI "Taken."
	CRLF
	FCLEAR RING,NDESCBIT
	FCLEAR NEEDLE,INVISIBLE
	FCLEAR RING,DONTTAKE
	PUTP SKELETON,P?FDESC,STR?170
	RTRUE
?L8:	EQUAL? PRSA,V?PUT \?L14
	FSET? RING,NDESCBIT \?L14
	FCLEAR NEEDLE,INVISIBLE
	FCLEAR RING,NDESCBIT
	FCLEAR RING,DONTTAKE
	PUTP SKELETON,P?FDESC,STR?170
	RFALSE
?L14:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L15
	CALL HOW?,PRSO
	RTRUE
?L15:	EQUAL? PRSA,V?DISEMBARK \?L16
	PRINTR "It's stuck on your finger."
?L16:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \FALSE
	GETP RING,P?TEXT >STACK
	PRINT STACK
	CRLF
	FCLEAR NEEDLE,INVISIBLE
	FCLEAR RING,DONTTAKE
	RTRUE

	.FUNCT TOUCH-NEEDLE-FCN
	EQUAL? PRSA,V?RUB \?L1
	PRINTI "You prick your finger on the tiny needle sticking out from the inside of the ring."
	CRLF
	CALL QUEUE,I-RING-KILL,-1 >STACK
	PUT STACK,0,1
	RTRUE
?L1:	EQUAL? PRSA,V?PUT,V?THROW,V?DROP /?L6
	EQUAL? PRSA,V?PUT-ON \?L5
?L6:	PRINTR "Better find a haystack first."
?L5:	EQUAL? PRSA,V?SMELL \?L9
	PRINTR "It smells very faintly of almonds."
?L9:	EQUAL? PRSA,V?TASTE \FALSE
	CALL PRINT-ID,STR?171
	CALL JIGS-UP,STR?172
	RETURN 2

	.INSERT "annotated_games/infidel/infidel_str"
	.END
