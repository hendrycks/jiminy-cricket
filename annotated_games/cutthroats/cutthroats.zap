	.TIME
	.INSERT "cutthroats/cutthroats_freq"
	.INSERT "cutthroats/cutthroats_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	CALL DPRINT,OBJ >STACK
	RSTACK

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-THEFT?
	EQUAL? PRSO,ANCHOR,BATTERY,CAGE /TRUE
	EQUAL? PRSO,CARPET,CHAIR,CHARTS /TRUE
	EQUAL? PRSO,CIGAR,COMPASS,COMPRESSOR /TRUE
	EQUAL? PRSO,DEEP-SUIT,DETECTOR-LABEL,DETECTOR-SWITCH /TRUE
	EQUAL? PRSO,DIVING-BOOK,DRILL,DRY-CELL /TRUE
	EQUAL? PRSO,ENVELOPE,FERRY-TOKEN,FLASHLIGHT /TRUE
	EQUAL? PRSO,ID-CARD,INFIDEL-BOX,KNIFE /TRUE
	EQUAL? PRSO,LOUNGE-CHAIR,MAGNET,METAL-DETECTOR /TRUE
	EQUAL? PRSO,MIRROR,MM-COMPRESSOR,NET /TRUE
	EQUAL? PRSO,PARROTS-PATCH,PETES-PATCH,PRICE-LIST /TRUE
	EQUAL? PRSO,PUTTY,ROPE,SAFE /TRUE
	EQUAL? PRSO,SHARK-REPELLENT,SPEAR-GUN,TABLE-OBJECT /TRUE
	EQUAL? PRSO,TRAWLER,TUBE,WINCH \FALSE
	RTRUE

	.FUNCT PRIVATE-DOOR?
	EQUAL? PRSO,FRONT-DOOR,LOCKED-DOOR \FALSE
	RTRUE

	.FUNCT KILL-VERB?
	EQUAL? PRSA,V?ATTACK,V?MUNG,V?KILL /TRUE
	EQUAL? PRSA,V?RAPE,V?BURN,V?MELT /TRUE
	RFALSE

	.FUNCT HARM-VERB?
	EQUAL? PRSA,V?ROB,V?CUT,V?KISS \FALSE
	RTRUE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,AIR-HOSE,AIR-TANK,AIRTIGHT-DOOR /TRUE
	EQUAL? PRSO,ANCHOR,BACK-WINDOW,BAR /TRUE
	EQUAL? PRSO,BATTERY,BED,BEDROOM-DOOR /TRUE
	EQUAL? PRSO,BOOK,BROKEN-MAST,BULKHEADS /TRUE
	EQUAL? PRSO,BUNK,BUNKS,BUREAU /TRUE
	EQUAL? PRSO,CAGE,CARPET,CASK /TRUE
	EQUAL? PRSO,CEILING,CHAIR,CHARTS /TRUE
	EQUAL? PRSO,CIGAR,CLOSET,CLUMP-OF-MINES /TRUE
	EQUAL? PRSO,COMPASS,COMPRESSOR,DECK /TRUE
	EQUAL? PRSO,DECK-CHAIR,DEEP-SUIT,DETECTOR-COMPARTMENT /TRUE
	EQUAL? PRSO,DETECTOR-LABEL,DETECTOR-SWITCH,DINNER-PLATE /TRUE
	EQUAL? PRSO,DIVING-BOOK,DRILL,DRINK-OBJECT /TRUE
	EQUAL? PRSO,DRINKING-WATER,DRY-CELL,EAST-LADDER /TRUE
	EQUAL? PRSO,EMPTY-CHEST,ENVELOPE,FALLEN-BUNK /TRUE
	EQUAL? PRSO,FERRY,FERRY-TOKEN,FLASHLIGHT /TRUE
	EQUAL? PRSO,FLIPPERS,FOOD,FRONT-DOOR /TRUE
	EQUAL? PRSO,GLASS-CASE,GLOBAL-BANK,GLOBAL-FERRY /TRUE
	EQUAL? PRSO,GLOBAL-MONEY,GLOBAL-TREASURE,GOLD-COIN /TRUE
	EQUAL? PRSO,ID-CARD,INFIDEL-BOX,IRON-BAR /TRUE
	EQUAL? PRSO,KEY,KNIFE,LADDER-BOTTOM /TRUE
	EQUAL? PRSO,LADDER-TOP,LG-IRON-BAR,LIGHTHOUSE /TRUE
	EQUAL? PRSO,LOCKED-DOOR,LOCKER-DOOR,LOUNGE-CHAIR /TRUE
	EQUAL? PRSO,MAGNET,MASK,MAST /TRUE
	EQUAL? PRSO,METAL-DETECTOR,MINE,MIRROR /TRUE
	EQUAL? PRSO,MM-COMPRESSOR,NET,NOTE /TRUE
	EQUAL? PRSO,PARROTS-PATCH,PASSBOOK,PETES-PATCH /TRUE
	EQUAL? PRSO,POCKET,PRICE-LIST,PUTTY /TRUE
	EQUAL? PRSO,RAILING,REDS-BUNK,ROPE /TRUE
	EQUAL? PRSO,SAFE,SAFETY-LINE,SALVAGER /TRUE
	EQUAL? PRSO,SCABBARD,SHARK-REPELLENT,SHIPWRECK /TRUE
	EQUAL? PRSO,SKELETON,SPEAR-GUN,STAIRS /TRUE
	EQUAL? PRSO,STAMPS,STOVE,SWORD /TRUE
	EQUAL? PRSO,TABLE-OBJECT,TRAWLER,TREASURE-CHEST /TRUE
	EQUAL? PRSO,TUBE,WALLPAPER,WALLS /TRUE
	EQUAL? PRSO,WATCH,WEST-LADDER,WET-SUIT /TRUE
	EQUAL? PRSO,WINCH,WINDOW /TRUE
	CALL IS-STRUCTURE? >STACK
	RSTACK

	.FUNCT IS-STRUCTURE?
	EQUAL? PRSO,BANK,BEDROOM,MCGINTY-HQ /TRUE
	EQUAL? PRSO,MM-AFT-DECK,MM-CAPT-CABIN,MM-CREW-QTRS /TRUE
	EQUAL? PRSO,MM-ENGINE-ROOM,MM-FORE-DECK,MM-GALLEY /TRUE
	EQUAL? PRSO,MM-LOCKER,MM-LOUNGE,MM-PORT-DECK /TRUE
	EQUAL? PRSO,MM-STARBOARD-DECK,MM-WHEELHOUSE,NW-AFT-DECK /TRUE
	EQUAL? PRSO,NW-CAPT-CABIN,NW-CREW-QTRS,NW-ENGINE-ROOM /TRUE
	EQUAL? PRSO,NW-FORE-DECK,NW-GALLEY,NW-LOCKER /TRUE
	EQUAL? PRSO,NW-LOUNGE,NW-PORT-DECK,NW-STARBOARD-DECK /TRUE
	EQUAL? PRSO,NW-WHEELHOUSE,OCEAN-FLOOR,OCEAN-ROAD-1 /TRUE
	EQUAL? PRSO,OCEAN-ROAD-2,OCEAN-ROAD-3,OUTFITTERS-HQ /TRUE
	EQUAL? PRSO,POINT-LOOKOUT,RED-BOAR-INN,SHANTY \FALSE
	RTRUE

	.FUNCT IS-PERSON?
	EQUAL? PRSO,PLAYER /FALSE
	FSET? PRSO,PERSON /TRUE
	EQUAL? PRSO,DELIVERY-BOY,HEVLIN,JOHNNY /TRUE
	EQUAL? PRSO,MCGINTY,PEOPLE,PETE /TRUE
	EQUAL? PRSO,SPEAR-CARRIER,WEASEL /TRUE
	RFALSE

	.FUNCT IS-PERSON-PRSI?
	EQUAL? PRSI,PLAYER /FALSE
	FSET? PRSI,PERSON /TRUE
	EQUAL? PRSI,DELIVERY-BOY,HEVLIN,JOHNNY /TRUE
	EQUAL? PRSI,MCGINTY,PEOPLE,PETE /TRUE
	EQUAL? PRSI,SPEAR-CARRIER,WEASEL /TRUE
	RFALSE

	.FUNCT DANGEROUS-DRINK?
	EQUAL? PRSO,BATTERY,DRY-CELL,OCEAN /TRUE
	EQUAL? PRSO,PUTTY,TUBE,SHARK-REPELLENT \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?,?TMP
	CALL IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-OBJECT-OR-PROPERTY? >STACK
	RSTACK

	.FUNCT IS-ANIMAL?
	EQUAL? PRSO,BARNACLES,PARROT,SHARK /TRUE
	EQUAL? PRSO,SQUID \FALSE
	RTRUE

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-ANIMAL? >STACK
	RSTACK

	.FUNCT IS-SELF?
	EQUAL? PRSO,ME,ADVENTURER \FALSE
	RTRUE

	.FUNCT QUEUE,RTN,TICK,CINT
	CALL INT,RTN >CINT
	PUT CINT,C-TICK,TICK
	RETURN CINT

	.FUNCT INT,RTN,E,C,INT?1
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	SUB C-INTS,C-INTLEN >C-INTS
	ADD C-TABLE,C-INTS >INT?1
	PUT INT?1,C-RTN,RTN
	RETURN INT?1
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L5
	RETURN C
?L5:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT ENABLED?,RTN,C,E
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E /FALSE
	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L8
	GET C,C-ENABLED? >STACK
	ZERO? STACK \TRUE
	RFALSE
?L8:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT QUEUED?,RTN,C,E
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E /FALSE
	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L9
	GET C,C-ENABLED? >STACK
	ZERO? STACK /FALSE
	GET C,C-TICK >STACK
	ZERO? STACK \TRUE
	RFALSE
?L9:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT CLOCKER,C,E,TICK,FLG=0,VAL
	ZERO? CLOCK-WAIT /?L1
	SET 'CLOCK-WAIT,0
	RFALSE
?L1:	IGRTR? 'PRESENT-TIME,1439 \?L4
	SUB PRESENT-TIME,1440 >PRESENT-TIME
?L4:	ZERO? WATCH-WOUND /?L11
	IGRTR? 'WATCH-MOVES,59 \?L11
	SUB WATCH-MOVES,60 >WATCH-MOVES
	IGRTR? 'WATCH-SCORE,11 \?L11
	SET 'WATCH-SCORE,0
?L11:	CALL WATCH-UPDATE
	ADD C-TABLE,C-INTS >C
	ADD C-TABLE,C-TABLELEN >E
?L16:	EQUAL? C,E \?L18
	RETURN FLG
?L18:	GET C,C-ENABLED? >STACK
	ZERO? STACK /?L26
	GET C,C-TICK >TICK
	ZERO? TICK /?L26
	SUB TICK,1 >STACK
	PUT C,C-TICK,STACK
	GRTR? TICK,1 /?L26
	GET C,C-RTN >STACK
	CALL STACK >VAL
	ZERO? VAL /?L26
	ZERO? FLG /?L28
	EQUAL? VAL,M-FATAL \?L26
?L28:	SET 'FLG,VAL
?L26:	ADD C,C-INTLEN >C
	JUMP ?L16

	.FUNCT WATCH-UPDATE
	IN? WATCH,PLAYER \?L1
	SET 'MOVES,WATCH-MOVES
	SET 'SCORE,WATCH-SCORE
	RETURN SCORE
?L1:	SET 'MOVES,99
	SET 'SCORE,111
	RETURN SCORE

	.FUNCT PICK-ONE,FROB
	GET FROB,0 >STACK
	RANDOM STACK >STACK
	GET FROB,STACK >STACK
	RSTACK

	.FUNCT DPRINT,OBJ
	GETP OBJ,P?SDESC >STACK
	ZERO? STACK /?L1
	GETP OBJ,P?SDESC >STACK
	PRINT STACK
	RTRUE
?L1:	PRINTD OBJ
	RTRUE

	.FUNCT APRINT,OBJ
	FSET? OBJ,PERSON /?L3
	EQUAL? OBJ,PETES-PATCH \?L1
?L3:	CALL DPRINT,OBJ >STACK
	RSTACK
?L1:	FSET? OBJ,VOWELBIT \?L6
	PRINTI "an "
	CALL DPRINT,OBJ >STACK
	RSTACK
?L6:	PRINTI "a "
	CALL DPRINT,OBJ >STACK
	RSTACK

	.FUNCT GO
START::
?L0:	PUTB P-LEXV,0,59
	CALL QUEUE,I-UNWOUND,20 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-BUSINESS-HOURS,60 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-FERRY-APPROACHING,117 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-FERRY,120 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-HUNGER,15 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-THIRST,25 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-TIRED,929 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-LIVER,10 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-DRILL,5
	CALL QUEUE,I-MM-COMPRESSOR,80
	CALL QUEUE,I-PLOT-NEVER-STARTS,60 >STACK
	PUT STACK,0,1
	SET 'LIT,1
	SET 'SCORE,8
	SET 'WINNER,ADVENTURER
	SET 'PLAYER,WINNER
	SET 'SAMPLE-TREASURE,GLOBAL-OBJECTS
	CALL PUT-IN-TABLE,ENVELOPE,MCGINTY-HQ,GLOBAL-SURFACE
	SET 'HERE,BEDROOM
	SET 'P-IT-OBJECT,0
	FSET? HERE,TOUCHBIT /?L1
	CALL START-MOVEMENT
	CALL TELL-START-STR
	CRLF
	CALL V-VERSION
	CRLF
?L1:	MOVE WINNER,BED
	CALL V-LOOK
	CALL MAIN-LOOP
	JUMP ?L0

	.FUNCT MAIN-VERB-PRINT,TMP
	GET P-ITBL,P-VERBN >TMP
	ZERO? P-OFLAG /?L1
	GET TMP,0 >STACK
	PRINTB STACK
	RTRUE
?L1:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT MAIN-LOOP,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP,PLACE
?L1:	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	SET 'WAITED?,0
	SET 'P-WALK-DIR,0
	EQUAL? HERE,QCONTEXT-ROOM /?L3
	SET 'QCONTEXT,0
?L3:	CALL PARSER >P-WON
	ZERO? P-WON /?L6
	LOC PLAYER >LAST-PLAYER-LOC
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	ZERO? P-IT-OBJECT /?L8
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L8
	SET 'TMP,0
?L10:	IGRTR? 'CNT,ICNT /?L11
	GET P-PRSI,CNT >STACK
	EQUAL? STACK,IT \?L10
	PUT P-PRSI,CNT,P-IT-OBJECT
	SET 'TMP,1
?L11:	ZERO? TMP \?L21
	SET 'CNT,0
?L20:	IGRTR? 'CNT,OCNT /?L21
	GET P-PRSO,CNT >STACK
	EQUAL? STACK,IT \?L20
	PUT P-PRSO,CNT,P-IT-OBJECT
?L21:	SET 'CNT,0
?L8:	ZERO? OCNT \?L30
	SET 'NUM,OCNT
	JUMP ?L37
?L30:	GRTR? OCNT,1 \?L32
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L33
	SET 'OBJ,0
	JUMP ?L35
?L33:	GET P-PRSI,1 >OBJ
?L35:	SET 'NUM,OCNT
	JUMP ?L37
?L32:	GRTR? ICNT,1 \?L36
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L37
?L36:	SET 'NUM,1
?L37:	ZERO? OBJ \?L38
	EQUAL? ICNT,1 \?L38
	GET P-PRSI,1 >OBJ
?L38:	EQUAL? PRSA,V?WALK \?L41
	ZERO? P-WALK-DIR /?L41
	CALL PERFORM,PRSA,PRSO >V
	JUMP ?L93
?L41:	ZERO? NUM \?L43
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	ZERO? STACK \?L44
	CALL PERFORM,PRSA >V
	SET 'PRSO,0
	JUMP ?L93
?L44:	ZERO? LIT \?L46
	CALL TELL-TOO-DARK
	JUMP ?L93
?L46:	ZERO? OBJ /?L48
	EQUAL? OBJ,NOT-HERE-OBJECT \?L50
	CALL GLOBAL-NOT-HERE-PRINT,OBJ
	JUMP ?L93
?L50:	LOC WINNER >PLACE
	FSET? PLACE,VEHBIT \?L52
	LOC OBJ >STACK
	EQUAL? PLACE,STACK /?L93
	PRINTI "You should get "
	FSET? PLACE,SURFACEBIT \?L57
	PRINTI "off"
	JUMP ?L61
?L57:	PRINTI "out"
?L61:	PRINTI " of "
	CALL THE?,PLACE
	CALL DPRINT,PLACE
	PRINTI " first."
	CRLF
	SET 'V,0
	JUMP ?L93
?L52:	EQUAL? PRSA,V?GIVE \?L69
	CALL TELL-NOTHING,STR?8
	CALL MAIN-VERB-PRINT
	PRINTI "."
	CRLF
	SET 'V,0
	JUMP ?L93
?L69:	FSET? OBJ,CONTBIT \?L182
	FSET? OBJ,OPENBIT /?L72
	PRINTI "Better open the "
	CALL DPRINT,OBJ
	PRINTI " first."
	CRLF
	SET 'P-IT-OBJECT,OBJ
	SET 'V,0
	JUMP ?L93
?L72:	FSET? OBJ,CONTBIT /?L75
?L182:	CALL TELL-NOTHING,STR?9,1
	SET 'V,0
	JUMP ?L93
?L75:	PRINTI "It's not in that."
	CRLF
	SET 'V,0
	JUMP ?L93
?L48:	EQUAL? PRSA,V?$0024CALL \?L79
	CALL V-CALL-LOSE
	SET 'V,0
	JUMP ?L93
?L79:	ZERO? P-NONE /?L80
	PRINTI "I can't find any here!"
	CRLF
	SET 'V,0
	JUMP ?L93
?L80:	PRINTI "There isn't anything to "
	CALL MAIN-VERB-PRINT
	PRINTI " here!"
	CRLF
	SET 'V,0
	JUMP ?L93
?L43:	SET 'P-NOT-HERE,0
	SET 'P-MULT,0
	GRTR? NUM,1 \?L89
	SET 'P-MULT,1
?L89:	SET 'TMP,0
?L92:	IGRTR? 'CNT,NUM \?L94
	GRTR? P-NOT-HERE,0 \?L96
	PRINTI "The "
	EQUAL? P-NOT-HERE,NUM /?L100
	PRINTI "other "
?L100:	PRINTI "object"
	EQUAL? P-NOT-HERE,1 /?L107
	PRINTI "s"
?L107:	PRINTI " that you mentioned "
	EQUAL? P-NOT-HERE,1 /?L114
	PRINTI "are"
	JUMP ?L118
?L114:	PRINTI "is"
?L118:	PRINTI "n't here."
	CRLF
	JUMP ?L93
?L96:	ZERO? TMP \?L93
	PRINTI "I don't know what you're referring to."
	CRLF
	JUMP ?L93
?L94:	ZERO? PTBL /?L128
	GET P-PRSO,CNT >OBJ1
	JUMP ?L130
?L128:	GET P-PRSI,CNT >OBJ1
?L130:	ZERO? PTBL /?L131
	SET 'PRSO,OBJ1
	JUMP ?L133
?L131:	SET 'PRSO,OBJ
?L133:	ZERO? PTBL /?L134
	SET 'PRSI,OBJ
	JUMP ?L136
?L134:	SET 'PRSI,OBJ1
?L136:	GRTR? NUM,1 \?L146
	EQUAL? OBJ1,NOT-HERE-OBJECT \?L139
	INC 'P-NOT-HERE
	JUMP ?L92
?L139:	EQUAL? PRSA,V?TAKE \?L141
	ZERO? PRSI /?L141
	GET P-ITBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL \?L141
	IN? PRSO,PRSI \?L92
?L141:	EQUAL? P-GETFLAGS,P-ALL \?L145
	EQUAL? PRSA,V?TAKE \?L142
	LOC OBJ1 >STACK
	EQUAL? STACK,WINNER,HERE /?L144
	LOC OBJ1 >STACK
	FSET? STACK,TRANSBIT \?L92
?L144:	FSET? OBJ1,TAKEBIT /?L142
	FSET? OBJ1,TRYTAKEBIT \?L92
?L142:	EQUAL? P-GETFLAGS,P-ALL \?L145
	EQUAL? PRSA,V?DROP \?L145
	IN? OBJ1,WINNER /?L145
	IN? P-IT-OBJECT,WINNER \?L92
?L145:	EQUAL? OBJ1,IT \?L147
	CALL DPRINT,P-IT-OBJECT
	JUMP ?L149
?L147:	CALL DPRINT,OBJ1
?L149:	PRINTI ": "
?L146:	ZERO? PTBL /?L153
	PUSH OBJ1
	JUMP ?L155
?L153:	PUSH OBJ
?L155:	CALL QCONTEXT-CHECK,STACK >V
	SET 'TMP,1
	CALL PERFORM,PRSA,PRSO,PRSI >V
	EQUAL? V,M-FATAL \?L92
?L93:	EQUAL? V,M-FATAL /?L159
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-END >V
?L159:	EQUAL? PRSA,V?FOLLOW,V?WALK,V?AGAIN /?L165
	EQUAL? PRSA,V?WAIT /?L165
	CALL GAME-COMMAND? >STACK
	ZERO? STACK \?L165
	SET 'L-PRSA,PRSA
	SET 'L-PRSO,PRSO
	SET 'L-PRSI,PRSI
	SET 'L-WALK-DIR,P-WALK-DIR
	SET 'L-WINNER,WINNER
?L165:	EQUAL? V,M-FATAL \?L169
	SET 'P-CONT,0
	JUMP ?L169
?L6:	SET 'P-CONT,0
?L169:	ZERO? P-WON /?L177
	CALL GAME-COMMAND? >STACK
	ZERO? STACK \?L177
	EQUAL? PRSA,V?TELL \?L174
	ZERO? PRSI /?L177
?L174:	ZERO? CLOCK-WAIT \?L176
	ZERO? I-WAIT-DURATION \?L175
?L176:	CALL CLOCKER >V
	CALL DETECTOR-NOISE >V
	JUMP ?L177
?L175:	CALL V-WAIT,I-WAIT-DURATION,0 >I-WAIT-FLAG
	ZERO? I-WAIT-FLAG /?L178
	CALL I-WAIT-RTN >STACK
	SET 'I-WAIT-FLAG,0
	JUMP ?L180
?L178:	SET 'I-WAIT-DURATION,0
	CALL CLOCKER >V
?L180:	CALL DETECTOR-NOISE >V
?L177:	SET 'PRSA,0
	SET 'PRSO,0
	SET 'PRSI,0
	JUMP ?L1

	.FUNCT GAME-COMMAND?
	EQUAL? PRSA,V?VERBOSE,V?SUPER-BRIEF,V?BRIEF /TRUE
	EQUAL? PRSA,V?RESTART,V?RESTORE,V?SAVE /TRUE
	EQUAL? PRSA,V?UNSCRIPT,V?SCRIPT,V?QUIT /TRUE
	EQUAL? PRSA,V?SCORE,V?VERSION,V?$0024VERIFY /TRUE
	EQUAL? PRSA,V?TIME /TRUE
	RFALSE

	.FUNCT QCONTEXT-CHECK,PRSO?1,OTHER,WHO=0,N=0
	EQUAL? PRSA,V?LONGITUDE,V?LATITUDE,V?HELP /?L3
	EQUAL? PRSA,V?GIVE,V?TELL,V?SHOW \FALSE
	EQUAL? PRSO?1,PLAYER \FALSE
?L3:	FIRST? HERE >OTHER \?L6
?L7:	FSET? OTHER,PERSON \?L9
	EQUAL? OTHER,PLAYER /?L9
	INC 'N
	SET 'WHO,OTHER
?L9:	NEXT? OTHER >OTHER /?L7
?L6:	EQUAL? 1,N \?L12
	ZERO? QCONTEXT \?L22
	CALL SAID-TO,WHO
?L12:	ZERO? QCONTEXT /FALSE
?L22:	IN? QCONTEXT,HERE \FALSE
	EQUAL? QCONTEXT-ROOM,HERE \FALSE
	EQUAL? WINNER,PLAYER \FALSE
	SET 'WINNER,QCONTEXT
	PRINTI "(said to "
	CALL DPRINT,QCONTEXT
	PRINTR ")"

	.FUNCT SAID-TO,WHO
	SET 'WINNER,WHO
	SET 'QCONTEXT,WHO
	SET 'QCONTEXT-ROOM,HERE
	RETURN QCONTEXT-ROOM

	.FUNCT PERFORM,A,O=0,I=0,V,OA,OO,OI
	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	EQUAL? A,V?WALK /?L1
	EQUAL? IT,I,O \?L1
	PRINTI "I don't see what you are referring to."
	CRLF
	RETURN 2
?L1:	SET 'PRSA,A
	SET 'PRSO,O
	ZERO? PRSO /?L8
	EQUAL? PRSI,IT /?L8
	EQUAL? PRSA,V?WALK /?L8
	SET 'P-IT-OBJECT,PRSO
?L8:	SET 'PRSI,I
	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \?L11
	EQUAL? PRSA,V?WALK /?L11
	CALL NOT-HERE-OBJECT-F >V
	ZERO? V /?L11
	SET 'P-WON,0
	JUMP ?L21
?L11:	SET 'O,PRSO
	SET 'I,PRSI
	GETP WINNER,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L21
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-BEG >V
	ZERO? V \?L21
	GET PREACTIONS,A >STACK
	CALL STACK >V
	ZERO? V \?L21
	SET 'I,PRSI
	EQUAL? I,0,0 /?L18
	GETP I,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L21
?L18:	ZERO? O /?L20
	EQUAL? A,V?WALK /?L19
	LOC O >STACK
	ZERO? STACK /?L19
	LOC O >STACK
	GETP STACK,P?CONTFCN >STACK
	CALL STACK,M-CONT >V
	ZERO? V \?L21
?L19:	ZERO? O /?L20
	EQUAL? A,V?WALK /?L20
	GETP O,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L21
?L20:	GET ACTIONS,A >STACK
	CALL STACK >V
	ZERO? V /?L21
?L21:	EQUAL? V,M-FATAL /?L23
	LOC WINNER >STACK
	EQUAL? STACK,PRSO \?L25
	SET 'PRSO,0
?L25:	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-END >V
?L23:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT TELL-START-STR
	PRINTR "Nights on Hardscrabble Island are lonely and cold when the lighthouse barely pierces the gloom. You sit on your bed, thinking of better times and far-off places. A knock on your door stirs you, and Hevlin, a shipmate you haven't seen for years, staggers in.

""I'm in trouble,"" he says. ""I had a few too many at The Shanty. I was looking for Red, but he wasn't around, and I started talking about ... here,"" he says, handing you a slim volume that you recognize as a shipwreck book written years ago by the Historical Society.

You smile. Every diver on the island has looked for those wrecks, without even an old boot to show for it. You open the door, hoping the drunken fool will leave. ""I know what you're thinkin',"" Hevlin scowls, ""but look!"" He points to the familiar map, and you see new locations marked for two of the wrecks.

""Keep it for me,"" he says. ""Just for tonight. It'll be safe here with you. Don't let -- "" He stops and broods for a moment. ""I've got to go find Red!"" And with that, Hevlin leaves.

You put the book in your dresser and think about following Hevlin. Then you hear a scuffle outside. You look through your window and see two men struggling. One falls to the ground in a heap. The other man bends down beside him, then turns as if startled and runs away. Another man then approaches the wounded figure. He kneels beside him for a long moment, then takes off after the other man.

It isn't long before the police arrive to tell you that Hevlin's been murdered. You don't mention the book, and hours later, as you lie awake in your bed, you wonder if the book could really be what it seems."

	.FUNCT ACCESSIBLE?,OBJ,L
	LOC OBJ >L
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? OBJ,PSEUDO-OBJECT \?L3
	GETP PSEUDO-OBJECT,P?DESCFCN >STACK
	EQUAL? STACK,HERE \FALSE
	RTRUE
?L3:	ZERO? L /FALSE
	EQUAL? L,GLOBAL-OBJECTS /TRUE
	EQUAL? L,LOCAL-GLOBALS \?L9
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	ZERO? STACK \TRUE
?L9:	CALL META-LOC,OBJ >STACK
	EQUAL? STACK,HERE \FALSE
	EQUAL? L,WINNER,HERE /TRUE
	FSET? L,OPENBIT /?L13
	FSET? L,PERSON \FALSE
?L13:	CALL ACCESSIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT VISIBLE?,OBJ,L
	LOC OBJ >L
	CALL ACCESSIBLE?,OBJ >STACK
	ZERO? STACK \TRUE
	CALL SEE-INSIDE?,L >STACK
	ZERO? STACK /FALSE
	CALL VISIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT META-LOC,OBJ
?L1:	ZERO? OBJ /FALSE
	EQUAL? OBJ,GLOBAL-OBJECTS,LOCAL-GLOBALS \?L5
	RETURN OBJ
?L5:	IN? OBJ,ROOMS \?L7
	RETURN OBJ
?L7:	LOC OBJ >OBJ
	JUMP ?L1

	.FUNCT PARSER,PTR=P-LEXSTART,WORD,VAL=0,VERB=0,LEN,DIR=0,NW=0,LW=0,NUM,SCNT,CNT=-1
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADVERB,0
	SET 'P-MERGED,0
	SET 'P-NONE,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	ZERO? QUOTE-FLAG \?L8
	EQUAL? WINNER,PLAYER /?L8
	SET 'WINNER,PLAYER
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L8
	LOC WINNER >HERE
?L8:	ZERO? P-CONT /?L12
	SET 'PTR,P-CONT
	SET 'P-CONT,0
	EQUAL? L-PRSA,V?TELL /?L17
	CRLF
	JUMP ?L17
?L12:	SET 'WINNER,PLAYER
	SET 'QUOTE-FLAG,0
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L18
	LOC WINNER >HERE
?L18:	ZERO? SUPER-BRIEF \?L21
	CRLF
?L21:	PRINTI ">"
	READ P-INBUF,P-LEXV
?L17:	GETB P-LEXV,P-LEXWORDS >P-LEN
	ZERO? P-LEN \?L26
	PRINTI "What?"
	CRLF
	RFALSE
?L26:	GET P-LEXV,PTR >WORD
	EQUAL? WORD,W?WHY,W?HOW,W?WHEN /?L31
	EQUAL? WORD,W?IS,W?DID,W?ARE \?L30
?L31:	PRINTI "Sorry, but this program can't handle questions like that. You should stick to questions like ""WHAT IS ..."" and ""WHERE IS ...."" Maybe you'd like to reread the manual."
	CRLF
	RFALSE
?L30:	SET 'LEN,P-LEN
	SET 'P-DIR,0
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
	PUT P-ITBL,P-VERBN,0
?L35:	DLESS? 'P-LEN,0 \?L37
	SET 'QUOTE-FLAG,0
	JUMP ?L36
?L37:	GET P-LEXV,PTR >WORD
	ZERO? WORD \?L40
	CALL NUMBER?,PTR >WORD
	ZERO? WORD /?L39
?L40:	EQUAL? WORD,W?TO \?L41
	EQUAL? VERB,ACT?TELL,ACT?ASK \?L41
	SET 'WORD,W?$QUOTE
	JUMP ?L43
?L41:	EQUAL? WORD,W?THEN \?L43
	ZERO? VERB \?L43
	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WORD,W?$QUOTE
?L43:	EQUAL? WORD,W?$PERIOD \?L45
	EQUAL? LW,W?MR \?L45
	SET 'LW,0
	JUMP ?L92
?L45:	EQUAL? WORD,W?THEN,W?$PERIOD,W?$QUOTE \?L47
	EQUAL? WORD,W?$QUOTE \?L52
	ZERO? QUOTE-FLAG /?L50
	SET 'QUOTE-FLAG,0
	JUMP ?L52
?L50:	SET 'QUOTE-FLAG,1
?L52:	ZERO? P-LEN /?L54
	ADD PTR,P-LEXELEN >P-CONT
?L54:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L36
?L47:	CALL WT?,WORD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L56
	EQUAL? VERB,0,ACT?WALK \?L56
	EQUAL? LEN,1 /?L57
	EQUAL? LEN,2 \?L58
	EQUAL? VERB,ACT?WALK /?L57
?L58:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
	EQUAL? NW,W?THEN,W?$QUOTE \?L59
	GRTR? LEN,2 /?L57
?L59:	EQUAL? NW,W?$PERIOD \?L60
	GRTR? LEN,1 /?L57
?L60:	ZERO? QUOTE-FLAG /?L61
	EQUAL? LEN,2 \?L61
	EQUAL? NW,W?$QUOTE /?L57
?L61:	GRTR? LEN,2 \?L56
	EQUAL? NW,W?$COMMA,W?AND \?L56
?L57:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L62
	ADD PTR,P-LEXELEN >STACK
	PUT P-LEXV,STACK,W?THEN
?L62:	GRTR? LEN,2 /?L92
	SET 'QUOTE-FLAG,0
	JUMP ?L36
?L56:	CALL WT?,WORD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L68
	ZERO? VERB \?L68
	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WORD
	MUL PTR,2 >STACK
	ADD STACK,2 >NUM
	GETB P-LEXV,NUM >STACK
	PUTB P-VTBL,2,STACK
	ADD NUM,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L92
?L68:	CALL WT?,WORD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L70
	EQUAL? WORD,W?ALL,W?ONE,W?A /?L71
	CALL WT?,WORD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L71
	CALL WT?,WORD,PS?OBJECT >STACK
	ZERO? STACK /?L69
?L71:	SET 'VAL,0
?L70:	GRTR? P-LEN,0 \?L72
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?OF \?L72
	EQUAL? VERB,ACT?MAKE /?L72
	ZERO? VAL \?L105
	EQUAL? WORD,W?ALL,W?ONE,W?A \?L92
?L72:	ZERO? VAL /?L74
?L105:	ZERO? P-LEN /?L75
	ADD PTR,2 >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?THEN,W?$PERIOD \?L74
?L75:	LESS? P-NCN,2 \?L92
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WORD
	JUMP ?L92
?L74:	EQUAL? P-NCN,2 \?L79
	PRINTI "I found more than two nouns in that sentence!"
	CRLF
	RFALSE
?L79:	INC 'P-NCN
	CALL CLAUSE,PTR,VAL,WORD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L92
	SET 'QUOTE-FLAG,0
	JUMP ?L36
?L69:	EQUAL? WORD,W?QUIETLY /?L89
	EQUAL? WORD,W?SLOWLY,W?QUICKLY,W?BRIEFLY \?L88
?L89:	SET 'P-ADVERB,WORD
	JUMP ?L92
?L88:	CALL WT?,WORD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L92
	CALL CANT-USE,PTR
	RFALSE
?L39:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L92:	SET 'LW,WORD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L35
?L36:	ZERO? DIR /?L93
	SET 'PRSA,V?WALK
	SET 'PRSO,DIR
	SET 'P-WALK-DIR,DIR
	SET 'P-OFLAG,0
	RTRUE
?L93:	ZERO? P-OFLAG /?L96
	CALL ORPHAN-MERGE
?L96:	GET P-ITBL,P-VERB >STACK
	ZERO? STACK \?L99
	PUT P-ITBL,P-VERB,ACT?$0024CALL
?L99:	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT WT?,PTR,BIT,B1=5,OFFSET=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L6
	INC 'OFFSET
?L6:	GETB PTR,OFFSET >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WORD,OFF,NUM,ANDFLG=0,FIRST??=1,NW,LW=0
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L1
	ADD P-PREP1,OFF >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WORD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'P-LEN
?L3:	ZERO? P-LEN \?L4
	DEC 'P-NCN
	RETURN -1
?L4:	ADD P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L7
	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
?L7:	DLESS? 'P-LEN,0 \?L12
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L12:	GET P-LEXV,PTR >WORD
	ZERO? WORD \?L17
	CALL NUMBER?,PTR >WORD
	ZERO? WORD /?L15
?L17:	ZERO? P-LEN \?L18
	SET 'NW,0
	JUMP ?L20
?L18:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L20:	EQUAL? WORD,W?OF \?L21
	GET P-ITBL,P-VERB >STACK
	EQUAL? STACK,ACT?MAKE \?L21
	PUT P-LEXV,PTR,W?WITH
	SET 'WORD,W?WITH
?L21:	EQUAL? WORD,W?$PERIOD \?L24
	EQUAL? LW,W?MR \?L24
	SET 'LW,0
	JUMP ?L47
?L24:	EQUAL? WORD,W?AND,W?$COMMA \?L26
	SET 'ANDFLG,1
	JUMP ?L47
?L26:	EQUAL? WORD,W?ALL,W?ONE \?L27
	EQUAL? NW,W?OF \?L47
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L47
?L27:	EQUAL? WORD,W?THEN,W?$PERIOD /?L32
	CALL WT?,WORD,PS?PREPOSITION >STACK
	ZERO? STACK /?L31
	ZERO? FIRST?? \?L31
?L32:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L31:	ZERO? ANDFLG /?L33
	GET P-ITBL,P-VERBN >STACK
	ZERO? STACK /?L34
	CALL WT?,WORD,PS?DIRECTION >STACK
	ZERO? STACK \?L34
	CALL WT?,WORD,PS?VERB >STACK
	ZERO? STACK /?L33
?L34:	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	PUT P-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L47
?L33:	CALL WT?,WORD,PS?OBJECT >STACK
	ZERO? STACK /?L35
	GRTR? P-LEN,0 \?L36
	EQUAL? NW,W?OF \?L36
	EQUAL? WORD,W?ALL,W?ONE \?L47
?L36:	CALL WT?,WORD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L38
	ZERO? NW /?L38
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L47
?L38:	ZERO? ANDFLG \?L39
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L39
	EQUAL? NW,W?$COMMA /?L39
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L39:	SET 'ANDFLG,0
	JUMP ?L47
?L35:	CALL WT?,WORD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L47
	CALL WT?,WORD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L47
	CALL WT?,WORD,PS?PREPOSITION >STACK
	ZERO? STACK \?L47
	CALL CANT-USE,PTR
	RFALSE
?L15:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L47:	SET 'LW,WORD
	SET 'FIRST??,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0,TIM=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
	SET 'P-DOLLAR-FLAG,0
?L1:	DLESS? 'CNT,0 /?L2
	GETB P-INBUF,BPTR >CHR
	EQUAL? CHR,58 \?L6
	SET 'TIM,SUM
	SET 'SUM,0
	JUMP ?L11
?L6:	GRTR? SUM,9999 /FALSE
	LESS? CHR,58 \?L9
	GRTR? CHR,47 \?L9
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
	JUMP ?L11
?L9:	EQUAL? CHR,36 \FALSE
	SET 'P-DOLLAR-FLAG,1
?L11:	INC 'BPTR
	JUMP ?L1
?L2:	PUT P-LEXV,PTR,W?INTNUM
	GRTR? SUM,9999 /FALSE
	ZERO? TIM /?L14
	SET 'SET-HR,TIM
	SET 'SET-MIN,SUM
	GRTR? TIM,23 /FALSE
	MUL TIM,60 >STACK
	ADD SUM,STACK >SUM
?L14:	ZERO? P-DOLLAR-FLAG /?L19
	GRTR? SUM,0 \?L19
	SET 'P-AMOUNT,SUM
	FSET INTNUM,VOWELBIT
	PUTP INTNUM,P?SDESC,STR?10
	RETURN W?INTNUM
?L19:	SET 'P-NUMBER,SUM
	SET 'P-DOLLAR-FLAG,0
	FCLEAR INTNUM,VOWELBIT
	PUTP INTNUM,P?SDESC,STR?11
	RETURN W?INTNUM

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,WRD
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >WRD
	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L1
	SET 'ADJ,1
	JUMP ?L3
?L1:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L3
	ZERO? P-NCN \?L3
	PUT P-ITBL,P-VERB,0
	PUT P-ITBL,P-VERBN,0
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
	SET 'P-NCN,1
?L3:	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L5
	ZERO? ADJ \?L5
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L5:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L8
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP1 >STACK
	EQUAL? TEMP,STACK /?L11
	ZERO? TEMP \FALSE
?L11:	ZERO? ADJ /?L12
	ADD P-LEXV,2 >STACK
	PUT P-OTBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L32
?L12:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L32
?L8:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L16
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP2 >STACK
	EQUAL? TEMP,STACK /?L19
	ZERO? TEMP \FALSE
?L19:	ZERO? ADJ /?L20
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L20:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L32
?L16:	ZERO? P-ACLAUSE /?L32
	EQUAL? P-NCN,1 /?L25
	ZERO? ADJ \?L25
	SET 'P-ACLAUSE,0
	RFALSE
?L25:	GET P-ITBL,P-NC1 >BEG
	ZERO? ADJ /?L28
	ADD P-LEXV,2 >BEG
	SET 'ADJ,0
?L28:	GET P-ITBL,P-NC1L >END
?L31:	GET BEG,0 >WRD
	EQUAL? BEG,END \?L33
	ZERO? ADJ /?L35
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L32
?L35:	SET 'P-ACLAUSE,0
	RFALSE
?L33:	ZERO? ADJ \?L38
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE /?L39
	EQUAL? WRD,W?ALL,W?ONE \?L38
?L39:	SET 'ADJ,WRD
	JUMP ?L44
?L38:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT /?L41
	EQUAL? WRD,W?ONE \?L44
?L41:	EQUAL? WRD,P-ANAM,W?ONE \FALSE
	CALL ACLAUSE-WIN,ADJ
	JUMP ?L32
?L44:	ADD BEG,P-WORDLEN >BEG
	ZERO? END \?L31
	SET 'END,BEG
	SET 'P-NCN,1
	SUB BEG,4 >STACK
	PUT P-ITBL,P-NC1,STACK
	PUT P-ITBL,P-NC1L,BEG
	JUMP ?L31
?L32:	IGRTR? 'CNT,P-ITBLLEN \?L52
	SET 'P-MERGED,1
	RTRUE
?L52:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L32

	.FUNCT ACLAUSE-WIN,ADJ
	GET P-OTBL,P-VERB >STACK
	PUT P-ITBL,P-VERB,STACK
	SET 'P-CCSRC,P-OTBL
	ADD P-ACLAUSE,1 >STACK
	CALL CLAUSE-COPY,P-ACLAUSE,STACK,ADJ
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'P-NCN,2
?L1:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,MSG,?TMP
	PRINTI "I don't know the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI """."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT CANT-USE,PTR,BUF,?TMP
	PRINTI "Sorry, but you can't use the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI """ in that sense."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	CALL TELL-COULDNT-FIND,STR?12
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L4:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	GRTR? P-NCN,NUM /?L13
	LESS? NUM,1 /?L8
	ZERO? P-NCN \?L8
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L9
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L8
?L9:	SET 'DRIVE1,SYN
	JUMP ?L13
?L8:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L13
	EQUAL? NUM,2 \?L11
	EQUAL? P-NCN,1 \?L11
	SET 'DRIVE2,SYN
	JUMP ?L13
?L11:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L13
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L13:	DLESS? 'LEN,1 \?L16
	ZERO? DRIVE1 \?L66
	ZERO? DRIVE2 \?L5
	PRINTI "I don't understand that sentence."
	CRLF
	RFALSE
?L16:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L4
?L5:	ZERO? DRIVE1 /?L25
?L66:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L25
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L25:	ZERO? DRIVE2 /?L27
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L27
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L27:	EQUAL? VERB,ACT?FIND \?L28
	EQUAL? WINNER,PLAYER /?L29
	PRINTI "You'll have to ask a more specific question."
	CRLF
	RFALSE
?L29:	PRINTI "Sorry, but I can't answer that question."
	CRLF
	RFALSE
?L28:	EQUAL? WINNER,PLAYER \?L37
	CALL ORPHAN,DRIVE1,DRIVE2
	EQUAL? VERB,ACT?WALK \?L39
	PRINTI "Where"
	JUMP ?L43
?L39:	PRINTI "What"
?L43:	PRINTI " do you want to "
	JUMP ?L48
?L37:	CALL REQUEST-INCOMPLETE
	PRINTI "what you want "
	CALL THE?,WINNER
	CALL DPRINT,WINNER
	PRINTI " to "
?L48:	CALL VERB-PRINT
	ZERO? DRIVE2 /?L53
	CALL CLAUSE-PRINT,P-NC1,P-NC1L
?L53:	ZERO? DRIVE1 /?L56
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L58
?L56:	GETB DRIVE2,P-SPREP2 >STACK
?L58:	CALL PREP-PRINT,STACK
	EQUAL? WINNER,PLAYER \?L59
	SET 'P-OFLAG,1
	PRINTI "?"
	CRLF
	RFALSE
?L59:	SET 'P-OFLAG,0
	PRINTI "."
	CRLF
	RFALSE

	.FUNCT REQUEST-INCOMPLETE
	PRINTI "Your request was incomplete. Next time, say "
	RTRUE

	.FUNCT VERB-PRINT,TMP
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "say"
	RTRUE
?L1:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L5
	GET TMP,0 >STACK
	PRINTB STACK
	RTRUE
?L5:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
	RTRUE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	PUT P-OCLAUSE,P-MATCHLEN,0
	SET 'P-CCSRC,P-ITBL
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L1
?L2:	EQUAL? P-NCN,2 \?L6
	CALL CLAUSE-COPY,P-NC2,P-NC2L
?L6:	LESS? P-NCN,1 /?L9
	CALL CLAUSE-COPY,P-NC1,P-NC1L
?L9:	ZERO? D1 /?L12
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L12:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT CLAUSE-PRINT,BPTR,EPTR,THE??1=1
	GET P-ITBL,EPTR >STACK
	GET P-ITBL,BPTR >STACK
	CALL BUFFER-PRINT,STACK,STACK,THE??1 >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=0,WRD,FIRST??=1,PN=0
?L1:	EQUAL? BEG,END /TRUE
	ZERO? NOSP /?L6
	SET 'NOSP,0
	JUMP ?L8
?L6:	PRINTI " "
?L8:	GET BEG,0 >WRD
	EQUAL? WRD,W?$PERIOD \?L11
	SET 'NOSP,1
	JUMP ?L24
?L11:	EQUAL? WRD,W?MR \?L13
	PRINTI "Mr."
	SET 'PN,1
	JUMP ?L24
?L13:	EQUAL? WRD,W?MCGINTY \?L16
	PRINTI "McGinty"
	SET 'PN,1
	JUMP ?L24
?L16:	EQUAL? WRD,W?ME \?L19
	CALL DPRINT,GLOBAL-SELF
	SET 'PN,1
	JUMP ?L24
?L19:	EQUAL? WRD,W?WEASEL,W?PETE,W?JOHN /?L23
	EQUAL? WRD,W?JOHNNY,W?RED,W?RAT /?L23
	EQUAL? WRD,W?MARY,W?MARGAR,W?FRANK /?L23
	EQUAL? WRD,W?WEBSTE,W?HEVLIN \?L22
?L23:	CALL CAPITALIZE,BEG
	SET 'PN,1
	JUMP ?L24
?L22:	ZERO? FIRST?? /?L25
	ZERO? PN \?L25
	ZERO? CP /?L25
	PRINTI "the "
?L25:	ZERO? P-OFLAG \?L32
	ZERO? P-MERGED /?L30
?L32:	EQUAL? WRD,W?INTNUM \?L33
	CALL DPRINT,INTNUM
	JUMP ?L39
?L33:	PRINTB WRD
	JUMP ?L39
?L30:	EQUAL? WRD,W?IT,W?HIM \?L38
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L38
	EQUAL? P-IT-OBJECT,PSEUDO-OBJECT /?L38
	CALL DPRINT,P-IT-OBJECT
	JUMP ?L39
?L38:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L39:	SET 'FIRST??,0
?L24:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CAPITALIZE,PTR
	ZERO? P-OFLAG \?L3
	ZERO? P-MERGED /?L1
?L3:	GET PTR,0 >STACK
	PRINTB STACK
	RTRUE
?L1:	GETB PTR,3 >STACK
	GETB P-INBUF,STACK >STACK
	SUB STACK,32 >STACK
	PRINTC STACK
	GETB PTR,3 >STACK
	INC 'STACK
	GETB PTR,2 >STACK
	DEC 'STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT PREP-PRINT,PREP,SP?=1,WRD
	ZERO? PREP /FALSE
	ZERO? SP? /?L3
	PRINTI " "
?L3:	CALL PREP-FIND,PREP >WRD
	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?SIT,STACK \?L8
	EQUAL? W?DOWN,WRD \?L8
	PRINTI "on"
	JUMP ?L15
?L8:	EQUAL? WRD,W?AGAINST \?L12
	PRINTI "against"
	JUMP ?L15
?L12:	PRINTB WRD
?L15:	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?GET,STACK \TRUE
	EQUAL? W?OUT,WRD \TRUE
	PRINTI " of"
	RTRUE

	.FUNCT CLAUSE-COPY,BPTR,EPTR,INSERT=0,BEG,END
	GET P-CCSRC,BPTR >BEG
	GET P-CCSRC,EPTR >END
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	PUT P-OTBL,BPTR,STACK
?L1:	EQUAL? BEG,END \?L3
	GET P-OCLAUSE,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD P-OCLAUSE,STACK >STACK
	PUT P-OTBL,EPTR,STACK
	RTRUE
?L3:	ZERO? INSERT /?L6
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L6
	CALL CLAUSE-ADD,INSERT
?L6:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT CLAUSE-ADD,WRD,PTR
	GET P-OCLAUSE,P-MATCHLEN >STACK
	ADD STACK,2 >PTR
	SUB PTR,1 >STACK
	PUT P-OCLAUSE,STACK,WRD
	PUT P-OCLAUSE,PTR,0
	PUT P-OCLAUSE,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-FIND,PREP,CNT=0,SIZE
	GET PREPOSITIONS,0 >STACK
	MUL STACK,2 >SIZE
?L1:	IGRTR? 'CNT,SIZE /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L1
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ
	EQUAL? GBIT,RMUNGBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	PRINTI "("
	CALL PREP-PRINT,PREP,0 >STACK
	ZERO? STACK /?L10
	PRINTI " "
	CALL THE?,OBJ
?L10:	CALL DPRINT,OBJ
	PRINTI ")"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,PTR
	GET P-ITBL,P-NC1 >PTR
	ZERO? PTR /?L5
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /?L5
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L5:	GET P-ITBL,P-NC2 >PTR
	ZERO? PTR /TRUE
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSI,P-MATCHLEN >STACK
	EQUAL? STACK,1 \?L14
	CALL BUT-MERGE,P-PRSO >P-PRSO
	RTRUE
?L14:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,AND=0,BUT=0,LEN,WV,WORD,NW
	SET 'P-AND,0
	SET 'P-GETFLAGS,0
	SET 'P-CSPTR,PTR
	SET 'P-CEPTR,EPTR
	PUT P-BUTS,P-MATCHLEN,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WORD
?L1:	EQUAL? PTR,EPTR \?L3
?L48:	ZERO? BUT /?L6
	PUSH BUT
	JUMP ?L5
?L6:	PUSH TBL
?L5:	CALL GET-OBJECT,STACK >STACK
	RSTACK
?L3:	GET PTR,P-LEXELEN >NW
	EQUAL? WORD,W?ALL \?L8
	SET 'P-GETFLAGS,P-ALL
	EQUAL? NW,W?OF \?L43
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L43
?L8:	EQUAL? WORD,W?BUT,W?EXCEPT \?L13
	ZERO? BUT /?L17
	PUSH BUT
	JUMP ?L16
?L17:	PUSH TBL
?L16:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,P-BUTS
	PUT BUT,P-MATCHLEN,0
	JUMP ?L43
?L13:	EQUAL? WORD,W?A,W?ONE \?L18
	ZERO? P-ADJ \?L19
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L43
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L43
?L19:	SET 'P-NAM,P-ONEOBJ
	ZERO? BUT /?L28
	PUSH BUT
	JUMP ?L27
?L28:	PUSH TBL
?L27:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L43
?L18:	EQUAL? WORD,W?AND,W?$COMMA \?L31
	EQUAL? NW,W?AND,W?$COMMA /?L31
	SET 'P-AND,1
	ZERO? BUT /?L35
	PUSH BUT
	JUMP ?L34
?L35:	PUSH TBL
?L34:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L43
?L31:	CALL WT?,WORD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L43
	EQUAL? WORD,W?AND,W?$COMMA /?L43
	EQUAL? WORD,W?OF \?L38
	ZERO? P-GETFLAGS \?L43
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L43
?L38:	CALL WT?,WORD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L42
	ZERO? P-ADJ \?L42
	SET 'P-ADJ,WV
	SET 'P-ADJN,WORD
	JUMP ?L43
?L42:	CALL WT?,WORD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L43
	SET 'P-NAM,WORD
	SET 'P-ONEOBJ,WORD
?L43:	EQUAL? PTR,EPTR /?L48
	ADD PTR,P-WORDLEN >PTR
	SET 'WORD,NW
	JUMP ?L1

	.FUNCT GET-OBJECT,TBL,VRB=1,BITS,LEN,XBITS,TLEN,GCHECK=0,OLEN=0,OBJ
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	ZERO? P-NAM \?L11
	ZERO? P-ADJ /?L8
	CALL WT?,P-ADJN,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L6
	SET 'P-NAM,P-ADJN
	SET 'P-ADJ,0
	JUMP ?L8
?L6:	CALL WT?,P-ADJN,PS?DIRECTION,P1?DIRECTION >BITS
	ZERO? BITS /?L8
	SET 'P-ADJ,0
	PUT TBL,P-MATCHLEN,1
	PUT TBL,1,INTDIR
	SET 'P-WALK-DIR,BITS
	RTRUE
?L8:	ZERO? P-NAM \?L11
	ZERO? P-ADJ \?L11
	EQUAL? P-GETFLAGS,P-ALL /?L78
	ZERO? P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	CALL TELL-COULDNT-FIND,STR?13
	RFALSE
?L11:	EQUAL? P-GETFLAGS,P-ALL \?L19
?L78:	ZERO? P-SLOCBITS \?L17
?L19:	SET 'P-SLOCBITS,-1
?L17:	SET 'P-TABLE,TBL
?L21:	ZERO? GCHECK /?L23
	CALL GLOBAL-CHECK,TBL
	JUMP ?L25
?L23:	ZERO? LIT /?L26
	FCLEAR PLAYER,TRANSBIT
	CALL DO-SL,HERE,SOG,SIR
	FSET PLAYER,TRANSBIT
?L26:	CALL DO-SL,PLAYER,SH,SC
?L25:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL \?L29
	ZERO? LEN \?L73
	ZERO? P-NAM /?L73
	SET 'P-NONE,1
	JUMP ?L73
?L29:	BTST P-GETFLAGS,P-ONE \?L34
	ZERO? LEN /?L34
	EQUAL? LEN,1 /?L35
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "How about the "
	GET TBL,1 >STACK
	CALL DPRINT,STACK
	PRINTI "?"
	CRLF
?L35:	PUT TBL,P-MATCHLEN,1
	JUMP ?L73
?L34:	GRTR? LEN,1 /?L43
	ZERO? LEN \?L73
	EQUAL? P-SLOCBITS,-1 /?L42
?L43:	EQUAL? P-SLOCBITS,-1 \?L44
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L21
?L44:	ZERO? LEN \?L47
	SET 'LEN,OLEN
?L47:	ZERO? VRB /?L64
	ZERO? P-NAM /?L50
	EQUAL? WINNER,PLAYER \?L52
	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L54
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L56
?L54:	SET 'P-ACLAUSE,P-NC2
?L56:	SET 'P-AADJ,P-ADJ
	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L64
?L52:	CALL REQUEST-INCOMPLETE
	PRINTI "which"
	CALL WHICH-PRINT-NOUN,TBL
	PRINTI " you mean, "
	CALL WHICH-PRINT-LIST,TLEN,LEN,TBL
	SET 'P-OFLAG,0
	PRINTI "."
	CRLF
	JUMP ?L64
?L50:	ZERO? VRB /?L64
	CALL TELL-COULDNT-FIND,STR?13
?L64:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L42:	ZERO? LEN \?L73
	ZERO? GCHECK /?L66
	ZERO? VRB /?L71
	SET 'P-SLOCBITS,XBITS
	ZERO? LIT /?L69
	CALL OBJ-FOUND,NOT-HERE-OBJECT,TBL
	SET 'P-XNAM,P-NAM
	SET 'P-XADJ,P-ADJ
	SET 'P-XADJN,P-ADJN
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	RTRUE
?L69:	CALL TELL-TOO-DARK
?L71:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L66:	ZERO? LEN \?L73
	SET 'GCHECK,1
	JUMP ?L21
?L73:	ZERO? P-ADJ /?L75
	ZERO? P-NAM \?L75
	SET 'P-NONOUN,1
	JUMP ?L77
?L75:	SET 'P-NONOUN,0
?L77:	SET 'P-SLOCBITS,XBITS
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE

	.FUNCT TELL-COULDNT-FIND,STR
	PRINTI "I couldn't find "
	PRINT STR
	PRINTR " in that sentence."

	.FUNCT TELL-TOO-DARK
	PRINTR "It's too dark to see!"

	.FUNCT MOBY-FIND,TBL,FOO,LEN
	SET 'P-MOBY-FLAG,1
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	SET 'P-NAM,P-XNAM
	SET 'P-ADJ,P-XADJ
	SET 'P-MOBY-FOUND,0
	PUT TBL,P-MATCHLEN,0
	FIRST? ROOMS >FOO \?L3
?L4:	CALL SEARCH-LIST,FOO,TBL,P-SRCALL
	NEXT? FOO >FOO /?L4
?L3:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L8
	CALL DO-SL,LOCAL-GLOBALS,1,1
?L8:	GET TBL,P-MATCHLEN >LEN
	ZERO? LEN \?L11
	CALL SEARCH-LIST,GLOBAL-FERRY,TBL,P-SRCTOP
?L11:	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L14
	GET TBL,1 >P-MOBY-FOUND
?L14:	SET 'P-MOBY-FLAG,0
	RETURN LEN

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL
	PRINTI "Which"
	CALL WHICH-PRINT-NOUN,TBL
	PRINTI " do you mean, "
	CALL WHICH-PRINT-LIST,TLEN,LEN,TBL
	PRINTR "?"

	.FUNCT WHICH-PRINT-NOUN,TBL
	ZERO? P-OFLAG \?L3
	ZERO? P-MERGED \?L3
	ZERO? P-AND /?L1
?L3:	PRINTI " "
	EQUAL? P-NAM,W?INTNUM \?L6
	CALL DPRINT,INTNUM >STACK
	RSTACK
?L6:	PRINTB P-NAM
	RTRUE
?L1:	EQUAL? TBL,P-PRSO \?L11
	CALL CLAUSE-PRINT,P-NC1,P-NC1L,0 >STACK
	RSTACK
?L11:	CALL CLAUSE-PRINT,P-NC2,P-NC2L,0 >STACK
	RSTACK

	.FUNCT WHICH-PRINT-LIST,TLEN,LEN,TBL,OBJ,RLEN
	SET 'RLEN,LEN
?L1:	INC 'TLEN
	GET TBL,TLEN >OBJ
	CALL THE?,OBJ
	CALL DPRINT,OBJ
	EQUAL? LEN,2 \?L5
	EQUAL? RLEN,2 /?L7
	PRINTI ", "
?L7:	PRINTI " or "
	JUMP ?L14
?L5:	GRTR? LEN,2 \?L14
	PRINTI ", "
?L14:	DLESS? 'LEN,1 \?L1
	RTRUE

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	FSET? OBJ,CONTBIT /?L12
	FSET? OBJ,SURFACEBIT \?L11
?L12:	FSET? OBJ,OPENBIT /?L10
?L11:	FSET? OBJ,TRANSBIT \?L8
?L10:	CALL SEARCH-LIST,OBJ,TBL,P-SRCTOP
?L8:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETPT HERE,P?PSEUDO >RMG
	ZERO? RMG /?L21
	PTSIZE RMG >STACK
	DIV STACK,4 >STACK
	SUB STACK,1 >RMGL
	SET 'CNT,0
?L20:	MUL CNT,2 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L22
	MUL CNT,2 >STACK
	INC 'STACK
	GET RMG,STACK >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	PUTP PSEUDO-OBJECT,P?DESCFCN,HERE
	GETP PSEUDO-OBJECT,P?ACTION >STACK
	CALL STACK,M-NAME >STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L21
?L22:	IGRTR? 'CNT,RMGL \?L20
?L21:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	RETURN P-SLOCBITS

	.FUNCT DO-SL,OBJ,BIT1,BIT2,BITS
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL,FLS,NOBJ
	FIRST? OBJ >OBJ \FALSE
?L3:	EQUAL? LVL,P-SRCBOT /?L5
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L5
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	EQUAL? LVL,P-SRCTOP \?L10
	FSET? OBJ,SEARCHBIT /?L10
	FSET? OBJ,SURFACEBIT \?L8
?L10:	FIRST? OBJ >NOBJ \?L8
	FSET? OBJ,OPENBIT /?L11
	FSET? OBJ,TRANSBIT /?L11
	ZERO? P-MOBY-FLAG \?L11
	FSET? OBJ,PERSON \?L8
	EQUAL? OBJ,PLAYER /?L8
?L11:	FSET? OBJ,SURFACEBIT \?L12
	PUSH P-SRCALL
	JUMP ?L15
?L12:	FSET? OBJ,SEARCHBIT \?L14
	PUSH P-SRCALL
	JUMP ?L15
?L14:	PUSH P-SRCTOP
?L15:	CALL SEARCH-LIST,OBJ,TBL,STACK >FLS
?L8:	NEXT? OBJ >OBJ /?L3
	RTRUE

	.FUNCT THIS-IT?,OBJ,TBL,SYNS
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	ZERO? P-ADJ /?L4
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DEC 'STACK
	CALL ZMEMQB,P-ADJ,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L4:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,BITS,PTR,OBJ,TAKEN
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST BITS,SHAVE /?L3
	BTST BITS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L9
	SET 'OBJ,P-IT-OBJECT
?L9:	CALL HELD?,OBJ >STACK
	ZERO? STACK \?L3
	SET 'PRSO,OBJ
	FSET? OBJ,TRYTAKEBIT \?L14
	SET 'TAKEN,1
	JUMP ?L18
?L14:	EQUAL? WINNER,PLAYER /?L16
	SET 'TAKEN,0
	JUMP ?L18
?L16:	BTST BITS,STAKE \?L17
	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \?L17
	SET 'TAKEN,0
	JUMP ?L18
?L17:	SET 'TAKEN,1
?L18:	ZERO? TAKEN /?L49
	BTST BITS,SHAVE \?L19
	EQUAL? OBJ,GLOBAL-MONEY,RIDICULOUS-MONEY-KLUDGE /?L23
	EQUAL? OBJ,INTNUM \?L24
	ZERO? P-DOLLAR-FLAG \?L23
?L24:	EQUAL? OBJ,IT \?L21
	EQUAL? P-IT-OBJECT,RIDICULOUS-MONEY-KLUDGE,INTNUM,GLOBAL-MONEY \?L21
?L23:	CALL TELL-YOU-CANT,STR?14
	RFALSE
?L21:	CALL TELL-DONT-HAVE,0
	EQUAL? OBJ,NOT-HERE-OBJECT \?L26
	PRINTI "that."
	CRLF
	RFALSE
?L26:	CALL THE?,OBJ
	CALL DPRINT,OBJ
	PRINTI "."
	CRLF
	RFALSE
?L19:	ZERO? TAKEN \?L3
?L49:	EQUAL? WINNER,PLAYER \?L3
	PRINTI "(taking "
	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,0 /?L38
	GET TBL,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L36
?L38:	CALL THE?,OBJ
	CALL DPRINT,OBJ
	JUMP ?L41
?L36:	PRINTI "it"
?L41:	PRINTI " first)"
	CRLF
	JUMP ?L3

	.FUNCT MANY-CHECK,LOSS=0,TMP
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	CALL TELL-YOU-CANT,STR?15,0
	EQUAL? LOSS,2 \?L7
	PRINTI "in"
?L7:	PRINTI "direct objects with """
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L14
	PRINTI "tell"
	JUMP ?L20
?L14:	ZERO? P-OFLAG \?L19
	ZERO? P-MERGED /?L18
?L19:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L20
?L18:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L20:	PRINTI """."
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT LIT?,RM,OHERE,LIT?1=0
	SET 'P-GWIMBIT,ONBIT
	SET 'OHERE,HERE
	SET 'HERE,RM
	FSET? RM,ONBIT \?L1
	SET 'LIT?1,1
	JUMP ?L7
?L1:	PUT P-MERGE,P-MATCHLEN,0
	SET 'P-TABLE,P-MERGE
	SET 'P-SLOCBITS,-1
	EQUAL? OHERE,RM \?L4
	CALL DO-SL,WINNER,1,1
?L4:	CALL DO-SL,RM,1,1
	GET P-TABLE,P-MATCHLEN >STACK
	GRTR? STACK,0 \?L7
	SET 'LIT?1,1
?L7:	SET 'HERE,OHERE
	SET 'P-GWIMBIT,0
	RETURN LIT?1

	.FUNCT VPRINT,TMP
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "say"
	RTRUE
?L1:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L5
	GET TMP,0 >STACK
	PRINTB STACK
	RTRUE
?L5:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT PRSO-PRINT,PTR
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 /?L3
	ZERO? P-MERGED \?L3
	GET P-ITBL,P-NC1 >PTR
	GET PTR,0 >STACK
	EQUAL? STACK,W?IT \?L1
?L3:	PRINTI " "
	CALL DPRINT,PRSO >STACK
	RSTACK
?L1:	GET P-ITBL,P-NC1L >STACK
	CALL BUFFER-PRINT,PTR,STACK,0 >STACK
	RSTACK

	.FUNCT PRSI-PRINT,PTR
	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 /?L3
	ZERO? P-MERGED \?L3
	GET P-ITBL,P-NC2 >PTR
	GET PTR,0 >STACK
	EQUAL? STACK,W?IT \?L1
?L3:	PRINTI " "
	CALL DPRINT,PRSI >STACK
	RSTACK
?L1:	GET P-ITBL,P-NC2L >STACK
	CALL BUFFER-PRINT,PTR,STACK,0 >STACK
	RSTACK

	.FUNCT THE?,OBJ
	EQUAL? OBJ,NOT-HERE-OBJECT \?L1
	PRINTI "any "
	RTRUE
?L1:	FSET? OBJ,PERSON /FALSE
	EQUAL? OBJ,PETES-PATCH /FALSE
	PRINTI "the "
	RTRUE

	.FUNCT START-SENTENCE,OBJ
	EQUAL? OBJ,WEASEL \?L1
	PRINTI "The Weasel"
	RTRUE
?L1:	FSET? OBJ,PERSON /?L6
	EQUAL? OBJ,PETES-PATCH \?L5
?L6:	CALL DPRINT,OBJ >STACK
	RSTACK
?L5:	PRINTI "The "
	CALL DPRINT,OBJ >STACK
	RSTACK

	.FUNCT TELL-DONT-HAVE,STR
	PRINTI "You don't have "
	ZERO? STR /FALSE
	PRINT STR
	PRINTR "."

	.FUNCT TELL-NO-KEY
	CALL TELL-DONT-HAVE,STR?16 >STACK
	RSTACK

	.FUNCT RED-HERRING-F
	EQUAL? PRSA,V?ASK-ABOUT /FALSE
	CALL GLOBAL-NOT-HERE-PRINT,RED-HERRING >STACK
	RSTACK

	.FUNCT INTNUM-F
	EQUAL? PRSA,V?WITHDRAW,V?GIVE \?L1
	ZERO? P-DOLLAR-FLAG \?L9
	PRINTI "Next time, tell me what there's "
	PRINTN P-NUMBER
	PRINTI " of."
	CRLF
	SET 'CLOCK-WAIT,1
	RETURN 2
?L1:	ZERO? P-DOLLAR-FLAG /FALSE
?L9:	EQUAL? PRSA,V?ASK-FOR,V?TAKE,V?WITHDRAW /FALSE
	EQUAL? WINNER,PLAYER \FALSE
	GRTR? P-AMOUNT,POCKET-CHANGE \FALSE
	CALL TELL-DONT-HAVE,STR?17 >STACK
	RSTACK

	.FUNCT AIR-F
	EQUAL? PRSA,V?TASTE,V?SMELL \?L1
	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK /?L3
	FSET? MASK,WORNBIT /?L3
	PRINTR "The air is musty but breathable."
?L3:	EQUAL? HERE,MM-ENGINE-ROOM,NW-ENGINE-ROOM \?L7
	PRINTR "The air is heavy with diesel fumes."
?L7:	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L10
	PRINTR "It feels a whole lot better than the water you could be breathing."
?L10:	PRINTR "You find nothing special about the air."
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L16
	PRINTR "I think you're an air head."
?L16:	EQUAL? PRSA,V?LOOK-INSIDE \?L19
	CALL PERFORM,V?LOOK
	RTRUE
?L19:	EQUAL? PRSI,AIR \FALSE
	EQUAL? PRSA,V?DROP,V?THROW \FALSE
	CALL PERFORM,PRSA,PRSO,GROUND
	RTRUE

	.FUNCT FLOOR-F
	EQUAL? PRSA,V?PUT,V?PUT-ON \FALSE
	EQUAL? PRSI,GROUND \FALSE
	CALL PERFORM,V?DROP,PRSO
	RTRUE

	.FUNCT DECK-F
	EQUAL? PRSA,V?WALK-TO \?L1
	CALL TELL-SHD-DIR >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUT,V?PUT-ON \FALSE
	EQUAL? PRSI,DECK \FALSE
	CALL PERFORM,V?DROP,PRSO
	RTRUE

	.FUNCT FLOOR-HOLE-F
	EQUAL? PRSA,V?THROUGH \?L1
	CALL DO-WALK,P?DOWN
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L3
	CALL TELL-YOU-CANT,STR?18 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?EXAMINE \FALSE
	EQUAL? HERE,WRECK-5 \?L5
	ZERO? WRECK-5-FLOODED \?L5
	PRINTR "There's water on the other side."
?L5:	CALL TELL-LOOKS-HOLE >STACK
	RSTACK

	.FUNCT TELL-LOOKS-HOLE
	PRINTR "It looks a lot like a hole."

	.FUNCT CEILING-HOLE-F
	EQUAL? PRSA,V?THROUGH \?L1
	CALL DO-WALK,P?UP
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L3
	CALL TELL-YOU-CANT,STR?18 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?EXAMINE \FALSE
	CALL TELL-LOOKS-HOLE >STACK
	RSTACK

	.FUNCT HOLE-F
	EQUAL? PRSA,V?DRILL /FALSE
	CALL GLOBAL-NOT-HERE-PRINT,HOLE >STACK
	RSTACK

	.FUNCT MAST-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "There are several rotting masts here."
	EQUAL? HERE,WRECK-1 \?L5
	PRINTI " The top of one has fallen into a hole at your feet."
?L5:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?CLIMB-FOO \FALSE
	PRINTR "None of the masts looks sturdy enough."

	.FUNCT LIGHTHOUSE-F
	EQUAL? HERE,WINDING-ROAD-1 \?L1
	EQUAL? PRSA,V?OPEN,V?THROUGH \?L3
	PRINTR "The door is locked."
?L3:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "You can see the base of a "
	CALL DPRINT,LIGHTHOUSE
	PRINTI ". "
	CALL TELL-CLOSED,STR?19
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L12
	PRINTI "The "
	CALL DPRINT,LIGHTHOUSE
	PRINTI " towers over Hardscrabble Island from the island's northwest corner."
	GRTR? PRESENT-TIME,1200 /?L18
	LESS? PRESENT-TIME,480 \?L16
?L18:	PRINTI " Its light provides a beacon for ships."
?L16:	CRLF
	RTRUE
?L12:	EQUAL? PRSA,V?WALK-TO \?L22
	CALL TELL-SHD-DIR >STACK
	RSTACK
?L22:	EQUAL? PRSA,V?FIND /FALSE
	EQUAL? PRSA,V?ASK-ABOUT \?L24
	FSET? PRSO,VICBIT \FALSE
	PRINTR """It's been there forever."""
?L24:	PRINTR "That would be difficult from this distance."

	.FUNCT GLOBAL-TREASURE-F
	EQUAL? PRSA,V?TELL,V?ASK-CONTEXT-ABOUT,V?ASK-ABOUT /FALSE
	EQUAL? PRSA,V?FIND \?L3
	EQUAL? WINNER,PLAYER \?L4
	CALL TELL-NOT-EASY >STACK
	RSTACK
?L4:	PRINTR """I'd like to know where some is."""
?L3:	CALL GLOBAL-NOT-HERE-PRINT,GLOBAL-TREASURE >STACK
	RSTACK

	.FUNCT TRAWLER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,TRAWLER-LINE-C \?L3
	PRINTI "The "
	CALL DPRINT,TRAWLER
	PRINTR " is in decent shape."
?L3:	EQUAL? HERE,MM-WHEELHOUSE \?L7
	ZERO? AT-SEA /?L7
	CALL GLOBAL-NOT-HERE-PRINT,TRAWLER >STACK
	RSTACK
?L7:	PRINTI "The "
	CALL DPRINT,TRAWLER
	CALL TELL-BOAT-DESC >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?THROUGH,V?BOARD \?L11
	EQUAL? HERE,WHARF \?L12
	CALL DO-WALK,P?WEST
	RTRUE
?L12:	EQUAL? HERE,UNDERWATER \?L14
	EQUAL? DEPTH,50 \?L14
	CALL DO-WALK,P?UP
	RTRUE
?L14:	CALL TELL-YOU-CANT,STR?20
	RTRUE
?L11:	EQUAL? PRSA,V?DISEMBARK \?L16
	ZERO? AT-SEA /?L17
	CALL GLOBAL-IN?,RAILING,HERE >STACK
	ZERO? STACK /?L19
	CALL PERFORM,V?DIVE
	RTRUE
?L19:	CALL TELL-NO-EXIT >STACK
	RSTACK
?L17:	EQUAL? HERE,NW-STARBOARD-DECK \?L22
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L22:	CALL TELL-NO-EXIT >STACK
	RSTACK
?L16:	EQUAL? PRSA,V?LISTEN \?L24
	ZERO? AT-SEA /?L24
	CALL TELL-THRUM >STACK
	RSTACK
?L24:	EQUAL? PRSA,V?LAUNCH \FALSE
	CALL TELL-YOU-CANT,STR?21 >STACK
	RSTACK

	.FUNCT TELL-NO-EXIT
	CALL TELL-HOW-THAT,STR?23,STR?22 >STACK
	RSTACK

	.FUNCT TELL-HOW-THAT,STR,LAST=0
	PRINTI "How can you "
	PRINT STR
	PRINTI " that"
	ZERO? LAST /?L3
	PRINTI " "
	PRINT LAST
?L3:	PRINTR "?"

	.FUNCT TELL-BOAT-DESC
	PRINTR " looks weathered but not aged."

	.FUNCT TELL-THRUM
	PRINTR "You hear the powerful thrum of diesel engines."

	.FUNCT SALVAGER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,SALVAGER-LINE-C \?L3
	PRINTI "The "
	CALL DPRINT,SALVAGER
	PRINTR " is shipshape."
?L3:	EQUAL? HERE,NW-WHEELHOUSE \?L7
	ZERO? AT-SEA /?L7
	CALL GLOBAL-NOT-HERE-PRINT,SALVAGER >STACK
	RSTACK
?L7:	PRINTI "The "
	CALL DPRINT,SALVAGER
	PRINTI " is a medium-size boat that"
	CALL TELL-BOAT-DESC >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?THROUGH,V?BOARD \?L11
	EQUAL? HERE,WHARF \?L12
	CALL DO-WALK,P?EAST
	RTRUE
?L12:	EQUAL? HERE,UNDERWATER \?L14
	EQUAL? DEPTH,50 \?L14
	CALL DO-WALK,P?UP
	RTRUE
?L14:	CALL TELL-YOU-CANT,STR?20
	RTRUE
?L11:	EQUAL? PRSA,V?DISEMBARK \?L16
	ZERO? AT-SEA /?L17
	CALL GLOBAL-IN?,RAILING,HERE >STACK
	ZERO? STACK /?L19
	CALL PERFORM,V?DIVE
	RTRUE
?L19:	CALL TELL-NO-EXIT >STACK
	RSTACK
?L17:	EQUAL? HERE,MM-PORT-DECK \?L22
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L22:	CALL TELL-NO-EXIT >STACK
	RSTACK
?L16:	EQUAL? PRSA,V?LISTEN \?L24
	ZERO? AT-SEA /?L24
	CALL TELL-THRUM >STACK
	RSTACK
?L24:	EQUAL? PRSA,V?LAUNCH \FALSE
	CALL TELL-YOU-CANT,STR?21 >STACK
	RSTACK

	.FUNCT SHIPWRECK-F
	EQUAL? PRSA,V?DISEMBARK \?L1
	CALL TELL-NOT-EASY >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "It is what's left of a "
	EQUAL? WRECK-CHOSEN,1,3 \?L6
	PRINTI "wooden"
	JUMP ?L10
?L6:	PRINTI "steel"
?L10:	PRINTR " ship."

	.FUNCT GLOBAL-SLEEP-F
	EQUAL? PRSA,V?WALK-TO \?L1
	CALL PERFORM,V?SLEEP
	RTRUE
?L1:	PRINTR "Huh? Wake up!"

	.FUNCT FIELD-F
	EQUAL? PRSA,V?THROUGH,V?BOARD \?L1
	CALL TELL-YOU-CANT,STR?24 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-BEHIND \?L3
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L3:	EQUAL? PRSA,V?CUT \?L6
	CALL TELL-DONT-HAVE,STR?25 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?PLAY \?L7
	PRINTR "Sounds exciting."
?L7:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "This field was once productive farmland but hasn't been tended for many years."

	.FUNCT ROCKS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The rocks here are large, pointy, and impossible to get through."
?L1:	EQUAL? PRSA,V?THROUGH,V?BOARD \FALSE
	CALL TELL-YOU-CANT,STR?26 >STACK
	RSTACK

	.FUNCT POCKET-F
	FSET? WET-SUIT,WORNBIT /?L3
	FSET? DEEP-SUIT,WORNBIT \?L1
?L3:	PRINTR "Your diving gear is over the pocket."
?L1:	EQUAL? PRSA,V?TAKE \?L6
	EQUAL? PRSO,RIDICULOUS-MONEY-KLUDGE,GLOBAL-MONEY \?L6
	CALL TELL-FLASHING-CASH >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \?L7
	PRINTI "There is $"
	PRINTN POCKET-CHANGE
	PRINTR " in it."
?L7:	EQUAL? PRSA,V?EMPTY \?L10
	PRINTR "You think better of the idea."
?L10:	EQUAL? PRSA,V?OPEN \?L13
	PRINTR "It's open enough."
?L13:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,POCKET \FALSE
	ZERO? P-DOLLAR-FLAG /?L17
	EQUAL? PRSO,INTNUM \?L17
	GRTR? P-AMOUNT,POCKET-CHANGE \?L17
	CALL TELL-DONT-HAVE,STR?17 >STACK
	RSTACK
?L17:	EQUAL? PRSO,RIDICULOUS-MONEY-KLUDGE,GLOBAL-MONEY /?L20
	EQUAL? PRSO,INTNUM \?L19
	ZERO? P-DOLLAR-FLAG /?L19
?L20:	CALL TELL-ALREADY,STR?27 >STACK
	RSTACK
?L19:	CALL TELL-NO-FIT >STACK
	RSTACK

	.FUNCT TELL-NO-FIT,STR=0
	PRINTI "It won't fit"
	ZERO? STR /?L3
	PRINTI " "
	PRINT STR
?L3:	PRINTR "."

	.FUNCT PEOPLE-F
	EQUAL? HERE,SHANTY,FERRY-LANDING \?L1
	PRINTI "Leave them alone. They're not bothering you."
	CRLF
	CALL KILL-VERB? >STACK
	CALL PRINT-ID,STR?28,STACK
	CALL HARM-VERB? >STACK
	CALL PRINT-ID,STR?29,STACK >STACK
	RSTACK
?L1:	IN? HERE,WEASEL /?L6
	IN? HERE,JOHNNY /?L6
	IN? HERE,PETE /?L6
	IN? HERE,SPEAR-CARRIER /?L6
	IN? HERE,DELIVERY-BOY \?L5
?L6:	CALL TELL-REFER-INDIVIDUAL,STR?30 >STACK
	RSTACK
?L5:	CALL GLOBAL-NOT-HERE-PRINT,PEOPLE >STACK
	RSTACK

	.FUNCT TELL-REFER-INDIVIDUAL,STR
	PRINTI "Refer to individual"
	PRINT STR
	PRINTR "."

	.FUNCT GLOBAL-SURFACE-F
	EQUAL? PRSA,V?OPEN \FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT MOVE-SHARED-OBJECTS,PLACE,CTR=0,SURFACE?=1
	EQUAL? PLACE,LAST-S-O-T-PLACE /FALSE
	EQUAL? LAST-S-O-T-PLACE,MM-CREW-QTRS,NW-CREW-QTRS \?L3
	SET 'SURFACE?,0
	CALL UNLOAD,UNDER-BUNK
	CALL UNLOAD,BUNK
	JUMP ?L5
?L3:	EQUAL? LAST-S-O-T-PLACE,MM-GALLEY,NW-GALLEY \?L4
	CALL UNLOAD,STOVE
	JUMP ?L5
?L4:	EQUAL? LAST-S-O-T-PLACE,MM-LOUNGE,NW-LOUNGE \?L5
	CALL UNLOAD,LOUNGE-CHAIR
?L5:	ZERO? SURFACE? /?L7
	CALL UNLOAD,GLOBAL-SURFACE
?L7:	EQUAL? PLACE,MM-CREW-QTRS,NW-CREW-QTRS /?L10
	MOVE GLOBAL-SURFACE,PLACE
?L10:	SET 'LAST-S-O-T-PLACE,PLACE
?L13:	GRTR? CTR,44 /TRUE
	ADD CTR,1 >STACK
	GET SHARED-OBJECT-TABLE,STACK >STACK
	EQUAL? STACK,PLACE \?L17
	ADD CTR,2 >STACK
	GET SHARED-OBJECT-TABLE,STACK >STACK
	GET SHARED-OBJECT-TABLE,CTR >STACK
	MOVE STACK,STACK
	PUT SHARED-OBJECT-TABLE,CTR,0
	ADD CTR,1 >STACK
	PUT SHARED-OBJECT-TABLE,STACK,0
	ADD CTR,2 >STACK
	PUT SHARED-OBJECT-TABLE,STACK,0
?L17:	ADD CTR,3 >CTR
	JUMP ?L13

	.FUNCT UNLOAD,OBJ,F,N
	FIRST? OBJ >F \FALSE
	NEXT? F >N /?L3
?L3:	CALL PUT-IN-TABLE,F,LAST-S-O-T-PLACE,OBJ
?L4:	ZERO? N /TRUE
	SET 'F,N
	NEXT? F >N /?L9
?L9:	CALL PUT-IN-TABLE,F,LAST-S-O-T-PLACE,OBJ
	JUMP ?L4

	.FUNCT PUT-IN-TABLE,OBJ,RM,SURF,CTR=0
	EQUAL? OBJ,PLAYER /FALSE
?L1:	GRTR? CTR,44 /?L5
	GET SHARED-OBJECT-TABLE,CTR >STACK
	ZERO? STACK \?L8
	PUT SHARED-OBJECT-TABLE,CTR,OBJ
	ADD CTR,1 >STACK
	PUT SHARED-OBJECT-TABLE,STACK,RM
	ADD CTR,2 >STACK
	PUT SHARED-OBJECT-TABLE,STACK,SURF
	MOVE OBJ,LOCAL-GLOBALS
	RFALSE
?L8:	ADD CTR,3 >CTR
	JUMP ?L1
?L5:	PRINTR "[BUG: Too much on surfaces.]"

	.FUNCT GLOBAL-BANK-F
	EQUAL? HERE,BANK \?L1
	EQUAL? PRSA,V?EXAMINE \?L3
	CALL PERFORM,V?LOOK
	SET 'P-IT-OBJECT,GLOBAL-BANK
	RTRUE
?L3:	EQUAL? PRSA,V?ROB \?L5
	CALL ROBBERY-ENDING >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?EXIT,V?DROP \?L6
	CALL DO-WALK,P?OUT
	RTRUE
?L6:	EQUAL? PRSA,V?MUNG \FALSE
	PRINTI "This isn't Monte Carlo."
	CRLF
	CALL PRINT-ID,STR?31
	RTRUE
?L1:	EQUAL? HERE,SHORE-ROAD-2 \?L11
	EQUAL? PRSA,V?THROUGH \?L12
	CALL DO-WALK,P?IN
	RTRUE
?L12:	EQUAL? PRSA,V?EXAMINE \?L14
	PRINTI "The "
	CALL DPRINT,BANK
	PRINTR " is an imposing granite building."
?L14:	EQUAL? PRSA,V?ROB \FALSE
	ZERO? BUSINESS-HOURS? /?L18
	CALL ROBBERY-ENDING >STACK
	RSTACK
?L18:	CALL ROBBERY-ENDING,0 >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?ASK-ABOUT \?L24
	EQUAL? PRSI,GLOBAL-BANK /FALSE
?L24:	EQUAL? PRSA,V?WALK-TO,V?FIND \?L22
	EQUAL? PRSO,GLOBAL-BANK /FALSE
?L22:	CALL GLOBAL-NOT-HERE-PRINT,GLOBAL-BANK >STACK
	RSTACK

	.FUNCT ROBBERY-ENDING,INSIDE?=1
	ZERO? INSIDE? /?L1
	PRINTI "The teller trips the alarm, and policemen come and drag you away. As you contemplate a stretch in prison, you consider that crime might not pay."
	CRLF
	CALL PRINT-ID,STR?32
	JUMP ?L5
?L1:	PRINTI "You don't realize your attempts have set off a silent alarm until the police arrive. At that point, you can only wonder if attempted robbery wasn't such a bright idea."
	CRLF
	CALL PRINT-ID,STR?33
?L5:	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT GLOBAL-MONEY-F
	EQUAL? PRSA,V?STEP,V?ASK-ABOUT,V?ASK-FOR /FALSE
	EQUAL? PRSA,V?FOLLOW,V?WHAT /FALSE
	EQUAL? PRSA,V?FIND \?L4
	CALL TELL-NOT-EASY
	RTRUE
?L4:	GRTR? POCKET-CHANGE,0 \?L5
	FSET? WET-SUIT,WORNBIT /?L8
	FSET? DEEP-SUIT,WORNBIT \?L6
?L8:	CALL TELL-CANT-REACH,STR?34 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?COUNT \?L9
	PRINTI "You are carrying $"
	PRINTN POCKET-CHANGE
	PRINTR "."
?L9:	EQUAL? PRSA,V?EXAMINE \?L12
	PRINTI "It looks a lot like $"
	PRINTN POCKET-CHANGE
	PRINTR "."
?L12:	EQUAL? PRSA,V?TAKE /FALSE
	CALL TELL-FLASHING-CASH >STACK
	RSTACK
?L5:	EQUAL? HERE,BANK \?L17
	PRINTI "Not surprisingly, the money here is not easily accessible."
	CRLF
	EQUAL? PRSA,V?TAKE /?L20
	PUSH 0
	JUMP ?L21
?L20:	PUSH 1
?L21:	CALL PRINT-ID,STR?35,STACK
	EQUAL? PRSA,V?CUT,V?BURN,V?MUNG /?L22
	PUSH 0
	JUMP ?L23
?L22:	PUSH 1
?L23:	CALL PRINT-ID,STR?36,STACK
	RTRUE
?L17:	CALL GLOBAL-NOT-HERE-PRINT,GLOBAL-MONEY >STACK
	RSTACK

	.FUNCT TELL-FLASHING-CASH
	PRINTR "Flashing your bankroll is not a good idea."

	.FUNCT FERRY-TOKEN-F
	IN? SPEAR-CARRIER,HERE \?L1
	EQUAL? PRSA,V?ASK-FOR,V?ASK-ABOUT \?L4
	EQUAL? PRSO,SPEAR-CARRIER /?L3
?L4:	EQUAL? PRSA,V?BUY \?L1
?L3:	CALL NO-TOKENS,HERE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?ASK-ABOUT \?L5
	FSET? PRSO,PERSON \?L5
	PRINTR """You need them for the ferry."""
?L5:	EQUAL? PRSA,V?ASK-FOR,V?FIND /FALSE
	CALL GLOBAL-NOT-HERE-PRINT,FERRY-TOKEN >STACK
	RSTACK

	.FUNCT NO-TOKENS,PLACE
	EQUAL? PLACE,BANK \?L1
	PRINTR "The teller says, ""We're out. Try Outfitters."""
?L1:	PRINTI "The "
	CALL DPRINT,SPEAR-CARRIER
	PRINTI " checks and then says, ""I'm afraid we're out of tokens. Try "
	CALL DPRINT,BANK
	PRINTR "."""

	.FUNCT GLOBAL-TIME-F
	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR \?L1
	EQUAL? PRSO,SPEAR-CARRIER \?L3
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTI " checks and tells you it's "
	CALL TIME-PRINT,PRESENT-TIME
	CRLF
	RTRUE
?L3:	FSET? PRSO,PERSON \FALSE
	PRINTR """I'm not sure."""
?L1:	EQUAL? PRSA,V?TELL \?L11
	EQUAL? PRSO,GLOBAL-TIME \?L11
	ZERO? PRSI \?L11
	PRINTR "Didn't you learn that the little hand points to the hour and the big hand points to the minute?"
?L11:	EQUAL? PRSA,V?EXAMINE \?L14
	CALL PERFORM,V?TIME
	SET 'P-IT-OBJECT,GLOBAL-TIME
	RTRUE
?L14:	EQUAL? PRSA,V?TELL \?L15
	FSET? PRSO,VICBIT \?L15
	EQUAL? PRSO,ME \FALSE
?L15:	PRINTR "If you want to know the time, check your watch."

	.FUNCT GLOBAL-DAY-F
	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR \?L4
	FSET? PRSO,VICBIT /?L3
?L4:	EQUAL? PRSA,V?WHAT \?L7
	EQUAL? WINNER,PLAYER /?L1
?L3:	PRINTR """Wednesday."""
?L1:	EQUAL? PRSA,V?WHAT \?L7
	PRINTR "Ask somebody."
?L7:	CALL TELL-SERIOUS >STACK
	RSTACK

	.FUNCT TELL-SERIOUS
	PRINTR "Be serious."

	.FUNCT ADVENTURER-F
	GRTR? BLOOD-ALCOHOL,25 \?L1
	CALL PRINT-ID,STR?37
	CALL JIGS-UP,STR?38 >STACK
	RSTACK
?L1:	GRTR? HOW-THIRSTY,3 /?L4
	GRTR? BLOOD-ALCOHOL,15 /?L4
	GRTR? HOW-HUNGRY,3 /?L4
	EQUAL? HOW-TIRED,6 /?L4
	EQUAL? P-ADVERB,W?SLOWLY \?L3
?L4:	EQUAL? PRSA,V?WAIT,V?SLEEP /?L7
	EQUAL? PRSA,V?TELL \?L8
	ZERO? PRSI /?L7
?L8:	CALL GAME-COMMAND? >STACK
	ZERO? STACK \?L7
	ZERO? WAITED? /?L5
?L7:	SET 'WAITED?,2
	EQUAL? PRSA,V?WALK /?L12
	ZERO? PRSO /?L11
	CALL META-LOC,PRSO >STACK
	EQUAL? STACK,HERE /?L11
	IN? PRSO,GLOBAL-OBJECTS /?L11
	SET 'PRSO,NOT-HERE-OBJECT
	JUMP ?L12
?L11:	ZERO? PRSI /?L12
	CALL META-LOC,PRSI >STACK
	EQUAL? STACK,HERE /?L12
	IN? PRSI,GLOBAL-OBJECTS /?L12
	SET 'PRSI,NOT-HERE-OBJECT
?L12:	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \FALSE
	CALL NOT-HERE-OBJECT-F >STACK
	RSTACK
?L5:	SET 'WAITED?,1
	CALL CLOCKER >STACK
	EQUAL? STACK,M-FATAL \?L18
	SET 'CLOCK-WAIT,1
	PRINTI "This interrupts what you're trying to do."
	CRLF
	RETURN 2
?L18:	EQUAL? PRSA,V?WALK \FALSE
	IN? PLAYER,UNDERWATER /FALSE
	IN? PLAYER,HERE \FALSE
	GRTR? BLOOD-ALCOHOL,15 \?L27
	CALL TELL-YOURE-NOT,STR?39
	CRLF
	CALL RANDOM-WALK >STACK
	RSTACK
?L27:	RANDOM 100 >STACK
	GRTR? 40,STACK \FALSE
	PRINTI "You stop to sit down for a bit and then struggle back to your feet."
	CRLF
	RETURN 2
?L3:	FSET? FLIPPERS,WORNBIT \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	ZERO? AT-SEA \FALSE
	GETP HERE,P?LINE >STACK
	LESS? STACK,TRAWLER-LINE-C /?L38
	EQUAL? HERE,MM-PORT-DECK \?L39
	EQUAL? P-WALK-DIR,P?WEST /?L38
?L39:	EQUAL? HERE,NW-STARBOARD-DECK \FALSE
	EQUAL? P-WALK-DIR,P?EAST \FALSE
?L38:	PRINTR "You'd look silly walking around in flippers."

	.FUNCT RANDOM-WALK,P,Z,L,S,D=0
	SET 'P,0
?L1:	NEXTP HERE,P >P
	LESS? P,P?NW \?L3
	ZERO? D /TRUE
	CALL DO-WALK,D
	RTRUE
?L3:	GETPT HERE,P >Z
	PTSIZE Z >L
	EQUAL? L,UEXIT /?L11
	EQUAL? L,CEXIT \?L12
	GETB Z,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK \?L11
?L12:	EQUAL? L,DEXIT \?L1
	GETB Z,DEXITOBJ >STACK
	FSET? STACK,OPENBIT \?L1
?L11:	ZERO? D \?L13
	SET 'D,P
	JUMP ?L1
?L13:	RANDOM 100 >STACK
	GRTR? 50,STACK \?L1
	SET 'D,P
	JUMP ?L1

	.FUNCT DETECTOR-NOISE,LISTENING?=0,C,H,P,Z,L,R,LAST-R=0,?TMP
	CALL META-LOC,PLAYER >H
	ZERO? LISTENING? \?L1
	EQUAL? PRSA,V?LISTEN \?L1
	EQUAL? PRSO,METAL-DETECTOR /FALSE
?L1:	CALL META-LOC,METAL-DETECTOR >STACK
	EQUAL? STACK,H \?L3
	ZERO? DETECTOR-ON /?L3
	ZERO? DETECTOR-POWERED /?L3
	CALL COUNT-METAL,H >?TMP
	GETP H,P?DESCFCN >STACK
	ADD ?TMP,STACK >C
	SET 'P,0
?L4:	NEXTP H,P >P
	ZERO? P /?L5
	LESS? P,P?NW /?L4
	GETPT H,P >Z
	PTSIZE Z >L
	EQUAL? L,UEXIT,CEXIT,DEXIT \?L9
	GETB Z,0 >R
	EQUAL? R,LAST-R /?L4
	CALL COUNT-METAL,R >STACK
	DIV STACK,2 >?TMP
	GETP R,P?DESCFCN >STACK
	DIV STACK,2 >STACK
	ADD C,?TMP >STACK
	ADD STACK,STACK >C
	SET 'LAST-R,R
	JUMP ?L4
?L9:	EQUAL? L,FEXIT \?L4
	GET Z,0 >STACK
	CALL STACK,0 >R
	EQUAL? R,0,LAST-R /?L4
	CALL COUNT-METAL,R >STACK
	DIV STACK,2 >?TMP
	GETP R,P?DESCFCN >STACK
	DIV STACK,2 >STACK
	ADD C,?TMP >STACK
	ADD STACK,STACK >C
	SET 'LAST-R,R
	JUMP ?L4
?L5:	ZERO? C \?L26
	ZERO? LISTENING? /FALSE
	PRINTI "The "
	CALL DPRINT,METAL-DETECTOR
	PRINTR " makes no noise."
?L26:	PRINTI "The "
	CALL DPRINT,METAL-DETECTOR
	PRINTI " is clicking "
	GRTR? C,100 \?L30
	PRINTI "extremely fast"
	JUMP ?L43
?L30:	GRTR? C,75 \?L34
	PRINTI "quickly"
	JUMP ?L43
?L34:	GRTR? C,50 \?L37
	PRINTI "moderately"
	JUMP ?L43
?L37:	GRTR? C,25 \?L40
	PRINTI "slowly"
	JUMP ?L43
?L40:	PRINTI "occasionally"
?L43:	PRINTR "."
?L3:	ZERO? LISTENING? /FALSE
	PRINTI "The "
	CALL DPRINT,METAL-DETECTOR
	PRINTR " makes no noise."

	.FUNCT COUNT-METAL,R,F,V=0
	FIRST? R >F /?L4
	RETURN V
?L4:	FSET? F,INVISIBLE \?L7
	EQUAL? F,PLAYER \?L8
?L7:	GETP F,P?STATION >STACK
	ADD V,STACK >V
	FIRST? F >STACK \?L8
	CALL COUNT-METAL,F >STACK
	ADD V,STACK >V
?L8:	NEXT? F >F /?L4
	RETURN V

	.FUNCT CRETIN-F
	EQUAL? PRSO,WINNER,ME \FALSE
	EQUAL? PRSA,V?EAT \?L4
	PRINTI "Stick to stew."
	CRLF
	CALL PRINT-ID,STR?40
	RTRUE
?L4:	EQUAL? PRSA,V?DRINK \?L8
	PRINTR "Stick to grog."
?L8:	EQUAL? PRSA,V?ALARM \?L11
	PRINTR "Good morning!"
?L11:	EQUAL? PRSA,V?KILL,V?ATTACK,V?MUNG \?L14
	PRINTI "Although it's not hard, I can't make it that simple."
	CRLF
	CALL PRINT-ID,STR?41
	RTRUE
?L14:	EQUAL? PRSA,V?FIND \?L17
	PRINTR "Have you tried asking the parrot?"
?L17:	EQUAL? PRSA,V?LAMP-ON,V?TAKE /?L21
	EQUAL? PRSA,V?GIVE \?L20
	EQUAL? PRSO,ME \?L20
?L21:	PRINTR "You romantic fool!"
?L20:	EQUAL? PRSA,V?EXAMINE \?L24
	PRINTR "You look like a diver."
?L24:	EQUAL? PRSA,V?LOOK-UNDER \?L27
	PRINTR "I think the center of the earth is down there somewhere."
?L27:	EQUAL? PRSA,V?RUB \?L30
	PRINTR "You're starting to rub me the wrong way."
?L30:	EQUAL? PRSA,V?PLAY \?L33
	PRINTR "Don't expect an Oscar."
?L33:	EQUAL? PRSA,V?THROUGH,V?BOARD,V?CLIMB-ON \?L36
	PRINTR "I'm not impressed."
?L36:	EQUAL? PRSA,V?SHAKE,V?CROSS \?L39
	PRINTR "I'm much too kind."
?L39:	EQUAL? PRSA,V?DROP \?L42
	PRINTR "Like a hot potato."
?L42:	EQUAL? PRSA,V?FOLLOW \?L45
	PRINTR "What makes you think you know where you're going?"
?L45:	EQUAL? PRSA,V?SEARCH \?L48
	PRINTR "Okay. I found one empty head but a strong heart."
?L48:	EQUAL? PRSA,V?PUSH,V?SMELL \?L51
	PRINTR "I'd rather not."
?L51:	EQUAL? PRSA,V?THROW \?L54
	PRINTR "For a loop?"
?L54:	EQUAL? PRSA,V?ROB \FALSE
	PRINTR "You wouldn't get much from anyone that stupid."

	.FUNCT GLOBAL-SELF-F
	EQUAL? WINNER,PLAYER \?L6
	EQUAL? PRSI,GLOBAL-SELF \?L3
	SET 'PRSI,ME
?L3:	EQUAL? PRSO,GLOBAL-SELF \?L6
	SET 'PRSO,ME
?L6:	CALL PERFORM,PRSA,PRSO,PRSI
	RTRUE

	.FUNCT GLOBAL-ROOM-F,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?42
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	CALL PERFORM,V?LOOK
	SET 'P-IT-OBJECT,GLOBAL-ROOM
	RTRUE
?L3:	EQUAL? PRSA,V?DISEMBARK,V?EXIT,V?DROP \?L4
	CALL DO-WALK,P?OUT
	RTRUE
?L4:	EQUAL? PRSA,V?THROUGH,V?ENTER \?L5
	CALL DO-WALK,P?IN
	RTRUE
?L5:	EQUAL? PRSA,V?ATTACK,V?MUNG \?L6
	PRINTI "It's sturdier than you give it credit for."
	CRLF
	CALL PRINT-ID,STR?43
	RTRUE
?L6:	EQUAL? PRSA,V?UNLOCK \?L9
	PRINTR "Please be more specific about what you want to unlock."
?L9:	EQUAL? PRSA,V?PUT \FALSE
	CALL PERFORM,V?DROP,PRSO
	RTRUE

	.FUNCT WINDOW-F
	EQUAL? HERE,BEDROOM \?L1
	EQUAL? PRSA,V?LOOK-INSIDE \?L3
	PRINTI "You see an "
	CALL DPRINT,FIELD
	PRINTR " beyond the alley where the terrible events of last night transpired."
?L3:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTR "It's stuck shut."
?L1:	EQUAL? HERE,BANK \?L11
	EQUAL? PRSA,V?EXAMINE \?L12
	PRINTR "It is a barred window about chest-high behind which the teller transacts his business."
?L12:	EQUAL? PRSA,V?LOOK-BEHIND,V?LOOK-INSIDE \FALSE
	PRINTR "There is a teller there."
?L11:	EQUAL? HERE,MM-WHEELHOUSE,NW-WHEELHOUSE \FALSE
	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "You can see the ocean beyond the deck."

	.FUNCT IN-WINDOW-F,L
	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTI "You see "
	LOC JOHNNY >L
	EQUAL? L,MM-WHEELHOUSE,NW-WHEELHOUSE \?L5
	GETP L,P?LINE >STACK
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,STACK \?L5
	PRINTI "Johnny in "
?L5:	PRINTR "the wheelhouse."

	.FUNCT BEDROOM-DOOR-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? BEDROOM-DOOR,OPENBIT \?L3
	CALL TELL-ALREADY,STR?44
	RTRUE
?L3:	EQUAL? HERE,UPSTAIRS-HALLWAY \?L5
	ZERO? BEDROOM-DOOR-LOCKED /?L5
	PRINTR "It's locked."
?L5:	FSET BEDROOM-DOOR,OPENBIT
	SET 'BEDROOM-DOOR-LOCKED,0
	IN? WEASEL,UPSTAIRS-HALLWAY \?L9
	PRINTI "You open the door and see "
	CALL DPRINT,WEASEL
	PRINTI ". He says, ""Oh. Hi. I was just wonderin' if you were gonna be at the meetin' at "
	CALL DPRINT,SHANTY
	PRINTI "."" He turns and heads down the steps."
	CRLF
	CALL ESTABLISH-GOAL,WEASEL,SHANTY
	CALL INT,I-WEASEL-TO-BEDROOM >STACK
	PUT STACK,0,0
	RTRUE
?L9:	CALL TELL-NOW,BEDROOM-DOOR,STR?44
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE \?L14
	FSET? BEDROOM-DOOR,OPENBIT /?L15
	CALL TELL-ALREADY,STR?45
	RTRUE
?L15:	FCLEAR BEDROOM-DOOR,OPENBIT
	CALL TELL-NOW,BEDROOM-DOOR,STR?45
	RTRUE
?L14:	EQUAL? PRSA,V?UNLOCK \FALSE
	ZERO? BEDROOM-DOOR-LOCKED /?L19
	IN? PLAYER,BEDROOM /?L23
	EQUAL? PRSI,KEY \?L21
?L23:	SET 'BEDROOM-DOOR-LOCKED,0
	CALL TELL-NOW,BEDROOM-DOOR,STR?46 >STACK
	RSTACK
?L21:	ZERO? PRSI /?L24
	CALL TELL-YOU-CANT,STR?47 >STACK
	RSTACK
?L24:	PRINTR "Not without the key."
?L19:	CALL TELL-ALREADY,STR?46 >STACK
	RSTACK

	.FUNCT OCEAN-F,L
	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK /?L1
	PRINTR "There's no water in here."
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L6
	PRINTR "There is water all around you."
?L6:	PRINTI "The ocean looks choppy"
	ZERO? AT-SEA /?L13
	PRINTR ". Whitecaps rise and fall around the boat."
?L13:	PRINTR ", and you know about the dangerous currents here."
?L5:	EQUAL? PRSA,V?LISTEN \?L20
	PRINTR "You hear the crashing of the waves."
?L20:	EQUAL? PRSA,V?SWIM,V?THROUGH,V?BOARD \?L23
	GETP HERE,P?LINE >L
	EQUAL? L,UNDERWATER-LINE-C \?L24
	PRINTR "You're already in it!"
?L24:	EQUAL? L,TRAWLER-LINE-C,SALVAGER-LINE-C /?L29
	EQUAL? HERE,WHARF,FERRY-LANDING \?L28
?L29:	ZERO? AT-SEA /?L30
	CALL PERFORM,V?DIVE
	RTRUE
?L30:	CALL PRINT-ID,STR?48
	CALL JIGS-UP,STR?49 >STACK
	RSTACK
?L28:	CALL TELL-NO-SHORELINE >STACK
	RSTACK
?L23:	EQUAL? PRSA,V?THROW,V?DROP \?L34
	EQUAL? PRSI,OCEAN \?L34
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L35
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L35:	CALL TELL-NO-LITTER >STACK
	RSTACK
?L34:	EQUAL? PRSA,V?SMELL \?L38
	PRINTR "It smells very salty, which is what you might expect from the sea."
?L38:	EQUAL? PRSA,V?TASTE,V?DRINK \?L41
	GETP HERE,P?LINE >STACK
	GRTR? STACK,BACK-ALLEY-LINE-C /?L44
	EQUAL? HERE,FERRY-LANDING,WHARF \?L42
?L44:	PRINTI "Bleahhhh! You spit it out immediately!"
	CRLF
	CALL PRINT-ID,STR?50 >STACK
	RSTACK
?L42:	CALL TELL-NO-SHORELINE >STACK
	RSTACK
?L41:	EQUAL? PRSA,V?RUB \FALSE
	GETP HERE,P?LINE >STACK
	GRTR? STACK,BACK-ALLEY-LINE-C /?L51
	EQUAL? HERE,FERRY-LANDING,WHARF \?L49
?L51:	PRINTR "It's wet."
?L49:	CALL TELL-NO-SHORELINE >STACK
	RSTACK

	.FUNCT TELL-NO-SHORELINE
	CALL TELL-YOU-CANT,STR?51 >STACK
	RSTACK

	.FUNCT TELL-NO-LITTER
	PRINTR "It would spoil the beauty of the sea."

	.FUNCT STAIRS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The carpeted stairway leads "
	EQUAL? HERE,UPSTAIRS-HALLWAY \?L5
	PRINTI "down"
	JUMP ?L9
?L5:	EQUAL? HERE,RED-BOAR-INN \?L9
	PRINTI "up"
?L9:	PRINTR "."
?L1:	EQUAL? PRSA,V?CLIMB-FOO \FALSE
	EQUAL? HERE,UPSTAIRS-HALLWAY \?L16
	CALL V-CLIMB-UP,P?DOWN
	RTRUE
?L16:	CALL V-CLIMB-UP
	RTRUE

	.FUNCT LADDER-TOP-F
	EQUAL? PRSA,V?CLIMB-FOO \FALSE
	CALL DO-WALK,P?DOWN
	RTRUE

	.FUNCT LADDER-BOTTOM-F
	EQUAL? PRSA,V?CLIMB-FOO \FALSE
	CALL DO-WALK,P?UP
	RTRUE

	.FUNCT RAILING-F
	EQUAL? PRSA,V?CLIMB-FOO \?L1
	PRINTR "You immediately climb back down."
?L1:	EQUAL? PRSA,V?LEAP,V?DISEMBARK \FALSE
	CALL PERFORM,V?DIVE
	RTRUE

	.FUNCT BUNKS-F
	EQUAL? PRSA,V?SLEEP,V?BOARD \?L1
	CALL TELL-BAD-SHAPE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "These stacks of bunks look as though they were never comfortable. The work of time and the sea have made them fairly decrepit, incapable of supporting much weight."
?L3:	EQUAL? PRSA,V?MUNG \FALSE
	PRINTR "Some pieces fall away, but the structure holds together."

	.FUNCT TELL-BAD-SHAPE
	PRINTR "They don't look as if they could support your weight."

	.FUNCT TIME-PRINT,NUM,HR,PM=0
	DIV NUM,60 >HR
	GRTR? HR,12 \?L1
	SUB HR,12 >HR
	SET 'PM,1
	JUMP ?L4
?L1:	EQUAL? HR,12 \?L3
	SET 'PM,1
	JUMP ?L4
?L3:	ZERO? HR \?L4
	SET 'HR,12
?L4:	PRINTN HR
	PRINTI ":"
	MOD NUM,60 >HR
	LESS? HR,10 \?L8
	PRINTI "0"
?L8:	PRINTN HR
	PRINTI " "
	ZERO? PM /?L17
	PUSH STR?52
	JUMP ?L19
?L17:	PUSH STR?53
?L19:	PRINT STACK
	RTRUE

	.FUNCT TABLE-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?54
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "The table has a variety of forms and brochures you find boring."
?L3:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	EQUAL? PRSI,PSEUDO-OBJECT \FALSE
	PRINTI "A bank official scurries out, picks up the "
	CALL DPRINT,PRSO
	PRINTR ", and hands it to you, pointing out that the table is for bank business only."

	.FUNCT LIGHTHOUSE-LOCK-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?55
	RTRUE
?L1:	EQUAL? PRSA,V?PICK \?L3
	PRINTI "You try for a while, but the lock won't give."
	CRLF
	CALL PRINT-ID,STR?56
	RTRUE
?L3:	EQUAL? PRSA,V?UNLOCK \?L6
	CALL TELL-NO-KEY
	RTRUE
?L6:	EQUAL? PRSA,V?MUNG \?L7
	PRINTI "You find that the door and lock withstand your attempts."
	CRLF
	CALL PRINT-ID,STR?57
	RTRUE
?L7:	EQUAL? PRSA,V?LOCK \FALSE
	CALL TELL-ALREADY,STR?58
	RTRUE

	.FUNCT WHEEL-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?59
	RTRUE
?L1:	EQUAL? PRSA,V?SPIN,V?TURN \FALSE
	IN? JOHNNY,HERE \?L4
	CALL DPRINT,JOHNNY
	PRINTI " glares at you. You decide to leave the piloting to the captain."
	CRLF
	CALL PRINT-ID,STR?60 >STACK
	RSTACK
?L4:	PRINTR "The wheel spins."

	.FUNCT BOLT-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?61
	RTRUE
?L1:	PRINTR "The bolts are rusted firmly into place."

	.FUNCT NOT-HERE-OBJECT-F,TBL,PRSO?=1,OBJ
	EQUAL? PRSO,NOT-HERE-OBJECT \?L5
	EQUAL? PRSI,NOT-HERE-OBJECT \?L1
	PRINTR "Those things aren't here."
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L5
	SET 'TBL,P-PRSO
	JUMP ?L6
?L5:	SET 'TBL,P-PRSI
	SET 'PRSO?,0
?L6:	ZERO? PRSO? /?L7
	EQUAL? PRSA,V?CLIMB-UP,V?ASK-CONTEXT-FOR,V?ASK-CONTEXT-ABOUT /?L11
	EQUAL? PRSA,V?FOLLOW,V?FIND,V?EXAMINE /?L11
	EQUAL? PRSA,V?$0024CALL,V?WHAT,V?WAIT-FOR /?L11
	EQUAL? PRSA,V?THROUGH,V?MAKE,V?GIVE /?L11
	EQUAL? PRSA,V?WALK-TO \?L28
?L11:	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT /?L28
	RTRUE
?L7:	EQUAL? PRSA,V?SGIVE,V?ASK-FOR,V?ASK-ABOUT /?L22
	EQUAL? PRSA,V?TELL \?L28
?L22:	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT \TRUE
?L28:	EQUAL? PRSA,V?$0024CALL \?L30
	CALL V-CALL-LOSE
	SET 'CLOCK-WAIT,0
	JUMP ?L35
?L30:	EQUAL? WINNER,ADVENTURER \?L32
	CALL TELL-YOU-CANT,STR?62,0
	CALL NOT-HERE-PRINT,PRSO?
	PRINTI " here."
	CRLF
	JUMP ?L35
?L32:	CALL START-SENTENCE,WINNER
	PRINTI " seems confused. ""I don't see any"
	CALL NOT-HERE-PRINT,PRSO?
	PRINTI " here!"""
	CRLF
?L35:	SET 'P-MOBY-FOUND,0
	SET 'PRSA,0
	SET 'PRSO,0
	SET 'PRSI,0
	RETURN 2

	.FUNCT FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ,CTR,PER,?TMP
	CALL MOBY-FIND,TBL >M-F
	GRTR? M-F,1 \?L1
	GET TBL,1 >STACK
	GETP STACK,P?GLOBAL >OBJ
	ZERO? OBJ /?L1
	SET 'M-F,1
	SET 'P-MOBY-FOUND,OBJ
?L1:	EQUAL? 1,M-F \?L4
	ZERO? PRSO? /?L6
	EQUAL? PRSA,V?TELL \?L8
	EQUAL? WINNER,PLAYER \?L8
	FSET? P-MOBY-FOUND,VICBIT \?L8
	SET 'P-CONT,0
	CALL TELL-NOT-HERE-TALK
	RTRUE
?L8:	EQUAL? PRSA,V?EXAMINE \?L10
	FSET? P-MOBY-FOUND,PERSON \?L11
	CALL META-LOC,PLAYER >STACK
	GETP STACK,P?CORRIDOR >?TMP
	LOC P-MOBY-FOUND >STACK
	GETP STACK,P?CORRIDOR >STACK
	BAND ?TMP,STACK >STACK
	ZERO? STACK /?L11
	PRINTI "You can see "
	CALL DPRINT,P-MOBY-FOUND
	PRINTR " in the distance."
?L11:	EQUAL? PRSO,MCGINTY \?L15
	IN? PLAYER,BACK-ALLEY-2 \?L15
	IN? MCGINTY,MCGINTY-HQ \?L15
	PRINTI "Looking through the window, you see "
	CALL DPRINT,MCGINTY
	PRINTR " in his office."
?L15:	CALL GLOBAL-NOT-HERE-PRINT,PRSO
	RTRUE
?L10:	SET 'PRSO,P-MOBY-FOUND
	JUMP ?L20
?L6:	SET 'PRSI,P-MOBY-FOUND
?L20:	ZERO? P-XADJ /?L21
	ZERO? P-XNAM \?L21
	SET 'P-NONOUN,1
	RFALSE
?L21:	SET 'P-NONOUN,0
	RFALSE
?L4:	ZERO? PRSO? \?L24
	EQUAL? PRSA,V?ASK-ABOUT /?L27
	EQUAL? PRSA,V?TELL \?L25
	EQUAL? PRSO,ME \?L25
?L27:	EQUAL? PRSO,ME \?L28
	EQUAL? WINNER,PLAYER \?L30
	ZERO? QCONTEXT /?L30
	EQUAL? HERE,QCONTEXT-ROOM \?L30
	SET 'PER,QCONTEXT
	JUMP ?L33
?L30:	SET 'PER,WINNER
	JUMP ?L33
?L28:	SET 'PER,PRSO
?L33:	FSET? PER,VICBIT \?L34
	CALL SAY-CONFUSED,PER,PRSO?
	RTRUE
?L34:	CALL SUDDENLY-REALIZE-TALKING,PER
	RTRUE
?L25:	FSET? PRSO,VICBIT \?L37
	CALL SAY-CONFUSED,PRSO,PRSO? >STACK
	RSTACK
?L37:	PRINTI "You wouldn't find any"
	CALL NOT-HERE-PRINT,PRSO?
	PRINTR " there."
?L24:	RETURN NOT-HERE-OBJECT

	.FUNCT GLOBAL-NOT-HERE-PRINT,OBJ
	ZERO? P-MULT /?L1
	INC 'P-NOT-HERE
	JUMP ?L3
?L1:	CALL TELL-YOU-CANT,STR?62,0
	EQUAL? OBJ,PRSO \?L4
	CALL PRSO-PRINT
	JUMP ?L6
?L4:	CALL PRSI-PRINT
?L6:	PRINTI " here."
	CRLF
?L3:	SET 'P-WON,0
	RTRUE

	.FUNCT SAY-CONFUSED,PER,PRSO?
	CALL START-SENTENCE,PER
	PRINTI " looks confused. ""I have no idea what"
	CALL NOT-HERE-PRINT,PRSO?
	PRINTR " you're talking about!"""

	.FUNCT NOT-HERE-PRINT,PRSO?
	ZERO? P-OFLAG /?L1
	ZERO? P-XADJ /?L3
	PRINTI " "
	PRINTB P-XADJN
?L3:	ZERO? P-XNAM /?L14
	PRINTI " "
	PRINTB P-XNAM
	JUMP ?L14
?L1:	ZERO? PRSO? /?L13
	GET P-ITBL,P-NC1L >STACK
	GET P-ITBL,P-NC1 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0
	JUMP ?L14
?L13:	GET P-ITBL,P-NC2L >STACK
	GET P-ITBL,P-NC2 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0
?L14:	SET 'P-WON,0
	RETURN P-WON

	.FUNCT TELL-YOU-CANT,STR,FINISH?1=1
	PRINTI "You can't "
	PRINT STR
	ZERO? FINISH?1 /FALSE
	CRLF
	RTRUE

	.FUNCT TELL-ROPE-HIGH
	CALL TELL-CANT-REACH,STR?63 >STACK
	RSTACK

	.FUNCT TELL-CANT-REACH,STR
	CALL TELL-YOU-CANT,STR?64,0
	PRINT STR
	PRINTR "."

	.FUNCT TELL-NO-GO,PRINT?
	ZERO? PRINT? /FALSE
	CALL TELL-YOU-CANT,STR?65 >STACK
	RSTACK

	.FUNCT TELL-NO-NO
	CALL TELL-YOU-CANT,STR?66 >STACK
	RSTACK

	.FUNCT TELL-NO-AFFORD
	CALL TELL-YOU-CANT,STR?67 >STACK
	RSTACK

	.FUNCT TELL-TOO-BIG
	CALL TELL-YOU-CANT,STR?68 >STACK
	RSTACK

	.FUNCT V-VERBOSE
	SET 'VERBOSE,1
	SET 'SUPER-BRIEF,0
	PRINTI "Maximum verbosity."
	CRLF
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT V-BRIEF
	SET 'VERBOSE,0
	SET 'SUPER-BRIEF,0
	PRINTR "Brief descriptions."

	.FUNCT V-SUPER-BRIEF
	SET 'SUPER-BRIEF,1
	PRINTR "Super-brief descriptions."

	.FUNCT V-LOOK
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /FALSE
	CALL DESCRIBE-OBJECTS,1 >STACK
	RSTACK

	.FUNCT V-FIRST-LOOK
	CALL DESCRIBE-ROOM >STACK
	ZERO? STACK /FALSE
	ZERO? SUPER-BRIEF \FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT PRE-EXAMINE
	ZERO? LIT \FALSE
	FSET? PRSO,READBIT \FALSE
	CALL PERFORM,V?READ,PRSO
	RTRUE

	.FUNCT V-EXAMINE
	GETP PRSO,P?TEXT >STACK
	ZERO? STACK /?L1
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	FSET? PRSO,CONTBIT /?L6
	FSET? PRSO,DOORBIT \?L5
?L6:	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE
?L5:	PRINTI "I see nothing special about "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT DESCRIBE-ROOM,LOOK?=0,V?,STR,AV=0
	SET 'V?,LOOK?
	ZERO? V? \?L1
	SET 'V?,VERBOSE
?L1:	ZERO? LIT \?L3
	CALL TELL-TOO-DARK
	RFALSE
?L3:	FSET? HERE,TOUCHBIT /?L6
	FSET HERE,TOUCHBIT
	SET 'V?,1
?L6:	IN? HERE,ROOMS \?L9
	CALL DPRINT,HERE
	LOC WINNER >AV
	FSET? AV,VEHBIT \?L13
	PRINTI ", "
	CALL VEHPREP,AV >STACK
	PRINT STACK
	PRINTI " the "
	CALL DPRINT,AV
?L13:	CRLF
?L9:	ZERO? LOOK? \?L21
	ZERO? SUPER-BRIEF \?L28
?L21:	ZERO? V? /?L24
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \TRUE
	ZERO? V? /?L24
	GETP HERE,P?LDESC >STR
	ZERO? STR /?L24
	PRINT STR
	CRLF
?L24:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-FLASH >STACK
	ZERO? AV /?L28
	EQUAL? HERE,AV /?L28
	FSET? AV,VEHBIT \?L28
	GETP AV,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
?L28:	GETP HERE,P?CORRIDOR >STACK
	ZERO? STACK /TRUE
	CALL CORRIDOR-LOOK
	RTRUE

	.FUNCT VEHPREP,VEH
	FSET? VEH,SURFACEBIT \?L1
	RETURN STR?69
?L1:	RETURN STR?70

	.FUNCT DESCRIBE-OBJECTS,V?=0
	ZERO? LIT /?L1
	FIRST? HERE >STACK \FALSE
	ZERO? V? \?L5
	SET 'V?,VERBOSE
?L5:	CALL PRINT-CONT,HERE,V?,-1 >STACK
	RSTACK
?L1:	PRINTR "I can't see anything in the dark."

	.FUNCT DESCRIBE-OBJECT,OBJ,V?,LEVEL,STR=0,AV
	SET 'DESC-OBJECT,OBJ
	ZERO? LEVEL \?L8
	GETP OBJ,P?DESCFCN >STACK
	CALL STACK,M-OBJDESC >STACK
	ZERO? STACK \TRUE
	ZERO? LEVEL \?L8
	FSET? OBJ,TOUCHBIT /?L5
	GETP OBJ,P?FDESC >STR
	ZERO? STR \?L4
?L5:	GETP OBJ,P?LDESC >STR
	ZERO? STR /?L3
?L4:	PRINT STR
	JUMP ?L18
?L3:	ZERO? LEVEL \?L8
	PRINTI "There is "
	CALL APRINT,OBJ
	PRINTI " here."
	JUMP ?L18
?L8:	GET INDENTS,LEVEL >STACK
	PRINT STACK
	PRINTI "A"
	CALL VOWEL?,OBJ
	CALL DPRINT,OBJ
	FSET? OBJ,WORNBIT \?L18
	IN? OBJ,WINNER \?L18
	PRINTI " (being worn)"
?L18:	CRLF
	CALL SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /FALSE
	FIRST? OBJ >STACK \FALSE
	CALL PRINT-CONT,OBJ,V?,LEVEL >STACK
	RSTACK

	.FUNCT PRINT-CONT,OBJ,V?=0,LEVEL=0,Y,1ST?,AV,STR,PV?=0,INV?=0,FLG=0
	FIRST? OBJ >Y \TRUE
	LOC WINNER >AV
	ZERO? AV /?L4
	FSET? AV,VEHBIT /?L6
?L4:	SET 'AV,0
?L6:	SET '1ST?,1
	LOC OBJ >STACK
	EQUAL? WINNER,OBJ,STACK \?L7
	SET 'INV?,1
	JUMP ?L11
?L7:	ZERO? Y \?L12
?L58:	ZERO? 1ST? \?L14
	PUSH 1
	JUMP ?L11
?L14:	PUSH 0
	JUMP ?L11
?L12:	EQUAL? Y,AV \?L16
	SET 'PV?,1
	JUMP ?L24
?L16:	EQUAL? Y,WINNER /?L24
	FSET? Y,INVISIBLE /?L24
	FSET? Y,TOUCHBIT /?L24
	GETP Y,P?FDESC >STR
	ZERO? STR /?L24
	GETP Y,P?DESCFCN >STACK
	ZERO? STACK \?L24
	FSET? Y,NDESCBIT /?L19
	PRINT STR
	CRLF
	SET 'FLG,1
?L19:	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L24
	LOC Y >STACK
	GETP STACK,P?DESCFCN >STACK
	ZERO? STACK \?L24
	FIRST? Y >STACK \?L24
	CALL PRINT-CONT,Y,V?,0
?L24:	NEXT? Y >Y /?L12
	JUMP ?L58
?L11:	FIRST? OBJ >Y /?L32
?L57:	ZERO? PV? /?L34
	ZERO? AV /?L34
	FIRST? AV >STACK \?L34
	CALL PRINT-CONT,AV,V?,LEVEL
?L34:	ZERO? 1ST? \?L37
	PUSH 1
	RETURN FLG
?L37:	PUSH 0
	RETURN FLG
?L32:	EQUAL? Y,AV,ADVENTURER /?L53
	FSET? Y,INVISIBLE /?L53
	ZERO? INV? \?L41
	FSET? Y,TOUCHBIT /?L41
	GETP Y,P?DESCFCN >STACK
	ZERO? STACK \?L41
	GETP Y,P?FDESC >STACK
	ZERO? STACK \?L53
?L41:	FSET? Y,NDESCBIT /?L42
	ZERO? 1ST? /?L44
	CALL FIRSTER,OBJ,LEVEL >STACK
	ZERO? STACK /?L48
	SET 'FLG,1
	LESS? LEVEL,0 \?L48
	SET 'LEVEL,0
?L48:	INC 'LEVEL
	SET '1ST?,0
?L44:	CALL DESCRIBE-OBJECT,Y,V?,LEVEL
	JUMP ?L53
?L42:	GETP Y,P?DESCFCN >STACK
	ZERO? STACK \?L53
	FIRST? Y >STACK \?L53
	CALL SEE-INSIDE?,Y >STACK
	ZERO? STACK /?L53
	CALL PRINT-CONT,Y,V?,LEVEL
?L53:	NEXT? Y >Y /?L32
	JUMP ?L57

	.FUNCT FIRSTER,OBJ,LEVEL,F
	EQUAL? OBJ,WINNER \?L1
	PRINTR "You are carrying:"
?L1:	IN? OBJ,ROOMS /FALSE
	GRTR? LEVEL,0 \?L6
	GET INDENTS,LEVEL >STACK
	PRINT STACK
?L6:	EQUAL? OBJ,MAGNET \?L11
	PRINTI "The "
	CALL DPRINT,OBJ
	PRINTI " is touching"
	JUMP ?L26
?L11:	FSET? OBJ,SURFACEBIT \?L15
	PRINTI "Sitting on the "
	CALL DPRINT,OBJ
	FIRST? OBJ >F /?L18
?L18:	NEXT? F >STACK \?L19
	PRINTI " are"
	JUMP ?L26
?L19:	PRINTI " is"
	JUMP ?L26
?L15:	PRINTI "The "
	CALL DPRINT,OBJ
	PRINTI " contains"
?L26:	PRINTR ":"

	.FUNCT RATING-UPD,NUM
	ADD BASE-RATING,NUM >BASE-RATING
	ADD RATING,NUM >RATING
	RTRUE

	.FUNCT RATING-OBJ,OBJ,TEMP
	GETP OBJ,P?VALUE >STACK
	ZERO? STACK /TRUE
	GETP OBJ,P?VALUE >TEMP
	GRTR? TEMP,0 \FALSE
	CALL RATING-UPD,TEMP
	PUTP OBJ,P?VALUE,0
	RTRUE

	.FUNCT V-SCORE,ASK?=1
	PRINTI "Your score is "
	PRINTN RATING
	PRINTI " out of a possible "
	PRINTN RATING-MAX
	PRINTI "."
	CRLF
	PRINTI "This score gives you the rank of a "
	GRTR? RATING,245 \?L7
	PRINTI "rich diver"
	JUMP ?L20
?L7:	GRTR? RATING,190 \?L11
	PRINTI "good adventurer"
	JUMP ?L20
?L11:	GRTR? RATING,125 \?L14
	PRINTI "decent diver"
	JUMP ?L20
?L14:	GRTR? RATING,45 \?L17
	PRINTI "so-so sailor"
	JUMP ?L20
?L17:	PRINTI "chicken of the sea"
?L20:	PRINTI "."
	CRLF
	RETURN RATING

	.FUNCT FINISH
	CRLF
	CALL V-SCORE
	USL
	CRLF
?L1:	PRINTI "[EVENT: GAME OVER]Would you like to restart the game from the beginning, restore a saved game position, or end this session of the game? (Type RESTART, RESTORE, or QUIT): >"
	READ P-INBUF,P-LEXV
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?RESTART \?L5
	RESTART
?L5:	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?RESTORE \?L7
	RESTORE \?L8
	CALL TELL-OKAY
	JUMP ?L1
?L8:	CALL TELL-FAILED
	JUMP ?L1
?L7:	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?QUIT,W?Q \?L1
	QUIT

	.FUNCT V-QUIT,ASK?=1,SCOR
	CALL V-SCORE
	ZERO? ASK? /?L3
	PRINTI "Do you wish to leave the game? (Y is affirmative): "
	CALL YES? >STACK
	ZERO? STACK \?L3
	ZERO? ASK? \?L1
?L3:	USL
	QUIT
?L1:	CALL TELL-OKAY >STACK
	RSTACK

	.FUNCT YES?
	PRINTI ">"
	READ Y-INBUF,Y-LEXV
	GET Y-LEXV,1 >STACK
	EQUAL? STACK,W?YES,W?Y \FALSE
	RTRUE

	.FUNCT V-VERSION,CNT=17,V
	GET 0,1 >STACK
	BAND STACK,2047 >V
	PRINTI "CUTTHROATS
Infocom interactive fiction - an adventure story
Copyright (c) 1984 by Infocom, Inc. All rights reserved.
"
	PRINTI "CUTTHROATS is a registered trademark of Infocom, Inc.
Release "
	PRINTN V
	PRINTI " / Serial number "
?L5:	IGRTR? 'CNT,23 /?L6
	GETB 0,CNT >STACK
	PRINTC STACK
	JUMP ?L5
?L6:	CRLF
	RTRUE

	.FUNCT V-AGAIN,OBJ,N=0
	EQUAL? L-PRSO,NOT-HERE-OBJECT \?L1
	ZERO? P-MOBY-FOUND /?L1
	SET 'N,1
	SET 'L-PRSO,P-MOBY-FOUND
	JUMP ?L3
?L1:	EQUAL? L-PRSI,NOT-HERE-OBJECT \?L3
	ZERO? P-MOBY-FOUND /?L3
	SET 'N,1
	SET 'L-PRSI,P-MOBY-FOUND
?L3:	ZERO? L-PRSA \?L5
	PRINTR "Not until you do something."
?L5:	EQUAL? L-PRSA,V?WALK,V?FOLLOW \?L9
	CALL PERFORM,L-PRSA,L-PRSO >STACK
	RSTACK
?L9:	ZERO? L-PRSO /?L11
	CALL VISIBLE?,L-PRSO >STACK
	ZERO? STACK \?L11
	SET 'OBJ,L-PRSO
	JUMP ?L12
?L11:	ZERO? L-PRSI /?L13
	CALL VISIBLE?,L-PRSI >STACK
	ZERO? STACK \?L13
	SET 'OBJ,L-PRSI
	JUMP ?L12
?L13:	SET 'OBJ,0
?L12:	EQUAL? OBJ,0,ROOMS /?L15
	ZERO? N /?L17
	CALL TELL-YOU-CANT,STR?71,0
	EQUAL? OBJ,WEASEL /?L19
	PRINTI "any "
?L19:	CALL DPRINT,OBJ
	PRINTI " here."
	CRLF
	JUMP ?L26
?L17:	PRINTI "I can't see "
	CALL THE?,OBJ
	CALL DPRINT,OBJ
	PRINTI " anymore."
	CRLF
?L26:	SET 'CLOCK-WAIT,1
	RETURN 2
?L15:	EQUAL? L-WINNER,PLAYER /?L36
	CALL CONTACT-ESTABLISHED >STACK
	EQUAL? STACK,M-FATAL /FALSE
?L36:	SET 'P-WALK-DIR,L-WALK-DIR
	SET 'P-MERGED,1
	SET 'P-MULT,0
	CALL PERFORM,L-PRSA,L-PRSO,L-PRSI >N
	ZERO? N \?L37
	SET 'N,1
?L37:	SET 'P-MERGED,0
	RETURN N

	.FUNCT CONTACT-ESTABLISHED,OCONT,V
	SET 'OCONT,P-CONT
	SET 'P-CONT,1
	SET 'P-MERGED,1
	CALL PERFORM,V?TELL,L-WINNER >V
	SET 'P-CONT,OCONT
	SET 'P-MERGED,0
	RETURN V

	.FUNCT JIGS-UP,DESC,PLAYER?=0
	PRINT DESC
	CRLF
	PRINTI " 
   ****  You have died  **** 

"
	PRINTI "Too bad."
	CRLF
	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT V-RESTORE
	RESTORE \?L1
	CALL TELL-OKAY
	CALL V-FIRST-LOOK >STACK
	RSTACK
?L1:	CALL TELL-FAILED >STACK
	RSTACK

	.FUNCT TELL-FAILED
	PRINTR "Failed."

	.FUNCT TELL-OKAY
	PRINTR "Okay."

	.FUNCT V-SAVE
	SAVE \?L1
	CALL TELL-OKAY >STACK
	RSTACK
?L1:	CALL TELL-FAILED >STACK
	RSTACK

	.FUNCT V-RESTART
	CALL V-SCORE,1
	PRINTI "Do you wish to restart? (Y is affirmative): "
	CALL YES? >STACK
	ZERO? STACK /FALSE
	PRINTI "Restarting."
	CRLF
	RESTART

	.FUNCT V-WALK-AROUND
	CALL TELL-SHD-DIR >STACK
	RSTACK

	.FUNCT V-LAUNCH
	PRINTR "How does one launch that?"

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	ZERO? P-WALK-DIR \?L1
	CALL PERFORM,V?WALK-TO,PRSO
	RTRUE
?L1:	GETPT HERE,PRSO >PT
	ZERO? PT /?L3
	PTSIZE PT >PTS
	EQUAL? PTS,UEXIT \?L4
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L4:	EQUAL? PTS,NEXIT \?L6
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN 2
?L6:	EQUAL? PTS,FEXIT \?L11
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L12
	CALL GOTO,RM >STACK
	RSTACK
?L12:	RETURN 2
?L11:	EQUAL? PTS,CEXIT \?L17
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L18
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L18:	GET PT,CEXITSTR >STR
	ZERO? STR /?L20
	PRINT STR
	CRLF
	RETURN 2
?L20:	CALL TELL-NO-GO,1
	RETURN 2
?L17:	EQUAL? PTS,DEXIT \FALSE
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L29
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L29:	GET PT,DEXITSTR >STR
	ZERO? STR /?L31
	PRINT STR
	CRLF
	SET 'P-IT-OBJECT,OBJ
	RETURN 2
?L31:	CALL TELL-CLOSED,OBJ,0
	SET 'P-IT-OBJECT,OBJ
	RETURN 2
?L3:	ZERO? LIT \?L40
	RANDOM 100 >STACK
	GRTR? 90,STACK \?L40
	CALL PRINT-ID,STR?72
	CALL JIGS-UP,STR?73 >STACK
	RSTACK
?L40:	CALL TELL-NO-GO,1
	RETURN 2

	.FUNCT V-INVENTORY
	FIRST? WINNER >STACK \?L1
	CALL PRINT-CONT,WINNER
	JUMP ?L3
?L1:	PRINTI "You are empty-handed."
	CRLF
?L3:	EQUAL? WINNER,PLAYER \FALSE
	GRTR? POCKET-CHANGE,0 \FALSE
	FSET? WET-SUIT,WORNBIT /FALSE
	FSET? DEEP-SUIT,WORNBIT /FALSE
	PRINTI "You have $"
	PRINTN POCKET-CHANGE
	PRINTR " in your pocket."

	.FUNCT PRE-TAKE
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSO,OCEAN \?L3
	EQUAL? PRSI,GLASS-CASE /FALSE
?L3:	EQUAL? PRSI,GLOBAL-ROOM \?L4
	CALL TELL-YOURE-NOT,STR?74
	RTRUE
?L4:	EQUAL? PRSO,RIDICULOUS-MONEY-KLUDGE,GLOBAL-MONEY /?L6
	EQUAL? PRSO,INTNUM \?L5
	ZERO? P-DOLLAR-FLAG /?L5
?L6:	CALL TELL-NOT-EASY
	RTRUE
?L5:	IN? PRSO,MAGNET \?L7
	EQUAL? PRSI,0,MAGNET /FALSE
?L7:	IN? PRSO,WINNER \?L10
	FSET? PRSO,WORNBIT \?L12
	GET P-VTBL,0 >STACK
	EQUAL? STACK,W?REMOVE \?L14
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L14:	PRINTR "You are already wearing it."
?L12:	CALL TELL-YOU-ALREADY,STR?75 >STACK
	RSTACK
?L10:	LOC PRSO >STACK
	FSET? STACK,CONTBIT \?L20
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L20
	EQUAL? PRSO,PUTTY /FALSE
	CALL TELL-CANT-REACH,STR?76
	RTRUE
?L20:	ZERO? PRSI /?L24
	LOC PRSO >STACK
	EQUAL? PRSI,STACK /?L25
	EQUAL? PRSO,NOT-HERE-OBJECT \?L27
	FSET? PRSI,CONTBIT \?L27
	FSET? PRSI,OPENBIT /?L27
	CALL TELL-YOUD-BETTER,STR?77,0,0
	CALL DPRINT,PRSI
	PRINTI " first."
	CRLF
	SET 'P-IT-OBJECT,PRSI
	RTRUE
?L27:	EQUAL? PRSO,PRSI \?L31
	CALL TELL-SERIOUS >STACK
	RSTACK
?L31:	FSET? PRSI,VICBIT \?L32
	CALL PERFORM,V?ASK-FOR,PRSI,PRSO
	RTRUE
?L32:	EQUAL? PRSO,RIDICULOUS-MONEY-KLUDGE,GLOBAL-MONEY /?L34
	EQUAL? PRSO,INTNUM \?L33
	ZERO? P-DOLLAR-FLAG /?L33
?L34:	EQUAL? PRSI,POCKET \?L33
	CALL TELL-WHY-BOTHER >STACK
	RSTACK
?L33:	EQUAL? PRSO,AIR \?L35
	EQUAL? PRSI,AIR-TANK \?L35
	CALL PERFORM,V?EMPTY,AIR-TANK
	RTRUE
?L35:	CALL START-SENTENCE,PRSO
	PRINTI " isn't in "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR "."
?L25:	SET 'PRSI,0
	RFALSE
?L24:	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	PRINTI "You are "
	LOC WINNER >STACK
	CALL VEHPREP,STACK >STACK
	PRINT STACK
	PRINTR " it, loser!"

	.FUNCT TELL-YOURE-NOT,STR,DONE?=1
	PRINTI "You're not "
	PRINT STR
	ZERO? DONE? /FALSE
	CRLF
	RTRUE

	.FUNCT TELL-NOT-EASY
	PRINTR "It's not that easy."

	.FUNCT V-TAKE
	CALL ITAKE >STACK
	ZERO? STACK /FALSE
	PRINTI "Taken."
	CRLF
	CALL IS-THEFT? >STACK
	CALL PRINT-ID,STR?78,STACK >STACK
	RSTACK

	.FUNCT ITAKE,VB=1,CNT,OBJ,TEMP,?TMP
	FSET? PRSO,TAKEBIT /?L1
	ZERO? VB /FALSE
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RFALSE
?L1:	EQUAL? PRSO,ENVELOPE \?L8
	EQUAL? HERE,MCGINTY-HQ \?L8
	IN? MCGINTY,MCGINTY-HQ \?L8
	SET 'TEMP,PRSA
	SET 'PRSA,V?TAKE
	CALL ENVELOPE-F
	SET 'PRSA,TEMP
	RFALSE
?L8:	LOC PRSO >STACK
	IN? STACK,WINNER /?L9
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,WINNER >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,LOAD-ALLOWED \?L9
	ZERO? VB /FALSE
	PRINTI "Your load is too heavy."
	CRLF
	RFALSE
?L9:	CALL CCOUNT,WINNER >CNT
	GRTR? CNT,FUMBLE-NUMBER \?L15
	PRINTI "You're carrying too many things already!"
	CRLF
	RFALSE
?L15:	EQUAL? PRSO,MINE \?L18
	CALL BOOM >STACK
	RSTACK
?L18:	MOVE PRSO,WINNER
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	CALL RATING-OBJ,PRSO
	RTRUE

	.FUNCT V-PUT-ACROSS
	CALL TELL-NO-NO >STACK
	RSTACK

	.FUNCT V-PUT-ON
	FSET? PRSI,SURFACEBIT \?L1
	CALL V-PUT
	RTRUE
?L1:	EQUAL? PRSI,ME \?L3
	PRINTR "Sounds kinky."
?L3:	FSET? PRSI,VICBIT \?L6
	PRINTR "I don't think he'd appreciate it."
?L6:	PRINTI "There's no good surface on "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR "."

	.FUNCT PRE-PUT,OBJ
	ZERO? PRSI \?L1
	PRINTR "Huh?"
?L1:	EQUAL? PRSO,MAGNET,GLOBAL-SELF,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSI,OCEAN \?L6
	CALL PERFORM,V?THROW,PRSO,OCEAN
	RTRUE
?L6:	EQUAL? PRSA,V?PUT \?L7
	EQUAL? PRSO,ME \?L7
	CALL PERFORM,V?WEAR,PRSI
	RTRUE
?L7:	EQUAL? PRSA,V?PUT-ON \?L8
	EQUAL? PRSI,ME \?L8
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L8:	EQUAL? PRSO,RIDICULOUS-MONEY-KLUDGE,GLOBAL-MONEY /?L10
	ZERO? P-DOLLAR-FLAG /?L9
	EQUAL? PRSO,INTNUM \?L9
?L10:	EQUAL? PRSI,POCKET /FALSE
	CALL TELL-YOU-CANT,STR?14 >STACK
	RSTACK
?L9:	EQUAL? PRSO,AIR-HOSE \?L14
	EQUAL? PRSI,DEEP-SUIT /FALSE
?L14:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L15
	CALL TELL-DONT-HAVE,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."
?L15:	IN? PRSO,GLOBAL-OBJECTS /?L19
	FSET? PRSO,TAKEBIT /FALSE
?L19:	PRINTR "Nice try."

	.FUNCT V-PUT,?TMP
	FSET? PRSI,OPENBIT /?L5
	FSET? PRSI,DOORBIT /?L4
	FSET? PRSI,CONTBIT /?L4
	FSET? PRSI,VEHBIT /?L4
	CALL TELL-NO-NO
	RTRUE
?L4:	FSET? PRSI,OPENBIT /?L5
	PRINTI "The "
	CALL DPRINT,PRSI
	PRINTR " isn't open."
?L5:	EQUAL? PRSI,PRSO \?L9
	CALL TELL-HOW-THAT,STR?23 >STACK
	RSTACK
?L9:	IN? PRSO,PRSI \?L10
	CALL START-SENTENCE,PRSO
	PRINTI " is already in "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR "."
?L10:	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \?L15
	PRINTR "There's no room."
?L15:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L18
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
?L18:	MOVE PRSO,PRSI
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,WORNBIT
	PRINTR "Done."

	.FUNCT PRE-DROP
	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE

	.FUNCT PRE-GIVE,?TMP
	ZERO? PRSI \?L1
	PRINTR "Huh?"
?L1:	EQUAL? PRSO,ME,NOT-HERE-OBJECT /FALSE
	FSET? PRSI,VICBIT /?L6
	PRINTI "To "
	CALL APRINT,PRSI
	PRINTR "???"
?L6:	EQUAL? WINNER,PLAYER \?L9
	EQUAL? PRSI,ME \?L9
	ZERO? QCONTEXT /?L9
	EQUAL? HERE,QCONTEXT-ROOM \?L9
	SET '?TMP,HERE
	CALL META-LOC,QCONTEXT >STACK
	EQUAL? ?TMP,STACK \?L9
	SET 'WINNER,QCONTEXT
	CALL PERFORM,V?GIVE,PRSO,PRSI
	SET 'WINNER,PLAYER
	RTRUE
?L9:	EQUAL? PRSI,WINNER /?L11
	EQUAL? WINNER,PLAYER \?L10
	EQUAL? PRSI,ME \?L10
?L11:	CALL TELL-CHARITY >STACK
	RSTACK
?L10:	EQUAL? PRSO,INTNUM,RIDICULOUS-MONEY-KLUDGE,GLOBAL-MONEY /FALSE
	EQUAL? PRSO,DRINKING-WATER \?L13
	EQUAL? HERE,SHANTY \?L13
	EQUAL? PRSI,SPEAR-CARRIER /FALSE
?L13:	EQUAL? PRSO,DRINK-OBJECT \?L14
	IN? DRINK-OBJECT,TABLE-OBJECT /FALSE
?L14:	CALL HELD?,PRSO >STACK
	ZERO? STACK \FALSE
	EQUAL? WINNER,PLAYER \?L16
	PRINTR "That's easy for you to say since you don't even have it."
?L16:	PRINTI """I don't have "
	CALL APRINT,PRSO
	PRINTI " to give!"" exclaims "
	CALL THE?,WINNER
	CALL DPRINT,WINNER
	PRINTR "."

	.FUNCT TELL-CHARITY
	PRINTR "I know charity begins at home, but this is ridiculous."

	.FUNCT PRE-SGIVE
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT HELD?,OBJ
	ZERO? OBJ /FALSE
	IN? OBJ,WINNER /TRUE
	EQUAL? OBJ,ME,GLOBAL-SELF /TRUE
	LOC OBJ >STACK
	CALL HELD?,STACK >STACK
	RSTACK

	.FUNCT V-GIVE
	EQUAL? PRSI,SPEAR-CARRIER \?L1
	EQUAL? PRSO,INTNUM \?L1
	ZERO? P-DOLLAR-FLAG /?L1
	PRINTR """If you want to buy something, be specific."""
?L1:	FSET? PRSI,VICBIT \?L5
	CALL START-SENTENCE,PRSI
	PRINTR " declines your generous offer."
?L5:	CALL TELL-YOU-CANT,STR?79,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI " to "
	CALL APRINT,PRSI
	PRINTR "!"

	.FUNCT V-SGIVE
	PRINTR "Bug."

	.FUNCT V-DROP,SUPPRESS=0
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	ZERO? SUPPRESS \FALSE
	PRINTR "Dropped."

	.FUNCT PRE-THROW
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	IN? PRSO,WINNER /FALSE
	CALL TELL-YOURE-NOT,STR?80,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT V-THROW
	ZERO? PRSI /?L12
	FSET? PRSI,CONTBIT /?L5
	FSET? PRSI,CLIMBBIT \?L3
?L5:	CALL PERFORM,V?PUT,PRSO,PRSI
	RTRUE
?L3:	EQUAL? PRSI,ME \?L6
	PRINTR "You'd probably miss."
?L6:	EQUAL? PRSI,FIELD \?L9
	CALL START-SENTENCE,PRSO
	PRINTI " bounces off the weeds."
	CRLF
	JUMP ?L12
?L9:	CALL START-SENTENCE,PRSI
	FSET? PRSI,VICBIT \?L13
	PRINTI " ducks"
	JUMP ?L17
?L13:	PRINTI " doesn't duck"
?L17:	PRINTI " as the "
	CALL DPRINT,PRSO
	PRINTI " flies by."
	CRLF
?L12:	CALL IDROP
	ZERO? PRSI \TRUE
	PRINTR "Thrown."

	.FUNCT IDROP,?TMP
	IN? PRSO,WINNER /?L5
	LOC PRSO >STACK
	IN? STACK,WINNER /?L1
	CALL TELL-YOURE-NOT,STR?80,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI "."
	CRLF
	RFALSE
?L1:	IN? PRSO,WINNER /?L5
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L5
	LOC PRSO >STACK
	CALL TELL-CLOSED,STACK,0
	RFALSE
?L5:	LOC PLAYER >STACK
	FSET? STACK,VEHBIT \?L7
	IN? PLAYER,BED /?L7
	SET '?TMP,PRSO
	CALL META-LOC,PLAYER >STACK
	MOVE ?TMP,STACK
	JUMP ?L9
?L7:	LOC WINNER >STACK
	MOVE PRSO,STACK
?L9:	FCLEAR PRSO,WORNBIT
	EQUAL? PRSO,SAFETY-LINE \TRUE
	CALL QUEUE,I-PENDULUM,3 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT PRE-OPEN
	ZERO? PRSI /FALSE
	FSET? PRSI,TOOLBIT /FALSE
	CALL PRE-BURN >STACK
	RSTACK

	.FUNCT V-OPEN,F,STR
	FSET? PRSO,CONTBIT /?L1
	CALL SAY-MUST-TELL >STACK
	RSTACK
?L1:	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L3
	FSET? PRSO,OPENBIT \?L4
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L4:	FSET PRSO,OPENBIT
	FIRST? PRSO >STACK /?L7
	PRINTR "Opened."
?L7:	FIRST? PRSO >F \?L11
	NEXT? F >STACK /?L11
	GETP F,P?FDESC >STR
	ZERO? STR /?L11
	CALL TELL-OPENS
	PRINT STR
	CRLF
	RTRUE
?L11:	PRINTI "Opening the "
	CALL DPRINT,PRSO
	PRINTI " reveals "
	CALL PRINT-CONTENTS,PRSO
	PRINTR "."
?L3:	FSET? PRSO,DOORBIT \?L19
	FSET? PRSO,OPENBIT \?L20
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L20:	CALL TELL-OPENS
	FSET PRSO,OPENBIT
	RTRUE
?L19:	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " fails to open."

	.FUNCT TELL-OPENS
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " opens."

	.FUNCT SAY-MUST-TELL
	PRINTI "You must tell me how to do that to "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT PRINT-CONTENTS,OBJ,F,N,1ST?=1,2ND=0
	FIRST? OBJ >F \FALSE
	NEXT? F >STACK /?L3
	SET 'P-IT-OBJECT,F
?L3:	NEXT? F >N /?L8
?L8:	ZERO? 1ST? /?L9
	SET '1ST?,0
	SET '2ND,1
	JUMP ?L20
?L9:	ZERO? N \?L14
	ZERO? 2ND \?L12
?L14:	SET '2ND,0
	PRINTI ","
?L12:	PRINTI " "
	ZERO? N \?L20
	PRINTI "and "
?L20:	CALL APRINT,F
	SET 'F,N
	ZERO? F \?L3
	RTRUE

	.FUNCT V-ASK-ABOUT
	EQUAL? PRSO,ME,PLAYER \?L1
	CALL TELL-NO-INFO >STACK
	RSTACK
?L1:	FSET? PRSO,VICBIT /?L3
	CALL SUDDENLY-REALIZE-TALKING,PRSO
	RTRUE
?L3:	PRINTI "After a moment's thought, "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR " disavows any knowledge of that."

	.FUNCT SUDDENLY-REALIZE-TALKING,OBJ
	PRINTI "You suddenly realize that you're talking to "
	CALL APRINT,OBJ
	PRINTR "."

	.FUNCT TELL-NO-INFO
	PRINTI "You find that you can provide "
	CALL DPRINT,GLOBAL-SELF
	PRINTR " with no new information."

	.FUNCT PRE-ASK-CONTEXT-ABOUT,P,?TMP
	ZERO? QCONTEXT /FALSE
	EQUAL? HERE,QCONTEXT-ROOM \FALSE
	SET '?TMP,HERE
	CALL META-LOC,QCONTEXT >STACK
	EQUAL? ?TMP,STACK \FALSE
	PRINTI "(said to "
	CALL DPRINT,QCONTEXT
	PRINTI ")"
	CRLF
	CALL PERFORM,V?ASK-ABOUT,QCONTEXT,PRSO
	RTRUE

	.FUNCT V-ASK-CONTEXT-ABOUT
	CALL V-ASK-CONTEXT-FOR >STACK
	RSTACK

	.FUNCT V-ASK-FOR
	EQUAL? PRSO,ME,PLAYER \?L1
	CALL TELL-NO-INFO >STACK
	RSTACK
?L1:	FSET? PRSO,VICBIT \?L3
	EQUAL? PRSO,PLAYER \?L4
	IN? PRSI,PLAYER \?L6
	CALL TELL-YOU-ALREADY,STR?75 >STACK
	RSTACK
?L6:	CALL TELL-DONT-HAVE,STR?34 >STACK
	RSTACK
?L4:	EQUAL? PRSI,RIDICULOUS-MONEY-KLUDGE,GLOBAL-MONEY,KNIFE /?L10
	EQUAL? PRSI,INTNUM \?L9
	ZERO? P-DOLLAR-FLAG /?L9
?L10:	CALL START-SENTENCE,PRSO
	PRINTR " refuses."
?L9:	EQUAL? PRSO,SPEAR-CARRIER \?L13
	GETP PRSI,P?NORTH >STACK
	GRTR? STACK,0 \?L13
	CALL TELL-CHARITY >STACK
	RSTACK
?L13:	CALL START-SENTENCE,PRSO
	IN? PRSI,PRSO \?L15
	PRINTI " hands you the "
	CALL DPRINT,PRSI
	PRINTI "."
	CRLF
	MOVE PRSI,WINNER
	RTRUE
?L15:	PRINTR " doesn't have that."
?L3:	CALL SUDDENLY-REALIZE-TALKING,PRSO >STACK
	RSTACK

	.FUNCT PRE-ASK-CONTEXT-FOR,P,?TMP
	ZERO? QCONTEXT /FALSE
	EQUAL? HERE,QCONTEXT-ROOM \FALSE
	SET '?TMP,HERE
	CALL META-LOC,QCONTEXT >STACK
	EQUAL? ?TMP,STACK \FALSE
	PRINTI "(said to "
	CALL DPRINT,QCONTEXT
	PRINTI ")"
	CRLF
	CALL PERFORM,V?ASK-FOR,QCONTEXT,PRSO
	RTRUE

	.FUNCT V-ASK-CONTEXT-FOR
	CALL TELL-YOURE-NOT,STR?81 >STACK
	RSTACK

	.FUNCT V-CALL
	FSET? PRSO,PERSON \?L1
	CALL PERFORM,V?$0024CALL,PRSO
	RTRUE
?L1:	FSET? PRSO,VICBIT \?L3
	SET 'QCONTEXT,PRSO
	SET 'QCONTEXT-ROOM,HERE
	PRINTI "The "
	CALL DPRINT,PRSO
	CALL TELL-LISTENING >STACK
	RSTACK
?L3:	PRINTR "There's no response."

	.FUNCT V-CALL-LOSE
	SET 'CLOCK-WAIT,1
	PRINTR "You must use a verb!"

	.FUNCT PRE-$0024CALL
	EQUAL? PRSO,INTDIR \?L1
	CALL PERFORM,V?WALK,P-WALK-DIR
	RTRUE
?L1:	FSET? PRSO,VICBIT /FALSE
	CALL V-CALL-LOSE >STACK
	RSTACK

	.FUNCT V-$0024CALL,MOT=0
	EQUAL? PRSO,PLAYER,ME \?L1
	CALL V-CALL-LOSE >STACK
	RSTACK
?L1:	FSET? PRSO,PERSON \?L3
	CALL IN-MOTION?,PRSO >STACK
	ZERO? STACK /?L4
	SET 'MOT,1
?L4:	CALL META-LOC,PRSO >STACK
	EQUAL? STACK,HERE /?L9
	CALL CORRIDOR-LOOK,PRSO >STACK
	ZERO? STACK /?L7
?L9:	CALL START-SENTENCE,PRSO
	CALL GRAB-ATTENTION,PRSO >STACK
	ZERO? STACK /?L10
	FSET PRSO,TOUCHBIT
	CALL META-LOC,PRSO >QCONTEXT-ROOM
	ZERO? MOT /?L12
	PRINTR " stops and turns toward you."
?L12:	CALL TELL-LISTENING >STACK
	RSTACK
?L10:	PRINTR " ignores you."
?L7:	PRINTI "You don't see "
	CALL DPRINT,PRSO
	PRINTR " here."
?L3:	EQUAL? PRSO,SPEAR-CARRIER \?L23
	IN? SPEAR-CARRIER,HERE \?L23
	SET 'QCONTEXT,SPEAR-CARRIER
	SET 'QCONTEXT-ROOM,HERE
	PRINTI "The "
	CALL DPRINT,PRSO
	CALL TELL-LISTENING >STACK
	RSTACK
?L23:	CALL V-CALL-LOSE >STACK
	RSTACK

	.FUNCT TELL-LISTENING
	PRINTR " is listening."

	.FUNCT V-CLOSE
	FSET? PRSO,CONTBIT /?L1
	CALL SAY-MUST-TELL >STACK
	RSTACK
?L1:	FSET? PRSO,SURFACEBIT /?L3
	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L3
	FSET? PRSO,OPENBIT \?L4
	FCLEAR PRSO,OPENBIT
	PRINTR "Closed."
?L4:	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK
?L3:	FSET? PRSO,DOORBIT \?L9
	FSET? PRSO,OPENBIT \?L10
	CALL TELL-NOW,PRSO,STR?45
	FCLEAR PRSO,OPENBIT
	RTRUE
?L10:	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK
?L9:	CALL TELL-YOU-CANT,STR?82 >STACK
	RSTACK

	.FUNCT CCOUNT,OBJ,CNT=0,X
	FIRST? OBJ >X \?L4
?L3:	FSET? X,WORNBIT /?L5
	INC 'CNT
?L5:	NEXT? X >X /?L3
?L4:	RETURN CNT

	.FUNCT WEIGHT,OBJ,CONT,WT=0
	FIRST? OBJ >CONT \?L4
?L3:	EQUAL? OBJ,WINNER \?L5
	FSET? CONT,WEARBIT \?L5
	INC 'WT
	JUMP ?L7
?L5:	CALL WEIGHT,CONT >STACK
	ADD WT,STACK >WT
?L7:	NEXT? CONT >CONT /?L3
?L4:	GETP OBJ,P?SIZE >STACK
	ADD WT,STACK >STACK
	RSTACK

	.FUNCT V-BREATHE
	EQUAL? PRSO,0,AIR /?L1
	PRINTR "Stick to air."
?L1:	PRINTR "If you stop breathing, I'll let you know."

	.FUNCT V-SCRIPT
	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	PRINTI "Here begins"
	PRINT COPR-NOTICE
	CRLF
	RTRUE

	.FUNCT V-UNSCRIPT
	PRINTI "Here ends"
	PRINT COPR-NOTICE
	CRLF
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT PRE-MOVE
	EQUAL? PRSO,SAFETY-LINE /FALSE
	IN? PLAYER,PRSO \?L3
	CALL TELL-CONTORT >STACK
	RSTACK
?L3:	CALL HELD?,PRSO >STACK
	ZERO? STACK /FALSE
	PRINTR "I don't juggle objects!"

	.FUNCT V-MOVE
	FSET? PRSO,TAKEBIT \?L1
	PRINTI "Moving the "
	CALL DPRINT,PRSO
	PRINTR " reveals nothing."
?L1:	FSET? PRSO,PUSHBIT \?L5
	CALL TELL-MOVES-BIT >STACK
	RSTACK
?L5:	CALL TELL-YOU-CANT,STR?83,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT V-LAMP-ON
	FSET? PRSO,VICBIT \?L1
	PRINTR "Restrain yourself."
?L1:	CALL TELL-YOU-CANT,STR?84 >STACK
	RSTACK

	.FUNCT V-LAMP-OFF
	CALL TELL-YOU-CANT,STR?85 >STACK
	RSTACK

	.FUNCT TELL-PASSES
	PRINTR "Time passes..."

	.FUNCT V-WAIT,NUM=10,NOT-INT?=1,WHO=0,INTERRUPTED=0
	ZERO? NOT-INT? /?L3
	CALL TELL-PASSES
	GRTR? I-WAIT-DURATION,0 /FALSE
?L3:	DLESS? 'NUM,0 /?L8
	CALL CLOCKER >STACK
	ZERO? STACK /?L11
	SET 'INTERRUPTED,1
	JUMP ?L8
?L11:	ZERO? WHO /?L3
	IN? WHO,HERE \?L3
	SET 'INTERRUPTED,1
?L8:	ZERO? NOT-INT? /?L14
	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT
?L14:	RETURN INTERRUPTED

	.FUNCT V-WAIT-FOR
	EQUAL? PRSO,INTNUM \?L1
	GRTR? P-NUMBER,180 \?L3
	PRINTR "That's too long to wait."
?L3:	CALL V-WAIT,P-NUMBER >STACK
	RSTACK
?L1:	EQUAL? PRSO,PLAYER,ME \?L8
	PRINTR "You're already here!"
?L8:	FSET? PRSO,PERSON /?L12
	EQUAL? PRSO,DELIVERY-BOY \?L11
?L12:	IN? PRSO,HERE \?L13
	PRINTR "He's already here!"
?L13:	CALL TELL-PASSES
?L18:	CALL V-WAIT,30,0,PRSO >STACK
	ZERO? STACK /?L22
	IN? PRSO,HERE \?L22
	FSET PRSO,TOUCHBIT
	CALL START-SENTENCE,PRSO
	PRINTI ", for whom you were waiting, has arrived."
	CRLF
	SET 'P-IT-OBJECT,PRSO
	JUMP ?L19
?L22:	CALL START-SENTENCE,PRSO
	PRINTI " isn't here yet. Do you want to keep waiting? (YES or NO?)"
	CALL YES? >STACK
	ZERO? STACK \?L18
	PRINTI "If you say so..."
	CRLF
?L19:	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT
?L11:	FSET? PRSO,VICBIT \?L35
	PRINTR "I don't think he's going anywhere."
?L35:	PRINTR "Why? It's not going anywhere."

	.FUNCT PRE-BOARD,AV
	LOC WINNER >AV
	FSET? PRSO,VEHBIT \?L1
	FSET? AV,VEHBIT \FALSE
	PRINTI "You are already "
	CALL VEHPREP,AV >STACK
	PRINT STACK
	PRINTI " the "
	CALL DPRINT,AV
	PRINTI "!"
	CRLF
	RETURN 2
?L1:	FSET? PRSO,WEARBIT \?L8
	CALL PERFORM,V?WEAR,PRSO
	RETURN 2
?L8:	EQUAL? PRSO,FIELD,CLOSET,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSO,BACK-WINDOW,REDS-BUNK,OCEAN /FALSE
	PRINTI "I suppose you have a theory on getting into "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI "."
	CRLF
	RETURN 2

	.FUNCT V-BOARD
	PRINTI "You are now "
	CALL VEHPREP,PRSO >STACK
	PRINT STACK
	PRINTI " the "
	CALL DPRINT,PRSO
	PRINTI "."
	CRLF
	MOVE WINNER,PRSO
	RTRUE

	.FUNCT V-DISEMBARK
	FSET? PRSO,WORNBIT \?L1
	CALL UNWEAR
	RTRUE
?L1:	LOC WINNER >STACK
	EQUAL? STACK,PRSO /?L3
	CALL TELL-YOURE-NOT,STR?86
	RETURN 2
?L3:	FSET? HERE,RLANDBIT \?L6
	ZERO? STOOD-UP \?L7
	PRINTI "You get out of bed."
	CRLF
	SET 'STOOD-UP,1
	JUMP ?L11
?L7:	PRINTI "You are on your feet again."
	CRLF
?L11:	MOVE WINNER,HERE
	RTRUE
?L6:	PRINTI "A bad idea."
	CRLF
	RETURN 2

	.FUNCT PRE-BUY
	EQUAL? PRSO,DRINKING-WATER /FALSE
	FSET? WET-SUIT,WORNBIT /?L3
	FSET? DEEP-SUIT,WORNBIT \FALSE
?L3:	CALL TELL-YOU-CANT,STR?87 >STACK
	RSTACK

	.FUNCT V-BUY,RENT=0,COST,?TMP
	IN? PRSO,ROOMS /?L1
	GETP PRSO,P?NORTH >COST
	ZERO? COST /?L1
	GRTR? COST,0 \?L1
	CALL ENABLED?,I-EQUIP >STACK
	ZERO? STACK /?L3
	IN? MCGINTY,OUTFITTERS-HQ /?L3
	PRINTR "The salesman is too busy with Johnny right now."
?L3:	FSET? PRSO,RENTBIT \?L7
	ZERO? RENT \?L7
	PRINTR "That's not for sale, but you might try renting it."
?L7:	GRTR? COST,POCKET-CHANGE \?L10
	CALL TELL-NO-AFFORD >STACK
	RSTACK
?L10:	SUB POCKET-CHANGE,COST >POCKET-CHANGE
	PUTP PRSO,P?NORTH,-1
	ZERO? JOHNNY-MADE-DEAL /?L12
	ZERO? DELIVERY-MADE \?L12
	FSET PRSO,TRYTAKEBIT
	PUT DELIVERY-TABLE,DT-PTR,PRSO
	ADD DT-PTR,2 >DT-PTR
	JUMP ?L18
?L12:	FSET PRSO,TAKEBIT
	FCLEAR PRSO,NDESCBIT
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,WINNER >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,LOAD-ALLOWED /?L17
	CALL CCOUNT,WINNER >STACK
	GRTR? STACK,FUMBLE-NUMBER \?L15
?L17:	MOVE PRSO,GLOBAL-SURFACE
	JUMP ?L18
?L15:	MOVE PRSO,WINNER
?L18:	PRINTI "You have "
	CALL PRINT-ID,STR?88
	ZERO? RENT /?L21
	PRINTI "rented"
	JUMP ?L25
?L21:	PRINTI "purchased"
?L25:	PRINTI " "
	CALL APRINT,PRSO
	PRINTI " for $"
	PRINTN COST
	IN? PRSO,GLOBAL-SURFACE \?L30
	PRINTI ". Since you can't currently carry it, the salesman leaves it on the counter"
?L30:	PRINTR "."
?L1:	EQUAL? COST,-1 \?L37
	FSET? PRSO,RENTBIT \?L38
	PRINTR "You've already rented it."
?L38:	CALL TELL-ONLY-ONCE,STR?89 >STACK
	RSTACK
?L37:	EQUAL? PRSO,DRINKING-WATER \?L43
	EQUAL? HERE,MM-GALLEY,NW-GALLEY \?L44
	PRINTI "Get it "
	CALL DPRINT,GLOBAL-SELF
	PRINTR "."
?L44:	CALL PERFORM,V?ASK-FOR,SPEAR-CARRIER,DRINKING-WATER
	SET 'P-IT-OBJECT,DRINKING-WATER
	RTRUE
?L43:	PRINTR "That's not for sale."

	.FUNCT TELL-ONLY-ONCE,STR
	PRINTI "You only "
	PRINT STR
	PRINTR " it once."

	.FUNCT V-RENT,COST
	IN? PRSO,ROOMS /?L1
	GETP PRSO,P?NORTH >COST
	ZERO? COST /?L1
	GRTR? COST,0 \?L1
	FSET? PRSO,RENTBIT /?L3
	PRINTR "That's not available for rental. You might try buying it."
?L3:	CALL V-BUY,1 >STACK
	RSTACK
?L1:	EQUAL? COST,-1 \?L8
	FSET? PRSO,RENTBIT \?L9
	CALL TELL-ONLY-ONCE,STR?90 >STACK
	RSTACK
?L9:	CALL TELL-YOU-ALREADY,STR?91 >STACK
	RSTACK
?L8:	CALL TELL-YOU-CANT,STR?92 >STACK
	RSTACK

	.FUNCT GOTO,RM,V?=1,LB,WLOC,AV=0,OLIT,F,N
	FSET? RM,RLANDBIT /?L1
	SET 'LB,0
	JUMP ?L2
?L1:	SET 'LB,1
?L2:	LOC WINNER >WLOC
	SET 'OLIT,LIT
	FSET? WLOC,VEHBIT \?L3
	CALL TELL-YOUD-BETTER,STR?93,0,0
	FSET? WLOC,SURFACEBIT \?L5
	PRINTI "off"
	JUMP ?L9
?L5:	PRINTI "out"
?L9:	PRINTI " of the "
	CALL DPRINT,WLOC
	PRINTI " first."
	CRLF
	RETURN 2
?L3:	MOVE WINNER,RM
	SET 'HERE,RM
	CALL LIT?,HERE >LIT
	ZERO? OLIT \?L19
	ZERO? LIT \?L19
	RANDOM 100 >STACK
	GRTR? 90,STACK \?L19
	CALL PRINT-ID,STR?94
	CALL JIGS-UP,STR?95
?L19:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	CALL RATING-OBJ,RM
	EQUAL? HERE,RM \TRUE
	EQUAL? ADVENTURER,WINNER /?L24
	CALL START-SENTENCE,WINNER
	PRINTI " leaves the room."
	CRLF
	RETURN 2
?L24:	ZERO? V? /TRUE
	CALL V-FIRST-LOOK
	IN? MAGNET,PLAYER \TRUE
	ZERO? MAGNET-ON /?L32
	CALL ATTRACTION
	RTRUE
?L32:	FIRST? MAGNET >F \TRUE
	MOVE F,WLOC
	RTRUE

	.FUNCT V-BACK
	PRINTI "Sorry, my memory isn't that good. "
	CALL TELL-SHD-DIR >STACK
	RSTACK

	.FUNCT POURABLE?,OBJ
	EQUAL? OBJ,DRINKING-WATER,DRINK-OBJECT \FALSE
	RTRUE

	.FUNCT V-POUR
	EQUAL? PRSO,OCEAN \?L1
	CALL TELL-YOURE-NOT,STR?96 >STACK
	RSTACK
?L1:	CALL POURABLE?,PRSO >STACK
	ZERO? STACK \?L3
	CALL TELL-YOU-CANT,STR?97
	RTRUE
?L3:	EQUAL? HERE,SHANTY \?L4
	IN? PRSO,TABLE-OBJECT /?L4
	CALL TELL-BUY-FIRST >STACK
	RSTACK
?L4:	MOVE PRSO,HERE
	FSET PRSO,NDESCBIT
	PRINTI "It evaporates immediately."
	CRLF
	EQUAL? PRSO,DRINKING-WATER,DRINK-OBJECT /?L8
	PUSH 0
	JUMP ?L9
?L8:	PUSH 1
?L9:	CALL PRINT-ID,STR?98,STACK >STACK
	RSTACK

	.FUNCT V-POUR-IN,L
	CALL POURABLE?,PRSO >STACK
	ZERO? STACK \?L1
	PRINTI "I don't think you can pour "
	CALL APRINT,PRSO
	PRINTI "."
	RTRUE
?L1:	FSET? PRSI,CONTBIT /?L5
	PRINTI "You'd have a lot of trouble pouring the "
	CALL DPRINT,PRSO
	PRINTI " into "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR "."
?L5:	CALL TELL-WHY-BOTHER >STACK
	RSTACK

	.FUNCT V-POUR-ON
	CALL POURABLE?,PRSO >STACK
	ZERO? STACK /?L1
	CALL TELL-WHY-BOTHER >STACK
	RSTACK
?L1:	CALL TELL-YOU-CANT,STR?97 >STACK
	RSTACK

	.FUNCT V-SHOW
	ZERO? PRSI \?L1
	PRINTR "Huh?"
?L1:	EQUAL? PRSI,ME,PLAYER \?L5
	PRINTI "Do you often talk to "
	CALL DPRINT,GLOBAL-SELF
	PRINTR "?"
?L5:	FSET? PRSI,VICBIT /?L8
	PRINTI "Don't wait for "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR " to applaud."
?L8:	EQUAL? PRSI,PRSO \?L13
	PRINTR "He's already aware of his own presence."
?L13:	PRINTI "Although "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR " takes a look, he seems disinterested."

	.FUNCT PRE-SSHOW
	SET 'P-MERGED,1
	CALL PERFORM,V?SHOW,PRSI,PRSO
	RTRUE

	.FUNCT V-SSHOW
	PRINTI "Bug."
	RTRUE

	.FUNCT V-SPRAY
	CALL V-SQUEEZE >STACK
	RSTACK

	.FUNCT V-SSPRAY
	CALL PERFORM,V?SPRAY,PRSI,PRSO >STACK
	RSTACK

	.FUNCT V-SQUEEZE
	PRINTR "How singularly useless."

	.FUNCT V-OIL
	PRINTI "That's not very useful."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?99,STACK >STACK
	RSTACK

	.FUNCT V-FILL
	CALL TELL-NO-NO >STACK
	RSTACK

	.FUNCT PRE-DRILL
	ZERO? PRSI \?L1
	SET 'PRSI,DRILL
?L1:	EQUAL? PRSI,DRILL /?L4
	CALL PRE-BURN >STACK
	RSTACK
?L4:	IN? DRILL,PLAYER /FALSE
	CALL TELL-YOURE-NOT,STR?100 >STACK
	RSTACK

	.FUNCT V-DRILL
	CALL TELL-YOU-CANT,STR?101 >STACK
	RSTACK

	.FUNCT PRE-DRILL-IN
	IN? DRILL,PLAYER /?L1
	PRINTR "A drill might help."
?L1:	EQUAL? PRSO,HOLE-2,HOLE-1,HOLE /?L6
	EQUAL? PRSO,CEILING-HOLE-2,CEILING-HOLE-1,JAGGED-HOLE /?L6
	EQUAL? PRSO,FLOOR-HOLE-2,FLOOR-HOLE-1 \?L5
?L6:	PRINTI "(with the "
	CALL DPRINT,DRILL
	PRINTI ")"
	CRLF
	CALL PERFORM,V?DRILL,PRSI,DRILL
	RTRUE
?L5:	SET 'CLOCK-WAIT,1
	PRINTR "I can't figure out what you mean."

	.FUNCT V-DRILL-IN
	PRINTR "Bug."

	.FUNCT PRE-DRINK
	EQUAL? WINNER,PLAYER /?L1
	PRINTR """I'm not thirsty."""
?L1:	FSET? PRSO,DRINKBIT \?L5
	FSET? DEEP-SUIT,WORNBIT \?L6
	CALL TELL-IN-WAY >STACK
	RSTACK
?L6:	FSET? MASK,WORNBIT \FALSE
	CALL TELL-IN-WAY,0 >STACK
	RSTACK
?L5:	CALL TELL-YOU-CANT,STR?102 >STACK
	RSTACK

	.FUNCT V-DRINK
	PRINTI "I don't think "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI " would go down very well."
	CRLF
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?103,STACK >STACK
	RSTACK

	.FUNCT TELL-IN-WAY,HOOD?=1
	PRINTI "The "
	ZERO? HOOD? /?L3
	PRINTI "hood"
	JUMP ?L7
?L3:	CALL DPRINT,MASK
?L7:	PRINTR " would get in the way."

	.FUNCT PRE-EAT
	EQUAL? WINNER,PLAYER /?L1
	PRINTR """I'm not hungry."""
?L1:	ZERO? SOUPS-ON /?L5
	FSET? PRSO,FOODBIT \?L5
	FSET? DEEP-SUIT,WORNBIT \?L6
	CALL TELL-IN-WAY >STACK
	RSTACK
?L6:	FSET? MASK,WORNBIT \FALSE
	CALL TELL-IN-WAY,0 >STACK
	RSTACK
?L5:	EQUAL? HERE,SHANTY \?L10
	FSET? PRSO,FOODBIT \?L10
	PRINTR "You'll have to buy it first."
?L10:	FSET? PRSO,DRINKBIT \FALSE
	PRINTR "Try drinking it."

	.FUNCT V-EAT
	FSET? PRSO,PERSON \?L1
	PRINTI "Cannibalism isn't a good idea. Especially when you're more likely to be the dinner than the diner."
	CRLF
	CALL PRINT-ID,STR?104 >STACK
	RSTACK
?L1:	PRINTI "I don't think that "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI " would agree with you."
	CRLF
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?105,STACK >STACK
	RSTACK

	.FUNCT V-CURSES
	ZERO? PRSO /?L1
	FSET? PRSO,VICBIT \?L3
	PRINTR "Insults of this nature won't help you."
?L3:	PRINTI "And to think that "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR " never said anything bad about you..."
?L1:	PRINTR "You really don't have to swear like a sailor."

	.FUNCT V-LISTEN
	FSET? PRSO,VICBIT \?L1
	PRINTI "If "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR " says anything useful, I'll let you know."
?L1:	CALL START-SENTENCE,PRSO
	PRINTR " makes no sound."

	.FUNCT V-FOLLOW,CN,CHR,COR,PCOR,L
	SET 'L-PRSO,PRSO
	SET 'L-PRSA,PRSA
	EQUAL? WINNER,PLAYER /?L1
	CALL TELL-FREE-WILL
	RETURN 2
?L1:	EQUAL? PRSO,PLAYER \?L5
	PRINTR "It's not clear whom you're talking to."
?L5:	FSET? PRSO,PERSON /?L8
	EQUAL? PRSO,DELIVERY-BOY /?L8
	PRINTR "That doesn't sound very exciting."
?L8:	LOC PRSO >L
	EQUAL? HERE,L \?L11
	PRINTI "You're in the same place as "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "!"
?L11:	GETP HERE,P?CORRIDOR >COR
	ZERO? COR /?L16
	GETP L,P?CORRIDOR >PCOR
	ZERO? PCOR /?L16
	BAND COR,PCOR >STACK
	ZERO? STACK /?L16
	CALL COR-DIR,HERE,L >PRSO
	SET 'P-WALK-DIR,PRSO
	CALL V-WALK >STACK
	RSTACK
?L16:	IN? PRSO,FERRY \?L17
	CALL TELL-CANT-BOARD >STACK
	RSTACK
?L17:	PRINTI "You seem to have lost track of "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT TELL-FREE-WILL
	PRINTR """I'll go where I want!"""

	.FUNCT V-STAY
	EQUAL? WINNER,PLAYER \?L1
	PRINTR "I'm not going anywhere."
?L1:	CALL TELL-FREE-WILL
	RETURN 2

	.FUNCT V-PRAY
	PRINTR "If you pray enough, your prayers may be answered."

	.FUNCT V-LEAP,Z,S
	EQUAL? PRSO,0,INTDIR /?L1
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L1:	GETPT HERE,P?DOWN >Z
	ZERO? Z /?L3
	PTSIZE Z >S
	EQUAL? S,2 /?L6
	EQUAL? S,4 \?L4
	GETB Z,1 >STACK
	VALUE STACK >STACK
	ZERO? STACK \?L4
?L6:	CALL PRINT-ID,STR?106
	CALL JIGS-UP,STR?107 >STACK
	RSTACK
?L4:	CALL V-SKIP >STACK
	RSTACK
?L3:	CALL V-SKIP >STACK
	RSTACK

	.FUNCT V-SKIP
	LOC PLAYER >STACK
	FSET? STACK,VEHBIT \?L1
	PRINTR "That would be tough from your current position."
?L1:	CALL PICK-ONE,WHEEEEE >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-LEAVE
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-HELLO
	ZERO? PRSO /?L1
	CALL TELL-NO-RESPONSE >STACK
	RSTACK
?L1:	CALL PICK-ONE,HELLOS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-GOODBYE
	CALL V-HELLO >STACK
	RSTACK

	.FUNCT TELL-NO-RESPONSE
	CALL START-SENTENCE,PRSO
	PRINTR " fails to respond."

	.FUNCT PRE-READ
	ZERO? LIT \?L1
	PRINTR "It is impossible to read in the dark."
?L1:	ZERO? PRSI /FALSE
	PRINTI "How does one look through "
	CALL APRINT,PRSI
	PRINTR "?"

	.FUNCT V-READ
	FSET? PRSO,READBIT /?L1
	PRINTI "How can I read "
	CALL APRINT,PRSO
	PRINTR "?"
?L1:	FSET PRSO,TOUCHBIT
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-LOOK-UNDER
	FSET? PRSO,VICBIT \?L1
	PRINTR "His feet are on the floor."
?L1:	EQUAL? PRSO,LIGHTHOUSE,DRINK-OBJECT,FOOD /?L6
	EQUAL? PRSO,OCEAN,GROUND,CLOSET \?L5
?L6:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L5:	IN? PRSO,PLAYER \?L9
	PRINTR "You have it."
?L9:	CALL TELL-NOTHING,STR?108
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L13
	PRINTI "seaweed"
	JUMP ?L21
?L13:	EQUAL? PRSO,FERRY,SALVAGER,TRAWLER /?L18
	EQUAL? PRSO,GLOBAL-FERRY \?L17
?L18:	PRINTI "water"
	JUMP ?L21
?L17:	PRINTI "dust"
?L21:	PRINTR " there."

	.FUNCT V-LOOK-BEHIND
	CALL TELL-NOTHING,STR?109
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT TELL-NOTHING,STR,DONE?=0
	PRINTI "There's nothing "
	PRINT STR
	ZERO? DONE? /FALSE
	PRINTR "."

	.FUNCT PRE-LOOK-IN
	FSET? PRSO,SURFACEBIT \FALSE
	PRINTR "It's solid."

	.FUNCT PRE-LOOK-ON
	FSET? PRSO,CONTBIT \FALSE
	FSET? PRSO,SURFACEBIT /FALSE
	CALL TELL-NOTHING,STR?110
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT V-LOOK-INSIDE,REACH?=0,?TMP
	FSET? PRSO,DOORBIT \?L1
	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTI " is "
	FSET? PRSO,OPENBIT \?L5
	PRINTI "open, but you can't tell what's beyond it"
	JUMP ?L9
?L5:	PRINTI "closed"
?L9:	PRINTR "."
?L1:	FSET? PRSO,CONTBIT \?L14
	FSET? PRSO,VICBIT \?L15
	CALL TELL-NOTHING,STR?111
	ZERO? REACH? /?L17
	PRINTI "felt"
	JUMP ?L21
?L17:	PRINTI "seen"
?L21:	PRINTR "."
?L15:	CALL SEE-INSIDE?,PRSO >STACK
	ZERO? STACK /?L26
	FIRST? PRSO >STACK \?L27
	CALL PRINT-CONT,PRSO >STACK
	ZERO? STACK \TRUE
?L27:	FSET? PRSO,WORNBIT \?L29
	PRINTR "You're wearing it."
?L29:	FSET? PRSO,SURFACEBIT \?L32
	IN? WINNER,PRSO \?L33
	PRINTR "You're on it!"
?L33:	CALL TELL-NOTHING,STR?112
	CALL DPRINT,PRSO
	PRINTR "."
?L32:	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " is empty."
?L26:	CALL TELL-CLOSED,PRSO,0 >STACK
	RSTACK
?L14:	PRINTI "I don't know how to do that."
	CRLF
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L48
	PUSH ?TMP
	JUMP ?L47
?L48:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L47:	CALL PRINT-ID,STR?113,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?114,STACK >STACK
	RSTACK

	.FUNCT SEE-INSIDE?,OBJ
	FSET? OBJ,INVISIBLE /FALSE
	FSET? OBJ,OPENBIT /TRUE
	FSET? OBJ,TRANSBIT /TRUE
	RFALSE

	.FUNCT PRE-BURN
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?115,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?116,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?117,STACK
	ZERO? PRSI \?L1
	PRINTR "Huh?"
?L1:	PRINTI "With "
	CALL APRINT,PRSI
	PRINTR "??!?"

	.FUNCT V-BURN
	CALL TELL-NO-NO
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?118,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?119,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?120,STACK >STACK
	RSTACK

	.FUNCT PRE-TURN
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSO,PSEUDO-OBJECT \?L3
	EQUAL? HERE,MM-WHEELHOUSE,NW-WHEELHOUSE /FALSE
?L3:	FSET? PRSO,TURNBIT /?L4
	CALL TELL-WHY-BOTHER >STACK
	RSTACK
?L4:	ZERO? PRSI /FALSE
	EQUAL? PRSI,INTDIR \FALSE
	CALL TELL-YOU-CANT,STR?121 >STACK
	RSTACK

	.FUNCT V-TURN
	CALL TELL-NO-EFFECT >STACK
	RSTACK

	.FUNCT TELL-NO-EFFECT
	PRINTR "This has no effect."

	.FUNCT V-PUMP
	PRINTR "I really don't see how."

	.FUNCT V-INFLATE
	CALL TELL-HOW-THAT,STR?122 >STACK
	RSTACK

	.FUNCT V-DEFLATE
	PRINTR "Come on, now!"

	.FUNCT V-LOCK
	PRINTR "It doesn't seem to work."

	.FUNCT V-PICK
	CALL TELL-YOU-CANT,STR?123
	CALL PRIVATE-DOOR? >STACK
	CALL PRINT-ID,STR?124,STACK >STACK
	RSTACK

	.FUNCT PRE-UNLOCK
	EQUAL? PRSO,SAFE /FALSE
	ZERO? PRSI \FALSE
	IN? KEY,PLAYER \FALSE
	SET 'PRSI,KEY
	PRINTI "(with the room key)"
	CRLF
	RFALSE

	.FUNCT V-UNLOCK
	FSET? PRSO,DOORBIT \?L1
	PRINTR "It's not locked."
?L1:	CALL V-LOCK >STACK
	RSTACK

	.FUNCT V-CUT,?TMP
	ZERO? PRSI \?L1
	PRINTR "Huh?"
?L1:	FSET? PRSI,WEAPONBIT /?L5
	PRINTI "Not with "
	CALL APRINT,PRSI
	PRINTR "!"
?L5:	FSET? PRSO,VICBIT /?L9
	EQUAL? PRSO,SQUID \?L8
?L9:	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L11
	PUSH ?TMP
	JUMP ?L10
?L11:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L10:	CALL PRINT-ID,STR?125,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?126,STACK
	CALL IKILL,STR?127 >STACK
	RSTACK
?L8:	PRINTI "Strange concept, cutting "
	CALL APRINT,PRSO
	PRINTI "..."
	CRLF
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L16
	PUSH ?TMP
	JUMP ?L15
?L16:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L15:	CALL PRINT-ID,STR?128,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?129,STACK >STACK
	RSTACK

	.FUNCT V-KILL
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?130,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?131,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?132,STACK
	CALL IKILL,STR?133 >STACK
	RSTACK

	.FUNCT IKILL,STR
	ZERO? PRSO \?L1
	CALL TELL-NOTHING,STR?134
	PRINT STR
	PRINTR "."
?L1:	EQUAL? PRSO,SQUID \?L5
	CALL PRINT-ID,STR?135
	CALL JIGS-UP,STR?136 >STACK
	RSTACK
?L5:	FSET? PRSO,VICBIT /?L6
	PRINTI "I've known strange people, but fighting "
	CALL APRINT,PRSO
	PRINTR "?"
?L6:	ZERO? PRSI /?L10
	EQUAL? PRSI,GLOBAL-SELF,ME \?L9
?L10:	PRINTI "Trying to "
	PRINT STR
	PRINTI " "
	CALL APRINT,PRSO
	PRINTR " with your bare hands is suicidal."
?L9:	IN? PRSI,WINNER /?L13
	PRINTI "You aren't even holding "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR "."
?L13:	FSET? PRSI,WEAPONBIT /?L18
	PRINTI "Trying to "
	PRINT STR
	PRINTI " "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI " with "
	CALL APRINT,PRSI
	PRINTR " is suicidal."
?L18:	CALL TELL-NOT-SMART >STACK
	RSTACK

	.FUNCT V-ATTACK
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?137,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?138,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?139,STACK
	CALL IKILL,STR?140 >STACK
	RSTACK

	.FUNCT V-SWING
	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L1
	CALL TELL-YOURE-NOT,STR?141 >STACK
	RSTACK
?L1:	PRINTI "Whoosh!"
	CRLF
	FSET? PRSO,WEAPONBIT /?L7
	PUSH 0
	JUMP ?L6
?L7:	CALL IS-PERSON-PRSI? >STACK
?L6:	CALL PRINT-ID,STR?142,STACK
	FSET? PRSO,WEAPONBIT /?L9
	PUSH 0
	JUMP ?L8
?L9:	CALL IS-OBJECT-OR-PROPERTY? >STACK
?L8:	CALL PRINT-ID,STR?143,STACK
	FSET? PRSO,WEAPONBIT /?L11
	PUSH 0
	JUMP ?L10
?L11:	CALL IS-SELF? >STACK
?L10:	CALL PRINT-ID,STR?144,STACK >STACK
	RSTACK

	.FUNCT V-KICK,?TMP
	CALL IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L1:	CALL PRINT-ID,STR?145,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?146,STACK
	FSET? PRSO,PERSON \?L3
	CALL TELL-NOT-SMART >STACK
	RSTACK
?L3:	CALL HACK-HACK,STR?147 >STACK
	RSTACK

	.FUNCT TELL-NOT-SMART
	PRINTR "That wouldn't be too smart."

	.FUNCT V-WAVE
	CALL HACK-HACK,STR?148 >STACK
	RSTACK

	.FUNCT V-WAVE-AT
	ZERO? PRSO /?L1
	FSET? PRSO,VICBIT \?L1
	CALL START-SENTENCE,PRSO
	PRINTR " acknowledges your greeting."
?L1:	CALL TELL-NO-RESPONSE >STACK
	RSTACK

	.FUNCT V-LOWER
	CALL HACK-HACK,STR?149 >STACK
	RSTACK

	.FUNCT V-RUB
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?150,STACK
	FSET? PRSO,PERSON \?L1
	CALL TELL-HANDS-OFF >STACK
	RSTACK
?L1:	CALL HACK-HACK,STR?151 >STACK
	RSTACK

	.FUNCT TELL-HANDS-OFF
	PRINTR """Get your hands off me!"""

	.FUNCT V-PUSH
	FSET? PRSO,PERSON \?L1
	CALL TELL-HANDS-OFF >STACK
	RSTACK
?L1:	IN? WINNER,PRSO \?L3
	CALL TELL-CONTORT >STACK
	RSTACK
?L3:	FSET? PRSO,PUSHBIT \?L4
	CALL TELL-MOVES-BIT >STACK
	RSTACK
?L4:	CALL HACK-HACK,STR?152 >STACK
	RSTACK

	.FUNCT TELL-MOVES-BIT
	CALL START-SENTENCE,PRSO
	PRINTR " moves a bit."

	.FUNCT V-PUSH-OFF
	FSET? PRSI,SURFACEBIT \?L1
	IN? PRSO,PRSI \?L1
	LOC PRSI >STACK
	MOVE PRSO,STACK
	CALL TELL-NOW,PRSO,STR?153 >STACK
	RSTACK
?L1:	PRINTI "A ludicrous idea at best."
	CRLF
	CALL IS-PERSON? >STACK
	ZERO? STACK \?L7
	PUSH 0
	JUMP ?L9
?L7:	EQUAL? PRSI,POINT-LOOKOUT,TRAWLER,FERRY /?L8
	EQUAL? PRSI,RAILING,SALVAGER /?L8
	PUSH 0
	JUMP ?L9
?L8:	PUSH 1
?L9:	CALL PRINT-ID,STR?154,STACK >STACK
	RSTACK

	.FUNCT V-PUSH-TO,FALLEN=0,OH,F
	IN? WINNER,PRSO \?L1
	CALL TELL-CONTORT >STACK
	RSTACK
?L1:	FSET? PRSO,PUSHBIT /?L3
	FSET? PRSO,TAKEBIT \?L4
	PRINTR "There's no need for that. Why not just pick it up and then carry it there?"
?L4:	EQUAL? PRSO,ME \?L8
	PRINTR "Do it yourself."
?L8:	FSET? PRSO,VICBIT \?L11
	CALL TELL-HANDS-OFF >STACK
	RSTACK
?L11:	PRINTI "You push and strain, but can't budge "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."
?L3:	EQUAL? PRSI,INTDIR /?L17
	CALL TELL-YOU-CANT,STR?155
	RTRUE
?L17:	SET 'OH,HERE
	ZERO? OH /FALSE
	CALL DO-WALK,P-WALK-DIR >STACK
	EQUAL? STACK,M-FATAL /FALSE
?L19:	FIRST? PRSO >F \?L20
	MOVE F,OH
	SET 'FALLEN,1
	JUMP ?L19
?L20:	MOVE PRSO,HERE
	FSET PRSO,TOUCHBIT
	PRINTI "You bring the "
	CALL DPRINT,PRSO
	PRINTI " along with you."
	ZERO? FALLEN /?L26
	CALL TELL-ALL-FALL
?L26:	CRLF
	RTRUE

	.FUNCT TELL-CONTORT
	PRINTR "That would require some impressive contortions."

	.FUNCT TELL-ALL-FALL
	PRINTI " Everything that was on it falls off."
	RTRUE

	.FUNCT PRE-CHIP
	GET P-VTBL,0 >STACK
	EQUAL? STACK,W?CHIP \?L1
	IN? SPEAR-CARRIER,HERE \?L1
	EQUAL? PRSO,INTNUM \?L1
	ZERO? P-DOLLAR-FLAG /?L1
	CALL PERFORM,V?GIVE,PRSO,SPEAR-CARRIER
	RTRUE
?L1:	CALL PERFORM,V?MUNG,PRSO
	RTRUE

	.FUNCT V-CHIP
	PRINTR "Bug."

	.FUNCT PRE-MUNG
	EQUAL? PRSO,WINNER,ME,NOT-HERE-OBJECT /FALSE
	EQUAL? PRSO,MIRROR,GLOBAL-BANK,ADVENTURER /FALSE
	ZERO? PRSI /?L4
	FSET? PRSI,WEAPONBIT /FALSE
?L4:	FSET? PRSO,VICBIT /?L5
	EQUAL? PRSO,SQUID /?L5
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?156,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?157,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?158,STACK
	CALL HACK-HACK,STR?159
	RTRUE
?L5:	PRINTI "Trying to destroy "
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?160,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?161,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?162,STACK
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI " with "
	ZERO? PRSI \?L11
	PRINTI "your bare hands is suicidal"
	JUMP ?L15
?L11:	CALL APRINT,PRSI
	PRINTI " is insane"
?L15:	PRINTR "."

	.FUNCT V-MUNG
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?163,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?164,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?165,STACK
	FSET? PRSO,VICBIT /?L3
	EQUAL? PRSO,SQUID \?L1
?L3:	CALL IKILL,STR?140 >STACK
	RSTACK
?L1:	PRINTR "Nothing much happens."

	.FUNCT HACK-HACK,STR
	IN? PRSO,GLOBAL-OBJECTS \?L1
	EQUAL? PRSA,V?LOWER,V?WAVE \?L1
	PRINTI "Unfortunately, "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR " isn't here."
?L1:	PRINT STR
	PRINTI " "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	CALL PICK-ONE,HO-HUM >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-KNOCK
	FSET? PRSO,DOORBIT \?L1
	CALL TELL-NO-ANSWER >STACK
	RSTACK
?L1:	PRINTI "Why knock on "
	CALL APRINT,PRSO
	PRINTR "?"

	.FUNCT V-CHOMP
	PRINTI "I don't know how to do that. I win in all cases!"
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?166,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?167,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?168,STACK >STACK
	RSTACK

	.FUNCT V-WIN
	PRINTR "Naturally!"

	.FUNCT V-YELL
	CALL PRINT-ID,STR?169
	ZERO? PRSO /?L1
	PRINTR "You could be more polite and lower your voice."
?L1:	PRINTR "Aarrrrrgggggggghhhhhhhhhhh!"

	.FUNCT V-PLUG
	CALL TELL-NO-EFFECT >STACK
	RSTACK

	.FUNCT V-LATITUDE,LAT=1,STR,NEW=0
	ZERO? LAT /?L1
	SET 'STR,STR?170
	JUMP ?L3
?L1:	SET 'STR,STR?171
?L3:	EQUAL? WINNER,PLAYER \?L4
	PRINTI "Why don't you tell someone who cares?"
	CRLF
	RETURN 2
?L4:	LESS? MEETINGS-COMPLETED,2 \?L10
	CALL START-SENTENCE,WINNER
	PRINTI " looks bewildered. ""What does that have to do with anything?"" he asks."
	CRLF
	RETURN 2
?L10:	EQUAL? WINNER,JOHNNY /?L15
	CALL START-SENTENCE,WINNER
	PRINTI " says, ""That's nice. Why don't you let the captain know?"""
	CRLF
	RETURN 2
?L15:	EQUAL? PRSO,INTNUM /?L20
	PRINTI "Johnny looks at you strangely. ""What kind of a "
	PRINT STR
	PRINTR " is that?"""
?L20:	GRTR? P-NUMBER,59 \?L23
	PRINTR """There are 60 minutes in a degree."""
?L23:	ZERO? LAT /?L27
	ZERO? LATITUDE-SET /?L33
	EQUAL? LATITUDE-SET,P-NUMBER \?L31
	SET 'NEW,M-FATAL
	JUMP ?L33
?L31:	SET 'NEW,1
?L33:	SET 'LATITUDE-SET,P-NUMBER
	JUMP ?L35
?L27:	ZERO? LONGITUDE-SET /?L40
	EQUAL? LONGITUDE-SET,P-NUMBER \?L38
	SET 'NEW,M-FATAL
	JUMP ?L40
?L38:	SET 'NEW,1
?L40:	SET 'LONGITUDE-SET,P-NUMBER
?L35:	EQUAL? NEW,M-FATAL \?L42
	CALL TELL-YOU-ALREADY,STR?172,1 >STACK
	RSTACK
?L42:	ZERO? NEW /?L44
	PRINTI """Now the "
	PRINT STR
	PRINTI " is "
	PRINTN P-NUMBER
	PRINTR ", huh?"""
?L44:	PRINTI """Okay. The "
	PRINT STR
	PRINTI " is "
	PRINTN P-NUMBER
	PRINTR "."""

	.FUNCT V-LONGITUDE
	CALL V-LATITUDE,0 >STACK
	RSTACK

	.FUNCT V-EMPTY,X
	FSET? PRSO,CONTBIT /?L1
	CALL TELL-YOU-CANT,STR?173 >STACK
	RSTACK
?L1:	FSET? PRSO,OPENBIT /?L3
	CALL TELL-YOU-CANT,STR?174 >STACK
	RSTACK
?L3:	FIRST? PRSO >STACK \?L4
?L5:	FIRST? PRSO >X \?L6
	MOVE X,HERE
	JUMP ?L5
?L6:	CALL TELL-NOW,PRSO,STR?175 >STACK
	RSTACK
?L4:	CALL TELL-NOTHING,STR?176
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT V-SHAKE,X
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?177,STACK
	FSET? PRSO,VICBIT \?L1
	CALL TELL-NO-EFFECT >STACK
	RSTACK
?L1:	FSET? PRSO,TAKEBIT /?L3
	CALL TELL-YOU-CANT,STR?178 >STACK
	RSTACK
?L3:	FSET? PRSO,OPENBIT /?L18
	FIRST? PRSO >STACK \?L4
	PRINTI "It sounds as if there is something inside the "
	CALL DPRINT,PRSO
	PRINTR "."
?L4:	FSET? PRSO,OPENBIT \?L7
?L18:	FIRST? PRSO >STACK \?L7
?L8:	FIRST? PRSO >X \?L9
	MOVE X,HERE
	JUMP ?L8
?L9:	PRINTI "All of the objects spill onto the "
	CALL SPILL-WHERE? >STACK
	RSTACK
?L7:	CALL TELL-NOTHING,STR?176
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT SPILL-WHERE?
	IN? WINNER,BED \?L1
	PRINTR "floor by your bed."
?L1:	GETP HERE,P?LINE >STACK
	GRTR? STACK,BACK-ALLEY-LINE-C \?L5
	PRINTR "deck by your feet."
?L5:	PRINTR "floor."

	.FUNCT V-DIAGNOSE
	PRINTI "You are "
	GRTR? HOW-HUNGRY,3 \?L3
	PRINTI "extremely"
	JUMP ?L16
?L3:	ZERO? HOW-HUNGRY \?L7
	PRINTI "not"
	JUMP ?L16
?L7:	EQUAL? HOW-HUNGRY,1 \?L10
	PRINTI "a bit"
	JUMP ?L16
?L10:	EQUAL? HOW-HUNGRY,2 \?L13
	PRINTI "pretty"
	JUMP ?L16
?L13:	EQUAL? HOW-HUNGRY,3 \?L16
	PRINTI "very"
?L16:	PRINTI " hungry, "
	ZERO? HOW-THIRSTY \?L22
	PRINTI "not thirsty"
	JUMP ?L35
?L22:	EQUAL? HOW-THIRSTY,1 \?L26
	PRINTI "a little thirsty"
	JUMP ?L35
?L26:	EQUAL? HOW-THIRSTY,2 \?L29
	PRINTI "fairly thirsty"
	JUMP ?L35
?L29:	EQUAL? HOW-THIRSTY,3 \?L32
	PRINTI "very thirsty"
	JUMP ?L35
?L32:	GRTR? HOW-THIRSTY,3 \?L35
	PRINTI "utterly parched"
?L35:	PRINTI ", and "
	ZERO? HOW-TIRED \?L41
	PRINTI "half-awake"
	JUMP ?L57
?L41:	LESS? HOW-TIRED,3 \?L45
	PRINTI "wide-awake"
	JUMP ?L57
?L45:	EQUAL? HOW-TIRED,3 \?L48
	PRINTI "a bit drowsy"
	JUMP ?L57
?L48:	EQUAL? HOW-TIRED,4 \?L51
	PRINTI "fairly tired"
	JUMP ?L57
?L51:	EQUAL? HOW-TIRED,5 \?L54
	PRINTI "very sleepy"
	JUMP ?L57
?L54:	EQUAL? HOW-TIRED,6 \?L57
	PRINTI "dead on your feet"
?L57:	PRINTR "."

	.FUNCT PRE-DIG
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	ZERO? PRSI \?L3
	PRINTR "Huh?"
?L3:	FSET? PRSI,TOOLBIT /FALSE
	PRINTI "Digging with "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR " is very silly."

	.FUNCT V-AIM
	PRINTR "That would be pointless."

	.FUNCT V-DIG
	CALL TELL-YOU-CANT,STR?179 >STACK
	RSTACK

	.FUNCT PRE-SMELL
	FSET? MASK,WORNBIT /?L3
	FSET? DEEP-SUIT,WORNBIT \FALSE
?L3:	CALL TELL-YOU-CANT,STR?180 >STACK
	RSTACK

	.FUNCT V-SMELL
	FSET? PRSO,VICBIT \?L1
	PRINTR "Nothing a good deodorant couldn't fix."
?L1:	PRINTI "It smells just like "
	CALL APRINT,PRSO
	PRINTR "."

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,Z
	GETPT OBJ2,P?GLOBAL >Z
	ZERO? Z /FALSE
	PTSIZE Z >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,Z,STACK >STACK
	RSTACK

	.FUNCT V-SWIM
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L1
	EQUAL? PRSO,INTDIR \?L3
	CALL DO-WALK,P-WALK-DIR >STACK
	RSTACK
?L3:	CALL TELL-SHD-DIR >STACK
	RSTACK
?L1:	PRINTR "I think you're all wet."

	.FUNCT V-DIVE
	EQUAL? PRSO,0,OCEAN /?L1
	PRINTR "This isn't a circus!"
?L1:	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L5
	CALL DO-WALK,P?DOWN
	RTRUE
?L5:	LOC PLAYER >STACK
	CALL GLOBAL-IN?,OCEAN,STACK >STACK
	ZERO? STACK /?L6
	EQUAL? HERE,MM-WHEELHOUSE,NW-WHEELHOUSE /?L6
	GETP HERE,P?LINE >STACK
	LESS? STACK,TRAWLER-LINE-C \?L7
	EQUAL? HERE,FERRY-LANDING,WHARF /?L7
	CALL PERFORM,V?BOARD,OCEAN
	RTRUE
?L7:	FSET? DEEP-SUIT,WORNBIT /?L48
	FSET? WET-SUIT,WORNBIT \?L10
	IN? AIR-TANK,PLAYER \?L10
	FSET? MASK,WORNBIT \?L10
	FSET? FLIPPERS,WORNBIT /?L9
?L10:	CALL PRINT-ID,STR?181
	CALL JIGS-UP,STR?182 >STACK
	RSTACK
?L9:	FSET? DEEP-SUIT,WORNBIT \?L11
?L48:	IN? AIR-HOSE,DEEP-SUIT \?L12
	FSET? MM-COMPRESSOR,ONBIT /?L11
?L12:	CALL PRINT-ID,STR?183
	CALL JIGS-UP,STR?184 >STACK
	RSTACK
?L11:	ZERO? AT-SEA \?L13
	CALL PRINT-ID,STR?185
	CALL JIGS-UP,STR?186 >STACK
	RSTACK
?L13:	EQUAL? OCEAN-BOTTOM,50 \?L15
	SET 'HERE,OCEAN-FLOOR
	MOVE PLAYER,OCEAN-FLOOR
	JUMP ?L17
?L15:	MOVE PLAYER,UNDERWATER
	SET 'HERE,UNDERWATER
	CALL UNDERWATER-F,M-ENTER
?L17:	FCLEAR OCEAN,VEHBIT
	CALL INT,I-ENDIT >STACK
	PUT STACK,0,0
	SET 'DEPTH,50
	IN? PASSBOOK,PLAYER \?L18
	FSET PASSBOOK,RMUNGBIT
?L18:	IN? DIVING-BOOK,PLAYER \?L21
	FSET DIVING-BOOK,RMUNGBIT
?L21:	IN? NOTE,PLAYER \?L24
	FSET NOTE,RMUNGBIT
?L24:	IN? BOOK,PLAYER \?L27
	FSET BOOK,RMUNGBIT
?L27:	IN? ENVELOPE,PLAYER \?L30
	FSET ENVELOPE,RMUNGBIT
?L30:	IN? BATTERY,PLAYER /?L35
	IN? BATTERY,DRILL \?L33
	FSET? DRILL,OPENBIT \?L33
?L35:	FSET BATTERY,RMUNGBIT
	SET 'DRILL-POWERED,0
?L33:	IN? DRY-CELL,PLAYER /?L39
	IN? DRY-CELL,DETECTOR-COMPARTMENT \?L37
	FSET? DETECTOR-COMPARTMENT,OPENBIT \?L37
?L39:	FSET DRY-CELL,RMUNGBIT
	SET 'DETECTOR-POWERED,0
?L37:	IN? AIR-TANK,PLAYER \?L41
	FSET? DEEP-SUIT,WORNBIT /?L41
	CALL QUEUE,I-AIR-SUPPLY,-1 >STACK
	PUT STACK,0,1
	JUMP ?L44
?L41:	CALL INT,I-MM-COMPRESSOR >STACK
	GET STACK,C-TICK >STACK
	GRTR? STACK,0 \?L43
	CALL INT,I-MM-COMPRESSOR >STACK
	PUT STACK,0,1
	JUMP ?L44
?L43:	CALL INT,I-LAST-GASP >STACK
	PUT STACK,0,1
?L44:	CALL V-LOOK >STACK
	RSTACK
?L6:	PRINTR "Consulting your years of experience, you come to the conclusion that the lack of water here would make this a lousy place to try diving."

	.FUNCT V-UNTIE
	FSET? PRSO,PERSON \?L1
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	PRINTR "This cannot be tied, so it cannot be untied!"

	.FUNCT PRE-TIE
	EQUAL? PRSO,AIR-HOSE /FALSE
	EQUAL? PRSO,ROPE,SAFETY-LINE /?L3
	EQUAL? PRSI,ROPE,SAFETY-LINE /?L3
	PRINTR "Even if I knew how to do that, I wouldn't."
?L3:	EQUAL? PRSI,WINNER /?L7
	EQUAL? PRSO,WINNER \FALSE
?L7:	CALL TELL-YOU-CANT,STR?187 >STACK
	RSTACK

	.FUNCT V-TIE
	PRINTI "Don't bother."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?188,STACK >STACK
	RSTACK

	.FUNCT V-TIE-UP
	PRINTI "You could certainly never tie it with that!"
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?189,STACK >STACK
	RSTACK

	.FUNCT V-MELT
	PRINTI "I'm not sure that "
	CALL APRINT,PRSO
	PRINTI " can be melted."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?190,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?191,STACK
	CALL IS-SELF? >STACK
	CALL PRINT-ID,STR?192,STACK >STACK
	RSTACK

	.FUNCT V-MUMBLE
	PRINTR "You'll have to speak up if you expect me to hear you!"

	.FUNCT V-ALARM
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?193,STACK
	EQUAL? PRSO,ROOMS \?L4
	EQUAL? WINNER,PLAYER \?L3
?L4:	FSET? PRSO,VICBIT \?L1
	EQUAL? PRSO,ME /?L1
?L3:	PRINTR "He's wide awake, or haven't you noticed?"
?L1:	EQUAL? PRSO,ROOMS \?L7
	PRINTR "You're already awake."
?L7:	CALL START-SENTENCE,PRSO
	PRINTR " isn't sleeping."

	.FUNCT V-CLIMB-ON
	FSET? PRSO,CLIMBBIT /?L3
	FSET? PRSO,VEHBIT \?L1
?L3:	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L1:	CALL TELL-YOU-CANT,STR?194,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT V-CLIMB-FOO
	EQUAL? PRSO,ROOMS \?L1
	CALL V-CLIMB-UP >STACK
	RSTACK
?L1:	FSET? PRSO,CLIMBBIT /?L3
	FSET? PRSO,VEHBIT /?L3
	CALL TELL-YOU-CANT,STR?195,0
	CALL APRINT,PRSO
	PRINTI "!"
	CRLF
	RETURN 2
?L3:	CALL V-CLIMB-UP,P?UP,1 >STACK
	RSTACK

	.FUNCT V-CLIMB-UP,DIR=P?UP,OBJ=0,X
	GETPT HERE,DIR >STACK
	ZERO? STACK /?L1
	CALL DO-WALK,DIR
	RTRUE
?L1:	ZERO? OBJ \?L10
	CALL TELL-NO-GO,1 >STACK
	RSTACK
?L10:	GETPT PRSO,P?SYNONYM >X
	PTSIZE X >STACK
	CALL ZMEMQ,W?WALLS,X,STACK >STACK
	ZERO? STACK /?L4
	PRINTR "Climbing the walls is to no avail."
?L4:	PRINTR "Bizarre!"

	.FUNCT V-CLIMB-DOWN
	CALL V-CLIMB-UP,P?DOWN >STACK
	RSTACK

	.FUNCT V-SEND
	FSET? PRSO,VICBIT \?L1
	PRINTI "I doubt that "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR " is at your beck and call."
?L1:	PRINTR "That doesn't make sends."

	.FUNCT V-WIND
	PRINTI "You cannot wind up "
	CALL APRINT,PRSO
	PRINTR "."

	.FUNCT V-COUNT
	PRINTR "I can't deal with those numbers."

	.FUNCT PRE-BRACE
	CALL PERFORM,V?PUT-UNDER,PRSI,PRSO
	RTRUE

	.FUNCT V-BRACE
	PRINTR "Bug."

	.FUNCT V-PUT-UNDER,?TMP
	FSET? PRSI,DOORBIT \?L1
	GETP PRSO,P?SIZE >STACK
	LESS? STACK,5 \?L1
	FSET? PRSI,OPENBIT \?L3
	CALL TELL-WHY-BOTHER >STACK
	RSTACK
?L3:	CALL IDROP >STACK
	ZERO? STACK /FALSE
	SET '?TMP,PRSO
	CALL OTHER-SIDE,PRSI,1 >STACK
	MOVE ?TMP,STACK
	PRINTR "Done."
?L1:	CALL TELL-NO-NO >STACK
	RSTACK

	.FUNCT V-PUSH-UNDER
	FSET? PRSO,TAKEBIT /?L3
	FSET? PRSO,PUSHBIT \?L1
?L3:	CALL PERFORM,V?PUT-UNDER,PRSO,PRSI
	RTRUE
?L1:	CALL TELL-NO-NO >STACK
	RSTACK

	.FUNCT V-PLAY
	FSET? PRSO,VICBIT \?L1
	PRINTI "You are so engrossed in the role of "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	CALL PRINT-ID,STR?196
	CALL JIGS-UP,STR?197 >STACK
	RSTACK
?L1:	PRINTR "How peculiar!"

	.FUNCT V-MAKE
	CALL TELL-NO-NO >STACK
	RSTACK

	.FUNCT V-ENTER
	EQUAL? HERE,WINDING-ROAD-1 \?L1
	CALL PERFORM,V?THROUGH,LIGHTHOUSE
	RTRUE
?L1:	CALL DO-WALK,P?IN >STACK
	RSTACK

	.FUNCT V-EXIT
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-CROSS
	CALL TELL-YOU-CANT,STR?198 >STACK
	RSTACK

	.FUNCT V-SEARCH
	FSET? PRSO,PERSON \?L1
	CALL START-SENTENCE,PRSO
	PRINTR " glares at you. ""Get away from me!"" he growls."
?L1:	FSET? PRSO,CONTBIT \?L5
	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE
?L5:	PRINTR "You find nothing unusual."

	.FUNCT V-FIND,L
	LOC PRSO >L
	EQUAL? WINNER,PLAYER /?L1
	PRINTI """Find "
	FSET? PRSO,VICBIT \?L5
	PRINTI "him "
	JUMP ?L9
?L5:	PRINTI "it "
?L9:	CALL DPRINT,GLOBAL-SELF
	PRINTR "."""
?L1:	EQUAL? L,GLOBAL-OBJECTS \?L14
	PRINTI "Why don't you try finding it "
	CALL DPRINT,GLOBAL-SELF
	PRINTR "?"
?L14:	IN? PRSO,WINNER \?L17
	PRINTR "You have it."
?L17:	IN? PRSO,HERE /?L21
	EQUAL? PRSO,PSEUDO-OBJECT \?L20
?L21:	FSET? PRSO,VICBIT \?L22
	PRINTI "He's"
	JUMP ?L26
?L22:	PRINTI "It's"
?L26:	PRINTR " right here."
?L20:	IN? L,HERE /?L32
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK /?L31
?L32:	FSET? L,PERSON \?L33
	PRINTI "You notice that "
	CALL DPRINT,L
	PRINTR " has it."
?L33:	FSET? L,CONTBIT \?L37
	PRINTI "It's "
	CALL VEHPREP,L >STACK
	PRINT STACK
	PRINTI " the "
	CALL DPRINT,L
	PRINTR "."
?L37:	EQUAL? L,FERRY \?L40
	PRINTR "He's on the ferry."
?L40:	PRINTR "It's around here somewhere."
?L31:	PRINTI "Find "
	FSET? PRSO,VICBIT \?L49
	PRINTI "him"
	JUMP ?L53
?L49:	PRINTI "it"
?L53:	PRINTI " "
	CALL DPRINT,GLOBAL-SELF
	PRINTR "."

	.FUNCT PRE-TELL
	ZERO? PRSI /?L8
	EQUAL? PRSO,ME,PLAYER \?L1
	EQUAL? WINNER,PLAYER /?L3
	SET 'PRSA,V?ASK-ABOUT
	CALL PERFORM,V?ASK-ABOUT,WINNER,PRSI
	RTRUE
?L3:	SET 'PRSA,V?ASK-CONTEXT-ABOUT
	CALL PERFORM,V?ASK-CONTEXT-ABOUT,PRSI
	RTRUE
?L1:	ZERO? PRSI \FALSE
?L8:	FSET? PRSO,VICBIT /FALSE
	CALL TELL-NO-TELL >STACK
	RSTACK

	.FUNCT V-TELL
	ZERO? PRSI /?L1
	FSET? PRSO,PERSON \?L3
	CALL START-SENTENCE,PRSO
	PRINTR " seems less than impressed with this information."
?L3:	FSET? PRSO,VICBIT /?L8
	EQUAL? PRSO,SQUID \?L7
?L8:	PRINTI "The "
	CALL DPRINT,PRSO
	PRINTR " ignores what you have to say."
?L7:	CALL TELL-NO-RESPONSE >STACK
	RSTACK
?L1:	EQUAL? WINNER,PLAYER \?L12
	EQUAL? PRSO,ME,WINNER \?L12
	PRINTI "Talking to "
	CALL DPRINT,GLOBAL-SELF
	PRINTI " is diverting, but unnecessary."
	CRLF
	RETURN 2
?L12:	EQUAL? PRSO,PLAYER,ME \?L17
	PRINTI """What in the world are you trying to say?"""
	CRLF
	RETURN 2
?L17:	FSET? PRSO,VICBIT \?L22
	CALL META-LOC,PRSO >STACK
	EQUAL? STACK,HERE /?L23
	CALL GLOBAL-NOT-HERE-PRINT,PRSO
	RETURN 2
?L23:	EQUAL? WINNER,PLAYER /?L27
	ZERO? P-CONT \?L27
	PRINTI """I'll talk to whoever I want."""
	CRLF
	RETURN 2
?L27:	SET 'WINNER,PRSO
	CALL META-LOC,WINNER >HERE
	SET 'QCONTEXT,WINNER
	SET 'QCONTEXT-ROOM,HERE
	ZERO? P-CONT \FALSE
	CALL START-SENTENCE,PRSO
	PRINTI " turns and looks at you as though he thought you were about to say something."
	CRLF
	RETURN 2
?L22:	CALL TELL-NO-TELL >STACK
	RSTACK

	.FUNCT TELL-NO-TELL
	CALL TELL-YOU-CANT,STR?199,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI "!"
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	RETURN 2

	.FUNCT V-KISS
	PRINTI "I'd sooner kiss a parrot."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?200,STACK >STACK
	RSTACK

	.FUNCT V-RAPE
	PRINTI "An ugly idea from an ugly person."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?201,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?202,STACK >STACK
	RSTACK

	.FUNCT FIND-IN,WHERE,WHAT,W,R=0
	FIRST? WHERE >W \FALSE
?L2:	FSET? W,WHAT \?L7
	ZERO? R /?L9
	RETURN 2
?L9:	SET 'R,W
	JUMP ?L2
?L7:	NEXT? W >W /?L2
	RETURN R

	.FUNCT V-SAY,V
	CALL FIND-IN,HERE,VICBIT >V
	ZERO? V /?L1
	PRINTI "You must address "
	EQUAL? V,M-FATAL \?L5
	PRINTI "someone"
	JUMP ?L9
?L5:	CALL THE?,V
	CALL DPRINT,V
?L9:	PRINTI " directly."
	CRLF
	RETURN 2
?L1:	GET P-LEXV,P-CONT >STACK
	EQUAL? STACK,W?HELLO \?L16
	SET 'QUOTE-FLAG,0
	RTRUE
?L16:	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	PRINTI "Talking to "
	CALL DPRINT,GLOBAL-SELF
	PRINTR " is said to be a sign of impending mental collapse."

	.FUNCT V-SPIN
	CALL TELL-YOU-CANT,STR?203 >STACK
	RSTACK

	.FUNCT V-THROUGH,M
	FSET? PRSO,DOORBIT \?L1
	CALL OTHER-SIDE,PRSO >STACK
	CALL DO-WALK,STACK
	RTRUE
?L1:	FSET? PRSO,VEHBIT /?L4
	EQUAL? HERE,MCGINTY-HQ \?L3
	EQUAL? PRSO,PSEUDO-OBJECT \?L3
?L4:	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L3:	IN? PRSO,GLOBAL-OBJECTS /?L5
	CALL META-LOC,PRSO >STACK
	EQUAL? STACK,HERE /?L5
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK \?L5
	CALL GLOBAL-NOT-HERE-PRINT,PRSO >STACK
	RSTACK
?L5:	FSET? PRSO,TAKEBIT /?L6
	PRINTI "You hit your head against "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR " as you attempt this feat."
?L6:	IN? PRSO,WINNER \?L11
	CALL TELL-CONTORT >STACK
	RSTACK
?L11:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-STEP
	FSET? PRSO,VEHBIT \?L1
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L1:	EQUAL? PRSO,GROUND \?L3
	PRINTR "Fred Astaire you're not."
?L3:	PRINTR "That sounds pretty useless."

	.FUNCT V-WEAR
	FSET? PRSO,WEARBIT /?L1
	CALL TELL-YOU-CANT,STR?204,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."
?L1:	FSET? PRSO,WORNBIT \?L5
	PRINTR "You are already wearing it."
?L5:	IN? PRSO,WINNER /?L9
	CALL ITAKE >STACK
	ZERO? STACK /FALSE
?L9:	FSET PRSO,WORNBIT
	PRINTI "You are now wearing "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT UNWEAR
	FSET? PRSO,WORNBIT \?L1
	FCLEAR PRSO,WORNBIT
	PRINTI "You are now holding "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."
?L1:	CALL TELL-YOURE-NOT,STR?205 >STACK
	RSTACK

	.FUNCT V-WITHDRAW
	EQUAL? PRSO,INTNUM /?L1
	CALL PERFORM,V?TAKE,PRSO >STACK
	RSTACK
?L1:	CALL TELL-YOU-CANT,STR?206 >STACK
	RSTACK

	.FUNCT V-DEPOSIT
	EQUAL? PRSO,INTNUM /?L1
	CALL PERFORM,V?PUT,PRSO,PRSI >STACK
	RSTACK
?L1:	CALL TELL-YOU-CANT,STR?207 >STACK
	RSTACK

	.FUNCT V-THROW-OFF
	CALL TELL-YOU-CANT,STR?208 >STACK
	RSTACK

	.FUNCT V-$0024VERIFY
	PRINTI "Verifying game..."
	CRLF
	VERIFY \?L3
	PRINTR "Yup. Game correct."
?L3:	PRINTR "** UH OH! Game File Failure. **"

	.FUNCT V-STAND
	ZERO? PRSO /?L7
	EQUAL? PRSO,GLOBAL-BANK /?L5
	FSET? PRSO,VICBIT \?L3
?L5:	CALL PERFORM,V?ROB,PRSO
	RTRUE
?L3:	FSET? PRSO,VEHBIT \?L6
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L6:	EQUAL? PRSO,ROOMS /?L7
	CALL HACK-HACK,STR?149
	RTRUE
?L7:	LOC WINNER >STACK
	FSET? STACK,VEHBIT \?L10
	LOC WINNER >STACK
	CALL PERFORM,V?DISEMBARK,STACK
	RTRUE
?L10:	PRINTR "You are already standing, I think."

	.FUNCT V-HIDE
	PRINTR "That's not a good hiding place."

	.FUNCT V-HIDE-UNDER
	CALL V-HIDE >STACK
	RSTACK

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR >STACK
	EQUAL? STACK,M-FATAL \TRUE
	RETURN 2

	.FUNCT V-WALK-TO
	EQUAL? PRSO,INTDIR \?L1
	CALL DO-WALK,P-WALK-DIR >STACK
	RSTACK
?L1:	IN? PRSO,HERE /?L4
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK /?L3
?L4:	FSET? PRSO,VICBIT \?L5
	PRINTI "He"
	JUMP ?L9
?L5:	PRINTI "It"
?L9:	PRINTR "'s here!"
?L3:	CALL TELL-SHD-DIR >STACK
	RSTACK

	.FUNCT TELL-SHD-DIR
	PRINTI "You should supply a "
	CALL DPRINT,INTDIR
	PRINTR "!"

	.FUNCT OTHER-SIDE,DOBJ,RM?=0,P=0,Z
?L1:	NEXTP HERE,P >P
	LESS? P,P?NW /FALSE
	GETPT HERE,P >Z
	PTSIZE Z >STACK
	EQUAL? STACK,DEXIT \?L1
	GETB Z,DEXITOBJ >STACK
	EQUAL? STACK,DOBJ \?L1
	ZERO? RM? /?L8
	GETB Z,0 >STACK
	RSTACK
?L8:	RETURN P

	.FUNCT V-LEAN-ON
	PRINTR "Are you so very tired, then?"

	.FUNCT V-PUT-AGAINST
	CALL TELL-NO-NO >STACK
	RSTACK

	.FUNCT V-TASTE
	FSET? PRSO,FOODBIT \?L1
	CALL PERFORM,V?EAT,PRSO >STACK
	RSTACK
?L1:	PRINTI "It tastes just like "
	CALL APRINT,PRSO
	PRINTR "."

	.FUNCT TELL-WHY-BOTHER
	PRINTR "Why bother?"

	.FUNCT V-ROB
	FSET? PRSO,PERSON /?L3
	EQUAL? PRSO,SPEAR-CARRIER \?L1
?L3:	PRINTI "Even as you begin to make your move, "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	CALL PRINT-ID,STR?209
	CALL JIGS-UP,STR?210 >STACK
	RSTACK
?L1:	PRINTI "No wonder you never made the Ten Most Wanted list."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?211,STACK >STACK
	RSTACK

	.FUNCT V-PUSH-THROUGH
	PRINTI "Pushing "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR " in that way isn't particularly helpful."

	.FUNCT HOW?,OBJ
	PRINTI "I don't know how to do that to "
	CALL APRINT,OBJ
	PRINTR "."

	.FUNCT VOWEL?,OBJ
	FSET? OBJ,VOWELBIT \?L1
	PRINTI "n"
?L1:	PRINTI " "
	RTRUE

	.FUNCT V-SMOKE
	PRINTI "Smoking is bad for your health."
	CRLF
	CALL PRINT-ID,STR?212 >STACK
	RSTACK

	.FUNCT V-UNFOLD
	CALL HOW?,PRSO >STACK
	RSTACK

	.FUNCT V-FOLD
	CALL V-UNFOLD >STACK
	RSTACK

	.FUNCT V-HOLE-DIG
	PRINTI "I can't dig in "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR "."

	.FUNCT V-TURN-OVER
	IN? PRSO,WINNER \?L1
	CALL TELL-NOTHING,STR?213,1 >STACK
	RSTACK
?L1:	FSET? PRSO,TAKEBIT \?L3
	CALL TELL-YOUD-BETTER,STR?214,1 >STACK
	RSTACK
?L3:	PRINTR "Good luck!"

	.FUNCT V-READ-INSIDE
	CALL TELL-NOTHING,STR?215,1 >STACK
	RSTACK

	.FUNCT PRE-REACH-IN
	EQUAL? PRSO,NOT-HERE-OBJECT /FALSE
	FSET? PRSO,CONTBIT /?L3
	CALL TELL-CANT-REACH,STR?216
	RTRUE
?L3:	FSET? PRSO,OPENBIT /FALSE
	CALL TELL-CLOSED,PRSO,0 >STACK
	RSTACK

	.FUNCT V-REACH-IN
	CALL PERFORM,V?LOOK-INSIDE,PRSO >STACK
	RSTACK

	.FUNCT TELL-CLOSED,ARG,STR?=1
	PRINTI "The "
	ZERO? STR? /?L3
	PRINT ARG
	JUMP ?L7
?L3:	CALL DPRINT,ARG
?L7:	PRINTR " is closed."

	.FUNCT V-CLEAN
	PRINTR "Cleanliness may be next to godliness, but there are limits."

	.FUNCT V-TIME
	IN? WATCH,WINNER /?L3
	IN? WATCH,HERE \?L1
?L3:	PRINTI "Your watch says it's "
	CALL WATCH-TIME
	PRINTR "."
?L1:	CALL TELL-YOU-CANT,STR?217 >STACK
	RSTACK

	.FUNCT V-WEIGH
	FSET? PRSO,TAKEBIT \?L1
	PRINTR "Tough to do without a scale."
?L1:	PRINTR "Now that's bizarre!"

	.FUNCT V-CHASTISE
	EQUAL? PRSO,INTDIR \?L1
	PRINTR "The best way to see what's happening there is to go there."
?L1:	PRINTI "Please be more specific. LOOKing AT, BEHIND, UNDER, THROUGH, INSIDE, ON, DOWN, FOR, or any other method of LOOKing mean different things to me. Please specify which preposition you'd like to use next time, like LOOK AT "
	FSET? PRSO,PERSON /?L8
	PRINTI "THE "
?L8:	CALL DPRINT,PRSO
	PRINTI ", or LOOK INSIDE "
	FSET? PRSO,PERSON /?L15
	PRINTI "THE "
?L15:	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT V-HELP
	EQUAL? PRSO,0,WINNER /?L3
	PRINTI "It seems that "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTI " doesn't need any help."
	CRLF
?L3:	PRINTI "I'm afraid you'll have to figure this out "
	CALL DPRINT,GLOBAL-SELF
	PRINTR ".
[If you really need help, you can order an InvisiClues Hint Booklet and a complete map by using the order form that came in your package.]"

	.FUNCT GET-COMFORTABLE,OBJ
	FIRST? OBJ >STACK /?L3
	CALL WEARING-SOMETHING? >STACK
	ZERO? STACK /?L1
?L3:	CALL TELL-NOT-COMFORTABLE >STACK
	RSTACK
?L1:	MOVE WINNER,OBJ
	PRINTI "You get into the "
	CALL DPRINT,OBJ
	PRINTI " and try to get comfortable. "
	CALL V-SLEEP >STACK
	RSTACK

	.FUNCT TELL-NOT-COMFORTABLE
	PRINTR "That doesn't sound very comfortable."

	.FUNCT V-SLEEP
	EQUAL? HOW-TIRED,6 \?L1
	GETP HERE,P?LINE >STACK
	LESS? STACK,UNDERWATER-LINE-C \?L3
	CALL SLEEP-LOSE >STACK
	RSTACK
?L3:	CALL PRINT-ID,STR?218
	CALL JIGS-UP,STR?219 >STACK
	RSTACK
?L1:	EQUAL? PRSO,0,BUNK,BED /?L6
	EQUAL? PRSO,ROOMS /?L6
	CALL TELL-NOT-COMFORTABLE >STACK
	RSTACK
?L6:	IN? WINNER,BED /?L8
	IN? WINNER,BUNK \?L7
?L8:	EQUAL? HOW-TIRED,1 /?L9
	IN? WINNER,BED \FALSE
	CALL SLEEP-LOSE >STACK
	RSTACK
?L9:	PRINTR "You close your eyes, but your mind is too active to let you sleep."
?L7:	IN? BED,HERE \?L17
	CALL GET-COMFORTABLE,BED
	RTRUE
?L17:	IN? BUNK,HERE \?L18
	CALL GET-COMFORTABLE,BUNK
	RTRUE
?L18:	ZERO? PRSO /?L19
	CALL TELL-NOT-COMFORTABLE >STACK
	RSTACK
?L19:	LESS? HOW-TIRED,2 \?L20
	CALL TELL-YOURE-NOT,STR?220 >STACK
	RSTACK
?L20:	PRINTR "Better find a good place to lie down."

	.FUNCT SLEEP-LOSE
	PRINTI "You drift off to sleep.

You wake up. Once again, you find "
	CALL DPRINT,GLOBAL-SELF
	PRINTI " with the usual nothing to do. It seems as if you are destined to spend the rest of your days on this island, waiting for a break that may never come."
	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT PRE-WHAT
	ZERO? PRSI /FALSE
	EQUAL? PRSO,GLOBAL-DAY,GLOBAL-TIME /FALSE
	EQUAL? PRSI,P-IT-OBJECT,IT /FALSE
	PRINTI "I'm afraid that question is beyond me."
	CRLF
	RETURN 2

	.FUNCT V-WHAT,?TMP
	EQUAL? WINNER,PLAYER \?L3
	ZERO? QCONTEXT /?L1
	EQUAL? HERE,QCONTEXT-ROOM \?L1
	SET '?TMP,HERE
	CALL META-LOC,QCONTEXT >STACK
	EQUAL? ?TMP,STACK \?L1
	FSET? QCONTEXT,PERSON \?L1
?L3:	PRINTR """Isn't it obvious?"""
?L1:	ZERO? PRSO \?L6
	PRINTR "Huh?"
?L6:	FSET? PRSO,PERSON \?L9
	PRINTR "Try asking that person."
?L9:	PRINTI "Are you talking to "
	CALL DPRINT,GLOBAL-SELF
	PRINTR " again?"

	.FUNCT V-YES
	CALL TELL-RATHER,STR?221 >STACK
	RSTACK

	.FUNCT V-MAYBE
	CALL TELL-RATHER,STR?222 >STACK
	RSTACK

	.FUNCT V-NO
	CALL TELL-RATHER,STR?223 >STACK
	RSTACK

	.FUNCT TELL-RATHER,STR
	PRINTI "You sound rather "
	PRINT STR
	PRINTR "."

	.FUNCT V-SIT
	FSET? PRSO,PERSON \?L1
	CALL PERFORM,V?SIT-WITH,PRSO >STACK
	RSTACK
?L1:	CALL PERFORM,V?SIT-ON,PRSO >STACK
	RSTACK

	.FUNCT V-SIT-ON
	FSET? PRSO,VEHBIT \?L1
	CALL PERFORM,V?BOARD,PRSO
	RTRUE
?L1:	EQUAL? PRSO,GROUND,DECK \?L3
	LOC WINNER >STACK
	FSET? STACK,VEHBIT \?L4
	MOVE WINNER,HERE
?L4:	PRINTR "After a moment, you stand back up."
?L3:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?224,STACK >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT V-SIT-WITH
	FSET? PRSO,PERSON /?L1
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	IN? PLAYER,SHANTY \?L5
	IN? PRSO,SHANTY \?L5
	CALL PERFORM,V?SIT-ON,CHAIR >STACK
	RSTACK
?L5:	PRINTI "There's no place to sit with "
	CALL DPRINT,PRSO
	PRINTR "."

	.FUNCT TELL-ALREADY,STR
	PRINTI "It's already "
	PRINT STR
	PRINTR "."

	.FUNCT TELL-YOUD-BETTER,STR,1ST=0,DONE=1
	PRINTI "You'd better "
	PRINT STR
	ZERO? 1ST /?L3
	PRINTI " first."
?L3:	ZERO? DONE /FALSE
	CRLF
	RTRUE

	.FUNCT FIXED-FONT-ON
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT FIXED-FONT-OFF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT DIR-PRINT,DIR,CNT=0,TBL,DRY=0
	ZERO? DIR \?L1
	PRINTI "out of view"
	RTRUE
?L1:	GETP HERE,P?LINE >STACK
	GRTR? STACK,BACK-ALLEY-LINE-C \?L5
	SET 'TBL,NAUTICAL-DIR-STRINGS
	JUMP ?L6
?L5:	SET 'TBL,DIR-STRINGS
	SET 'DRY,1
?L6:	GET TBL,CNT >STACK
	EQUAL? STACK,DIR \?L9
	ZERO? DRY /?L11
	EQUAL? DIR,P?UP,P?DOWN /?L11
	PRINTI "the "
?L11:	ADD CNT,1 >STACK
	GET TBL,STACK >STACK
	PRINT STACK
	RTRUE
?L9:	INC 'CNT
	JUMP ?L6

	.FUNCT FOLLOW-GOAL,PERSON?1,HERE?1,LINE,LN,RM,GT,GOAL,FLG,GOAL-FLAG=0,IGOAL=0,LOC,CNT=1,DIR
	LOC PERSON?1 >HERE?1
	GETP PERSON?1,P?CHARACTER >STACK
	GET GOAL-TABLES,STACK >GT
	GET GT,GOAL-F >STACK
	EQUAL? HERE?1,STACK \?L1
	PUT GT,GOAL-S,0
	RFALSE
?L1:	GET GT,GOAL-ENABLE >STACK
	ZERO? STACK /FALSE
	GETP HERE?1,P?STATION >LOC
	EQUAL? LOC,HERE?1 /?L5
	CALL MOVE-PERSON,PERSON?1,LOC >STACK
	RSTACK
?L5:	GET GT,GOAL-I >IGOAL
	GET TRANSFER-TABLE,IGOAL >GOAL
	ZERO? GOAL \?L11
	SET 'IGOAL,0
	GET GT,GOAL-S >GOAL
	ZERO? GOAL /FALSE
?L11:	EQUAL? HERE?1,GOAL \?L17
	ZERO? IGOAL /?L14
	ADD IGOAL,1 >STACK
	GET TRANSFER-TABLE,STACK >STACK
	CALL MOVE-PERSON,PERSON?1,STACK >FLG
	GET GT,GOAL-F >STACK
	CALL ESTABLISH-GOAL,PERSON?1,STACK
	RETURN FLG
?L14:	GET GT,GOAL-F >STACK
	EQUAL? HERE?1,STACK /?L16
	PUT GT,GOAL-S,0
	GET GT,GOAL-F >STACK
	CALL MOVE-PERSON,PERSON?1,STACK >FLG
	RETURN FLG
?L16:	PUT GT,GOAL-S,0
	RFALSE
?L17:	GETP GOAL,P?LINE >STACK
	CALL GET-LINE,STACK >LINE
?L19:	GET LINE,CNT >RM
	EQUAL? RM,HERE?1 \?L21
	ZERO? GOAL-FLAG /?L23
	SUB CNT,3 >STACK
	GET LINE,STACK >LOC
	JUMP ?L25
?L23:	ADD CNT,3 >STACK
	GET LINE,STACK >LOC
?L25:	CALL MOVE-PERSON,PERSON?1,LOC >STACK
	RSTACK
?L21:	EQUAL? RM,GOAL \?L26
	SET 'GOAL-FLAG,1
?L26:	ADD CNT,3 >CNT
	JUMP ?L19

	.FUNCT COR-DIR,HERE?1,THERE,COR,RM,PAST=0,CNT=2
	GETP HERE?1,P?CORRIDOR >STACK
	GETP THERE,P?CORRIDOR >STACK
	BAND STACK,STACK >STACK
	CALL GET-COR,STACK >COR
?L1:	GET COR,CNT >RM
	EQUAL? RM,HERE?1 \?L3
	SET 'PAST,1
	JUMP ?L2
?L3:	EQUAL? RM,THERE /?L2
	INC 'CNT
	JUMP ?L1
?L2:	GET COR,PAST >STACK
	RSTACK

	.FUNCT GET-LINE,LN
	ZERO? LN \?L1
	RETURN ROAD-WHARF-LINE
?L1:	EQUAL? LN,1 \?L3
	RETURN EAST-ROAD-LINE
?L3:	EQUAL? LN,2 \?L4
	RETURN BEDROOM-LINE
?L4:	EQUAL? LN,3 \?L5
	RETURN BACK-ALLEY-LINE
?L5:	EQUAL? LN,4 \?L6
	RETURN TRAWLER-LINE
?L6:	EQUAL? LN,5 \FALSE
	RETURN SALVAGER-LINE

	.FUNCT GET-COR,NUM
	EQUAL? NUM,1 \?L1
	RETURN COR-1
?L1:	EQUAL? NUM,2 \?L3
	RETURN COR-2
?L3:	EQUAL? NUM,4 \?L4
	RETURN COR-4
?L4:	EQUAL? NUM,8 \?L5
	RETURN COR-8
?L5:	EQUAL? NUM,16 \?L6
	RETURN COR-16
?L6:	EQUAL? NUM,32 \?L7
	RETURN COR-32
?L7:	EQUAL? NUM,64 \?L8
	RETURN COR-64
?L8:	EQUAL? NUM,128 \?L9
	RETURN COR-128
?L9:	EQUAL? NUM,256 \?L10
	RETURN COR-256
?L10:	RETURN COR-512

	.FUNCT CORRIDOR-LOOK,ITM=0,C,Z,COR,VAL,FOUND=0
	GETP HERE,P?CORRIDOR >C
	ZERO? C /FALSE
?L3:	SUB C,512 >Z
	LESS? Z,0 /?L5
	SET 'COR,COR-512
	JUMP ?L16
?L5:	SUB C,256 >Z
	LESS? Z,0 /?L7
	SET 'COR,COR-256
	JUMP ?L16
?L7:	SUB C,128 >Z
	LESS? Z,0 /?L8
	SET 'COR,COR-128
	JUMP ?L16
?L8:	SUB C,64 >Z
	LESS? Z,0 /?L9
	SET 'COR,COR-64
	JUMP ?L16
?L9:	SUB C,32 >Z
	LESS? Z,0 /?L10
	SET 'COR,COR-32
	JUMP ?L16
?L10:	SUB C,16 >Z
	LESS? Z,0 /?L11
	SET 'COR,COR-16
	JUMP ?L16
?L11:	SUB C,8 >Z
	LESS? Z,0 /?L12
	SET 'COR,COR-8
	JUMP ?L16
?L12:	SUB C,4 >Z
	LESS? Z,0 /?L13
	SET 'COR,COR-4
	JUMP ?L16
?L13:	SUB C,2 >Z
	LESS? Z,0 /?L14
	SET 'COR,COR-2
	JUMP ?L16
?L14:	SUB C,1 >Z
	LESS? Z,0 /?L4
	SET 'COR,COR-1
?L16:	CALL CORRIDOR-CHECK,COR,ITM >VAL
	ZERO? FOUND \?L17
	SET 'FOUND,VAL
?L17:	SET 'C,Z
	JUMP ?L3
?L4:	RETURN FOUND

	.FUNCT CORRIDOR-CHECK,COR,ITM,CNT=2,PAST=0,FOUND=0,RM,OBJ
?L1:	GET COR,CNT >RM
	ZERO? RM /FALSE
	EQUAL? RM,HERE \?L5
	SET 'PAST,1
	JUMP ?L27
?L5:	FIRST? RM >OBJ \?L27
?L7:	ZERO? ITM /?L9
	EQUAL? OBJ,ITM \?L14
	GET COR,PAST >FOUND
	JUMP ?L8
?L9:	GETP OBJ,P?CHARACTER >STACK
	ZERO? STACK /?L14
	CALL IN-MOTION?,OBJ >STACK
	ZERO? STACK \?L14
	EQUAL? OBJ,MCGINTY \?L15
	CALL QUEUED?,I-MCGINTY-FOLLOWS >STACK
	ZERO? STACK /?L15
	EQUAL? PRSA,V?FOLLOW,V?WALK /?L14
?L15:	CALL START-SENTENCE,OBJ
	PRINTI " is "
	PRINTI "off to "
	GET COR,PAST >STACK
	CALL DIR-PRINT,STACK
	PRINTI "."
	CRLF
?L14:	NEXT? OBJ >OBJ /?L7
?L8:	ZERO? FOUND /?L27
	RETURN FOUND
?L27:	INC 'CNT
	JUMP ?L1

	.FUNCT IN-MOTION?,PERSON?1,GT
	GETP PERSON?1,P?CHARACTER >STACK
	GET GOAL-TABLES,STACK >GT
	GET GT,GOAL-ENABLE >STACK
	ZERO? STACK \?L3
	GET GT,ATTENTION >STACK
	EQUAL? STACK,1 \FALSE
?L3:	GET GT,GOAL-S >STACK
	ZERO? STACK /FALSE
	GET GT,GOAL-F >STACK
	LOC PERSON?1 >STACK
	EQUAL? STACK,STACK /FALSE
	RTRUE

	.FUNCT START-MOVEMENT
	CALL QUEUE,I-MCGINTY,1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-JOHNNY,1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-PETE,1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-WEASEL,1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-DELIVERY-BOY,1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-FOLLOW,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-ATTENTION,-1 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-DISGUSTING-WEASEL-KLUDGE,35 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT IMOVEMENT,PERSON?1,INT?1,TB,VAR,DIS,TIM,ID,RM,GT
	GETP PERSON?1,P?CHARACTER >ID
	GET MOVEMENT-GOALS,ID >TB
	GET GOAL-TABLES,ID >GT
	GET TB,MG-ROOM >RM
	ZERO? RM /?L5
	GET GT,GOAL-QUEUED >STACK
	ZERO? STACK /?L3
	PUT GT,GOAL-QUEUED,RM
	JUMP ?L5
?L3:	CALL ESTABLISH-GOAL,PERSON?1,RM
?L5:	GET TB,MG-TIME >TIM
	ZERO? TIM /FALSE
	GET TB,MG-VARIATION >VAR
	MUL VAR,2 >STACK
	RANDOM STACK >DIS
	SUB DIS,VAR >STACK
	ADD TIM,STACK >STACK
	CALL QUEUE,INT?1,STACK
	ADD TB,MG-LENGTH >STACK
	PUT MOVEMENT-GOALS,ID,STACK
	GET TB,MG-NEXT >STACK
	ZERO? STACK /FALSE
	SUB VAR,DIS >STACK
	GET TB,MG-NEXT >STACK
	ADD STACK,STACK >STACK
	PUT TB,MG-NEXT,STACK
	RFALSE

	.FUNCT I-FOLLOW,FLG=0,CNT=0,GT,VAL
?L1:	IGRTR? 'CNT,CHARACTER-MAX \?L3
	RETURN FLG
?L3:	GET GOAL-TABLES,CNT >GT
	GET GT,GOAL-S >STACK
	ZERO? STACK /?L1
	GET GT,GOAL-ENABLE >STACK
	ZERO? STACK \?L6
	GET GT,ATTENTION >STACK
	ZERO? STACK \?L1
?L6:	PUT GT,GOAL-ENABLE,1
	GET CHARACTER-TABLE,CNT >STACK
	CALL FOLLOW-GOAL,STACK >VAL
	ZERO? VAL /?L1
	EQUAL? FLG,M-FATAL /?L1
	SET 'FLG,VAL
	JUMP ?L1

	.FUNCT I-ATTENTION,FLG=0,CNT=0,ATT,GT
?L1:	IGRTR? 'CNT,CHARACTER-MAX \?L3
	RETURN FLG
?L3:	GET GOAL-TABLES,CNT >GT
	GET GT,ATTENTION >STACK
	SUB STACK,1 >ATT
	ZERO? ATT \?L5
	PUT GT,GOAL-ENABLE,1
?L5:	PUT GT,ATTENTION,ATT
	JUMP ?L1

	.FUNCT GRAB-ATTENTION,PERSON?1,CHR,GT,ATT
	GETP PERSON?1,P?CHARACTER >CHR
	GET GOAL-TABLES,CHR >GT
	GET GT,GOAL-S >STACK
	ZERO? STACK /?L5
	GET GT,ATTENTION-SPAN >ATT
	PUT GT,ATTENTION,ATT
	ZERO? ATT \?L3
	PUT GT,GOAL-ENABLE,1
	RFALSE
?L3:	GET GT,GOAL-ENABLE >STACK
	ZERO? STACK /?L5
	PUT GT,GOAL-ENABLE,0
?L5:	SET 'QCONTEXT,PERSON?1
	SET 'QCONTEXT-ROOM,HERE
	RTRUE

	.FUNCT ESTABLISH-GOAL,PERSON?1,GOAL,PRIORITY=0,HERE?1,HL,GL,GT
	LOC PERSON?1 >HERE?1
	GETP PERSON?1,P?CHARACTER >STACK
	GET GOAL-TABLES,STACK >GT
	ZERO? PRIORITY /?L1
	PUT GT,GOAL-ENABLE,1
	PUT GT,GOAL-QUEUED,HERE?1
?L1:	GETP GOAL,P?LINE >STACK
	MUL STACK,2 >STACK
	GETP HERE?1,P?LINE >STACK
	MUL STACK,12 >STACK
	ADD STACK,STACK >STACK
	PUT GT,GOAL-I,STACK
	GETP GOAL,P?STATION >STACK
	PUT GT,GOAL-S,STACK
	PUT GT,GOAL-F,GOAL
	LOC PERSON?1 >STACK
	RSTACK

	.FUNCT GOAL-REACHED,PERSON?1,GT
	GETP PERSON?1,P?CHARACTER >STACK
	GET GOAL-TABLES,STACK >GT
	PUT GT,GOAL-S,0
	GET GT,GOAL-FUNCTION >STACK
	CALL STACK,G-REACHED >STACK
	RSTACK

	.FUNCT MOVE-PERSON,PERSON?1,WHERE,DIR,GT,OL,COR,PCOR,CHR,PUSHCART,FLG=0,VAL=0,DF,CD
	GETP PERSON?1,P?CHARACTER >CHR
	GET GOAL-TABLES,CHR >GT
	LOC PERSON?1 >OL
	CALL DIR-FROM,OL,WHERE >DIR
	SET 'PUSHCART,STR?225
	EQUAL? OL,HERE \?L1
	FSET? PERSON?1,INVISIBLE /?L1
	SET 'FLG,1
	CALL START-SENTENCE,PERSON?1
	EQUAL? DIR,P?OUT \?L3
	PRINTI " leaves the room"
	EQUAL? PERSON?1,DELIVERY-BOY \?L7
	PRINT PUSHCART
?L7:	PRINTI "."
	CRLF
	JUMP ?L107
?L3:	EQUAL? DIR,P?IN \?L14
	PRINTI " goes into another room"
	PRINTI "."
	CRLF
	JUMP ?L107
?L14:	PRINTI " heads "
	GETP HERE,P?LINE >STACK
	LESS? STACK,TRAWLER-LINE-C \?L22
	EQUAL? DIR,P?UP,P?DOWN /?L22
	PRINTI "off to "
?L22:	CALL DIR-PRINT,DIR
	EQUAL? PERSON?1,DELIVERY-BOY \?L27
	PRINT PUSHCART
?L27:	PRINTI "."
	CRLF
	JUMP ?L107
?L1:	EQUAL? WHERE,HERE \?L34
	FSET? PERSON?1,INVISIBLE /?L34
	SET 'FLG,M-FATAL
	GET GT,GOAL-F >STACK
	EQUAL? HERE,STACK /?L107
	CALL START-SENTENCE,PERSON?1
	PRINTI " walks "
	EQUAL? PRSA,V?WALK \?L39
	EQUAL? WHERE,HERE \?L39
	EQUAL? OL,LAST-PLAYER-LOC \?L39
	PRINTI "along with"
	JUMP ?L43
?L39:	PRINTI "past"
?L43:	PRINTI " you"
	EQUAL? PERSON?1,DELIVERY-BOY \?L48
	PRINT PUSHCART
?L48:	PRINTI "."
	CRLF
	JUMP ?L107
?L34:	GETP HERE,P?CORRIDOR >COR
	ZERO? COR /?L107
	FSET? PERSON?1,INVISIBLE /?L107
	GETP OL,P?CORRIDOR >PCOR
	ZERO? PCOR /?L57
	BAND COR,PCOR >STACK
	ZERO? STACK /?L57
	SET 'FLG,1
	GETP WHERE,P?CORRIDOR >STACK
	ZERO? STACK \?L59
	CALL START-SENTENCE,PERSON?1
	PRINTI ", off to "
	CALL COR-DIR,HERE,OL >STACK
	CALL DIR-PRINT,STACK
	PRINTI ","
	PRINTI " leaves your view"
	PRINTI " to "
	CALL DIR-FROM,OL,WHERE >STACK
	CALL DIR-PRINT,STACK
	EQUAL? PERSON?1,DELIVERY-BOY \?L69
	PRINT PUSHCART
?L69:	PRINTI "."
	CRLF
	JUMP ?L107
?L59:	GETP WHERE,P?CORRIDOR >STACK
	BAND COR,STACK >STACK
	ZERO? STACK \?L76
	CALL START-SENTENCE,PERSON?1
	PRINTI ", off to "
	CALL COR-DIR,HERE,OL >STACK
	CALL DIR-PRINT,STACK
	PRINTI ", disappears from sight to "
	CALL DIR-FROM,OL,WHERE >PCOR
	CALL DIR-PRINT,PCOR
	EQUAL? PERSON?1,DELIVERY-BOY \?L81
	PRINT PUSHCART
?L81:	PRINTI "."
	CRLF
	JUMP ?L107
?L76:	CALL START-SENTENCE,PERSON?1
	PRINTI " is to "
	CALL COR-DIR,HERE,WHERE >CD
	CALL DIR-PRINT,CD
	PRINTI ", heading "
	CALL DIR-FROM,OL,WHERE >DF
	EQUAL? CD,DF \?L93
	PRINTI "away from you"
	JUMP ?L97
?L93:	PRINTI "toward "
	CALL DIR-PRINT,DF
?L97:	EQUAL? PERSON?1,DELIVERY-BOY \?L100
	PRINT PUSHCART
?L100:	PRINTI "."
	CRLF
	JUMP ?L107
?L57:	GETP WHERE,P?CORRIDOR >PCOR
	ZERO? PCOR /?L107
	BAND COR,PCOR >STACK
	ZERO? STACK /?L107
	SET 'FLG,1
	PRINTI "To "
	CALL COR-DIR,HERE,WHERE >STACK
	CALL DIR-PRINT,STACK
	PRINTI " "
	CALL THE?,PERSON?1
	CALL DPRINT,PERSON?1
	PRINTI " comes into view from "
	CALL DIR-FROM,WHERE,OL >STACK
	CALL DIR-PRINT,STACK
	EQUAL? PERSON?1,DELIVERY-BOY \?L114
	PRINT PUSHCART
?L114:	PRINTI "."
	CRLF
?L107:	MOVE PERSON?1,WHERE
	GET GT,GOAL-F >STACK
	EQUAL? STACK,WHERE \?L123
	CALL GOAL-REACHED,PERSON?1 >VAL
	ZERO? VAL \?L130
	EQUAL? HERE,WHERE \?L130
	FSET? PERSON?1,INVISIBLE /?L130
	SET 'FLG,M-FATAL
	CALL START-SENTENCE,PERSON?1
	PRINTI " stops here."
	CRLF
	JUMP ?L130
?L123:	GET GT,GOAL-FUNCTION >STACK
	CALL STACK,G-ENROUTE >STACK
?L130:	EQUAL? VAL,M-FATAL \?L131
	RETURN VAL
?L131:	RETURN FLG

	.FUNCT DIR-FROM,HERE?1,THERE,V=0,P=0,L,Z,O
?L1:	NEXTP HERE?1,P >P
	ZERO? P \?L3
	RETURN V
?L3:	EQUAL? P,P?IN,P?OUT /?L1
	LESS? P,P?NW /?L1
	GETPT HERE?1,P >Z
	PTSIZE Z >L
	EQUAL? L,DEXIT,UEXIT,CEXIT \?L7
	GETB Z,REXIT >STACK
	EQUAL? STACK,THERE \?L7
	EQUAL? P,P?UP,P?DOWN \?L9
	SET 'V,P
	JUMP ?L1
?L9:	RETURN P
?L7:	ZERO? V \?L1
	EQUAL? L,FEXIT \?L1
	SET 'V,P
	JUMP ?L1

	.FUNCT WINDING-ROAD-1-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	PUTP LOCKED-DOOR,P?SDESC,STR?226
	EQUAL? MEETINGS-COMPLETED,1 \FALSE
	GRTR? PRESENT-TIME,585 \?L5
	CALL ALL-GO-HOME
	CALL I-PLOT-NEVER-STARTS
	SET 'SM-CTR,4
	RETURN SM-CTR
?L5:	CALL QUEUE,I-SECOND-MEETING,-1 >STACK
	PUT STACK,0,1
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	GRTR? SM-CTR,0 \FALSE
	LESS? SM-CTR,4 \FALSE
	GRTR? HOW-HUNGRY,3 \?L14
	PRINTI "Johnny looks at you. ""If you can't keep in shape, we don't want you. One word to anyone and you're a goner."" He then lets you pass..."
	CRLF
	CRLF
	SET 'SM-CTR,4
	RFALSE
?L14:	PRINTR "Johnny blocks you. ""What's the hurry, matey?"""

	.FUNCT WINDING-ROAD-2-F,RARG
	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROUGH,V?BOARD \FALSE
	EQUAL? PRSO,PSEUDO-OBJECT \FALSE
	PRINTR "After trying to get a foothold, you give up."

	.FUNCT SWAMP-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?227
	RTRUE
?L1:	EQUAL? PRSA,V?SMELL \FALSE
	PRINTR "It smells awful."

	.FUNCT WHARF-ROAD-2-S,PRINT?=1
	ZERO? PRINT? /FALSE
	ZERO? BUSINESS-HOURS? /?L3
	IN? MCGINTY,MCGINTY-HQ \?L3
	RETURN MCGINTY-HQ
?L3:	CALL DPRINT,MCGINTY
	PRINTI "'s is closed."
	CRLF
	RFALSE

	.FUNCT FRONT-DOOR-F,OPEN?=0
	EQUAL? HERE,RED-BOAR-INN,WHARF-ROAD-1,WHARF-ROAD-5 /?L3
	EQUAL? HERE,SHANTY \?L1
?L3:	SET 'OPEN?,1
	JUMP ?L8
?L1:	ZERO? BUSINESS-HOURS? /?L8
	EQUAL? HERE,WHARF-ROAD-4,OUTFITTERS-HQ,BANK /?L7
	EQUAL? HERE,SHORE-ROAD-2 \?L5
?L7:	SET 'OPEN?,1
	JUMP ?L8
?L5:	IN? MCGINTY,MCGINTY-HQ \?L8
	SET 'OPEN?,1
?L8:	EQUAL? PRSA,V?EXAMINE \?L11
	PRINTI "The door is "
	ZERO? OPEN? /?L15
	PRINTI "open"
	JUMP ?L19
?L15:	PRINTI "closed"
?L19:	PRINTR "."
?L11:	EQUAL? PRSA,V?OPEN \?L24
	ZERO? OPEN? /?L25
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L25:	EQUAL? HERE,MCGINTY-HQ \?L27
	CALL TELL-BLOWS,STR?45 >STACK
	RSTACK
?L27:	PRINTR "It's locked."
?L24:	EQUAL? PRSA,V?UNLOCK \?L31
	EQUAL? HERE,MCGINTY-HQ,OUTFITTERS-HQ,SHANTY /?L34
	EQUAL? HERE,BANK,RED-BOAR-INN \?L32
?L34:	CALL TELL-DONT-HAVE,STR?228 >STACK
	RSTACK
?L32:	CALL TELL-NO-KEY >STACK
	RSTACK
?L31:	EQUAL? PRSA,V?CLOSE \FALSE
	ZERO? OPEN? /?L37
	CALL TELL-BLOWS,STR?44 >STACK
	RSTACK
?L37:	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK

	.FUNCT TELL-BLOWS,STR
	PRINTI "It blows back "
	PRINT STR
	PRINTR "."

	.FUNCT SHORE-ROAD-2-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the east end of the "
	CALL DPRINT,SHORE-ROAD-1
	PRINTI ", an east/west road with a ferry landing at its west end. The "
	CALL DPRINT,BANK
	PRINTI ", the island's only bank, is off to the north. The "
	CALL DPRINT,OCEAN-ROAD-1
	PRINTR " starts up to the northeast."

	.FUNCT BACK-ALLEY-1-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUTP LOCKED-DOOR,P?SDESC,STR?229
	RTRUE

	.FUNCT BACK-ALLEY-2-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUTP LOCKED-DOOR,P?SDESC,STR?229
	RTRUE

	.FUNCT BACK-ALLEY-2-N,PRINT?=1
	ZERO? PRINT? /FALSE
	FSET? BACK-WINDOW,OPENBIT \?L3
	IN? MCGINTY,BACK-ALLEY-1 /?L6
	IN? MCGINTY,BACK-ALLEY-2 /?L6
	IN? MCGINTY,BACK-ALLEY-3 \?L4
?L6:	CALL PRINT-ID,STR?230
	CALL JIGS-UP,STR?231 >STACK
	RSTACK
?L4:	CALL TELL-THRU-WINDOW
	IN? MCGINTY,MCGINTY-HQ \?L8
	SET 'MCGINTY-HQ-OCCUPIED,1
?L8:	RETURN MCGINTY-HQ
?L3:	PRINTI "The door is locked."
	CRLF
	RFALSE

	.FUNCT BACK-WINDOW-F
	EQUAL? PRSA,V?OPEN \?L1
	IN? PLAYER,MCGINTY-HQ \?L3
	CALL TELL-YOU-CANT,STR?232 >STACK
	RSTACK
?L3:	FSET? BACK-WINDOW,OPENBIT \?L5
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L5:	FSET BACK-WINDOW,OPENBIT
	PRINTR "You open it enough to fit through it."
?L1:	EQUAL? PRSA,V?CLOSE \?L9
	FSET? BACK-WINDOW,OPENBIT \?L10
	FCLEAR BACK-WINDOW,OPENBIT
	PRINTR "You close the window."
?L10:	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK
?L9:	EQUAL? PRSA,V?BOARD,V?THROUGH \?L15
	FSET? BACK-WINDOW,OPENBIT \?L16
	IN? PLAYER,MCGINTY-HQ \?L18
	CALL DO-WALK,P?SOUTH
	RTRUE
?L18:	CALL DO-WALK,P?NORTH
	RTRUE
?L16:	CALL TELL-CLOSED,STR?233
	RTRUE
?L15:	EQUAL? PRSA,V?LOOK-INSIDE \?L22
	PRINTI "You see "
	IN? PLAYER,MCGINTY-HQ \?L25
	PRINTI "the back alley"
	JUMP ?L32
?L25:	IN? MCGINTY,MCGINTY-HQ \?L29
	CALL DPRINT,MCGINTY
	PRINTI " sitting at his desk"
	JUMP ?L32
?L29:	CALL DPRINT,MCGINTY
	PRINTI "'s office"
?L32:	PRINTR "."
?L22:	EQUAL? PRSA,V?UNLOCK \FALSE
	PRINTR "It doesn't seem to be locked."

	.FUNCT LOCKED-DOOR-F,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?226
	RTRUE
?L1:	EQUAL? PRSA,V?OPEN \?L3
	PRINTR "It's locked."
?L3:	EQUAL? PRSA,V?UNLOCK \?L6
	CALL TELL-NO-KEY >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?EXAMINE,V?READ \?L7
	EQUAL? HERE,WINDING-ROAD-1 \?L8
	PRINTI "The lettering on the door reads:
"
	CALL FIXED-FONT-ON
	PRINTI "    ""This "
	CALL DPRINT,LIGHTHOUSE
	PRINTI " is part of
             CUTTHROATS
    an Infocom Tale of Adventure
 by Michael Berlyn and Jerry Wolper
        (c)1984 Infocom, Inc."""
	CRLF
	CALL FIXED-FONT-OFF
	RTRUE
?L8:	EQUAL? PRSA,V?READ \?L14
	CALL V-READ >STACK
	RSTACK
?L14:	CALL TELL-CLOSED,STR?234 >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?MUNG \?L16
	PRINTI "The door and lock withstand your attempts."
	CRLF
	CALL PRINT-ID,STR?235 >STACK
	RSTACK
?L16:	EQUAL? PRSA,V?KNOCK \?L19
	CALL TELL-NO-ANSWER >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?CLOSE \?L20
	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?LOCK \FALSE
	CALL TELL-ALREADY,STR?58 >STACK
	RSTACK

	.FUNCT TELL-NO-ANSWER
	PRINTR "You wait a minute, but there's no answer."

	.FUNCT BACK-ALLEY-4-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUTP LOCKED-DOOR,P?SDESC,STR?229
	RTRUE

	.FUNCT BACK-ALLEY-5-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUTP LOCKED-DOOR,P?SDESC,STR?229
	RTRUE

	.FUNCT RED-BOAR-INN-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	MOVE SPEAR-CARRIER,RED-BOAR-INN
	PUTP SPEAR-CARRIER,P?SDESC,STR?236
	PUTP SPEAR-CARRIER,P?LDESC,STR?237
	PUTP GLOBAL-SURFACE,P?SDESC,STR?238
	CALL MOVE-SHARED-OBJECTS,RED-BOAR-INN
	RFALSE

	.FUNCT MAIL-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?239
	RTRUE
?L1:	EQUAL? PRSA,V?ASK-CONTEXT-FOR,V?ASK-FOR /FALSE
	CALL GLOBAL-NOT-HERE-PRINT,PSEUDO-OBJECT
	RETURN 2

	.FUNCT MESSAGE-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?240
	RTRUE
?L1:	CALL MAIL-PSEUDO >STACK
	RSTACK

	.FUNCT BEDROOM-F,RARG
	EQUAL? RARG,M-FLASH \?L1
	IN? WEASEL,BEDROOM \?L3
	EQUAL? PRSA,V?LOOK /?L3
	CALL PRINT-ID,STR?241
	CALL JIGS-UP,STR?242 >STACK
	RSTACK
?L3:	ZERO? BEDROOM-MESSAGE /FALSE
	PRINT BEDROOM-MESSAGE
	CRLF
	SET 'BEDROOM-MESSAGE,0
	RETURN BEDROOM-MESSAGE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,PSEUDO-OBJECT \FALSE
	CALL TELL-CLOTHES >STACK
	RSTACK

	.FUNCT BEDROOM-W,PRINT?=1
	ZERO? PRINT? /FALSE
	PRINTI "It's not a walk-in closet."
	CRLF
	RFALSE

	.FUNCT BED-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	ZERO? PRSO /?L3
	IN? PRSO,PLAYER /FALSE
	IN? PRSO,BED /FALSE
	EQUAL? PRSO,GLOBAL-ROOM /FALSE
	EQUAL? PRSA,V?DROP \?L3
	EQUAL? PRSO,BED /FALSE
?L3:	EQUAL? PRSA,V?EXAMINE \?L6
	EQUAL? PRSO,CLOSET,BUREAU /FALSE
?L6:	CALL BED-VERB? >STACK
	ZERO? STACK \FALSE
	PRINTI "You should get out of bed first."
	CRLF
	RETURN 2
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?BOARD \FALSE
	FIRST? BED >STACK /?L16
	CALL WEARING-SOMETHING? >STACK
	ZERO? STACK /FALSE
?L16:	CALL TELL-NOT-COMFORTABLE >STACK
	RSTACK

	.FUNCT BED-VERB?
	EQUAL? PRSA,V?DIAGNOSE,V?SUPER-BRIEF,V?BRIEF /TRUE
	EQUAL? PRSA,V?QUIT,V?INVENTORY,V?VERBOSE /TRUE
	EQUAL? PRSA,V?SAVE,V?RESTORE,V?RESTART /TRUE
	EQUAL? PRSA,V?VERSION,V?$0024VERIFY,V?SCORE /TRUE
	EQUAL? PRSA,V?ASK-CONTEXT-ABOUT,V?ASK-ABOUT,V?AGAIN /TRUE
	EQUAL? PRSA,V?BREATHE,V?ASK-CONTEXT-FOR,V?ASK-FOR /TRUE
	EQUAL? PRSA,V?FIND,V?CALL,V?$0024CALL /TRUE
	EQUAL? PRSA,V?CURSES,V?COUNT,V?CHOMP /TRUE
	EQUAL? PRSA,V?HELLO,V?GOODBYE,V?DISEMBARK /TRUE
	EQUAL? PRSA,V?LATITUDE,V?ALARM,V?HELP /TRUE
	EQUAL? PRSA,V?LOOK,V?LISTEN,V?LONGITUDE /TRUE
	EQUAL? PRSA,V?MAYBE,V?CHASTISE,V?LOOK-INSIDE /TRUE
	EQUAL? PRSA,V?MUMBLE,V?NO,V?YES /TRUE
	EQUAL? PRSA,V?SIT,V?SCRIPT,V?PRAY /TRUE
	EQUAL? PRSA,V?SMELL,V?UNSCRIPT,V?SIT-ON /TRUE
	EQUAL? PRSA,V?TELL,V?STAY,V?STAND /TRUE
	EQUAL? PRSA,V?TIME,V?SLEEP,V?SAY /TRUE
	EQUAL? PRSA,V?WAVE-AT,V?WAIT-FOR,V?WAIT /TRUE
	EQUAL? PRSA,V?WHAT,V?YELL,V?WIN \FALSE
	RTRUE

	.FUNCT BUREAU-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? BUREAU,OPENBIT \?L3
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L3:	FSET BUREAU,OPENBIT
	PRINTI "Opening the "
	CALL DPRINT,BUREAU
	PRINTI " reveals "
	CALL TELL-BUREAU-CONTENTS >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLOSE \?L8
	FSET? BUREAU,OPENBIT \?L9
	FCLEAR BUREAU,OPENBIT
	PRINTR "Closed."
?L9:	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?PUT-ON \?L14
	EQUAL? PRSI,BUREAU \?L14
	CALL IDROP >STACK
	ZERO? STACK /TRUE
	PRINTR "It slides off onto the floor."
?L14:	EQUAL? PRSA,V?EXAMINE \?L20
	PRINTI "It's a tilted old wooden "
	CALL DPRINT,BUREAU
	FSET? BUREAU,OPENBIT \?L23
	FIRST? BUREAU >STACK \?L25
	PRINTI ". In addition to your clothes, you find "
	CALL PRINT-CONTENTS,BUREAU
	PRINTR " inside."
?L25:	PRINTR ". Your clothes are in it."
?L23:	PRINTR ", which is closed."
?L20:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	FSET? BUREAU,OPENBIT \FALSE
	PRINTI "The "
	CALL DPRINT,BUREAU
	PRINTI " contains "
	CALL TELL-BUREAU-CONTENTS >STACK
	RSTACK

	.FUNCT TELL-BUREAU-CONTENTS
	FIRST? BUREAU >STACK \?L1
	CALL PRINT-CONTENTS,BUREAU
	PRINTI ", as well as"
	JUMP ?L5
?L1:	PRINTI "nothing but"
?L5:	PRINTR " your clothes."

	.FUNCT PASSBOOK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? PASSBOOK,RMUNGBIT \?L3
	CALL TELL-SOGGY >STACK
	RSTACK
?L3:	PRINTI "This is a distinctive "
	CALL DPRINT,BANK
	PRINTI " passbook"
	IN? PASSBOOK,MCGINTY /?L8
	IN? PASSBOOK,WEASEL /?L8
	PRINTI " which shows a balance of $"
	PRINTN PASSBOOK-BALANCE
	PRINTI ". The last date stamped in it is "
	PRINT STUPID-PROBLEM-STRING
?L8:	PRINTR "."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?OPEN,V?READ \?L15
	IN? PASSBOOK,WEASEL /?L18
	IN? PASSBOOK,MCGINTY \?L16
?L18:	LOC PASSBOOK >STACK
	CALL START-SENTENCE,STACK
	PRINTR " has it."
?L16:	CALL PERFORM,V?EXAMINE,PASSBOOK
	RTRUE
?L15:	EQUAL? PRSA,V?CLOSE \FALSE
	PRINTR "It's closed."

	.FUNCT KEY-F
	EQUAL? PRSA,V?LOCK \?L1
	EQUAL? PRSO,BEDROOM-DOOR \?L1
	ZERO? BEDROOM-DOOR-LOCKED /?L3
	CALL TELL-ALREADY,STR?58
	RTRUE
?L3:	FSET? BEDROOM-DOOR,OPENBIT \?L5
	PRINTR "You should close it first."
?L5:	SET 'BEDROOM-DOOR-LOCKED,1
	CALL TELL-NOW,BEDROOM-DOOR,STR?58
	RTRUE
?L1:	EQUAL? PRSA,V?UNLOCK \?L9
	EQUAL? PRSO,BEDROOM-DOOR \?L9
	ZERO? BEDROOM-DOOR-LOCKED \?L10
	CALL TELL-ALREADY,STR?46
	RTRUE
?L10:	SET 'BEDROOM-DOOR-LOCKED,0
	CALL TELL-NOW,BEDROOM-DOOR,STR?46
	RTRUE
?L9:	EQUAL? PRSA,V?OPEN \FALSE
	EQUAL? PRSO,BEDROOM-DOOR \FALSE
	CALL PERFORM,V?UNLOCK,BEDROOM-DOOR,KEY
	CALL PERFORM,V?OPEN,BEDROOM-DOOR
	RTRUE

	.FUNCT NOTE-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	FSET? NOTE,RMUNGBIT \FALSE
	CALL TELL-SOGGY >STACK
	RSTACK

	.FUNCT BOOK-F
	FSET? BOOK,RMUNGBIT \?L1
	EQUAL? PRSA,V?EXAMINE,V?READ,V?OPEN \?L1
	CALL TELL-SOGGY >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	CALL PERFORM,V?READ,BOOK
	RTRUE

	.FUNCT CLOTHES-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?243
	RTRUE
?L1:	EQUAL? PRSA,V?DISEMBARK,V?WEAR \FALSE
	CALL TELL-CLOTHES >STACK
	RSTACK

	.FUNCT TELL-CLOTHES
	PRINTR "What you have on now is fine."

	.FUNCT CLOSET-F,RARG=0
	EQUAL? RARG,M-OBJDESC /TRUE
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L3
	PRINTR "The closet has no door."
?L3:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTI "It looks as if the door was torn off its hinges a long time ago. "
	RFALSE
?L6:	EQUAL? PRSA,V?BOARD,V?THROUGH \FALSE
	CALL BEDROOM-W
	RTRUE

	.FUNCT WET-SUIT-F
	EQUAL? PRSA,V?DISEMBARK,V?THROW,V?DROP \?L1
	FSET? AIR-TANK,WORNBIT /?L3
	FSET? FLIPPERS,WORNBIT /?L3
	FSET? MASK,WORNBIT \?L1
?L3:	CALL TELL-YOU-CANT,STR?244 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?WEAR \FALSE
	FSET? DEEP-SUIT,WORNBIT \FALSE
	CALL TELL-YOU-CANT,STR?245,0
	CALL DPRINT,DEEP-SUIT
	PRINTR "."

	.FUNCT FLIPPERS-F
	EQUAL? PRSA,V?WEAR \FALSE
	FSET? WET-SUIT,WORNBIT /FALSE
	FSET? DEEP-SUIT,WORNBIT \?L5
	PRINTI "They don't fit with the "
	CALL DPRINT,DEEP-SUIT
	PRINTR "."
?L5:	PRINTI "The "
	CALL DPRINT,WET-SUIT
	PRINTR " won't fit over them."

	.FUNCT MASK-F
	EQUAL? PRSA,V?WEAR \?L1
	FSET? WET-SUIT,WORNBIT /FALSE
	FSET? DEEP-SUIT,WORNBIT \?L5
	PRINTI "It won't fit over the "
	CALL DPRINT,DEEP-SUIT
	PRINTR "'s hood."
?L5:	PRINTI "You couldn't fit the "
	CALL DPRINT,WET-SUIT
	PRINTR " over it."
?L1:	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \FALSE
	FSET? MASK,WORNBIT \FALSE
	EQUAL? PRSA,V?DISEMBARK,V?THROW,V?DROP \FALSE
	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK \FALSE
	CALL PRINT-ID,STR?246
	CALL JIGS-UP,STR?247 >STACK
	RSTACK

	.FUNCT AIR-TANK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This double tank made of aluminum is designed to fit over a "
	CALL DPRINT,WET-SUIT
	PRINTI ". Its gauge is currently at "
	GRTR? AIR-LEFT,150 \?L5
	PRINTI "full"
	JUMP ?L18
?L5:	GRTR? AIR-LEFT,100 \?L9
	PRINTI "fairly full"
	JUMP ?L18
?L9:	GRTR? AIR-LEFT,50 \?L12
	PRINTI "medium"
	JUMP ?L18
?L12:	GRTR? AIR-LEFT,15 \?L15
	PRINTI "almost empty"
	JUMP ?L18
?L15:	PRINTI "empty"
?L18:	PRINTR "."
?L1:	EQUAL? PRSA,V?FILL \?L23
	EQUAL? PRSI,COMPRESSOR /?L26
	EQUAL? PRSI,AIR \?L24
	IN? COMPRESSOR,HERE \?L24
?L26:	GETP COMPRESSOR,P?NORTH >STACK
	GRTR? STACK,0 \?L27
	PRINTR "The salesman tells you to rent the compressor first."
?L27:	FSET? AIR-TANK,WORNBIT \?L31
	CALL TELL-CONTORT >STACK
	RSTACK
?L31:	SET 'AIR-LEFT,160
	CALL TELL-NOW,AIR-TANK,STR?248 >STACK
	RSTACK
?L24:	EQUAL? PRSI,MM-COMPRESSOR \?L33
	PRINTR "There's no way to get air from this compressor to the tank."
?L33:	EQUAL? PRSI,AIR \FALSE
	PRINTR "The right compressor would probably help."
?L23:	EQUAL? PRSA,V?EMPTY \?L40
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L41
	CALL PRINT-ID,STR?249
	CALL JIGS-UP,STR?250 >STACK
	RSTACK
?L41:	ZERO? AIR-LEFT \?L43
	CALL TELL-ALREADY,STR?175 >STACK
	RSTACK
?L43:	SET 'AIR-LEFT,0
	CALL TELL-NOW,AIR-TANK,STR?175 >STACK
	RSTACK
?L40:	EQUAL? PRSA,V?WEAR \?L45
	FSET? WET-SUIT,WORNBIT /FALSE
	FSET? DEEP-SUIT,WORNBIT \?L48
	PRINTI "This tank can't be worn with a "
	CALL DPRINT,DEEP-SUIT
	PRINTR "."
?L48:	PRINTI "This tank should be worn outside a "
	CALL DPRINT,WET-SUIT
	PRINTR "."
?L45:	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \FALSE
	EQUAL? PRSA,V?THROW,V?DROP \FALSE
	FSET? DEEP-SUIT,WORNBIT /FALSE
	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK \FALSE
	CALL PRINT-ID,STR?251
	CALL JIGS-UP,STR?252 >STACK
	RSTACK

	.FUNCT MCGINTY-HQ-F,RARG,DEST
	EQUAL? RARG,M-ENTER \?L1
	PUTP LOCKED-DOOR,P?SDESC,STR?229
	PUTP GLOBAL-SURFACE,P?SDESC,STR?253
	CALL MOVE-SHARED-OBJECTS,MCGINTY-HQ
	RFALSE
?L1:	EQUAL? RARG,M-FLASH \?L3
	ZERO? MCGINTY-HQ-OCCUPIED /?L4
	IN? PASSBOOK,PLAYER /?L6
	CALL MCGINTY-F,M-OBJDESC
	CRLF
?L6:	CALL PRINT-ID,STR?254
	CALL JIGS-UP,STR?255 >STACK
	RSTACK
?L4:	IN? MCGINTY,MCGINTY-HQ \FALSE
	GET GOAL-TABLES,MCGINTY-C >STACK
	GET STACK,GOAL-S >DEST
	EQUAL? DEST,0,WHARF-ROAD-2 /FALSE
	CALL MCGINTY-ERRAND >STACK
	RSTACK
?L3:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSO,GLOBAL-SURFACE \FALSE
	EQUAL? PRSA,V?OPEN \?L14
	PRINTR "It's locked."
?L14:	EQUAL? PRSA,V?UNLOCK \?L18
	CALL TELL-NO-KEY >STACK
	RSTACK
?L18:	EQUAL? PRSA,V?CLOSE \FALSE
	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK

	.FUNCT MCGINTY-HQ-S,PRINT?=1
	FSET? BACK-WINDOW,OPENBIT \?L1
	CALL TELL-THRU-WINDOW
	RETURN BACK-ALLEY-2
?L1:	EQUAL? PRSO,WINDOW \?L3
	ZERO? PRINT? /FALSE
	CALL TELL-CLOSED,STR?233
	RFALSE
?L3:	ZERO? PRINT? /FALSE
	PRINTI "The door is locked."
	CRLF
	RFALSE

	.FUNCT TELL-THRU-WINDOW
	PRINTI "You climb through the open window..."
	CRLF
	CRLF
	RTRUE

	.FUNCT MCGINTY-CHAIR-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?256
	RTRUE
?L1:	EQUAL? PRSA,V?PUT-ON \?L3
	PRINTR "It's too lopsided."
?L3:	EQUAL? PRSA,V?SIT-ON,V?CLIMB-ON \?L6
	CALL TELL-WHY-BOTHER >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's an impressively beat-up chair."

	.FUNCT STUBS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The floor is littered with stubs from cheap cigars."
?L1:	EQUAL? PRSA,V?SMELL \?L5
	PRINTR "The aroma is reminiscent of burning tires."
?L5:	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "You think twice and realize you don't want to carry a used cigar."

	.FUNCT ENVELOPE-F,L
	EQUAL? PRSA,V?LOOK-UNDER,V?TAKE,V?OPEN \?L1
	EQUAL? HERE,MCGINTY-HQ \?L1
	IN? MCGINTY,MCGINTY-HQ \?L1
	IN? ENVELOPE,PLAYER /?L1
	CALL DPRINT,MCGINTY
	PRINTI " squeals angrily. ""Keep your hands off of my private papers!"""
	CRLF
	CALL PRINT-ID,STR?257 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?TAKE \?L5
	IN? WEASEL,HERE \?L5
	CALL WEASEL-BEATS-YOU >STACK
	RSTACK
?L5:	IN? ENVELOPE,UNDER-BUNK \?L6
	EQUAL? PRSA,V?ASK-ABOUT,V?TELL,V?TAKE /?L6
	PRINTI "It's hidden under the mattress."
	CRLF
	EQUAL? PRSA,V?TAKE /?L9
	PUSH 0
	JUMP ?L10
?L9:	PUSH 1
?L10:	CALL PRINT-ID,STR?258,STACK >STACK
	RSTACK
?L6:	IN? ENVELOPE,PLAYER /?L11
	LOC ENVELOPE >L
	FSET? L,PERSON \?L11
	EQUAL? PRSA,V?OPEN \?L11
	CALL START-SENTENCE,L
	PRINTI " tells you to keep your hands off it."
	CRLF
	CALL PRINT-ID,STR?259 >STACK
	RSTACK
?L11:	FSET? ENVELOPE,RMUNGBIT \FALSE
	EQUAL? PRSA,V?EXAMINE \?L15
	PRINTI "It's a soggy "
	CALL DPRINT,ENVELOPE
	PRINTR "."
?L15:	EQUAL? PRSA,V?READ \FALSE
	CALL TELL-SOGGY >STACK
	RSTACK

	.FUNCT OUTFITTERS-HQ-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	MOVE SPEAR-CARRIER,OUTFITTERS-HQ
	PUTP SPEAR-CARRIER,P?SDESC,STR?260
	PUTP SPEAR-CARRIER,P?LDESC,STR?261
	PUTP GLOBAL-SURFACE,P?SDESC,STR?238
	CALL MOVE-SHARED-OBJECTS,OUTFITTERS-HQ
	CALL QUEUED?,I-EQUIP >STACK
	ZERO? STACK /FALSE
	IN? MCGINTY,OUTFITTERS-HQ /FALSE
	SET 'I-WAIT-DURATION,9
	SET 'I-WAIT-RTN,I-EQUIP
	RFALSE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PSEUDO-OBJECT,PRSO,PRSI \?L7
	CALL MERCHANDISE-PSEUDO >STACK
	RSTACK
?L7:	EQUAL? PRSO,SALVAGER,TRAWLER \?L9
	EQUAL? PRSA,V?RENT \?L10
	ZERO? JOHNNY-MADE-DEAL /?L12
	EQUAL? SHIP-CHOSEN,PRSO \?L12
	PRINTR """Johnny already took care of that."""
?L12:	CALL TELL-YOU-CANT,STR?262 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?ASK-ABOUT,V?FIND,V?BUY /FALSE
	EQUAL? PRSA,V?ASK-CONTEXT-ABOUT /FALSE
	CALL GLOBAL-NOT-HERE-PRINT,PRSO >STACK
	RSTACK
?L9:	EQUAL? PRSI,SALVAGER,TRAWLER \?L20
	EQUAL? PRSA,V?TELL,V?ASK-ABOUT /FALSE
	CALL GLOBAL-NOT-HERE-PRINT,PRSI >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?RENT,V?BUY \?L24
	ZERO? AMT-OWED /?L24
	PRINTI "The salesman looks sorry. ""I can't sell you anything until you pay the $"
	PRINTN AMT-OWED
	PRINTI " of "
	CALL DPRINT,JOHNNY
	PRINTR "'s."""
?L24:	EQUAL? PRSA,V?TAKE \?L27
	GETP PRSO,P?NORTH >STACK
	EQUAL? STACK,-1 \?L27
	ZERO? JOHNNY-MADE-DEAL /?L27
	ZERO? DELIVERY-MADE \?L27
	IN? PRSO,PLAYER /?L27
	PRINTR "The salesman says, ""Don't bother. It'll be delivered to the ship."""
?L27:	EQUAL? PRSA,V?LAMP-ON,V?OPEN \FALSE
	GETP PRSO,P?NORTH >STACK
	GRTR? STACK,0 \FALSE
	PRINTI "The salesman stops you. ""You want to play with it, you buy it."""
	CRLF
	CALL PRINT-ID,STR?263 >STACK
	RSTACK

	.FUNCT MERCHANDISE-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?264
	RTRUE
?L1:	CALL TELL-REFER-INDIVIDUAL,STR?265
	RETURN 2

	.FUNCT OUT-OF-STOCK-F
	EQUAL? PRSA,V?BUY \?L1
	PRINTI "The salesman checks and says, "
	CALL TELL-WERE-OUT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?ASK-ABOUT \?L5
	EQUAL? HERE,OUTFITTERS-HQ \FALSE
	CALL TELL-WERE-OUT >STACK
	RSTACK
?L5:	EQUAL? PRSO,SPEAR-GUN /?L10
	EQUAL? PRSI,SPEAR-GUN \?L9
?L10:	CALL GLOBAL-NOT-HERE-PRINT,SPEAR-GUN >STACK
	RSTACK
?L9:	EQUAL? PRSO,COMPASS /?L12
	EQUAL? PRSI,COMPASS \?L11
?L12:	CALL GLOBAL-NOT-HERE-PRINT,COMPASS >STACK
	RSTACK
?L11:	CALL GLOBAL-NOT-HERE-PRINT,WINCH >STACK
	RSTACK

	.FUNCT TELL-WERE-OUT
	PRINTR """We're out of those. Try next week."""

	.FUNCT DRY-CELL-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "The "
	FSET? DRY-CELL,RMUNGBIT \?L5
	PRINTI "corroded "
?L5:	CALL DPRINT,DRY-CELL
	PRINTI " reads "
	RFALSE

	.FUNCT NET-F
	EQUAL? PRSA,V?THROW-OFF,V?PUT-ON \FALSE
	EQUAL? PRSO,NET \FALSE
	MOVE NET,HERE
	PRINTR "It slides off."

	.FUNCT BATTERY-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "The "
	FSET? BATTERY,RMUNGBIT \?L5
	PRINTI "corroded"
	JUMP ?L9
?L5:	PRINTI "standard"
?L9:	PRINTI " battery reads "
	RFALSE

	.FUNCT TUBE-F
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,TUBE \?L1
	PRINTR "The tube refuses to accept anything."
?L1:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L5
	EQUAL? PRSI,GLASS-CASE \?L5
	FSET? TUBE,OPENBIT \?L5
	IN? PUTTY,TUBE \?L5
	CALL PERFORM,V?PUT-ON,PUTTY,GLASS-CASE
	RTRUE
?L5:	EQUAL? PRSA,V?SQUEEZE \FALSE
	FSET? PRSO,OPENBIT \?L11
	IN? PUTTY,PRSO \?L7
	MOVE PUTTY,WINNER
	PRINTR "You are now holding some putty."
?L7:	FSET? PRSO,OPENBIT \?L11
	PRINTR "The tube is apparently empty."
?L11:	CALL TELL-CLOSED,STR?266 >STACK
	RSTACK

	.FUNCT PUTTY-F
	CALL COMPILER-SUCKS-EXP >STACK
	ZERO? STACK /?L1
	IN? PUTTY,GLASS-CASE \?L3
	CALL TELL-IN-CRACK >STACK
	RSTACK
?L3:	MOVE PUTTY,GLASS-CASE
	CALL INT,I-CASE-LEAK >STACK
	PUT STACK,0,0
	PRINTI "The putty seals the crack"
	IN? HOLE-1,GLASS-CASE /?L10
	IN? HOLE-2,GLASS-CASE \?L8
?L10:	PRINTI " and hole"
	JUMP ?L13
?L8:	SET 'NO-HOLE-PLUGGED,1
?L13:	PRINTI " in the "
	CALL DPRINT,GLASS-CASE
	PRINTR "."
?L1:	IN? PUTTY,GLASS-CASE \?L16
	EQUAL? PRSA,V?FIND,V?EXAMINE /?L16
	CALL TELL-IN-CRACK >STACK
	RSTACK
?L16:	EQUAL? PRSA,V?OIL \?L19
	EQUAL? PRSI,PUTTY /?L18
?L19:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,PUTTY \FALSE
?L18:	EQUAL? PRSI,TUBE \?L20
	CALL TELL-YOU-CANT,STR?267 >STACK
	RSTACK
?L20:	PRINTR "It isn't a lubricant."

	.FUNCT COMPILER-SUCKS-EXP
	EQUAL? PRSA,V?PUT-ON,V?PUT \?L1
	EQUAL? PRSI,GLASS-CASE /TRUE
	EQUAL? PRSI,HOLE-1 \?L4
	IN? HOLE-1,GLASS-CASE /TRUE
?L4:	EQUAL? PRSI,HOLE-2 \?L1
	IN? HOLE-2,GLASS-CASE /TRUE
?L1:	EQUAL? PRSA,V?PLUG,V?FILL \FALSE
	EQUAL? PRSO,GLASS-CASE /TRUE
	EQUAL? PRSO,HOLE-1 \?L7
	IN? HOLE-1,GLASS-CASE /TRUE
?L7:	EQUAL? PRSO,HOLE-2 \FALSE
	IN? HOLE-2,GLASS-CASE \FALSE
	RTRUE

	.FUNCT TELL-IN-CRACK
	PRINTR "The putty is already set in the crack."

	.FUNCT INFIDEL-BOX-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "This is state-of-the-art electronic equipment that automatically determines longitude and latitude when its button is pressed."
?L1:	EQUAL? PRSA,V?PUSH \FALSE
	PRINTR "Nothing happens, probably because you're indoors."

	.FUNCT DIVING-BOOK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? DIVING-BOOK,RMUNGBIT \?L3
	CALL TELL-SOGGY >STACK
	RSTACK
?L3:	PRINTR "This book is ""Everything About Diving"" by Fritz Zamboni."
?L1:	EQUAL? PRSA,V?OPEN,V?READ \FALSE
	FSET? DIVING-BOOK,RMUNGBIT \?L9
	CALL TELL-SOGGY >STACK
	RSTACK
?L9:	PRINTR "It says nothing you don't already know."

	.FUNCT TELL-SOGGY
	PRINTR "It's too soggy."

	.FUNCT MAGNET-F,RARG=0,F,N,OBJ
	EQUAL? RARG,M-CONT \?L1
	EQUAL? PRSA,V?WEAR,V?TAKE \?L3
	EQUAL? PRSO,MINE /?L3
	ZERO? MAGNET-ON /?L3
	PRINTR "The magnet's stronger than you are."
?L3:	EQUAL? PRSA,V?THROW,V?DROP \FALSE
	PRINTR "It's stuck to the magnet."
?L1:	EQUAL? RARG,M-OBJDESC \?L11
	PRINTI "There is a "
	CALL DPRINT,MAGNET
	PRINTI " here."
	CRLF
	FIRST? MAGNET >F \TRUE
	EQUAL? F,MINE /TRUE
	ZERO? MAGNET-ON /?L18
	PRINTI "Attached to the magnet "
	NEXT? F >STACK \?L21
	PRINTI "are"
	JUMP ?L25
?L21:	PRINTI "is"
?L25:	PRINTI " "
	CALL PRINT-CONTENTS,MAGNET
	PRINTR "."
?L18:	CALL DESCRIBE-OBJECT,F,1,0
	RTRUE
?L11:	EQUAL? PRSA,V?EXAMINE \?L34
	ZERO? MAGNET-ON /?L35
	FIRST? MAGNET >STACK \?L35
	PRINTI "The "
	CALL DPRINT,MAGNET
	PRINTI " is on and has "
	CALL PRINT-CONTENTS,MAGNET
	PRINTI " attached to it."
	CRLF
	SET 'P-IT-OBJECT,MAGNET
	RETURN P-IT-OBJECT
?L35:	PRINTI "The "
	CALL DPRINT,MAGNET
	PRINTI " has a switch which is currently "
	ZERO? MAGNET-ON /?L44
	PRINTI "on"
	JUMP ?L48
?L44:	PRINTI "off"
?L48:	PRINTR "."
?L34:	EQUAL? PRSA,V?LAMP-ON \?L53
	ZERO? MAGNET-ON /?L54
	CALL TELL-ALREADY,STR?69 >STACK
	RSTACK
?L54:	SET 'MAGNET-ON,1
	CALL TELL-NOW,MAGNET,STR?69
	CALL ATTRACTION >STACK
	RSTACK
?L53:	EQUAL? PRSA,V?LAMP-OFF \?L57
	ZERO? MAGNET-ON /?L58
	SET 'MAGNET-ON,0
	CALL TELL-NOW,MAGNET,STR?268,0
	FIRST? MAGNET >F \?L63
	CALL TELL-ALL-FALL
?L62:	ZERO? F /?L63
	NEXT? F >N /?L67
?L67:	MOVE F,HERE
	EQUAL? F,MINE \?L68
	FSET MINE,RMUNGBIT
	CRLF
	PRINTI "The mine drifts harmlessly into a corner."
?L68:	SET 'F,N
	JUMP ?L62
?L63:	CRLF
	RTRUE
?L58:	CALL TELL-ALREADY,STR?269 >STACK
	RSTACK
?L57:	EQUAL? PRSA,V?THROW,V?DROP \?L75
	IN? MINE,MAGNET \?L76
	ZERO? MAGNET-ON /?L78
	FSET MINE,RMUNGBIT
	RFALSE
?L78:	MOVE MINE,HERE
	RFALSE
?L76:	ZERO? MAGNET-ON \FALSE
	CALL CLEAR-MAGNET
	RFALSE
?L75:	EQUAL? PRSA,V?TAKE \?L83
	EQUAL? PRSO,MAGNET \?L83
	IN? MINE,MAGNET \FALSE
	CALL BOOM >STACK
	RSTACK
?L83:	EQUAL? PRSA,V?PUT-AGAINST,V?PUT-ON \?L89
	EQUAL? PRSO,MAGNET \?L89
	SET 'OBJ,PRSI
	ZERO? OBJ \?L88
?L89:	EQUAL? PRSA,V?RUB \FALSE
	EQUAL? PRSI,MAGNET \FALSE
	SET 'OBJ,PRSO
	ZERO? OBJ /FALSE
?L88:	FSET? OBJ,SURFACEBIT \?L90
	CALL CLEAR-MAGNET
	RFALSE
?L90:	ZERO? MAGNET-ON \?L93
	EQUAL? OBJ,ME /?L93
	GETP OBJ,P?CHARACTER >STACK
	ZERO? STACK /?L92
?L93:	CALL TELL-WHY-BOTHER >STACK
	RSTACK
?L92:	IN? OBJ,PLAYER \?L94
	PRINTI "The magnet is touching "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR "."
?L94:	FIRST? MAGNET >F \?L100
	MOVE F,HERE
?L100:	LOC OBJ >N
	EQUAL? N,0,GLOBAL-OBJECTS,LOCAL-GLOBALS /?L103
	MOVE OBJ,MAGNET
?L103:	CALL TELL-NOW,MAGNET,STR?270,0
	CALL THE?,OBJ
	CALL DPRINT,OBJ
	PRINTR "."

	.FUNCT TELL-NOW,OBJ,STR,FINISH?=1
	PRINTI "The "
	CALL DPRINT,OBJ
	PRINTI " is now "
	PRINT STR
	ZERO? FINISH? /FALSE
	PRINTR "."

	.FUNCT ATTRACTION,F,N
	FIRST? HERE >F /?L1
?L1:	FIRST? MAGNET >N \?L2
	GETP N,P?STATION >STACK
	ZERO? STACK /?L4
	FSET? N,TAKEBIT /?L2
?L4:	MOVE N,HERE
?L2:	ZERO? F /TRUE
	NEXT? F >N /?L11
?L11:	FSET? F,INVISIBLE /?L12
	GETP F,P?STATION >STACK
	ZERO? STACK /?L12
	FSET? F,TAKEBIT \?L12
	EQUAL? F,MAGNET /?L12
	MOVE F,MAGNET
	EQUAL? F,IRON-BAR \?L14
	EQUAL? HERE,WRECK-5 \?L14
	CALL PRINT-ID,STR?271
	CALL JIGS-UP,STR?272
?L14:	PRINTI "The "
	CALL DPRINT,F
	PRINTI " jumps to the magnet."
	EQUAL? F,MINE \?L19
	PRINTI " Unfortunately, even though the spikes are spaced widely apart, one gets pushed..."
	CRLF
	CRLF
	CALL BOOM
?L19:	CRLF
?L12:	SET 'F,N
	JUMP ?L2

	.FUNCT CLEAR-MAGNET,F,N
	FIRST? MAGNET >F /?L4
	RTRUE
?L1:	ZERO? F /TRUE
?L4:	NEXT? F >N /?L7
?L7:	MOVE F,HERE
	SET 'F,N
	JUMP ?L1

	.FUNCT FLASHLIGHT-F
	EQUAL? PRSA,V?LAMP-ON \?L1
	FSET? FLASHLIGHT,ONBIT \?L3
	CALL TELL-ALREADY,STR?69 >STACK
	RSTACK
?L3:	FSET FLASHLIGHT,ONBIT
	CALL TELL-NOW,FLASHLIGHT,STR?69
	ZERO? LIT \TRUE
	CALL LIT?,HERE >LIT
	CRLF
	CALL V-LOOK
	RTRUE
?L1:	EQUAL? PRSA,V?LAMP-OFF \?L9
	FSET? FLASHLIGHT,ONBIT \?L10
	FCLEAR FLASHLIGHT,ONBIT
	CALL LIT?,HERE >LIT
	CALL TELL-NOW,FLASHLIGHT,STR?269 >STACK
	RSTACK
?L10:	CALL TELL-ALREADY,STR?269 >STACK
	RSTACK
?L9:	EQUAL? PRSA,V?EXAMINE \?L13
	PRINTI "The sealed, waterproof "
	CALL DPRINT,FLASHLIGHT
	PRINTI " is "
	FSET? FLASHLIGHT,ONBIT \?L16
	PRINTI "on"
	JUMP ?L20
?L16:	PRINTI "off"
?L20:	PRINTR "."
?L13:	EQUAL? PRSA,V?AIM \FALSE
	EQUAL? PRSO,FLASHLIGHT \FALSE
	FSET? FLASHLIGHT,ONBIT \FALSE
	PRINTI "The "
	CALL DPRINT,FLASHLIGHT
	PRINTI " is shining on "
	CALL THE?,PRSI
	CALL DPRINT,PRSI
	PRINTR "."

	.FUNCT SHARK-REPELLENT-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? SHARK-REPELLENT,OPENBIT \?L3
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L3:	FSET SHARK-REPELLENT,OPENBIT
	PRINTI "Opened."
	GETP HERE,P?LINE >STACK
	LESS? STACK,UNDERWATER-LINE-C /?L10
	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK /?L8
?L10:	CALL PRINT-ID,STR?273
	CALL JIGS-UP,STR?274
?L8:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE \?L12
	FSET? SHARK-REPELLENT,OPENBIT \?L13
	PRINTR "It can't be closed."
?L13:	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?EXAMINE \?L18
	PRINTI "The canister, which is "
	FSET? SHARK-REPELLENT,OPENBIT \?L21
	PRINTI "open"
	JUMP ?L25
?L21:	PRINTI "closed"
?L25:	PRINTR ", has a label which says, ""IMPORTANT: read this label!"""
?L18:	EQUAL? PRSA,V?READ \FALSE
	PRINTR "The label says: ""IMPORTANT: read this label!

SWANZO BRAND SHARK REPELLENT

This product will repel sharks, or your money back! Simply open the canister UNDERWATER. Works for 5 hours. WARNING: Fumes released in air may be hazardous to humans."""

	.FUNCT SHANTY-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	MOVE FOOD,SHANTY
	FSET FOOD,NDESCBIT
	SET 'SOUPS-ON,0
	MOVE DRINKING-WATER,SHANTY
	FSET DRINKING-WATER,NDESCBIT
	MOVE DRINK-OBJECT,SHANTY
	FSET DRINK-OBJECT,NDESCBIT
	PUTP DRINKING-WATER,P?SDESC,STR?275
	MOVE SPEAR-CARRIER,SHANTY
	PUTP SPEAR-CARRIER,P?SDESC,STR?276
	PUTP SPEAR-CARRIER,P?LDESC,STR?277
	LESS? PRESENT-TIME,541 \?L3
	CALL QUEUE,I-FIRST-MEETING,-1 >STACK
	PUT STACK,0,1
	RTRUE
?L3:	SET 'FM-CTR,5
	RETURN FM-CTR
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?YES \?L7
	EQUAL? FM-CTR,4 \?L7
	PRINT WARNING-STR
	CRLF
	SET 'FM-CTR,5
	CALL RATING-UPD,20
	CALL INT,I-FIRST-MEETING >STACK
	PUT STACK,0,0
	SET 'MEETINGS-COMPLETED,1
	RETURN MEETINGS-COMPLETED
?L7:	EQUAL? PRSA,V?NO \FALSE
	EQUAL? FM-CTR,4 \FALSE
	CALL TELL-NO-CONTINUE
	CALL I-PLOT-NEVER-STARTS
	SET 'JOHNNY-SILENT,1
	CALL INT,I-FIRST-MEETING >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT TELL-NO-CONTINUE
	PRINTI "The three men look at each other in disbelief. ""If you wanna ignore the chance of a lifetime, you're nuts,"" "
	CALL DPRINT,WEASEL
	PRINTI " states. Johnny says, ""We'll find someone else."" They then ignore you."
	CRLF
	CALL PRINT-ID,STR?278 >STACK
	RSTACK

	.FUNCT PARROT-F
	EQUAL? WINNER,PARROT \?L1
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	EQUAL? PRSA,V?HELLO \?L3
	CALL PICK-ONE,PARROTISMS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L3:	EQUAL? PRSA,V?FIND \?L7
	EQUAL? PRSO,ME \?L7
	PRINTR """You're right here."""
?L7:	PRINTR """An interesting concept, but I am incapable."""
?L1:	EQUAL? PRSA,V?TELL \?L13
	ZERO? P-CONT \FALSE
?L13:	EQUAL? PRSA,V?FIND,V?EXAMINE /FALSE
	EQUAL? HERE,SHANTY \FALSE
	EQUAL? PRSA,V?LOOK-UNDER \?L16
	CALL TELL-NOTHING,STR?279,1 >STACK
	RSTACK
?L16:	EQUAL? PRSA,V?ASK-ABOUT \?L17
	EQUAL? PRSI,PARROT /FALSE
?L17:	CALL PICK-ONE,PARROTISMS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT PARROTS-PATCH-F
	EQUAL? PRSA,V?DISEMBARK,V?ASK-FOR,V?LOOK-UNDER /?L4
	EQUAL? PRSA,V?MOVE /?L4
	EQUAL? PRSA,V?TAKE \?L1
	ZERO? PRSI /?L4
	EQUAL? PRSI,PARROT \?L1
?L4:	PRINTI "Mind your manners."
	CRLF
	CALL PRINT-ID,STR?280 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a small black eyepatch."

	.FUNCT CHAIR-F,RARG=0,F
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?DISEMBARK \?L3
	EQUAL? PRSO,CHAIR \?L3
	LESS? FM-CTR,5 \?L3
	PRINTR "Johnny pushes you back. ""Can't you wait a few minutes?"""
?L3:	EQUAL? PRSA,V?YES \?L7
	EQUAL? FM-CTR,4 \?L7
	PRINT WARNING-STR
	CRLF
	SET 'FM-CTR,5
	CALL RATING-UPD,20
	CALL INT,I-FIRST-MEETING >STACK
	PUT STACK,0,0
	SET 'MEETINGS-COMPLETED,1
	RETURN MEETINGS-COMPLETED
?L7:	EQUAL? PRSA,V?NO \FALSE
	EQUAL? FM-CTR,4 \FALSE
	CALL TELL-NO-CONTINUE
	CALL I-PLOT-NEVER-STARTS
	CALL INT,I-FIRST-MEETING >STACK
	PUT STACK,0,0
	RTRUE
?L1:	EQUAL? PRSO,CHAIR \FALSE
	EQUAL? PRSA,V?BOARD \FALSE
	FIRST? CHAIR >F \?L15
	CALL TELL-NOT-COMFORTABLE >STACK
	RSTACK
?L15:	ZERO? FM-CTR \FALSE
	SET 'FM-CTR,1
	CALL INT,I-PLOT-NEVER-STARTS >STACK
	PUT STACK,0,0
	RFALSE

	.FUNCT FURNITURE-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?281
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "There are a number of tables and chairs here."

	.FUNCT BAR-F,F
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	PRINTR "Leave that to the management."
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	PRINTI "It is a worn wooden bar that has had more than its share of drinks on it. The parrot doesn't do it much good, either"
	FIRST? BAR >F \?L8
	PRINTI ". Sitting on the bar "
	NEXT? F >STACK \?L12
	PRINTI "are "
	JUMP ?L16
?L12:	PRINTI "is "
?L16:	CALL PRINT-CONTENTS,BAR
?L8:	PRINTR "."
?L5:	EQUAL? PRSA,V?LOOK-BEHIND \FALSE
	PRINTR "The bartender is there."

	.FUNCT MIRROR-F
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L1
	PRINTR "You see grime rather than a reflection."
?L1:	EQUAL? PRSA,V?CLEAN \?L5
	CALL TELL-CANT-REACH,STR?282
	CALL PRINT-ID,STR?283 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?MUNG \FALSE
	PRINTI "That would be unlucky."
	CRLF
	CALL PRINT-ID,STR?284 >STACK
	RSTACK

	.FUNCT FOOD-F
	EQUAL? PRSA,V?FIND \?L1
	ZERO? P-NONOUN /?L1
	EQUAL? P-XADJN,W?BEEF \?L1
	PRINTR "Gimme a break!"
?L1:	EQUAL? PRSA,V?BUY \?L5
	GETP HERE,P?LINE >STACK
	GRTR? STACK,BACK-ALLEY-LINE-C \?L6
	PRINTR "Free food is a benefit of this job."
?L6:	ZERO? HOW-HUNGRY \?L10
	CALL TELL-WAIT-HUNGRY >STACK
	RSTACK
?L10:	ZERO? SOUPS-ON /?L11
	PRINTR "You only need one meal at a time."
?L11:	LESS? POCKET-CHANGE,5 \?L14
	CALL TELL-NO-AFFORD >STACK
	RSTACK
?L14:	SUB POCKET-CHANGE,5 >POCKET-CHANGE
	SET 'SOUPS-ON,1
	MOVE FOOD,TABLE-OBJECT
	FCLEAR FOOD,NDESCBIT
	PRINTI "You have bought a meal for $5."
	CRLF
	CALL PRINT-ID,STR?285 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?EAT \?L18
	ZERO? SOUPS-ON /?L19
	ZERO? HOW-HUNGRY \?L21
	CALL TELL-WAIT-HUNGRY
	RTRUE
?L21:	CALL QUEUE,I-HUNGER,150 >STACK
	PUT STACK,0,1
	SET 'HOW-HUNGRY,0
	EQUAL? HERE,SHANTY \?L24
	SET 'SOUPS-ON,0
	FSET FOOD,NDESCBIT
	MOVE FOOD,SHANTY
?L24:	PRINTI "Not bad! It really hit the spot."
	CRLF
	CALL PRINT-ID,STR?286 >STACK
	RSTACK
?L19:	EQUAL? HERE,SHANTY \?L29
	PRINTI "You'll have to buy it before you can eat it."
	CRLF
	CALL PRINT-ID,STR?287 >STACK
	RSTACK
?L29:	PRINTR "You'll have to wait for Pete to finish fixing it."
?L18:	EQUAL? PRSA,V?SMELL \?L35
	PRINTR "It smells fairly tasty."
?L35:	EQUAL? PRSA,V?EXAMINE \?L38
	GETP HERE,P?LINE >STACK
	GRTR? STACK,BACK-ALLEY-LINE-C \?L39
	PRINTR "It looks like a pretty standard stew."
?L39:	ZERO? SOUPS-ON /?L43
	PRINTI "This stew is a staple of "
	CALL DPRINT,SHANTY
	PRINTR " and is edible."
?L43:	CALL GLOBAL-NOT-HERE-PRINT,PRSO >STACK
	RSTACK
?L38:	EQUAL? PRSA,V?FIND \FALSE
	IN? FOOD,TABLE-OBJECT \?L48
	PRINTR "It's on the table."
?L48:	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,SHANTY \FALSE
	PRINTR "You can order food here."

	.FUNCT TELL-WAIT-HUNGRY
	PRINTR "Wait until you're a little hungrier."

	.FUNCT DRINKING-WATER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	IN? DRINKING-WATER,TABLE-OBJECT \?L3
	PRINTR "It's a glass of water, what else?"
?L3:	EQUAL? HERE,MM-GALLEY,NW-GALLEY \?L7
	PRINTR "There's a tap in the sink which dispenses bottled water."
?L7:	PRINTR "You can ask the bartender for a glass."
?L1:	EQUAL? PRSA,V?DRINK \?L13
	IN? DRINKING-WATER,TABLE-OBJECT /?L16
	EQUAL? HERE,MM-GALLEY,NW-GALLEY \?L14
?L16:	GRTR? SLOSH-CTR,4 \?L17
	PRINTR "Are you trying to do an ocean imitation?"
?L17:	SET 'HOW-THIRSTY,0
	INC 'SLOSH-CTR
	CALL QUEUE,I-THIRST,180 >STACK
	PUT STACK,0,1
	MOVE DRINKING-WATER,HERE
	FSET DRINKING-WATER,NDESCBIT
	PUTP DRINKING-WATER,P?SDESC,STR?275
	PRINTI "You feel much refreshed."
	CRLF
	CALL PRINT-ID,STR?288 >STACK
	RSTACK
?L14:	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,SHANTY \FALSE
	CALL TELL-ASK-FIRST >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?BUY \?L26
	EQUAL? HERE,MM-GALLEY,NW-GALLEY \?L26
	CALL TELL-JUST >STACK
	RSTACK
?L26:	EQUAL? PRSA,V?TAKE \?L27
	IN? DRINKING-WATER,SHANTY \?L28
	CALL TELL-ASK-FIRST >STACK
	RSTACK
?L28:	CALL TELL-JUST >STACK
	RSTACK
?L27:	EQUAL? PRSA,V?FIND \FALSE
	IN? DRINKING-WATER,TABLE-OBJECT \?L32
	PRINTR "It's on the table."
?L32:	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,SHANTY \FALSE
	PRINTR "You can order water here."

	.FUNCT TELL-ASK-FIRST
	PRINTR "Ask the bartender for some water first."

	.FUNCT TELL-JUST
	PRINTR "Just drink it."

	.FUNCT DRINK-OBJECT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	IN? DRINK-OBJECT,TABLE-OBJECT \?L3
	PRINTR "It's grog which has left many staggering."
?L3:	CALL TELL-BUY-FIRST >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?BUY \?L8
	IN? DRINK-OBJECT,TABLE-OBJECT \?L9
	CALL TELL-YOU-ALREADY,STR?289 >STACK
	RSTACK
?L9:	LESS? POCKET-CHANGE,2 \?L11
	CALL TELL-NO-AFFORD >STACK
	RSTACK
?L11:	MOVE DRINK-OBJECT,TABLE-OBJECT
	FCLEAR DRINK-OBJECT,NDESCBIT
	SUB POCKET-CHANGE,2 >POCKET-CHANGE
	PRINTI "You have bought a drink for $2."
	CRLF
	CALL PRINT-ID,STR?290 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?DRINK \?L15
	IN? DRINK-OBJECT,TABLE-OBJECT \?L16
	MOVE DRINK-OBJECT,SHANTY
	CALL QUEUE,I-THIRST,90 >STACK
	PUT STACK,0,1
	SET 'HOW-THIRSTY,0
	FSET DRINK-OBJECT,NDESCBIT
	ADD BLOOD-ALCOHOL,6 >BLOOD-ALCOHOL
	PRINTR "It burns your throat on the way down."
?L16:	CALL TELL-BUY-FIRST >STACK
	RSTACK
?L15:	EQUAL? PRSA,V?TASTE \?L21
	IN? DRINK-OBJECT,TABLE-OBJECT /FALSE
	CALL TELL-BUY-FIRST >STACK
	RSTACK
?L21:	EQUAL? PRSA,V?FIND \FALSE
	IN? DRINK-OBJECT,TABLE-OBJECT \?L26
	PRINTR "It's on the table."
?L26:	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,SHANTY \FALSE
	PRINTR "You can order grog here."

	.FUNCT TELL-BUY-FIRST
	PRINTR "You'll have to order one first."

	.FUNCT NON-DRINK-F
	CALL TELL-YOUD-BETTER,STR?291 >STACK
	RSTACK

	.FUNCT BANK-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	MOVE SPEAR-CARRIER,BANK
	PUTP SPEAR-CARRIER,P?SDESC,STR?292
	PUTP SPEAR-CARRIER,P?LDESC,STR?293
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WITHDRAW \?L4
	EQUAL? PRSO,INTNUM \FALSE
	ZERO? P-DOLLAR-FLAG \?L8
	CALL TELL-YOU-CANT,STR?294 >STACK
	RSTACK
?L8:	LESS? P-AMOUNT,1 \?L9
	CALL TELL-SERIOUS >STACK
	RSTACK
?L9:	IN? PASSBOOK,PLAYER /?L10
	PRINTR "The teller points out that you don't have your passbook."
?L10:	GRTR? P-AMOUNT,PASSBOOK-BALANCE \?L13
	PRINTR "The teller takes your passbook, checks the balance, tells you that there's not enough to cover your planned withdrawal, and returns it."
?L13:	SUB PASSBOOK-BALANCE,P-AMOUNT >PASSBOOK-BALANCE
	ADD POCKET-CHANGE,P-AMOUNT >POCKET-CHANGE
	SET 'STUPID-PROBLEM-STRING,STR?295
	PRINTR "The teller takes your passbook, enters the withdrawal, hands you the money and your passbook, and says ""Have a good day."""
?L4:	EQUAL? PRSA,V?DEPOSIT \FALSE
	EQUAL? PRSI,0,GLOBAL-BANK /?L20
	CALL PERFORM,V?PUT,PRSO,PRSI
	RTRUE
?L20:	ZERO? P-DOLLAR-FLAG /?L23
	EQUAL? PRSO,INTNUM /?L22
?L23:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L24
	CALL TELL-DONT-HAVE,0
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR "."
?L24:	PRINTI "The teller looks at the "
	CALL DPRINT,PRSO
	PRINTR " and returns it, pointing out that you don't have a safe deposit box."
?L22:	GRTR? P-AMOUNT,POCKET-CHANGE \?L31
	CALL TELL-YOU-CANT,STR?296 >STACK
	RSTACK
?L31:	LESS? P-AMOUNT,1 \?L32
	CALL TELL-SERIOUS >STACK
	RSTACK
?L32:	IN? PASSBOOK,PLAYER /?L33
	PRINTR "The teller points out that you need to have your passbook."
?L33:	ADD PASSBOOK-BALANCE,P-AMOUNT >PASSBOOK-BALANCE
	SUB POCKET-CHANGE,P-AMOUNT >POCKET-CHANGE
	SET 'STUPID-PROBLEM-STRING,STR?295
	PRINTI "The teller takes your money and passbook, records the deposit, returns the passbook, and says ""Thank you for banking at "
	CALL DPRINT,BANK
	PRINTR "."""

	.FUNCT RIDICULOUS-MONEY-KLUDGE-F
	EQUAL? PRSA,V?ASK-ABOUT /FALSE
	EQUAL? PRSA,V?COUNT,V?FIND \?L3
	CALL PERFORM,PRSA,GLOBAL-MONEY
	RTRUE
?L3:	PRINTR "You should specify an amount."

	.FUNCT VAULT-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,BANK /?L1
	CALL GLOBAL-NOT-HERE-PRINT,SAFE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L3
	PRINTR "The safe is behind the teller's window and is mostly empty."
?L3:	EQUAL? PRSA,V?FIND,V?ASK-ABOUT /FALSE
	PRINTR "There's no way you can get at the safe."

	.FUNCT POINT-LOOKOUT-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	EQUAL? MEETINGS-COMPLETED,2 \FALSE
	LESS? PRESENT-TIME,660 \FALSE
	CALL QUEUE,I-THIRD-MEETING,-1 >STACK
	PUT STACK,0,1
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?LEAP \?L7
	CALL PRINT-ID,STR?297
	CALL JIGS-UP,STR?298 >STACK
	RSTACK
?L7:	GRTR? TM-CTR,0 \?L9
	LESS? TM-CTR,6 \?L9
	EQUAL? PRSA,V?YES \?L10
	PRINTR """That's nice, but I'd like to see it."""
?L10:	EQUAL? PRSA,V?NO \?L14
	SET 'TM-CTR,4
	CALL I-THIRD-MEETING >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?WALK \?L15
	PRINTR "Johnny puts a hand on your shoulder. ""Not so fast, matey."""
?L15:	EQUAL? PRSA,V?SHOW \?L18
	EQUAL? PRSI,JOHNNY \?L18
	EQUAL? PRSO,GLOBAL-MONEY /?L21
	EQUAL? PRSO,INTNUM \?L19
	ZERO? P-DOLLAR-FLAG /?L19
?L21:	FSET? WET-SUIT,WORNBIT /?L22
	FSET? DEEP-SUIT,WORNBIT \?L19
?L22:	CALL TELL-CANT-REACH,STR?299
	RTRUE
?L19:	EQUAL? PRSO,GLOBAL-MONEY \?L30
	SET 'P-AMOUNT,0
	EQUAL? PRSO,GLOBAL-MONEY \?L30
	GRTR? POCKET-CHANGE,499 /?L29
?L30:	EQUAL? PRSO,INTNUM \?L27
	ZERO? P-DOLLAR-FLAG /?L27
	GRTR? P-AMOUNT,499 \?L27
	GRTR? P-AMOUNT,POCKET-CHANGE /?L27
?L29:	SET 'TM-CTR,5
	PRINTR "He smiles and flashes a wad that represents the contributions of your three partners."
?L27:	EQUAL? PRSO,GLOBAL-MONEY /?L34
	EQUAL? PRSO,INTNUM \FALSE
	ZERO? P-DOLLAR-FLAG /FALSE
?L34:	GRTR? P-AMOUNT,POCKET-CHANGE \?L35
	PRINTR "You haven't got that much to show him."
?L35:	CALL PRINT-ID,STR?300
	CALL JIGS-UP,STR?301 >STACK
	RSTACK
?L18:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,JOHNNY \FALSE
	EQUAL? PRSO,GLOBAL-MONEY \?L48
	SET 'P-AMOUNT,0
	EQUAL? PRSO,GLOBAL-MONEY \?L48
	GRTR? POCKET-CHANGE,499 /?L47
?L48:	EQUAL? PRSO,INTNUM \?L49
	ZERO? P-DOLLAR-FLAG /?L49
	GRTR? P-AMOUNT,499 \?L49
	GRTR? P-AMOUNT,POCKET-CHANGE /?L49
?L47:	FSET? DEEP-SUIT,WORNBIT /?L49
	FSET? WET-SUIT,WORNBIT /?L49
	PRINTI "Johnny examines your money and returns it. ""You hold it. I needed to make sure you had it."" "
?L49:	EQUAL? PRSO,GLOBAL-MONEY /?L57
	EQUAL? PRSO,INTNUM \FALSE
	ZERO? P-DOLLAR-FLAG /FALSE
?L57:	GRTR? P-AMOUNT,POCKET-CHANGE \?L58
	CALL TELL-YOU-CANT,STR?302 >STACK
	RSTACK
?L58:	CALL PERFORM,V?SHOW,PRSO,JOHNNY
	RTRUE
?L9:	EQUAL? TM-CTR,7 \FALSE
	EQUAL? PRSA,V?YES \?L64
	SET 'SHIP-CHOSEN,SALVAGER
	SET 'TM-CTR,8
	RTRUE
?L64:	EQUAL? PRSA,V?NO \?L66
	SET 'SHIP-CHOSEN,TRAWLER
	SET 'TM-CTR,8
	RTRUE
?L66:	EQUAL? PRSA,V?MAYBE \?L67
	PRINTI """A wise guy, huh?"" "
	RTRUE
?L67:	EQUAL? PRSA,V?WALK \FALSE
	PRINTI """Let's finish here first, huh?"" "
	RTRUE

	.FUNCT CLIFF-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?303
	RTRUE
?L1:	EQUAL? PRSA,V?THROW-OFF \?L3
	CALL PERFORM,V?THROW,PRSO,OCEAN
	RTRUE
?L3:	EQUAL? PRSA,V?DISEMBARK \FALSE
	CALL PERFORM,V?LEAP >STACK
	RSTACK

	.FUNCT WHARF-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You're on Hardscrabble Island's weatherbeaten wharf, north of the "
	CALL DPRINT,WHARF-ROAD-1
	PRINTI "."
	ZERO? TRAWLER-DOCKED /?L5
	PRINTI " A trawler called the "
	CALL DPRINT,TRAWLER
	PRINTI " is berthed here to the west."
?L5:	ZERO? SALVAGER-DOCKED /?L10
	PRINTI " The "
	CALL DPRINT,SALVAGER
	PRINTI " is moored to the east."
?L10:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROUGH,V?BOARD \FALSE
	EQUAL? PRSO,TRAWLER \?L18
	CALL DO-WALK,P?WEST
	RTRUE
?L18:	EQUAL? PRSO,SALVAGER \FALSE
	CALL DO-WALK,P?EAST
	RTRUE

	.FUNCT FERRY-F
	EQUAL? PRSA,V?CLIMB-ON,V?THROUGH,V?BOARD \?L1
	IN? FERRY,FERRY-LANDING \?L3
	EQUAL? HERE,FERRY-LANDING \?L5
	CALL TELL-CANT-BOARD >STACK
	RSTACK
?L5:	CALL TELL-YOURE-NOT,STR?304 >STACK
	RSTACK
?L3:	PRINTR "It's not at the landing. Be patient."
?L1:	EQUAL? PRSA,V?WALK-TO \?L11
	EQUAL? HERE,FERRY-LANDING /?L11
	CALL TELL-SHD-DIR >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?LISTEN \FALSE
	PRINTR "You hear its engines."

	.FUNCT TELL-CANT-BOARD
	CALL TELL-DONT-HAVE,STR?305 >STACK
	RSTACK

	.FUNCT GLOBAL-FERRY-F
	EQUAL? PRSA,V?FIND,V?TELL,V?ASK-ABOUT /FALSE
	CALL GLOBAL-NOT-HERE-PRINT,GLOBAL-FERRY >STACK
	RSTACK

	.FUNCT MM-FORE-DECK-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	CALL TELL-FORE-END,SALVAGER >STACK
	RSTACK

	.FUNCT TELL-FORE-END,OBJ
	PRINTI "You are at the fore end of the "
	CALL DPRINT,OBJ
	PRINTR ". You can see the ocean over the rail that runs around the deck. A ladder leads below deck, and the wheelhouse is aft of you. A chair is bolted to the deck."

	.FUNCT DECK-CHAIR-F,RARG=0
	EQUAL? RARG,M-OBJDESC \?L1
	IN? PETE,DECK-CHAIR \TRUE
	CALL TELL-IN-CHAIR,PETE
	RTRUE
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?EXAMINE \?L7
	PRINTI "This weatherbeaten chair is used by a lookout while standing watch. It faces forward and is bolted to the deck. "
	IN? PETE,DECK-CHAIR \?L11
	CALL TELL-IN-CHAIR,PETE
?L11:	CRLF
	RTRUE
?L7:	EQUAL? PRSA,V?ASK-ABOUT \?L14
	PRINTR """It's the lookout's chair."""
?L14:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L17
	EQUAL? PRSI,DECK-CHAIR \?L17
	CALL IDROP >STACK
	ZERO? STACK /TRUE
	IN? PLAYER,DECK-CHAIR \?L20
	LOC DECK-CHAIR >STACK
	MOVE PRSO,STACK
?L20:	PRINTR "It slides off the chair and onto the deck."
?L17:	EQUAL? PRSA,V?BOARD \FALSE
	IN? PETE,DECK-CHAIR \FALSE
	CALL TELL-ALREADY,STR?306 >STACK
	RSTACK

	.FUNCT TELL-IN-CHAIR,OCC
	CALL START-SENTENCE,OCC
	PRINTR " is sitting in the chair."

	.FUNCT MM-PORT-DECK-F,RARG,DOCK?
	EQUAL? RARG,M-ENTER \?L1
	MOVE BUNK,MM-CREW-QTRS
	MOVE UNDER-BUNK,MM-CREW-QTRS
	MOVE STOVE,MM-GALLEY
	MOVE DECK-CHAIR,MM-FORE-DECK
	MOVE REDS-BUNK,MM-CAPT-CABIN
	MOVE LOUNGE-CHAIR,MM-LOUNGE
	IN? PETE,MM-GALLEY \?L3
	MOVE FOOD,STOVE
	FSET FOOD,NDESCBIT
?L3:	ZERO? WATER-DELIVERED /FALSE
	EQUAL? SHIP-CHOSEN,SALVAGER \FALSE
	MOVE DRINKING-WATER,MM-GALLEY
	FSET DRINKING-WATER,NDESCBIT
	RFALSE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	CALL TELL-FOO-SIDE,SALVAGER,STR?308,STR?307
	RTRUE

	.FUNCT TELL-FOO-SIDE,OBJ,SIDE,HOUSE,DOCK?
	PRINTI "You are on the "
	PRINT SIDE
	PRINTI " side of the "
	CALL DPRINT,OBJ
	PRINTI ", a sturdy vessel designed for "
	EQUAL? OBJ,TRAWLER \?L3
	PRINTI "trawling"
	JUMP ?L7
?L3:	PRINTI "deep-sea salvaging"
?L7:	PRINTI ". To "
	PRINT HOUSE
	PRINTI " is a small wheelhouse, while "
	EQUAL? OBJ,TRAWLER \?L12
	SET 'DOCK?,TRAWLER-DOCKED
	JUMP ?L14
?L12:	SET 'DOCK?,SALVAGER-DOCKED
?L14:	ZERO? DOCK? /?L15
	PRINTI "to "
	PRINT SIDE
	PRINTR " is the gangway leading to the dock. The gentle rocking of the boat in port reminds you of time spent on the open sea."
?L15:	PRINTI "the ocean, with its blue-green waves crashing, lies off the "
	PRINT SIDE
	PRINTR " rail."

	.FUNCT TELL-AFT-DECK
	PRINTI "The smell of diesel fuel is strong but reassuring here on the aft deck. A ladder leads below deck, while forward you can see the entrance to the command center of the boat, the wheelhouse."
	RTRUE

	.FUNCT MM-AFT-DECK-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	CALL TELL-AFT-DECK
	PRINTR " A huge air compressor is bolted to the deck by the aft rail."
?L1:	EQUAL? RARG,M-BEG \?L5
	EQUAL? PRSA,V?WALK \FALSE
	IN? AIR-HOSE,DEEP-SUIT \FALSE
	IN? DEEP-SUIT,PLAYER \FALSE
	PRINTI "You don't want to drag the "
	CALL DPRINT,AIR-HOSE
	PRINTR " around the boat."
?L5:	EQUAL? RARG,M-FLASH \FALSE
	IN? WEASEL,MM-AFT-DECK \FALSE
	ZERO? AT-SEA /FALSE
	ZERO? WEASEL-APPREHENDED \FALSE
	CALL QUEUED?,I-PENDULUM >STACK
	ZERO? STACK \FALSE
	CALL QUEUE,I-PENDULUM,-1 >STACK
	PUT STACK,0,1
	CALL TELL-WEASEL-TOSSES >STACK
	RSTACK

	.FUNCT TELL-WEASEL-TOSSES
	FCLEAR LINE-HACK,INVISIBLE
	LOC WEASEL >STACK
	MOVE LINE-HACK,STACK
	PRINTI "The Weasel tosses a line over the side and says, "
	PRINT LINE-STR
	CRLF
	RTRUE

	.FUNCT LINE-HACK-F,HOLDER=0
	LOC LINE-HACK >STACK
	IN? WEASEL,STACK \?L1
	SET 'HOLDER,WEASEL
	JUMP ?L3
?L1:	LOC LINE-HACK >STACK
	IN? JOHNNY,STACK \?L3
	SET 'HOLDER,JOHNNY
?L3:	EQUAL? PRSA,V?EXAMINE \?L5
	ZERO? HOLDER /?L7
	CALL START-SENTENCE,HOLDER
	PRINTI " is holding one end of a weighted "
	CALL DPRINT,LINE-HACK
	PRINTR "."
?L7:	PRINTI "One end of "
	CALL APRINT,LINE-HACK
	PRINTR " is here. Leave it alone."
?L5:	EQUAL? PRSA,V?ASK-ABOUT,V?FIND /FALSE
	ZERO? HOLDER /?L16
	CALL START-SENTENCE,HOLDER
	PRINTR " pulls it away. ""Don't mess with that!"""
?L16:	PRINTR "Leave it alone."

	.FUNCT MM-COMPRESSOR-F,TICK
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	CALL TELL-NO-NO >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUT \?L3
	EQUAL? PRSI,MM-COMPRESSOR \?L3
	PRINTR "There's no place to put it."
?L3:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTI "The large, gasoline-powered air compressor is "
	FSET? MM-COMPRESSOR,ONBIT \?L9
	PRINTI "on"
	JUMP ?L13
?L9:	PRINTI "off"
?L13:	PRINTI ". You can quickly see it "
	CALL INT,I-MM-COMPRESSOR >STACK
	GET STACK,C-TICK >TICK
	ZERO? TICK \?L18
	PRINTI "is out of fuel"
	JUMP ?L22
?L18:	EQUAL? TICK,80 \?L23
	PRINTI "has"
	JUMP ?L27
?L23:	PRINTI "started with"
?L27:	PRINTI " fuel for an hour and a half's operation"
?L22:	PRINTI ". A retractable "
	CALL DPRINT,AIR-HOSE
	PRINTR " is built in."
?L6:	EQUAL? PRSA,V?LAMP-ON \?L34
	FSET? MM-COMPRESSOR,ONBIT \?L35
	CALL TELL-ALREADY,STR?69 >STACK
	RSTACK
?L35:	CALL INT,I-MM-COMPRESSOR >STACK
	PUT STACK,0,1
	FSET MM-COMPRESSOR,ONBIT
	PRINTR "Okay. The compressor is on."
?L34:	EQUAL? PRSA,V?LAMP-OFF \?L40
	FSET? MM-COMPRESSOR,ONBIT \?L41
	CALL INT,I-MM-COMPRESSOR >STACK
	PUT STACK,0,0
	FCLEAR MM-COMPRESSOR,ONBIT
	CALL TELL-NOW,MM-COMPRESSOR,STR?269 >STACK
	RSTACK
?L41:	CALL TELL-ALREADY,STR?269 >STACK
	RSTACK
?L40:	EQUAL? PRSA,V?LISTEN \FALSE
	FSET? MM-COMPRESSOR,ONBIT \FALSE
	PRINTR "The compressor is making a steady loud noise."

	.FUNCT AIR-HOSE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	IN? AIR-HOSE,DEEP-SUIT \?L3
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L5
	PRINTI "This "
	CALL DPRINT,AIR-HOSE
	PRINTI " goes from the aft deck of the "
	CALL DPRINT,SALVAGER
	PRINTR " and ends at your diving suit. Without it, you would find breathing impossible."
?L5:	PRINTI "It connects the "
	CALL DPRINT,DEEP-SUIT
	PRINTI " and the "
	CALL DPRINT,MM-COMPRESSOR
	PRINTI " "
	EQUAL? HERE,MM-AFT-DECK \?L12
	PRINTI "here"
	JUMP ?L16
?L12:	PRINTI "on the aft deck"
?L16:	PRINTR "."
?L3:	PRINTI "It is designed to be connected to a "
	CALL DPRINT,DEEP-SUIT
	PRINTR " to provide air and is about 600 feet long."
?L1:	EQUAL? PRSA,V?TIE,V?PUT \?L24
	EQUAL? PRSI,DEEP-SUIT /?L25
	EQUAL? PRSO,DEEP-SUIT \?L24
?L25:	IN? AIR-HOSE,DEEP-SUIT \?L26
	CALL TELL-ALREADY,STR?309 >STACK
	RSTACK
?L26:	MOVE AIR-HOSE,DEEP-SUIT
	CALL TELL-NOW,AIR-HOSE,CONNECT-STR >STACK
	RSTACK
?L24:	EQUAL? PRSA,V?TAKE \?L29
	IN? AIR-HOSE,DEEP-SUIT \?L30
	CALL TELL-ALREADY,CONNECT-STR >STACK
	RSTACK
?L30:	PRINTI "Why drag it around? Just connect it to the "
	CALL DPRINT,DEEP-SUIT
	PRINTR "."
?L29:	EQUAL? PRSA,V?TIE \?L35
	CALL TELL-YOU-CANT,STR?310 >STACK
	RSTACK
?L35:	EQUAL? PRSA,V?UNTIE \?L36
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L37
	CALL PRINT-ID,STR?311
	CALL JIGS-UP,STR?312 >STACK
	RSTACK
?L37:	MOVE AIR-HOSE,MM-COMPRESSOR
	PRINTR "The hose retracts back to the compressor."
?L36:	EQUAL? PRSA,V?MOVE \?L42
	PRINTR "That was fun."
?L42:	EQUAL? PRSA,V?CLIMB-FOO \FALSE
	CALL TELL-YOU-CANT,STR?313 >STACK
	RSTACK

	.FUNCT TELL-WHEELHOUSE,OBJ
	PRINTI " Through the glass windows you see the "
	ZERO? AT-SEA /?L3
	PRINTR "ocean churning all around you."
?L3:	CALL DPRINT,OBJ
	PRINTR " docked at the wharf, and the island stretching aft. Forward, you see the choppy waters of the bay."

	.FUNCT MM-WHEELHOUSE-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are in the wheelhouse with a passageway leading out onto the deck abaft. You can see the "
	CALL DPRINT,MM-COMPRESSOR
	PRINTI " sitting there, taking up most of the aft deck."
	CALL TELL-WHEELHOUSE,TRAWLER
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? OCEAN,PRSO,PRSI \FALSE
	EQUAL? PRSA,V?EXAMINE \?L8
	PRINTR "You see the ocean through the window."
?L8:	EQUAL? PRSA,V?ASK-ABOUT,V?FIND /FALSE
	CALL TELL-YOU-CANT,STR?314 >STACK
	RSTACK

	.FUNCT COMPRESSOR-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?315
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	CALL TELL-YOU-CANT,STR?316 >STACK
	RSTACK
?L3:	CALL TELL-CANT-REACH,STR?317 >STACK
	RSTACK

	.FUNCT MM-LOCKER-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in a relatively empty locker."
	PRINT SPARE-PARTS-STR
	CRLF
	RTRUE

	.FUNCT METAL-DETECTOR-F,TMP
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The "
	CALL DPRINT,METAL-DETECTOR
	PRINTI "'s label is well-worn. It has a "
	CALL DPRINT,DETECTOR-SWITCH
	PRINTI " which is currently "
	ZERO? DETECTOR-ON /?L5
	PRINTI "on"
	JUMP ?L9
?L5:	PRINTI "off"
?L9:	PRINTI ", and a compartment on the side which is "
	FSET? DETECTOR-COMPARTMENT,OPENBIT \?L14
	PRINTI "open"
	FIRST? DETECTOR-COMPARTMENT >TMP \?L23
	PRINTI " and contains "
	CALL APRINT,TMP
	JUMP ?L23
?L14:	PRINTI "closed"
?L23:	PRINTR "."
?L1:	EQUAL? PRSA,V?LAMP-ON \?L28
	SET 'DETECTOR-ON,1
	CALL TELL-SWITCH,STR?69
	RTRUE
?L28:	EQUAL? PRSA,V?LAMP-OFF \?L29
	SET 'DETECTOR-ON,0
	CALL TELL-SWITCH,STR?269
	RTRUE
?L29:	EQUAL? PRSA,V?LISTEN \?L30
	CALL DETECTOR-NOISE,1
	RTRUE
?L30:	EQUAL? PRSA,V?PUT \?L31
	EQUAL? PRSI,METAL-DETECTOR \?L31
	CALL PERFORM,V?PUT,PRSO,DETECTOR-COMPARTMENT
	RTRUE
?L31:	EQUAL? PRSA,V?EMPTY,V?CLOSE,V?OPEN \?L32
	CALL PERFORM,PRSA,DETECTOR-COMPARTMENT
	SET 'P-IT-OBJECT,METAL-DETECTOR
	RTRUE
?L32:	EQUAL? PRSA,V?LOOK-INSIDE \?L33
	CALL PERFORM,V?EXAMINE,DETECTOR-COMPARTMENT
	SET 'P-IT-OBJECT,METAL-DETECTOR
	RTRUE
?L33:	EQUAL? PRSA,V?SHAKE \FALSE
	FSET? DETECTOR-COMPARTMENT,OPENBIT \?L35
	FIRST? DETECTOR-COMPARTMENT >STACK \?L35
	MOVE DRY-CELL,HERE
	SET 'DETECTOR-POWERED,0
	PRINTI "The "
	CALL DPRINT,DRY-CELL
	PRINTR " falls out of the machine."
?L35:	PRINTR "Nothing happens."

	.FUNCT DETECTOR-LABEL-F
	EQUAL? PRSA,V?TAKE \FALSE
	PRINTI "You tug at it, but it can't be pulled off."
	CRLF
	CALL PRINT-ID,STR?318
	RTRUE

	.FUNCT DETECTOR-SWITCH-F
	EQUAL? PRSA,V?EXAMINE \?L1
	ZERO? DETECTOR-ON /?L3
	CALL TELL-SWITCH,STR?69
	RTRUE
?L3:	CALL TELL-SWITCH,STR?269
	RTRUE
?L1:	EQUAL? PRSA,V?LAMP-ON \?L6
	CALL PERFORM,V?LAMP-ON,METAL-DETECTOR
	SET 'P-IT-OBJECT,DETECTOR-SWITCH
	RTRUE
?L6:	EQUAL? PRSA,V?LAMP-OFF \?L7
	CALL PERFORM,V?LAMP-OFF,METAL-DETECTOR
	SET 'P-IT-OBJECT,DETECTOR-SWITCH
	RTRUE
?L7:	EQUAL? PRSA,V?THROW,V?MOVE,V?TURN \FALSE
	ZERO? DETECTOR-ON /?L9
	CALL PERFORM,V?LAMP-OFF,METAL-DETECTOR
	JUMP ?L11
?L9:	CALL PERFORM,V?LAMP-ON,METAL-DETECTOR
?L11:	SET 'P-IT-OBJECT,DETECTOR-SWITCH
	RTRUE

	.FUNCT DETECTOR-COMPARTMENT-F,RARG=0
	EQUAL? RARG,M-CONT \?L1
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,DRY-CELL \FALSE
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	PRINTI "Taken."
	CRLF
	ZERO? DETECTOR-POWERED /TRUE
	SET 'DETECTOR-POWERED,0
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L14
	FSET? DETECTOR-COMPARTMENT,OPENBIT \?L15
	PRINTI "The compartment is on the side of the machine. Inside "
	FIRST? DETECTOR-COMPARTMENT >STACK \?L19
	PRINTI "is a connected"
	JUMP ?L23
?L19:	PRINTI "are connections for a"
?L23:	PRINTI " nine-volt "
	CALL DPRINT,DRY-CELL
	PRINTR "."
?L15:	CALL TELL-CLOSED,STR?319
	RTRUE
?L14:	EQUAL? PRSA,V?PUT \?L29
	EQUAL? PRSO,DETECTOR-COMPARTMENT /FALSE
	FSET? DETECTOR-COMPARTMENT,OPENBIT /?L32
	CALL TELL-CLOSED,STR?320 >STACK
	RSTACK
?L32:	EQUAL? PRSO,DRY-CELL \?L33
	MOVE DRY-CELL,DETECTOR-COMPARTMENT
	FSET? DRY-CELL,RMUNGBIT /?L34
	SET 'DETECTOR-POWERED,1
?L34:	PRINTI "The "
	CALL DPRINT,DRY-CELL
	PRINTR " fits snugly inside."
?L33:	PRINTR "Unfortunately, it doesn't fit."
?L29:	EQUAL? PRSA,V?OPEN \?L42
	IN? DRY-CELL,DETECTOR-COMPARTMENT \?L42
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L42
	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK \?L42
	CALL PRINT-ID,STR?321
	FSET DRY-CELL,RMUNGBIT
	SET 'DETECTOR-POWERED,0
	RFALSE
?L42:	EQUAL? PRSA,V?EMPTY \FALSE
	FSET? DETECTOR-COMPARTMENT,OPENBIT \FALSE
	SET 'DETECTOR-POWERED,0
	RFALSE

	.FUNCT DEEP-SUIT-F
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	CALL TELL-NO-NO >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "This "
	CALL DPRINT,DEEP-SUIT
	PRINTR " is bulky on land, but underwater it will protect you to 500 feet. It has a hood with ""viewport"" and a connection for a compressor hose."
?L3:	EQUAL? PRSA,V?PUT \?L6
	EQUAL? PRSI,DEEP-SUIT \?L6
	EQUAL? PRSO,AIR-HOSE /?L6
	CALL TELL-NO-NO >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?WEAR \?L7
	FSET? WET-SUIT,WORNBIT \?L7
	CALL TELL-NO-FIT,STR?322 >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?DISEMBARK,V?THROW,V?DROP \FALSE
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \FALSE
	CALL PRINT-ID,STR?323
	CALL JIGS-UP,STR?324 >STACK
	RSTACK

	.FUNCT MM-CREW-QTRS-F,RARG,W
	EQUAL? RARG,M-LOOK \?L1
	CALL TELL-CREW-QTRS
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL MOVE-SHARED-OBJECTS,MM-CREW-QTRS
	RFALSE

	.FUNCT BUNK-F,RARG=0,F
	ZERO? RARG \FALSE
	EQUAL? PRSA,V?SLEEP,V?BOARD \?L3
	FIRST? BUNK >F \?L6
	EQUAL? F,PLAYER \?L5
?L6:	CALL WEARING-SOMETHING? >STACK
	ZERO? STACK /?L3
?L5:	CALL TELL-NOT-COMFORTABLE >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?HIDE-UNDER,V?PUT-UNDER \?L7
	EQUAL? PRSO,GLOBAL-SELF,ME \?L8
	PRINTR "You won't fit."
?L8:	GETP PRSO,P?SIZE >STACK
	LESS? STACK,5 \?L12
	FIRST? UNDER-BUNK >STACK \?L13
	CALL TELL-NO-FIT >STACK
	RSTACK
?L13:	MOVE PRSO,UNDER-BUNK
	FSET PRSO,NDESCBIT
	CALL TELL-NOW,PRSO,STR?325 >STACK
	RSTACK
?L12:	CALL TELL-NO-FIT >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	FIRST? UNDER-BUNK >F \?L18
	SET 'P-IT-OBJECT,F
	PRINTI "There is "
	CALL APRINT,F
	PRINTR " under the mattress."
?L18:	PRINTR "Nobody's hidden his life savings there."

	.FUNCT WEARING-SOMETHING?,F
	FIRST? PLAYER >F \FALSE
?L4:	FSET? F,WORNBIT \?L6
	EQUAL? F,WATCH \TRUE
?L6:	NEXT? F >F /?L4
	RFALSE

	.FUNCT UNDER-BUNK-F,RARG=0
	EQUAL? RARG,M-OBJDESC /TRUE
	EQUAL? RARG,M-CONT \FALSE
	EQUAL? PRSA,V?TAKE \FALSE
	FCLEAR PRSO,NDESCBIT
	RFALSE

	.FUNCT BUNKS-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?326
	RTRUE
?L1:	PRINTI "The only bunk you should worry about is your own."
	CRLF
	EQUAL? PRSA,V?MUNG,V?ATTACK /?L6
	PUSH 0
	JUMP ?L7
?L6:	PUSH 1
?L7:	CALL PRINT-ID,STR?327,STACK >STACK
	RSTACK

	.FUNCT MM-GALLEY-F,RARG
	CALL GENERIC-GALLEY-F,RARG,MM-GALLEY >STACK
	RSTACK

	.FUNCT GENERIC-GALLEY-F,RARG,PLACE
	EQUAL? RARG,M-ENTER \?L1
	PUTP GLOBAL-SURFACE,P?SDESC,STR?54
	CALL MOVE-SHARED-OBJECTS,PLACE
	RFALSE
?L1:	EQUAL? RARG,M-LOOK \?L3
	PRINTI "You are in the "
	EQUAL? PLACE,MM-GALLEY \?L6
	CALL DPRINT,SALVAGER
	JUMP ?L10
?L6:	CALL DPRINT,TRAWLER
?L10:	PRINTI "'s galley. A stove and a small table are the fixtures here."
	IN? FOOD,STOVE \?L15
	CALL TELL-STEW-ON
?L15:	ZERO? WATER-DELIVERED /?L18
	GETP PLACE,P?LINE >STACK
	GETP SHIP-CHOSEN,P?LINE >STACK
	EQUAL? STACK,STACK \?L18
	PRINTI " Water is available."
?L18:	PRINTR " A ladder leads up through the deck to the wheelhouse for feeding the captain in rough weather."
?L3:	EQUAL? RARG,M-BEG \FALSE
	CALL DOUBLE-DUTY-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT DOUBLE-DUTY-CHECK
	EQUAL? PRSA,V?ASK-FOR \FALSE
	EQUAL? PRSO,PETE \FALSE
	EQUAL? PRSI,FOOD \?L3
	ZERO? SOUPS-ON /?L5
	PRINTI """Take some "
	CALL DPRINT,GLOBAL-SELF
	PRINTR "."""
?L5:	PRINTR """Wait 'til it's ready."""
?L3:	EQUAL? PRSI,DRINKING-WATER \FALSE
	PRINTI """Take it "
	CALL DPRINT,GLOBAL-SELF
	PRINTR "."""

	.FUNCT TELL-STEW-ON,LEAD?=1
	ZERO? LEAD? /?L1
	PRINTI " "
?L1:	PRINTI "A pot of stew is simmering on the stove."
	RTRUE

	.FUNCT STOVE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The small stove rests on gimbals that keep it relatively level."
	IN? FOOD,STOVE \?L5
	CALL TELL-STEW-ON
?L5:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L8
	IN? FOOD,STOVE \?L8
	CALL TELL-STEW-ON,0
	CRLF
	RTRUE
?L8:	EQUAL? PRSA,V?LAMP-OFF,V?LAMP-ON \FALSE
	PRINTR "That's Pete's job."

	.FUNCT MM-LOUNGE-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUTP GLOBAL-SURFACE,P?SDESC,STR?54
	CALL MOVE-SHARED-OBJECTS,MM-LOUNGE
	RFALSE

	.FUNCT LOUNGE-CHAIR-F,RARG=0,F
	EQUAL? PRSO,CHAIR \FALSE
	EQUAL? PRSA,V?BOARD \FALSE
	FIRST? CHAIR >F \FALSE
	CALL TELL-NOT-COMFORTABLE >STACK
	RSTACK

	.FUNCT REDS-BUNK-F
	EQUAL? PRSA,V?SIT,V?SLEEP,V?BOARD /?L3
	EQUAL? PRSA,V?HIDE-UNDER,V?PUT-UNDER,V?SIT-ON /?L3
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,REDS-BUNK \?L1
?L3:	PRINTI "You know better than to disturb the captain's bunk!"
	CRLF
	CALL PRINT-ID,STR?328 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "It's shipshape."

	.FUNCT MM-ENGINE-ROOM-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in a tiny cabin with barely enough room to breathe. By your feet lie the huge diesel engines of the "
	CALL DPRINT,SALVAGER
	PRINTR "."

	.FUNCT ENGINE-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?329
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "The engines are extremely complex and delicate pieces of machinery."
?L3:	EQUAL? PRSA,V?PLUG,V?LAMP-OFF,V?LAMP-ON \?L6
	PRINTI "Leave the engines to "
	CALL DPRINT,WEASEL
	PRINTR " and he'll leave the diving to you."
?L6:	EQUAL? PRSA,V?ASK-ABOUT \?L9
	EQUAL? PRSO,WEASEL \?L9
	PRINTR """These are in pretty good shape."""
?L9:	EQUAL? PRSA,V?LISTEN \FALSE
	ZERO? AT-SEA /FALSE
	CALL TELL-YOU-CANT,STR?330 >STACK
	RSTACK

	.FUNCT NW-FORE-DECK-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	CALL TELL-FORE-END,TRAWLER >STACK
	RSTACK

	.FUNCT NW-STARBOARD-DECK-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	MOVE BUNK,NW-CREW-QTRS
	MOVE UNDER-BUNK,NW-CREW-QTRS
	MOVE STOVE,NW-GALLEY
	MOVE DECK-CHAIR,NW-FORE-DECK
	MOVE REDS-BUNK,NW-CAPT-CABIN
	MOVE LOUNGE-CHAIR,NW-LOUNGE
	IN? PETE,NW-GALLEY \?L3
	MOVE FOOD,STOVE
	FSET FOOD,NDESCBIT
?L3:	ZERO? WATER-DELIVERED /FALSE
	EQUAL? TRAWLER,SHIP-CHOSEN \FALSE
	MOVE DRINKING-WATER,NW-GALLEY
	FSET DRINKING-WATER,NDESCBIT
	RFALSE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	CALL TELL-FOO-SIDE,TRAWLER,STR?307,STR?308
	RTRUE

	.FUNCT NW-AFT-DECK-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	CALL TELL-AFT-DECK
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-FLASH \FALSE
	IN? WEASEL,NW-AFT-DECK \FALSE
	ZERO? AT-SEA /FALSE
	ZERO? WEASEL-APPREHENDED \FALSE
	CALL QUEUED?,I-PENDULUM >STACK
	ZERO? STACK \FALSE
	CALL QUEUE,I-PENDULUM,-1 >STACK
	PUT STACK,0,1
	CALL TELL-WEASEL-TOSSES >STACK
	RSTACK

	.FUNCT NW-WHEELHOUSE-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are in the wheelhouse of the "
	CALL DPRINT,TRAWLER
	PRINTI ". The passageway leading out onto the deck lies abaft."
	CALL TELL-WHEELHOUSE,SALVAGER
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? OCEAN,PRSO,PRSI \FALSE
	EQUAL? PRSA,V?EXAMINE \?L8
	PRINTR "You see the ocean through the window."
?L8:	CALL TELL-YOU-CANT,STR?314 >STACK
	RSTACK

	.FUNCT NW-LOCKER-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in a fairly empty storage locker. It must have been cleaned out after its last trawling expedition."
	PRINT SPARE-PARTS-STR
	CRLF
	RTRUE

	.FUNCT TELL-SWITCH,STR
	PRINTI "The switch is now in the """
	PRINT STR
	PRINTR """ position."

	.FUNCT DRILL-F,RARG=0
	EQUAL? RARG,M-CONT \?L1
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,BATTERY \FALSE
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	PRINTI "Taken."
	CALL PRINT-ID,STR?331
	ZERO? DRILL-POWERED /?L11
	SET 'DRILL-POWERED,0
	ZERO? DRILL-ON /?L11
	CALL INT,I-DRILL >STACK
	PUT STACK,0,0
	PRINTI " The drill bit winds to a halt."
?L11:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LAMP-ON \?L19
	EQUAL? PRSO,DRILL \?L19
	ZERO? DRILL-ON /?L20
	CALL TELL-ALREADY,STR?69 >STACK
	RSTACK
?L20:	ZERO? DRILL-POWERED /?L22
	SET 'DRILL-ON,1
	CALL INT,I-DRILL >STACK
	PUT STACK,0,1
	PRINTR "The drill bit begins to spin."
?L22:	SET 'DRILL-ON,1
	CALL TELL-SWITCH,STR?69 >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?LAMP-OFF \?L26
	EQUAL? PRSO,DRILL \?L26
	ZERO? DRILL-ON \?L27
	CALL TELL-ALREADY,STR?269 >STACK
	RSTACK
?L27:	ZERO? DRILL-POWERED /?L29
	SET 'DRILL-ON,0
	CALL INT,I-DRILL >STACK
	PUT STACK,0,0
	PRINTR "The drill bit stops spinning."
?L29:	SET 'DRILL-ON,0
	CALL TELL-SWITCH,STR?269 >STACK
	RSTACK
?L26:	EQUAL? PRSA,V?EXAMINE \?L33
	PRINTI "This waterproof wonder features a permanent bit"
	CALL QUEUED?,I-DRILL >STACK
	ZERO? STACK /?L36
	PRINTI " which is turning"
?L36:	PRINTI ", a panel which is "
	FSET? DRILL,OPENBIT \?L43
	PRINTI "open"
	ZERO? DRILL-POWERED /?L47
	PRINTI " with a C battery inside"
	JUMP ?L54
?L47:	PRINTI ", revealing space for a C battery"
	JUMP ?L54
?L43:	PRINTI "closed"
?L54:	PRINTI ", and a switch which is in the """
	ZERO? DRILL-ON /?L59
	PRINTI "on"
	JUMP ?L63
?L59:	PRINTI "off"
?L63:	PRINTR """ position."
?L33:	EQUAL? PRSA,V?LOOK-INSIDE \?L68
	CALL PERFORM,V?EXAMINE,DRILL
	RTRUE
?L68:	EQUAL? PRSA,V?OPEN \?L69
	EQUAL? PRSO,DRILL \?L69
	IN? BATTERY,DRILL \?L69
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L69
	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK \?L69
	CALL PRINT-ID,STR?332
	FSET BATTERY,RMUNGBIT
	SET 'DRILL-POWERED,0
	RFALSE
?L69:	EQUAL? PRSI,DRILL \FALSE
	EQUAL? PRSA,V?PUT \?L71
	FSET? DRILL,OPENBIT /?L73
	SET 'P-IT-OBJECT,DRILL
	CALL TELL-CLOSED,STR?320 >STACK
	RSTACK
?L73:	EQUAL? PRSO,BATTERY \?L75
	MOVE BATTERY,DRILL
	FSET? BATTERY,RMUNGBIT \?L76
	CALL TELL-NOW,BATTERY,STR?333
	RTRUE
?L76:	SET 'DRILL-POWERED,1
	ZERO? DRILL-ON /?L79
	CALL INT,I-DRILL >STACK
	PUT STACK,0,1
	PRINTR "The drill bit starts spinning."
?L79:	CALL TELL-NOW,BATTERY,STR?333 >STACK
	RSTACK
?L75:	CALL TELL-NO-FIT >STACK
	RSTACK
?L71:	EQUAL? PRSA,V?TELL,V?ASK-ABOUT,V?TAKE /FALSE
	EQUAL? PRSA,V?PUT-ON,V?PUT-AGAINST /FALSE
	ZERO? DRILL-ON /?L88
	ZERO? DRILL-POWERED \FALSE
?L88:	EQUAL? PRSO,GLOBAL-TIME /FALSE
	SET 'P-IT-OBJECT,DRILL
	PRINTI "The "
	CALL DPRINT,DRILL
	PRINTR " isn't running!"

	.FUNCT GENERIC-HOLE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "As holes go, it's very nice."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L5
	PRINTR "You see nothing new."
?L5:	EQUAL? PRSA,V?REACH-IN \FALSE
	PRINTR "It's not that big."

	.FUNCT ADD-HOLE,OBJ,I
	FSET? HOLE-1,INVISIBLE \?L1
	FCLEAR HOLE-1,INVISIBLE
	MOVE HOLE-1,OBJ
	JUMP ?L4
?L1:	FSET? HOLE-2,INVISIBLE \?L3
	FCLEAR HOLE-2,INVISIBLE
	PUTP HOLE-1,P?SDESC,STR?334
	MOVE HOLE-2,OBJ
	JUMP ?L4
?L3:	PRINTI "The drill should be dead now."
	CRLF
?L4:	CALL INT,I-DRILL >I
	GET I,C-TICK >STACK
	DEC 'STACK
	PUT I,C-TICK,STACK
	GET I,C-TICK >STACK
	ZERO? STACK \TRUE
	CALL I-DRILL
	RTRUE

	.FUNCT TELL-CREW-QTRS
	PRINTR "You are below deck in the crew's quarters. Narrow, uncomfortable bunks line the bulkheads, and you note the similarity between this area and a sardine can. Sleeping here is necessary but uninviting. A ladder leads up and out to the fore deck."

	.FUNCT NW-CREW-QTRS-F,RARG,W
	EQUAL? RARG,M-LOOK \?L1
	CALL TELL-CREW-QTRS >STACK
	RSTACK
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL MOVE-SHARED-OBJECTS,NW-CREW-QTRS
	RFALSE

	.FUNCT NW-GALLEY-F,RARG
	CALL GENERIC-GALLEY-F,RARG,NW-GALLEY >STACK
	RSTACK

	.FUNCT NW-LOUNGE-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	PUTP GLOBAL-SURFACE,P?SDESC,STR?54
	CALL MOVE-SHARED-OBJECTS,NW-LOUNGE
	RFALSE

	.FUNCT NW-ENGINE-ROOM-F,RARG
	CALL PRINT-ID,STR?335
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in a tiny, smelly space where it is difficult to breathe. By your feet lie the diesel engines of the "
	CALL DPRINT,TRAWLER
	PRINTR "."

	.FUNCT UNDERWATER-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	FCLEAR UNDERWATER,TOUCHBIT
	IN? SHARK,LOCAL-GLOBALS \?L3
	CALL QUEUED?,I-SHARK >STACK
	ZERO? STACK \?L3
	DIV OCEAN-BOTTOM,50 >STACK
	DEC 'STACK
	RANDOM STACK >STACK
	CALL QUEUE,I-SHARK,STACK >STACK
	PUT STACK,0,1
?L3:	MOVE LINE-HACK,UNDERWATER
	RFALSE
?L1:	EQUAL? RARG,M-LOOK \?L6
	PRINTR "You are in the sea, completely surrounded by water."
?L6:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? LINE-HACK,PRSO,PRSI \?L10
	CALL TELL-CANT-REACH,STR?336 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?WALK \?L12
	EQUAL? P-WALK-DIR,P?UP,P?DOWN /?L12
	CALL TELL-NOWHERE >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?SWIM,V?DIVE,V?WALK /FALSE
	EQUAL? PRSA,V?SAVE,V?EXAMINE,V?LOOK /FALSE
	EQUAL? PRSA,V?SCORE,V?QUIT,V?RESTORE /FALSE
	EQUAL? PRSA,V?DIAGNOSE,V?FIND,V?TIME /FALSE
	EQUAL? PRSA,V?OPEN,V?LAMP-OFF,V?LAMP-ON /FALSE
	EQUAL? PRSA,V?READ,V?TAKE,V?CLOSE /FALSE
	EQUAL? PRSA,V?INVENTORY,V?WAIT,V?BREATHE /FALSE
	EQUAL? PRSA,V?WHAT,V?AGAIN,V?VERSION /FALSE
	EQUAL? PRSA,V?RESTART,V?UNSCRIPT,V?SCRIPT /FALSE
	EQUAL? PRSA,V?$0024CALL /FALSE
	EQUAL? PRSA,V?THROW,V?DROP \?L15
	CALL TELL-NO-LITTER >STACK
	RSTACK
?L15:	CALL TELL-YOU-CANT,STR?337
	RETURN 2

	.FUNCT TELL-NOWHERE
	PRINTR "That won't get you anywhere."

	.FUNCT UNDERWATER-U,PRINT?=1,L
	ZERO? PRINT? /FALSE
	SUB DEPTH,50 >DEPTH
	LOC WEASEL >L
	IN? SAFETY-LINE,L /?L4
	IN? TREASURE-CHEST,L /?L4
	IN? EMPTY-CHEST,L /?L4
	FCLEAR LINE-HACK,INVISIBLE
?L4:	ZERO? DEPTH \?L7
	PRINTI "You get out of the water and reboard your ship..."
	CRLF
	CRLF
	CALL INT,I-AIR-SUPPLY >STACK
	PUT STACK,0,0
	CALL ENABLED?,I-LAST-GASP >STACK
	ZERO? STACK /?L11
	CALL INT,I-LAST-GASP >STACK
	PUT STACK,0,0
	JUMP ?L13
?L11:	CALL INT,I-MM-COMPRESSOR >STACK
	PUT STACK,0,0
?L13:	FSET? OCEAN-FLOOR,TOUCHBIT /?L16
	FSET? WRECK-1,TOUCHBIT \?L14
?L16:	CALL RATING-UPD,25
	IN? SAFETY-LINE,TREASURE-CHEST /?L19
	IN? GLASS-CASE,PLAYER \?L34
	FSET? STAMPS,RMUNGBIT /?L17
?L19:	CALL RATING-UPD,25
	LOC WEASEL >STACK
	IN? TREASURE-CHEST,STACK \?L20
	CALL TREASURE-CHEST-WIN
	JUMP ?L23
?L20:	IN? SAFETY-LINE,TREASURE-CHEST \?L22
	CALL CHEST-PULL-UP
	CALL TREASURE-CHEST-WIN
	JUMP ?L23
?L22:	PRINTI "When your shipmates find that you've recovered these priceless stamps, they congratulate you. "
?L23:	ZERO? WEASEL-BLOWN \?L28
	FSET? ENVELOPE,INVISIBLE \?L26
?L28:	PRINTI "Johnny slaps you on the back. ""Good job, matey!"" As you return to the island over the calm, dazzling blue sea, you contemplate your wealth with a touch of sadness. You think of Hevlin and hope his soul is resting a little easier now."
	CRLF
	CRLF
	CALL RATING-UPD,20
	CALL FINISH >STACK
	RSTACK
?L26:	PRINTI "Exhilarated but tired, you lie out on the deck. You fall asleep at once, and dream of a tropical paradise. But even as you dream, your throat is cut! And as your life drains away, you realize how foolish it was not to have suspected a traitor!"
	CRLF
	CALL PRINT-ID,STR?338
	CALL FINISH >STACK
	RSTACK
?L17:	IN? GLASS-CASE,PLAYER \?L34
	FSET? STAMPS,RMUNGBIT \?L34
	PRINTI "But their elation turns to disappointment, as they notice that the stamps are waterlogged and, thus, worthless"
	CALL LONG-TRIP >STACK
	RSTACK
?L34:	LOC WEASEL >STACK
	IN? EMPTY-CHEST,STACK \?L37
	CALL EMPTY-CHEST-LOSE >STACK
	RSTACK
?L37:	IN? SAFETY-LINE,EMPTY-CHEST \?L38
	CALL CHEST-PULL-UP
	CALL EMPTY-CHEST-LOSE >STACK
	RSTACK
?L38:	PRINTI "When your shipmates find out that you haven't found any treasure, Johnny shakes his head. You can't help feeling you've let them, as well as "
	CALL DPRINT,GLOBAL-SELF
	PRINTI ", down"
	CALL LONG-TRIP >STACK
	RSTACK
?L14:	ZERO? AT-SEA /?L42
	GRTR? PRESENT-TIME,720 \?L42
	PRINTI "Johnny looks downcast when he sees that you empty-handed. ""Let's get back to the Island. Maybe another time..."""
	CRLF
	CALL FINISH >STACK
	RSTACK
?L42:	EQUAL? SHIP-CHOSEN,TRAWLER \?L45
	FSET OCEAN,VEHBIT
	MOVE LINE-HACK,NW-AFT-DECK
	RETURN NW-AFT-DECK
?L45:	FSET OCEAN,VEHBIT
	MOVE LINE-HACK,MM-AFT-DECK
	RETURN MM-AFT-DECK
?L7:	PRINTI "You ascend "
	EQUAL? HERE,UNDERWATER \?L50
	PRINTI "another "
?L50:	PRINTI "50 feet..."
	CRLF
	CRLF
	ZERO? DOOMED /?L57
	EQUAL? DEPTH,250 \?L57
	CALL PRINT-ID,STR?339
	CALL JIGS-UP,STR?340 >STACK
	RSTACK
?L57:	RETURN UNDERWATER

	.FUNCT CHEST-PULL-UP
	LOC WEASEL >STACK
	EQUAL? STACK,MM-AFT-DECK,NW-AFT-DECK \?L1
	CALL START-SENTENCE,WEASEL
	JUMP ?L3
?L1:	CALL START-SENTENCE,JOHNNY
?L3:	PRINTI " pulls on the "
	CALL DPRINT,SAFETY-LINE
	PRINTI " and drags up the chest. "
	RTRUE

	.FUNCT EMPTY-CHEST-LOSE
	CALL TELL-1ST-CHEST-LINE
	PRINTI "disappointment, the contents are nothing more than old Portuguese newspapers"
	CALL LONG-TRIP >STACK
	RSTACK

	.FUNCT TELL-1ST-CHEST-LINE
	PRINTI "Johnny spends several minutes forcing open the chest. To everyone's "
	RTRUE

	.FUNCT LONG-TRIP
	PRINTI ". It will be a long trip back."
	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT TREASURE-CHEST-WIN
	CALL TELL-1ST-CHEST-LINE
	PRINTI "delight, there are hundreds of gold escudos inside. "
	RTRUE

	.FUNCT UNDERWATER-D,PRINT?=1
	ZERO? PRINT? /FALSE
	ADD DEPTH,50 >DEPTH
	GRTR? DEPTH,300 \?L4
	FSET? DEEP-SUIT,WORNBIT /?L4
	CALL PRINT-ID,STR?341
	CALL JIGS-UP,STR?342 >STACK
	RSTACK
?L4:	EQUAL? DEPTH,OCEAN-BOTTOM \?L6
	ZERO? WRECK-CHOSEN /?L7
	PRINTI "The yellow beam from your light settles on a huge jagged outcropping of rusted metal and barnacles. As you angle your light downward, you can barely make out the shape of a monstrous corroded hull, partly buried in the silt from its decades of slumber on the floor of the ocean."
	CRLF
	CRLF
	RETURN WRECK-1
?L7:	PRINTI "You flutter down to the ocean floor..."
	CRLF
	CRLF
	RETURN OCEAN-FLOOR
?L6:	PRINTI "You descend another 50 feet..."
	CRLF
	CRLF
	RETURN UNDERWATER

	.FUNCT OCEAN-FLOOR-F,RARG=0
	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? P-WALK-DIR,P?UP /FALSE
	CALL TELL-NOWHERE >STACK
	RSTACK

	.FUNCT WRECK-1-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	FSET? WRECK-1,TOUCHBIT /?L3
	FSET LINE-HACK,INVISIBLE
	EQUAL? WRECK-CHOSEN,1 \?L5
	MOVE SQUID,WRECK-12
	MOVE IRON-BAR,WRECK-5
	EQUAL? WRECK-FOUND,1 \?L7
	MOVE TREASURE-CHEST,WRECK-11
	MOVE EMPTY-CHEST,WRECK-9
?L7:	MOVE SKELETON,WRECK-10
	MOVE SCABBARD,SKELETON
	PUTP WRECK-8,P?VALUE,10
	FCLEAR CEILING-HOLE-1,INVISIBLE
	FCLEAR FLOOR-HOLE-1,INVISIBLE
	MOVE CASK,WRECK-6
	MOVE ROPE,WRECK-4
	MOVE BROKEN-MAST,WRECK-4
	PUTP WRECK-5,P?DESCFCN,80
	PUTP WRECK-7,P?DESCFCN,45
	PUTP WRECK-8,P?DESCFCN,45
	FCLEAR FALLEN-BUNK,INVISIBLE
	FCLEAR MAST,INVISIBLE
	FCLEAR JAGGED-HOLE,INVISIBLE
	RTRUE
?L5:	EQUAL? WRECK-CHOSEN,2 \FALSE
	FCLEAR AIRTIGHT-DOOR,INVISIBLE
	FCLEAR AIRTIGHT-DOOR,OPENBIT
	FCLEAR LOCKER-DOOR,INVISIBLE
	FCLEAR LOCKER-DOOR,OPENBIT
	MOVE SAFE,WRECK-8
	PUTP SAFE,P?ACTION,SAFE-F
	FCLEAR SAFE,NDESCBIT
	EQUAL? WRECK-FOUND,2 \?L11
	MOVE GLASS-CASE,SAFE
?L11:	MOVE MINE,WRECK-11
	MOVE CLUMP-OF-MINES,WRECK-11
	FCLEAR CEILING-HOLE-2,INVISIBLE
	FCLEAR FLOOR-HOLE-2,INVISIBLE
	PUTP WRECK-6,P?VALUE,25
	PUTP WRECK-1,P?DESCFCN,100
	PUTP WRECK-2,P?DESCFCN,100
	PUTP WRECK-3,P?DESCFCN,100
	PUTP WRECK-4,P?DESCFCN,100
	PUTP WRECK-5,P?DESCFCN,100
	PUTP WRECK-6,P?DESCFCN,100
	PUTP WRECK-7,P?DESCFCN,100
	PUTP WRECK-8,P?DESCFCN,100
	PUTP WRECK-9,P?DESCFCN,100
	PUTP WRECK-10,P?DESCFCN,100
	PUTP WRECK-11,P?DESCFCN,100
	PUTP WRECK-12,P?DESCFCN,100
	PUTP WRECK-13,P?DESCFCN,100
	RTRUE
?L3:	EQUAL? WRECK-CHOSEN,2 \FALSE
	PUTP FLOOR-HOLE-2,P?SDESC,STR?343
	RTRUE
?L1:	EQUAL? RARG,M-LOOK \FALSE
	GET WRECK-1-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT WRECK-1-D,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	ZERO? PRINT? /?L7
	FSET? WEST-LADDER,RMUNGBIT \?L5
	CALL TELL-GRACEFUL
	RETURN WRECK-4
?L5:	FSET WEST-LADDER,RMUNGBIT
	PRINTI "As you put your foot on the top rung, the rotting wood gives way. The other rungs break beneath your weight, and you plummet down to the deck below..."
	CRLF
	CRLF
?L7:	RETURN WRECK-4
?L1:	EQUAL? WRECK-CHOSEN,3 \?L11
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L11:	RETURN WRECK-4

	.FUNCT WEST-LADDER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? WEST-LADDER,RMUNGBIT \?L3
	EQUAL? HERE,WRECK-1 \?L5
	PRINTR "All that's left are a couple of pieces that were broken off at the top."
?L5:	PRINTR "The ladder is nothing more than some broken pieces of wood."
?L3:	PRINTR "Looks like a ladder."
?L1:	EQUAL? PRSA,V?TAKE \?L15
	EQUAL? HERE,WRECK-1 /?L18
	FSET? WEST-LADDER,RMUNGBIT /?L16
?L18:	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE
?L16:	PRINTR "None of the pieces looks useful."
?L15:	EQUAL? PRSA,V?CLIMB-FOO \FALSE
	EQUAL? HERE,WRECK-1 \?L25
	CALL DO-WALK,P?DOWN
	JUMP ?L27
?L25:	CALL DO-WALK,P?UP
?L27:	SET 'P-IT-OBJECT,WEST-LADDER
	RTRUE

	.FUNCT WRECK-2-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	GET WRECK-2-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT WRECK-3-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	GET WRECK-3-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT WRECK-3-D,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	ZERO? PRINT? /?L7
	ZERO? DOOMED /?L5
	CALL PRINT-ID,STR?344
	CALL JIGS-UP,STR?345
	RETURN WRECK-7
?L5:	SET 'DOOMED,1
	CALL TELL-GRACEFUL
?L7:	RETURN WRECK-7
?L1:	CALL TELL-NO-GO,PRINT?
	RFALSE

	.FUNCT TELL-GRACEFUL
	PRINTI "You sink gracefully down to the next deck..."
	CRLF
	CRLF
	RTRUE

	.FUNCT WRECK-4-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	GET WRECK-4-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	EQUAL? WRECK-CHOSEN,1 \?L7
	FSET? ROPE,NDESCBIT \?L7
	CALL TELL-WRAPPED,STR?346
?L7:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \?L11
	EQUAL? WRECK-CHOSEN,2 \?L11
	PUTP CEILING-HOLE-2,P?SDESC,STR?347
	FSET CEILING-HOLE-2,VOWELBIT
	PUTP FLOOR-HOLE-2,P?SDESC,STR?348
	RFALSE
?L11:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? WRECK-CHOSEN,1 \?L13
	CALL NOT-THIS-WRECK,BUNKS >STACK
	RSTACK
?L13:	EQUAL? WRECK-CHOSEN,2 \FALSE
	CALL NOT-THIS-WRECK,PSEUDO-OBJECT >STACK
	RSTACK

	.FUNCT TELL-WRAPPED,STR
	PRINTI " A rope is wrapped around "
	PRINT STR
	PRINTI "."
	RTRUE

	.FUNCT WRECK-4-N,PRINT?=1
	EQUAL? WRECK-CHOSEN,2 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	RETURN WRECK-5

	.FUNCT WRECK-4-U,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	ZERO? PRINT? /?L3
	ZERO? ROPE-HANGING /?L5
	CALL TELL-ROPE-HIGH
	RFALSE
?L5:	FSET? WEST-LADDER,RMUNGBIT \?L7
	PRINTI "There's no way to get back up what's left of the ladder."
	CRLF
	RFALSE
?L7:	FSET WEST-LADDER,RMUNGBIT
	PRINTI "As you start to climb, a rung collapses under your foot. You grab at other rungs but find you are back where you started amidst several pieces of what used to be the ladder."
	CRLF
	RFALSE
?L3:	RETURN WRECK-1
?L1:	IN? GLASS-CASE,PLAYER \?L15
	FSET? STAMPS,RMUNGBIT /?L15
	GRTR? WATER-IN-CASE,0 \?L15
	FSET STAMPS,RMUNGBIT
	SET 'WATER-IN-CASE,10
	PRINTI "As you go up, the water in the "
	CALL DPRINT,GLASS-CASE
	PRINTI " sloshes around, ruining the stamps."
	CRLF
	CRLF
	CALL PRINT-ID,STR?349
?L15:	RETURN WRECK-1

	.FUNCT WRECK-4-D,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	RETURN WRECK-9

	.FUNCT AIRTIGHT-ROOM?
	EQUAL? WRECK-CHOSEN,2 \FALSE
	EQUAL? HERE,WRECK-5 \FALSE
	ZERO? WRECK-5-FLOODED /TRUE
	RFALSE

	.FUNCT ROPE-F,RARG=0
	EQUAL? RARG,M-OBJDESC \?L1
	FSET? ROPE,TAKEBIT \?L3
	PRINTR "A length of rope lies here."
?L3:	PRINTR "A rope hangs down here."
?L1:	EQUAL? PRSA,V?CUT \?L10
	EQUAL? PRSI,SWORD \?L11
	ZERO? ROPE-HANGING /?L13
	FSET ROPE,TAKEBIT
	SET 'ROPE-HANGING,0
	PRINTR "A three-foot length of rope falls to the deck."
?L13:	FSET? ROPE,NDESCBIT \?L17
	IN? PLAYER,CASK \?L18
	SET 'ROPE-HANGING,1
	FCLEAR ROPE,NDESCBIT
	CALL RATING-UPD,15
	PRINTR "The rope falls to within eight feet of the floor."
?L18:	CALL TELL-ROPE-HIGH >STACK
	RSTACK
?L17:	MOVE ROPE,LOCAL-GLOBALS
	PRINTR "You chop the rope into many small pieces, which float off on the current and become lost among the debris."
?L11:	CALL TELL-YOU-CANT,STR?350 >STACK
	RSTACK
?L10:	ZERO? ROPE-HANGING \?L27
	EQUAL? PRSA,V?UNTIE,V?MOVE,V?RUB /?L30
	EQUAL? PRSA,V?TAKE,V?CLIMB-FOO \FALSE
?L30:	FSET? ROPE,TAKEBIT /FALSE
	CALL TELL-ROPE-HIGH >STACK
	RSTACK
?L27:	EQUAL? PRSA,V?TAKE \?L35
	PRINTR "It's tied securely above."
?L35:	EQUAL? PRSA,V?CLIMB-FOO \?L38
	CALL DO-WALK,P?UP
	SET 'P-IT-OBJECT,ROPE
	RTRUE
?L38:	EQUAL? PRSA,V?UNTIE \FALSE
	CALL TELL-CANT-REACH,STR?351 >STACK
	RSTACK

	.FUNCT BROKEN-MAST-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The mast is suspended securely above you."
	ZERO? ROPE-HANGING /?L5
	PRINTR " A rope is hanging from it."
?L5:	FSET? ROPE,NDESCBIT \?L9
	CALL TELL-WRAPPED,STR?34
?L9:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?UNTIE,V?MOVE,V?RUB /?L12
	EQUAL? PRSA,V?TAKE,V?CLIMB-FOO \FALSE
?L12:	CALL TELL-CANT-REACH,STR?346 >STACK
	RSTACK

	.FUNCT WRECK-5-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	EQUAL? WRECK-CHOSEN,2 \?L3
	PRINTI "This cabin was once a passenger compartment, "
	ZERO? WRECK-5-FLOODED /?L7
	PRINTI "but it is now flooded. There is a passage leading down through the deck, and a door in the aft "
	CALL DPRINT,BULKHEADS
	PRINTR "."
?L7:	PRINTR "although the fragile partitions within have collapsed. The room is filled with air and a glance tells you why: the closed door to aft kept the air and water pressures equalized, stopping the flow of water up through the hole in the deck."
?L3:	GET WRECK-5-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \?L17
	EQUAL? WRECK-CHOSEN,1 /FALSE
	EQUAL? LG-IRON-BAR,PRSO,PRSI \?L18
	CALL GLOBAL-NOT-HERE-PRINT,LG-IRON-BAR >STACK
	RSTACK
?L18:	EQUAL? WRECK-CHOSEN,1 /FALSE
	EQUAL? BARNACLES,PRSO,PRSI \FALSE
	CALL GLOBAL-NOT-HERE-PRINT,BARNACLES >STACK
	RSTACK
?L17:	EQUAL? RARG,M-ENTER \FALSE
	IN? GLASS-CASE,PLAYER \FALSE
	ZERO? WRECK-5-FLOODED \FALSE
	CALL INT,I-CASE-LEAK >STACK
	PUT STACK,0,0
	IN? HOLE-2,GLASS-CASE \FALSE
	IN? PUTTY,GLASS-CASE /FALSE
	SET 'WATER-IN-CASE,0
	RETURN WATER-IN-CASE

	.FUNCT WRECK-5-N,PRINT?=1
	EQUAL? WRECK-CHOSEN,2 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	RETURN WRECK-4

	.FUNCT WRECK-5-D,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	RETURN WRECK-10

	.FUNCT AIRTIGHT-DOOR-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? AIRTIGHT-DOOR,OPENBIT \?L3
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L3:	FSET AIRTIGHT-DOOR,OPENBIT
	CALL TELL-NOW,AIRTIGHT-DOOR,STR?44
	ZERO? WRECK-5-FLOODED \TRUE
	SET 'WRECK-5-FLOODED,1
	EQUAL? HERE,WRECK-5 \?L8
	FSET? DEEP-SUIT,WORNBIT /?L10
	FSET? MASK,WORNBIT \?L12
	IN? AIR-TANK,PLAYER \?L12
	FSET? WET-SUIT,WORNBIT /?L10
?L12:	CALL PRINT-ID,STR?352
	CALL JIGS-UP,STR?353
	RTRUE
?L10:	PRINTR "Water rushes in through the open door and the hole in the deck, filling the room to above your head, forcing the air out."
?L8:	PRINTR "Water rushes through the door into the next room."
?L1:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? AIRTIGHT-DOOR,OPENBIT \?L21
	FCLEAR AIRTIGHT-DOOR,OPENBIT
	CALL TELL-NOW,AIRTIGHT-DOOR,STR?45 >STACK
	RSTACK
?L21:	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK

	.FUNCT IRON-BAR-F
	IN? IRON-BAR,FALLEN-BUNK \?L1
	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "The "
	CALL DPRINT,IRON-BAR
	PRINTI " is"
	PRINT WEDGED-STR
	CRLF
	RTRUE
?L3:	EQUAL? PRSA,V?MOVE,V?TAKE \FALSE
	PRINTI "It's too tightly"
	PRINT WEDGED-STR
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L11
	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	EQUAL? HERE,WRECK-5 \?L14
	FCLEAR IRON-BAR,NDESCBIT
	PRINTI "You take one of the "
	CALL DPRINT,IRON-BAR
	PRINTR "s."
?L14:	PRINTR "Taken."
?L11:	EQUAL? PRSA,V?DROP \FALSE
	CALL V-DROP >STACK
	ZERO? STACK /TRUE
	EQUAL? HERE,WRECK-5 \TRUE
	FSET IRON-BAR,NDESCBIT
	RTRUE

	.FUNCT LG-IRON-BAR-F
	EQUAL? PRSA,V?TAKE \?L1
	IN? IRON-BAR,HERE \?L1
	CALL PERFORM,V?TAKE,IRON-BAR
	RTRUE
?L1:	PRINTI "These are a "
	CALL DPRINT,LG-IRON-BAR
	PRINTR " held firmly together by barnacles."

	.FUNCT PLAQUE-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?354
	RTRUE
?L1:	EQUAL? WRECK-CHOSEN,1 \?L3
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINTR "Although your knowledge of 17th-century Portuguese is minimal, you can see that the ship is named the Sao Vera, and the plaque is signed by King Alfonso VI."
?L3:	CALL GLOBAL-NOT-HERE-PRINT,PSEUDO-OBJECT >STACK
	RSTACK

	.FUNCT PARTITIONS-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?355
	RTRUE
?L1:	EQUAL? WRECK-CHOSEN,2 \?L3
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "These partitions once separated cabins."
?L3:	CALL GLOBAL-NOT-HERE-PRINT,PSEUDO-OBJECT >STACK
	RSTACK

	.FUNCT WRECK-6-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	GET WRECK-6-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \FALSE
	FSET? DEEP-SUIT,WORNBIT /?L6
	FSET? MASK,WORNBIT \?L8
	IN? AIR-TANK,PLAYER \?L8
	FSET? WET-SUIT,WORNBIT /?L6
?L8:	CALL PRINT-ID,STR?356
	CALL JIGS-UP,WATERY-ENVIRONMENT >STACK
	RSTACK
?L6:	CALL COMPILER-SUCKS-EXP-2 >STACK
	ZERO? STACK /FALSE
	CALL INT,I-CASE-LEAK >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT COMPILER-SUCKS-EXP-2
	FSET? STAMPS,RMUNGBIT /FALSE
	IN? GLASS-CASE,PLAYER \FALSE
	IN? PUTTY,GLASS-CASE \TRUE
	IN? HOLE-1,GLASS-CASE /?L6
	IN? HOLE-2,GLASS-CASE \FALSE
?L6:	ZERO? NO-HOLE-PLUGGED /FALSE
	RTRUE

	.FUNCT WRECK-6-D,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	ZERO? PRINT? \?L4
	RETURN WRECK-11
?L4:	FSET? MINE,RMUNGBIT \?L6
	FSET? AIR-TANK,WORNBIT /?L9
	IN? AIR-TANK,PLAYER /?L7
?L9:	RETURN WRECK-11
?L7:	CALL TELL-TOO-BIG
	RFALSE
?L6:	PRINTI "As you make your way down, you bump what had to be a floating mine. A second later..."
	CRLF
	CRLF
	CALL BOOM >STACK
	RSTACK

	.FUNCT TELL-SCUBA-STOPS
	PRINTR "The scuba tank makes it impossible to fit through the passage."

	.FUNCT TELL-CARRY-SCUBA?
	IN? AIR-TANK,PLAYER \FALSE
	PRINTI "Carrying your tank in front of you, you swim to the next room..."
	CRLF
	CRLF
	RTRUE

	.FUNCT WRECK-6-S,PRINT?=1
	EQUAL? WRECK-CHOSEN,2 \?L1
	ZERO? PRINT? \?L3
	RETURN WRECK-7
?L3:	FSET? AIR-TANK,WORNBIT \?L5
	CALL TELL-SCUBA-STOPS
	RFALSE
?L5:	CALL TELL-CARRY-SCUBA?
?L1:	RETURN WRECK-7

	.FUNCT CASK-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	ZERO? ROPE-HANGING /FALSE
	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? P-WALK-DIR,P?UP \FALSE
	IN? CASK,WRECK-4 \FALSE
	CALL WEIGHT,PLAYER >STACK
	GRTR? STACK,22 \?L5
	CALL TELL-YOU-CANT,STR?357 >STACK
	RSTACK
?L5:	MOVE PLAYER,WRECK-1
	SET 'HERE,WRECK-1
	PRINTI "You reach up, grab the rope, and climb..."
	CRLF
	CRLF
	CALL WRECK-1-F,M-ENTER
	CALL V-FIRST-LOOK
	RTRUE
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?CLIMB-FOO \?L12
	CALL PERFORM,V?CLIMB-ON,CASK
	RTRUE
?L12:	EQUAL? PRSA,DRILL \FALSE
	PRINTI "There is now a hole in the "
	CALL DPRINT,CASK
	PRINTI "."
	CRLF
	CALL ADD-HOLE,CASK >STACK
	RSTACK

	.FUNCT WOOD-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?358
	RTRUE
?L1:	EQUAL? WRECK-CHOSEN,2 \FALSE
	CALL GLOBAL-NOT-HERE-PRINT,PSEUDO-OBJECT >STACK
	RSTACK

	.FUNCT OVERTURNED-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?359
	RTRUE
?L1:	EQUAL? WRECK-CHOSEN,1 \?L3
	CALL GLOBAL-NOT-HERE-PRINT,PSEUDO-OBJECT >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "These are dining tables now scattered in various positions."

	.FUNCT WRECK-7-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	EQUAL? WRECK-CHOSEN,1 \?L3
	PRINTI "This cabin was used for housing the crew. In addition to lining the "
	CALL DPRINT,BULKHEADS
	PRINTI "s, bunks are strewn about the cabin"
	ZERO? BUNKS-MOVED \?L7
	PRINTI ", blocking a doorway aft. There is"
	JUMP ?L11
?L7:	PRINTI ". There is a doorway aft, and"
?L11:	PRINTR " an unblocked forward exit."
?L3:	GET WRECK-7-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? WRECK-CHOSEN,2 \FALSE
	EQUAL? PRSA,V?WEAR \?L22
	PRINTR "There's not enough room here for you to put that on."
?L22:	EQUAL? PRSA,V?WALK \?L26
	FSET? DEEP-SUIT,WORNBIT \?L26
	CALL PRINT-ID,STR?360
	CALL JIGS-UP,STR?361
?L26:	CALL NOT-THIS-WRECK,PSEUDO-OBJECT >STACK
	RSTACK

	.FUNCT WRECK-7-S,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	ZERO? BUNKS-MOVED \?L5
	ZERO? PRINT? \?L3
?L5:	RETURN WRECK-8
?L3:	SET 'P-IT-OBJECT,FALLEN-BUNK
	PRINTI "There are bunks in the way."
	CRLF
	RFALSE
?L1:	ZERO? PRINT? \?L10
	RETURN WRECK-8
?L10:	FSET? AIR-TANK,WORNBIT \?L12
	CALL TELL-SCUBA-STOPS
	RFALSE
?L12:	CALL TELL-CARRY-SCUBA?
	RETURN WRECK-8

	.FUNCT WRECK-7-N,PRINT?=1
	EQUAL? WRECK-CHOSEN,2 \?L1
	ZERO? PRINT? \?L3
	RETURN WRECK-6
?L3:	FSET? AIR-TANK,WORNBIT \?L5
	CALL TELL-SCUBA-STOPS
	RFALSE
?L5:	CALL TELL-CARRY-SCUBA?
?L1:	RETURN WRECK-6

	.FUNCT WRECK-7-U,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	ZERO? PRINT? /?L3
	PRINTI "There's no way you can reach that hole."
	CRLF
	RFALSE
?L3:	RETURN WRECK-3
?L1:	CALL TELL-NO-GO,PRINT?
	RFALSE

	.FUNCT FALLEN-BUNK-F
	EQUAL? PRSA,V?PUSH \?L1
	PRINTR "The bunks move a bit but fall back to where they were."
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	ZERO? BUNKS-MOVED /?L6
	PRINTI "A "
	CALL DPRINT,FALLEN-BUNK
	PRINTI " teeters by the passageway."
	IN? IRON-BAR,FALLEN-BUNK \?L10
	PRINTI " They are being held up by an "
	CALL DPRINT,IRON-BAR
	PRINTI "."
?L10:	CRLF
	RTRUE
?L6:	PRINTI "There is a "
	CALL DPRINT,FALLEN-BUNK
	PRINTR " before the aft doorway."
?L5:	EQUAL? PRSA,V?SLEEP \?L18
	CALL TELL-BAD-SHAPE >STACK
	RSTACK
?L18:	EQUAL? PRSA,V?MOVE \?L19
	EQUAL? PRSI,IRON-BAR \?L20
	ZERO? BUNKS-MOVED /?L22
	PRINTR "They've already been moved."
?L22:	SET 'BUNKS-MOVED,1
	CALL QUEUE,I-PLUMMET,2 >STACK
	PUT STACK,0,1
	SET 'CRIMP-CTR,0
	PRINTI "Using the "
	CALL DPRINT,IRON-BAR
	PRINTR ", you move the bunks out of the way."
?L20:	PRINTI "They're too heavy to move "
	ZERO? PRSI /?L32
	PRINTI "that way"
	JUMP ?L36
?L32:	PRINTI "by hand"
?L36:	PRINTR "."
?L19:	EQUAL? PRSA,V?LOOK-BEHIND \?L41
	EQUAL? HERE,WRECK-7 \?L41
	ZERO? BUNKS-MOVED \?L51
	PRINTR "There is a passageway there."
?L41:	ZERO? BUNKS-MOVED /?L44
?L51:	EQUAL? PRSA,V?PUT-UNDER \?L44
	EQUAL? PRSO,IRON-BAR \?L44
	CALL INT,I-PLUMMET >STACK
	PUT STACK,0,0
	MOVE IRON-BAR,FALLEN-BUNK
	PUTP WRECK-7,P?DESCFCN,65
	PUTP WRECK-8,P?DESCFCN,65
	PRINTI "The "
	CALL DPRINT,IRON-BAR
	PRINTR " is wedging the bunks up."
?L44:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	IN? IRON-BAR,FALLEN-BUNK \FALSE
	PRINTI "The "
	CALL DPRINT,IRON-BAR
	PRINTI " is there,"
	PRINT WEDGED-STR
	CRLF
	RTRUE

	.FUNCT DEBRIS-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?362
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "All sorts of jetsam has collected here, none of it very interesting on its own."

	.FUNCT WRECK-8-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	GET WRECK-8-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT WRECK-8-D,PRINT?=1
	EQUAL? WRECK-CHOSEN,2 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	RETURN WRECK-13

	.FUNCT WRECK-8-N,PRINT?=1
	EQUAL? WRECK-CHOSEN,2 \?L1
	ZERO? PRINT? \?L3
	RETURN WRECK-7
?L3:	FSET? AIR-TANK,WORNBIT \?L5
	CALL TELL-SCUBA-STOPS
	RFALSE
?L5:	CALL TELL-CARRY-SCUBA?
?L1:	RETURN WRECK-7

	.FUNCT EAST-LADDER-F
	EQUAL? PRSA,V?CLIMB-FOO \FALSE
	EQUAL? HERE,WRECK-8 \?L3
	CALL DO-WALK,P?DOWN
	JUMP ?L5
?L3:	CALL DO-WALK,P?UP
?L5:	SET 'P-IT-OBJECT,EAST-LADDER
	RTRUE

	.FUNCT SAFE-F
	EQUAL? PRSA,V?THROUGH \?L1
	EQUAL? HERE,WRECK-8 /?L1
	EQUAL? WRECK-CHOSEN,2 /?L1
	CALL GLOBAL-NOT-HERE-PRINT,SAFE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?OPEN /?L4
	EQUAL? PRSA,V?DRILL \?L3
?L4:	EQUAL? PRSI,DRILL \?L5
	FSET SAFE,OPENBIT
	CALL QUEUE,I-CASE-LEAK,-1 >STACK
	PUT STACK,0,1
	PRINTI "As you drill through the lock, the door pops open with a rush of escaping air!"
	FIRST? SAFE >STACK \?L9
	PRINTI " This reveals "
	CALL PRINT-CONTENTS,SAFE
	PRINTI "!"
?L9:	CRLF
	CALL ADD-HOLE,SAFE >STACK
	RSTACK
?L5:	ZERO? PRSI /?L16
	PRINTI "With "
	CALL APRINT,PRSI
	PRINTR "??!?"
?L16:	IN? HOLE-1,SAFE /FALSE
	IN? HOLE-2,SAFE /FALSE
	PRINTR "It's locked."
?L3:	EQUAL? PRSA,V?UNLOCK \FALSE
	IN? HOLE-1,SAFE /?L27
	IN? HOLE-2,SAFE \?L25
?L27:	PRINTR "You've already done it. By brute force."
?L25:	CALL TELL-DONT-HAVE,STR?363 >STACK
	RSTACK

	.FUNCT GLASS-CASE-F
	EQUAL? PRSA,V?OPEN \?L1
	PRINTR "It's sealed shut."
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	PRINTI "The "
	CALL DPRINT,GLASS-CASE
	PRINTI " has a shelf inside it. A collection of extremely rare "
	FSET? STAMPS,RMUNGBIT \?L8
	PRINTI "but soggy "
?L8:	PRINTI "postage stamps sits on the shelf. There is a crack near a bottom corner of the case"
	IN? PUTTY,GLASS-CASE \?L15
	PRINTI ", which is sealed with putty"
?L15:	PRINTI "."
	IN? HOLE-1,GLASS-CASE /?L24
	IN? HOLE-2,GLASS-CASE \?L22
?L24:	PRINTI " Near the crack is the hole you drilled"
	IN? PUTTY,GLASS-CASE \?L27
	ZERO? NO-HOLE-PLUGGED \?L27
	PRINTI ", which is also filled with putty"
?L27:	PRINTI "."
?L22:	GRTR? WATER-IN-CASE,0 \?L35
	PRINTI " The case has some water in it."
?L35:	CRLF
	RTRUE
?L5:	EQUAL? PRSA,V?TAKE,V?POUR \?L42
	EQUAL? PRSO,OCEAN /?L41
?L42:	EQUAL? PRSA,V?EMPTY \?L40
?L41:	ZERO? WATER-IN-CASE \?L43
	PRINTR "There's no water in the case."
?L43:	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK \?L47
	PRINTR "That would be a losing battle."
?L47:	SET 'WATER-IN-CASE,0
	FSET STAMPS,RMUNGBIT
	PRINTI "In the process of emptying the case, you manage to get the stamps wet."
	CRLF
	CALL PRINT-ID,STR?364 >STACK
	RSTACK
?L40:	EQUAL? PRSA,V?DRILL \?L53
	IN? PLAYER,WRECK-5 \?L54
	ZERO? WRECK-5-FLOODED \?L54
	SET 'WATER-IN-CASE,0
	PRINTI "The water pours out of the hole."
	CRLF
	JUMP ?L58
?L54:	SET 'WATER-IN-CASE,10
	CALL INT,I-CASE-LEAK >STACK
	PUT STACK,0,0
	FSET STAMPS,RMUNGBIT
	PRINTI "Water pours into the case, ruining the stamps."
	CRLF
	CALL PRINT-ID,STR?365
?L58:	CALL ADD-HOLE,GLASS-CASE >STACK
	RSTACK
?L53:	EQUAL? PRSA,V?MUNG \FALSE
	EQUAL? PRSO,GLASS-CASE \FALSE
	PRINTI "That wouldn't be too smart."
	CRLF
	CALL PRINT-ID,STR?366 >STACK
	RSTACK

	.FUNCT STAMPS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "These are rare stamps which include a little-known sheet of ""inverted biplanes,"" full sheets of ""Graf Zeppelins,"" and other rarities. Sold at auction, their value would exceed $50 million"
	FSET? STAMPS,RMUNGBIT \?L5
	PRINTI ". Unfortunately, since they're all stuck together and salty, they're not even worth the price of a cup of coffee"
?L5:	PRINTR "."
?L1:	EQUAL? PRSA,V?COUNT \FALSE
	PRINTR "It's hard to tell."

	.FUNCT WRECK-9-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	GET WRECK-9-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \?L5
	EQUAL? WRECK-CHOSEN,2 \?L5
	PUTP CEILING-HOLE-2,P?SDESC,STR?343
	FCLEAR CEILING-HOLE-2,VOWELBIT
	PUTP FLOOR-HOLE-2,P?SDESC,STR?343
	RTRUE
?L5:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? WRECK-CHOSEN,1 \FALSE
	CALL NOT-THIS-WRECK,BUNKS >STACK
	RSTACK

	.FUNCT WRECK-9-U,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	RETURN WRECK-4

	.FUNCT WRECK-9-W,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	ZERO? PRINT? /FALSE
	CALL TELL-CAREFULLY-PICK
	RETURN WEST-OF-WRECK-9
?L1:	CALL TELL-NO-GO,PRINT?
	RFALSE

	.FUNCT EMPTY-CHEST-F,RARG=0
	CALL GENERIC-CHEST-F,EMPTY-CHEST,RARG >STACK
	RSTACK

	.FUNCT GENERIC-CHEST-F,CHEST,RARG
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?WALK \?L10
	EQUAL? P-WALK-DIR,P?UP \?L3
	IN? CHEST,WRECK-13 \?L3
	MOVE PLAYER,WRECK-8
	SET 'HERE,WRECK-8
	ZERO? CHEST-CLIMB-POINTS /?L5
	CALL RATING-UPD,CHEST-CLIMB-POINTS
	SET 'CHEST-CLIMB-POINTS,0
?L5:	PRINTI "You reach the first unbroken rung and climb the ladder..."
	CRLF
	CRLF
	CALL WRECK-8-F,M-ENTER
	CALL V-FIRST-LOOK
	RTRUE
?L3:	EQUAL? PRSA,V?WALK \?L10
	EQUAL? P-WALK-DIR,P?UP /?L10
	CALL TELL-YOUD-BETTER,STR?367,1 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?MOVE \FALSE
	EQUAL? PRSO,SAFETY-LINE \FALSE
	IN? SAFETY-LINE,CHEST \FALSE
	CALL PRINT-ID,STR?368
	CALL JIGS-UP,STR?369 >STACK
	RSTACK
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?CLIMB-FOO \?L14
	CALL PERFORM,V?CLIMB-ON,CHEST
	RTRUE
?L14:	EQUAL? PRSA,V?TAKE \?L16
	PRINTR "It's much too heavy."
?L16:	EQUAL? PRSA,V?PUSH-TO \?L19
	IN? SAFETY-LINE,CHEST \?L19
	EQUAL? P-WALK-DIR,P?EAST \?L19
	CALL TELL-TOO-SHORT >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?TIE \FALSE
	EQUAL? PRSO,SAFETY-LINE /?L23
	EQUAL? PRSI,SAFETY-LINE \FALSE
?L23:	IN? SAFETY-LINE,CHEST \?L24
	CALL TELL-ALREADY,STR?370 >STACK
	RSTACK
?L24:	MOVE SAFETY-LINE,CHEST
	FSET SAFETY-LINE,NDESCBIT
	ZERO? CHEST-TIE-POINTS /?L27
	CALL RATING-UPD,CHEST-TIE-POINTS
	SET 'CHEST-TIE-POINTS,0
?L27:	CALL INT,I-PENDULUM >STACK
	PUT STACK,0,0
	PRINTR "Tied."

	.FUNCT JAGGED-HOLE-F,OUTSIDE?=0
	EQUAL? HERE,WEST-OF-WRECK-9,WEST-OF-WRECK-11 \?L1
	SET 'OUTSIDE?,1
?L1:	EQUAL? PRSA,V?THROUGH \?L4
	ZERO? OUTSIDE? /?L6
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L6:	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?PUSH-THROUGH \?L9
	EQUAL? PRSI,JAGGED-HOLE \?L9
	ZERO? OUTSIDE? /?L10
	SET 'P-WALK-DIR,P?EAST
	JUMP ?L12
?L10:	SET 'P-WALK-DIR,P?WEST
?L12:	CALL PERFORM,V?PUSH-TO,PRSO,INTDIR
	RTRUE
?L9:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL TELL-YOU-CANT,STR?18 >STACK
	RSTACK

	.FUNCT TELL-TOO-SHORT,STR=0
	PRINTI "The "
	CALL DPRINT,SAFETY-LINE
	PRINTI " isn't long enough"
	ZERO? STR /?L3
	PRINT STR
?L3:	PRINTR "."

	.FUNCT GENERIC-WEST-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are on the murky ocean floor, outside the rotted hull of a "
	CALL DPRINT,SHIPWRECK
	PRINTR ". You can return to the wreck through the hole in the hull to starboard."
?L1:	EQUAL? RARG,M-BEG \?L5
	EQUAL? PRSA,V?WALK \?L6
	EQUAL? P-WALK-DIR,P?EAST,P?IN \?L8
	IN? SAFETY-LINE,PLAYER \FALSE
	CALL TELL-TOO-SHORT,STR?371
	RETURN 2
?L8:	ZERO? P-WALK-DIR /FALSE
	CALL LINE-SNAGS >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?WAIT-FOR \FALSE
	EQUAL? PRSO,SAFETY-LINE \FALSE
	CALL QUEUED?,I-PENDULUM >STACK
	ZERO? STACK /FALSE
	IN? SAFETY-LINE,HERE \?L18
	SET 'CLOCK-WAIT,1
	PRINTR "It's right here!"
?L18:	CALL V-WAIT >STACK
	RSTACK
?L5:	EQUAL? RARG,M-END \FALSE
	IN? SAFETY-LINE,HERE \FALSE
	CALL ENABLED?,I-PENDULUM >STACK
	ZERO? STACK \FALSE
	CALL QUEUE,I-PENDULUM,3 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT LINE-SNAGS
	CALL PRINT-ID,STR?372
	CALL JIGS-UP,STR?373 >STACK
	RSTACK

	.FUNCT SAFETY-LINE-F,RARG=0,MSTR
	EQUAL? RARG,M-OBJDESC \?L1
	PRINTI "The "
	CALL DPRINT,SAFETY-LINE
	PRINTR " from the ship is swaying to and fro."
?L1:	EQUAL? PRSA,V?TAKE \?L5
	IN? SAFETY-LINE,TREASURE-CHEST /?L8
	IN? SAFETY-LINE,EMPTY-CHEST \?L6
?L8:	PRINTR "It's tied to the chest."
?L6:	IN? SAFETY-LINE,HERE /?L11
	PRINTR "It's no longer here."
?L11:	CALL ITAKE >STACK
	ZERO? STACK /TRUE
	CALL INT,I-PENDULUM >STACK
	PUT STACK,0,0
	PRINTR "Taken."
?L5:	EQUAL? PRSA,V?UNTIE \?L18
	IN? SAFETY-LINE,TREASURE-CHEST /?L21
	IN? SAFETY-LINE,EMPTY-CHEST \?L19
?L21:	CALL META-LOC,SAFETY-LINE >STACK
	MOVE SAFETY-LINE,STACK
	FCLEAR SAFETY-LINE,NDESCBIT
	CALL QUEUE,I-PENDULUM,3 >STACK
	PUT STACK,0,1
	PRINTR "Untied."
?L19:	PRINTR "It's not tied to anything!"
?L18:	EQUAL? PRSA,V?MOVE \?L27
	PRINTI "The line starts to move upward"
	SET 'MSTR,STR?374
	IN? SAFETY-LINE,TREASURE-CHEST \?L30
	LOC WEASEL >STACK
	MOVE TREASURE-CHEST,STACK
	JUMP ?L33
?L30:	IN? SAFETY-LINE,EMPTY-CHEST \?L32
	LOC WEASEL >STACK
	MOVE EMPTY-CHEST,STACK
	JUMP ?L33
?L32:	SET 'MSTR,STR?375
	CALL INT,I-PENDULUM >STACK
	PUT STACK,0,0
	LOC WEASEL >STACK
	MOVE SAFETY-LINE,STACK
?L33:	PRINT MSTR
	CRLF
	RTRUE
?L27:	EQUAL? PRSA,V?CLIMB-FOO \?L36
	CALL LINE-SNAGS >STACK
	RSTACK
?L36:	EQUAL? PRSA,V?CUT \FALSE
	PRINTI "This rope is too strong."
	CRLF
	CALL PRINT-ID,STR?376 >STACK
	RSTACK

	.FUNCT WRECK-10-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	GET WRECK-10-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \FALSE
	FSET? DEEP-SUIT,WORNBIT /?L6
	FSET? MASK,WORNBIT \?L8
	IN? AIR-TANK,PLAYER \?L8
	FSET? WET-SUIT,WORNBIT /?L6
?L8:	CALL PRINT-ID,STR?377
	CALL JIGS-UP,WATERY-ENVIRONMENT >STACK
	RSTACK
?L6:	CALL COMPILER-SUCKS-EXP-2 >STACK
	ZERO? STACK /FALSE
	CALL INT,I-CASE-LEAK >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT WRECK-10-U,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	RETURN WRECK-5

	.FUNCT LOCKER-DOOR-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? LOCKER-DOOR,OPENBIT \?L3
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L3:	FSET LOCKER-DOOR,OPENBIT
	CALL TELL-NOW,LOCKER-DOOR,STR?44 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLOSE \?L6
	FSET? LOCKER-DOOR,OPENBIT \?L7
	FCLEAR LOCKER-DOOR,OPENBIT
	CALL TELL-NOW,LOCKER-DOOR,STR?45 >STACK
	RSTACK
?L7:	CALL TELL-ALREADY,STR?45 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?READ \?L10
	CALL FIXED-FONT-ON
	PRINTI "    ""S.S. LEVIATHAN
     STORAGE LOCKER
   DANGER: EXPLOSIVES!""
"
	CALL FIXED-FONT-OFF
	RTRUE
?L10:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "The door, which has a sign on it, is "
	FSET? LOCKER-DOOR,OPENBIT \?L16
	PRINTI "open"
	JUMP ?L20
?L16:	PRINTI "closed"
?L20:	PRINTR "."

	.FUNCT SKELETON-F,RARG=0
	EQUAL? RARG,M-OBJDESC \?L1
	PRINTI "Some who went down with the ship were in here, where they are nothing more than "
	CALL DPRINT,SKELETON
	PRINTR "s."
?L1:	EQUAL? PRSA,V?KILL \?L5
	PRINTI "The "
	CALL DPRINT,SKELETON
	PRINTI "s remain dead."
	CRLF
	CALL PRINT-ID,STR?378 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?TAKE,V?ATTACK,V?MUNG /?L9
	EQUAL? PRSA,V?PUSH \?L8
?L9:	PRINTI "One of the "
	CALL DPRINT,SKELETON
	PRINTI "s falls apart."
	CRLF
	CALL PRINT-ID,STR?379 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?COUNT,V?EXAMINE \FALSE
	PRINTI "There are about fifty of them. "
	EQUAL? PRSA,V?COUNT \?L15
	PRINTR "It's hard to tell exactly."
?L15:	PRINTI "As you look around, you notice that one of the "
	CALL DPRINT,SKELETON
	PRINTI "s has what looks like a "
	CALL DPRINT,SCABBARD
	PRINTR " at its hip."

	.FUNCT SCABBARD-F,F
	EQUAL? PRSA,V?TAKE \?L1
	PRINTI "The "
	CALL DPRINT,SCABBARD
	PRINTI " is stuck to the "
	CALL DPRINT,SKELETON
	PRINTR " by encrusted barnacles."
?L1:	EQUAL? PRSA,V?EXAMINE \?L5
	PRINTI "There is very little of the original leather left to this "
	CALL DPRINT,SCABBARD
	PRINTI ", but barnacles have collected in its place."
	FIRST? SCABBARD >F \?L8
	PRINTI " There is "
	CALL APRINT,F
	PRINTI " in the "
	CALL DPRINT,SCABBARD
	PRINTI "."
?L8:	CRLF
	RTRUE
?L5:	EQUAL? PRSA,V?OPEN \?L13
	CALL TELL-ALREADY,STR?44 >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?CLOSE \?L14
	PRINTR "It doesn't close."
?L14:	EQUAL? PRSA,V?CUT \FALSE
	CALL TELL-BARNACLES >STACK
	RSTACK

	.FUNCT TELL-BARNACLES
	PRINTR "The barnacles are too firmly emplaced."

	.FUNCT BARNACLE-PSEUDO,PARG=0
	EQUAL? PARG,M-NAME \?L1
	PUTP PSEUDO-OBJECT,P?SDESC,STR?380
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "The barnacles look very firmly emplaced."
?L3:	EQUAL? PRSA,V?MOVE,V?CUT,V?TAKE \FALSE
	CALL TELL-BARNACLES >STACK
	RSTACK

	.FUNCT WRECK-11-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	GET WRECK-11-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	IN? MINE,MAGNET \FALSE
	IN? MAGNET,PLAYER \FALSE
	ZERO? MAGNET-ON /FALSE
	PRINTI "The mine bumps a "
	CALL DPRINT,BULKHEADS
	PRINTI "..."
	CRLF
	CRLF
	CALL BOOM >STACK
	RSTACK

	.FUNCT WRECK-11-U,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	ZERO? PRINT? \?L4
	RETURN WRECK-6
?L4:	FSET? MINE,RMUNGBIT /?L6
	PRINTI "As you make your way up, you bump the floating mine. A second later..."
	CRLF
	CRLF
	CALL BOOM >STACK
	RSTACK
?L6:	FSET? AIR-TANK,WORNBIT \?L9
	RETURN WRECK-6
?L9:	CALL TELL-TOO-BIG
	RFALSE

	.FUNCT WRECK-11-S,PRINT?=1
	EQUAL? WRECK-CHOSEN,2 \?L1
	CALL TELL-NO-GO,PRINT?
	RFALSE
?L1:	RETURN WRECK-12

	.FUNCT TELL-CAREFULLY-PICK
	PRINTI "You carefully pick your way through the jagged edge of the hole..."
	CRLF
	CRLF
	RTRUE

	.FUNCT WRECK-11-W,PRINT?=1
	EQUAL? WRECK-CHOSEN,1 \?L1
	ZERO? PRINT? /FALSE
	CALL TELL-CAREFULLY-PICK
	RETURN WEST-OF-WRECK-11
?L1:	CALL TELL-NO-GO,PRINT?
	RFALSE

	.FUNCT TREASURE-CHEST-F,RARG=0
	CALL GENERIC-CHEST-F,TREASURE-CHEST,RARG >STACK
	RSTACK

	.FUNCT MINE-F
	EQUAL? PRSA,V?THROW-OFF,V?THROW,V?TAKE /?L3
	EQUAL? PRSA,V?PUSH,V?MUNG,V?MOVE /?L3
	EQUAL? PRSA,V?PUSH-TO \?L1
?L3:	CALL BOOM >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	IN? MINE,MAGNET \?L5
	ZERO? MAGNET-ON /?L5
	PRINTI "A single mine is being held by the "
	CALL DPRINT,MAGNET
	PRINTR " which is safely attached between its spikes."
?L5:	FSET? MINE,RMUNGBIT \?L9
	PRINTI "A single mine is floating relatively harmlessly in one corner of the room."
	JUMP ?L12
?L9:	PRINTI "This mine is blocking the hole that leads to the room above."
?L12:	PRINTI " It has lots of widely-spaced spikes pointing out from it."
	IN? MINE,MAGNET \?L17
	PRINTI " You are holding the "
	CALL DPRINT,MAGNET
	PRINTI " next to it."
?L17:	CRLF
	RTRUE

	.FUNCT CLUMP-OF-MINES-F,RARG=0
	EQUAL? RARG,M-OBJDESC \?L1
	PRINTI "A number of spherical mines with spikes sticking out of them litter the room. These mines must have once been used to blockade shipping lanes. Most of them are tethered together on the deck, but one is "
	IN? MINE,MAGNET \?L5
	ZERO? MAGNET-ON /?L7
	PRINTI "being held by the "
	JUMP ?L11
?L7:	PRINTI "touching your "
?L11:	CALL DPRINT,MAGNET
	JUMP ?L19
?L5:	FSET? MINE,RMUNGBIT \?L16
	PRINTI "floating in a corner of the room"
	JUMP ?L19
?L16:	PRINTI "floating up near the hole in the "
	CALL DPRINT,CEILING
?L19:	PRINTR "."
?L1:	EQUAL? PRSA,V?TAKE \FALSE
	CALL BOOM >STACK
	RSTACK

	.FUNCT BOOM
	CALL PRINT-ID,STR?381
	CALL JIGS-UP,STR?382 >STACK
	RSTACK

	.FUNCT WRECK-12-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	GET WRECK-12-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \FALSE
	CALL QUEUE,I-SQUID,2 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT SQUID-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The squid is huge, its body 20 feet long, and each of its ten arms 35 feet long! It is currently asleep, its arms waving placidly beneath its body."
?L1:	EQUAL? PRSA,V?ALARM \FALSE
	PRINTI "As it awakens, the behemoth turns to you. "
	CALL I-SQUID >STACK
	RSTACK

	.FUNCT WRECK-13-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	GET WRECK-13-DESCS,WRECK-CHOSEN >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT WRECK-13-U,PRINT?=1
	ZERO? PRINT? \?L1
	RETURN WRECK-8
?L1:	CALL TELL-CANT-REACH,STR?383
	RFALSE

	.FUNCT NOT-THIS-WRECK,OBJ
	EQUAL? PRSO,OBJ /?L3
	EQUAL? PRSI,OBJ \FALSE
?L3:	CALL GLOBAL-NOT-HERE-PRINT,OBJ
	RTRUE

	.FUNCT TELL-NEVER-KNEW
	PRINTR """Never heard of him."""

	.FUNCT MCGINTY-F,RARG=0,OBJ,PFLAG=0
	EQUAL? RARG,M-OBJDESC \?L1
	ZERO? MCGINTY-KNOWS \?L6
	IN? PASSBOOK,PLAYER \?L5
	CALL QUEUED?,I-MCGINTY-FOLLOWS >STACK
	ZERO? STACK \?L5
	SET 'PFLAG,1
	CALL MCGINTY-WILL-FOLLOW
	JUMP ?L6
?L5:	IN? PASSBOOK,HERE \?L6
	CALL MCGINTY-WILL-FOLLOW
	MOVE PASSBOOK,MCGINTY
	SET 'PFLAG,2
?L6:	CALL IN-MOTION?,MCGINTY >STACK
	ZERO? STACK \TRUE
	CALL QUEUED?,I-MCGINTY-FOLLOWS >STACK
	ZERO? STACK /?L11
	EQUAL? PRSA,V?FOLLOW,V?WALK \?L11
	LOC PLAYER >STACK
	IN? MCGINTY,STACK \TRUE
?L11:	CALL TRAITOR-TIME? >STACK
	ZERO? STACK \TRUE
	FSET? MCGINTY,TOUCHBIT \?L12
	CALL DPRINT,MCGINTY
	PRINTI " is here, "
	EQUAL? HERE,OUTFITTERS-HQ \?L15
	PRINTI "talking with the salesman"
	JUMP ?L19
?L15:	PRINTI "smoking his cigar"
?L19:	PRINTI "."
	JUMP ?L24
?L12:	CALL DPRINT,MCGINTY
	PRINTI ", a small, nervous man, is "
	IN? MCGINTY,MCGINTY-HQ \?L27
	PRINTI "sitting behind a desk"
	JUMP ?L31
?L27:	PRINTI "standing nearby"
?L31:	PRINTI ". His lips clamp around a cigar too large for his face."
	FSET MCGINTY,TOUCHBIT
?L24:	EQUAL? PFLAG,1 \?L36
	CALL TELL-EYES-NARROW
	CRLF
	RTRUE
?L36:	EQUAL? PFLAG,2 \?L38
	CALL TELL-TAKE-PASS,STR?384
?L38:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-CONT \?L45
	EQUAL? PRSA,V?TAKE \FALSE
	FSET? PRSO,TAKEBIT \FALSE
	CALL DPRINT,MCGINTY
	PRINTI " pulls it back. ""I'm not gonna give that to you!"""
	CRLF
	CALL PRINT-ID,STR?385
	RTRUE
?L45:	EQUAL? WINNER,MCGINTY \?L53
	CALL META-LOC,PLAYER >STACK
	IN? MCGINTY,STACK /?L49
	SET 'P-CONT,0
	CALL TELL-NOT-HERE-TALK
	RETURN 2
?L49:	CALL TRAITOR-TIME? >STACK
	ZERO? STACK /?L53
	CALL TELL-IN-MEETING
	RETURN 2
?L53:	FSET MCGINTY,TOUCHBIT
	EQUAL? PRSA,V?FOLLOW \?L58
	EQUAL? PRSO,MCGINTY /FALSE
?L58:	EQUAL? PRSA,V?$0024CALL \?L60
	CALL TRAITOR-TIME? >STACK
	ZERO? STACK /?L60
	CALL TELL-IN-MEETING
	RTRUE
?L60:	EQUAL? PRSA,V?HELLO \?L61
	SET 'QCONTEXT,MCGINTY
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """Howdy."""
?L61:	EQUAL? PRSA,V?GOODBYE \?L64
	SET 'QCONTEXT,MCGINTY
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """So long."""
?L64:	EQUAL? PRSA,V?TAKE \?L69
	EQUAL? PRSI,MCGINTY /?L68
?L69:	EQUAL? PRSA,V?ASK-FOR \?L67
	EQUAL? PRSO,MCGINTY \?L67
?L68:	EQUAL? PRSO,MCGINTY \?L70
	SET 'OBJ,PRSI
	JUMP ?L72
?L70:	SET 'OBJ,PRSO
?L72:	IN? OBJ,MCGINTY \?L73
	PRINTR """I'm not gonna give that to you."""
?L73:	PRINTR """I don't have that."""
?L67:	EQUAL? PRSA,V?BUY \?L81
	EQUAL? PRSO,FERRY-TOKEN \?L81
	PRINTR """I don't have one. Try the bank."""
?L81:	EQUAL? PRSA,V?$0024CALL \?L87
	EQUAL? WINNER,PLAYER /FALSE
?L87:	CALL GRAB-ATTENTION,MCGINTY >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?TELL \?L91
	EQUAL? PRSO,MCGINTY \?L91
	EQUAL? PRSI,SAMPLE-TREASURE,GLOBAL-TREASURE \?L119
	CALL TRAITOR-TIME? >STACK
	ZERO? STACK /?L95
	CALL PRINT-ID,STR?386
	CALL JIGS-UP,STR?387
	RTRUE
?L95:	ZERO? MCGINTY-KNOWS /?L97
	PRINTR """Thanks, but I already know about it."""
?L97:	IN? SPEAR-CARRIER,HERE /?L103
	IN? JOHNNY,HERE /?L103
	IN? PETE,HERE /?L103
	IN? WEASEL,HERE \?L101
?L103:	SET 'MCGINTY-KNOWS,1
	CALL ZERO-ATTENTION,MCGINTY
	GET GOAL-TABLES,MCGINTY-C >STACK
	PUT STACK,GOAL-ENABLE,1
	CALL DPRINT,MCGINTY
	PRINTI " looks delighted with the information."
	IN? MCGINTY,OUTFITTERS-HQ \?L106
	CALL ESTABLISH-GOAL,MCGINTY,MCGINTY-HQ
	IN? JOHNNY,OUTFITTERS-HQ \?L108
	CALL SAY-MCGINTY-KNOWS
	RTRUE
?L108:	PRINTI " He thanks you."
	CALL TELL-NEED-BOAT
	RTRUE
?L106:	CALL ESTABLISH-GOAL,MCGINTY,OUTFITTERS-HQ
	CALL ALL-GO-HOME
	CALL I-PLOT-NEVER-STARTS
	CALL INT,I-SHOVE-OFF >STACK
	PUT STACK,0,0
	PRINTR " ""Excuse me,"" he says. ""I have business to attend to."""
?L101:	CALL PRINT-ID,STR?388
	CALL JIGS-UP,STR?389
	RTRUE
?L91:	EQUAL? PRSA,V?SHOW \?L118
	EQUAL? PRSO,BOOK,NOTE \?L118
	EQUAL? PRSI,MCGINTY \?L118
	CALL PERFORM,V?TELL,MCGINTY,GLOBAL-TREASURE
	RTRUE
?L118:	EQUAL? PRSA,V?ASK-ABOUT \?L119
	EQUAL? PRSO,MCGINTY \?L119
	CALL TRAITOR-TIME? >STACK
	ZERO? STACK /?L120
	CALL TELL-IN-MEETING
	RETURN 2
?L120:	EQUAL? PRSI,GLOBAL-TREASURE \?L124
	PRINTI """I'm always looking for "
	CALL DPRINT,GLOBAL-TREASURE
	PRINTR ","" he says, grinning."
?L124:	EQUAL? PRSI,SPEAR-CARRIER \?L127
	PRINTR """He does his job."""
?L127:	EQUAL? PRSI,PETES-PATCH \?L130
	PRINTR """All I know is that Pete wears it."""
?L130:	EQUAL? PRSI,CIGAR \?L133
	PRINTR """Yeah. That's my cigar."""
?L133:	EQUAL? PRSI,HEVLIN \?L136
	CALL TELL-NEVER-KNEW
	RTRUE
?L136:	EQUAL? PRSI,WEASEL,PETE,JOHNNY \?L137
	PRINTR """He's worked for me. He's all right."""
?L137:	EQUAL? PRSI,ME \?L140
	CALL TELL-YOURE-DIVER
	RTRUE
?L140:	EQUAL? PRSI,MCGINTY \?L141
	CALL TELL-KNOW-ME
	RTRUE
?L141:	EQUAL? PRSI,PARROT \?L142
	PRINTR """It's the queerest bird I've ever seen."""
?L142:	EQUAL? PRSI,SALVAGER,TRAWLER \FALSE
	PRINTR """She's a nice boat."""
?L119:	EQUAL? WINNER,MCGINTY \FALSE
	EQUAL? PRSO,GLOBAL-SELF \?L152
	SET 'PRSO,MCGINTY
?L152:	EQUAL? PRSI,GLOBAL-SELF \?L155
	SET 'PRSI,MCGINTY
?L155:	EQUAL? PRSA,V?TELL \?L158
	EQUAL? PRSO,ME /FALSE
?L158:	EQUAL? PRSA,V?$0024CALL \?L160
	CALL TELL-SO-WHAT >STACK
	RSTACK
?L160:	EQUAL? PRSA,V?LEAVE,V?DISEMBARK,V?WALK \?L161
	PRINTR """I'll leave when I'm ready."""
?L161:	EQUAL? PRSA,V?SHOW \?L164
	IN? PRSO,MCGINTY \?L164
	EQUAL? PRSI,ME \?L164
	SET 'WINNER,PLAYER
	CALL PERFORM,V?EXAMINE,PRSO
	SET 'WINNER,MCGINTY
	RETURN WINNER
?L164:	EQUAL? PRSA,V?MAYBE,V?NO,V?YES /FALSE
	EQUAL? PRSA,V?SSHOW,V?FIND,V?WHAT /FALSE
	EQUAL? PRSA,V?ALARM /FALSE
	PRINTI """I'd rather not."""
	CRLF
	RETURN 2

	.FUNCT ZERO-ATTENTION,PER
	GETP PER,P?CHARACTER >STACK
	GET GOAL-TABLES,STACK >STACK
	PUT STACK,ATTENTION,0
	RTRUE

	.FUNCT TELL-SO-WHAT
	FSET? PRSO,VICBIT \?L1
	PRINTR """What about him?"""
?L1:	CALL V-CALL-LOSE >STACK
	RSTACK

	.FUNCT TELL-TAKE-PASS,STR
	PRINT STR
	PRINTI " sees the passbook, picks it up, looks at it and then at you."
	RTRUE

	.FUNCT TRAITOR-TIME?
	IN? ID-CARD,WEASEL \FALSE
	CALL QUEUED?,I-TRAITOR-MEETING >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT TELL-IN-MEETING
	PRINTR "He's too engrossed in his meeting to hear you."

	.FUNCT MCGINTY-ERRAND
	MOVE PLAYER,WHARF-ROAD-2
	MOVE MCGINTY,WHARF-ROAD-2
	SET 'HERE,WHARF-ROAD-2
	PRINTI """I'm closing to run an errand,"" "
	CALL DPRINT,MCGINTY
	PRINTI " says, ushering you out..."
	CRLF
	CRLF
	CALL V-FIRST-LOOK >STACK
	RSTACK

	.FUNCT I-MCGINTY,GARG=0,L,DEST,MMG,V=0
	LOC MCGINTY >L
	ZERO? GARG \?L1
	GET MOVEMENT-GOALS,MCGINTY-C >MMG
	IN? MCGINTY,MCGINTY-HQ \?L3
	IN? PLAYER,MCGINTY-HQ \?L3
	GET MMG,MG-ROOM >STACK
	EQUAL? STACK,MCGINTY-HQ /?L3
	CALL MCGINTY-ERRAND
	SET 'V,1
?L3:	EQUAL? L,FERRY-LANDING \?L6
	SET 'MCGINTY-MEETS-WEASEL,0
?L6:	CALL IMOVEMENT,MCGINTY,I-MCGINTY
	RETURN V
?L1:	EQUAL? GARG,G-REACHED \?L9
	EQUAL? L,MCGINTY-HQ \?L10
	IN? PLAYER,L \?L12
	CALL PRINT-ID,STR?390
	CALL JIGS-UP,STR?391
	JUMP ?L16
?L12:	IN? PLAYER,WHARF-ROAD-2 \?L14
	EQUAL? LAST-PLAYER-LOC,MCGINTY-HQ \?L14
	CALL PRINT-ID,STR?392
	CALL JIGS-UP,STR?393
	JUMP ?L16
?L14:	IN? ID-CARD,MCGINTY \?L15
	MOVE ID-CARD,ENVELOPE
	FSET ID-CARD,TAKEBIT
	FCLEAR ENVELOPE,INVISIBLE
	JUMP ?L16
?L15:	ZERO? MCGINTY-KNOWS \?L16
	ZERO? MCGINTY-MEETS-WEASEL /?L16
	GET MOVEMENT-GOALS,MCGINTY-C >STACK
	GET STACK,MG-ROOM >STACK
	EQUAL? STACK,SHANTY \?L16
	PUT MOVEMENT-GOALS,MCGINTY-C,MCGINTY-MEETS-WEASEL-TABLE
	CALL IMOVEMENT,MCGINTY,I-MCGINTY
	RFALSE
?L16:	IN? PLAYER,BACK-ALLEY-2 \FALSE
	FSET? WINDOW,OPENBIT \FALSE
	PRINTI "The window gets slammed shut."
	CRLF
	FCLEAR BACK-WINDOW,OPENBIT
	RTRUE
?L10:	EQUAL? L,FERRY-LANDING \?L23
	CALL QUEUE,I-TRAITOR-MEETING,-1 >STACK
	PUT STACK,0,1
	IN? PLAYER,L \?L24
	CALL DPRINT,MCGINTY
	PRINTI " wanders in, looking preoccupied."
	CRLF
	SET 'V,1
?L24:	IN? WEASEL,L \?L29
	CALL I-TRAITOR-MEETING
?L29:	RETURN V
?L23:	EQUAL? L,HERE \?L32
	CALL DPRINT,MCGINTY
	PRINTI " wanders in."
	IN? PASSBOOK,PLAYER \?L35
	ZERO? MCGINTY-KNOWS \?L35
	CALL QUEUED?,I-MCGINTY-FOLLOWS >STACK
	ZERO? STACK \?L35
	CALL MCGINTY-WILL-FOLLOW
	CALL TELL-EYES-NARROW
	JUMP ?L37
?L35:	IN? PASSBOOK,L \?L37
	SET 'MCGINTY-MEETS-WEASEL,1
?L37:	CRLF
	RETURN 2
?L32:	IN? PASSBOOK,L \FALSE
	MOVE PASSBOOK,MCGINTY
	SET 'MCGINTY-MEETS-WEASEL,1
	RFALSE
?L9:	EQUAL? GARG,G-ENROUTE \FALSE
	IN? PLAYER,L \?L44
	IN? PASSBOOK,PLAYER \?L44
	ZERO? MCGINTY-KNOWS \?L44
	CALL QUEUED?,I-MCGINTY-FOLLOWS >STACK
	ZERO? STACK \?L44
	CALL MCGINTY-WILL-FOLLOW
	CALL TELL-EYES-NARROW,0
	CRLF
	RTRUE
?L44:	IN? PASSBOOK,L \FALSE
	ZERO? MCGINTY-KNOWS \FALSE
	CALL META-LOC,PLAYER >STACK
	IN? MCGINTY,STACK \?L47
	CALL MCGINTY-WILL-FOLLOW
	MOVE PASSBOOK,MCGINTY
	CALL TELL-TAKE-PASS,STR?394
	CRLF
	RTRUE
?L47:	SET 'MCGINTY-MEETS-WEASEL,1
	MOVE PASSBOOK,MCGINTY
	RFALSE

	.FUNCT TELL-EYES-NARROW,SPACE=1
	ZERO? ALREADY-FOLLOWED \FALSE
	ZERO? SPACE /?L3
	PRINTI " "
?L3:	PRINTI "As he looks at you, he does a double take and stares intently at your possessions."
	RTRUE

	.FUNCT MCGINTY-WILL-FOLLOW,GT
	ZERO? MCGINTY-KNOWS \FALSE
	GET GOAL-TABLES,MCGINTY-C >GT
	PUT GT,GOAL-ENABLE,0
	PUT GT,GOAL-F,WRECK-13
	PUT GT,ATTENTION,500
	CALL INT,I-MCGINTY >STACK
	PUT STACK,0,0
	CALL QUEUE,I-MCGINTY-FOLLOWS,-1 >STACK
	PUT STACK,0,1
	RTRUE

	.FUNCT I-MCGINTY-FOLLOWS,GT,MCG-LOC,?TMP
	LOC MCGINTY >MCG-LOC
	GRTR? PRESENT-TIME,810 \?L1
	ZERO? ALREADY-FOLLOWED \?L1
	CALL INT,I-MCGINTY-FOLLOWS >STACK
	PUT STACK,0,0
	GET GOAL-TABLES,MCGINTY-C >GT
	PUT GT,ATTENTION,0
	PUT GT,GOAL-ENABLE,1
	SET 'ALREADY-FOLLOWED,1
	CALL ESTABLISH-GOAL,MCGINTY,MCGINTY-HQ
	RFALSE
?L1:	GET GOAL-TABLES,MCGINTY-C >STACK
	PUT STACK,ATTENTION,5
	EQUAL? HERE,OUTFITTERS-HQ \?L4
	EQUAL? MCG-LOC,WHARF-ROAD-4 \?L4
	CALL MOVE-PERSON,MCGINTY,OUTFITTERS-HQ >STACK
	RSTACK
?L4:	EQUAL? HERE,MCG-LOC,LAST-PLAYER-LOC /FALSE
	EQUAL? MCG-LOC,LAST-PLAYER-LOC /FALSE
	SET '?TMP,LAST-PLAYER-LOC
	CALL META-LOC,LAST-PLAYER-LOC >STACK
	EQUAL? ?TMP,STACK \FALSE
	CALL MOVE-PERSON,MCGINTY,LAST-PLAYER-LOC >STACK
	RSTACK

	.FUNCT CIGAR-F
	EQUAL? PRSA,V?TAKE \?L1
	CALL DPRINT,MCGINTY
	PRINTI " yanks it back, then tenderly clamps it between his teeth."
	CRLF
	CALL PRINT-ID,STR?395 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LAMP-ON \?L5
	CALL TELL-ALREADY,STR?396 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?SMELL \FALSE
	PRINTR "The cigar smells like a burning tire."

	.FUNCT JOHNNY-F,RARG=0,TREAS,?TMP
	EQUAL? RARG,M-OBJDESC \?L1
	CALL QUEUED?,I-PENDULUM >STACK
	ZERO? STACK /?L3
	CALL INT,I-PENDULUM >STACK
	GET STACK,C-TICK >STACK
	EQUAL? STACK,-1 /TRUE
?L3:	CALL IN-MOTION?,JOHNNY >STACK
	ZERO? STACK \TRUE
	EQUAL? HERE,MM-AFT-DECK,NW-AFT-DECK \?L6
	ZERO? WEASEL-APPREHENDED /?L6
	CALL QUEUED?,I-PENDULUM >STACK
	ZERO? STACK \?L6
	CALL I-JOHNNY,G-REACHED
	RTRUE
?L6:	FSET? JOHNNY,TOUCHBIT \?L7
	CALL DPRINT,JOHNNY
	PRINTI " is here"
	IN? SPEAR-CARRIER,HERE \?L16
	IN? MCGINTY,HERE \?L12
	PRINTI ", glaring at "
	CALL DPRINT,MCGINTY
	JUMP ?L16
?L12:	LESS? FM-CTR,2 /?L17
	GRTR? FM-CTR,4 \?L16
?L17:	EQUAL? PRESENT-TIME,704 /?L16
	PRINTI ", chatting with the "
	CALL DPRINT,SPEAR-CARRIER
?L16:	PRINTR "."
?L7:	CALL DPRINT,JOHNNY
	PRINTI " is here. Red hair sprouts from his head and from beneath his flannel shirt."
	CRLF
	FSET JOHNNY,TOUCHBIT
	RTRUE
?L1:	EQUAL? RARG,M-CONT \?L35
	EQUAL? PRSA,V?TAKE \?L28
	FSET? PRSO,TAKEBIT \?L28
	PRINTI "Johnny glares down at you. ""Get your hands off of that!"""
	CRLF
	CALL PRINT-ID,STR?397
	RTRUE
?L28:	EQUAL? KNIFE,PRSO,PRSI \FALSE
	EQUAL? PRSA,V?ASK-ABOUT,V?FIND,V?EXAMINE /FALSE
	EQUAL? PRSA,V?ASK-CONTEXT-ABOUT /FALSE
	PRINTI "Johnny pulls it back. ""I'm not gonna let you give this to "
	CALL DPRINT,WEASEL
	PRINTR "."""
?L35:	EQUAL? JOHNNY,WINNER \?L37
	CALL META-LOC,JOHNNY >?TMP
	CALL META-LOC,PLAYER >STACK
	EQUAL? ?TMP,STACK /?L37
	SET 'P-CONT,0
	CALL TELL-NOT-HERE-TALK
	RETURN 2
?L37:	FSET JOHNNY,TOUCHBIT
	EQUAL? PRSA,V?FOLLOW \?L42
	EQUAL? PRSO,JOHNNY /FALSE
?L42:	EQUAL? PRSA,V?TELL \?L44
	ZERO? PRSI /FALSE
?L44:	ZERO? MCGINTY-KNOWS \?L46
	ZERO? JOHNNY-SILENT /?L45
?L46:	CALL DPRINT,JOHNNY
	PRINTI " looks right through you."
	CRLF
	RETURN 2
?L45:	EQUAL? PRSA,V?GOODBYE,V?HELLO \?L51
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """Ahoy, matey."""
?L51:	EQUAL? PRSA,V?BUY \?L55
	EQUAL? PRSO,FERRY-TOKEN \?L55
	PRINTI """Try "
	CALL DPRINT,BANK
	PRINTR "."""
?L55:	EQUAL? PRSA,V?$0024CALL \?L61
	EQUAL? WINNER,PLAYER /FALSE
?L61:	CALL GRAB-ATTENTION,JOHNNY >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?SHOW,V?GIVE \?L65
	EQUAL? PRSO,CHARTS \?L65
	PRINTR """No thanks. I have my own."""
?L65:	EQUAL? PRSA,V?SHOW \?L71
	EQUAL? PRSO,NOTE /?L70
?L71:	EQUAL? PRSA,V?ASK-ABOUT \?L69
	EQUAL? PRSI,NOTE \?L69
?L70:	PRINTR """Yeah. I wrote that."""
?L69:	EQUAL? PRSA,V?GIVE \?L74
	EQUAL? PRSO,ENVELOPE /?L75
	EQUAL? PRSO,ID-CARD \?L74
?L75:	IN? ID-CARD,ENVELOPE /?L76
	CALL TELL-RETURNS,JOHNNY
?L76:	CALL PERFORM,V?SHOW,PRSO,JOHNNY
	RTRUE
?L74:	EQUAL? PRSA,V?SHOW \?L79
	EQUAL? PRSI,JOHNNY \?L79
	IN? ID-CARD,ENVELOPE \?L80
	EQUAL? PRSO,ENVELOPE /?L82
	EQUAL? PRSO,ID-CARD \?L80
?L82:	PRINTI "Johnny takes the card and "
	CALL DPRINT,ENVELOPE
	PRINTI " and studies them. "
	ZERO? WEASEL-APPREHENDED /?L85
	CALL TELL-ALREADY-SHOWN
	PRINTI ","" he says, handing the "
	CALL DPRINT,ENVELOPE
	PRINTR " back."
?L85:	ZERO? CLUMSILY-HANDLED /?L89
	PRINTI """You trying to frame "
	CALL DPRINT,WEASEL
	PRINTI "?"" He returns the "
	CALL DPRINT,ENVELOPE
	PRINTR "."
?L89:	MOVE ENVELOPE,JOHNNY
	PRINTI """So,"" he muses, """
	CALL DPRINT,WEASEL
	PRINTI " is working with "
	CALL DPRINT,MCGINTY
	PRINTI ". I'll take care of him."""
	SET 'WEASEL-BLOWN,1
	LOC JOHNNY >STACK
	IN? WEASEL,STACK \?L95
	CALL ROUGH-JUSTICE
	CRLF
	RTRUE
?L95:	IN? WEASEL,FERRY /?L98
	IN? WEASEL,GLOBAL-FERRY \?L97
?L98:	CALL ESTABLISH-GOAL,JOHNNY,FERRY-LANDING
	CRLF
	RTRUE
?L97:	CALL META-LOC,WEASEL >STACK
	CALL ESTABLISH-GOAL,JOHNNY,STACK
	CRLF
	RTRUE
?L80:	EQUAL? PRSO,ENVELOPE \?L100
	ZERO? WEASEL-BLOWN /?L101
	CALL TELL-ALREADY-SHOWN
	JUMP ?L103
?L101:	PRINTI """It's empty. It don't mean nothing"
	SET 'CLUMSILY-HANDLED,1
?L103:	PRINTR "."""
?L100:	EQUAL? PRSO,ID-CARD \?L117
	ZERO? WEASEL-BLOWN /?L109
	CALL TELL-ALREADY-SHOWN
	JUMP ?L111
?L109:	PRINTI """That's "
	CALL DPRINT,WEASEL
	PRINTI "'s. He'll be glad you found it"
	SET 'CLUMSILY-HANDLED,1
?L111:	PRINTR "."""
?L79:	EQUAL? PRSA,V?ASK-ABOUT \?L117
	EQUAL? PRSO,JOHNNY \?L117
	EQUAL? PRSI,SHARK,SAMPLE-TREASURE,GLOBAL-TREASURE \?L118
	IN? MCGINTY,HERE \?L120
	CALL MCGINTY-AND-TREASURE,GLOBAL-TREASURE
	RTRUE
?L120:	CALL ENABLED?,I-JOHNNY >STACK
	ZERO? STACK /?L123
	ZERO? SAMPLE-TREASURE \?L122
?L123:	PRINTI "Red scowls. ""What "
	CALL DPRINT,GLOBAL-TREASURE
	PRINTR "?"""
?L122:	LESS? SM-CTR,2 \?L126
	PRINTR """All in good time."""
?L126:	LESS? TM-CTR,7 /?L130
	IN? WEASEL,HERE /?L130
	IN? PETE,HERE /?L130
	IN? SPEAR-CARRIER,HERE \?L129
?L130:	PRINTI """I told you. I found a "
	CALL DPRINT,SAMPLE-TREASURE
	PRINTR " while I was cleaning a shark."""
?L129:	EQUAL? PRSI,SHARK \?L133
	PRINTR """I made that up."""
?L133:	PRINTR """Hevlin gave it to me."""
?L118:	EQUAL? PRSI,BOOK \?L139
	LESS? TM-CTR,7 /FALSE
	IN? WEASEL,HERE /FALSE
	IN? PETE,HERE /FALSE
	IN? SPEAR-CARRIER,HERE /FALSE
	PRINTR """That's the one Hevlin gave you."""
?L139:	EQUAL? PRSI,PETES-PATCH \?L146
	PRINTR """Pete's worn it a long time."""
?L146:	EQUAL? PRSI,HEVLIN \?L149
	PRINTR """He was an old friend of mine."""
?L149:	EQUAL? PRSI,SPEAR-CARRIER \?L152
	PRINTR """You know him as well as I do."""
?L152:	EQUAL? PRSI,ME \?L155
	CALL TELL-YOURE-DIVER
	RTRUE
?L155:	EQUAL? PRSI,WEASEL \?L156
	PRINTI """The Weasel? "
	ZERO? WEASEL-BLOWN /?L159
	PRINTR "Lower than a sea slug..."""
?L159:	IN? WEASEL,HERE \?L163
	PRINTI "He's my pal."""
	CALL TELL-FERRY-KLUDGE,STR?398
	CRLF
	RTRUE
?L163:	PRINTR "I wouldn't trust him farther than I could throw a whale! But he's a great one-man crew."""
?L156:	EQUAL? PRSI,MCGINTY \?L169
	IN? MCGINTY,HERE \?L170
	PRINTC 34
	CALL DPRINT,MCGINTY
	PRINTR "'s one of my favorite people to work for!"""
?L170:	PRINTR """That man would sell his mother for a profit!"""
?L169:	EQUAL? PRSI,PETE \?L177
	IN? PETE,HERE \?L178
	PRINTI "Johnny leans over and mutters, "
?L178:	PRINTR """Pete's no genius, but he's dependable. He got a bad name 'cause of what happened, him serving his mates rats for mess. But he'll never make that mistake again!"""
?L177:	EQUAL? PRSI,JOHNNY \?L185
	CALL TELL-KNOW-ME
	RTRUE
?L185:	EQUAL? PRSI,PARROT \?L186
	PRINTI """It's what makes "
	CALL DPRINT,SHANTY
	PRINTR " what it is."""
?L186:	EQUAL? PRSI,SALVAGER,TRAWLER \?L189
	PRINTR """It's one of Outfitters' boats."""
?L189:	EQUAL? PRSI,LINE-HACK \FALSE
	PRINT LINE-STR
	CRLF
	RTRUE
?L117:	EQUAL? WINNER,JOHNNY \FALSE
	EQUAL? PRSO,GLOBAL-SELF \?L199
	SET 'PRSO,JOHNNY
?L199:	EQUAL? PRSI,GLOBAL-SELF \?L202
	SET 'PRSI,JOHNNY
?L202:	IN? MCGINTY,HERE \?L211
	EQUAL? PRSO,SAMPLE-TREASURE,GLOBAL-TREASURE \?L207
	SET 'TREAS,PRSO
	JUMP ?L209
?L207:	EQUAL? PRSI,GLOBAL-TREASURE,SAMPLE-TREASURE \?L209
	SET 'TREAS,PRSI
?L209:	ZERO? TREAS /?L211
	CALL MCGINTY-AND-TREASURE,TREAS
	RTRUE
?L211:	EQUAL? PRSA,V?TELL \?L215
	EQUAL? PRSO,ME /FALSE
?L215:	EQUAL? PRSA,V?$0024CALL \?L217
	CALL TELL-SO-WHAT >STACK
	RSTACK
?L217:	EQUAL? PRSA,V?SHOW \?L218
	IN? PRSO,JOHNNY \?L218
	EQUAL? PRSI,ME \?L218
	SET 'WINNER,PLAYER
	CALL PERFORM,V?EXAMINE,PRSO
	SET 'WINNER,JOHNNY
	RETURN WINNER
?L218:	EQUAL? PRSA,V?MAYBE,V?NO,V?YES /FALSE
	EQUAL? PRSA,V?WHAT,V?LONGITUDE,V?LATITUDE /FALSE
	EQUAL? PRSA,V?ALARM,V?SSHOW,V?FIND /FALSE
	PRINTI """I'll do what I want."""
	CRLF
	RETURN 2

	.FUNCT MCGINTY-AND-TREASURE,TRE
	CALL MCGINTY-WILL-FOLLOW
	PRINTI "Johnny looks at "
	CALL DPRINT,MCGINTY
	PRINTI " and then at you. ""What "
	CALL DPRINT,TRE
	PRINTR "?"""

	.FUNCT TELL-RETURNS,PER
	CALL START-SENTENCE,PER
	PRINTI " looks at the "
	CALL DPRINT,PRSO
	PRINTI " and hands it back to you. "
	RTRUE

	.FUNCT TELL-ALREADY-SHOWN
	CALL TELL-YOU-ALREADY,STR?399,1,0 >STACK
	RSTACK

	.FUNCT TELL-YOU-ALREADY,STR,QUOTE?=0,DONE=1
	ZERO? QUOTE? /?L1
	PRINTI """"
?L1:	PRINTI "You already "
	PRINT STR
	ZERO? DONE /FALSE
	CRLF
	RTRUE

	.FUNCT I-JOHNNY,GARG=0,L,JMG,V,?TMP
	LOC JOHNNY >L
	ZERO? GARG \?L1
	ZERO? WEASEL-BLOWN \FALSE
	GRTR? FM-CTR,1 \?L7
	LESS? FM-CTR,5 /?L6
?L7:	GRTR? TM-CTR,0 \?L5
	LESS? TM-CTR,8 \?L5
?L6:	CALL QUEUE,I-JOHNNY,1 >STACK
	PUT STACK,0,1
	RFALSE
?L5:	GET MOVEMENT-GOALS,JOHNNY-C >JMG
	GET JMG,MG-ROOM >STACK
	EQUAL? STACK,MM-CAPT-CABIN \?L9
	EQUAL? SHIP-CHOSEN,TRAWLER \?L9
	PUT JMG,MG-ROOM,NW-CAPT-CABIN
?L9:	CALL IMOVEMENT,JOHNNY,I-JOHNNY >STACK
	RSTACK
?L1:	EQUAL? GARG,G-REACHED \?L12
	ZERO? WEASEL-APPREHENDED /?L13
	EQUAL? L,MM-LOUNGE,NW-LOUNGE \?L15
	LOC WEASEL >STACK
	IN? PLAYER,STACK \?L17
	CALL TELL-JOHNNY-DRAGS
?L17:	MOVE WEASEL,L
	EQUAL? SHIP-CHOSEN,TRAWLER \?L20
	CALL ESTABLISH-GOAL,JOHNNY,NW-AFT-DECK
	JUMP ?L22
?L20:	CALL ESTABLISH-GOAL,JOHNNY,MM-AFT-DECK
?L22:	IN? PLAYER,L \TRUE
	PRINTI "Johnny drags "
	CALL DPRINT,WEASEL
	PRINTR " in, ties him up, and throws him to the floor."
?L15:	EQUAL? L,MM-AFT-DECK,NW-AFT-DECK \?L42
	CALL QUEUED?,I-PENDULUM >STACK
	ZERO? STACK \?L42
	IN? PLAYER,L \?L42
	CALL QUEUE,I-PENDULUM,-1 >STACK
	PUT STACK,0,1
	FCLEAR LINE-HACK,INVISIBLE
	MOVE LINE-HACK,L
	PRINTI "Johnny approaches, throws a weighted "
	CALL DPRINT,SAFETY-LINE
	PRINTI " over the side, and says, "
	PRINT LINE-STR
	CRLF
	RTRUE
?L13:	ZERO? WEASEL-BLOWN /?L35
	CALL META-LOC,WEASEL >STACK
	EQUAL? L,STACK \?L36
	CALL ROUGH-JUSTICE
	JUMP ?L42
?L36:	IN? WEASEL,GLOBAL-FERRY /FALSE
	IN? WEASEL,FERRY /FALSE
	IN? WEASEL,LOCAL-GLOBALS /FALSE
	GET GOAL-TABLES,JOHNNY-C >STACK
	GET STACK,GOAL-F >?TMP
	CALL META-LOC,WEASEL >STACK
	EQUAL? ?TMP,STACK /?L42
	CALL META-LOC,WEASEL >STACK
	CALL ESTABLISH-GOAL,JOHNNY,STACK
	RFALSE
?L35:	EQUAL? L,OUTFITTERS-HQ \?L42
	EQUAL? MEETINGS-COMPLETED,3 \?L42
	CALL QUEUE,I-EQUIP,-1 >STACK
	PUT STACK,0,1
?L42:	EQUAL? L,HERE \FALSE
	CALL DPRINT,JOHNNY
	PRINTI " appears, striding like a proud lion."
	CRLF
	CALL QUEUED?,I-THIRD-MEETING >STACK
	ZERO? STACK /?L50
	CALL I-THIRD-MEETING
?L50:	RETURN 2
?L12:	EQUAL? GARG,G-ENROUTE \FALSE
	ZERO? WEASEL-BLOWN /FALSE
	ZERO? WEASEL-APPREHENDED /?L59
	LOC WEASEL >STACK
	EQUAL? STACK,MM-LOUNGE,NW-LOUNGE /FALSE
	IN? WEASEL,L \?L63
	SET 'V,1
?L63:	MOVE WEASEL,L
	ZERO? V \?L68
	IN? PLAYER,L \FALSE
?L68:	CALL TELL-JOHNNY-DRAGS >STACK
	RSTACK
?L59:	CALL META-LOC,WEASEL >STACK
	EQUAL? L,STACK \?L72
	CALL ROUGH-JUSTICE >STACK
	RSTACK
?L72:	IN? WEASEL,GLOBAL-FERRY /FALSE
	IN? WEASEL,FERRY /FALSE
	IN? WEASEL,LOCAL-GLOBALS /FALSE
	GET GOAL-TABLES,JOHNNY-C >STACK
	GET STACK,GOAL-F >?TMP
	CALL META-LOC,WEASEL >STACK
	EQUAL? ?TMP,STACK /FALSE
	CALL META-LOC,WEASEL >STACK
	CALL ESTABLISH-GOAL,JOHNNY,STACK
	RFALSE

	.FUNCT TELL-JOHNNY-DRAGS
	PRINTI "Johnny drags "
	CALL DPRINT,WEASEL
	PRINTR " along with him."

	.FUNCT ROUGH-JUSTICE,PRINT?=0
	LOC JOHNNY >STACK
	IN? PLAYER,STACK \?L1
	SET 'PRINT?,1
	CRLF
	PRINTI "Johnny grabs "
	CALL DPRINT,WEASEL
	PRINTI " and his knife. ""All right, slime. Thought you and "
	CALL DPRINT,MCGINTY
	PRINTI " could rip us off, huh?"" Before he turns to lead "
	CALL DPRINT,WEASEL
	PRINTI " away, "
?L1:	ZERO? AT-SEA /?L6
	SET 'WEASEL-APPREHENDED,1
	MOVE KNIFE,JOHNNY
	LOC LOUNGE-CHAIR >STACK
	CALL ESTABLISH-GOAL,JOHNNY,STACK >STACK
	RSTACK
?L6:	ZERO? PRINT? /?L9
	PRINTI "Johnny says, ""We'd have to find someone else to crew. I better call it off."" You head for "
	CALL DPRINT,SHANTY
	PRINTI ", wishing you had more to do today than drink."
	CRLF
	JUMP ?L13
?L9:	CALL TELL-COMES-UP,JOHNNY
	PRINTI """I've taken care of "
	CALL DPRINT,WEASEL
	PRINTI ", but we can't go out without a crew. Maybe next time."""
	CRLF
	CALL PRINT-ID,STR?400
?L13:	CALL FINISH >STACK
	RSTACK

	.FUNCT TELL-COMES-UP,WHO
	CALL START-SENTENCE,WHO
	PRINTI " comes up to you and says, "
	RTRUE

	.FUNCT PETE-F,RARG=0,?TMP
	EQUAL? RARG,M-OBJDESC \?L1
	CALL IN-MOTION?,PETE >STACK
	ZERO? STACK \TRUE
	LOC PETE >STACK
	EQUAL? STACK,MM-GALLEY,NW-GALLEY \?L5
	CALL DPRINT,PETE
	PRINTR " is watching over his stew."
?L5:	GRTR? FM-CTR,1 \?L10
	LESS? FM-CTR,5 /?L9
?L10:	EQUAL? PRESENT-TIME,704 \?L8
?L9:	CALL DPRINT,PETE
	PRINTR " is sitting here, listening intently."
?L8:	FSET? PETE,TOUCHBIT \?L13
	CALL DPRINT,PETE
	PRINTR " fiddles with his eyepatch, shifting his weight from foot to foot."
?L13:	PRINTI "A man wearing an eyepatch, black turtleneck, and jeans is standing about. He is known as "
	CALL DPRINT,PETE
	PRINTI "."
	CRLF
	FSET PETE,TOUCHBIT
	RTRUE
?L1:	EQUAL? RARG,M-CONT \?L24
	EQUAL? PRSA,V?TAKE \FALSE
	FSET? PRSO,TAKEBIT \FALSE
	PRINTI "Pete pulls it back. ""That's mine!"""
	CRLF
	CALL PRINT-ID,STR?401
	RTRUE
?L24:	EQUAL? WINNER,PETE \?L26
	CALL META-LOC,PETE >?TMP
	CALL META-LOC,PLAYER >STACK
	EQUAL? ?TMP,STACK /?L26
	SET 'P-CONT,0
	CALL TELL-NOT-HERE-TALK
	RETURN 2
?L26:	FSET PETE,TOUCHBIT
	EQUAL? PRSA,V?FOLLOW \?L31
	EQUAL? PRSO,PETE /FALSE
?L31:	EQUAL? PRSA,V?HELLO \?L33
	SET 'QCONTEXT,PETE
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """Hi."""
?L33:	EQUAL? PRSA,V?GOODBYE \?L36
	SET 'QCONTEXT,PETE
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """Bye."""
?L36:	EQUAL? PRSA,V?SMELL \?L39
	PRINTR "Phew! Better stay upwind of him."
?L39:	EQUAL? PRSA,V?BUY \?L43
	EQUAL? PRSO,FERRY-TOKEN \?L43
	PRINTR "Pete checks his pockets, then holds out his empty hands."
?L43:	EQUAL? PRSA,V?$0024CALL \?L49
	EQUAL? WINNER,PLAYER /FALSE
?L49:	CALL GRAB-ATTENTION,PETE >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?GIVE \?L53
	EQUAL? PRSO,ENVELOPE /?L55
	EQUAL? PRSO,ID-CARD \?L53
?L55:	IN? ID-CARD,ENVELOPE /?L56
	CALL TELL-RETURNS,PETE
?L56:	CALL PERFORM,V?SHOW,PRSO,PETE
	RTRUE
?L53:	EQUAL? PRSA,V?SHOW \?L59
	EQUAL? PRSI,PETE \?L59
	IN? ID-CARD,ENVELOPE \?L60
	EQUAL? PRSO,ENVELOPE /?L62
	EQUAL? PRSO,ID-CARD \?L60
?L62:	PRINTI "Pete takes the "
	CALL DPRINT,ENVELOPE
	PRINTI ", studies it, then returns it. ""Looks like "
	CALL DPRINT,WEASEL
	PRINTR "'s card to me,"" he says."
?L60:	EQUAL? PRSO,ENVELOPE \?L65
	PRINTR """Looks like it's empty."""
?L65:	EQUAL? PRSO,ID-CARD \?L72
	PRINTI """Looks like "
	CALL DPRINT,WEASEL
	PRINTR "'s card. Better return it."""
?L59:	EQUAL? PRSA,V?ASK-ABOUT \?L72
	EQUAL? PRSO,PETE \?L72
	EQUAL? PRSI,GLOBAL-TREASURE \?L73
	IN? MCGINTY,HERE \?L75
	CALL MCGINTY-WILL-FOLLOW
?L75:	LESS? FM-CTR,3 \?L78
	PRINTR """I think that's what Johnny wants to talk about."""
?L78:	GETP HERE,P?LINE >STACK
	LESS? STACK,TRAWLER-LINE-C \?L82
	PRINTR """Looks like Johnny found some."""
?L82:	PRINTR """That's what we're lookin' for."""
?L73:	EQUAL? PRSI,SAMPLE-TREASURE \?L88
	IN? SAMPLE-TREASURE,JOHNNY \?L88
	IN? MCGINTY,HERE \?L89
	CALL MCGINTY-WILL-FOLLOW
?L89:	PRINTR """You saw it. You should know more about it than me."""
?L88:	EQUAL? PRSI,PETES-PATCH \?L94
	PRINTR """That's my eyepatch. It covers my bad eye."""
?L94:	EQUAL? PRSI,STOVE \?L97
	PRINTI """There's nothing special about the "
	CALL DPRINT,STOVE
	PRINTR "."""
?L97:	EQUAL? PRSI,SPEAR-CARRIER \?L100
	PRINTR """He's a good guy."""
?L100:	EQUAL? PRSI,JOHNNY \?L103
	PRINTR "Pete thinks for a second. ""Yeah, Red's a friend of mine."""
?L103:	EQUAL? PRSI,MCGINTY \?L106
	PRINTR """I done work for him, but I don't like him."""
?L106:	EQUAL? PRSI,HEVLIN \?L109
	CALL TELL-NEVER-KNEW
	RTRUE
?L109:	EQUAL? PRSI,WEASEL \?L110
	PRINTI "Pete frowns for a moment, then "
	IN? WEASEL,HERE \?L113
	PRINTI "leans over and whispers"
	JUMP ?L117
?L113:	PRINTI "says"
?L117:	PRINTR ", ""The Weasel's a friend, but I don't trust him. He's awful quick with that knife."""
?L110:	EQUAL? PRSI,PETE \?L122
	CALL TELL-KNOW-ME
	RTRUE
?L122:	EQUAL? PRSI,ME \?L123
	CALL TELL-YOURE-DIVER
	RTRUE
?L123:	EQUAL? PRSI,PARROT \?L124
	PRINTR """He's weird. He talks funny."""
?L124:	EQUAL? PRSI,FOOD \?L127
	GETP HERE,P?LINE >STACK
	GRTR? STACK,BACK-ALLEY-LINE-C \?L127
	PRINTR """It's a beef stew. There's nothing wrong with it."""
?L127:	EQUAL? PRSI,TRAWLER,SALVAGER \FALSE
	PRINTR """She's a boat."""
?L72:	EQUAL? WINNER,PETE \FALSE
	EQUAL? PRSO,GLOBAL-SELF \?L137
	SET 'PRSO,PETE
?L137:	EQUAL? PRSI,GLOBAL-SELF \?L140
	SET 'PRSI,PETE
?L140:	EQUAL? PRSA,V?TELL \?L143
	EQUAL? PRSO,ME /FALSE
?L143:	EQUAL? PRSA,V?$0024CALL \?L145
	CALL TELL-SO-WHAT >STACK
	RSTACK
?L145:	EQUAL? PRSA,V?SHOW \?L146
	IN? PRSO,PETE \?L146
	EQUAL? PRSI,ME \?L146
	SET 'WINNER,PLAYER
	CALL PERFORM,V?EXAMINE,PRSO
	SET 'WINNER,PETE
	RETURN WINNER
?L146:	EQUAL? PRSA,V?MAYBE,V?NO,V?YES /FALSE
	EQUAL? PRSA,V?WHAT,V?LONGITUDE,V?LATITUDE /FALSE
	EQUAL? PRSA,V?ALARM,V?SSHOW,V?FIND /FALSE
	PRINTI """I don't think I can do that."""
	CRLF
	RETURN 2

	.FUNCT I-PETE,GARG=0,L,PMG,?TMP
	LOC PETE >L
	ZERO? GARG \?L1
	GRTR? FM-CTR,1 \?L3
	LESS? FM-CTR,5 \?L3
	CALL QUEUE,I-PETE,1 >STACK
	PUT STACK,0,1
	RFALSE
?L3:	GET MOVEMENT-GOALS,PETE-C >PMG
	GET PMG,MG-ROOM >STACK
	EQUAL? STACK,MM-GALLEY \?L6
	EQUAL? SHIP-CHOSEN,TRAWLER \?L6
	PUT PMG,MG-ROOM,NW-GALLEY
?L6:	CALL IMOVEMENT,PETE,I-PETE >STACK
	RSTACK
?L1:	EQUAL? GARG,G-REACHED \FALSE
	EQUAL? L,MM-GALLEY,NW-GALLEY \?L10
	GETP L,P?LINE >?TMP
	CALL META-LOC,PLAYER >STACK
	GETP STACK,P?LINE >STACK
	EQUAL? ?TMP,STACK \?L10
	FSET FOOD,NDESCBIT
	MOVE FOOD,STOVE
?L10:	EQUAL? HERE,L \FALSE
	CALL DPRINT,PETE
	PRINTI " arrives, quickly taking in the situation."
	CRLF
	RETURN 2

	.FUNCT PETES-PATCH-F
	EQUAL? PRSA,V?DISEMBARK,V?ASK-FOR,V?LOOK-UNDER /?L4
	EQUAL? PRSA,V?MOVE /?L4
	EQUAL? PRSA,V?TAKE \?L1
	ZERO? PRSI /?L4
	EQUAL? PRSI,PETE \?L1
?L4:	PRINTI "Mind your manners."
	CRLF
	CALL PRINT-ID,STR?402 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a standard black eyepatch."

	.FUNCT WEASEL-F,RARG=0,?TMP
	EQUAL? RARG,M-OBJDESC \?L1
	IN? ENVELOPE,PLAYER \?L3
	CALL WEASEL-BEATS-YOU >STACK
	ZERO? STACK \TRUE
?L3:	ZERO? WEASEL-APPREHENDED /?L5
	EQUAL? HERE,MM-LOUNGE,NW-LOUNGE \?L6
	CALL TELL-TIED
	CRLF
	RTRUE
?L6:	PRINTR "The Weasel is firmly in Johnny's grasp."
?L5:	CALL QUEUED?,I-PENDULUM >STACK
	ZERO? STACK /?L11
	CALL INT,I-PENDULUM >STACK
	GET STACK,C-TICK >STACK
	EQUAL? STACK,-1 /TRUE
?L11:	EQUAL? HERE,UPSTAIRS-HALLWAY \?L12
	CALL QUEUED?,I-WEASEL-TO-BEDROOM >STACK
	ZERO? STACK /?L12
	CALL INT,I-WEASEL-TO-BEDROOM >STACK
	PUT STACK,0,0
	PRINTI "The Weasel sees you come up"
	CALL TELL-WEASEL-EXCUSE
	RTRUE
?L12:	GRTR? FM-CTR,1 \?L17
	LESS? FM-CTR,5 /?L16
?L17:	EQUAL? PRESENT-TIME,704 \?L15
	EQUAL? HERE,SHANTY \?L15
?L16:	PRINTR "The Weasel is sitting here, eyes darting."
?L15:	CALL IN-MOTION?,WEASEL >STACK
	ZERO? STACK \TRUE
	CALL TRAITOR-TIME? >STACK
	ZERO? STACK \TRUE
	FSET? WEASEL,TOUCHBIT \?L22
	LOC WEASEL >STACK
	EQUAL? STACK,MM-AFT-DECK,NW-AFT-DECK \?L23
	ZERO? AT-SEA /?L23
	ZERO? WEASEL-APPREHENDED \?L23
	CALL QUEUED?,I-PENDULUM >STACK
	ZERO? STACK \?L23
	CALL QUEUE,I-PENDULUM,-1 >STACK
	PUT STACK,0,1
	CALL TELL-WEASEL-TOSSES
	RTRUE
?L23:	PRINTR "The Weasel is picking his teeth with a nasty knife, looking around furtively."
?L22:	PRINTI "A short, wiry guy known only as """
	CALL DPRINT,WEASEL
	PRINTI """ is over in a corner, picking his teeth with a knife."
	CRLF
	FSET WEASEL,TOUCHBIT
	RTRUE
?L1:	EQUAL? RARG,M-CONT \?L36
	EQUAL? PRSA,V?TAKE \FALSE
	FSET? PRSO,TAKEBIT \FALSE
	PRINTI "The Weasel glares at you. ""I ain't gonna give that to ya!"""
	CRLF
	CALL PRINT-ID,STR?403
	RTRUE
?L36:	EQUAL? WINNER,WEASEL \?L44
	CALL META-LOC,WEASEL >?TMP
	CALL META-LOC,PLAYER >STACK
	EQUAL? ?TMP,STACK /?L40
	SET 'P-CONT,0
	CALL TELL-NOT-HERE-TALK
	RETURN 2
?L40:	CALL TRAITOR-TIME? >STACK
	ZERO? STACK /?L44
	CALL TELL-IN-MEETING
	RETURN 2
?L44:	FSET WEASEL,TOUCHBIT
	EQUAL? PRSA,V?FOLLOW \?L49
	EQUAL? PRSO,WEASEL /FALSE
?L49:	EQUAL? PRSA,V?$0024CALL \?L51
	CALL TRAITOR-TIME? >STACK
	ZERO? STACK /?L51
	CALL TELL-IN-MEETING
	RTRUE
?L51:	EQUAL? PRSA,V?UNTIE \?L52
	ZERO? WEASEL-APPREHENDED /?L52
	EQUAL? HERE,MM-LOUNGE,NW-LOUNGE \?L52
	CALL PRINT-ID,STR?404
	CALL JIGS-UP,STR?405
	JUMP ?L96
?L52:	EQUAL? PRSA,V?SEARCH \?L53
	ZERO? WEASEL-APPREHENDED /?L54
	IN? PASSBOOK,WEASEL \?L56
	MOVE PASSBOOK,PLAYER
	PRINTR "You take back your passbook."
?L56:	PRINTR "Despite his writhing, you search him fruitlessly."
?L54:	ZERO? WEASEL-PISSED /?L63
	CALL PRINT-ID,STR?406
	CALL JIGS-UP,STR?407
	RTRUE
?L63:	SET 'WEASEL-PISSED,1
	PRINTR "The Weasel shrinks back and says, ""Hey, don't you trust me? I don't gotta take this from you!"""
?L53:	ZERO? WEASEL-APPREHENDED /?L67
	EQUAL? PRSA,V?EXAMINE \?L68
	CALL TELL-TIED
	JUMP ?L73
?L68:	EQUAL? PRSA,V?TELL,V?ASK-ABOUT \?L70
	EQUAL? PRSI,WEASEL \?L70
	EQUAL? PRSO,WEASEL \FALSE
?L70:	IN? WEASEL,HERE \FALSE
	EQUAL? PRSA,V?FIND /FALSE
	PRINTI "The Weasel just glares at you."
?L73:	CRLF
	EQUAL? PRSA,V?ASK-ABOUT,V?TELL \?L76
	EQUAL? PRSO,WEASEL \?L76
	SET 'QCONTEXT,WEASEL
	SET 'QCONTEXT-ROOM,HERE
?L76:	RETURN 2
?L67:	EQUAL? PRSA,V?HELLO \?L81
	SET 'QCONTEXT,WEASEL
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """Yeah. Hi."""
?L81:	EQUAL? PRSA,V?GOODBYE \?L84
	SET 'QCONTEXT,WEASEL
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """Yeah. Bye."""
?L84:	EQUAL? PRSA,V?ASK-FOR \?L89
	EQUAL? PRSO,WEASEL /?L88
?L89:	EQUAL? PRSA,V?TAKE \?L87
	EQUAL? PRSI,WEASEL \?L87
?L88:	EQUAL? KNIFE,PRSI,PRSO /FALSE
	PRINTR """If I got it, I ain't gonna give it to ya."""
?L87:	EQUAL? PRSA,V?BUY \?L96
	EQUAL? PRSO,FERRY-TOKEN \?L96
	PRINTR """I might need it. Try the bank."""
?L96:	EQUAL? PRSA,V?$0024CALL \?L102
	EQUAL? WINNER,PLAYER /FALSE
?L102:	CALL GRAB-ATTENTION,WEASEL >STACK
	ZERO? STACK /TRUE
	EQUAL? PRSA,V?GIVE \?L106
	EQUAL? PRSO,ENVELOPE /?L108
	EQUAL? PRSO,ID-CARD \?L106
?L108:	CALL PERFORM,V?SHOW,PRSO,WEASEL
	RTRUE
?L106:	EQUAL? PRSA,V?SHOW \?L109
	EQUAL? PRSI,WEASEL \?L109
	IN? ID-CARD,ENVELOPE \?L110
	EQUAL? PRSO,ENVELOPE /?L112
	EQUAL? PRSO,ID-CARD \?L110
?L112:	MOVE ENVELOPE,WEASEL
	PRINTI "The Weasel takes the "
	CALL DPRINT,ENVELOPE
	PRINTR ". ""Thanks. I was wonderin' what happened to my card."""
?L110:	EQUAL? PRSO,ENVELOPE \?L115
	PRINTR "The Weasel shoves it back at you. ""I dunno nothin' about this. Could be old."""
?L115:	EQUAL? PRSO,ID-CARD \?L122
	MOVE ID-CARD,WEASEL
	PRINTR "The Weasel takes the card. ""Thanks. I'd be in trouble without this."""
?L109:	EQUAL? PRSA,V?ASK-ABOUT \?L122
	EQUAL? PRSO,WEASEL \?L122
	CALL TRAITOR-TIME? >STACK
	ZERO? STACK /?L123
	CALL TELL-IN-MEETING
	RETURN 2
?L123:	EQUAL? PRSI,GLOBAL-TREASURE \?L127
	IN? MCGINTY,HERE \?L128
	CALL MCGINTY-WILL-FOLLOW
	PRINTI "The Weasel glances at "
	CALL DPRINT,MCGINTY
	PRINTI " and says, ""What "
	CALL DPRINT,GLOBAL-TREASURE
	PRINTR "?"""
?L128:	LESS? FM-CTR,3 \?L132
	PRINTR """That could be what Johnny wants to talk about."""
?L132:	PRINTR """I guess that's what we're lookin' for."""
?L127:	EQUAL? PRSI,KNIFE \?L138
	PRINTR """Yeah. That's my knife."""
?L138:	EQUAL? PRSI,HEVLIN \?L141
	CALL TELL-NEVER-KNEW
	RTRUE
?L141:	EQUAL? PRSI,PETES-PATCH \?L142
	PRINTR """Pete's worn it as long as I've known him."""
?L142:	EQUAL? PRSI,TRAWLER,SALVAGER \?L145
	PRINTR """It's a decent boat."""
?L145:	EQUAL? PRSI,SPEAR-CARRIER \?L148
	PRINTR """I guess he's okay."""
?L148:	EQUAL? PRSI,JOHNNY \?L151
	PRINTR """Yeah. Red's okay."""
?L151:	EQUAL? PRSI,ME \?L154
	CALL TELL-YOURE-DIVER
	RTRUE
?L154:	EQUAL? PRSI,PETE \?L155
	PRINTR """Pete's a good guy. Just don't eat his chow."""
?L155:	EQUAL? PRSI,MCGINTY \?L158
	CALL WEASEL-SHUFFLE
	PRINTR """He's all right. I work with him now and then."""
?L158:	EQUAL? PRSI,WEASEL \?L161
	CALL TELL-KNOW-ME
	RTRUE
?L161:	EQUAL? PRSI,PARROT \?L162
	PRINTR """She is one strange bird."""
?L162:	EQUAL? PRSI,GLOBAL-FERRY,FERRY \?L165
	CALL WEASEL-SHUFFLE
	PRINTR """I use it to go home on the mainland."""
?L165:	EQUAL? PRSI,LINE-HACK \FALSE
	PRINT LINE-STR
	CRLF
	RTRUE
?L122:	EQUAL? WINNER,WEASEL \FALSE
	EQUAL? PRSO,GLOBAL-SELF \?L175
	SET 'PRSO,WEASEL
?L175:	EQUAL? PRSI,GLOBAL-SELF \?L178
	SET 'PRSI,WEASEL
?L178:	EQUAL? PRSA,V?TELL \?L181
	EQUAL? PRSO,ME /FALSE
?L181:	EQUAL? PRSA,V?$0024CALL \?L183
	CALL TELL-SO-WHAT >STACK
	RSTACK
?L183:	EQUAL? PRSA,V?SHOW \?L184
	IN? PRSO,WEASEL \?L184
	EQUAL? PRSO,PASSBOOK,ENVELOPE /?L184
	EQUAL? PRSI,ME \?L184
	SET 'WINNER,PLAYER
	CALL PERFORM,V?EXAMINE,PRSO
	SET 'WINNER,WEASEL
	RETURN WINNER
?L184:	EQUAL? FM-CTR,2 \?L185
	EQUAL? PRSA,V?SIT-ON,V?SIT \?L185
	PRINTR """Wait a second."""
?L185:	EQUAL? PRSA,V?MAYBE,V?NO,V?YES /FALSE
	EQUAL? PRSA,V?WHAT,V?LONGITUDE,V?LATITUDE /FALSE
	EQUAL? PRSA,V?ALARM,V?SSHOW,V?FIND /FALSE
	PRINTI """I don't wanna do that."""
	CRLF
	RETURN 2

	.FUNCT WEASEL-SHUFFLE
	GRTR? PRESENT-TIME,840 \FALSE
	IN? ENVELOPE,LOCAL-GLOBALS /FALSE
	PRINTI "The Weasel's eyes dart as he shuffles his feet. "
	RTRUE

	.FUNCT TELL-TIED
	PRINTI "The Weasel is tied up and squirming."
	RTRUE

	.FUNCT I-WEASEL,GARG=0,L,VAL=0,GT
	LOC WEASEL >L
	ZERO? GARG \?L1
	GRTR? FM-CTR,1 \?L3
	LESS? FM-CTR,5 \?L3
	CALL QUEUE,I-JOHNNY,1 >STACK
	PUT STACK,0,1
	RFALSE
?L3:	CALL IMOVEMENT,WEASEL,I-WEASEL >STACK
	RSTACK
?L1:	EQUAL? GARG,G-REACHED \?L6
	CALL META-LOC,PLAYER >STACK
	EQUAL? L,STACK \?L7
	IN? ENVELOPE,PLAYER \?L7
	CALL WEASEL-BEATS-YOU >STACK
	ZERO? STACK \TRUE
?L7:	EQUAL? L,BANK \?L9
	IN? PASSBOOK,WEASEL \?L9
	SET 'PASSBOOK-BALANCE,0
	SET 'STUPID-PROBLEM-STRING,STR?295
	JUMP ?L42
?L9:	EQUAL? L,UPSTAIRS-HALLWAY \?L10
	IN? PASSBOOK,UPSTAIRS-HALLWAY \?L11
	GRTR? PASSBOOK-BALANCE,99 \?L11
	IN? PLAYER,UPSTAIRS-HALLWAY /?L11
	MOVE PASSBOOK,WEASEL
	PUT MOVEMENT-GOALS,WEASEL-C,WEASEL-RETIRES-TABLE
	CALL IMOVEMENT,WEASEL,I-WEASEL
	JUMP ?L42
?L11:	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,BEDROOM \?L13
	FSET? BEDROOM-DOOR,OPENBIT \?L14
	MOVE WEASEL,BEDROOM
	GRTR? PRESENT-TIME,540 \?L16
	PRINTI "The Weasel comes in, and fear flashes across his face. ""Don't forget to meet Johnny later,"" he says."
	CRLF
	JUMP ?L20
?L16:	PRINTI "You hear something at the door and "
	EQUAL? PRSA,V?OPEN \?L25
	EQUAL? PRSO,BEDROOM-DOOR /?L23
?L25:	PRINTI "turn to "
?L23:	PRINTI "see "
	CALL DPRINT,WEASEL
	PRINTI " walk in. Fear flashes across his face, but only for an instant. He says, ""Oh, hi. I was just wonderin' if you was comin' to the meeting. Looks like we found the real thing this time."""
	CRLF
?L20:	CALL ESTABLISH-GOAL,WEASEL,SHANTY
	JUMP ?L31
?L14:	CALL QUEUE,I-WEASEL-TO-BEDROOM,2 >STACK
	PUT STACK,0,1
	PRINTI "You hear a knock at the door."
	CRLF
	SET 'P-IT-OBJECT,BEDROOM-DOOR
?L31:	SET 'VAL,M-FATAL
	JUMP ?L42
?L13:	EQUAL? HERE,UPSTAIRS-HALLWAY \?L34
	PRINTI "The Weasel gets to the top of the stairs, sees you,"
	CALL TELL-WEASEL-EXCUSE
	SET 'VAL,M-FATAL
	JUMP ?L42
?L34:	FSET? BEDROOM-DOOR,OPENBIT \?L38
	CALL WEASEL-ALONE-IN-BEDROOM
	JUMP ?L42
?L38:	CALL QUEUE,I-WEASEL-TO-BEDROOM,2 >STACK
	PUT STACK,0,1
	JUMP ?L42
?L10:	EQUAL? L,HERE \?L42
	PRINTI "The Weasel approaches, glancing around furtively."
	CRLF
	SET 'VAL,M-FATAL
?L42:	CALL WEASEL-CHECK,ENVELOPE,L
	CALL WEASEL-CHECK,ID-CARD,L
	RETURN VAL
?L6:	EQUAL? GARG,G-ENROUTE \FALSE
	EQUAL? HERE,UPSTAIRS-HALLWAY \?L48
	ZERO? BEDROOM-MESSAGE /?L48
	SET 'BEDROOM-DOOR-LOCKED,0
?L48:	IN? PASSBOOK,L \?L56
	GRTR? PASSBOOK-BALANCE,99 \?L56
	CALL META-LOC,PLAYER >STACK
	IN? WEASEL,STACK /?L56
	MOVE PASSBOOK,WEASEL
	GET GOAL-TABLES,WEASEL-C >GT
	GET GT,GOAL-F >STACK
	EQUAL? STACK,FERRY-LANDING \?L53
	CALL ESTABLISH-GOAL,WEASEL,BACK-ALLEY-5
?L53:	GETP L,P?LINE >STACK
	LESS? STACK,TRAWLER-LINE-C \?L56
	PUT MOVEMENT-GOALS,WEASEL-C,WEASEL-RETIRES-TABLE
	CALL IMOVEMENT,WEASEL,I-WEASEL
?L56:	IN? ENVELOPE,PLAYER \?L60
	CALL META-LOC,PLAYER >STACK
	EQUAL? L,STACK \?L60
	CALL WEASEL-BEATS-YOU >STACK
	ZERO? STACK \TRUE
?L60:	CALL WEASEL-CHECK,ENVELOPE,L
	CALL WEASEL-CHECK,ID-CARD,L >STACK
	RSTACK

	.FUNCT TELL-WEASEL-PICKUP,STR
	PRINTI "The Weasel picks up "
	PRINT STR
	PRINTR "."

	.FUNCT TELL-WEASEL-EXCUSE
	CALL ESTABLISH-GOAL,WEASEL,SHANTY
	PRINTI " and says, "
	GRTR? PRESENT-TIME,540 \?L3
	PRINTR """Umm, well, better not forget to meet with Johnny."""
?L3:	PRINTI """Oh. I was just checkin' to see if you're goin' to the meeting at "
	CALL DPRINT,SHANTY
	PRINTR "."" He looks slightly disappointed."

	.FUNCT WEASEL-CHECK,OBJ,L
	LOC OBJ >STACK
	EQUAL? STACK,ENVELOPE,UNDER-BUNK /?L4
	CALL META-LOC,OBJ >STACK
	EQUAL? STACK,L \?L4
	LOC OBJ >STACK
	FSET? STACK,PERSON \?L3
?L4:	CALL REALLY-HERE?,OBJ,L >STACK
	ZERO? STACK /FALSE
?L3:	MOVE OBJ,WEASEL
	CALL META-LOC,PLAYER >STACK
	EQUAL? L,STACK \FALSE
	EQUAL? L,ID-CARD \?L7
	CALL TELL-WEASEL-PICKUP,STR?408 >STACK
	RSTACK
?L7:	CALL TELL-WEASEL-PICKUP,STR?409 >STACK
	RSTACK

	.FUNCT REALLY-HERE?,OBJ,L,CTR=0
?L1:	GRTR? CTR,44 /FALSE
	GET SHARED-OBJECT-TABLE,CTR >STACK
	EQUAL? STACK,OBJ \?L5
	ADD CTR,1 >STACK
	GET SHARED-OBJECT-TABLE,STACK >STACK
	EQUAL? STACK,L \?L5
	ADD CTR,2 >STACK
	GET SHARED-OBJECT-TABLE,STACK >STACK
	EQUAL? STACK,UNDER-BUNK /?L5
	PUT SHARED-OBJECT-TABLE,CTR,0
	ADD CTR,1 >STACK
	PUT SHARED-OBJECT-TABLE,STACK,0
	ADD CTR,2 >STACK
	PUT SHARED-OBJECT-TABLE,STACK,0
	RTRUE
?L5:	ADD CTR,3 >CTR
	JUMP ?L1

	.FUNCT I-WEASEL-TO-BEDROOM
	ZERO? BEDROOM-DOOR-LOCKED /?L1
	CALL ESTABLISH-GOAL,WEASEL,SHANTY
	RFALSE
?L1:	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,BEDROOM \?L4
	MOVE WEASEL,BEDROOM
	PRINTI "The door opens and "
	CALL DPRINT,WEASEL
	PRINTI " walks in. He sees you and says, ""Oh. Hi. I just wanted to make sure you "
	GRTR? PRESENT-TIME,540 \?L8
	PRINTI "remembered to meet Johnny later."""
	JUMP ?L19
?L8:	PRINTI "knew about the meetin' at "
	CALL DPRINT,SHANTY
	PRINTI "."
	FSET? NOTE,TOUCHBIT \?L15
	PRINTI " You got Johnny's note, right?"""
	JUMP ?L19
?L15:	PRINTI """ He points to the note on the floor. ""You better read this note."""
?L19:	CRLF
	CALL ESTABLISH-GOAL,WEASEL,SHANTY >STACK
	RSTACK
?L4:	CALL WEASEL-ALONE-IN-BEDROOM
	RFALSE

	.FUNCT WEASEL-ALONE-IN-BEDROOM,WGT
	GET GOAL-TABLES,WEASEL-C >WGT
	MOVE WEASEL,BEDROOM
	PUT WGT,ATTENTION,5
	FSET BUREAU,OPENBIT
	CALL META-LOC,PASSBOOK >STACK
	EQUAL? STACK,BEDROOM \?L1
	GRTR? PASSBOOK-BALANCE,99 \?L1
	MOVE PASSBOOK,WEASEL
	PUT MOVEMENT-GOALS,WEASEL-C,WEASEL-RETIRES-TABLE
	CALL IMOVEMENT,WEASEL,I-WEASEL
	JUMP ?L3
?L1:	CALL ESTABLISH-GOAL,WEASEL,SHANTY
?L3:	PUT WGT,GOAL-ENABLE,0
	SET 'BEDROOM-MESSAGE,STR?410
	RETURN BEDROOM-MESSAGE

	.FUNCT WEASEL-BEATS-YOU
	ZERO? WEASEL-APPREHENDED \FALSE
	CALL TELL-COMES-UP,WEASEL
	CALL PRINT-ID,STR?411
	CALL JIGS-UP,STR?412 >STACK
	RSTACK

	.FUNCT KNIFE-F
	EQUAL? PRSA,V?TAKE /?L3
	EQUAL? PRSA,V?ASK-FOR \?L1
	EQUAL? PRSO,WEASEL \?L1
?L3:	IN? KNIFE,WEASEL \FALSE
	PRINTI "The Weasel pulls it away. ""Don't mess with my knife,"" he warns, ""or I'll give it to ya in a way ya won't much like."""
	CRLF
	CALL PRINT-ID,STR?413 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "This knife "
	IN? KNIFE,WEASEL \?L12
	PRINTI "is"
	JUMP ?L16
?L12:	PRINTI "was"
?L16:	PRINTI " "
	CALL DPRINT,WEASEL
	PRINTR "'s, and it's razor sharp."

	.FUNCT WATCH-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	PRINTI "Your trusty old wind-up diver's watch is waterproof to 350 fathoms. It currently shows "
	CALL WATCH-TIME
	PRINTI " a.m. (The AM/PM indicator never did work.)"
	ZERO? WATCH-WOUND \?L7
	PRINTI " The sweep hand isn't moving on it."
?L7:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LISTEN \?L12
	ZERO? WATCH-WOUND /?L13
	PRINTR "It's ticking."
?L13:	PRINTI "The "
	CALL DPRINT,WATCH
	PRINTR " makes no sound. And it's not battery-operated."
?L12:	EQUAL? PRSA,V?WIND \?L20
	EQUAL? PRSO,WATCH \?L20
	SET 'WATCH-WOUND,1
	CALL QUEUE,I-UNWOUND,1500 >STACK
	PUT STACK,0,1
	PRINTR "Okay. You've wound the watch."
?L20:	EQUAL? PRSA,V?SHAKE \?L23
	PRINTR "Shaken. It's not self-winding, but it is shock-proof."
?L23:	EQUAL? PRSA,V?TURN \FALSE
	ZERO? PRSI \?L27
	PRINTR "If you want to set the watch, specify the time to which you want it set."
?L27:	EQUAL? PRSI,INTNUM \FALSE
	GRTR? SET-HR,23 /?L34
	GRTR? SET-MIN,59 \?L32
?L34:	PRINTR "Try setting it to a more reasonable time."
?L32:	GRTR? SET-HR,11 \?L37
	SUB SET-HR,12 >SET-HR
?L37:	SET 'WATCH-SCORE,SET-HR
	SET 'WATCH-MOVES,SET-MIN
	SET 'SET-MIN,60
	CALL TELL-NOW,WATCH,STR?414,0
	CALL WATCH-TIME
	PRINTR "."

	.FUNCT WATCH-TIME,HR
	ZERO? WATCH-SCORE \?L1
	SET 'HR,12
	JUMP ?L3
?L1:	SET 'HR,WATCH-SCORE
?L3:	PRINTN HR
	PRINTI ":"
	LESS? WATCH-MOVES,10 \?L6
	PRINTI "0"
?L6:	PRINTN WATCH-MOVES
	RTRUE

	.FUNCT DELIVERY-BOY-F,RARG=0
	EQUAL? RARG,M-OBJDESC \?L1
	CALL IN-MOTION?,DELIVERY-BOY >STACK
	ZERO? STACK \TRUE
	PRINTI "The "
	CALL DPRINT,DELIVERY-BOY
	PRINTR " is here."
?L1:	EQUAL? PRSA,V?EXAMINE \?L8
	PRINTI "The "
	CALL DPRINT,DELIVERY-BOY
	PRINTI " is young. He's pushing a cart which is "
	ZERO? DELIVERY-MADE /?L11
	PRINTI "currently empty"
	JUMP ?L15
?L11:	PRINTI "loaded with stuff"
?L15:	PRINTR "."
?L8:	EQUAL? DELIVERY-BOY,WINNER /?L21
	EQUAL? PRSA,V?GOODBYE,V?HELLO /?L21
	EQUAL? PRSA,V?TELL \FALSE
	EQUAL? PRSO,DELIVERY-BOY \FALSE
?L21:	SET 'QCONTEXT,DELIVERY-BOY
	SET 'QCONTEXT-ROOM,HERE
	PRINTI """I can't stop now. I'm working!"""
	CRLF
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RTRUE

	.FUNCT I-DELIVERY-BOY,GARG=0,L,DMG,OBJ,DEST,?TMP
	LOC DELIVERY-BOY >L
	ZERO? GARG \?L1
	GET MOVEMENT-GOALS,DELIVERY-BOY-C >DMG
	LESS? PRESENT-TIME,485 /?L8
	ZERO? AMT-OWED \FALSE
	ZERO? JOHNNY-MADE-DEAL /FALSE
	GET DMG,MG-ROOM >STACK
	EQUAL? STACK,MM-LOCKER \?L8
	MOVE DELIVERY-BOY,OUTFITTERS-HQ
	EQUAL? SHIP-CHOSEN,TRAWLER \?L8
	PUT DMG,MG-ROOM,NW-LOCKER
?L8:	CALL IMOVEMENT,DELIVERY-BOY,I-DELIVERY-BOY >STACK
	RSTACK
?L1:	EQUAL? GARG,G-REACHED \?L12
	EQUAL? L,OUTFITTERS-HQ \?L13
	MOVE DELIVERY-BOY,LOCAL-GLOBALS
?L13:	EQUAL? L,MM-LOCKER,NW-LOCKER \?L16
?L18:	SUB DT-PTR,2 >DT-PTR
	LESS? DT-PTR,0 /?L19
	GET DELIVERY-TABLE,DT-PTR >OBJ
	MOVE OBJ,L
	EQUAL? OBJ,COMPRESSOR /?L23
	FSET OBJ,TAKEBIT
?L23:	FCLEAR OBJ,TRYTAKEBIT
	FCLEAR OBJ,NDESCBIT
	JUMP ?L18
?L19:	SET 'DELIVERY-MADE,1
	CALL ESTABLISH-GOAL,DELIVERY-BOY,OUTFITTERS-HQ
	EQUAL? L,HERE \FALSE
	PRINTI "The "
	CALL DPRINT,DELIVERY-BOY
	PRINTI " arrives with a cartful of stuff which he unloads."
	CRLF
	RETURN 2
?L16:	EQUAL? L,HERE \FALSE
	PRINTI "The "
	CALL DPRINT,DELIVERY-BOY
	PRINTI " walks in."
	CRLF
	RETURN 2
?L12:	EQUAL? GARG,G-ENROUTE \FALSE
	EQUAL? L,MM-GALLEY,NW-GALLEY \FALSE
	ZERO? WATER-DELIVERED \FALSE
	SET 'WATER-DELIVERED,1
	GET GOAL-TABLES,DELIVERY-BOY-C >STACK
	PUT STACK,ATTENTION,2
	GETP L,P?LINE >?TMP
	CALL META-LOC,WINNER >STACK
	GETP STACK,P?LINE >STACK
	EQUAL? ?TMP,STACK \?L42
	MOVE DRINKING-WATER,L
	FSET DRINKING-WATER,NDESCBIT
?L42:	IN? PLAYER,L \FALSE
	PRINTR "The delivery boy stops to drop off some stuff."

	.FUNCT SPEAR-CARRIER-F,CHANGE,COST
	EQUAL? PRSA,V?HELLO \?L1
	SET 'QCONTEXT,SPEAR-CARRIER
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """Hi there! What can I do for you?"""
?L1:	EQUAL? PRSA,V?GOODBYE \?L5
	SET 'QCONTEXT,SPEAR-CARRIER
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """So long. See you around."""
?L5:	EQUAL? PRSA,V?ALARM /FALSE
	EQUAL? PRSA,V?TIME /?L10
	EQUAL? PRSA,V?WHAT \?L9
	EQUAL? PRSO,GLOBAL-TIME \?L9
?L10:	CALL PERFORM,V?ASK-ABOUT,SPEAR-CARRIER,GLOBAL-TIME
	RTRUE
?L9:	EQUAL? WINNER,SPEAR-CARRIER \?L11
	EQUAL? PRSO,GLOBAL-SELF \?L12
	SET 'PRSO,SPEAR-CARRIER
?L12:	EQUAL? PRSI,GLOBAL-SELF \?L15
	SET 'PRSI,SPEAR-CARRIER
?L15:	EQUAL? PRSA,V?FIND \?L18
	EQUAL? PRSO,GLOBAL-BANK \?L18
	EQUAL? HERE,BANK \?L20
	PRINTR """This is the bank!"""
?L20:	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,SPEAR-CARRIER,GLOBAL-BANK
	SET 'WINNER,SPEAR-CARRIER
	RTRUE
?L18:	EQUAL? PRSA,V?$0024CALL \?L25
	CALL TELL-SO-WHAT
	RTRUE
?L25:	EQUAL? PRSA,V?WHAT,V?SSHOW,V?SGIVE /FALSE
	EQUAL? PRSA,V?NO,V?YES,V?FIND /FALSE
	EQUAL? PRSA,V?MAYBE /FALSE
	EQUAL? PRSA,V?ASK-FOR,V?ASK-ABOUT \?L28
	EQUAL? PRSI,GLOBAL-TIME /FALSE
?L28:	EQUAL? PRSA,V?GIVE \?L29
	EQUAL? PRSI,ME \?L29
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-FOR,SPEAR-CARRIER,PRSO
	SET 'WINNER,SPEAR-CARRIER
	RTRUE
?L29:	EQUAL? PRSA,V?TELL \?L30
	EQUAL? PRSO,ME \?L30
	ZERO? PRSI /FALSE
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,SPEAR-CARRIER,PRSI
	SET 'WINNER,SPEAR-CARRIER
	RTRUE
?L30:	EQUAL? PRSA,V?HELLO \?L34
	PRINTR """Hi there! What can I do for you?"""
?L34:	EQUAL? PRSA,V?GOODBYE \?L37
	PRINTR """So long. See you around."""
?L37:	EQUAL? PRSA,V?WITHDRAW \?L40
	EQUAL? HERE,BANK /FALSE
?L40:	EQUAL? PRSA,V?SHOW \?L41
	EQUAL? PRSI,ME \?L41
	PRINTI """Examine it "
	CALL DPRINT,GLOBAL-SELF
	PRINTR "."""
?L41:	PRINTR """I can't do that while I'm on the job."""
?L11:	EQUAL? PRSA,V?TELL \?L47
	ZERO? PRSI /FALSE
?L47:	EQUAL? PRSA,V?BUY \?L48
	EQUAL? PRSO,FERRY-TOKEN \?L48
	CALL NO-TOKENS,HERE
	RTRUE
?L48:	EQUAL? PRSA,V?SEARCH \?L49
	CALL TELL-YOU-CANT,STR?415,0
	IN? BAR,HERE \?L50
	CALL DPRINT,BAR
	JUMP ?L57
?L50:	IN? WINDOW,HERE \?L54
	CALL DPRINT,WINDOW
	JUMP ?L57
?L54:	CALL DPRINT,GLOBAL-SURFACE
?L57:	PRINTR "."
?L49:	EQUAL? PRSA,V?ASK-ABOUT \?L117
	EQUAL? PRSO,SPEAR-CARRIER \?L117
	SET 'QCONTEXT,SPEAR-CARRIER
	SET 'QCONTEXT-ROOM,HERE
	EQUAL? PRSI,SPEAR-CARRIER \?L63
	PRINTR """Just another of the people who keep this island running."""
?L63:	EQUAL? PRSI,ME \?L67
	CALL TELL-YOURE-DIVER
	RTRUE
?L67:	FSET? PRSI,PERSON \?L68
	PRINTI """You know "
	CALL DPRINT,PRSI
	PRINTR "."""
?L68:	EQUAL? PRSI,GLOBAL-BANK \?L71
	EQUAL? HERE,BANK \?L72
	PRINTI """It's the "
	CALL DPRINT,BANK
	PRINTR ", a savings bank which has served Hardscrabble Island for over forty years."""
?L72:	PRINTI """It's at the eastern end of the "
	CALL DPRINT,SHORE-ROAD-1
	PRINTR "."""
?L71:	EQUAL? PRSI,GLOBAL-MONEY \?L79
	PRINTR """That's what makes the world go around. Right?"""
?L79:	EQUAL? PRSI,RIDICULOUS-MONEY-KLUDGE \?L82
	PRINTR "He smiles. ""Money is our most important product."""
?L82:	EQUAL? PRSI,PARROT \?L85
	EQUAL? HERE,SHANTY \?L86
	PRINTR """Isn't it great? I bought it from a passing sailor some years back. I never did figure out why it has a wooden leg and an eyepatch."""
?L86:	PRINTI """The one in "
	CALL DPRINT,SHANTY
	PRINTR "? I can't imagine the island without it!"""
?L85:	EQUAL? HERE,RED-BOAR-INN \?L93
	EQUAL? PRSI,HEVLIN \?L117
	PRINTR """He came in here last night looking for you."""
?L93:	EQUAL? HERE,OUTFITTERS-HQ \?L117
	EQUAL? PRSI,DELIVERY-BOY \?L100
	PRINTI """"
	CALL IN-MOTION?,DELIVERY-BOY >STACK
	ZERO? STACK \?L104
	PRINTI "He's probably in the back room setting up the next delivery. "
?L104:	PRINTR "He's very conscientious, you know."""
?L100:	EQUAL? PRSI,PRICE-LIST \?L111
	PRINTR """It's up to date."""
?L111:	EQUAL? PRSI,SALVAGER,TRAWLER \?L114
	PRINTI """She's a great boat. You can read all about her in the "
	CALL DPRINT,PRICE-LIST
	PRINTR "."""
?L114:	GETP PRSI,P?NORTH >STACK
	ZERO? STACK /?L117
	IN? PRSI,ROOMS /?L117
	EQUAL? PRSI,DRINK-OBJECT,FOOD /?L117
	PRINTI """It's a great "
	CALL DPRINT,PRSI
	PRINTR "."""
?L117:	EQUAL? PRSA,V?WALK \?L123
	PRINTR "He indicates that he'd rather stay where he is."
?L123:	EQUAL? HERE,BANK \?L127
	EQUAL? PRSI,SPEAR-CARRIER \?L127
	EQUAL? PRSA,V?GIVE \?L128
	PRINTI "The teller examines the "
	EQUAL? PRSO,PASSBOOK \?L132
	PRINTI "passbook, says"
	CALL TELL-OUR-PASSBOOK
	PRINTR " If you want to withdraw some money, say so,"" and hands it back to you."
?L132:	CALL DPRINT,PRSO
	PRINTR ", thinks for a moment, and then hands it back to you, pointing out that you have no safe deposit box."
?L128:	EQUAL? PRSA,V?SHOW \FALSE
	EQUAL? PRSO,PASSBOOK \FALSE
	PRINTI "The teller says,"
	CALL TELL-OUR-PASSBOOK
	PRINTR """"
?L127:	EQUAL? HERE,RED-BOAR-INN \?L147
	EQUAL? PRSA,V?ASK-FOR \?L148
	EQUAL? PRSI,GLOBAL-ROOM \?L150
	PRINTR """We're full. Your current room will have to do."""
?L150:	EQUAL? PRSI,PSEUDO-OBJECT \FALSE
	PRINTR """Nope. No messages."""
?L148:	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSO,KEY \FALSE
	PRINTR "The desk clerk hands you back the key. ""You've paid for another week."""
?L147:	EQUAL? HERE,BANK \?L162
	EQUAL? PRSA,V?ASK-FOR \FALSE
	EQUAL? PRSI,INTNUM,RIDICULOUS-MONEY-KLUDGE \FALSE
	GRTR? PASSBOOK-BALANCE,0 \?L165
	PRINTR """If you want to make a withdrawal, be specific."""
?L165:	PRINTR """I'm afraid that the loan officer is out today."""
?L162:	EQUAL? HERE,OUTFITTERS-HQ \?L180
	EQUAL? PRSA,V?ASK-FOR \?L173
	EQUAL? PRSO,SPEAR-CARRIER \?L173
	GETP PRSO,P?NORTH >COST
	GRTR? COST,0 \?L174
	PRINTR """You want it, you buy it."""
?L174:	LESS? COST,0 \FALSE
	CALL TELL-YOU-ALREADY,STR?416,1
	RTRUE
?L173:	EQUAL? HERE,OUTFITTERS-HQ \?L180
	EQUAL? PRSI,SPEAR-CARRIER \?L180
	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSO,INTNUM \?L183
	ZERO? P-DOLLAR-FLAG /?L183
	FSET? WET-SUIT,WORNBIT /?L187
	FSET? DEEP-SUIT,WORNBIT \?L185
?L187:	CALL TELL-YOU-CANT,STR?87
	RTRUE
?L185:	GRTR? P-AMOUNT,POCKET-CHANGE \?L188
	PRINTR "You haven't got that much."
?L188:	ZERO? AMT-OWED /?L191
	LESS? P-AMOUNT,AMT-OWED \?L192
	SUB AMT-OWED,P-AMOUNT >AMT-OWED
	SUB POCKET-CHANGE,P-AMOUNT >POCKET-CHANGE
	PRINTI "The salesman takes the money and says, ""You still owe me $"
	PRINTN AMT-OWED
	PRINTR "."""
?L192:	GRTR? P-AMOUNT,AMT-OWED \?L197
	SUB P-AMOUNT,AMT-OWED >CHANGE
	PRINTI "The salesman takes the money, counts it, and hands you back $"
	PRINTN CHANGE
	PRINTI ". "
?L197:	SUB POCKET-CHANGE,AMT-OWED >POCKET-CHANGE
	SET 'AMT-OWED,0
	PRINTI """Thank you very much. Let me know what else you want."""
	CRLF
	CALL PRINT-ID,STR?417
	RTRUE
?L191:	PRINTR "The salesman hands it back to you. ""If you want to buy anything, please be specific."""
?L183:	EQUAL? PRSO,GLOBAL-MONEY \?L207
	SET 'P-AMOUNT,AMT-OWED
	SET 'P-DOLLAR-FLAG,1
	CALL PERFORM,V?GIVE,INTNUM,PRSI
	SET 'P-IT-OBJECT,GLOBAL-MONEY
	RTRUE
?L207:	PRINTI "The salesman looks at "
	CALL THE?,PRSO
	CALL DPRINT,PRSO
	PRINTR ", then returns it."
?L180:	EQUAL? SHANTY,HERE \FALSE
	EQUAL? PRSA,V?ASK-FOR \?L218
	EQUAL? PRSI,DRINKING-WATER /?L217
?L218:	EQUAL? PRSA,V?BUY \?L215
	EQUAL? PRSO,DRINKING-WATER \?L215
?L217:	IN? DRINKING-WATER,TABLE-OBJECT \?L219
	PRINTR """One glass to a customer."""
?L219:	MOVE DRINKING-WATER,TABLE-OBJECT
	FCLEAR DRINKING-WATER,NDESCBIT
	PUTP DRINKING-WATER,P?SDESC,STR?418
	PRINTR "The bartender puts a glass of water on the table."
?L215:	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR \FALSE
	EQUAL? PRSI,FOOD \?L227
	PRINTR """It's beef stew today. You can buy it for $5."""
?L227:	EQUAL? PRSI,DRINK-OBJECT \FALSE
	PRINTR """Grog is $2."""

	.FUNCT TELL-OUR-PASSBOOK
	PRINTI " ""Yes. That's one of our passbooks."
	RTRUE

	.FUNCT TELL-NOT-HERE-TALK
	CALL TELL-YOU-CANT,STR?419 >STACK
	RSTACK

	.FUNCT TELL-YOURE-DIVER
	PRINTR """You're a diver!"""

	.FUNCT TELL-KNOW-ME
	PRINTR """You know me."""

	.FUNCT HEVLIN-F,OWINNER
	EQUAL? PRSA,V?ASK-FOR,V?ASK-CONTEXT-ABOUT,V?ASK-ABOUT /FALSE
	EQUAL? PRSA,V?ASK-CONTEXT-FOR /FALSE
	EQUAL? PRSA,V?TELL \?L1
	EQUAL? PRSO,HEVLIN,ME \FALSE
?L1:	EQUAL? PRSA,V?WHAT \?L4
	SET 'OWINNER,WINNER
	SET 'WINNER,PLAYER
	CALL PERFORM,V?ASK-ABOUT,OWINNER,HEVLIN
	SET 'WINNER,OWINNER
	RTRUE
?L4:	EQUAL? PRSA,V?FIND \?L5
	EQUAL? WINNER,JOHNNY /?L8
	EQUAL? WINNER,SPEAR-CARRIER \?L6
	EQUAL? HERE,RED-BOAR-INN \?L6
?L8:	PRINTR """He was killed last night."""
?L6:	EQUAL? WINNER,PLAYER \?L11
	CALL TELL-HES-DEAD >STACK
	RSTACK
?L11:	CALL TELL-NEVER-KNEW >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?PRAY,V?HELP,V?FIND \?L13
	CALL TELL-HES-DEAD
	RETURN 2
?L13:	CALL GLOBAL-NOT-HERE-PRINT,HEVLIN >STACK
	RSTACK

	.FUNCT TELL-HES-DEAD
	PRINTR "Hevlin is dead."

	.FUNCT I-UNWOUND
	SET 'WATCH-WOUND,0
	RFALSE

	.FUNCT I-BUSINESS-HOURS
	ZERO? BUSINESS-HOURS? /?L1
	SET 'BUSINESS-HOURS?,0
	IN? PLAYER,MCGINTY-HQ \?L3
	MOVE PLAYER,WHARF-ROAD-2
	SET 'HERE,WHARF-ROAD-2
	PRINTI """Closing time,"" says "
	CALL DPRINT,MCGINTY
	PRINTI " as he escorts you out to the street..."
	CRLF
	CRLF
	CALL V-FIRST-LOOK
	RTRUE
?L3:	IN? PLAYER,OUTFITTERS-HQ \?L7
	MOVE PLAYER,WHARF-ROAD-4
	SET 'HERE,WHARF-ROAD-4
	PRINTI """Sorry, but it's closing time,"" the salesman says, then shows you out..."
	CRLF
	CRLF
	CALL V-FIRST-LOOK
	RTRUE
?L7:	IN? PLAYER,BANK \FALSE
	MOVE PLAYER,SHORE-ROAD-2
	SET 'HERE,SHORE-ROAD-2
	PRINTI "The teller says, ""You'll have to leave. It's 5:00."" A guard escorts you out..."
	CRLF
	CRLF
	CALL V-FIRST-LOOK
	RTRUE
?L1:	SET 'BUSINESS-HOURS?,1
	CALL QUEUE,I-BUSINESS-HOURS,480 >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT I-FERRY-APPROACHING
	CALL QUEUE,I-FERRY-APPROACHING,-1 >STACK
	PUT STACK,0,1
	FCLEAR FERRY,INVISIBLE
	IN? WEASEL,GLOBAL-FERRY \?L1
	MOVE WEASEL,FERRY
?L1:	EQUAL? HERE,FERRY-LANDING,SHORE-ROAD-1,SHORE-ROAD-2 \FALSE
	PRINTR "The ferry approaches the landing."

	.FUNCT I-FERRY,WEASEL-HERE?=0
	CALL INT,I-FERRY-APPROACHING >STACK
	PUT STACK,0,0
	CALL QUEUE,I-FERRY-LEAVING,5 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-FERRY-GONE,8 >STACK
	PUT STACK,0,1
	MOVE FERRY,FERRY-LANDING
	IN? WEASEL,FERRY-LANDING \?L1
	CALL QUEUED?,I-TRAITOR-MEETING >STACK
	ZERO? STACK \?L1
	SET 'WEASEL-HERE?,1
	MOVE WEASEL,FERRY
	JUMP ?L7
?L1:	IN? WEASEL,FERRY \?L7
	MOVE WEASEL,FERRY-LANDING
	IN? JOHNNY,FERRY-LANDING \?L4
	ZERO? WEASEL-BLOWN /?L4
	CALL ROUGH-JUSTICE
	JUMP ?L7
?L4:	EQUAL? SHIP-CHOSEN,TRAWLER \?L6
	CALL ESTABLISH-GOAL,WEASEL,NW-CREW-QTRS
	JUMP ?L7
?L6:	EQUAL? SHIP-CHOSEN,SALVAGER \?L7
	CALL ESTABLISH-GOAL,WEASEL,MM-CREW-QTRS
?L7:	EQUAL? HERE,FERRY-LANDING \?L10
	PRINTI "The ferry arrives. Some passengers get off and others get on."
	ZERO? WEASEL-HERE? /?L14
	CALL TELL-FERRY-KLUDGE,STR?420
	CRLF
	RTRUE
?L14:	IN? WEASEL,FERRY-LANDING \?L17
	CALL QUEUED?,I-TRAITOR-MEETING >STACK
	ZERO? STACK \?L17
	CALL TELL-FERRY-KLUDGE,STR?421
	IN? ENVELOPE,PLAYER \?L17
	CRLF
	CALL WEASEL-BEATS-YOU
?L17:	CRLF
	RTRUE
?L10:	EQUAL? HERE,SHORE-ROAD-1,SHORE-ROAD-2 \FALSE
	PRINTR "The ferry arrives at the landing."

	.FUNCT TELL-FERRY-KLUDGE,STR
	PRINTI " The Weasel "
	PRINT STR
	PRINTI "."
	RTRUE

	.FUNCT I-FERRY-LEAVING
	CALL QUEUE,I-FERRY-LEAVING,-1 >STACK
	PUT STACK,0,1
	MOVE FERRY,LOCAL-GLOBALS
	IN? WEASEL,FERRY \?L1
	IN? PASSBOOK,WEASEL \?L1
	MOVE WEASEL,LOCAL-GLOBALS
?L1:	EQUAL? HERE,FERRY-LANDING,SHORE-ROAD-1,SHORE-ROAD-2 \FALSE
	PRINTR "The ferry pulls away, heading for the mainland."

	.FUNCT I-FERRY-GONE
	CALL INT,I-FERRY-LEAVING >STACK
	PUT STACK,0,0
	CALL QUEUE,I-FERRY-APPROACHING,109 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-FERRY,112 >STACK
	PUT STACK,0,1
	FSET FERRY,INVISIBLE
	IN? WEASEL,FERRY \FALSE
	MOVE WEASEL,GLOBAL-FERRY
	RFALSE

	.FUNCT I-DISGUSTING-WEASEL-KLUDGE,WGT
	IN? PASSBOOK,WEASEL /FALSE
	GET GOAL-TABLES,WEASEL-C >WGT
	GET WGT,GOAL-F >STACK
	EQUAL? STACK,SHANTY /FALSE
	PUT WGT,ATTENTION,0
	CALL ESTABLISH-GOAL,WEASEL,SHANTY
	RFALSE

	.FUNCT I-FIRST-MEETING
	EQUAL? FM-CTR,5 \?L1
	CALL INT,I-FIRST-MEETING >STACK
	PUT STACK,0,0
	RFALSE
?L1:	IN? JOHNNY,SHANTY \FALSE
	IN? PETE,SHANTY \FALSE
	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,SHANTY \FALSE
	ZERO? FM-CTR \?L4
	GRTR? PRESENT-TIME,535 \?L6
	CALL I-PLOT-NEVER-STARTS
	CALL INT,I-FIRST-MEETING >STACK
	PUT STACK,0,0
	RFALSE
?L6:	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTI """Sit down and we'll talk,"" "
	CALL DPRINT,JOHNNY
	PRINTR " says."
?L4:	EQUAL? FM-CTR,1 \?L11
	IN? WEASEL,SHANTY \?L12
	SET 'FM-CTR,2
	CALL I-FIRST-MEETING >STACK
	RSTACK
?L12:	ZERO? WAITING-FOR-WEASEL /?L14
	GRTR? PRESENT-TIME,525 \FALSE
	CALL INT,I-FIRST-MEETING >STACK
	PUT STACK,0,0
	CALL I-PLOT-NEVER-STARTS
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTI "Pete looks at Johnny and says, ""Weasel ain't gonna show.""
""Guess not,"" replies Johnny. ""Without "
	CALL DPRINT,WEASEL
	PRINTR ", there's no deal. Who knows what that creep is up to?"""
?L14:	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTI "Johnny says, ""When "
	CALL DPRINT,WEASEL
	PRINTI " shows, I'll tell ya what we got."""
	CRLF
	SET 'WAITING-FOR-WEASEL,1
	RETURN WAITING-FOR-WEASEL
?L11:	GRTR? BLOOD-ALCOHOL,10 \?L23
	CALL INT,I-FIRST-MEETING >STACK
	PUT STACK,0,0
	CALL I-PLOT-NEVER-STARTS
	PRINTR "Pete turns to Johnny and says, ""This joker's drunk!""
""Yeah,"" Johnny says. He looks at you. ""Some diver! We'll find someone else."""
?L23:	EQUAL? FM-CTR,2 \?L26
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTI "At Pete's request, "
	CALL DPRINT,WEASEL
	PRINTI " joins you. Johnny then whispers that he's come across some sunken "
	CALL DPRINT,GLOBAL-TREASURE
	PRINTI "."
	CRLF
	SET 'FM-CTR,3
	SET 'I-WAIT-RTN,I-FIRST-MEETING
	SET 'I-WAIT-DURATION,2
	RETURN I-WAIT-DURATION
?L26:	EQUAL? FM-CTR,3 \?L29
	ZERO? I-WAIT-FLAG /?L30
	PRINTI "Unfortunately, this interrupts Johnny's explanation of what the meeting is about."
	CRLF
	SET 'I-WAIT-DURATION,2
	RETURN I-WAIT-DURATION
?L30:	GRTR? I-WAIT-DURATION,0 \?L34
	EQUAL? I-WAIT-RTN,I-FIRST-MEETING /FALSE
?L34:	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTI "Johnny explains that they need more money to get started. They chose you because they know you've salted some money away and you're a great diver. He asks if you're interested in the deal."
	CRLF
	SET 'FM-CTR,4
	RETURN FM-CTR
?L29:	EQUAL? FM-CTR,4 \FALSE
	GRTR? PRESENT-TIME,539 \?L39
	EQUAL? PRSA,V?NO,V?YES /?L39
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	CALL I-PLOT-NEVER-STARTS
	PRINTR "Pete turns to Johnny. ""We don't want anyone who can't decide.""
""Right,"" says Johnny. ""We'll find someone else."" He turns to you. ""Say a word about this and you're history!"""
?L39:	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTR """Well, what is it? Yes or no?"" Pete asks anxiously."

	.FUNCT SAMPLE-TREASURE-F
	EQUAL? PRSA,V?TAKE /?L3
	EQUAL? PRSA,V?ASK-FOR \?L1
	EQUAL? PRSO,JOHNNY \?L1
?L3:	IN? MCGINTY,HERE \?L4
	CALL PERFORM,V?TELL,MCGINTY,SAMPLE-TREASURE
	RTRUE
?L4:	PRINTR "Red pulls it back. ""If we get the loot, there'll be plenty for all."""
?L1:	EQUAL? PRSA,V?TURN \FALSE
	CALL DPRINT,JOHNNY
	PRINTR " has it."

	.FUNCT I-SECOND-MEETING
	GRTR? PRESENT-TIME,585 \?L1
	LESS? SM-CTR,2 /?L3
	GRTR? HOW-HUNGRY,3 \?L1
?L3:	CALL ALL-GO-HOME
	CALL I-PLOT-NEVER-STARTS
	SET 'SM-CTR,4
?L1:	EQUAL? SM-CTR,4 \?L5
	CALL INT,I-SECOND-MEETING >STACK
	PUT STACK,0,0
	RTRUE
?L5:	EQUAL? HERE,WINDING-ROAD-1 /?L7
	CALL INT,I-SECOND-MEETING >STACK
	PUT STACK,0,0
	RTRUE
?L7:	GRTR? SM-CTR,1 \?L8
	IN? MCGINTY,WINDING-ROAD-1 /?L9
	IN? MCGINTY,WINDING-ROAD-2 \?L8
?L9:	CALL PRINT-ID,STR?422
	CALL JIGS-UP,STR?423 >STACK
	RSTACK
?L8:	LESS? SM-CTR,2 \?L10
	IN? WEASEL,WINDING-ROAD-1 \?L11
	IN? JOHNNY,WINDING-ROAD-1 \?L11
	IN? PETE,WINDING-ROAD-1 \?L11
	SET 'SM-CTR,2
	CALL I-SECOND-MEETING
	RTRUE
?L11:	ZERO? SM-CTR \FALSE
	IN? JOHNNY,WINDING-ROAD-1 \FALSE
	SET 'SM-CTR,1
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTR "Johnny says, ""We'll start when everyone's here."""
?L10:	GRTR? BLOOD-ALCOHOL,10 \?L20
	SET 'SM-CTR,4
	CALL INT,I-SECOND-MEETING >STACK
	PUT STACK,0,0
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	CALL ALL-GO-HOME
	CALL I-PLOT-NEVER-STARTS
	PRINTI """I won't risk everything on a drunk diver!"" "
	CALL DPRINT,WEASEL
	PRINTI " says.
""You're right,"" says Johnny. ""We're calling this off."""
	CRLF
	CALL PRINT-ID,STR?424 >STACK
	RSTACK
?L20:	EQUAL? SM-CTR,2 \?L23
	RANDOM 2 >WRECK-FOUND
	EQUAL? WRECK-FOUND,1 \?L24
	SET 'SAMPLE-TREASURE,GOLD-COIN
	JUMP ?L26
?L24:	SET 'SAMPLE-TREASURE,DINNER-PLATE
?L26:	PUTP SAMPLE-TREASURE,P?ACTION,SAMPLE-TREASURE-F
	MOVE SAMPLE-TREASURE,JOHNNY
	SET 'P-IT-OBJECT,SAMPLE-TREASURE
	SET 'SM-CTR,3
	SET 'I-WAIT-DURATION,6
	SET 'I-WAIT-RTN,I-SECOND-MEETING
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTI "Johnny nods, then pulls out "
	CALL APRINT,SAMPLE-TREASURE
	PRINTR " he says he came across while on a shark hunt."
?L23:	EQUAL? SM-CTR,3 \FALSE
	ZERO? I-WAIT-FLAG /?L30
	PRINTI "This interrupts Johnny's explanation, which makes him angry."
	CRLF
	SET 'I-WAIT-DURATION,6
	RETURN I-WAIT-DURATION
?L30:	GRTR? I-WAIT-DURATION,0 \?L34
	EQUAL? I-WAIT-RTN,I-SECOND-MEETING /FALSE
?L34:	CALL INT,I-SECOND-MEETING >STACK
	PUT STACK,0,0
	SUB 705,PRESENT-TIME >STACK
	CALL QUEUE,I-OTHERS-MEET,STACK >STACK
	PUT STACK,0,1
	SET 'SM-CTR,4
	SET 'MEETINGS-COMPLETED,2
	PUT MOVEMENT-GOALS,JOHNNY-C,JOHNNY-CONTINUES-TABLE
	CALL IMOVEMENT,JOHNNY,I-JOHNNY
	CALL RATING-UPD,20
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	CRLF
	PRINTI """We're not sure which wreck to salvage,"" Johnny says. ""Since you're joining up, we're hoping you'll identify where the "
	CALL DPRINT,SAMPLE-TREASURE
	PRINTI " came from, and then do the dive for us. I'll captain, Pete will cook, and "
	CALL DPRINT,WEASEL
	PRINTI " will crew.

Johnny winks at you. ""We'll need you to supply the minutes of longitude and latitude of the wreck. Get $500 and meet me at Point Lookout at 10:45. Then we'll provision the boat.""

He turns to the others. ""We'll meet in "
	CALL DPRINT,SHANTY
	PRINTR " at 11:45 to discuss final arrangements.

""We're all in this now,"" Johnny says to the group. ""I'm not gonna chance this operation if one of you doesn't show. We need everyone to pull this off. If anyone tries anything stupid, you won't live to regret it."""

	.FUNCT I-THIRD-MEETING,JMG
	EQUAL? HERE,POINT-LOOKOUT /?L1
	CALL INT,I-THIRD-MEETING >STACK
	PUT STACK,0,0
	RFALSE
?L1:	IN? JOHNNY,POINT-LOOKOUT \FALSE
	LESS? TM-CTR,6 \?L7
	INC 'TM-CTR
?L7:	IN? MCGINTY,POINT-LOOKOUT \?L8
	CALL PRINT-ID,STR?425
	CALL JIGS-UP,STR?426 >STACK
	RSTACK
?L8:	IN? MCGINTY,OCEAN-ROAD-3 \?L10
	CALL IN-MOTION?,MCGINTY >STACK
	ZERO? STACK \?L10
	CALL PRINT-ID,STR?427
	CALL JIGS-UP,STR?428 >STACK
	RSTACK
?L10:	EQUAL? TM-CTR,1 \?L11
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTR "Johnny turns toward you. ""Well? Did you bring the money?"""
?L11:	GRTR? BLOOD-ALCOHOL,10 \?L14
	CALL PRINT-ID,STR?429
	CALL JIGS-UP,STR?430 >STACK
	RSTACK
?L14:	EQUAL? TM-CTR,4 \?L15
	PRINTR "Johnny glares at you as if you were a sea slug."
?L15:	EQUAL? TM-CTR,5 \?L18
	CALL PRINT-ID,STR?431
	CALL JIGS-UP,STR?432 >STACK
	RSTACK
?L18:	EQUAL? TM-CTR,6 \?L19
	SET 'TM-CTR,7
	CALL RATING-UPD,20
	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	CRLF
	PRINTI """Glad you're with us. Since you're okay, I'll level with you. Before Hevlin died, he told me he gave you the book. He also said you could handle this job. He's the one who gave me the "
	CALL DPRINT,SAMPLE-TREASURE
	PRINTI ". I didn't want to say anything in front of Pete and "
	CALL DPRINT,WEASEL
	PRINTI " just in case.

""We're gonna need a boat, but I don't know which one. If you need deep-sea diving gear, it'll have to be the "
	CALL DPRINT,SALVAGER
	PRINTI ". Is the "
	CALL DPRINT,GLOBAL-TREASURE
	PRINTR " more than 200 feet deep?"""
?L19:	EQUAL? TM-CTR,7 \?L22
	GRTR? PRESENT-TIME,675 \?L23
	CALL PRINT-ID,STR?433
	CALL JIGS-UP,STR?434
?L23:	SET 'QCONTEXT,JOHNNY
	SET 'QCONTEXT-ROOM,HERE
	PRINTR "Johnny looks impatient. ""Don't confuse things. A yes or no will do."""
?L22:	EQUAL? TM-CTR,8 \FALSE
	CALL ESTABLISH-GOAL,JOHNNY,OUTFITTERS-HQ
	PUT MOVEMENT-GOALS,JOHNNY-C,JOHNNY-COMPLETES-TABLE
	GET MOVEMENT-GOALS,JOHNNY-C >JMG
	SUB 838,PRESENT-TIME >STACK
	PUT JMG,MG-TIME,STACK
	CALL IMOVEMENT,JOHNNY,I-JOHNNY
	CALL INT,I-THIRD-MEETING >STACK
	PUT STACK,0,0
	SET 'MEETINGS-COMPLETED,3
	PRINTI """We'll rent the "
	CALL DPRINT,SHIP-CHOSEN
	PRINTR ". Let's go get what we need."""

	.FUNCT I-EQUIP,MCG-GT,V=0
	IN? PLAYER,OUTFITTERS-HQ \?L1
	IN? MCGINTY,OUTFITTERS-HQ \?L3
	INC 'WARNING-CTR
	EQUAL? WARNING-CTR,7 \?L5
	PRINTI "Johnny leans over and whispers, ""Let's wait out McGinty. He should leave soon."""
	CRLF
	SET 'V,1
?L5:	GRTR? I-WAIT-DURATION,0 \?L10
	SET 'I-WAIT-DURATION,0
	SET 'I-WAIT-RTN,0
	PRINTI "Johnny ends his conversation, and "
	CALL DPRINT,MCGINTY
	PRINTR " asks the salesman some questions."
?L10:	GET GOAL-TABLES,MCGINTY-C >MCG-GT
	GET MCG-GT,GOAL-ENABLE >STACK
	ZERO? STACK /?L14
	GET MCG-GT,GOAL-F >STACK
	EQUAL? STACK,MCGINTY-HQ \?L14
	ZERO? MCGINTY-KNOWS \?L15
	SET 'MCGINTY-MEETS-WEASEL,1
?L15:	SET 'I-WAIT-DURATION,9
	SET 'I-WAIT-RTN,I-EQUIP
	RFALSE
?L14:	EQUAL? PRSA,V?RENT,V?BUY \?L18
	EQUAL? PRSO,FERRY-TOKEN /?L18
	SET 'MCGINTY-KNOWS,1
	CALL INT,I-MCGINTY-FOLLOWS >STACK
	PUT STACK,0,0
	CALL INT,I-EQUIP >STACK
	PUT STACK,0,0
	MOVE MCGINTY,WHARF-ROAD-4
	CALL ESTABLISH-GOAL,MCGINTY,MCGINTY-HQ
	CALL DPRINT,MCGINTY
	PRINTI " grins as he realizes what you're up to."
	CALL SAY-MCGINTY-KNOWS >STACK
	RSTACK
?L18:	GRTR? PRESENT-TIME,699 \?L21
	IN? JOHNNY,OUTFITTERS-HQ \?L22
	CALL ESTABLISH-GOAL,JOHNNY,SHANTY
	PRINTI "Johnny glares at "
	CALL DPRINT,MCGINTY
	PRINTR " and then at his watch. ""There's no way."" He turns to you. ""Forget it. We can't get this done in time."""
?L22:	CALL INT,I-MCGINTY-FOLLOWS >STACK
	PUT STACK,0,0
	CALL ESTABLISH-GOAL,MCGINTY,MCGINTY-HQ
	CALL INT,I-EQUIP >STACK
	PUT STACK,0,0
	CALL DPRINT,MCGINTY
	PRINTR " turns to the salesman. ""I think... yeah! I will need that boat after all."" He turns to you and grins."
?L21:	EQUAL? PRSA,V?WAIT-FOR,V?WAIT,V?WALK /?L29
	EQUAL? PRSA,V?LOOK /?L29
	PRINTI "Johnny glances nervously at "
	CALL DPRINT,MCGINTY
	PRINTR "."
?L29:	RETURN V
?L3:	ZERO? MCGINTY-KNOWS /?L33
	CALL INT,I-EQUIP >STACK
	PUT STACK,0,0
	RFALSE
?L33:	ZERO? I-WAIT-FLAG /?L34
	PRINTI "Johnny seems unhappy to have his conversation interrupted."
	CRLF
	SET 'I-WAIT-DURATION,9
	RETURN I-WAIT-DURATION
?L34:	EQUAL? I-WAIT-RTN,I-EQUIP \?L37
	GRTR? I-WAIT-DURATION,0 /FALSE
	CALL ESTABLISH-GOAL,JOHNNY,SHANTY
	SUB 870,PRESENT-TIME >STACK
	CALL QUEUE,I-SHOVE-OFF,STACK >STACK
	PUT STACK,0,1
	CALL INT,I-EQUIP >STACK
	PUT STACK,0,0
	EQUAL? SHIP-CHOSEN,TRAWLER \?L41
	RANDOM 50 >STACK
	ADD 50,STACK >AMT-OWED
	JUMP ?L43
?L41:	RANDOM 50 >STACK
	ADD 400,STACK >AMT-OWED
?L43:	SET 'JOHNNY-MADE-DEAL,1
	CALL RATING-UPD,20
	PRINTI "Johnny hands him a list and the salesman quotes a price. Johnny gives him the money he has, then says to you, ""You'll need to chip in $"
	PRINTN AMT-OWED
	PRINTI " plus the money for your stuff. We'll leave on the "
	CALL DPRINT,SHIP-CHOSEN
	PRINTI " at high tide.""

He tells the "
	CALL DPRINT,SPEAR-CARRIER
	PRINTR ", ""Deliver the stuff half an hour before high tide."" He turns back to you. ""Better be on board then to watch the stuff."""
?L37:	IN? MCGINTY,WHARF-ROAD-4 /FALSE
	SET 'I-WAIT-DURATION,9
	SET 'I-WAIT-RTN,I-EQUIP
	RFALSE
?L1:	SET 'I-WAIT-DURATION,0
	CALL INT,I-EQUIP >STACK
	GET STACK,C-TICK >STACK
	LESS? STACK,-15 \FALSE
	CALL INT,I-EQUIP >STACK
	PUT STACK,0,0
	IN? JOHNNY,OUTFITTERS-HQ \?L51
	CALL ESTABLISH-GOAL,JOHNNY,SHANTY
?L51:	CALL I-PLOT-NEVER-STARTS
	RFALSE

	.FUNCT TELL-NEED-BOAT
	PRINTR " ""We will need that boat after all,"" he says to the salesman as he leaves."

	.FUNCT SAY-MCGINTY-KNOWS
	CALL TELL-NEED-BOAT
	MOVE JOHNNY,WHARF-ROAD-3
	CALL ZERO-ATTENTION,JOHNNY
	CALL ESTABLISH-GOAL,JOHNNY,SHANTY
	CRLF
	PRINTR "Johnny glares at you. ""That was stupid! Now he's stopped us from renting the boat we need."" He storms out. You can't help feeling fortunate that someone else happened to be here."

	.FUNCT I-OTHERS-MEET,V=1
	GRTR? PRESENT-TIME,720 \?L1
	CALL INT,I-OTHERS-MEET >STACK
	PUT STACK,0,0
	CALL I-PLOT-NEVER-STARTS
	IN? PLAYER,CHAIR \?L3
	PRINTI "Johnny tells Pete the deal's off."
	CRLF
	RETURN V
?L3:	IN? PLAYER,SHANTY \?L7
	PRINTI "Johnny says something to Pete."
	CRLF
	RETURN V
?L7:	SET 'V,0
	RETURN V
?L1:	IN? JOHNNY,SHANTY \?L12
	IN? PETE,SHANTY \?L12
	IN? WEASEL,SHANTY /?L11
?L12:	CALL QUEUE,I-OTHERS-MEET,1 >STACK
	PUT STACK,0,1
	RFALSE
?L11:	ZERO? JOHNNY-MADE-DEAL \?L13
	CALL I-PLOT-NEVER-STARTS
?L13:	IN? PLAYER,CHAIR \?L15
	PRINTI "Johnny tells Pete and "
	CALL DPRINT,WEASEL
	PRINTI " the deal's "
	ZERO? JOHNNY-MADE-DEAL /?L19
	PRINTI "on and to be at the "
	CALL DPRINT,SHIP-CHOSEN
	PRINTI " at 2:30"
	JUMP ?L23
?L19:	PRINTI "off"
?L23:	PRINTR "."
?L15:	IN? PLAYER,SHANTY \FALSE
	PRINTI "Johnny, Pete, and "
	CALL DPRINT,WEASEL
	PRINTR " are talking at a corner table."

	.FUNCT I-TRAITOR-MEETING,FERRY-HERE=0
	IN? WEASEL,FERRY /?L3
	ZERO? MCGINTY-KNOWS \?L3
	IN? MCGINTY,FERRY-LANDING /?L1
?L3:	CALL INT,I-TRAITOR-MEETING >STACK
	PUT STACK,0,0
	RFALSE
?L1:	IN? WEASEL,FERRY-LANDING \FALSE
	IN? ID-CARD,WEASEL \?L5
	IN? PASSBOOK,WEASEL \?L6
	IN? FERRY,FERRY-LANDING \?L8
	MOVE WEASEL,FERRY
	SET 'FERRY-HERE,1
?L8:	CALL INT,I-TRAITOR-MEETING >STACK
	PUT STACK,0,0
	IN? PLAYER,FERRY-LANDING \FALSE
	CALL TELL-CORNER,FERRY-HERE,STR?435 >STACK
	RSTACK
?L6:	MOVE ID-CARD,MCGINTY
	IN? FERRY,FERRY-LANDING \?L15
	MOVE WEASEL,FERRY
	SET 'FERRY-HERE,1
?L15:	CALL INT,I-TRAITOR-MEETING >STACK
	PUT STACK,0,0
	IN? PLAYER,FERRY-LANDING \FALSE
	CALL TELL-CORNER,FERRY-HERE,STR?436 >STACK
	RSTACK
?L5:	MOVE ID-CARD,WEASEL
	SET 'MCGINTY-MEETS-WEASEL,0
	IN? PLAYER,FERRY-LANDING \FALSE
	CALL DPRINT,MCGINTY
	PRINTI " takes "
	CALL DPRINT,WEASEL
	PRINTR " to a corner of the landing, where they talk."

	.FUNCT TELL-CORNER,FERRY-HERE,STR
	CALL DPRINT,MCGINTY
	PRINTI " and "
	CALL DPRINT,WEASEL
	PRINTI " are talking in a corner. The Weasel "
	PRINT STR
	PRINTI " and "
	ZERO? FERRY-HERE /?L3
	PRINTI "then boards the ferry"
	JUMP ?L7
?L3:	PRINTI "they separate"
?L7:	PRINTR "."

	.FUNCT I-SHOVE-OFF,L,?TMP
	CALL ENABLED?,I-JOHNNY >STACK
	ZERO? STACK /FALSE
	CALL META-LOC,PLAYER >STACK
	GETP STACK,P?LINE >?TMP
	GETP SHIP-CHOSEN,P?LINE >STACK
	EQUAL? ?TMP,STACK \?L3
	GRTR? PRESENT-TIME,930 \?L4
	ZERO? LATITUDE-SET \?L4
	ZERO? LONGITUDE-SET \?L4
	CALL ALL-GO-HOME
	RFALSE
?L4:	CALL META-LOC,PLAYER >STACK
	IN? JOHNNY,STACK \?L6
	CALL DPRINT,JOHNNY
	PRINTI " turns to"
	JUMP ?L9
?L6:	LOC JOHNNY >L
	CALL META-LOC,PLAYER >STACK
	MOVE JOHNNY,STACK
	CALL ESTABLISH-GOAL,JOHNNY,L
	CALL DPRINT,JOHNNY
	PRINTI " walks up behind"
?L9:	PRINTI " you and says, """
	ZERO? DELIVERY-MADE \?L14
	PRINTI "We're gonna have to forget it. Outfitters never delivered the stuff."
	CRLF
	CALL ALL-GO-HOME
	RTRUE
?L14:	EQUAL? 0,LATITUDE-SET,LONGITUDE-SET \?L18
	PRINTI "If we're gonna go, you have to tell me the minutes of "
	ZERO? LATITUDE-SET \?L25
	PRINTI "latitude"
	ZERO? LONGITUDE-SET \?L31
	PRINTI " and "
?L25:	ZERO? LONGITUDE-SET \?L31
	PRINTI "longitude"
?L31:	PRINTI "."""
	CRLF
	CALL GRAB-ATTENTION,JOHNNY
	RANDOM 10 >STACK
	ADD 30,STACK >STACK
	CALL QUEUE,I-SHOVE-OFF,STACK >STACK
	PUT STACK,0,1
	RTRUE
?L18:	PRINTI "We'll be leaving shortly. Get some sleep."""
	CRLF
	EQUAL? SHIP-CHOSEN,SALVAGER \?L41
	CALL ESTABLISH-GOAL,JOHNNY,MM-WHEELHOUSE
	JUMP ?L43
?L41:	CALL ESTABLISH-GOAL,JOHNNY,NW-WHEELHOUSE
?L43:	LOC WEASEL >STACK
	EQUAL? STACK,FERRY,GLOBAL-FERRY,LOCAL-GLOBALS /?L44
	LOC DECK-CHAIR >STACK
	CALL ESTABLISH-GOAL,WEASEL,STACK
?L44:	ZERO? AMT-OWED \FALSE
	CALL QUEUE,I-BOAT-TRIP,10 >STACK
	PUT STACK,0,1
	RFALSE
?L3:	GRTR? PRESENT-TIME,900 \?L50
	CALL ALL-GO-HOME
	RFALSE
?L50:	RANDOM 10 >STACK
	ADD 30,STACK >STACK
	CALL QUEUE,I-SHOVE-OFF,STACK >STACK
	PUT STACK,0,1
	RFALSE

	.FUNCT ALL-GO-HOME
	CALL ESTABLISH-GOAL,PETE,SHANTY
	IN? WEASEL,FERRY /?L1
	IN? WEASEL,GLOBAL-FERRY /?L1
	IN? WEASEL,LOCAL-GLOBALS /?L1
	CALL ESTABLISH-GOAL,WEASEL,SHANTY
?L1:	SET 'JOHNNY-SILENT,1
	CALL ESTABLISH-GOAL,JOHNNY,SHANTY >STACK
	RSTACK

	.FUNCT I-BOAT-TRIP,BOAT,OT,EXCESS,?TMP
	ZERO? ASLEEP \FALSE
	CALL META-LOC,PLAYER >STACK
	GETP STACK,P?LINE >?TMP
	GETP SHIP-CHOSEN,P?LINE >BOAT
	EQUAL? ?TMP,BOAT \FALSE
	LOC WEASEL >STACK
	GETP STACK,P?LINE >STACK
	EQUAL? STACK,BOAT /?L4
	CALL TELL-COMES-UP,JOHNNY
	PRINTI """The Weasel's not on board. The deal's off."""
	CRLF
	CALL FINISH
	JUMP ?L9
?L4:	LOC MCGINTY >STACK
	GETP STACK,P?LINE >STACK
	EQUAL? STACK,BOAT \?L8
	CALL TELL-COMES-UP,WEASEL
	CALL PRINT-ID,STR?437
	CALL JIGS-UP,STR?438
	JUMP ?L9
?L8:	IN? ENVELOPE,JOHNNY \?L9
	LOC WEASEL >STACK
	MOVE JOHNNY,STACK
	CALL ROUGH-JUSTICE
?L9:	CALL INT,I-MCGINTY-FOLLOWS >STACK
	PUT STACK,0,0
	SET 'SOUPS-ON,1
	CALL RATING-UPD,20
	EQUAL? LATITUDE-SET,20 \?L11
	EQUAL? LONGITUDE-SET,25 \?L11
	CALL TELL-COMES-UP,JOHNNY
	CALL PRINT-ID,STR?439
	CALL JIGS-UP,STR?440
?L11:	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,MM-GALLEY,NW-GALLEY \?L14
	PRINTI "Pete announces that the stew is ready."
	CRLF
?L14:	EQUAL? SHIP-CHOSEN,TRAWLER \?L19
	SET 'TRAWLER-DOCKED,0
	JUMP ?L21
?L19:	SET 'SALVAGER-DOCKED,0
?L21:	SET 'AT-SEA,1
	IN? PLAYER,DECK-CHAIR \?L22
	LOC DECK-CHAIR >STACK
	MOVE PLAYER,STACK
?L22:	LOC PLAYER >STACK
	CALL GLOBAL-IN?,RAILING,STACK >STACK
	ZERO? STACK /?L25
	PRINTI "As the engines roar to life, you go to the "
	CALL DPRINT,RAILING
	PRINTI " to watch the shoreline recede."
	LOC PLAYER >STACK
	IN? DECK-CHAIR,STACK \?L29
	CALL TELL-FERRY-KLUDGE,STR?441
?L29:	PRINTI " As the boat leaves the wharf, y"
	JUMP ?L34
?L25:	PRINTI "The boat begins to move through the waves. Y"
?L34:	PRINTI "ou feel the thrill of being out to sea once again."
	CRLF
	CALL PRINT-ID,STR?442
	CRLF
	IN? PLAYER,BUNK /?L39
	PRINTI "You "
	LOC BUNK >STACK
	IN? PLAYER,STACK /?L43
	LOC BUNK >HERE
	CALL MOVE-SHARED-OBJECTS,HERE
	IN? AIR-HOSE,DEEP-SUIT \?L45
	MOVE AIR-HOSE,MM-COMPRESSOR
	PRINTI "disconnect the "
	CALL DPRINT,AIR-HOSE
	PRINTI ", "
?L45:	PRINTI "go to the crew's quarters and "
?L43:	MOVE PLAYER,BUNK
	PRINTI "climb into your bunk"
	CALL STRIP-EQUIPMENT
	PRINTI ". "
	CRLF
?L39:	PRINTI "In no time, the rhythm of the ocean lulls you to sleep..."
	CRLF
	CRLF
	MOVE PETE,DECK-CHAIR
	MOVE JOHNNY,HERE
	EQUAL? SHIP-CHOSEN,SALVAGER \?L60
	MOVE WEASEL,MM-AFT-DECK
	JUMP ?L62
?L60:	MOVE WEASEL,NW-AFT-DECK
?L62:	CALL META-LOC,ENVELOPE >STACK
	GETP STACK,P?LINE >STACK
	EQUAL? STACK,BOAT \?L63
	IN? ENVELOPE,UNDER-BUNK /?L63
	MOVE ENVELOPE,WEASEL
?L63:	SET 'OT,PRESENT-TIME
	RANDOM 15 >STACK
	ADD 345,STACK >PRESENT-TIME
	ADD PRESENT-TIME,1440 >STACK
	SUB STACK,OT >EXCESS
	CALL INTERRUPT-CHECK,EXCESS
	ZERO? WATCH-WOUND /?L72
	MOD EXCESS,60 >STACK
	ADD WATCH-MOVES,STACK >WATCH-MOVES
	GRTR? WATCH-MOVES,59 \?L68
	SUB WATCH-MOVES,60 >WATCH-MOVES
	INC 'WATCH-SCORE
?L68:	DIV EXCESS,60 >STACK
	ADD WATCH-SCORE,STACK >WATCH-SCORE
?L71:	GRTR? WATCH-SCORE,11 \?L72
	SUB WATCH-SCORE,12 >WATCH-SCORE
	JUMP ?L71
?L72:	CALL WATCH-UPDATE
	EQUAL? LATITUDE-SET,40 \?L77
	EQUAL? LONGITUDE-SET,45 \?L77
	SET 'WRECK-CHOSEN,1
	SET 'OCEAN-BOTTOM,400
	JUMP ?L81
?L77:	EQUAL? LATITUDE-SET,25 \?L79
	EQUAL? LONGITUDE-SET,25 \?L79
	SET 'WRECK-CHOSEN,2
	SET 'OCEAN-BOTTOM,150
	JUMP ?L81
?L79:	EQUAL? LATITUDE-SET,15 \?L80
	EQUAL? LONGITUDE-SET,50 \?L80
	SET 'WRECK-CHOSEN,3
	SET 'OCEAN-BOTTOM,350
	JUMP ?L81
?L80:	CALL OCEAN-BOTTOM-FCN >OCEAN-BOTTOM
	ZERO? OCEAN-BOTTOM \?L81
	CALL PRINT-ID,STR?443
	CALL JIGS-UP,STR?444
?L81:	SET 'HOW-TIRED,1
	LESS? HOW-HUNGRY,2 \?L83
	SET 'HOW-HUNGRY,1
?L83:	LESS? HOW-THIRSTY,2 \?L86
	SET 'HOW-THIRSTY,1
?L86:	CALL QUEUE,I-HUNGER,10 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-THIRST,15 >STACK
	PUT STACK,0,1
	CALL QUEUE,I-TIRED,869 >STACK
	PUT STACK,0,1
	SUB 720,PRESENT-TIME >STACK
	CALL QUEUE,I-ENDIT,STACK >STACK
	PUT STACK,0,1
	CALL DPRINT,JOHNNY
	PRINTI " shakes your shoulder and wakes you. "
	EQUAL? SHIP-CHOSEN,TRAWLER \?L91
	CALL ESTABLISH-GOAL,JOHNNY,NW-CAPT-CABIN
	JUMP ?L93
?L91:	CALL ESTABLISH-GOAL,JOHNNY,MM-CAPT-CABIN
?L93:	CALL INT,I-BOAT-TRIP >STACK
	PUT STACK,0,0
	PRINTR """We've arrived. You're up as soon as you're ready."""

	.FUNCT STRIP-EQUIPMENT,F,N,V=0
	FIRST? PLAYER >F /?L4
	JUMP ?L3
?L1:	ZERO? F /?L3
?L4:	NEXT? F >N /?L7
?L7:	EQUAL? F,WATCH /?L8
	LOC BUNK >STACK
	MOVE F,STACK
	FCLEAR F,WORNBIT
	SET 'V,1
?L8:	SET 'F,N
	JUMP ?L1
?L3:	ZERO? V /FALSE
	PRINTI ", dropping your equipment"
	RTRUE

	.FUNCT INTERRUPT-CHECK,DUR,C,E,TICK,FOO,R
	ADD C-TABLE,C-INTS >C
	ADD C-TABLE,C-TABLELEN >E
	SET 'ASLEEP,1
?L1:	EQUAL? C,E /?L2
	GET C,C-ENABLED? >STACK
	ZERO? STACK /?L11
	GET C,C-TICK >TICK
	ZERO? TICK /?L11
	SUB TICK,DUR >FOO
	LESS? FOO,2 \?L9
	GET C,C-RTN >STACK
	CALL STACK >STACK
	SUB TICK,1 >STACK
	PUT C,C-TICK,STACK
	JUMP ?L11
?L9:	PUT C,C-TICK,FOO
?L11:	ADD C,C-INTLEN >C
	JUMP ?L1
?L2:	SET 'ASLEEP,0
	RETURN ASLEEP

	.FUNCT LE?,LAT,LON,CNST
	MUL LON,LONGITUDE-SET >STACK
	MUL LAT,LATITUDE-SET >STACK
	ADD STACK,STACK >STACK
	GRTR? STACK,CNST \TRUE
	RFALSE

	.FUNCT GE?,LAT,LON,CNST
	MUL LON,LONGITUDE-SET >STACK
	MUL LAT,LATITUDE-SET >STACK
	ADD STACK,STACK >STACK
	LESS? STACK,CNST \TRUE
	RFALSE

	.FUNCT OCEAN-BOTTOM-FCN
	LESS? LONGITUDE-SET,5 /?L3
	GRTR? LONGITUDE-SET,55 /?L3
	LESS? LATITUDE-SET,5 /?L3
	GRTR? LATITUDE-SET,45 \?L1
?L3:	CALL PRINT-ID,STR?445
	CALL JIGS-UP,STR?446 >STACK
	RSTACK
?L1:	GRTR? LATITUDE-SET,17 /?L4
	CALL LE?,2,-5,-11 >STACK
	ZERO? STACK /?L4
	CALL LE?,1,1,30 >STACK
	ZERO? STACK \FALSE
?L4:	GRTR? LATITUDE-SET,6 /?L5
	GRTR? LONGITUDE-SET,36 /?L5
	LESS? LONGITUDE-SET,34 \FALSE
?L5:	GRTR? LONGITUDE-SET,34 /?L6
	GRTR? LATITUDE-SET,7 /?L6
	CALL LE?,1,-1,-26 >STACK
	ZERO? STACK \FALSE
?L6:	CALL GE?,2,1,115 >STACK
	ZERO? STACK /?L7
	RETURN 400
?L7:	CALL GE?,1,1,68 >STACK
	ZERO? STACK /?L8
	CALL LE?,1,-2,-91 >STACK
	ZERO? STACK /?L8
	RETURN 400
?L8:	LESS? LATITUDE-SET,40 \?L11
	CALL GE?,15,4,680 >STACK
	ZERO? STACK \?L11
	CALL GE?,2,1,107 >STACK
	ZERO? STACK \?L11
	CALL GE?,1,1,76 >STACK
	ZERO? STACK \?L11
	LESS? LONGITUDE-SET,44 /?L9
	CALL GE?,2,1,70 >STACK
	ZERO? STACK /?L9
	LESS? LONGITUDE-SET,52 \?L11
	CALL LE?,5,-3,-57 >STACK
	ZERO? STACK \?L11
	CALL LE?,1,-1,-31 >STACK
	ZERO? STACK /?L9
?L11:	RETURN 350
?L9:	GRTR? LATITUDE-SET,37 /?L14
	CALL GE?,6,1,240 >STACK
	ZERO? STACK \?L14
	CALL GE?,13,6,635 >STACK
	ZERO? STACK \?L14
	CALL GE?,1,1,72 >STACK
	ZERO? STACK \?L14
	LESS? LONGITUDE-SET,41 /?L12
	CALL GE?,13,8,497 >STACK
	ZERO? STACK /?L12
	LESS? LONGITUDE-SET,49 \?L14
	CALL LE?,6,-5,-121 >STACK
	ZERO? STACK \?L14
	CALL LE?,2,-3,-103 >STACK
	ZERO? STACK /?L12
?L14:	RETURN 300
?L12:	LESS? LATITUDE-SET,35 \?L17
	CALL GE?,2,-1,57 >STACK
	ZERO? STACK \?L17
	CALL GE?,44,15,1810 >STACK
	ZERO? STACK \?L17
	CALL GE?,4,3,230 >STACK
	ZERO? STACK \?L17
	LESS? LONGITUDE-SET,37 /?L15
	CALL GE?,13,7,415 >STACK
	ZERO? STACK /?L15
	LESS? LONGITUDE-SET,46 \?L17
	CALL LE?,3,-2,-32 >STACK
	ZERO? STACK /?L15
?L17:	RETURN 250
?L15:	GRTR? LATITUDE-SET,19 /?L20
	CALL LE?,5,3,131 >STACK
	ZERO? STACK /?L20
	CALL LE?,7,6,214 >STACK
	ZERO? STACK \?L19
?L20:	GRTR? LATITUDE-SET,7 /?L21
	GRTR? LONGITUDE-SET,35 \?L19
?L21:	GRTR? LATITUDE-SET,8 /?L18
	CALL LE?,2,-1,-16 >STACK
	ZERO? STACK /?L18
	CALL LE?,1,1,45 >STACK
	ZERO? STACK /?L18
	CALL LE?,2,1,51 >STACK
	ZERO? STACK /?L18
?L19:	RETURN 50
?L18:	GRTR? LATITUDE-SET,20 /?L24
	CALL LE?,2,1,50 >STACK
	ZERO? STACK /?L24
	CALL LE?,10,7,286 >STACK
	ZERO? STACK \?L23
?L24:	GRTR? LATITUDE-SET,9 /?L22
	CALL LE?,3,2,99 >STACK
	ZERO? STACK /?L22
?L23:	RETURN 100
?L22:	GRTR? LATITUDE-SET,22 /?L27
	CALL LE?,5,3,140 >STACK
	ZERO? STACK \?L26
	CALL LE?,7,3,172 >STACK
	ZERO? STACK \?L26
?L27:	GRTR? LATITUDE-SET,10 /?L25
	CALL LE?,9,5,270 >STACK
	ZERO? STACK /?L25
?L26:	RETURN 150
?L25:	GRTR? LONGITUDE-SET,29 /?L28
	LESS? LONGITUDE-SET,18 /?L28
	GRTR? LATITUDE-SET,24 /?L28
	LESS? LATITUDE-SET,19 /?L28
	CALL LE?,9,4,296 >STACK
	ZERO? STACK /?L28
	CALL GE?,4,1,102 >STACK
	ZERO? STACK /?L28
	CALL GE?,2,1,62 >STACK
	ZERO? STACK /?L28
	RETURN 50
?L28:	GRTR? LATITUDE-SET,28 /?L29
	LESS? LATITUDE-SET,17 /?L29
	GRTR? LONGITUDE-SET,34 /?L29
	LESS? LONGITUDE-SET,15 /?L29
	CALL LE?,1,-1,11 >STACK
	ZERO? STACK /?L29
	CALL GE?,1,1,39 >STACK
	ZERO? STACK /?L29
	CALL GE?,5,2,141 >STACK
	ZERO? STACK /?L29
	CALL GE?,1,-1,-15 >STACK
	ZERO? STACK /?L29
	CALL LE?,4,1,118 >STACK
	ZERO? STACK \?L30
	CALL LE?,6,5,268 >STACK
	ZERO? STACK /?L29
?L30:	RETURN 100
?L29:	GRTR? LATITUDE-SET,32 /?L31
	LESS? LATITUDE-SET,16 /?L31
	GRTR? LONGITUDE-SET,38 /?L31
	CALL GE?,5,-3,-19 >STACK
	ZERO? STACK /?L31
	CALL GE?,7,3,196 >STACK
	ZERO? STACK /?L31
	CALL GE?,3,7,164 >STACK
	ZERO? STACK /?L31
	CALL LE?,1,-1,18 >STACK
	ZERO? STACK /?L31
	CALL LE?,7,6,344 >STACK
	ZERO? STACK \?L32
	CALL LE?,11,4,394 >STACK
	ZERO? STACK /?L31
?L32:	RETURN 150
?L31:	RETURN 200

	.FUNCT I-HUNGER,N,?TMP
	ZERO? ASLEEP \FALSE
	INC 'HOW-HUNGRY
	EQUAL? HOW-HUNGRY,1 \?L4
	CALL QUEUE,I-HUNGER,300 >STACK
	PUT STACK,0,1
	RFALSE
?L4:	EQUAL? HOW-HUNGRY,2 \?L6
	CALL QUEUE,I-HUNGER,20 >STACK
	PUT STACK,0,1
	PRINTI "You begin to feel hungry."
	CRLF
	RFALSE
?L6:	EQUAL? HOW-HUNGRY,3 \?L9
	CALL QUEUE,I-HUNGER,20 >STACK
	PUT STACK,0,1
	PRINTI "Your stomach begins to bother you. Better "
	CALL PRINT-ID,STR?447
	CALL META-LOC,PLAYER >?TMP
	CALL META-LOC,FOOD >STACK
	EQUAL? ?TMP,STACK \?L12
	PRINTI "do something about it"
	JUMP ?L16
?L12:	PRINTI "find some food"
?L16:	PRINTI "!"
	CRLF
	RFALSE
?L9:	GRTR? HOW-HUNGRY,3 \FALSE
	EQUAL? HERE,SHANTY \?L22
	SET 'N,2
	JUMP ?L24
?L22:	SET 'N,6
?L24:	CALL QUEUE,I-HUNGER,N >STACK
	PUT STACK,0,1
	PRINTI "Your stomach is growling loudly."
	CRLF
	CALL PRINT-ID,STR?448
	RETURN 2

	.FUNCT I-THIRST
	ZERO? ASLEEP \FALSE
	INC 'HOW-THIRSTY
	EQUAL? HOW-THIRSTY,1 \?L4
	CALL QUEUE,I-THIRST,110 >STACK
	PUT STACK,0,1
	PRINTI "Your throat starts to feel dry."
	CRLF
	RFALSE
?L4:	EQUAL? HOW-THIRSTY,2 \?L8
	CALL QUEUE,I-THIRST,115 >STACK
	PUT STACK,0,1
	PRINTI "You feel fairly thirsty."
	CRLF
	CALL PRINT-ID,STR?449
	RFALSE
?L8:	EQUAL? HOW-THIRSTY,3 \?L11
	CALL QUEUE,I-THIRST,15 >STACK
	PUT STACK,0,1
	CALL TELL-YOUD-BETTER,STR?450
	CALL PRINT-ID,STR?451
	RFALSE
?L11:	GRTR? HOW-THIRSTY,3 \FALSE
	CALL QUEUE,I-THIRST,4 >STACK
	PUT STACK,0,1
	PRINTI "You lick your lips and clear your throat."
	CRLF
	CALL PRINT-ID,STR?452
	RETURN 2

	.FUNCT I-TIRED
	ZERO? ASLEEP \FALSE
	LESS? HOW-TIRED,6 \?L3
	INC 'HOW-TIRED
?L3:	EQUAL? HOW-TIRED,1 \?L5
	CALL QUEUE,I-TIRED,479 >STACK
	PUT STACK,0,1
	RFALSE
?L5:	EQUAL? HOW-TIRED,2 \?L7
	CALL QUEUE,I-TIRED,1 >STACK
	PUT STACK,0,1
	RFALSE
?L7:	EQUAL? HOW-TIRED,3 \?L8
	CALL QUEUE,I-TIRED,30 >STACK
	PUT STACK,0,1
	PRINTR "You yawn as you begin to feel drowsy."
?L8:	EQUAL? HOW-TIRED,4 \?L11
	CALL QUEUE,I-TIRED,20 >STACK
	PUT STACK,0,1
	PRINTI "You are starting to feel tired."
	CRLF
	RFALSE
?L11:	EQUAL? HOW-TIRED,5 \?L14
	CALL QUEUE,I-TIRED,10 >STACK
	PUT STACK,0,1
	PRINTR "You yawn and feel very tired. Think about going to bed."
?L14:	EQUAL? HOW-TIRED,6 \FALSE
	PRINTI "Exhaustion overwhelms you. Keeping your eyes open is painful."
	CALL PRINT-ID,STR?453
	ZERO? AT-SEA \?L20
	PRINTI " "
	CALL V-SLEEP
	RETURN 2
?L20:	CALL QUEUE,I-TIRED,6 >STACK
	PUT STACK,0,1
	CRLF
	RETURN 2

	.FUNCT I-SQUID,L
	LOC SQUID >L
	CALL META-LOC,PLAYER >STACK
	EQUAL? STACK,L \?L1
	CALL PRINT-ID,STR?454
	CALL JIGS-UP,STR?455 >STACK
	RSTACK
?L1:	CALL INT,I-SQUID >STACK
	PUT STACK,0,0
	RFALSE

	.FUNCT I-SHARK
	GETP HERE,P?LINE >STACK
	LESS? STACK,UNDERWATER-LINE-C \?L1
	CALL INT,I-SHARK >STACK
	PUT STACK,0,0
	MOVE SHARK,LOCAL-GLOBALS
	FCLEAR SHARK,ONBIT
	RFALSE
?L1:	IN? SHARK,UNDERWATER \?L3
	IN? SHARK-REPELLENT,PLAYER \?L4
	FSET? SHARK-REPELLENT,OPENBIT \?L4
	MOVE SHARK,WINDING-ROAD-2
	CALL INT,I-SHARK >STACK
	PUT STACK,0,0
	ZERO? LIT /FALSE
	FSET? SHARK,ONBIT \?L8
	PRINTI "The shark continues"
	JUMP ?L11
?L8:	PRINTI "A shark swims"
?L11:	PRINTR " toward you, then stops. It turns and swims away."
?L4:	FSET? SHARK,ONBIT \?L17
	PRINTI "The shark"
	JUMP ?L24
?L17:	ZERO? LIT /?L21
	PRINTI "A shark"
	JUMP ?L24
?L21:	PRINTI "Something"
?L24:	CALL PRINT-ID,STR?456
	CALL JIGS-UP,STR?457 >STACK
	RSTACK
?L3:	MOVE SHARK,UNDERWATER
	CALL QUEUE,I-SHARK,-1 >STACK
	PUT STACK,0,1
	ZERO? LIT /FALSE
	FSET SHARK,ONBIT
	PRINTR "A shark swims toward you!"

	.FUNCT I-PLUMMET
	INC 'CRIMP-CTR
	EQUAL? CRIMP-CTR,1 \?L1
	CALL QUEUE,I-PLUMMET,-1 >STACK
	PUT STACK,0,1
	CALL GLOBAL-IN?,FALLEN-BUNK,HERE >STACK
	ZERO? STACK /FALSE
	SET 'P-IT-OBJECT,FALLEN-BUNK
	PRINTR "The row of bunks you moved starts to fall."
?L1:	EQUAL? CRIMP-CTR,2 \?L8
	CALL GLOBAL-IN?,FALLEN-BUNK,HERE >STACK
	ZERO? STACK /FALSE
	SET 'P-IT-OBJECT,FALLEN-BUNK
	PRINTI "The row of bunks falls toward the doorway"
	EQUAL? HERE,WRECK-8 \?L13
	PRINTI ", threatening to pinch your "
	CALL DPRINT,AIR-HOSE
	PRINTR "!"
?L13:	PRINTR "."
?L8:	EQUAL? CRIMP-CTR,3 \FALSE
	CALL GLOBAL-IN?,FALLEN-BUNK,HERE >STACK
	ZERO? STACK /?L22
	EQUAL? HERE,WRECK-8 \?L24
	CALL PRINT-ID,STR?458
	CALL JIGS-UP,STR?459 >STACK
	RSTACK
?L24:	SET 'BUNKS-MOVED,0
	SET 'P-IT-OBJECT,FALLEN-BUNK
	PRINTR "The bunks fall back into the doorway, blocking the passage."
?L22:	EQUAL? HERE,WRECK-1,WRECK-2,WRECK-3 /?L30
	EQUAL? HERE,WRECK-4,WRECK-5,WRECK-6 /?L30
	EQUAL? HERE,UNDERWATER \?L29
?L30:	SET 'BUNKS-MOVED,0
	RFALSE
?L29:	CALL PRINT-ID,STR?460
	CALL JIGS-UP,STR?461 >STACK
	RSTACK

	.FUNCT I-LIVER
	GRTR? BLOOD-ALCOHOL,0 \?L1
	DEC 'BLOOD-ALCOHOL
?L1:	GRTR? SLOSH-CTR,0 \?L4
	DEC 'SLOSH-CTR
?L4:	CALL QUEUE,I-LIVER,10 >STACK
	PUT STACK,0,1
	GRTR? BLOOD-ALCOHOL,15 \FALSE
	PRINTI "Your head swims for a minute."
	CRLF
	CALL PRINT-ID,STR?462
	RETURN 2

	.FUNCT I-PENDULUM,DIR=0
	CALL QUEUE,I-PENDULUM,-2
	EQUAL? LINE-LOC,5 \?L1
	SET 'LINE-LOC-INC,-1
	JUMP ?L7
?L1:	EQUAL? LINE-LOC,1 \?L3
	SET 'LINE-LOC-INC,1
	JUMP ?L7
?L3:	CALL META-LOC,PLAYER >STACK
	IN? SAFETY-LINE,STACK \?L7
	EQUAL? LINE-LOC-INC,1 \?L5
	SET 'DIR,STR?463
	JUMP ?L7
?L5:	SET 'DIR,STR?464
?L7:	ADD LINE-LOC,LINE-LOC-INC >LINE-LOC
	EQUAL? LINE-LOC,2 \?L9
	MOVE SAFETY-LINE,WEST-OF-WRECK-9
	EQUAL? HERE,WEST-OF-WRECK-9 \FALSE
	CALL TELL-LINE-SWINGS >STACK
	RSTACK
?L9:	EQUAL? LINE-LOC,4 \?L14
	MOVE SAFETY-LINE,WEST-OF-WRECK-11
	EQUAL? HERE,WEST-OF-WRECK-11 \FALSE
	CALL TELL-LINE-SWINGS >STACK
	RSTACK
?L14:	MOVE SAFETY-LINE,LOCAL-GLOBALS
	ZERO? DIR /FALSE
	PRINTI "The line swings away to the "
	PRINT DIR
	PRINTR "."

	.FUNCT TELL-LINE-SWINGS
	PRINTI "The "
	CALL DPRINT,SAFETY-LINE
	PRINTI " from above swings in from the "
	EQUAL? LINE-LOC-INC,1 \?L3
	PRINTI "south"
	JUMP ?L7
?L3:	PRINTI "north"
?L7:	PRINTR "."

	.FUNCT I-CASE-LEAK,ALREADY=0
	IGRTR? 'WATER-IN-CASE,9 \?L1
	FSET? STAMPS,RMUNGBIT \?L3
	SET 'ALREADY,1
?L3:	FSET STAMPS,RMUNGBIT
	CALL INT,I-CASE-LEAK >STACK
	PUT STACK,0,0
?L1:	IN? GLASS-CASE,PLAYER \FALSE
	PRINTI "The water level in the "
	CALL DPRINT,GLASS-CASE
	PRINTI " rises."
	FSET? STAMPS,RMUNGBIT \?L11
	ZERO? ALREADY \?L11
	PRINTI " As it reaches the stamps, it soaks them."
	CALL PRINT-ID,STR?465
?L11:	CRLF
	RTRUE

	.FUNCT I-DRILL
	FSET BATTERY,RMUNGBIT
	SET 'DRILL-POWERED,0
	CALL INT,I-DRILL >STACK
	PUT STACK,0,0
	PRINTI "The "
	CALL DPRINT,DRILL
	PRINTR " sputters, and the bit stops turning."

	.FUNCT I-AIR-SUPPLY
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \FALSE
	IN? AIR-TANK,PLAYER \FALSE
	CALL AIRTIGHT-ROOM? >STACK
	ZERO? STACK \FALSE
	ADD DEPTH,33 >STACK
	DIV STACK,44 >STACK
	SUB AIR-LEFT,STACK >AIR-LEFT
	LESS? AIR-LEFT,1 \?L3
	CALL PRINT-ID,STR?466
	CALL JIGS-UP,STR?467 >STACK
	RSTACK
?L3:	LESS? AIR-LEFT,15 \FALSE
	PRINTI "Your air supply is dangerously low."
	CRLF
	EQUAL? WAITED?,1 /TRUE
	RETURN 2

	.FUNCT I-MM-COMPRESSOR
	CALL QUEUE,I-LAST-GASP,10 >STACK
	PUT STACK,0,1
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \FALSE
	PRINTI "You have to breathe harder. Maybe you'd better surface."
	CRLF
	RETURN 2

	.FUNCT I-LAST-GASP
	GETP HERE,P?LINE >STACK
	EQUAL? STACK,UNDERWATER-LINE-C \?L1
	CALL PRINT-ID,STR?468
	CALL JIGS-UP,STR?469 >STACK
	RSTACK
?L1:	CALL QUEUE,I-LAST-GASP,1 >STACK
	PUT STACK,0,0
	RTRUE

	.FUNCT I-PLOT-NEVER-STARTS
	CALL INT,I-JOHNNY >STACK
	PUT STACK,0,0
	CALL INT,I-PETE >STACK
	PUT STACK,0,0
	IN? WEASEL,SHANTY \?L1
	CALL INT,I-WEASEL >STACK
	PUT STACK,0,0
?L1:	SET 'FM-CTR,5
	RFALSE

	.FUNCT I-ENDIT
	GETP HERE,P?LINE >STACK
	LESS? STACK,UNDERWATER-LINE-C \FALSE
	CALL PRINT-ID,STR?470
	CALL JIGS-UP,STR?471 >STACK
	RSTACK

	.INSERT "cutthroats/cutthroats_str"
	.END
