	.INSERT "annotated_games/lurkinghorror/lurkinghorror_freq"
	.INSERT "annotated_games/lurkinghorror/lurkinghorror_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	CALL IPRINT,OBJ >STACK
	RSTACK

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT IS-THEFT?
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,RING,MOUSE,BOLT-CUTTER /TRUE
	EQUAL? PRSO,BOOTS,BRONZE-PLUG,CABLE /TRUE
	EQUAL? PRSO,CARTON,CHINESE-FOOD,COKE /TRUE
	EQUAL? PRSO,CROWBAR,FLASHLIGHT,FLASK /TRUE
	EQUAL? PRSO,GLOVES,JUNK,KEY-1 /TRUE
	EQUAL? PRSO,KEY-2,KEY-3,KEY-4 /TRUE
	EQUAL? PRSO,KEYRING,KNIFE,MANHOLE-COVER /TRUE
	EQUAL? PRSO,MASTER-KEY,MICROWAVE,OUTSIDE-DOOR /TRUE
	EQUAL? PRSO,PADLOCK,PC,PEACH-TREE /TRUE
	EQUAL? PRSO,PLASTIC-CONTAINER,POWER-CORD,PRESSURE-VALVE /TRUE
	EQUAL? PRSO,REFRIGERATOR,REPEATER,REPEATER-COVER /TRUE
	EQUAL? PRSO,RING,SIGNUP,SNACK /TRUE
	EQUAL? PRSO,STEAM-PIPES,STOP-SWITCH,URCHIN-CLOTHES /TRUE
	EQUAL? PRSO,VAT \FALSE
	RTRUE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,RING,MOUSE,ACCESS-HATCH /TRUE
	EQUAL? PRSO,ACCESS-PANEL,ALARM-BUTTON,ALCHEMY-DOOR /TRUE
	EQUAL? PRSO,ALCHEMY-TRAP-DOOR,ALCHEMY-WINDOW,ARCHWAY /TRUE
	EQUAL? PRSO,ASSIGNMENT,AXE,BASEMENT-BUTTON /TRUE
	EQUAL? PRSO,BOLT-CUTTER,BOOTS,BRICK-WALL /TRUE
	EQUAL? PRSO,BROKEN-BRICK,BRONZE-PLUG,CABLE /TRUE
	EQUAL? PRSO,CARTON,CHINESE-FOOD,CLOSE-BUTTON /TRUE
	EQUAL? PRSO,COKE,CONTROLS,CROWBAR /TRUE
	EQUAL? PRSO,EMERGENCY-CABINET,FLASHLIGHT,FLASK /TRUE
	EQUAL? PRSO,FORKLIFT,GLOVES,HOOK /TRUE
	EQUAL? PRSO,INPUT-CABLE,INPUT-SOCKET,IRON-PLATE /TRUE
	EQUAL? PRSO,JUNK,KEY-1,KEY-2 /TRUE
	EQUAL? PRSO,KEY-3,KEY-4,KEYRING /TRUE
	EQUAL? PRSO,KITCHEN-COUNTER,KNIFE,LAB-BENCH /TRUE
	EQUAL? PRSO,LADDER,MANHOLE-COVER,MASTER-KEY /TRUE
	EQUAL? PRSO,MENU-BOX,MICROWAVE,MOUSE /TRUE
	EQUAL? PRSO,NEW-BRICK,ODD-PAPER,OPEN-BUTTON /TRUE
	EQUAL? PRSO,OUTLET,OUTSIDE-DOOR,PADLOCK /TRUE
	EQUAL? PRSO,PC,PEACH-TREE,PLASTIC-CONTAINER /TRUE
	EQUAL? PRSO,POOL,POWER-CORD,PRESSURE-VALVE /TRUE
	EQUAL? PRSO,READOUT,REFRIGERATOR,REPEATER /TRUE
	EQUAL? PRSO,REPEATER-COVER,RING,SIGNUP /TRUE
	EQUAL? PRSO,SNACK,STEAM-PIPES,STOP-SWITCH /TRUE
	EQUAL? PRSO,TUB,URCHIN-CLOTHES,VAT \FALSE
	RTRUE

	.FUNCT DANGEROUS-DRINK?
	EQUAL? PRSO,FLOOR-WAX,NITROGEN,POOL \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?
	EQUAL? PRSO,EYES,FEET,HANDS /TRUE
	EQUAL? PRSO,HAND /TRUE
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	RSTACK

	.FUNCT IS-PERSON?
	FSET? PRSO,PERSON \FALSE
	EQUAL? PRSO,ME \TRUE
	RFALSE

	.FUNCT IS-ANIMAL?
	EQUAL? PRSO,RATS,TENTACLE,MASS /TRUE
	EQUAL? PRSO,FROB \FALSE
	RTRUE

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	EQUAL? PRSO,RATS,TENTACLE,MASS /TRUE
	EQUAL? PRSO,FROB \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? PRSO,EYES,FEET,HEAD /TRUE
	EQUAL? PRSO,HANDS,ME \FALSE
	RTRUE

	.FUNCT IS-WEAPON?
	FSET? PRSO,WEAPONBIT \FALSE
	RTRUE

	.FUNCT HARM-VERB?
	EQUAL? PRSA,V?ATTACK,V?BITE,V?CUT /TRUE
	EQUAL? PRSA,V?KICK,V?RUB,V?PUSH /TRUE
	EQUAL? PRSA,V?MOVE,V?THROW /TRUE
	RFALSE

	.FUNCT KILL-VERB?,?TMP
	EQUAL? PRSA,V?KILL,V?MUNG /?L3
	SET '?TMP,0
	JUMP ?L2
?L3:	SET '?TMP,1
	RETURN ?TMP
?L2:	EQUAL? PRSA,V?ATTACK,V?THROW \FALSE
	FSET? PRSI,WEAPONBIT \FALSE
	RTRUE

	.FUNCT HOSTILE-NOT-KILL?
	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /FALSE
	CALL KILL-VERB? >STACK
	ZERO? STACK /TRUE
	RFALSE

	.FUNCT KILL-VERB-MAINT?,W,?TMP
	EQUAL? PRSA,V?THROW /?L1
	SET 'W,PRSI
	JUMP ?L3
?L1:	SET 'W,PRSO
?L3:	EQUAL? PRSA,V?KILL,V?MUNG /?L6
	SET '?TMP,0
	JUMP ?L5
?L6:	SET '?TMP,1
	RETURN ?TMP
?L5:	EQUAL? PRSA,V?ATTACK,V?THROW \FALSE
	FSET? W,WEAPONBIT \FALSE
	RTRUE

	.FUNCT CTHE-PRINT-PRSO
	CALL THE-PRINT,PRSO,1 >STACK
	RSTACK

	.FUNCT CTHE-PRINT-PRSI
	CALL THE-PRINT,PRSI,1 >STACK
	RSTACK

	.FUNCT CTHE-PRINT,O
	CALL THE-PRINT,O,1 >STACK
	RSTACK

	.FUNCT THE-PRINT-PRSO
	CALL THE-PRINT,PRSO >STACK
	RSTACK

	.FUNCT THE-PRINT-PRSI
	CALL THE-PRINT,PRSI >STACK
	RSTACK

	.FUNCT THE-PRINT,O,CAP?=0
	FSET? O,NOTHEBIT /?L1
	PUSH 1
	JUMP ?L2
?L1:	PUSH 0
?L2:	CALL DPRINT,O,CAP?,STACK >STACK
	RSTACK

	.FUNCT PRINTA-PRSO
	CALL PRINTA,PRSO >STACK
	RSTACK

	.FUNCT PRINTA-PRSI
	CALL PRINTA,PRSI >STACK
	RSTACK

	.FUNCT PRINTA,O
	FSET? O,THE \?L1
	PRINTI "the "
	JUMP ?L6
?L1:	FSET? O,NOABIT /?L6
	FSET? O,AN \?L4
	PRINTI "an "
	JUMP ?L6
?L4:	PRINTI "a "
?L6:	CALL IPRINT,O >STACK
	RSTACK

	.FUNCT DPRINT,O,CAP?=0,THE?=0,S
	ZERO? THE? \?L3
	FSET? O,THE \?L6
?L3:	ZERO? CAP? /?L4
	PRINTI "The "
	JUMP ?L6
?L4:	PRINTI "the "
?L6:	CALL IPRINT,O >STACK
	RSTACK

	.FUNCT IPRINT,O
	EQUAL? O,PSEUDO-OBJECT \?L1
	ZERO? P-MERGED \?L1
	EQUAL? O,PRSO,PRSI \?L1
	CALL THING-PRINT,PSEUDO-PRSO >STACK
	RSTACK
?L1:	EQUAL? O,INTNAME \?L3
	PRINTB P-NAME
	RTRUE
?L3:	PRINTD O
	RTRUE

	.FUNCT PICK-ONE,FROB?1,L,CNT,RND,MSG,RFROB
	GET FROB?1,0 >L
	GET FROB?1,1 >CNT
	DEC 'L
	ADD FROB?1,2 >FROB?1
	MUL CNT,2 >STACK
	ADD FROB?1,STACK >RFROB
	SUB L,CNT >STACK
	RANDOM STACK >RND
	GET RFROB,RND >MSG
	GET RFROB,1 >STACK
	PUT RFROB,RND,STACK
	PUT RFROB,1,MSG
	INC 'CNT
	EQUAL? CNT,L \?L1
	SET 'CNT,0
?L1:	PUT FROB?1,0,CNT
	RETURN MSG

	.FUNCT RANDOM-ELEMENT,FROB?1
	GET FROB?1,0 >STACK
	RANDOM STACK >STACK
	GET FROB?1,STACK >STACK
	RSTACK

	.FUNCT GO
START::
	CALL PUT-GLOBAL,TOMB,0,0
	CALL PUT-GLOBAL,TOMB,1,0
	ADD C-TABLE,C-TABLELEN >CLOCK-HAND
	CALL QUEUE,I-URCHIN,10
	CALL QUEUE,I-TIRED,200
	SET 'P-HIM-OBJECT,HACKER
	SET 'P-IT-OBJECT,PC
	SET 'WINNER,PLAYER
	SET 'HERE,TERMINAL-ROOM
	CALL LIT?,HERE >LIT
	USL
	PRINTI "You've waited until the last minute again. This time it's the end of the term, so all the TechNet terminals in the dorm are occupied. So, off you go to the old Comp Center. Too bad it's the worst storm of the winter (Murphy's Law, right?), and you practically froze to death slogging over here from the dorm. Not to mention jumping at every shadow, what with all the recent disappearances. Time to find a free machine, get to work, and write that twenty page paper."
	CRLF
	CRLF
	CALL V-VERSION
	CRLF
	CALL V-LOOK
	CALL MAIN-LOOP
	QUIT

	.FUNCT MAIN-LOOP,TRASH
?L1:	CALL MAIN-LOOP-1 >TRASH
	JUMP ?L1

	.FUNCT MAIN-LOOP-1,ICNT,OCNT,NUM,CNT=0,OBJ=0,TBL,V=0,PTBL=1,OBJ1,TMP,ONUM
	CALL PARSER >P-WON
	ZERO? P-WON /?L1
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	CALL OBJECT-SUBSTITUTE,IT,P-IT-OBJECT >WAS-IT?
	CALL OBJECT-SUBSTITUTE,HIM,P-HIM-OBJECT >WAS-HIM?
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >ONUM
	ZERO? OCNT /?L5
	ZERO? ICNT \?L3
	EQUAL? ONUM,2 \?L3
?L5:	SET 'NUM,0
	JUMP ?L11
?L3:	GRTR? OCNT,1 \?L6
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L7
	SET 'OBJ,0
	JUMP ?L9
?L7:	GET P-PRSI,1 >OBJ
?L9:	SET 'NUM,OCNT
	JUMP ?L11
?L6:	GRTR? ICNT,1 \?L10
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L11
?L10:	SET 'NUM,1
?L11:	ZERO? OBJ \?L12
	EQUAL? ICNT,1 \?L12
	GET P-PRSI,1 >OBJ
?L12:	SET 'PERFORM-DEPTH,0
	EQUAL? PRSA,V?WALK \?L15
	CALL PERFORM-PRSA,PRSO >V
	JUMP ?L32
?L15:	ZERO? NUM \?L17
	ZERO? ONUM \?L18
	CALL PERFORM-PRSA >V
	SET 'PRSO,0
	JUMP ?L32
?L18:	ZERO? LIT \?L20
	PRINT TOO-DARK
	CALL END-QUOTE
	JUMP ?L32
?L20:	PRINTI "There isn't anything to "
	GET P-ITBL,P-VERBN >TMP
	EQUAL? PRSA,V?TELL \?L22
	PRINTI "talk to"
	JUMP ?L26
?L22:	ZERO? P-OFLAG \?L25
	ZERO? P-MERGED /?L24
?L25:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L26
?L24:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L26:	PRINTI "!"
	CRLF
	SET 'V,0
	CALL END-QUOTE
	JUMP ?L32
?L17:	SET 'P-NOT-HERE,0
	SET 'P-MULT,0
	GRTR? NUM,1 \?L28
	SET 'P-MULT,1
?L28:	SET 'TMP,0
	SET 'CNT,0
?L31:	IGRTR? 'CNT,NUM \?L33
	GRTR? P-NOT-HERE,0 \?L35
	PRINTI "The "
	EQUAL? P-NOT-HERE,NUM /?L37
	PRINTI "other "
?L37:	PRINTI "object"
	EQUAL? P-NOT-HERE,1 /?L40
	PRINTI "s"
?L40:	PRINTI " that you mentioned "
	EQUAL? P-NOT-HERE,1 /?L43
	PRINTI "are"
	JUMP ?L45
?L43:	PRINTI "is"
?L45:	PRINTI "n't here."
	CRLF
	JUMP ?L32
?L35:	ZERO? TMP \?L32
	PRINT REFERRING
	CRLF
	JUMP ?L32
?L33:	ZERO? PTBL /?L49
	GET P-PRSO,CNT >OBJ1
	JUMP ?L51
?L49:	GET P-PRSI,CNT >OBJ1
?L51:	ZERO? PTBL /?L52
	SET 'PRSO,OBJ1
	JUMP ?L54
?L52:	SET 'PRSO,OBJ
?L54:	ZERO? PTBL /?L55
	SET 'PRSI,OBJ
	JUMP ?L57
?L55:	SET 'PRSI,OBJ1
?L57:	GRTR? NUM,1 /?L60
	GET P-ITBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL \?L64
?L60:	CALL MULTIPLE-EXCEPTION?,OBJ1 >STACK
	ZERO? STACK \?L31
	EQUAL? PRSA,V?COMPARE-MANY /?L64
	EQUAL? OBJ1,IT \?L65
	CALL DPRINT,P-IT-OBJECT
	JUMP ?L67
?L65:	CALL DPRINT,OBJ1
?L67:	PRINTI ": "
?L64:	SET 'TMP,1
	EQUAL? PRSO,PSEUDO-OBJECT \?L69
	SET 'PSEUDO-PRSO,1
	JUMP ?L70
?L69:	SET 'PSEUDO-PRSO,0
?L70:	CALL PERFORM-PRSA,PRSO,PRSI >V
	EQUAL? V,M-FATAL /?L95
	ZERO? P-MULT /?L31
	INC 'P-MULT
	JUMP ?L31
?L32:	EQUAL? V,M-FATAL /?L95
	CALL GAME-VERB? >STACK
	ZERO? STACK \?L82
	LOC WINNER >STACK
	ZERO? STACK /?L82
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-END >V
?L82:	EQUAL? V,M-FATAL \?L88
?L95:	SET 'P-CONT,0
	JUMP ?L88
?L1:	SET 'P-CONT,0
?L88:	ZERO? P-WON /FALSE
	CALL GAME-VERB? >STACK
	ZERO? STACK \?L93
	CALL CLOCKER >V
?L93:	SET 'PRSA,0
	SET 'PRSO,0
	SET 'PRSI,0
	RETURN PRSI

	.FUNCT OBJECT-SUBSTITUTE,OBJ,VAR,TMP=0,CNT=0,ICNT,OCNT
	ZERO? VAR /FALSE
	CALL ACCESSIBLE?,VAR >STACK
	ZERO? STACK /FALSE
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
?L3:	IGRTR? 'CNT,ICNT /?L4
	GET P-PRSI,CNT >STACK
	EQUAL? STACK,OBJ \?L3
	PUT P-PRSI,CNT,VAR
	SET 'TMP,1
?L4:	SET 'CNT,0
?L11:	IGRTR? 'CNT,OCNT /?L12
	GET P-PRSO,CNT >STACK
	EQUAL? STACK,OBJ \?L11
	PUT P-PRSO,CNT,VAR
	SET 'TMP,1
?L12:	RETURN TMP

	.FUNCT GAME-VERB?
	EQUAL? PRSA,V?TELL \?L1
	ZERO? P-CONT \TRUE
?L1:	EQUAL? PRSA,V?HELP \?L3
	ZERO? PRSO \?L3
	IN? PC,HERE \TRUE
?L3:	EQUAL? PRSA,V?QUIT,V?VERSION,V?BRIEF /TRUE
	EQUAL? PRSA,V?SUPER-BRIEF,V?VERBOSE,V?$0024VERIFY /TRUE
	EQUAL? PRSA,V?RESTART,V?SAVE,V?RESTORE /TRUE
	EQUAL? PRSA,V?SCRIPT,V?UNSCRIPT,V?$0024SOUND /TRUE
	EQUAL? PRSA,V?$0024RANDOM,V?$0024COMMAND,V?$0024RECORD /TRUE
	EQUAL? PRSA,V?$0024UNRECORD,V?SCORE,V?TIME /TRUE
	RFALSE

	.FUNCT MULTIPLE-EXCEPTION?,OBJ1,L
	LOC OBJ1 >L
	EQUAL? OBJ1,NOT-HERE-OBJECT \?L1
	INC 'P-NOT-HERE
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L3
	ZERO? PRSI /?L3
	IN? PRSO,PRSI \TRUE
?L3:	CALL ACCESSIBLE?,OBJ1 >STACK
	ZERO? STACK /TRUE
	EQUAL? P-GETFLAGS,P-ALL \FALSE
	ZERO? PRSI /?L6
	EQUAL? PRSO,PRSI /TRUE
?L6:	EQUAL? PRSA,V?TAKE \?L8
	ZERO? PRSI \?L8
	EQUAL? L,WINNER,HERE,PRSI /?L12
	LOC WINNER >STACK
	EQUAL? L,STACK /?L12
	FSET? L,SURFACEBIT /?L12
	FSET? L,SEARCHBIT \TRUE
?L12:	FSET? OBJ1,TAKEBIT /?L9
	FSET? OBJ1,TRYTAKEBIT \TRUE
?L9:	FSET? L,PERSON /TRUE
	LOC L >STACK
	FSET? STACK,PERSON /TRUE
	CALL HELD?,PRSO >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSO,DOME-LADDER \?L16
	ZERO? LADDER-TOP? \TRUE
	ZERO? LADDER-BOTTOM? \TRUE
?L16:	EQUAL? PRSO,CHAIN,CHAIN-1,CHAIN-2 \?L18
	ZERO? CHAIN-HOOKED? \?L19
	ZERO? CHAIN-LOOPED? /?L18
?L19:	EQUAL? L,ELEVATOR-PIT,CS-BASEMENT \TRUE
?L18:	EQUAL? PRSO,PADLOCK \FALSE
	ZERO? PADLOCK-ON? \TRUE
	RFALSE
?L8:	EQUAL? PRSA,V?DROP,V?GIVE \?L22
	IN? OBJ1,WINNER \TRUE
	FSET? OBJ1,WEARBIT /TRUE
	RFALSE
?L22:	EQUAL? PRSA,V?PUT \FALSE
	IN? PRSO,WINNER /FALSE
	CALL HELD?,PRSO,PRSI >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT FAKE-ORPHAN,TMP
	CALL ORPHAN,P-SYNTAX,0
	PRINT WHAT-DO-YOU-WANT-TO
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	JUMP ?L4
?L1:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L3
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L4
?L3:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L4:	SET 'P-OFLAG,1
	SET 'P-WON,0
	GETB P-SYNTAX,P-SPREP1 >STACK
	CALL PREP-PRINT,STACK
	PRINTR "?"

	.FUNCT PERFORM,A,O=0,I=0,V=0,OA,OO,OI,CNT
	INC 'PERFORM-DEPTH
	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	SET 'PRSA,A
	EQUAL? IT,I,O \?L1
	ZERO? I \?L3
	CALL FAKE-ORPHAN
	RETURN M-FATAL
?L3:	PRINT REFERRING
	CRLF
	RETURN M-FATAL
?L1:	ZERO? I /?L7
	EQUAL? PRSA,V?WALK /?L7
	EQUAL? I,NOT-HERE-OBJECT /?L7
	CALL THIS-IS-IT,I
?L7:	ZERO? O /?L10
	EQUAL? PRSA,V?WALK /?L10
	EQUAL? O,NOT-HERE-OBJECT /?L10
	CALL THIS-IS-IT,O
?L10:	SET 'PRSO,O
	SET 'PRSI,I
	EQUAL? A,V?WALK /?L13
	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \?L13
	CALL NOT-HERE-OBJECT-F >V
	ZERO? V \?L24
?L13:	SET 'O,PRSO
	SET 'I,PRSI
	EQUAL? PRSA,V?TELL-ABOUT,V?SGIVE,V?SSHOW /?L16
	EQUAL? PRSA,V?SRUB,V?SPUT-ON /?L16
	GETP WINNER,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L24
?L16:	LOC WINNER >STACK
	ZERO? STACK /?L18
	LOC WINNER >STACK
	EQUAL? STACK,HERE /?L18
	LOC WINNER >STACK
	GETP STACK,P?ACTION >STACK
	CALL STACK,M-BEG >V
	ZERO? V \?L24
?L18:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-BEG >V
	ZERO? V \?L24
	GET PREACTIONS,A >STACK
	CALL STACK >V
	ZERO? V \?L24
	ZERO? I /?L21
	GETP I,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L24
?L21:	ZERO? O /?L23
	EQUAL? A,V?WALK /?L22
	LOC O >STACK
	ZERO? STACK /?L22
	LOC O >STACK
	GETP STACK,P?CONTFCN >STACK
	ZERO? STACK /?L22
	LOC O >STACK
	GETP STACK,P?CONTFCN >STACK
	CALL STACK,M-CONTAINER >V
	ZERO? V \?L24
?L22:	ZERO? O /?L23
	EQUAL? A,V?WALK /?L23
	GETP O,P?ACTION >STACK
	CALL STACK >V
	ZERO? V \?L24
?L23:	GET ACTIONS,A >STACK
	CALL STACK >V
	ZERO? V /?L24
?L24:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT DEQUEUE,RTN,TIM
	CALL QUEUED?,RTN >RTN
	ZERO? RTN /FALSE
	GET RTN,C-TICK >TIM
	PUT RTN,C-RTN,0
	RETURN TIM

	.FUNCT QUEUED?,RTN,C,E
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E /FALSE
	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L8
	GET C,C-TICK >STACK
	ZERO? STACK /FALSE
	RETURN C
?L8:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT QUEUE,RTN,TICK,I?=0,C,E,INT=0
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	ZERO? INT /?L5
	SET 'C,INT
	JUMP ?L7
?L5:	SUB C-INTS,C-INTLEN >C-INTS
	ADD C-TABLE,C-INTS >INT
?L7:	PUT INT,C-RTN,RTN
	JUMP ?L2
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L8
	ZERO? I? \FALSE
	SET 'INT,C
	JUMP ?L2
?L8:	GET C,C-RTN >STACK
	ZERO? STACK \?L12
	SET 'INT,C
?L12:	ADD C,C-INTLEN >C
	JUMP ?L1
?L2:	GRTR? INT,CLOCK-HAND \?L14
	ADD TICK,3 >STACK
	SUB 0,STACK >TICK
?L14:	PUT INT,C-TICK,TICK
	RETURN INT

	.FUNCT CLOCKER,E,TICK,RTN,FLG=0,Q?=0,OWINNER
	ZERO? CLOCK-WAIT /?L1
	SET 'CLOCK-WAIT,0
	RFALSE
?L1:	ADD C-TABLE,C-INTS >CLOCK-HAND
	ADD C-TABLE,C-TABLELEN >E
	SET 'OWINNER,WINNER
	SET 'WINNER,PLAYER
?L4:	EQUAL? CLOCK-HAND,E \?L6
	SET 'CLOCK-HAND,E
	INC 'MOVES
	SET 'WINNER,OWINNER
	RETURN FLG
?L6:	GET CLOCK-HAND,C-RTN >STACK
	ZERO? STACK /?L26
	GET CLOCK-HAND,C-TICK >TICK
	LESS? TICK,-1 \?L9
	SUB 0,TICK >STACK
	SUB STACK,3 >STACK
	PUT CLOCK-HAND,C-TICK,STACK
	SET 'Q?,CLOCK-HAND
	JUMP ?L26
?L9:	ZERO? TICK /?L26
	GRTR? TICK,0 \?L12
	DEC 'TICK
	PUT CLOCK-HAND,C-TICK,TICK
?L12:	ZERO? TICK /?L15
	SET 'Q?,CLOCK-HAND
?L15:	GRTR? TICK,0 /?L26
	GET CLOCK-HAND,C-RTN >RTN
	ZERO? TICK \?L20
	PUT CLOCK-HAND,C-RTN,0
?L20:	CALL RTN >STACK
	ZERO? STACK /?L23
	SET 'FLG,1
?L23:	ZERO? Q? \?L26
	GET CLOCK-HAND,C-RTN >STACK
	ZERO? STACK /?L26
	SET 'Q?,1
?L26:	ADD CLOCK-HAND,C-INTLEN >CLOCK-HAND
	ZERO? Q? \?L4
	ADD C-INTS,C-INTLEN >C-INTS
	JUMP ?L4

	.FUNCT PERFORM-PRSA,O=0,I=0
	CALL PERFORM,PRSA,O,I >STACK
	RSTACK

	.FUNCT NEW-VERB,V
	CALL PERFORM,V,PRSO,PRSI >STACK
	RSTACK

	.FUNCT SWAP-VERB,V
	CALL PERFORM,V,PRSI,PRSO >STACK
	RSTACK

	.FUNCT NEW-PRSO,O
	CALL PERFORM-PRSA,O,PRSI >STACK
	RSTACK

	.FUNCT NEW-PRSI,I
	CALL PERFORM-PRSA,PRSO,I >STACK
	RSTACK

	.FUNCT NEW-WINNER-PRSO,A,O=0,I=0,OW
	SET 'OW,WINNER
	SET 'WINNER,PRSO
	CALL PERFORM,A,O,I
	SET 'WINNER,OW
	RETURN WINNER

	.FUNCT REDIRECT,FROM,TO,O,I
	EQUAL? PRSO,FROM \?L1
	SET 'O,TO
	JUMP ?L3
?L1:	SET 'O,PRSO
?L3:	EQUAL? PRSI,FROM \?L4
	SET 'I,TO
	JUMP ?L6
?L4:	SET 'I,PRSI
?L6:	CALL PERFORM-PRSA,O,I
	RTRUE

	.FUNCT PARSER,PTR=P-LEXSTART,WRD,VAL=0,VERB=0,OF-FLAG=0,OWINNER,OMERGED,LEN,DIR=0,NW=0,LW=0,CNT=-1
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	ZERO? P-OFLAG \?L6
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
?L6:	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'OWINNER,WINNER
	SET 'OMERGED,P-MERGED
	SET 'P-ADVERB,0
	SET 'P-MERGED,0
	SET 'P-END-ON-PREP,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	ZERO? QUOTE-FLAG \?L9
	EQUAL? WINNER,PLAYER /?L9
	SET 'WINNER,PLAYER
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L11
	LOC WINNER >HERE
?L11:	CALL LIT?,HERE >LIT
?L9:	ZERO? RESERVE-PTR /?L15
	SET 'PTR,RESERVE-PTR
	CALL STUFF,RESERVE-LEXV,P-LEXV
	ZERO? VERBOSITY /?L17
	EQUAL? PLAYER,WINNER \?L17
	CRLF
?L17:	SET 'RESERVE-PTR,0
	SET 'P-CONT,0
	JUMP ?L24
?L15:	ZERO? P-CONT /?L20
	SET 'PTR,P-CONT
	ZERO? VERBOSITY /?L21
	EQUAL? PLAYER,WINNER \?L21
	CRLF
?L21:	SET 'P-CONT,0
	JUMP ?L24
?L20:	SET 'WINNER,PLAYER
	SET 'QUOTE-FLAG,0
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L25
	LOC WINNER >HERE
?L25:	CALL LIT?,HERE >LIT
	ZERO? VERBOSITY /?L28
	CRLF
?L28:	PRINTI ">"
	READ P-INBUF,P-LEXV
?L24:	GETB P-LEXV,P-LEXWORDS >P-LEN
	ZERO? P-LEN \?L31
	CALL BEG-PARDON
	RFALSE
?L31:	GET P-LEXV,PTR >WRD
	EQUAL? WRD,W?OOPS,W?O \?L34
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA \?L36
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L36:	GRTR? P-LEN,1 /?L39
	PRINTI "I can't help your clumsiness."
	CRLF
	RFALSE
?L39:	GET OOPS-TABLE,O-PTR >STACK
	ZERO? STACK /?L41
	GRTR? P-LEN,2 \?L44
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$QUOTE \?L42
	PRINTI "Sorry, you can't correct mistakes in quoted text."
	CRLF
	RFALSE
?L42:	GRTR? P-LEN,2 \?L44
	PRINTI "Warning: only the first word after OOPS is used."
	CRLF
?L44:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	GET OOPS-TABLE,O-PTR >STACK
	PUT AGAIN-LEXV,STACK,STACK
	SET 'WINNER,OWINNER
	GET OOPS-TABLE,O-PTR >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,3 >STACK
	MUL PTR,P-LEXELEN >STACK
	ADD STACK,7 >STACK
	GETB P-LEXV,STACK >STACK
	MUL PTR,P-LEXELEN >STACK
	ADD STACK,6 >STACK
	GETB P-LEXV,STACK >STACK
	CALL INBUF-ADD,STACK,STACK,STACK
	CALL STUFF,AGAIN-LEXV,P-LEXV
	GETB P-LEXV,P-LEXWORDS >P-LEN
	GET OOPS-TABLE,O-START >PTR
	CALL INBUF-STUFF,OOPS-INBUF,P-INBUF
	JUMP ?L47
?L41:	PUT OOPS-TABLE,O-END,0
	PRINTI "There was no word to replace!"
	CRLF
	RFALSE
?L34:	EQUAL? WRD,W?AGAIN,W?G /?L48
	SET 'P-NUMBER,0
?L48:	PUT OOPS-TABLE,O-END,0
?L47:	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?AGAIN,W?G \?L51
	GETB OOPS-INBUF,1 >STACK
	ZERO? STACK \?L53
	CALL BEG-PARDON
	RFALSE
?L53:	ZERO? P-OFLAG /?L55
	PRINTI "It's difficult to repeat fragments."
	CRLF
	RFALSE
?L55:	ZERO? P-WON \?L56
	PRINTI "That would just repeat a mistake."
	CRLF
	RFALSE
?L56:	GRTR? P-LEN,1 \?L57
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA,W?THEN /?L60
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?AND \?L58
?L60:	ADD PTR,4 >PTR
	GETB P-LEXV,P-LEXWORDS >STACK
	SUB STACK,2 >STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
	JUMP ?L62
?L58:	PRINTI "I couldn't understand that sentence."
	CRLF
	RFALSE
?L57:	ADD PTR,P-LEXELEN >PTR
	GETB P-LEXV,P-LEXWORDS >STACK
	DEC 'STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
?L62:	GETB P-LEXV,P-LEXWORDS >STACK
	GRTR? STACK,0 \?L63
	CALL STUFF,P-LEXV,RESERVE-LEXV
	SET 'RESERVE-PTR,PTR
	JUMP ?L65
?L63:	SET 'RESERVE-PTR,0
?L65:	SET 'WINNER,OWINNER
	SET 'P-MERGED,OMERGED
	CALL INBUF-STUFF,OOPS-INBUF,P-INBUF
	CALL STUFF,AGAIN-LEXV,P-LEXV
	SET 'CNT,-1
	SET 'DIR,AGAIN-DIR
?L66:	IGRTR? 'CNT,P-ITBLLEN /?L73
	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L66
?L51:	CALL STUFF,P-LEXV,AGAIN-LEXV
	CALL INBUF-STUFF,P-INBUF,OOPS-INBUF
	PUT OOPS-TABLE,O-START,PTR
	MUL 4,P-LEN >STACK
	PUT OOPS-TABLE,O-LENGTH,STACK
	GETB P-LEXV,P-LEXWORDS >STACK
	MUL P-LEXELEN,STACK >STACK
	ADD PTR,STACK >STACK
	MUL 2,STACK >LEN
	SUB LEN,2 >STACK
	GETB P-LEXV,STACK >STACK
	SUB LEN,1 >STACK
	GETB P-LEXV,STACK >STACK
	ADD STACK,STACK >STACK
	PUT OOPS-TABLE,O-END,STACK
	SET 'RESERVE-PTR,0
	SET 'LEN,P-LEN
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
?L72:	DLESS? 'P-LEN,0 \?L74
	SET 'QUOTE-FLAG,0
	JUMP ?L73
?L74:	CALL KNOWN-WORD?,PTR,VERB >WRD
	ZERO? WRD /?L76
	ZERO? P-LEN \?L77
	SET 'NW,0
	JUMP ?L79
?L77:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L79:	EQUAL? WRD,W?TO \?L80
	EQUAL? VERB,ACT?TELL,ACT?ASK \?L80
	CALL WT?,NW,PS?VERB,P1?VERB >STACK
	ZERO? STACK /?L80
	PUT P-ITBL,P-VERB,ACT?TELL
	SET 'WRD,W?$QUOTE
	JUMP ?L85
?L80:	EQUAL? WRD,W?THEN \?L85
	GRTR? P-LEN,0 \?L85
	ZERO? VERB \?L85
	ZERO? QUOTE-FLAG \?L85
	EQUAL? LW,0,W?$PERIOD \?L83
	SET 'WRD,W?THE
	JUMP ?L85
?L83:	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WRD,W?$QUOTE
?L85:	EQUAL? WRD,W?THEN,W?$PERIOD,W?$QUOTE \?L87
	EQUAL? WRD,W?$QUOTE \?L95
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?$QUOTE \?L91
	EQUAL? VERB,ACT?TELL,ACT?SAY \?L93
	EQUAL? WINNER,PLAYER /?L91
?L93:	CALL YOU-CANT-X-THAT,STR?79
	RFALSE
?L91:	ZERO? QUOTE-FLAG /?L94
	SET 'QUOTE-FLAG,0
	JUMP ?L95
?L94:	SET 'QUOTE-FLAG,1
?L95:	ZERO? P-LEN /?L97
	ADD PTR,P-LEXELEN >P-CONT
?L97:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L73
?L87:	ZERO? P-OFLAG /?L100
	ZERO? VERB \?L100
	EQUAL? WRD,W?UP,W?DOWN \?L100
	GET P-OTBL,P-VERB >STACK
	EQUAL? STACK,ACT?PUSH \?L100
	GET P-OTBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?CALL,W?BUTTON,W?ARROW \?L100
	EQUAL? WRD,W?UP \?L102
	SET 'WRD,W?UP-ARROW
	JUMP ?L104
?L102:	EQUAL? WRD,W?DOWN \?L104
	SET 'WRD,W?DOWN-ARROW
?L104:	CALL CHANGE-LEXV,PTR,WRD
?L100:	CALL WT?,WRD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L107
	EQUAL? VERB,0,ACT?WALK \?L107
	EQUAL? LEN,1 /?L109
	EQUAL? LEN,2 \?L110
	EQUAL? VERB,ACT?WALK /?L109
?L110:	EQUAL? NW,W?THEN,W?$PERIOD,W?$QUOTE \?L111
	LESS? LEN,2 \?L109
?L111:	ZERO? QUOTE-FLAG /?L112
	EQUAL? LEN,2 \?L112
	EQUAL? NW,W?$QUOTE /?L109
?L112:	GRTR? LEN,2 \?L107
	EQUAL? NW,W?$COMMA,W?AND \?L107
?L109:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L113
	ADD PTR,P-LEXELEN >STACK
	CALL CHANGE-LEXV,STACK,W?THEN
?L113:	GRTR? LEN,2 /?L148
	SET 'QUOTE-FLAG,0
	JUMP ?L73
?L107:	CALL WT?,WRD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L119
	ZERO? VERB \?L119
	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WRD
	MUL PTR,2 >STACK
	ADD STACK,2 >CNT
	GETB P-LEXV,CNT >STACK
	PUTB P-VTBL,2,STACK
	ADD CNT,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L148
?L119:	CALL WT?,WRD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L121
	EQUAL? WRD,W?ALL,W?ONE,W?BOTH /?L121
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L121
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L120
?L121:	GRTR? P-LEN,1 \?L122
	EQUAL? NW,W?OF \?L122
	ZERO? VAL \?L158
	EQUAL? WRD,W?ALL,W?ONE,W?A /?L122
	EQUAL? WRD,W?BOTH /?L122
	SET 'OF-FLAG,1
	JUMP ?L148
?L122:	ZERO? VAL /?L124
?L158:	ZERO? P-LEN /?L125
	EQUAL? NW,W?THEN,W?$PERIOD \?L124
?L125:	SET 'P-END-ON-PREP,1
	LESS? P-NCN,2 \?L148
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WRD
	JUMP ?L148
?L124:	EQUAL? P-NCN,2 \?L129
	PRINTI "There were too many nouns in that sentence."
	CRLF
	RFALSE
?L129:	ZERO? VAL /?L131
	EQUAL? WRD,W?UP,W?DOWN,W?U /?L133
	EQUAL? WRD,W?D \?L131
?L133:	EQUAL? NW,W?BUTTON,W?ARROW \?L131
	SET 'VAL,0
?L131:	INC 'P-NCN
	SET 'P-ACT,VERB
	CALL CLAUSE,PTR,VAL,WRD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L148
	SET 'QUOTE-FLAG,0
	JUMP ?L73
?L120:	EQUAL? WRD,W?OF \?L140
	ZERO? OF-FLAG /?L143
	EQUAL? NW,W?$PERIOD,W?THEN \?L141
?L143:	CALL CANT-USE,PTR
	RFALSE
?L141:	SET 'OF-FLAG,0
	JUMP ?L148
?L140:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L148
	EQUAL? VERB,ACT?TELL \?L146
	CALL WT?,WRD,PS?VERB,P1?VERB >STACK
	ZERO? STACK /?L146
	EQUAL? WINNER,PLAYER \?L146
	PRINTI "Please consult your manual for the correct way to talk to characters."
	CRLF
	RFALSE
?L146:	CALL CANT-USE,PTR
	RFALSE
?L76:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L148:	SET 'LW,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L72
?L73:	PUT OOPS-TABLE,O-PTR,0
	ZERO? DIR /?L149
	SET 'PRSA,V?WALK
	SET 'PRSO,DIR
	SET 'P-OFLAG,0
	SET 'P-WALK-DIR,DIR
	SET 'AGAIN-DIR,DIR
	RETURN AGAIN-DIR
?L149:	ZERO? P-OFLAG /?L152
	CALL ORPHAN-MERGE
?L152:	SET 'P-WALK-DIR,0
	SET 'AGAIN-DIR,0
	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT BEG-PARDON
	PRINTR "I beg your pardon?"

	.FUNCT KNOWN-WORD?,PTR,VERB=0,WRD=0,NWRD=0
	GET P-LEXV,PTR >WRD
	ZERO? WRD /?L1
	EQUAL? WRD,W?EVERYTHING,W?BOTH \?L3
	SET 'NWRD,W?ALL
	JUMP ?L10
?L3:	EQUAL? WRD,W?A \?L10
	SET 'NWRD,W?ONE
	JUMP ?L10
?L1:	CALL INPUT-EQUAL?,PTR,LOGIN-ID,W?XYZZY >WRD
	ZERO? WRD \?L8
	CALL INPUT-EQUAL?,PTR,PASSWORD-STRING,W?PLUGH >WRD
	ZERO? WRD /?L7
?L8:	SET 'P-NAME,WRD
	SET 'NWRD,W?INTNAME
	JUMP ?L10
?L7:	CALL NUMBER?,PTR >NWRD
	ZERO? NWRD \?L15
	EQUAL? VERB,ACT?TYPE,ACT?LOGIN,ACT?PASSWORD \?L10
	SET 'P-NAME,WRD
	SET 'NWRD,W?INTNAME
?L10:	ZERO? NWRD /?L12
?L15:	CALL CHANGE-LEXV,PTR,NWRD
	SET 'WRD,NWRD
?L12:	RETURN WRD

	.FUNCT INPUT-EQUAL?,PTR,TBL,WRD,LEX,LPTR,CNT=0,CMAX
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >LEX
	GETB TBL,0 >CMAX
	GETB LEX,2 >STACK
	EQUAL? CMAX,STACK \FALSE
	GETB LEX,3 >LPTR
?L3:	IGRTR? 'CNT,CMAX \?L5
	RETURN WRD
?L5:	GETB TBL,CNT >STACK
	GETB P-INBUF,LPTR >STACK
	EQUAL? STACK,STACK \FALSE
	INC 'LPTR
	JUMP ?L3

	.FUNCT CHANGE-LEXV,PTR,WRD
	PUT P-LEXV,PTR,WRD
	PUT AGAIN-LEXV,PTR,WRD
	RTRUE

	.FUNCT STUFF,SRC,DEST,MAX=29,PTR=P-LEXSTART,CTR=1,BPTR
	GETB SRC,0 >STACK
	PUTB DEST,0,STACK
	GETB SRC,1 >STACK
	PUTB DEST,1,STACK
?L1:	GET SRC,PTR >STACK
	PUT DEST,PTR,STACK
	MUL PTR,2 >STACK
	ADD STACK,2 >BPTR
	GETB SRC,BPTR >STACK
	PUTB DEST,BPTR,STACK
	MUL PTR,2 >STACK
	ADD STACK,3 >BPTR
	GETB SRC,BPTR >STACK
	PUTB DEST,BPTR,STACK
	ADD PTR,P-LEXELEN >PTR
	IGRTR? 'CTR,MAX \?L1
	RTRUE

	.FUNCT INBUF-STUFF,SRC,DEST,CNT
	GETB SRC,0 >STACK
	SUB STACK,1 >CNT
?L1:	GETB SRC,CNT >STACK
	PUTB DEST,CNT,STACK
	DLESS? 'CNT,0 \?L1
	RTRUE

	.FUNCT INBUF-ADD,LEN,BEG,SLOT,DBEG,CTR=0,TMP,?TMP
	GET OOPS-TABLE,O-END >TMP
	ZERO? TMP /?L1
	SET 'DBEG,TMP
	JUMP ?L3
?L1:	GET OOPS-TABLE,O-LENGTH >TMP
	GETB AGAIN-LEXV,TMP >?TMP
	ADD TMP,1 >STACK
	GETB AGAIN-LEXV,STACK >STACK
	ADD ?TMP,STACK >DBEG
?L3:	ADD DBEG,LEN >STACK
	PUT OOPS-TABLE,O-END,STACK
?L4:	ADD BEG,CTR >STACK
	GETB P-INBUF,STACK >STACK
	ADD DBEG,CTR >STACK
	PUTB OOPS-INBUF,STACK,STACK
	INC 'CTR
	EQUAL? CTR,LEN \?L4
	PUTB AGAIN-LEXV,SLOT,DBEG
	SUB SLOT,1 >STACK
	PUTB AGAIN-LEXV,STACK,LEN
	RTRUE

	.FUNCT WT?,PTR,BIT,B1=5,OFFS=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \?L1
	GRTR? B1,4 /TRUE
	EQUAL? BIT,PS?OBJECT /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L7
	INC 'OFFS
?L7:	GETB PTR,OFFS >STACK
	RSTACK
?L1:	EQUAL? BIT,PS?ADJECTIVE \FALSE
	EQUAL? PTR,W?UP,W?U \?L11
	CALL WT?,W?UP-ARROW,PS?ADJECTIVE,B1 >STACK
	RSTACK
?L11:	EQUAL? PTR,W?DOWN,W?D \FALSE
	CALL WT?,W?DOWN-ARROW,PS?ADJECTIVE,B1 >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WRD,OFF,NUM,ANDFLG=0,1ST?=1,NW,LW=0
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L1
	ADD P-PREP1,OFF >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'P-LEN
?L3:	ZERO? P-LEN \?L4
	DEC 'P-NCN
	RETURN -1
?L4:	ADD P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L7
	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
?L7:	DLESS? 'P-LEN,0 \?L12
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L12:	CALL KNOWN-WORD?,PTR >WRD
	ZERO? WRD /?L15
	ZERO? P-LEN \?L17
	SET 'NW,0
	JUMP ?L19
?L17:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >NW
?L19:	EQUAL? WRD,W?$QUOTE \?L20
	EQUAL? P-ACT,ACT?TELL,ACT?SAY \FALSE
?L20:	EQUAL? WRD,W?AND,W?$COMMA \?L24
	SET 'ANDFLG,WRD
	JUMP ?L43
?L24:	EQUAL? WRD,W?ALL,W?ONE,W?BOTH \?L25
	EQUAL? NW,W?OF \?L43
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L43
?L25:	EQUAL? WRD,W?THEN,W?$PERIOD /?L30
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L29
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK /?L29
	ZERO? 1ST? \?L29
?L30:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L29:	EQUAL? ANDFLG,W?$COMMA \?L31
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK \?L31
	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	CALL CHANGE-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L43
?L31:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L32
	GRTR? P-LEN,0 \?L33
	EQUAL? NW,W?OF \?L33
	EQUAL? WRD,W?ALL,W?ONE \?L43
?L33:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L35
	ZERO? NW /?L35
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L43
	CALL WT?,NW,PS?ADJECTIVE >STACK
	ZERO? STACK \?L43
?L35:	ZERO? ANDFLG \?L37
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L37
	EQUAL? NW,W?$COMMA /?L37
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L37:	SET 'ANDFLG,0
	JUMP ?L43
?L32:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L43
	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L43
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK \?L43
	CALL CANT-USE,PTR
	RFALSE
?L15:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L43:	SET 'LW,WRD
	SET '1ST?,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0
	SET 'P-TIME?,0
	SET 'P-MINUTES,0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L1:	DLESS? 'CNT,0 /?L2
	GETB P-INBUF,BPTR >CHR
	EQUAL? CHR,58 \?L6
	SET 'P-TIME?,1
	MUL SUM,60 >P-MINUTES
	SET 'SUM,0
	JUMP ?L12
?L6:	LESS? CHR,58 \FALSE
	GRTR? CHR,47 \FALSE
	GRTR? SUM,6553 \?L9
	SET 'SUM,10000
	JUMP ?L2
?L9:	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
?L12:	INC 'BPTR
	JUMP ?L1
?L2:	SET 'P-NUMBER,SUM
	ZERO? P-TIME? /?L13
	ADD P-MINUTES,P-NUMBER >P-NUMBER
?L13:	RETURN W?INTNUM

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,ADJB=0,VRB=0,NOUN=0,ADJE,WRD,?TMP
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >WRD
	ZERO? WRD /?L9
	CALL WT?,WRD,PS?VERB,P1?VERB >?TMP
	GET P-OTBL,P-VERB >STACK
	EQUAL? ?TMP,STACK \?L3
	SET 'VRB,1
?L3:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK /?L6
	SET 'ADJ,1
?L6:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L9
	SET 'NOUN,1
?L9:	ZERO? VRB \?L13
	ZERO? ADJ \?L13
	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L13
	ZERO? P-NCN \?L13
	PUT P-ITBL,P-VERB,0
	PUT P-ITBL,P-VERBN,0
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
	SET 'P-NCN,1
?L13:	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L16
	ZERO? ADJ \?L16
	ZERO? VRB \?L16
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L16:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L19
	GET P-OTBL,P-PREP1 >STACK
	GET P-ITBL,P-PREP1 >STACK
	EQUAL? STACK,0,STACK \FALSE
	ZERO? ADJ /?L27
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L24
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L24:	ZERO? P-NCN \?L27
	SET 'P-NCN,1
?L27:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L51
?L19:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L32
	GET P-OTBL,P-PREP2 >STACK
	GET P-ITBL,P-PREP1 >STACK
	EQUAL? STACK,0,STACK \FALSE
	ZERO? ADJ \?L37
	ZERO? P-NCN \?L38
	ZERO? NOUN /?L38
?L37:	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L38
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L38:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L51
?L32:	ZERO? P-ACLAUSE /?L51
	EQUAL? P-NCN,1 /?L44
	ZERO? ADJ \?L44
	SET 'P-ACLAUSE,0
	RFALSE
?L44:	GET P-ITBL,P-NC1 >BEG
	ZERO? ADJ /?L47
	ADD P-LEXV,2 >BEG
	PUT P-ITBL,P-NC1,BEG
	SET 'ADJ,0
?L47:	GET P-ITBL,P-NC1L >END
?L50:	EQUAL? BEG,END \?L56
	ZERO? ADJB /?L54
	CALL CLAUSE-WIN,ADJB,ADJE
	JUMP ?L51
?L54:	SET 'P-ACLAUSE,0
	RFALSE
?L56:	GET BEG,0 >WRD
	EQUAL? WRD,W?ALL,W?ONE /?L60
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE \?L58
?L60:	ZERO? ADJB \?L61
	SET 'ADJB,BEG
?L61:	ADD BEG,P-WORDLEN >ADJE
	JUMP ?L65
?L58:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT \?L65
	ADD BEG,P-WORDLEN >STACK
	EQUAL? STACK,END \?L65
	ZERO? P-ANAM /?L65
	EQUAL? WRD,P-ANAM /?L65
	SET 'P-ANAM,0
	GET P-ITBL,P-NC1 >ADJB
	SET 'ADJE,END
?L65:	ADD BEG,P-WORDLEN >BEG
	ZERO? END \?L50
	SET 'END,BEG
	SET 'P-NCN,1
	SUB BEG,4 >STACK
	PUT P-ITBL,P-NC1,STACK
	PUT P-ITBL,P-NC1L,BEG
	JUMP ?L50
?L51:	GET P-OVTBL,0 >STACK
	PUT P-VTBL,0,STACK
	GETB P-OVTBL,2 >STACK
	PUTB P-VTBL,2,STACK
	GETB P-OVTBL,3 >STACK
	PUTB P-VTBL,3,STACK
	PUT P-OTBL,P-VERBN,P-VTBL
	PUTB P-VTBL,2,0
?L73:	IGRTR? 'CNT,P-ITBLLEN \?L75
	SET 'P-MERGED,1
	RTRUE
?L75:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L73

	.FUNCT CLAUSE-WIN,ADJB=0,ADJE=0
	ZERO? ADJB /?L1
	GET P-OTBL,P-VERB >STACK
	PUT P-ITBL,P-VERB,STACK
?L1:	PUT P-CCTBL,CC-BEG,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-END,STACK
	PUT P-CCTBL,CC-IBEG,ADJB
	PUT P-CCTBL,CC-IEND,ADJE
	EQUAL? P-ACLAUSE,P-NC1 \?L4
	PUT P-CCTBL,CC-CLAUSE,P-OCL1
	JUMP ?L6
?L4:	PUT P-CCTBL,CC-CLAUSE,P-OCL2
?L6:	CALL CLAUSE-COPY,P-OTBL,P-OTBL
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L7
	SET 'P-NCN,2
?L7:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,?TMP
	PUT OOPS-TABLE,O-PTR,PTR
	PRINTI "I don't know the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI "."""
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT CANT-USE,PTR,BUF,?TMP
	PRINTI "You used the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI """ in a way that I don't understand."
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB,TMP
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	PRINTI "There was no verb in that sentence!"
	CRLF
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L4:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	GRTR? P-NCN,NUM /?L13
	LESS? NUM,1 /?L8
	ZERO? P-NCN \?L8
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L9
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L8
?L9:	SET 'DRIVE1,SYN
	JUMP ?L13
?L8:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L13
	EQUAL? NUM,2 \?L11
	EQUAL? P-NCN,1 \?L11
	SET 'DRIVE2,SYN
	JUMP ?L13
?L11:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L13
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L13:	DLESS? 'LEN,1 \?L16
	ZERO? DRIVE1 \?L39
	ZERO? DRIVE2 \?L5
	PRINT NOT-RECOGNIZED
	CRLF
	RFALSE
?L16:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L4
?L5:	ZERO? DRIVE1 /?L23
?L39:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L23
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L23:	ZERO? DRIVE2 /?L25
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L25
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L25:	EQUAL? VERB,ACT?FIND \?L26
	PRINTI "I can't answer that question."
	CRLF
	RFALSE
?L26:	EQUAL? WINNER,PLAYER /?L27
	PRINTI "I don't understand. What are you referring to?"
	CRLF
	RFALSE
?L27:	CALL ORPHAN,DRIVE1,DRIVE2
	PRINT WHAT-DO-YOU-WANT-TO
	GET P-OTBL,P-VERBN >TMP
	ZERO? TMP \?L29
	PRINTI "tell"
	JUMP ?L32
?L29:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L31
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L32
?L31:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L32:	ZERO? DRIVE2 /?L33
	PRINTI " "
	CALL THING-PRINT,1,1
?L33:	SET 'P-OFLAG,1
	ZERO? DRIVE1 /?L36
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L38
?L36:	GETB DRIVE2,P-SPREP2 >STACK
?L38:	CALL PREP-PRINT,STACK
	PRINTI "?"
	CRLF
	RFALSE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	ZERO? P-MERGED \?L1
	PUT P-OCL1,P-MATCHLEN,0
	PUT P-OCL2,P-MATCHLEN,0
?L1:	GET P-VTBL,0 >STACK
	PUT P-OVTBL,0,STACK
	GETB P-VTBL,2 >STACK
	PUTB P-OVTBL,2,STACK
	GETB P-VTBL,3 >STACK
	PUTB P-OVTBL,3,STACK
?L4:	IGRTR? 'CNT,P-ITBLLEN /?L5
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L4
?L5:	EQUAL? P-NCN,2 \?L9
	PUT P-CCTBL,CC-BEG,P-NC2
	PUT P-CCTBL,CC-END,P-NC2L
	PUT P-CCTBL,CC-CLAUSE,P-OCL2
	PUT P-CCTBL,CC-IBEG,0
	PUT P-CCTBL,CC-IEND,0
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L9:	LESS? P-NCN,1 /?L12
	PUT P-CCTBL,CC-BEG,P-NC1
	PUT P-CCTBL,CC-END,P-NC1L
	PUT P-CCTBL,CC-CLAUSE,P-OCL1
	PUT P-CCTBL,CC-IBEG,0
	PUT P-CCTBL,CC-IEND,0
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L12:	ZERO? D1 /?L15
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L15:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT THING-PRINT,PRSO?,THE?=0,BEG,END
	ZERO? PRSO? /?L1
	GET P-ITBL,P-NC1 >BEG
	GET P-ITBL,P-NC1L >END
	JUMP ?L3
?L1:	GET P-ITBL,P-NC2 >BEG
	GET P-ITBL,P-NC2L >END
?L3:	CALL BUFFER-PRINT,BEG,END,THE? >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=1,WRD,1ST?=1,PN=0,Q?=0
?L1:	EQUAL? BEG,END /TRUE
	GET BEG,0 >WRD
	EQUAL? WRD,W?$COMMA \?L6
	PRINTI ", "
	JUMP ?L9
?L6:	ZERO? NOSP /?L8
	SET 'NOSP,0
	JUMP ?L9
?L8:	PRINTI " "
?L9:	EQUAL? WRD,W?$PERIOD,W?$COMMA \?L10
	SET 'NOSP,1
	JUMP ?L14
?L10:	EQUAL? WRD,W?ME \?L12
	PRINTD ME
	SET 'PN,1
	JUMP ?L14
?L12:	EQUAL? WRD,W?INTNUM \?L13
	PRINTN P-NUMBER
	SET 'PN,1
	JUMP ?L14
?L13:	ZERO? 1ST? /?L15
	ZERO? PN \?L15
	ZERO? CP /?L15
	PRINTI "the "
?L15:	ZERO? P-OFLAG \?L20
	ZERO? P-MERGED /?L18
?L20:	PRINTB WRD
	JUMP ?L23
?L18:	EQUAL? WRD,W?IT \?L21
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L21
	PRINTD P-IT-OBJECT
	JUMP ?L23
?L21:	EQUAL? WRD,W?HIM \?L22
	CALL ACCESSIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK /?L22
	PRINTD P-HIM-OBJECT
	JUMP ?L23
?L22:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L23:	SET '1ST?,0
?L14:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT PREP-PRINT,PREP,WRD
	ZERO? PREP /FALSE
	PRINTI " "
	EQUAL? PREP,PR?THROUGH \?L3
	PRINTI "through"
	RTRUE
?L3:	CALL PREP-TO-WORD,PREP >WRD
	PRINTB WRD
	RTRUE

	.FUNCT CLAUSE-COPY,SRC,DEST,IBEG=0,IEND,OCL,BEG,END,BB,EE,OBEG,CNT,B,E
	GET P-CCTBL,CC-BEG >BB
	GET P-CCTBL,CC-END >EE
	GET P-CCTBL,CC-CLAUSE >OCL
	GET P-CCTBL,CC-IBEG >IBEG
	GET P-CCTBL,CC-IEND >IEND
	GET SRC,BB >BEG
	GET SRC,EE >END
	GET OCL,P-MATCHLEN >OBEG
?L1:	EQUAL? BEG,END \?L3
	ZERO? IBEG /?L2
	ZERO? P-ANAM \?L2
	CALL CLAUSE-SUBSTRUC,IBEG,IEND
	JUMP ?L2
?L3:	ZERO? IBEG /?L9
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L9
	CALL CLAUSE-SUBSTRUC,IBEG,IEND
?L9:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1
?L2:	GRTR? OBEG,0 \?L12
	GET OCL,P-MATCHLEN >STACK
	SUB STACK,OBEG >CNT
	GRTR? CNT,0 \?L12
	PUT OCL,P-MATCHLEN,0
	INC 'OBEG
?L14:	GET OCL,OBEG >STACK
	CALL CLAUSE-ADD,STACK,1
	SUB CNT,2 >CNT
	ZERO? CNT /?L15
	ADD OBEG,2 >OBEG
	JUMP ?L14
?L15:	SET 'OBEG,0
?L12:	MUL OBEG,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD OCL,STACK >STACK
	PUT DEST,BB,STACK
	GET OCL,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD OCL,STACK >STACK
	PUT DEST,EE,STACK
	RTRUE

	.FUNCT CLAUSE-SUBSTRUC,B,E
?L1:	EQUAL? B,E /TRUE
	GET B,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD B,P-WORDLEN >B
	JUMP ?L1

	.FUNCT CLAUSE-ADD,WRD,CHECK?=0,OCL,PTR
	GET P-CCTBL,CC-CLAUSE >OCL
	GET OCL,P-MATCHLEN >PTR
	ZERO? CHECK? /?L1
	ZERO? PTR /?L1
	CALL ZMEMQ,WRD,OCL >STACK
	ZERO? STACK \FALSE
?L1:	ADD PTR,2 >PTR
	SUB PTR,1 >STACK
	PUT OCL,STACK,WRD
	PUT OCL,PTR,0
	PUT OCL,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-TO-WORD,PREP,CNT=2,SIZE
	GET PREPOSITIONS,0 >SIZE
?L1:	DLESS? 'SIZE,0 /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L5
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK
?L5:	ADD CNT,2 >CNT
	JUMP ?L1

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ
	EQUAL? GBIT,RLANDBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	PRINTI "("
	ZERO? PREP /?L8
	ZERO? P-END-ON-PREP \?L8
	CALL PREP-TO-WORD,PREP >PREP
	PRINTB PREP
	EQUAL? PREP,W?OUT \?L10
	PRINTI " of"
?L10:	PRINTI " "
	EQUAL? OBJ,HANDS \?L13
	CALL DPRINT,OBJ
	JUMP ?L15
?L13:	CALL THE-PRINT,OBJ
?L15:	PRINTI ")"
	CRLF
	RETURN OBJ
?L8:	CALL DPRINT,OBJ
	PRINTI ")"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,OPTR,IPTR,L
	PUT P-BUTS,P-MATCHLEN,0
	GET P-ITBL,P-NC2 >IPTR
	ZERO? IPTR /?L3
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,IPTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
?L3:	GET P-ITBL,P-NC1 >OPTR
	ZERO? OPTR /?L8
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,OPTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
?L8:	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSO,P-MATCHLEN >L
	ZERO? OPTR /?L13
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L13:	ZERO? IPTR /TRUE
	ZERO? OPTR /?L18
	GET P-PRSO,P-MATCHLEN >STACK
	EQUAL? L,STACK \TRUE
?L18:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,BUT=0,LEN,WV,WRD,NW,WAS-ALL=0
	SET 'P-AND,0
	EQUAL? P-GETFLAGS,P-ALL \?L1
	SET 'WAS-ALL,1
?L1:	SET 'P-GETFLAGS,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WRD
?L4:	EQUAL? PTR,EPTR \?L6
?L57:	ZERO? BUT /?L9
	PUSH BUT
	JUMP ?L8
?L9:	PUSH TBL
?L8:	CALL GET-OBJECT,STACK >WV
	ZERO? WAS-ALL /?L10
	SET 'P-GETFLAGS,P-ALL
?L10:	RETURN WV
?L6:	ADD PTR,P-WORDLEN >STACK
	EQUAL? EPTR,STACK \?L14
	SET 'NW,0
	JUMP ?L16
?L14:	GET PTR,P-LEXELEN >NW
?L16:	EQUAL? WRD,W?ALL,W?BOTH \?L17
	SET 'P-GETFLAGS,P-ALL
	EQUAL? NW,W?OF \?L52
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L52
?L17:	EQUAL? WRD,W?BUT,W?EXCEPT \?L22
	ZERO? BUT /?L26
	PUSH BUT
	JUMP ?L25
?L26:	PUSH TBL
?L25:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,P-BUTS
	PUT BUT,P-MATCHLEN,0
	JUMP ?L52
?L22:	EQUAL? WRD,W?A,W?ONE \?L27
	GET P-ADJT,0 >STACK
	ZERO? STACK \?L28
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L52
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L52
?L28:	SET 'P-NAM,P-ONEOBJ
	ZERO? BUT /?L37
	PUSH BUT
	JUMP ?L36
?L37:	PUSH TBL
?L36:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L52
?L27:	EQUAL? WRD,W?AND,W?$COMMA \?L40
	EQUAL? NW,W?AND,W?$COMMA /?L40
	SET 'P-AND,1
	ZERO? BUT /?L44
	PUSH BUT
	JUMP ?L43
?L44:	PUSH TBL
?L43:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L52
?L40:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L52
	EQUAL? WRD,W?AND,W?$COMMA /?L52
	EQUAL? WRD,W?OF \?L47
	ZERO? P-GETFLAGS \?L52
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L52
?L47:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L51
	CALL NEW-ADJ,WV,WRD
	JUMP ?L52
?L51:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L52
	SET 'P-NAM,WRD
	SET 'P-ONEOBJ,WRD
?L52:	EQUAL? PTR,EPTR /?L57
	ADD PTR,P-WORDLEN >PTR
	SET 'WRD,NW
	JUMP ?L4

	.FUNCT NEW-ADJ,WV=0,WRD=0,N
	ZERO? WV \?L1
	SET 'P-NAM,0
	PUT P-ADJT,0,0
	PUT P-ADJNT,0,0
	RTRUE
?L1:	GET P-ADJT,0 >N
	LESS? N,4 \?L4
	INC 'N
?L4:	PUT P-ADJT,0,N
	PUT P-ADJT,N,WV
	PUT P-ADJNT,0,N
	PUT P-ADJNT,N,WRD
	RTRUE

	.FUNCT COPY-ADJ,SRC,DST,N
	GET SRC,0 >N
?L1:	GET SRC,N >STACK
	PUT DST,N,STACK
	DLESS? 'N,0 \?L1
	RTRUE

	.FUNCT SEARCH-CONTENTS?,OBJ
	FSET? OBJ,INVISIBLE /FALSE
	FSET? OBJ,SEARCHBIT \?L3
	FSET? OBJ,OPENBIT /TRUE
	FSET? OBJ,TRANSBIT /TRUE
?L3:	FSET? OBJ,SURFACEBIT /TRUE
	RFALSE

	.FUNCT GET-OBJECT,TBL,VRB=1,GEN,BITS,LEN,XBITS,TLEN,GCHECK=0,OLEN=0,OBJ
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	ZERO? P-NAM \?L11
	GET P-ADJNT,0 >LEN
	ZERO? LEN /?L8
	GET P-ADJNT,LEN >STACK
	CALL WT?,STACK,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L6
	GET P-ADJNT,0 >STACK
	GET P-ADJNT,STACK >P-NAM
	SUB LEN,1 >STACK
	PUT P-ADJT,0,STACK
	SUB LEN,1 >STACK
	PUT P-ADJNT,0,STACK
	JUMP ?L8
?L6:	EQUAL? LEN,1 \?L8
	GET P-ADJNT,1 >STACK
	CALL WT?,STACK,PS?DIRECTION,P1?DIRECTION >BITS
	ZERO? BITS /?L8
	PUT P-ADJT,0,0
	PUT P-ADJNT,0,0
	PUT TBL,P-MATCHLEN,1
	PUT TBL,1,INTDIR
	SET 'P-DIRECTION,BITS
	RTRUE
?L8:	ZERO? P-NAM \?L11
	GET P-ADJT,0 >STACK
	ZERO? STACK \?L11
	EQUAL? P-GETFLAGS,P-ALL /?L69
	ZERO? P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	PRINT NOUN-MISSING
	CRLF
	RFALSE
?L11:	EQUAL? P-GETFLAGS,P-ALL \?L19
?L69:	ZERO? P-SLOCBITS \?L17
?L19:	SET 'P-SLOCBITS,-1
?L17:	SET 'P-TABLE,TBL
?L21:	ZERO? GCHECK /?L23
	CALL GLOBAL-CHECK,TBL
	JUMP ?L25
?L23:	ZERO? LIT /?L28
	CALL DO-SL,HERE,SOG,SIR
	LOC PLAYER >STACK
	FSET? STACK,VEHBIT \?L28
	LOC PLAYER >STACK
	CALL SEARCH-CONTENTS?,STACK >STACK
	ZERO? STACK \?L28
	LOC PLAYER >STACK
	CALL DO-SL,STACK,SOG,SIR
?L28:	CALL DO-SL,PLAYER,SH,SC
?L25:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL /?L42
	BTST P-GETFLAGS,P-ONE \?L34
	ZERO? LEN /?L34
	EQUAL? LEN,1 /?L35
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "(How about "
	GET TBL,1 >STACK
	CALL THE-PRINT,STACK
	PRINTI "?)"
	CRLF
?L35:	PUT TBL,P-MATCHLEN,1
	JUMP ?L42
?L34:	GRTR? LEN,1 /?L39
	ZERO? LEN \?L67
	EQUAL? P-SLOCBITS,-1 /?L42
?L39:	EQUAL? P-SLOCBITS,-1 \?L40
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L21
?L40:	ZERO? LEN \?L43
	SET 'LEN,OLEN
?L43:	GRTR? LEN,1 \?L46
	CALL GENERIC?,TBL,LEN >GEN
	ZERO? GEN /?L46
	ADD TLEN,1 >LEN
	PUT TBL,P-MATCHLEN,LEN
	PUT TBL,LEN,GEN
	CALL SETUP-XADJ
	RTRUE
?L46:	ZERO? VRB /?L54
	EQUAL? WINNER,PLAYER /?L48
	CALL WHICH-PRINT,TLEN,LEN,TBL
	JUMP ?L54
?L48:	ZERO? VRB /?L54
	ZERO? P-NAM \?L50
	GET P-ADJT,0 >STACK
	ZERO? STACK /?L49
?L50:	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L51
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L53
?L51:	SET 'P-ACLAUSE,P-NC2
?L53:	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L54
?L49:	ZERO? VRB /?L54
	PRINT NOUN-MISSING
	CRLF
?L54:	CALL NEW-ADJ
	RFALSE
?L42:	ZERO? LEN \?L67
	ZERO? GCHECK /?L57
	ZERO? VRB /?L65
	SET 'P-SLOCBITS,XBITS
	ZERO? LIT \?L63
	EQUAL? TBL,P-PRSO \?L64
	EQUAL? PRSA,V?TELL,V?WHERE,V?WHAT /?L63
	EQUAL? PRSA,V?WHO,V?FOLLOW,V?WAIT-FOR /?L63
?L64:	EQUAL? TBL,P-PRSI \?L61
	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR,V?TELL-ABOUT \?L61
?L63:	CALL OBJ-FOUND,NOT-HERE-OBJECT,TBL
	CALL SETUP-XADJ
	RTRUE
?L61:	PRINT TOO-DARK
?L65:	CALL NEW-ADJ
	RFALSE
?L57:	ZERO? LEN \?L67
	SET 'GCHECK,1
	JUMP ?L21
?L67:	SET 'P-SLOCBITS,XBITS
	CALL NEW-ADJ
	RTRUE

	.FUNCT SETUP-XADJ
	SET 'P-XNAM,P-NAM
	CALL COPY-ADJ,P-ADJT,P-XADJT
	CALL COPY-ADJ,P-ADJNT,P-XADJNT
	CALL NEW-ADJ >STACK
	RSTACK

	.FUNCT MOBY-FIND,TBL,FOO,LEN,GEN
	SET 'P-MOBY-FLAG,1
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	SET 'P-NAM,P-XNAM
	CALL COPY-ADJ,P-XADJT,P-ADJT
	PUT TBL,P-MATCHLEN,0
	FIRST? ROOMS >FOO \?L3
?L4:	CALL SEARCH-LIST,FOO,TBL,P-SRCALL
	NEXT? FOO >FOO /?L4
?L3:	CALL DO-SL,LOCAL-GLOBALS,1,1
	CALL SEARCH-LIST,ROOMS,TBL,P-SRCTOP
	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L8
	GET TBL,1 >P-MOBY-FOUND
	JUMP ?L10
?L8:	GRTR? LEN,1 \?L10
	CALL GENERIC?,TBL,LEN >GEN
	ZERO? GEN /?L10
	SET 'LEN,1
	SET 'P-MOBY-FOUND,GEN
?L10:	SET 'P-MOBY-FLAG,0
	CALL NEW-ADJ
	RETURN LEN

	.FUNCT GENERIC?,TBL,LEN,GEN=0,G,N=0
	GRTR? LEN,1 \FALSE
?L3:	IGRTR? 'N,LEN \?L5
	CALL GEN >STACK
	RSTACK
?L5:	GET TBL,N >STACK
	GETP STACK,P?GENERIC >G
	ZERO? GEN \?L8
	SET 'GEN,G
	JUMP ?L3
?L8:	EQUAL? GEN,G /?L3
	RFALSE

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	ZERO? LEN \?L1
	PRINT REFERRING
	CRLF
	RTRUE
?L1:	SET 'RLEN,LEN
	EQUAL? WINNER,PLAYER /?L4
	PRINTI """I don't understand if you mean "
	JUMP ?L6
?L4:	PRINTI "Which "
	ZERO? P-OFLAG \?L9
	ZERO? P-MERGED \?L9
	ZERO? P-AND /?L7
?L9:	CALL PRINT-ADJT,P-ADJNT >STACK
	ZERO? STACK /?L10
	ZERO? P-NAM /?L17
	PRINTI " "
	PRINTB P-NAM
	JUMP ?L17
?L10:	ZERO? P-NAM /?L15
	PRINTB P-NAM
	JUMP ?L17
?L15:	PRINTB W?ONE
	JUMP ?L17
?L7:	EQUAL? TBL,P-PRSO /?L18
	PUSH 0
	JUMP ?L19
?L18:	PUSH 1
?L19:	CALL THING-PRINT,STACK
?L17:	PRINTI " do you mean, "
?L6:	INC 'TLEN
	GET TBL,TLEN >OBJ
	EQUAL? OBJ,FLOOR-BUTTON \?L22
	PRINTI "the 1 button, the 2 button, the 3 button"
	JUMP ?L24
?L22:	CALL THE-PRINT,OBJ
?L24:	EQUAL? LEN,2 \?L25
	EQUAL? RLEN,2 /?L27
	PRINTI ","
?L27:	PRINTI " or "
	JUMP ?L30
?L25:	GRTR? LEN,2 \?L30
	PRINTI ", "
?L30:	DLESS? 'LEN,1 \?L6
	EQUAL? WINNER,PLAYER /?L35
	PRINTR "."""
?L35:	PRINTR "?"

	.FUNCT PRINT-ADJT,TBL,N,CNT=0
	GET TBL,0 >N
	ZERO? N /FALSE
?L3:	GET TBL,N >STACK
	PRINTB STACK
	DEC 'N
	ZERO? N /TRUE
	PRINTI " "
	JUMP ?L3

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS,FOO,NOBJ
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	ZERO? OBJ /?L10
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L7
	CALL OBJ-FOUND,OBJ,TBL
?L7:	CALL SEARCH-CONTENTS?,OBJ >STACK
	ZERO? STACK /?L10
	FIRST? OBJ >NOBJ \?L10
	CALL SEARCH-LIST,OBJ,TBL,P-SRCALL
?L10:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETP HERE,P?THINGS >RMG
	ZERO? RMG /?L21
	GET RMG,0 >RMGL
	SET 'CNT,0
?L20:	ADD CNT,2 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L22
	GET P-ADJT,0 >STACK
	ZERO? STACK /?L24
	ADD CNT,1 >STACK
	GET RMG,STACK >STACK
	CALL ZMEMQ,STACK,P-ADJNT >STACK
	ZERO? STACK /?L22
?L24:	SET 'P-PNAM,P-NAM
	SET 'LAST-PSEUDO-LOC,HERE
	PUTP PSEUDO-OBJECT,P?ACTION,RANDOM-PSEUDO
	GETPT PSEUDO-OBJECT,P?ACTION >STACK
	SUB STACK,5 >FOO
	GET P-NAM,0 >STACK
	PUT FOO,0,STACK
	GET P-NAM,1 >STACK
	PUT FOO,1,STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L21
?L22:	ADD CNT,2 >CNT
	LESS? CNT,RMGL /?L20
?L21:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	RETURN P-SLOCBITS

	.FUNCT DO-SL,OBJ,BIT1,BIT2,BTS
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL,ROBJ
	FIRST? OBJ >OBJ \FALSE
?L3:	EQUAL? LVL,P-SRCBOT /?L5
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L5
	CALL THIS-IT?,OBJ,TBL >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	EQUAL? OBJ,ELEVATOR-DOOR \?L8
	CALL DOOR-AT-ELEVATOR >ROBJ
	JUMP ?L10
?L8:	SET 'ROBJ,OBJ
?L10:	FIRST? ROBJ >STACK \?L11
	CALL SEARCH-CONTENTS?,ROBJ >STACK
	ZERO? STACK /?L11
	EQUAL? LVL,P-SRCTOP \?L13
	ZERO? P-MOBY-FLAG /?L11
?L13:	ZERO? P-MOBY-FLAG \?L16
	FSET? ROBJ,SURFACEBIT /?L16
	FSET? ROBJ,SEARCHBIT \?L14
?L16:	PUSH P-SRCALL
	JUMP ?L17
?L14:	PUSH P-SRCTOP
?L17:	CALL SEARCH-LIST,ROBJ,TBL,STACK
?L11:	NEXT? OBJ >OBJ /?L3
	RTRUE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	EQUAL? TBL,P-PRSO \?L1
	PUT P-NAMW,0,P-NAM
	GET P-ADJNT,1 >STACK
	PUT P-ADJW,0,STACK
	JUMP ?L3
?L1:	EQUAL? TBL,P-PRSI \?L3
	PUT P-NAMW,1,P-NAM
	GET P-ADJNT,1 >STACK
	PUT P-ADJW,1,STACK
?L3:	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,IBITS,PTR,OBJ,TAKEN?1
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST IBITS,SHAVE /?L3
	BTST IBITS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L9
	ZERO? P-IT-OBJECT \?L11
	PRINT REFERRING
	CRLF
	JUMP ?L19
?L11:	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK \?L13
	PRINTI "I don't see "
	CALL THE-PRINT,P-IT-OBJECT
	PRINTI " here."
	CRLF
	RFALSE
?L13:	SET 'OBJ,P-IT-OBJECT
	JUMP ?L19
?L9:	EQUAL? OBJ,HIM \?L19
	ZERO? P-HIM-OBJECT \?L16
	PRINT REFERRING
	CRLF
	JUMP ?L19
?L16:	CALL ACCESSIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK \?L18
	PRINTI "I don't see "
	CALL THE-PRINT,P-HIM-OBJECT
	PRINTI " here."
	CRLF
	RFALSE
?L18:	SET 'OBJ,P-HIM-OBJECT
?L19:	CALL HELD?,OBJ,WINNER >STACK
	ZERO? STACK \?L3
	CALL INTRINSIC?,OBJ >STACK
	ZERO? STACK \?L3
	IN? WINNER,OBJ /?L3
	SET 'PRSO,OBJ
	SET 'TAKEN?1,1
	FSET? OBJ,TRYTAKEBIT \?L25
	SET 'TAKEN?1,0
	JUMP ?L29
?L25:	EQUAL? WINNER,PLAYER \?L29
	BTST IBITS,STAKE \?L28
	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 /?L29
?L28:	SET 'TAKEN?1,0
?L29:	ZERO? TAKEN?1 \?L43
	BTST IBITS,SHAVE \?L30
	GET TBL,P-MATCHLEN >STACK
	LESS? 1,STACK \?L32
	PRINT YOU-ARENT
	PRINTI "holding all those things!"
	CRLF
	RFALSE
?L32:	EQUAL? OBJ,NOT-HERE-OBJECT \?L34
	PRINT YOU-CANT-SEE
	PRINTI "that here!"
	CRLF
	RFALSE
?L34:	EQUAL? WINNER,PLAYER \?L35
	PRINT YOU-ARENT
	JUMP ?L36
?L35:	PRINT STR?80
	CALL THE-PRINT,WINNER
	PRINTI " is "
?L36:	PRINTI "holding "
	EQUAL? OBJ,PSEUDO-OBJECT \?L37
	PRINTI "that"
	JUMP ?L39
?L37:	CALL THE-PRINT,OBJ
?L39:	CALL THIS-IS-IT,OBJ
	PRINT PERIOD
	RFALSE
?L30:	ZERO? TAKEN?1 /?L3
?L43:	EQUAL? WINNER,PLAYER \?L3
	EQUAL? PRSO,INTNUM /?L3
	CALL TAKING-FIRST,OBJ
	JUMP ?L3

	.FUNCT TAKING-FIRST,OBJ
	PRINTI "(Taking "
	CALL THE-PRINT,OBJ
	PRINTR " first)"

	.FUNCT MANY-CHECK,LOSS=0,TMP
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	PRINT YOU-CANT
	PRINTI "use multiple "
	EQUAL? LOSS,2 \?L7
	PRINTI "in"
?L7:	PRINTI "direct objects with """
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L10
	PRINTI "tell"
	JUMP ?L14
?L10:	ZERO? P-OFLAG \?L13
	ZERO? P-MERGED /?L12
?L13:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L14
?L12:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L14:	PRINTI """."
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK \?L9
	MUL CNT,2 >STACK
	ADD TBL,STACK >STACK
	RSTACK
?L9:	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT LIT?,RM,RMBIT=1,OHERE?1,LIT?1=0
	SET 'P-GWIMBIT,ONBIT
	SET 'OHERE?1,HERE
	SET 'HERE,RM
	ZERO? RMBIT /?L1
	FSET? RM,ONBIT \?L1
	SET 'LIT?1,HERE
	JUMP ?L17
?L1:	EQUAL? HERE,ELEVATOR-PIT \?L3
	FSET? ELEVATOR-DOOR-B,OPENBIT /?L4
	FSET? ELEVATOR-DOOR-1,OPENBIT \?L3
?L4:	SET 'LIT?1,CS-BASEMENT
	JUMP ?L17
?L3:	EQUAL? HERE,UNDER-ALCHEMY-LAB \?L5
	FSET? ALCHEMY-TRAP-DOOR,OPENBIT \?L5
	FSET? ALCHEMY-LAB,ONBIT \?L5
	SET 'LIT?1,ALCHEMY-LAB
	JUMP ?L17
?L5:	FSET? WINNER,ONBIT \?L6
	CALL HELD?,WINNER,RM >STACK
	ZERO? STACK /?L6
	SET 'LIT?1,WINNER
	JUMP ?L17
?L6:	PUT P-MERGE,P-MATCHLEN,0
	SET 'P-TABLE,P-MERGE
	SET 'P-SLOCBITS,-1
	EQUAL? OHERE?1,RM \?L10
	CALL DO-SL,WINNER,1,1
	EQUAL? WINNER,PLAYER /?L10
	IN? PLAYER,RM \?L10
	CALL DO-SL,PLAYER,1,1
?L10:	LOC WINNER >STACK
	FSET? STACK,VEHBIT \?L14
	LOC WINNER >STACK
	FSET? STACK,OPENBIT /?L14
	LOC WINNER >STACK
	CALL DO-SL,STACK,1,1
?L14:	CALL DO-SL,RM,1,1
	GET P-TABLE,P-MATCHLEN >STACK
	GRTR? STACK,0 \?L17
	GET P-TABLE,1 >LIT?1
?L17:	SET 'HERE,OHERE?1
	SET 'P-GWIMBIT,0
	RETURN LIT?1

	.FUNCT THIS-IT?,OBJ,TBL,SYNS,ACNT
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	GET P-ADJT,0 >ACNT
	ZERO? ACNT /?L9
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	ZERO? ACNT /?L9
?L8:	PTSIZE SYNS >STACK
	DEC 'STACK
	GET P-ADJT,ACNT >STACK
	CALL ZMEMQB,STACK,SYNS,STACK >STACK
	ZERO? STACK /FALSE
	DEC 'ACNT
	ZERO? ACNT \?L8
?L9:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT END-QUOTE
	SET 'QUOTE-FLAG,0
	SET 'P-CONT,0
	RETURN M-FATAL

	.FUNCT V-$0024COMMAND
	DIRIN 1
	RTRUE

	.FUNCT V-$0024RANDOM
	EQUAL? PRSO,INTNUM /?L1
	PRINTR "Illegal call to #RANDOM."
?L1:	SUB 0,P-NUMBER >STACK
	RANDOM STACK >STACK
	RTRUE

	.FUNCT V-$0024RECORD
	DIROUT D-RECORD-ON
	RTRUE

	.FUNCT V-$0024UNRECORD
	DIROUT D-RECORD-OFF
	RTRUE

	.FUNCT I-TIRED,FORG=0
	CALL QUEUE,I-TIRED,25
	GRTR? LOAD-ALLOWED,10 \?L1
	SUB LOAD-ALLOWED,10 >LOAD-ALLOWED
?L1:	GRTR? FUMBLE-NUMBER,1 \?L4
	DEC 'FUMBLE-NUMBER
?L4:	INC 'AWAKE
	CRLF
	GRTR? AWAKE,8 \?L7
	PRINTI "You are so exhausted you can't stay awake any longer."
	CRLF
	CRLF
	CALL V-SLEEP,1
	RETURN M-FATAL
?L7:	PRINTI "You are "
	GET TIRED-TELL,AWAKE >STACK
	PRINT STACK
	PRINT PERIOD
	RTRUE

	.FUNCT DESCRIBE-ROOM,LOOK?=0,V?,STR,AV
	ZERO? LIT \?L1
	PRINTI "It is pitch black."
	CRLF
	RFALSE
?L1:	IN? HERE,ROOMS \?L4
	PRINTD HERE
?L4:	LOC WINNER >AV
	FSET? AV,VEHBIT \?L7
	FSET? AV,SURFACEBIT \?L9
	PRINTI ", on "
	JUMP ?L11
?L9:	PRINTI ", in "
?L11:	CALL THE-PRINT,AV
?L7:	CRLF
	SET 'V?,LOOK?
	ZERO? V? \?L16
	EQUAL? VERBOSITY,2 /?L15
	SET 'V?,0
	JUMP ?L16
?L15:	SET 'V?,1
?L16:	FSET? HERE,TOUCHBIT /?L19
	FSET HERE,TOUCHBIT
	ZERO? VERBOSITY /?L19
	SET 'V?,1
?L19:	SET 'DESCRIBED-ROOM?,V?
	ZERO? V? /TRUE
	EQUAL? HERE,AV /?L25
	FSET? AV,VEHBIT \?L25
	GETP AV,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \TRUE
?L25:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \TRUE
	GETP HERE,P?LDESC >STR
	ZERO? STR /TRUE
	PRINT STR
	CRLF
	RTRUE

	.FUNCT DESCRIBE-OBJECTS,O,STR,AV,TMP
	LOC WINNER >AV
	FIRST? HERE >O \FALSE
?L7:	CALL DESCRIBABLE?,O >STACK
	ZERO? STACK /?L9
	FSET? O,TOUCHBIT /?L9
	GETP O,P?FDESC >STR
	ZERO? STR /?L9
	CALL THIS-IS-IT,O
	CRLF
	PRINT STR
	FSET? O,CONTBIT \?L10
	CALL DESCRIBE-CONTENTS,O,1,3
?L10:	CRLF
?L9:	NEXT? O >O /?L7
	FIRST? HERE >O \?L17
?L18:	CALL DESCRIBABLE?,O >STACK
	ZERO? STACK /?L32
	GETP O,P?FDESC >STACK
	ZERO? STACK /?L20
	FSET? O,TOUCHBIT \?L32
?L20:	GETP O,P?DESCFCN >STR
	ZERO? STR /?L22
	CALL STR,M-OBJDESC?,O >TMP
	ZERO? TMP /?L22
	EQUAL? TMP,M-FATAL /?L32
	CALL THIS-IS-IT,O
	CRLF
	CALL STR,M-OBJDESC,O >STR
	ZERO? STR /?L27
	FSET? O,CONTBIT \?L27
	EQUAL? STR,M-FATAL /?L27
	CALL DESCRIBE-CONTENTS,O,1,3
?L27:	CRLF
	JUMP ?L32
?L22:	GETP O,P?LDESC >STR
	ZERO? STR /?L32
	CALL THIS-IS-IT,O
	CRLF
	PRINT STR
	FSET? O,CONTBIT \?L33
	CALL DESCRIBE-CONTENTS,O,1,3
?L33:	CRLF
?L32:	NEXT? O >O /?L18
?L17:	CALL DESCRIBE-CONTENTS,HERE,0,0
	ZERO? AV /FALSE
	EQUAL? HERE,AV /FALSE
	CALL DESCRIBE-CONTENTS,AV,0,0 >STACK
	RSTACK

	.FUNCT DESCRIBE-CONTENTS,OBJ,LEVEL=-1,ALL?=D-ALL?,F=0,N,1ST?=1,IT?=0,TWO?=0,START?=0,PARA?=0,DB
	EQUAL? LEVEL,2 \?L1
	SET 'LEVEL,1
	SET 'PARA?,1
	SET 'START?,1
	JUMP ?L3
?L1:	BTST ALL?,D-PARA? \?L3
	SET 'PARA?,1
?L3:	FIRST? OBJ >N /?L5
?L5:	ZERO? START? \?L10
	IN? OBJ,ROOMS /?L10
	FSET? OBJ,PERSON /?L10
	ZERO? N /FALSE
	FSET? OBJ,CONTBIT \FALSE
	FSET? OBJ,OPENBIT /?L9
	FSET? OBJ,TRANSBIT \FALSE
?L9:	EQUAL? LEVEL,-1 /?L10
	FSET? OBJ,SEARCHBIT \FALSE
?L10:	ZERO? N /?L16
?L82:	CALL DESCRIBABLE?,N >STACK
	ZERO? STACK /?L13
	BTST ALL?,D-ALL? /?L16
	CALL SIMPLE-DESC?,N >STACK
	ZERO? STACK /?L13
?L16:	ZERO? F /?L36
	ZERO? 1ST? /?L19
	SET '1ST?,0
	EQUAL? LEVEL,0,1 \?L21
	ZERO? START? \?L33
	ZERO? PARA? \?L25
	SET 'PARA?,1
	CRLF
	JUMP ?L27
?L25:	EQUAL? LEVEL,1 \?L27
	PRINTI " "
?L27:	CALL DESCRIBE-START,OBJ,N
	JUMP ?L33
?L21:	EQUAL? LEVEL,-1 /?L33
	PRINT LEVEL
	JUMP ?L33
?L19:	ZERO? N /?L32
	PRINTI ", "
	JUMP ?L33
?L32:	PRINTI " and "
?L33:	CALL PRINTA,F
	CALL DESCRIBE-SPECIAL,F
	ZERO? IT? \?L34
	ZERO? TWO? \?L34
	SET 'IT?,F
	JUMP ?L36
?L34:	SET 'TWO?,1
	SET 'IT?,0
?L36:	SET 'F,N
?L13:	ZERO? N /?L41
	NEXT? N >N /?L41
?L41:	ZERO? F \?L10
	ZERO? N \?L82
	ZERO? IT? /?L45
	ZERO? TWO? \?L45
	CALL THIS-IS-IT,IT?
?L45:	ZERO? 1ST? /?L80
	ZERO? START? /?L48
	PRINTI " nothing"
	RFALSE
?L48:	ZERO? 1ST? \?L12
?L80:	EQUAL? LEVEL,0,1 \?L60
	EQUAL? OBJ,HERE \?L51
	PRINTI " here"
?L51:	PRINTI "."
?L12:	EQUAL? LEVEL,0,1 \?L60
	FIRST? OBJ >F \?L60
?L61:	FSET? F,CONTBIT \?L63
	CALL DESCRIBABLE?,F,1 >STACK
	ZERO? STACK /?L63
	BTST ALL?,D-ALL? /?L64
	CALL SIMPLE-DESC?,F >STACK
	ZERO? STACK /?L63
?L64:	SET 'DB,D-BIT
	SET 'D-BIT,0
	ZERO? PARA? /?L67
	PUSH 3
	JUMP ?L69
?L67:	PUSH D-ALL?
?L69:	CALL DESCRIBE-CONTENTS,F,1,STACK >STACK
	ZERO? STACK /?L65
	SET '1ST?,0
	SET 'PARA?,1
?L65:	SET 'D-BIT,DB
?L63:	NEXT? F >F /?L61
?L60:	ZERO? 1ST? \FALSE
	EQUAL? LEVEL,0,1 \?L74
	LOC WINNER >STACK
	EQUAL? OBJ,HERE,STACK \?L74
	CRLF
?L74:	ZERO? 1ST? \FALSE
	RTRUE

	.FUNCT DESCRIBE-START,OBJ,N
	EQUAL? OBJ,HERE \?L1
	PRINTI "There is "
	RTRUE
?L1:	EQUAL? OBJ,PLAYER \?L3
	EQUAL? D-BIT,WEARBIT \?L4
	PRINTI " You are wearing "
	RTRUE
?L4:	PRINTI "You are carrying "
	RTRUE
?L3:	FSET? OBJ,PERSON \?L7
	CALL CTHE-PRINT,OBJ
	PRINTI " wears "
	RTRUE
?L7:	FSET? OBJ,SURFACEBIT \?L8
	PRINTI "Sitting on "
	CALL THE-PRINT,OBJ
	PRINTI " is "
	RTRUE
?L8:	CALL CTHE-PRINT,OBJ
	PRINTI " contains "
	RTRUE

	.FUNCT DESCRIBE-SPECIAL,OBJ
	FSET? OBJ,ONBIT \?L1
	PRINTI " (providing light)"
	RTRUE
?L1:	FSET? OBJ,SLIMEBIT \?L3
	PRINTI " (slimed)"
	RTRUE
?L3:	EQUAL? OBJ,HAND \FALSE
	FSET? HAND,PERSON \FALSE
	IN? HAND,PLAYER \FALSE
	PRINTI " (perched on your shoulder)"
	RTRUE

	.FUNCT DESCRIBABLE?,OBJ,CONT?=0
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? OBJ,WINNER /FALSE
	LOC WINNER >STACK
	EQUAL? OBJ,STACK \?L4
	LOC WINNER >STACK
	EQUAL? HERE,STACK \FALSE
?L4:	ZERO? CONT? \?L5
	FSET? OBJ,NDESCBIT /FALSE
?L5:	ZERO? D-BIT /TRUE
	GRTR? D-BIT,0 \?L7
	FSET? OBJ,D-BIT \FALSE
	RTRUE
?L7:	SUB 0,D-BIT >STACK
	FSET? OBJ,STACK /FALSE
	RTRUE

	.FUNCT SIMPLE-DESC?,OBJ,STR
	GETP OBJ,P?FDESC >STACK
	ZERO? STACK /?L1
	FSET? OBJ,TOUCHBIT \FALSE
?L1:	GETP OBJ,P?DESCFCN >STR
	ZERO? STR /?L3
	CALL STR,M-OBJDESC?,OBJ >STACK
	ZERO? STACK \FALSE
?L3:	GETP OBJ,P?LDESC >STACK
	ZERO? STACK /TRUE
	RFALSE

	.FUNCT DESCRIBE-REST,OBJ
	CALL DESCRIBE-CONTENTS,OBJ >STACK
	ZERO? STACK \TRUE
	PRINTI "nothing"
	RTRUE

	.FUNCT DESCRIBE-SENT,OBJ
	CALL DESCRIBE-CONTENTS,OBJ,0,3 >STACK
	ZERO? STACK \TRUE
	PRINTI "The "
	CALL DPRINT,OBJ
	PRINTI " is empty."
	RTRUE

	.FUNCT TO-A-PRSO?
	CALL HOW-DO-YOU
	CALL A-PRSO? >STACK
	RSTACK

	.FUNCT CANT-GO
	PRINT YOU-CANT
	PRINTR "go that way."

	.FUNCT NOT-HOLDING,OBJ
	CALL THIS-IS-IT,OBJ
	PRINT YOU-ARENT
	PRINTI "holding "
	CALL THE-PRINT,OBJ
	PRINT PERIOD
	RTRUE

	.FUNCT ITS-EMPTY
	CALL CTHE-PRINT-PRSO
	PRINTI " is empty"
	PRINT PERIOD
	RTRUE

	.FUNCT ITS-ALREADY-X,X
	PRINT IT-IS-ALREADY
	PRINT X
	PRINT PERIOD
	RTRUE

	.FUNCT ALREADY-OPEN
	CALL ITS-ALREADY-X,STR?81 >STACK
	RSTACK

	.FUNCT ALREADY-CLOSED
	CALL ITS-ALREADY-X,STR?82 >STACK
	RSTACK

	.FUNCT WITH-PRSI?
	PRINTI "With "
	CALL A-PRSI? >STACK
	RSTACK

	.FUNCT TELL-OPEN-CLOSED,OBJ=0
	ZERO? OBJ /?L1
	CALL CTHE-PRINT,OBJ
	JUMP ?L3
?L1:	SET 'OBJ,PRSO
	CALL THE-PRINT-PRSO
?L3:	CALL IS-ARE,OBJ
	PRINTI " "
	CALL OPEN-CLOSED,OBJ >STACK
	RSTACK

	.FUNCT OPEN-CLOSED,OBJ
	FSET? OBJ,OPENBIT \?L1
	PRINTI "open"
	JUMP ?L3
?L1:	PRINTI "closed"
?L3:	PRINT PERIOD
	RTRUE

	.FUNCT THE-PRSO
	CALL THE-PRINT-PRSO
	PRINT PERIOD
	RTRUE

	.FUNCT A-PRSO
	CALL PRINTA-PRSO
	PRINT PERIOD
	RTRUE

	.FUNCT A-PRSO?
	CALL PRINTA-PRSO
	PRINTR "?"

	.FUNCT THE-PRSI
	CALL THE-PRINT-PRSI
	PRINT PERIOD
	RTRUE

	.FUNCT A-PRSI?
	CALL PRINTA-PRSI
	PRINTR "?"

	.FUNCT YOU-CANT-X-THAT,STR
	PRINT YOU-CANT
	PRINT STR
	PRINTR " that!"

	.FUNCT YOU-CANT-X-PRSO,STR
	PRINT YOU-CANT
	PRINT STR
	PRINTI " "
	ZERO? PRSO /?L1
	CALL THE-PRINT-PRSO
	JUMP ?L3
?L1:	PRINTI "that"
?L3:	PRINT PERIOD
	RTRUE

	.FUNCT UNINTERESTED,OBJ
	EQUAL? OBJ,ME \?L1
	CALL TELL-YUKS >STACK
	RSTACK
?L1:	CALL CTHE-PRINT,OBJ
	CALL IS-ARE,OBJ
	PRINTR " uninterested."

	.FUNCT IS-ARE,OBJ
	CALL PLURAL?,OBJ >STACK
	ZERO? STACK /?L1
	PRINTI " are"
	RTRUE
?L1:	PRINTI " is"
	RTRUE

	.FUNCT PLURAL?,OBJ
	EQUAL? OBJ,RATS,STUDENTS,ELEVATOR-DOOR /TRUE
	EQUAL? OBJ,ELEVATOR-DOOR-B,ELEVATOR-DOOR-1,ELEVATOR-DOOR-2 /TRUE
	EQUAL? OBJ,ELEVATOR-DOOR-3,STEAM-PIPES,GLOBAL-URCHINS /TRUE
	EQUAL? OBJ,STUDENTS,URCHINS \FALSE
	RTRUE

	.FUNCT CANT-REACH-THAT
	CALL YOU-CANT-X-THAT,STR?83 >STACK
	RSTACK

	.FUNCT V-VERBOSE
	SET 'VERBOSITY,2
	PRINTI "Verbose"
	PRINT DESCRIPTIONS
	PRINT PERIOD
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT V-BRIEF
	SET 'VERBOSITY,1
	PRINTI "Brief"
	PRINT DESCRIPTIONS
	PRINT PERIOD
	RTRUE

	.FUNCT V-SUPER-BRIEF
	SET 'VERBOSITY,0
	PRINTI "Super-brief"
	PRINT DESCRIPTIONS
	PRINT PERIOD
	RTRUE

	.FUNCT V-DIAGNOSE
	PRINTI "You are "
	LESS? AWAKE,0 \?L1
	PRINTI "wide awake"
	JUMP ?L3
?L1:	GET TIRED-TELL,AWAKE >STACK
	PRINT STACK
?L3:	PRINTI ", and are in "
	GRTR? FREEZE-COUNT,2 \?L4
	GRTR? FREEZE-COUNT,3 \?L6
	PRINTI "imminent "
?L6:	PRINTI "danger of freezing to death"
	JUMP ?L10
?L4:	PRINTI "good health"
	ZERO? FREEZE-COUNT /?L10
	PRINTI " but getting cold"
?L10:	PRINT PERIOD
	RTRUE

	.FUNCT V-INVENTORY
	SUB 0,WEARBIT >D-BIT
	CALL DESCRIBE-CONTENTS,WINNER,0,3 >STACK
	ZERO? STACK \?L1
	PRINTI "You are empty-handed."
?L1:	SET 'D-BIT,WEARBIT
	CALL DESCRIBE-CONTENTS,WINNER,0,3
	SET 'D-BIT,0
	CRLF
	RTRUE

	.FUNCT V-QUIT,ASK?=1,SCOR
	CALL V-SCORE
	ZERO? ASK? /?L3
	PRINT STR?84
	PRINTI "leave the game"
	CALL YES? >STACK
	ZERO? STACK \?L3
	ZERO? ASK? \?L1
?L3:	QUIT
?L1:	PRINT OKAY
	RTRUE

	.FUNCT V-RESTART
	CALL V-SCORE,1
	PRINT STR?84
	PRINTI "restart"
	CALL YES? >STACK
	ZERO? STACK /FALSE
	PRINTI "Restarting."
	CRLF
	RESTART

	.FUNCT FINISH
	USL
	CRLF
	CALL V-SCORE
	CRLF
	PRINTI "[EVENT: GAME OVER]Would you like to restart the game from the beginning, restore a saved game position, or end this session of the game?"
	CRLF
?L1:	PRINTI "(Type RESTART, RESTORE, or QUIT):
>"
	READ P-INBUF,P-LEXV
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?RESTAR \?L3
	RESTART
?L3:	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?RESTOR \?L5
	RESTORE \?L6
	PRINT OKAY
	JUMP ?L1
?L6:	PRINT FAILED
	JUMP ?L1
?L5:	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?QUIT,W?Q \?L1
	QUIT

	.FUNCT YES?
	PRINTI "?
(Y is affirmative): >"
	READ P-INBUF,P-LEXV
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?YES,W?Y \FALSE
	RTRUE

	.FUNCT V-RESTORE,X,Y
	GET SOUND-FLAG,0 >X
	RESTORE /TRUE
	PRINT FAILED
	RTRUE

	.FUNCT V-SAVE,X
	PUTB OOPS-INBUF,1,0
	SAVE /?L1
	SET 'X,0
	JUMP ?L2
?L1:	SET 'X,1
?L2:	ZERO? X \?L3
	PRINT FAILED
	RTRUE
?L3:	PRINT OKAY
	RTRUE

	.FUNCT V-SCORE,ASK?=1
	PRINTI "Your score is "
	PRINTN SCORE
	PRINTI " of a possible 105, in "
	PRINTN MOVES
	PRINTI " move"
	EQUAL? MOVES,1 /?L1
	PRINTI "s"
?L1:	PRINTI ". Graded on the curve, you are in the class of "
	DIV SCORE,10 >STACK
	GET RANKINGS,STACK >STACK
	PRINT STACK
	PRINT PERIOD
	RETURN SCORE

	.FUNCT V-SCRIPT
	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	PRINTI "Start of a transcript of "
	PRINT LURKING-HORROR
	PRINT PERIOD
	CALL V-VERSION >STACK
	RSTACK

	.FUNCT V-UNSCRIPT
	PRINTI "End of transcript"
	PRINT PERIOD
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT V-VERSION,CNT
	PRINT LURKING-HORROR
	PRINTI "
An Interactive Horror
Copyright (c) 1987 by Infocom, Inc. All rights reserved.
"
	PRINT LURKING-HORROR
	PRINTI " is a trademark of Infocom, Inc.
Release "
	GET 0,1 >STACK
	BAND STACK,2047 >STACK
	PRINTN STACK
	PRINTI " / Serial number "
	SET 'CNT,18
?L1:	GETB 0,CNT >STACK
	PRINTC STACK
	IGRTR? 'CNT,23 \?L1
	CRLF
	RTRUE

	.FUNCT V-$0024VERIFY
	EQUAL? PRSO,INTNUM \?L1
	EQUAL? P-NUMBER,1066 \?L1
	PRINTN SERIAL
	CRLF
	RTRUE
?L1:	ZERO? PRSO /?L3
	PRINT NOT-RECOGNIZED
	CRLF
	RTRUE
?L3:	PRINTI "Verifying..."
	CRLF
	VERIFY \?L5
	PRINTR "The disk is correct."
?L5:	CRLF
	PRINTR "** Disk Failure **"

	.FUNCT V-WAKE
	EQUAL? PRSO,ROOMS \?L1
	CALL NEW-PRSO,ME
	RTRUE
?L1:	PRINT I-DONT-THINK-THAT
	CALL THE-PRINT-PRSO
	PRINTR " is sleeping."

	.FUNCT V-ANSWER
	PRINTI "Nobody is awaiting your answer."
	CRLF
	CALL END-QUOTE >STACK
	RSTACK

	.FUNCT PRE-ASK-ABOUT,P
	ZERO? PRSI \FALSE
	CALL FIND-IN,HERE,PERSON >P
	ZERO? P /FALSE
	CALL PERFORM-PRSA,P,PRSO
	RTRUE

	.FUNCT V-ASK-ABOUT
	EQUAL? PRSO,ME \?L1
	CALL NEW-VERB,V?TELL
	RTRUE
?L1:	FSET? PRSO,PERSON \?L3
	CALL NEW-WINNER-PRSO,V?TELL-ME-ABOUT,PRSI
	RTRUE
?L3:	CALL NEW-VERB,V?TELL
	RTRUE

	.FUNCT FIND-IN,WHERE,WHAT,W,W?1
	FIRST? WHERE >W?1 \FALSE
?L1:	FSET? W?1,WHAT \?L4
	CALL VISIBLE?,W?1 >STACK
	ZERO? STACK /?L4
	RETURN W?1
?L4:	NEXT? W?1 >W?1 /?L1
	RFALSE

	.FUNCT PRE-ASK-FOR
	CALL PRE-ASK-ABOUT >STACK
	RSTACK

	.FUNCT V-ASK-FOR
	EQUAL? PRSO,ME \?L1
	CALL PERFORM,V?TAKE,PRSI
	RTRUE
?L1:	FSET? PRSO,PERSON \?L3
	CALL NEW-WINNER-PRSO,V?GIVE,PRSI,ME
	RTRUE
?L3:	PRINTI "It's unlikely that "
	CALL THE-PRINT-PRSO
	PRINTR " will oblige."

	.FUNCT V-ATTACK
	CALL IKILL,STR?85
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?86,STACK
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?87,STACK
	CALL IS-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?88,STACK >STACK
	RSTACK

	.FUNCT V-BITE
	CALL HACK-HACK,STR?89
	FSET? PRSO,PERSON /?L3
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	JUMP ?L1
?L3:	PUSH 1
?L1:	CALL PRINT-ID,STR?90,STACK >STACK
	RSTACK

	.FUNCT PRE-BOARD,AV
	LOC WINNER >AV
	FSET? PRSO,VEHBIT \?L1
	EQUAL? AV,PRSO \?L3
	PRINT YOU-ARE
	PRINT PERIOD
	RETURN M-FATAL
?L3:	FSET? AV,VEHBIT \FALSE
	CALL HELD?,PRSO,AV >STACK
	ZERO? STACK /FALSE
	PRINT YOU-HAVE-TO
	PRINTI "leave "
	CALL THE-PRINT,AV
	PRINTI " first"
	PRINT PERIOD
	RETURN M-FATAL
?L1:	PRINT YOU-CANT
	PRINTI "get into "
	CALL THE-PRINT-PRSO
	PRINTI "!"
	CRLF
	RETURN M-FATAL

	.FUNCT YOU-ARE-IN,AV
	PRINT YOU-ARE
	FSET? AV,SURFACEBIT \?L1
	PUSH STR?91
	JUMP ?L3
?L1:	PUSH STR?92
?L3:	PRINT STACK
	CALL THE-PRINT,AV
	PRINTR "!"

	.FUNCT V-BOARD,AV
	PRINT YOU-ARE-NOW
	PRINTI "in "
	CALL THE-PRSO
	MOVE WINNER,PRSO
	GETP PRSO,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	RTRUE

	.FUNCT V-BURN
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?93,STACK
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	CALL PRINT-ID,STR?94,STACK
	CALL IS-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?95,STACK
	ZERO? PRSI \?L1
	PRINTR "Your blazing gaze is insufficient."
?L1:	CALL WITH-PRSI? >STACK
	RSTACK

	.FUNCT V-CHASTISE
	PRINTR "Use prepositions instead: LOOK AT the object, LOOK INSIDE it, LOOK UNDER it, etc."

	.FUNCT V-CLIMB-DOWN
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L1:	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT V-CLIMB-FOO
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT V-CLIMB-ON
	FSET? PRSO,VEHBIT \?L1
	FSET? PRSO,SURFACEBIT \?L1
	CALL NEW-VERB,V?BOARD
	RTRUE
?L1:	PRINT YOU-CANT
	PRINTI "climb onto "
	CALL A-PRSO >STACK
	RSTACK

	.FUNCT V-CLIMB-OVER
	CALL YOU-CANT-X-THAT,STR?96 >STACK
	RSTACK

	.FUNCT V-CLIMB-UP
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT V-CLOSE
	FSET? PRSO,OPENBIT /?L1
	FSET? PRSO,OPENABLE \?L1
	CALL CTHE-PRINT-PRSO
	PRINTR " is already closed."
?L1:	FSET? PRSO,SURFACEBIT /?L4
	FSET? PRSO,CONTBIT /?L3
	FSET? PRSO,DOORBIT /?L3
?L4:	PRINTI "There's no way to close "
	CALL THE-PRSO >STACK
	RSTACK
?L3:	FSET? PRSO,PERSON \?L5
	PRINTR "Huh?"
?L5:	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L6
	FSET? PRSO,OPENBIT \?L7
	FCLEAR PRSO,OPENBIT
	PRINTI "Closed"
	CALL IN-DARK? >STACK
	RSTACK
?L7:	CALL ALREADY-CLOSED >STACK
	RSTACK
?L6:	FSET? PRSO,DOORBIT \?L10
	CALL CLOSE-A-DOOR >STACK
	RSTACK
?L10:	CALL YOU-CANT-X-THAT,STR?97 >STACK
	RSTACK

	.FUNCT CLOSE-A-DOOR
	FSET? PRSO,OPENBIT \?L1
	CALL OKAY-THE-PRSO-IS-NOW,STR?82
	FCLEAR PRSO,OPENBIT
	RTRUE
?L1:	CALL ALREADY-CLOSED >STACK
	RSTACK

	.FUNCT IN-DARK?,DIE?=0,OLIT
	SET 'OLIT,LIT
	CALL LIT?,HERE >LIT
	ZERO? OLIT /?L1
	ZERO? LIT \?L1
	PRINTI ", leaving you in the dark."
	CRLF
	ZERO? DIE? /TRUE
	CRLF
	PRINTI "Not alone, however. "
	CALL PRINT-ID,STR?98
	CALL JIGS-UP,STR?99 >STACK
	RSTACK
?L1:	PRINT PERIOD
	RTRUE

	.FUNCT OKAY-THE-PRSO-IS-NOW,STR
	PRINTI "Okay, "
	CALL THE-PRINT-PRSO
	PRINTI " is now "
	PRINT STR
	PRINT PERIOD
	RTRUE

	.FUNCT V-COMPARE-MANY
	GET P-PRSO,0 >STACK
	EQUAL? STACK,2 \?L1
	SET 'P-MULT,0
	GET P-PRSO,2 >STACK
	GET P-PRSO,1 >STACK
	CALL PERFORM,V?COMPARE,STACK,STACK
	RETURN M-FATAL
?L1:	PRINTR "You can only compare two things."

	.FUNCT V-WASTE-OF-TIME
	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT V-COMPARE
	EQUAL? PRSO,RAT-SYMBOL,STONE-SYMBOL,CARVING-SYMBOL /?L3
	EQUAL? PRSO,TATTOO,CARTON \?L1
?L3:	EQUAL? PRSI,RAT-SYMBOL,STONE-SYMBOL,CARVING-SYMBOL /?L4
	EQUAL? PRSI,TATTOO,CARTON \?L1
?L4:	PRINTR "Allowing for the different media in which the symbols are executed, they are identical."
?L1:	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT V-CROSS
	CALL YOU-CANT-X-THAT,STR?100 >STACK
	RSTACK

	.FUNCT V-CURSE
	PRINTI "Language like that was until recently grounds for probation!"
	CRLF
	CALL PRINT-ID,STR?101
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?102,STACK >STACK
	RSTACK

	.FUNCT V-CUT
	FSET? PRSO,PERSON \?L1
	CALL NEW-VERB,V?KILL
	RTRUE
?L1:	ZERO? PRSI /?L7
	FSET? PRSI,WEAPONBIT /?L3
	ZERO? PRSI /?L7
	CALL INTRINSIC?,PRSI >STACK
	ZERO? STACK /?L5
?L7:	PRINTI "Your body"
	JUMP ?L8
?L5:	CALL CTHE-PRINT-PRSI
?L8:	PRINTI " has an inadequate ""cutting edge."""
	CRLF
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?103,STACK >STACK
	RSTACK
?L3:	CALL TO-A-PRSO?
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?104,STACK >STACK
	RSTACK

	.FUNCT V-DISEMBARK,AV
	LOC WINNER >AV
	ZERO? PRSO /?L3
	EQUAL? PRSO,ROOMS \?L1
?L3:	ZERO? AV /?L4
	FSET? AV,VEHBIT \?L4
	CALL NEW-PRSO,AV
	RTRUE
?L4:	PRINT YOU-ARENT
	PRINTR "in anything."
?L1:	ZERO? AV /?L7
	FSET? AV,VEHBIT \?L7
	EQUAL? AV,PRSO /?L8
	CALL HELD?,AV,PRSO >STACK
	ZERO? STACK \?L8
	CALL YOU-ARE-IN,AV
	RETURN M-FATAL
?L8:	LOC PRSO >STACK
	MOVE WINNER,STACK
	PRINT YOU-ARE-NOW
	PRINTR "on your feet."
?L7:	LOC PRSO >STACK
	ZERO? STACK /?L11
	CALL NEW-VERB,V?TAKE
	RTRUE
?L11:	PRINTR "It's not in anything."

	.FUNCT V-DRINK,S
	CALL YOU-CANT-X-THAT,STR?105
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?106,STACK >STACK
	RSTACK

	.FUNCT V-DRINK-FROM,X
	CALL TO-A-PRSO?
	CALL DANGEROUS-DRINK? >STACK
	CALL PRINT-ID,STR?107,STACK >STACK
	RSTACK

	.FUNCT PRE-DROP
	EQUAL? PRSO,ROOMS,CABLE \?L4
	ZERO? ON-CABLE? \?L3
?L4:	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
?L3:	CALL NEW-VERB,V?DISEMBARK
	RTRUE

	.FUNCT V-DROP
	EQUAL? PRSO,ROOMS \?L1
	PRINT YOU-ARENT
	PRINTR "hanging from anything."
?L1:	CALL IDROP >STACK
	ZERO? STACK /TRUE
	PRINTR "Dropped."

	.FUNCT V-EAT,H
	GETPT PRSO,P?COOK >STACK
	ZERO? STACK /?L1
	FSET? PRSO,FOODBIT \?L1
	PRINTI "It tastes "
	CALL HEAT,PRSO >STACK
	PRINT STACK
	PRINT PERIOD
	RTRUE
?L1:	PRINTI "The food here is terrible, but this is ridiculous!"
	CRLF
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?108,STACK >STACK
	RSTACK

	.FUNCT V-ENTER,VEHICLE
	IN? PENTAGRAM,HERE \?L1
	CALL PERFORM,V?BOARD,PENTAGRAM
	RTRUE
?L1:	GETPT HERE,P?IN >STACK
	ZERO? STACK /?L3
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L3:	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT PRE-EXAMINE
	ZERO? LIT \?L1
	PRINT TOO-DARK
	RTRUE
?L1:	FSET? PRSO,SLIMEBIT \FALSE
	PRINTI "First, it's covered with slime. "
	RFALSE

	.FUNCT V-EXAMINE,H
	FSET? PRSO,READBIT \?L1
	GETP PRSO,P?TEXT >STACK
	ZERO? STACK /?L1
	CALL NEW-VERB,V?READ
	RTRUE
?L1:	FSET? PRSO,DOORBIT \?L3
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L3:	FSET? PRSO,CONTBIT \?L4
	FSET? PRSO,OPENBIT \?L5
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L5:	PRINT STR?109
	RTRUE
?L4:	GETPT PRSO,P?COOK >STACK
	ZERO? STACK /?L8
	PRINTI "It looks "
	CALL HEAT,PRSO >STACK
	PRINT STACK
	PRINT PERIOD
	RTRUE
?L8:	CALL PRSO-NOTHING-SPECIAL >STACK
	RSTACK

	.FUNCT PRSO-NOTHING-SPECIAL
	PRINT STR?110
	CALL THE-PRSO >STACK
	RSTACK

	.FUNCT V-EXIT
	ZERO? PRSO /?L1
	FSET? PRSO,VEHBIT \?L1
	CALL NEW-VERB,V?DISEMBARK
	RTRUE
?L1:	GETPT HERE,P?OUT >STACK
	ZERO? STACK /?L3
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L3:	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT V-FILL
	ZERO? PRSI \?L1
	PRINT THERES-NOTHING-TO
	PRINTI "fill it with"
	PRINT PERIOD
	RTRUE
?L1:	CALL TELL-YUKS >STACK
	RSTACK

	.FUNCT V-FIND,WHERE=0,L
	CALL INTRINSIC?,PRSO >STACK
	ZERO? STACK /?L1
	PRINTI "Nearby, I'm sure"
	JUMP ?L14
?L1:	IN? PRSO,PLAYER \?L3
	PRINTI "You have it"
	JUMP ?L14
?L3:	IN? PRSO,HERE /?L5
	EQUAL? PRSO,PSEUDO-OBJECT \?L4
?L5:	PRINTI "Right in front of you"
	JUMP ?L14
?L4:	IN? PRSO,LOCAL-GLOBALS /?L7
	IN? PRSO,GLOBAL-OBJECTS \?L6
?L7:	PRINTI "It could be lurking right behind you"
	JUMP ?L14
?L6:	LOC PRSO >L
	EQUAL? L,URCHIN \?L9
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L9
	PRINTI "Maybe an urchin ripped it off"
	JUMP ?L14
?L9:	FSET? L,PERSON \?L11
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L11
	PRINTI "I think "
	CALL THE-PRINT,L
	PRINTI " has it"
	JUMP ?L14
?L11:	CALL ACCESSIBLE?,PRSO >STACK
	ZERO? STACK /?L12
	PRINTI "It's in "
	CALL THE-PRINT,L
	JUMP ?L14
?L12:	ZERO? WHERE /?L13
	PRINTI "Beats me"
	JUMP ?L14
?L13:	PRINT YOU-HAVE-TO
	PRINTI "do that yourself"
?L14:	PRINT PERIOD
	RTRUE

	.FUNCT V-FOLLOW
	ZERO? PRSO /?L1
	IN? PRSO,HERE \?L1
	CALL CTHE-PRINT-PRSO
	PRINTR " is right here!"
?L1:	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT PRE-GIVE
	EQUAL? WINNER,PLAYER \FALSE
	CALL HELD?,PRSO >STACK
	ZERO? STACK \FALSE
	PRINT YOU-HAVE-TO
	PRINTR "get it first."

	.FUNCT V-GIVE
	FSET? PRSI,PERSON /?L1
	PRINT YOU-CANT
	PRINTI "give "
	CALL PRINTA-PRSO
	PRINTI " to "
	CALL PRINTA-PRSI
	PRINTR "!"
?L1:	CALL UNINTERESTED,PRSI >STACK
	RSTACK

	.FUNCT V-HELLO,OWINNER
	ZERO? PRSO /?L1
	FSET? PRSO,PERSON \?L3
	CALL NEW-WINNER-PRSO,PRSA
	RTRUE
?L3:	PRINTI "Serious college students never say ""Hello"" to "
	CALL A-PRSO >STACK
	RSTACK
?L1:	PRINTR "Cheery, aren't you?"

	.FUNCT V-HELP
	ZERO? PRSO /?L1
	CALL CTHE-PRINT-PRSO
	PRINT STR?111
	PRINTR "want help."
?L1:	IN? PC,HERE \?L3
	CALL PERFORM,V?PUSH,HELP-KEY
	RTRUE
?L3:	PRINTR "If you're really stuck, you can order maps and InvisiClues Hint Booklets using the order form that came in your package."

	.FUNCT V-HIDE
	ZERO? PRSO \?L1
	PRINTI "There's no place to hide here."
	CRLF
	RETURN M-FATAL
?L1:	ZERO? PRSI /?L6
	FSET? PRSI,PERSON \?L3
	CALL UNINTERESTED,PRSI >STACK
	RSTACK
?L3:	ZERO? PRSI \FALSE
?L6:	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT V-HIDE-FROM
	PRINT YOU-HAVE-TO
	PRINTR "decide where."

	.FUNCT V-KICK
	CALL HACK-HACK,STR?112
	FSET? PRSO,PERSON /?L3
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	JUMP ?L1
?L3:	PUSH 1
?L1:	CALL PRINT-ID,STR?113,STACK >STACK
	RSTACK

	.FUNCT V-KILL
	CALL IKILL,STR?114
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?115,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?116,STACK
	CALL IS-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?117,STACK >STACK
	RSTACK

	.FUNCT IKILL,STR
	ZERO? PRSO \?L1
	PRINT THERES-NOTHING-TO
	PRINT STR
	PRINTI " here."
	CRLF
?L1:	FSET? PRSO,DOORBIT \?L4
	PRINTR "Pounding on a door is of little use."
?L4:	FSET? PRSO,PERSON /?L6
	CALL TO-A-PRSO? >STACK
	RSTACK
?L6:	EQUAL? PRSI,0,HANDS /?L8
	FSET? PRSI,WEAPONBIT /?L7
?L8:	PRINTI "Trying to "
	PRINT STR
	PRINTI " "
	CALL THE-PRINT-PRSO
	PRINTI " with "
	EQUAL? PRSI,0,HANDS /?L9
	CALL PRINTA-PRSI
	JUMP ?L11
?L9:	PRINTI "your bare hands"
?L11:	PRINTR " is suicidal."
?L7:	IN? PRSI,WINNER /?L12
	CALL NOT-HOLDING,PRSI >STACK
	RSTACK
?L12:	CALL NOT-TRAINED >STACK
	RSTACK

	.FUNCT NOT-TRAINED
	PRINTR "You miss. (Now you know why few technical schools make it to the Rose Bowl.)"

	.FUNCT V-KNOCK
	FSET? PRSO,DOORBIT \?L1
	PRINTR "Nobody's home."
?L1:	PRINTI "Why knock on "
	CALL A-PRSO? >STACK
	RSTACK

	.FUNCT V-KISS
	FSET? PRSO,PERSON \?L1
	CALL UNINTERESTED,PRSO
	CALL PRINT-ID,STR?118 >STACK
	RSTACK
?L1:	CALL TELL-YUKS >STACK
	RSTACK

	.FUNCT V-LAMP-OFF
	CALL TO-A-PRSO? >STACK
	RSTACK

	.FUNCT V-LAMP-ON
	CALL TO-A-PRSO? >STACK
	RSTACK

	.FUNCT V-LEAN-ON
	PRINTR "Tired?"

	.FUNCT V-LEAP
	ZERO? PRSO /?L1
	IN? PRSO,HERE \?L1
	CALL V-SKIP >STACK
	RSTACK
?L1:	EQUAL? HERE,CS-ROOF,ON-DOME \?L3
	CALL PRINT-ID,STR?119
	CALL JIGS-UP,STR?120 >STACK
	RSTACK
?L3:	PRINT GOOD-TRICK
	RTRUE

	.FUNCT V-LEAVE
	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-LISTEN
	EQUAL? HERE,YUGGOTH,BOWL-ROOM,PLATFORM-ROOM \?L1
	PRINTR "The sounds here are harsh and discordant."
?L1:	EQUAL? HERE,CAVE-ALTAR,CAVE-ROOM \?L3
	CALL I-PANEL-NOISES,1 >STACK
	RSTACK
?L3:	EQUAL? PRSO,0,NOISE /?L4
	PRINTI "At the moment, "
	CALL THE-PRINT-PRSO
	PRINTR " is as quiet as a graveyard."
?L4:	CALL IN-TUNNEL?,RATS >STACK
	ZERO? STACK /?L5
	CALL IN-TUNNEL?,WINNER >STACK
	ZERO? STACK /?L5
	PRINT RATS-CHITTERING
	RTRUE
?L5:	RANDOM 100 >STACK
	LESS? 90,STACK /?L6
	PRINTR "You hear nothing unsettling."
?L6:	PRINTR "You hear a very odd noise, sort of like breathing."

	.FUNCT V-LOCK
	CALL CTHE-PRINT-PRSO
	PRINTR " doesn't have a lock."

	.FUNCT V-FIRST-LOOK
	GRTR? VERBOSITY,1 /?L3
	PUSH 0
	JUMP ?L4
?L3:	PUSH 1
?L4:	CALL DESCRIBE-ROOM,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? VERBOSITY /FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT V-LOOK
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /FALSE
	CALL DESCRIBE-OBJECTS >STACK
	RSTACK

	.FUNCT V-LOOK-BEHIND
	FSET? PRSO,OPENBIT /?L1
	FSET? PRSO,SURFACEBIT /?L1
	FSET? PRSO,CONTBIT /?L3
	FSET? PRSO,DOORBIT \?L1
?L3:	CALL INSPECTION-REVEALS,PRSO >STACK
	RSTACK
?L1:	PRINT THERE-IS-NOTHING
	PRINTI "behind "
	CALL THE-PRSO >STACK
	RSTACK

	.FUNCT V-LOOK-DOWN
	ZERO? LIT \?L1
	PRINT TOO-DARK
	RTRUE
?L1:	EQUAL? PRSO,0,ROOMS,GLOBAL-HOLE \?L3
	CALL GLOBAL-IN?,GLOBAL-HOLE,HERE >STACK
	ZERO? STACK /?L4
	CALL PERFORM,V?LOOK-INSIDE,GLOBAL-HOLE
	RTRUE
?L4:	CALL PERFORM,V?EXAMINE,GROUND
	RTRUE
?L3:	CALL PRSO-NOTHING-SPECIAL >STACK
	RSTACK

	.FUNCT WHAT-CONTENTS
	CALL DESCRIBE-CONTENTS,PRSO >STACK
	ZERO? STACK \?L3
	PRINTI "nothing"
	IN? PLAYER,PRSO \?L3
	PRINTI " (other than you)"
?L3:	PRINT PERIOD
	RTRUE

	.FUNCT V-LOOK-INSIDE
	FSET? PRSO,PERSON \?L1
	CALL PRSO-NOTHING-SPECIAL >STACK
	RSTACK
?L1:	FSET? PRSO,SURFACEBIT \?L3
	PRINTI "On "
	CALL THE-PRINT-PRSO
	PRINTI " is "
	CALL WHAT-CONTENTS >STACK
	RSTACK
?L3:	FSET? PRSO,DOORBIT \?L4
	CALL THIS-IS-IT,PRSO
	PRINTI "All you can tell is that "
	CALL TELL-OPEN-CLOSED >STACK
	RSTACK
?L4:	FSET? PRSO,CONTBIT \?L5
	LOC WINNER >STACK
	EQUAL? PRSO,STACK \?L6
	MOVE PLAYER,ROOMS
	PRINTI "Aside from you, there's "
	CALL WHAT-CONTENTS
	MOVE PLAYER,PRSO
	RTRUE
?L6:	CALL SEE-INSIDE?,PRSO >STACK
	ZERO? STACK /?L8
	CALL CTHE-PRINT-PRSO
	PRINTI " contains "
	CALL WHAT-CONTENTS >STACK
	RSTACK
?L8:	FSET? PRSO,OPENBIT /?L9
	FIRST? PRSO >STACK \?L9
	CALL NEW-VERB,V?OPEN
	RTRUE
?L9:	CALL THIS-IS-IT,PRSO
	PRINTI "It seems "
	CALL TELL-OPEN-CLOSED >STACK
	RSTACK
?L5:	CALL YOU-CANT-X-PRSO,STR?121 >STACK
	RSTACK

	.FUNCT V-LOOK-UNDER
	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L1
	PRINTR "You're already holding it!"
?L1:	PRINT THERE-IS-NOTHING
	PRINTR "there."

	.FUNCT V-LOWER
	CALL HACK-HACK,STR?122 >STACK
	RSTACK

	.FUNCT V-LOWER-INTO
	CALL V-LOWER >STACK
	RSTACK

	.FUNCT V-MELT
	CALL WITH-PRSI?
	EQUAL? PRSI,MICROWAVE /?L2
	PUSH 0
	JUMP ?L4
?L2:	FSET? PRSO,PERSON /?L3
	PUSH 0
	JUMP ?L4
?L3:	PUSH 1
?L4:	CALL PRINT-ID,STR?123,STACK
	EQUAL? PRSO,MICROWAVE /?L6
	PUSH 0
	JUMP ?L5
?L6:	CALL IS-OBJ-PROP-ANIMAL? >STACK
?L5:	CALL PRINT-ID,STR?124,STACK
	EQUAL? PRSO,MICROWAVE /?L8
	PUSH 0
	JUMP ?L7
?L8:	CALL IS-PART-OF-SELF? >STACK
?L7:	CALL PRINT-ID,STR?125,STACK >STACK
	RSTACK

	.FUNCT V-MOVE
	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L1
	PRINTR "You're holding it. Are you planning to juggle it?"
?L1:	FSET? PRSO,TAKEBIT \?L3
	FSET? PRSO,PERSON /?L3
	CALL V-TURN-OVER >STACK
	RSTACK
?L3:	CALL YOU-CANT-X-PRSO,STR?126 >STACK
	RSTACK

	.FUNCT HOSTILE-VERB?
	EQUAL? PRSA,V?ATTACK,V?BITE,V?CUT /TRUE
	EQUAL? PRSA,V?KICK,V?KILL,V?MUNG /TRUE
	EQUAL? PRSA,V?RUB,V?PUSH,V?MOVE /TRUE
	EQUAL? PRSA,V?THROW /TRUE
	RFALSE

	.FUNCT ABSTRACT-VERB?
	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR,V?FIND /TRUE
	EQUAL? PRSA,V?TELL-ME-ABOUT,V?TELL-ABOUT,V?WHAT /TRUE
	EQUAL? PRSA,V?WHERE /TRUE
	RFALSE

	.FUNCT PASSIVE-VERB?,?TMP
	CALL ABSTRACT-VERB? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	EQUAL? PRSA,V?COMPARE,V?COUNT,V?CURSE /TRUE
	EQUAL? PRSA,V?DIE,V?DISEMBARK,V?EXAMINE /TRUE
	EQUAL? PRSA,V?HELLO,V?LISTEN,V?LOOK-BEHIND /TRUE
	EQUAL? PRSA,V?LOOK-DOWN,V?LOOK-INSIDE,V?LOOK-UNDER /TRUE
	EQUAL? PRSA,V?POINT,V?READ,V?REPLY /TRUE
	EQUAL? PRSA,V?SAY,V?SCARE,V?SHOW /TRUE
	EQUAL? PRSA,V?TELL,V?THANK,V?WAIT /TRUE
	EQUAL? PRSA,V?WAIT-FOR,V?WALK,V?WAVE-AT /TRUE
	EQUAL? PRSA,V?YAWN,V?YELL /TRUE
	RFALSE

	.FUNCT V-MUNG
	CALL HACK-HACK,STR?127
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?128,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?129,STACK
	CALL IS-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?130,STACK >STACK
	RSTACK

	.FUNCT PRE-OPEN
	IN? PRSO,MICROWAVE \?L1
	FSET? MICROWAVE,OPENBIT /?L1
	CALL YOU-CANT-X-THAT,STR?131 >STACK
	RSTACK
?L1:	FSET? PRSO,PERSON /?L4
	EQUAL? PRSO,DEAD-RAT,HAND \?L3
?L4:	PRINTR "What a grisly idea."
?L3:	EQUAL? PRSI,0,FORKLIFT /FALSE
	CALL HELD?,PRSI >STACK
	ZERO? STACK \FALSE
	CALL NOT-HOLDING,PRSI >STACK
	RSTACK

	.FUNCT V-OPEN,F,STR
	FSET? PRSO,OPENBIT \?L1
	FSET? PRSO,OPENABLE \?L1
	CALL CTHE-PRINT-PRSO
	PRINTR " is already open."
?L1:	FSET? PRSO,CONTBIT /?L5
	FSET? PRSO,DOORBIT \?L4
?L5:	FSET? PRSO,SURFACEBIT \?L3
?L4:	CALL TO-A-PRSO? >STACK
	RSTACK
?L3:	GETP PRSO,P?CAPACITY >STACK
	ZERO? STACK /?L6
	FSET? PRSO,OPENBIT /FALSE
	FSET PRSO,OPENBIT
	FSET PRSO,TOUCHBIT
	FIRST? PRSO >STACK \?L11
	FSET? PRSO,TRANSBIT \?L9
?L11:	PRINTR "Opened."
?L9:	FIRST? PRSO >F \?L12
	NEXT? F >STACK /?L12
	GETP F,P?FDESC >STR
	ZERO? STR /?L12
	CALL OKAY-THE-PRSO-IS-NOW,STR?81
	PRINT STR
	CRLF
	RTRUE
?L12:	PRINTI "Opening "
	CALL THE-PRINT-PRSO
	PRINTI " reveals "
	CALL WHAT-CONTENTS >STACK
	RSTACK
?L6:	FSET? PRSO,OPENBIT \?L16
	CALL ALREADY-OPEN >STACK
	RSTACK
?L16:	FSET? PRSO,LOCKED \?L18
	PRINTR "It's locked."
?L18:	FSET PRSO,OPENBIT
	CALL OKAY-THE-PRSO-IS-NOW,STR?81 >STACK
	RSTACK

	.FUNCT V-PICK
	CALL YOU-CANT-X-THAT,STR?132 >STACK
	RSTACK

	.FUNCT V-PLUG
	CALL V-TURN >STACK
	RSTACK

	.FUNCT V-POINT
	PRINTR "It may be dangerous to point."

	.FUNCT V-POUR-FROM
	IN? PRSO,PRSI \?L1
	CALL PERFORM,V?POUR,PRSO
	RTRUE
?L1:	PRINTR "It's not in that!"

	.FUNCT PRE-POUR
	EQUAL? PRSO,PRSI \FALSE
	CALL TELL-YUKS >STACK
	RSTACK

	.FUNCT V-POUR
	FSET? PRSO,CONTBIT \?L1
	CALL HELD?,PRSO >STACK
	ZERO? STACK /?L1
	CALL EMPTY-ALL,PRSO,PRSI >STACK
	RSTACK
?L1:	CALL YOU-CANT-X-THAT,STR?133 >STACK
	RSTACK

	.FUNCT EMPTY-ALL,FROM,TO,F,N,R,1ST?=0,F?1,N?1
	FIRST? FROM >F?1 \?L3
?L1:	NEXT? F?1 >N?1 /?L4
?L4:	FSET? F?1,TAKEBIT \?L10
	SET '1ST?,1
	CALL DPRINT,F?1
	PRINTI ": "
	ZERO? TO /?L7
	CALL PERFORM,V?PUT,F?1,TO >R
	JUMP ?L9
?L7:	CALL PERFORM,V?DROP,F?1 >R
?L9:	EQUAL? R,M-FATAL /TRUE
?L10:	SET 'F?1,N?1
	ZERO? F?1 \?L1
?L3:	ZERO? 1ST? \TRUE
	CALL CTHE-PRINT,FROM
	PRINTR " is empty."

	.FUNCT V-PUSH
	CALL HACK-HACK,STR?134 >STACK
	RSTACK

	.FUNCT V-PUSH-TO
	CALL YOU-CANT-X-THAT,STR?135 >STACK
	RSTACK

	.FUNCT PRE-PUT,L
	LOC PRSO >L
	IN? PRSO,GLOBAL-OBJECTS /?L3
	FSET? PRSO,TAKEBIT /?L1
?L3:	PRINTR "Nice try."
?L1:	EQUAL? PRSA,V?PUT \?L4
	FSET? PRSO,WEAPONBIT \?L4
	FSET? PRSI,PERSON \?L4
	CALL SWAP-VERB,V?ATTACK
	RTRUE
?L4:	IN? PRSO,PRSI \?L5
	CALL TAKE-OUT-FIRST,PRSO,PRSI >STACK
	RSTACK
?L5:	IN? PRSI,PRSO \?L6
	CALL TAKE-OUT-FIRST,PRSI,PRSO >STACK
	RSTACK
?L6:	FSET? L,PERSON /FALSE
	FSET? L,CONTBIT \?L8
	FSET? L,OPENBIT /?L8
	CALL TAKE-OUT-FIRST,PRSO,L >STACK
	RSTACK
?L8:	EQUAL? PRSO,ELIXIR,FLOOR-WAX,NITROGEN \FALSE
	CALL NEW-VERB,V?POUR
	RTRUE

	.FUNCT TAKE-OUT-FIRST,OBJ,CONT
	PRINTI "You should take "
	CALL THE-PRINT,OBJ
	PRINTI " "
	EQUAL? CONT,HAND \?L1
	PRINTI "off"
	JUMP ?L3
?L1:	PRINTI "out"
?L3:	PRINTI " "
	CALL THE-PRINT,CONT
	PRINTR " first."

	.FUNCT V-PUT,W
	FSET? PRSI,OPENBIT /?L1
	FSET? PRSI,DOORBIT /?L1
	FSET? PRSI,CONTBIT /?L1
	FSET? PRSI,SURFACEBIT /?L1
	FSET? PRSI,VEHBIT /?L1
	CALL YOU-CANT-X-THAT,STR?96
	RTRUE
?L1:	EQUAL? PRSI,POOL \?L3
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L3:	FSET? PRSI,OPENBIT /?L4
	FSET? PRSI,SURFACEBIT /?L4
	CALL INSPECTION-REVEALS,PRSI >STACK
	RSTACK
?L4:	EQUAL? PRSI,PRSO \?L5
	CALL TO-A-PRSO? >STACK
	RSTACK
?L5:	IN? PRSO,PRSI \?L6
	PRINTI "I think "
	CALL THE-PRINT-PRSO
	PRINTI " is already in "
	CALL THE-PRSI >STACK
	RSTACK
?L6:	LOC PRSI >W
	FSET? W,PERSON \?L7
	EQUAL? W,WINNER /?L7
	PRINTI "Don't you think you should ask "
	CALL THE-PRINT,W
	PRINTR " first?"
?L7:	EQUAL? PRSO,AXE,BOLT-CUTTER,CROWBAR \?L10
	EQUAL? PRSI,MICROWAVE /?L9
?L10:	CALL PRSO-TOO-BIG? >STACK
	ZERO? STACK /?L8
?L9:	PRINT NO-ROOM
	CRLF
	RTRUE
?L8:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L11
	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
?L11:	FCLEAR PRSO,WEARBIT
	MOVE PRSO,PRSI
	EQUAL? PRSI,FLASK \?L13
	FCLEAR PRSO,SLIMEBIT
?L13:	FSET PRSO,TOUCHBIT
	PRINTR "Done."

	.FUNCT PRSO-TOO-BIG?,?TMP
	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \FALSE
	RTRUE

	.FUNCT INSPECTION-REVEALS,OBJ
	CALL THIS-IS-IT,OBJ
	PRINTI "Inspection reveals that "
	CALL THE-PRINT,OBJ
	PRINTR " isn't open."

	.FUNCT V-PUT-BEHIND
	PRINT YOU-CANT
	PRINTR "be sure what's lurking there."

	.FUNCT V-PUT-ON
	EQUAL? PRSI,ME \?L1
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L1:	EQUAL? PRSI,GROUND \?L3
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L3:	FSET? PRSI,SURFACEBIT \?L4
	CALL V-PUT >STACK
	RSTACK
?L4:	CALL NO-GOOD-SURFACE >STACK
	RSTACK

	.FUNCT NO-GOOD-SURFACE
	PRINTI "There's no good surface on "
	CALL THE-PRSI >STACK
	RSTACK

	.FUNCT V-PUT-UNDER
	CALL YOU-CANT-X-THAT,STR?136 >STACK
	RSTACK

	.FUNCT V-RAISE
	CALL HACK-HACK,STR?137 >STACK
	RSTACK

	.FUNCT V-REACH-IN,OBJ
	FSET? PRSO,CONTBIT \?L3
	FSET? PRSO,PERSON \?L1
?L3:	CALL TO-A-PRSO? >STACK
	RSTACK
?L1:	FSET? PRSO,OPENBIT /?L4
	PRINTR "It's not open."
?L4:	FIRST? PRSO >OBJ \?L6
	FSET? OBJ,INVISIBLE /?L6
	FSET? OBJ,TAKEBIT /?L5
?L6:	CALL ITS-EMPTY >STACK
	RSTACK
?L5:	PRINT STR?138
	PRINTI "in "
	CALL THE-PRINT-PRSO
	PRINTR "!"

	.FUNCT PRE-READ
	ZERO? LIT \?L1
	PRINT YOU-CANT
	PRINTR "read in the dark."
?L1:	ZERO? PRSI /FALSE
	FSET? PRSI,TRANSBIT /FALSE
	CALL HOW-DO-YOU
	CALL A-PRSI? >STACK
	RSTACK

	.FUNCT HOW-DO-YOU
	PRINTI "How do you do that with "
	RTRUE

	.FUNCT V-READ
	FSET? PRSO,READBIT \?L1
	GETP PRSO,P?TEXT >STACK
	ZERO? STACK /?L1
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	CALL TO-A-PRSO? >STACK
	RSTACK

	.FUNCT V-REPLY
	PRINTI "You are ignored."
	CRLF
	CALL END-QUOTE >STACK
	RSTACK

	.FUNCT PRE-SRUB
	CALL SWAP-VERB,V?RUB
	RTRUE

	.FUNCT V-SRUB
	RTRUE

	.FUNCT V-RUB,H
	GETPT PRSO,P?COOK >STACK
	ZERO? STACK /?L1
	PRINTI "It's "
	CALL HEAT,PRSO >STACK
	PRINT STACK
	PRINT PERIOD
	RTRUE
?L1:	EQUAL? PRSO,AIR \?L3
	PRINTI "It's "
	FSET? HERE,OUTSIDE \?L4
	PRINTR "cold."
?L4:	PRINTR "warm."
?L3:	CALL HACK-HACK,STR?139 >STACK
	RSTACK

	.FUNCT V-SAY,V
	CALL FIND-IN,HERE,PERSON >V
	ZERO? V /?L1
	PRINTI "You must address "
	CALL THE-PRINT,V
	PRINTI " directly."
	CRLF
	CALL END-QUOTE >STACK
	RSTACK
?L1:	GET P-LEXV,P-CONT >STACK
	EQUAL? STACK,W?HELLO \?L3
	SET 'QUOTE-FLAG,0
	RTRUE
?L3:	CALL PERFORM,V?TELL,ME
	CALL END-QUOTE >STACK
	RSTACK

	.FUNCT V-SEARCH
	FSET? PRSO,PERSON \?L1
	CALL CTHE-PRINT-PRSO
	PRINTR " refuses."
?L1:	PRINT THERE-IS-NOTHING
	PRINTI "there"
	PRINT PERIOD
	RTRUE

	.FUNCT PRE-SGIVE
	CALL SWAP-VERB,V?GIVE
	RTRUE

	.FUNCT V-SGIVE
	RTRUE

	.FUNCT V-SHAKE,X
	FSET? PRSO,PERSON \?L1
	PRINTR "Be real."
?L1:	PRINTR "There's no point in shaking that."

	.FUNCT V-SHARPEN
	PRINTR "You'll never sharpen anything with that!"

	.FUNCT V-SHOOT
	PRINTI "This explains why you aren't in ROTC."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?140,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?141,STACK
	CALL IS-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?142,STACK >STACK
	RSTACK

	.FUNCT V-SHOW
	FSET? PRSI,PERSON \?L1
	CALL UNINTERESTED,PRSI >STACK
	RSTACK
?L1:	CALL TELL-YUKS >STACK
	RSTACK

	.FUNCT V-SIT
	EQUAL? PRSA,V?SIT \?L1
	EQUAL? PRSO,ROOMS \?L1
	IN? CHAIR,HERE \?L1
	CALL NEW-PRSO,CHAIR
	RTRUE
?L1:	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT V-SKIP
	PRINTR "Not as fun as skipping class."

	.FUNCT V-SLEEP,FORCE?=0
	ZERO? FORCE? \?L1
	EQUAL? AWAKE,-1 \?L1
	PRINTR "You try to sleep, but you can't relax."
?L1:	CALL QUEUED?,I-FREEZE-TO-DEATH >STACK
	ZERO? STACK /?L3
	PRINTI "You would freeze to death before you woke."
	CRLF
	CALL PRINT-ID,STR?143 >STACK
	RSTACK
?L3:	PRINTI "You've been up for a long time, and it was turning into an all-nighter. You can use the rest. You stretch out as best you can. You toss and turn fitfully, sleeping only in snatches."
	CRLF
	CRLF
	PRINTI "You dream of "
	CALL RANDOM-ELEMENT,DREAMS >STACK
	PRINT STACK
	CRLF
	CRLF
	CALL PRINT-ID,STR?144
	CALL JIGS-UP,STR?145
	RETURN M-FATAL

	.FUNCT LIKE-A-PRSO,V
	PRINTI "It "
	PRINT V
	PRINTI " just like "
	CALL PRINTA-PRSO
	PRINTR "."

	.FUNCT V-SMELL
	ZERO? PRSO /?L1
	CALL LIKE-A-PRSO,STR?146 >STACK
	RSTACK
?L1:	LOC WINNER >STACK
	FSET? STACK,VEHBIT \?L3
	LOC WINNER >STACK
	CALL PERFORM-PRSA,STACK
	RTRUE
?L3:	PRINTR "There's no noticeable smell here."

	.FUNCT PRE-SSHOW
	CALL SWAP-VERB,V?SHOW
	RTRUE

	.FUNCT V-SSHOW
	RTRUE

	.FUNCT V-STAND
	EQUAL? PRSO,0,ROOMS \?L1
	LOC WINNER >STACK
	FSET? STACK,VEHBIT \?L3
	LOC WINNER >STACK
	CALL PERFORM,V?DISEMBARK,STACK
	RTRUE
?L3:	PRINT YOU-ARE
	PRINTR " standing."
?L1:	CALL HACK-HACK,STR?147 >STACK
	RSTACK

	.FUNCT V-SWING
	ZERO? PRSI \?L1
	PRINTR "Whoosh!"
?L1:	CALL SWAP-VERB,V?ATTACK
	RTRUE

	.FUNCT V-SWIM
	CALL TELL-YUKS >STACK
	RSTACK

	.FUNCT PRE-TAKE
	IN? PRSO,WINNER \?L1
	PRINT YOU-HAVE
	PRINTR "it."
?L1:	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L3
	LOC PRSO >STACK
	FSET? STACK,CONTBIT \?L3
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L3
	EQUAL? PRSO,REPEATER-COVER,PADLOCK /?L3
	CALL CANT-REACH-THAT
	RTRUE
?L3:	ZERO? PRSI /?L4
	EQUAL? PRSI,WALL-SOCKET,ROD,HOOK /FALSE
	EQUAL? PRSO,ME \?L7
	CALL PERFORM,V?DROP,PRSI
	RTRUE
?L7:	LOC PRSO >STACK
	EQUAL? PRSI,STACK /?L8
	EQUAL? PRSI,HOOK \?L10
	EQUAL? PRSO,CHAIN-HOOKED? \?L9
?L10:	EQUAL? PRSI,ROD \?L8
	EQUAL? PRSO,CHAIN-LOOPED? /?L8
?L9:	PRINTI "But "
	CALL THE-PRINT-PRSO
	PRINTI " isn't in "
	CALL THE-PRSI >STACK
	RSTACK
?L8:	SET 'PRSI,0
	RFALSE
?L4:	LOC WINNER >STACK
	EQUAL? PRSO,STACK \FALSE
	PRINTI "You are "
	FSET? PRSO,PERSON \?L13
	PRINTI "being carried by"
	JUMP ?L16
?L13:	FSET? PRSO,SURFACEBIT \?L15
	PRINTI "on"
	JUMP ?L16
?L15:	PRINTI "in"
?L16:	PRINTR " it!"

	.FUNCT NOT-REACHABLE?
	CALL PASSIVE-VERB? >STACK
	ZERO? STACK \FALSE
	CALL NOT-IN-VEHICLE?,PRSO >STACK
	ZERO? STACK /?L4
	RETURN PRSO
?L4:	CALL NOT-IN-VEHICLE?,PRSI >STACK
	ZERO? STACK /FALSE
	RETURN PRSI

	.FUNCT CANT-REACH-FROM-VEHICLE,O
	PRINT YOU-CANT
	PRINTI "reach "
	CALL THE-PRINT,O
	PRINTI " from within "
	LOC WINNER >STACK
	CALL THE-PRINT,STACK
	PRINTR "."

	.FUNCT NOT-IN-VEHICLE?,PP,V
	LOC WINNER >V
	EQUAL? PP,0,V,ROOMS /FALSE
	CALL INTRINSIC?,PP >STACK
	ZERO? STACK \FALSE
	CALL HELD?,PP >STACK
	ZERO? STACK \FALSE
	CALL META-LOC,PP >STACK
	EQUAL? STACK,V \TRUE
	RFALSE

	.FUNCT V-TAKE
	CALL ITAKE >STACK
	EQUAL? STACK,1 \FALSE
	PRINT TAKEN
	CALL IS-THEFT? >STACK
	CALL PRINT-ID,STR?148,STACK >STACK
	RSTACK

	.FUNCT V-TAKE-OFF
	FSET? PRSO,VEHBIT \?L1
	CALL NEW-VERB,V?DISEMBARK
	RTRUE
?L1:	FSET? PRSO,WEARBIT \?L3
	FCLEAR PRSO,WEARBIT
	PRINTI "You're no longer wearing "
	CALL THE-PRINT-PRSO
	PRINT PERIOD
	RTRUE
?L3:	CALL NEW-VERB,V?TAKE
	RTRUE

	.FUNCT V-TELL
	FSET? PRSO,PERSON \?L1
	ZERO? P-CONT /?L3
	SET 'WINNER,PRSO
	RTRUE
?L3:	PRINTI "Hmmm ... "
	CALL THE-PRINT-PRSO
	PRINTR " waits for you to say something."
?L1:	CALL YOU-CANT-X-PRSO,STR?149
	CALL END-QUOTE >STACK
	RSTACK

	.FUNCT V-THANK
	ZERO? PRSO \?L1
	PRINTR "You're welcome, I guess."
?L1:	FSET? PRSO,PERSON \?L3
	CALL UNINTERESTED,PRSO
	EQUAL? PRSO,HACKER /?L5
	PUSH 0
	JUMP ?L7
?L5:	GRTR? HACKER-HELP,0 /?L6
	PUSH 0
	JUMP ?L7
?L6:	PUSH 1
?L7:	CALL PRINT-ID,STR?150,STACK >STACK
	RSTACK
?L3:	CALL TO-A-PRSO? >STACK
	RSTACK

	.FUNCT V-THROUGH,M
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L1:	EQUAL? PRSO,INTNAME \?L3
	CALL NEW-VERB,V?TYPE
	RTRUE
?L3:	FSET? PRSO,VEHBIT \?L4
	CALL NEW-VERB,V?BOARD
	RTRUE
?L4:	FSET? PRSO,DOORBIT \?L5
	FSET? PRSO,OPENBIT \?L5
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L5:	FSET? PRSO,TAKEBIT /?L6
	PRINTI "You hit your head against "
	CALL THE-PRINT-PRSO
	PRINTI " as you attempt this feat."
	CRLF
	CALL PRINT-ID,STR?151 >STACK
	RSTACK
?L6:	IN? PRSO,WINNER \?L7
	PRINTR "That would involve quite a contortion!"
?L7:	CALL TELL-YUKS >STACK
	RSTACK

	.FUNCT V-THROW
	ZERO? PRSI /?L10
	FSET? PRSI,PERSON \?L1
	IN? PRSO,WINNER \?L3
	CALL IDROP >STACK
	ZERO? STACK /FALSE
	CALL NOT-TRAINED
	CALL IS-WEAPON? >STACK
	CALL PRINT-ID,STR?152,STACK >STACK
	RSTACK
?L3:	CALL SWAP-VERB,V?ATTACK
	RTRUE
?L1:	ZERO? PRSI /?L10
	EQUAL? PRSI,PSEUDO-OBJECT /?L9
	FSET? PRSO,WEAPONBIT \?L9
	CALL SWAP-VERB,V?ATTACK
	RTRUE
?L9:	ZERO? PRSI /?L10
	FSET? PRSI,DOORBIT /?L10
	FSET? PRSI,CONTBIT \?L10
	GETP PRSI,P?CAPACITY >STACK
	ZERO? STACK /?L10
	CALL NEW-VERB,V?PUT
	RTRUE
?L10:	CALL IDROP >STACK
	ZERO? STACK /FALSE
	PRINTR "Thrown."

	.FUNCT V-THROW-OFF
	CALL YOU-CANT-X-THAT,STR?153
	EQUAL? PRSI,DOME,DOME-ROOF,BROWN-ROOF /?L1
	EQUAL? PRSI,CS-ROOF /?L1
	PUSH 0
	JUMP ?L2
?L1:	PUSH 1
?L2:	CALL PRINT-ID,STR?154,STACK >STACK
	RSTACK

	.FUNCT V-TIE
	CALL TO-A-PRSO?
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?155,STACK >STACK
	RSTACK

	.FUNCT V-TIE-UP
	CALL TO-A-PRSO?
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?156,STACK >STACK
	RSTACK

	.FUNCT V-TIME,X
	PRINTR "It seems like three o'clock in the morning."

	.FUNCT V-TORTURE
	PRINTI "An appalling idea!"
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?157,STACK
	CALL IS-ANIMAL? >STACK
	CALL PRINT-ID,STR?158,STACK >STACK
	RSTACK

	.FUNCT V-TURN
	PRINTR "This has no effect."

	.FUNCT V-TURN-OVER
	PRINTI "Moving "
	CALL THE-PRINT-PRSO
	PRINTR " reveals nothing."

	.FUNCT V-TURN-AROUND
	EQUAL? PRSO,ROOMS \?L1
	CALL PERFORM,V?LOOK-BEHIND,ME
	RTRUE
?L1:	FSET? PRSO,PERSON \?L3
	PRINTI "I wouldn't do that, "
	CALL THE-PRINT-PRSO
	PRINTR " might get dizzy."
?L3:	FSET? PRSO,TAKEBIT /?L4
	PRINT YOU-CANT
	PRINTI "turn "
	CALL THE-PRINT-PRSO
	PRINTR " around."
?L4:	PRINTI "Turning "
	CALL THE-PRINT-PRSO
	PRINTR " around gives you a new perspective on it, but reveals no new information."

	.FUNCT V-UNLOCK
	FSET? PRSO,DOORBIT \?L1
	EQUAL? PRSI,MASTER-KEY \?L1
	PRINTI "The key fits perfectly in the lock, but the lock doesn't turn. The master key doesn't work on this lock."
	CRLF
	CALL PRINT-ID,STR?159 >STACK
	RSTACK
?L1:	CALL V-LOCK >STACK
	RSTACK

	.FUNCT V-UNTIE
	CALL TO-A-PRSO? >STACK
	RSTACK

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	ZERO? P-WALK-DIR \?L1
	CALL NEW-VERB,V?WALK-TO
	RTRUE
?L1:	GETPT HERE,PRSO >PT
	ZERO? PT /?L3
	PTSIZE PT >PTS
	EQUAL? PTS,NEXIT \?L4
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN M-FATAL
?L4:	EQUAL? PTS,UEXIT \?L6
	GETB PT,REXIT >RM
	JUMP ?L20
?L6:	EQUAL? PTS,FEXIT \?L7
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM \?L20
	RETURN M-FATAL
?L7:	EQUAL? PTS,CEXIT \?L11
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L12
	GETB PT,REXIT >RM
	JUMP ?L20
?L12:	GET PT,CEXITSTR >STR
	ZERO? STR /?L14
	PRINT STR
	CRLF
	RETURN M-FATAL
?L14:	CALL CANT-GO
	RETURN M-FATAL
?L11:	EQUAL? PTS,DEXIT \?L20
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L17
	GETB PT,REXIT >RM
	JUMP ?L20
?L17:	GET PT,DEXITSTR >STR
	ZERO? STR /?L19
	PRINT STR
	CRLF
	CALL THIS-IS-IT,OBJ
	RETURN M-FATAL
?L19:	CALL TELL-OPEN-CLOSED,OBJ
	CALL THIS-IS-IT,OBJ
	RETURN M-FATAL
?L20:	IN? FLOOR-WAX,HERE \?L22
	PRINTI "You slip and slide on the wax. It's like walking on wet ice. You can barely keep upright, but "
	ZERO? CORD-SEVERED? /?L24
	IN? MAINTENANCE-MAN,HERE \?L24
	FSET? MAINTENANCE-MAN,PERSON \?L24
	PRINTI "it's worse for the maintenance man. His gait is so jerky that each time he takes a step he falls! His persistence is impressive, but you slip (literally) by before he can grab you."
	JUMP ?L26
?L24:	PRINTI "you manage to lose your balance in just the right way to keep going."
?L26:	CRLF
	CRLF
	JUMP ?L28
?L22:	ZERO? ON-CABLE? /?L28
	EQUAL? PRSO,P?DOWN /?L28
	PRINTI "You go hand-over-hand along the cable."
	CALL GLOBAL-IN?,CABLE,RM >STACK
	ZERO? STACK \?L30
	SET 'ON-CABLE?,0
	PRINTI " You reach the end, drop, and continue on."
?L30:	ZERO? RATS-HERE /?L33
	MOVE RATS,HERE
	PRINTI " The rats follow, red eyes staring upward. Some of the bolder ones leap at your feet, and one hits with a thump."
?L33:	CRLF
	CRLF
?L28:	CALL GOTO,RM >STACK
	RSTACK
?L3:	CALL CANT-GO
	RETURN M-FATAL

	.FUNCT V-WALK-AROUND
	PRINTR "Please use compass directions instead."

	.FUNCT V-WALK-TO
	ZERO? PRSO /?L1
	IN? PRSO,HERE /?L3
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK /?L1
?L3:	PRINTR "It's here!"
?L1:	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT V-WAIT,NUM=3
	EQUAL? PRSO,INTNUM \?L5
	GRTR? P-NUMBER,100 \?L3
	PRINTI "Too long!"
	CRLF
	JUMP ?L5
?L3:	SET 'NUM,P-NUMBER
?L5:	PRINTI "Time passes..."
	CRLF
?L7:	DLESS? 'NUM,0 /?L8
	CALL CLOCKER >STACK
	ZERO? STACK /?L7
?L8:	SET 'CLOCK-WAIT,1
	RETURN CLOCK-WAIT

	.FUNCT V-WAIT-FOR
	EQUAL? PRSO,INTNUM \?L1
	CALL NEW-VERB,V?WAIT
	RTRUE
?L1:	LOC PRSO >STACK
	EQUAL? STACK,HERE,WINNER \?L3
	PRINTR "It's already here!"
?L3:	PRINTR "You may well wait quite a while."

	.FUNCT V-WAVE
	CALL HACK-HACK,STR?160 >STACK
	RSTACK

	.FUNCT V-WAVE-AT
	CALL CTHE-PRINT-PRSO
	CALL IS-ARE,PRSO
	PRINTR "n't likely to respond."

	.FUNCT V-WEAR
	FSET? PRSO,WEARBIT \?L1
	PRINT YOU-ARE
	PRINT PERIOD
	RTRUE
?L1:	CALL YOU-CANT-X-PRSO,STR?161 >STACK
	RSTACK

	.FUNCT V-WHAT
	PRINTR "An excellent question."

	.FUNCT V-WHERE
	ZERO? PRSO \?L1
	ZERO? P-IT-OBJECT /?L3
	CALL NEW-PRSO,P-IT-OBJECT
	RTRUE
?L3:	PRINTR "Why?"
?L1:	CALL V-FIND,1 >STACK
	RSTACK

	.FUNCT V-WHO
	ZERO? PRSO \?L1
	CALL V-WHAT >STACK
	RSTACK
?L1:	FSET? PRSO,PERSON \?L3
	CALL NEW-VERB,V?WHAT
	RTRUE
?L3:	PRINTR "That's not a person!"

	.FUNCT V-YAWN
	CALL V-LEAN-ON >STACK
	RSTACK

	.FUNCT V-YELL
	PRINTI "The scream echoes back to you, subtly changed."
	CRLF
	CALL PRINT-ID,STR?162 >STACK
	RSTACK

	.FUNCT ITAKE,VB=1,CNT,OBJ,?TMP
	FSET? PRSO,TAKEBIT /?L1
	ZERO? VB /FALSE
	CALL TELL-YUKS
	RFALSE
?L1:	IN? PRSO,WINNER \?L6
	PRINT YOU-HAVE
	PRINTI "it"
	PRINT PERIOD
	RFALSE
?L6:	EQUAL? PRSO,CHAIN-1,CHAIN-2 \?L7
	CALL HELD?,CHAIN >STACK
	ZERO? STACK /?L7
	REMOVE PRSO
	RTRUE
?L7:	LOC PRSO >STACK
	IN? STACK,WINNER /?L8
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,WINNER >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,LOAD-ALLOWED \?L8
	ZERO? VB /?L9
	FIRST? PLAYER >STACK \?L11
	PRINTI "Your load is too heavy"
	JUMP ?L13
?L11:	PRINTI "It's a little too heavy"
?L13:	LESS? LOAD-ALLOWED,LOAD-MAX \?L14
	PRINTI ", especially in light of your exhaustion."
	JUMP ?L16
?L14:	PRINTI "."
?L16:	CRLF
?L9:	RETURN M-FATAL
?L8:	CALL CCOUNT,WINNER >CNT
	GRTR? CNT,FUMBLE-NUMBER \?L18
	ZERO? VB /?L19
	PRINTI "You're holding too many things and can't quite get them all arranged to take it as well."
	CRLF
?L19:	RETURN M-FATAL
?L18:	FSET? PRSO,SLIMEBIT \?L23
	CALL QUEUE,I-SLIME-OBJECT,1
?L23:	CALL SCORE-OBJECT
	MOVE PRSO,WINNER
	FCLEAR PRSO,WEARBIT
	FCLEAR PRSO,NDESCBIT
	RTRUE

	.FUNCT SCORE-OBJECT,OBJ=0
	ZERO? OBJ \?L3
	SET 'OBJ,PRSO
	FSET? OBJ,TOUCHBIT /TRUE
?L3:	GETPT OBJ,P?VALUE >STACK
	ZERO? STACK /?L7
	GETP OBJ,P?VALUE >STACK
	ADD SCORE,STACK >SCORE
	PUTP OBJ,P?VALUE,0
?L7:	FSET OBJ,TOUCHBIT
	RTRUE

	.FUNCT IDROP
	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L1
	PRINT YOU-ARENT
	PRINTI "carrying "
	CALL THE-PRSO
	RFALSE
?L1:	IN? PRSO,WINNER /?L3
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L3
	CALL THIS-IS-IT,PRSO
	LOC PRSO >STACK
	CALL TELL-OPEN-CLOSED,STACK
	RFALSE
?L3:	FCLEAR PRSO,WEARBIT
	LOC WINNER >STACK
	MOVE PRSO,STACK
	RTRUE

	.FUNCT CCOUNT,OBJ,CNT=0,X,X?1
	FIRST? OBJ >X?1 \?L3
?L1:	EQUAL? X?1,HAND \?L4
	FSET? HAND,PERSON /?L7
?L4:	FSET? X?1,WEARBIT /?L7
	INC 'CNT
?L7:	NEXT? X?1 >X?1 /?L1
?L3:	RETURN CNT

	.FUNCT WEIGHT,OBJ,CONT,WT=0,CONT?1
	EQUAL? OBJ,HAND \?L1
	FSET? HAND,PERSON /TRUE
?L1:	FSET? OBJ,WEARBIT /FALSE
	FIRST? OBJ >CONT?1 \?L6
?L4:	CALL WEIGHT,CONT?1 >STACK
	ADD WT,STACK >WT
	NEXT? CONT?1 >CONT?1 /?L4
?L6:	GETP OBJ,P?SIZE >STACK
	ADD WT,STACK >STACK
	RSTACK

	.FUNCT GOTO,RM,V?=1,OLIT
	SET 'OHERE,RM
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LEAVE >STACK
	SET 'OHERE,HERE
	SET 'OLIT,LIT
	LOC WINNER >STACK
	IN? STACK,ROOMS /?L1
	LOC WINNER >STACK
	MOVE STACK,RM
	JUMP ?L3
?L1:	MOVE WINNER,RM
?L3:	SET 'HERE,RM
	CALL LIT?,HERE >LIT
	ZERO? OLIT \?L4
	ZERO? LIT \?L4
	RANDOM 100 >STACK
	LESS? 80,STACK /?L4
	CALL PRINT-ID,STR?163
	CALL JIGS-UP,STR?99
	RTRUE
?L4:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	EQUAL? HERE,RM \TRUE
	ZERO? V? /?L9
	CALL V-FIRST-LOOK
?L9:	ZERO? LIT /TRUE
	CALL SCORE-OBJECT,RM
	RTRUE

	.FUNCT JIGS-UP,DESC=0,FROB?=0
	SET 'WINNER,PLAYER
	ZERO? DESC /?L1
	PRINT DESC
?L1:	PRINTI "

   ****  You have "
	ZERO? FROB? /?L4
	PRINTI "changed"
	JUMP ?L6
?L4:	PRINTI "died"
?L6:	PRINTI "  ****

"
	ZERO? FROB? /?L7
	PRINTI "Sometimes, during your future existence, you remember your old life. At these times, you wish you had died instead."
	CRLF
	JUMP ?L9
?L7:	PRINTI "At first, you think ""Maybe it was all just a bad dream,"" but no such luck. It appears to be for real. That's too bad, although something gnawing on your "
	CALL RANDOM-ELEMENT,PARTS >STACK
	PRINT STACK
	PRINTI " thinks it's pretty wonderful, or at least fairly tasty."
	CRLF
?L9:	CALL FINISH >STACK
	RSTACK

	.FUNCT ROB,FROM,TO,IGNORE=0,F,N,1ST?=0
	FIRST? FROM >F /?L16
	RETURN 1ST?
?L1:	ZERO? F /?L3
?L16:	NEXT? F >N /?L6
?L6:	EQUAL? TO,URCHIN \?L7
	EQUAL? F,VAT,HAND,CHAIN /?L13
	EQUAL? F,FLOOR-WAX,DOME-LADDER,MANHOLE-COVER /?L13
	EQUAL? F,PLASTIC-CONTAINER,CHAIR,PC /?L13
	EQUAL? F,LOVECRAFT /?L13
?L7:	FSET? F,TAKEBIT \?L13
	FSET? F,TOUCHBIT \?L13
	EQUAL? F,IGNORE /?L13
	SET '1ST?,1
	ZERO? TO /?L11
	MOVE F,TO
	JUMP ?L13
?L11:	REMOVE F
?L13:	SET 'F,N
	JUMP ?L1
?L3:	RETURN 1ST?

	.FUNCT THIS-IS-IT,OBJ
	EQUAL? OBJ,IT,HIM /FALSE
	EQUAL? OBJ,HACKER,MAINTENANCE-MAN,PROFESSOR /?L5
	EQUAL? OBJ,URCHIN \?L3
?L5:	ZERO? WAS-HIM? \FALSE
	SET 'P-HIM-OBJECT,OBJ
	RETURN P-HIM-OBJECT
?L3:	ZERO? WAS-IT? \FALSE
	SET 'P-IT-OBJECT,OBJ
	RETURN P-IT-OBJECT

	.FUNCT INTRINSIC?,OBJ
	EQUAL? OBJ,ME,HANDS,HEAD /TRUE
	EQUAL? OBJ,EYES,FEET \FALSE
	RTRUE

	.FUNCT ACCESSIBLE?,OBJ,L,?TMP
	LOC OBJ >L
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? OBJ,PSEUDO-OBJECT \?L3
	EQUAL? LAST-PSEUDO-LOC,HERE \FALSE
	RTRUE
?L3:	ZERO? L /FALSE
	EQUAL? L,GLOBAL-OBJECTS /TRUE
	EQUAL? L,LOCAL-GLOBALS \?L9
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	ZERO? STACK \TRUE
?L9:	CALL META-LOC,OBJ >?TMP
	LOC WINNER >STACK
	EQUAL? ?TMP,HERE,STACK \FALSE
	LOC WINNER >STACK
	EQUAL? L,WINNER,HERE,STACK /TRUE
	FSET? L,OPENBIT \FALSE
	CALL ACCESSIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT VISIBLE?,OBJ,L
	LOC OBJ >L
	CALL ACCESSIBLE?,OBJ >STACK
	ZERO? STACK \TRUE
	CALL SEE-INSIDE?,L >STACK
	ZERO? STACK /FALSE
	CALL VISIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT META-LOC,OBJ
?L1:	ZERO? OBJ /FALSE
	IN? OBJ,GLOBAL-OBJECTS \?L5
	RETURN GLOBAL-OBJECTS
?L5:	IN? OBJ,ROOMS \?L7
	RETURN OBJ
?L7:	LOC OBJ >OBJ
	JUMP ?L1

	.FUNCT HELD?,OBJ,WHO=0
	ZERO? WHO \?L1
	SET 'WHO,PLAYER
?L1:	ZERO? OBJ /FALSE
	IN? OBJ,WHO /TRUE
	IN? OBJ,ROOMS /FALSE
	IN? OBJ,GLOBAL-OBJECTS /FALSE
	LOC OBJ >STACK
	CALL HELD?,STACK,WHO >STACK
	RSTACK

	.FUNCT SEE-INSIDE?,OBJ
	ZERO? OBJ /FALSE
	FSET? OBJ,INVISIBLE /FALSE
	FSET? OBJ,TRANSBIT /TRUE
	FSET? OBJ,OPENBIT /TRUE
	RFALSE

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,TEE
	ZERO? OBJ2 /FALSE
	GETPT OBJ2,P?GLOBAL >TEE
	ZERO? TEE /FALSE
	PTSIZE TEE >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,TEE,STACK >STACK
	RSTACK

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR >STACK
	RSTACK

	.FUNCT HACK-HACK,STR
	PRINT STR
	PRINTI " "
	CALL THE-PRINT-PRSO
	PRINTR " has no effect."

	.FUNCT TELL-YUKS
	CALL PICK-ONE,YUKS >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT PRE-PRY
	ZERO? PRSI /FALSE
	CALL INTRINSIC?,PRSI >STACK
	ZERO? STACK \FALSE
	CALL HELD?,PRSI >STACK
	ZERO? STACK \FALSE
	IN? WINNER,PRSI /FALSE
	FSET? PRSI,VEHBIT /FALSE
	CALL NOT-HOLDING,PRSI >STACK
	RSTACK

	.FUNCT V-PRY
	CALL V-TURN >STACK
	RSTACK

	.FUNCT V-BURY
	PRINTI "You can never tell what will happen to something you bury."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?164,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?165,STACK
	EQUAL? PRSO,ME,EYES,HEAD /?L1
	PUSH 0
	JUMP ?L2
?L1:	PUSH 1
?L2:	CALL PRINT-ID,STR?166,STACK >STACK
	RSTACK

	.FUNCT V-YES
	PRINTR "That was a rhetorical question."

	.FUNCT V-NO
	CALL V-YES >STACK
	RSTACK

	.FUNCT V-BUY
	CALL UNINTERESTED,PRSI >STACK
	RSTACK

	.FUNCT PRE-SSELL
	CALL SWAP-VERB,V?SELL
	RTRUE

	.FUNCT V-SSELL
	RTRUE

	.FUNCT V-SELL
	CALL UNINTERESTED,PRSI >STACK
	RSTACK

	.FUNCT PRE-TELL-ABOUT
	EQUAL? PRSO,ME \FALSE
	CALL PERFORM,V?TELL-ME-ABOUT,PRSI
	RTRUE

	.FUNCT V-TELL-ABOUT
	CALL HELD?,PRSI >STACK
	ZERO? STACK /?L1
	CALL SWAP-VERB,V?SHOW
	RTRUE
?L1:	CALL ACCESSIBLE?,PRSI >STACK
	ZERO? STACK /?L3
	CALL NEW-VERB,V?ASK-ABOUT
	RTRUE
?L3:	CALL UNINTERESTED,PRSO >STACK
	RSTACK

	.FUNCT V-TELL-ME-ABOUT
	EQUAL? WINNER,PLAYER \?L1
	CALL MENTAL-COLLAPSE >STACK
	RSTACK
?L1:	CALL UNINTERESTED,WINNER >STACK
	RSTACK

	.FUNCT V-TRADE
	ZERO? PRSI /?L1
	FSET? PRSI,PERSON \?L1
	CALL UNINTERESTED,PRSI >STACK
	RSTACK
?L1:	EQUAL? WINNER,PLAYER \?L3
	ZERO? PRSI /?L3
	FSET? PRSO,PERSON /?L3
	IN? HACKER,HERE \?L4
	SET 'WINNER,HACKER
	CALL NEW-VERB,PRSA
	SET 'WINNER,PLAYER
	RTRUE
?L4:	PRINTR "No one here is interested in trading."
?L3:	CALL V-BARGAIN >STACK
	RSTACK

	.FUNCT V-ERASE
	CALL TELL-YUKS
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?167,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?168,STACK
	EQUAL? PRSO,ME /?L1
	PUSH 0
	JUMP ?L2
?L1:	PUSH 1
?L2:	CALL PRINT-ID,STR?169,STACK >STACK
	RSTACK

	.FUNCT V-ADMIRE
	PRINTR "Your taste is unusual."

	.FUNCT V-BARGAIN
	PRINTR "What are you, an M.B.A. student?"

	.FUNCT V-REPAIR
	FSET? PRSO,RMUNGBIT \?L1
	PRINTI "You don't know how."
	CRLF
	CALL PRINT-ID,STR?170 >STACK
	RSTACK
?L1:	CALL CTHE-PRINT-PRSO
	PRINTR " isn't broken."

	.FUNCT V-LOOK-UP
	EQUAL? PRSO,ROOMS \?L1
	PRINTR "Don't get a sore neck."
?L1:	CALL NEW-VERB,V?WHAT
	RTRUE

	.FUNCT V-PLUG-IN
	CALL YOU-CANT-X-THAT,STR?171 >STACK
	RSTACK

	.FUNCT V-UNPLUG
	CALL YOU-CANT-X-THAT,STR?172 >STACK
	RSTACK

	.FUNCT V-EDIT
	CALL YOU-CANT-X-THAT,STR?173 >STACK
	RSTACK

	.FUNCT V-CLICK
	PRINT NOTHING-HAPPENS
	RTRUE

	.FUNCT V-WALK-UNDER
	PRINTI "Only a snake could get under "
	CALL PRINTA-PRSO
	PRINTR "!"

	.FUNCT V-SCARE
	PRINTI "I don't think you scared "
	CALL THE-PRINT-PRSO
	PRINTI " very much."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?174,STACK >STACK
	RSTACK

	.FUNCT V-TYPE
	CALL CANT-USE-COMPUTER? >STACK
	ZERO? STACK \TRUE
	ZERO? USERNAME? \?L3
	CALL NEW-VERB,V?LOGIN
	RTRUE
?L3:	ZERO? LOGGED-IN? \?L4
	CALL NEW-VERB,V?PASSWORD
	RTRUE
?L4:	PRINTI "Nothing interesting happens, "
	FSET? PC,POWERBIT \?L6
	PRINTR "except that a yellow smiling face appears in a small box next to the legend ""Sorry, Syntax Error. Hope you have a nice day anyway."""
?L6:	PRINTR "as the computer is powered off."

	.FUNCT V-WEDGE
	PRINT YOU-CANT
	PRINTI "wedge open "
	CALL PRINTA-PRSO
	PRINTI " with "
	CALL PRINTA-PRSI
	PRINT PERIOD
	RTRUE

	.FUNCT PRE-SWEDGE
	CALL SWAP-VERB,V?WEDGE
	RTRUE

	.FUNCT V-SWEDGE
	RTRUE

	.FUNCT V-PUT-BETWEEN
	PRINT YOU-CANT
	PRINTI "put "
	CALL PRINTA-PRSO
	PRINTI " between "
	CALL PRINTA-PRSI
	PRINT PERIOD
	RTRUE

	.FUNCT V-TASTE
	PRINTI "It tastes exactly as you'd expect "
	CALL PRINTA-PRSO
	PRINTR " to taste, only worse."

	.FUNCT V-DIE
	CALL PERFORM,V?KILL,ME
	RTRUE

	.FUNCT V-HACK
	PRINTI "Your use of such jargon is unconvincing."
	CRLF
	EQUAL? PRSI,AXE /?L2
	PUSH 0
	JUMP ?L1
?L2:	CALL IS-PERSON? >STACK
?L1:	CALL PRINT-ID,STR?175,STACK >STACK
	RSTACK

	.FUNCT V-COOK
	PRINTI "Most people cook things in ovens."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?176,STACK
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?177,STACK >STACK
	RSTACK

	.FUNCT V-DRIVE-ON
	FSET? PRSI,PERSON \?L1
	CALL CTHE-PRINT-PRSI
	PRINTR " moves out of the way."
?L1:	PRINT GOOD-TRICK
	RTRUE

	.FUNCT V-DRIVE-TO
	IN? WINNER,PRSO \?L1
	EQUAL? PRSI,INTDIR \?L1
	CALL DO-WALK,P-DIRECTION >STACK
	RSTACK
?L1:	PRINT GOOD-TRICK
	RTRUE

	.FUNCT V-STEP-ON
	FSET? PRSO,VEHBIT \?L1
	CALL NEW-VERB,V?BOARD
	RTRUE
?L1:	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT V-STOP
	PRINT NOTHING-HAPPENS
	RTRUE

	.FUNCT V-RELEASE
	CALL NEW-VERB,V?DROP
	RTRUE

	.FUNCT V-PUSH-DOWN
	EQUAL? PRSO,ROOMS \?L1
	CALL GLOBAL-IN?,DOWN-BUTTON,HERE >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?PUSH,DOWN-BUTTON
	RTRUE
?L1:	CALL NO-BUTTON,DOWN-BUTTON >STACK
	RSTACK

	.FUNCT NO-BUTTON,OBJ
	PRINTI "There's no "
	CALL DPRINT,OBJ
	PRINTR " here."

	.FUNCT V-PUSH-UP
	EQUAL? PRSO,ROOMS \?L1
	CALL GLOBAL-IN?,UP-BUTTON,HERE >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?PUSH,UP-BUTTON
	RTRUE
?L1:	CALL NO-BUTTON,UP-BUTTON >STACK
	RSTACK

	.FUNCT V-PRAY
	PRINTR "You get an empty feeling."

	.FUNCT PRE-SPUT-ON
	CALL SWAP-VERB,V?PUT-ON
	RTRUE

	.FUNCT V-SPUT-ON
	RTRUE

	.FUNCT SOUNDS,N,OP=S-START,VOL=8
	ZERO? OP \?L1
	SET 'OP,S-START
?L1:	GET SOUND-FLAG,0 >STACK
	LESS? STACK,0 \?L4
	EQUAL? OP,S-START \?L4
	PUT SOUND-FLAG,0,1
	CRLF
	PRINTI "[Use $SOUND to toggle sound usage on and off.]"
	CRLF
	CRLF
?L4:	EQUAL? N,S-DRONE,S-ATTACK,S-PSYCHO /?L9
	EQUAL? N,S-MONSTR,S-VOICE,S-ZOMBIE /?L9
	EQUAL? N,S-CRETIN \?L7
?L9:	MUL N,16 >STACK
	ADD STACK,VOL >STACK
	PUT SOUND-FLAG,1,STACK
?L7:	GET SOUND-FLAG,0 >STACK
	ZERO? STACK /FALSE
	EQUAL? OP,S-STOP \?L13
	PUT SOUND-FLAG,0,1
	PUT SOUND-FLAG,1,0
	JUMP ?L17
?L13:	EQUAL? N,S-DRONE,S-ATTACK,S-PSYCHO /?L16
	EQUAL? N,S-MONSTR,S-VOICE,S-ZOMBIE /?L16
	EQUAL? N,S-CRETIN \?L15
?L16:	MUL N,16 >STACK
	ADD STACK,VOL >STACK
	PUT SOUND-FLAG,0,STACK
	MUL N,16 >STACK
	ADD STACK,VOL >STACK
	PUT SOUND-FLAG,1,STACK
	JUMP ?L17
?L15:	PUT SOUND-FLAG,0,1
	PUT SOUND-FLAG,1,0
?L17:	EQUAL? OP,S-START \?L18
	SOUND N,OP,VOL
	RTRUE
?L18:	SOUND N,OP
	RTRUE

	.FUNCT KILL-SOUNDS
	CALL SOUNDS,0,S-STOP
	CALL SOUNDS,0,S-CLEANUP >STACK
	RSTACK

	.FUNCT V-$0024SOUND,X,Y
	GET SOUND-FLAG,1 >X
	GET SOUND-FLAG,0 >Y
	PRINTI "Sound "
	ZERO? Y /?L1
	CALL KILL-SOUNDS
	EQUAL? Y,1 /?L3
	PUT SOUND-FLAG,1,Y
	JUMP ?L5
?L3:	PUT SOUND-FLAG,1,0
?L5:	PUT SOUND-FLAG,0,0
	PRINTR "off."
?L1:	PUT SOUND-FLAG,0,1
	ZERO? X /?L7
?L7:	PRINTR "on."

	.FUNCT INTNUM-F
	EQUAL? PRSO,INTNUM \FALSE
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L3
	CALL REDIRECT,INTNUM,FLOOR-BUTTON
	RTRUE
?L3:	EQUAL? HERE,KITCHEN \?L5
	PUT P-ADJW,0,W?INTNUM
	CALL REDIRECT,INTNUM,CONTROLS
	RTRUE
?L5:	EQUAL? PRSA,V?PUSH \FALSE
	PRINT STR?178
	PRINTR "to push here."

	.FUNCT NOT-HERE-OBJECT-F,TBL,PRSO?=1,X=0,?TMP
	EQUAL? PRSO,NOT-HERE-OBJECT \?L3
	EQUAL? PRSI,NOT-HERE-OBJECT \?L1
	PRINTR "Those things aren't here!"
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L3
	SET 'TBL,P-PRSO
	EQUAL? PRSA,V?FOLLOW,V?WAIT-FOR,V?FIND /?L6
	EQUAL? PRSA,V?TELL,V?WHAT,V?WHERE /?L6
	EQUAL? PRSA,V?WHO \?L8
?L6:	SET 'X,1
	JUMP ?L8
?L3:	SET 'TBL,P-PRSI
	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR,V?TELL-ABOUT \?L9
	SET 'X,1
?L9:	SET 'PRSO?,0
?L8:	ZERO? X /?L26
	CALL FIND-NOT-HERE,TBL,PRSO? >STACK
	ZERO? STACK \?L26
	EQUAL? PRSA,V?FOLLOW \?L14
	PRINTR "I'm afraid that's not possible."
?L14:	EQUAL? PRSA,V?WAIT-FOR \?L16
	EQUAL? PRSO,RATS \?L17
	CALL IN-TUNNEL?,RATS >STACK
	ZERO? STACK /?L17
	CALL IN-TUNNEL? >STACK
	ZERO? STACK /?L17
	PRINTR "All in good time..."
?L17:	CALL PLURAL?,PRSO >STACK
	ZERO? STACK /?L20
	PRINTI "They're"
	JUMP ?L22
?L20:	PRINTI "He's"
?L22:	PRINTR " not expected any time soon."
?L16:	EQUAL? PRSA,V?TELL \FALSE
	LOC PRSO >?TMP
	EQUAL? ?TMP,INF-1,INF-2,INF-3 /?L25
	EQUAL? ?TMP,INF-4,INF-5 \?L26
?L25:	EQUAL? HERE,INF-1,INF-2,INF-3 /FALSE
	EQUAL? HERE,INF-4,INF-5 /FALSE
?L26:	CALL CANT-SEE-ANY-HERE,PRSO? >STACK
	RSTACK

	.FUNCT CANT-SEE-ANY-HERE,PRSO?
	EQUAL? WINNER,PLAYER \?L1
	PRINTI "You"
	JUMP ?L3
?L1:	CALL CTHE-PRINT,WINNER
?L3:	PRINTI " can't see any "
	ZERO? P-OFLAG /?L4
	CALL PRINT-ADJT,P-XADJNT >STACK
	ZERO? STACK /?L6
?L6:	ZERO? P-XNAM /?L12
	PRINTB P-XNAM
	JUMP ?L12
?L4:	CALL THING-PRINT,PRSO?
?L12:	PRINTI " here."
	CRLF
	CALL END-QUOTE >STACK
	RSTACK

	.FUNCT FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ
	CALL MOBY-FIND,TBL >M-F
	EQUAL? 1,M-F \?L1
	ZERO? PRSO? /?L3
	SET 'PRSO,P-MOBY-FOUND
	RFALSE
?L3:	SET 'PRSI,P-MOBY-FOUND
	RFALSE
?L1:	RETURN NOT-HERE-OBJECT

	.FUNCT LIGHT-F
	EQUAL? PRSA,V?LAMP-ON \?L1
	ZERO? LIT /?L3
	PRINT IT-IS-ALREADY
	PRINTI "light"
	PRINT PERIOD
	RTRUE
?L3:	PRINTR "You need a light source!"
?L1:	EQUAL? PRSA,V?LAMP-OFF \FALSE
	PRINT WASTE-OF-TIME
	RTRUE

	.FUNCT GLOBAL-HOLE-F
	EQUAL? PRSA,V?DIG \?L1
	EQUAL? PRSO,GLOBAL-HOLE \?L1
	CALL PERFORM,V?DIG,PRSI
	RTRUE
?L1:	EQUAL? PRSA,V?REACH-IN \FALSE
	PRINT YOU-FIND-NOTHING
	PRINTR " of interest."

	.FUNCT CEILING-F
	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	CALL NEW-VERB,V?LOOK
	RTRUE

	.FUNCT GENERIC-HAND-F
	RETURN HAND

	.FUNCT EYES-F
	EQUAL? PRSA,V?OPEN \?L1
	PRINTR "They are."
?L1:	EQUAL? PRSA,V?CLOSE \?L3
	PRINTR "That won't help."
?L3:	ZERO? LIT \FALSE
	PRINT TOO-DARK
	RTRUE

	.FUNCT PLAYER-F,DOOR
	ZERO? ON-CABLE? /?L1
	EQUAL? PRSA,V?DROP \?L6
	EQUAL? PRSO,ROOMS /?L5
?L6:	EQUAL? PRSA,V?DISEMBARK,V?TAKE,V?TAKE-OFF /?L5
	CALL HOSTILE-VERB? >STACK
	ZERO? STACK \?L5
	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? P-WALK-DIR,P?DOWN \FALSE
?L5:	SET 'ON-CABLE?,0
	PRINTI "You let go of the cable and drop to the floor"
	ZERO? RATS-HERE /?L7
	LESS? RATS-HERE,2 \?L9
	SET 'RATS-HERE,2
?L9:	PRINTI " among the now-frenzied rats"
?L7:	PRINT PERIOD
	RTRUE
?L1:	ZERO? HOLDING-DOORS? /FALSE
	CALL THIS-FLOOR-DOOR >DOOR
	EQUAL? PRSO,ELEVATOR-DOOR,DOOR /FALSE
	EQUAL? PRSI,ELEVATOR-DOOR,DOOR /FALSE
	CALL GAME-VERB? >STACK
	ZERO? STACK \FALSE
	CALL PASSIVE-VERB? >STACK
	ZERO? STACK \FALSE
	PRINT HOLDING-IS-ALL
	CRLF
	RTRUE

	.FUNCT MENTAL-COLLAPSE
	PRINTR "Talking to yourself is a sign of impending mental collapse."

	.FUNCT ME-F,OLIT
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? PRSO,ME \?L1
	CALL V-DIAGNOSE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?TELL,V?HELP \?L3
	CALL MENTAL-COLLAPSE
	CALL END-QUOTE >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?LISTEN \?L4
	PRINTR "Yes?"
?L4:	EQUAL? PRSA,V?WAKE \?L5
	PRINT YOU-ARE
	PRINT PERIOD
	RTRUE
?L5:	EQUAL? WINNER,PLAYER \?L6
	EQUAL? PRSA,V?GIVE \?L6
	EQUAL? PRSO,ME \?L7
	PRINT WASTE-OF-TIME
	RTRUE
?L7:	EQUAL? PRSI,ME \FALSE
	IN? PRSO,PLAYER \?L10
	CALL PRE-TAKE >STACK
	RSTACK
?L10:	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L6:	EQUAL? PRSA,V?MOVE \?L14
	CALL V-WALK-AROUND >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?SEARCH \?L15
	CALL V-INVENTORY
	RTRUE
?L15:	EQUAL? PRSA,V?KILL,V?MUNG,V?BURY /?L17
	EQUAL? PRSA,V?SMELL \?L16
?L17:	EQUAL? PRSA,V?SMELL /?L18
	PUSH 1
	JUMP ?L19
?L18:	PUSH 0
?L19:	CALL PRINT-ID,STR?179,STACK
	CALL JIGS-UP,STR?180
	RTRUE
?L16:	EQUAL? PRSA,V?WHO \?L20
	CALL V-WHAT >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?FOLLOW \?L21
	PRINTR "You're getting ahead of yourself."
?L21:	EQUAL? PRSA,V?LOOK-BEHIND \FALSE
	PRINTI "You look back over your shoulder. "
	RANDOM 100 >STACK
	LESS? 80,STACK /?L23
	PRINT STR?181
	PRINTR "there."
?L23:	RANDOM 100 >STACK
	LESS? 80,STACK /?L25
	PRINTR "Was that a flicker of movement in the distance?"
?L25:	PRINTR "You see something duck back into the shadows."

	.FUNCT GLOBAL-ROOM-F
	EQUAL? PRSA,V?LOOK,V?EXAMINE,V?LOOK-INSIDE \?L1
	CALL V-LOOK
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \?L3
	EQUAL? PRSI,GLOBAL-ROOM \?L3
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L3:	EQUAL? PRSA,V?THROUGH,V?WALK-TO \?L4
	CALL V-WALK-AROUND >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?DROP,V?LEAVE,V?EXIT \?L5
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?WALK-AROUND \?L6
	PRINTR "Walking around the room reveals nothing new. To move elsewhere, just type the desired direction."
?L6:	EQUAL? PRSA,V?LAMP-ON \FALSE
	CALL NEW-PRSO,LIGHT
	RTRUE

	.FUNCT GENERIC-WALL-F
	RETURN WALL

	.FUNCT WALL-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINT IT-LOOKS-LIKE
	PRINTR "a wall."
?L1:	EQUAL? PRSA,V?LOWER,V?MUNG \FALSE
	PRINT YOU-CANT
	PRINTI "pull down a wall that easily."
	CRLF
	EQUAL? PRSA,V?MUNG /?L4
	PUSH 0
	JUMP ?L5
?L4:	PUSH 1
?L5:	CALL PRINT-ID,STR?182,STACK >STACK
	RSTACK

	.FUNCT GROUND-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's still there."
?L1:	EQUAL? PRSA,V?PUT \?L5
	EQUAL? PRSI,GROUND \?L5
	CALL PERFORM,V?BURY,PRSO
	RTRUE
?L5:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON,V?CLIMB-FOO /?L7
	EQUAL? PRSA,V?BOARD \?L6
?L7:	PRINT WASTE-OF-TIME
	RTRUE
?L6:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	PRINTR "You never did master X-rays. Freshman physics was such a drag."

	.FUNCT CORRIDOR-F
	EQUAL? PRSA,V?THROUGH,V?WALK-TO \?L1
	CALL V-WALK-AROUND >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?FOLLOW,V?CLIMB-DOWN \?L3
	EQUAL? HERE,YUGGOTH,BOWL-ROOM,PLATFORM-ROOM \?L3
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?CLIMB-DOWN \FALSE
	EQUAL? HERE,DEAD-STORAGE \FALSE
	CALL DO-WALK,P?EAST >STACK
	RSTACK

	.FUNCT RANDOM-PSEUDO
	EQUAL? P-PNAM,W?SHAFT \?L1
	EQUAL? PRSA,V?EXAMINE,V?LOOK-UP \?L1
	CALL LIKE-A-SHAFT >STACK
	RSTACK
?L1:	EQUAL? P-PNAM,W?TRIANGLE \?L3
	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "It's ""Floppy Triangles,"" a work of modern sculpture."
?L3:	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE,V?LOOK-BEHIND \?L4
	PRINT STR?110
	PRINTR "it."
?L4:	EQUAL? PRSA,V?TAKE \FALSE
	CALL YOU-CANT-X-THAT,STR?183 >STACK
	RSTACK

	.FUNCT GLOBAL-SLEEP-F
	EQUAL? PRSA,V?WALK-TO,V?TAKE \?L1
	CALL NEW-VERB,V?SLEEP
	RTRUE
?L1:	EQUAL? PRSA,V?FIND \FALSE
	PRINTR "Sleep anywhere."

	.FUNCT SNOW-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	FSET? HERE,OUTSIDE \?L3
	PRINTR "It's still coming down."
?L3:	PRINTR "You are inside."

	.FUNCT OFFICE-DOOR-F
	PRINTR "The offices are inaccessible."

	.FUNCT GENERIC-DOOR-F
	EQUAL? HERE,CHEMISTRY-BLDG \?L1
	RETURN ALCHEMY-DOOR
?L1:	EQUAL? HERE,INF-1,INF-3 \FALSE
	RETURN OUTSIDE-DOOR

	.FUNCT SMITH-ST-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTD SMITH-ST
	PRINTR " runs east and west along the north side of the main campus area. At the moment, it is an arctic wasteland of howling wind and drifting snow. On the other side of the street, barely visible, are the lidless eyes of streetlights. The street hasn't been plowed, or if it has been, it did no good."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? OHERE,SMITH-ST-2 /FALSE
	CALL EXIT-TO-COLD >STACK
	RSTACK

	.FUNCT SMITH-ST-2-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTD SMITH-ST
	PRINTR " runs west towards the computer center here. To the south is a dilapidated grey wooden building. The street is an impassable sea of blowing and drifting snow."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? OHERE,TEMPORARY-LAB \FALSE
	CALL EXIT-TO-COLD >STACK
	RSTACK

	.FUNCT I-FREEZE-TO-DEATH
	FSET? HERE,OUTSIDE \FALSE
	IGRTR? 'FREEZE-COUNT,5 \?L3
	CRLF
	CALL PRINT-ID,STR?184
	CALL JIGS-UP,STR?185 >STACK
	RSTACK
?L3:	CALL QUEUE,I-FREEZE-TO-DEATH,4
	CRLF
	GET FREEZING,FREEZE-COUNT >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT CS-BEGS
	EQUAL? PRSA,V?WALK \?L1
	EQUAL? P-WALK-DIR,P?SOUTH /?L1
	EQUAL? HERE,CS-BASEMENT \?L3
	EQUAL? P-WALK-DIR,P?DOWN,P?IN /?L1
?L3:	CALL MOVE-FROM-DOORS >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?ENTER \FALSE
	ZERO? PRSO \FALSE
	CALL NEW-PRSO,ELEVATOR
	RTRUE

	.FUNCT COMP-CENTER-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINT THE-LOBBY
	PRINTD COMP-CENTER
	PRINTI ". "
	CALL ELEVATOR-AND-BUTTONS
	PRINTI "to the south."
	CALL DESCRIBE-STAIRS
	PRINT STR?186
	PRINTD SMITH-ST
	PRINTR "."
?L1:	EQUAL? RARG,M-BEG \?L3
	CALL CS-BEGS >STACK
	RSTACK
?L3:	EQUAL? RARG,M-ENTER \FALSE
	CALL EXIT-FROM-COLD >STACK
	RSTACK

	.FUNCT DESCRIBE-ELEVATOR-AND-BUTTONS
	PRINTI " floor of the "
	PRINTD COMP-CENTER
	PRINTI ". "
	CALL ELEVATOR-AND-BUTTONS
	PRINTI "on the south side of the hallway."
	RTRUE

	.FUNCT ELEVATOR-AND-BUTTONS
	PRINTI "An elevator and call button"
	EQUAL? HERE,CS-3RD,CS-BASEMENT /?L1
	PRINTI "s"
?L1:	PRINTI " are "
	RTRUE

	.FUNCT CS-2ND-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is the second"
	CALL DESCRIBE-ELEVATOR-AND-BUTTONS
	PRINTI " A large, noisy room is to the north."
	CALL DESCRIBE-STAIRS
	PRINTR "To the west a corridor leads into a smaller room."
?L1:	EQUAL? RARG,M-BEG \FALSE
	CALL CS-BEGS >STACK
	RSTACK

	.FUNCT CS-3RD-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is the third"
	CALL DESCRIBE-ELEVATOR-AND-BUTTONS
	CALL DESCRIBE-STAIRS
	PRINT STR?186
	PRINTR "a glass wall beyond which you can see a computer room crammed with computer equipment. A stairway leads up."
?L1:	EQUAL? RARG,M-BEG \FALSE
	CALL CS-BEGS >STACK
	RSTACK

	.FUNCT CS-ROOF-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is the roof of the "
	PRINTD COMP-CENTER
	PRINTR ". A door leads to the stairway. The roof is covered with tarred pea gravel and drifted snow. The wind howls around your ears. To the south and southeast you can dimly see the looming shapes of the Great Dome and the Brown Building."
?L1:	EQUAL? RARG,M-BEG \?L3
	CALL ROOF-BEGS >STACK
	RSTACK
?L3:	EQUAL? RARG,M-ENTER \?L4
	PRINTI "You push through the door to the roof. "
	CALL EXIT-TO-COLD >STACK
	RSTACK
?L4:	EQUAL? RARG,M-LEAVE \FALSE
	CALL EXIT-FROM-COLD >STACK
	RSTACK

	.FUNCT HACKER-EXIT
	CALL HELD?,PC >STACK
	ZERO? STACK \?L3
	CALL HELD?,CHAIR >STACK
	ZERO? STACK /?L1
?L3:	PRINT HACKER-PREVENTS
	PRINT YOU-CANT
	PRINTI "walk off with that! It's Tech property!"""
	CRLF
	CALL PRINT-ID,STR?187
	RFALSE
?L1:	RETURN CS-2ND

	.FUNCT TERMINAL-ROOM-F,RARG
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?TELL /?L3
	CALL GAME-VERB? >STACK
	ZERO? STACK \FALSE
?L3:	CALL QUEUED?,I-HACKER-HELPS >STACK
	ZERO? STACK /?L5
	EQUAL? PRSA,V?RUB,V?POINT,V?CLICK /?L8
	EQUAL? PRSA,V?HELP \FALSE
?L8:	EQUAL? PRSO,MENU-BOX,MORE-BOX,0 \FALSE
	PRINT HACKER-PREVENTS
	PRINTR "Who's the hacker here?"" he snarls."
?L5:	CALL QUEUED?,I-COMPULSION >STACK
	ZERO? STACK /FALSE
	EQUAL? PRSA,V?RUB,V?POINT,V?CLICK /?L13
	EQUAL? PRSA,V?PUSH,V?ATTACK \?L11
?L13:	EQUAL? PRSO,MORE-BOX /FALSE
?L11:	EQUAL? PRSA,V?READ \?L14
	EQUAL? PRSO,ODD-PAPER /FALSE
?L14:	EQUAL? PRSA,V?TELL,V?HELLO \?L16
	PRINTI "Your throat tightens, and no sound issues forth. "
	JUMP ?L18
?L16:	EQUAL? PRSA,V?INVENTORY,V?LAMP-OFF \?L18
	PRINTI "Your body refuses to obey your brain's command. "
?L18:	PRINTI "Instead, you find your finger moving towards the MORE box, and you touch it. The screen feels oddly cold."
	CRLF
	EQUAL? PRSA,V?TELL \TRUE
	CALL END-QUOTE >STACK
	RSTACK
?L1:	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? OHERE,PLATFORM-ROOM \FALSE
	CALL QUEUE,I-HACKER-HELPS,-1
	PRINTI "You are awakened by the thump of your head hitting the terminal in front of you. Falling asleep over term papers! It must have been a nightmare. Embarrassed, you glance around. Yes, the hacker is looking in your direction. He must have heard the thump."
	CRLF
	CRLF
	RTRUE

	.FUNCT I-HACKER-HELPS
	EQUAL? HERE,TERMINAL-ROOM \?L1
	INC 'HACKER-HELP
	CRLF
	EQUAL? HACKER-HELP,1 \?L3
	PRINT STR?188
	PRINTI "over, trying to look nonchalant"
	IN? PLAYER,CHAIR \?L5
	MOVE PLAYER,HERE
	FCLEAR HACKER,CONTBIT
	MOVE HACKER,CHAIR
	PRINTI " as he takes over your chair"
?L5:	PRINTI ". ""Losing, huh?"" he asks wittily. He "
	FSET? PC,POWERBIT \?L8
	PRINTI "glances at"
	JUMP ?L10
?L8:	PRINTI "turns on"
?L10:	PRINTR " your terminal, which displays a pattern of snow and unusual characters. He appears somewhat excited."
?L3:	EQUAL? HACKER-HELP,2 \?L11
	PRINTR "The hacker, mumbling under his breath, begins a flurry of activity. First the screen returns to something nearly normal, then windows begin popping up like toadstools after a rain. The screen looks a lot like the top of his terminal table (or the bottom of a trash can)."
?L11:	EQUAL? HACKER-HELP,3 \?L12
	PRINTR "The hacker types furiously, and the screen displays what to you looks like an explosion in a teletype factory. After a while he says. ""Chomping file system. Your directory has gone seriously west. I fixed it."" He checks the screen. ""It was mixed up on the file server with some files from the Department of Alchemy."" He grunts. ""People's names for their nodes are getting weird. This one is called 'Lovecraft.'"" He pauses. ""Your paper is gone, though. Sorry. Maybe they could help you down there."""
?L12:	MOVE HACKER,TERMINAL-ROOM
	FSET HACKER,CONTBIT
	CALL DEQUEUE,I-HACKER-HELPS
	PRINT STR?188
	PRINTR "back to his terminal and returns to his hacking."
?L1:	CALL DEQUEUE,I-HACKER-HELPS >STACK
	RSTACK

	.FUNCT CS-PIT-ENTER
	EQUAL? WINNER,URCHIN /FALSE
	FSET? ELEVATOR-DOOR-B,OPENBIT \?L3
	ZERO? ELEVATOR-LOC /?L3
	PRINTI "You drop to the floor below, which isn't all that far down."
	ZERO? HOLDING-DOORS? /?L4
	SET 'HOLDING-DOORS?,0
	FCLEAR ELEVATOR-DOOR-B,OPENBIT
	CALL ELEVATOR-WANTED?
	PRINTI " The doors shut as soon as you release them"
	CALL IN-DARK?
	JUMP ?L6
?L4:	CRLF
?L6:	CRLF
	RETURN ELEVATOR-PIT
?L3:	CALL CANT-GO
	RFALSE

	.FUNCT CS-BASEMENT-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "Bare concrete walls line a wide corridor leading east and west. "
	CALL ELEVATOR-AND-BUTTONS
	PRINTI "to the south."
	CALL DESCRIBE-STAIRS
	PRINT STR?189
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	CALL CS-BEGS >STACK
	RSTACK

	.FUNCT DEAD-STORAGE-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is a storage room. It contains an incredible assemblage of discarded junk. Some of it is so old and mouldering that you can't be sure where one bit of junk stops and the next begins. It's piled to the ceiling on ancient, rotting pallets"
	LESS? JUNK-MOVED?,JUNK-MOVES-NEEDED \?L3
	PRINTR "; you can't even see the east wall."
?L3:	PRINTR ". A narrow path winds eastward through the junk."
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROUGH \?L7
	EQUAL? PRSO,ROOMS \?L7
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?MOVE \FALSE
	EQUAL? PRSO,CORRIDOR \FALSE
	CALL NEW-PRSO,JUNK
	RTRUE

	.FUNCT STORAGE-EXIT
	EQUAL? WINNER,URCHIN /FALSE
	GRTR? JUNK-MOVED?,JUNK-MOVES-NEEDED \?L3
	RETURN STORAGE-ROOM
?L3:	ZERO? JUNK-MOVED? /?L4
	PRINTI "There is still no path all the way through the junk, but you can now tell for sure that there's a room to the east."
	CRLF
	RFALSE
?L4:	PRINTI "You climb around on the junk for a while, and you get the impression that there is an opening 'way on the east wall, but there is so much stuff in the way that you can't get to it."
	CRLF
	RFALSE

	.FUNCT JUNK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "Looking more closely only emphasizes how completely entropy has taken over this room."
?L1:	EQUAL? PRSA,V?MOVE,V?PRY \?L3
	PRINTR "You have obviously underestimated the amount of junk in here. It's not only voluminous, it's heavy."
?L3:	EQUAL? PRSA,V?SEARCH \FALSE
	PRINTR "You find many worthless items of hardware, old discarded memos and papers, but nothing of any use or value."

	.FUNCT FORKLIFT-F,RARG=0,O
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?OPEN \?L3
	EQUAL? PRSO,MANHOLE-COVER \?L3
	EQUAL? PRSI,FORKLIFT /FALSE
?L3:	EQUAL? PRSA,V?LEAP,V?BOARD,V?MUNG \?L5
	ZERO? PRSO /?L5
	IN? PRSO,FORKLIFT /?L5
	EQUAL? PRSO,FORKLIFT /?L5
	CALL PERFORM,V?DRIVE-ON,FORKLIFT,PRSO
	RTRUE
?L5:	EQUAL? PRSA,V?DRIVE-ON,V?DRIVE-TO /FALSE
	EQUAL? PRSA,V?THROUGH \?L7
	EQUAL? PRSO,JUNK \?L7
	PRINTI "The forklift isn't that powerful."
	CRLF
	CALL PRINT-ID,STR?190 >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?WALK \?L8
	EQUAL? P-WALK-DIR,P?DOWN \?L9
	CALL PERFORM,V?DISEMBARK
	RTRUE
?L9:	FSET? FORKLIFT,POWERBIT /?L11
	PRINT YOU-CANT
	PRINTI "go anywhere in"
	PRINT A-DEAD-FORKLIFT
	CRLF
	RTRUE
?L11:	IN? FORKLIFT,DEAD-STORAGE \?L12
	EQUAL? P-WALK-DIR,P?EAST \?L12
	GRTR? JUNK-MOVED?,JUNK-MOVES-NEEDED \?L13
	CALL GOTO,STORAGE-ROOM >STACK
	RSTACK
?L13:	ZERO? JUNK-MOVED? \?L15
	PRINTR "There is no path through the junk for you, much less for a forklift."
?L15:	PRINT YOU-HAVE-TO
	PRINTR "move some more junk first, I'm afraid."
?L12:	IN? FORKLIFT,AERO-BASEMENT \?L19
	EQUAL? P-WALK-DIR,P?WEST,P?UP /?L18
?L19:	IN? FORKLIFT,TEMPORARY-BASEMENT \?L17
	EQUAL? P-WALK-DIR,P?UP \?L17
?L18:	PRINT FORKLIFT-WONT-FIT
	PRINTR "stairwell."
?L17:	IN? FORKLIFT,CS-BASEMENT \FALSE
	EQUAL? P-WALK-DIR,P?SOUTH,P?IN,P?DOWN \?L21
	FSET? ELEVATOR-DOOR-B,OPENBIT \?L21
	PRINT FORKLIFT-WONT-FIT
	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK /?L23
	PRINTR "elevator."
?L23:	PRINTR "shaft."
?L21:	EQUAL? P-WALK-DIR,P?UP \FALSE
	PRINT FORKLIFT-WONT-FIT
	PRINTR "stairwell."
?L8:	EQUAL? PRSA,V?LAMP-ON \?L29
	EQUAL? PRSO,FORKLIFT \?L29
	FSET? PRSO,POWERBIT /?L30
	FSET FORKLIFT,POWERBIT
	PRINTR "The forklift sputters to life."
?L30:	PRINTR "It's wheezing away already."
?L29:	EQUAL? PRSA,V?LAMP-OFF,V?STOP \?L33
	EQUAL? PRSO,FORKLIFT \?L33
	FSET? PRSO,POWERBIT \?L34
	FCLEAR FORKLIFT,POWERBIT
	PRINTR "The forklift coughs once, and dies."
?L34:	CALL ITS-ALREADY-X,STR?191 >STACK
	RSTACK
?L33:	EQUAL? PRSA,V?MOVE /?L38
	EQUAL? PRSA,V?PRY \?L37
	EQUAL? PRSI,FORKLIFT \?L37
?L38:	ZERO? LIT \?L39
	PRINT TOO-DARK
	RTRUE
?L39:	FSET? FORKLIFT,POWERBIT /?L41
	PRINT YOU-CANT
	PRINTI "move anything with"
	PRINT A-DEAD-FORKLIFT
	CRLF
	RTRUE
?L41:	EQUAL? PRSO,JUNK \?L42
	EQUAL? HERE,STORAGE-ROOM \?L43
	PRINT STR?181
	PRINTR "on pallets here, hence the forklift is useless."
?L43:	ZERO? JUNK-MOVED? \?L45
	SET 'JUNK-MOVED?,1
	PRINTR "You have a little trouble using the forklift, but it's not really all that hard. You start clearing junk, moving it around and trying to create a passage."
?L45:	IGRTR? 'JUNK-MOVED?,JUNK-MOVES-NEEDED \?L46
	GRTR? JUNK-MOVED?,4 \?L47
	PRINTR "I suppose you're planning to clear the entire room? You've made a nice path to the next room already."
?L47:	PRINTR "You've built a fairly narrow (about one forklift wide) path through the junk. You can see an opening into a further storage room beyond this one."
?L46:	PRINTR "You continue moving junk, becoming more proficient with the forklift."
?L42:	PRINTI "The forklift is ineffective in manipulating "
	CALL THE-PRINT-PRSO
	PRINT PERIOD
	RTRUE
?L37:	CALL NOT-REACHABLE? >O
	ZERO? O /FALSE
	CALL CANT-REACH-FROM-VEHICLE,O >STACK
	RSTACK
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?EXAMINE \?L55
	PRINTI "This is a rusty "
	FSET? FORKLIFT,POWERBIT \?L57
	PRINTI "and wheezing "
?L57:	PRINTR "old forklift. It looks like you could control it fairly easily, though."
?L55:	EQUAL? PRSA,V?LAMP-ON,V?LAMP-OFF,V?STOP \?L60
	PRINT YOU-HAVE-TO
	PRINTR "get in it first."
?L60:	EQUAL? PRSA,V?MOVE,V?PRY \FALSE
	EQUAL? PRSO,JUNK \FALSE
	EQUAL? PRSI,FORKLIFT \FALSE
	PRINTR "You're trying to operate the forklift by telepathy?"

	.FUNCT STORAGE-ROOM-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FCLEAR MANHOLE,NDESCBIT
	MOVE MANHOLE,HERE
	RTRUE

	.FUNCT MANHOLE-EXIT
	IN? MANHOLE-COVER,MANHOLE /?L1
	ADD SCORE,MANHOLE-SCORE >SCORE
	SET 'MANHOLE-SCORE,0
	RETURN BRICK-TUNNEL
?L1:	EQUAL? WINNER,PLAYER \FALSE
	PRINT STR?192
	PRINTI "steel cover on the manhole."
	CRLF
	RFALSE

	.FUNCT MANHOLE-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	IN? MANHOLE-COVER,MANHOLE \?L4
	PRINT STR?192
	PRINTI "closed, disused-looking manhole here."
	RETURN M-FATAL
?L4:	PRINT STR?193
	PRINTI "manhole here."
	RETURN M-FATAL

	.FUNCT MANHOLE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	IN? MANHOLE-COVER,MANHOLE /?L3
	PRINTI "It's a manhole."
	EQUAL? HERE,STORAGE-ROOM \?L5
	PRINTI " It's very dark inside, but you can see that crude brick handholds provide a slippery path down. Cool air rises out of the hole."
?L5:	CRLF
	RTRUE
?L3:	PRINTI "It's a steel ring set in the "
	EQUAL? HERE,STORAGE-ROOM \?L9
	PRINTI "floor"
	JUMP ?L11
?L9:	PRINTI "ceiling"
?L11:	PRINTR ". It's probably a manhole."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE,V?LOOK-DOWN \?L12
	IN? MANHOLE-COVER,MANHOLE \?L13
	PRINTR "You see only the cover."
?L13:	EQUAL? HERE,BRICK-TUNNEL \?L15
	PRINTR "You can't see much."
?L15:	PRINTR "You can see a dark, grimy tunnel below."
?L12:	EQUAL? PRSA,V?PUT,V?PUT-ON \?L17
	EQUAL? PRSI,MANHOLE \?L17
	EQUAL? PRSO,MANHOLE-COVER /FALSE
	IN? MANHOLE-COVER,MANHOLE /?L20
	MOVE PRSO,BRICK-TUNNEL
	PRINTI "You drop "
	CALL THE-PRINT-PRSO
	PRINTR ", and it hits the ground not far below."
?L20:	PRINTR "The manhole is covered right now."
?L17:	EQUAL? PRSA,V?THROUGH,V?BOARD,V?CLIMB-DOWN \?L22
	EQUAL? PRSO,MANHOLE \?L22
	EQUAL? HERE,STORAGE-ROOM \?L23
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L23:	CALL DO-WALK,P?UP >STACK
	RSTACK
?L22:	EQUAL? PRSA,V?RAISE,V?PRY,V?MOVE \?L26
	EQUAL? PRSO,MANHOLE \?L26
	CALL PERFORM-PRSA,MANHOLE-COVER,PRSI
	RTRUE
?L26:	EQUAL? PRSA,V?OPEN \?L27
	EQUAL? PRSI,CROWBAR \?L28
	CALL NEW-VERB,V?PRY
	RTRUE
?L28:	IN? MANHOLE-COVER,MANHOLE \FALSE
	PRINTR "The only way would seem to be to remove the manhole cover."
?L27:	EQUAL? PRSA,V?CLOSE \FALSE
	CALL PERFORM,V?PUT,MANHOLE-COVER,MANHOLE
	RTRUE

	.FUNCT MANHOLE-COVER-F
	EQUAL? PRSO,MANHOLE-COVER \FALSE
	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "It's an old, rusty, steel "
	PRINTD MANHOLE-COVER
	IN? MANHOLE-COVER,MANHOLE \?L9
	PRINTI " set in a steel ring embedded in the "
	EQUAL? HERE,STORAGE-ROOM \?L7
	PRINTI "floor"
	JUMP ?L9
?L7:	PRINTI "ceiling"
?L9:	PRINTR "."
?L3:	EQUAL? PRSA,V?TAKE,V?TAKE-OFF \?L11
	IN? MANHOLE-COVER,MANHOLE \FALSE
	PRINT YOU-CANT
	PRINT STR?194
	PRINTI "it; it's heavy and in a steel ring; impossible to just "
	EQUAL? HERE,STORAGE-ROOM \?L14
	PRINTR "drag it away."
?L14:	PRINTR "push it off."
?L11:	EQUAL? PRSA,V?CLIMB-ON,V?STEP-ON \?L18
	PRINT WASTE-OF-TIME
	RTRUE
?L18:	EQUAL? PRSA,V?PRY,V?OPEN \?L19
	EQUAL? PRSI,CROWBAR \?L19
	IN? MANHOLE-COVER,MANHOLE \?L19
	MOVE MANHOLE-COVER,STORAGE-ROOM
	PRINTI "You lever the "
	PRINTD MANHOLE-COVER
	PRINTI " aside"
	EQUAL? HERE,STORAGE-ROOM \?L20
	PRINTI ", and crusted dirt falls into a dark"
	FSET? MANHOLE,RMUNGBIT \?L22
	PRINTI ", partly obstructed"
?L22:	PRINTR " hole below."
?L20:	PRINTR "."
?L19:	EQUAL? PRSA,V?PUSH-TO,V?PUT-ON,V?PUT \?L26
	EQUAL? PRSI,MANHOLE \?L26
	MOVE MANHOLE-COVER,MANHOLE
	PRINTI "You manage to shove the "
	PRINTD MANHOLE-COVER
	PRINTR " back over the hole."
?L26:	EQUAL? PRSA,V?OPEN \?L27
	IN? MANHOLE-COVER,MANHOLE \FALSE
	PRINTR "An interesting idea, but how?"
?L27:	EQUAL? PRSA,V?MOVE,V?RAISE \?L31
	IN? MANHOLE-COVER,MANHOLE /?L32
	PRINTR "You move it a little way, but it's very heavy."
?L32:	PRINTR "It doesn't budge."
?L31:	EQUAL? PRSA,V?PUSH \?L35
	IN? MANHOLE-COVER,MANHOLE \FALSE
	PRINTR "It's sitting inside a steel ring, so pushing it does nothing."
?L35:	EQUAL? PRSA,V?CUT,V?MUNG \FALSE
	PRINTI "The cover is heavy."
	CALL PRINT-ID,STR?195
	ZERO? PRSI /?L40
	PRINTI " Your "
	PRINTD PRSI
	PRINTI " won't thank you for this."
?L40:	CRLF
	RTRUE

	.FUNCT BRICK-TUNNEL-EXIT
	IN? MANHOLE-COVER,MANHOLE /?L1
	RETURN STORAGE-ROOM
?L1:	PRINT STR?192
	PRINTD MANHOLE-COVER
	PRINTI " blocking your way."
	CRLF
	RFALSE

	.FUNCT BRICK-TUNNEL-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is an ancient tunnel constructed of roughly mortared bricks and stones. "
	ZERO? MANHOLE-SCORE \?L3
	PRINTI "A slippery and almost invisible set of handholds leads up. "
?L3:	PRINTR "The tunnel continues a long way north and south from here."
?L1:	EQUAL? RARG,M-ENTER \?L6
	FSET MANHOLE,NDESCBIT
	MOVE MANHOLE,HERE
	EQUAL? OHERE,STORAGE-ROOM \?L7
	FSET? MANHOLE,RMUNGBIT \?L7
	FCLEAR MANHOLE,RMUNGBIT
	PRINT STR?196
	PRINTI "cobwebs, damp fungus, and other obstructions."
	CRLF
	CRLF
	RTRUE
?L7:	EQUAL? OHERE,UNDER-ALCHEMY-LAB \FALSE
	PRINT DOWN-LONG-TUNNEL
	RTRUE
?L6:	EQUAL? RARG,M-LEAVE \FALSE
	EQUAL? OHERE,UNDER-ALCHEMY-LAB,CAVE-ROOM \FALSE
	PRINT DOWN-LONG-TUNNEL
	RTRUE

	.FUNCT CAVE-ROOM-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in a huge, cave-like construction. A path leads down to a floor partly covered with rough concrete. The walls and ceiling are high and reinforced with beams of wood, iron, and steel. In the center of the floor you can see a large, flat "
	PRINTD SLAB
	PRINTR ". The only exit is behind you to the south."

	.FUNCT SLAB-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The slab is roughly circular, made of indifferently dressed New England granite, and about three feet high."
	EQUAL? HERE,CAVE-ALTAR \?L3
	PRINTI " It is carved all over with odd glyphs, symbols, and strange animal (or part-animal?) figures. The top is covered with a brown stain shading to red at the edges."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?BOARD,V?RUB,V?READ /?L7
	EQUAL? PRSA,V?PUSH \?L6
?L7:	EQUAL? HERE,CAVE-ROOM \?L8
	PRINT ARENT-CLOSE-ENOUGH
	RTRUE
?L8:	EQUAL? PRSA,V?READ \?L10
	CALL NEW-PRSO,CARVINGS
	RTRUE
?L10:	EQUAL? PRSA,V?RUB \?L11
	EQUAL? PRSI,0,HANDS /?L11
	PRINT NOTHING-HAPPENS
	RTRUE
?L11:	PRINTR "An inexplicable revulsion prevents you from touching it."
?L6:	EQUAL? PRSA,V?WALK-TO \FALSE
	EQUAL? HERE,CAVE-ROOM \?L14
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L14:	PRINT STR?197
	PRINTR "slab warily. It is disquieting to look at."

	.FUNCT CARVING-SYMBOL-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINTI "The symbol appears to be the oldest thing carved on the altar. It is beautifully incised in the rocks. Its age is apparent from its wear and the overlay of newer carvings and scratchings over it. "
	CALL TELL-SYMBOL,CARVINGS
	CRLF
	RTRUE

	.FUNCT CARVINGS-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	EQUAL? HERE,CAVE-ALTAR \?L3
	PRINTI "The carvings are in a variety of styles. Some are almost like graffiti, and have carved dates as early as 1655 and as recent as last year. Some are creatures, or people, or combinations of the two. Some are obscene, or revolting, or just indescribable. One is a strange "
	PRINTD CARVING-SYMBOL
	PRINTR ". Most are at least partly spotted with brown stains."
?L3:	PRINT ARENT-CLOSE-ENOUGH
	RTRUE
?L1:	EQUAL? PRSA,V?RUB \FALSE
	CALL NEW-PRSO,SLAB
	RTRUE

	.FUNCT CAVE-ALTAR-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	CALL THIS-IS-IT,CARVING-SYMBOL
	PRINTI "You are at the bottom of the cave. The huge "
	PRINTD SLAB
	PRINTR " in the center is a sort of altar. It is carved with strange and disturbing symbols, the largest of which looks very familiar. Some of the symbols are obscured by rusty red stains. Nearby is an iron plate set in the concrete of the floor."
?L1:	EQUAL? RARG,M-BEG \?L3
	EQUAL? PRSA,V?FIND \?L4
	EQUAL? PRSO,STUDENTS \?L4
	ZERO? SEEN-PIT? /?L4
	PRINTR "You no longer need to look for them. You now understand the stains on the altar."
?L4:	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? P-WALK-DIR,P?DOWN \FALSE
	ZERO? SEEN-PIT? /FALSE
	PRINTI "You're joking."
	CRLF
	CALL PRINT-ID,STR?198 >STACK
	RSTACK
?L3:	EQUAL? RARG,M-ENTER \FALSE
	FSET? IRON-PLATE,OPENBIT \FALSE
	CALL QUEUE,I-PANEL-NOISES,-1 >STACK
	RSTACK

	.FUNCT KNIFE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "This small knife is clean, sharp, and has a long, thin blade and a wooden handle. Only the tip of the blade appears at all dull or used."
?L1:	EQUAL? PRSA,V?SHARPEN \FALSE
	PRINTR "The blade doesn't look any different after this operation."

	.FUNCT IRON-PLATE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The plate is iron, about two feet square, and "
	FSET? IRON-PLATE,OPENBIT /?L3
	PRINTI "looks like it could be slid "
?L3:	PRINTR "open. A curious feature of the plate is that it has upward projecting dents in it which appear to have been punched from below."
?L1:	EQUAL? PRSA,V?OPEN,V?MOVE \?L6
	ZERO? SEEN-PIT? /?L7
	PRINT STR?199
	RTRUE
?L7:	FSET? PRSO,OPENBIT /FALSE
	FSET PRSO,OPENBIT
	CALL QUEUE,I-PANEL-NOISES,-1
	PRINTR "You slide open the panel, revealing a dark pit below. Immediately, there is a response from below."
?L6:	EQUAL? PRSA,V?RAISE \?L11
	PRINTR "It doesn't lift, it slides."
?L11:	EQUAL? PRSA,V?PUT \?L12
	EQUAL? PRSI,IRON-PLATE \?L12
	FSET? PRSI,OPENBIT \?L13
	REMOVE PRSO
	FSET? PRSO,FOODBIT \?L15
	PRINTR "Sounds of ghoulish excitement issue from the opening."
?L15:	PRINTR "The sounds from below increase in intensity."
?L13:	PRINTR "The panel isn't open."
?L12:	EQUAL? PRSA,V?CLOSE \?L19
	FSET? PRSO,OPENBIT \FALSE
	FCLEAR PRSO,OPENBIT
	CALL DEQUEUE,I-PANEL-NOISES
	PRINTR "You close the panel. You no longer hear the noises, much to your relief."
?L19:	EQUAL? PRSA,V?LISTEN \?L23
	ZERO? SEEN-PIT? /?L24
	PRINT UNABLE
	PRINTR "do that again."
?L24:	FSET? IRON-PLATE,OPENBIT \?L26
	PRINTR "Disturbing noises issue from the open panel."
?L26:	PRINTR "You hear very faint noises through the closed panel."
?L23:	EQUAL? PRSA,V?LOOK-INSIDE,V?LOOK-UNDER,V?REACH-IN /?L29
	EQUAL? PRSA,V?LEAP,V?BOARD \FALSE
?L29:	ZERO? SEEN-PIT? /?L30
	PRINT STR?199
	RTRUE
?L30:	FSET? IRON-PLATE,OPENBIT \?L32
	FCLEAR IRON-PLATE,OPENBIT
	CALL DEQUEUE,I-PANEL-NOISES
	SET 'SEEN-PIT?,1
	PRINTR "You peer through the hole, shining your light into the stygian darkness below. The commotion below is growing louder, and suddenly you catch a glimpse of things moving in the pit. Without consciously realizing you have done it, you slam the panel shut, reeling away from the source of such images. Now you know what has been done with the missing students."
?L32:	CALL TELL-OPEN-CLOSED,PRSO >STACK
	RSTACK

	.FUNCT I-PANEL-NOISES,NOCR?=0
	EQUAL? HERE,CAVE-ALTAR,CAVE-ROOM /?L1
	CALL DEQUEUE,I-PANEL-NOISES
	RFALSE
?L1:	ZERO? NOCR? \?L3
	EQUAL? PRSA,V?LISTEN /FALSE
?L3:	EQUAL? HERE,CAVE-ALTAR \?L4
	ZERO? NOCR? \?L5
	CRLF
?L5:	PRINTR "A low, guttural, groaning and snarling issues from the opening."
?L4:	ZERO? NOCR? \?L9
	CRLF
?L9:	PRINTR "You can still hear faint groans and snarls from the larger cave."

	.FUNCT UNDER-ALCHEMY-LAB-EXIT
	FSET? ALCHEMY-TRAP-DOOR,OPENBIT /?L1
	EQUAL? WINNER,PLAYER \FALSE
	CALL THIS-IS-IT,ALCHEMY-TRAP-DOOR
	PRINTI "The trapdoor isn't open."
	CRLF
	RFALSE
?L1:	RETURN ALCHEMY-LAB

	.FUNCT UNDER-ALCHEMY-LAB-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a tunnel whose walls are cinderblock, with a concrete floor and ceiling. A metal ladder leads up to "
	CALL AN-OPEN$002fCLOSED,ALCHEMY-TRAP-DOOR
	PRINTR " in the ceiling, and the tunnel continues north, where the cinderblock walls become brick."

	.FUNCT AN-OPEN$002fCLOSED,DOOR
	FSET? DOOR,OPENBIT \?L1
	PRINTI "an open "
	JUMP ?L3
?L1:	PRINTI "a closed "
?L3:	CALL DPRINT,DOOR
	RTRUE

	.FUNCT TEMPORARY-LAB-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	CALL DEQUEUE,I-FREEZE-TO-DEATH
	GRTR? FREEZE-COUNT,0 \FALSE
	SET 'FREEZE-COUNT,0
	PRINT PUSH-INTO
	PRINTI "comparative warmth of a laboratory."
	CRLF
	CRLF
	RTRUE

	.FUNCT FLASK-CONT,RARG
	EQUAL? PRSA,V?TAKE \FALSE
	IN? NITROGEN,FLASK \FALSE
	EQUAL? PRSO,NITROGEN /FALSE
	REMOVE PRSO
	PRINTI "You manage to fish "
	CALL THE-PRINT-PRSO
	PRINTI " out without freezing your fingers somehow, but it's frozen solid. It's also fragile. It shatters into a million pieces, and is gone."
	CRLF
	CALL PRINT-ID,STR?200 >STACK
	RSTACK

	.FUNCT FLASK-F
	EQUAL? PRSO,FLASK \?L1
	EQUAL? PRSA,V?EXAMINE \?L3
	PRINT STR?201
	PRINTI "metal flask, about the size of a water cooler bottle. "
	FSET? FLASK,OPENBIT \?L5
	PRINTI "The flask is open"
	IN? NITROGEN,FLASK \?L7
	PRINTI ", and a thin, cold mist flows out of it"
?L7:	PRINT PERIOD
	RTRUE
?L5:	CALL TELL-OPEN-CLOSED,FLASK >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?RUB \?L11
	PRINTI "The metal of the flask is "
	IN? NITROGEN,FLASK \?L12
	PRINTI "very "
?L12:	PRINTR "cold."
?L11:	EQUAL? PRSA,V?OPEN \?L15
	FSET? FLASK,OPENBIT /FALSE
	FSET FLASK,OPENBIT
	PRINTI "You open the flask"
	IN? NITROGEN,FLASK \?L18
	MOVE MIST,HERE
	CALL QUEUE,I-NITROGEN-GOES,3
	PRINTI ", and a cold, white mist boils out"
?L18:	PRINT PERIOD
	RTRUE
?L15:	EQUAL? PRSA,V?CLOSE \?L22
	FSET? FLASK,OPENBIT \FALSE
	CALL DEQUEUE,I-NITROGEN-GOES
	CALL QUEUE,I-MIST-GOES,2
	FCLEAR FLASK,OPENBIT
	PRINTR "You screw the flask closed."
?L22:	EQUAL? PRSA,V?FILL \?L26
	CALL CANT-FILL-IT >STACK
	RSTACK
?L26:	EQUAL? PRSA,V?POUR \FALSE
	IN? NITROGEN,FLASK \FALSE
	CALL NEW-PRSO,NITROGEN
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,FLASK \FALSE
	GETP FLASK,P?CAPACITY >STACK
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,STACK \FALSE
	PRINTI "The neck of "
	CALL THE-PRINT,FLASK
	PRINTR " is too small."

	.FUNCT MIST-F
	ZERO? TIED-UP? \FALSE
	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "The mist is boiling up "
	IN? NITROGEN,FLASK \?L5
	PRINTI "out of the flask"
	JUMP ?L7
?L5:	PRINTI "off of the ground"
?L7:	PRINTR ". It is thin, white, and cold."
?L3:	EQUAL? PRSA,V?RUB \?L8
	PRINTR "The mist is very cold."
?L8:	EQUAL? PRSA,V?SMELL \FALSE
	PRINTR "The mist is odorless."

	.FUNCT I-MIST-GOES,L
	CALL QUEUED?,I-NITROGEN-GOES >STACK
	ZERO? STACK \FALSE
	LOC MIST >L
	REMOVE MIST
	EQUAL? HERE,L \FALSE
	CRLF
	PRINTR "The mist dissipates."

	.FUNCT NITROGEN-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The flask contains a clear, "
	PRINTD NITROGEN
	PRINTR " with a thin white mist boiling off of it."
?L1:	EQUAL? PRSA,V?TAKE,V?RUB \?L3
	PRINTI "The liquid is extremely cold. In fact, you burn your finger on it."
	CRLF
	CALL PRINT-ID,STR?202 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?SMELL \?L4
	PRINTR "The liquid has no smell."
?L4:	EQUAL? PRSA,V?POUR,V?PUT,V?DROP /?L6
	EQUAL? PRSA,V?THROW \FALSE
?L6:	REMOVE NITROGEN
	CALL DEQUEUE,I-NITROGEN-GOES
	CALL QUEUE,I-MIST-GOES,2
	EQUAL? PRSI,FLASK \?L7
	PRINT GOOD-TRICK
	RTRUE
?L7:	ZERO? PRSI /?L9
	FSET? PRSI,PERSON \?L9
	EQUAL? PRSI,ME,HAND /?L9
	CALL SWAP-VERB,V?ATTACK
	RTRUE
?L9:	PRINTI "The freezing liquid pours out"
	ZERO? PRSI /?L11
	PRINTI " onto "
	CALL THE-PRINT-PRSI
?L11:	PRINTI ", boiling into cold mist almost immediately"
	ZERO? PRSI /?L20
	CALL HELD?,PRSI >STACK
	ZERO? STACK \?L18
	CALL INTRINSIC?,PRSI >STACK
	ZERO? STACK /?L16
?L18:	CALL PRINT-ID,STR?203
	CALL JIGS-UP,STR?204
	RETURN M-FATAL
?L16:	FSET? PRSI,SLIMEBIT \?L19
	FCLEAR PRSI,SLIMEBIT
	JUMP ?L20
?L19:	FSET? PRSI,TAKEBIT \?L20
	REMOVE PRSI
	PRINTI ", but "
	CALL THE-PRINT-PRSI
	PRINTI " freezes and then shatters from the cold"
	CALL PRINT-ID,STR?205
?L20:	PRINTR "."

	.FUNCT I-NITROGEN-GOES
	IN? NITROGEN,FLASK \FALSE
	CALL QUEUE,I-NITROGEN-GOES,3
	DEC 'NITROGEN-CNT
	ZERO? NITROGEN-CNT \?L3
	CALL DEQUEUE,I-NITROGEN-GOES
	CALL QUEUE,I-MIST-GOES,2
	REMOVE NITROGEN
	RFALSE
?L3:	CALL ACCESSIBLE?,FLASK >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTR "Cold white mist continues to boil out of the flask."

	.FUNCT CS-ELEVATOR-ROOM-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is a battered, rather dirty elevator. The fake wood walls are scratched and marred with graffiti. "
	CALL ELEVATOR-DOORS-OPEN-CLOSED,ELEVATOR-DOOR
	PRINT TO-THE-RIGHT
	PRINTI "doors is an area with "
	PRINTD FLOOR-BUTTON
	PRINTI "s (B and 1 through 3), an "
	PRINTD OPEN-BUTTON
	PRINTI ", a "
	PRINTD CLOSE-BUTTON
	PRINTI ", a "
	PRINTD STOP-SWITCH
	PRINTI ", and an "
	PRINTD ALARM-BUTTON
	PRINTI "."
	CALL TELL-BUTTON,0,66
	CALL TELL-BUTTON,1,49
	CALL TELL-BUTTON,2,50
	CALL TELL-BUTTON,3,51
	PRINTI " Below these is an "
	PRINTD ACCESS-PANEL
	PRINTI " which is "
	CALL OPEN-CLOSED,ACCESS-PANEL >STACK
	RSTACK
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?DISEMBARK \FALSE
	CALL DO-WALK,P?NORTH >STACK
	RSTACK

	.FUNCT TELL-BUTTON,N,C
	GET BUTTONS,N >STACK
	BTST STACK,E-GO \FALSE
	PRINTI " The """
	PRINTC C
	PRINTI """ button is glowing."
	RTRUE

	.FUNCT ACCESS-PANEL-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	FSET? ACCESS-PANEL,OPENBIT /?L3
	PRINTR "This panel presumably opens to access the inner maintenance controls of the elevator."
?L3:	PRINTI "The panel conceals a small space which probably contained maintenance controls for the elevator once, but these have been torn out by someone, leaving a bare metal cavity. "
	CALL DESCRIBE-SENT,ACCESS-PANEL
	CRLF
	RTRUE

	.FUNCT FLASHLIGHT-F,OLIT,?TMP
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The flashlight is a heavy-duty shop-style light."
	FSET? FLASHLIGHT,ONBIT \?L3
	PRINT STR?206
	PRINTI "on."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LAMP-ON \?L6
	FSET? FLASHLIGHT,LIGHTBIT /?L7
	PRINT IT-SEEMS-TO-BE
	PRINTR "burned out."
?L7:	FSET? FLASHLIGHT,ONBIT \?L9
	PRINTR "It is!"
?L9:	FSET FLASHLIGHT,ONBIT
	GET FLASHLIGHT-TABLE,0 >STACK
	CALL QUEUE,I-FLASHLIGHT,STACK
	CALL CTHE-PRINT,FLASHLIGHT
	PRINTI " clicks on."
	CRLF
	SET 'OLIT,LIT
	CALL LIT?,HERE >LIT
	ZERO? OLIT \TRUE
	ZERO? LIT /TRUE
	CRLF
	CALL V-LOOK
	RTRUE
?L6:	EQUAL? PRSA,V?LAMP-OFF \?L14
	FSET? FLASHLIGHT,ONBIT /?L15
	PRINTR "It is!"
?L15:	FCLEAR FLASHLIGHT,ONBIT
	SET '?TMP,FLASHLIGHT-TABLE
	CALL DEQUEUE,I-FLASHLIGHT >STACK
	PUT ?TMP,0,STACK
	CALL CTHE-PRINT,FLASHLIGHT
	PRINTI " clicks off"
	CALL IN-DARK?,1 >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?OPEN \FALSE
	PRINTR "It doesn't open. It appears to be one of those rechargeable lights, so you can't easily get at the battery."

	.FUNCT I-FLASHLIGHT,HERE?=0,OLIT
	CALL META-LOC,FLASHLIGHT >STACK
	EQUAL? STACK,HERE /?L3
	SET 'HERE?,0
	JUMP ?L1
?L3:	SET 'HERE?,1
	CRLF
	CALL CTHE-PRINT,FLASHLIGHT
	GET FLASHLIGHT-TABLE,1 >STACK
	PRINT STACK
?L1:	ADD FLASHLIGHT-TABLE,4 >FLASHLIGHT-TABLE
	GET FLASHLIGHT-TABLE,0 >STACK
	ZERO? STACK \?L6
	FCLEAR FLASHLIGHT,ONBIT
	FCLEAR FLASHLIGHT,LIGHTBIT
	ZERO? HERE? /FALSE
	CALL CTHE-PRINT,FLASHLIGHT
	PRINTI " has burned out"
	CALL IN-DARK?,1
	JUMP ?L11
?L6:	GET FLASHLIGHT-TABLE,0 >STACK
	CALL QUEUE,I-FLASHLIGHT,STACK
?L11:	ZERO? HERE? /FALSE
	CRLF
	RTRUE

	.FUNCT THIS-FLOOR-DOOR
	EQUAL? HERE,CS-BASEMENT,ELEVATOR-PIT \?L1
	RETURN ELEVATOR-DOOR-B
?L1:	EQUAL? HERE,COMP-CENTER \?L3
	RETURN ELEVATOR-DOOR-1
?L3:	EQUAL? HERE,CS-2ND \?L4
	RETURN ELEVATOR-DOOR-2
?L4:	EQUAL? HERE,CS-3RD \FALSE
	RETURN ELEVATOR-DOOR-3

	.FUNCT DOOR-AT-ELEVATOR
	ZERO? ELEVATOR-LOC \?L1
	RETURN ELEVATOR-DOOR-B
?L1:	EQUAL? ELEVATOR-LOC,1 \?L3
	RETURN ELEVATOR-DOOR-1
?L3:	EQUAL? ELEVATOR-LOC,2 \?L4
	RETURN ELEVATOR-DOOR-2
?L4:	RETURN ELEVATOR-DOOR-3

	.FUNCT FLOOR-SHAFT
	EQUAL? HERE,CS-BASEMENT,ELEVATOR-PIT \?L1
	RETURN SHAFT-B
?L1:	EQUAL? HERE,COMP-CENTER \?L3
	RETURN SHAFT-1
?L3:	EQUAL? HERE,CS-2ND \?L4
	RETURN SHAFT-2
?L4:	EQUAL? HERE,CS-3RD \FALSE
	RETURN SHAFT-3

	.FUNCT OPEN-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	ZERO? ELEVATOR-STOPPED? /?L3
	CALL QUEUE,I-ELEVATOR-DOOR-CLOSES,2
	FSET? ELEVATOR-DOOR,OPENBIT \?L5
	PRINTR "The doors stay open."
?L5:	CALL DOOR-AT-ELEVATOR >STACK
	FSET STACK,OPENBIT
	FSET ELEVATOR-DOOR,OPENBIT
	PRINTR "The doors spring open."
?L3:	PRINT STILL-MOVING
	PRINTI " "
	PRINT NOTHING-HAPPENS
	RTRUE

	.FUNCT CLOSE-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	ZERO? ELEVATOR-STOPPED? /?L3
	FSET? ELEVATOR-DOOR,OPENBIT \?L5
	CALL QUEUE,I-ELEVATOR-DOOR-CLOSES,2
	PRINTR "You push the button."
?L5:	PRINTR "The door is already closed."
?L3:	PRINT STR?207
	PRINTR "moving, the door is closed."

	.FUNCT FLOOR-BUTTON-F,OLD
	EQUAL? PRSA,V?PUSH \FALSE
	EQUAL? PRSO,BASEMENT-BUTTON \?L3
	SET 'P-NUMBER,0
?L3:	GRTR? P-NUMBER,3 \?L6
	PRINTR "There are only three floors and a basement in this building."
?L6:	EQUAL? P-NUMBER,ELEVATOR-LOC \?L8
	EQUAL? HERE,CS-ELEVATOR-ROOM \TRUE
	PRINTR "The button doesn't light."
?L8:	GET BUTTONS,P-NUMBER >OLD
	BTST OLD,E-GO /?L13
	BOR OLD,E-GO >STACK
	PUT BUTTONS,P-NUMBER,STACK
	CALL QUEUE,I-ELEVATOR-MOVES,1
	ZERO? ELEVATOR-STOPPED? /?L15
	CALL PICK-ELEVATOR-DIRECTION
?L15:	EQUAL? HERE,CS-ELEVATOR-ROOM \TRUE
	PRINTI "The button for the "
	GET FLOOR-NAMES,P-NUMBER >STACK
	PRINT STACK
	PRINT STR?208
	RTRUE
?L13:	EQUAL? HERE,CS-ELEVATOR-ROOM \TRUE
	PRINT ALREADY-GLOWING
	RTRUE

	.FUNCT ELEVATOR-HERE?
	EQUAL? HERE,CS-ELEVATOR-ROOM /TRUE
	GETPT HERE,P?FLOOR >STACK
	ZERO? STACK /FALSE
	GETP HERE,P?FLOOR >STACK
	EQUAL? STACK,ELEVATOR-LOC \FALSE
	RTRUE

	.FUNCT ELEVATOR-WANTED?
	GET BUTTONS,0 >STACK
	ZERO? STACK \?L3
	GET BUTTONS,1 >STACK
	ZERO? STACK \?L3
	GET BUTTONS,2 >STACK
	ZERO? STACK \?L3
	GET BUTTONS,3 >STACK
	ZERO? STACK /FALSE
?L3:	CALL QUEUE,I-ELEVATOR-MOVES,1 >STACK
	RSTACK

	.FUNCT I-ELEVATOR-DOOR-OPENS
	CALL QUEUE,I-ELEVATOR-DOOR-CLOSES,2
	FSET? ELEVATOR-DOOR,OPENBIT /FALSE
	SET 'ELEVATOR-STOPPED?,3
	CALL DOOR-AT-ELEVATOR >STACK
	FSET STACK,OPENBIT
	FSET ELEVATOR-DOOR,OPENBIT
	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK /FALSE
	CRLF
	CALL CTHE-PRINT,ELEVATOR-DOOR
	PRINTR " slide open."

	.FUNCT CHAIN-IN-DOOR?
	ZERO? CHAIN-HOOKED? /FALSE
	CALL META-LOC,HOOK >STACK
	EQUAL? STACK,HERE \FALSE
	CALL HELD?,CHAIN >STACK
	ZERO? STACK \?L3
	IN? CHAIN,HERE \FALSE
?L3:	RETURN CHAIN

	.FUNCT I-ELEVATOR-DOOR-CLOSES,W
	FSET? ELEVATOR-DOOR,OPENBIT \FALSE
	CALL DOOR-AT-ELEVATOR >STACK
	FIRST? STACK >W /?L4
	ZERO? HOLDING-DOORS? \?L4
	CALL CHAIN-IN-DOOR? >W
	ZERO? W /?L3
?L4:	CALL QUEUE,I-ELEVATOR-DOOR-CLOSES,2
	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK /FALSE
	CRLF
	CALL CTHE-PRINT,ELEVATOR-DOOR
	PRINTI " bounce against "
	ZERO? W /?L7
	CALL THE-PRINT,W
	JUMP ?L9
?L7:	PRINTI "your body"
?L9:	PRINTR ", trying to close."
?L3:	CALL ELEVATOR-WANTED?
	FCLEAR ELEVATOR-DOOR,OPENBIT
	CALL DOOR-AT-ELEVATOR >STACK
	FCLEAR STACK,OPENBIT
	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK /FALSE
	CRLF
	CALL CTHE-PRINT,ELEVATOR-DOOR
	PRINTR " slide closed."

	.FUNCT CLOSE-ELEVATOR-DOOR,DOOR
	SET 'HOLDING-DOORS?,0
	SET 'ELEVATOR-STOPPED?,1
	CALL ELEVATOR-WANTED?
	FCLEAR DOOR,OPENBIT
	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK /?L1
	FCLEAR ELEVATOR-DOOR,OPENBIT
	RTRUE
?L1:	CALL FLOOR-SHAFT >STACK
	REMOVE STACK
	RTRUE

	.FUNCT PICK-ELEVATOR-DIRECTION,ZERO,ONE,TWO,THREE
	ZERO? ELEVATOR-LOC \?L1
	SET 'ELEVATOR-DIRECTION,1
	RETURN ELEVATOR-DIRECTION
?L1:	EQUAL? ELEVATOR-LOC,3 \?L3
	SET 'ELEVATOR-DIRECTION,-1
	RETURN ELEVATOR-DIRECTION
?L3:	GET BUTTONS,0 >ZERO
	GET BUTTONS,1 >ONE
	GET BUTTONS,2 >TWO
	GET BUTTONS,3 >THREE
	EQUAL? ELEVATOR-DIRECTION,-1 \?L5
	EQUAL? ELEVATOR-LOC,1 \?L7
	ZERO? ZERO \FALSE
	SET 'ELEVATOR-DIRECTION,1
	RETURN ELEVATOR-DIRECTION
?L7:	EQUAL? ELEVATOR-LOC,2 \FALSE
	ZERO? ZERO \FALSE
	ZERO? ONE \FALSE
	SET 'ELEVATOR-DIRECTION,1
	RETURN ELEVATOR-DIRECTION
?L5:	EQUAL? ELEVATOR-DIRECTION,1 \FALSE
	EQUAL? ELEVATOR-LOC,2 \?L18
	ZERO? THREE \FALSE
	SET 'ELEVATOR-DIRECTION,-1
	RETURN ELEVATOR-DIRECTION
?L18:	EQUAL? ELEVATOR-LOC,1 \FALSE
	ZERO? TWO \FALSE
	ZERO? THREE \FALSE
	SET 'ELEVATOR-DIRECTION,-1
	RETURN ELEVATOR-DIRECTION

	.FUNCT ELEVATOR-CALLED?
	GET BUTTONS,0 >STACK
	ZERO? STACK /?L1
	ZERO? ELEVATOR-LOC \TRUE
?L1:	GET BUTTONS,1 >STACK
	ZERO? STACK /?L3
	EQUAL? ELEVATOR-LOC,1 \TRUE
?L3:	GET BUTTONS,2 >STACK
	ZERO? STACK /?L4
	EQUAL? ELEVATOR-LOC,2 \TRUE
?L4:	GET BUTTONS,3 >STACK
	ZERO? STACK /FALSE
	EQUAL? ELEVATOR-LOC,3 \TRUE
	RFALSE

	.FUNCT NO-HIGHER-UP-CALLS?,ZERO,ONE,TWO,THREE
	GET BUTTONS,0 >ZERO
	GET BUTTONS,1 >ONE
	GET BUTTONS,2 >TWO
	GET BUTTONS,3 >THREE
	ZERO? ELEVATOR-LOC \?L1
	BTST ONE,3 /FALSE
	BTST TWO,3 /FALSE
	BTST THREE,3 \TRUE
	RFALSE
?L1:	EQUAL? ELEVATOR-LOC,1 \?L7
	BTST TWO,3 /FALSE
	BTST THREE,3 \TRUE
	RFALSE
?L7:	EQUAL? ELEVATOR-LOC,2 \?L12
	BTST THREE,3 \TRUE
	RFALSE
?L12:	EQUAL? ELEVATOR-LOC,3 /TRUE
	RFALSE

	.FUNCT NO-LOWER-DOWN-CALLS?,ZERO,ONE,TWO,THREE
	GET BUTTONS,0 >ZERO
	GET BUTTONS,1 >ONE
	GET BUTTONS,2 >TWO
	GET BUTTONS,3 >THREE
	ZERO? ELEVATOR-LOC /TRUE
	EQUAL? ELEVATOR-LOC,1 \?L3
	BTST ZERO,5 \TRUE
	RFALSE
?L3:	EQUAL? ELEVATOR-LOC,2 \?L7
	BTST ZERO,5 /FALSE
	BTST ONE,5 \TRUE
	RFALSE
?L7:	EQUAL? ELEVATOR-LOC,3 \FALSE
	BTST ZERO,5 /FALSE
	BTST ONE,5 /FALSE
	BTST TWO,5 \TRUE
	RFALSE

	.FUNCT I-ELEVATOR-MOVES,OLD,STOPPING?
	CALL QUEUE,I-ELEVATOR-MOVES,1
	FSET? ELEVATOR-DOOR,OPENBIT /FALSE
	FSET? ELEVATOR-DOOR-B,OPENBIT /FALSE
	FSET? ELEVATOR-DOOR-1,OPENBIT /FALSE
	FSET? ELEVATOR-DOOR-2,OPENBIT /FALSE
	FSET? ELEVATOR-DOOR-3,OPENBIT /FALSE
	ZERO? ELEVATOR-STOPPED? /?L5
	CALL ELEVATOR-CALLED? >STACK
	ZERO? STACK /?L5
	DEC 'ELEVATOR-STOPPED?
	ZERO? ELEVATOR-STOPPED? \FALSE
	EQUAL? HERE,ELEVATOR-PIT /?L11
	EQUAL? HERE,STEAM-TUNNEL-EAST \?L9
	EQUAL? BRICK-FLAG,BF-BOTH \?L9
?L11:	CRLF
	PRINTI "A loud mechanical whining "
	EQUAL? HERE,ELEVATOR-PIT \?L12
	PRINTR "begins above you."
?L12:	PRINTR "is audible through the hole."
?L9:	EQUAL? HERE,CS-ELEVATOR-ROOM \?L15
	CRLF
	PRINTI "The elevator begins to move "
	GRTR? ELEVATOR-DIRECTION,0 \?L16
	PUSH STR?209
	JUMP ?L18
?L16:	PUSH STR?210
?L18:	PRINT STACK
	PRINT PERIOD
	RTRUE
?L15:	GETPT HERE,P?FLOOR >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTR "You hear the elevator begin moving."
?L5:	ZERO? ELEVATOR-LOC \?L26
	LESS? ELEVATOR-DIRECTION,0 /?L25
?L26:	EQUAL? ELEVATOR-LOC,3 \?L23
	GRTR? ELEVATOR-DIRECTION,0 \?L23
?L25:	CALL PICK-ELEVATOR-DIRECTION
	JUMP ?L57
?L23:	ADD ELEVATOR-LOC,ELEVATOR-DIRECTION >ELEVATOR-LOC
	ZERO? ELEVATOR-LOC \?L28
	MOVE ELEVATOR-CEILING,SHAFT-1
	FSET ELEVATOR-FLOOR,NDESCBIT
	MOVE ELEVATOR-FLOOR,ELEVATOR-PIT
	JUMP ?L57
?L28:	EQUAL? ELEVATOR-LOC,1 \?L30
	MOVE ELEVATOR-CEILING,SHAFT-2
	MOVE ELEVATOR-FLOOR,SHAFT-B
	EQUAL? CHAIN-HOOKED?,HOOK \?L57
	MOVE CHAIN,ELEVATOR-PIT
	EQUAL? HERE,ELEVATOR-PIT \?L57
	CRLF
	PRINTI "A greasy chain descends out of the shaft into a pile at your feet."
	CRLF
	JUMP ?L57
?L30:	EQUAL? ELEVATOR-LOC,2 \?L37
	MOVE ELEVATOR-CEILING,SHAFT-3
	MOVE ELEVATOR-FLOOR,SHAFT-1
	ZERO? CHAIN-LOOPED? /?L38
	ZERO? CHAIN-HOOKED? /?L57
	FSET CHAIN-2,INVISIBLE
	SET 'CHAIN-LOOPED?,0
	FSET? CHAIN-2,LOCKED \?L40
	FCLEAR ELEVATOR-PIT,TOUCHBIT
	REMOVE ROD
	REMOVE PADLOCK
	FCLEAR CHAIN-2,LOCKED
	SET 'PADLOCK-ON?,0
	SET 'BRICK-WALL-FLAG,1
	ADD SCORE,BRICK-WALL-SCORE >SCORE
	SET 'BRICK-WALL-SCORE,0
	CALL HEAR-CHAIN? >STACK
	ZERO? STACK /?L42
	CALL CHAIN-NOISES
	PRINTI "tearing, rending sound, then a rumbling crash."
	CRLF
	JUMP ?L57
?L42:	EQUAL? HERE,ELEVATOR-PIT \?L57
	CRLF
	PRINTI "The length of chain grows taut, pulling at the rod. Suddenly, the bricks give up, and a steel reinforcing rod pulls free of the shattered wall. It flies across the room, impaling you with uncanny precision."
	CRLF
	CALL PRINT-ID,STR?211
	CALL JIGS-UP
	JUMP ?L57
?L40:	CALL HEAR-CHAIN? >STACK
	ZERO? STACK /?L47
	CALL CHAIN-NOISES
	PRINTI "metallic sliding sound, then silence."
	CRLF
	JUMP ?L57
?L47:	EQUAL? HERE,ELEVATOR-PIT \?L57
	CRLF
	PRINTI "The chain slides off the rod and away into the air."
	CRLF
	JUMP ?L57
?L38:	ZERO? CHAIN-HOOKED? /?L57
	IN? CHAIN,WINNER \?L52
	REMOVE CHAIN
	CRLF
	PRINTI "Suddenly, the chain is torn from your grasp!"
	CRLF
	JUMP ?L57
?L52:	IN? CHAIN,ELEVATOR-PIT \?L57
	REMOVE CHAIN
	JUMP ?L57
?L37:	EQUAL? ELEVATOR-LOC,3 \?L57
	REMOVE ELEVATOR-CEILING
	MOVE ELEVATOR-FLOOR,SHAFT-2
?L57:	GET BUTTONS,ELEVATOR-LOC >OLD
	GRTR? ELEVATOR-DIRECTION,0 \?L59
	BTST OLD,E-UP \?L61
	SET 'STOPPING?,UP-BUTTON
	JUMP ?L68
?L61:	BTST OLD,E-DOWN \?L68
	CALL NO-HIGHER-UP-CALLS? >STACK
	ZERO? STACK /?L68
	CALL PICK-ELEVATOR-DIRECTION
	SET 'STOPPING?,DOWN-BUTTON
	JUMP ?L68
?L59:	LESS? ELEVATOR-DIRECTION,0 \?L68
	BTST OLD,E-DOWN \?L66
	SET 'STOPPING?,DOWN-BUTTON
	JUMP ?L68
?L66:	BTST OLD,E-UP \?L68
	CALL NO-LOWER-DOWN-CALLS? >STACK
	ZERO? STACK /?L68
	CALL PICK-ELEVATOR-DIRECTION
	SET 'STOPPING?,UP-BUTTON
?L68:	ZERO? STOPPING? \?L76
	BTST OLD,E-GO \?L71
	ZERO? STOPPING? \?L76
	GRTR? ELEVATOR-DIRECTION,0 \?L79
	CALL NO-HIGHER-UP-CALLS? >STACK
	ZERO? STACK \?L78
?L79:	LESS? ELEVATOR-DIRECTION,0 \?L76
	CALL NO-LOWER-DOWN-CALLS? >STACK
	ZERO? STACK /?L76
?L78:	CALL PICK-ELEVATOR-DIRECTION
?L76:	EQUAL? STOPPING?,UP-BUTTON \?L82
	BAND OLD,E-DOWN >STACK
	JUMP ?L85
?L82:	EQUAL? STOPPING?,DOWN-BUTTON \?L84
	BAND OLD,E-UP >STACK
	JUMP ?L85
?L84:	PUSH 0
?L85:	PUT BUTTONS,ELEVATOR-LOC,STACK
	CALL DEQUEUE,I-ELEVATOR-MOVES
	SET 'ELEVATOR-STOPPED?,3
	CALL QUEUE,I-ELEVATOR-DOOR-OPENS,1
	EQUAL? HERE,ELEVATOR-PIT \?L86
	ZERO? ELEVATOR-LOC \?L88
	CALL PRINT-ID,STR?212
	CALL JIGS-UP,STR?213
	RETURN M-FATAL
?L88:	CRLF
	PRINTR "The noise stops."
?L86:	EQUAL? HERE,STEAM-TUNNEL-EAST \?L91
	EQUAL? BRICK-FLAG,BF-BOTH \?L91
	CRLF
	PRINT STR?214
	PRINTR "in the hole stops."
?L91:	EQUAL? HERE,CS-ELEVATOR-ROOM \?L92
	CRLF
	PRINTI "The elevator slows and comes to a stop."
	BTST OLD,E-GO \?L93
	PRINTI " The button for the "
	GET FLOOR-NAMES,ELEVATOR-LOC >STACK
	PRINT STACK
	PRINTI " blinks off."
?L93:	CRLF
	RTRUE
?L92:	EQUAL? STOPPING?,UP-BUTTON,DOWN-BUTTON \?L96
	EQUAL? HERE,CS-ELEVATOR-ROOM /?L96
	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK /?L96
	CRLF
	CALL CTHE-PRINT,STOPPING?
	PRINTR " blinks off."
?L96:	GETPT HERE,P?FLOOR >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "You no longer"
	PRINT HEAR-THE-ELEVATOR
	RTRUE
?L71:	ZERO? ELEVATOR-STOPPED? \FALSE
	EQUAL? HERE,ELEVATOR-PIT \?L100
	CRLF
	PRINT STR?214
	PRINTI "is moving "
	GRTR? ELEVATOR-DIRECTION,0 \?L102
	PRINTI "away from you"
	JUMP ?L105
?L102:	PRINTI "closer to you"
	EQUAL? ELEVATOR-LOC,1 \?L105
	PRINTI ". In fact, it's very close. It must be just above your head"
?L105:	PRINT PERIOD
	RTRUE
?L100:	EQUAL? HERE,STEAM-TUNNEL-EAST \?L108
	EQUAL? BRICK-FLAG,BF-BOTH \?L108
	CRLF
	PRINT STR?214
	PRINTI "from the hole is getting "
	GRTR? ELEVATOR-DIRECTION,0 \?L109
	PUSH STR?215
	JUMP ?L111
?L109:	PUSH STR?216
?L111:	PRINT STACK
	PRINT PERIOD
	RTRUE
?L108:	EQUAL? HERE,CS-ELEVATOR-ROOM \?L112
	CRLF
	PRINTI "The elevator continues to move "
	GRTR? ELEVATOR-DIRECTION,0 \?L113
	PUSH STR?209
	JUMP ?L115
?L113:	PUSH STR?210
?L115:	PRINT STACK
	PRINT PERIOD
	RTRUE
?L112:	GETPT HERE,P?FLOOR >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "You"
	PRINT HEAR-THE-ELEVATOR
	RTRUE

	.FUNCT HEAR-CHAIN?
	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK \TRUE
	EQUAL? HERE,CS-BASEMENT,COMP-CENTER,CS-2ND /TRUE
	EQUAL? HERE,CS-3RD,STEAM-TUNNEL,STEAM-TUNNEL-EAST /TRUE
	RFALSE

	.FUNCT CHAIN-NOISES
	CRLF
	PRINTI "From "
	EQUAL? HERE,STEAM-TUNNEL,STEAM-TUNNEL-EAST \?L1
	PRINTI "the pit"
	JUMP ?L3
?L1:	PRINTI "below"
?L3:	PRINTI ", you hear a "
	RTRUE

	.FUNCT ALARM-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	PRINTR "For as long as you hold the button down, an ear-splitting alarm bell rings."

	.FUNCT STOP-SWITCH-F
	EQUAL? PRSA,V?TURN,V?LAMP-ON,V?LAMP-OFF \FALSE
	PRINTI "You flip the switch, but"
	PRINT LC-NOTHING-HAPPENS
	CRLF
	RTRUE

	.FUNCT ELEVATOR-F,DOOR
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L3
	CALL PERFORM,V?LOOK
	RTRUE
?L3:	PRINTR "You aren't in it."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L6
	CALL DOOR-AT-ELEVATOR >DOOR
	FSET? DOOR,OPENBIT \?L7
	PRINTR "There is an elevator there, unsurprisingly."
?L7:	CALL TELL-OPEN-CLOSED,DOOR >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?THROUGH,V?BOARD \?L10
	EQUAL? PRSO,ELEVATOR \?L10
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L11
	PRINT ALREADY-IN-IT
	CRLF
	RTRUE
?L11:	CALL DO-WALK,P?SOUTH >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?SAY \?L14
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L15
	PRINT YOURE-IN-IT
	RTRUE
?L15:	PRINTR "You'll to press one of the call buttons (up or down)."
?L14:	EQUAL? PRSA,V?PUT,V?THROW \?L18
	EQUAL? PRSI,ELEVATOR \?L18
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L19
	PRINT YOURE-IN-IT
	RTRUE
?L19:	FSET? ELEVATOR-DOOR,OPENBIT \FALSE
	MOVE PRSO,CS-ELEVATOR-ROOM
	PRINTR "Thrown."
?L18:	EQUAL? PRSA,V?OPEN \FALSE
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L24
	PUSH ELEVATOR-DOOR
	JUMP ?L26
?L24:	CALL THIS-FLOOR-DOOR >STACK
?L26:	CALL NEW-PRSO,STACK
	RTRUE

	.FUNCT ELEVATOR-DOOR-F
	EQUAL? PRSA,V?OPEN \?L1
	CALL PERFORM,V?PUSH,OPEN-BUTTON
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE \?L3
	CALL PERFORM,V?PUSH,CLOSE-BUTTON
	RTRUE
?L3:	EQUAL? PRSA,V?THROUGH \?L4
	CALL DO-WALK,P?NORTH
	RTRUE
?L4:	ZERO? ELEVATOR-LOC \?L6
	CALL REDIRECT,ELEVATOR-DOOR,ELEVATOR-DOOR-B >STACK
	RSTACK
?L6:	EQUAL? ELEVATOR-LOC,1 \?L8
	CALL REDIRECT,ELEVATOR-DOOR,ELEVATOR-DOOR-1 >STACK
	RSTACK
?L8:	EQUAL? ELEVATOR-LOC,2 \?L9
	CALL REDIRECT,ELEVATOR-DOOR,ELEVATOR-DOOR-2 >STACK
	RSTACK
?L9:	EQUAL? ELEVATOR-LOC,3 \FALSE
	CALL REDIRECT,ELEVATOR-DOOR,ELEVATOR-DOOR-3 >STACK
	RSTACK

	.FUNCT ELEVATOR-DOORS-DESC,RARG,DOOR
	EQUAL? RARG,M-OBJDESC? \?L1
	FSET? DOOR,OPENBIT /TRUE
	RETURN M-FATAL
?L1:	CALL BUTTON-GLOWING,UP-BUTTON,E-UP
	CALL BUTTON-GLOWING,DOWN-BUTTON,E-DOWN
	CALL ELEVATOR-DOORS-OPEN-CLOSED,DOOR >STACK
	RSTACK

	.FUNCT BUTTON-GLOWING,OBJ,BIT,F
	GETP HERE,P?FLOOR >F
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	ZERO? STACK /FALSE
	GET BUTTONS,F >STACK
	BTST STACK,BIT \FALSE
	CALL CTHE-PRINT,OBJ
	PRINTI " is glowing. "
	RTRUE

	.FUNCT ELEVATOR-DOORS-OPEN-CLOSED,DOOR,H?
	CALL CTHE-PRINT,ELEVATOR-DOOR
	PRINTI " are "
	FSET? DOOR,OPENBIT \?L1
	FIRST? DOOR >STACK \?L3
	PRINTI "wedged open with "
	FIRST? DOOR >STACK /?L5
?L5:	CALL PRINTA,STACK
	PRINTI ", revealing "
	CALL ELEVATOR-HERE? >H?
	ZERO? H? /?L6
	PRINTI "the elevator"
	JUMP ?L8
?L6:	PRINTI "a dim "
	PRINTD SHAFT-B
?L8:	PRINTI " beyond."
	ZERO? H? \FALSE
	CRLF
	CRLF
	CALL SHAFT-DESC >STACK
	RSTACK
?L3:	PRINTI "open."
	RTRUE
?L1:	PRINTI "closed."
	RTRUE

	.FUNCT ELEVATOR-DOOR-CONT,RARG,L
	EQUAL? PRSA,V?TAKE \FALSE
	LOC PRSO >L
	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
	CALL REMOVE-WEDGER,PRSO,L
	RTRUE

	.FUNCT OPEN-ELEVATOR-DOOR
	FSET PRSO,OPENBIT
	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK /?L1
	FSET ELEVATOR-DOOR,OPENBIT
	RTRUE
?L1:	EQUAL? HERE,ELEVATOR-PIT \?L4
	MOVE SHAFT-B,CS-BASEMENT
	RTRUE
?L4:	CALL FLOOR-SHAFT >STACK
	MOVE STACK,HERE
	RTRUE

	.FUNCT REMOVE-WEDGER,WEDGER,DOOR
	FCLEAR WEDGER,NDESCBIT
	CALL CLOSE-ELEVATOR-DOOR,DOOR
	EQUAL? PRSA,V?TAKE \?L1
	PRINTI "You take "
	JUMP ?L3
?L1:	PRINTI "You pull "
?L3:	CALL THE-PRINT,WEDGER
	PRINTI " away, and the doors spring shut"
	CALL IN-DARK? >STACK
	RSTACK

	.FUNCT RELEASE-ELEVATOR-DOORS,D
	ZERO? HOLDING-DOORS? /FALSE
	CALL CLOSE-ELEVATOR-DOOR,D
	PRINT STR?217
	PRINTI "doors, which spring shut"
	CALL IN-DARK?
	RTRUE

	.FUNCT MOVE-FROM-DOORS,D,H
	CALL THIS-FLOOR-DOOR >D
	CALL RELEASE-ELEVATOR-DOORS,D >H
	CALL END-OF-CHAIN?,H >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT END-OF-CHAIN?,H=0
	CALL HELD?,CHAIN >STACK
	ZERO? STACK /FALSE
	ZERO? CHAIN-LOOPED? \?L3
	ZERO? CHAIN-HOOKED? /FALSE
?L3:	ZERO? H /?L4
	CRLF
?L4:	PRINT STR?218
	RTRUE

	.FUNCT ALREADY-WEDGED
	PRINTI "It's already wedged open with "
	FIRST? PRSO >STACK /?L1
?L1:	CALL PRINTA,STACK
	PRINT PERIOD
	RTRUE

	.FUNCT NOT-WHILE-MOVING?
	CALL QUEUED?,I-ELEVATOR-MOVES >STACK
	ZERO? STACK /FALSE
	ZERO? ELEVATOR-STOPPED? \FALSE
	PRINTR "Not while the elevator is moving!"

	.FUNCT FORCE-DOORS
	PRINTI "You force the "
	EQUAL? HERE,ELEVATOR-PIT \?L1
	PRINTI "plates"
	JUMP ?L3
?L1:	PRINTI "doors"
?L3:	PRINTI " apart with "
	EQUAL? PRSI,0,HANDS \?L4
	PRINTI "your hands"
	RTRUE
?L4:	CALL THE-PRINT-PRSI
	RTRUE

	.FUNCT ELEVATOR-DOORS-F,TMP=0,AUTO,EH?
	CALL ELEVATOR-HERE? >EH?
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,ELEVATOR-PIT \?L3
	PRINTI "You are looking at the inside of an"
	FSET? ELEVATOR-DOOR-B,OPENBIT \?L5
	PRINTI " open"
?L5:	PRINTI " elevator door"
	FIRST? PRSO >STACK \?L8
	PRINTI ". It's held open by "
	FIRST? PRSO >STACK /?L10
?L10:	CALL PRINTA,STACK
?L8:	PRINT PERIOD
	RTRUE
?L3:	CALL ELEVATOR-DOORS-OPEN-CLOSED,PRSO
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?RELEASE \?L13
	FSET? PRSO,OPENBIT \?L14
	ZERO? EH? /?L16
	PRINTR "The elevator usually does that itself."
?L16:	FIRST? PRSO >TMP \?L18
	MOVE TMP,HERE
	CALL REMOVE-WEDGER,TMP,PRSO
	RTRUE
?L18:	CALL RELEASE-ELEVATOR-DOORS,PRSO >STACK
	RSTACK
?L14:	PRINTR "They're closed already."
?L13:	EQUAL? PRSA,V?LOOK-INSIDE \?L21
	FSET? PRSO,OPENBIT \?L22
	PRINTI "You can see the "
	EQUAL? HERE,ELEVATOR-PIT \?L24
	PRINTI "basement of the "
	PRINTD COMP-CENTER
	PRINTR "."
?L24:	ZERO? EH? /?L26
	PRINT THE-INTERIOR
	PRINT PERIOD
	RTRUE
?L26:	PRINTD SHAFT-B
	PRINTI ". "
	CALL FLOOR-SHAFT >STACK
	CALL PERFORM-PRSA,STACK
	RTRUE
?L22:	PRINTR "They're closed, opaque, and otherwise non-transparent."
?L21:	EQUAL? PRSA,V?THROUGH \?L29
	CALL DO-WALK,P?SOUTH
	RTRUE
?L29:	EQUAL? PRSA,V?PUT \?L30
	EQUAL? PRSI,ELEVATOR-DOOR-B,ELEVATOR-DOOR-1,ELEVATOR-DOOR-2 /?L31
	EQUAL? PRSI,ELEVATOR-DOOR-3 \?L30
?L31:	FIRST? PRSI >STACK \?L32
	FIRST? PRSI >STACK /?L34
?L34:	CALL CTHE-PRINT,STACK
	PRINTR " is already holding it open."
?L32:	FSET? PRSI,OPENBIT \?L35
	CALL SWAP-VERB,V?WEDGE
	RTRUE
?L35:	PRINT YOU-CANT
	PRINTR "until it's open."
?L30:	EQUAL? PRSA,V?OPEN,V?PRY \?L37
	FSET? PRSO,OPENBIT \?L38
	FIRST? PRSO >STACK \?L40
	CALL ALREADY-WEDGED >STACK
	RSTACK
?L40:	ZERO? HOLDING-DOORS? /?L42
	PRINT HOLDING-IS-ALL
	PRINTR " It's not easy."
?L42:	ZERO? EH? /FALSE
	CALL ALREADY-OPEN >STACK
	RSTACK
?L38:	ZERO? EH? /?L45
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L46
	PRINTI "You are in the elevator"
	JUMP ?L48
?L46:	PRINT STR?207
	PRINTI "here"
?L48:	PRINTI ", so the doors will open when you press "
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L49
	CALL THE-PRINT,OPEN-BUTTON
	PRINTR "."
?L49:	PRINTR "a call button."
?L45:	EQUAL? PRSI,0,HANDS,CROWBAR /?L53
	EQUAL? PRSI,AXE,BOLT-CUTTER,KNIFE \?L52
?L53:	CALL NOT-WHILE-MOVING? >STACK
	ZERO? STACK \TRUE
	SET 'HOLDING-DOORS?,1
	CALL OPEN-ELEVATOR-DOOR
	CALL FORCE-DOORS
	PRINTI ", barely able to hold them open. Beyond you see "
	EQUAL? HERE,ELEVATOR-PIT \?L57
	PRINTR "the basement."
?L57:	EQUAL? HERE,CS-BASEMENT \?L60
	PRINTI "the bottom of the "
	PRINTD SHAFT-B
	PRINTI " only a few feet below. "
	JUMP ?L62
?L60:	PRINTI "the "
	PRINTD SHAFT-B
	PRINTI ". "
?L62:	CALL SHAFT-DESC
	CRLF
	RTRUE
?L52:	CALL WITH-PRSI? >STACK
	RSTACK
?L37:	EQUAL? PRSA,V?PUT-BETWEEN \?L64
	EQUAL? PRSI,ELEVATOR-DOOR-B,ELEVATOR-DOOR-1,ELEVATOR-DOOR-2 /?L65
	EQUAL? PRSI,ELEVATOR-DOOR-3 \?L64
?L65:	CALL SWAP-VERB,V?WEDGE
	RTRUE
?L64:	EQUAL? PRSA,V?WEDGE \FALSE
	EQUAL? PRSO,ELEVATOR-DOOR-B,ELEVATOR-DOOR-1,ELEVATOR-DOOR-2 /?L67
	EQUAL? PRSO,ELEVATOR-DOOR-3 \FALSE
?L67:	EQUAL? PRSO,PRSI \?L68
	CALL TELL-YUKS
	RTRUE
?L68:	FIRST? PRSO >STACK \?L70
	CALL ALREADY-WEDGED
	RTRUE
?L70:	CALL NOT-WHILE-MOVING? >STACK
	ZERO? STACK \TRUE
	FSET? PRSO,OPENBIT /?L83
	CALL FORCE-DOORS
	PRINTI ", revealing "
	EQUAL? HERE,ELEVATOR-PIT /?L77
	EQUAL? HERE,CS-ELEVATOR-ROOM \?L78
	ZERO? ELEVATOR-LOC \?L75
?L77:	PRINTI "the basement of the "
	PRINTD COMP-CENTER
	PRINTI ". "
	JUMP ?L83
?L75:	EQUAL? HERE,CS-ELEVATOR-ROOM \?L78
	EQUAL? ELEVATOR-LOC,1 \?L79
	PRINTI "a lobby."
	CRLF
	JUMP ?L83
?L79:	PRINTI "a corridor."
	CRLF
	JUMP ?L83
?L78:	ZERO? EH? \?L82
	SET 'TMP,1
	PRINTI "a dark "
	PRINTD SHAFT-B
	PRINTI ". "
	JUMP ?L83
?L82:	PRINT THE-INTERIOR
	PRINTI ". "
?L83:	EQUAL? PRSI,CROWBAR,BOLT-CUTTER,AXE \?L85
	CALL OPEN-ELEVATOR-DOOR
	FSET PRSI,NDESCBIT
	SET 'HOLDING-DOORS?,0
	MOVE PRSI,PRSO
	CALL CTHE-PRINT-PRSI
	PRINTI " wedges nicely between the doors, holding them securely open."
	ZERO? TMP /?L87
	PRINTI " "
	CALL SHAFT-DESC
?L87:	CRLF
	RTRUE
?L85:	EQUAL? PRSI,PLASTIC-CONTAINER \?L90
	CALL ROB,PRSI,HERE >TMP
	REMOVE PRSI
	PRINTI "The plastic container holds the doors open for a moment, and then is crushed by the force."
	CALL PRINT-ID,STR?219
	ZERO? TMP /?L91
	PRINTI " The contents of the container spill to the ground."
?L91:	CRLF
	RTRUE
?L90:	PRINT YOU-CANT
	PRINTI "wedge the door with "
	CALL PRINTA-PRSI
	PRINT PERIOD
	RTRUE

	.FUNCT DESCRIBE-STAIRS
	PRINTI " Stairs also lead "
	EQUAL? HERE,COMP-CENTER,CS-2ND \?L1
	PRINTI "up and down"
	JUMP ?L4
?L1:	EQUAL? HERE,CS-BASEMENT \?L3
	PRINTI "up"
	JUMP ?L4
?L3:	PRINTI "down"
?L4:	PRINTI ", for the energetic. "
	RTRUE

	.FUNCT UP-BUTTON-F,BIT=E-UP,OLD,FLOOR
	GETP HERE,P?FLOOR >FLOOR
	GET BUTTONS,FLOOR >OLD
	EQUAL? PRSA,V?EXAMINE \?L1
	BTST OLD,BIT \FALSE
	CALL CTHE-PRINT-PRSO
	PRINTR " is glowing."
?L1:	EQUAL? PRSA,V?PUSH \FALSE
	BTST OLD,BIT /?L7
	ZERO? ELEVATOR-STOPPED? /?L9
	GETP HERE,P?FLOOR >STACK
	EQUAL? STACK,ELEVATOR-LOC \?L9
	CALL DEQUEUE,I-ELEVATOR-MOVES
	CALL QUEUE,I-ELEVATOR-DOOR-OPENS,1
	PRINTI "You push "
	CALL THE-PRINT-PRSO
	PRINT PERIOD
	RTRUE
?L9:	BOR BIT,OLD >STACK
	PUT BUTTONS,FLOOR,STACK
	ZERO? ELEVATOR-STOPPED? /?L14
	CALL PICK-ELEVATOR-DIRECTION
	CALL QUEUED?,I-ELEVATOR-DOOR-CLOSES >STACK
	ZERO? STACK \?L14
	CALL QUEUE,I-ELEVATOR-MOVES,1,1
?L14:	CALL CTHE-PRINT-PRSO
	PRINT STR?208
	RTRUE
?L7:	PRINT ALREADY-GLOWING
	RTRUE

	.FUNCT DOWN-BUTTON-F
	CALL UP-BUTTON-F,E-DOWN >STACK
	RSTACK

	.FUNCT CS-ELEVATOR-ENTER
	EQUAL? WINNER,URCHIN /FALSE
	ZERO? ELEVATOR-STOPPED? /?L3
	GETP HERE,P?FLOOR >STACK
	EQUAL? ELEVATOR-LOC,STACK \?L3
	CALL DOOR-AT-ELEVATOR >STACK
	FSET? STACK,OPENBIT \?L4
	CALL END-OF-CHAIN? >STACK
	ZERO? STACK \FALSE
	RETURN CS-ELEVATOR-ROOM
?L4:	CALL CTHE-PRINT,ELEVATOR-DOOR
	PRINTI " aren't open."
	CRLF
	RFALSE
?L3:	EQUAL? HERE,CS-BASEMENT \?L10
	FSET? ELEVATOR-DOOR-B,OPENBIT \?L10
	CALL CS-PIT-ENTER >STACK
	RSTACK
?L10:	CALL THIS-FLOOR-DOOR >STACK
	FSET? STACK,OPENBIT \?L11
	CALL THIS-FLOOR-DOOR >STACK
	FIRST? STACK >STACK \?L11
	PRINTI "You would fall "
	IN? ELEVATOR-FLOOR,HERE \?L12
	PRINTI "onto the machinery"
	JUMP ?L14
?L12:	PRINT INTO-THE-SHAFT
?L14:	PRINTI ". Not a pretty fate."
	CRLF
	RFALSE
?L11:	PRINTI "The elevator isn't here."
	CRLF
	RFALSE

	.FUNCT CS-ELEVATOR-EXIT
	ZERO? ELEVATOR-STOPPED? /?L1
	CALL DOOR-AT-ELEVATOR >STACK
	FSET? STACK,OPENBIT /?L3
	CALL CTHE-PRINT,ELEVATOR-DOOR
	PRINTI " are closed."
	CRLF
	RFALSE
?L3:	ZERO? ELEVATOR-LOC \?L5
	RETURN CS-BASEMENT
?L5:	EQUAL? ELEVATOR-LOC,1 \?L6
	RETURN COMP-CENTER
?L6:	EQUAL? ELEVATOR-LOC,2 \?L7
	RETURN CS-2ND
?L7:	EQUAL? ELEVATOR-LOC,3 \FALSE
	RETURN CS-3RD
?L1:	PRINT STILL-MOVING
	CRLF
	RFALSE

	.FUNCT HEAVY-JUNK?,WHO,F
	FIRST? WHO >F \FALSE
?L4:	EQUAL? F,HAND \?L6
	FSET? F,PERSON /?L8
?L6:	EQUAL? F,CROWBAR /?L8
	GETP F,P?SIZE >STACK
	GRTR? STACK,5 \?L8
	RETURN F
?L8:	NEXT? F >F /?L4
	RFALSE

	.FUNCT TOMB-SQUEEZE,TMP
	EQUAL? WINNER,PLAYER \?L1
	CALL HEAVY-JUNK?,WINNER >TMP
	ZERO? TMP /?L3
	PRINTI "It's too tight a fit carrying "
	CALL THE-PRINT,TMP
	PRINT PERIOD
	CALL THIS-IS-IT,TMP
	RFALSE
?L3:	EQUAL? HERE,TOMB \?L5
	RETURN SUB-BASEMENT
?L5:	RETURN TOMB
?L1:	IN? WINNER,TOMB \?L8
	RETURN SUB-BASEMENT
?L8:	RETURN TOMB

	.FUNCT TOMB-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is a tiny, narrow, ill-fitting room. It appears to have been a left over space from the joining of two preexisting buildings. It is roughly coffin shaped. The walls are covered by decades of overlaid graffiti, but there is one which is painted in huge fluorescent letters that were apparently impossible for later artists to completely deface. On the floor is a rusty access hatch"
	EQUAL? PADLOCK-ON?,ACCESS-HATCH \?L3
	PRINTI " locked with a huge padlock"
	JUMP ?L5
?L3:	FSET? ACCESS-HATCH,OPENBIT \?L5
	PRINTI " which is open"
?L5:	PRINT PERIOD
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?READ,V?EXAMINE \?L8
	EQUAL? PRSO,GRAFFITI,WALL \?L8
	PRINTR "It reads ""The Tomb of the Unknown Tool."""
?L8:	EQUAL? PRSA,V?THROW,V?DROP \FALSE
	EQUAL? PRSI,GLOBAL-HOLE \FALSE
	MOVE PRSO,TUNNEL
	PRINTR "Gone."

	.FUNCT LADDER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,TOMB,TUNNEL \FALSE
	PRINTR "It's a rusty ladder made of welded iron set in the wall."
?L1:	EQUAL? PRSA,V?CLIMB-UP \?L6
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?CLIMB-DOWN \?L7
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?CLIMB-FOO \FALSE
	EQUAL? HERE,TOMB,INSIDE-DOME,ALCHEMY-LAB \?L9
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L9:	EQUAL? HERE,TUNNEL,BROWN-ROOF,UNDER-ALCHEMY-LAB \FALSE
	CALL DO-WALK,P?UP >STACK
	RSTACK

	.FUNCT UNLOCK-PADLOCK-FIRST
	CALL CTHE-PRINT,PADLOCK
	PRINTI " locks "
	CALL THE-PRINT,PADLOCK-ON?
	PRINTI " in place"
	PRINT PERIOD
	RTRUE

	.FUNCT ALREADY-LOCKED-TO
	CALL CTHE-PRINT,PADLOCK
	PRINTI " is already locked to "
	CALL THE-PRINT,PADLOCK-ON?
	PRINT PERIOD
	RTRUE

	.FUNCT ACCESS-HATCH-F
	EQUAL? PRSA,V?EXAMINE \?L1
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?HOLE \?L3
	CALL NEW-VERB,V?LOOK-INSIDE
	RTRUE
?L3:	PRINTI "The hatch is made of stamped, ridged steel. It was originally painted institutional grey, but has been the victim of innumerable graffiti artists since. You can still make out the stencilled warning ""Authorized personnel only"" which has been carefully prefixed by ""UN,"" and suffixed by ""This means you!"" both in a disgusting fiery red. The hatch is "
	EQUAL? PADLOCK-ON?,ACCESS-HATCH \?L6
	PRINTI "locked with a padlock"
	JUMP ?L8
?L6:	PRINTI "unlocked"
?L8:	PRINT PERIOD
	RTRUE
?L1:	EQUAL? PRSA,V?UNLOCK \?L9
	CALL NEW-PRSO,PADLOCK
	RTRUE
?L9:	EQUAL? PRSA,V?OPEN,V?RAISE \?L10
	FSET? PRSO,LOCKED \?L11
	CALL UNLOCK-PADLOCK-FIRST >STACK
	RSTACK
?L11:	FSET? PRSO,OPENBIT /FALSE
	CALL PUT-GLOBAL,HERE,0,GLOBAL-HOLE
	CALL PUT-GLOBAL,HERE,1,LADDER
	FSET PRSO,OPENBIT
	FSET TUNNEL,ONBIT
	FSET TUNNEL-EAST,ONBIT
	FSET TUNNEL-WEST,ONBIT
	PRINTI "The hatch is heavy, and its hinges are rusty, but "
	EQUAL? HERE,TUNNEL \?L14
	PRINTR "it opens."
?L14:	PRINTR "you pull and strain and it opens with a scream of metal. Revealed below is a rusty ladder leading down. Warm, fetid air coils up out of the hole. There is a burned out (no, smashed) utility light set in the wall a few feet down."
?L10:	EQUAL? PRSA,V?CLOSE,V?LOWER \?L18
	FSET? PRSO,OPENBIT \FALSE
	CALL PUT-GLOBAL,HERE,0,0
	CALL PUT-GLOBAL,HERE,1,0
	FCLEAR TUNNEL,ONBIT
	FCLEAR TUNNEL-EAST,ONBIT
	FCLEAR TUNNEL-WEST,ONBIT
	FCLEAR ACCESS-HATCH,OPENBIT
	PRINTI "The hatch closes"
	CALL IN-DARK? >STACK
	RSTACK
?L18:	EQUAL? PRSA,V?LOCK \?L24
	EQUAL? PRSO,ACCESS-HATCH \?L24
	EQUAL? PRSI,PADLOCK /?L23
?L24:	EQUAL? PRSA,V?PUT-ON \?L22
	EQUAL? PRSO,PADLOCK \?L22
	EQUAL? PRSI,ACCESS-HATCH \?L22
?L23:	ZERO? PADLOCK-ON? /?L25
	CALL ALREADY-LOCKED-TO >STACK
	RSTACK
?L25:	FSET? ACCESS-HATCH,LOCKED \?L27
	PRINT IT-ALREADY-IS
	RTRUE
?L27:	SET 'PADLOCK-ON?,ACCESS-HATCH
	FSET PADLOCK,NDESCBIT
	FCLEAR PADLOCK,OPENBIT
	FSET PADLOCK,LOCKED
	MOVE PADLOCK,ACCESS-HATCH
	FSET ACCESS-HATCH,LOCKED
	FCLEAR ACCESS-HATCH,OPENBIT
	PRINTR "Locked up safe and secure!"
?L22:	EQUAL? PRSA,V?LOOK-INSIDE \?L29
	FSET? PRSO,OPENBIT \?L30
	PRINTI "You see a"
	EQUAL? HERE,TOMB \?L32
	PRINTI " dark"
	PRINT STR?220
	CRLF
	RTRUE
?L32:	PRINTR "n oddly shaped small room."
?L30:	CALL TELL-OPEN-CLOSED,PRSO >STACK
	RSTACK
?L29:	EQUAL? PRSA,V?THROUGH \FALSE
	EQUAL? HERE,TUNNEL \?L37
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L37:	EQUAL? HERE,TOMB \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT PADLOCK-F,LP
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINT STR?221
	PRINTI "been spray painted many times by graffiti artists. It's currently fluorescent purple. In spite of the many coats of paint, the lock manages to be rusty and, in fact, almost slimy-looking. The padlock is "
	FSET? PADLOCK,LOCKED \?L3
	PRINTI "locked"
	ZERO? PADLOCK-ON? /?L8
	PRINTI " to "
	CALL THE-PRINT,PADLOCK-ON?
	JUMP ?L8
?L3:	PRINTI "unlocked"
?L8:	PRINT PERIOD
	RTRUE
?L1:	EQUAL? PRSA,V?READ \?L9
	PRINT STR?221
	PRINTR "no identifiable brand or symbol on it."
?L9:	EQUAL? PRSA,V?TAKE \?L10
	ZERO? PADLOCK-ON? /?L10
	CALL UNLOCK-PADLOCK-FIRST >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?PUT-ON \?L11
	CALL SWAP-VERB,V?LOCK
	RTRUE
?L11:	EQUAL? PRSA,V?LOCK,V?CLOSE,V?TIE \?L12
	ZERO? PADLOCK-ON? /?L13
	CALL ALREADY-LOCKED-TO >STACK
	RSTACK
?L13:	EQUAL? PRSI,0,MASTER-KEY \?L15
	FSET PRSO,LOCKED
	FCLEAR PRSO,OPENBIT
	PRINTR "Okay, you've now closed the padlock."
?L15:	EQUAL? PRSI,PADLOCK \?L16
	EQUAL? PRSO,CHAIN,CHAIN-1,CHAIN-2 /?L16
	EQUAL? PRSO,ACCESS-HATCH /?L16
	CALL CANT-LOCK,PRSO >STACK
	RSTACK
?L16:	EQUAL? PRSO,PADLOCK \FALSE
	EQUAL? PRSI,CHAIN,CHAIN-1,CHAIN-2 /?L20
	EQUAL? PRSI,ACCESS-HATCH \?L18
?L20:	CALL PERFORM,V?LOCK,PRSI,PADLOCK
	RTRUE
?L18:	CALL CANT-LOCK,PRSI >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?UNLOCK /?L24
	EQUAL? PRSA,V?OPEN \?L23
	FSET? PADLOCK,LOCKED \?L23
?L24:	FSET? PRSO,LOCKED /?L25
	PRINT IT-ALREADY-IS
	RTRUE
?L25:	ZERO? PRSI \?L27
	PRINT YOU-HAVE-TO
	PRINTI "use a key for that."
	CRLF
	CALL PRINT-ID,STR?222 >STACK
	RSTACK
?L27:	EQUAL? PRSI,MASTER-KEY \?L28
	ZERO? PADLOCK-ON? /?L33
	LOC PADLOCK >LP
	FCLEAR LP,LOCKED
	IN? LP,LOCAL-GLOBALS \?L31
	MOVE PADLOCK,HERE
	JUMP ?L33
?L31:	LOC LP >STACK
	MOVE PADLOCK,STACK
?L33:	FCLEAR PADLOCK,NDESCBIT
	FCLEAR PADLOCK,LOCKED
	FSET PADLOCK,OPENBIT
	PRINTI "The lock, though rusty and unwilling, opens"
	ZERO? PADLOCK-ON? /?L35
	PRINTI ", releasing "
	CALL THE-PRINT,PADLOCK-ON?
	CALL PRINT-ID,STR?223
?L35:	SET 'PADLOCK-ON?,0
	PRINT PERIOD
	RTRUE
?L28:	EQUAL? PRSI,KEY-1,KEY-2,KEY-3 /?L39
	EQUAL? PRSI,KEY-4 \?L38
?L39:	CALL CTHE-PRINT-PRSI
	PRINT STR?111
	PRINTI "open this lock."
	CRLF
	CALL PRINT-ID,STR?224 >STACK
	RSTACK
?L38:	ZERO? PRSI \?L40
	PRINT STR?225
	PRINTI "a key."
	CRLF
	CALL PRINT-ID,STR?226 >STACK
	RSTACK
?L40:	PRINT YOU-CANT
	PRINTI "open this lock with "
	CALL PRINTA-PRSI
	PRINTI "!"
	CRLF
	CALL PRINT-ID,STR?227 >STACK
	RSTACK
?L23:	EQUAL? PRSA,V?MUNG,V?CUT,V?ATTACK \FALSE
	EQUAL? PRSO,PADLOCK \FALSE
	CALL PRINT-ID,STR?228
	EQUAL? PRSI,SMOOTH-STONE \?L43
	PRINTR "You smash against the padlock with the stone. As expected, there is no result. In fact, both stone and padlock are unmarred."
?L43:	EQUAL? PRSI,AXE \?L45
	PRINTR "All you succeed in doing is blunting the axe a little."
?L45:	PRINTR "In spite of its present defacement, this is a good padlock. Your feeble attempts have no effect."

	.FUNCT CANT-LOCK,OBJ
	CALL CTHE-PRINT,PADLOCK
	PRINTI " can't lock onto "
	CALL THE-PRINT,OBJ
	PRINT PERIOD
	RTRUE

	.FUNCT GRAFFITI-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	PRINTI """"
	CALL PICK-ONE,GRAFFITI-TABLE >STACK
	PRINT STACK
	PRINTR """"

	.FUNCT STEAM-EXIT
	FSET? PRESSURE-VALVE,OPENBIT \?L1
	EQUAL? WINNER,PLAYER \FALSE
	PRINTI "You would be plunging into scalding steam. Not such a smart idea, if you ask me."
	CRLF
	CALL PRINT-ID,STR?229
	RFALSE
?L1:	EQUAL? HERE,TUNNEL \?L6
	RETURN TUNNEL-EAST
?L6:	RETURN TUNNEL

	.FUNCT RATS-EXIT,H
	IN? RATS,HERE \?L1
	ZERO? ON-CABLE? \?L1
	INC 'RATS-HERE
	PRINTI "You plunge into the mass of rats, but there are too many of them, and you can't force your way past."
	CRLF
	CALL PRINT-ID,STR?230
	RFALSE
?L1:	EQUAL? HERE,TUNNEL-WEST \?L3
	RETURN TUNNEL-ENTRANCE
?L3:	EQUAL? HERE,TUNNEL \?L4
	RETURN TUNNEL-WEST
?L4:	EQUAL? HERE,TUNNEL-EAST \?L5
	CALL STEAM-EXIT >STACK
	RSTACK
?L5:	EQUAL? HERE,STEAM-TUNNEL \?L6
	RETURN TUNNEL-EAST
?L6:	EQUAL? HERE,STEAM-TUNNEL-EAST \FALSE
	RETURN STEAM-TUNNEL

	.FUNCT TUNNEL-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	CALL TUNNEL-AND-PIPE
	PRINTR "You have gone from the arctic to the tropics. The concrete tunnel has odd molds and fungi growing on its walls and ceiling, and the floor is squishy. Torn clots of insulation litter the floor. Along the ceiling runs a thick tangle of coaxial cable. The tunnel heads east and west. A rusty metal ladder leads up."
?L1:	EQUAL? RARG,M-BEG \?L3
	ZERO? RATS-HERE /FALSE
	EQUAL? PRSA,V?WALK \?L6
	EQUAL? P-WALK-DIR,P?UP \?L6
	SET 'ON-CABLE?,0
	PRINTI "You force your way through the mass of rats, grabbing onto the rusty ladder like a mast on a stormy sea, and begin to pull your way up. A few rats drop off, squealing in anger. You climb higher, reaching the hatch, as the last of the rats drops to the floor below."
	CRLF
	CRLF
	RFALSE
?L6:	CALL FOOD-FOR-RATS >STACK
	ZERO? STACK /FALSE
	RTRUE
?L3:	EQUAL? RARG,M-ENTER \FALSE
	GETP PRESSURE-VALVE,P?VALUE >STACK
	ZERO? STACK /FALSE
	CALL DEQUEUE,I-RATS-GO-AWAY
	CALL QUEUE,I-RATS,-1 >STACK
	RSTACK

	.FUNCT THROW-FOOD
	REMOVE PRSO
	PRINTI "A small contingent of rats falls greedily upon "
	CALL THE-PRINT-PRSO
	PRINTR ", biting and scratching, fighting desperately for it. The rest of the rats are not distracted, however."

	.FUNCT TUNNEL-EAST-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	CALL TUNNEL-AND-PIPE
	PRINTI "A thick bundle of coaxial cable runs east to west along the ceiling. There is a pressure release valve on the steam pipe here."
	FSET? PRESSURE-VALVE,OPENBIT \?L3
	PRINTI " The valve is"
	PRINT WIDE-OPEN
?L3:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	CALL FOOD-FOR-RATS >STACK
	RSTACK

	.FUNCT FOOD-FOR-RATS
	ZERO? RATS-HERE /FALSE
	EQUAL? PRSA,V?DROP /?L5
	EQUAL? PRSA,V?GIVE \FALSE
	EQUAL? PRSI,RATS \FALSE
?L5:	FSET? PRSO,FOODBIT \FALSE
	CALL THROW-FOOD >STACK
	RSTACK

	.FUNCT STEAM-TUNNEL-F,RARG
	EQUAL? RARG,M-BEG \FALSE
	CALL FOOD-FOR-RATS >STACK
	RSTACK

	.FUNCT ELEVATOR-PIT-ENTER
	ZERO? BRICK-WALL-FLAG /?L1
	ZERO? ELEVATOR-LOC \?L3
	PRINTI "A "
	PRINTD ELEVATOR-FLOOR
	PRINTI " blocks your way."
	CRLF
	RFALSE
?L3:	RETURN ELEVATOR-PIT
?L1:	PRINTI "You are trying to walk through a brick wall."
	CRLF
	RFALSE

	.FUNCT STEAM-TUNNEL-EAST-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "The steam pipe and coaxial cable turn upwards and disappear into the ceiling here. The tunnel itself comes to an end in a grimy, damp, and dripping triad of crumbling brick walls."
	ZERO? BRICK-WALL-FLAG \?L3
	ZERO? BRICK-FLAG \?L3
	PRINTI " The south wall looks particularly decrepit."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \?L6
	EQUAL? PRSA,V?RUB \?L7
	EQUAL? PRSO,AIR \?L7
	CALL NEW-PRSO,BRICK-WALL
	RTRUE
?L7:	EQUAL? PRSA,V?THROUGH \?L9
	EQUAL? PRSO,GLOBAL-HOLE \?L9
	CALL DO-WALK,P?SOUTH >STACK
	RSTACK
?L9:	CALL FOOD-FOR-RATS >STACK
	RSTACK
?L6:	EQUAL? RARG,M-ENTER \FALSE
	CALL MOVE-WALL,A?SOUTH
	ZERO? BRICK-WALL-FLAG \?L16
	BTST BRICK-FLAG,BF-TUNNEL /?L14
	MOVE BROKEN-BRICK,BRICK-WALL
	JUMP ?L16
?L14:	BTST BRICK-FLAG,BF-PIT /?L16
	MOVE NEW-BRICK,BRICK-WALL
?L16:	CALL RANDOM-ELEVATOR-MOTION
	GETP PRESSURE-VALVE,P?VALUE >STACK
	ZERO? STACK /FALSE
	FSET? PRESSURE-VALVE,OPENBIT /FALSE
	CALL DEQUEUE,I-RATS-GO-AWAY
	CALL QUEUE,I-RATS,-1 >STACK
	RSTACK

	.FUNCT NEW-BRICK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's a new brick. It appears to be of relatively recent vintage."
?L1:	EQUAL? PRSA,V?PRY,V?ATTACK \FALSE
	EQUAL? PRSI,CROWBAR \FALSE
	IN? PRSO,BRICK-WALL \?L4
	CALL NEW-PRSO,BRICK-WALL
	RTRUE
?L4:	CALL TRY-ANOTHER-BRICK >STACK
	RSTACK

	.FUNCT TRY-ANOTHER-BRICK
	PRINT YOUVE-ALREADY
	PRINTI "pried that brick loose, maybe you should attack the wall again."
	CRLF
	EQUAL? PRSA,V?ATTACK /?L1
	PUSH 0
	JUMP ?L2
?L1:	PUSH 1
?L2:	CALL PRINT-ID,STR?231,STACK >STACK
	RSTACK

	.FUNCT BROKEN-BRICK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's a crumbling, broken brick. Little bits of mortar still cling to it."
?L1:	EQUAL? PRSA,V?PRY,V?ATTACK \?L3
	EQUAL? PRSI,CROWBAR \?L3
	IN? PRSO,BRICK-WALL \?L4
	CALL NEW-PRSO,BRICK-WALL
	RTRUE
?L4:	CALL TRY-ANOTHER-BRICK >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?REPAIR \FALSE
	CALL CTHE-PRINT-PRSO
	PRINTI " isn't that broken."
	CRLF
	CALL PRINT-ID,STR?232 >STACK
	RSTACK

	.FUNCT ROD-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's rusty, obviously didn't help the wall all that much, and runs up and down through the hole you have made."
	ZERO? CHAIN-LOOPED? /?L3
	PRINTI " There is a length of greasy chain wrapped around it."
	CALL TELL-IF-LOCKED
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE,V?UNTIE \?L6
	EQUAL? PRSO,CHAIN \?L6
	EQUAL? PRSI,ROD \?L6
	ZERO? CHAIN-LOOPED? /?L6
	CALL PERFORM-PRSA,CHAIN-2,ROD
	RTRUE
?L6:	EQUAL? PRSA,V?LOCK \?L7
	EQUAL? PRSO,CHAIN,CHAIN-2 \?L7
	EQUAL? PRSI,ROD \?L7
	ZERO? CHAIN-LOOPED? /?L8
	CALL HELD?,PADLOCK >STACK
	ZERO? STACK /?L8
	CALL PERFORM-PRSA,CHAIN-2,PADLOCK
	RTRUE
?L8:	CALL HELD?,PADLOCK >STACK
	ZERO? STACK /?L10
	PRINTR "The hasp of the padlock won't fit around the rod."
?L10:	PRINTR "You don't seem to have anything to lock it with."
?L7:	EQUAL? PRSA,V?PRY,V?MOVE \FALSE
	PRINTR "It's pretty solidly mortared in."

	.FUNCT BRICK-HOLE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINT STR?192
	ZERO? BRICK-WALL-FLAG /?L3
	PRINTR "huge hole here, where the wall has collapsed."
?L3:	EQUAL? BRICK-FLAG,BF-BOTH \?L5
	PRINTR "large hole here, with a reinforcing rod running through it."
?L5:	CALL HOLE-IN-BRICKS? >STACK
	ZERO? STACK /FALSE
	PRINTR "small hole in the wall where a brick was removed."
?L1:	EQUAL? PRSA,V?PUT \?L8
	EQUAL? PRSI,BRICK-HOLE \?L8
	ZERO? BRICK-WALL-FLAG /?L9
	PRINTR "The hole that's there now is big enough for you to walk through. Hence, no such luck."
?L9:	MOVE PRSO,HERE
	PRINTI "You put "
	CALL THE-PRINT-PRSO
	PRINTI " in the hole, but "
	EQUAL? PRSO,NEW-BRICK,BROKEN-BRICK \?L12
	PRINTI "it doesn't fit very tightly any more, so "
	JUMP ?L14
?L12:	PRINTI "as the hole is irregular, "
?L14:	PRINTR "it falls out again and drops to the floor."
?L8:	EQUAL? PRSA,V?THROUGH \?L15
	ZERO? BRICK-WALL-FLAG /?L16
	EQUAL? HERE,ELEVATOR-PIT \?L18
	PUSH P?NORTH
	JUMP ?L20
?L18:	PUSH P?SOUTH
?L20:	CALL DO-WALK,STACK >STACK
	RSTACK
?L16:	PRINTR "The hole is the size of a brick. You are somewhat larger."
?L15:	EQUAL? PRSA,V?LOOK-INSIDE \?L22
	CALL REDIRECT,BRICK-HOLE,BRICK-WALL >STACK
	RSTACK
?L22:	EQUAL? PRSA,V?REACH-IN \FALSE
	ZERO? BRICK-WALL-FLAG /?L24
	PRINTR "Plenty of room there."
?L24:	EQUAL? BRICK-FLAG,BF-BOTH \?L26
	PRINTR "You reach in and touch the reinforcing rod."
?L26:	PRINTR "When you reach in you get the impression there is some metal in the hole."

	.FUNCT HOLE-IN-BRICKS?,?TMP
	EQUAL? BRICK-FLAG,BF-BOTH /TRUE
	EQUAL? HERE,STEAM-TUNNEL-EAST /?L6
	PUSH 0
	JUMP ?L8
?L6:	EQUAL? BRICK-FLAG,BF-TUNNEL /?L7
	PUSH 0
	JUMP ?L8
?L7:	PUSH 1
?L8:	POP '?TMP
	ZERO? ?TMP /?L4
	RETURN ?TMP
?L4:	EQUAL? HERE,ELEVATOR-PIT \FALSE
	EQUAL? BRICK-FLAG,BF-PIT /TRUE
	RFALSE

	.FUNCT BRICK-WALL-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? \?L1
	ZERO? BRICK-WALL-FLAG \TRUE
	CALL HOLE-IN-BRICKS? >STACK
	ZERO? STACK \TRUE
	RETURN M-FATAL
?L1:	PRINTI "The "
	EQUAL? HERE,STEAM-TUNNEL-EAST \?L8
	PRINTI "southern "
?L8:	PRINTD BRICK-WALL
	ZERO? BRICK-WALL-FLAG /?L11
	PRINTI " has an enormous hole ripped in it."
	RETURN M-FATAL
?L11:	PRINTI " has a hole in it."
	FSET? ROD,INVISIBLE /?L14
	CALL TELL-ABOUT-ROD
?L14:	RETURN M-FATAL

	.FUNCT BRICK-WALL-CONT,RARG
	EQUAL? PRSA,V?TAKE,V?MOVE \FALSE
	PRINT YOU-CANT
	PRINT STR?194
	CALL THE-PRINT-PRSO
	PRINTR " with your fingers."

	.FUNCT BRICK-WALL-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,STEAM-TUNNEL-EAST \?L3
	CALL CTHE-PRINT,BRICK-WALL
	PRINTI " "
	ZERO? BRICK-WALL-FLAG /?L5
	PRINTR "is demolished. There is now a large hole leading south into another room."
?L5:	CALL HOLE-IN-BRICKS? >STACK
	ZERO? STACK /?L7
	CALL DESCRIBE-WALL-HOLE,STR?234,STR?233 >STACK
	RSTACK
?L7:	PRINTR "is in terrible shape. It's aged and crumbling, with grooves between bricks where the mortar has fallen out."
?L3:	CALL CTHE-PRINT,BRICK-WALL
	PRINTI " "
	ZERO? BRICK-WALL-FLAG /?L10
	PRINTR "is quite ruined. Fortunately it wasn't structural. There are big chunks of brick and concrete all over the floor here."
?L10:	CALL HOLE-IN-BRICKS? >STACK
	ZERO? STACK /?L12
	CALL DESCRIBE-WALL-HOLE,STR?236,STR?235 >STACK
	RSTACK
?L12:	PRINTR "is in pretty good shape. It's relatively new, and you can only see one or two loose-looking bricks."
?L1:	EQUAL? PRSA,V?TAKE,V?MOVE \?L14
	PRINTI "Though there are loose bricks, they aren't loose enough for you to just pry them out with your fingers."
	CRLF
	CALL PRINT-ID,STR?237 >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?LISTEN \?L15
	ZERO? BRICK-FLAG \?L16
	PRINTR "You place your ear to the wall, slimy and dank as it is, and hear nothing. However, you feel a weak current of cool air coming from between some of the bricks."
?L16:	PRINT COOL-AIR-FLOWING
	CALL QUEUED?,I-ELEVATOR-MOVES >STACK
	ZERO? STACK /?L19
	PRINTI ", and you can hear mechanical noises on the other side"
?L19:	PRINT PERIOD
	RTRUE
?L15:	EQUAL? PRSA,V?RUB \?L22
	PRINTI "The wall is slimy, dank, and damp. "
	ZERO? BRICK-FLAG \?L23
	PRINTR "You feel a weak current of cool air coming from between some of the bricks."
?L23:	PRINT COOL-AIR-FLOWING
	PRINT PERIOD
	RTRUE
?L22:	EQUAL? PRSA,V?ATTACK,V?MUNG \?L26
	PRINTI "It doesn't do much"
	CALL PRINT-ID,STR?238
	ZERO? BRICK-FLAG \?L27
	PRINTI " but loosen a brick in the wall"
?L27:	PRINT PERIOD
	RTRUE
?L26:	EQUAL? PRSA,V?TAKE-OFF \?L30
	EQUAL? BRICK-FLAG,BF-BOTH /?L31
	PRINT STR?192
	PRINTR "loose brick in the wall, but you can't remove it with your hands."
?L31:	PRINTR "There aren't any more loose bricks."
?L30:	EQUAL? PRSA,V?LOOK-INSIDE \?L34
	EQUAL? HERE,STEAM-TUNNEL-EAST \?L35
	ZERO? BRICK-WALL-FLAG /?L37
	PRINT STR?192
	PRINTR "small rectangular room on the other side of the wall."
?L37:	EQUAL? BRICK-FLAG,BF-BOTH \?L39
	PRINT STR?193
	PRINTI "space, a small room containing some machinery."
	PRINT CANT-SEE-TOO-WELL
	RTRUE
?L39:	CALL HOLE-IN-BRICKS? >STACK
	ZERO? STACK /?L40
	PRINT INSIDE-OF-HOLE
	RTRUE
?L40:	PRINT CRACKS-AND-MORTAR
	RTRUE
?L35:	ZERO? BRICK-WALL-FLAG /?L43
	PRINTR "You see and dark and grimy tunnel leading west."
?L43:	EQUAL? BRICK-FLAG,BF-BOTH \?L45
	PRINTI "There is some sort of tunnel."
	PRINT CANT-SEE-TOO-WELL
	RTRUE
?L45:	CALL HOLE-IN-BRICKS? >STACK
	ZERO? STACK /?L46
	PRINT INSIDE-OF-HOLE
	RTRUE
?L46:	PRINT CRACKS-AND-MORTAR
	RTRUE
?L34:	EQUAL? PRSA,V?LOWER \?L48
	PRINTR "You aren't strong enough to pull down a brick wall."
?L48:	EQUAL? PRSA,V?PRY,V?ATTACK \FALSE
	EQUAL? PRSO,BRICK-WALL \FALSE
	EQUAL? PRSI,CROWBAR \FALSE
	ZERO? BRICK-WALL-FLAG /?L50
	PRINTI "The hole is already quite large, and further demolition would have to involve structural supports."
	CRLF
	CALL PRINT-ID,STR?239 >STACK
	RSTACK
?L50:	ZERO? BRICK-FLAG \?L52
	EQUAL? HERE,ELEVATOR-PIT \?L53
	FCLEAR NEW-BRICK,NDESCBIT
	MOVE NEW-BRICK,HERE
	CALL CHANGE-ADJECTIVE,NEW-BRICK,0
	MOVE BROKEN-BRICK,BRICK-WALL
	BOR BRICK-FLAG,BF-PIT >BRICK-FLAG
	JUMP ?L55
?L53:	FCLEAR BROKEN-BRICK,NDESCBIT
	MOVE BROKEN-BRICK,HERE
	CALL CHANGE-ADJECTIVE,BROKEN-BRICK,0
	MOVE NEW-BRICK,BRICK-WALL
	BOR BRICK-FLAG,BF-TUNNEL >BRICK-FLAG
?L55:	MOVE BRICK-HOLE,HERE
	PRINT WALL-YIELDS
	PRINTR "pulls out of the wall."
?L52:	EQUAL? BRICK-FLAG,BF-BOTH /?L56
	MOVE BRICK-HOLE,HERE
	SET 'BRICK-FLAG,BF-BOTH
	PRINT WALL-YIELDS
	FCLEAR ROD,INVISIBLE
	IN? BROKEN-BRICK,BRICK-WALL \?L57
	FCLEAR BROKEN-BRICK,NDESCBIT
	MOVE BROKEN-BRICK,STEAM-TUNNEL-EAST
	CALL CHANGE-ADJECTIVE,BROKEN-BRICK,0
	CALL BRICK-DROPS,STEAM-TUNNEL-EAST
	JUMP ?L59
?L57:	FCLEAR NEW-BRICK,NDESCBIT
	MOVE NEW-BRICK,ELEVATOR-PIT
	CALL CHANGE-ADJECTIVE,NEW-BRICK,0
	CALL BRICK-DROPS,ELEVATOR-PIT
?L59:	PRINTI ", making a hole through the wall. You can see a rusty steel reinforcing rod in the hole."
	EQUAL? HERE,STEAM-TUNNEL-EAST \?L60
	ZERO? ELEVATOR-STOPPED? \?L60
	PRINTI " You hear a whining noise through the hole."
?L60:	CRLF
	RTRUE
?L56:	PRINTR "There don't seem to be any more bricks as loose as the first two."

	.FUNCT BRICK-DROPS,THIS-SIDE
	EQUAL? HERE,THIS-SIDE \?L1
	PRINTI "comes loose and drops to the ground"
	RTRUE
?L1:	PRINTI "drops to the floor on the other side"
	RTRUE

	.FUNCT DESCRIBE-WALL-HOLE,BRICK,OK
	PRINTI "has a brick-size hole "
	EQUAL? BRICK-FLAG,BF-BOTH \?L1
	PRINTI "through it where bricks have been pried out. A steel rod is visible"
	JUMP ?L3
?L1:	CALL HOLE-IN-BRICKS? >STACK
	ZERO? STACK /?L3
	PRINTI "in it where a brick was removed. You can see "
	PRINT BRICK
	PRINTI " brick"
?L3:	PRINTI " in the hole. The rest of the wall is in "
	PRINT OK
	PRINTR " shape."

	.FUNCT THROUGH-THE,OBJ
	FSET? OBJ,WEARBIT \FALSE
	PRINTI " through "
	CALL THE-PRINT,OBJ
	RTRUE

	.FUNCT PIT-DOOR-EXIT
	FIRST? ELEVATOR-DOOR-B >STACK \?L1
	ZERO? RATS-HERE /?L3
	LESS? RATS-HERE,2 \?L5
	SET 'RATS-HERE,2
?L5:	PRINTI "You leap up the wall towards the basement, but the rats are faster! They bite your fingers"
	CALL PRINT-ID,STR?240
	CALL THROUGH-THE,GLOVES
	PRINTI ", and you release your hold, tumbling back to the pit!"
	CRLF
	RFALSE
?L3:	PRINTI "You climb up the gritty wall and out into the basement."
	CRLF
	CRLF
	RETURN CS-BASEMENT
?L1:	FSET? ELEVATOR-DOOR-B,OPENBIT \?L9
	PRINTI "You try to climb up while holding the doors open, but it's just outside the realm of possibility."
	CRLF
	RFALSE
?L9:	PRINTI "There is no apparent way through the closed "
	PRINTD ELEVATOR-DOOR
	PRINTI "."
	CRLF
	RFALSE

	.FUNCT TELL-ABOUT-ROD
	FSET? ROD,INVISIBLE /FALSE
	PRINTI " There is a vertical reinforcing rod visible in the middle of the hole."
	ZERO? CHAIN-LOOPED? /FALSE
	PRINTI " A chain is"
	PRINT LOOPED-AROUND-ROD
	ZERO? CHAIN-HOOKED? /?L5
	PRINTI " and disappears up into the shaft"
	JUMP ?L7
?L5:	IN? CHAIN,ELEVATOR-PIT \?L7
	PRINTI " and trails down onto the floor"
?L7:	PRINTI "."
	EQUAL? PADLOCK-ON?,CHAIN-2 \FALSE
	PRINTI " A padlock secures the chain."
	RTRUE

	.FUNCT ELEVATOR-PIT-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This small room is pretty bare and featureless. The north wall is brick and the other three walls are concrete. The east and west walls are adorned with rails not unlike railroad rails. Above you "
	IN? ELEVATOR-FLOOR,SHAFT-B \?L3
	PRINTR "and out of reach, the shaft is blocked by something."
?L3:	PRINTI "is an empty shaft. On the north side of the shaft is an elevator door"
	FIRST? ELEVATOR-DOOR-B >STACK \?L6
	PRINTI " wedged open by "
	FIRST? ELEVATOR-DOOR-B >STACK /?L8
?L8:	CALL PRINTA,STACK
	JUMP ?L9
?L6:	FSET? ELEVATOR-DOOR-B,OPENBIT \?L9
	PRINTI " which you are holding open"
?L9:	PRINT PERIOD
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \?L11
	CALL MOVE-WALL,A?NORTH
	ZERO? BRICK-WALL-FLAG \?L16
	BTST BRICK-FLAG,BF-PIT /?L14
	MOVE NEW-BRICK,BRICK-WALL
	JUMP ?L16
?L14:	BTST BRICK-FLAG,BF-TUNNEL /?L16
	MOVE BROKEN-BRICK,BRICK-WALL
?L16:	CALL RANDOM-ELEVATOR-MOTION >STACK
	RSTACK
?L11:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \?L20
	EQUAL? P-WALK-DIR,P?UP /?L20
	CALL HELD?,CHAIN >STACK
	ZERO? STACK /?L20
	ZERO? CHAIN-HOOKED? /?L20
	PRINT STR?218
	RTRUE
?L20:	EQUAL? PRSA,V?RUB \?L22
	EQUAL? PRSO,AIR \?L22
	CALL NEW-PRSO,BRICK-WALL
	RTRUE
?L22:	EQUAL? PRSA,V?THROUGH \?L23
	EQUAL? PRSO,GLOBAL-HOLE \?L23
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L23:	EQUAL? PRSA,V?LOOK-UP \?L24
	EQUAL? PRSO,ROOMS \?L24
	PRINTI "You see an "
	PRINTD SHAFT-B
	PRINTR "."
?L24:	EQUAL? PRSA,V?WALK \?L25
	EQUAL? P-WALK-DIR,P?UP,P?OUT /?L25
	CALL MOVE-FROM-DOORS >STACK
	RSTACK
?L25:	EQUAL? PRSA,V?LISTEN \FALSE
	EQUAL? PRSO,0,NOISE \FALSE
	ZERO? ELEVATOR-STOPPED? \?L27
	PRINTR "You hear the whine of powerful machinery."
?L27:	ZERO? BRICK-WALL-FLAG /FALSE
	CALL IN-TUNNEL?,RATS >STACK
	ZERO? STACK /FALSE
	PRINT RATS-CHITTERING
	RTRUE

	.FUNCT MOVE-WALL,A
	MOVE BRICK-WALL,HERE
	CALL CHANGE-ADJECTIVE,BRICK-WALL,0,A
	ZERO? BRICK-WALL-FLAG \?L3
	CALL HOLE-IN-BRICKS? >STACK
	ZERO? STACK /FALSE
?L3:	MOVE BRICK-HOLE,HERE
	RTRUE

	.FUNCT RANDOM-ELEVATOR-MOTION
	RANDOM 100 >STACK
	LESS? 25,STACK /FALSE
	RANDOM 4 >STACK
	SUB STACK,1 >P-NUMBER
	CALL PERFORM,V?PUSH,FLOOR-BUTTON
	RTRUE

	.FUNCT ELEVATOR-FLOOR-F
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L1
	CALL CTHE-PRINT,ELEVATOR-FLOOR
	PRINTI " is most notable for a metal hook"
	ZERO? CHAIN-HOOKED? /?L3
	PRINTI " with a chain hanging on it"
?L3:	PRINT PERIOD
	RTRUE
?L1:	EQUAL? PRSA,V?TIE,V?PUT,V?PUT-ON \FALSE
	EQUAL? PRSO,CHAIN \FALSE
	ZERO? CHAIN-HOOKED? \?L7
	PRINTI "Only the hook seems capable of such a use, so you try that. "
?L7:	CALL NEW-PRSI,HOOK
	RTRUE

	.FUNCT SHAFT-DESC,OBJ
	CALL FLOOR-SHAFT >OBJ
	IN? ELEVATOR-FLOOR,OBJ /?L3
	IN? ELEVATOR-CEILING,OBJ \?L1
?L3:	PRINTI "In the "
	PRINTD SHAFT-B
	PRINTI " "
	CALL PRINTA,ELEVATOR-FLOOR
	PRINTI " is visible."
	IN? ELEVATOR-FLOOR,OBJ \?L4
	PRINTI " One bit of the tangle is very much like a hook"
	ZERO? CHAIN-HOOKED? /?L14
	PRINTI ", and indeed, a chain is hanging from it"
	CALL HELD?,CHAIN >STACK
	ZERO? STACK /?L8
	PRINTI ". You are holding the other end of the chain"
	JUMP ?L14
?L8:	PRINTI ". The other end of the chain is "
	IN? CHAIN,HERE \?L11
	PRINTI "on the floor"
	JUMP ?L14
?L11:	CALL META-LOC,CHAIN >STACK
	EQUAL? STACK,HERE \?L13
	PRINTI "in "
	LOC CHAIN >STACK
	CALL THE-PRINT,STACK
	JUMP ?L14
?L13:	PRINTI "dangling in the shaft below"
?L14:	PRINTI "."
	RETURN M-FATAL
?L4:	IN? ELEVATOR-CEILING,OBJ \?L18
	PRINTI " The machinery has that malevolent mechanical appearance that means danger."
	RETURN M-FATAL
?L1:	PRINTI "The dark shaft opens like a waiting mouth."
?L18:	RETURN M-FATAL

	.FUNCT LIKE-A-SHAFT
	PRINT IT-LOOKS-LIKE
	CALL PRINTA,SHAFT-B
	PRINTR "."

	.FUNCT SHAFT-F
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L1
	PRINTI "The dark, grimy "
	PRINTD SHAFT-B
	PRINTI " extends up "
	IN? ELEVATOR-FLOOR,PRSO \?L3
	PRINTI "to "
	CALL PRINTA,ELEVATOR-FLOOR
	PRINTI " just above the ceiling level"
	JUMP ?L5
?L3:	PRINTI "into dimness"
?L5:	PRINTI " and down "
	IN? ELEVATOR-CEILING,PRSO \?L6
	PRINTI "to a tangle of dangerous-looking lifting machinery at about floor level"
	JUMP ?L9
?L6:	EQUAL? HERE,CS-BASEMENT \?L8
	PRINTI "to a concrete-lined pit below"
	JUMP ?L9
?L8:	PRINTI "into a dark pit below"
?L9:	IN? ELEVATOR-FLOOR,PRSO \?L16
	PRINTI ". "
	CALL CTHE-PRINT,ELEVATOR-FLOOR
	PRINTI " includes a hook-like protrusion just inside the door"
	ZERO? CHAIN-HOOKED? /?L16
	PRINTI ". A greasy chain is hooked onto the protrusion, "
	CALL HELD?,CHAIN >STACK
	ZERO? STACK /?L14
	PRINTI "terminating in your hands"
	JUMP ?L16
?L14:	PRINTI "dropping into the pit"
?L16:	PRINT PERIOD
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-UP \?L19
	CALL LIKE-A-SHAFT >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?PUT \?L20
	EQUAL? PRSI,SHAFT-B,SHAFT-1,SHAFT-2 /?L21
	EQUAL? PRSI,SHAFT-3 \?L20
?L21:	GETP HERE,P?FLOOR >STACK
	GRTR? ELEVATOR-LOC,STACK \?L22
	EQUAL? PRSO,CHAIN \?L24
	GRTR? ELEVATOR-LOC,1 \?L24
	REMOVE PRSO
	JUMP ?L27
?L24:	MOVE PRSO,ELEVATOR-PIT
	JUMP ?L27
?L22:	MOVE PRSO,ELEVATOR-CEILING
?L27:	PRINTR "Dropped."
?L20:	EQUAL? PRSA,V?THROUGH,V?BOARD \FALSE
	EQUAL? HERE,CS-BASEMENT \?L29
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L29:	PRINTR "It's a long way down."

	.FUNCT HOOK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The hook is actually a very strong looking welded protrusion on the bottom of the elevator, but it is hook-like."
	ZERO? CHAIN-HOOKED? /?L3
	PRINTI " One end of a chain is hooked onto it, in fact."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE,V?UNTIE \FALSE
	EQUAL? PRSO,CHAIN \FALSE
	EQUAL? PRSI,HOOK \FALSE
	ZERO? CHAIN-HOOKED? /FALSE
	CALL NEW-PRSO,CHAIN-1
	RTRUE

	.FUNCT GENERIC-CHAIN-F
	LOC CHAIN >STACK
	ZERO? STACK /?L1
	RETURN CHAIN
?L1:	LOC CHAIN-2 >STACK
	ZERO? STACK /?L3
	RETURN CHAIN-2
?L3:	RETURN CHAIN-1

	.FUNCT CHAIN-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? \?L1
	CALL HELD?,CHAIN >STACK
	ZERO? STACK \TRUE
	ZERO? CHAIN-HOOKED? /?L6
	EQUAL? HERE,CS-BASEMENT /?L5
?L6:	ZERO? CHAIN-LOOPED? /TRUE
	EQUAL? HERE,ELEVATOR-PIT \TRUE
?L5:	RETURN M-FATAL
?L1:	PRINTI "There is "
	EQUAL? HERE,ELEVATOR-PIT \?L12
	ZERO? CHAIN-LOOPED? \?L11
?L12:	EQUAL? HERE,CS-BASEMENT,ELEVATOR-PIT \?L9
	ZERO? CHAIN-HOOKED? /?L9
?L11:	PRINTI "one end of "
?L9:	PRINTI "a greasy length of chain "
	FSET? CHAIN,TOUCHBIT /?L14
	PRINTI "coiled "
?L14:	PRINTI "on the floor here."
	RTRUE

	.FUNCT TELL-IF-LOCKED
	FSET? CHAIN-2,LOCKED \FALSE
	PRINTI " The chain is locked with a padlock."
	RTRUE

	.FUNCT CHAIN-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This is a length of rather greasy chain. It looks strong"
	EQUAL? HERE,ELEVATOR-PIT \?L3
	ZERO? CHAIN-LOOPED? /?L3
	ZERO? CHAIN-HOOKED? /?L5
	PRINT HOOKED-TO-HOOK
	PRINTI " and"
	PRINT LOOPED-AROUND-ROD
	JUMP ?L17
?L3:	ZERO? CHAIN-HOOKED? /?L5
	EQUAL? HERE,CS-BASEMENT \?L6
	CALL META-LOC,HOOK >STACK
	EQUAL? STACK,HERE \?L8
	PRINT HOOKED-TO-HOOK
	JUMP ?L17
?L8:	CALL ELEVATOR-HERE? >STACK
	ZERO? STACK \?L17
	PRINT IT-DANGLES
	JUMP ?L17
?L6:	EQUAL? HERE,ELEVATOR-PIT \?L17
	PRINTI " and it disappears up "
	PRINT INTO-THE-SHAFT
	JUMP ?L17
?L5:	ZERO? CHAIN-LOOPED? /?L17
	EQUAL? HERE,ELEVATOR-PIT \?L15
	PRINTI " and it's"
	PRINT LOOPED-AROUND-ROD
	JUMP ?L17
?L15:	EQUAL? HERE,CS-BASEMENT \?L17
	PRINT IT-DANGLES
?L17:	PRINTI "."
	EQUAL? HERE,ELEVATOR-PIT \?L20
	CALL TELL-IF-LOCKED
?L20:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L23
	ZERO? CHAIN-HOOKED? /?L24
	ZERO? CHAIN-LOOPED? /?L30
	PRINT YOU-HAVE-TO
	EQUAL? HERE,CS-BASEMENT \?L26
	PRINTI "unhook"
	JUMP ?L29
?L26:	FSET? CHAIN-2,LOCKED \?L28
	PRINTI "unlock"
	JUMP ?L29
?L28:	PRINTI "unwrap"
?L29:	PRINTR " it first."
?L24:	ZERO? CHAIN-LOOPED? /?L30
	EQUAL? PRSI,ROD /?L31
	CALL HELD?,CHAIN >STACK
	ZERO? STACK \?L31
	CALL ACCESSIBLE?,CHAIN >STACK
	ZERO? STACK \?L30
?L31:	CALL PERFORM,V?UNTIE,CHAIN-2,ROD
	RTRUE
?L30:	ZERO? CHAIN-HOOKED? /FALSE
	EQUAL? PRSI,HOOK /?L33
	CALL HELD?,CHAIN >STACK
	ZERO? STACK \?L33
	CALL ACCESSIBLE?,CHAIN >STACK
	ZERO? STACK \FALSE
?L33:	CALL PERFORM,V?UNTIE,CHAIN-1
	RTRUE
?L23:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-FOO,V?CLIMB-DOWN \?L35
	ZERO? CHAIN-HOOKED? /?L35
	PRINTI "The chain is too greasy to climb"
	FSET? GLOVES,WEARBIT \?L36
	PRINTI ", even wearing the gloves"
?L36:	PRINT PERIOD
	RTRUE
?L35:	EQUAL? PRSA,V?UNLOCK \?L43
	EQUAL? PRSO,CHAIN-2,CHAIN \?L39
	EQUAL? PRSI,MASTER-KEY \?L39
	FSET? CHAIN-2,LOCKED \?L40
	ZERO? CHAIN-LOOPED? /?L40
	CALL NEW-PRSO,PADLOCK
	RTRUE
?L40:	PRINTR "The chain isn't locked up."
?L39:	EQUAL? PRSA,V?UNLOCK \?L43
	EQUAL? PRSO,CHAIN-2,CHAIN \?L43
	ZERO? PRSI \?L43
	CALL HELD?,MASTER-KEY >STACK
	ZERO? STACK /?L43
	CALL PERFORM-PRSA,PADLOCK,MASTER-KEY
	RTRUE
?L43:	EQUAL? PRSA,V?LOCK,V?TIE \?L44
	EQUAL? PRSO,CHAIN,CHAIN-1,CHAIN-2 \?L44
	EQUAL? PRSI,PADLOCK \?L44
	FSET? PADLOCK,LOCKED \?L45
	CALL CTHE-PRINT,PADLOCK
	PRINTR " is locked already."
?L45:	EQUAL? PRSO,CHAIN,CHAIN-2 \?L47
	FSET? CHAIN-2,LOCKED /?L47
	ZERO? CHAIN-LOOPED? /?L47
	SET 'PADLOCK-ON?,CHAIN-2
	MOVE PADLOCK,CHAIN-2
	FSET PADLOCK,LOCKED
	FCLEAR PADLOCK,OPENBIT
	FSET PADLOCK,NDESCBIT
	FSET CHAIN-2,LOCKED
	PRINTR "You lock the chain with the padlock. It now forms a secure loop around the rod."
?L47:	PRINTR "That's pretty pointless, as the chain isn't currently securing anything."
?L44:	EQUAL? PRSA,V?TIE,V?PUT-ON \?L49
	EQUAL? PRSO,CHAIN,CHAIN-1,CHAIN-2 \?L49
	EQUAL? PRSI,CHAIN,CHAIN-1,CHAIN-2 \?L50
	PRINT STR?241
	RTRUE
?L50:	ZERO? CHAIN-HOOKED? /?L52
	ZERO? CHAIN-LOOPED? /?L52
	PRINT YOUVE-ALREADY
	PRINTI "attached the ends of the chain to the hook and the rod."
	EQUAL? PRSI,ROD,HOOK /?L53
	PRINTI " "
	PRINT YOU-HAVE-TO
	PRINTR "retrieve one first."
?L53:	EQUAL? HERE,ELEVATOR-PIT \?L55
	PRINTI " There isn't enough extra chain to reach that far."
?L55:	CRLF
	RTRUE
?L52:	EQUAL? PRSI,ROD \?L58
	ZERO? CHAIN-LOOPED? \?L60
	FCLEAR CHAIN-2,INVISIBLE
	SET 'CHAIN-LOOPED?,ROD
	PRINTI "You wrap the chain around the rod, but find it too thick to actually tie it."
	ZERO? CHAIN-HOOKED? /?L62
	REMOVE CHAIN
	PRINTI " A few feet hangs on one side of the rod, and the rest curves up from the rod towards the floor of the elevator."
?L62:	CRLF
	RTRUE
?L60:	PRINT YOUVE-ALREADY
	PRINTR "wrapped the chain around the rod."
?L58:	EQUAL? PRSI,HOOK \?L66
	ZERO? CHAIN-HOOKED? \?L67
	CALL HELD?,CHAIN >STACK
	ZERO? STACK /?L69
	ZERO? CHAIN-LOOPED? \?L69
	MOVE CHAIN,HERE
	PRINTI "You stretch out towards the hook, find that the whole chain is just too much weight, and put most of it on the floor. Much easier! "
?L69:	LOC HOOK >STACK
	MOVE CHAIN-1,STACK
	SET 'CHAIN-HOOKED?,HOOK
	ZERO? CHAIN-LOOPED? /?L72
	REMOVE CHAIN
	JUMP ?L74
?L72:	MOVE CHAIN,HERE
?L74:	PRINTR "You hook the chain to the hook, where it looks quite secure."
?L67:	PRINTR "One end of the chain is all that will fit."
?L66:	PRINTI "The chain won't attach to "
	CALL THE-PRINT-PRSI
	PRINT PERIOD
	RTRUE
?L49:	EQUAL? PRSA,V?PUT \?L77
	EQUAL? PRSI,CHAIN,CHAIN-1,CHAIN-2 \?L77
	PRINT STR?241
	RTRUE
?L77:	EQUAL? PRSA,V?UNTIE,V?TAKE-OFF \?L78
	EQUAL? PRSI,ROD \?L79
	ZERO? CHAIN-LOOPED? /?L81
	FSET? CHAIN-2,LOCKED \?L83
	CALL UNLOCK-PADLOCK-FIRST >STACK
	RSTACK
?L83:	FSET CHAIN-2,INVISIBLE
	CALL HELD?,CHAIN >STACK
	ZERO? STACK \?L86
	MOVE CHAIN,ELEVATOR-PIT
	CALL THIS-IS-IT,CHAIN
?L86:	SET 'CHAIN-LOOPED?,0
	CALL REMOVE-CHAIN-FROM,STR?242 >STACK
	RSTACK
?L81:	PRINT ITS-NOT-TIED
	RTRUE
?L79:	EQUAL? PRSI,HOOK \?L90
	ZERO? CHAIN-HOOKED? /?L91
	CALL REMOVE-CHAIN-FROM,STR?243
	REMOVE CHAIN-1
	CALL HELD?,CHAIN >STACK
	ZERO? STACK \?L93
	MOVE CHAIN,HERE
	CALL THIS-IS-IT,CHAIN
?L93:	SET 'CHAIN-HOOKED?,0
	RTRUE
?L91:	PRINT ITS-NOT-TIED
	RTRUE
?L90:	ZERO? CHAIN-HOOKED? /?L98
	CALL ACCESSIBLE?,HOOK >STACK
	ZERO? STACK /?L98
	CALL PERFORM,V?UNTIE,CHAIN-1,HOOK
	RTRUE
?L98:	ZERO? CHAIN-LOOPED? /?L100
	CALL ACCESSIBLE?,ROD >STACK
	ZERO? STACK /?L100
	CALL PERFORM,V?UNTIE,CHAIN-2,ROD
	RTRUE
?L100:	PRINT ITS-NOT-TIED
	RTRUE
?L78:	EQUAL? PRSA,V?MOVE \FALSE
	EQUAL? HERE,CS-BASEMENT \?L103
	ZERO? CHAIN-HOOKED? /?L105
	CALL PULL-HOOK >STACK
	RSTACK
?L105:	ZERO? CHAIN-LOOPED? /FALSE
	CALL PULL-ROD >STACK
	RSTACK
?L103:	EQUAL? HERE,ELEVATOR-PIT \FALSE
	ZERO? CHAIN-LOOPED? /?L110
	CALL PULL-ROD >STACK
	RSTACK
?L110:	ZERO? CHAIN-HOOKED? /FALSE
	CALL PULL-HOOK >STACK
	RSTACK

	.FUNCT REMOVE-CHAIN-FROM,VRB
	PRINTI "You "
	PRINT VRB
	PRINTI " the chain from "
	CALL THE-PRINT-PRSI
	PRINTR "."

	.FUNCT PULL-HOOK
	PRINTI "It's pretty securely hooked."
	CALL PRETTY-SECURE >STACK
	RSTACK

	.FUNCT PULL-ROD
	FSET? CHAIN-2,LOCKED \?L1
	PRINTI "You pull as hard as you can, but you can't pull the rod out."
	CALL PRETTY-SECURE >STACK
	RSTACK
?L1:	SET 'CHAIN-LOOPED?,0
	FSET CHAIN-2,INVISIBLE
	CALL HELD?,CHAIN >STACK
	ZERO? STACK \?L4
	MOVE CHAIN,ELEVATOR-PIT
?L4:	PRINTR "It clatters along the rod and then falls off."

	.FUNCT PRETTY-SECURE
	ZERO? CHAIN-LOOPED? /?L1
	FSET? CHAIN-2,LOCKED \?L1
	PRINTI " In fact, it feels pretty secure all around."
?L1:	CRLF
	RTRUE

	.FUNCT PRESSURE-VALVE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	GET P-NAMW,0 >STACK
	ZERO? STACK \?L3
	FSET? PRESSURE-VALVE,OPENBIT \?L5
	PRINTR "It looks like live steam."
?L5:	ZERO? VALVE-OPENED? /?L7
	PRINTR "It's just a trickle."
?L7:	PRINT STR?109
	RTRUE
?L3:	PRINTI "It looks pretty rusty, but appears to be in working order. "
	FSET? PRESSURE-VALVE,OPENBIT \?L10
	PRINTI "In fact, it's"
	PRINT WIDE-OPEN
	CRLF
	RTRUE
?L10:	ZERO? VALVE-OPENED? /?L12
	PRINT IT-SEEMS-TO-BE
	PRINTR "partly open."
?L12:	PRINT STR?109
	RTRUE
?L1:	EQUAL? PRSA,V?TURN \?L14
	FSET? PRESSURE-VALVE,OPENBIT \?L15
	CALL NEW-VERB,V?CLOSE
	RTRUE
?L15:	CALL NEW-VERB,V?OPEN
	RTRUE
?L14:	EQUAL? PRSA,V?ATTACK \?L18
	FSET? PRSI,WEAPONBIT \?L18
	CALL OPEN-VALVE >STACK
	RSTACK
?L18:	EQUAL? PRSA,V?OPEN,V?PRY \?L19
	ZERO? PRSI /?L19
	FSET? PRSI,WEAPONBIT \?L19
	CALL OPEN-VALVE >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?OPEN \?L22
	ZERO? VALVE-OPENED? \?L21
	FSET? PRESSURE-VALVE,RMUNGBIT \?L20
?L21:	CALL OPEN-VALVE >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?OPEN \?L22
	ZERO? VALVE-OPENED? \?L22
	PRINTI "It's too rusty. You pull and strain, but"
	PRINT LC-NOTHING-HAPPENS
	CRLF
	RTRUE
?L22:	EQUAL? PRSA,V?CLOSE,V?LAMP-OFF \FALSE
	FSET? PRESSURE-VALVE,OPENBIT \?L24
	SET 'VALVE-OPENED?,0
	FSET PRESSURE-VALVE,RMUNGBIT
	FCLEAR PRESSURE-VALVE,OPENBIT
	PRINTR "The valve closes, more easily than it opened."
?L24:	PRINT IT-ALREADY-IS
	RTRUE

	.FUNCT OPEN-VALVE
	FSET? PRESSURE-VALVE,OPENBIT \?L1
	CALL ALREADY-OPEN >STACK
	RSTACK
?L1:	FSET? PRESSURE-VALVE,RMUNGBIT \?L4
	SET 'VALVE-OPENED?,1
?L4:	IGRTR? 'VALVE-OPENED?,1 \?L7
	FSET PRESSURE-VALVE,OPENBIT
	CALL DEQUEUE,I-RATS
	MOVE RATS,GLOBAL-OBJECTS
	PRINTI "The valve screeches open. A jet spray of live steam issues from it, filling the tunnel in front of you."
	ZERO? RATS-HERE /?L16
	CALL SCORE-OBJECT,PRESSURE-VALVE
	MOVE DEAD-RAT,HERE
	SET 'RATS-HERE,0
	PRINTI " The rats are caught in the full force of the blast. Horrible squeals can be heard from the midst of the steam cloud, and scalded rats charge past you, all interest in anything but flight forgotten."
	CALL PRINT-ID,STR?244
	IN? DEAD-RAT,HERE \?L16
	PRINTR " One of their number remains, dead."
?L7:	PRINTI "The valve, with a horrible scream of tortured metal, gives a little, and a small trickle of steam issues forth."
	ZERO? RATS-HERE /?L16
	PRINTI " This further agitates the rats."
?L16:	CRLF
	RTRUE

	.FUNCT TUNNEL-AND-PIPE
	PRINTI "This dank and grimy tunnel is largely filled with an imperfectly insulated steam pipe. The tunnel is uncomfortably hot and damp. "
	RTRUE

	.FUNCT TUNNEL-WEST-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	CALL TUNNEL-AND-PIPE
	PRINTR "A bundle of coaxial cable runs along the ceiling, festooned with damp mold and cobwebs. The tunnel continues west."
?L1:	EQUAL? RARG,M-BEG \FALSE
	ZERO? RATS-HERE /FALSE
	EQUAL? PRSA,V?DROP \FALSE
	FSET? PRSO,FOODBIT \FALSE
	CALL THROW-FOOD >STACK
	RSTACK

	.FUNCT CABLE-F,RARG=0
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,CS-BASEMENT \?L3
	PRINT STR?189
	RTRUE
?L3:	PRINTR "The cable runs overhead in a fat bundle. It looks like the kind you've seen connecting nodes of the local net. This clump is pretty grotty looking, festooned with damp cobwebs, and stained with something that dripped from the ceiling."
?L1:	EQUAL? PRSA,V?TAKE \?L6
	CALL YOU-CANT-X-THAT,STR?183 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?CUT,V?MUNG \?L7
	EQUAL? PRSI,0,HANDS \?L8
	CALL TELL-YUKS
	CALL PRINT-ID,STR?245 >STACK
	RSTACK
?L8:	EQUAL? PRSI,BOLT-CUTTER,AXE \?L10
	PRINTI "You begin cutting the cables, and after a while you realize that the inner cables look different, sort of dead white and slimy. Then you notice that the cables you have cut are knitting back together."
	CRLF
	CALL PRINT-ID,STR?246 >STACK
	RSTACK
?L10:	PRINT YOU-CANT
	PRINTI "expect to cut cable with "
	CALL PRINTA-PRSI
	PRINT PERIOD
	CALL PRINT-ID,STR?247 >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?FOLLOW \?L12
	PRINTI "It runs "
	EQUAL? HERE,CS-BASEMENT \?L13
	PRINTR "from floor to ceiling."
?L13:	EQUAL? HERE,STEAM-TUNNEL-EAST,TUNNEL-ENTRANCE \?L15
	PRINTI "down from the ceiling and off to the "
	EQUAL? HERE,STEAM-TUNNEL-EAST \?L16
	PRINTR "west."
?L16:	PRINTR "east."
?L15:	PRINTR "east and west along the ceiling."
?L12:	EQUAL? PRSA,V?CLIMB-FOO,V?CLIMB-ON,V?BOARD \FALSE
	EQUAL? HERE,CS-BASEMENT \?L21
	CALL TELL-YUKS >STACK
	RSTACK
?L21:	ZERO? ON-CABLE? /?L23
	PRINT YOU-ARE
	PRINT PERIOD
	RTRUE
?L23:	SET 'ON-CABLE?,1
	CALL QUEUE,I-CABLE-FALL,2
	PRINTI "You leap, grab the damp and moldy bundle of cable, and hang suspended off the floor."
	ZERO? RATS-HERE /?L25
	PRINTI " "
	PRINT YOU-ARE-NOW
	PRINTI "somewhat out of reach of the rats."
?L25:	CRLF
	RTRUE

	.FUNCT I-CABLE-FALL
	CRLF
	PRINTI "Your grip on the cable, never too secure, loosens"
	SET 'ON-CABLE?,0
	ZERO? RATS-HERE /?L1
	PRINTI " fatally as an Einstein among rats, who was crawling along the cable itself, bites your fingers"
	CALL THROUGH-THE,GLOVES
	PRINTI ". You fall, landing among the delighted rats."
	CRLF
	CRLF
	CALL PRINT-ID,STR?248
	CALL JIGS-UP,STR?249 >STACK
	RSTACK
?L1:	PRINTR ", and you drop to the floor."

	.FUNCT I-RATS,ORAT
	LOC RATS >ORAT
	IN? RATS,GLOBAL-OBJECTS \?L1
	MOVE RATS,TUNNEL-WEST
	CALL IN-TUNNEL? >STACK
	ZERO? STACK /TRUE
	CRLF
	PRINTR "You can hear, in the distance, a chittering, scratching sound."
?L1:	IN? RATS,HERE /?L51
	ZERO? RATS-HERE /?L7
	CALL IN-TUNNEL? >STACK
	ZERO? STACK /?L9
	MOVE RATS,HERE
	JUMP ?L25
?L9:	EQUAL? HERE,TOMB \?L13
	FSET? ACCESS-HATCH,OPENBIT /?L12
?L13:	EQUAL? HERE,CS-BASEMENT \?L11
	FSET? ELEVATOR-DOOR-B,OPENBIT \?L11
?L12:	CALL QUEUE,I-RATS-GO-AWAY,4,1
	CRLF
	PRINTR "From below you can hear the chittering of the rats."
?L11:	EQUAL? HERE,TOMB,CS-BASEMENT \?L25
	CALL QUEUE,I-RATS-GO-AWAY,2,1
	JUMP ?L25
?L7:	EQUAL? HERE,TOMB,CS-BASEMENT \?L16
	CALL QUEUE,I-RATS-GO-AWAY,2,1
	JUMP ?L25
?L16:	IGRTR? 'RATS-WAITING,3 \?L25
	IN? RATS,TUNNEL-WEST \?L18
	MOVE RATS,TUNNEL
	JUMP ?L23
?L18:	IN? RATS,TUNNEL \?L20
	MOVE RATS,TUNNEL-EAST
	JUMP ?L23
?L20:	IN? RATS,TUNNEL-EAST \?L21
	MOVE RATS,STEAM-TUNNEL
	JUMP ?L23
?L21:	IN? RATS,STEAM-TUNNEL \?L22
	MOVE RATS,STEAM-TUNNEL-EAST
	JUMP ?L23
?L22:	IN? RATS,STEAM-TUNNEL-EAST \?L23
	ZERO? BRICK-WALL-FLAG /?L23
	MOVE RATS,ELEVATOR-PIT
?L23:	IN? RATS,HERE \?L30
	SET 'RATS-WAITING,0
?L25:	IN? RATS,HERE \?L30
?L51:	CRLF
	EQUAL? HERE,ORAT /?L36
	ZERO? RATS-HERE /?L34
	PRINTI "The rats follow, surging around you. "
	JUMP ?L36
?L34:	PRINTI "A troop of rats appears out of the darkness. "
?L36:	INC 'RATS-HERE
	ZERO? ON-CABLE? /?L38
	PRINTR "The rats leap toward you, maddened that you are out of reach!"
?L38:	EQUAL? RATS-HERE,1 \?L40
	PRINTR "The rats are momentarily startled by your presence, but soon the bolder ones begin to approach. There are more rats here than you have ever seen."
?L40:	EQUAL? RATS-HERE,2 \?L41
	PRINTI "The rats attack! Slimy, snarling, and hungry, they swarm over your feet, biting at your legs"
	CALL PRINT-ID,STR?250
	CALL THROUGH-THE,BOOTS
	PRINTR " and clinging desperately to your feet."
?L41:	EQUAL? RATS-HERE,3 \?L42
	PRINTI "The troop of rats surges around you, scenting blood and the kill. There are rats clinging all over you, their nasty teeth biting down in a dozen places."
	CRLF
	CALL PRINT-ID,STR?251 >STACK
	RSTACK
?L42:	CALL I-RATS-GO-AWAY
	CALL PRINT-ID,STR?252
	CALL JIGS-UP,STR?253 >STACK
	RSTACK
?L30:	CALL IN-TUNNEL?,RATS >STACK
	ZERO? STACK /FALSE
	CALL IN-TUNNEL? >STACK
	ZERO? STACK /FALSE
	EQUAL? RATS-WAITING,1 \?L47
	CRLF
	PRINTR "The sound is louder. It sounds like small animals. Is it rats?"
?L47:	EQUAL? RATS-WAITING,2 \?L48
	CRLF
	PRINTR "The sound continues. It's almost certainly rats."
?L48:	CRLF
	PRINTR "The rat sounds are growing louder, but you still can't see any rats."

	.FUNCT IN-TUNNEL?,WHO=0,L
	ZERO? WHO \?L1
	SET 'WHO,PLAYER
?L1:	LOC WHO >L
	EQUAL? L,TUNNEL-WEST,TUNNEL,TUNNEL-EAST /TRUE
	EQUAL? L,STEAM-TUNNEL,STEAM-TUNNEL-EAST /TRUE
	EQUAL? L,ELEVATOR-PIT \FALSE
	ZERO? BRICK-WALL-FLAG \TRUE
	RFALSE

	.FUNCT I-RATS-GO-AWAY
	CALL DEQUEUE,I-RATS
	MOVE RATS,GLOBAL-OBJECTS
	SET 'RATS-HERE,0
	SET 'RATS-WAITING,0
	RFALSE

	.FUNCT DEAD-RAT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "This rat appears to have been stepped on. A small trickle of blood has clotted around its mouth. Branded into its neck is a strange symbol."
?L1:	EQUAL? PRSA,V?TAKE \?L3
	FSET? PRSO,TOUCHBIT /FALSE
	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
	PRINTR "As you take the dead rat, it moves, but then you realize that it's only lice and fleas bailing out."
?L3:	EQUAL? PRSA,V?PUT \?L10
	EQUAL? PRSI,DEAD-RAT \?L10
	CALL SQUISH-RAT >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?BOARD,V?STEP-ON \?L11
	PRINTI "You crush the rat. You hear its bones snap. What a sadist!"
	CRLF
	CALL PRINT-ID,STR?254 >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?EAT \FALSE
	PRINTI "You dangle the rat over your mouth by its tail. You think about it. You lower the rat towards your face. You think some more. Fortunately for your health, you change your mind."
	CRLF
	CALL PRINT-ID,STR?255 >STACK
	RSTACK

	.FUNCT SQUISH-RAT
	CALL CTHE-PRINT-PRSO
	PRINTI " hits "
	EQUAL? PRSI,RATS \?L1
	PRINTI "a rat"
	CALL PRINT-ID,STR?256
	JUMP ?L3
?L1:	PRINTI "the rat"
	CALL PRINT-ID,STR?257
?L3:	PRINTR " with a satisfying squish."

	.FUNCT RAT-SYMBOL-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINT SYMBOL-APPEARS
	PRINTI "scarred into the hide of the rat. There is no hair growing on it, and although it looks like scar tissue, the color is wrong -- a sort of purplish green. "
	CALL TELL-SYMBOL,DEAD-RAT
	CRLF
	RTRUE

	.FUNCT GENERIC-SYMBOL-F
	EQUAL? P-IT-OBJECT,TATTOO,STONE-SYMBOL,RAT-SYMBOL /?L3
	EQUAL? P-IT-OBJECT,PENTAGRAM,CARVING-SYMBOL,CARTON \?L1
?L3:	RETURN P-IT-OBJECT
?L1:	EQUAL? P-IT-OBJECT,HAND \?L4
	RETURN TATTOO
?L4:	EQUAL? P-IT-OBJECT,SMOOTH-STONE \?L5
	RETURN STONE-SYMBOL
?L5:	EQUAL? P-IT-OBJECT,DEAD-RAT \?L6
	RETURN RAT-SYMBOL
?L6:	EQUAL? P-IT-OBJECT,CARVINGS \?L7
	RETURN CARVING-SYMBOL
?L7:	EQUAL? P-IT-OBJECT,CARTON \FALSE
	RETURN CARTON

	.FUNCT TELL-SYMBOL,OBJ
	PRINTI "The symbol "
	ZERO? SEEN-SYMBOL? \?L1
	SET 'SEEN-SYMBOL?,OBJ
	PRINTI "is like nothing you've ever seen, and yet somehow you know it has meaning."
	RTRUE
?L1:	EQUAL? SEEN-SYMBOL?,OBJ /?L3
	PRINTI "looks oddly familiar."
	RTRUE
?L3:	PRINTI "seems just as odd as before."
	RTRUE

	.FUNCT GENERIC-RAT-F
	CALL ACCESSIBLE?,DEAD-RAT >STACK
	ZERO? STACK /?L1
	RETURN DEAD-RAT
?L1:	RETURN RATS

	.FUNCT RATS-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	PRINTI "There are rats here."
	RTRUE

	.FUNCT RATS-F
	IN? RATS,GLOBAL-OBJECTS \?L1
	EQUAL? PRSA,V?TELL-ABOUT,V?ASK-ABOUT,V?TELL-ME-ABOUT /?L1
	PRINTR "There are no rats here."
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "These are strange rats. They don't look like the usual sewer rats. There is more white in their fur, even dirty and encrusted as it is. Some are furless, and others piebald. Many of the older ones are scarred and look particularly cunning."
?L3:	EQUAL? PRSA,V?SMELL \?L4
	PRINTR "You catch a sharp odor over the background of damp and sewage. It's metallic, almost stinging. It's the odor of fresh blood."
?L4:	EQUAL? PRSA,V?THROW \?L5
	FSET? PRSO,FOODBIT \?L5
	CALL THROW-FOOD >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?ATTACK,V?KILL \?L6
	PRINTI "You strike out at the rats, but several clamp onto your hand. The pain is horrible. The rest are all the more frenzied by the drops of blood."
	CRLF
	CALL PRINT-ID,STR?258 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?KICK \?L7
	PRINTI "You kick, throwing off a few biting at your foot and leg"
	CALL PRINT-ID,STR?259
	CALL THROUGH-THE,BOOTS
	PRINTR ". These smash squealing into the wall, but others take their places."
?L7:	EQUAL? PRSA,V?PUT \?L8
	EQUAL? PRSI,RATS \?L8
	CALL SQUISH-RAT >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?STEP-ON \?L9
	PRINTI "You smash a rat, but it's one of hundreds."
	CRLF
	CALL PRINT-ID,STR?260 >STACK
	RSTACK
?L9:	EQUAL? PRSA,V?LISTEN \FALSE
	CALL CTHE-PRINT,RATS
	PRINTR " sound annoyed and hungry."

	.FUNCT MASS-AVE-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	CALL EXIT-TO-COLD >STACK
	RSTACK
?L1:	EQUAL? RARG,M-LEAVE \FALSE
	CALL EXIT-FROM-COLD >STACK
	RSTACK

	.FUNCT EXIT-FROM-COLD
	CALL DEQUEUE,I-FREEZE-TO-DEATH
	GRTR? FREEZE-COUNT,0 \FALSE
	SET 'FREEZE-COUNT,0
	PRINT PUSH-INTO
	PRINTI "welcoming warmth inside."
	CRLF
	CRLF
	RTRUE

	.FUNCT CHEMISTRY-BLDG-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This corridor is lined with closed, dark offices. At the south end of the corridor is a door with a light shining behind it. "
	FSET? ALCHEMY-DOOR,OPENBIT \?L3
	PRINTR "The door is open."
?L3:	PRINTR "There is something written on the door."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? OHERE,ALCHEMY-DEPT \FALSE
	ZERO? PROF-DEAD? \FALSE
	SET 'LEFT-ALCHEMY?,1
	FSET ALCHEMY-DOOR,LOCKED
	FCLEAR ALCHEMY-DOOR,OPENBIT
	PRINTI "The door closes behind you."
	CRLF
	CRLF
	RTRUE

	.FUNCT ALCHEMY-DOOR-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This is a standard Tech door. It's made of black-painted wood and has a "
	FSET? ALCHEMY-WINDOW,RMUNGBIT \?L3
	PRINTI "badly cracked "
?L3:	PRINTD ALCHEMY-WINDOW
	PRINTI " with "
	EQUAL? HERE,ALCHEMY-DEPT \?L6
	PRINTI "something painted on the other side."
	JUMP ?L8
?L6:	PRINTI """Department of Alchemy"" painted on it."
?L8:	EQUAL? HERE,CHEMISTRY-BLDG \?L9
	FSET? ALCHEMY-DEPT,ONBIT \?L9
	ZERO? PROF-DEAD? \?L9
	PRINTI " There is a light on inside."
?L9:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L12
	EQUAL? HERE,ALCHEMY-DEPT \?L13
	PRINTR "You are inside it already."
?L13:	FSET? ALCHEMY-DEPT,ONBIT /?L15
	PRINTR "It's dark inside."
?L15:	ZERO? PROF-DEAD? \?L16
	PRINTR "Every so often, you see a shadow move across the window."
?L16:	PRINTR "You don't see anything in particular, other than that the light is on inside."
?L12:	EQUAL? PRSA,V?READ \?L18
	EQUAL? HERE,CHEMISTRY-BLDG \?L19
	PRINTR "Painted on the door, in calligraphy indistinguishable from any other door at Tech, is the phrase ""Department of Alchemy."" You always used to wonder what was behind that door."
?L19:	PRINT YOU-CANT
	PRINTR "read it from this side."
?L18:	EQUAL? PRSA,V?UNLOCK \?L22
	FSET? PRSO,LOCKED \?L23
	EQUAL? PRSI,MASTER-KEY \?L25
	EQUAL? HERE,CHEMISTRY-BLDG \FALSE
	CALL QUEUE,I-ANSWER-DOOR,3,1
	RFALSE
?L25:	EQUAL? PRSI,KEY-1,KEY-2,KEY-3 /?L31
	EQUAL? PRSI,KEY-4 \FALSE
?L31:	PRINTR "It doesn't even fit the lock."
?L23:	EQUAL? HERE,ALCHEMY-DEPT \FALSE
	PRINTR "You don't need to unlock it to open it from this side."
?L22:	EQUAL? PRSA,V?KNOCK,V?KICK,V?ATTACK \?L35
	PRINTI "You knock on the door."
	EQUAL? HERE,CHEMISTRY-BLDG \?L36
	CALL QUEUE,I-ANSWER-DOOR,3,1
	PRINTI " The hollow sound reverberates down the hall. You sort of wish you had knocked more softly."
?L36:	CRLF
	RTRUE
?L35:	EQUAL? PRSA,V?THROUGH \FALSE
	EQUAL? HERE,ALCHEMY-DEPT \?L40
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L40:	EQUAL? HERE,CHEMISTRY-BLDG \FALSE
	CALL DO-WALK,P?SOUTH >STACK
	RSTACK

	.FUNCT ALCHEMY-WINDOW-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a frosted glass window. It's more or less opaque."
	FSET? ALCHEMY-WINDOW,RMUNGBIT \?L3
	PRINTI " It's covered with a maze of cracks."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?READ,V?KNOCK \?L6
	CALL NEW-PRSO,ALCHEMY-DOOR
	RTRUE
?L6:	EQUAL? PRSA,V?MUNG,V?ATTACK \FALSE
	EQUAL? HERE,CHEMISTRY-BLDG \?L8
	CALL QUEUE,I-ANSWER-DOOR,3,1
?L8:	EQUAL? PRSI,0,HANDS \?L11
	PRINT STR?261
	PRINTI ", other than your hands getting somewhat sore and a lot of noise being produced."
	CRLF
	CALL PRINT-ID,STR?262 >STACK
	RSTACK
?L11:	FSET? PRSI,WEAPONBIT /?L13
	CALL CTHE-PRINT-PRSI
	PRINTI " bounces harmlessly off the glass."
	CRLF
	CALL PRINT-ID,STR?263 >STACK
	RSTACK
?L13:	FSET? PRSO,RMUNGBIT \?L14
	PRINTI "Further attacks do little to worsen the damage."
	CRLF
	CALL PRINT-ID,STR?264 >STACK
	RSTACK
?L14:	FSET PRSO,RMUNGBIT
	PRINTI "You smash the glass, and cracks spread all over the pane from the point of impact. The window remains whole, though, as it's made of wire reinforced glass."
	CRLF
	CALL PRINT-ID,STR?265 >STACK
	RSTACK

	.FUNCT I-ANSWER-DOOR
	EQUAL? HERE,CHEMISTRY-BLDG \FALSE
	ZERO? PROF-DEAD? \?L3
	MOVE PROFESSOR,ALCHEMY-DEPT
	CALL QUEUE,I-PROFESSOR,-1
	CRLF
	PRINTI "The door opens partway, revealing a professorial man in a white lab coat. He smiles. "
	ZERO? LEFT-ALCHEMY? \?L5
	PRINTI """Good evening! I don't get many visitors this late. You're not one of my students, are you?"""
	JUMP ?L7
?L5:	PRINTI """Back for another visit, are you?"""
?L7:	PRINTI " He ushers you into the room without waiting for an answer, closing the door behind you."
	CRLF
	CRLF
	CALL GOTO,ALCHEMY-DEPT >STACK
	RSTACK
?L3:	CRLF
	PRINTR "There is no sign of life behind the door."

	.FUNCT SIGNUP-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	PRINTI "This appears to be a sign-up sheet for the lab. Strangely, although few daytime segments are used, almost all of the nighttime ones are. Most seem to have been taken by two different people, the professor and another, presumably one of his graduate students."
	FSET SIGNUP,RMUNGBIT
	FSET? NOTE,RMUNGBIT /?L5
	ZERO? REMEMBERED-STUDENT? /?L3
?L5:	PRINTR " With a start, you realize that the author of the suicide note was the heavy user of the lab."
?L3:	CALL QUEUE,I-REMEMBER-STUDENT,4
	PRINTR " The name of the graduate student is oddly familiar."
?L1:	EQUAL? PRSA,V?TAKE \FALSE
	IN? PROFESSOR,HERE \FALSE
	PRINTI """You can't take that! It's the only way we have to keep track of who's signed up to use the lab."""
	CRLF
	CALL PRINT-ID,STR?266 >STACK
	RSTACK

	.FUNCT I-REMEMBER-STUDENT
	SET 'REMEMBERED-STUDENT?,1
	CRLF
	PRINTR "Suddenly, you remember why the graduate student's name was familiar. He was a missing student, until his body was found smashed and broken at the base of the tallest building on campus."

	.FUNCT ARCHWAY-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This archway, part of the oldest section of Tech, is between a lab and the headquarters of the Alchemy Department."
	EQUAL? HERE,ALCHEMY-DEPT \?L3
	FSET? SIGNUP,TOUCHBIT /?L3
	PRINT TO-THE-RIGHT
	PRINTI "archway is a sheet of paper. It looks like a sign-up sheet."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?THROUGH \FALSE
	EQUAL? HERE,ALCHEMY-LAB \?L7
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L7:	CALL DO-WALK,P?SOUTH >STACK
	RSTACK

	.FUNCT LAB-F
	EQUAL? PRSA,V?ENTER,V?THROUGH \?L1
	EQUAL? HERE,ALCHEMY-DEPT \?L3
	CALL DO-WALK,P?SOUTH >STACK
	RSTACK
?L3:	EQUAL? HERE,UNDER-ALCHEMY-LAB \?L5
	FSET? ALCHEMY-TRAP-DOOR,OPENBIT \?L6
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L6:	PRINT REFERRING
	CRLF
	RTRUE
?L5:	PRINT ALREADY-IN-IT
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?THROW \?L10
	EQUAL? PRSI,LAB \?L10
	MOVE PRSO,ALCHEMY-LAB
	PRINTR "Thrown."
?L10:	EQUAL? PRSA,V?DROP \?L11
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	EQUAL? HERE,ALCHEMY-DEPT \?L13
	CALL LIKE-A-PRSO,STR?267 >STACK
	RSTACK
?L13:	EQUAL? HERE,UNDER-ALCHEMY-LAB \?L15
	ZERO? LIT /?L16
	FSET? ALCHEMY-TRAP-DOOR,OPENBIT \?L16
	CALL LIKE-A-PRSO,STR?267 >STACK
	RSTACK
?L16:	PRINT REFERRING
	CRLF
	RTRUE
?L15:	PRINT ALREADY-IN-IT
	CRLF
	RTRUE

	.FUNCT ALCHEMY-LAB-ENTER
	EQUAL? WINNER,URCHIN /FALSE
	IN? PROFESSOR,ALCHEMY-DEPT \?L3
	CALL LAB-ENTER? >STACK
	ZERO? STACK /FALSE
	CRLF
?L3:	RETURN ALCHEMY-LAB

	.FUNCT LAB-ENTER?
	ZERO? PROF-SEEN-NOTE? \?L1
	CALL CTHE-PRINT,PROFESSOR
	PRINTI " stops you, not too gently. ""Sorry,"" he says, although he doesn't sound too sorry. ""There are very delicate experiments going on in the lab. You might hurt something."" All you can see before he guides you away from the archway is a great deal of odd apparatus and equipment."
	CRLF
	RFALSE
?L1:	MOVE PROFESSOR,ALCHEMY-LAB
	FSET ALCHEMY-LAB,ONBIT
	PRINTR """Ah! You'd like to see the lab?"" the professor asks in a rather unctuous tone. ""Come right in!"" He ushers you through the archway into the lab, following quickly behind you and turning on the lights."

	.FUNCT I-PROFESSOR
	EQUAL? HERE,ALCHEMY-LAB,UNDER-ALCHEMY-LAB,BRICK-TUNNEL \?L1
	INC 'TIED-UP?
	EQUAL? TIED-UP?,1 \?L3
	MOVE PLAYER,PENTAGRAM
	CRLF
	CALL CTHE-PRINT,PROFESSOR
	PRINTI " guides you to the center of the lab, where a strange pentagonal symbol is chalked on the floor. "
	FSET? PENTAGRAM,RMUNGBIT \?L5
	PRINTI "He repairs some scuff marks on it, muttering about sloppy students. He then "
	JUMP ?L7
?L5:	PRINTI "He "
?L7:	PRINTR "cuts one of the chalk lines with a small knife you had not previously noticed, pushes you into the center of the chalked symbol, and redraws the line, muttering softly and rhythmically as he does so. ""There, that's done. Don't move from there, it'll only make things worse for you."" He makes some odd gestures at the archway and then goes over to the lab bench."
?L3:	EQUAL? TIED-UP?,2 \?L8
	CRLF
	CALL CTHE-PRINT,PROFESSOR
	PRINTR " is preparing something at the lab bench. ""Alchemy is my chosen field, and I've gotten ridiculed for it. It's like chemistry, except that chemists don't recognize that some natural laws are enforced by persons, not physics. Some of them will grant power, or knowledge, but they must be placated, or even bribed. They're not of this earth, not demons or devils, and they aren't always friendly. To me it's just an unpleasant necessity on the path to power. When I'm done, they won't laugh anymore!"""
?L8:	EQUAL? TIED-UP?,3 \?L9
	CRLF
	CALL CTHE-PRINT,PROFESSOR
	PRINTR " enters another pentagram, and begins a highly choreographed ritual. ""This may seem a little silly to you, but the symbology is what's important. Certain alignments, certain aspects. In a few moments, it won't matter anyway,"" he remarks. ""There is very little room for error here, so be calm."" He chants, he brandishes strange instruments, moves about inside the pentagram, and occasionally points to you. It becomes clear exactly what he meant by the word ""bribe."""
?L9:	EQUAL? TIED-UP?,4 \?L10
	CRLF
	PRINTI "The chant grows more complex"
	FSET? PENTAGRAM,RMUNGBIT \?L11
	PRINTI ", the professor having difficulty with the almost unpronounceable words"
?L11:	PRINTR ", with rhythms and cadences that make you want to stop your ears. The room appears to be getting darker."
?L10:	EQUAL? TIED-UP?,5 \?L14
	MOVE MIST,HERE
	CRLF
	PRINTI "A thick black mist begins to form in the room. Parts are darker, and parts lighter, and the dark parts form a disturbing shape. The professor chants and calls more loudly now"
	IN? PLAYER,PENTAGRAM /?L15
	PRINTI ", clearly terrified of what may happen"
	JUMP ?L17
?L15:	FSET? PENTAGRAM,RMUNGBIT \?L17
	PRINTI ", his voice rising in a kind of hysteria"
?L17:	PRINTR ", and you realize the calls are being answered."
?L14:	EQUAL? TIED-UP?,6 \?L19
	CRLF
	PRINTI "The room is now freezing cold, though the windows are shuttered and tightly curtained. Low, bone-rattling vibrations shake the room in cadence with the chant. The black mist is growing thicker. The professor "
	IN? PLAYER,PENTAGRAM /?L20
	PRINTR "is alternately looking at you and at the mist."
?L20:	FSET? PENTAGRAM,RMUNGBIT \?L22
	PRINTR "gestures in your direction, an overtone of terror in his voice."
?L22:	PRINTR "chants more rapidly, producing strange guttural sounds, scarcely human."
?L19:	EQUAL? TIED-UP?,7 \?L24
	EQUAL? HERE,ALCHEMY-LAB \?L25
	CRLF
	PRINTI "The black mist swirls wildly around the room, and a deep bass voice gibbers out of thin air. "
	IN? PLAYER,PENTAGRAM /?L27
	PRINTR """No!"" screams the professor, and jumps toward you out of his own pentagram. He realizes what he has done, and tries to reenter, but the mist grabs at him."
?L27:	CALL CTHE-PRINT,PROFESSOR
	FSET? PENTAGRAM,RMUNGBIT \?L30
	PRINTR " points madly toward you, and the mist follows."
?L30:	PRINTR "'s brow drips with sweat."
?L25:	CRLF
	PRINTR "You hear a deep bass voice, and a softer, pleading baritone."
?L24:	EQUAL? TIED-UP?,8 \FALSE
	REMOVE MIST
	IN? PLAYER,PENTAGRAM /?L37
	IN? PLAYER,ALCHEMY-LAB \?L35
?L37:	CRLF
	CALL PRINT-ID,STR?268
	CALL JIGS-UP,STR?269 >STACK
	RSTACK
?L35:	SET 'TIED-UP?,0
	CALL ROB,PROFESSOR,ALCHEMY-LAB
	MOVE PROFESSOR,GLOBAL-OBJECTS
	CALL SCORE-OBJECT,PROFESSOR
	SET 'PROF-DEAD?,1
	FCLEAR ALCHEMY-LAB,TOUCHBIT
	FCLEAR ALCHEMY-LAB,ONBIT
	CALL DEQUEUE,I-PROFESSOR
	CRLF
	PRINTI "From above, you hear a thunderous noise, a maniacal scream, and then the sound of equipment smashing. "
	CALL PRINT-ID,STR?270
	FSET? ALCHEMY-TRAP-DOOR,OPENBIT \?L39
	FCLEAR ALCHEMY-TRAP-DOOR,OPENBIT
	PRINTI "The trapdoor slams shut, but around it"
	JUMP ?L41
?L39:	PRINTI "Around the trapdoor"
?L41:	PRINTI " pours a blinding flash of light. Finally you hear an almost inaudible whimper, then nothing. The light fades"
	CALL IN-DARK?
	RTRUE
?L1:	EQUAL? HERE,ALCHEMY-DEPT \?L43
	CRLF
	CALL CTHE-PRINT,PROFESSOR
	PRINTI " "
	ZERO? PROF-FLAG \?L44
	SET 'PROF-FLAG,1
	PRINTI "gazes"
	JUMP ?L46
?L44:	PRINTI "continues to gaze"
?L46:	PRINTI " at you "
	ZERO? PROF-MAD? /?L49
	ZERO? PROF-SEEN-NOTE? /?L47
	PRINTR "with a distinctly predatory air."
?L47:	ZERO? PROF-MAD? /?L49
	PRINTR "with malign intent."
?L49:	PRINTR "in a bored and distracted way."
?L43:	CALL DEQUEUE,I-PROFESSOR
	RFALSE

	.FUNCT PENTAGRAM-F,RARG=0,O
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?READ,V?LOOK-INSIDE \?L3
	CALL NOT-REACHABLE? >STACK
	ZERO? STACK /?L3
	PRINT YOU-CANT-SEE
	CALL THE-PRINT-PRSO
	PRINTR " well enough from here to do that."
?L3:	EQUAL? PRSA,V?POUR \?L5
	EQUAL? PRSI,0,GROUND \?L5
	CALL NEW-PRSI,PENTAGRAM
	RTRUE
?L5:	EQUAL? PRSA,V?BOARD \?L6
	EQUAL? PRSO,PENTAGRAM \?L6
	PRINT ALREADY-IN-IT
	CRLF
	RTRUE
?L6:	EQUAL? PRSA,V?WALK /FALSE
	EQUAL? PRSA,V?DISEMBARK,V?EXIT \?L8
	ZERO? TIED-UP? \?L9
	MOVE WINNER,HERE
	CALL CROSS-PENTAGRAM,STR?271 >STACK
	RSTACK
?L9:	FSET? PENTAGRAM,RMUNGBIT /?L11
	PRINTR "Your feet approach the chalk line, and then stop. You can't push your way out."
?L11:	MOVE WINNER,HERE
	PRINT STR?196
	PRINTR "a soft spot just over the scuff marks, and are outside the pentagram. The air is thick and close."
?L8:	CALL NOT-REACHABLE? >O
	ZERO? O /FALSE
	FSET? PENTAGRAM,RMUNGBIT \?L14
	CALL CANT-REACH-FROM-VEHICLE,O >STACK
	RSTACK
?L14:	PRINTR "Your hand won't pass over the chalk line."
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?EXAMINE \?L19
	PRINTR "For want of a better word, call this a pentagram. It isn't particularly pentagonal, but it's an odd shape chalked on the floor, and it's roughly pentagonal."
?L19:	EQUAL? PRSA,V?PUT \?L21
	EQUAL? PRSI,PENTAGRAM \?L21
	CALL IDROP >STACK
	ZERO? STACK /TRUE
	MOVE PRSO,PENTAGRAM
	PRINTR "Dropped."
?L21:	EQUAL? PRSA,V?BOARD \?L25
	MOVE PLAYER,PENTAGRAM
	CALL CROSS-PENTAGRAM,STR?272 >STACK
	RSTACK
?L25:	EQUAL? PRSA,V?POUR \?L26
	EQUAL? PRSO,COKE,NITROGEN \?L26
	FSET? PENTAGRAM,RMUNGBIT \?L27
	PRINTI "The pentagram is now almostly entirely effaced."
	CRLF
	CALL PRINT-ID,STR?273 >STACK
	RSTACK
?L27:	CALL CTHE-PRINT-PRSO
	PRINTR " pours on the ground, spreading towards the lines of the pentagram. As it reaches the nearest line, it begins to smoke and boil away, but never quite touches the chalk."
?L26:	EQUAL? PRSA,V?RUB,V?MUNG,V?CUT /?L31
	EQUAL? PRSA,V?ERASE,V?OPEN \?L30
?L31:	EQUAL? PRSI,0,HANDS,FEET \?L32
	PRINTR "You try, but no part of your body will touch the chalk lines."
?L32:	FSET? PENTAGRAM,RMUNGBIT \?L34
	PRINTR "You scuff it up some more."
?L34:	EQUAL? PRSI,KNIFE \?L35
	FSET PENTAGRAM,RMUNGBIT
	PRINTI "You cut the outer lines of the pentagram. It no longer completely encloses you."
	CALL PRINT-ID,STR?274
	CALL PROF-REACTS >STACK
	RSTACK
?L35:	FSET? PRSI,WEAPONBIT /?L37
	FSET? PRSI,TOOLBIT \?L36
?L37:	CALL CTHE-PRINT-PRSI
	PRINTR " passes over the chalk line, but doesn't have any effect on it."
?L36:	CALL CTHE-PRINT-PRSI
	PRINTR " doesn't even touch the chalk line."
?L30:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? PENTAGRAM,RMUNGBIT \FALSE
	PRINT STR?225
	PRINTI "a piece of chalk to close it with. Besides, you don't know the incantation."
	CRLF
	CALL PRINT-ID,STR?275 >STACK
	RSTACK

	.FUNCT CROSS-PENTAGRAM,DIR
	PRINTI "You get "
	PRINT DIR
	PRINTR " the pentagram, being careful not to further scuff the chalk."

	.FUNCT PROF-REACTS
	ZERO? TIED-UP? /?L5
	PRINTI " The professor sees what you've done out of the corner of his eye."
	GRTR? TIED-UP?,2 \?L3
	PRINTR " He stares, horrified. ""Stop, don't move!"" he says between verses of the chant. The chant takes on a pleading tone."
?L3:	CALL ROB,PLAYER,0
	FCLEAR PENTAGRAM,RMUNGBIT
	PRINTI " He quickly slides over and redraws the pentagram. This time he performs a thorough search, removing all your possessions, tut-tutting all the while."
?L5:	CRLF
	RTRUE

	.FUNCT ALCHEMY-DEPT-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This office is clinically clean, shiny, and modern. It looks like something out of a science fiction movie. "
	FSET? ALCHEMY-DOOR,OPENBIT \?L3
	PRINTI "An open"
	JUMP ?L5
?L3:	PRINTI "A closed"
?L5:	PRINTR " door to the north leads back into the corridor and an archway opens to the south."
?L1:	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? OHERE,CHEMISTRY-BLDG \FALSE
	ZERO? PROF-DEAD? \FALSE
	FCLEAR ALCHEMY-DOOR,LOCKED
	FCLEAR ALCHEMY-DOOR,OPENBIT
	RTRUE

	.FUNCT ALCHEMY-LAB-DOWN-EXIT
	ZERO? LAB-BENCH-MOVED? /?L3
	FSET? ALCHEMY-TRAP-DOOR,OPENBIT \?L1
	MOVE WINNER,HERE
	RETURN UNDER-ALCHEMY-LAB
?L1:	ZERO? LAB-BENCH-MOVED? /?L3
	PRINTI "The trapdoor bars your way."
	CRLF
	RFALSE
?L3:	PRINTI "There is no obvious way down from here."
	CRLF
	RFALSE

	.FUNCT ALCHEMY-LAB-EXIT
	ZERO? TIED-UP? /?L1
	FSET? PENTAGRAM,RMUNGBIT \?L3
	PRINTI "You find the archway barred by a force you can't push through."
	CRLF
	RFALSE
?L3:	PRINTI "You find it very hard to move. Your feet reach the chalk line and then seem to meet resistance, though there is nothing there but the chalk."
	CRLF
	RFALSE
?L1:	MOVE WINNER,HERE
	RETURN ALCHEMY-DEPT

	.FUNCT ALCHEMY-LAB-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	ZERO? PROF-DEAD? \?L3
	PRINTI "The lab is an ultramodern, fully equipped chemistry lab. Unfortunately, or perhaps fortunately, you aren't a chemistry major, so the equipment might as well be magical."
	JUMP ?L5
?L3:	PRINTI "The lab is a shambles. It looks like something red and sticky has been spread over the walls, ceiling, and floor. Much of the equipment, particularly that near the center of the room, has been destroyed."
?L5:	ZERO? LAB-BENCH-MOVED? /?L6
	PRINTI " There is "
	CALL AN-OPEN$002fCLOSED,ALCHEMY-TRAP-DOOR
	PRINTR " in the floor."
?L6:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?EXAMINE \?L10
	EQUAL? PRSO,GROUND \?L10
	CALL NEW-PRSO,PENTAGRAM
	RTRUE
?L10:	EQUAL? PRSA,V?EXAMINE,V?READ,V?LOOK-INSIDE /FALSE
	EQUAL? PRSA,V?ASK-ABOUT,V?TELL-ME-ABOUT,V?TELL-ABOUT /FALSE
	IN? PROFESSOR,HERE \FALSE
	EQUAL? VAT,PRSO,PRSI \FALSE
	LESS? TIED-UP?,3 \?L15
	CALL CTHE-PRINT,PROFESSOR
	PRINTR ", none too gently, prevents you. ""Plenty of time for that later,"" he cautions you."
?L15:	EQUAL? PERFORM-DEPTH,1 \FALSE
	CALL CTHE-PRINT,PROFESSOR
	PRINTI " watches you in horror, stumbling over his ritual."
	CRLF
	CRLF
	RFALSE

	.FUNCT ALCHEMY-TRAP-DOOR-F
	EQUAL? HERE,ALCHEMY-LAB \?L1
	EQUAL? PRSA,V?EXAMINE \?L3
	PRINT IT-LOOKS-LIKE
	PRINTR "a hinged metal plate. There is a handle on one edge."
?L3:	EQUAL? PRSA,V?THROUGH \?L5
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?OPEN,V?RAISE \?L6
	ZERO? LAB-BENCH-MOVED? \?L7
	PRINT IT-LIFTS-BUT
	PRINTR "the lab bench and goes no further."
?L7:	FSET? PRSO,OPENBIT /FALSE
	FSET ALCHEMY-TRAP-DOOR,OPENBIT
	PRINTR "It swings open easily."
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	FSET? ALCHEMY-TRAP-DOOR,OPENBIT \?L12
	PRINTR "You see a dark tunnel below."
?L12:	PRINTR "Your X-ray eyes appear to be nonfunctional today."
?L1:	EQUAL? PRSA,V?EXAMINE \?L17
	PRINT IT-LOOKS-LIKE
	PRINTR "a metal plate in the ceiling."
?L17:	EQUAL? PRSA,V?THROUGH \?L19
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?OPEN,V?RAISE,V?PUSH \?L20
	ZERO? LAB-BENCH-MOVED? \?L21
	PRINT IT-LIFTS-BUT
	PRINTR "something and goes no further."
?L21:	FSET? PRSO,OPENBIT /FALSE
	FSET ALCHEMY-TRAP-DOOR,OPENBIT
	PRINTR "It pushes open easily."
?L20:	EQUAL? PRSA,V?LOOK-INSIDE,V?LOOK-BEHIND \FALSE
	ZERO? LIT \?L26
	PRINT TOO-DARK
	RTRUE
?L26:	FSET? ALCHEMY-TRAP-DOOR,OPENBIT \?L28
	PRINTR "You see a laboratory."
?L28:	PRINTR "Pushing the plate up as far as you can, you can see part of a workroom or lab of some kind."

	.FUNCT STUDENTS-F
	CALL GLOBAL-URCHINS-F,STUDENTS >STACK
	RSTACK

	.FUNCT YOU-SEE-NO,OBJ
	PRINTI "You see no "
	CALL DPRINT,OBJ
	PRINTR "."

	.FUNCT GLOBAL-URCHINS-F,OBJ=0
	ZERO? OBJ \?L1
	SET 'OBJ,GLOBAL-URCHINS
?L1:	EQUAL? WINNER,OBJ /?L6
	EQUAL? PRSA,V?TELL,V?SAY,V?HELLO \?L4
?L6:	PRINTI "There is no reply."
	CRLF
	EQUAL? PRSO,OBJ \TRUE
	CALL END-QUOTE
	RETURN M-FATAL
?L4:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK \?L11
	EQUAL? PRSA,V?SHOW,V?SEARCH,V?FIND /?L11
	EQUAL? PRSA,V?EXAMINE,V?TELL-ABOUT \?L10
	EQUAL? PRSO,OBJ \?L10
?L11:	CALL YOU-SEE-NO,OBJ
	CALL HARM-VERB? >STACK
	CALL PRINT-ID,STR?276,STACK
	CALL KILL-VERB? >STACK
	CALL PRINT-ID,STR?277,STACK >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?HELP,V?UNTIE \?L12
	CALL BEYOND-HELP
	CALL PRINT-ID,STR?278 >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?WHAT \FALSE
	EQUAL? PRSO,URCHINS,GLOBAL-URCHINS \FALSE
	PRINTR "That's what students call the local children who sometimes hang around Tech. They are usually blamed when anything is stolen, generally mistrusted, and often booted off campus by the campus police."

	.FUNCT BEYOND-HELP
	PRINTI "They "
	EQUAL? PRSO,STUDENTS \?L1
	ZERO? SEEN-PIT? /?L1
	PRINTI "are"
	JUMP ?L3
?L1:	PRINTI "may be"
?L3:	PRINTR " beyond help."

	.FUNCT LOVECRAFT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This machine looks just like the ones in the terminal room. "
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	FSET? LOVECRAFT,POWERBIT /?L3
	PRINTI " It's turned off."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?WHO \?L6
	PRINTR "I suggest you consult your local library or any practitioner of the occult arts."
?L6:	EQUAL? PRSA,V?LAMP-ON \?L7
	FSET? LOVECRAFT,POWERBIT /?L8
	FSET LOVECRAFT,POWERBIT
	PRINTI "You turn the machine on, it performs a quick self-check, and then displays a message on the screen: "
	PRINT STR?279
	IN? PROFESSOR,HERE \?L10
	PRINTI " The professor, who has been watching you, smiles."
?L10:	CRLF
	RTRUE
?L8:	PRINTR "It's on, for what little good that will do you."
?L7:	EQUAL? PRSA,V?LAMP-OFF \FALSE
	FSET? LOVECRAFT,POWERBIT \?L15
	CALL COMPUTER-POWERS-OFF >STACK
	RSTACK
?L15:	CALL ITS-ALREADY-X,STR?191 >STACK
	RSTACK

	.FUNCT RING-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The G.U.E. Tech class ring is a gold ring depicting a hyrax eating a twig. Such rings are familiarly known as ""brass hyraxes."""
?L1:	EQUAL? PRSA,V?TAKE-OFF \?L3
	FSET? GLOVES,WEARBIT \?L3
	PRINT YOU-HAVE-TO
	PRINTR "take off your gloves first."
?L3:	EQUAL? PRSA,V?WEAR \FALSE
	FSET? GLOVES,WEARBIT \?L5
	CALL CTHE-PRINT,RING
	PRINTR " won't go on over the gloves."
?L5:	CALL IWEAR >STACK
	EQUAL? STACK,1 \TRUE
	PRINTR "It fits surprisingly well."

	.FUNCT PROFESSOR-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	CALL CTHE-PRINT,PROFESSOR
	PRINTI " is "
	GRTR? TIED-UP?,2 \?L4
	PRINTI "performing a strange ritual "
?L4:	PRINTI "here."
	RETURN M-FATAL

	.FUNCT PROFESSOR-F,RARG=0
	EQUAL? RARG,M-CONTAINER \?L1
	EQUAL? PRSA,V?EXAMINE,V?TAKE,V?SHOW /?L5
	EQUAL? PRSA,V?WEAR /?L5
	EQUAL? WINNER,PROFESSOR \FALSE
	EQUAL? PRSA,V?GIVE \FALSE
?L5:	EQUAL? PRSO,RING \?L6
	SET 'PROF-MAD?,1
	PRINTR "He thrusts his hand into his pocket."
?L6:	PRINTR """You'll get it. All in good time."""
?L1:	EQUAL? WINNER,PROFESSOR \?L10
	EQUAL? PRSA,V?GIVE /FALSE
	EQUAL? PRSA,V?TELL-ME-ABOUT \?L13
	GRTR? TIED-UP?,2 \?L14
	CALL CTHE-PRINT,PROFESSOR
	PRINTR " is intently following his ritual and won't be distracted."
?L14:	EQUAL? PRSO,ODD-PAPER \?L16
	SET 'PROF-MAD?,1
	PRINTR """I don't like your insinuations."""
?L16:	EQUAL? PRSO,RING \?L17
	PRINTR """Just a trinket."""
?L17:	EQUAL? PRSO,LAB \?L18
	CALL LAB-ENTER? >STACK
	ZERO? STACK /TRUE
	CRLF
	CALL GOTO,ALCHEMY-LAB >STACK
	RSTACK
?L18:	EQUAL? PRSO,SIGNUP \?L22
	PRINTR """We don't have much lab space. Everyone has to sign up for lab time."""
?L22:	EQUAL? PRSO,STUDENTS \?L23
	PRINTR """I don't know anything about them. Tech is high-pressure. Some people can't take it."""
?L23:	EQUAL? PRSO,NOTE \?L24
	ZERO? PROF-SEEN-NOTE? /?L25
	PRINTR """Obviously a nut case. He knew he was going to flunk out, and this is clearly an attempt to put the blame somewhere else."""
?L25:	PRINTR """What note is that?"" he asks, nervously."
?L24:	EQUAL? PRSO,VAT \?L28
	PRINTR """Just a little experiment of mine. The label is just a joke."""
?L28:	EQUAL? PRSO,LOVECRAFT \FALSE
	PRINTR """The machines in our department have names like that. Lovecraft wrote some stories about alchemy. We've got Paracelsus, Dunsany, and a couple of others, too."""
?L13:	ZERO? TIED-UP? /?L31
	PRINT NO-RESPONSE
	CRLF
	RTRUE
?L31:	CALL CTHE-PRINT,PROFESSOR
	PRINTR " looks at you in much the way a cat looks at a mouse."
?L10:	ZERO? PROF-DEAD? /?L33
	CALL ABSTRACT-VERB? >STACK
	ZERO? STACK \?L33
	CALL CTHE-PRINT,PROFESSOR
	PRINTR " is no more."
?L33:	EQUAL? PRSA,V?EXAMINE \?L34
	PRINTI "The man looks like a professor. He's wearing a white lab coat, rather stained with chemicals, and a G.U.E. Tech class ring. "
	EQUAL? HERE,ALCHEMY-DEPT \?L35
	PRINTR "He watches you with an ambiguously predatory air."
?L35:	PRINTR "He's working on something at the lab bench in front of him."
?L34:	EQUAL? PRSA,V?SHOW,V?GIVE \?L38
	EQUAL? PRSI,PROFESSOR \?L38
	GRTR? TIED-UP?,2 \?L39
	CALL CTHE-PRINT,PROFESSOR
	PRINTR " is nervously following his ritual."
?L39:	EQUAL? PRSO,SMOOTH-STONE,HAND,KNIFE \?L41
	SET 'PROF-MAD?,1
	MOVE PRSO,PROFESSOR
	PRINTR """Very interesting! I'll take that!"""
?L41:	EQUAL? PRSO,NOTE \?L42
	SET 'PROF-SEEN-NOTE?,1
	SET 'PROF-MAD?,1
	MOVE NOTE,PROFESSOR
	PRINTR "He reads it carefully. ""What drivel! This just confirms my suspicions. He had clearly gone over the edge. Drug use, drinking, insanity. It's only too bad that I didn't realize what was happening. I might have helped him."""
?L42:	PRINTR "He doesn't seem interested."
?L38:	EQUAL? PRSA,V?THROW /FALSE
	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /FALSE
	CALL HARM-VERB? >STACK
	CALL PRINT-ID,STR?280,STACK
	CALL KILL-VERB? >STACK
	CALL PRINT-ID,STR?281,STACK
	GRTR? TIED-UP?,6 \?L46
	PRINTR "The mist protects him, almost possessively."
?L46:	GRTR? TIED-UP?,2 \?L48
	CALL CTHE-PRINT,PROFESSOR
	PRINTR ", in his pentagram, is invulnerable."
?L48:	SET 'PROF-MAD?,1
	PRINTI "With contemptuous ease, the professor prevents you."
	ZERO? PRSI /?L50
	FSET? PRSI,WEAPONBIT \?L50
	MOVE PRSI,PROFESSOR
	PRINTI " ""I'll take this,"" he says. ""Just for safekeeping."" He makes "
	CALL THE-PRINT-PRSI
	PRINTI " disappear."
?L50:	CRLF
	RTRUE

	.FUNCT LAB-BENCH-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The bench is a chemistry lab bench. It has a marble top, and casters at each corner. Various equipment litters the bench, none of which you recognize"
	FIRST? LAB-BENCH >STACK \?L3
	PRINTI ", but the lab bench also contains "
	CALL DESCRIBE-REST,LAB-BENCH
?L3:	PRINT PERIOD
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-UNDER \?L6
	ZERO? LAB-BENCH-MOVED? \?L7
	PRINTR "You can see a metal plate beneath the bench. Only part of it is visible."
?L7:	PRINTR "Nothing but concrete floor there."
?L6:	EQUAL? PRSA,V?MOVE,V?PUSH \FALSE
	ZERO? LAB-BENCH-MOVED? \?L11
	SET 'LAB-BENCH-MOVED?,1
	PRINTR "It's heavy, but it moves, revealing a hinged metal trapdoor beneath."
?L11:	PRINTR "It rolls a little."

	.FUNCT VAT-CONT-F,RARG
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,ELIXIR \?L3
	PRINT YOU-CANT
	PRINTR "take it, it's a liquid."
?L3:	CALL ITAKE >STACK
	EQUAL? STACK,0,M-FATAL /TRUE
	EQUAL? PRSO,HAND \?L6
	FSET? HAND,PERSON \?L6
	PRINTI "You grab the wiggling hand and draw it forth, newly animated, from the vat."
	JUMP ?L7
?L6:	PRINTI "You reach into the liquid, fish around rapidly due to the horrible feel of the chemicals, and draw out "
	CALL THE-PRINT-PRSO
	PRINTI "."
?L7:	PRINTI " As it emerges, the elixir flows off."
	EQUAL? PRSO,HAND \?L8
	FSET? HAND,PERSON \?L8
	ADD SCORE,HAND-ANIMATED-SCORE >SCORE
	SET 'HAND-ANIMATED-SCORE,0
	PRINTI " The hand scuttles up your arm and perches quietly on your shoulder."
?L8:	CRLF
	RTRUE

	.FUNCT VAT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINT STR?201
	PRINTI "(a couple of liters, at least) glass or pyrex vat. It has a label stuck to it. "
	CALL DESCRIBE-SENT,VAT
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \?L3
	EQUAL? PRSI,VAT \?L3
	IN? ELIXIR,VAT \?L3
	EQUAL? PRSO,DEAD-RAT \?L4
	REMOVE DEAD-RAT
	PRINTI "You dip the dead rat into the elixir. Almost immediately it convulses, begins to flop around in the liquid, and then springs out onto the floor! It scurries away before you can catch it."
	CRLF
	CALL PRINT-ID,STR?282 >STACK
	RSTACK
?L4:	EQUAL? PRSO,HAND \?L6
	MOVE HAND,VAT
	FSET? HAND,PERSON \?L7
	PRINTR "Nothing unusual happens (compared to the first time, anyway)."
?L7:	CALL QUEUE,I-ANIMATE-HAND,-1
	PRINTR "When you dip the mummified hand in the liquid, the elixir begins to bubble furiously. You can't really see the hand, except when a finger pokes up every so often."
?L6:	CALL PRSO-TOO-BIG? >STACK
	ZERO? STACK /?L10
	PRINT NO-ROOM
	CRLF
	RTRUE
?L10:	FCLEAR PRSO,WEARBIT
	MOVE PRSO,VAT
	PRINTI "You drop "
	CALL THE-PRINT-PRSO
	PRINTR " into the vat, where it is completely covered by the tarry liquid."
?L3:	EQUAL? PRSA,V?OPEN,V?CLOSE \?L12
	CALL TELL-YUKS >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?POUR \?L13
	EQUAL? PRSO,VAT \?L13
	CALL NEW-PRSO,ELIXIR
	RTRUE
?L13:	EQUAL? PRSA,V?REACH-IN \FALSE
	PRINTR "You feel the thick tarry liquid."

	.FUNCT ELIXIR-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The elixir is thick and tarry. Torpid bubbles break the surface every so often, though you can find no source of heat to produce them."
?L1:	EQUAL? PRSA,V?DRINK \?L3
	PRINTI "It would be like drinking road tar."
	CRLF
	CALL PRINT-ID,STR?283 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?RUB \?L4
	PRINTI "You touch the liquid with your finger. It's very unpleasant. The liquid is stingingly hot. You pull your finger out, and it is some time before it feels normal again."
	CRLF
	CALL PRINT-ID,STR?284 >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?TAKE \?L5
	ZERO? PRSI \?L5
	IN? ELIXIR,VAT \FALSE
	CALL NEW-PRSO,VAT
	RTRUE
?L5:	EQUAL? PRSA,V?POUR,V?DROP,V?THROW \?L9
	EQUAL? PRSO,ELIXIR \?L9
	PRINTR "Remember those ketchup commercials? Remember how slow the winning ketchup was? Well, this is a lot slower. The liquid has a very high surface tension, and pours so slowly that you'd be here all night waiting for it to finish."
?L9:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,ELIXIR \FALSE
	CALL NEW-PRSI,VAT >STACK
	RSTACK

	.FUNCT I-ANIMATE-HAND,HERE?=0
	IN? HAND,VAT /?L1
	CALL DEQUEUE,I-ANIMATE-HAND
	RFALSE
?L1:	CALL META-LOC,VAT >STACK
	EQUAL? STACK,HERE \?L4
	SET 'HERE?,1
?L4:	IGRTR? 'ANIMATION-COUNT,2 /?L9
	FSET? HAND,PERSON \?L7
?L9:	FSET HAND,PERSON
	ZERO? HERE? /FALSE
	CRLF
	PRINTI "The hand is trying to crawl out of the vat."
	FSET? HAND,PERSON /?L12
	PRINTI " The fingers flex and grab at the slippery sides, but in vain."
?L12:	CRLF
	RTRUE
?L7:	EQUAL? ANIMATION-COUNT,1 \?L16
	ZERO? HERE? /FALSE
	CRLF
	PRINTR "The hand bobs to the surface. It's odd, but it looked like one of the fingers moved."
?L16:	ZERO? HERE? /FALSE
	CRLF
	PRINTR "The hand splashes to the surface. The fingers are moving!"

	.FUNCT GREAT-COURT-EXIT
	EQUAL? WINNER,URCHIN /FALSE
	ZERO? DOOR-WARNING /?L3
	RETURN GREAT-COURT
?L3:	SET 'DOOR-WARNING,1
	PRINTI "Remember, this is one of the doors that's always locked at night. You won't be able to get back in if you go out."
	CRLF
	RFALSE

	.FUNCT WAXER-EXIT
	EQUAL? WINNER,URCHIN \?L1
	LOC URCHIN >STACK
	CALL INF-EAST-EXIT,STACK >STACK
	RSTACK
?L1:	IN? FLOOR-WAXER,HERE \?L3
	IN? MAINTENANCE-MAN,FLOOR-WAXER \?L3
	CALL THIS-IS-IT,MAINTENANCE-MAN
	ZERO? CORD-SEVERED? /?L4
	CALL MAINT-DESCENDS
	LOC MAINTENANCE-MAN >STACK
	IN? FLOOR-WAX,STACK \FALSE
	CALL INF-EAST-EXIT,HERE
	RFALSE
?L4:	PRINTI "In a deft maneuver, "
	CALL THE-PRINT,MAINTENANCE-MAN
	PRINTI " steers the "
	PRINTD FLOOR-WAXER
	PRINTI " into your path, blocking your advance."
	CRLF
	RFALSE
?L3:	ZERO? CORD-SEVERED? /?L10
	IN? MAINTENANCE-MAN,HERE \?L10
	FSET? MAINTENANCE-MAN,PERSON \?L10
	IN? FLOOR-WAX,HERE /?L10
	CALL THIS-IS-IT,MAINTENANCE-MAN
	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINT STR?285
	PRINTI ", grasping and panting. There is no way to go around him."
	CRLF
	RFALSE
?L10:	CALL INF-EAST-EXIT,HERE >STACK
	RSTACK

	.FUNCT INF-EAST-EXIT,L
	EQUAL? L,INF-1 \?L1
	RETURN INF-2
?L1:	EQUAL? L,INF-2 \?L3
	RETURN INF-3
?L3:	EQUAL? L,INF-3 \?L4
	RETURN INF-4
?L4:	EQUAL? L,INF-4 \?L5
	RETURN INF-5
?L5:	EQUAL? L,INF-5 \FALSE
	EQUAL? P-WALK-DIR,P?NORTH \?L7
	RETURN NUTRITION-BLDG
?L7:	RETURN CHEMISTRY-BLDG

	.FUNCT INF-F,RARG,L
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "The so-called infinite corridor runs from east to west in the main campus building."
	EQUAL? HERE,INF-1 \?L3
	PRINTI " This is the west end."
	JUMP ?L6
?L3:	EQUAL? HERE,INF-2,INF-3,INF-4 \?L5
	PRINTI " The corridor extends both ways from here."
	JUMP ?L6
?L5:	EQUAL? HERE,INF-5 \?L6
	PRINTI " This is the east end."
?L6:	EQUAL? HERE,INF-2,INF-4 \?L8
	PRINTR " Many closed and locked offices are to the north and south."
?L8:	EQUAL? HERE,INF-1 \?L10
	PRINTR " Side corridors lead north and south, and a set of doors leads west into the howling blizzard."
?L10:	EQUAL? HERE,INF-3 \?L11
	PRINTR " A stairway leads up, and a door leads out to the Great Court."
?L11:	EQUAL? HERE,INF-5 \?L12
	PRINTI " The corridor branches north and south here."
?L12:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-END \?L14
	IN? FLOOR-WAXER,HERE /FALSE
	EQUAL? PRSA,V?WALK,V?LOOK \FALSE
	CRLF
	PRINT STR?192
	PRINTI "largish machine "
	ZERO? CORD-SEVERED? \?L17
	PRINTI "being operated "
?L17:	PRINT DOWN-THE-HALL
	CALL FLOOR-WAXER-DIRECTION
	CRLF
	RTRUE
?L14:	EQUAL? RARG,M-ENTER \FALSE
	SET 'DOOR-WARNING,0
	EQUAL? OHERE,INF-1,INF-2,INF-3 /TRUE
	EQUAL? OHERE,INF-4,INF-5 /TRUE
	FSET? HERE,TOUCHBIT /?L25
	CALL QUEUE,I-WAXER-MOVES,10,1 >STACK
	ZERO? STACK /TRUE
?L25:	IN? MAINTENANCE-MAN,HERE \FALSE
	FSET? MAINTENANCE-MAN,PERSON \FALSE
	CALL QUEUE,I-MAINT-ATTACK,-1 >STACK
	RSTACK

	.FUNCT FLOOR-WAXER-DIRECTION,L
	LOC FLOOR-WAXER >L
	EQUAL? HERE,INF-1 /?L3
	EQUAL? HERE,INF-2 \?L4
	EQUAL? L,INF-3,INF-4,INF-5 /?L3
?L4:	EQUAL? HERE,INF-3 \?L5
	EQUAL? L,INF-4,INF-5 /?L3
?L5:	EQUAL? HERE,INF-4 \?L1
	EQUAL? L,INF-5 \?L1
?L3:	PRINTI "east."
	RTRUE
?L1:	PRINTI "west."
	RTRUE

	.FUNCT GENERIC-MAINTENANCE-MAN-F
	CALL META-LOC,MAINTENANCE-MAN >STACK
	EQUAL? STACK,HERE \?L1
	RETURN MAINTENANCE-MAN
?L1:	RETURN GLOBAL-MAINTENANCE-MAN

	.FUNCT GLOBAL-MAINTENANCE-MAN-F
	EQUAL? PRSA,V?EXAMINE,V?FIND \?L1
	LOC MAINTENANCE-MAN >STACK
	ZERO? STACK /?L3
	CALL MAINTENANCE-MAN-F >STACK
	RSTACK
?L3:	CALL YOU-SEE-NO,MAINTENANCE-MAN >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?POUR \?L6
	EQUAL? PRSI,GLOBAL-MAINTENANCE-MAN \?L6
	EQUAL? HERE,GREAT-DOME \?L6
	IN? MAINTENANCE-MAN,INF-3 /FALSE
?L6:	CALL ABSTRACT-VERB? >STACK
	ZERO? STACK \FALSE
	PRINTI "He's not here, but he might be soon!"
	CRLF
	EQUAL? PRSA,V?TELL \TRUE
	CALL END-QUOTE >STACK
	RSTACK

	.FUNCT MAINTENANCE-MAN-F,W
	EQUAL? WINNER,MAINTENANCE-MAN \?L1
	CALL META-LOC,MAINTENANCE-MAN >STACK
	EQUAL? STACK,HERE /?L3
	PRINTI "He"
	PRINT IS-DOWN-THE-HALL
	JUMP ?L5
?L3:	ZERO? CORD-SEVERED? /?L6
	PRINTI "He snarls at you angrily."
	JUMP ?L8
?L6:	PRINTI "He replies in a language you do not recognize."
?L8:	PRINTI " The words are guttural and jarring."
	CRLF
?L5:	CALL END-QUOTE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L9
	ZERO? CORD-SEVERED? /?L10
	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINTR " is very annoyed with you."
?L10:	PRINTR "He looks tired, bored, almost zombie-like."
?L9:	EQUAL? PRSA,V?SHOW,V?GIVE \?L13
	PRINTR "He doesn't react."
?L13:	EQUAL? PRSA,V?ATTACK,V?KILL /?L15
	EQUAL? PRSA,V?THROW \?L14
	EQUAL? PRSI,MAINTENANCE-MAN \?L14
?L15:	CALL KILL-VERB-MAINT? >STACK
	CALL PRINT-ID,STR?286,STACK
	CALL KILL-VERB-MAINT? >STACK
	ZERO? STACK \?L16
	PUSH 1
	JUMP ?L17
?L16:	PUSH 0
?L17:	CALL PRINT-ID,STR?287,STACK
	EQUAL? PRSA,V?THROW /?L18
	SET 'W,PRSI
	JUMP ?L20
?L18:	SET 'W,PRSO
?L20:	EQUAL? PRSA,V?THROW /?L23
	EQUAL? W,AXE \?L21
?L23:	CALL META-LOC,MAINTENANCE-MAN >STACK
	MOVE W,STACK
?L21:	EQUAL? W,0,HANDS \?L25
	PRINT YOU-CANT
	PRINTR "hurt him with your hands!"
?L25:	CALL CTHE-PRINT,W
	PRINTI " "
	IN? MAINTENANCE-MAN,FLOOR-WAXER \?L28
	EQUAL? PRSA,V?THROW \?L30
	PRINT STR?288
	PRINTR "!"
?L30:	PRINTI "can't reach him in "
	CALL THE-PRINT,FLOOR-WAXER
	PRINTR "!"
?L28:	CALL QUEUED?,I-MAINT-DISSOLVES >STACK
	ZERO? STACK /?L33
	PRINT STR?288
	PRINTI " as "
	CALL THE-PRINT,MAINTENANCE-MAN
	PRINTR " slips again!"
?L33:	EQUAL? W,AXE \?L34
	EQUAL? PRSA,V?THROW \?L35
	PRINTI "sails through the air, end over end, and makes a direct hit in"
	JUMP ?L37
?L35:	PRINTI "chops into"
?L37:	PRINTR " his chest, where it sticks. Ed Ames would be proud. The force of the blow staggers him a bit. He looks down at the axe with a certain perplexity, then pulls it free, the wound making a sickening sucking sound."
?L34:	EQUAL? W,SMOOTH-STONE \?L38
	PRINTR "hits him right between the eyes. He falls to the ground, stunned. There is now what looks like a large burn mark on his forehead. He ignores it and rises."
?L38:	EQUAL? W,NITROGEN \?L39
	PRINTR "makes a good show, but none actually gets on him."
?L39:	FSET? W,WEAPONBIT \?L40
	EQUAL? PRSA,V?THROW /?L43
	EQUAL? W,AXE \?L41
?L43:	PRINTI "sails toward him, but he bats it"
	JUMP ?L44
?L41:	PRINTI "is pushed"
?L44:	PRINTR " contemptuously aside, barely slowing his advance."
?L40:	PRINTR "does about as much damage as a piece of thistledown."
?L14:	EQUAL? PRSA,V?WALK-AROUND \FALSE
	ZERO? CORD-SEVERED? /FALSE
	PRINT YOU-CANT
	PRINTR "evade him."

	.FUNCT I-WAXER-MOVES,L,NL,TMP
	LOC FLOOR-WAXER >L
	CALL QUEUE,I-WAXER-MOVES,5
	ZERO? WAX-WEST? /?L47
	EQUAL? L,INF-1 \?L1
	SET 'WAX-WEST?,0
	JUMP ?L3
?L1:	ZERO? WAX-WEST? \?L48
?L47:	EQUAL? L,INF-5 \?L3
	SET 'WAX-WEST?,1
?L3:	ZERO? WAX-WEST? /?L5
?L48:	EQUAL? L,INF-3 \?L7
	EQUAL? HERE,GREAT-DOME,TOP-OF-DOME,DOME-ROOF /?L9
	EQUAL? HERE,ON-DOME \?L7
?L9:	SET 'WAX-WEST?,0
	RFALSE
?L7:	EQUAL? HERE,L \?L10
	SET 'WAX-WEST?,0
	CRLF
	CALL CTHE-PRINT,FLOOR-WAXER
	PRINTI " continues waxing a section of floor nearby. "
	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINTR " operating it stares at you suspiciously."
?L10:	EQUAL? L,INF-2 \?L12
	SET 'NL,INF-1
	JUMP ?L23
?L12:	EQUAL? L,INF-3 \?L14
	SET 'NL,INF-2
	JUMP ?L23
?L14:	EQUAL? L,INF-4 \?L15
	SET 'NL,INF-3
	JUMP ?L23
?L15:	EQUAL? L,INF-5 \?L23
	SET 'NL,INF-4
	JUMP ?L23
?L5:	EQUAL? L,INF-4 \?L19
	SET 'NL,INF-5
	JUMP ?L23
?L19:	EQUAL? L,INF-3 \?L21
	SET 'NL,INF-4
	JUMP ?L23
?L21:	EQUAL? L,INF-2 \?L22
	SET 'NL,INF-3
	JUMP ?L23
?L22:	EQUAL? L,INF-1 \?L23
	SET 'NL,INF-2
?L23:	MOVE FLOOR-WAXER,NL
	EQUAL? NL,INF-1 \?L25
	SET 'TMP,POWER-CORD
	JUMP ?L27
?L25:	SET 'TMP,GLOBAL-FLOOR-WAXER
?L27:	CALL PUT-GLOBAL,INF-1,0,TMP
	EQUAL? NL,INF-1,INF-2 \?L28
	SET 'TMP,POWER-CORD
	JUMP ?L30
?L28:	SET 'TMP,GLOBAL-FLOOR-WAXER
?L30:	CALL PUT-GLOBAL,INF-2,0,TMP
	EQUAL? NL,INF-4,INF-5 \?L31
	SET 'TMP,POWER-CORD
	JUMP ?L33
?L31:	SET 'TMP,GLOBAL-FLOOR-WAXER
?L33:	CALL PUT-GLOBAL,INF-4,0,TMP
	EQUAL? NL,INF-5 \?L34
	SET 'TMP,POWER-CORD
	JUMP ?L36
?L34:	SET 'TMP,GLOBAL-FLOOR-WAXER
?L36:	CALL PUT-GLOBAL,INF-5,0,TMP
	EQUAL? HERE,NL \?L37
	CRLF
	CALL CTHE-PRINT,FLOOR-WAXER
	PRINTI ", approaching from the "
	ZERO? WAX-WEST? /?L39
	PRINTI "east"
	JUMP ?L41
?L39:	PRINTI "west"
?L41:	PRINTR ", is now here."
?L37:	EQUAL? HERE,L \FALSE
	CRLF
	CALL CTHE-PRINT,FLOOR-WAXER
	PRINTI " waxes away to the "
	ZERO? WAX-WEST? /?L43
	PRINTI "west"
	JUMP ?L45
?L43:	PRINTI "east"
?L45:	PRINT PERIOD
	RTRUE

	.FUNCT CHANGE-ADJECTIVE,OBJ,P,NEW=0,G
	GETPT OBJ,P?ADJECTIVE >G
	ZERO? G /FALSE
	PUTB G,P,NEW
	RTRUE

	.FUNCT PUT-GLOBAL,OBJ,P,VAL,G
	GETPT OBJ,P?GLOBAL >G
	ZERO? G /FALSE
	PUTB G,P,VAL
	RTRUE

	.FUNCT GENERIC-FLOOR-WAXER-F
	IN? FLOOR-WAXER,HERE \?L1
	RETURN FLOOR-WAXER
?L1:	RETURN GLOBAL-FLOOR-WAXER

	.FUNCT GLOBAL-FLOOR-WAXER-F
	EQUAL? PRSA,V?WALK-TO \?L1
	EQUAL? HERE,INF-1 \?L3
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L3:	EQUAL? HERE,INF-2 \?L5
	IN? FLOOR-WAXER,INF-1 \?L6
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L6:	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L5:	EQUAL? HERE,INF-3 \?L9
	IN? FLOOR-WAXER,INF-1 /?L12
	IN? FLOOR-WAXER,INF-2 \?L10
?L12:	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L10:	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L9:	EQUAL? HERE,INF-4 \?L14
	IN? FLOOR-WAXER,INF-5 \?L15
	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L15:	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L14:	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L1:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /?L19
	PRINTI "It"
	PRINT IS-DOWN-THE-HALL
	CALL PRINT-ID,STR?289 >STACK
	RSTACK
?L19:	CALL FLOOR-WAXER-F >STACK
	RSTACK

	.FUNCT FLOOR-WAXER-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	IN? MAINTENANCE-MAN,FLOOR-WAXER \?L4
	PRINTI "A "
	PRINTD MAINTENANCE-MAN
	PRINTI " is here, riding a "
	PRINTD FLOOR-WAXER
	PRINTI "."
	RETURN M-FATAL
?L4:	PRINTI "A disabled "
	PRINTD FLOOR-WAXER
	PRINTI " looms nearby."
	RETURN M-FATAL

	.FUNCT FLOOR-WAXER-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	EQUAL? PRSA,V?WALK \?L3
	EQUAL? P-WALK-DIR,P?DOWN \?L3
	CALL PERFORM,V?DISEMBARK
	RTRUE
?L3:	EQUAL? PRSA,V?WALK,V?LAMP-OFF,V?LAMP-ON /?L6
	EQUAL? PRSA,V?STOP \FALSE
?L6:	CALL CTHE-PRINT,POWER-CORD
	PRINTR " is severed. It's not going anywhere."
?L1:	EQUAL? RARG,M-CONTAINER \?L8
	EQUAL? PRSA,V?TAKE \FALSE
	IN? WINNER,FLOOR-WAXER /FALSE
	CALL CANT-REACH-THAT
	RTRUE
?L8:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?EXAMINE \?L13
	EQUAL? PRSO,GLOBAL-FLOOR-WAXER \?L15
	PRINT YOU-CANT
	PRINTR "see it too clearly, but it looks like a large waxing machine."
?L15:	PRINTI "It's a large "
	PRINTD FLOOR-WAXER
	PRINTI ", big enough to ride in"
	IN? MAINTENANCE-MAN,FLOOR-WAXER \?L18
	PRINTI ", and in fact there is "
	CALL PRINTA,MAINTENANCE-MAN
	PRINTI " riding it"
?L18:	PRINTI ". It actually looks sort of like a small bulldozer. "
	ZERO? CORD-SEVERED? /?L21
	PRINTI "The severed remnant of "
	CALL THE-PRINT,POWER-CORD
	PRINTR " graces one end."
?L21:	PRINTI "A "
	PRINTD POWER-CORD
	PRINTR " connects it to the wall."
?L13:	EQUAL? PRSA,V?LISTEN \?L24
	ZERO? CORD-SEVERED? /?L25
	PRINTR "It's very quiet."
?L25:	PRINTI "It makes a ghastly whirring, whining sound."
	IN? FLOOR-WAXER,HERE \?L28
	PRINTI " This close, it's almost unbearable."
?L28:	CRLF
	RTRUE
?L24:	EQUAL? PRSA,V?BOARD \?L31
	EQUAL? PRSO,GLOBAL-FLOOR-WAXER \?L32
	PRINTR "It's not here!"
?L32:	IN? MAINTENANCE-MAN,PRSO \FALSE
	CALL CTHE-PRINT,MAINTENANCE-MAN
	ZERO? CORD-SEVERED? /?L35
	PRINTI " catches you with a surprisingly strong punch as you try to climb aboard. You fall to the floor, taken aback."
	CRLF
	CALL PRINT-ID,STR?290 >STACK
	RSTACK
?L35:	PRINTR " prevents you. He says something that probably means ""No riders, buddy"" (freely translated)."
?L31:	EQUAL? PRSA,V?UNPLUG \?L39
	CALL NEW-PRSO,POWER-CORD
	RTRUE
?L39:	EQUAL? PRSA,V?LAMP-OFF,V?STOP \?L40
	PRINTR "You'd have to be riding in it to turn it off."
?L40:	EQUAL? PRSA,V?LOOK-UNDER \?L41
	PRINTR "You see a nice, shiny floor."
?L41:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /?L42
	PRINTI "The waxer is pretty sturdy. These things have been waxing the floors here for decades."
	CRLF
	CALL PRINT-ID,STR?291 >STACK
	RSTACK
?L42:	EQUAL? PRSA,V?WALK-AROUND \FALSE
	ZERO? CORD-SEVERED? \FALSE
	PRINT YOU-CANT
	PRINTR "evade it."

	.FUNCT WALL-SOCKET-DESC,RARG,OBJ,L
	EQUAL? RARG,M-OBJDESC? /TRUE
	PRINT STR?192
	PRINTI "wall socket on one wall, and a heavy-duty "
	PRINTD POWER-CORD
	PRINTI " is plugged into it. The cord "
	ZERO? CORD-SEVERED? /?L4
	PRINTI "terminates in a severed stump"
	JUMP ?L10
?L4:	PRINTI "leads "
	LOC FLOOR-WAXER >L
	EQUAL? L,HERE \?L7
	PRINTI "to a large "
	PRINTD FLOOR-WAXER
	JUMP ?L10
?L7:	EQUAL? L,INF-1,INF-2 \?L9
	PRINTI "away to the west"
	JUMP ?L10
?L9:	EQUAL? L,INF-4,INF-5 \?L10
	PRINTI "away to the east"
?L10:	PRINTI "."
	RTRUE

	.FUNCT POWER-CORD-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL CTHE-PRINT,POWER-CORD
	ZERO? CORD-SEVERED? \?L3
	PRINTI " connects"
	JUMP ?L5
?L3:	PRINTI ", now a mere stub, formerly connected"
?L5:	PRINTI " a wall socket "
	EQUAL? HERE,INF-1,INF-2 \?L6
	PRINT DOWN-THE-HALL
	PRINTI "east "
	JUMP ?L9
?L6:	EQUAL? HERE,INF-3 \?L8
	PRINT STR?292
	PRINTI " "
	JUMP ?L9
?L8:	PRINT DOWN-THE-HALL
	PRINTI "west "
?L9:	PRINTI "with "
	CALL THE-PRINT,FLOOR-WAXER
	PRINTR "."
?L1:	EQUAL? PRSA,V?TAKE,V?UNPLUG,V?MOVE /?L11
	EQUAL? PRSA,V?PRY \?L10
?L11:	PRINTI "You pull at "
	CALL THE-PRINT,POWER-CORD
	PRINTR ", but it won't come loose!"
?L10:	EQUAL? PRSA,V?FOLLOW \?L12
	CALL CTHE-PRINT,POWER-CORD
	PRINTI " goes from a wall socket "
	EQUAL? HERE,INF-1,INF-2 \?L13
	PRINTI "to the east"
	JUMP ?L16
?L13:	EQUAL? HERE,INF-3 \?L15
	PRINT STR?292
	JUMP ?L16
?L15:	PRINTI "to the west"
?L16:	PRINTI " to "
	CALL PRINTA,FLOOR-WAXER
	PRINTI " which is "
	IN? FLOOR-WAXER,HERE \?L17
	PRINTI "here."
	JUMP ?L19
?L17:	PRINTI "to the "
	CALL FLOOR-WAXER-DIRECTION
?L19:	ZERO? CORD-SEVERED? /?L20
	PRINTI " Of course, the cord is severed."
?L20:	CRLF
	RTRUE
?L12:	EQUAL? PRSA,V?CUT,V?MUNG,V?ATTACK \?L23
	EQUAL? PRSO,POWER-CORD \?L23
	EQUAL? PRSI,0,HANDS \?L24
	PRINTI "You'll need more than your hands to sever this cord!"
	CRLF
	CALL PRINT-ID,STR?293 >STACK
	RSTACK
?L24:	ZERO? CORD-SEVERED? /?L26
	PRINT YOUVE-ALREADY
	PRINTI "sliced it once! Trying to make salami?"
	CRLF
	CALL PRINT-ID,STR?294 >STACK
	RSTACK
?L26:	EQUAL? PRSI,AXE \?L27
	SET 'CORD-SEVERED?,1
	CALL DEQUEUE,I-WAXER-MOVES
	CALL QUEUE,I-MAINT-ATTACK,2
	PRINTI "The axe crashes against the floor, and "
	CALL THE-PRINT,POWER-CORD
	PRINTI " severs! The whine of "
	CALL THE-PRINT,FLOOR-WAXER
	PRINTI " slows, and "
	CALL THE-PRINT,MAINTENANCE-MAN
	PRINTI " jerks to alertness."
	CRLF
	CALL PRINT-ID,STR?295 >STACK
	RSTACK
?L27:	PRINTI "You hit the cord with "
	CALL THE-PRINT-PRSI
	PRINTI ", but it has no effect."
	CRLF
	CALL PRINT-ID,STR?296 >STACK
	RSTACK
?L23:	EQUAL? PRSA,V?REPAIR \FALSE
	ZERO? CORD-SEVERED? /FALSE
	PRINTI "It's beyond repair."
	CRLF
	CALL PRINT-ID,STR?297 >STACK
	RSTACK

	.FUNCT SEE-MM?
	IN? MAINTENANCE-MAN,HERE /TRUE
	EQUAL? HERE,INF-1,INF-2,INF-3 /TRUE
	EQUAL? HERE,INF-4,INF-5 /TRUE
	EQUAL? HERE,GREAT-DOME,TOP-OF-DOME \FALSE
	IN? MAINTENANCE-MAN,INF-3 /TRUE
	RFALSE

	.FUNCT MAINT-DESCENDS,INT?=0
	CALL QUEUE,I-MAINT-ATTACK,-1
	LOC FLOOR-WAXER >STACK
	MOVE MAINTENANCE-MAN,STACK
	CALL SEE-MM? >STACK
	ZERO? STACK /FALSE
	ZERO? INT? /?L3
	CRLF
?L3:	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINTI ", growling foul-sounding imprecations, descends from "
	CALL THE-PRINT,FLOOR-WAXER
	PRINTI " and "
	ZERO? INT? /?L6
	PRINTI "heads towards you."
	JUMP ?L8
?L6:	PRINTI "blocks your way."
?L8:	LOC MAINTENANCE-MAN >STACK
	IN? FLOOR-WAX,STACK \?L9
	SET 'SEEN-MM-SLIP?,1
	PRINTI " But almost immediately, he slips on the floor wax."
?L9:	CRLF
	RTRUE

	.FUNCT I-MAINT-ATTACK,L,TMP,TMP1,MM-WAITS?=0
	IN? MAINTENANCE-MAN,FLOOR-WAXER \?L1
	CALL MAINT-DESCENDS,1 >STACK
	RSTACK
?L1:	LOC MAINTENANCE-MAN >STACK
	IN? FLOOR-WAX,STACK \?L3
	CALL QUEUE,I-MAINT-DISSOLVES,4,1
	ADD SCORE,MAINT-SCORE >SCORE
	SET 'MAINT-SCORE,0
	CALL SEE-MM? >STACK
	ZERO? STACK /FALSE
	CRLF
	CALL CTHE-PRINT,MAINTENANCE-MAN
	ZERO? SEEN-MM-SLIP? /?L6
	PRINTI " continues slipping, falling, standing, and so on."
	JUMP ?L8
?L6:	SET 'SEEN-MM-SLIP?,1
	PRINTI " reaches the wax and immediately slips and falls."
?L8:	PRINTR " He reminds you of a badly made windup toy."
?L3:	LOC MAINTENANCE-MAN >L
	IN? MAINTENANCE-MAN,HERE \?L11
	CRLF
	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINTI " stares with maniacal intensity at your throat."
	JUMP ?L44
?L11:	EQUAL? HERE,INF-1,INF-2,INF-3 /?L14
	EQUAL? HERE,INF-4,INF-5 /?L14
	SET 'MM-WAITS?,1
	SET 'MAINT-ATTACK-COUNT,5
?L14:	EQUAL? HERE,GREAT-DOME,TOP-OF-DOME,DOME-ROOF /?L19
	EQUAL? HERE,ON-DOME \?L17
?L19:	EQUAL? L,INF-5 \?L20
	MOVE MAINTENANCE-MAN,INF-4
	JUMP ?L29
?L20:	EQUAL? L,INF-4 \?L29
	MOVE MAINTENANCE-MAN,INF-3
	JUMP ?L29
?L17:	EQUAL? L,INF-5 \?L25
	MOVE MAINTENANCE-MAN,INF-4
	JUMP ?L29
?L25:	EQUAL? L,INF-4 \?L27
	MOVE MAINTENANCE-MAN,INF-3
	JUMP ?L29
?L27:	EQUAL? L,INF-3 \?L28
	MOVE MAINTENANCE-MAN,INF-2
	JUMP ?L29
?L28:	EQUAL? L,INF-2 \?L29
	MOVE MAINTENANCE-MAN,INF-1
?L29:	EQUAL? HERE,GREAT-DOME,TOP-OF-DOME \?L31
	EQUAL? L,INF-3 \FALSE
	CALL MM-WAITS-PATIENTLY,STR?298
	RTRUE
?L31:	EQUAL? HERE,MASS-AVE \?L36
	EQUAL? L,INF-1 \FALSE
	CALL MM-WAITS-PATIENTLY,STR?299
	RTRUE
?L36:	ZERO? MM-WAITS? /?L40
	EQUAL? L,ENGINEERING-BLDG,AERO-LOBBY \FALSE
	CALL MM-WAITS-PATIENTLY,STR?300
	RTRUE
?L40:	CRLF
	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINT STR?285
	PRINTI " with surprising speed."
?L44:	LOC MAINTENANCE-MAN >L
	IN? MAINTENANCE-MAN,HERE \?L45
	IN? FLOOR-WAX,HERE \?L45
	SET 'SEEN-MM-SLIP?,1
	PRINTR " Just as he is about to grab you he slips on the wax. His hand whips by, inches from your throat, and he drops to the floor, screaming in frustration."
?L45:	IN? FLOOR-WAX,L \?L47
	CALL SEE-MM? >STACK
	ZERO? STACK /?L47
	SET 'SEEN-MM-SLIP?,1
	PRINTR " He encounters the floor wax, slips, and drops to the floor, screaming in frustration."
?L47:	IGRTR? 'MAINT-ATTACK-COUNT,4 \?L48
	EQUAL? HERE,GREAT-DOME,TOP-OF-DOME,ON-DOME /FALSE
	EQUAL? HERE,DOME-ROOF,MASS-AVE /FALSE
	CALL DEQUEUE,I-MAINT-ATTACK
	CALL PRINT-ID,STR?301
	CALL JIGS-UP,STR?302 >STACK
	RSTACK
?L48:	IN? MAINTENANCE-MAN,HERE \?L52
	CRLF
	RTRUE
?L52:	GETP HERE,P?SIZE >TMP
	ZERO? TMP /?L58
	GETP L,P?SIZE >TMP1
	ZERO? TMP1 /?L58
	SUB TMP1,TMP >TMP
	PRINTI " He is "
	EQUAL? TMP,1 \?L56
	PRINTR "nearly upon you."
?L56:	EQUAL? TMP,2 \?L59
	PRINTI "some ways down"
	JUMP ?L62
?L59:	EQUAL? TMP,3 \?L61
	PRINTI "quite a way down"
	JUMP ?L62
?L61:	EQUAL? TMP,4 \?L62
	PRINTI "at the far end of"
?L62:	PRINTI " the corridor."
?L58:	CRLF
	RTRUE

	.FUNCT MM-WAITS-PATIENTLY,WHERE
	CRLF
	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINTI " waits patiently "
	PRINT WHERE
	PRINTR "."

	.FUNCT I-MAINT-DISSOLVES
	REMOVE MAINTENANCE-MAN
	CALL DEQUEUE,I-MAINT-ATTACK
	EQUAL? HERE,INF-1,INF-2,INF-3 /?L3
	EQUAL? HERE,INF-4,INF-5 \FALSE
?L3:	CRLF
	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINTI " appears to shorten and almost dissolve. There is a great commotion, as though he is undergoing a convulsion of some sort, and then he appears to explode into a crowd of small squealing creatures. These, seeing you, scuttle off in the opposite direction and disappear."
	CRLF
	CALL PRINT-ID,STR?303 >STACK
	RSTACK

	.FUNCT PLASTIC-CONTAINER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a plain plastic container with something written on it. "
	CALL LOOK-IN-CONTAINER >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?OPEN \?L3
	FSET? PLASTIC-CONTAINER,OPENBIT /FALSE
	FSET PLASTIC-CONTAINER,OPENBIT
	PRINTR "You pull off the seal and open the container, revealing a smelly, viscous liquid."
?L3:	EQUAL? PRSA,V?CLOSE \?L7
	FSET? PLASTIC-CONTAINER,OPENBIT \FALSE
	PRINTR "The container can't be resealed."
?L7:	EQUAL? PRSA,V?LOOK-INSIDE \?L11
	CALL LOOK-IN-CONTAINER >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?POUR \?L12
	FSET? PLASTIC-CONTAINER,OPENBIT /?L13
	PRINTR "The container isn't open."
?L13:	IN? FLOOR-WAX,PRSO \?L15
	CALL NEW-PRSO,FLOOR-WAX
	RTRUE
?L15:	CALL V-POUR >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?FILL \FALSE
	CALL CANT-FILL-IT >STACK
	RSTACK

	.FUNCT LOOK-IN-CONTAINER
	FSET? PRSO,OPENBIT /?L1
	CALL TELL-OPEN-CLOSED,PRSO
	RTRUE
?L1:	FIRST? PRSO >STACK \?L3
	CALL DESCRIBE-SENT,PRSO
	CRLF
	RTRUE
?L3:	PRINTR "It appears to be empty."

	.FUNCT CANT-FILL-IT
	PRINT YOU-CANT
	ZERO? PRSI /?L1
	PRINTI "get "
	CALL THE-PRINT-PRSI
	PRINTR " into the container."
?L1:	PRINTI "fill "
	CALL THE-PRINT-PRSO
	PRINT PERIOD
	RTRUE

	.FUNCT FLOOR-WAX-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? \?L1
	LOC FLOOR-WAX >STACK
	IN? STACK,ROOMS /TRUE
	RFALSE
?L1:	PRINT STR?304
	PRINTI "covered with slippery, messy floor wax."
	RTRUE

	.FUNCT FLOOR-WAX-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINT IT-SEEMS-TO-BE
	PRINTR "floor wax."
?L1:	EQUAL? PRSA,V?TAKE \?L3
	PRINTR "It's a liquid, not a solid."
?L3:	EQUAL? PRSA,V?STEP-ON \?L4
	IN? FLOOR-WAX,HERE \?L4
	PRINTR "It's pretty slippery, all right. You can't walk on it very easily."
?L4:	EQUAL? PRSA,V?PUT \?L7
	EQUAL? PRSO,HANDS /?L6
?L7:	EQUAL? PRSA,V?RUB \?L5
?L6:	PRINTR "It feels like floor wax. It's very slippery."
?L5:	EQUAL? PRSA,V?SMELL \?L8
	PRINTR "It smells very pungent."
?L8:	EQUAL? PRSA,V?PUT \?L9
	EQUAL? PRSI,GROUND /?L12
	FSET? PRSI,CONTBIT \FALSE
?L12:	CALL NEW-VERB,V?POUR
	RTRUE
?L9:	EQUAL? PRSA,V?POUR,V?DROP \FALSE
	IN? PRSO,PLASTIC-CONTAINER \?L15
	ZERO? PRSI /?L17
	CALL HELD?,PRSI >STACK
	ZERO? STACK \?L19
	FSET? PRSI,CONTBIT \?L17
	GETP PRSI,P?CAPACITY >STACK
	ZERO? STACK /?L17
?L19:	PRINTR "Without a funnel, you are doomed to failure. It'll end up all over everything."
?L17:	MOVE FLOOR-WAX,HERE
	EQUAL? PRSI,GROUND,CORRIDOR,GLOBAL-MAINTENANCE-MAN /?L21
	ZERO? PRSI /?L21
	PRINTI "You pour it all over "
	CALL THE-PRINT-PRSI
	PRINTI ", and of course it pours right off onto the floor."
	JUMP ?L26
?L21:	EQUAL? HERE,TOP-OF-DOME,GREAT-DOME \?L24
	MOVE FLOOR-WAX,INF-3
	PRINTI "The wax cascades down onto the corridor floor below, like Quasimodo's molten lead."
	JUMP ?L26
?L24:	PRINTI "It pours out and spreads like ants at a picnic."
?L26:	FSET? HERE,OUTSIDE /?L27
	PRINTI " The floor is now covered from wall to wall with slippery floor wax."
?L27:	LOC FLOOR-WAX >STACK
	IN? MAINTENANCE-MAN,STACK \?L30
	SET 'SEEN-MM-SLIP?,1
	PRINTI " "
	CALL CTHE-PRINT,MAINTENANCE-MAN
	PRINTI ", attempting to get closer to you, enters the waxed part of the floor. He begins to slip and slide, barely able to maintain his balance, much less advance."
?L30:	CRLF
	RTRUE
?L15:	PRINTR "There is no more wax to pour."

	.FUNCT EMERGENCY-CABINET-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	PRINT STR?192
	FSET? OBJ,RMUNGBIT \?L4
	PRINTI "formerly "
?L4:	PRINTI "glass-fronted emergency cabinet here."
	FSET? OBJ,RMUNGBIT /TRUE
	RETURN M-FATAL

	.FUNCT EMERGENCY-CABINET-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's one of those little cabinets you see in institutional buildings that usually contains a fire hose and a fire axe. "
	IN? AXE,PRSO \?L3
	PRINTI "This one seems to only have an axe. "
?L3:	PRINTI "It "
	FSET? PRSO,RMUNGBIT \?L6
	PRINTI "had"
	JUMP ?L8
?L6:	PRINTI "has"
?L8:	PRINTI " a transparent window"
	FSET? PRSO,RMUNGBIT \?L9
	PRINTI " but apparently some vandal smashed it"
?L9:	PRINTR ". There is writing on the cabinet."
?L1:	EQUAL? PRSA,V?OPEN \?L12
	FSET? PRSO,RMUNGBIT /FALSE
	PRINTR "You should read the sign."
?L12:	EQUAL? PRSA,V?LOOK-INSIDE \?L16
	PRINTI "Inside the cabinet you see "
	CALL DESCRIBE-REST,EMERGENCY-CABINET
	PRINT PERIOD
	RTRUE
?L16:	EQUAL? PRSA,V?MUNG,V?ATTACK \FALSE
	EQUAL? PRSO,EMERGENCY-CABINET \FALSE
	FSET? EMERGENCY-CABINET,RMUNGBIT \?L18
	PRINTR "The cabinet is already smashed."
?L18:	EQUAL? PRSI,0,HANDS \?L20
	FSET? GLOVES,WEARBIT /?L21
	PRINTI "You hit at the glass with your hands, but you can't hit hard enough to break it: you might cut yourself on the glass."
	CRLF
	CALL PRINT-ID,STR?305 >STACK
	RSTACK
?L21:	FSET EMERGENCY-CABINET,OPENBIT
	FSET EMERGENCY-CABINET,RMUNGBIT
	PRINTR "Wearing the heavy gloves, you confidently smash the glass with a blow of your hands!"
?L20:	FSET? PRSI,WEAPONBIT \?L24
	FSET? EMERGENCY-CABINET,RMUNGBIT /FALSE
	FSET EMERGENCY-CABINET,OPENBIT
	FSET EMERGENCY-CABINET,RMUNGBIT
	PRINTR "The glass smashes with a satisfying crash!"
?L24:	EQUAL? PRSI,PLASTIC-CONTAINER \?L28
	PRINTR "The light plastic bounces off the cabinet."
?L28:	PRINTR "The glass survives unscathed."

	.FUNCT AERO-LOBBY-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINT THE-LOBBY
	PRINTR "Aeronautical Engineering Building. Stairs lead down and a corridor heads south towards the main building."

	.FUNCT GREAT-DOME-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "Here a walkway circles the base of a huge ornate dome. Below is the Infinite Corridor."
	FSET? DOME-LADDER,TOUCHBIT /?L5
	PRINTI " From stories of Tech Exploring trips, you recall that there is supposed to be a ladder here."
	FSET? TENTACLE,INVISIBLE /?L5
	PRINTI " On the other hand, there is a shiny rope-like thing hanging near where the ladder used to be, and leading upward."
?L5:	IN? FLOOR-WAXER,INF-3 \?L9
	PRINTI " Below you, in the corridor, you can see "
	CALL PRINTA,FLOOR-WAXER
	ZERO? CORD-SEVERED? \?L11
	PRINTI ", busily waxing the floor"
?L11:	PRINTI "."
?L9:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? P-WALK-DIR,P?UP \FALSE
	EQUAL? HERE,LADDER-BOTTOM? \FALSE
	CALL PERFORM,V?CLIMB-UP,DOME-LADDER
	RTRUE

	.FUNCT TENTACLE-WETNESS
	PRINTI "It's wet, and when you touch it, some of the wetness sticks to your "
	FSET? GLOVES,WEARBIT \?L1
	PRINTI "gloves"
	RTRUE
?L1:	PRINTI "hands, and stings"
	CALL PRINT-ID,STR?306 >STACK
	RSTACK

	.FUNCT TENTACLE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The strand is wet and glistening. It extends upward into the dome, leading to a narrow catwalk."
?L1:	EQUAL? PRSA,V?TAKE,V?RUB \?L3
	CALL TENTACLE-WETNESS
	PRINTR ". The strand twitches a little when you touch it."
?L3:	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-FOO \FALSE
	EQUAL? HERE,GREAT-DOME \FALSE
	FSET? GLOVES,WEARBIT \?L7
	PRINTI "The wet stuff on the strand sticks to the gloves, but doesn't otherwise affect you. You have a little trouble climbing up to the catwalk, but grab the rail just before your strength gives out. You heave yourself up onto the catwalk."
	CRLF
	CRLF
	CALL GOTO,TOP-OF-DOME >STACK
	RSTACK
?L7:	PRINT STR?307
	PRINTI "up the strand, but the glistening wet stuff begins to burn your hands. You get a few feet up before the pain is too much. You drop back to the floor."
	CRLF
	CALL PRINT-ID,STR?308 >STACK
	RSTACK

	.FUNCT TOP-OF-DOME-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "Inside the great dome, near the top, a metal catwalk is precariously perched. There is no way further up, but a small metal door is set in the side of the dome."
	FSET? DOME-DOOR,OPENBIT \?L3
	PRINTI " Frigid wind and snow blow through the open door."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \?L6
	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? P-WALK-DIR,P?UP \?L9
	EQUAL? HERE,LADDER-BOTTOM? \?L9
	CALL PERFORM,V?CLIMB-UP,DOME-LADDER
	RTRUE
?L9:	EQUAL? P-WALK-DIR,P?DOWN \FALSE
	EQUAL? HERE,LADDER-TOP? \FALSE
	CALL PERFORM,V?CLIMB-DOWN,DOME-LADDER
	RTRUE
?L6:	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? OHERE,DOME-ROOF \?L15
	CALL EXIT-FROM-COLD >STACK
	RSTACK
?L15:	FSET? TENTACLE,INVISIBLE /FALSE
	FSET TENTACLE,INVISIBLE
	PRINTI "You stand up on the catwalk, catching your breath for a moment. Your eyes stray along the strand you climbed. It trails along the catwalk, where it joins something large and squishy squatting at the far side. A single, bright-blue eye opens in the squishy mass, and the tentacle (for that's what it is) retracts. The mass almost flows through the spaces in the catwalk railing and drops to the floor fifteen feet below. Before you can react, it's gone."
	CRLF
	CRLF
	RTRUE

	.FUNCT DOME-LADDER-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	FSET? DOME-LADDER,TOUCHBIT /?L4
	PRINTI "Where the pulpy mass was squatting, a wooden ladder lies on the catwalk."
	RTRUE
?L4:	PRINTI "A wooden ladder "
	EQUAL? HERE,LADDER-TOP? \?L7
	PRINTI "leads down from"
	JUMP ?L10
?L7:	EQUAL? HERE,LADDER-BOTTOM? \?L9
	PRINTI "leads up from"
	JUMP ?L10
?L9:	PRINTI "rests"
?L10:	PRINTI " here."
	RTRUE

	.FUNCT DOME-LADDER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "There is the same wet stuff on the ladder as on the tentacle."
?L1:	EQUAL? PRSA,V?RUB \?L3
	CALL TENTACLE-WETNESS
	PRINT PERIOD
	RTRUE
?L3:	EQUAL? PRSA,V?TAKE \?L4
	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
	SET 'LADDER-TOP?,0
	SET 'LADDER-BOTTOM?,0
	PRINTR "It's a heavy ladder, but you manage to take it."
?L4:	EQUAL? PRSA,V?RAISE,V?LAMP-ON \?L8
	FSET DOME-LADDER,TOUCHBIT
	EQUAL? LADDER-TOP?,TOP-OF-DOME \?L9
	EQUAL? HERE,TOP-OF-DOME \?L11
	MOVE DOME-LADDER,HERE
	SET 'LADDER-TOP?,0
	SET 'LADDER-BOTTOM?,0
	PRINTR "With a great effort, the ladder being quite heavy (it's a Type I), you pull the ladder up and lay it on the catwalk."
?L11:	PRINTR "The ladder is already set up."
?L9:	EQUAL? HERE,GREAT-DOME \?L14
	SET 'LADDER-TOP?,TOP-OF-DOME
	SET 'LADDER-BOTTOM?,GREAT-DOME
	MOVE DOME-LADDER,HERE
	PRINTR "You raise the ladder, leaning it against the catwalk above."
?L14:	EQUAL? HERE,ELEVATOR-PIT \?L15
	FSET? ELEVATOR-DOOR-B,OPENBIT \?L16
	FIRST? ELEVATOR-DOOR-B >STACK /?L16
	PRINT YOU-CANT
	PRINTR "raise a ladder and hold the doors open at the same time!"
?L16:	CALL ONLY-A-FEW-FEET >STACK
	RSTACK
?L15:	PRINTR "There isn't much here to climb up to."
?L8:	EQUAL? PRSA,V?LOWER /?L21
	EQUAL? PRSA,V?PUT-ON \?L20
	EQUAL? PRSI,CATWALK \?L20
?L21:	FSET DOME-LADDER,TOUCHBIT
	EQUAL? HERE,TOP-OF-DOME \?L22
	ZERO? LADDER-TOP? \?L24
	MOVE DOME-LADDER,HERE
	SET 'LADDER-TOP?,TOP-OF-DOME
	SET 'LADDER-BOTTOM?,GREAT-DOME
	PRINTR "You lower the ladder to the walkway below. It's just the right length to climb down."
?L24:	PRINT YOU-CANT
	PRINTR "lower it from here."
?L22:	EQUAL? HERE,CS-BASEMENT \?L27
	CALL ONLY-A-FEW-FEET >STACK
	RSTACK
?L27:	ZERO? LADDER-TOP? \?L28
	PRINTR "It's already taken down."
?L28:	SET 'LADDER-TOP?,0
	SET 'LADDER-BOTTOM?,0
	PRINTR "Lowered."
?L20:	EQUAL? PRSA,V?CLIMB-FOO \?L30
	EQUAL? HERE,LADDER-BOTTOM? \?L31
	CALL NEW-VERB,V?CLIMB-UP
	RTRUE
?L31:	EQUAL? HERE,LADDER-TOP? \?L33
	CALL NEW-VERB,V?CLIMB-DOWN
	RTRUE
?L33:	CALL LADDER-NOT-UP >STACK
	RSTACK
?L30:	EQUAL? PRSA,V?CLIMB-UP \?L35
	EQUAL? LADDER-BOTTOM?,HERE \?L36
	PRINT YOU-SCRAMBLE-UP
	PRINTI "ladder."
	CRLF
	CRLF
	MOVE DOME-LADDER,LADDER-TOP?
	CALL GOTO,LADDER-TOP? >STACK
	RSTACK
?L36:	EQUAL? LADDER-TOP?,HERE \?L38
	CALL LADDER-EXTENDS,STR?310,STR?309 >STACK
	RSTACK
?L38:	CALL LADDER-NOT-UP >STACK
	RSTACK
?L35:	EQUAL? PRSA,V?CLIMB-DOWN \?L40
	EQUAL? LADDER-TOP?,HERE \?L41
	PRINTI "You scramble down the ladder."
	CRLF
	CRLF
	MOVE DOME-LADDER,LADDER-BOTTOM?
	CALL GOTO,LADDER-BOTTOM? >STACK
	RSTACK
?L41:	EQUAL? LADDER-BOTTOM?,HERE \?L43
	CALL LADDER-EXTENDS,STR?309,STR?310 >STACK
	RSTACK
?L43:	CALL LADDER-NOT-UP >STACK
	RSTACK
?L40:	EQUAL? PRSA,V?WALK-UNDER \FALSE
	EQUAL? LADDER-BOTTOM?,HERE \?L46
	PRINTR "You trepidatiously walk under the ladder. Nothing seems to happen."
?L46:	PRINTR "There's no ladder set up here."

	.FUNCT LADDER-EXTENDS,U,D
	PRINTI "The ladder extends "
	PRINT U
	PRINTI " from here, not "
	PRINT D
	PRINTR "."

	.FUNCT ONLY-A-FEW-FEET
	PRINTI "It's only a few feet "
	EQUAL? HERE,ELEVATOR-PIT \?L1
	PRINTI "up"
	JUMP ?L3
?L1:	PRINTI "down"
?L3:	PRINTR ". You don't need a ladder for that!"

	.FUNCT LADDER-NOT-UP
	CALL HELD?,DOME-LADDER >STACK
	ZERO? STACK /?L1
	PRINTR "Climbing it while holding it would be a neat trick."
?L1:	PRINTR "The ladder doesn't go anywhere yet."

	.FUNCT GLOVES-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "This is a pair of electrician's rubber gloves. They look well used but serviceable."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L3
	PRINTR "They're kind of dirty inside, but there's nothing nasty hidden there."
?L3:	EQUAL? PRSA,V?PUT-ON \?L4
	EQUAL? PRSO,HAND \?L6
	EQUAL? PRSI,GLOVES /?L5
?L6:	EQUAL? PRSA,V?PUT-ON \?L4
	EQUAL? PRSO,GLOVES \?L4
	EQUAL? PRSI,HAND \?L4
?L5:	PRINTR "It's much too big."
?L4:	EQUAL? PRSA,V?WEAR /?L8
	EQUAL? PRSA,V?PUT-ON \FALSE
	EQUAL? PRSO,HANDS \?L9
	EQUAL? PRSI,GLOVES /?L8
?L9:	EQUAL? PRSA,V?PUT-ON \FALSE
	EQUAL? PRSO,GLOVES \FALSE
	EQUAL? PRSI,HANDS \FALSE
?L8:	CALL IWEAR >STACK
	EQUAL? STACK,1 \TRUE
	PRINTR "You put on the gloves. They're a little big, but not really such a bad fit at all."

	.FUNCT DOME-DOOR-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's a small metal door, the same color as the dome."
?L1:	EQUAL? PRSA,V?THROUGH \?L3
	EQUAL? HERE,TOP-OF-DOME \?L4
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L4:	CALL DO-WALK,P?IN >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?OPEN \?L7
	FSET? DOME-DOOR,OPENBIT /?L7
	FSET DOME-DOOR,OPENBIT
	PRINTR "You open the door, and freezing air, blowing snow, and howling wind enter and whip around you."
?L7:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? DOME-DOOR,OPENBIT \FALSE
	FCLEAR DOME-DOOR,OPENBIT
	PRINTR "You close the door, shutting out the blizzard."

	.FUNCT DOME-ROOF-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	EQUAL? OHERE,TOP-OF-DOME \FALSE
	CALL EXIT-TO-COLD >STACK
	RSTACK

	.FUNCT EXIT-TO-COLD
	CALL QUEUE,I-FREEZE-TO-DEATH,2,1
	PRINTI "You enter the freezing, biting cold of the blizzard."
	CRLF
	CRLF
	RTRUE

	.FUNCT ON-DOME-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	PRINT YOU-SCRAMBLE-UP
	PRINTI "icy surface of the dome, almost slipping a few times, but finally you make it to the top."
	CRLF
	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \?L4
	EQUAL? P-WALK-DIR,P?DOWN /?L4
	PRINTR "There is nowhere to go but down."
?L4:	CALL ROOF-BEGS >STACK
	RSTACK

	.FUNCT BRONZE-PLUG-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This is a cylindrical bronze plug about two inches in diameter"
	FSET? PRSO,TOUCHBIT /?L3
	PRINTR ". It is set in the center of the flat part of the dome."
?L3:	PRINTR " and one inch high."
?L1:	EQUAL? PRSA,V?TAKE \?L6
	FSET? PRSO,RMUNGBIT /?L6
	CALL PERFORM,V?PRY,PRSO,HANDS
	RTRUE
?L6:	EQUAL? PRSA,V?RAISE,V?MOVE,V?PRY /?L8
	EQUAL? PRSA,V?OPEN \?L7
?L8:	FSET? BRONZE-PLUG,RMUNGBIT \?L9
	PRINT YOUVE-ALREADY
	PRINTR "removed it."
?L9:	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
	FSET BRONZE-PLUG,RMUNGBIT
	MOVE SECRET-HOLE,HERE
	PRINTI "You pry the plug out of its socket, revealing a cylindrical hole about the same diameter but somewhat deeper. "
	FSET? NOTE,TOUCHBIT /?L12
	PRINT STR?192
	PRINTR "piece of paper in the hole."
?L12:	FIRST? SECRET-HOLE >STACK \?L14
	CALL DESCRIBE-SENT,SECRET-HOLE
	CRLF
	RTRUE
?L14:	PRINTR "The hole is empty."
?L7:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,BRONZE-PLUG \FALSE
	EQUAL? PRSI,SECRET-HOLE \FALSE
	FCLEAR BRONZE-PLUG,RMUNGBIT
	REMOVE SECRET-HOLE
	MOVE BRONZE-PLUG,HERE
	PRINTR "You insert the plug in the hole."

	.FUNCT NOTE-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	CALL HELD?,NOTE >STACK
	ZERO? STACK \?L3
	MOVE NOTE,WINNER
	CALL TAKING-FIRST,NOTE
?L3:	FSET NOTE,RMUNGBIT
	PRINTI "You unroll the piece of paper and read the shaky handwriting:

""I can no longer face what I've been doing. I can't sleep, I start at the slightest noise, and even dulling my senses with alcohol or drugs is no longer enough. I refuse to participate in what he is doing any more. Either he is insane, or I am insane, or (and this is what I fear most) the universe itself is insane. I have only one final warning: I am the only suicide, but I will not be the final death.""

The name signed to it is "
	FSET? SIGNUP,RMUNGBIT /?L8
	ZERO? REMEMBERED-STUDENT? /?L6
?L8:	PRINTR "that of the Alchemy Department graduate student."
?L6:	CALL QUEUE,I-REMEMBER-STUDENT,5
	PRINTR "oddly familiar."

	.FUNCT HACKER-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	EQUAL? HERE,TERMINAL-ROOM \?L4
	PRINTI "Sitting at a terminal is a hacker whom you recognize."
	RETURN M-FATAL
?L4:	PRINTI "A muddy, scratched-up hacker stands tiredly here."
	RETURN M-FATAL

	.FUNCT HACKER-F,RARG=0,H
	EQUAL? RARG,M-CONTAINER \?L1
	EQUAL? PRSA,V?TAKE,V?MOVE \FALSE
	GRTR? LAIR-CNT,6 \?L5
	PRINTR "You don't want to get that close to him."
?L5:	PRINTR """Hey! No snarfage, loser!"" You determine that this means, ""Stop!"""
?L1:	EQUAL? WINNER,HACKER \?L9
	GRTR? LAIR-CNT,6 \?L10
	PRINTR "The hacker replies, ""Meld!"""
?L10:	EQUAL? PRSA,V?HELP \?L12
	EQUAL? HERE,TERMINAL-ROOM \?L13
	PRINTR """Be patient!"""
?L13:	FSET? SMOOTH-STONE,TOUCHBIT \?L15
	CALL PERFORM,V?TELL-ME-ABOUT,PROGRAM
	RTRUE
?L15:	PRINTR """Help? I'm not a T.A. I've got work to do."""
?L12:	EQUAL? PRSA,V?WHO \?L17
	EQUAL? PRSO,LOVECRAFT \?L17
	CALL NEW-VERB,V?WHAT
	RTRUE
?L17:	EQUAL? PRSA,V?TELL-ME-ABOUT,V?WHAT \?L18
	EQUAL? PRSO,HACKER \?L19
	PRINTR "He's reluctant to boast."
?L19:	EQUAL? PRSO,KEYRING,KEY-1,KEY-2 /?L22
	EQUAL? PRSO,KEY-3,KEY-4 \?L21
?L22:	GETPT MASTER-KEY,P?VALUE >STACK
	ZERO? STACK /?L23
	FSET MASTER-KEY,TOUCHBIT
	MOVE MASTER-KEY,KEYRING
?L23:	PRINTR """I've accumulated a few keys over the years. I'm a licensed locksmith, which helps. I can get into any room at Tech."" He pulls the keyring out on its chain, and shows off a key you hadn't noticed before. ""This is a master key,"" he says."
?L21:	EQUAL? PRSO,CHINESE-FOOD,SNACK \?L26
	PRINTR """Yeah! I'd love some yummy Chinese food. Szechuan style. Ummm!"""
?L26:	EQUAL? PRSO,MASTER-KEY \?L27
	IN? MASTER-KEY,GLOBAL-OBJECTS \?L28
	PRINT STR?311
	RTRUE
?L28:	CALL THIS-IS-IT,MASTER-KEY
	PRINTR """That's one of my best keys. It's a Tech master key. Not that it really opens every door at Tech, but I'd say three out of five, at least. Naturally, some labs are off-limits even to this key."""
?L27:	EQUAL? PRSO,STUDENTS \?L31
	PRINTR """Missing students? I knew one of them slightly. Not the sort who would go away, you know? He was sort of hackeresque, not dumb for an undergrad, either. Not the type to disappear."""
?L31:	EQUAL? PRSO,PROGRAM,PC,MENU-BOX /?L33
	EQUAL? PRSO,YAK-WINDOW,HELP-KEY \?L32
?L33:	ZERO? HACKER-HELP \?L34
	PRINTR """You should consult the documentation."" He's preoccupied with his own debugging."
?L34:	CALL QUEUED?,I-HACKER-HELPS >STACK
	ZERO? STACK /?L36
	PRINTR """I'm looking at it. Be patient. This isn't some little micro. We're on a hairy OS on a hairy net."""
?L36:	PRINTR """I already looked at it. The bug is fixed in the sources. Your paper is gone, unless those Alchemy chompers have a copy."""
?L32:	EQUAL? PRSO,LOVECRAFT \?L38
	PRINTR """Wasn't he a fantasy author?"""
?L38:	EQUAL? PRSO,SMOOTH-STONE \?L39
	PRINTR """I've never seen one like that. Pretty tasteful, I'd say."""
?L39:	EQUAL? PRSO,GLOBAL-URCHINS \?L40
	PRINTR """There are always urchins around. I remember one or two who became hackers."""
?L40:	EQUAL? PRSO,REPEATER,INPUT-CABLE,INPUT-SOCKET \?L41
	PRINTR """I'll fix it!"""
?L41:	PRINTR "The hacker studiously ignores you, loath to admit there is something he doesn't know about."
?L18:	EQUAL? PRSA,V?FOLLOW \?L43
	EQUAL? HERE,INNER-LAIR \?L44
	PRINTR """I'm here, aren't I?"""
?L44:	PRINTR """I haven't got time. I have new versions of the system, the assembler, the editor, and the debugger to finish hacking."""
?L43:	EQUAL? PRSA,V?GIVE \?L47
	EQUAL? PRSI,ME \?L47
	IN? CARTON,HACKER /?L48
	CALL QUEUE,I-FOOD-HINT,2
?L48:	EQUAL? PRSO,HELP-KEY \?L51
	CALL PERFORM,V?HELP
	RTRUE
?L51:	EQUAL? PRSO,KEYRING \?L53
	PRINTI """Well, I can't give you "
	IN? CARTON,HACKER \?L54
	PRINTI "all "
?L54:	PRINTR "my keys, I need them."" He fondles his keyring proudly."
?L53:	EQUAL? PRSO,MASTER-KEY \?L57
	IN? MASTER-KEY,GLOBAL-OBJECTS \?L58
	PRINT STR?311
	RTRUE
?L58:	IN? CARTON,HACKER \?L60
	CALL HACKER-LOANS-KEY >STACK
	RSTACK
?L60:	PRINTR """Fat chance! This is a master key! What have you done for me lately?"""
?L57:	EQUAL? PRSO,KEY-1,KEY-2,KEY-3 /?L63
	EQUAL? PRSO,KEY-4 \?L62
?L63:	PRINTR """Those are boring old keys. They don't open anything interesting."""
?L62:	PRINTR """I don't have that."""
?L47:	EQUAL? PRSA,V?TRADE \?L65
	EQUAL? PRSO,CHINESE-FOOD,CARTON,MASTER-KEY \?L66
	EQUAL? PRSO,CHINESE-FOOD,CARTON,MASTER-KEY \?L66
	SET 'HACKER-TRADE?,1
	PRINTI """You give me the food first."""
	CRLF
	CALL PRINT-ID,STR?312 >STACK
	RSTACK
?L66:	PRINTR """That's not a good trade."""
?L65:	EQUAL? PRSA,V?HELLO \?L69
	PRINTI """Greetingage."""
	EQUAL? HERE,TERMINAL-ROOM \?L70
	PRINTI " He turns back to his hacking."
?L70:	CRLF
	RTRUE
?L69:	PRINTR """Mumble. Frotz."""
?L9:	EQUAL? PRSA,V?EXAMINE \?L74
	EQUAL? HERE,INNER-LAIR \?L75
	GRTR? LAIR-CNT,6 \?L77
	PRINTR "He looks vacant-eyed and dangerous."
?L77:	PRINTR "He's muddy, wet, and tired looking."
?L75:	PRINTI "The hacker "
	ZERO? HACKER-HELP /?L81
	CALL QUEUED?,I-HACKER-HELPS >STACK
	ZERO? STACK /?L81
	PRINTI "is "
	EQUAL? HACKER-HELP,1 \?L83
	PRINTI "star"
	JUMP ?L85
?L83:	PRINTI "sitt"
?L85:	PRINTI "ing at your terminal"
	GRTR? HACKER-HELP,1 \?L86
	PRINTI ", typing furiously"
?L86:	PRINTI ". Every so often, he pauses briefly and twirls a lock of his hair. He is also humming under his breath."
	JUMP ?L89
?L81:	PRINTI "sits comfortably on an office chair facing a terminal table, or perhaps it's just a pile of old listings as tall as a terminal table. He is typing madly, using just two fingers, but achieves speeds that typists using all ten fingers only dream of. He is apparently debugging a large assembly language program, as the screen of his terminal looks like a spray of completely random characters."
?L89:	PRINTR " The hacker is dressed in blue jeans, an old work shirt, and what might once have been running shoes. Hanging from his belt is an enormous ring of keys. He is in need of a bath."
?L74:	EQUAL? PRSA,V?THANK \?L90
	GRTR? LAIR-CNT,6 \?L91
	PRINTR "It doesn't impress him."
?L91:	CALL HELD?,MASTER-KEY >STACK
	ZERO? STACK \?L94
	ZERO? HACKER-HELP /FALSE
?L94:	PRINTR "He blushes."
?L90:	EQUAL? PRSA,V?LISTEN \?L96
	GRTR? LAIR-CNT,6 \?L97
	PRINTR "He sounds like an insincere Moonie."
?L97:	PRINTR "He is humming something. It sounds classical, perhaps Bach?"
?L96:	EQUAL? PRSA,V?SMELL \?L100
	PRINTR "Either the hacker, his clothing, or both are in need of cleaning."
?L100:	EQUAL? PRSA,V?TELL-ABOUT \?L101
	EQUAL? PRSO,HACKER \?L101
	GRTR? LAIR-CNT,6 \?L102
	PRINTR "He doesn't appear to be listening."
?L102:	EQUAL? PRSI,PROGRAM,PC \?L104
	ZERO? HACKER-HELP /?L105
	PRINTR "He listens, more or less. The impression he gives is that non-hackers don't know anything about the bugs they cause."
?L105:	PRINTR "The hacker isn't too interested, and doesn't bother to get up and investigate more closely. He mumbles something about sending him a bug message, and returns to his work."
?L104:	IN? PRSI,PLAYER \?L108
	CALL PERFORM,V?SHOW,PRSI,HACKER
	RTRUE
?L108:	PRINTR "The hacker shows little interest in your remarks."
?L101:	EQUAL? PRSA,V?SHOW \?L110
	GRTR? LAIR-CNT,6 \?L111
	PRINT TOTALLY-UNRESPONSIVE
	RTRUE
?L111:	FSET? PRSO,FOODBIT \?L113
	PRINTR """Winnage! I could do with some of that."""
?L113:	EQUAL? PRSO,SMOOTH-STONE \?L114
	PRINTR """Odd-looking thing. Are you a rock-jock?"""
?L114:	EQUAL? PRSO,HAND \?L115
	PRINTR """Mondo grosso!"""
?L115:	EQUAL? PRSO,DEAD-RAT \?L116
	PRINTR """I have enough of those in my basement. Get rid of it!"""
?L116:	PRINTI "He more or less grunts at you, but shows little interest in "
	CALL THE-PRINT-PRSO
	PRINT PERIOD
	RTRUE
?L110:	EQUAL? PRSA,V?GIVE \?L118
	GRTR? LAIR-CNT,6 \?L119
	PRINT TOTALLY-UNRESPONSIVE
	RTRUE
?L119:	EQUAL? PRSO,CARTON,CHINESE-FOOD \?L121
	IN? CHINESE-FOOD,CARTON \?L121
	CALL DEQUEUE,I-FOOD-HINT
	GETP CHINESE-FOOD,P?COOK >H
	FSET? CHINESE-FOOD,RMUNGBIT \?L122
	REMOVE CARTON
	PRINTI """Ouch! This is ridiculous! You've overcooked it. Look at those poor shrimp! It's ruined, chomper!"" He throws it away."
	CRLF
	CALL PRINT-ID,STR?313 >STACK
	RSTACK
?L122:	LESS? H,12 /?L124
	MOVE CARTON,HACKER
	REMOVE CHINESE-FOOD
	PRINTI """Ah! Serious food!"" He plunges into the food with all the delicacy and table manners of a shark at a feeding frenzy. Soon a satisfied expression appears on his face. "
	CALL PRINT-ID,STR?314
	ZERO? HACKER-TRADE? /?L125
	CALL HACKER-LOANS-KEY >STACK
	RSTACK
?L125:	PRINTR """Now, what was it you were wanting?"" he asks."
?L124:	PRINTI """Yuck! This is"
	CALL PRINT-ID,STR?315
	ZERO? H \?L129
	PRINTI " cold"
	JUMP ?L131
?L129:	PRINTI "n't warm enough"
?L131:	PRINTR "!"" He thrusts it back into your hands."
?L121:	EQUAL? PRSO,SNACK \?L132
	FSET? SNACK,RMUNGBIT /?L132
	MOVE SNACK,HACKER
	PRINTI """Hey, thanks!"" He stuffs it down in no time."
	CALL AFTER-HACKER-EATS >STACK
	RSTACK
?L132:	EQUAL? PRSO,COKE \?L133
	PRINTI """I only drink Diet Coke,"" he complains."
	CALL AFTER-HACKER-EATS >STACK
	RSTACK
?L133:	PRINTR """No thanks, keep it for now."""
?L118:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /FALSE
	EQUAL? PRSA,V?THROW \?L136
	MOVE PRSO,HERE
	PRINTI "Thrown. "
?L136:	GRTR? LAIR-CNT,6 \?L139
	PRINTI "He is unharmed. ""It is peaceful within,"" he remarks."
	CRLF
	CALL KILL-VERB? >STACK
	CALL PRINT-ID,STR?316,STACK
	CALL KILL-VERB? >STACK
	ZERO? STACK \?L141
	PUSH 1
	JUMP ?L142
?L141:	PUSH 0
?L142:	CALL PRINT-ID,STR?317,STACK >STACK
	RSTACK
?L139:	PRINTI "The hacker retreats. ""I know karate!"" he says, somewhat unconvincingly."
	CRLF
	CALL KILL-VERB? >STACK
	CALL PRINT-ID,STR?318,STACK
	CALL KILL-VERB? >STACK
	ZERO? STACK \?L144
	PUSH 1
	JUMP ?L145
?L144:	PUSH 0
?L145:	CALL PRINT-ID,STR?319,STACK >STACK
	RSTACK

	.FUNCT AFTER-HACKER-EATS
	IN? CARTON,HACKER /?L1
	PRINTI " ""I could really do with some Chinese food, though."""
?L1:	CRLF
	RTRUE

	.FUNCT HACKER-LOANS-KEY
	SET 'HACKER-TRADE?,0
	MOVE MASTER-KEY,PLAYER
	CALL SCORE-OBJECT,MASTER-KEY
	PRINTI """Well, I suppose I could loan you "
	CALL THE-PRINT,MASTER-KEY
	PRINTR " for a while. Just don't get into trouble, okay? I'll find you later, when I'm done with all this, and get it back."" He hands you the key."

	.FUNCT I-FOOD-HINT
	ZERO? FOOD-COUNT /FALSE
	LOC HACKER >STACK
	EQUAL? HERE,STACK \FALSE
	INC 'FOOD-COUNT
	GET FOOD-HINTS,0 >STACK
	GRTR? FOOD-COUNT,STACK \?L5
	SET 'FOOD-COUNT,0
	RFALSE
?L5:	CALL QUEUE,I-FOOD-HINT,2
	CRLF
	PRINTI "The hacker turns to you and says, """
	GET FOOD-HINTS,FOOD-COUNT >STACK
	PRINT STACK
	PRINTR """"

	.FUNCT KEYRING-F
	FSET KEYRING,SEARCHBIT
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "Hanging from the hacker's belt is a watchman's keyring. The large and almost full ring is connected by an extensible chain to a reel attached to the hacker's belt. It is difficult to lose such a keyring. "
	CALL AMONG-THE-KEYS >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?TAKE \?L3
	PRINT HACKER-PREVENTS
	PRINTI "Chomp!"" he says."
	CRLF
	CALL PRINT-ID,STR?320 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	CALL AMONG-THE-KEYS >STACK
	RSTACK

	.FUNCT AMONG-THE-KEYS
	PRINTI "There are multitudinous keys hanging on the keyring. Among them are "
	CALL DESCRIBE-REST,KEYRING
	PRINT PERIOD
	RTRUE

	.FUNCT GENERIC-KEY-F
	CALL ACCESSIBLE?,KEYRING >STACK
	ZERO? STACK /FALSE
	RETURN KEYRING

	.FUNCT MASTER-KEY-F
	EQUAL? PRSA,V?EXAMINE \?L1
	IN? MASTER-KEY,GLOBAL-OBJECTS /?L1
	PRINTR "The key appears to be a master key. There is no indication of what locks it might fit, however."
?L1:	EQUAL? PRSA,V?TAKE \FALSE
	IN? MASTER-KEY,GLOBAL-OBJECTS \FALSE
	PRINTR "You haven't seen any master key."

	.FUNCT CARTON-F
	GET P-NAMW,0 >STACK
	EQUAL? W?SYMBOL,STACK /?L3
	GET P-NAMW,1 >STACK
	EQUAL? W?SYMBOL,STACK \?L1
?L3:	CALL CARTON-SYMBOL-F >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L4
	PRINTR "This is a cardboard carton with an incomprehensible symbol scrawled on the top."
?L4:	EQUAL? PRSA,V?READ \?L5
	CALL CARTON-SYMBOL-F >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?SMELL \?L6
	IN? CHINESE-FOOD,CARTON \?L6
	CALL NEW-PRSO,CHINESE-FOOD
	RTRUE
?L6:	EQUAL? PRSA,V?RUB \?L7
	IN? CHINESE-FOOD,CARTON \?L7
	GETP CHINESE-FOOD,P?COOK >STACK
	GRTR? STACK,8 \?L7
	PRINTR "The carton feels warm."
?L7:	EQUAL? PRSA,V?EAT \FALSE
	PRINTI "You might find the contents more agreeable than the carton itself."
	CRLF
	CALL PRINT-ID,STR?321 >STACK
	RSTACK

	.FUNCT CARTON-SYMBOL-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINT STR?80
	PRINTI "Chinese, English, or any other language you know. "
	CALL TELL-SYMBOL,CARTON
	CRLF
	RTRUE

	.FUNCT HEAT,OBJ,H
	GETP OBJ,P?COOK >H
	LESS? H,20 /?L1
	RETURN STR?322
?L1:	LESS? H,16 /?L3
	RETURN STR?323
?L3:	LESS? H,12 /?L4
	RETURN STR?324
?L4:	LESS? H,8 /?L5
	RETURN STR?325
?L5:	LESS? H,4 /?L6
	RETURN STR?326
?L6:	RETURN STR?327

	.FUNCT CHINESE-FOOD-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This is a carton of "
	CALL HEAT,CHINESE-FOOD >STACK
	PRINT STACK
	PRINTR " Szechuan shrimp. Lovely red peppers poke out of the sauce."
?L1:	EQUAL? PRSA,V?TAKE \?L3
	ZERO? PRSI \?L3
	IN? PRSO,CARTON \FALSE
	PRINTI "If you take it out, it will spill all over you. Why not take the carton instead?"
	CRLF
	CALL PRINT-ID,STR?328 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?PUT \?L7
	EQUAL? PRSO,CHINESE-FOOD \?L7
	IN? CHINESE-FOOD,CARTON \?L7
	CALL NEW-PRSO,CARTON
	RTRUE
?L7:	EQUAL? PRSA,V?EAT,V?TASTE \FALSE
	PRINTI "It's very (chemically) hot, spicy, and "
	CALL HEAT,CHINESE-FOOD >STACK
	PRINT STACK
	PRINTI "."
	EQUAL? PRSA,V?EAT \?L9
	REMOVE CHINESE-FOOD
	PRINTI " You immediately want to drink something to wash it down."
?L9:	CRLF
	RTRUE

	.FUNCT COKE-F,SIZ,TIRE
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This is a"
	GETP COKE,P?SIZE >SIZ
	EQUAL? SIZ,1 \?L3
	PRINTI "n empty"
	JUMP ?L8
?L3:	EQUAL? SIZ,2 \?L5
	PRINTI " nearly empty"
	JUMP ?L8
?L5:	EQUAL? SIZ,3 \?L6
	PRINTI " partly full"
	JUMP ?L8
?L6:	EQUAL? SIZ,4 \?L7
	PRINTI " partly empty"
	JUMP ?L8
?L7:	EQUAL? SIZ,5 \?L8
	PRINTI " full"
?L8:	PRINTI " two-liter bottle of "
	GRTR? SIZ,1 \?L10
	CALL HEAT,COKE >STACK
	PRINT STACK
	PRINTI " "
?L10:	PRINTR "Classic Coke."
?L1:	EQUAL? PRSA,V?TASTE \?L13
	PRINTR "Tastes like the real thing."
?L13:	EQUAL? PRSA,V?DRINK \?L14
	GETP COKE,P?SIZE >SIZ
	GRTR? SIZ,1 \?L15
	DEC 'SIZ
	PUTP COKE,P?SIZE,SIZ
	CALL QUEUED?,I-TIRED >TIRE
	ZERO? TIRE /?L17
	GRTR? AWAKE,-1 \?L19
	DEC 'AWAKE
	INC 'FUMBLE-NUMBER
	ADD LOAD-ALLOWED,10 >LOAD-ALLOWED
?L19:	GET TIRE,C-TICK >STACK
	ADD STACK,200 >SIZ
	PUT TIRE,C-TICK,SIZ
?L17:	PRINTI "Delicious! Contains caffeine, one of the four basic food groups. Too bad they make it with fructose these days, instead of sucrose. You feel much more alert and awake now."
	CRLF
	CALL PRINT-ID,STR?329 >STACK
	RSTACK
?L15:	PRINTR "The bottle is empty."
?L14:	EQUAL? PRSA,V?OPEN,V?CLOSE \?L24
	PRINTR "You fiddle with the cap for a while. What fun! Much better than working on your paper."
?L24:	EQUAL? PRSA,V?LOOK-INSIDE \?L25
	PRINT IT-LOOKS-LIKE
	PRINTR "the inside of a Coke bottle."
?L25:	EQUAL? PRSA,V?SHAKE \?L26
	GETP COKE,P?SIZE >SIZ
	GRTR? SIZ,1 \?L26
	PRINTR "The Coke fizzes up."
?L26:	EQUAL? PRSA,V?POUR \FALSE
	EQUAL? PRSO,COKE \FALSE
	GETP COKE,P?SIZE >SIZ
	EQUAL? SIZ,1 \?L28
	PRINTR "There is none left in the bottle."
?L28:	PUTP COKE,P?SIZE,1
	PRINTI "You pour the Coke on "
	ZERO? PRSI /?L31
	CALL THE-PRINT-PRSI
	JUMP ?L33
?L31:	PRINTI "the ground"
?L33:	PRINTR ", wasting it."

	.FUNCT SNACK-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This is a"
	FSET? SNACK,RMUNGBIT \?L3
	PRINTI "n empty"
	JUMP ?L6
?L3:	FSET? SNACK,OPENBIT \?L6
	PRINTI "n open"
	GETP SNACK,P?COOK >STACK
	ZERO? STACK /?L6
	PRINTI ", "
	CALL HEAT,SNACK >STACK
	PRINT STACK
?L6:	PRINTI " "
	PRINTD SNACK
	PRINTR ", a snack food made with peanut butter and chocolate cake."
?L1:	EQUAL? PRSA,V?OPEN \?L10
	FSET? SNACK,OPENBIT /FALSE
	FSET SNACK,OPENBIT
	PRINTR "You open the package, revealing yummy junk food inside."
?L10:	EQUAL? PRSA,V?EAT \FALSE
	FSET? SNACK,RMUNGBIT \?L15
	PRINTI "You already did. "
	PRINT STR?181
	PRINTR "left but the wrapper."
?L15:	PRINTI "You "
	FSET? SNACK,OPENBIT /?L18
	FSET SNACK,OPENBIT
	PRINTI "tear open the package and "
?L18:	GETP SNACK,P?COOK >STACK
	GRTR? STACK,12 \?L21
	PRINTR "discover that they are too hot to eat."
?L21:	FSET SNACK,RMUNGBIT
	PRINTI "devour the delicious food-like substance."
	CRLF
	CALL PRINT-ID,STR?330 >STACK
	RSTACK

	.FUNCT MICROWAVE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The microwave oven hangs over the kitchen counter. It has more complicated controls than your pc. There is an LED readout above the controls. The microwave is "
	CALL QUEUED?,I-MICROWAVE >STACK
	ZERO? STACK /?L3
	PRINTR "on."
?L3:	PRINTI "off and it's "
	CALL OPEN-CLOSED,MICROWAVE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LAMP-ON \?L6
	PUT P-ADJW,0,W?START
	CALL PERFORM,V?PUSH,CONTROLS
	RTRUE
?L6:	EQUAL? PRSA,V?LAMP-OFF \?L7
	PUT P-ADJW,0,W?STOP
	CALL PERFORM,V?PUSH,CONTROLS
	RTRUE
?L7:	EQUAL? PRSA,V?UNPLUG \?L8
	CALL CANT-GET-TO-PLUG >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?OPEN \?L9
	FSET? MICROWAVE,OPENBIT /FALSE
	FSET MICROWAVE,OPENBIT
	CALL CTHE-PRINT,MICROWAVE
	CALL QUEUED?,I-MICROWAVE >STACK
	ZERO? STACK /?L12
	CALL DEQUEUE,I-MICROWAVE
	PRINTI " shuts off, and"
?L12:	PRINTR " is now open."
?L9:	EQUAL? PRSA,V?CLOSE \FALSE
	CALL CLOSE-A-DOOR >STACK
	RSTACK

	.FUNCT READOUT-F,SEC
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINTI "The display is currently displaying "
	ZERO? MICROWAVE-TIMER \?L3
	PRINTI "the current time"
	JUMP ?L5
?L3:	DIV MICROWAVE-TIMER,60 >STACK
	PRINTN STACK
	PRINTI ":"
	MOD MICROWAVE-TIMER,60 >SEC
	LESS? SEC,10 \?L6
	PRINTI "0"
?L6:	PRINTN SEC
?L5:	PRINTI " and the word """
	GET MICROWAVE-TEMPS,MICROWAVE-TEMP >STACK
	PRINT STACK
	PRINTR "."""

	.FUNCT CONTROLS-F,ADJ,N
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	PRINTI "There are controls labelled 0 to 9, WM, LO, MED, HI, START, CLEAR, and STOP. "
	CALL TELL-TIMER >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?TURN \?L3
	EQUAL? PRSI,INTNUM \?L3
	CALL CLEAR-MICROWAVE-TBL
	SET 'MICROWAVE-TIMER,P-NUMBER
	GRTR? MICROWAVE-TIMER,3600 \?L4
	PRINT YOU-CANT
	PRINTR "set it for that long a time."
?L4:	CALL TELL-TIMER >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?RUB,V?PUSH,V?TYPE /?L8
	EQUAL? PRSA,V?ENTER \FALSE
?L8:	GET P-ADJW,0 >ADJ
	ZERO? ADJ /TRUE
	EQUAL? ADJ,W?INTNUM \?L11
	GRTR? P-NUMBER,9 \?L12
	ZERO? P-TIME? /?L14
	PRINTR "Why don't you try setting the timer to that?"
?L14:	PRINT STR?178
	PRINTI """"
	PRINTN P-NUMBER
	PRINTR """ on the control panel!"
?L12:	GET MICROWAVE-TBL,2 >STACK
	PUT MICROWAVE-TBL,3,STACK
	GET MICROWAVE-TBL,1 >STACK
	PUT MICROWAVE-TBL,2,STACK
	GET MICROWAVE-TBL,0 >STACK
	PUT MICROWAVE-TBL,1,STACK
	PUT MICROWAVE-TBL,0,P-NUMBER
	GET MICROWAVE-TBL,3 >STACK
	MUL STACK,600 >STACK
	GET MICROWAVE-TBL,2 >STACK
	MUL STACK,60 >STACK
	GET MICROWAVE-TBL,1 >STACK
	MUL STACK,10 >STACK
	GET MICROWAVE-TBL,0 >STACK
	ADD STACK,STACK >STACK
	ADD STACK,STACK >STACK
	ADD STACK,STACK >MICROWAVE-TIMER
	CALL TELL-TIMER >STACK
	RSTACK
?L11:	EQUAL? ADJ,W?START \?L18
	CALL QUEUED?,I-MICROWAVE >STACK
	ZERO? STACK /?L19
	PRINTR "It's already started."
?L19:	FSET? MICROWAVE,OPENBIT /?L22
	ZERO? MICROWAVE-TIMER \?L21
?L22:	PRINTI "Nothing happens, as there's "
	ZERO? MICROWAVE-TIMER /?L49
	PRINTR "a safety interlock engaged when the door is open."
?L49:	PRINTR "no time set on it yet."
?L21:	ZERO? MICROWAVE-TEMP \?L28
	SET 'MICROWAVE-TEMP,4
?L28:	CALL CLEAR-MICROWAVE-TBL
	CALL QUEUE,I-MICROWAVE,-1
	PRINTR "The microwave starts up. The timer begins counting down."
?L18:	EQUAL? ADJ,W?STOP \?L31
	CALL QUEUED?,I-MICROWAVE >STACK
	ZERO? STACK /?L32
	CALL CLEAR-MICROWAVE-TBL
	CALL DEQUEUE,I-MICROWAVE
	PRINT MICROWAVE-STOPS
	CALL TELL-HEAT,0 >STACK
	RSTACK
?L32:	CALL ITS-ALREADY-X,STR?191 >STACK
	RSTACK
?L31:	EQUAL? ADJ,W?CLEAR \?L35
	CALL QUEUED?,I-MICROWAVE >STACK
	ZERO? STACK /?L36
	PRINT NOTHING-HAPPENS
	RTRUE
?L36:	CALL CLEAR-MICROWAVE-TBL
	SET 'MICROWAVE-TIMER,0
	PRINTR "The timer clears to zero."
?L35:	EQUAL? ADJ,W?WM,W?LO,W?MED /?L40
	EQUAL? ADJ,W?HIGH,W?HI \?L39
?L40:	CALL QUEUED?,I-MICROWAVE >STACK
	ZERO? STACK /?L41
	PRINT NOTHING-HAPPENS
	RTRUE
?L41:	EQUAL? ADJ,W?WM \?L43
	CALL TELL-HEAT,1 >STACK
	RSTACK
?L43:	EQUAL? ADJ,W?LO \?L44
	CALL TELL-HEAT,2 >STACK
	RSTACK
?L44:	EQUAL? ADJ,W?MED \?L45
	CALL TELL-HEAT,3 >STACK
	RSTACK
?L45:	CALL TELL-HEAT,4 >STACK
	RSTACK
?L39:	PRINTR "Which button?"

	.FUNCT CLEAR-MICROWAVE-TBL
	PUT MICROWAVE-TBL,0,0
	PUT MICROWAVE-TBL,1,0
	PUT MICROWAVE-TBL,2,0
	PUT MICROWAVE-TBL,3,0
	RTRUE

	.FUNCT I-COOL,CNT=0,L,OBJ,H,Q?=0,MICROWAVE-RUNNING?
	GET HEAT-TABLE,0 >L
	CALL QUEUED?,I-MICROWAVE >MICROWAVE-RUNNING?
?L1:	IGRTR? 'CNT,L \?L3
	ZERO? Q? /TRUE
	CALL QUEUE,I-COOL,2
	RTRUE
?L3:	GET HEAT-TABLE,CNT >OBJ
	INC 'CNT
	GET HEAT-TABLE,CNT >STACK
	ZERO? STACK \?L9
	SET 'Q?,1
	PUT HEAT-TABLE,CNT,MOVES
?L9:	IN? OBJ,MICROWAVE \?L12
	ZERO? MICROWAVE-RUNNING? /?L12
	SET 'Q?,1
	JUMP ?L1
?L12:	GETP OBJ,P?COOK >H
	ZERO? H /?L1
	GET HEAT-TABLE,CNT >STACK
	SUB MOVES,STACK >STACK
	GRTR? STACK,3 \?L15
	PUT HEAT-TABLE,CNT,MOVES
	DEC 'H
	PUTP OBJ,P?COOK,H
?L15:	ZERO? H /?L1
	SET 'Q?,1
	JUMP ?L1

	.FUNCT HEAT-CONTENTS,WHAT,TIM,H,M
	FIRST? WHAT >M \TRUE
?L1:	GETPT M,P?COOK >STACK
	ZERO? STACK /?L4
	CALL QUEUE,I-COOL,2,1
	GETP M,P?COOK >STACK
	ADD STACK,MICROWAVE-TEMP >H
	LESS? TIM,0 \?L6
	DIV 60,MICROWAVE-TEMP >STACK
	DIV TIM,STACK >STACK
	ADD H,STACK >H
?L6:	PUTP M,P?COOK,H
	EQUAL? M,HAND \?L9
	FSET? M,PERSON \?L9
	SET 'ANIMATION-COUNT,0
	FCLEAR M,PERSON
	EQUAL? HERE,KITCHEN \?L16
	CRLF
	PRINTI "The hand scrabbles frantically around inside "
	LOC HAND >STACK
	CALL THE-PRINT,STACK
	PRINTI ", and then at last lies still."
	CRLF
	CALL PRINT-ID,STR?331
	JUMP ?L16
?L9:	EQUAL? M,CHINESE-FOOD \?L16
	GRTR? H,20 \?L16
	FSET M,RMUNGBIT
	JUMP ?L16
?L4:	CALL HEAT-CONTENTS,M,TIM
?L16:	NEXT? M >M /?L1
	RTRUE

	.FUNCT I-MICROWAVE
	SUB MICROWAVE-TIMER,60 >MICROWAVE-TIMER
	CALL HEAT-CONTENTS,MICROWAVE,MICROWAVE-TIMER
	GRTR? MICROWAVE-TIMER,0 /?L1
	SET 'MICROWAVE-TIMER,0
	CALL DEQUEUE,I-MICROWAVE
?L1:	EQUAL? HERE,KITCHEN \FALSE
	CRLF
	ZERO? MICROWAVE-TIMER \?L6
	PRINT MICROWAVE-STOPS
?L6:	CALL TELL-TIMER >STACK
	RSTACK

	.FUNCT TELL-TIMER
	PRINTI "The timer display now reads "
	DIV MICROWAVE-TIMER,60 >STACK
	PRINTN STACK
	PRINTI ":"
	MOD MICROWAVE-TIMER,60 >STACK
	LESS? STACK,10 \?L1
	PRINTI "0"
?L1:	MOD MICROWAVE-TIMER,60 >STACK
	PRINTN STACK
	PRINT PERIOD
	RTRUE

	.FUNCT TELL-HEAT,N
	SET 'MICROWAVE-TEMP,N
	PRINTI "The bottom of the display now reads """
	GET MICROWAVE-TEMPS,N >STACK
	PRINT STACK
	PRINTR "."""

	.FUNCT REFRIGERATOR-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?SIGN \?L3
	PRINTR """Everything in this fridge must have a name and date on it!"" (The sign has neither.)"
?L3:	PRINTI "This is a medium-sized refrigerator whose door is "
	FSET? PRSO,OPENBIT \?L6
	PRINTI "open"
	JUMP ?L8
?L6:	PRINTI "closed"
?L8:	PRINTR ". There is a sign on the front."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L9
	FSET? REFRIGERATOR,OPENBIT \?L10
	PRINTI "The interior of the refrigerator is appalling. There are soggy lunch bags, ancient sandwiches and other less identifiable items"
	FIRST? REFRIGERATOR >STACK \?L12
	PRINTI ". More appetizingly, you see "
	CALL DESCRIBE-REST,REFRIGERATOR
?L12:	PRINT PERIOD
	RTRUE
?L10:	PRINT YOU-HAVE-TO
	PRINTR "open it to look in it."
?L9:	EQUAL? PRSA,V?UNPLUG \FALSE
	CALL CANT-GET-TO-PLUG >STACK
	RSTACK

	.FUNCT CANT-GET-TO-PLUG
	PRINT YOU-CANT
	PRINTR "get to the plug."

	.FUNCT ASSIGNMENT-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINTR "Laser printed on creamy bond paper, the assignment is due tomorrow. It's from your freshman course in ""The Classics in the Modern Idiom,"" better known as ""21.014."" It reads, in part: ""Twenty pages on modern analogues of Xenophon's 'Anabasis.'"" You're not sure whether this refers to the movie ""The Warriors"" or ""Alien,"" but this is the last assignment you need to complete in this course this term. You wonder, yet again, why a technical school requires you to endure this sort of stuff."

	.FUNCT CHAIR-F,RARG=0
	EQUAL? RARG,M-BEG \?L1
	CALL QUEUED?,I-COMPULSION >STACK
	ZERO? STACK \FALSE
	EQUAL? PRSA,V?WALK \?L5
	LOC CHAIR >STACK
	MOVE WINNER,STACK
	PRINTR "First, you arise from the chair."
?L5:	EQUAL? PRSA,V?SIT \?L6
	EQUAL? PRSO,CHAIR \?L6
	PRINT YOU-ARE
	PRINT PERIOD
	RTRUE
?L6:	EQUAL? PRSA,V?STAND,V?DISEMBARK \FALSE
	EQUAL? PRSO,CHAIR \FALSE
	LOC CHAIR >STACK
	MOVE WINNER,STACK
	PRINTR "You get out of the chair."
?L1:	ZERO? RARG \FALSE
	EQUAL? PRSA,V?EXAMINE \?L10
	PRINTR "It's a molded plastic chair, a cheap knock-off of a designer chair, and even more uncomfortable."
?L10:	EQUAL? PRSA,V?TAKE \?L12
	IN? HACKER,CHAIR \?L12
	PRINTI "It's in use."
	CRLF
	CALL PRINT-ID,STR?332 >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?SIT,V?BOARD \FALSE
	IN? HACKER,CHAIR \?L14
	PRINTI "The hacker is already using it."
	CRLF
	CALL PRINT-ID,STR?333
	RTRUE
?L14:	CALL HELD?,CHAIR >STACK
	ZERO? STACK /?L17
	LOC WINNER >STACK
	MOVE CHAIR,STACK
?L17:	MOVE WINNER,CHAIR
	PRINT YOU-ARE-NOW
	PRINTR "sitting in the chair."

	.FUNCT HELP-KEY-F
	CALL MOUSE-VERB? >STACK
	ZERO? STACK /FALSE
	FSET? PC,POWERBIT /?L3
	PRINTI "Well,"
	PRINT LC-NOTHING-HAPPENS
	PRINTR " Perhaps you should turn on the computer?"
?L3:	PRINTI "You push the friendly-looking HELP key. A spritely little box appears on the screen, which reads: """
	ZERO? LOGGED-IN? \?L6
	PRINTI "You should "
	ZERO? USERNAME? \?L8
	PRINTI """LOGIN your-user-id"" and then "
?L8:	PRINTI """PASSWORD your-password""."
	JUMP ?L17
?L6:	IN? MORE-BOX,PC \?L11
	PRINTI "Please"
	ZERO? READ-PAGE? \?L12
	PRINTI " read the page on the screen and then"
?L12:	PRINTI " click the MORE box."
	JUMP ?L17
?L11:	IN? YAK-WINDOW,PC \?L15
	PRINTI "Please click the box representing the file you wish to edit or view. I notice that one file is marked as urgent, so you should probably click its box."
	JUMP ?L17
?L15:	IN? MENU-BOX,PC \?L16
	PRINTI "You should click the menu box, as you previously set it up as an urgent task."
	JUMP ?L17
?L16:	PRINTI "I can't help you at this point."
?L17:	PRINTR """"

	.FUNCT MOUSE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's a plastic pointing device."
?L1:	EQUAL? PRSA,V?TAKE \?L3
	PRINTI "It's attached to the computer."
	CRLF
	CALL PRINT-ID,STR?334 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?MOVE \?L4
	PRINTR "It rolls smoothly."
?L4:	CALL MOUSE-VERB? >STACK
	ZERO? STACK /?L5
	EQUAL? PRSO,MOUSE \?L5
	ZERO? PRSI /?L6
	CALL PERFORM,V?CLICK,PRSI
	RTRUE
?L6:	PRINT YOU-HAVE-TO
	PRINTR "click something with the mouse."
?L5:	CALL MOUSE-VERB? >STACK
	ZERO? STACK /FALSE
	EQUAL? PRSI,MOUSE \FALSE
	CALL PERFORM,V?CLICK,PRSO
	RTRUE

	.FUNCT PC-F,TMP
	EQUAL? PRSA,V?EXAMINE \?L1
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?SCREEN \?L3
	CALL NEW-VERB,V?READ
	RTRUE
?L3:	PRINTI "This is a beyond-state-of-the-art personal computer. It has a 1024 by 1024 pixel color monitor, a mouse, an attached hard disk, and a local area network connection. Fortunately, one of its features is a prominent HELP key."
	FSET? PC,POWERBIT /?L6
	PRINT STR?206
	PRINTR "turned off."
?L6:	FIRST? PC >STACK \?L8
	PRINTI " On the screen you see "
	FIRST? PC >STACK /?L9
?L9:	CALL PRINTA,STACK
	PRINTI "."
?L8:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?LISTEN \?L11
	FSET? PC,POWERBIT \?L11
	PRINTR "It hums contentedly."
?L11:	EQUAL? PRSA,V?TAKE \?L12
	CALL QUEUED?,I-HACKER-HELPS >STACK
	ZERO? STACK /?L13
	CALL NEW-VERB,V?UNPLUG
	RTRUE
?L13:	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
	PRINTI "You take it"
	CALL PRINT-ID,STR?335
	ZERO? PC-UNPLUGGED? \?L16
	PRINTI ", "
	FSET? PC,POWERBIT \?L18
	CALL INIT-PC
	PRINTI "turning it off and "
?L18:	SET 'PC-UNPLUGGED?,1
	PRINTI "unplugging it first"
?L16:	PRINT PERIOD
	RTRUE
?L12:	EQUAL? PRSA,V?PUT,V?PUT-ON \?L23
	EQUAL? PRSI,PC \?L23
	CALL NO-GOOD-SURFACE >STACK
	RSTACK
?L23:	EQUAL? PRSA,V?READ \?L24
	CALL QUEUED?,I-HACKER-HELPS >STACK
	ZERO? STACK /?L25
	LESS? HACKER-HELP,3 \?L25
	PRINT STR?181
	PRINTR "recognizable on the screen."
?L25:	IN? ODD-PAPER,PC \?L28
	SET 'TMP,ODD-PAPER
	JUMP ?L29
?L28:	IN? MENU-BOX,PC \?L30
	SET 'TMP,MENU-BOX
	JUMP ?L29
?L30:	IN? MORE-BOX,PC \?L31
	SET 'TMP,MORE-BOX
	JUMP ?L29
?L31:	IN? YAK-WINDOW,PC \?L32
	SET 'TMP,YAK-WINDOW
	JUMP ?L29
?L32:	SET 'TMP,0
?L29:	ZERO? TMP /?L34
	CALL NEW-PRSO,TMP
	RTRUE
?L34:	PRINT STR?181
	PRINTR "to read on the screen now."
?L24:	EQUAL? PRSA,V?LAMP-ON \?L37
	ZERO? PC-UNPLUGGED? /?L38
	PRINTR "It's unplugged. You should plug it in first."
?L38:	FSET? PC,POWERBIT /?L40
	FSET PC,POWERBIT
	PRINT COMPUTER-POWERS
	PRINTI "up, goes through a remarkably fast self-check, and greets you, requesting "
	PRINT LOGIN-PLEASE
	PRINTR " The only sound you hear is a very low hum."
?L40:	PRINTR "It's on. Maybe you didn't notice."
?L37:	EQUAL? PRSA,V?PLUG-IN \?L42
	ZERO? PC-UNPLUGGED? /?L43
	SET 'PC-UNPLUGGED?,0
	PRINTR "You plug in the computer."
?L43:	PRINT IT-ALREADY-IS
	RTRUE
?L42:	EQUAL? PRSA,V?UNPLUG \?L46
	ZERO? PC-UNPLUGGED? /?L47
	PRINT IT-ALREADY-IS
	RTRUE
?L47:	CALL QUEUED?,I-HACKER-HELPS >STACK
	ZERO? STACK /?L49
	PRINT STR?336
	CALL PRINT-ID,STR?337 >STACK
	RSTACK
?L49:	CALL INIT-PC
	SET 'PC-UNPLUGGED?,1
	PRINTR "Okay, it's unplugged now."
?L46:	EQUAL? PRSA,V?LAMP-OFF \?L51
	CALL QUEUED?,I-HACKER-HELPS >STACK
	ZERO? STACK /?L52
	PRINT STR?336
	CALL PRINT-ID,STR?338 >STACK
	RSTACK
?L52:	FSET? PC,POWERBIT \?L54
	CALL INIT-PC
	CALL COMPUTER-POWERS-OFF >STACK
	RSTACK
?L54:	CALL ITS-ALREADY-X,STR?191 >STACK
	RSTACK
?L51:	EQUAL? PRSA,V?READ \?L56
	IN? ODD-PAPER,PC \FALSE
	CALL NEW-PRSO,ODD-PAPER
	RTRUE
?L56:	EQUAL? PRSA,V?SIT-AT \FALSE
	IN? CHAIR,HERE \FALSE
	CALL PERFORM,V?SIT,CHAIR
	RTRUE

	.FUNCT COMPUTER-POWERS-OFF
	FCLEAR PRSO,POWERBIT
	PRINT COMPUTER-POWERS
	PRINTR "off. It no longer makes a sound."

	.FUNCT INIT-PC
	FCLEAR PC,POWERBIT
	SET 'LOGGED-IN?,0
	SET 'USERNAME?,0
	REMOVE MENU-BOX
	REMOVE MORE-BOX
	MOVE YAK-WINDOW,GLOBAL-OBJECTS
	IN? ODD-PAPER,GLOBAL-OBJECTS /FALSE
	REMOVE ODD-PAPER
	RTRUE

	.FUNCT CANT-USE-COMPUTER?,COMP=0
	CALL ACCESSIBLE?,PC >STACK
	ZERO? STACK /?L1
	SET 'COMP,PC
	JUMP ?L4
?L1:	CALL ACCESSIBLE?,LOVECRAFT >STACK
	ZERO? STACK /?L3
	SET 'COMP,LOVECRAFT
	JUMP ?L4
?L3:	PRINTR "Login on what?"
?L4:	CALL POWER-ON-FIRST?,COMP >STACK
	ZERO? STACK \TRUE
	EQUAL? COMP,LOVECRAFT \FALSE
	PRINT STR?279
	CRLF
	RTRUE

	.FUNCT V-LOGIN
	CALL CANT-USE-COMPUTER? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSO,INTNAME \?L3
	EQUAL? P-NAME,W?XYZZY \?L3
	SET 'USERNAME?,W?XYZZY
	JUMP ?L4
?L3:	SET 'USERNAME?,1
?L4:	PRINT COMPUTER-RESPONDS
	PRINTR "PASSWORD PLEASE:"""

	.FUNCT POWER-ON-FIRST?,COMP
	FSET? COMP,POWERBIT /FALSE
	PRINTR "It would help if you turned on the computer first."

	.FUNCT V-PASSWORD
	CALL CANT-USE-COMPUTER? >STACK
	ZERO? STACK \TRUE
	EQUAL? PRSO,INTNAME \?L3
	EQUAL? P-NAME,W?PLUGH \?L3
	EQUAL? USERNAME?,W?XYZZY \?L3
	SET 'LOGGED-IN?,1
	MOVE MENU-BOX,PC
	PRINT COMPUTER-RESPONDS
	PRINTI "Good evening. You're here awfully late."" It displays a list of pending tasks, one of which is in blinking red letters, with large arrows pointing to it. The task reads ""Classics Paper,"" some particularly ominous words next to it say ""DUE TOMORROW!"" and more reassuringly, a menu box next to that reads "
	GETP MENU-BOX,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L3:	SET 'USERNAME?,0
	SET 'LOGGED-IN?,0
	PRINT COMPUTER-RESPONDS
	PRINTI "INVALID LOGIN"" and then "
	PRINT LOGIN-PLEASE
	CRLF
	RTRUE

	.FUNCT MOUSE-VERB?
	EQUAL? PRSA,V?PUSH,V?RUB,V?CLICK /TRUE
	EQUAL? PRSA,V?POINT,V?EDIT,V?ATTACK /TRUE
	RFALSE

	.FUNCT MENU-BOX-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The most immediate thing you see is the red menu box that refers to an urgent task."
?L1:	CALL MOUSE-VERB? >STACK
	ZERO? STACK /FALSE
	REMOVE MENU-BOX
	MOVE YAK-WINDOW,PC
	PRINTI "The menu box is replaced by the YAK text editor and menu boxes listing the titles of your files. The one for your paper is highlighted in a rather urgent-looking shade of red."
	CRLF
	CALL PRINT-ID,STR?339 >STACK
	RSTACK

	.FUNCT GENERIC-PAPER-F
	IN? YAK-WINDOW,PC \?L1
	RETURN YAK-WINDOW
?L1:	RETURN ODD-PAPER

	.FUNCT YAK-WINDOW-F
	IN? YAK-WINDOW,GLOBAL-OBJECTS \?L1
	CALL ABSTRACT-VERB? >STACK
	ZERO? STACK \FALSE
	CALL YOU-SEE-NO,YAK-WINDOW >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE,V?READ \?L6
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?BOX,W?SCREEN \?L7
	PRINTR "There's one for your paper."
?L7:	PRINT YOU-HAVE-TO
	PRINTR "touch the box for it first."
?L6:	CALL MOUSE-VERB? >STACK
	ZERO? STACK /FALSE
	MOVE YAK-WINDOW,GLOBAL-OBJECTS
	MOVE MORE-BOX,PC
	SET 'READ-PAGE?,0
	PRINTI "You click the box for your paper, and"
	FSET? ODD-PAPER,TOUCHBIT /?L11
	MOVE ODD-PAPER,PC
	PRINTR " the box grows reassuringly until it fills most of the screen. Unfortunately, the text that fills it bears no resemblance to your paper. The title is the same, but after that, there is something different, very different."
?L11:	PRINT LC-NOTHING-HAPPENS
	PRINTR " ""Your paper is lost!"" reminds the hacker."

	.FUNCT MORE-BOX-F
	EQUAL? PRSA,V?READ \?L1
	PRINTR "It says ""MORE"" in a subdued typeface."
?L1:	CALL MOUSE-VERB? >STACK
	ZERO? STACK /FALSE
	ZERO? READ-PAGE? \?L4
	PRINTR "You haven't read the page yet. You probably shouldn't touch the MORE box until then."
?L4:	PRINTR "You touch the MORE box, and a new page appears."

	.FUNCT ODD-PAPER-F
	IN? ODD-PAPER,GLOBAL-OBJECTS \?L1
	CALL ABSTRACT-VERB? >STACK
	ZERO? STACK \FALSE
	PRINTR "It's been lost!"
?L1:	CALL MOUSE-VERB? >STACK
	ZERO? STACK /?L6
	PRINT ALREADY-DISPLAYED
	RTRUE
?L6:	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	SET 'READ-PAGE?,1
	CALL QUEUE,I-COMPULSION,2,1 >STACK
	ZERO? STACK /?L8
	SET 'COMPCNT,1
	GET COMPDESCS,COMPCNT >STACK
	PRINT STACK
	CRLF
	CRLF
	PRINTR "As you look at it more closely, you find it hard to focus on the screen, but impossible to look away. Your finger strays toward the ""MORE"" box..."
?L8:	PRINTR "You click the ""MORE"" box and read what appears."

	.FUNCT I-COMPULSION
	FSET ODD-PAPER,TOUCHBIT
	INC 'COMPCNT
	GET COMPDESCS,0 >STACK
	GRTR? COMPCNT,STACK \?L1
	CRLF
	PRINTI "You faint, and when you awaken..."
	CRLF
	CRLF
	CALL DEQUEUE,I-COMPULSION
	REMOVE MORE-BOX
	MOVE MENU-BOX,PC
	IN? PLAYER,HERE /?L3
	MOVE PLAYER,HERE
?L3:	CALL ROB,PLAYER,FROB
	CALL GOTO,YUGGOTH >STACK
	RSTACK
?L1:	CALL QUEUE,I-COMPULSION,1
	SET 'READ-PAGE?,1
	CRLF
	GET COMPDESCS,COMPCNT >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT I-YUGGOTH
	EQUAL? HERE,YUGGOTH \?L1
	CRLF
	PRINTI "From below, a low noise begins, and slowly builds. You feel yourself drawn downward by the noise."
	CRLF
	CRLF
	CALL GOTO,BOWL-ROOM
	RETURN M-FATAL
?L1:	EQUAL? HERE,BOWL-ROOM \FALSE
	CRLF
	PRINTI "The crowd around you begins to sway and groan. They are expecting something. You are drawn forward by the noise."
	CRLF
	CRLF
	CALL GOTO,PLATFORM-ROOM
	RETURN M-FATAL

	.FUNCT RANDOM-YUGGOTH-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	CALL QUEUE,I-YUGGOTH,2 >STACK
	RSTACK

	.FUNCT PLATFORM-ROOM-F,RARG
	EQUAL? RARG,M-ENTER /TRUE
	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?WALK \?L4
	EQUAL? P-WALK-DIR,P?UP \?L6
	PRINTR "You are prevented, as the crowd holds you back."
?L6:	PRINTR "The crowding is such that you can barely move, much less walk."
?L4:	EQUAL? PRSA,V?LISTEN \?L9
	EQUAL? PRSO,0,NOISE \?L9
	PRINTR "It sounds like supplication."
?L9:	EQUAL? PRSA,V?SMELL \?L10
	ZERO? PRSO \?L10
	IN? LURKER,HERE \?L10
	CALL NEW-PRSO,LURKER
	RTRUE
?L10:	EQUAL? PRSA,V?DROP,V?PUT,V?THROW \?L13
	EQUAL? PRSO,SMOOTH-STONE /?L12
?L13:	EQUAL? PRSA,V?ATTACK \FALSE
	EQUAL? PRSI,SMOOTH-STONE \FALSE
?L12:	PRINTI "You can't. You go through the motions, but the stone doesn't leave your hand."
	CRLF
	CALL HOSTILE-VERB? >STACK
	CALL PRINT-ID,STR?340,STACK >STACK
	RSTACK

	.FUNCT PLATFORM-F
	EQUAL? PRSA,V?WALK-TO,V?THROUGH,V?BOARD \?L1
	EQUAL? HERE,BOWL-ROOM \?L3
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L3:	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE,V?LOOK-UNDER,V?LOOK-BEHIND \FALSE
	PRINTR "The platform is made of the same rocks as the surrounding terrain. In fact, you can't tell whether it is natural or constructed."

	.FUNCT SMOOTH-STONE-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? \?L1
	FSET? SMOOTH-STONE,TOUCHBIT \TRUE
	RFALSE
?L1:	FSET? SMOOTH-STONE,TOUCHBIT /FALSE
	EQUAL? HERE,INNER-LAIR \?L7
	PRINTI "The stone sits on a hummock of mud. From here it appears to have a crack in it."
	RTRUE
?L7:	PRINTI "One small stone stands out in the pile, smooth, shiny, and glowing with a blazing light."
	RTRUE

	.FUNCT SMOOTH-STONE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a "
	EQUAL? HERE,INNER-LAIR \?L3
	FSET? SMOOTH-STONE,TOUCHBIT /?L3
	PRINTI "cracked"
	JUMP ?L5
?L3:	PRINTI "smooth, shiny"
?L5:	PRINTR " piece of what might be obsidian. Scratched on it is a symbol."
?L1:	EQUAL? PRSA,V?TAKE \?L6
	IN? PRSO,HERE \?L6
	EQUAL? HERE,PLATFORM-ROOM \?L7
	CALL QUEUE,I-COOL,20,1
	CALL QUEUE,I-LURKER-APPEARS,-1
	RFALSE
?L7:	EQUAL? HERE,BROWN-ROOF,INSIDE-DOME \?L9
	IN? FLIER,HERE \?L9
	PRINTR "The noisome creature jabs at you with its razor beak, but appears unwilling to approach the stone."
?L9:	EQUAL? HERE,INNER-LAIR \FALSE
	FSET? SMOOTH-STONE,TOUCHBIT /FALSE
	PRINTI "You pick up the stone. It has a long jagged crack that almost breaks it in half. As you pick it up, you feel it bump to one side. Then, as you are holding it in your hand, something pushes its way out through the crack, breaking the stone into two pieces. Something small, pale, and damp blinks its watery eyes at you. It hisses, gaining strength, and spreads membranous wings. "
	PRINTI "It takes to the air, at first clumsily, then with increased assurance, and disappears into the gloom. One eerie cry drifts back to where you stand."
	CRLF
	CRLF
	PRINTI "Something rises out of the mud, slowly straightening. The hacker, mud-covered and weak, staggers to his feet. ""Can I have my key back?"" he asks."
	CRLF
	ADD SCORE,5 >SCORE
	CALL FINISH >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?DROP \?L12
	IN? FLIER,HERE \FALSE
	MOVE SMOOTH-STONE,HERE
	PRINTR "The shape becomes agitated, screeching and cawing as it approaches the stone."
?L12:	EQUAL? PRSA,V?KICK,V?MOVE,V?RUB \?L16
	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L16
	IN? FLIER,HERE \?L16
	PRINT YOU-CANT
	PRINTR "get close enough."
?L16:	EQUAL? PRSA,V?RUB \?L17
	EQUAL? PRSO,SMOOTH-STONE \?L17
	PRINTI "The stone is smooth and "
	ZERO? END-CNT /?L18
	PRINTI "warm"
	JUMP ?L20
?L18:	PRINTI "cool"
?L20:	PRINTR "."
?L17:	EQUAL? PRSA,V?ATTACK \?L21
	EQUAL? PRSI,SMOOTH-STONE \?L21
	EQUAL? PRSO,FLIER-SHAPE \?L22
	MOVE SMOOTH-STONE,HERE
	PRINTI "The stone crashes against the wall of the dome. The shape screams, a hissing fit of anger and frustration."
	CRLF
	CALL PRINT-ID,STR?341 >STACK
	RSTACK
?L22:	EQUAL? PRSO,FLIER \FALSE
	PRINTI "The stone hits the dark beast, and appears to go completely through it as though the creature was made of air. "
	CALL PRINT-ID,STR?342
	EQUAL? HERE,INSIDE-DOME \?L25
	MOVE SMOOTH-STONE,HERE
	MOVE FLIER,BROWN-ROOF
	CALL QUEUE,I-FLIER,3
	PRINTR "The stone tumbles onto the floor. The creature, hissing vilely, retreats."
?L25:	EQUAL? HERE,BROWN-ROOF \FALSE
	CALL OBJ-OFF-ROOF,SMOOTH-STONE >STACK
	RSTACK
?L21:	EQUAL? PRSA,V?OPEN \FALSE
	CALL TELL-YUKS >STACK
	RSTACK

	.FUNCT OBJ-OFF-ROOF,OBJ
	MOVE OBJ,COURTYARD
	CALL CTHE-PRINT,OBJ
	PRINTI " disappears over the south edge of the building"
	IN? FLIER,HERE \?L1
	PRINTI ", and the creature "
	EQUAL? OBJ,SMOOTH-STONE \?L3
	CALL SCORE-OBJECT,FLIER
	MOVE FLIER,GLOBAL-OBJECTS
	PRINTR "follows it, screaming frustration into the storm."
?L3:	PRINTR "watches it fall with cunning attention."
?L1:	PRINTR "."

	.FUNCT STONE-SYMBOL-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	PRINT SYMBOL-APPEARS
	PRINTI "carved into the "
	PRINTD SMOOTH-STONE
	PRINTI ", perhaps with a claw. "
	CALL TELL-SYMBOL,SMOOTH-STONE
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?RUB \FALSE
	PRINTR "The symbol is rough."

	.FUNCT I-LURKER-APPEARS
	CRLF
	INC 'YUGGOTH-COUNT
	EQUAL? YUGGOTH-COUNT,1 \?L1
	MOVE LURKER,HERE
	PRINTR "Suddenly, the dimness becomes darkness, and the crowd around you explodes with excitement. You are jostled and shoved from all sides. A low keening begins, building into a deafening, almost mechanical chant. The darkness before you compacts and deepens."
?L1:	EQUAL? YUGGOTH-COUNT,2 \?L3
	PRINTI "The darkness before you, now visible, is a creature. It towers over the now-silent crowd. The thing jerks this way and that, spraying a foul ichor. Its palps twitch expectantly, then pound impatiently against the rock. You can feel the "
	PRINTD SMOOTH-STONE
	PRINTR " vibrating in your hand."
?L3:	EQUAL? YUGGOTH-COUNT,3 \FALSE
	PRINTI "The thing now turns, sensing the presence of the stone. It quests almost blindly for it, then those surrounding you thrust you forward. The thing stoops, its mandibles grasping you. You are lifted towards its gaping maw. The stench and the sounds issuing from it are overwhelming, and you fall unconscious."
	CRLF
	CRLF
	CALL DEQUEUE,I-LURKER-APPEARS
	IN? CHAIR,TERMINAL-ROOM \?L5
	MOVE CHAIR,HERE
	MOVE PLAYER,CHAIR
?L5:	MOVE ODD-PAPER,GLOBAL-OBJECTS
	CALL GOTO,TERMINAL-ROOM
	CALL ROB,FROB,PLAYER
	RTRUE

	.FUNCT GENERIC-CREATURE-F
	RETURN LURKER

	.FUNCT LURKER-F
	EQUAL? WINNER,LURKER \?L1
	PRINT NO-RESPONSE
	PRINTI " You are not even sure that you produced any sound when you spoke."
	CRLF
	CALL END-QUOTE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	GRTR? YUGGOTH-COUNT,1 \?L4
	PRINTR "It is large, smooth and yet scaly. It has too many limbs, and they are not in the right places. To look at it gives you a headache."
?L4:	PRINTR "You see a visible darkness, in a shape not easily grasped."
?L3:	EQUAL? PRSA,V?SMELL \FALSE
	PRINTR "The thing gives off a charnel stench."

	.FUNCT BROWN-ELEVATOR-F
	EQUAL? PRSA,V?OPEN,V?PRY,V?WEDGE \FALSE
	PRINTR "It's broken."

	.FUNCT BROWN-BUILDING-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINT THE-LOBBY
	PRINTR "Brown Building, an eighteen-story skyscraper which houses the Meteorology Department and other outposts of the Earth Sciences. The elevator is out of order, but a long stairway leads up to the roof, and another leads down to the basement. A revolving door leads out into the night."

	.FUNCT COURTYARD-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	CALL EXIT-TO-COLD >STACK
	RSTACK
?L1:	EQUAL? RARG,M-LEAVE \FALSE
	CALL EXIT-FROM-COLD >STACK
	RSTACK

	.FUNCT OUTSIDE-DOOR-F
	FSET? HERE,OUTSIDE \?L1
	EQUAL? PRSA,V?THROUGH \?L3
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L3:	EQUAL? HERE,MASS-AVE,SMITH-ST,COURTYARD /?L6
	EQUAL? HERE,CS-ROOF \?L5
?L6:	EQUAL? PRSA,V?OPEN \?L7
	PRINTR "The door opens from this side."
?L7:	EQUAL? PRSA,V?UNLOCK \FALSE
	EQUAL? PRSI,MASTER-KEY \FALSE
	PRINTR "The door is not keyed to this key."
?L5:	EQUAL? PRSA,V?OPEN,V?UNLOCK \FALSE
	PRINTR "The door is securely locked."
?L1:	EQUAL? PRSA,V?THROUGH \?L14
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?OPEN \FALSE
	PRINTR "You can open the door, but it shuts automatically immediately thereafter."

	.FUNCT GREAT-COURT-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	CALL AS-YOU-ENTER-LEAVE,STR?343
	CALL EXIT-TO-COLD >STACK
	RSTACK

	.FUNCT AS-YOU-ENTER-LEAVE,EL
	PRINTI "As you "
	PRINT EL
	PRINTI ", the door closes and locks behind you."
	CRLF
	CRLF
	RTRUE

	.FUNCT ROOF-DOOR-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? ROOF-DOOR,LOCKED /?L1
	FSET? ROOF-DOOR,OPENBIT /?L1
	FSET ROOF-DOOR,OPENBIT
	PRINTI "You push the door open"
	EQUAL? HERE,BROWN-TOP-FLOOR \?L3
	PRINTI ", revealing a windswept, snow-covered roof. Frigid wind whips snow into your face"
?L3:	PRINTR "."
?L1:	EQUAL? PRSA,V?UNLOCK \?L6
	EQUAL? PRSI,MASTER-KEY \?L6
	FCLEAR PRSO,LOCKED
	PRINT DOOR-NOW-UNLOCKED
	CALL PRINT-ID,STR?344 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?LOCK \?L7
	EQUAL? PRSI,MASTER-KEY \?L7
	FSET PRSO,LOCKED
	PRINTR "The door is now locked."
?L7:	EQUAL? PRSA,V?THROUGH \FALSE
	EQUAL? HERE,BROWN-ROOF \?L9
	CALL DO-WALK,P?IN >STACK
	RSTACK
?L9:	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT BROWN-ROOF-EXIT
	IN? FLIER,HERE \?L1
	PRINTI "The dark shape, its foul stench overpowering the wind, "
	IN? FLIER-SHAPE,HERE \?L3
	REMOVE FLIER-SHAPE
	SET 'FLIER-COUNT,3
	PRINTI "drops from the dome and "
?L3:	PRINTI "blocks your escape."
	CRLF
	RFALSE
?L1:	FSET? ROOF-DOOR,OPENBIT \?L6
	RETURN BROWN-TOP-FLOOR
?L6:	PRINTI "The door leading inside is closed."
	CRLF
	RFALSE

	.FUNCT BROWN-ROOF-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	CALL EXIT-TO-COLD >STACK
	RSTACK
?L1:	EQUAL? RARG,M-LEAVE \?L3
	CALL EXIT-FROM-COLD >STACK
	RSTACK
?L3:	EQUAL? RARG,M-BEG \FALSE
	CALL ROOF-BEGS >STACK
	RSTACK

	.FUNCT ROOF-BEGS
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? PRSO,CEILING \?L1
	PRINTI "It's made of "
	EQUAL? HERE,ON-DOME \?L3
	PRINTR "concrete."
?L3:	PRINTR "tiny, tarry cinders."
?L1:	EQUAL? PRSA,V?THROW-OFF \?L6
	EQUAL? PRSI,CEILING \?L6
	EQUAL? PRSO,SMOOTH-STONE \?L7
	IN? FLIER,HERE \?L7
	CALL PERFORM,V?ATTACK,FLIER,SMOOTH-STONE
	RTRUE
?L7:	EQUAL? HERE,BROWN-ROOF \?L10
	MOVE PRSO,COURTYARD
	JUMP ?L12
?L10:	REMOVE PRSO
?L12:	CALL OBJ-OFF-ROOF,PRSO >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?LEAP \FALSE
	IN? FLIER,HERE \?L14
	PRINTI "The creature sees you preparing to leap, and springs toward you in a desperate effort, blood-red mouth contorted with a cry of frustration, but it's too late."
	CRLF
?L14:	CALL PRINT-ID,STR?345
	CALL JIGS-UP,STR?346 >STACK
	RSTACK

	.FUNCT DOME-F
	EQUAL? PRSA,V?THROUGH,V?CLIMB-FOO \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	EQUAL? HERE,BROWN-ROOF \?L3
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "The dome is large and semitransparent. It's made of some sort of milky-colored plastic. It dominates the roof. You can climb up to the entrance via a short ladder."
?L3:	EQUAL? PRSA,V?LEAP \FALSE
	CALL PRINT-ID,STR?347
	CALL JIGS-UP,STR?120 >STACK
	RSTACK

	.FUNCT INSIDE-DOME-EXIT
	IN? FLIER,HERE \?L1
	PRINTI "The creature is blocking your exit."
	CRLF
	RFALSE
?L1:	RETURN BROWN-ROOF

	.FUNCT INSIDE-DOME-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	ZERO? FLIER-COUNT \FALSE
	CALL HELD?,SMOOTH-STONE >STACK
	ZERO? STACK /FALSE
	CALL QUEUE,I-FLIER,-1 >STACK
	RSTACK
?L1:	EQUAL? RARG,M-BEG \?L6
	EQUAL? PRSA,V?DIG,V?SEARCH \FALSE
	EQUAL? PRSO,DIRT \FALSE
	CALL NEW-PRSO,TUB
	RTRUE
?L6:	EQUAL? RARG,M-END \FALSE
	ZERO? FLIER-COUNT \FALSE
	CALL HELD?,HAND >STACK
	ZERO? STACK /FALSE
	CALL QUEUE,I-FLIER,-1 >STACK
	RSTACK

	.FUNCT I-FLIER
	ZERO? FLIER-COUNT /?L1
	IN? FLIER,GLOBAL-OBJECTS \?L1
	CALL DEQUEUE,I-FLIER
	RFALSE
?L1:	INC 'FLIER-COUNT
	CALL QUEUE,I-FLIER,-1
	EQUAL? HERE,INSIDE-DOME \?L4
	EQUAL? FLIER-COUNT,1 \?L6
	MOVE FLIER-SHAPE,HERE
	MOVE FLIER,BROWN-ROOF
	CRLF
	PRINTR "Something smashes against the glass of the dome! You turn and see a dark shape clinging to the outside of the structure."
?L6:	EQUAL? FLIER-COUNT,2 \?L8
	CRLF
	PRINT SHAPE-TWITCHES
	CRLF
	RTRUE
?L8:	EQUAL? FLIER-COUNT,3 \?L9
	REMOVE FLIER-SHAPE
	CRLF
	PRINTR "The shape drops out of view."
?L9:	EQUAL? FLIER-COUNT,4 \?L10
	CRLF
	PRINTR "You hear, on the ladder outside, hard claws painfully climbing towards the dome entrance."
?L10:	LESS? FLIER-COUNT,5 /?L11
	IN? FLIER,HERE /?L11
	MOVE FLIER,HERE
	CRLF
	PRINTR "The creature enters the dome, screaming viciously at you, its claws reaching out to grasp and rend."
?L11:	CALL FLIER-EATS-HAND? >STACK
	RSTACK
?L4:	EQUAL? HERE,BROWN-ROOF \FALSE
	EQUAL? FLIER-COUNT,1 \?L14
	MOVE FLIER-SHAPE,INSIDE-DOME
	MOVE FLIER,BROWN-ROOF
	CRLF
	PRINTR "You hear a strange confusion of wings, and then something dark and shapeless smashes against the dome above you!"
?L14:	EQUAL? FLIER-COUNT,2 \?L16
	CRLF
	PRINT SHAPE-TWITCHES
	CRLF
	RTRUE
?L16:	EQUAL? FLIER-COUNT,3 \?L17
	REMOVE FLIER-SHAPE
	CRLF
	PRINTR "The shape drops, crunching into the snow almost next to you. Its scaly head turns toward you, eyes like coals staring into yours."
?L17:	EQUAL? FLIER-COUNT,4 \?L18
	CRLF
	PRINTR "The shape rises, baring needle-sharp teeth and pumping its wings painfully in the gale."
?L18:	EQUAL? FLIER-COUNT,5 \?L19
	CRLF
	PRINTR "The creature approaches, hissing at you as it nears."
?L19:	CALL FLIER-EATS-HAND? >STACK
	RSTACK

	.FUNCT FLIER-EATS-HAND?,NOCR?=0
	IN? FLIER,HERE \FALSE
	ZERO? NOCR? \?L3
	IN? HAND,PLAYER /?L3
	IN? HAND,HERE \FALSE
?L3:	MOVE FLIER,GLOBAL-OBJECTS
	ZERO? NOCR? \?L4
	CRLF
?L4:	PRINTI "In a snake-like strike, the creature "
	IN? HAND,WINNER \?L7
	PRINTI "attacks! Its toothy jaws close on your hand! Not your hand, but the "
	JUMP ?L9
?L7:	PRINTI "snaps at the "
?L9:	REMOVE HAND
	FSET? HAND,PERSON /?L10
	PRINTI "mummified "
?L10:	PRINTI "hand you dug out of the tub! With a disgusting gobbling noise, the flier swallows the hand, and then, "
	EQUAL? HERE,BROWN-ROOF \?L13
	PRINTR "its wings beating feebly against the wind, it sails away into the gale."
?L13:	PRINTR "using its wings to push itself away, it scuttles out into the cold and away."

	.FUNCT FLIER-SHAPE-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINT YOU-CANT
	PRINTR "tell much from here. It's large and dark, but the dome obscures all detail."

	.FUNCT FLIER-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	PRINTI "A dark shape watches balefully from nearby."
	RTRUE

	.FUNCT FLIER-F
	IN? FLIER,GLOBAL-OBJECTS \?L1
	CALL ABSTRACT-VERB? >STACK
	ZERO? STACK \FALSE
	PRINTR "The creature has disappeared as though it never was."
?L1:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTR "Like a black sheet flapping in the wind, the dark flier is hard to see. Red eyes glow like coals on its scaly, bullet-shaped head. Human-like hands clench and unclench. Sharp needles of teeth project wickedly from its twisted jaw."
?L6:	EQUAL? PRSA,V?SMELL \?L7
	PRINTR "Its stench is that of a foul eater of carrion, overlaid with another smell you can't place, but which is even less appetizing."
?L7:	EQUAL? PRSA,V?ATTACK,V?KILL \?L8
	EQUAL? PRSI,SMOOTH-STONE /?L8
	PRINTI "Hissing and screeching, the creature fends off your attack. Its head jerks from side to side, watching you."
	CRLF
	CALL PRINT-ID,STR?348 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?GIVE \?L9
	EQUAL? PRSO,HAND \?L10
	CALL FLIER-EATS-HAND?,1 >STACK
	RSTACK
?L10:	EQUAL? PRSO,SMOOTH-STONE \FALSE
	CALL CTHE-PRINT-PRSI
	PRINTR " edges away."
?L9:	EQUAL? PRSA,V?THROW,V?POUR \FALSE
	EQUAL? PRSI,FLIER \FALSE
	EQUAL? PRSO,SMOOTH-STONE,ELIXIR /FALSE
	MOVE PRSO,HERE
	PRINTI "The creature darts to the side, dodging "
	CALL THE-PRINT-PRSO
	PRINT PERIOD
	EQUAL? PRSO,NITROGEN /?L15
	PUSH 0
	JUMP ?L16
?L15:	PUSH 1
?L16:	CALL PRINT-ID,STR?349,STACK >STACK
	RSTACK

	.FUNCT PEACH-TREE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's a small peach tree planted in a very large tub of earth. It appears healthy, although as it is wintertime, the tree has no leaves."
?L1:	EQUAL? PRSA,V?RUB \?L3
	PRINTR "It feels like wood, but there is something slippery on it higher up."
?L3:	EQUAL? PRSA,V?ATTACK,V?CUT \?L4
	EQUAL? PRSI,AXE \?L4
	PRINTI "At the last second, you realize it would be an unspeakable act of vandalism."
	CRLF
	CALL PRINT-ID,STR?350 >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?SHAKE \?L5
	PRINTR "You shake it, but nothing drops. Its branches are bare."
?L5:	EQUAL? PRSA,V?CLIMB-ON,V?CLIMB-UP,V?CLIMB-FOO \FALSE
	PRINT STR?307
	PRINTR "the tree, but as you get partway up, your hands encounter a slippery substance which covers the limbs at this height. Not only is it extremely unpleasant to touch, it makes the tree too slippery to climb any further."

	.FUNCT TUB-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The tub is full of dirt and ""condo chips"" (those pine bark chips that are spread around condos and shopping centers by the ton). The dirt has been disturbed recently."
?L1:	EQUAL? PRSA,V?DIG,V?SEARCH,V?LOOK-INSIDE \FALSE
	FSET? HAND,TOUCHBIT /?L4
	FSET HAND,TOUCHBIT
	MOVE HAND,TUB
	CALL SCORE-OBJECT,HAND
	PRINT STR?351
	PRINTR "in the dirt for a while, when you encounter something hard. Further exploration reveals it to be a dried, chewed looking human hand."
?L4:	PRINT YOU-FIND-NOTHING
	PRINTR " further, which is something of a relief."

	.FUNCT TATTOO-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	PRINTI "The tattoo is old and faded. It was done in red ink and is very artistically drawn. "
	CALL TELL-SYMBOL,HAND
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?RUB \FALSE
	PRINTR "This part of the hand feels particularly cold."

	.FUNCT HAND-F,RARG=0
	EQUAL? RARG,M-CONTAINER \?L1
	FSET? HAND,PERSON \FALSE
	EQUAL? PRSA,V?WEAR \?L5
	CALL TAKE-OUT-FIRST,PRSO,HAND >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?TAKE \?L8
	CALL HELD?,HAND >STACK
	ZERO? STACK \FALSE
?L8:	CALL NEW-PRSO,HAND >STACK
	RSTACK
?L1:	EQUAL? WINNER,HAND \?L11
	PRINTI "As you speak, the hand sits still, but there is no other noticeable result."
	CRLF
	CALL END-QUOTE >STACK
	RSTACK
?L11:	EQUAL? PRSA,V?EXAMINE \?L12
	FSET? HAND,PERSON \?L13
	PRINTI "There are stains, scars, "
	IN? RING,HAND \?L15
	CALL PRINTA,RING
	PRINTI ", "
?L15:	PRINTI "and a tattoo on the hand. "
	ZERO? LAIR-FLAG /?L18
	CALL HELD?,HAND >STACK
	ZERO? STACK /?L20
	CALL HAND-POINTS >STACK
	RSTACK
?L20:	PRINTI "It's splashing in"
	PRINT THE-POOL
	RTRUE
?L18:	PRINTR "It looks perfectly normal and alive, ignoring the fact that there is no arm attached to it. It doesn't appear to mind, so why should you?"
?L13:	PRINTR "The hand is very old. It's dry and very light, mummified in fact. There are stains, scars, and dried blood on it. There is a tattoo on the back of it. The hand appears to have been severed by the application of very sharp teeth, perhaps an animal's."
?L12:	EQUAL? PRSO,HAND \?L25
	EQUAL? PRSA,V?TAKE,V?PUT,V?THROW /?L26
	EQUAL? PRSA,V?RUB \?L27
	EQUAL? PRSI,HAND /?L26
?L27:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /?L25
?L26:	FSET? HAND,PERSON \?L25
	EQUAL? HERE,INNER-LAIR \?L28
	CALL CTHE-PRINT,HAND
	PRINTR ", muddy and wet, wiggles out of your grasp."
?L28:	IN? HAND,PLAYER \FALSE
	CALL CTHE-PRINT,HAND
	PRINTR " scuttles away to your other shoulder."
?L25:	EQUAL? PRSA,V?PUT-ON \?L32
	EQUAL? PRSO,RING \?L32
	EQUAL? PRSI,HAND \?L32
	FSET? HAND,PERSON \?L33
	FCLEAR RING,WEARBIT
	MOVE RING,HAND
	PRINTR "The ring fits the hand perfectly."
?L33:	PRINT YOU-CANT
	PRINTR "get the ring onto the dry flesh of the hand."
?L32:	EQUAL? PRSA,V?GIVE,V?SHOW \?L36
	EQUAL? PRSI,HAND \?L36
	FSET? HAND,PERSON \FALSE
	PRINTI "The hand "
	IN? HAND,VAT \?L39
	PRINTR "is preoccupied."
?L39:	FSET? PRSO,PERSON \?L41
	PRINTR "doesn't react."
?L41:	PRINTI "scurries to "
	CALL THE-PRINT-PRSO
	PRINTR " and touches it all over, much as a blind person would examine something."
?L36:	EQUAL? PRSA,V?RUB \?L44
	EQUAL? PRSO,HAND \?L44
	CALL HELD?,HAND >STACK
	ZERO? STACK \?L45
	CALL NOT-HOLDING,HAND >STACK
	RSTACK
?L45:	FSET? HAND,PERSON \?L47
	PRINTR "It's warm and dry."
?L47:	PRINTR "It's dry and cold. In fact, it's mummified."
?L44:	EQUAL? PRSA,V?FOLLOW \FALSE
	EQUAL? HERE,INNER-LAIR \FALSE
	PRINTR "The pool isn't that deep!"

	.FUNCT LAIR-EXIT
	FSET? URCHINS,RMUNGBIT \?L1
	PRINTI "A few of the urchins grab feebly at you as you pass, but none is a serious barrier."
	CRLF
	CRLF
	RETURN LAIR-1
?L1:	IN? URCHINS,SLOTS \?L3
	PRINTI "Something is blocking the downward passage. It's moving, slowly and painfully, trying to climb up."
	CRLF
	RFALSE
?L3:	PRINTI "The urchins lurch, almost as one, into your way, grabbing at you feebly but effectively. Their pale, limp hands can't grab you, but they can stop you. There is no way past."
	CRLF
	RFALSE

	.FUNCT LARGE-CHAMBER-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is a wide spot in the tunnel, just as wet and muddy as elsewhere. The walls are slimy as well. Numerous slots or indentations about two feet wide and a foot high open here and there. "
	LOC URCHINS >STACK
	ZERO? STACK /?L3
	FSET? URCHINS,RMUNGBIT \?L5
	PRINTI "Stubs of the wire still "
	JUMP ?L7
?L5:	PRINTI "Thin, wire or ropelike growths emerge from a hole further down and "
?L7:	IN? URCHINS,SLOTS \?L8
	PRINTR "enter each of the slots. There is background noise here, almost loud enough to hear clearly."
?L8:	IN? URCHINS,HERE \?L15
	PRINTI "envelop the head of each urchin. The urchins are "
	FSET? URCHINS,RMUNGBIT \?L11
	PRINTR "catatonic."
?L11:	PRINTR "saying or chanting something repetitive and monotonal, almost machinelike."
?L3:	PRINTI "There is a"
	PRINT STR?220
?L15:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \?L16
	SET 'LAIR-FLAG,0
	CALL QUEUE,I-URCHINS,-1 >STACK
	RSTACK
?L16:	EQUAL? RARG,M-LEAVE /TRUE
	EQUAL? RARG,M-BEG \FALSE
	EQUAL? PRSA,V?THROUGH \?L19
	EQUAL? PRSO,GLOBAL-HOLE \?L19
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L19:	EQUAL? PRSA,V?EXAMINE \?L21
	EQUAL? PRSO,GLOBAL-HOLE \?L21
	PRINTR "It's a slimy, muddy hole, but it's the only way down."
?L21:	EQUAL? PRSA,V?WALK \?L22
	EQUAL? P-WALK-DIR,P?DOWN,P?UP /?L22
	CALL PERFORM,V?THROUGH,SLOTS
	RTRUE
?L22:	EQUAL? PRSA,V?LISTEN \FALSE
	EQUAL? PRSO,NOISE,0 \FALSE
	IN? URCHINS,SLOTS \?L24
	PUSH SLOTS
	JUMP ?L26
?L24:	PUSH URCHINS
?L26:	CALL NEW-PRSO,STACK
	RTRUE

	.FUNCT URCHINS-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	PRINTI "There are urchins here."
	RTRUE

	.FUNCT URCHINS-F
	EQUAL? WINNER,URCHINS \?L1
	FSET? URCHINS,RMUNGBIT \?L3
	PRINT NO-RESPONSE
	PRINTI " It's as though they don't hear you."
	CRLF
	JUMP ?L5
?L3:	PRINTI "The urchins turn to you in unison. They smile, revealing red, broken teeth. They never stop their deep-voiced, incomprehensible chant."
	CRLF
?L5:	CALL END-QUOTE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTI "These are not normal looking urchins. Their clothes are muddy and tattered. They are barefoot in midwinter, and covered with mud. Around their heads are draped the "
	FSET? URCHINS,RMUNGBIT \?L7
	PRINTI "stubs of the "
?L7:	PRINTR "ropy growths that you've been noticing in this area. Although their eyes are open, they stare catatonically."
?L6:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK \?L11
	EQUAL? PRSA,V?SEARCH \?L10
?L11:	PRINTI "They ignore you."
	CRLF
	CALL KILL-VERB? >STACK
	CALL PRINT-ID,STR?352,STACK
	CALL HOSTILE-NOT-KILL? >STACK
	CALL PRINT-ID,STR?353,STACK >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?HELP,V?UNTIE \?L12
	CALL BEYOND-HELP
	CALL PRINT-ID,STR?354 >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?GIVE,V?SHOW \?L13
	EQUAL? PRSI,URCHINS,GLOBAL-URCHINS \?L13
	PRINTR "They ignore your offer, caught up in something only they can sense."
?L13:	EQUAL? PRSA,V?WAKE \?L14
	PRINTR "They seem quite awake."
?L14:	EQUAL? PRSA,V?LISTEN \?L15
	PRINTR "The strange chant never stops. They don't move their lips to make it. It resonates deep within their chests."
?L15:	EQUAL? PRSA,V?TELL /FALSE
	CALL GLOBAL-URCHINS-F >STACK
	RSTACK

	.FUNCT URCHIN-CLOTHES-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It bulges in odd places."
?L1:	EQUAL? PRSA,V?TAKE,V?OPEN,V?RUB /?L4
	EQUAL? PRSA,V?LOOK-INSIDE,V?LOOK-UNDER,V?SEARCH \FALSE
?L4:	PRINTI """Hey! Keep off, sucker!"
	CALL PRINT-ID,STR?355
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?PARKA \?L5
	PRINTI " "
	PRINT YOU-CANT
	PRINTI "scare me!"
?L5:	PRINTR """"

	.FUNCT URCHIN-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	PRINTI "Slouching nearby is an urchin."
	FSET? URCHIN,TOUCHBIT /?L4
	FSET URCHIN,TOUCHBIT
	CALL URCHIN-FIRST-LOOK
?L4:	RETURN M-FATAL

	.FUNCT URCHIN-FIRST-LOOK
	PRINTI " He's "
	PRINT URCHIN-LDESC
	PRINTI ". He's jumpy, and looks suspiciously at you."
	RTRUE

	.FUNCT URCHIN-F,MANY?,?TMP
	EQUAL? WINNER,URCHIN \?L1
	EQUAL? PRSA,V?LEAVE \?L3
	PRINTI """Hey! You go away, sucker."""
	JUMP ?L16
?L3:	EQUAL? PRSA,V?TELL-ME-ABOUT,V?YES,V?NO \?L5
	EQUAL? PRSO,URCHIN \?L6
	PRINTI """I just came in to get out of the snow. I wouldn't come in here if it wasn't snowing."""
	JUMP ?L16
?L6:	EQUAL? PRSO,STUDENTS \?L8
	PRINTI """Hey, you guys got students gone missing? We got kids gone missing!"" He looks at you suspiciously. ""You ain't the one done it, are ya?"""
	JUMP ?L16
?L8:	EQUAL? PRSO,GLOBAL-URCHINS \?L9
	PRINTI """The word is out on the street, man. Don't go to Tech, or you're gonna be gone, ya know? I wouldn't be here myself if I had a warm place to go."""
	JUMP ?L16
?L9:	PRINTI "He doesn't reply."
	JUMP ?L16
?L5:	EQUAL? PRSA,V?WHERE \?L11
	FSET? PRSO,TAKEBIT \?L11
	PRINTI """I didn't take it!"""
	JUMP ?L16
?L11:	EQUAL? PRSA,V?TAKE,V?OPEN,V?UNLOCK /?L13
	EQUAL? PRSA,V?WALK,V?FOLLOW /?L13
	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /?L12
?L13:	PRINTI """I don't take no orders from bozos!"""
	CALL IS-THEFT? >?TMP
	ZERO? ?TMP /?L15
	PUSH ?TMP
	JUMP ?L14
?L15:	CALL HOSTILE-VERB? >STACK
?L14:	CALL PRINT-ID,STR?356,STACK
	JUMP ?L16
?L12:	PRINTI """I don't hafta say anything. I ain't done nothing."""
?L16:	PRINTR " He seems very nervous about talking to you."
?L1:	EQUAL? PRSA,V?EXAMINE \?L17
	PRINTI "This is an urchin."
	CALL URCHIN-FIRST-LOOK
	CRLF
	RTRUE
?L17:	EQUAL? PRSA,V?SMELL \?L18
	PRINTR "He smells damp. There is also a slight odor of fast food."
?L18:	EQUAL? PRSA,V?SHOW,V?GIVE \?L21
	EQUAL? PRSO,HAND /?L20
?L21:	EQUAL? PRSA,V?SCARE,V?RUB \?L19
	EQUAL? PRSI,HAND \?L19
?L20:	FSET? HAND,PERSON \?L22
	REMOVE URCHIN
	CALL DEQUEUE,I-URCHIN
	FCLEAR BOLT-CUTTER,INVISIBLE
	MOVE BOLT-CUTTER,HERE
	PRINTI "The urchin sees the hand twitching. ""I heard what happens around here! I'm not gettin' fed to a monster!"" He lets loose a scream of fear and zooms away. Some"
	EQUAL? PRSA,V?SCARE,V?RUB /?L24
	PUSH 0
	JUMP ?L25
?L24:	PUSH 1
?L25:	CALL PRINT-ID,STR?357,STACK
	CALL ROB,URCHIN,HERE >MANY?
	ZERO? MANY? /?L26
	PRINTI " things drop"
	JUMP ?L28
?L26:	PRINTI "thing drops"
?L28:	PRINTI " from beneath his parka as he departs. He slows for a moment, decides not to retrieve "
	ZERO? MANY? /?L29
	PRINTI "them"
	JUMP ?L31
?L29:	PRINTI "it"
?L31:	PRINTR ", and disappears into the distance."
?L22:	PRINTR "He stares at the hand, scared but holding his ground. ""What's that?"" he says, voice quavering."
?L19:	EQUAL? PRSA,V?GIVE \?L33
	EQUAL? PRSI,URCHIN \?L33
	PRINTI """My momma said never take nothin' from no stranger."""
	FSET? PRSO,FOODBIT \?L34
	EQUAL? PRSO,COKE /?L34
	REMOVE PRSO
	PRINTI " He takes "
	CALL THE-PRINT-PRSO
	PRINTI " anyway, disposing of it in record time. ""On the other hand, I'm hungry,"" he remarks."
?L34:	CRLF
	RTRUE
?L33:	EQUAL? PRSA,V?TELL-ABOUT \?L37
	EQUAL? PRSI,HAND \?L37
	PRINTR """You expect me to believe garbage like that?"" the urchin sneers."
?L37:	EQUAL? PRSA,V?SHOW \?L38
	EQUAL? PRSI,URCHIN \?L38
	EQUAL? PRSO,MASTER-KEY \?L39
	PRINTR """I got one already."""
?L39:	EQUAL? PRSO,DEAD-RAT \?L41
	PRINTR """I seen a lot of those."""
?L41:	PRINTR "He makes an unconvincing show of disinterest."
?L38:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /?L43
	EQUAL? PRSA,V?THROW \?L44
	MOVE PRSO,HERE
?L44:	FSET? URCHIN,RMUNGBIT /?L47
	FSET URCHIN,RMUNGBIT
	PRINTI "The urchin backs off, and then draws a very large switchblade out of his coat pocket. ""You watch out,"" he says, ""I know how to use this. Get outa here!"""
	CRLF
	CALL PRINT-ID,STR?358 >STACK
	RSTACK
?L47:	EQUAL? PRSI,0,HANDS \?L49
	PRINTI "The urchin laughs in your face, fending you off with his switchblade."
	CRLF
	CALL PRINT-ID,STR?359 >STACK
	RSTACK
?L49:	FSET? PRSI,WEAPONBIT \FALSE
	CALL PRINT-ID,STR?360
	CALL JIGS-UP,STR?361 >STACK
	RSTACK
?L43:	EQUAL? PRSA,V?SCARE \?L52
	PRINTI "How do you propose to do that?"
	CRLF
	CALL PRINT-ID,STR?362 >STACK
	RSTACK
?L52:	EQUAL? PRSA,V?WHAT \?L53
	CALL NEW-PRSO,URCHINS
	RTRUE
?L53:	EQUAL? PRSA,V?FOLLOW \FALSE
	IN? URCHIN,HERE /FALSE
	PRINTI "He got away clean. "
	PRINT YOU-CANT
	PRINTR "follow him."

	.FUNCT I-URCHIN,TMP=0,S,RM,ORM,OWINNER,UL,D,P
	CALL QUEUE,I-URCHIN,10
	PUT URCHIN-TABLE,0,0
	SET 'OWINNER,WINNER
	SET 'WINNER,URCHIN
	LOC URCHIN >UL
	IN? URCHIN,HERE \?L1
	RANDOM 100 >STACK
	LESS? 80,STACK /?L1
	CALL META-LOC,MAINTENANCE-MAN >STACK
	EQUAL? STACK,HERE /?L1
	ZERO? LIT /FALSE
	CRLF
	PRINTR "The urchin looks around nervously, obviously thinking of flight, but decides against it."
?L1:	SET 'D,32
?L7:	DLESS? 'D,P?OUT /?L9
	GETPT UL,D >P
	ZERO? P /?L7
	PTSIZE P >S
	SET 'RM,0
	EQUAL? S,UEXIT /?L12
	EQUAL? S,CEXIT \?L13
	GETB P,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK \?L12
?L13:	EQUAL? S,DEXIT \?L14
	GETB P,DEXITOBJ >STACK
	FSET? STACK,OPENBIT /?L12
?L14:	EQUAL? S,FEXIT \?L7
	GET P,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L7
?L12:	ZERO? RM \?L15
	GETB P,REXIT >RM
?L15:	FSET? RM,OUTSIDE /?L7
	EQUAL? RM,TOMB /?L7
	CALL META-LOC,MAINTENANCE-MAN >STACK
	EQUAL? STACK,RM /?L7
	GET URCHIN-TABLE,0 >TMP
	INC 'TMP
	PUT URCHIN-TABLE,0,TMP
	PUT URCHIN-TABLE,TMP,RM
	JUMP ?L7
?L9:	SET 'WINNER,OWINNER
	LOC URCHIN >ORM
	CALL RANDOM-ELEMENT,URCHIN-TABLE >RM
	EQUAL? HERE,RM \?L22
	ZERO? LIT /?L22
	CRLF
	FSET? URCHIN,TOUCHBIT /?L24
	FSET URCHIN,TOUCHBIT
	PRINTI "An urchin ("
	PRINT URCHIN-LDESC
	PRINTI ")"
	JUMP ?L26
?L24:	PRINTI "The urchin"
?L26:	PRINTR " saunters nonchalantly into the room, notices you, and beats a hasty retreat."
?L22:	EQUAL? HERE,ORM /?L28
	CALL ROB,ORM,URCHIN
?L28:	MOVE URCHIN,RM
	CALL ROB,RM,URCHIN
	EQUAL? HERE,ORM \FALSE
	CRLF
	PRINTR "The urchin has disappeared."

	.FUNCT BOLT-CUTTER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "This is a heavy duty bolt or chain cutter, standard equipment for local bicycle thieves. It will defeat any but the heaviest bicycle chains."
?L1:	EQUAL? PRSA,V?CUT \FALSE
	EQUAL? PRSO,CHAIN,CHAIN-1,CHAIN-2 \FALSE
	PRINTI "It's too thick."
	CRLF
	CALL PRINT-ID,STR?363 >STACK
	RSTACK

	.FUNCT URCHIN-WIRE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "These are thin, fibrous, ropy growths. They look very tough."
?L1:	EQUAL? PRSA,V?FOLLOW \?L3
	PRINTI "They go from the "
	IN? URCHINS,SLOTS \?L4
	PRINTI "slots"
	JUMP ?L6
?L4:	PRINTI "urchins"
?L6:	PRINTR " down the tunnel."
?L3:	EQUAL? PRSA,V?CUT,V?MUNG \FALSE
	EQUAL? PRSO,URCHIN-WIRE \FALSE
	EQUAL? PRSI,BOLT-CUTTER \?L8
	FSET URCHINS,RMUNGBIT
	CALL SCORE-OBJECT,URCHIN-WIRE
	REMOVE URCHIN-WIRE
	PRINTI "You strain and push the two handles of the bolt cutter together with all your strength. At first it looks like nothing will happen, but then, with a loud click, the jaws cut the wire!

The wire, as though under tension, rapidly begins to curl up, disappearing down the tunnel and away. "
	IN? URCHINS,SLOTS \?L10
	FCLEAR URCHINS,INVISIBLE
	MOVE URCHINS,HERE
	PRINTI "Urchins burst forth from the slots. "
?L10:	PRINTR "The effect on the urchins is electric (perhaps literally). They twitch, jerk spasmodically, and fall to the ground almost in unison. They have lost all interest in you."
?L8:	ZERO? PRSI /?L13
	FSET? PRSI,WEAPONBIT /?L14
	FSET? PRSI,TOOLBIT \?L13
?L14:	CALL CTHE-PRINT-PRSI
	PRINTR " drives the wire into the mud, but doesn't cut it."
?L13:	CALL V-CUT >STACK
	RSTACK

	.FUNCT SLOTS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The slots are narrow burrows apparently dug by hand out of the mud of the chamber walls."
	IN? URCHINS,SLOTS \?L3
	PRINTI " Most of the slots have a thin wire or rope heading into them. You begin to be quite certain that there is something moving inside the slot you are looking at."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?THROUGH,V?BOARD \?L6
	EQUAL? PRSO,SLOTS \?L6
	PRINTI "You squeeze your way into one of the slots. The mud coats you with a cold, slimy coat which makes it barely possible to breathe."
	IN? URCHINS,SLOTS \?L7
	PRINTI " You are about halfway in when your hands touch something fleshy in front of you. It's cold and dead. On the other hand, it moves."
?L7:	PRINTR " You slide out with all the speed you can muster."
?L6:	EQUAL? PRSA,V?LOOK-INSIDE \?L10
	PRINT YOU-CANT-SEE
	PRINTR "anything but the wet walls of the burrow."
?L10:	EQUAL? PRSA,V?REACH-IN \?L11
	IN? URCHINS,SLOTS /?L12
	PRINT THERE-IS-NOTHING
	PRINTR "in the slots but cold, wet mud."
?L12:	PRINTR "You reach inside, oblivious to the cold clammy mud. At first you feel nothing, but just at the limit of your stretch, you feel flesh. It's cold and dead. You jerk your hand back out."
?L11:	EQUAL? PRSA,V?LISTEN \FALSE
	IN? URCHINS,SLOTS \FALSE
	PRINTR "The noise, as you listen more carefully, resolves itself into voices. They are chanting, but the words are unknown to you."

	.FUNCT I-URCHINS
	EQUAL? HERE,LARGE-CHAMBER \FALSE
	FSET? URCHINS,RMUNGBIT /FALSE
	INC 'URCHIN-CNT
	EQUAL? URCHIN-CNT,1 \?L3
	CRLF
	PRINTR "A small, furtive motion attracts your attention to the slots."
?L3:	EQUAL? URCHIN-CNT,2 \?L5
	CRLF
	PRINTR "There is motion in the slots. In fact, there is motion in almost all of them."
?L5:	IN? URCHINS,SLOTS \?L6
	FCLEAR URCHINS,INVISIBLE
	MOVE URCHINS,LARGE-CHAMBER
	CRLF
	PRINTR "Slowly, painfully, things emerge from the slots. They are pale, thin creatures with red mouths and staring eyes. Mold grows in their hair and wirelike streamers wrap their heads and join a bundle on the floor. You realize that these are urchins."
?L6:	CALL DEQUEUE,I-URCHINS >STACK
	RSTACK

	.FUNCT LAIR-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "You are lost in narrow, wet tunnels burrowed through the mud. Muddy, oily water covers the floor."
	EQUAL? HERE,OUTER-LAIR \?L3
	IN? CURTAIN,HERE \?L5
	PRINTR " A curtain of moldy slime covers the south wall."
?L5:	PRINTI " There is an ancient door in the south wall. "
	CALL TELL-OPEN-CLOSED,CURTAIN-DOOR >STACK
	RSTACK
?L3:	CRLF
	RTRUE
?L1:	EQUAL? RARG,M-LEAVE \?L9
	SET 'LAIR-FLAG,0
	FCLEAR HERE,TOUCHBIT
	RTRUE
?L9:	EQUAL? RARG,M-BEG \?L10
	EQUAL? HERE,OUTER-LAIR \FALSE
	IN? CURTAIN,HERE \FALSE
	EQUAL? PRSA,V?WALK \FALSE
	EQUAL? P-WALK-DIR,P?SOUTH \FALSE
	CALL PERFORM,V?THROUGH,CURTAIN
	RTRUE
?L10:	EQUAL? RARG,M-END \FALSE
	IN? HAND,PLAYER \FALSE
	FSET? HAND,PERSON \FALSE
	IN? RING,HAND \FALSE
	EQUAL? HERE,LAIR-FLAG /FALSE
	SET 'LAIR-FLAG,HERE
	CALL HAND-POINTS >STACK
	RSTACK

	.FUNCT HAND-POINTS
	CRLF
	PRINTI "The hand "
	IN? RING,HAND \?L1
	PRINTI "points its mutilated ring finger "
	GETP HERE,P?POINT >STACK
	PRINT STACK
	PRINTI " and "
?L1:	PRINTR "grips your shoulder tightly."

	.FUNCT CURTAIN-F,W
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The entire south wall is covered with a curtain of moldy phosphorescent slime. There is something about the slime that makes it appear unhealthy, as though the influences here are bad for anything living."
?L1:	EQUAL? PRSA,V?POUR,V?THROW \?L3
	EQUAL? PRSO,NITROGEN \?L3
	EQUAL? PRSI,CURTAIN \?L3
	REMOVE NITROGEN
	CALL DEQUEUE,I-NITROGEN-GOES
	CALL QUEUE,I-MIST-GOES,2
	PRINTI "The liquid splashes onto the curtain, and a cold mist fills the room. The slime begins to freeze. "
	LESS? NITROGEN-CNT,3 \?L4
	PRINTR "Patches of it shatter and fall, but the rest of the slime oozes into the ruined spots, and the curtain appears unharmed."
?L4:	ADD SCORE,5 >SCORE
	REMOVE CURTAIN
	FCLEAR CURTAIN-DOOR,INVISIBLE
	PRINTR "Nearly the entire curtain solidifies, shatters, and drops to the ground, revealing an ancient wooden door."
?L3:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK \?L8
	EQUAL? PRSA,V?TAKE,V?PRY,V?THROUGH /?L9
	EQUAL? PRSA,V?LOOK-BEHIND,V?RAISE \FALSE
?L9:	EQUAL? PRSO,CURTAIN \FALSE
?L8:	EQUAL? PRSO,CURTAIN \?L10
	SET 'W,PRSI
	JUMP ?L12
?L10:	SET 'W,PRSO
?L12:	EQUAL? W,0,HANDS \?L13
	CALL DEQUEUE,I-SLIME-OBJECT
	CALL QUEUE,I-SLIME,-1
	IN? GLOVES,WINNER \?L15
	FSET? GLOVES,WEARBIT \?L15
	PRINTI "The curtain is very slick and wet. Some of it sticks to your gloves."
	CRLF
	JUMP ?L18
?L15:	IN? SLIME,WINNER \?L17
	CALL MORE-SLIME,HANDS
	JUMP ?L18
?L17:	PRINTI "The feel is greasy, wet, and at first cold. Then you get a burning sensation, like that from a sea-nettle sting. You jerk away, but some of the slime sticks to you!"
	CRLF
	CALL PRINT-ID,STR?364
?L18:	MOVE SLIME,WINNER
	RTRUE
?L13:	EQUAL? PRSA,V?THROW \?L20
	MOVE W,HERE
?L20:	FSET? W,SLIMEBIT \?L23
	CALL MORE-SLIME,W >STACK
	RSTACK
?L23:	FSET W,SLIMEBIT
	CALL QUEUE,I-SLIME-OBJECT,2
	CALL CTHE-PRINT,W
	PRINTI " touches the curtain, and immediately some of the slime attacks, flowing almost intelligently onto it. "
	CALL CTHE-PRINT,W
	PRINTR " is now covered with slime."

	.FUNCT MORE-SLIME,OBJ
	PRINTI "More slime flows onto "
	CALL THE-PRINT,OBJ
	PRINTR "."

	.FUNCT SLIME-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	PRINTI "There is slime crawling up your arm. It has reached your "
	GET SLIMES,SLIME-CNT >STACK
	PRINT STACK
	PRINTI "."
	RTRUE

	.FUNCT SLIME-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's flowing, dark-green, and undulates slowly as it crawls up your arm."
?L1:	EQUAL? PRSA,V?RUB \?L3
	PRINTI "You already did that once. Twice would be stupid!"
	CRLF
	CALL PRINT-ID,STR?365 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?MUNG,V?KILL \?L4
	PRINT STR?261
	PRINTI ". You only succeed in hurting your arm."
	CRLF
	CALL PRINT-ID,STR?366 >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?POUR \?L5
	EQUAL? PRSO,NITROGEN \?L5
	CALL PRINT-ID,STR?367
	CALL JIGS-UP,STR?368 >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?DROP,V?TAKE-OFF \FALSE
	PRINTR "You try to scrape it off, but to no avail. It just flows back into place around your arm."

	.FUNCT I-SLIME-OBJECT,WHAT=0,W
	ZERO? WHAT \?L1
	SET 'WHAT,WINNER
?L1:	FIRST? WHAT >W \TRUE
?L4:	FSET? W,SLIMEBIT \?L7
	FSET? W,RMUNGBIT /?L7
	FSET W,RMUNGBIT
	EQUAL? WHAT,WINNER \?L9
	MOVE SLIME,WHAT
	CALL DEQUEUE,I-SLIME-OBJECT
	CALL QUEUE,I-SLIME,-1
	CRLF
	PRINTI "The slime has now flowed from "
	CALL THE-PRINT,W
	FSET? GLOVES,WEARBIT \?L11
	REMOVE GLOVES
	PRINTI ", devoured your gloves"
?L11:	PRINTR ", and begun attacking your hand."
?L9:	FSET WHAT,SLIMEBIT
	CALL QUEUE,I-SLIME-OBJECT,1
	JUMP ?L15
?L7:	FSET? W,CONTBIT \?L15
	FSET? W,OPENBIT \?L15
	CALL I-SLIME-OBJECT,W
?L15:	NEXT? W >W /?L4
	RTRUE

	.FUNCT I-SLIME
	IN? SLIME,WINNER \?L1
	ZERO? SLIME-CNT \?L3
	IN? GLOVES,WINNER \?L3
	FSET? GLOVES,WEARBIT \?L3
	REMOVE GLOVES
	CRLF
	PRINTR "The slime eats through your gloves! It begins to attack your hand, and you feel a hot, stinging sensation, like a sea-nettle sting."
?L3:	IGRTR? 'SLIME-CNT,5 \?L5
	CALL DEQUEUE,I-SLIME
	CRLF
	CALL PRINT-ID,STR?369
	CALL JIGS-UP,STR?370 >STACK
	RSTACK
?L5:	CRLF
	PRINTI "The slime is creeping slowly up your arm! It's reached your "
	GET SLIMES,SLIME-CNT >STACK
	PRINT STACK
	PRINT PERIOD
	RTRUE
?L1:	CALL DEQUEUE,I-SLIME >STACK
	RSTACK

	.FUNCT CURTAIN-DOOR-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This door, blackened by age, is built of ancient, rotting timbers, but still looks very strong. It is set in a rough-hewn arch. Oddly, in addition to an old, rusted-away lock, there is another which looks new and shiny. "
	CALL TELL-OPEN-CLOSED,CURTAIN-DOOR >STACK
	RSTACK
?L1:	EQUAL? HERE,INNER-LAIR \?L3
	EQUAL? PRSA,V?LOCK,V?UNLOCK \?L3
	EQUAL? PRSO,CURTAIN-DOOR \?L3
	EQUAL? PRSI,MASTER-KEY \?L3
	PRINTR "The lock doesn't appear to work from this side!"
?L3:	EQUAL? PRSA,V?UNLOCK \?L4
	EQUAL? PRSO,CURTAIN-DOOR \?L4
	EQUAL? PRSI,MASTER-KEY \?L4
	FCLEAR CURTAIN-DOOR,LOCKED
	PRINT DOOR-NOW-UNLOCKED
	RTRUE
?L4:	EQUAL? PRSA,V?ATTACK,V?MUNG \FALSE
	EQUAL? PRSO,CURTAIN-DOOR \FALSE
	EQUAL? PRSI,0,HANDS \?L6
	PRINTI "You only bruise your hands."
	CRLF
	CALL PRINT-ID,STR?371 >STACK
	RSTACK
?L6:	PRINTI "The door is surprisingly solid."
	CRLF
	CALL PRINT-ID,STR?372 >STACK
	RSTACK

	.FUNCT INNER-LAIR-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINT STR?304
	PRINTI "a stagnant, slime infested pool of water. It feels to "
	FSET? BOOTS,WEARBIT /?L3
	PRINTI "your sodden feet to "
?L3:	PRINTI "be about six inches deep."
	IN? MASS,HERE \?L6
	PRINTI " Ropes or wires tumble down the slope, where they enter a large whitish mass which takes up much of the chamber. The noise is loud here, and comes from the mass, which undulates in synchrony with the noise."
?L6:	PRINTR " Wan, sourceless light illuminates the chamber."
?L1:	EQUAL? RARG,M-BEG \?L9
	EQUAL? PRSA,V?LISTEN \FALSE
	EQUAL? PRSO,0,NOISE \FALSE
	CALL NEW-PRSO,MASS
	RTRUE
?L9:	EQUAL? RARG,M-ENTER \FALSE
	FSET CURTAIN-DOOR,LOCKED
	FCLEAR CURTAIN-DOOR,OPENBIT
	CALL QUEUE,I-HAND-DIVES,-1
	MOVE HACKER,LAIR-5
	CALL QUEUE,I-HACKER-RETURNS,2
	CALL AS-YOU-ENTER-LEAVE,STR?373 >STACK
	RSTACK

	.FUNCT I-HAND-DIVES
	FSET? HAND,PERSON \FALSE
	CALL HELD?,HAND >STACK
	ZERO? STACK /?L3
	MOVE HAND,INNER-LAIR
	CRLF
	PRINTR "Suddenly, the hand leaps from your shoulder into the slime-encrusted puddle. It dives beneath the water."
?L3:	IN? HAND,INNER-LAIR \FALSE
	CRLF
	PRINTI "The hand repeatedly dives and bobs to the surface in one part of"
	PRINT THE-POOL
	RTRUE

	.FUNCT I-HACKER-RETURNS,HERE?
	IN? HACKER,HERE /?L1
	SET 'HERE?,0
	JUMP ?L2
?L1:	SET 'HERE?,1
?L2:	IN? HACKER,INNER-LAIR \?L3
	INC 'LAIR-CNT
	EQUAL? LAIR-CNT,1 \?L5
	CRLF
	PRINT HACKER-STARES
	PRINTI "the thing in the cave. ""I got very suspicious about your problems with the net. I began to trace some coax, found some repeaters and bridges that weren't on the layout charts, and started following them. Anyway, here I am. That thing there, whatever it is, and those wires, are interfaced to the whole campus net. And that means it's tied into all the nets, commercial, government, even military, potentially."""
	CRLF
	RETURN M-FATAL
?L5:	EQUAL? LAIR-CNT,2 \?L7
	CRLF
	PRINTI """I guess I better do something. It could be a serious compromise of system integrity if this thing isn't dealt with."" He peers at the mass, as if evaluating it. He then reaches into a pocket and pulls out a small pair of wire strippers."
	CRLF
	RETURN M-FATAL
?L7:	EQUAL? LAIR-CNT,3 \?L8
	FSET HACKER,INVISIBLE
	FSET HACKER,RMUNGBIT
	CRLF
	PRINTI "The hacker advances on the mass, apparently planning to cut some of the wires leading into it. As he approaches it, the sound stops completely, and the wires begin a frantic, looping, twining dance. The mass begins to flow towards the hacker almost as quickly as he walks toward it. They reach each other and begin to merge together. He screams; a long, ululating cry that echoes through the cavern. Then he is engulfed."
	CRLF
	RETURN M-FATAL
?L8:	EQUAL? LAIR-CNT,4,5,6 \?L9
	CRLF
	PRINTI "The mass is bulging, vibrating, and rippling."
	EQUAL? LAIR-CNT,6 \?L10
	PRINTI " A huge tear is forming near where the hacker was absorbed."
?L10:	CRLF
	RETURN M-FATAL
?L9:	EQUAL? LAIR-CNT,7 \?L13
	FCLEAR HACKER,INVISIBLE
	CRLF
	PRINTI "The hacker pulls himself out of the side of the mass. As he does, you think you can see many pairs of eyes appear briefly in the semitransparent mass, watching curiously. Wires and tentacles trail from his body, and tiny, almost rat-like creatures cling to his body everywhere, crawling about like ants. He walks slowly, jerkily towards you. ""Be one!"" he says, haltingly but fervently."
	CRLF
	RETURN M-FATAL
?L13:	EQUAL? LAIR-CNT,8 \?L14
	CRLF
	PRINTI "The hacker grabs for you. ""Join us! Serve the master!"" he croaks. Some of the creatures leap onto you, biting at exposed skin."
	CRLF
	RETURN M-FATAL
?L14:	EQUAL? LAIR-CNT,9 \?L15
	CRLF
	CALL PRINT-ID,STR?374
	CALL JIGS-UP,STR?375,1
?L15:	RETURN M-FATAL
?L3:	IN? HACKER,OUTER-LAIR \?L17
	MOVE HACKER,INNER-LAIR
	CRLF
	PRINTI "You hear a stumbling noise behind you, turn and see the hacker staggering into the cavern."
	CRLF
	CRLF
	PRINT HACKER-STARES
	PRINTR "you, shocked. ""It's you! When I gave you my key, I never suspected you'd get this far!"""
?L17:	IN? HACKER,LAIR-5 \FALSE
	CALL QUEUE,I-HACKER-RETURNS,-1
	MOVE HACKER,OUTER-LAIR
	CRLF
	PRINTR "You hear noises outside the door."

	.FUNCT MASS-F
	EQUAL? WINNER,MASS \?L1
	PRINTI "When you speak, the noise stops, if only briefly. When it resumes, it's more insistent."
	CRLF
	CALL END-QUOTE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L4
	PRINTR "The mass is strangely, even wrongly, shaped. It is hard to get a fix on what's wrong with it, but it doesn't look like it could or should exist in any sane universe. It quivers and bubbles as though air were pumping through it. Many wires, tentacles, and combinations of the two enter the mass from all sides, making it almost fuzzy in appearance."
?L4:	EQUAL? PRSA,V?LISTEN \?L6
	PRINTR "You listen closely to the sounds, which are loud and at first seem random. The more you listen, the more you sense a strange regularity to them. You get impressions, one after another, of electronic music, a simple sine wave pattern, and telephone crosstalk. They are all overlaid with speech, or something like speech, nearer random babbling, or many people talking at once. You can't understand any of it, but it's so near intelligibility that you feel that if you moved closer, you just might get it."
?L6:	EQUAL? PRSA,V?GIVE,V?SHOW \?L7
	PRINTR "There is no reaction that you can detect."
?L7:	EQUAL? PRSA,V?RUB \?L8
	ZERO? PRSI /?L9
	PUSH PRSI
	JUMP ?L11
?L9:	PUSH HANDS
?L11:	CALL PERFORM,V?ATTACK,PRSO,STACK
	RTRUE
?L8:	EQUAL? PRSA,V?PUT-ON \?L12
	EQUAL? PRSO,HIGH-VOLTAGE \?L12
	EQUAL? PRSI,MASS \?L12
	CALL SWAP-VERB,V?RUB
	RTRUE
?L12:	EQUAL? PRSA,V?ATTACK,V?THROUGH \FALSE
	EQUAL? PRSI,0,HANDS \?L14
	PRINT STR?197
	PRINTI "mass and grab onto it."
	CALL PRINT-ID,STR?376
	CALL JIGS-UP,TOUCHING-MASS,1 >STACK
	RSTACK
?L14:	EQUAL? PRSI,HIGH-VOLTAGE \?L16
	FSET? HIGH-VOLTAGE,RMUNGBIT \?L17
	PRINTI "Deftly avoiding the exposed wire, the"
	JUMP ?L19
?L17:	PRINTI "The"
?L19:	PRINTI " tentacles grab you and pull you into the rippling slime."
	CALL PRINT-ID,STR?377
	CALL JIGS-UP,TOUCHING-MASS,1 >STACK
	RSTACK
?L16:	FSET? PRSI,WEAPONBIT \FALSE
	REMOVE PRSI
	CALL CTHE-PRINT-PRSI
	PRINTI " is engulfed by the mass and disappears. The mass itself is unchanged."
	CRLF
	CALL PRINT-ID,STR?378 >STACK
	RSTACK

	.FUNCT REPEATER-DESC,RARG,OBJ
	EQUAL? RARG,M-OBJDESC? /TRUE
	PRINTI "Set on the wall, incongruous in its surroundings, is a metal box. "
	CALL DESCRIBE-BOX
	RETURN M-FATAL

	.FUNCT DESCRIBE-BOX
	PRINTI "On one side a coaxial cable enters the box. On the other, "
	CALL PRINTA,OUTPUT-CABLE
	PRINTI " leads from the box "
	IN? MASS,HERE \?L1
	PRINTI "to the mass"
	JUMP ?L3
?L1:	PRINTI "and"
	PRINT ENDS-IN-STUMP
?L3:	PRINTI ". "
	FSET? REPEATER,OPENBIT \?L4
	PRINTI "The cover is off the box, revealing electronic innards."
	RTRUE
?L4:	PRINT STR?192
	PRINTI "metal cover on the box."
	RTRUE

	.FUNCT REPEATER-F
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L1
	CALL DESCRIBE-BOX
	FSET? REPEATER,OPENBIT \?L3
	PRINTI " "
	CALL DESCRIBE-CABLES
	RTRUE
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?OPEN \?L6
	EQUAL? PRSO,REPEATER \?L6
	CALL NEW-PRSO,REPEATER-COVER
	RTRUE
?L6:	EQUAL? PRSA,V?CLOSE \?L7
	EQUAL? PRSO,REPEATER \?L7
	CALL PERFORM,V?PUT,REPEATER-COVER,REPEATER
	RTRUE
?L7:	EQUAL? PRSA,V?PLUG \FALSE
	EQUAL? PRSI,REPEATER \FALSE
	FSET? REPEATER-COVER,OPENBIT \?L9
	IN? INPUT-CABLE,INPUT-SOCKET /?L9
	CALL NEW-PRSI,INPUT-SOCKET >STACK
	RSTACK
?L9:	PRINTR "You'll have to be more specific."

	.FUNCT REPEATER-COVER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It's a metal cover with simple finger screws to hold it on."
?L1:	EQUAL? PRSA,V?UNTIE \?L3
	FSET? REPEATER,OPENBIT \?L3
	PRINTR "You already opened it."
?L3:	EQUAL? PRSA,V?OPEN,V?UNTIE /?L5
	EQUAL? PRSA,V?TAKE,V?TAKE-OFF \?L4
	IN? REPEATER-COVER,REPEATER \?L4
?L5:	EQUAL? PRSA,V?TAKE,V?TAKE-OFF \?L8
	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
?L8:	FSET REPEATER,OPENBIT
	PRINTI "You remove the cover, revealing a plethora of electronic innards. "
	CALL DESCRIBE-CABLES >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?CLOSE /?L11
	EQUAL? PRSA,V?PUT,V?TIE \FALSE
	EQUAL? PRSO,REPEATER-COVER \FALSE
	EQUAL? PRSI,REPEATER \FALSE
?L11:	FSET? REPEATER,OPENBIT \?L12
	FCLEAR REPEATER,OPENBIT
	MOVE REPEATER-COVER,REPEATER
	PRINT STR?379
	RTRUE
?L12:	PRINTR "It's already screwed on tightly."

	.FUNCT DESCRIBE-CABLES
	PRINTI "Most prominent are a socket "
	IN? INPUT-CABLE,INPUT-SOCKET \?L1
	PRINTI "into which the coaxial cable is plugged"
	JUMP ?L3
?L1:	PRINTI "(now empty) next to which a coaxial cable hangs"
?L3:	PRINTI ", and a connector into which the glistening "
	PRINTD OUTPUT-CABLE
	PRINTR " disappears."

	.FUNCT INPUT-CABLE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "This looks like pretty standard coax to you. It appears almost spontaneously from high in the wall, and enters the box, where "
	FSET? REPEATER,OPENBIT \?L3
	PRINTI "it's "
	FSET? INPUT-CABLE,RMUNGBIT \?L7
	IN? INPUT-CABLE,INPUT-SOCKET /?L5
	PRINTR "ends next to an empty socket."
?L5:	FSET? INPUT-CABLE,RMUNGBIT \?L7
	PRINTR "cut."
?L7:	IN? INPUT-CABLE,INPUT-SOCKET /?L8
	PRINTR "hanging loose next to a socket."
?L8:	PRINTR "plugged into the socket."
?L3:	PRINTI "it "
	PRINT STR?380
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?UNPLUG,V?UNTIE \?L11
	IN? INPUT-CABLE,INPUT-SOCKET \?L12
	MOVE INPUT-CABLE,REPEATER
	PRINTR "You unscrew the cable. It now hangs unconnected inside the box."
?L12:	PRINT IT-ALREADY-IS
	RTRUE
?L11:	EQUAL? PRSA,V?TAKE \?L15
	IN? INPUT-CABLE,INPUT-SOCKET \?L16
	CALL NEW-VERB,V?UNTIE
	RTRUE
?L16:	PRINTR "It's threaded through the box: impossible to take."
?L15:	EQUAL? PRSA,V?PLUG,V?TIE,V?PUT \?L19
	EQUAL? PRSO,INPUT-CABLE \?L19
	EQUAL? PRSI,INPUT-SOCKET \?L19
	IN? INPUT-CABLE,INPUT-SOCKET /?L20
	MOVE INPUT-CABLE,INPUT-SOCKET
	PRINT STR?379
	RTRUE
?L20:	PRINT IT-ALREADY-IS
	RTRUE
?L19:	EQUAL? PRSA,V?CUT \FALSE
	FSET? INPUT-CABLE,RMUNGBIT \?L24
	CALL ITS-ALREADY-X,STR?381 >STACK
	RSTACK
?L24:	EQUAL? PRSI,BOLT-CUTTER,AXE \?L26
	FSET INPUT-CABLE,RMUNGBIT
	PRINTR "You neatly snip the cable in two."
?L26:	CALL PRSI-USELESS >STACK
	RSTACK

	.FUNCT INPUT-SOCKET-F
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \FALSE
	IN? INPUT-CABLE,INPUT-SOCKET \?L3
	PRINTR "It has a coaxial cable plugged into it."
?L3:	PRINTR "It's empty."

	.FUNCT OUTPUT-CABLE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	IN? MASS,HERE \?L3
	PRINTI "This is "
	CALL PRINTA,OUTPUT-CABLE
	PRINTI " of the mass in the end of the cave. It enters the box and "
	FSET? OUTPUT-CABLE,RMUNGBIT \?L5
	PRINTI "is cut."
	JUMP ?L8
?L5:	FSET? REPEATER,OPENBIT \?L7
	PRINTI "connects to a connector inside it."
	JUMP ?L8
?L7:	PRINT STR?380
?L8:	PRINTR " The cable twitches periodically."
?L3:	CALL CTHE-PRINT,OUTPUT-CABLE
	PRINT ENDS-IN-STUMP
	PRINTR "."
?L1:	EQUAL? PRSA,V?UNPLUG,V?UNTIE /?L11
	EQUAL? PRSA,V?TAKE \?L10
	EQUAL? PRSO,OUTPUT-CABLE \?L10
?L11:	PRINTR "There is no way to do that. The appendage and its socket blend together indistinguishably."
?L10:	EQUAL? PRSA,V?CUT,V?ATTACK \FALSE
	FSET? OUTPUT-CABLE,RMUNGBIT \?L13
	CALL ITS-ALREADY-X,STR?381
	CALL PRINT-ID,STR?382 >STACK
	RSTACK
?L13:	FSET? REPEATER,OPENBIT /?L15
	PRINTI "The tentacle whips out of your way."
	CRLF
	CALL PRINT-ID,STR?383 >STACK
	RSTACK
?L15:	EQUAL? PRSI,BOLT-CUTTER,AXE \?L16
	FSET OUTPUT-CABLE,RMUNGBIT
	PRINTI "You cut the tentacle in two inside the box, where it can't get away, precipitating a deafening shriek from the direction of the mass."
	CRLF
	CALL PRINT-ID,STR?384 >STACK
	RSTACK
?L16:	CALL PRSI-USELESS >STACK
	RSTACK

	.FUNCT PRSI-USELESS
	CALL CTHE-PRINT-PRSI
	PRINTR " is useless for this purpose."

	.FUNCT HIGH-VOLTAGE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? HIGH-VOLTAGE,RMUNGBIT \?L3
	PRINTR "This is one end of a high voltage power line. The conductors are visible within the slashed outer insulation."
?L3:	FSET? HIGH-VOLTAGE,POWERBIT \?L5
	PRINTR "This is a thick, hard cable. It reminds you of a high voltage power line."
?L5:	PRINTR "It's still under the water."
?L1:	EQUAL? PRSA,V?TAKE /?L8
	EQUAL? PRSA,V?MOVE \?L17
	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L7
?L8:	CALL DEQUEUE,I-HAND-DIVES
	CALL ITAKE >STACK
	EQUAL? STACK,1 \TRUE
	FSET? HIGH-VOLTAGE,RMUNGBIT \?L11
	CALL DEQUEUE,I-LINE-IN-WATER
	FSET? HIGH-VOLTAGE,POWERBIT \?L12
	PRINTR "You carefully grab the line just as it's about to drop into the water."
?L12:	FSET? GLOVES,WEARBIT \?L14
	PRINTR "Taken."
?L14:	CALL PRINT-ID,STR?385
	CALL JIGS-UP,STR?386 >STACK
	RSTACK
?L11:	FSET HIGH-VOLTAGE,POWERBIT
	PRINTR "You pull a length of the line out of the water. It's like holding a large, heavy snake."
?L7:	EQUAL? PRSA,V?MOVE \?L17
	PRINT YOU-CANT
	PRINTR "pull any more of it out."
?L17:	EQUAL? PRSA,V?DROP /?L19
	EQUAL? PRSA,V?PUT \?L18
	EQUAL? PRSI,POOL \?L18
?L19:	MOVE HIGH-VOLTAGE,HERE
	PRINT STR?217
	PRINTI "line."
	FSET? HIGH-VOLTAGE,RMUNGBIT \?L20
	CALL QUEUE,I-LINE-IN-WATER,2
?L20:	CRLF
	RTRUE
?L18:	EQUAL? PRSA,V?RUB \?L23
	EQUAL? PRSI,HIGH-VOLTAGE \?L23
	FSET? HIGH-VOLTAGE,RMUNGBIT \?L23
	CALL PERFORM,V?ATTACK,PRSO,HIGH-VOLTAGE
	RTRUE
?L23:	EQUAL? PRSA,V?CUT,V?ATTACK \?L24
	EQUAL? PRSO,HIGH-VOLTAGE \?L24
	FSET? HIGH-VOLTAGE,RMUNGBIT \?L25
	CALL ITS-ALREADY-X,STR?381
	CALL PRINT-ID,STR?387 >STACK
	RSTACK
?L25:	FSET? HIGH-VOLTAGE,POWERBIT /?L27
	PRINTR "You splash around in the water, to no avail. You can't see the line."
?L27:	EQUAL? PRSI,AXE \?L28
	IGRTR? 'HV-CNT,2 \?L29
	FSET HIGH-VOLTAGE,RMUNGBIT
	MOVE HIGH-VOLTAGE,HERE
	CALL QUEUE,I-LINE-IN-WATER,2
	PRINTI "The line parts! The two ends begin to sink towards the water as they straighten out."
	CRLF
	CALL PRINT-ID,STR?388 >STACK
	RSTACK
?L29:	EQUAL? HV-CNT,2 \?L31
	PRINTI "Your blow cuts through more insulation and into the conductors."
	CRLF
	CALL PRINT-ID,STR?389 >STACK
	RSTACK
?L31:	PRINTI "You strike the line with the axe, making a deep gash in the insulation."
	CRLF
	CALL PRINT-ID,STR?390 >STACK
	RSTACK
?L28:	EQUAL? PRSI,BOLT-CUTTER \?L33
	PRINTI "The jaws of the bolt cutter won't open far enough to fit around the line."
	CRLF
	CALL PRINT-ID,STR?391 >STACK
	RSTACK
?L33:	PRINTI "You'd probably have as much success trying to bite it in two."
	CRLF
	CALL PRINT-ID,STR?392 >STACK
	RSTACK
?L24:	EQUAL? PRSA,V?PUT,V?PLUG,V?TIE \?L35
	EQUAL? PRSO,HIGH-VOLTAGE \?L35
	EQUAL? PRSI,INPUT-SOCKET \?L35
	FSET? HIGH-VOLTAGE,RMUNGBIT /?L36
	PRINTR "There's no end to the line that you could plug in."
?L36:	FIRST? INPUT-SOCKET >STACK \?L38
	PRINTI "There's already "
	FIRST? INPUT-SOCKET >STACK /?L39
?L39:	CALL PRINTA,STACK
	PRINTR " in the socket."
?L38:	PRINTI "You shove the exposed conductors into the socket, producing a shower of sparks!"
	FSET? GLOVES,WEARBIT /?L41
	MOVE HIGH-VOLTAGE,HERE
	CALL QUEUE,I-LINE-IN-WATER,2
	PRINTI " The sparks burn your hands! You jerk back, dropping the line!"
	CRLF
	CALL PRINT-ID,STR?393 >STACK
	RSTACK
?L41:	FSET? BOOTS,WEARBIT /?L43
	CALL PRINT-ID,STR?394
	CALL JIGS-UP,STR?395 >STACK
	RSTACK
?L43:	FSET? OUTPUT-CABLE,RMUNGBIT \?L44
	MOVE HIGH-VOLTAGE,INPUT-SOCKET
	PRINTR " The stump of the tentacle still connected to the connector shrivels and fries."
?L44:	CALL QUEUED?,I-FROB-APPEARS >STACK
	ZERO? STACK \TRUE
	MOVE HIGH-VOLTAGE,INPUT-SOCKET
	CALL DEQUEUE,I-HACKER-RETURNS
	CALL QUEUE,I-FROB-APPEARS,-1
	PRINTI " The tentacle connected to the other socket begins to jerk and twitch spasmodically. The mass it's connected to quivers, and a horrible noise, almost like a huge machine running without oil, issues from the thing."
	FSET? HACKER,INVISIBLE /?L46
	PRINTI " The hacker screams soundlessly and drops into the water."
?L46:	CRLF
	CRLF
	PRINTR "The mass begins to change shape, compacting, darkening. You can briefly see human outlines within the grey, gelatinous mass. They surround something larger, of a shape not human, not animal, like nothing you've seen before."
?L35:	EQUAL? PRSA,V?FOLLOW \FALSE
	FSET? HIGH-VOLTAGE,POWERBIT \FALSE
	PRINTR "Both ends of the line disappear into the water and mud of the lair."

	.FUNCT I-LINE-IN-WATER
	CRLF
	FSET? HIGH-VOLTAGE,POWERBIT \?L1
	PRINTI "The exposed ends of the high voltage line drop into the water! "
	FCLEAR HIGH-VOLTAGE,POWERBIT
?L1:	FSET? BOOTS,WEARBIT /?L4
	CALL PRINT-ID,STR?396
	CALL JIGS-UP,STR?397 >STACK
	RSTACK
?L4:	CALL QUEUE,I-LINE-IN-WATER,-1
	PRINTR "Sparks and bubbles burst from the electrified water."

	.FUNCT POOL-F
	EQUAL? PRSA,V?SWIM,V?THROUGH,V?BOARD /?L3
	EQUAL? PRSA,V?STAND-ON,V?LEAP,V?WALK-AROUND \?L1
?L3:	PRINT ALREADY-IN-IT
	PRINTR " It covers most of the floor!"
?L1:	EQUAL? PRSA,V?PUT-UNDER \?L4
	CALL CTHE-PRINT-PRSO
	PRINTR " gets wet."
?L4:	EQUAL? HERE,INNER-LAIR \?L5
	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTR "The floor is covered by a pool of stagnant water. Near your feet there is a slightly deeper part that seems to have something in it."
?L6:	EQUAL? PRSA,V?DRINK,V?DRINK-FROM,V?FILL \?L8
	PRINTI "You couldn't bear to drink the water from this pool."
	CRLF
	EQUAL? PRSA,V?FILL /?L9
	PUSH 1
	JUMP ?L10
?L9:	PUSH 0
?L10:	CALL PRINT-ID,STR?398,STACK >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?LOOK-INSIDE \?L11
	PRINT YOU-CANT-SEE
	PRINTR "a thing, as the water is foul and murky."
?L11:	EQUAL? PRSA,V?REACH-IN,V?SEARCH \?L12
	LOC HIGH-VOLTAGE >STACK
	ZERO? STACK /?L13
	PRINT YOU-FIND-NOTHING
	PRINTR " you would wish to touch again."
?L13:	PRINT STR?351
	PRINTI "blindly in the gooey, slimy water. "
	CALL QUEUED?,I-HAND-DIVES >STACK
	ZERO? STACK /?L16
	CALL DEQUEUE,I-HAND-DIVES
	MOVE HIGH-VOLTAGE,HERE
	PRINT STR?138
	PRINTI "thick and slippery! A tentacle? No, it's cold and dead. "
	PRINT IT-SEEMS-TO-BE
	PRINTR "a line of some kind, just below the surface."
?L16:	PRINT YOU-FIND-NOTHING
	PRINTR "."
?L12:	EQUAL? PRSA,V?CROSS \FALSE
	CALL PERFORM,V?THROUGH,MASS
	RTRUE
?L5:	EQUAL? PRSA,V?EXAMINE \?L22
	PRINTR "It's a pool of rather yucky water."
?L22:	EQUAL? PRSA,V?LOOK-INSIDE \?L24
	PRINTR "It's about as clear as mud."
?L24:	EQUAL? PRSA,V?REACH-IN \FALSE
	PRINTR "It feels greasy, cold, and generally unpleasant."

	.FUNCT FROB-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "It is not from any wholesome place. It is the stuff of nightmares. It is the thing that waits in the dark, the thing that scratches at your windows late at night. It is not death, for next to this, death is a friend to be cherished."
?L1:	EQUAL? PRSA,V?THROW \?L3
	EQUAL? PRSO,SMOOTH-STONE \?L3
	EQUAL? PRSI,FROB \?L3
	EQUAL? END-CNT,1 \?L4
	REMOVE SMOOTH-STONE
	PRINTI "The stone hurtles through the air and is swallowed by the black nothing at its center. The creature howls in pain!"
	CRLF
	CALL PRINT-ID,STR?399 >STACK
	RSTACK
?L4:	EQUAL? END-CNT,2 \FALSE
	REMOVE FROB
	PRINTI "The stone smashes into the creature, sticking to its ichorous hide. The thing thrashes about, trying to bite at the stone, which is glowing brighter and brighter. Small hands issue from beneath its scales to tug in vain at the irritant. The creature begins to show gaping holes of dark, light-devouring nothingness around the stone. Its wings spread painfully, as though it were trying to fly away, and then fold. It widens its jaw in an almost human scream of agony. The black hole of its maw overwhelms it, and indeed the creature appears to be swallowing itself. At last, a grey cloud of greasy smoke surrounds the glowing stone, still suspended in midair. Then even that vanishes, and the stone drops to the ground, no longer glowing. The thing is gone."
	CRLF
	CALL PRINT-ID,STR?400
	MOVE SMOOTH-STONE,HERE
	FCLEAR SMOOTH-STONE,TOUCHBIT
	SET 'SCORE,100
	RETURN SCORE
?L3:	EQUAL? PRSA,V?RUB \?L10
	EQUAL? PRSO,FROB \?L10
	EQUAL? PRSI,SMOOTH-STONE /?L9
?L10:	EQUAL? PRSA,V?ATTACK \?L8
	EQUAL? PRSO,FROB \?L8
	EQUAL? PRSI,HIGH-VOLTAGE \?L8
?L9:	PRINT YOU-CANT
	PRINTI "force yourself to get that close to it."
	CRLF
	CALL PRINT-ID,STR?401 >STACK
	RSTACK
?L8:	CALL HOSTILE-VERB? >STACK
	ZERO? STACK /FALSE
	PRINTI "Defiantly, the creature shrugs off your puny attack."
	CRLF
	CALL PRINT-ID,STR?402 >STACK
	RSTACK

	.FUNCT I-FROB-APPEARS
	INC 'END-CNT
	EQUAL? END-CNT,1 \?L1
	REMOVE HACKER
	REMOVE MASS
	FSET OUTPUT-CABLE,RMUNGBIT
	ADD SCORE,5 >SCORE
	MOVE FROB,HERE
	CRLF
	PRINTI "The gelatinous mass solidifies and compacts, leaving behind a litter of smoking debris. In the debris squats a being. Huge, misshapen, it stares at you with baleful yellow eyes. Its scaly wings beat slowly, driving a fetid stench through the stale air of the cavern. A barbed tongue slides across its broken, daggerlike fangs."
	CALL HELD?,SMOOTH-STONE >STACK
	ZERO? STACK /?L3
	CRLF
	CRLF
	CALL CTHE-PRINT,SMOOTH-STONE
	PRINTI " vibrates. It starts to feel warm."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? END-CNT,2 \?L6
	CRLF
	PRINTI "The thing tenses, preparing to leap. Its mouth opens, revealing not the glistening interior, but a dead-black outline like a hole into nothingness."
	CALL HELD?,SMOOTH-STONE >STACK
	ZERO? STACK /?L7
	CRLF
	CRLF
	CALL CTHE-PRINT,SMOOTH-STONE
	PRINTI " is now glowing with a bright-red heat that nevertheless fails to burn you."
?L7:	CRLF
	RTRUE
?L6:	EQUAL? END-CNT,3 \FALSE
	LOC FROB >STACK
	ZERO? STACK /FALSE
	CRLF
	PRINTI "The creature leaps, a mountain falling on you, and the darkness swallows you, never to brighten again."
	CALL PRINT-ID,STR?403
	CALL HELD?,SMOOTH-STONE >STACK
	ZERO? STACK /?L13
	CRLF
	CRLF
	CALL CTHE-PRINT,SMOOTH-STONE
	PRINTI ", all that's left where you were standing, drops quietly into the pool."
?L13:	CALL JIGS-UP,0
	RETURN M-FATAL

	.FUNCT BOOTS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "They are well-used rubber boots."
?L1:	EQUAL? PRSA,V?WEAR \FALSE
	CALL IWEAR >STACK
	EQUAL? STACK,1 \TRUE
	PRINTR "Snug, but okay."

	.FUNCT IWEAR
	FSET? PRSO,WEARBIT \?L1
	PRINT YOU-ARE
	PRINT PERIOD
	RFALSE
?L1:	CALL HELD?,PRSO >STACK
	ZERO? STACK \?L3
	PRINT YOU-ARENT
	PRINTI " holding that!"
	CRLF
	RFALSE
?L3:	MOVE PRSO,WINNER
	FSET PRSO,WEARBIT
	RTRUE

	.INSERT "annotated_games/lurkinghorror/lurkinghorror_str"
	.END
