	.INSERT "./annotated_games/stationfall/stationfall_freq"
	.INSERT "./annotated_games/stationfall/stationfall_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	PRINTD OBJ
	RTRUE

	.FUNCT PRINT-ID,ID,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	CALL PRINT-DESC1,PRSO
	PRINTI ", PRSI: "
	CALL PRINT-DESC1,PRSI
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION=1
	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-THEFT?
	EQUAL? PRSA,V?TAKE \FALSE
	EQUAL? PRSO,LOG-READER,LOG-TAPE,KEY /TRUE
	EQUAL? PRSO,PUCE-SPOOL,DIODE-M,DETONATOR /TRUE
	EQUAL? PRSO,BLACKENED-DIODE,DRILL,SMALL-BIT /TRUE
	EQUAL? PRSO,DIARY,TWENTY-PRONG-FROMITZ-BOARD,NOTE /TRUE
	EQUAL? PRSO,CRYSTAL-BALL,HEADLAMP,TAFFY /TRUE
	EQUAL? PRSO,TWELVE-PRONG-FROMITZ-BOARD,DIODE-J,SPACESUIT /TRUE
	EQUAL? PRSO,BOOK,PAPER,PLATINUM-DETECTOR /TRUE
	EQUAL? PRSO,EXPLOSIVE,SPRAY-CAN,STRONG-BOX /TRUE
	EQUAL? PRSO,LETTER,COIN,ID-CHANGER \FALSE
	RTRUE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? PRSO,AIRLOCK-OBJECT,AUTO-DOOR,BALLOON /TRUE
	EQUAL? PRSO,BED,BEDISTOR,BLACKENED-DIODE /TRUE
	EQUAL? PRSO,BOOK,BOOTS,CAGE /TRUE
	EQUAL? PRSO,CALL-BUTTON,CEILING,COFFEE /TRUE
	EQUAL? PRSO,COIN,COPILOT-SEAT,COUNTER /TRUE
	EQUAL? PRSO,CRUMPLED-FORM,CRYSTAL-BALL,CUBICLE /TRUE
	EQUAL? PRSO,DESK,DETONATOR,DIARY /TRUE
	EQUAL? PRSO,DICE,DIODE-J,DIODE-M /TRUE
	EQUAL? PRSO,DISPENSER,DRILL,DRILLED-HOLE /TRUE
	EQUAL? PRSO,DRYER,ELEVATOR-OBJECT,ELEVATOR-SHAFT /TRUE
	EQUAL? PRSO,EQUIPMENT,ETERNAL-FLAME,EXERCISE-MACHINE /TRUE
	EQUAL? PRSO,EXPLOSIVE,FIXTURES,FOIL /TRUE
	EQUAL? PRSO,FOOD-KIT,FORKLIFT,FPU /TRUE
	EQUAL? PRSO,GARBAGE,GRATING,GRAY-GOO /TRUE
	EQUAL? PRSO,HEADLAMP,HEATING-CHAMBER,HOLDING-TANK /TRUE
	EQUAL? PRSO,HOUSING,ID-CHANGER,ID-READER /TRUE
	EQUAL? PRSO,INNER-AIRLOCK-DOOR,INSTRUCTION-SHEET,IRIS-HATCH /TRUE
	EQUAL? PRSO,JAMMER,KEY,KEYPAD /TRUE
	EQUAL? PRSO,LADDER,LARGE-BIT,LEASH /TRUE
	EQUAL? PRSO,LETTER,LILAC-SPOOL,LOCKER /TRUE
	EQUAL? PRSO,LOG-READER,LOG-TAPE,MAGAZINES /TRUE
	EQUAL? PRSO,MAUVE-SPOOL,MEDIUM-BIT,NANOFILM-READER /TRUE
	EQUAL? PRSO,NECTAR,NOTE,ORANGE-GOO /TRUE
	EQUAL? PRSO,OSTRICH-NIP,OUTER-AIRLOCK-DOOR,PALLETS /TRUE
	EQUAL? PRSO,PANEL,PAPER,PATTERN-OF-DOTS /TRUE
	EQUAL? PRSO,PEDESTAL,PILOT-SEAT,PLASTIC-BAG /TRUE
	EQUAL? PRSO,PLATINUM-DETECTOR,PRESSER,PUCE-SPOOL /TRUE
	EQUAL? PRSO,PULPIT,PYRAMID,RADIO /TRUE
	EQUAL? PRSO,ROULETTE-WHEEL,SAFE,SCULPTURE /TRUE
	EQUAL? PRSO,SECURITY-DOOR,SHRUBBERY,SIGN /TRUE
	EQUAL? PRSO,SIMULATION-BOOTH,SKELETON,SMALL-BIT /TRUE
	EQUAL? PRSO,SOUP,SPACESUIT,SPACETRUCK-HATCH /TRUE
	EQUAL? PRSO,SPACETRUCK-OBJECT,SPRAY-CAN,STAR /TRUE
	EQUAL? PRSO,STRONG-BOX,STUN-GUN,SWITCH /TRUE
	EQUAL? PRSO,SYSTEM-MONITORS,TAFFY,THERMOS /TRUE
	EQUAL? PRSO,TIMER,TRASH-CAN,TWELVE-PRONG-FROMITZ-BOARD /TRUE
	EQUAL? PRSO,TWENTY-PRONG-FROMITZ-BOARD,VALIDATION-STAMP,VILLAGE /TRUE
	EQUAL? PRSO,VILLAGE-FORM,VOLUME,WALLS /TRUE
	EQUAL? PRSO,WARDROBE,WELDER,WINDOW /TRUE
	EQUAL? PRSO,ZAPGUN \FALSE
	RTRUE

	.FUNCT IS-PERSON?
	EQUAL? PRSO,EVERYONE,FLOYD,HELEN /TRUE
	EQUAL? PRSO,HIM,OLIVER,PLATO /TRUE
	EQUAL? PRSO,PROTAGONIST,REX \FALSE
	RTRUE

	.FUNCT IS-ANIMAL?
	EQUAL? PRSO,GRUE,OSTRICH \FALSE
	RTRUE

	.FUNCT IS-SELF?
	EQUAL? PRSO,ME \FALSE
	RTRUE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? PRSO,HANDS,TONGUE \FALSE
	RTRUE

	.FUNCT IS-SELF-OR-PART-OF-SELF?,?TMP
	CALL IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-PART-OF-SELF? >STACK
	RSTACK

	.FUNCT IS-YOUR-PROPERTY?
	EQUAL? PRSO,ASSIGNMENT-COMPLETION-FORM,ROBOT-USE-AUTHORIZATION-FORM,CLASS-THREE-SPACECRAFT-ACTIVATION-FORM /TRUE
	EQUAL? PRSO,CHRONOMETER,PATROL-UNIFORM,ID-CARD \FALSE
	RTRUE

	.FUNCT DANGEROUS-DRINK?
	EQUAL? PRSO,GRAY-GOO,ORANGE-GOO \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?
	CALL IS-PART-OF-SELF? >STACK
	ZERO? STACK \?L2
	CALL IS-OBJECT-OR-PROPERTY? >STACK
	ZERO? STACK /FALSE
?L2:	EQUAL? PRSO,SOUP,TAFFY,NECTAR \TRUE
	RFALSE

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL IS-ANIMAL? >STACK
	RSTACK

	.FUNCT PICK-ONE,TBL,LENGTH,CNT,RND,MSG,RFROB
	GET TBL,0 >LENGTH
	GET TBL,1 >CNT
	DEC 'LENGTH
	ADD TBL,2 >TBL
	MUL CNT,2 >STACK
	ADD TBL,STACK >RFROB
	SUB LENGTH,CNT >STACK
	RANDOM STACK >RND
	GET RFROB,RND >MSG
	GET RFROB,1 >STACK
	PUT RFROB,RND,STACK
	PUT RFROB,1,MSG
	INC 'CNT
	EQUAL? CNT,LENGTH \?L1
	SET 'CNT,0
?L1:	PUT TBL,0,CNT
	RETURN MSG

	.FUNCT APRINT,OBJ
	FSET? OBJ,NARTICLEBIT \?L1
	PRINTI " "
	JUMP ?L4
?L1:	FSET? OBJ,VOWELBIT \?L3
	PRINTI " an "
	JUMP ?L4
?L3:	PRINTI " a "
?L4:	PRINTD OBJ
	RTRUE

	.FUNCT TPRINT,OBJ
	FSET? OBJ,NARTICLEBIT \?L1
	PRINTI " "
	JUMP ?L3
?L1:	PRINTI " the "
?L3:	PRINTD OBJ
	RTRUE

	.FUNCT TPRINT-PRSO
	CALL TPRINT,PRSO >STACK
	RSTACK

	.FUNCT TPRINT-PRSI
	CALL TPRINT,PRSI >STACK
	RSTACK

	.FUNCT ARPRINT,OBJ
	CALL APRINT,OBJ
	PRINT PERIOD-CR
	RTRUE

	.FUNCT TRPRINT,OBJ
	CALL TPRINT,OBJ
	PRINT PERIOD-CR
	RTRUE

	.FUNCT GO
START::
?L0:	SET 'WINNER,PROTAGONIST
	SET 'HERE,DECK-TWELVE
	RANDOM 1220 >STACK
	ADD 4430,STACK >INTERNAL-MOVES
	SET 'MOVES,INTERNAL-MOVES
	SUB 8100,INTERNAL-MOVES >STACK
	CALL QUEUE,I-SLEEP-WARNINGS,STACK
	CALL QUEUE,I-HUNGER-WARNINGS,1330
	CALL QUEUE,I-BLATHER,-1
	PRINTI "It's been five years since your planetfall on Resida. Your heroics in saving that doomed world resulted in a big promotion, but your life of dull scrubwork has been replaced by a life of dull paperwork. Today you find yourself amidst the administrative maze of Deck Twelve on a typically exciting task: an emergency mission to Space Station Gamma Delta Gamma 777-G 59/59 Sector Alpha-Mu-79 to pick up a supply of "
	PRINT FORM-NAME
	PRINT ELLIPSIS
	CALL V-VERSION
	USL
	CRLF
	CALL V-LOOK
	CALL MAIN-LOOP
	JUMP ?L0

	.FUNCT MAIN-LOOP,TRASH
?L1:	CALL MAIN-LOOP-1 >TRASH
	JUMP ?L1

	.FUNCT MAIN-LOOP-1,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP
	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	CALL PARSER >P-WON
	ZERO? P-WON /?L1
	GET P-PRSI,P-MATCHLEN >ICNT
	GET P-PRSO,P-MATCHLEN >OCNT
	EQUAL? PRSA,V?WALK /?L3
	ZERO? P-IT-OBJECT /?L3
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L3
	SET 'TMP,0
?L5:	IGRTR? 'CNT,ICNT /?L6
	GET P-PRSI,CNT >STACK
	EQUAL? STACK,IT \?L5
	PUT P-PRSI,CNT,P-IT-OBJECT
	SET 'TMP,1
?L6:	ZERO? TMP \?L16
	SET 'CNT,0
?L15:	IGRTR? 'CNT,OCNT /?L16
	GET P-PRSO,CNT >STACK
	EQUAL? STACK,IT \?L15
	PUT P-PRSO,CNT,P-IT-OBJECT
?L16:	SET 'CNT,0
?L3:	ZERO? OCNT \?L25
	SET 'NUM,OCNT
	JUMP ?L33
?L25:	GRTR? OCNT,1 \?L27
	SET 'TBL,P-PRSO
	ZERO? ICNT \?L28
	SET 'OBJ,0
	JUMP ?L30
?L28:	GET P-PRSI,1 >OBJ
?L30:	SET 'NUM,OCNT
	JUMP ?L33
?L27:	GRTR? ICNT,1 \?L31
	SET 'PTBL,0
	SET 'TBL,P-PRSI
	GET P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L33
?L31:	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	EQUAL? STACK,2 \?L32
	SET 'NUM,ICNT
	JUMP ?L33
?L32:	SET 'NUM,1
?L33:	ZERO? OBJ \?L34
	EQUAL? ICNT,1 \?L34
	GET P-PRSI,1 >OBJ
?L34:	EQUAL? PRSA,V?WALK \?L37
	CALL PERFORM,PRSA,PRSO >V
	JUMP ?L54
?L37:	ZERO? NUM \?L39
	GETB P-SYNTAX,P-SBITS >STACK
	BAND STACK,P-SONUMS >STACK
	ZERO? STACK \?L40
	CALL PERFORM,PRSA >V
	SET 'PRSO,0
	JUMP ?L54
?L40:	ZERO? LIT \?L42
	PRINT TOO-DARK
	CRLF
	CALL STOP
	JUMP ?L54
?L42:	PRINTI "There isn't anything to "
	GET P-ITBL,P-VERBN >TMP
	EQUAL? PRSA,V?TELL \?L44
	PRINTI "talk to"
	JUMP ?L48
?L44:	ZERO? P-OFLAG \?L47
	ZERO? P-MERGED /?L46
?L47:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L48
?L46:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L48:	PRINTI "!"
	CRLF
	SET 'V,0
	CALL STOP
	JUMP ?L54
?L39:	SET 'P-NOT-HERE,0
	SET 'P-MULT,0
	GRTR? NUM,1 \?L50
	SET 'P-MULT,1
?L50:	SET 'TMP,0
?L53:	IGRTR? 'CNT,NUM \?L55
	GRTR? P-NOT-HERE,0 \?L57
	PRINTI "[The "
	EQUAL? P-NOT-HERE,NUM /?L59
	PRINTI "other "
?L59:	PRINTI "object"
	EQUAL? P-NOT-HERE,1 /?L62
	PRINTI "s"
?L62:	PRINTI " that you mentioned "
	EQUAL? P-NOT-HERE,1 /?L65
	PRINTI "are"
	JUMP ?L67
?L65:	PRINTI "is"
?L67:	PRINTI "n't here.]"
	CRLF
	JUMP ?L54
?L57:	ZERO? TMP \?L54
	CALL REFERRING
	JUMP ?L54
?L55:	ZERO? PTBL /?L71
	GET P-PRSO,CNT >OBJ1
	JUMP ?L73
?L71:	GET P-PRSI,CNT >OBJ1
?L73:	ZERO? PTBL /?L74
	SET 'PRSO,OBJ1
	JUMP ?L76
?L74:	SET 'PRSO,OBJ
?L76:	ZERO? PTBL /?L77
	SET 'PRSI,OBJ
	JUMP ?L79
?L77:	SET 'PRSI,OBJ1
?L79:	GRTR? NUM,1 /?L82
	GET P-ITBL,P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL,W?BOTH,W?EVERYT \?L85
?L82:	CALL DONT-ALL,OBJ1 >STACK
	ZERO? STACK \?L53
	EQUAL? OBJ1,IT \?L86
	PRINTD P-IT-OBJECT
	JUMP ?L89
?L86:	EQUAL? OBJ1,HIM \?L88
	PRINTD P-HIM-OBJECT
	JUMP ?L89
?L88:	PRINTD OBJ1
?L89:	PRINTI ": "
?L85:	SET 'TMP,1
	CALL PERFORM,PRSA,PRSO,PRSI >V
	EQUAL? V,M-FATAL \?L53
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
?L54:	EQUAL? V,M-FATAL \?L94
	SET 'P-CONT,0
?L94:	CALL CLOCKER-VERB? >STACK
	ZERO? STACK /?L97
	EQUAL? PRSA,V?TELL /?L97
	ZERO? P-WON /?L97
	CALL RUNNING?,I-SPACETRUCK >STACK
	ZERO? STACK /?L99
	LESS? SPACETRUCK-COUNTER,5 \?L99
	SET 'C-ELAPSED,240
?L99:	GETP HERE,P?ACTION >STACK
	CALL STACK,M-END >V
	JUMP ?L103
?L97:	SET 'C-ELAPSED,0
	JUMP ?L103
?L1:	SET 'P-CONT,0
?L103:	ZERO? P-WON /?L104
	ADD INTERNAL-MOVES,C-ELAPSED >INTERNAL-MOVES
	FSET? CHRONOMETER,WORNBIT \?L106
	LESS? DAY,3 \?L108
	SET 'MOVES,INTERNAL-MOVES
	JUMP ?L111
?L108:	SET 'MOVES,9947
	JUMP ?L111
?L106:	SET 'MOVES,0
?L111:	ZERO? C-ELAPSED /?L112
	CALL CLOCKER >V
?L112:	SET 'POSTPONE-ATTACK,0
	SET 'FLOYD-TRYTAKEN,0
	SET 'P-PRSA-WORD,0
	SET 'P-NUMBER,0
	SET 'PRSA,0
	SET 'PRSO,0
	SET 'PRSI,0
?L104:	SET 'C-ELAPSED,7
	RETURN C-ELAPSED

	.FUNCT DONT-ALL,OBJ1,L
	LOC OBJ1 >L
	EQUAL? OBJ1,NOT-HERE-OBJECT \?L1
	INC 'P-NOT-HERE
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L3
	ZERO? PRSI /?L3
	IN? PRSO,PRSI \TRUE
?L3:	CALL ACCESSIBLE?,OBJ1 >STACK
	ZERO? STACK /TRUE
	EQUAL? P-GETFLAGS,P-ALL \FALSE
	ZERO? PRSI /?L6
	EQUAL? PRSO,PRSI /TRUE
?L6:	EQUAL? PRSA,V?TAKE \?L8
	FSET? OBJ1,TAKEBIT /?L9
	FSET? OBJ1,TRYTAKEBIT \TRUE
?L9:	EQUAL? L,WINNER,HERE,PRSI /?L11
	LOC WINNER >STACK
	EQUAL? L,STACK /?L11
	FSET? L,SURFACEBIT \TRUE
	FSET? L,TAKEBIT /TRUE
	RFALSE
?L11:	ZERO? PRSI \FALSE
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /FALSE
	RTRUE
?L8:	EQUAL? PRSA,V?PUT-ON,V?PUT,V?DROP /?L18
	EQUAL? PRSA,V?SGIVE,V?GIVE \?L17
?L18:	IN? OBJ1,WINNER \TRUE
?L17:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	IN? PRSO,WINNER /FALSE
	CALL ULTIMATELY-IN?,PRSO,PRSI >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT CLOCKER-VERB?
	EQUAL? PROTAGONIST,WINNER \TRUE
	EQUAL? PRSA,V?SCORE,V?HELP,V?VERSION /FALSE
	EQUAL? PRSA,V?$0024COMMAND,V?$0024UNRECORD,V?$0024RECORD /FALSE
	EQUAL? PRSA,V?RESTORE,V?SAVE,V?$0024RANDOM /FALSE
	EQUAL? PRSA,V?SCRIPT,V?QUIT,V?RESTART /FALSE
	EQUAL? PRSA,V?SUPER-BRIEF,V?BRIEF,V?UNSCRIPT /FALSE
	EQUAL? PRSA,V?VERBOSE \TRUE
	RFALSE

	.FUNCT FAKE-ORPHAN,IT-WAS-USED=0,TMP
	CALL ORPHAN,P-SYNTAX,0
	GET P-OTBL,P-VERBN >TMP
	PRINTI "[Be specific: Wh"
	ZERO? IT-WAS-USED /?L1
	PRINTI "at object"
	JUMP ?L3
?L1:	PRINTI "o"
?L3:	PRINTI " do you want to "
	ZERO? TMP \?L4
	PRINTI "tell"
	JUMP ?L7
?L4:	GETB P-VTBL,2 >STACK
	ZERO? STACK \?L6
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L7
?L6:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB P-VTBL,2,0
?L7:	SET 'P-OFLAG,1
	SET 'P-WON,0
	GETB P-SYNTAX,P-SPREP1 >STACK
	CALL PREP-PRINT,STACK
	PRINTR "?]"

	.FUNCT PERFORM,A,O=0,I=0,V,OA,OO,OI
	SET 'OA,PRSA
	SET 'OO,PRSO
	SET 'OI,PRSI
	SET 'PRSA,A
	ZERO? P-WALK-DIR \?L22
	EQUAL? IT,O,I \?L8
	CALL VISIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L3
	EQUAL? IT,O \?L5
	SET 'O,P-IT-OBJECT
	JUMP ?L8
?L5:	SET 'I,P-IT-OBJECT
	JUMP ?L8
?L3:	ZERO? I \?L9
	CALL FAKE-ORPHAN,1
	RETURN 8
?L9:	CALL REFERRING
	RETURN 8
?L8:	ZERO? P-WALK-DIR \?L22
	EQUAL? HIM,O,I \?L22
	CALL VISIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK /?L17
	EQUAL? HIM,O \?L19
	SET 'O,P-HIM-OBJECT
	JUMP ?L22
?L19:	SET 'I,P-HIM-OBJECT
	JUMP ?L22
?L17:	ZERO? I \?L23
	CALL FAKE-ORPHAN
	RETURN 8
?L23:	CALL REFERRING,1
	RETURN 8
?L22:	SET 'PRSO,O
	SET 'PRSI,I
	EQUAL? A,V?WALK /?L29
	EQUAL? NOT-HERE-OBJECT,PRSO,PRSI \?L29
	CALL D-APPLY,STR?58,NOT-HERE-OBJECT-F >V
	ZERO? V /?L29
	SET 'P-WON,0
	JUMP ?L37
?L29:	SET 'O,PRSO
	SET 'I,PRSI
	CALL THIS-IS-IT,PRSI
	CALL THIS-IS-IT,PRSO
	GETP WINNER,P?ACTION >STACK
	CALL D-APPLY,STR?59,STACK >V
	ZERO? V \?L37
	GET PREACTIONS,A >STACK
	CALL D-APPLY,STR?60,STACK >V
	ZERO? V \?L37
	ZERO? I /?L35
	GETP I,P?ACTION >STACK
	CALL D-APPLY,STR?61,STACK >V
	ZERO? V \?L37
?L35:	ZERO? O /?L36
	EQUAL? A,V?WALK /?L36
	GETP O,P?ACTION >STACK
	CALL D-APPLY,STR?62,STACK >V
	ZERO? V \?L37
?L36:	GET ACTIONS,A >STACK
	CALL D-APPLY,0,STACK >V
	ZERO? V /?L37
?L37:	SET 'PRSA,OA
	SET 'PRSO,OO
	SET 'PRSI,OI
	RETURN V

	.FUNCT D-APPLY,STR,FCN,FOO=0,RES
	ZERO? FCN /FALSE
	ZERO? FOO /?L4
	CALL FCN,FOO >RES
	RETURN RES
?L4:	CALL FCN >RES
	RETURN RES

	.FUNCT DEQUEUE,RTN
	CALL QUEUED?,RTN >RTN
	ZERO? RTN /FALSE
	PUT RTN,C-RTN,0
	RTRUE

	.FUNCT QUEUED?,RTN,C,E
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E /FALSE
	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L8
	GET C,C-TICK >STACK
	ZERO? STACK /FALSE
	RETURN C
?L8:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT RUNNING?,RTN,C,E
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E /FALSE
	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L9
	GET C,C-TICK >STACK
	ZERO? STACK /FALSE
	GET C,C-TICK >STACK
	GRTR? STACK,1 \TRUE
	RFALSE
?L9:	ADD C,C-INTLEN >C
	JUMP ?L1

	.FUNCT QUEUE,RTN,TICK,C,E,INT=0
	ADD C-TABLE,C-TABLELEN >E
	ADD C-TABLE,C-INTS >C
?L1:	EQUAL? C,E \?L3
	ZERO? INT /?L5
	SET 'C,INT
	JUMP ?L7
?L5:	LESS? C-INTS,C-INTLEN \?L8
	PRINTI "Bug2"
	CRLF
?L8:	SUB C-INTS,C-INTLEN >C-INTS
	LESS? C-INTS,C-MAXINTS \?L11
	SET 'C-MAXINTS,C-INTS
?L11:	ADD C-TABLE,C-INTS >INT
?L7:	PUT INT,C-RTN,RTN
	JUMP ?L2
?L3:	GET C,C-RTN >STACK
	EQUAL? STACK,RTN \?L14
	SET 'INT,C
	JUMP ?L2
?L14:	GET C,C-RTN >STACK
	ZERO? STACK \?L15
	SET 'INT,C
?L15:	ADD C,C-INTLEN >C
	JUMP ?L1
?L2:	GRTR? INT,CLOCK-HAND \?L17
	ADD TICK,3 >STACK
	SUB 0,STACK >TICK
?L17:	PUT INT,C-TICK,TICK
	RETURN INT

	.FUNCT CLOCKER,E,TICK,RTN,FLG=0,Q?=0,OWINNER,X
	ADD C-TABLE,C-INTS >CLOCK-HAND
	ADD C-TABLE,C-TABLELEN >E
	SET 'OWINNER,WINNER
	SET 'WINNER,PROTAGONIST
?L1:	EQUAL? CLOCK-HAND,E \?L3
	SET 'CLOCK-HAND,E
	SET 'WINNER,OWINNER
	RETURN FLG
?L3:	GET CLOCK-HAND,C-RTN >STACK
	ZERO? STACK /?L26
	GET CLOCK-HAND,C-TICK >TICK
	LESS? TICK,-1 \?L6
	SUB 0,TICK >STACK
	SUB STACK,3 >STACK
	PUT CLOCK-HAND,C-TICK,STACK
	SET 'Q?,CLOCK-HAND
	JUMP ?L26
?L6:	ZERO? TICK /?L26
	GRTR? TICK,0 \?L9
	SUB TICK,C-ELAPSED >TICK
	LESS? TICK,0 \?L11
	SET 'TICK,0
?L11:	PUT CLOCK-HAND,C-TICK,TICK
?L9:	ZERO? TICK /?L15
	SET 'Q?,CLOCK-HAND
?L15:	GRTR? TICK,0 /?L26
	GET CLOCK-HAND,C-RTN >RTN
	ZERO? TICK \?L20
	PUT CLOCK-HAND,C-RTN,0
?L20:	CALL RTN >X
	ZERO? X /?L23
	SET 'FLG,1
?L23:	ZERO? Q? \?L26
	GET CLOCK-HAND,C-RTN >STACK
	ZERO? STACK /?L26
	SET 'Q?,1
?L26:	ADD CLOCK-HAND,C-INTLEN >CLOCK-HAND
	ZERO? Q? \?L1
	ADD C-INTS,C-INTLEN >C-INTS
	JUMP ?L1

	.FUNCT THIS-IS-IT,OBJ
	ZERO? OBJ /TRUE
	EQUAL? PRSA,V?WALK \?L4
	EQUAL? PRSO,OBJ /TRUE
?L4:	EQUAL? OBJ,PROTAGONIST,NOT-HERE-OBJECT,ME /TRUE
	EQUAL? OBJ,GLOBAL-ROOM /TRUE
	FSET? OBJ,ACTORBIT /?L6
	EQUAL? OBJ,OLIVER \?L5
?L6:	SET 'P-HIM-OBJECT,OBJ
	RETURN P-HIM-OBJECT
?L5:	SET 'P-IT-OBJECT,OBJ
	RETURN P-IT-OBJECT

	.FUNCT PARSER,PTR=P-LEXSTART,WRD,VAL=0,VERB=0,OMERGED,OWINNER,OLEN,LEN,DIR=0,NW=0,LW=0,CNT=-1
?L1:	IGRTR? 'CNT,P-ITBLLEN /?L2
	ZERO? P-OFLAG \?L6
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
?L6:	PUT P-ITBL,CNT,0
	JUMP ?L1
?L2:	SET 'OMERGED,P-MERGED
	SET 'OWINNER,WINNER
	SET 'P-ADVERB,0
	SET 'P-MERGED,0
	SET 'P-END-ON-PREP,0
	PUT P-PRSO,P-MATCHLEN,0
	PUT P-PRSI,P-MATCHLEN,0
	PUT P-BUTS,P-MATCHLEN,0
	ZERO? QUOTE-FLAG \?L9
	EQUAL? WINNER,PROTAGONIST /?L9
	SET 'WINNER,PROTAGONIST
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L11
	LOC WINNER >HERE
?L11:	CALL LIT?,HERE >LIT
?L9:	ZERO? RESERVE-PTR /?L15
	SET 'PTR,RESERVE-PTR
	CALL STUFF,P-LEXV,RESERVE-LEXV
	CALL INBUF-STUFF,P-INBUF,RESERVE-INBUF
	ZERO? VERBOSITY /?L17
	EQUAL? PROTAGONIST,WINNER \?L17
	CRLF
?L17:	SET 'RESERVE-PTR,0
	JUMP ?L24
?L15:	ZERO? P-CONT /?L20
	SET 'PTR,P-CONT
	ZERO? VERBOSITY /?L21
	ZERO? ELIMINATE-CR \?L21
	CRLF
?L21:	SET 'ELIMINATE-CR,0
	JUMP ?L24
?L20:	SET 'WINNER,PROTAGONIST
	SET 'QUOTE-FLAG,0
	LOC WINNER >STACK
	FSET? STACK,VEHBIT /?L25
	LOC WINNER >HERE
?L25:	CALL LIT?,HERE >LIT
	ZERO? VERBOSITY /?L28
	CRLF
?L28:	PRINTI ">"
	GET OOPS-TABLE,O-PTR >STACK
	ZERO? STACK \?L31
	PUT OOPS-TABLE,O-END,0
?L31:	READ P-INBUF,P-LEXV
	GETB P-LEXV,P-LEXWORDS >OLEN
?L24:	GETB P-LEXV,P-LEXWORDS >P-LEN
	ZERO? P-LEN \?L34
	PRINTI "[I beg your pardon?]"
	CRLF
	RFALSE
?L34:	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?OOPS \?L36
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA \?L37
	ADD PTR,P-LEXELEN >PTR
	DEC 'P-LEN
?L37:	GRTR? P-LEN,1 /?L40
	CALL CANT-USE-THAT-WAY,STR?63
	RFALSE
?L40:	GET OOPS-TABLE,O-PTR >STACK
	ZERO? STACK /?L42
	GRTR? P-LEN,2 \?L43
	PRINTI "[Warning: Only the first word after OOPS is used.]"
	CRLF
?L43:	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	GET OOPS-TABLE,O-PTR >STACK
	PUT AGAIN-LEXV,STACK,STACK
	SET 'WINNER,OWINNER
	GET OOPS-TABLE,O-PTR >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,3 >STACK
	MUL PTR,P-LEXELEN >STACK
	ADD STACK,7 >STACK
	GETB P-LEXV,STACK >STACK
	MUL PTR,P-LEXELEN >STACK
	ADD STACK,6 >STACK
	GETB P-LEXV,STACK >STACK
	CALL INBUF-ADD,STACK,STACK,STACK
	CALL STUFF,P-LEXV,AGAIN-LEXV
	GETB P-LEXV,P-LEXWORDS >P-LEN
	GET OOPS-TABLE,O-START >PTR
	CALL INBUF-STUFF,P-INBUF,OOPS-INBUF
	JUMP ?L47
?L42:	PUT OOPS-TABLE,O-END,0
	PRINTI "[There was no word to replace!]"
	CRLF
	RFALSE
?L36:	ZERO? P-CONT \?L47
	PUT OOPS-TABLE,O-END,0
?L47:	SET 'P-CONT,0
	GET P-LEXV,PTR >STACK
	EQUAL? STACK,W?AGAIN,W?G \?L49
	GETB OOPS-INBUF,1 >STACK
	ZERO? STACK \?L51
	PRINTI "[What do you want to do again?]"
	CRLF
	RFALSE
?L51:	ZERO? P-OFLAG /?L53
	CALL CANT-USE-THAT-WAY,STR?64
	RFALSE
?L53:	ZERO? P-WON \?L54
	PRINTI "[That would just repeat a mistake!]"
	CRLF
	RFALSE
?L54:	EQUAL? OWINNER,PROTAGONIST /?L55
	CALL VISIBLE?,OWINNER >STACK
	ZERO? STACK \?L55
	PRINTI "[You can't see "
	PRINTD OWINNER
	PRINTI " any more.]"
	CRLF
	RFALSE
?L55:	GRTR? P-LEN,1 \?L56
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA,W?THEN /?L59
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?AND \?L57
?L59:	ADD PTR,4 >PTR
	GETB P-LEXV,P-LEXWORDS >STACK
	SUB STACK,2 >STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
	JUMP ?L61
?L57:	CALL RECOGNIZE
	RFALSE
?L56:	ADD PTR,P-LEXELEN >PTR
	GETB P-LEXV,P-LEXWORDS >STACK
	DEC 'STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
?L61:	GETB P-LEXV,P-LEXWORDS >STACK
	GRTR? STACK,0 \?L62
	CALL STUFF,RESERVE-LEXV,P-LEXV
	CALL INBUF-STUFF,RESERVE-INBUF,P-INBUF
	SET 'RESERVE-PTR,PTR
	JUMP ?L64
?L62:	SET 'RESERVE-PTR,0
?L64:	SET 'WINNER,OWINNER
	SET 'P-MERGED,OMERGED
	CALL INBUF-STUFF,P-INBUF,OOPS-INBUF
	CALL STUFF,P-LEXV,AGAIN-LEXV
	SET 'CNT,-1
	SET 'DIR,AGAIN-DIR
?L65:	IGRTR? 'CNT,P-ITBLLEN /?L75
	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L65
?L49:	CALL STUFF,AGAIN-LEXV,P-LEXV
	CALL INBUF-STUFF,OOPS-INBUF,P-INBUF
	PUT OOPS-TABLE,O-START,PTR
	MUL 4,P-LEN >STACK
	PUT OOPS-TABLE,O-LENGTH,STACK
	GETB P-LEXV,P-LEXWORDS >STACK
	MUL P-LEXELEN,STACK >STACK
	ADD PTR,STACK >STACK
	MUL 2,STACK >LEN
	GET OOPS-TABLE,O-END >STACK
	ZERO? STACK \?L71
	SUB LEN,2 >STACK
	GETB P-LEXV,STACK >STACK
	SUB LEN,1 >STACK
	GETB P-LEXV,STACK >STACK
	ADD STACK,STACK >STACK
	PUT OOPS-TABLE,O-END,STACK
?L71:	SET 'RESERVE-PTR,0
	SET 'LEN,P-LEN
	SET 'P-NCN,0
	SET 'P-GETFLAGS,0
?L74:	DLESS? 'P-LEN,0 \?L76
	SET 'QUOTE-FLAG,0
	JUMP ?L75
?L76:	GET P-LEXV,PTR >WRD
	CALL NAUGHTY-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	GET P-LEXV,PTR >WRD
	ZERO? WRD \?L80
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L79
?L80:	CALL NEXT-WORD,PTR >NW
	EQUAL? WRD,W?TO \?L81
	EQUAL? VERB,ACT?TELL,ACT?ASK \?L81
	CALL WT?,NW,PS?VERB,P1?VERB >STACK
	ZERO? STACK /?L81
	PUT P-ITBL,P-VERB,ACT?TELL
	SET 'WRD,W?$QUOTE
	JUMP ?L83
?L81:	EQUAL? WRD,W?THEN \?L83
	GRTR? P-LEN,0 \?L83
	ZERO? VERB \?L83
	ZERO? QUOTE-FLAG \?L83
	PUT P-ITBL,P-VERB,ACT?TELL
	PUT P-ITBL,P-VERBN,0
	SET 'WRD,W?$QUOTE
?L83:	EQUAL? WRD,W?THEN,W?$PERIOD /?L87
	EQUAL? WRD,W?$QUOTE \?L85
?L87:	EQUAL? WRD,W?$QUOTE \?L92
	ZERO? QUOTE-FLAG /?L90
	SET 'QUOTE-FLAG,0
	JUMP ?L92
?L90:	SET 'QUOTE-FLAG,1
?L92:	ZERO? P-LEN /?L94
	ADD PTR,P-LEXELEN >P-CONT
?L94:	PUTB P-LEXV,P-LEXWORDS,P-LEN
	JUMP ?L75
?L85:	CALL WT?,WRD,PS?DIRECTION,P1?DIRECTION >VAL
	ZERO? VAL /?L96
	EQUAL? VERB,0,ACT?WALK,ACT?GO \?L96
	EQUAL? LEN,1 /?L97
	EQUAL? LEN,2 \?L98
	EQUAL? VERB,ACT?WALK,ACT?GO /?L97
?L98:	EQUAL? NW,W?THEN,W?$PERIOD,W?$QUOTE \?L99
	LESS? LEN,2 \?L97
?L99:	ZERO? QUOTE-FLAG /?L100
	EQUAL? LEN,2 \?L100
	EQUAL? NW,W?$QUOTE /?L97
?L100:	GRTR? LEN,2 \?L96
	EQUAL? NW,W?$COMMA,W?AND \?L96
?L97:	SET 'DIR,VAL
	EQUAL? NW,W?$COMMA,W?AND \?L101
	ADD PTR,P-LEXELEN >STACK
	CALL CHANGE-LEXV,STACK,W?THEN
?L101:	GRTR? LEN,2 /?L133
	SET 'QUOTE-FLAG,0
	JUMP ?L75
?L96:	CALL WT?,WRD,PS?VERB,P1?VERB >VAL
	ZERO? VAL /?L107
	ZERO? VERB \?L107
	ZERO? P-OFLAG \?L108
	SET 'P-PRSA-WORD,WRD
?L108:	SET 'VERB,VAL
	PUT P-ITBL,P-VERB,VAL
	PUT P-ITBL,P-VERBN,P-VTBL
	PUT P-VTBL,0,WRD
	MUL PTR,2 >STACK
	ADD STACK,2 >CNT
	GETB P-LEXV,CNT >STACK
	PUTB P-VTBL,2,STACK
	ADD CNT,1 >STACK
	GETB P-LEXV,STACK >STACK
	PUTB P-VTBL,3,STACK
	JUMP ?L133
?L107:	CALL WT?,WRD,PS?PREPOSITION,0 >VAL
	ZERO? VAL \?L143
	EQUAL? WRD,W?ALL,W?ONE,W?BOTH /?L112
	EQUAL? WRD,W?EVERYT /?L112
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L112
	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L111
?L112:	ZERO? VAL /?L113
?L143:	EQUAL? WRD,W?BACK \?L113
	EQUAL? VERB,ACT?HAND /?L113
	SET 'VAL,0
?L113:	GRTR? P-LEN,0 \?L116
	EQUAL? NW,W?OF \?L116
	ZERO? VAL \?L144
	EQUAL? WRD,W?ALL,W?ONE,W?A /?L116
	EQUAL? WRD,W?BOTH,W?EVERYT \?L133
?L116:	ZERO? VAL /?L118
?L144:	ZERO? P-LEN /?L119
	EQUAL? NW,W?THEN,W?$PERIOD \?L118
?L119:	SET 'P-END-ON-PREP,1
	LESS? P-NCN,2 \?L133
	PUT P-ITBL,P-PREP1,VAL
	PUT P-ITBL,P-PREP1N,WRD
	JUMP ?L133
?L118:	EQUAL? P-NCN,2 \?L123
	PRINTI "[There were too many nouns in that sentence.]"
	CRLF
	RFALSE
?L123:	INC 'P-NCN
	CALL CLAUSE,PTR,VAL,WRD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L133
	SET 'QUOTE-FLAG,0
	JUMP ?L75
?L111:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L133
	EQUAL? VERB,ACT?TELL \?L131
	CALL WT?,WRD,PS?VERB,P1?VERB >STACK
	ZERO? STACK /?L131
	EQUAL? WINNER,PROTAGONIST \?L131
	PRINTI "[The way to speak to other characters is described in the instruction manual section entitled ""Communicating With Infocom's Interactive Fiction.""]"
	CRLF
	RFALSE
?L131:	CALL CANT-USE,PTR
	RFALSE
?L79:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L133:	SET 'LW,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L74
?L75:	PUT OOPS-TABLE,O-PTR,0
	ZERO? DIR /?L134
	SET 'PRSA,V?WALK
	SET 'PRSO,DIR
	SET 'P-OFLAG,0
	SET 'P-WALK-DIR,DIR
	SET 'AGAIN-DIR,DIR
	RTRUE
?L134:	SET 'P-WALK-DIR,0
	SET 'AGAIN-DIR,0
	ZERO? P-OFLAG /?L137
	CALL ORPHAN-MERGE
?L137:	CALL SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL MANY-CHECK >STACK
	ZERO? STACK /FALSE
	CALL TAKE-CHECK >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT CHANGE-LEXV,PTR,WRD,PTRS?=0,X,Y,Z
	ZERO? PTRS? /?L1
	SUB PTR,P-LEXELEN >STACK
	MUL 2,STACK >STACK
	ADD 2,STACK >X
	GETB P-LEXV,X >Y
	MUL 2,PTR >STACK
	ADD 2,STACK >Z
	PUTB P-LEXV,Z,Y
	PUTB AGAIN-LEXV,Z,Y
	ADD 1,X >STACK
	GETB P-LEXV,STACK >Y
	MUL 2,PTR >STACK
	ADD 3,STACK >Z
	PUTB P-LEXV,Z,Y
	PUTB AGAIN-LEXV,Z,Y
?L1:	PUT P-LEXV,PTR,WRD
	PUT AGAIN-LEXV,PTR,WRD
	RTRUE

	.FUNCT STUFF,DEST,SRC,MAX=29,PTR=P-LEXSTART,CTR=1,BPTR
	GETB SRC,0 >STACK
	PUTB DEST,0,STACK
	GETB SRC,1 >STACK
	PUTB DEST,1,STACK
?L1:	GET SRC,PTR >STACK
	PUT DEST,PTR,STACK
	MUL PTR,2 >STACK
	ADD STACK,2 >BPTR
	GETB SRC,BPTR >STACK
	PUTB DEST,BPTR,STACK
	MUL PTR,2 >STACK
	ADD STACK,3 >BPTR
	GETB SRC,BPTR >STACK
	PUTB DEST,BPTR,STACK
	ADD PTR,P-LEXELEN >PTR
	IGRTR? 'CTR,MAX \?L1
	RTRUE

	.FUNCT INBUF-STUFF,DEST,SRC,CNT=-1
?L1:	IGRTR? 'CNT,P-INBUF-LENGTH /TRUE
	GETB SRC,CNT >STACK
	PUTB DEST,CNT,STACK
	JUMP ?L1

	.FUNCT INBUF-ADD,LEN,BEG,SLOT,DBEG,CTR=0,TMP,?TMP
	GET OOPS-TABLE,O-END >TMP
	ZERO? TMP /?L1
	SET 'DBEG,TMP
	JUMP ?L3
?L1:	GET OOPS-TABLE,O-LENGTH >TMP
	GETB AGAIN-LEXV,TMP >?TMP
	ADD TMP,1 >STACK
	GETB AGAIN-LEXV,STACK >STACK
	ADD ?TMP,STACK >DBEG
?L3:	ADD DBEG,LEN >STACK
	PUT OOPS-TABLE,O-END,STACK
?L4:	ADD BEG,CTR >STACK
	GETB P-INBUF,STACK >STACK
	ADD DBEG,CTR >STACK
	PUTB OOPS-INBUF,STACK,STACK
	INC 'CTR
	EQUAL? CTR,LEN \?L4
	PUTB AGAIN-LEXV,SLOT,DBEG
	SUB SLOT,1 >STACK
	PUTB AGAIN-LEXV,STACK,LEN
	RTRUE

	.FUNCT WT?,PTR,BIT,B1=5,OFFS=P-P1OFF,TYP
	GETB PTR,P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	EQUAL? BIT,PS?OBJECT /TRUE
	BAND TYP,P-P1BITS >TYP
	EQUAL? TYP,B1 /?L7
	INC 'OFFS
?L7:	GETB PTR,OFFS >STACK
	RSTACK

	.FUNCT NEXT-WORD,PTR
	ZERO? P-LEN /FALSE
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	RSTACK

	.FUNCT CLAUSE,PTR,VAL,WRD,OFF,NUM,ANDFLG=0,FIRST??=1,NW,LW=0
	SUB P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L1
	ADD P-PREP1,OFF >NUM
	PUT P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,WRD
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'P-LEN
?L3:	ZERO? P-LEN \?L4
	DEC 'P-NCN
	RETURN -1
?L4:	ADD P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	PUT P-ITBL,NUM,STACK
?L7:	DLESS? 'P-LEN,0 \?L9
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN -1
?L9:	GET P-LEXV,PTR >WRD
	CALL NAUGHTY-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	ZERO? WRD \?L15
	CALL NUMBER?,PTR >WRD
	ZERO? WRD /?L14
?L15:	CALL NEXT-WORD,PTR >NW
	ZERO? FIRST?? /?L16
	EQUAL? WRD,W?THE,W?A,W?AN /?L18
	ZERO? VAL /?L16
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L16
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L16
?L18:	GET P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT P-ITBL,NUM,STACK
	JUMP ?L39
?L16:	EQUAL? WRD,W?AND,W?$COMMA \?L19
	SET 'ANDFLG,1
	JUMP ?L39
?L19:	EQUAL? WRD,W?ALL,W?ONE,W?BOTH /?L21
	EQUAL? WRD,W?EVERYT \?L20
?L21:	EQUAL? NW,W?OF \?L39
	DEC 'P-LEN
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L39
?L20:	EQUAL? WRD,W?THEN,W?$PERIOD /?L26
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK /?L25
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK /?L25
	ZERO? FIRST?? \?L25
?L26:	INC 'P-LEN
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	SUB PTR,P-LEXELEN >STACK
	RSTACK
?L25:	ZERO? ANDFLG /?L27
	GET P-ITBL,P-VERB >STACK
	ZERO? STACK \?L27
	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	CALL CHANGE-LEXV,STACK,W?THEN
	ADD P-LEN,2 >P-LEN
	JUMP ?L39
?L27:	CALL WT?,WRD,PS?OBJECT >STACK
	ZERO? STACK /?L28
	GRTR? P-LEN,0 \?L29
	EQUAL? NW,W?OF \?L29
	EQUAL? WRD,W?ALL,W?EVERYT,W?ONE /?L29
	EQUAL? WRD,W?BOTH \?L39
?L29:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	ZERO? STACK /?L31
	EQUAL? NW,0,W?MY /?L31
	CALL WT?,NW,PS?OBJECT >STACK
	ZERO? STACK \?L32
	CALL WT?,NW,PS?ADJECTIVE >STACK
	ZERO? STACK /?L31
?L32:	GET P-ITBL,P-VERB >STACK
	EQUAL? STACK,ACT?SHOW,ACT?HAND,ACT?FEED \?L39
?L31:	ZERO? ANDFLG \?L33
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L33
	EQUAL? NW,W?$COMMA /?L33
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD P-LEXV,STACK >STACK
	ADD NUM,1 >STACK
	PUT P-ITBL,STACK,STACK
	RETURN PTR
?L33:	SET 'ANDFLG,0
	JUMP ?L39
?L28:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK \?L39
	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L39
	CALL WT?,WRD,PS?PREPOSITION >STACK
	ZERO? STACK \?L39
	CALL CANT-USE,PTR
	RFALSE
?L14:	CALL UNKNOWN-WORD,PTR
	RFALSE
?L39:	SET 'LW,WRD
	SET 'FIRST??,0
	ADD PTR,P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT NUMBER?,PTR,CNT,BPTR,CHR,SUM=0,CCTR,TMP,XPTR
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L1:	DLESS? 'CNT,0 /?L2
	GRTR? SUM,6553 /FALSE
	GETB P-INBUF,BPTR >CHR
	LESS? CHR,58 \?L7
	GRTR? CHR,47 \?L7
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
	JUMP ?L9
?L7:	EQUAL? CHR,35 \FALSE
?L9:	INC 'BPTR
	JUMP ?L1
?L2:	CALL CHANGE-LEXV,PTR,W?NUMBER
	ADD PTR,P-LEXELEN >STACK
	GET P-LEXV,STACK >STACK
	EQUAL? STACK,W?$COMMA \?L13
	GRTR? P-LEN,1 \?L13
	ADD PTR,4 >XPTR
	CALL AFTER-COMMA-CHECK,XPTR >TMP
	ZERO? TMP /?L13
	MUL PTR,2 >STACK
	ADD STACK,2 >STACK
	GETB P-LEXV,STACK >CCTR
	MUL XPTR,2 >STACK
	ADD STACK,2 >STACK
	GETB P-LEXV,STACK >STACK
	ADD CCTR,STACK >CCTR
	INC 'CCTR
	MUL PTR,2 >STACK
	ADD STACK,2 >STACK
	PUTB P-LEXV,STACK,CCTR
	EQUAL? TMP,1000 \?L15
	SET 'TMP,0
?L15:	MUL 1000,SUM >STACK
	ADD STACK,TMP >SUM
	SUB P-LEN,2 >CCTR
?L18:	DLESS? 'CCTR,0 /?L19
	ADD PTR,P-LEXELEN >PTR
	ADD PTR,4 >XPTR
	GET P-LEXV,XPTR >STACK
	CALL CHANGE-LEXV,PTR,STACK
	MUL XPTR,2 >STACK
	ADD STACK,2 >STACK
	GETB P-LEXV,STACK >STACK
	MUL PTR,2 >STACK
	ADD STACK,2 >STACK
	PUTB P-LEXV,STACK,STACK
	MUL XPTR,2 >STACK
	ADD STACK,3 >STACK
	GETB P-LEXV,STACK >STACK
	MUL PTR,2 >STACK
	ADD STACK,3 >STACK
	PUTB P-LEXV,STACK,STACK
	JUMP ?L18
?L19:	SUB P-LEN,2 >P-LEN
	GETB P-LEXV,P-LEXWORDS >STACK
	SUB STACK,2 >STACK
	PUTB P-LEXV,P-LEXWORDS,STACK
?L13:	GRTR? SUM,10000 /FALSE
	SET 'P-NUMBER,SUM
	RETURN W?NUMBER

	.FUNCT AFTER-COMMA-CHECK,PTR,CNT,BPTR,CCTR=0,CHR,SUM=0
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,2 >CNT
	MUL PTR,2 >STACK
	ADD P-LEXV,STACK >STACK
	GETB STACK,3 >BPTR
?L1:	DLESS? 'CNT,0 /?L2
	GETB P-INBUF,BPTR >CHR
	IGRTR? 'CCTR,3 /?L2
	LESS? CHR,58 \FALSE
	GRTR? CHR,47 \FALSE
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
	INC 'BPTR
	JUMP ?L1
?L2:	EQUAL? CCTR,3 \FALSE
	ZERO? SUM \?L12
	RETURN 1000
?L12:	RETURN SUM

	.FUNCT ORPHAN-MERGE,CNT=-1,TEMP,VERB,BEG,END,ADJ=0,VRB=0,WRD,?TMP
	SET 'P-OFLAG,0
	GET P-ITBL,P-VERBN >STACK
	GET STACK,0 >WRD
	CALL WT?,WRD,PS?VERB,P1?VERB >?TMP
	GET P-OTBL,P-VERB >STACK
	EQUAL? ?TMP,STACK /?L3
	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK /?L1
?L3:	SET 'VRB,1
	SET 'ADJ,1
	JUMP ?L5
?L1:	CALL WT?,WRD,PS?ADJECTIVE >STACK
	ZERO? STACK /?L4
	SET 'ADJ,1
	JUMP ?L5
?L4:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L5
	ZERO? P-NCN \?L5
	PUT P-ITBL,P-VERB,0
	PUT P-ITBL,P-VERBN,0
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
	SET 'P-NCN,1
?L5:	GET P-ITBL,P-VERB >VERB
	ZERO? VERB /?L7
	ZERO? ADJ \?L7
	GET P-OTBL,P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L7:	EQUAL? P-NCN,2 /FALSE
	GET P-OTBL,P-NC1 >STACK
	EQUAL? STACK,1 \?L10
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP1 >STACK
	EQUAL? TEMP,STACK /?L13
	ZERO? TEMP \FALSE
?L13:	ZERO? ADJ /?L14
	ZERO? VRB \?L14
	ADD P-LEXV,2 >STACK
	PUT P-OTBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L16
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L16:	ZERO? P-NCN \?L22
	SET 'P-NCN,1
	JUMP ?L22
?L14:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC1,STACK
?L22:	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC1L,STACK
	JUMP ?L43
?L10:	GET P-OTBL,P-NC2 >STACK
	EQUAL? STACK,1 \?L24
	GET P-ITBL,P-PREP1 >TEMP
	GET P-OTBL,P-PREP2 >STACK
	EQUAL? TEMP,STACK /?L27
	ZERO? TEMP \FALSE
?L27:	ZERO? ADJ /?L30
	ZERO? VRB \?L30
	ADD P-LEXV,2 >STACK
	PUT P-ITBL,P-NC1,STACK
	GET P-ITBL,P-NC1L >STACK
	ZERO? STACK \?L30
	ADD P-LEXV,6 >STACK
	PUT P-ITBL,P-NC1L,STACK
?L30:	GET P-ITBL,P-NC1 >STACK
	PUT P-OTBL,P-NC2,STACK
	GET P-ITBL,P-NC1L >STACK
	PUT P-OTBL,P-NC2L,STACK
	SET 'P-NCN,2
	JUMP ?L43
?L24:	ZERO? P-ACLAUSE /?L43
	EQUAL? P-NCN,1 /?L36
	ZERO? ADJ \?L36
	SET 'P-ACLAUSE,0
	RFALSE
?L36:	GET P-ITBL,P-NC1 >BEG
	ZERO? ADJ /?L39
	ADD P-LEXV,2 >BEG
	SET 'ADJ,0
?L39:	GET P-ITBL,P-NC1L >END
?L42:	GET BEG,0 >WRD
	EQUAL? BEG,END \?L44
	ZERO? ADJ /?L46
	CALL CLAUSE-WIN,ADJ
	JUMP ?L43
?L46:	SET 'P-ACLAUSE,0
	RFALSE
?L44:	EQUAL? WRD,W?ALL,W?EVERYT,W?ONE /?L50
	EQUAL? WRD,W?BOTH /?L50
	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE \?L49
	CALL ADJ-CHECK,WRD,ADJ,ADJ >STACK
	ZERO? STACK /?L49
?L50:	SET 'ADJ,WRD
	JUMP ?L52
?L49:	EQUAL? WRD,W?ONE \?L51
	CALL CLAUSE-WIN,ADJ
	JUMP ?L43
?L51:	GETB WRD,P-PSOFF >STACK
	BTST STACK,PS?OBJECT \?L52
	EQUAL? WRD,P-ANAM \?L53
	CALL CLAUSE-WIN,ADJ
	JUMP ?L43
?L53:	CALL CLAUSE-WIN
	JUMP ?L43
?L52:	ADD BEG,P-WORDLEN >BEG
	ZERO? END \?L42
	SET 'END,BEG
	SET 'P-NCN,1
	SUB BEG,4 >STACK
	PUT P-ITBL,P-NC1,STACK
	PUT P-ITBL,P-NC1L,BEG
	JUMP ?L42
?L43:	GET P-OVTBL,0 >STACK
	PUT P-VTBL,0,STACK
	GETB P-OVTBL,2 >STACK
	PUTB P-VTBL,2,STACK
	GETB P-OVTBL,3 >STACK
	PUTB P-VTBL,3,STACK
	PUT P-OTBL,P-VERBN,P-VTBL
	PUTB P-VTBL,2,0
?L61:	IGRTR? 'CNT,P-ITBLLEN \?L63
	SET 'P-MERGED,1
	RTRUE
?L63:	GET P-OTBL,CNT >STACK
	PUT P-ITBL,CNT,STACK
	JUMP ?L61

	.FUNCT CLAUSE-WIN,ADJ=0
	ZERO? ADJ /?L1
	GET P-OTBL,P-VERB >STACK
	PUT P-ITBL,P-VERB,STACK
	JUMP ?L3
?L1:	SET 'ADJ,1
?L3:	PUT P-CCTBL,CC-SBPTR,P-ACLAUSE
	ADD P-ACLAUSE,1 >STACK
	PUT P-CCTBL,CC-SEPTR,STACK
	EQUAL? P-ACLAUSE,P-NC1 \?L4
	PUT P-CCTBL,CC-OCLAUSE,P-OCL1
	JUMP ?L6
?L4:	PUT P-CCTBL,CC-OCLAUSE,P-OCL2
?L6:	CALL CLAUSE-COPY,P-OTBL,P-OTBL,ADJ
	GET P-OTBL,P-NC2 >STACK
	ZERO? STACK /?L7
	SET 'P-NCN,2
?L7:	SET 'P-ACLAUSE,0
	RTRUE

	.FUNCT WORD-PRINT,CNT,BUF
?L1:	DLESS? 'CNT,0 /TRUE
	GETB P-INBUF,BUF >STACK
	PRINTC STACK
	INC 'BUF
	JUMP ?L1

	.FUNCT UNKNOWN-WORD,PTR,BUF,?TMP
	ZERO? P-OFLAG /?L1
	PUT OOPS-TABLE,O-END,0
?L1:	PUT OOPS-TABLE,O-PTR,PTR
	PRINTI "[I don't know the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTI ".""]"
	CRLF
	SET 'QUOTE-FLAG,0
	SET 'P-OFLAG,0
	RETURN P-OFLAG

	.FUNCT CANT-USE,PTR,BUF,?TMP
	PRINTI "[You used the word """
	MUL PTR,2 >BUF
	ADD P-LEXV,BUF >STACK
	GETB STACK,2 >?TMP
	ADD P-LEXV,BUF >STACK
	GETB STACK,3 >STACK
	CALL WORD-PRINT,?TMP,STACK
	PRINTR """ in a way that I don't understand.]"

	.FUNCT SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1=0,DRIVE2=0,PREP,VERB
	GET P-ITBL,P-VERB >VERB
	ZERO? VERB \?L1
	PRINTI "[There was no verb in that sentence!]"
	CRLF
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L4:	GETB SYN,P-SBITS >STACK
	BAND STACK,P-SONUMS >NUM
	GRTR? P-NCN,NUM /?L13
	LESS? NUM,1 /?L8
	ZERO? P-NCN \?L8
	GET P-ITBL,P-PREP1 >PREP
	ZERO? PREP /?L9
	GETB SYN,P-SPREP1 >STACK
	EQUAL? PREP,STACK \?L8
?L9:	SET 'DRIVE1,SYN
	JUMP ?L13
?L8:	GET P-ITBL,P-PREP1 >STACK
	GETB SYN,P-SPREP1 >STACK
	EQUAL? STACK,STACK \?L13
	EQUAL? NUM,2 \?L11
	EQUAL? P-NCN,1 \?L11
	SET 'DRIVE2,SYN
	JUMP ?L13
?L11:	GET P-ITBL,P-PREP2 >STACK
	GETB SYN,P-SPREP2 >STACK
	EQUAL? STACK,STACK \?L13
	CALL SYNTAX-FOUND,SYN
	RTRUE
?L13:	DLESS? 'LEN,1 \?L16
	ZERO? DRIVE1 \?L48
	ZERO? DRIVE2 \?L5
	CALL RECOGNIZE
	RFALSE
?L16:	ADD SYN,P-SYNLEN >SYN
	JUMP ?L4
?L5:	ZERO? DRIVE1 /?L23
?L48:	GETB DRIVE1,P-SPREP1 >STACK
	GETB DRIVE1,P-SLOC1 >STACK
	GETB DRIVE1,P-SFWIM1 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L23
	PUT P-PRSO,P-MATCHLEN,1
	PUT P-PRSO,1,OBJ
	CALL SYNTAX-FOUND,DRIVE1 >STACK
	RSTACK
?L23:	ZERO? DRIVE2 /?L25
	GETB DRIVE2,P-SPREP2 >STACK
	GETB DRIVE2,P-SLOC2 >STACK
	GETB DRIVE2,P-SFWIM2 >STACK
	CALL GWIM,STACK,STACK,STACK >OBJ
	ZERO? OBJ /?L25
	PUT P-PRSI,P-MATCHLEN,1
	PUT P-PRSI,1,OBJ
	CALL SYNTAX-FOUND,DRIVE2 >STACK
	RSTACK
?L25:	EQUAL? WINNER,PROTAGONIST \?L27
	CALL ORPHAN,DRIVE1,DRIVE2
	PRINTI "[Wh"
	JUMP ?L29
?L27:	PRINTI "[Your command was not complete. Next time, type wh"
?L29:	EQUAL? VERB,ACT?WALK,ACT?GO \?L30
	PRINTI "ere"
	JUMP ?L35
?L30:	ZERO? DRIVE1 /?L34
	GETB DRIVE1,P-SFWIM1 >STACK
	EQUAL? STACK,ACTORBIT /?L33
?L34:	ZERO? DRIVE2 /?L32
	GETB DRIVE2,P-SFWIM2 >STACK
	EQUAL? STACK,ACTORBIT \?L32
?L33:	PRINTI "om"
	JUMP ?L35
?L32:	PRINTI "at"
?L35:	EQUAL? WINNER,PROTAGONIST \?L36
	PRINTI " do you want to "
	JUMP ?L38
?L36:	PRINTI " you want"
	CALL TPRINT,WINNER
	PRINTI " to "
?L38:	CALL VERB-PRINT
	SET 'P-OFLAG,0
	ZERO? DRIVE2 /?L39
	SET 'PREP,P-MERGED
	SET 'P-MERGED,0
	CALL CLAUSE-PRINT,P-NC1,P-NC1L
	SET 'P-MERGED,PREP
?L39:	ZERO? DRIVE1 /?L42
	GETB DRIVE1,P-SPREP1 >STACK
	JUMP ?L44
?L42:	GETB DRIVE2,P-SPREP2 >STACK
?L44:	CALL PREP-PRINT,STACK
	EQUAL? WINNER,PROTAGONIST \?L45
	SET 'P-OFLAG,1
	PRINTI "?]"
	CRLF
	RFALSE
?L45:	SET 'P-OFLAG,0
	PRINTI ".]"
	CRLF
	RFALSE

	.FUNCT VERB-PRINT,TMP
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	RTRUE
?L1:	EQUAL? TMP,W?ZZMGCK \?L3
	PRINTI "answer"
	RTRUE
?L3:	GETB TMP,2 >STACK
	ZERO? STACK \?L4
	GET TMP,0 >STACK
	PRINTB STACK
	RTRUE
?L4:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
	PUTB TMP,2,0
	RTRUE

	.FUNCT ORPHAN,D1,D2,CNT=-1
	ZERO? P-MERGED \?L1
	PUT P-OCL1,P-MATCHLEN,0
	PUT P-OCL2,P-MATCHLEN,0
?L1:	GET P-VTBL,0 >STACK
	PUT P-OVTBL,0,STACK
	GETB P-VTBL,2 >STACK
	PUTB P-OVTBL,2,STACK
	GETB P-VTBL,3 >STACK
	PUTB P-OVTBL,3,STACK
?L4:	IGRTR? 'CNT,P-ITBLLEN /?L5
	GET P-ITBL,CNT >STACK
	PUT P-OTBL,CNT,STACK
	JUMP ?L4
?L5:	EQUAL? P-NCN,2 \?L9
	PUT P-CCTBL,CC-SBPTR,P-NC2
	PUT P-CCTBL,CC-SEPTR,P-NC2L
	PUT P-CCTBL,CC-OCLAUSE,P-OCL2
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L9:	LESS? P-NCN,1 /?L12
	PUT P-CCTBL,CC-SBPTR,P-NC1
	PUT P-CCTBL,CC-SEPTR,P-NC1L
	PUT P-CCTBL,CC-OCLAUSE,P-OCL1
	CALL CLAUSE-COPY,P-ITBL,P-OTBL
?L12:	ZERO? D1 /?L15
	GETB D1,P-SPREP1 >STACK
	PUT P-OTBL,P-PREP1,STACK
	PUT P-OTBL,P-NC1,1
	RTRUE
?L15:	ZERO? D2 /FALSE
	GETB D2,P-SPREP2 >STACK
	PUT P-OTBL,P-PREP2,STACK
	PUT P-OTBL,P-NC2,1
	RTRUE

	.FUNCT CLAUSE-PRINT,BPTR,EPTR,THE?=1
	GET P-ITBL,EPTR >STACK
	GET P-ITBL,BPTR >STACK
	CALL BUFFER-PRINT,STACK,STACK,THE? >STACK
	RSTACK

	.FUNCT BUFFER-PRINT,BEG,END,CP,NOSP=0,WRD,FIRST??=1,PN=0
?L1:	EQUAL? BEG,END /TRUE
	ZERO? NOSP /?L6
	SET 'NOSP,0
	JUMP ?L8
?L6:	PRINTI " "
?L8:	GET BEG,0 >WRD
	EQUAL? WRD,W?$PERIOD \?L9
	SET 'NOSP,1
	JUMP ?L14
?L9:	EQUAL? WRD,W?ME,W?MYSELF \?L11
	PRINTD ME
	SET 'PN,1
	JUMP ?L14
?L11:	CALL NAME?,WRD >STACK
	ZERO? STACK \?L13
	EQUAL? WRD,W?THERMOS \?L12
?L13:	CALL CAPITALIZE,BEG
	SET 'PN,1
	JUMP ?L14
?L12:	ZERO? FIRST?? /?L15
	ZERO? PN \?L15
	ZERO? CP /?L15
	EQUAL? WRD,W?MY /?L15
	PRINTI "the "
?L15:	ZERO? P-OFLAG \?L20
	ZERO? P-MERGED /?L18
?L20:	PRINTB WRD
	JUMP ?L24
?L18:	EQUAL? WRD,W?IT,W?THEM \?L21
	CALL ACCESSIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK /?L21
	PRINTD P-IT-OBJECT
	JUMP ?L24
?L21:	EQUAL? WRD,W?HIM,W?HIMSELF,W?HER /?L23
	EQUAL? WRD,W?HERSELF \?L22
?L23:	CALL ACCESSIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK /?L22
	PRINTD P-HIM-OBJECT
	JUMP ?L24
?L22:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L24:	SET 'FIRST??,0
?L14:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT NAME?,WRD
	EQUAL? WRD,W?FLOYD,W?PLATO,W?OLIVER \FALSE
	RTRUE

	.FUNCT CAPITALIZE,PTR
	ZERO? P-OFLAG \?L3
	ZERO? P-MERGED /?L1
?L3:	GET PTR,0 >STACK
	PRINTB STACK
	RTRUE
?L1:	GETB PTR,3 >STACK
	GETB P-INBUF,STACK >STACK
	SUB STACK,32 >STACK
	PRINTC STACK
	GETB PTR,3 >STACK
	INC 'STACK
	GETB PTR,2 >STACK
	DEC 'STACK
	CALL WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT PREP-PRINT,PREP,WRD
	ZERO? PREP /FALSE
	PRINTI " "
	EQUAL? PREP,PR?THROUGH \?L3
	PRINTI "through"
	RTRUE
?L3:	CALL PREP-FIND,PREP >WRD
	PRINTB WRD
	RTRUE

	.FUNCT CLAUSE-COPY,SRC,DEST,INSRT=0,OCL,BEG,END,BB,EE,OBEG,CNT,B,E
	GET P-CCTBL,CC-SBPTR >BB
	GET P-CCTBL,CC-SEPTR >EE
	GET P-CCTBL,CC-OCLAUSE >OCL
	GET SRC,BB >BEG
	GET SRC,EE >END
	GET OCL,P-MATCHLEN >OBEG
?L1:	EQUAL? BEG,END /?L2
	ZERO? INSRT /?L6
	GET BEG,0 >STACK
	EQUAL? P-ANAM,STACK \?L6
	EQUAL? INSRT,1 \?L8
	GET P-ITBL,P-NC1 >B
	GET P-ITBL,P-NC1L >E
?L10:	EQUAL? B,E /?L17
	GET B,0 >STACK
	CALL CLAUSE-ADD,STACK
	ADD B,P-WORDLEN >B
	JUMP ?L10
?L8:	GET OCL,1 >STACK
	EQUAL? INSRT,STACK /?L17
	CALL CLAUSE-ADD,INSRT
	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
	JUMP ?L17
?L6:	GET BEG,0 >STACK
	CALL CLAUSE-ADD,STACK
?L17:	ADD BEG,P-WORDLEN >BEG
	JUMP ?L1
?L2:	EQUAL? SRC,DEST \?L18
	GRTR? OBEG,0 \?L18
	GET OCL,P-MATCHLEN >STACK
	SUB STACK,OBEG >CNT
	GRTR? CNT,0 \?L18
	PUT OCL,P-MATCHLEN,0
	INC 'OBEG
?L20:	GET OCL,OBEG >STACK
	CALL CLAUSE-ADD,STACK
	SUB CNT,2 >CNT
	ZERO? CNT /?L21
	ADD OBEG,2 >OBEG
	JUMP ?L20
?L21:	SET 'OBEG,0
?L18:	MUL OBEG,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD OCL,STACK >STACK
	PUT DEST,BB,STACK
	GET OCL,P-MATCHLEN >STACK
	MUL STACK,P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD OCL,STACK >STACK
	PUT DEST,EE,STACK
	RTRUE

	.FUNCT CLAUSE-ADD,WRD,OCL,PTR
	GET P-CCTBL,CC-OCLAUSE >OCL
	GET OCL,P-MATCHLEN >STACK
	ADD STACK,2 >PTR
	SUB PTR,1 >STACK
	PUT OCL,STACK,WRD
	PUT OCL,PTR,0
	PUT OCL,P-MATCHLEN,PTR
	RTRUE

	.FUNCT PREP-FIND,PREP,CNT=0,SIZE
	GET PREPOSITIONS,0 >STACK
	MUL STACK,2 >SIZE
?L1:	IGRTR? 'CNT,SIZE /FALSE
	GET PREPOSITIONS,CNT >STACK
	EQUAL? STACK,PREP \?L1
	SUB CNT,1 >STACK
	GET PREPOSITIONS,STACK >STACK
	RSTACK

	.FUNCT SYNTAX-FOUND,SYN
	SET 'P-SYNTAX,SYN
	GETB SYN,P-SACTION >PRSA
	RETURN PRSA

	.FUNCT GWIM,GBIT,LBIT,PREP,OBJ
	EQUAL? GBIT,RLANDBIT \?L1
	RETURN ROOMS
?L1:	SET 'P-GWIMBIT,GBIT
	SET 'P-SLOCBITS,LBIT
	PUT P-MERGE,P-MATCHLEN,0
	CALL GET-OBJECT,P-MERGE,0 >STACK
	ZERO? STACK /?L4
	SET 'P-GWIMBIT,0
	GET P-MERGE,P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET P-MERGE,1 >OBJ
	PRINTI "["
	ZERO? PREP /?L15
	ZERO? P-END-ON-PREP \?L15
	CALL PREP-FIND,PREP >PREP
	PRINTB PREP
	EQUAL? PREP,W?OUT \?L10
	PRINTI " of"
?L10:	FSET? OBJ,NARTICLEBIT /?L13
	PRINTI " the "
	JUMP ?L15
?L13:	PRINTI " "
?L15:	PRINTD OBJ
	PRINTI "]"
	CRLF
	RETURN OBJ
?L4:	SET 'P-GWIMBIT,0
	RFALSE

	.FUNCT SNARF-OBJECTS,PTR
	GET P-ITBL,P-NC1 >PTR
	ZERO? PTR /?L5
	SET 'P-PHR,0
	GETB P-SYNTAX,P-SLOC1 >P-SLOCBITS
	GET P-ITBL,P-NC1L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSO >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /?L5
	CALL BUT-MERGE,P-PRSO >P-PRSO
?L5:	GET P-ITBL,P-NC2 >PTR
	ZERO? PTR /TRUE
	SET 'P-PHR,1
	GETB P-SYNTAX,P-SLOC2 >P-SLOCBITS
	GET P-ITBL,P-NC2L >STACK
	CALL SNARFEM,PTR,STACK,P-PRSI >STACK
	ZERO? STACK /FALSE
	GET P-BUTS,P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET P-PRSI,P-MATCHLEN >STACK
	EQUAL? STACK,1 \?L14
	CALL BUT-MERGE,P-PRSO >P-PRSO
	RTRUE
?L14:	CALL BUT-MERGE,P-PRSI >P-PRSI
	RTRUE

	.FUNCT BUT-MERGE,TBL,LEN,BUTLEN,CNT=1,MATCHES=0,OBJ,NTBL
	GET TBL,P-MATCHLEN >LEN
	PUT P-MERGE,P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	CALL ZMEMQ,OBJ,P-BUTS >STACK
	ZERO? STACK \?L6
	ADD MATCHES,1 >STACK
	PUT P-MERGE,STACK,OBJ
	INC 'MATCHES
?L6:	INC 'CNT
	JUMP ?L1
?L2:	PUT P-MERGE,P-MATCHLEN,MATCHES
	SET 'NTBL,P-MERGE
	SET 'P-MERGE,TBL
	RETURN NTBL

	.FUNCT SNARFEM,PTR,EPTR,TBL,BUT=0,LEN,WV,WRD,NW,WAS-ALL=0
	SET 'P-AND,0
	EQUAL? P-GETFLAGS,P-ALL \?L1
	SET 'WAS-ALL,1
?L1:	SET 'P-GETFLAGS,0
	PUT P-BUTS,P-MATCHLEN,0
	PUT TBL,P-MATCHLEN,0
	GET PTR,0 >WRD
?L4:	EQUAL? PTR,EPTR \?L6
?L61:	ZERO? BUT /?L9
	PUSH BUT
	JUMP ?L8
?L9:	PUSH TBL
?L8:	CALL GET-OBJECT,STACK >WV
	ZERO? WAS-ALL /?L10
	SET 'P-GETFLAGS,P-ALL
?L10:	RETURN WV
?L6:	ADD PTR,P-WORDLEN >STACK
	EQUAL? EPTR,STACK \?L14
	SET 'NW,0
	JUMP ?L16
?L14:	GET PTR,P-LEXELEN >NW
?L16:	EQUAL? WRD,W?ALL,W?BOTH,W?EVERYT \?L17
	CALL MANY-CHECK,P-PHR >STACK
	ZERO? STACK /FALSE
	SET 'P-GETFLAGS,P-ALL
	EQUAL? NW,W?OF \?L56
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L56
?L17:	CALL NAUGHTY-WORD?,WRD >STACK
	ZERO? STACK \FALSE
	EQUAL? WRD,W?BUT,W?EXCEPT \?L26
	ZERO? BUT /?L30
	PUSH BUT
	JUMP ?L29
?L30:	PUSH TBL
?L29:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,P-BUTS
	PUT BUT,P-MATCHLEN,0
	JUMP ?L56
?L26:	EQUAL? WRD,W?A,W?ONE \?L31
	ZERO? P-ADJ \?L32
	SET 'P-GETFLAGS,P-ONE
	EQUAL? NW,W?OF \?L56
	ADD PTR,P-WORDLEN >PTR
	JUMP ?L56
?L32:	SET 'P-NAM,P-ONEOBJ
	ZERO? BUT /?L41
	PUSH BUT
	JUMP ?L40
?L41:	PUSH TBL
?L40:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L56
?L31:	EQUAL? WRD,W?AND,W?$COMMA \?L44
	EQUAL? NW,W?AND,W?$COMMA /?L44
	SET 'P-AND,1
	ZERO? BUT /?L48
	PUSH BUT
	JUMP ?L47
?L48:	PUSH TBL
?L47:	CALL GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L56
?L44:	CALL WT?,WRD,PS?BUZZ-WORD >STACK
	ZERO? STACK \?L56
	EQUAL? WRD,W?AND,W?$COMMA /?L56
	EQUAL? WRD,W?OF \?L51
	ZERO? P-GETFLAGS \?L56
	SET 'P-GETFLAGS,P-INHIBIT
	JUMP ?L56
?L51:	CALL WT?,WRD,PS?ADJECTIVE,P1?ADJECTIVE >WV
	ZERO? WV /?L55
	CALL ADJ-CHECK,WRD,P-ADJ,P-ADJN >STACK
	ZERO? STACK /?L55
	EQUAL? NW,W?OF /?L55
	SET 'P-ADJ,WV
	SET 'P-ADJN,WRD
	JUMP ?L56
?L55:	CALL WT?,WRD,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L56
	SET 'P-NAM,WRD
	SET 'P-ONEOBJ,WRD
?L56:	EQUAL? PTR,EPTR /?L61
	ADD PTR,P-WORDLEN >PTR
	SET 'WRD,NW
	JUMP ?L4

	.FUNCT NAUGHTY-WORD?,WORD
	EQUAL? WORD,W?ASS,W?ASSHOLE,W?BITCH /?L3
	EQUAL? WORD,W?BASTARD,W?COCK,W?COCKSU /?L3
	EQUAL? WORD,W?CUNT,W?DAMN,W?DAMNED /?L3
	EQUAL? WORD,W?FUCK,W?FUCKED,W?FUCKING /?L3
	EQUAL? WORD,W?SHIT,W?SHITHEAD,W?SHITTY /?L3
	EQUAL? WORD,W?TROT,W?KRIP,W?MEGAKRIP /?L3
	EQUAL? WORD,W?TROTTING \FALSE
?L3:	PRINTI "Such language from a Lieutenant in the Stellar Patrol!"
	CRLF
	CALL PRINT-ID,STR?65 >STACK
	RSTACK

	.FUNCT ADJ-CHECK,WRD,ADJ,ADJN
	ZERO? ADJ /TRUE
	EQUAL? WRD,W?INNER,W?OUTER,W?LARGE /TRUE
	EQUAL? WRD,W?SMALL,W?MEDIUM,W?TWELVE /TRUE
	EQUAL? WRD,W?TWENTY,W?PROCESSING,W?DISPEN \FALSE
	RTRUE

	.FUNCT GET-OBJECT,TBL,VRB=1,BITS,LEN,XBITS,TLEN,GCHECK=0,OLEN=0,OBJ
	SET 'XBITS,P-SLOCBITS
	GET TBL,P-MATCHLEN >TLEN
	BTST P-GETFLAGS,P-INHIBIT /TRUE
	ZERO? P-NAM \?L11
	ZERO? P-ADJ /?L8
	CALL WT?,P-ADJN,PS?OBJECT,P1?OBJECT >STACK
	ZERO? STACK /?L6
	SET 'P-NAM,P-ADJN
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	JUMP ?L8
?L6:	CALL WT?,P-ADJN,PS?DIRECTION,P1?DIRECTION >BITS
	ZERO? BITS /?L8
	SET 'P-DIRECTION,BITS
?L8:	ZERO? P-NAM \?L11
	ZERO? P-ADJ \?L11
	EQUAL? P-GETFLAGS,P-ALL /?L63
	ZERO? P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	PRINT NOUN-MISSING
	RFALSE
?L11:	EQUAL? P-GETFLAGS,P-ALL \?L19
?L63:	ZERO? P-SLOCBITS \?L17
?L19:	SET 'P-SLOCBITS,-1
?L17:	SET 'P-TABLE,TBL
?L21:	ZERO? GCHECK /?L23
	CALL GLOBAL-CHECK,TBL
	JUMP ?L25
?L23:	ZERO? LIT \?L28
	EQUAL? PRSA,V?TELL \?L26
?L28:	FCLEAR WINNER,OPENBIT
	CALL DO-SL,HERE,SOG,SIR
	FSET WINNER,OPENBIT
	JUMP ?L29
?L26:	LOC WINNER >STACK
	FSET? STACK,VEHBIT \?L29
	LOC WINNER >STACK
	CALL THIS-IT?,STACK >STACK
	ZERO? STACK /?L29
	LOC WINNER >STACK
	CALL OBJ-FOUND,STACK,TBL
?L29:	CALL DO-SL,WINNER,SH,SC
?L25:	GET TBL,P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST P-GETFLAGS,P-ALL /?L61
	EQUAL? P-GETFLAGS,P-ALL /?L33
	GRTR? LEN,1 /?L34
	ZERO? LEN \?L61
	EQUAL? P-SLOCBITS,-1 /?L33
?L34:	EQUAL? P-SLOCBITS,-1 \?L35
	SET 'P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,P-MATCHLEN,STACK
	JUMP ?L21
?L35:	CALL PUT-ADJ-NAM
	ZERO? LEN \?L38
	SET 'LEN,OLEN
?L38:	ZERO? P-NAM /?L41
	ADD TLEN,1 >STACK
	GET TBL,STACK >OBJ
	ZERO? OBJ /?L41
	GETP OBJ,P?GENERIC >STACK
	CALL STACK >OBJ
	ZERO? OBJ /?L41
	EQUAL? OBJ,NOT-HERE-OBJECT /FALSE
	PUT TBL,1,OBJ
	PUT TBL,P-MATCHLEN,1
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE
?L41:	ZERO? VRB /?L51
	EQUAL? WINNER,PROTAGONIST /?L46
	CALL WHICH-PRINT,TLEN,LEN,TBL
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L46:	ZERO? VRB /?L51
	ZERO? P-NAM /?L47
	CALL WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,P-PRSO \?L48
	SET 'P-ACLAUSE,P-NC1
	JUMP ?L50
?L48:	SET 'P-ACLAUSE,P-NC2
?L50:	SET 'P-AADJ,P-ADJ
	SET 'P-ANAM,P-NAM
	CALL ORPHAN,0,0
	SET 'P-OFLAG,1
	JUMP ?L51
?L47:	ZERO? VRB /?L51
	PRINT NOUN-MISSING
?L51:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L33:	ZERO? LEN \?L61
	ZERO? GCHECK /?L53
	CALL PUT-ADJ-NAM
	ZERO? VRB /?L59
	SET 'P-SLOCBITS,XBITS
	ZERO? LIT \?L58
	EQUAL? PRSA,V?TELL,V?WHERE,V?WHAT \?L56
?L58:	CALL OBJ-FOUND,NOT-HERE-OBJECT,TBL
	SET 'P-XNAM,P-NAM
	SET 'P-XADJ,P-ADJ
	SET 'P-XADJN,P-ADJN
	SET 'P-NAM,0
	SET 'P-ADJ,0
	SET 'P-ADJN,0
	RTRUE
?L56:	PRINT TOO-DARK
	CRLF
?L59:	SET 'P-NAM,0
	SET 'P-ADJ,0
	RFALSE
?L53:	ZERO? LEN \?L61
	SET 'GCHECK,1
	JUMP ?L21
?L61:	SET 'P-SLOCBITS,XBITS
	CALL PUT-ADJ-NAM
	SET 'P-NAM,0
	SET 'P-ADJ,0
	RTRUE

	.FUNCT PUT-ADJ-NAM
	EQUAL? P-NAM,W?IT /FALSE
	PUT P-NAMW,P-PHR,P-NAM
	PUT P-ADJW,P-PHR,P-ADJ
	RTRUE

	.FUNCT MOBY-FIND,TBL,OBJ=1,LEN,FOO,NAM,ADJ
	SET 'NAM,P-NAM
	SET 'ADJ,P-ADJ
	SET 'P-NAM,P-XNAM
	SET 'P-ADJ,P-XADJ
	PUT TBL,P-MATCHLEN,0
?L1:	IN? OBJ,ROOMS /?L5
	CALL THIS-IT?,OBJ >FOO
	ZERO? FOO /?L5
	CALL OBJ-FOUND,OBJ,TBL >FOO
?L5:	IGRTR? 'OBJ,LAST-OBJECT \?L1
	GET TBL,P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L11
	GET TBL,1 >P-MOBY-FOUND
?L11:	SET 'P-NAM,NAM
	SET 'P-ADJ,ADJ
	RETURN LEN

	.FUNCT WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	ZERO? LEN \?L1
	CALL REFERRING
	RTRUE
?L1:	SET 'RLEN,LEN
	EQUAL? WINNER,PROTAGONIST /?L4
	PRINTI """I don't understand wh"
	EQUAL? P-ADJ,A?YOUR,A?MY,A?PURPOS \?L6
	PRINTR "at you mean!"""
?L6:	PRINTI "ether you mean "
	JUMP ?L17
?L4:	PRINTI "[Which"
	ZERO? P-OFLAG \?L12
	ZERO? P-MERGED \?L12
	ZERO? P-AND /?L10
?L12:	PRINTI " "
	PRINTB P-NAM
	JUMP ?L14
?L10:	EQUAL? TBL,P-PRSO \?L13
	CALL CLAUSE-PRINT,P-NC1,P-NC1L,0
	JUMP ?L14
?L13:	CALL CLAUSE-PRINT,P-NC2,P-NC2L,0
?L14:	PRINTI " do you mean"
	EQUAL? HERE,ROBOT-POOL \?L15
	EQUAL? P-NAM,W?ROBOT \?L15
	PRINTR "?]"
?L15:	PRINTI ", "
?L17:	INC 'TLEN
	GET TBL,TLEN >OBJ
	FSET? OBJ,NARTICLEBIT /?L20
	PRINTI "the "
?L20:	PRINTD OBJ
	EQUAL? LEN,2 \?L23
	EQUAL? RLEN,2 /?L25
	PRINTI ","
?L25:	PRINTI " or "
	JUMP ?L28
?L23:	GRTR? LEN,2 \?L28
	PRINTI ", "
?L28:	DLESS? 'LEN,1 \?L17
	EQUAL? WINNER,PROTAGONIST /?L33
	PRINTR "."""
?L33:	PRINTR "?]"

	.FUNCT GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT=0,OBJ,OBITS,FOO,?TMP
	GET TBL,P-MATCHLEN >LEN
	SET 'OBITS,P-SLOCBITS
	GETPT HERE,P?GLOBAL >RMG
	ZERO? RMG /?L4
	PTSIZE RMG >STACK
	SUB STACK,1 >RMGL
?L3:	GETB RMG,CNT >OBJ
	CALL THIS-IT?,OBJ >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	IGRTR? 'CNT,RMGL \?L3
?L4:	GETP HERE,P?THINGS >RMG
	ZERO? RMG /?L15
	GET RMG,0 >RMGL
	SET 'CNT,0
?L14:	ZERO? P-NAM /?L16
	ADD CNT,1 >STACK
	GET RMG,STACK >STACK
	EQUAL? P-NAM,STACK \?L19
?L16:	ZERO? P-ADJ /?L18
	SET '?TMP,P-ADJ
	ADD CNT,2 >STACK
	GET RMG,STACK >STACK
	CALL WT?,STACK,PS?ADJECTIVE,P1?ADJECTIVE >STACK
	EQUAL? ?TMP,STACK \?L19
?L18:	ZERO? P-NAM \?L20
	ZERO? P-ADJ /?L19
?L20:	SET 'LAST-PSEUDO-LOC,HERE
	ADD CNT,3 >STACK
	GET RMG,STACK >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	GETPT PSEUDO-OBJECT,P?ACTION >STACK
	SUB STACK,5 >FOO
	ADD CNT,1 >STACK
	GET RMG,STACK >RMG
	GET RMG,0 >STACK
	PUT FOO,0,STACK
	GET RMG,1 >STACK
	PUT FOO,1,STACK
	CALL OBJ-FOUND,PSEUDO-OBJECT,TBL
	JUMP ?L15
?L19:	ADD CNT,3 >CNT
	LESS? CNT,RMGL /?L14
?L15:	GET TBL,P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'P-SLOCBITS,-1
	SET 'P-TABLE,TBL
	CALL DO-SL,GLOBAL-OBJECTS,1,1
	SET 'P-SLOCBITS,OBITS
	RETURN P-SLOCBITS

	.FUNCT DO-SL,OBJ,BIT1,BIT2,BTS
	ADD BIT1,BIT2 >STACK
	BTST P-SLOCBITS,STACK \?L1
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCALL >STACK
	RSTACK
?L1:	BTST P-SLOCBITS,BIT1 \?L4
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCTOP >STACK
	RSTACK
?L4:	BTST P-SLOCBITS,BIT2 \TRUE
	CALL SEARCH-LIST,OBJ,P-TABLE,P-SRCBOT >STACK
	RSTACK

	.FUNCT SEARCH-LIST,OBJ,TBL,LVL,FLS,NOBJ
	FIRST? OBJ >OBJ \FALSE
?L3:	EQUAL? LVL,P-SRCBOT /?L5
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L5
	CALL THIS-IT?,OBJ >STACK
	ZERO? STACK /?L5
	CALL OBJ-FOUND,OBJ,TBL
?L5:	EQUAL? LVL,P-SRCTOP \?L10
	FSET? OBJ,SEARCHBIT /?L10
	FSET? OBJ,SURFACEBIT \?L11
?L10:	FIRST? OBJ >NOBJ \?L11
	FSET? OBJ,OPENBIT /?L13
	FSET? OBJ,TRANSBIT /?L13
	ZERO? P-MOBY-FLAG /?L11
?L13:	FSET? OBJ,SURFACEBIT \?L14
	PUSH P-SRCALL
	JUMP ?L17
?L14:	FSET? OBJ,SEARCHBIT \?L16
	PUSH P-SRCALL
	JUMP ?L17
?L16:	PUSH P-SRCTOP
?L17:	CALL SEARCH-LIST,OBJ,TBL,STACK >FLS
?L11:	NEXT? OBJ >OBJ /?L3
	RTRUE

	.FUNCT OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,P-MATCHLEN >PTR
	ADD PTR,1 >STACK
	PUT TBL,STACK,OBJ
	ADD PTR,1 >STACK
	PUT TBL,P-MATCHLEN,STACK
	RTRUE

	.FUNCT TAKE-CHECK
	GETB P-SYNTAX,P-SLOC1 >STACK
	CALL ITAKE-CHECK,P-PRSO,STACK >STACK
	ZERO? STACK /FALSE
	GETB P-SYNTAX,P-SLOC2 >STACK
	CALL ITAKE-CHECK,P-PRSI,STACK >STACK
	RSTACK

	.FUNCT ITAKE-CHECK,TBL,IBITS,PTR,OBJ,TAKEN
	GET TBL,P-MATCHLEN >PTR
	ZERO? PTR /TRUE
	BTST IBITS,SHAVE /?L3
	BTST IBITS,STAKE \TRUE
?L3:	DLESS? 'PTR,0 /TRUE
	ADD PTR,1 >STACK
	GET TBL,STACK >OBJ
	EQUAL? OBJ,IT \?L9
	CALL VISIBLE?,P-IT-OBJECT >STACK
	ZERO? STACK \?L11
	CALL REFERRING
	RFALSE
?L11:	SET 'OBJ,P-IT-OBJECT
	JUMP ?L17
?L9:	EQUAL? OBJ,HIM \?L17
	CALL VISIBLE?,P-HIM-OBJECT >STACK
	ZERO? STACK \?L15
	CALL REFERRING,1
	RFALSE
?L15:	SET 'OBJ,P-HIM-OBJECT
?L17:	CALL ULTIMATELY-IN?,OBJ >STACK
	ZERO? STACK \?L3
	EQUAL? OBJ,INTNUM,HANDS /?L3
	EQUAL? OBJ,LEASH \?L22
	ZERO? HANGING-IN-AIR \?L3
?L22:	SET 'PRSO,OBJ
	FSET? OBJ,TRYTAKEBIT /?L26
	CALL UNTOUCHABLE?,OBJ >STACK
	ZERO? STACK \?L26
	ZERO? STUNNED /?L24
?L26:	SET 'TAKEN,1
	JUMP ?L29
?L24:	EQUAL? WINNER,PROTAGONIST /?L27
	SET 'TAKEN,0
	JUMP ?L29
?L27:	BTST IBITS,STAKE \?L28
	CALL ITAKE,0 >STACK
	EQUAL? STACK,1 \?L28
	SET 'TAKEN,0
	JUMP ?L29
?L28:	SET 'TAKEN,1
?L29:	ZERO? TAKEN /?L42
	BTST IBITS,SHAVE \?L30
	GET TBL,P-MATCHLEN >STACK
	LESS? 1,STACK \?L32
	PRINT YNH
	PRINTI " all those things!"
	CRLF
	RFALSE
?L32:	EQUAL? OBJ,NOT-HERE-OBJECT \?L34
	PRINT YOU-CANT
	PRINTI "see that here!"
	CRLF
	RFALSE
?L34:	EQUAL? WINNER,PROTAGONIST \?L36
	PRINT YNH
	JUMP ?L38
?L36:	PRINTI "It doesn't look like"
	CALL TPRINT,WINNER
	PRINTI " has"
?L38:	CALL THIS-IS-IT,OBJ
	CALL TRPRINT,OBJ
	RFALSE
?L30:	ZERO? TAKEN \?L3
?L42:	IN? PROTAGONIST,OBJ /?L3
	EQUAL? WINNER,PROTAGONIST \?L3
	PRINTI "[taking"
	CALL TPRINT,OBJ
	PRINTI " first]"
	CRLF
	JUMP ?L3

	.FUNCT MANY-CHECK,PHR=2,LOSS=0,TMP
	ZERO? PHR \?L1
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L5
?L1:	EQUAL? PHR,1 \?L3
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
	JUMP ?L5
?L3:	EQUAL? PHR,2 \?L5
	GET P-PRSO,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L4
	GETB P-SYNTAX,P-SLOC1 >STACK
	BTST STACK,SMANY /?L4
	SET 'LOSS,1
	JUMP ?L5
?L4:	EQUAL? PHR,2 \?L5
	GET P-PRSI,P-MATCHLEN >STACK
	GRTR? STACK,1 \?L5
	GETB P-SYNTAX,P-SLOC2 >STACK
	BTST STACK,SMANY /?L5
	SET 'LOSS,2
?L5:	ZERO? LOSS /TRUE
	PRINTI "["
	PRINT YOU-CANT
	PRINTI "use multiple "
	EQUAL? LOSS,2 \?L9
	PRINTI "in"
?L9:	PRINTI "direct objects with """
	GET P-ITBL,P-VERBN >TMP
	ZERO? TMP \?L12
	PRINTI "tell"
	JUMP ?L16
?L12:	ZERO? P-OFLAG \?L15
	ZERO? P-MERGED /?L14
?L15:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L16
?L14:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL WORD-PRINT,STACK,STACK
?L16:	PRINTI """.]"
	CRLF
	RFALSE

	.FUNCT ZMEMQ,ITM,TBL,SIZE=-1,CNT=1
	ZERO? TBL /FALSE
	LESS? SIZE,0 /?L4
	SET 'CNT,0
	JUMP ?L6
?L4:	GET TBL,0 >SIZE
?L6:	GET TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L6
	RFALSE

	.FUNCT ZMEMQB,ITM,TBL,SIZE,CNT=0
?L1:	GETB TBL,CNT >STACK
	EQUAL? ITM,STACK /TRUE
	IGRTR? 'CNT,SIZE \?L1
	RFALSE

	.FUNCT LIT?,RM,RMBIT=1,OHERE,LIT?1=0
	SET 'P-GWIMBIT,ONBIT
	SET 'OHERE,HERE
	SET 'HERE,RM
	ZERO? RMBIT /?L1
	FSET? RM,ONBIT \?L1
	SET 'LIT?1,1
	JUMP ?L10
?L1:	PUT P-MERGE,P-MATCHLEN,0
	SET 'P-TABLE,P-MERGE
	SET 'P-SLOCBITS,-1
	EQUAL? OHERE,RM \?L6
	CALL DO-SL,WINNER,1,1
	EQUAL? WINNER,PROTAGONIST /?L6
	IN? PROTAGONIST,RM \?L6
	CALL DO-SL,PROTAGONIST,1,1
?L6:	CALL DO-SL,RM,1,1
	GET P-TABLE,P-MATCHLEN >STACK
	GRTR? STACK,0 \?L10
	SET 'LIT?1,1
?L10:	SET 'HERE,OHERE
	SET 'P-GWIMBIT,0
	RETURN LIT?1

	.FUNCT PRSO-PRINT,PTR
	ZERO? P-MERGED \?L3
	GET P-ITBL,P-NC1 >PTR
	GET PTR,0 >STACK
	EQUAL? STACK,W?IT \?L1
?L3:	PRINTI " "
	PRINTD PRSO
	RTRUE
?L1:	GET P-ITBL,P-NC1L >STACK
	CALL BUFFER-PRINT,PTR,STACK,0 >STACK
	RSTACK

	.FUNCT PRSI-PRINT,PTR
	ZERO? P-MERGED \?L3
	GET P-ITBL,P-NC2 >PTR
	GET PTR,0 >STACK
	EQUAL? STACK,W?IT \?L1
?L3:	PRINTI " "
	PRINTD PRSI
	RTRUE
?L1:	GET P-ITBL,P-NC2L >STACK
	CALL BUFFER-PRINT,PTR,STACK,0 >STACK
	RSTACK

	.FUNCT THIS-IT?,OBJ,SYNS
	FSET? OBJ,INVISIBLE /FALSE
	ZERO? P-NAM /?L3
	GETPT OBJ,P?SYNONYM >SYNS
	PTSIZE SYNS >STACK
	DIV STACK,2 >STACK
	DEC 'STACK
	CALL ZMEMQ,P-NAM,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L3:	ZERO? P-ADJ /?L4
	GETPT OBJ,P?ADJECTIVE >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DEC 'STACK
	CALL ZMEMQB,P-ADJ,SYNS,STACK >STACK
	ZERO? STACK /FALSE
?L4:	ZERO? P-GWIMBIT /TRUE
	FSET? OBJ,P-GWIMBIT /TRUE
	RFALSE

	.FUNCT INTDIR-F
	EQUAL? PRSA,V?SET \FALSE
	PRINTR "Okay, you're now facing in that direction, but you don't see anything you didn't see before."

	.FUNCT INTNUM-F
	CALL ADJ-USED,A?BIN,INTNUM >STACK
	ZERO? STACK /?L1
	EQUAL? HERE,ROBOT-POOL /?L3
	PRINT YOU-CANT
	PRINTR "see any bin here!]"
?L3:	GRTR? P-NUMBER,3 \?L5
	PRINTR "There are only three bins!"
?L5:	PRINT REFER-TO-BIN
	RTRUE
?L1:	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?ONE,W?TWO,W?THREE \?L7
	CALL GLOBAL-IN?,KEYPAD,HERE >STACK
	ZERO? STACK /?L7
	EQUAL? PRSA,V?TYPE,V?PUSH \?L7
	PRINTR "[Use numerals: for example, TYPE 5 rather than TYPE FIVE.]"
?L7:	EQUAL? PRSA,V?ON,V?SHOOT,V?EXAMINE /?L9
	EQUAL? PRSA,V?MUNG,V?KILL,V?OFF \?L8
?L9:	GET WELDER-TABLE,WELDER-TABLE-POINTER >STACK
	EQUAL? STACK,P-NUMBER \?L8
	IN? WELDER,HERE \?L8
	EQUAL? PRSO,INTNUM \?L10
	CALL PERFORM,PRSA,WELDER,PRSI
	RTRUE
?L10:	CALL PERFORM,PRSA,PRSO,WELDER
	RTRUE
?L8:	EQUAL? PRSA,V?ENTER \?L15
	EQUAL? P-PRSA-WORD,W?ENTER \?L15
	CALL GLOBAL-IN?,KEYPAD,HERE >STACK
	ZERO? STACK \?L14
?L15:	EQUAL? PRSA,V?PUSH \?L13
	CALL GLOBAL-IN?,KEYPAD,HERE >STACK
	ZERO? STACK /?L13
?L14:	CALL PERFORM,V?TYPE,INTNUM
	RTRUE
?L13:	EQUAL? PRSA,V?SET \?L16
	ZERO? PRSI \?L16
	EQUAL? HERE,COMMANDERS-QUARTERS \?L16
	EQUAL? P-NUMBER,DIAL-SETTING \?L17
	PRINT SENILITY-STRIKES
	RTRUE
?L17:	GRTR? P-NUMBER,8000 \?L19
	PRINTR "The dial goes up to only 8000."
?L19:	SET 'DIAL-SETTING,P-NUMBER
	PRINTR """Click."""
?L16:	EQUAL? PRSA,V?WAIT-FOR \?L21
	GRTR? P-NUMBER,40 \?L22
	PRINT TOO-LONG-TO-WAIT
	RTRUE
?L22:	CALL V-WAIT >STACK
	RSTACK
?L21:	EQUAL? PRSA,V?WAIT-UNTIL \?L25
	GRTR? P-NUMBER,INTERNAL-MOVES \?L26
	SUB P-NUMBER,INTERNAL-MOVES >STACK
	LESS? STACK,41 \?L26
	CALL V-WAIT >STACK
	RSTACK
?L26:	PRINT TOO-LONG-TO-WAIT
	RTRUE
?L25:	CALL TOUCHING?,INTNUM >STACK
	ZERO? STACK \?L30
	EQUAL? PRSA,V?SHOOT \FALSE
?L30:	PRINT HUH
	CALL PRINT-ID,STR?66 >STACK
	RSTACK

	.FUNCT NOT-HERE-OBJECT-F,TBL,PRSO?=1,OBJ,X=0
	EQUAL? PRSO,NOT-HERE-OBJECT \?L3
	EQUAL? PRSI,NOT-HERE-OBJECT \?L1
	PRINTR "Those things aren't here!"
?L1:	EQUAL? PRSO,NOT-HERE-OBJECT \?L3
	SET 'TBL,P-PRSO
	JUMP ?L4
?L3:	SET 'TBL,P-PRSI
	SET 'PRSO?,0
?L4:	ZERO? PRSO? /?L30
	CALL PRSO-MOBY-VERB? >STACK
	ZERO? STACK /?L5
	SET 'X,1
	JUMP ?L7
?L5:	ZERO? PRSO? \?L7
?L30:	CALL PRSI-MOBY-VERB? >STACK
	ZERO? STACK /?L7
	SET 'X,1
?L7:	ZERO? X /?L9
	CALL FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,NOT-HERE-OBJECT \TRUE
	EQUAL? PRSA,V?FOLLOW,V?WALK-TO \?L17
	CALL V-WALK-AROUND
	JUMP ?L20
?L17:	PRINTI "["
	PRINT YOULL-HAVE-TO
	PRINTI "be more specific.]"
	CRLF
	JUMP ?L20
?L9:	EQUAL? WINNER,PROTAGONIST \?L21
	PRINTI "You"
	JUMP ?L23
?L21:	PRINTI "Looking confused,"
	CALL TPRINT,WINNER
	PRINTI " says, ""I"
?L23:	PRINTI " can't see"
	CALL NAME?,P-XNAM >STACK
	ZERO? STACK \?L24
	PRINTI " any"
?L24:	CALL NOT-HERE-PRINT,PRSO?
	PRINTI " here!"
	EQUAL? WINNER,PROTAGONIST /?L27
	PRINTI """"
?L27:	CRLF
?L20:	CALL STOP >STACK
	RSTACK

	.FUNCT PRSO-MOBY-VERB?
	EQUAL? PRSA,V?WHAT,V?WHERE,V?WAIT-FOR /TRUE
	EQUAL? PRSA,V?WALK-TO,V?CALL,V?SAY /TRUE
	EQUAL? PRSA,V?FIND,V?FOLLOW \FALSE
	RTRUE

	.FUNCT PRSI-MOBY-VERB?
	EQUAL? PRSA,V?ASK-ABOUT,V?ASK-FOR,V?TELL-ABOUT \FALSE
	RTRUE

	.FUNCT FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ
	CALL MOBY-FIND,TBL >M-F
	EQUAL? 1,M-F \?L1
	ZERO? PRSO? /?L3
	SET 'PRSO,P-MOBY-FOUND
	CALL THIS-IS-IT,PRSO
	RFALSE
?L3:	SET 'PRSI,P-MOBY-FOUND
	RFALSE
?L1:	LESS? 1,M-F \?L6
	GET TBL,1 >OBJ
	GETP OBJ,P?GENERIC >STACK
	CALL STACK >OBJ
	ZERO? OBJ /?L6
	EQUAL? OBJ,NOT-HERE-OBJECT /TRUE
	ZERO? PRSO? /?L9
	SET 'PRSO,OBJ
	CALL THIS-IS-IT,PRSO
	RFALSE
?L9:	SET 'PRSI,OBJ
	RFALSE
?L6:	RETURN NOT-HERE-OBJECT

	.FUNCT NOT-HERE-PRINT,PRSO?
	ZERO? P-OFLAG /?L1
	ZERO? P-XADJ /?L3
	PRINTI " "
	PRINTB P-XADJN
?L3:	ZERO? P-XNAM /FALSE
	PRINTI " "
	PRINTB P-XNAM
	RTRUE
?L1:	ZERO? PRSO? /?L9
	GET P-ITBL,P-NC1L >STACK
	GET P-ITBL,P-NC1 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK
?L9:	GET P-ITBL,P-NC2L >STACK
	GET P-ITBL,P-NC2 >STACK
	CALL BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK

	.FUNCT GROUND-F
	EQUAL? PRSA,V?ENTER,V?CLIMB-ON \?L1
	ZERO? STUNNED /?L3
	PRINT LOOK-AROUND
	RTRUE
?L3:	SET 'C-ELAPSED,31
	PRINTR "After a brief squat on the floor, you stand again."
?L1:	EQUAL? PRSA,V?CLEAN \?L6
	SET 'AWAITING-REPLY,1
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTR "Do you also do windows?"
?L6:	EQUAL? PRSA,V?LOOK-UNDER \?L7
	CALL IMPOSSIBLES >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?OPEN \?L8
	EQUAL? HERE,BOTTOM-OF-AIR-SHAFT \?L8
	CALL PERFORM,V?OPEN,GRATING
	RTRUE
?L8:	EQUAL? PRSA,V?LEAVE \FALSE
	CALL DO-WALK,P?UP >STACK
	RSTACK

	.FUNCT WALLS-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	EQUAL? HERE,HOLDING-TANK-LEVEL \FALSE
	PRINT BLASTED-OPEN
	PRINT PERIOD-CR
	RTRUE

	.FUNCT CEILING-F
	EQUAL? PRSA,V?SEARCH,V?EXAMINE \?L1
	EQUAL? HERE,PET-STORE \?L1
	IN? PANEL,HERE \?L3
	PRINTI "There's a panel mounted in the ceiling. "
	CALL PERFORM,V?EXAMINE,PANEL
	RTRUE
?L3:	IN? PANEL,LOCAL-GLOBALS \FALSE
	MOVE PANEL,HERE
	CALL THIS-IS-IT,PANEL
	PRINTR "As you look carefully, you notice something that a casual inspection of the Pet Store would never have uncovered: a panel mounted in the ceiling."
?L1:	EQUAL? PRSA,V?EXAMINE \?L7
	EQUAL? HERE,DOME \?L7
	PRINT DOME-DESC
	CRLF
	RTRUE
?L7:	EQUAL? PRSA,V?LOOK-UNDER \FALSE
	CALL PERFORM,V?LOOK
	RTRUE

	.FUNCT GLOBAL-ROOM-F
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE,V?LOOK \?L1
	CALL V-LOOK >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?WALK-TO,V?ENTER \?L3
	CALL V-WALK-AROUND >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?DISEMBARK,V?EXIT,V?LEAVE \?L4
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?WALK-AROUND \?L5
	EQUAL? HERE,BARBERSHOP \?L5
	ZERO? MIRROR-BROKEN \?L5
	CALL ULTIMATELY-IN?,PLATINUM-DETECTOR >STACK
	ZERO? STACK /?L5
	FSET? PLATINUM-DETECTOR,ACTIVEBIT \?L5
	CALL PERFORM,V?FOLLOW,PLATINUM-DETECTOR
	RTRUE
?L5:	EQUAL? PRSA,V?SEARCH \?L6
	ZERO? LIT \?L7
	PRINT TOO-DARK
	CRLF
	RTRUE
?L7:	EQUAL? HERE,GREASY-STRAW \?L9
	FSET? NECTAR,TOUCHBIT /?L9
	MOVE NECTAR,HERE
	CALL THIS-IS-IT,NECTAR
	PRINTR "You spot a cup of Ramosian Fire Nectar behind the counter!"
?L9:	PRINTR "A cursory search of the room reveals nothing new."
?L6:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,GLOBAL-ROOM \FALSE
	EQUAL? P-PRSA-WORD,W?THROW \?L12
	CALL PERFORM,V?THROW,PRSO
	RTRUE
?L12:	CALL PERFORM,V?DROP,PRSO
	RTRUE

	.FUNCT WINDOW-F
	EQUAL? PRSA,V?LOOK-INSIDE \?L1
	EQUAL? HERE,SHADY-DANS \?L3
	PRINT DANS-LOT-DESC
	CRLF
	RTRUE
?L3:	EQUAL? HERE,DOCKING-BAY-2,CARGO-BAY \?L5
	PRINTI "You see the interior of"
	CALL TRPRINT,SPACETRUCK-OBJECT
	RTRUE
?L5:	EQUAL? SPACETRUCK-COUNTER,5 \?L6
	EQUAL? COURSE-PICKED,RIGHT-COURSE \?L6
	PRINTR "You see an empty docking bay."
?L6:	EQUAL? SPACETRUCK-COUNTER,-1 \?L7
	PRINTR "You see a large cargo bay."
?L7:	EQUAL? SPACETRUCK-COUNTER,4 \?L8
	EQUAL? COURSE-PICKED,RIGHT-COURSE \?L8
	PRINTI "   You are approaching the station from slightly above it (on the galactic plane), thus offering a good view of the station's layout. In the center is the large, spherical Command Module. Jutting ""north"" from it is a smaller Sub-Module. Joining the Command Module, at its two other connection points,"
	PRINT TANGLE-OF-TUBES
	PRINTR " These form a ""village,"" the sort of seedy, unauthorized village that frequently collects around a space station."
?L8:	PRINTR "You see nothing but the majestic sweep of the galaxy."
?L1:	EQUAL? PRSA,V?CLEAN \FALSE
	SET 'AWAITING-REPLY,1
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTR "Do you also do floors?"

	.FUNCT SIGN-F
	EQUAL? HERE,DOME \?L1
	IN? HOUSING,DOME /?L1
	CALL CANT-SEE,SIGN >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?READ \FALSE
	EQUAL? HERE,DOME \?L4
	CALL PERFORM,V?READ,HOUSING
	RTRUE
?L4:	EQUAL? HERE,GYM \?L6
	PRINTI """IMPORTANT! The "
	PRINTD EXERCISE-MACHINE
	PRINTI " has diagnostic frequencies which communicate with each other on frequency 710. Do not bring anything which broadcasts on that frequency within range of the machine!"""
	IN? EXERCISE-MACHINE,GYM /?L7
	PRINTI " Strangely, you don't see any "
	PRINTD EXERCISE-MACHINE
	PRINTI " anywhere in the gym."
?L7:	CRLF
	RTRUE
?L6:	EQUAL? HERE,SHIPPING-ROOM \?L10
	PRINTR """Always return the forklift to the shipping room when it's not in use! THIS MEANS YOU!"""
?L10:	EQUAL? HERE,GREASY-STRAW \?L11
	PRINT RESTAURANT-SIGN-TEXT
	CRLF
	RTRUE
?L11:	EQUAL? HERE,TRADING-POST \?L12
	PRINTR """!!!BEST PRICES IN TOWN!!!
IF YOU DON'T SEE IT ASK FOR IT!
Illegal wares shown by appointment only.
FREZONE (tm) explosive available."""
?L12:	EQUAL? HERE,PET-STORE \?L13
	PRINTI """SPECIAL!!! The best pet a lonely spacer could ever hope for!
   "
	PRINTD BALLOON
	PRINTI "s are fascinating critters. Filled with hydrogen, they float freely through the air like small dirigibles.
   With their translucent bodies and iridescent skin, they're a beautiful addition to the decor of any living bubble. Docile and friendly, "
	PRINTD BALLOON
	PRINTI "s are easy to care for, feeding on airborne spores!
   Limited supply!! Order yours today!!""
   You recall one fact about "
	PRINTD BALLOON
	PRINTR "s which the sign fails to mention: they propel themselves around by ejecting digestive gasses. This makes them one of the smelliest pets imaginable."
?L13:	EQUAL? HERE,OPIUM-DEN \?L14
	PRINTR "The sign is from the government's latest anti-drug crusade. It depicts the president of the Third Galactic Union, her hands crossed across her chest in a defiant pose, with the caption, ""Drugs are a no-no!"" You notice that someone has drawn a mustache on her."
?L14:	PRINTR """TRADING POST VACUUM STORAGE AREA
   Trespassers will be spaced!"""

	.FUNCT EQUIPMENT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,ROBOT-POOL \?L3
	PRINT ROBOT-POOL-EQUIPMENT-DESC
	CRLF
	RTRUE
?L3:	PRINTR "Since this equipment has nothing to do with the filling out or filing of multi-part forms, it's far outside your area of expertise."
?L1:	EQUAL? PRSA,V?USE \?L6
	EQUAL? HERE,ROBOT-POOL \?L6
	PRINTR "Put the form in the slot, you dolt!"
?L6:	EQUAL? PRSA,V?OFF,V?ON \FALSE
	CALL PERFORM,V?EXAMINE,EQUIPMENT
	RTRUE

	.FUNCT FIXTURES-F
	EQUAL? PRSA,V?USE,V?WALK-TO,V?ENTER \?L1
	PRINTR "This story doesn't go into that sort of detail."
?L1:	EQUAL? PRSA,V?ON,V?TAKE \FALSE
	CALL NOUN-USED,W?SHOWER,FIXTURES >STACK
	ZERO? STACK /FALSE
	CALL PERFORM,V?USE,FIXTURES
	RTRUE

	.FUNCT HOLE-F
	EQUAL? PRSA,V?DRILL-HOLE \?L1
	EQUAL? PRSO,HOLE /FALSE
?L1:	EQUAL? PRSA,V?DRILL \?L3
	EQUAL? PRSO,HOLE \?L3
	CALL PERFORM,V?DRILL-HOLE,HOLE,WALLS
	RTRUE
?L3:	CALL PRSO-MOBY-VERB? >STACK
	ZERO? STACK \FALSE
	CALL PRSI-MOBY-VERB? >STACK
	ZERO? STACK \FALSE
	CALL CANT-SEE,HOLE >STACK
	RSTACK

	.FUNCT LADDER-F
	EQUAL? PRSA,V?CLIMB-UP \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?CLIMB-DOWN \FALSE
	CALL DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT HANDS-F,ACTOR
	EQUAL? PRSA,V?APPLAUD \?L1
	SET 'PRSO,0
	RFALSE
?L1:	EQUAL? PRSA,V?SHAKE \?L3
	CALL FIND-IN,HERE,ACTORBIT,STR?67 >ACTOR
	ZERO? ACTOR /?L4
	CALL PERFORM,V?SHAKE-WITH,HANDS,ACTOR
	RTRUE
?L4:	PRINTR "Pleased to meet you."
?L3:	EQUAL? PRSA,V?COUNT \?L7
	CALL NOUN-USED,W?FINGER,HANDS >STACK
	ZERO? STACK /?L8
	PRINTI "Ten"
	JUMP ?L10
?L8:	PRINTI "Two"
?L10:	PRINTR ", as usual."
?L7:	EQUAL? PRSA,V?CLEAN \?L11
	PRINTR "Done."
?L11:	EQUAL? PRSA,V?SHOOT \?L12
	CALL PRINT-ID,STR?68
	CALL JIGS-UP,STR?69 >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?DRILL \?L13
	PRINTI "Hmmm. Are you trying for a hole in "
	PRINTD PRSO
	PRINTI " to match the hole in your head?"
	CRLF
	CALL PRINT-ID,STR?70 >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?TAKE-WITH \FALSE
	EQUAL? PRSI,HANDS \FALSE
	CALL PERFORM,V?TAKE,PRSO
	RTRUE

	.FUNCT TONGUE-F
	EQUAL? PRSA,V?RUN-OVER,V?PUT-ON \?L1
	EQUAL? PRSO,TONGUE \?L1
	CALL PERFORM,V?TASTE,PRSI
	RTRUE
?L1:	EQUAL? PRSA,V?DRILL \FALSE
	CALL HANDS-F >STACK
	RSTACK

	.FUNCT ME-F
	EQUAL? PRSA,V?TELL \?L1
	PRINTI "Talking to yourself is a sign of impending mental collapse."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?DRILL \?L3
	PRINTI "Why bother? Based on that input, you already have holes in your head!"
	CRLF
	CALL PRINT-ID,STR?71 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?GIVE \?L4
	EQUAL? PRSI,ME \?L4
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L4:	EQUAL? PRSA,V?SHOW \?L5
	EQUAL? PRSI,ME \?L5
	CALL PERFORM,V?EXAMINE,PRSO
	RTRUE
?L5:	EQUAL? PRSA,V?MOVE \?L6
	CALL V-WALK-AROUND >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?SEARCH \?L7
	CALL V-INVENTORY >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?MUNG,V?KILL \?L8
	EQUAL? PRSO,ME \?L8
	CALL PRINT-ID,STR?72
	CALL JIGS-UP,STR?73 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?SHOOT \?L9
	CALL PRINT-ID,STR?74
	CALL JIGS-UP,STR?75 >STACK
	RSTACK
?L9:	EQUAL? PRSA,V?WHERE,V?FIND \?L10
	PRINTI "You're in"
	CALL TRPRINT,HERE
	RTRUE
?L10:	EQUAL? PRSA,V?FOLLOW \?L11
	PRINTR "It would be hard not to."
?L11:	EQUAL? PRSA,V?EXAMINE \?L12
	CALL V-DIAGNOSE >STACK
	RSTACK
?L12:	EQUAL? PRSA,V?ALARM \?L13
	PRINTR "You are!"
?L13:	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "How romantic!"

	.FUNCT GRUE-F
	EQUAL? PRSA,V?WHAT \?L1
	PRINTR "Grues are vicious, carnivorous beasts first introduced to Earth by an alien spaceship during the 22nd century. Grues spread throughout the galaxy alongside man. Now extinct on all civilized planets, they still exist in some backwater corners of the galaxy. Their favorite diet is Lieutenants First Class, but their insatiable appetite is tempered by their fear of light."
?L1:	CALL TOUCHING?,GRUE >STACK
	ZERO? STACK \?L4
	EQUAL? PRSA,V?WALK-TO,V?EXAMINE \FALSE
?L4:	PRINTR "There's no grue in sight, fortunately."

	.FUNCT FORM-SLOT-F
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,PSEUDO-OBJECT \?L1
	EQUAL? PRSO,CRUMPLED-FORM \?L3
	PRINTR "The form's crumpledness prevents it from sliding into the slot."
?L3:	EQUAL? PRSO,CLASS-THREE-SPACECRAFT-ACTIVATION-FORM \?L5
	EQUAL? HERE,SPACETRUCK \?L5
	EQUAL? HERE,SPACETRUCK \?L6
	CALL BOTH-SEATS-NOT-OCCUPIED >STACK
	ZERO? STACK /?L6
	PRINTI "The form is spit back out. "
	CALL RECORDING,STR?76
	CALL PRINT-ID,STR?77 >STACK
	RSTACK
?L6:	REMOVE PRSO
	FSET PRSO,NDESCBIT
	PRINT FORM-ACCEPTED
	CALL RECORDING,STR?78 >STACK
	RSTACK
?L5:	EQUAL? PRSO,ROBOT-USE-AUTHORIZATION-FORM \?L9
	EQUAL? HERE,ROBOT-POOL \?L9
	REMOVE PRSO
	FSET PRSO,NDESCBIT
	PRINT FORM-ACCEPTED
	CALL RECORDING,STR?79 >STACK
	RSTACK
?L9:	EQUAL? PRSO,ASSIGNMENT-COMPLETION-FORM \?L10
	EQUAL? HERE,DECK-TWELVE \?L10
	PRINT FORM-REJECTED
	CALL RECORDING,STR?80 >STACK
	RSTACK
?L10:	EQUAL? PRSO,VILLAGE-FORM \?L11
	EQUAL? HERE,SOUTH-CONNECTION,EAST-CONNECTION \?L11
	ZERO? VILLAGE-FORM-VALIDATED \?L12
	PRINT FORM-REJECTED
	CALL RECORDING,STR?80
	CALL PRINT-ID,STR?81 >STACK
	RSTACK
?L12:	ADD SCORE,6 >SCORE
	INC 'ROBOT-EVILNESS
	FSET IRIS-HATCH,OPENBIT
	REMOVE PRSO
	FSET PRSO,NDESCBIT
	PRINTR "The hatch begins irising open, then sparks and smokes and grinds to a halt. However, it's about half dilated, wide enough to pass through. Beyond, you can see a small, dingy connecting tube, rather than the clean and brightly-lit Sub-Module connector you might have expected."
?L11:	EQUAL? PRSO,ASSIGNMENT-COMPLETION-FORM,CLASS-THREE-SPACECRAFT-ACTIVATION-FORM,ROBOT-USE-AUTHORIZATION-FORM /?L16
	EQUAL? PRSO,VILLAGE-FORM \?L15
?L16:	PRINT FORM-REJECTED
	CALL RECORDING,STR?82 >STACK
	RSTACK
?L15:	GETP P?SIZE,PRSO >STACK
	LESS? STACK,3 \?L17
	PRINTI "The slot swallows"
	CALL TPRINT-PRSO
	PRINTR " and then spits it back."
?L17:	CALL DOESNT-FIT,STR?83 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINT ONLY-BLACKNESS
	RTRUE

	.FUNCT BOTH-SEATS-NOT-OCCUPIED
	IN? PROTAGONIST,PILOT-SEAT \?L1
	IN? FLOYD,COPILOT-SEAT /FALSE
?L1:	IN? PROTAGONIST,COPILOT-SEAT \TRUE
	IN? FLOYD,PILOT-SEAT \TRUE
	RFALSE

	.FUNCT KEYPAD-F
	EQUAL? PRSA,V?PUSH \FALSE
	RANDOM 10 >STACK
	SUB STACK,1 >P-NUMBER
	PRINTI "Randomly, you hit "
	PRINTN P-NUMBER
	PRINTI ". "
	CALL PERFORM,V?TYPE,INTNUM
	RTRUE

	.FUNCT FURNISHING-F
	EQUAL? PRSA,V?SEARCH,V?OPEN,V?ENTER /?L3
	EQUAL? PRSA,V?EXAMINE,V?LOOK-INSIDE \?L1
?L3:	PRINTR "You merely find a few personal items of little interest."
?L1:	EQUAL? PRSA,V?PUT-ON,V?PUT \FALSE
	PRINTI "The "
	PRINTD PRSI
	PRINTI " is such a mess that you can't find a good spot to put"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT VILLAGE-F
	EQUAL? HERE,SPACETRUCK \?L1
	EQUAL? SPACETRUCK-COUNTER,4 \?L3
	EQUAL? COURSE-PICKED,RIGHT-COURSE /?L1
?L3:	CALL CANT-SEE,VILLAGE >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXIT,V?WALK-TO,V?ENTER /?L5
	EQUAL? PRSA,V?DISEMBARK,V?LEAVE \?L4
?L5:	CALL V-WALK-AROUND >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?EXAMINE \FALSE
	EQUAL? HERE,SPACETRUCK \FALSE
	PRINTI "The village"
	PRINT TANGLE-OF-TUBES
	CRLF
	RTRUE

	.FUNCT BED-F
	EQUAL? PRSA,V?WALK-TO \?L1
	CALL GLOBAL-IN?,BED,HERE >STACK
	ZERO? STACK \?L1
	PRINTR "There's no bed here!"
?L1:	EQUAL? PRSA,V?WALK-TO,V?ENTER \?L3
	ZERO? STUNNED /?L4
	CALL YOURE-STUNNED >STACK
	RSTACK
?L4:	GRTR? SLEEPY-LEVEL,0 \?L6
	MOVE PROTAGONIST,BED
	CALL QUEUE,I-FALL-ASLEEP,22
	CALL DEQUEUE,I-SLEEP-WARNINGS
	PRINTR "Ahhh...the bed is soft and comfortable. You should be asleep in short order."
?L6:	MOVE PROTAGONIST,BED
	PRINTR "You are now in bed."
?L3:	EQUAL? PRSA,V?EXIT,V?STAND,V?DISEMBARK /?L9
	EQUAL? PRSA,V?DROP \?L8
?L9:	CALL QUEUED?,I-FALL-ASLEEP >STACK
	ZERO? STACK /?L8
	PRINTR "But you're so tired and this bed is so comfy!"
?L8:	EQUAL? PRSA,V?DROP,V?EXIT,V?LEAVE \?L10
	CALL PERFORM,V?DISEMBARK,BED
	RTRUE
?L10:	EQUAL? PRSA,V?PUT-ON,V?PUT \?L11
	EQUAL? PRSI,BED \?L11
	MOVE PRSO,HERE
	PRINTI "The "
	PRINTD PRSO
	PRINTI " bounces off the bed"
	PRINT LANDS-ON-FLOOR
	CRLF
	RTRUE
?L11:	EQUAL? PRSA,V?LOOK-UNDER \?L13
	IN? PROTAGONIST,BED \?L12
	PRINTR "You're IN the bed, so unless you have X-ray vision..."
?L12:	EQUAL? PRSA,V?LOOK-UNDER \?L13
	EQUAL? HERE,COMMANDERS-QUARTERS \?L13
	FSET? VALIDATION-STAMP,TOUCHBIT /?L13
	FSET VALIDATION-STAMP,TOUCHBIT
	MOVE VALIDATION-STAMP,HERE
	CALL THIS-IS-IT,VALIDATION-STAMP
	PRINTI "You discover a "
	PRINTD VALIDATION-STAMP
	PRINTR "!"
?L13:	EQUAL? PRSA,V?SHOOT,V?KILL,V?DRILL \FALSE
	PRINTI "That would be a clear case of mattresscide!"
	CRLF
	CALL PRINT-ID,STR?84 >STACK
	RSTACK

	.FUNCT SLEEP-F
	EQUAL? PRSA,V?TAKE,V?WALK-TO \FALSE
	CALL V-SLEEP >STACK
	RSTACK

	.FUNCT I-SLEEP-WARNINGS
	IN? WELDER,HERE \?L4
	GRTR? SLEEPY-LEVEL,3 /?L3
?L4:	ZERO? STUNNED /?L1
?L3:	CALL QUEUE,I-HUNGER-WARNINGS,2
	RFALSE
?L1:	INC 'SLEEPY-LEVEL
	PRINTI "   "
	IN? PROTAGONIST,BED \?L6
	CALL DEQUEUE,I-SLEEP-WARNINGS
	CALL QUEUE,I-FALL-ASLEEP,16
	PRINTI "You suddenly realize how tired you were and how comfortable the bed is. You should be asleep in no time."
	CRLF
	JUMP ?L12
?L6:	EQUAL? SLEEPY-LEVEL,1 \?L8
	CALL QUEUE,I-SLEEP-WARNINGS,320
	PRINTI "You begin to feel weary. It might be time to think about finding a nice safe place to sleep."
	CRLF
	JUMP ?L12
?L8:	EQUAL? SLEEPY-LEVEL,2 \?L9
	CALL QUEUE,I-SLEEP-WARNINGS,160
	PRINTI "You're really tired now. You'd better find a place to sleep real soon."
	CRLF
	JUMP ?L12
?L9:	EQUAL? SLEEPY-LEVEL,3 \?L10
	CALL QUEUE,I-SLEEP-WARNINGS,80
	PRINTI "If you don't get some sleep soon you'll probably drop."
	CRLF
	CALL PRINT-ID,STR?85
	JUMP ?L12
?L10:	EQUAL? SLEEPY-LEVEL,4 \?L11
	CALL QUEUE,I-SLEEP-WARNINGS,40
	PRINTI "You can barely keep your eyes open."
	CRLF
	JUMP ?L12
?L11:	EQUAL? HERE,BED \?L13
	PRINTI "You slowly sink into a deep and blissful sleep."
	JUMP ?L16
?L13:	CALL GLOBAL-IN?,BED,HERE >STACK
	ZERO? STACK /?L15
	MOVE PROTAGONIST,BED
	PRINTI "You climb into one of the beds and immediately fall asleep."
	JUMP ?L16
?L15:	PRINT YOU-CANT
	PRINTI "stay awake a moment longer. You drop "
	CALL PRINT-ID,STR?86
	IN? PROTAGONIST,HERE \?L17
	FSET? HERE,WEIGHTLESSBIT /?L17
	PRINTI "to the deck and fall "
?L17:	PRINTI "into a deep but fitful sleep."
?L16:	CALL WAKING-UP
?L12:	IN? PROTAGONIST,BED /FALSE
	CALL STOP >STACK
	RSTACK

	.FUNCT I-FALL-ASLEEP
	IN? WELDER,HERE \?L1
	CALL QUEUE,I-FALL-ASLEEP,2
?L1:	PRINTI "   You slowly sink into a deep sleep.pid2"
	CALL DEQUEUE,I-FALL-ASLEEP
	CALL WAKING-UP >STACK
	RSTACK

	.FUNCT WAKING-UP,X,N,?TMP
	CRLF
	CRLF
	IN? PROTAGONIST,BED /?L1
	MOVE PROTAGONIST,HERE
?L1:	FSET? SPACESUIT,WORNBIT \?L4
	CALL PRINT-ID,STR?87
	CALL JIGS-UP,STR?88
	JUMP ?L19
?L4:	EQUAL? COURSE-PICKED,RIGHT-COURSE /?L6
	EQUAL? HERE,SPACETRUCK \?L6
	PRINTI "You wake up gasping for air! The "
	PRINTD SPACETRUCK-OBJECT
	CALL RUNNING?,I-SPACETRUCK >STACK
	ZERO? STACK /?L7
	PRINTI " is dead in uncharted space and it"
	JUMP ?L9
?L7:	PRINTI "'"
?L9:	PRINTI "s oxygen is running out!"
	CRLF
	CALL I-SUFFOCATE
	JUMP ?L19
?L6:	EQUAL? SPACETRUCK-COUNTER,-1 \?L10
	PRINTI "A clanging noise wakes you up, and you slowly become aware that you are in the Duffy's brig, and furthermore, you are wearing the uniform of an Ensign Ninth Class! You trace the clanging noise to a pipe in your cell.
   Placing your ear against the pipe, you hear, ""Psst! Grapevine news! Some dumb kripping "
	PRINT LFC
	PRINTI " fell asleep on Deck Twelve in the middle of some big assignment! The poor trot-head's been broken to Ensign Ninth, and there's talk of a court-martial!""
   Sure enough, the next morning you are led in front of a firing squad. Moral: don't screw up vital assignments like picking up "
	PRINT FORM-NAME
	CALL PRINT-ID,STR?89
	CALL JIGS-UP,STR?90
	JUMP ?L19
?L10:	IN? PROTAGONIST,HERE \?L13
	FSET? DOCKING-BAY-2,TOUCHBIT \?L13
	MUL DAY,40 >?TMP
	RANDOM 100 >STACK
	LESS? ?TMP,STACK \?L12
?L13:	CALL ULTIMATELY-IN?,OSTRICH-NIP >STACK
	ZERO? STACK /?L14
	IN? OSTRICH,HERE /?L12
?L14:	IN? EXPLOSIVE,DRILLED-HOLE \?L11
?L12:	CALL PRINT-ID,STR?91
	CALL JIGS-UP,STR?92
	JUMP ?L19
?L11:	ZERO? EXPLOSIVE-CONNECTED /?L15
	ZERO? TIMER-CONNECTED /?L15
	IN? DIODE-M,DETONATOR \?L15
	GRTR? TIMER-SETTING,0 \?L15
	CALL META-LOC,EXPLOSIVE >STACK
	EQUAL? STACK,HERE \?L16
	CALL PRINT-ID,STR?93
	CALL JIGS-UP,STR?94
	JUMP ?L19
?L16:	CALL DESTROY-EXPLOSIVE-CONT
	REMOVE TIMER
	REMOVE EXPLOSIVE
	REMOVE DETONATOR
	JUMP ?L19
?L15:	RANDOM 100 >STACK
	LESS? 60,STACK /?L19
	PRINTI "..."
	CALL PICK-ONE,DREAMS >STACK
	PRINT STACK
	PRINT ELLIPSIS
?L19:	INC 'DAY
	INC 'ROBOT-EVILNESS
	CALL I-ROBOT-EVILNESS
	SET 'TIMER-SETTING,0
	CALL DEQUEUE,I-TIMER
	SET 'SLEEPY-LEVEL,0
	SET 'SUIT-PRESSED,0
	SET 'FLOYD-ANGUISHED,0
	RANDOM 80 >STACK
	ADD 1600,STACK >INTERNAL-MOVES
	GRTR? DAY,2 \?L21
	SET 'MOVES,9947
	JUMP ?L23
?L21:	CALL QUEUE,I-MESSAGE,943
	ADD SCORE,3 >SCORE
	SET 'MOVES,INTERNAL-MOVES
?L23:	FCLEAR AUTO-DOOR,TOUCHBIT
	CALL QUEUE,I-SLEEP-WARNINGS,5900
	CALL ULTIMATELY-IN?,EXPLOSIVE,VACUUM-STORAGE >STACK
	ZERO? STACK \?L24
	MOVE EXPLOSIVE,DECK-TWELVE
	CALL REMOVE-CAREFULLY,EXPLOSIVE
	CALL DEQUEUE,I-EXPLOSIVE-MELT
?L24:	FSET? HEADLAMP,ONBIT \?L27
	FCLEAR HEADLAMP,ACTIVEBIT
	FCLEAR HEADLAMP,ONBIT
	SET 'HEADLAMP-COUNTER,0
?L27:	CALL RUNNING?,I-LOG-READER >STACK
	ZERO? STACK /?L30
	REMOVE LOG-READER
	CALL DEQUEUE,I-LOG-READER
	FCLEAR COMMANDERS-OFFICE,TOUCHBIT
?L30:	GRTR? SOUP-WARMTH,0 \?L37
	FSET? THERMOS,OPENBIT \?L35
	SET 'SOUP-WARMTH,0
	JUMP ?L37
?L35:	SUB SOUP-WARMTH,30 >SOUP-WARMTH
?L37:	FSET OSTRICH,TOUCHBIT
	CALL ROB,PROTAGONIST,HERE
	USL
	PRINTI "***** NOVEM "
	ADD DAY,3 >STACK
	PRINTN STACK
	PRINTI ", 11349 *****"
	CRLF
	CRLF
	PRINTI "You awake "
	ZERO? LIT \?L39
	PRINTI "in darkness."
	JUMP ?L43
?L39:	CALL QUEUED?,I-LIGHTS-OUT >STACK
	ZERO? STACK /?L41
	CALL DEQUEUE,I-LIGHTS-OUT
	CALL I-LIGHTS-OUT,1
	PRINTI "slowly, aware that something has changed. Aha! The lights have all gone out while you slept!"
	JUMP ?L43
?L41:	LOC PROTAGONIST >STACK
	EQUAL? STACK,BED,PILOT-SEAT,COPILOT-SEAT \?L42
	PRINTI "feeling refreshed and ready to face anything this new day might care to throw at you."
	JUMP ?L43
?L42:	PRINTI "and slowly stand up, feeling stiff from your uncomfortable night's sleep."
	CALL PRINT-ID,STR?95
?L43:	EQUAL? DAY,4 \?L48
	FSET? SAFE,OPENBIT /?L46
	CALL QUEUE,I-LIGHTS-OUT,177
	JUMP ?L48
?L46:	CALL QUEUED?,I-ANNOUNCEMENT >STACK
	ZERO? STACK \?L48
	CALL QUEUE,I-ANNOUNCEMENT,383
?L48:	GRTR? HUNGER-LEVEL,0 \?L51
	SET 'HUNGER-LEVEL,3
	CALL QUEUE,I-HUNGER-WARNINGS,200
	PRINTI " You're also incredibly famished. Better get some breakfast!"
	JUMP ?L53
?L51:	CALL QUEUE,I-HUNGER-WARNINGS,400
?L53:	CRLF
	CALL RUNNING?,I-SPACETRUCK >STACK
	ZERO? STACK /?L54
	EQUAL? COURSE-PICKED,RIGHT-COURSE \?L54
	CALL QUEUE,I-WELDER,-1
	CALL DEQUEUE,I-SPACETRUCK
	FCLEAR SPACETRUCK,WEIGHTLESSBIT
	ADD SCORE,5 >SCORE
	SET 'SPACETRUCK-COUNTER,5
	PRINTI "   You notice that, while you slept, the truck has docked itself in one of the space station's docking bays."
	CRLF
?L54:	EQUAL? DAY,3 \?L59
	FCLEAR ELEVATOR,WEIGHTLESSBIT
	FSET EXERCISE-MACHINE,TOUCHBIT
	MOVE EXERCISE-MACHINE,COMPUTER-CONTROL
	CALL ROB,EXERCISE-MACHINE,GYM
	FSET? CHRONOMETER,WORNBIT \?L59
	PRINTI "   "
	CALL PERFORM,V?EXAMINE,CHRONOMETER
?L59:	FSET? FLOYD,ACTIVEBIT \?L63
	IN? FLOYD,FACTORY /?L63
	EQUAL? HERE,AIRLOCK /?L63
	SET 'FLOYD-SPOKE,1
	PRINTI "   Floyd "
	GRTR? ROBOT-EVILNESS,13 \?L65
	PRINTI "is rudely kicking you"
	CALL PRINT-ID,STR?96
	IN? PROTAGONIST,BED \?L67
	PRINTI "r mattress"
	CALL PRINT-ID,STR?97
?L67:	PRINTI ". ""Trot it! Will you kripping wake up already? Floyd getting bored!"""
	CRLF
	JUMP ?L79
?L65:	PRINTI "bounces impatiently at "
	IN? PROTAGONIST,BED \?L71
	PRINTI "the foot of the bed"
	JUMP ?L73
?L71:	PRINTI "your side"
?L73:	ZERO? PLATO-INTRODUCED /?L87
	ZERO? PLATO-ATTACK-COUNTER \?L74
	MOVE PLATO,HERE
	PRINTI ". Plato is nearby, leafing through his book"
?L74:	ZERO? PLATO-INTRODUCED \?L77
?L87:	PRINTI ", along with a slightly older-looking robot. ""Wake up and meet Floyd's new friend,"" says Floyd with unbounded exuberance and a wide grin."
	CRLF
	CALL I-PLATO,1
	JUMP ?L79
?L77:	PRINTI ". ""About time you woke up, you lazy "
	GRTR? ROBOT-EVILNESS,9 \?L80
	PRINTI "slob!"" says Floyd. ""It's getting pretty trotting dull around he"
	CALL PRINT-ID,STR?98
	JUMP ?L82
?L80:	PRINTI "bones!"" says Floyd. ""Let's explore around some mo"
?L82:	PRINTI "re!"""
	CRLF
?L79:	MOVE FLOYD,HERE
?L63:	ZERO? LIT /?L84
	CRLF
	CALL V-LOOK
?L84:	CALL STOP >STACK
	RSTACK

	.FUNCT I-HUNGER-WARNINGS
	ZERO? STUNNED /?L1
	CALL QUEUE,I-HUNGER-WARNINGS,2
	RFALSE
?L1:	INC 'HUNGER-LEVEL
	PRINTI "   "
	EQUAL? HUNGER-LEVEL,1 \?L4
	CALL QUEUE,I-HUNGER-WARNINGS,450
	PRINTI "A growl from your stomach warns that you're getting pretty hungry and thirsty."
	CRLF
	JUMP ?L9
?L4:	EQUAL? HUNGER-LEVEL,2 \?L6
	CALL QUEUE,I-HUNGER-WARNINGS,300
	PRINTI "You're now really ravenous and your lips are quite parched."
	CRLF
	JUMP ?L9
?L6:	EQUAL? HUNGER-LEVEL,3 \?L7
	CALL QUEUE,I-HUNGER-WARNINGS,150
	PRINTI "You're starting to feel faint from lack of food and liquid."
	CRLF
	CALL PRINT-ID,STR?99
	JUMP ?L9
?L7:	EQUAL? HUNGER-LEVEL,4 \?L8
	CALL QUEUE,I-HUNGER-WARNINGS,150
	PRINTI "If you don't eat or drink something in a few millichrons, you'll probably pass out."
	CRLF
	CALL PRINT-ID,STR?100
	JUMP ?L9
?L8:	EQUAL? HUNGER-LEVEL,5 \?L9
	CALL PRINT-ID,STR?101
	CALL JIGS-UP,STR?102
?L9:	CALL STOP >STACK
	RSTACK

	.FUNCT WELDER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? WELDER-COUNTER,1 \?L3
	PRINTI "This welder, which is marked ""Welder Number "
	GET WELDER-TABLE,WELDER-TABLE-POINTER >STACK
	PRINTN STACK
	PRINTR ","" seems to be moving purposefully toward you, its welding extensions quivering with...excitement?"
?L3:	EQUAL? WELDER-COUNTER,2 \?L5
	PRINTR "There definitely seems to be something menacing about its behavior."
?L5:	PRINTR "The welder is now almost upon you!"
?L1:	EQUAL? PRSA,V?WHAT \?L7
	PRINTI "A "
	PRINTD WELDER
	PRINTI " is a very simple machine which repairs any leaks or holes in the hull of any sort of space habitat. Because of the potentially catastrophic effects of a break in the integrity of a hull on the habitat's air supply, "
	PRINTD WELDER
	PRINTR "s are kept active at all times, roaming around with their sensing devices alert for the tiniest leak."
?L7:	EQUAL? PRSA,V?SHOOT \?L8
	REMOVE WELDER
	GET WELDER-TABLE,NUMBER-OF-WELDERS >STACK
	PUT WELDER-TABLE,WELDER-TABLE-POINTER,STACK
	DEC 'NUMBER-OF-WELDERS
	SET 'WELDER-COUNTER,0
	ZERO? NUMBER-OF-WELDERS \?L9
	CALL DEQUEUE,I-WELDER
?L9:	PRINTI "The welder is enveloped by red-hot plasma rays. It glows ever brighter in the heat of the rays, seems to shimmer like a mirage, and then suddenly vanishes! A wave of hot vapor pushes you backwards."
	CALL VISIBLE?,EXPLOSIVE >STACK
	ZERO? STACK /?L12
	PRINTI " As the heat wave hits the explosive, it "
	PRINT SUBLIMES-INTO-FREZONE
	CALL DEQUEUE,I-EXPLOSIVE-MELT
	CALL REMOVE-CAREFULLY,EXPLOSIVE
?L12:	IN? OSTRICH,HERE \?L15
	FSET? OSTRICH,TOUCHBIT \?L15
	PRINTI " "
	CALL PERFORM,V?SCARE,OSTRICH >STACK
	RSTACK
?L15:	CRLF
	RTRUE
?L8:	EQUAL? PRSA,V?OFF \?L18
	PRINTR "There's no apparent on-off switch."
?L18:	EQUAL? PRSA,V?ON \?L19
	PRINTR "It is!"
?L19:	EQUAL? PRSA,V?MUNG,V?KILL \FALSE
	PRINTI "It's doubtful that you could even make a dent in the welder."
	CRLF
	CALL PRINT-ID,STR?103 >STACK
	RSTACK

	.FUNCT TOUCHING?,THING
	EQUAL? PRSO,THING \?L1
	EQUAL? PRSA,V?TAKE,V?TOUCH,V?SHAKE /TRUE
	EQUAL? PRSA,V?CLEAN,V?KISS,V?ENTER /TRUE
	EQUAL? PRSA,V?PUSH,V?CLOSE,V?LOOK-UNDER /TRUE
	EQUAL? PRSA,V?MOVE,V?OPEN,V?KNOCK /TRUE
	EQUAL? PRSA,V?SET,V?SHAKE,V?RAISE /TRUE
	EQUAL? PRSA,V?UNLOCK,V?LOCK,V?HUG /TRUE
	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-DOWN,V?CLIMB-ON /TRUE
	EQUAL? PRSA,V?ON,V?OFF,V?THROW /TRUE
	EQUAL? PRSA,V?TASTE,V?BITE,V?TICKLE /TRUE
	EQUAL? PRSA,V?LOOK-INSIDE,V?STAND-ON,V?TIE /TRUE
	EQUAL? PRSA,V?MUNG,V?KICK,V?KILL /TRUE
	EQUAL? PRSA,V?KNOCK,V?CUT,V?PUSH /TRUE
	EQUAL? PRSA,V?SEARCH /TRUE
?L1:	EQUAL? PRSI,THING \FALSE
	EQUAL? PRSA,V?PUT-ON,V?PUT,V?GIVE \FALSE
	RTRUE

	.FUNCT CANT-SEE,OBJ
	SET 'P-WON,0
	PRINT YOU-CANT
	PRINTI "see"
	EQUAL? PRSO,OBJ \?L3
	GET P-NAMW,0 >STACK
	JUMP ?L5
?L3:	GET P-NAMW,1 >STACK
?L5:	CALL NAME?,STACK >STACK
	ZERO? STACK \?L1
	PRINTI " any"
?L1:	EQUAL? OBJ,PRSI \?L7
	CALL PRSI-PRINT
	JUMP ?L9
?L7:	CALL PRSO-PRINT
?L9:	PRINTI " here."
	CRLF
	CALL STOP >STACK
	RSTACK

	.FUNCT CANT-VERB-A-PRSO,STRING
	PRINT YOU-CANT
	PRINT STRING
	CALL APRINT,PRSO
	PRINTR "!"

	.FUNCT TELL-HIT-HEAD
	PRINTI "You hit your head against"
	CALL TPRINT-PRSO
	PRINTR " as you attempt this."

	.FUNCT REMOVE-CAREFULLY,OBJ,ALSO=0
	ZERO? TIMER-CONNECTED /?L1
	EQUAL? OBJ,TIMER,DETONATOR \?L1
	SET 'TIMER-CONNECTED,0
	SET 'ALSO,1
	CALL VISIBLE?,TIMER >STACK
	ZERO? STACK /?L7
	PRINTI " (The timer is"
	PRINT NO-LONGER-ATTACHED
	JUMP ?L7
?L1:	ZERO? EXPLOSIVE-CONNECTED /?L7
	EQUAL? OBJ,EXPLOSIVE,DETONATOR \?L7
	SET 'EXPLOSIVE-CONNECTED,0
	CALL VISIBLE?,EXPLOSIVE >STACK
	ZERO? STACK /?L7
	PRINTI " (The explosive is"
	ZERO? ALSO /?L9
	PRINTI " also"
?L9:	PRINT NO-LONGER-ATTACHED
?L7:	IN? EXPLOSIVE,THERMOS \?L14
	FSET? THERMOS,OPENBIT /?L14
	SET 'THERMOS-FILLED-WITH-GAS,1
?L14:	FSET OBJ,TOUCHBIT
	FCLEAR OBJ,TRYTAKEBIT
	REMOVE OBJ
	RTRUE

	.FUNCT NOUN-USED,TEST-NOUN,OBJ
	EQUAL? PRSO,OBJ \?L1
	GET P-NAMW,0 >STACK
	EQUAL? STACK,TEST-NOUN /TRUE
?L1:	EQUAL? PRSI,OBJ \FALSE
	GET P-NAMW,1 >STACK
	EQUAL? STACK,TEST-NOUN \FALSE
	RTRUE

	.FUNCT ADJ-USED,TEST-ADJ,OBJ
	EQUAL? PRSO,OBJ \?L1
	GET P-ADJW,0 >STACK
	EQUAL? TEST-ADJ,STACK /TRUE
?L1:	EQUAL? PRSI,OBJ \FALSE
	GET P-ADJW,1 >STACK
	EQUAL? TEST-ADJ,STACK \FALSE
	RTRUE

	.FUNCT OPEN-CLOSED,OBJ
	FSET? OBJ,OPENBIT \?L1
	PRINTI "open"
	RTRUE
?L1:	PRINTI "closed"
	RTRUE

	.FUNCT WEE
	SET 'AWAITING-REPLY,1
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTR "Wasn't that fun?"

	.FUNCT CANT-REACH,OBJ
	PRINT YOU-CANT
	PRINTI "reach"
	CALL TPRINT,OBJ
	ZERO? HANGING-IN-AIR /?L1
	PRINTI " while you're hanging way up here"
	JUMP ?L4
?L1:	IN? PROTAGONIST,HERE /?L3
	PRINTI " from"
	LOC PROTAGONIST >STACK
	CALL TPRINT,STACK
	JUMP ?L4
?L3:	EQUAL? PRSO,HELEN,REX,FLOYD \?L4
	EQUAL? PRSO,ROBOT-PICKED /?L4
	PRINTI " from outside the bin"
?L4:	PRINT PERIOD-CR
	ZERO? P-MULT \TRUE
	CALL STOP >STACK
	RSTACK

	.FUNCT DO-FIRST,STRING,OBJ=0
	PRINT YOULL-HAVE-TO
	PRINT STRING
	ZERO? OBJ /?L1
	CALL TPRINT,OBJ
?L1:	PRINTI " first."
	CRLF
	ZERO? P-MULT \TRUE
	RETURN 8

	.FUNCT DOESNT-FIT,STRING
	PRINTI "Unsurprisingly,"
	CALL TPRINT-PRSO
	PRINTI " doesn't fit the "
	PRINT STRING
	PRINT PERIOD-CR
	RTRUE

	.FUNCT NOT-IN
	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTI " isn't "
	FSET? PRSI,ACTORBIT \?L1
	PRINTI "being held by"
	JUMP ?L4
?L1:	FSET? PRSI,SURFACEBIT \?L3
	PRINTI "on"
	JUMP ?L4
?L3:	PRINTI "in"
?L4:	CALL TRPRINT,PRSI
	RTRUE

	.FUNCT CANT-USE-THAT-WAY,STRING
	PRINTI "["
	PRINT YOU-CANT
	PRINTI "use "
	PRINT STRING
	PRINTR " that way.]"

	.FUNCT RECOGNIZE
	SET 'P-WON,0
	PRINTR "[That sentence isn't one I recognize.]"

	.FUNCT PRONOUN
	EQUAL? PRSO,ME \?L1
	PRINTI "You"
	RTRUE
?L1:	FSET? PRSO,PLURALBIT \?L3
	PRINTI "They"
	RTRUE
?L3:	FSET? PRSO,ACTORBIT \?L4
	PRINTI "He"
	RTRUE
?L4:	PRINTI "It"
	RTRUE

	.FUNCT REFERRING,HIM-HER=0
	PRINTI "I don't see wh"
	ZERO? HIM-HER /?L1
	PRINTI "o"
	JUMP ?L3
?L1:	PRINTI "at"
?L3:	PRINTR " you're referring to."

	.FUNCT ANTI-LITTER,OBJ
	REMOVE OBJ
	PRINTI ". The "
	EQUAL? OBJ,LEASH \?L1
	PRINTI "leash"
	CALL PRINT-ID,STR?104
	JUMP ?L3
?L1:	PRINTI "cup"
	CALL PRINT-ID,STR?105
?L3:	PRINTI " instantly vaporizes, part of the galactic anti-litter program."
	EQUAL? OBJ,LEASH /TRUE
	CRLF
	RTRUE

	.FUNCT MESS,STRING
	PRINTI "You create a "
	PRINT STRING
	PRINTI "ish mess. In the wink of an eye, an army of common Cassiopeian cockroaches swarms out of the ""woodwork,"" devours the "
	PRINT STRING
	PRINTI ", and return to their hidden recesses. You spend a moment pondering the competence of the station's Extermination Officer"
	CALL PRINT-ID,STR?106 >STACK
	RSTACK

	.FUNCT V-VERBOSE
	EQUAL? VERBOSITY,2 \?L1
	PRINT ALREADY-IN-MODE
	RTRUE
?L1:	SET 'VERBOSITY,2
	PRINTI "Maximum verbosity."
	CRLF
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT V-BRIEF
	EQUAL? VERBOSITY,1 \?L1
	PRINT ALREADY-IN-MODE
	RTRUE
?L1:	SET 'VERBOSITY,1
	PRINTR "Brief descriptions."

	.FUNCT V-SUPER-BRIEF
	ZERO? VERBOSITY \?L1
	PRINT ALREADY-IN-MODE
	RTRUE
?L1:	SET 'VERBOSITY,0
	PRINTR "Superbrief descriptions."

	.FUNCT V-SAVE
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	PUTB OOPS-INBUF,1,0
	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK /?L1
	FSET? FLOYD,TOUCHBIT \?L1
	FSET? FLOYD,ACTIVEBIT \?L1
	EQUAL? HERE,FACTORY /?L1
	PRINTI "Floyd's eyes light up. ""Oh boy! Are we gonna try something dangerous now?"""
	CRLF
	CRLF
?L1:	SAVE \?L4
	PRINT OK
	RTRUE
?L4:	PRINT FAILED
	RTRUE

	.FUNCT V-RESTORE
	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK /?L1
	FSET? FLOYD,TOUCHBIT \?L1
	FSET? FLOYD,ACTIVEBIT \?L1
	EQUAL? HERE,FACTORY /?L1
	PRINTI "Floyd looks disappointed but understanding. ""That part of the story was more fun,"" he sighs."
	CRLF
	CRLF
?L1:	RESTORE \?L4
	PRINT OK
	RTRUE
?L4:	PRINT FAILED
	RTRUE

	.FUNCT CONTINUE
	PRINTI "[Hit RETURN/ENTER.]"
	CRLF
	PUTB P-LEXV,0,10
	READ P-INBUF,P-LEXV
	PUTB P-LEXV,0,60
	RTRUE

	.FUNCT TELL-SCORE
	PRINTI "It is Day "
	PRINTN DAY
	PRINTI " of your adventure. "
	CALL V-TIME,1
	PRINTI " Your score is "
	PRINTN SCORE
	PRINTI " (of 80 points), giving you the rank of "
	ZERO? SCORE \?L1
	PRINTI "Insignificant Nobody"
	JUMP ?L9
?L1:	LESS? SCORE,17 \?L3
	PRINTI "Rising Young Insignificant Nobody"
	JUMP ?L9
?L3:	LESS? SCORE,27 \?L4
	PRINTI "One-Day Flash on the Evening News"
	JUMP ?L9
?L4:	LESS? SCORE,40 \?L5
	PRINTI "Footnote in History"
	JUMP ?L9
?L5:	LESS? SCORE,50 \?L6
	PRINTI "International VIP"
	JUMP ?L9
?L6:	LESS? SCORE,65 \?L7
	PRINTI "Interplanetary Star"
	JUMP ?L9
?L7:	LESS? SCORE,80 \?L8
	PRINTI "Interstellar Superstar"
	JUMP ?L9
?L8:	PRINTI "Intergalactic Mega-Hero"
?L9:	PRINT PERIOD-CR
	RTRUE

	.FUNCT V-SCRIPT
	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK /?L1
	FSET? FLOYD,TOUCHBIT \?L1
	FSET? FLOYD,ACTIVEBIT \?L1
	EQUAL? HERE,FACTORY /?L1
	PRINTI "   ""Uh oh,"" frets Floyd. ""Once printer is on, Floyd will have to be careful not to use any of the bad words he learned aboard the Duffy!"""
	CRLF
?L1:	GET 0,8 >STACK
	BOR STACK,1 >STACK
	PUT 0,8,STACK
	CALL CORP-NOTICE,STR?107
	CALL V-VERSION >STACK
	RSTACK

	.FUNCT V-UNSCRIPT
	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK /?L1
	FSET? FLOYD,TOUCHBIT \?L1
	FSET? FLOYD,ACTIVEBIT \?L1
	EQUAL? HERE,FACTORY /?L1
	PRINTI "   Floyd nods his approval. ""Good idea. Printer paper expensive. Best to save for important scenes. Not like this one."""
	CRLF
?L1:	CALL CORP-NOTICE,STR?108
	CALL V-VERSION
	GET 0,8 >STACK
	BAND STACK,-2 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT CORP-NOTICE,STRING
	PRINTI "Here "
	PRINT STRING
	PRINTR " a transcript of interaction with STATIONFALL."

	.FUNCT V-DIAGNOSE
	SET 'C-ELAPSED,18
	EQUAL? HERE,FACTORY \?L1
	PRINTR "We're talking adrenaline. Lots of adrenalin."
?L1:	PRINTI "You feel "
	ZERO? STUNNED /?L4
	PRINTI "numb. "
	CALL YOURE-STUNNED
	RTRUE
?L4:	ZERO? SLEEPY-LEVEL \?L6
	PRINTI "well-rested"
	JUMP ?L7
?L6:	EQUAL? SLEEPY-LEVEL,1 \?L8
	PRINTI "sort of"
	JUMP ?L11
?L8:	EQUAL? SLEEPY-LEVEL,2 \?L10
	PRINTI "quite"
	JUMP ?L11
?L10:	PRINTI "phenomenally"
?L11:	PRINTI " tired"
?L7:	ZERO? SLEEPY-LEVEL \?L15
	GRTR? HUNGER-LEVEL,0 /?L14
?L15:	GRTR? SLEEPY-LEVEL,0 \?L12
	ZERO? HUNGER-LEVEL \?L12
?L14:	PRINTI ", but"
	JUMP ?L16
?L12:	PRINTI ", and"
?L16:	PRINTI " you are "
	ZERO? HUNGER-LEVEL \?L17
	PRINTI "well-fed"
	JUMP ?L19
?L17:	EQUAL? HUNGER-LEVEL,1 \?L20
	PRINTI "fairly"
	JUMP ?L23
?L20:	EQUAL? HUNGER-LEVEL,2 \?L22
	PRINTI "very"
	JUMP ?L23
?L22:	PRINTI "awesomely"
?L23:	PRINTI " hungry and thirsty"
?L19:	PRINTR ". In all other respects, you are in good health."

	.FUNCT V-INVENTORY
	SUB 0,WORNBIT >D-BIT
	SET 'C-ELAPSED,18
	CALL DESCRIBE-CONTENTS,WINNER,0,3 >STACK
	ZERO? STACK \?L1
	PRINTI "You are empty-handed."
?L1:	SET 'D-BIT,WORNBIT
	CALL DESCRIBE-CONTENTS,WINNER,0,3
	SET 'D-BIT,0
	CRLF
	RTRUE

	.FUNCT V-QUIT
	CALL TELL-SCORE
	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK /?L1
	FSET? FLOYD,TOUCHBIT \?L1
	FSET? FLOYD,ACTIVEBIT \?L1
	EQUAL? HERE,FACTORY /?L1
	PRINTI "   Floyd grins impishly. ""Giving up, huh?"""
	CRLF
?L1:	CALL DO-YOU-WISH,STR?109
	CALL YES? >STACK
	ZERO? STACK /?L4
	QUIT
?L4:	PRINT OK
	RTRUE

	.FUNCT V-RESTART
	CALL TELL-SCORE
	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK /?L1
	FSET? FLOYD,TOUCHBIT \?L1
	FSET? FLOYD,ACTIVEBIT \?L1
	FSET? ROBOT-POOL,TOUCHBIT \?L1
	EQUAL? HERE,ROBOT-POOL /?L1
	PRINTI "   Floyd rolls his eyes. ""We're gonna have to go through that stupid scene in the Robot Pool again?"""
	CRLF
?L1:	CALL DO-YOU-WISH,STR?110
	CALL YES? >STACK
	ZERO? STACK /FALSE
	PRINTI "Restarting."
	CRLF
	RESTART

	.FUNCT DO-YOU-WISH,STRING
	CRLF
	PRINTI "Do you wish to "
	PRINT STRING
	PRINTI "? (Y is affirmative): "
	RTRUE

	.FUNCT YES?
?L0:	PRINTI ">"
	READ P-INBUF,P-LEXV
	GET P-LEXV,1 >STACK
	CALL YES-WORD,STACK >STACK
	ZERO? STACK \TRUE
	GET P-LEXV,1 >STACK
	CALL NO-WORD,STACK >STACK
	ZERO? STACK \FALSE
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?N /FALSE
	PRINTI "Please answer YES or NO. "
	JUMP ?L0

	.FUNCT FINISH,REPEATING=0,CNT=0
?L1:	CRLF
	ZERO? REPEATING \?L3
	SET 'REPEATING,1
	CALL TELL-SCORE
?L3:	PRINTI "[EVENT: GAME OVER]   According to the Treaty of Gishen IV (amended after the Battle on Sorkin III in 11347 GY) you have the opportunity to restart the story, restore a saved position, or end this session of the game. In the interests of interstellar peace, type RESTART, RESTORE, or QUIT: >"
	PUTB P-LEXV,0,10
	READ P-INBUF,P-LEXV
	PUTB P-LEXV,0,60
	INC 'CNT
	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?RESTAR \?L6
	RESTART
?L6:	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?RESTOR \?L8
	RESTORE /?L8
	PRINT FAILED
	JUMP ?L1
?L8:	GET P-LEXV,1 >STACK
	EQUAL? STACK,W?QUIT,W?Q /?L10
	GRTR? CNT,10 \?L1
?L10:	QUIT

	.FUNCT V-SCORE
	PRINTI "You're currently getting "
	ZERO? VERBOSITY \?L1
	PRINTI "superbrief"
	JUMP ?L4
?L1:	EQUAL? VERBOSITY,1 \?L3
	PRINTI "brief"
	JUMP ?L4
?L3:	PRINTI "verbose"
?L4:	PRINTI " descriptions. "
	CALL TELL-SCORE >STACK
	RSTACK

	.FUNCT V-VERSION,CNT=17,V
	GET 0,1 >STACK
	BAND STACK,2047 >V
	PRINTI "STATIONFALL
Infocom interactive fiction -- a science fiction story
Copyright (c) 1987 by Infocom, Inc. All rights reserved.
STATIONFALL is a trademark of Infocom, Inc.
Release "
	PRINTN V
	PRINTI " / Serial number "
?L1:	IGRTR? 'CNT,23 /?L2
	GETB 0,CNT >STACK
	PRINTC STACK
	JUMP ?L1
?L2:	CRLF
	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK /FALSE
	FSET? FLOYD,TOUCHBIT \FALSE
	FSET? FLOYD,ACTIVEBIT \FALSE
	EQUAL? HERE,FACTORY /FALSE
	PRINTR "   Floyd looks out at you, right through your computer screen. ""See that copyright notice?"" he asks in a defiant tone. ""If anyone tries pirating this disk, they'll have Floyd to answer to."""

	.FUNCT V-$0024COMMAND
	DIRIN 1
	RTRUE

	.FUNCT V-$0024RANDOM
	EQUAL? PRSO,INTNUM /?L1
	PRINTR "Bug1"
?L1:	SUB 0,P-NUMBER >STACK
	RANDOM STACK >STACK
	RTRUE

	.FUNCT V-$0024RECORD
	DIROUT D-RECORD-ON
	RTRUE

	.FUNCT V-$0024UNRECORD
	DIROUT D-RECORD-OFF
	RTRUE

	.FUNCT V-$0024VERIFY
	EQUAL? PRSO,INTNUM \?L1
	EQUAL? P-NUMBER,69 \?L1
	PRINTN SERIAL
	CRLF
	RTRUE
?L1:	PRINTI "Verifying."
	CRLF
	VERIFY \?L4
	PRINT OK
	RTRUE
?L4:	PRINTR "** Bad **"

	.FUNCT V-ALARM
	EQUAL? PRSO,ROOMS \?L1
	CALL PERFORM,PRSA,ME
	RTRUE
?L1:	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTR " isn't asleep."

	.FUNCT V-ANSWER
	ZERO? AWAITING-REPLY /?L3
	GET P-LEXV,P-CONT >STACK
	CALL YES-WORD,STACK >STACK
	ZERO? STACK /?L1
	CALL V-YES
	JUMP ?L4
?L1:	ZERO? AWAITING-REPLY /?L3
	GET P-LEXV,P-CONT >STACK
	CALL NO-WORD,STACK >STACK
	ZERO? STACK /?L3
	CALL V-NO
	JUMP ?L4
?L3:	PRINTI "Nobody is awaiting your answer."
	CRLF
?L4:	CALL STOP >STACK
	RSTACK

	.FUNCT V-APPLAUD
	PRINTI """Clap."""
	CRLF
	IN? OSTRICH,HERE \TRUE
	PRINTI "   "
	CALL PERFORM,V?SCARE,OSTRICH
	RTRUE

	.FUNCT V-APPLY
	FSET? PRSO,WEARBIT \?L1
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L1:	SET 'AWAITING-REPLY,1
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTI "Apply"
	CALL TPRINT-PRSO
	PRINTR " for what? A job?"

	.FUNCT V-ASK-ABOUT,OWINNER
	EQUAL? PRSO,ME \?L1
	CALL PERFORM,V?TELL,ME
	RTRUE
?L1:	FSET? PRSO,ACTORBIT \?L3
	SET 'OWINNER,WINNER
	SET 'WINNER,PRSO
	CALL PERFORM,V?TELL-ABOUT,ME,PRSI
	SET 'WINNER,OWINNER
	CALL THIS-IS-IT,PRSI
	CALL THIS-IS-IT,PRSO
	RTRUE
?L3:	CALL PERFORM,V?TELL,PRSO
	RTRUE

	.FUNCT V-ASK-FOR
	FSET? PRSO,ACTORBIT \?L1
	SET 'WINNER,PRSO
	CALL PERFORM,V?GIVE,PRSI,ME
	RTRUE
?L1:	CALL PERFORM,V?TELL,PRSO
	RTRUE

	.FUNCT V-ATTRACT
	EQUAL? PRSI,BOOTS \?L1
	CALL WASTES >STACK
	RSTACK
?L1:	PRINT HUH
	RTRUE

	.FUNCT V-BITE
	CALL HACK-HACK,STR?111 >STACK
	RSTACK

	.FUNCT V-BURN
	EQUAL? HERE,CHAPEL \?L1
	FSET? ETERNAL-FLAME,ONBIT \?L1
	CALL PERFORM,V?PUT,PRSO,ETERNAL-FLAME
	RTRUE
?L1:	PRINTR "You have no source of fire."

	.FUNCT V-CALL
	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK \?L1
	CALL CANT-SEE,PRSO >STACK
	RSTACK
?L1:	CALL PERFORM,V?TELL,PRSO
	RTRUE

	.FUNCT V-CATCH
	PRINTR "The only thing you're good at catching is a cold."

	.FUNCT V-CHASTISE
	EQUAL? PRSO,INTDIR \?L1
	PRINT YOULL-HAVE-TO
	PRINTR "go in that direction to see what's there."
?L1:	PRINTR "Use prepositions to indicate precisely what you want to do: LOOK AT the object, LOOK INSIDE it, LOOK UNDER it, etc."

	.FUNCT V-CLEAN
	SET 'AWAITING-REPLY,1
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTR "Do you also do windows?"

	.FUNCT V-CLIMB-DOWN
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L1:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L3
	PRINT HOLDING-IT
	RTRUE
?L3:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-CLIMB-ON
	FSET? PRSO,VEHBIT \?L1
	CALL PERFORM,V?ENTER,PRSO
	RTRUE
?L1:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L3
	PRINT HOLDING-IT
	RTRUE
?L3:	GET P-ITBL,P-PREP1 >STACK
	EQUAL? STACK,PR?IN \?L4
	CALL CANT-VERB-A-PRSO,STR?112 >STACK
	RSTACK
?L4:	CALL CANT-VERB-A-PRSO,STR?113 >STACK
	RSTACK

	.FUNCT V-CLIMB-UP
	EQUAL? PRSO,ROOMS \?L1
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L1:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L3
	PRINT HOLDING-IT
	RTRUE
?L3:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-CLOSE
	FSET? PRSO,SURFACEBIT /?L3
	FSET? PRSO,ACTORBIT /?L3
	FSET? PRSO,VEHBIT \?L1
?L3:	CALL CANT-VERB-A-PRSO,STR?114 >STACK
	RSTACK
?L1:	FSET? PRSO,DOORBIT /?L5
	FSET? PRSO,CONTBIT \?L4
?L5:	FSET? PRSO,OPENBIT \?L6
	ZERO? TIMER-CONNECTED /?L10
	CALL ULTIMATELY-IN?,TIMER,PRSO >STACK
	ZERO? STACK /?L8
	CALL ULTIMATELY-IN?,DETONATOR,PRSO >STACK
	ZERO? STACK \?L8
	CALL DO-FIRST,STR?115 >STACK
	RSTACK
?L8:	ZERO? TIMER-CONNECTED /?L10
	CALL ULTIMATELY-IN?,DETONATOR,PRSO >STACK
	ZERO? STACK /?L10
	CALL ULTIMATELY-IN?,TIMER,PRSO >STACK
	ZERO? STACK \?L10
	CALL DO-FIRST,STR?115 >STACK
	RSTACK
?L10:	ZERO? EXPLOSIVE-CONNECTED /?L12
	CALL ULTIMATELY-IN?,DETONATOR,PRSO >STACK
	ZERO? STACK /?L11
	CALL ULTIMATELY-IN?,EXPLOSIVE,PRSO >STACK
	ZERO? STACK \?L11
	CALL DO-FIRST,STR?116 >STACK
	RSTACK
?L11:	ZERO? EXPLOSIVE-CONNECTED /?L12
	CALL ULTIMATELY-IN?,EXPLOSIVE,PRSO >STACK
	ZERO? STACK /?L12
	CALL ULTIMATELY-IN?,DETONATOR,PRSO >STACK
	ZERO? STACK \?L12
	CALL DO-FIRST,STR?116 >STACK
	RSTACK
?L12:	FCLEAR PRSO,OPENBIT
	PRINTI "Okay,"
	CALL TPRINT-PRSO
	PRINTI " is now closed."
	CRLF
	CALL NOW-DARK? >STACK
	RSTACK
?L6:	PRINT ALREADY-IS
	RTRUE
?L4:	CALL CANT-VERB-A-PRSO,STR?114 >STACK
	RSTACK

	.FUNCT V-COMFORT
	FSET? PRSO,ACTORBIT /?L3
	EQUAL? PRSO,BALLOON \?L1
?L3:	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTR " isn't in need of comforting!"
?L1:	PRINT HUH
	RTRUE

	.FUNCT V-COMPARE
	PRINTR "They're incomparable."

	.FUNCT V-CONNECT
	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-COUNT
	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-CRAWL-UNDER
	FSET? PRSO,TAKEBIT /?L1
	CALL TELL-HIT-HEAD >STACK
	RSTACK
?L1:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-CROSS
	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT V-CRUMPLE
	CALL CANT-VERB-A-PRSO,STR?117 >STACK
	RSTACK

	.FUNCT V-CUT
	ZERO? PRSI \?L1
	CALL IMPOSSIBLES >STACK
	RSTACK
?L1:	PRINTI "To put it bluntly, neither"
	CALL TPRINT-PRSI
	PRINTR " nor you are very sharp."

	.FUNCT V-DIG
	CALL WASTES >STACK
	RSTACK

	.FUNCT V-DISCONNECT
	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTI " isn't connected to"
	ZERO? PRSI /?L1
	CALL TRPRINT,PRSI
	RTRUE
?L1:	PRINTR " anything!"

	.FUNCT V-DISEMBARK
	EQUAL? P-PRSA-WORD,W?HOLD \?L1
	GET P-ITBL,P-PREP1 >STACK
	EQUAL? STACK,PR?DOWN \?L1
	CALL PERFORM,V?PUSH,PRSO
	RTRUE
?L1:	ZERO? PRSO \?L3
	IN? PROTAGONIST,HERE /?L4
	LOC PROTAGONIST >STACK
	CALL PERFORM,PRSA,STACK
	RTRUE
?L4:	PRINT LOOK-AROUND
	RTRUE
?L3:	EQUAL? P-PRSA-WORD,W?TAKE \?L7
	CALL PERFORM,V?TAKE,PRSO
	RTRUE
?L7:	IN? PROTAGONIST,PRSO /?L8
	PRINT LOOK-AROUND
	RETURN 8
?L8:	MOVE PROTAGONIST,HERE
	PRINTI "You get o"
	EQUAL? PRSO,BED \?L12
	PRINTI "ff"
	JUMP ?L14
?L12:	PRINTI "ut of"
?L14:	CALL TPRINT-PRSO
	LOC FLOYD >STACK
	EQUAL? STACK,PILOT-SEAT,COPILOT-SEAT \?L15
	MOVE FLOYD,HERE
	PRINTI ". Floyd gets up also"
?L15:	PRINT PERIOD-CR
	RTRUE

	.FUNCT V-DRESS
	ZERO? PRSO /?L1
	CALL CANT-VERB-A-PRSO,STR?118 >STACK
	RSTACK
?L1:	CALL PERFORM,V?GET-DRESSED,ROOMS
	RTRUE

	.FUNCT PRE-DRILL
	ZERO? PRSI \?L5
	CALL ULTIMATELY-IN?,DRILL >STACK
	ZERO? STACK /?L3
	CALL VISIBLE?,DRILL >STACK
	ZERO? STACK /?L3
	SET 'PRSI,DRILL
	JUMP ?L5
?L3:	PRINTR "With what? Your head isn't QUITE pointy enough."
?L5:	EQUAL? PRSI,DRILL /?L7
	PRINT YOU-CANT
	PRINTI "drill with"
	CALL ARPRINT,PRSI
	RTRUE
?L7:	FIRST? DRILL >STACK /?L9
	PRINTR "There's no bit in the drill!"
?L9:	CALL UNTOUCHABLE?,PRSO >STACK
	ZERO? STACK /?L10
	CALL CANT-REACH,PRSO >STACK
	RSTACK
?L10:	ZERO? DRILL-FOOTNOTE \FALSE
	SET 'DRILL-FOOTNOTE,1
	PRINTI "(Footnote 5) "
	RFALSE

	.FUNCT V-DRILL,?TMP
	FSET? PRSO,TAKEBIT \?L1
	PRINTI "You'll need a vise to hold"
	CALL TPRINT-PRSO
	PRINTR " before you can drill it."
?L1:	PRINTI "The point of the drill doesn't seem to be as hard as"
	CALL TRPRINT,PRSO
	CALL IS-OBJ-PROP-ANIMAL? >?TMP
	ZERO? ?TMP /?L5
	PUSH ?TMP
	JUMP ?L4
?L5:	CALL IS-PERSON? >STACK
?L4:	CALL PRINT-ID,STR?119,STACK
	CALL IS-PART-OF-SELF? >STACK
	CALL PRINT-ID,STR?120,STACK >STACK
	RSTACK

	.FUNCT V-DRILL-HOLE
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?HOLE \?L1
	CALL PERFORM,V?DRILL,PRSI
	RTRUE
?L1:	CALL RECOGNIZE >STACK
	RSTACK

	.FUNCT V-DROP
	IN? PRSO,DRILL \?L1
	PRINTI "[removing"
	CALL TPRINT-PRSO
	PRINTI " from the drill first]"
	CRLF
?L1:	EQUAL? HERE,TOP-OF-AIR-SHAFT,AIR-SHAFT \?L4
	MOVE PRSO,BOTTOM-OF-AIR-SHAFT
	PRINTR "It plunges down the shaft."
?L4:	IN? PROTAGONIST,HOLDING-TANK \?L7
	MOVE PRSO,HOLDING-TANK
	JUMP ?L9
?L7:	MOVE PRSO,HERE
?L9:	PRINTI "Dropped"
	FSET? HERE,WEIGHTLESSBIT \?L10
	PRINTI ", so to speak"
?L10:	PRINT PERIOD-CR
	RTRUE

	.FUNCT PRE-EAT
	ZERO? STUNNED /?L1
	CALL YOURE-STUNNED >STACK
	RSTACK
?L1:	ZERO? PRSI /?L3
	IN? PRSO,PRSI /?L3
	CALL NOT-IN >STACK
	RSTACK
?L3:	FSET? SPACESUIT,WORNBIT \FALSE
	PRINT YOU-CANT
	PRINTR "eat while you're wearing a space suit!"

	.FUNCT V-EAT,FOOD=0
	GETP PRSO,P?FOOD-DESC >FOOD
	ZERO? FOOD /?L1
	ZERO? HUNGER-LEVEL \?L3
	PRINT NOT-HUNGRY
	RTRUE
?L3:	REMOVE PRSO
	SET 'C-ELAPSED,15
	SET 'HUNGER-LEVEL,0
	CALL QUEUE,I-HUNGER-WARNINGS,2250
	PRINTI "Mmmm...that tasted just like yummy"
	PRINT FOOD
	CALL PRINT-ID,STR?121
	EQUAL? PRSO,NECTAR \?L6
	CALL ANTI-LITTER,NECTAR >STACK
	RSTACK
?L6:	EQUAL? PRSO,SOUP \?L8
	PRINTI ". The soup was "
	CALL DESCRIBE-SOUP-TEMPERATURE >STACK
	RSTACK
?L8:	PRINT PERIOD-CR
	RTRUE
?L1:	PRINTI "It's doubtful that"
	CALL TPRINT-PRSO
	PRINTI " would agree with you."
	CRLF
	CALL DANGEROUS-FOOD? >STACK
	CALL PRINT-ID,STR?122,STACK >STACK
	RSTACK

	.FUNCT V-EAT-FROM,X
	FSET? PRSO,OPENBIT /?L1
	CALL DO-FIRST,STR?123,PRSO >STACK
	RSTACK
?L1:	FIRST? PRSO >X \?L3
	NEXT? X >STACK \?L4
	PRINTI "(How about"
	CALL TPRINT,X
	PRINTI "?)"
	CRLF
?L4:	CALL PERFORM,V?EAT,X
	RTRUE
?L3:	PRINTR "It's empty!"

	.FUNCT V-EMPTY,OBJ,NXT
	ZERO? PRSI \?L1
	SET 'PRSI,GROUND
?L1:	FSET? PRSO,CONTBIT /?L4
	PRINT HUH
	RTRUE
?L4:	FSET? PRSO,OPENBIT /?L6
	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTR " isn't open."
?L6:	FIRST? PRSO >STACK /?L9
	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTR " is already empty!"
?L9:	EQUAL? PRSI,STACK \?L8
	NEXT? PRSI >STACK /?L8
	PRINT THERES-NOTHING
	PRINTI "in"
	CALL TPRINT-PRSO
	PRINTI " but"
	CALL TRPRINT,PRSI
	RTRUE
?L8:	FIRST? PRSO >OBJ /?L11
?L11:	NEXT? OBJ >NXT /?L14
?L14:	EQUAL? OBJ,PROTAGONIST /?L24
	PRINTD OBJ
	PRINTI ": "
	FSET? OBJ,TAKEBIT \?L17
	MOVE OBJ,PROTAGONIST
	EQUAL? PRSI,HANDS \?L19
	PRINTI "Taken."
	CRLF
	JUMP ?L24
?L19:	EQUAL? PRSI,GROUND \?L21
	CALL PERFORM,V?DROP,OBJ
	JUMP ?L24
?L21:	FSET? PRSI,SURFACEBIT \?L22
	CALL PERFORM,V?PUT-ON,OBJ,PRSI
	JUMP ?L24
?L22:	CALL PERFORM,V?PUT,OBJ,PRSI
	JUMP ?L24
?L17:	CALL YUKS
?L24:	ZERO? NXT /TRUE
	SET 'OBJ,NXT
	JUMP ?L11

	.FUNCT V-EMPTY-FROM
	IN? PRSO,PRSI \?L1
	FSET? PRSO,TAKEBIT \?L3
	MOVE PRSO,PROTAGONIST
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L3:	CALL YUKS >STACK
	RSTACK
?L1:	CALL NOT-IN >STACK
	RSTACK

	.FUNCT PRE-ENTER
	IN? PROTAGONIST,PRSO \?L1
	PRINT LOOK-AROUND
	RTRUE
?L1:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L3
	PRINT HOLDING-IT
	RTRUE
?L3:	CALL UNTOUCHABLE?,PRSO >STACK
	ZERO? STACK /FALSE
	CALL CANT-REACH,PRSO >STACK
	RSTACK

	.FUNCT V-ENTER,AV
	LOC PROTAGONIST >AV
	FSET? PRSO,DOORBIT \?L1
	CALL OTHER-SIDE,PRSO >STACK
	CALL DO-WALK,STACK
	RTRUE
?L1:	FSET? PRSO,VEHBIT \?L3
	LOC PRSO >STACK
	EQUAL? STACK,HERE,LOCAL-GLOBALS /?L4
	PRINT YOU-CANT
	PRINTI "board"
	CALL TPRINT-PRSO
	PRINTI " when it's "
	LOC PRSO >STACK
	FSET? STACK,SURFACEBIT \?L6
	PRINTI "on"
	JUMP ?L8
?L6:	PRINTI "in"
?L8:	LOC PRSO >STACK
	CALL TRPRINT,STACK
	RTRUE
?L4:	MOVE PROTAGONIST,PRSO
	PRINTI "You are now "
	FSET? PRSO,INBIT \?L10
	PRINTI "i"
	JUMP ?L12
?L10:	PRINTI "o"
?L12:	PRINTI "n"
	CALL TPRINT-PRSO
	PRINTI "."
	GETP PRSO,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	CRLF
	RTRUE
?L3:	EQUAL? PRSO,AIR \?L13
	CALL V-LEAP >STACK
	RSTACK
?L13:	GET P-ITBL,P-PREP1 >STACK
	EQUAL? STACK,PR?ON \?L14
	CALL CANT-VERB-A-PRSO,STR?124 >STACK
	RSTACK
?L14:	FSET? PRSO,TAKEBIT /?L15
	CALL TELL-HIT-HEAD >STACK
	RSTACK
?L15:	GET P-ITBL,P-PREP1 >STACK
	EQUAL? STACK,PR?IN \FALSE
	CALL CANT-VERB-A-PRSO,STR?125 >STACK
	RSTACK

	.FUNCT V-EXAMINE
	SET 'C-ELAPSED,32
	FSET? PRSO,ACTORBIT \?L1
	FIRST? PRSO >STACK \?L3
	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE
?L3:	CALL NOTHING-INTERESTING
	PRINTI "about"
	CALL TRPRINT,PRSO
	RTRUE
?L1:	FSET? PRSO,SURFACEBIT \?L6
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L6:	FSET? PRSO,DOORBIT \?L7
	PRINT IT-SEEMS-THAT
	CALL TPRINT-PRSO
	PRINTI " is "
	CALL OPEN-CLOSED,PRSO
	PRINT PERIOD-CR
	RTRUE
?L7:	IN? PROTAGONIST,PRSO \?L8
	CALL DESCRIBE-VEHICLE >STACK
	RSTACK
?L8:	FSET? PRSO,CONTBIT \?L9
	FSET? PRSO,VEHBIT /?L9
	PRINTI "It's "
	CALL OPEN-CLOSED,PRSO
	FSET? PRSO,OPENBIT /?L12
	FSET? PRSO,TRANSBIT \?L10
?L12:	PRINTI ". "
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L10:	PRINT PERIOD-CR
	RTRUE
?L9:	FSET? PRSO,LIGHTBIT \?L14
	PRINTI "It looks like"
	CALL TPRINT-PRSO
	PRINTI " is o"
	FSET? PRSO,ACTIVEBIT \?L15
	PRINTI "n"
	JUMP ?L17
?L15:	PRINTI "ff"
?L17:	PRINT PERIOD-CR
	RTRUE
?L14:	FSET? PRSO,READBIT \?L18
	CALL PERFORM,V?READ,PRSO
	RTRUE
?L18:	FSET? PRSO,NARTICLEBIT \?L19
	CALL SENSE-OBJECT,STR?126 >STACK
	RSTACK
?L19:	RANDOM 100 >STACK
	LESS? 35,STACK \?L21
	EQUAL? PRSO,PSEUDO-OBJECT \?L20
?L21:	PRINTI "Totally ordinary looking "
	PRINTD PRSO
	PRINT PERIOD-CR
	RTRUE
?L20:	CALL NOTHING-INTERESTING
	PRINTI "about"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-EXERCISE
	ZERO? STUNNED /?L1
	CALL YOURE-STUNNED
	RTRUE
?L1:	IN? PROTAGONIST,EXERCISE-MACHINE \?L3
	CALL ULTIMATELY-IN?,JAMMER,HERE >STACK
	ZERO? STACK /?L4
	EQUAL? JAMMER-SETTING,710 \?L4
	FSET? JAMMER,ACTIVEBIT \?L4
	IN? TWENTY-PRONG-FROMITZ-BOARD,JAMMER \?L4
	PRINTR "The machine seems to be frozen."
?L4:	PRINTI "You do a few repetitions"
	JUMP ?L7
?L3:	PRINTI "You do a few push-ups"
?L7:	PRINTR ". Dr. Ventricalli, the Duffy's cardiologist, would be pleased."

	.FUNCT NOTHING-INTERESTING
	PRINT THERES-NOTHING
	RANDOM 100 >STACK
	LESS? 25,STACK /?L1
	PRINTI "unusual"
	JUMP ?L5
?L1:	RANDOM 100 >STACK
	LESS? 33,STACK /?L3
	PRINTI "noteworthy"
	JUMP ?L5
?L3:	RANDOM 100 >STACK
	LESS? 50,STACK /?L4
	PRINTI "eye-catching"
	JUMP ?L5
?L4:	PRINTI "special"
?L5:	PRINTI " "
	RTRUE

	.FUNCT V-EXIT
	ZERO? PRSO /?L1
	FSET? PRSO,VEHBIT \?L1
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L1:	CALL DO-WALK,P?OUT >STACK
	RSTACK

	.FUNCT V-FEED
	PRINTI "You have no food for"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-FILL
	ZERO? PRSI \?L1
	PRINT THERES-NOTHING
	PRINTR "to fill it with."
?L1:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-FIND,WHERE=0,L
	LOC PRSO >L
	SET 'C-ELAPSED,18
	ZERO? L \?L1
	CALL PRONOUN
	PRINTR " could be anywhere!"
?L1:	IN? PRSO,PROTAGONIST \?L3
	PRINTR "You have it!"
?L3:	IN? PRSO,HERE /?L5
	CALL GLOBAL-IN?,PRSO,HERE >STACK
	ZERO? STACK \?L5
	EQUAL? PRSO,PSEUDO-OBJECT \?L4
?L5:	PRINTR "Right in front of you."
?L4:	FSET? L,ACTORBIT \?L6
	CALL VISIBLE?,L >STACK
	ZERO? STACK /?L6
	PRINTI "Looks as if"
	CALL TPRINT,L
	PRINTR " has it."
?L6:	FSET? L,CONTBIT \?L7
	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK /?L7
	EQUAL? L,GLOBAL-OBJECTS /?L7
	FSET? L,SURFACEBIT \?L8
	PRINTI "O"
	JUMP ?L11
?L8:	FSET? L,VEHBIT \?L10
	FSET? L,INBIT /?L10
	PRINTI "O"
	JUMP ?L11
?L10:	PRINTI "I"
?L11:	PRINTI "n"
	CALL TRPRINT,L
	RTRUE
?L7:	ZERO? WHERE /?L13
	IN? PRSO,GLOBAL-OBJECTS \?L12
?L13:	PRINT YOULL-HAVE-TO
	PRINTR "do that yourself."
?L12:	PRINTR "Beats me."

	.FUNCT V-FIX
	PRINTR "[Such general commands won't work. To repair something, you must perform the specific steps required.]"

	.FUNCT V-FLATTEN
	PRINT HUH
	RTRUE

	.FUNCT V-FOLLOW
	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK /?L1
	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTR " is right here!"
?L1:	FSET? PRSO,ACTORBIT /?L3
	CALL IMPOSSIBLES >STACK
	RSTACK
?L3:	PRINTI "You have no idea where"
	CALL TPRINT-PRSO
	PRINTR " is."

	.FUNCT V-FOOTNOTE
	SET 'C-ELAPSED,0
	ZERO? PRSO /?L3
	EQUAL? PRSO,INTNUM /?L1
?L3:	PRINTR "Specify a number, as in ""FOOTNOTE 6."""
?L1:	EQUAL? P-NUMBER,1 \?L4
	PRINTI "These must be those special zero-gee dice which project their own gravitational field onto the nearest surface. Zero-gee dice are, of course, notoriously easy to load"
	JUMP ?L24
?L4:	EQUAL? P-NUMBER,2 \?L5
	PRINT UNFAMILIAR
	PRINTI "Blather was your officious, tyrannical superior aboard the S.P.S. Feinstein. He was demoted because of his craven behavior during the destruction of the Feinstein"
	JUMP ?L24
?L5:	EQUAL? P-NUMBER,3 \?L6
	PRINTI "The story of your acquaintance with Floyd and the episode on Resida are recounted in PLANETFALL"
	JUMP ?L24
?L6:	EQUAL? P-NUMBER,4 \?L7
	PRINTI "This is, of course, impossible. To do this, the creature would have to be an order of magnitude larger. There are two possible explanations: 1. The creature actually extends part of its volume into a parallel dimension"
	PRINT CALLOUS-DISREGARD
	JUMP ?L24
?L7:	EQUAL? P-NUMBER,5,9,13 \?L8
	PRINTI "Kids: "
	EQUAL? P-NUMBER,5 \?L9
	PRINTI "drills"
	JUMP ?L12
?L9:	EQUAL? P-NUMBER,9 \?L11
	PRINTI "zapguns"
	JUMP ?L12
?L11:	PRINTI "FREZONE (tm) explosives"
?L12:	PRINTI " are very dangerous. Don't try this at home without adult supervision"
	JUMP ?L24
?L8:	EQUAL? P-NUMBER,6 \?L13
	PRINTI "That was just an example"
	JUMP ?L24
?L13:	EQUAL? P-NUMBER,7 \?L14
	PRINT UNFAMILIAR
	PRINTI "your frenzied (former) boss, Ensign Blather, would toss you into the Feinstein's brig for the tiniest violation of the Stellar Patrol's near-infinity of trivial regulations"
	JUMP ?L24
?L14:	EQUAL? P-NUMBER,8 \?L15
	PRINTI "The author wishes to refute any claims that the use of footnotes is a ripoff from the interactive fiction version of THE HITCHHIKER'S GUIDE TO THE GALAXY. This is not true. Well, maybe it's a little bit true, in which case the author wishes to point out his right to rip off his own ideas. So there"
	JUMP ?L24
?L15:	EQUAL? P-NUMBER,10 \?L16
	SET 'AWAITING-REPLY,1
	CALL QUEUE,I-REPLY,1
	PRINTR "Isn't it fun reading through all the footnotes?"
?L16:	EQUAL? P-NUMBER,11,12 \?L17
	PRINTI "How to keep a STATIONFALL player busy all day (Footnote 1"
	EQUAL? P-NUMBER,11 \?L18
	PRINTI "2)"
	JUMP ?L24
?L18:	PRINTI "1)"
	JUMP ?L24
?L17:	EQUAL? P-NUMBER,14 \?L21
	PRINTI "Actually, it is only a myth that ostriches stick their heads in holes when frightened. The fact that this ostrich does can be attributed to: 1. an addling of the animal's brain caused by extended exposure to weightlessness"
	PRINT CALLOUS-DISREGARD
	JUMP ?L24
?L21:	EQUAL? P-NUMBER,15 \?L22
	PRINTR "IF you also played Planetfall, and IF you scrambled any magnetic cards in Planetfall by being careless with the magnet: GOTCHA AGAIN! (Footnote 16)"
?L22:	EQUAL? P-NUMBER,16 \?L23
	PRINTR "Reminds me of that old saying, ""Fool me once, shame on you. Fool me twice, shame on me!"""
?L23:	PRINTI "There is no Footnote "
	PRINTN P-NUMBER
	PRINT PERIOD-CR
	RTRUE
?L24:	ZERO? READ-A-FOOTNOTE \?L25
	SET 'READ-A-FOOTNOTE,1
	PRINTI ". (Footnote 8)"
?L25:	PRINT PERIOD-CR
	RTRUE

	.FUNCT PRE-GIVE,IDROP-VALUE
	EQUAL? PRSA,V?GIVE \?L1
	EQUAL? PRSO,HANDS \?L1
	CALL PERFORM,V?SHAKE-WITH,PRSI
	RTRUE
?L1:	CALL IDROP >IDROP-VALUE
	ZERO? IDROP-VALUE /FALSE
	RETURN IDROP-VALUE

	.FUNCT V-GET-DRESSED
	EQUAL? PRSO,ROOMS \?L1
	FSET? PATROL-UNIFORM,WORNBIT \?L3
	PRINTR "You are!"
?L3:	CALL VISIBLE?,PATROL-UNIFORM >STACK
	ZERO? STACK /?L5
	CALL PERFORM,V?WEAR,PATROL-UNIFORM
	RTRUE
?L5:	PRINTR "No clothes in sight!"
?L1:	CALL RECOGNIZE >STACK
	RSTACK

	.FUNCT V-GET-UNDRESSED
	EQUAL? PRSO,ROOMS \?L1
	CALL PERFORM,V?TAKE-OFF,PATROL-UNIFORM
	RTRUE
?L1:	CALL RECOGNIZE >STACK
	RSTACK

	.FUNCT V-GIVE
	FSET? PRSI,ACTORBIT \?L1
	PRINTI "Briskly,"
	CALL TPRINT-PRSI
	PRINTR " declines your offer."
?L1:	PRINT YOU-CANT
	PRINTI "give"
	CALL APRINT,PRSO
	PRINTI " to"
	CALL APRINT,PRSI
	PRINTR "!"

	.FUNCT V-GIVE-UP
	EQUAL? PRSO,ROOMS \?L1
	CALL V-QUIT >STACK
	RSTACK
?L1:	CALL RECOGNIZE >STACK
	RSTACK

	.FUNCT V-GREET
	FSET? PRSO,ACTORBIT \?L1
	SET 'WINNER,PRSO
	CALL PERFORM,V?HELLO
	SET 'WINNER,PROTAGONIST
	RTRUE
?L1:	CALL PERFORM,V?TELL,PRSO
	RTRUE

	.FUNCT V-HELLO
	ZERO? PRSO /?L1
	SET 'P-WON,0
	PRINTR "[The proper way to talk to characters in the story is PERSON, HELLO.]"
?L1:	CALL PERFORM,V?TELL,ME
	RTRUE

	.FUNCT V-HELP
	PRINTR "[Help!?! You need help?!? What about me, your poor computer? My chips are about to go, my mate just ran off with a mainframe from Milwaukee, and the kid wants to be a talking greeting card when he grows up! Furtherm... Hey! I'm not done! Mumk mpgrlph...]
   If you're really stuck, you can get an InvisiClues (TM) hint booklet and map from your dealer, or by using the order form from your package."

	.FUNCT V-HIDE
	PRINT YOU-CANT
	PRINTI "hide "
	ZERO? PRSO /?L1
	PRINTI "t"
?L1:	PRINTR "here."

	.FUNCT V-HUG
	PRINTR "Hugged."

	.FUNCT V-IN,VEHICLE
	CALL DO-WALK,P?IN >STACK
	RSTACK

	.FUNCT V-KICK
	CALL HACK-HACK,STR?127 >STACK
	RSTACK

	.FUNCT V-KILL
	EQUAL? PRSI,ZAPGUN \?L1
	CALL PERFORM,V?SHOOT,PRSO,PRSI
	RTRUE
?L1:	ZERO? PRSI \?L3
	CALL ULTIMATELY-IN?,ZAPGUN >STACK
	ZERO? STACK /?L3
	EQUAL? P-PRSA-WORD,W?KILL \?L3
	PRINTI "(with"
	CALL TPRINT,ZAPGUN
	PRINTI ")"
	CRLF
	CALL PERFORM,V?SHOOT,PRSO,ZAPGUN
	RTRUE
?L3:	FSET? PRSO,ACTORBIT \?L4
	PRINTI "You succeeded in frightening"
	CALL TRPRINT,PRSO
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?128,STACK >STACK
	RSTACK
?L4:	PRINTI "Why attack"
	CALL APRINT,PRSO
	PRINTI "?"
	CRLF
	CALL IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?129,STACK >STACK
	RSTACK

	.FUNCT V-KISS
	PRINTR "I'd sooner kiss a pile of Antarian swamp mold."

	.FUNCT V-KNOCK
	FSET? PRSO,DOORBIT \?L1
	PRINTR "Silence answers back."
?L1:	CALL HACK-HACK,STR?130 >STACK
	RSTACK

	.FUNCT V-LAUNCH
	PRINTR "Your brain is out to launch."

	.FUNCT V-LEAP
	ZERO? STUNNED /?L1
	CALL YOURE-STUNNED,STR?131 >STACK
	RSTACK
?L1:	EQUAL? PRSO,0,ROOMS /?L3
	PRINTR "You have spent too much time among the leaping loon-toads of Leonia."
?L3:	EQUAL? HERE,CHAPEL \?L4
	FSET? STAR,TRYTAKEBIT \?L4
	PRINTR "Your best jump still leaves you half a meter short of the star."
?L4:	EQUAL? HERE,AIR-SHAFT,TOP-OF-AIR-SHAFT \?L5
	EQUAL? AIR-SHAFT-LOC,7 \?L6
	CALL GOTO,BOTTOM-OF-AIR-SHAFT >STACK
	RSTACK
?L6:	CALL PRINT-ID,STR?132
	CALL JIGS-UP,STR?133 >STACK
	RSTACK
?L5:	EQUAL? HERE,BOTTOM-OF-AIR-SHAFT \?L9
	CALL PERFORM,V?OPEN,GRATING
	RTRUE
?L9:	EQUAL? HERE,VACUUM-STORAGE \?L10
	PRINTI "You sail away from the village..."
	CALL LOST-IN-SPACE >STACK
	RSTACK
?L10:	CALL WEE >STACK
	RSTACK

	.FUNCT V-LEAP-OFF
	FSET? PRSO,VEHBIT \?L1
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L1:	CALL PERFORM,V?LEAP,PRSO
	RTRUE

	.FUNCT V-LEAVE
	ZERO? PRSO \?L1
	SET 'PRSO,ROOMS
?L1:	EQUAL? PRSO,ROOMS \?L4
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L4:	IN? PROTAGONIST,PRSO \?L6
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L6:	CALL PERFORM,V?DROP,PRSO
	RTRUE

	.FUNCT V-LIE-DOWN
	EQUAL? PRSO,ROOMS \?L1
	CALL GLOBAL-IN?,BED,HERE >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?ENTER,BED
	RTRUE
?L3:	GRTR? SLEEPY-LEVEL,0 \?L5
	CALL V-SLEEP >STACK
	RSTACK
?L5:	CALL WASTES >STACK
	RSTACK
?L1:	FSET? PRSO,VEHBIT \?L7
	CALL PERFORM,V?ENTER,PRSO
	RTRUE
?L7:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-LISTEN
	SET 'C-ELAPSED,18
	ZERO? PRSO /?L1
	CALL SENSE-OBJECT,STR?134 >STACK
	RSTACK
?L1:	PRINTR "You hear nothing of interest."

	.FUNCT V-LOCK
	CALL YUKS >STACK
	RSTACK

	.FUNCT PRE-LOOK
	EQUAL? PRSO,STAR \?L1
	IN? DIODE-M,STAR /FALSE
?L1:	ZERO? LIT \FALSE
	PRINT TOO-DARK
	CRLF
	RTRUE

	.FUNCT V-LOOK
	SET 'C-ELAPSED,9
	CALL DESCRIBE-ROOM,1 >STACK
	ZERO? STACK /TRUE
	CALL DESCRIBE-OBJECTS
	RTRUE

	.FUNCT V-LOOK-BEHIND
	FSET? PRSO,DOORBIT \?L1
	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE
?L1:	PRINTI "There is nothing behind"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-LOOK-DOWN
	EQUAL? PRSO,ROOMS \?L1
	CALL PERFORM,V?EXAMINE,GROUND
	RTRUE
?L1:	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE

	.FUNCT V-LOOK-INSIDE
	ZERO? STUNNED /?L1
	CALL YOURE-STUNNED >STACK
	RSTACK
?L1:	FSET? PRSO,ACTORBIT \?L3
	PRINT IT-SEEMS-THAT
	CALL TPRINT-PRSO
	PRINTI " has"
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINT PERIOD-CR
	RTRUE
?L3:	IN? PROTAGONIST,PRSO \?L7
	CALL DESCRIBE-VEHICLE >STACK
	RSTACK
?L7:	FSET? PRSO,SURFACEBIT \?L8
	PRINT YOU-SEE
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINTI " on"
	CALL TRPRINT,PRSO
	RTRUE
?L8:	FSET? PRSO,DOORBIT \?L12
	PRINTI "All you can tell is that"
	CALL TPRINT-PRSO
	PRINTI " is "
	CALL OPEN-CLOSED,PRSO
	PRINT PERIOD-CR
	RTRUE
?L12:	FSET? PRSO,CONTBIT \?L13
	CALL SEE-INSIDE?,PRSO >STACK
	ZERO? STACK /?L14
	PRINT YOU-SEE
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINTI " in"
	CALL TRPRINT,PRSO
	RTRUE
?L14:	FSET? PRSO,OPENBIT /?L19
	FIRST? PRSO >STACK \?L19
	CALL PRE-TOUCH >STACK
	ZERO? STACK \TRUE
	CALL PERFORM,V?OPEN,PRSO
	RTRUE
?L19:	CALL DO-FIRST,STR?123,PRSO >STACK
	RSTACK
?L13:	GET P-ITBL,P-PREP1 >STACK
	EQUAL? STACK,PR?IN \?L24
	CALL CANT-VERB-A-PRSO,STR?135 >STACK
	RSTACK
?L24:	CALL CANT-VERB-A-PRSO,STR?136 >STACK
	RSTACK

	.FUNCT V-LOOK-OVER
	CALL V-EXAMINE >STACK
	RSTACK

	.FUNCT V-LOOK-UNDER
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L1
	FSET? PRSO,WORNBIT \?L3
	PRINTR "You're wearing it!"
?L3:	PRINT HOLDING-IT
	RTRUE
?L1:	CALL NOTHING-INTERESTING
	PRINTI "under"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-LOOK-UP
	EQUAL? PRSO,ROOMS \?L1
	EQUAL? HERE,AIR-SHAFT,BOTTOM-OF-AIR-SHAFT,BOTTOM-OF-ELEVATOR-SHAFT \?L3
	PRINT ONLY-BLACKNESS
	RTRUE
?L3:	CALL PERFORM,V?EXAMINE,CEILING
	RTRUE
?L1:	CALL PERFORM,V?LOOK-INSIDE,PRSO
	RTRUE

	.FUNCT V-LOWER
	CALL V-RAISE >STACK
	RSTACK

	.FUNCT V-MAYBE
	CALL YOU-SOUND,STR?137 >STACK
	RSTACK

	.FUNCT V-MEASURE
	EQUAL? PRSO,TONGUE,HANDS,ME \?L1
	PRINTR "Usual size."
?L1:	PRINTI "The same size as any other "
	PRINTD PRSO
	PRINT PERIOD-CR
	RTRUE

	.FUNCT V-MOVE
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L1
	CALL WASTES >STACK
	RSTACK
?L1:	CALL LOC-CLOSED >STACK
	ZERO? STACK \TRUE
	FSET? PRSO,TAKEBIT \?L4
	PRINTI "Moving"
	CALL TPRINT-PRSO
	PRINTR " reveals nothing."
?L4:	EQUAL? P-PRSA-WORD,W?PULL \?L5
	CALL HACK-HACK,STR?138 >STACK
	RSTACK
?L5:	CALL CANT-VERB-A-PRSO,STR?139 >STACK
	RSTACK

	.FUNCT PRE-MUNG
	ZERO? PRSI /?L1
	EQUAL? PRSI,ZAPGUN \?L1
	CALL PERFORM,V?SHOOT,PRSO,PRSI
	RTRUE
?L1:	CALL UNTOUCHABLE?,PRSO >STACK
	ZERO? STACK /FALSE
	CALL CANT-REACH,PRSO >STACK
	RSTACK

	.FUNCT V-MUNG
	EQUAL? PRSO,ROOMS \?L1
	PRINTR "Argh! Pimples!"
?L1:	CALL HACK-HACK,STR?140 >STACK
	RSTACK

	.FUNCT V-NO
	EQUAL? AWAITING-REPLY,1 \?L1
	CALL V-YES >STACK
	RSTACK
?L1:	EQUAL? AWAITING-REPLY,2,4 \?L3
	PRINTR "Floyd pouts."
?L3:	EQUAL? AWAITING-REPLY,3 \?L4
	PRINTR """Figures."""
?L4:	CALL YOU-SOUND,STR?141 >STACK
	RSTACK

	.FUNCT NO-WORD,WRD
	EQUAL? WRD,W?NO,W?NOPE /TRUE
	EQUAL? WRD,W?NAH,W?UH-UH \FALSE
	RTRUE

	.FUNCT V-OFF
	FSET? PRSO,LIGHTBIT \?L1
	FSET? PRSO,ACTIVEBIT \?L3
	FCLEAR PRSO,ACTIVEBIT
	FCLEAR PRSO,ONBIT
	PRINTI "Okay,"
	CALL TPRINT-PRSO
	PRINTI " is now off."
	CRLF
	CALL NOW-DARK? >STACK
	RSTACK
?L3:	PRINTR "It isn't on!"
?L1:	CALL CANT-TURN,STR?142 >STACK
	RSTACK

	.FUNCT V-ON
	FSET? PRSO,LIGHTBIT \?L1
	FSET? PRSO,ACTIVEBIT \?L3
	PRINT ALREADY-IS
	RTRUE
?L3:	FSET PRSO,ACTIVEBIT
	EQUAL? PRSO,HEADLAMP \?L6
	FSET PRSO,ONBIT
?L6:	PRINTI "Okay,"
	CALL TPRINT-PRSO
	PRINTI " is now on."
	CRLF
	CALL NOW-LIT? >STACK
	RSTACK
?L1:	CALL CANT-TURN,STR?143 >STACK
	RSTACK

	.FUNCT CANT-TURN,STRING
	PRINT YOU-CANT
	PRINTI "turn that o"
	PRINT STRING
	PRINT PERIOD-CR
	RTRUE

	.FUNCT V-OPEN
	FSET? PRSO,SURFACEBIT /?L3
	FSET? PRSO,ACTORBIT /?L3
	FSET? PRSO,VEHBIT \?L1
?L3:	CALL IMPOSSIBLES >STACK
	RSTACK
?L1:	FSET? PRSO,OPENBIT \?L4
	PRINT ALREADY-IS
	RTRUE
?L4:	FSET? PRSO,DOORBIT /?L5
	FSET? PRSO,CONTBIT /?L5
	CALL CANT-VERB-A-PRSO,STR?123 >STACK
	RSTACK
?L5:	FSET? PRSO,LOCKEDBIT \?L6
	PRINTR "It's locked."
?L6:	FSET? PRSO,DOORBIT \?L7
	FSET PRSO,OPENBIT
	PRINTI "The "
	PRINTD PRSO
	PRINTR " swings open."
?L7:	FSET PRSO,OPENBIT
	FSET PRSO,TOUCHBIT
	FIRST? PRSO >STACK \?L11
	FSET? PRSO,TRANSBIT \?L9
?L11:	PRINTR "Opened."
?L9:	PRINTI "Opening"
	CALL TPRINT-PRSO
	PRINTI " reveals"
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \?L13
	PRINT PERIOD-CR
?L13:	CALL NOW-LIT?
	RTRUE

	.FUNCT V-PICK
	CALL CANT-VERB-A-PRSO,STR?144 >STACK
	RSTACK

	.FUNCT V-PICK-UP
	CALL PERFORM,V?TAKE,PRSO,PRSI
	RTRUE

	.FUNCT V-PLAY-WITH
	FSET? PRSO,ACTORBIT \?L1
	CALL WEE >STACK
	RSTACK
?L1:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-POINT
	PRINTR "That would be pointless."

	.FUNCT V-POUR
	PRINTR "Pouring or spilling non-liquids is specifically forbidden by section 17.9.2 of the Galactic Adventure Game Compendium of Rules."

	.FUNCT V-PRAY
	PRINTR "If you pray enough, your prayers may be answered."

	.FUNCT V-PUSH
	EQUAL? P-PRSA-WORD,W?PRESS,W?IRON \?L1
	EQUAL? HERE,LAUNDRY \?L1
	ZERO? PRSI /?L3
	EQUAL? PRSI,PRESSER \?L1
?L3:	IN? PRSO,PRESSER \?L4
	CALL PERFORM,V?CLOSE,PRESSER
	RTRUE
?L4:	PRINT YOULL-HAVE-TO
	PRINTI "put"
	CALL TPRINT-PRSO
	PRINTR " in the presser first."
?L1:	CALL HACK-HACK,STR?145 >STACK
	RSTACK

	.FUNCT V-PUSH-DIR
	EQUAL? PRSI,INTDIR \?L1
	CALL V-PUSH >STACK
	RSTACK
?L1:	CALL RECOGNIZE >STACK
	RSTACK

	.FUNCT PRE-PUT,IDROP-VALUE
	EQUAL? PRSI,GROUND \?L1
	CALL PERFORM,V?DROP,PRSO
	RTRUE
?L1:	EQUAL? PRSO,HANDS \?L3
	EQUAL? PRSA,V?PUT \?L4
	PUSH V?REACH-IN
	JUMP ?L6
?L4:	PUSH V?TOUCH
?L6:	CALL PERFORM,STACK,PRSI
	RTRUE
?L3:	EQUAL? PRSI,TONGUE,HANDS /?L7
	CALL PRE-LOOK >STACK
	ZERO? STACK \TRUE
?L7:	IN? PRSO,PRSI \?L8
	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTI " is already in"
	CALL TRPRINT,PRSI
	RTRUE
?L8:	CALL ULTIMATELY-IN?,PRSI,PRSO >STACK
	ZERO? STACK /?L9
	PRINT YOU-CANT
	PRINTI "put"
	CALL TPRINT-PRSO
	GET P-ITBL,P-PREP2 >STACK
	EQUAL? STACK,PR?ON \?L10
	PRINTI " on"
	JUMP ?L12
?L10:	PRINTI " in"
?L12:	CALL TPRINT-PRSI
	PRINTI " when"
	CALL TPRINT-PRSI
	PRINTI " is already "
	FSET? PRSO,SURFACEBIT \?L13
	PRINTI "on"
	JUMP ?L15
?L13:	PRINTI "in"
?L15:	CALL TPRINT-PRSO
	PRINTR "!"
?L9:	CALL UNTOUCHABLE?,PRSI >STACK
	ZERO? STACK /?L16
	CALL CANT-REACH,PRSI >STACK
	RSTACK
?L16:	CALL IDROP >IDROP-VALUE
	ZERO? IDROP-VALUE /FALSE
	RETURN IDROP-VALUE

	.FUNCT V-PUT,?TMP
	FSET? PRSI,OPENBIT /?L1
	FSET? PRSI,CONTBIT /?L1
	FSET? PRSI,SURFACEBIT /?L1
	FSET? PRSI,VEHBIT /?L1
	PRINT YOU-CANT
	PRINTI "put"
	CALL TPRINT-PRSO
	PRINTI " in"
	CALL APRINT,PRSI
	PRINTR "!"
?L1:	EQUAL? PRSI,PRSO /?L4
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L3
	FSET? PRSO,TAKEBIT /?L3
?L4:	PRINTR "How can you do that?"
?L3:	FSET? PRSI,DOORBIT \?L5
	PRINT YOU-CANT
	PRINTR "do that from here."
?L5:	FSET? PRSI,OPENBIT /?L6
	FSET? PRSI,SURFACEBIT /?L6
	CALL THIS-IS-IT,PRSI
	CALL DO-FIRST,STR?123,PRSI >STACK
	RSTACK
?L6:	FSET? PRSI,ACTORBIT \?L7
	PRINT HUH
	RTRUE
?L7:	CALL WEIGHT,PRSI >?TMP
	CALL WEIGHT,PRSO >STACK
	ADD ?TMP,STACK >?TMP
	GETP PRSI,P?SIZE >STACK
	SUB ?TMP,STACK >?TMP
	GETP PRSI,P?CAPACITY >STACK
	GRTR? ?TMP,STACK \?L8
	CALL ULTIMATELY-IN?,PRSO,PRSI >STACK
	ZERO? STACK \?L8
	PRINTI "There's no room "
	FSET? PRSI,SURFACEBIT \?L9
	PRINTI "on"
	JUMP ?L11
?L9:	PRINTI "in"
?L11:	CALL TPRINT-PRSI
	PRINTI " for"
	CALL TRPRINT,PRSO
	RTRUE
?L8:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK \?L12
	CALL ITAKE >STACK
	EQUAL? STACK,M-FATAL,0 /TRUE
?L12:	MOVE PRSO,PRSI
	CALL SCORE-OBJ
	PRINTR "Done."

	.FUNCT V-PUT-BEHIND
	CALL WASTES >STACK
	RSTACK

	.FUNCT V-PUT-ON
	EQUAL? PRSI,ME \?L1
	CALL PERFORM,V?WEAR,PRSO
	RTRUE
?L1:	FSET? PRSI,SURFACEBIT /?L4
	FSET? PRSI,VEHBIT \?L3
?L4:	CALL V-PUT >STACK
	RSTACK
?L3:	EQUAL? P-PRSA-WORD,W?WRAP \?L5
	PRINTR "Useless. You're getting too wrapped up in this story."
?L5:	PRINTI "There's no good surface on"
	CALL TRPRINT,PRSI
	RTRUE

	.FUNCT V-PUT-UNDER
	CALL WASTES >STACK
	RSTACK

	.FUNCT V-RAISE
	CALL HACK-HACK,STR?146 >STACK
	RSTACK

	.FUNCT V-REACH-IN,OBJ
	FIRST? PRSO >OBJ /?L1
?L1:	FSET? PRSO,ACTORBIT /?L4
	FSET? PRSO,SURFACEBIT /?L4
	FSET? PRSO,CONTBIT /?L2
?L4:	CALL YUKS >STACK
	RSTACK
?L2:	FSET? PRSO,OPENBIT /?L5
	CALL DO-FIRST,STR?123,PRSO >STACK
	RSTACK
?L5:	ZERO? OBJ /?L7
	FSET? OBJ,INVISIBLE /?L7
	FSET? OBJ,TAKEBIT /?L6
?L7:	PRINT THERES-NOTHING
	PRINTI "in"
	CALL TRPRINT,PRSO
	RTRUE
?L6:	PRINTI "You feel something inside"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-READ
	FSET? PRSO,READBIT \?L1
	GETP PRSO,P?TEXT >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	CALL CANT-VERB-A-PRSO,STR?147 >STACK
	RSTACK

	.FUNCT V-REMOVE
	FSET? PRSO,WEARBIT \?L1
	CALL PERFORM,V?TAKE-OFF,PRSO
	RTRUE
?L1:	CALL PERFORM,V?TAKE,PRSO
	RTRUE

	.FUNCT V-ROLL
	CALL CANT-VERB-A-PRSO,STR?148 >STACK
	RSTACK

	.FUNCT V-RUN-OVER
	PRINT HUH
	RTRUE

	.FUNCT V-SAVE-SOMETHING
	PRINTI "Sorry, but"
	CALL TPRINT-PRSO
	PRINTR " is beyond help."

	.FUNCT V-SAY,V
	ZERO? AWAITING-REPLY /?L3
	GET P-LEXV,P-CONT >STACK
	CALL YES-WORD,STACK >STACK
	ZERO? STACK /?L1
	CALL V-YES
	JUMP ?L5
?L1:	ZERO? AWAITING-REPLY /?L3
	GET P-LEXV,P-CONT >STACK
	CALL NO-WORD,STACK >STACK
	ZERO? STACK /?L3
	CALL V-NO
	JUMP ?L5
?L3:	CALL FIND-IN,HERE,ACTORBIT >V
	ZERO? V /?L4
	PRINTI "You must address"
	CALL TPRINT,V
	PRINTI " directly."
	CRLF
	JUMP ?L5
?L4:	CALL PERFORM,V?TELL,ME
?L5:	CALL STOP >STACK
	RSTACK

	.FUNCT V-SCARE
	PRINTI "Despite your most frightening tactics,"
	CALL TPRINT-PRSO
	PRINTI " seems unscared."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?149,STACK >STACK
	RSTACK

	.FUNCT V-SCOLD
	PRINT HUH
	RTRUE

	.FUNCT V-SEARCH
	FSET? PRSO,ACTORBIT \?L1
	CALL V-SHAKE >STACK
	RSTACK
?L1:	IN? PROTAGONIST,PRSO \?L3
	CALL DESCRIBE-VEHICLE >STACK
	RSTACK
?L3:	FSET? PRSO,CONTBIT \?L5
	FSET? PRSO,OPENBIT /?L4
	CALL DO-FIRST,STR?123,PRSO >STACK
	RSTACK
?L4:	FSET? PRSO,CONTBIT \?L5
	SET 'C-ELAPSED,32
	PRINTI "You find"
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	PRINT PERIOD-CR
	RTRUE
?L5:	CALL CANT-VERB-A-PRSO,STR?150 >STACK
	RSTACK

	.FUNCT V-SET
	EQUAL? PRSO,ROOMS \?L1
	CALL WEE >STACK
	RSTACK
?L1:	ZERO? PRSI \?L3
	FSET? PRSO,TAKEBIT \?L4
	CALL HACK-HACK,STR?151 >STACK
	RSTACK
?L4:	PRINT YNH
	CALL TRPRINT,PRSO
	RTRUE
?L3:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-SGIVE
	CALL PERFORM,V?GIVE,PRSI,PRSO
	RTRUE

	.FUNCT V-SHAKE
	FSET? PRSO,ACTORBIT \?L1
	PRINTI "That wouldn't be polite."
	CRLF
	CALL IS-PERSON? >STACK
	CALL PRINT-ID,STR?152,STACK >STACK
	RSTACK
?L1:	CALL HACK-HACK,STR?153 >STACK
	RSTACK

	.FUNCT V-SHAKE-WITH
	EQUAL? PRSO,HANDS /?L1
	CALL RECOGNIZE >STACK
	RSTACK
?L1:	FSET? PRSI,ACTORBIT /?L3
	PRINTI "I don't think"
	CALL TPRINT-PRSI
	PRINTR " even has hands."
?L3:	PRINTR """How do you do."""

	.FUNCT PRE-SHOOT
	ZERO? PRSI \?L10
	CALL ULTIMATELY-IN?,ZAPGUN >STACK
	ZERO? STACK /?L8
	EQUAL? PRSO,ZAPGUN \?L3
	ZERO? ZAPGUN-SHOTS \?L5
	PRINTR """Click."""
?L5:	DEC 'ZAPGUN-SHOTS
	PRINTI "Nasty flames spew from the zapgun."
	CRLF
	CALL PRINT-ID,STR?154
	RTRUE
?L3:	SET 'PRSI,ZAPGUN
	PRINTI "(with the "
	PRINTD ZAPGUN
	PRINTI ")"
	CRLF
?L8:	ZERO? PRSI \?L10
	PRINTR "You aren't holding a gun!"
?L10:	EQUAL? PRSI,ZAPGUN /?L12
	PRINTI "Shoot"
	CALL APRINT,PRSI
	PRINTR "!?!"
?L12:	EQUAL? PRSO,ZAPGUN \?L13
	PRINTR "Sorry; the zapgun doesn't have a rubber barrel."
?L13:	ZERO? ZAPGUN-SHOTS \?L14
	PRINTR """Click."""
?L14:	DEC 'ZAPGUN-SHOTS
	RFALSE

	.FUNCT V-SHOOT,L
	ZERO? ZAPGUN-FOOTNOTE \?L1
	SET 'ZAPGUN-FOOTNOTE,1
	PRINTI "(Footnote 9) "
?L1:	PRINTI "A blaze of intense rays "
	FSET? PRSO,TAKEBIT /?L7
	EQUAL? PRSO,ROULETTE-WHEEL,LOCKER,ID-CHANGER /?L7
	EQUAL? PRSO,DRYER,HEATING-CHAMBER,LOG-READER /?L7
	EQUAL? PRSO,SKELETON,CAGE,PRESSER /?L7
	EQUAL? PRSO,SOUP,GRAY-GOO,ORANGE-GOO \?L4
?L7:	PRINTI "envelop"
	CALL TPRINT-PRSO
	PRINTI ". When the rays dissipate,"
	CALL TPRINT-PRSO
	PRINTI " "
	FSET? PRSO,PLURALBIT \?L8
	PRINTI "are"
	JUMP ?L10
?L8:	PRINTI "is"
?L10:	PRINTI " gone."
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L11
	PRINTI " Unfortunately, so is most of your "
	FSET? PRSO,WORNBIT \?L13
	PRINTI "body, since you were wear"
	JUMP ?L15
?L13:	PRINTI "arm, since you were hold"
?L15:	PRINTI "ing"
	CALL TPRINT-PRSO
	CALL PRINT-ID,STR?155
	CALL JIGS-UP,STR?90 >STACK
	RSTACK
?L11:	LOC PRSO >L
	EQUAL? L,FLOYD \?L17
	PRINTI " Floyd, who was holding"
	CALL TPRINT-PRSO
	PRINTI ", gives a shriek of fear, and all the oil drains from his face."
	CALL PRINT-ID,STR?156
	JUMP ?L19
?L17:	EQUAL? L,HERE,PEDESTAL,DRILLED-HOLE /?L19
	PRINTI " Naturally,"
	CALL TPRINT,L
	PRINTI " is also history, since"
	CALL TPRINT-PRSO
	PRINTI " was sitting "
	FSET? L,SURFACEBIT \?L20
	PRINTI "o"
	JUMP ?L22
?L20:	PRINTI "i"
?L22:	PRINTI "n it."
	CALL REMOVE-CAREFULLY,L
?L19:	CALL REMOVE-CAREFULLY,PRSO
	CRLF
	RTRUE
?L4:	PRINTI "washes over"
	CALL TPRINT-PRSO
	PRINTR ". It glows for a bit, but then cools."

	.FUNCT V-SSHOOT
	CALL PERFORM,V?SHOOT,PRSI,PRSO
	CALL THIS-IS-IT,PRSO
	RTRUE

	.FUNCT V-SHOW
	PRINTI "It doesn't look like"
	CALL TPRINT-PRSI
	PRINTR " is interested."

	.FUNCT V-SIT,VEHICLE
	EQUAL? PRSO,ROOMS /?L1
	CALL PERFORM,V?ENTER,PRSO
	RTRUE
?L1:	EQUAL? HERE,THEATRE \?L3
	PRINTR "But there's nothing to watch at the moment!"
?L3:	CALL FIND-IN,HERE,VEHBIT >VEHICLE
	ZERO? VEHICLE /?L4
	CALL PERFORM,V?ENTER,VEHICLE
	RTRUE
?L4:	CALL PERFORM,V?CLIMB-ON,GROUND
	RTRUE

	.FUNCT V-SKIP
	CALL WEE >STACK
	RSTACK

	.FUNCT V-SLEEP
	ZERO? SLEEPY-LEVEL \?L1
	PRINTR "You're not tired."
?L1:	CALL QUEUED?,I-FALL-ASLEEP >STACK
	ZERO? STACK /?L3
	PRINTR "You'll probably be asleep before you know it."
?L3:	PRINTR "Members of civilized societies usually sleep in beds."

	.FUNCT PRE-SMELL
	FSET? SPACESUIT,WORNBIT \FALSE
	PRINTI "You smell stale air and rusty metal and unbathed "
	PRINT LFC
	PRINTR " -- all the usual odors of a space suit."

	.FUNCT V-SMELL
	ZERO? PRSO /?L3
	EQUAL? PRSO,AIR \?L1
?L3:	ZERO? BALLOON-ODOR /?L4
	PRINTI "The awful odor of the "
	PRINTD BALLOON
	PRINTR "'s digestive gas is thankfully fading."
?L4:	EQUAL? HERE,GREASY-STRAW \?L6
	FSET? NECTAR,TOUCHBIT /?L6
	PRINTR "There's something yum-smelling around here!"
?L6:	EQUAL? HERE,OPIUM-DEN \?L7
	PRINTR "There's a lingering smell of various drugs."
?L7:	CALL VISIBLE?,BALLOON >STACK
	ZERO? STACK /?L8
	CALL PERFORM,V?SMELL,BALLOON
	RTRUE
?L8:	EQUAL? HERE,COMMANDERS-QUARTERS \?L9
	FSET? SAFE,OPENBIT \?L9
	PRINTR "The odor of an explosion hangs in the air."
?L9:	PRINTR "You smell nothing unusual just now."
?L1:	CALL SENSE-OBJECT,STR?157 >STACK
	RSTACK

	.FUNCT SENSE-OBJECT,STRING
	CALL PRONOUN
	PRINTI " "
	PRINT STRING
	FSET? PRSO,PLURALBIT /?L1
	EQUAL? PRSO,ME /?L1
	PRINTI "s"
?L1:	PRINTI " just like"
	CALL ARPRINT,PRSO
	RTRUE

	.FUNCT V-SPLAY-WITH
	CALL PERFORM,V?PLAY-WITH,PRSI
	RTRUE

	.FUNCT V-SPRAY
	ZERO? PRSI \?L1
	IN? SPRAY-CAN,PROTAGONIST \?L1
	PRINTI "[with the "
	PRINTD SPRAY-CAN
	PRINTI "]"
	CRLF
	CALL PERFORM,V?SPRAY,SPRAY-CAN,PRSO
	RTRUE
?L1:	CALL CANT-VERB-A-PRSO,STR?158 >STACK
	RSTACK

	.FUNCT V-SPUT-ON
	CALL PERFORM,V?PUT-ON,PRSI,PRSO
	RTRUE

	.FUNCT V-SSHOW
	CALL PERFORM,V?SHOW,PRSI,PRSO
	RTRUE

	.FUNCT V-SSPRAY
	CALL PERFORM,V?SPRAY,PRSI,PRSO
	RTRUE

	.FUNCT V-STAND
	EQUAL? P-PRSA-WORD,W?HOLD \?L1
	CALL WASTES >STACK
	RSTACK
?L1:	LOC PROTAGONIST >STACK
	FSET? STACK,VEHBIT \?L3
	LOC PROTAGONIST >STACK
	CALL PERFORM,V?DISEMBARK,STACK
	RTRUE
?L3:	ZERO? PRSO /?L4
	FSET? PRSO,TAKEBIT \?L4
	CALL WASTES >STACK
	RSTACK
?L4:	ZERO? STUNNED /?L5
	CALL YOURE-STUNNED >STACK
	RSTACK
?L5:	PRINTR "You're already standing."

	.FUNCT V-STAND-ON
	CALL WASTES >STACK
	RSTACK

	.FUNCT V-STELL
	CALL PERFORM,V?TELL,PRSI
	RTRUE

	.FUNCT V-STHROW
	CALL PERFORM,V?THROW-TO,PRSI,PRSO
	RTRUE

	.FUNCT V-SWING
	ZERO? PRSI /?L1
	CALL PERFORM,V?KILL,PRSI,PRSO
	RTRUE
?L1:	PRINTR """Whoosh."""

	.FUNCT V-SWRAP
	CALL PERFORM,V?PUT-ON,PRSO,PRSI
	RTRUE

	.FUNCT PRE-TAKE
	ZERO? STUNNED /?L1
	CALL YOURE-STUNNED,STR?159 >STACK
	RSTACK
?L1:	CALL UNTOUCHABLE?,PRSO >STACK
	ZERO? STACK /?L3
	CALL CANT-REACH,PRSO >STACK
	RSTACK
?L3:	EQUAL? PRSI,TONGUE,HANDS /?L4
	CALL PRE-LOOK >STACK
	ZERO? STACK \TRUE
?L4:	CALL LOC-CLOSED >STACK
	ZERO? STACK \TRUE
	IN? PROTAGONIST,PRSO \?L6
	PRINTI "You're "
	FSET? PRSO,INBIT \?L7
	PRINTI "i"
	JUMP ?L9
?L7:	PRINTI "o"
?L9:	PRINTR "n it, asteroid-brain!"
?L6:	IN? PRSO,PROTAGONIST /?L11
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /?L10
	FSET? PRSO,TAKEBIT /?L10
?L11:	FSET? PRSO,WORNBIT \?L12
	PRINTI "You're already wearing"
	JUMP ?L14
?L12:	PRINTI "You already have"
?L14:	CALL TPRINT-PRSO
	PRINT PERIOD-CR
	RTRUE
?L10:	IN? PRSO,HEATING-CHAMBER \?L15
	CALL PERFORM,V?REACH-IN,HEATING-CHAMBER
	RTRUE
?L15:	EQUAL? PRSO,LEASH \?L16
	EQUAL? PRSI,BALLOON \?L16
	CALL PERFORM,V?REMOVE,LEASH
	RTRUE
?L16:	ZERO? PRSI /FALSE
	IN? PRSO,PRSI /FALSE
	EQUAL? PRSO,ME \?L19
	CALL PERFORM,V?DROP,PRSI
	RTRUE
?L19:	EQUAL? PRSI,GLOBAL-ROOM \?L20
	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK /FALSE
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L20:	EQUAL? PRSI,SCULPTURE,GARBAGE \?L24
	IN? PRSO,HERE /FALSE
?L24:	IN? PRSO,PRSI /?L25
	CALL NOT-IN >STACK
	RSTACK
?L25:	SET 'PRSI,0
	RFALSE

	.FUNCT V-TAKE
	CALL ITAKE >STACK
	EQUAL? STACK,1 \FALSE
	ZERO? ID-SCRAMBLED \?L3
	EQUAL? PRSO,ID-CARD \?L6
	CALL ULTIMATELY-IN?,BOOTS >STACK
	ZERO? STACK /?L6
	FSET? BOOTS,WORNBIT \?L5
?L6:	EQUAL? PRSO,BOOTS \?L3
	CALL ULTIMATELY-IN?,ID-CARD >STACK
	ZERO? STACK /?L3
?L5:	FCLEAR BOOTS,TRYTAKEBIT
	FCLEAR ID-CARD,TRYTAKEBIT
	SET 'ID-SCRAMBLED,1
?L3:	PRINTI "Taken."
	CRLF
	CALL IS-THEFT? >STACK
	CALL PRINT-ID,STR?160,STACK >STACK
	RSTACK

	.FUNCT V-TAKE-OFF
	EQUAL? PRSO,ROOMS \?L1
	LOC PROTAGONIST >STACK
	FSET? STACK,VEHBIT \?L3
	PRINTI "[of"
	LOC PROTAGONIST >STACK
	CALL TPRINT,STACK
	PRINTI "]"
	CRLF
	LOC PROTAGONIST >STACK
	CALL PERFORM,V?DISEMBARK,STACK
	RTRUE
?L3:	CALL V-STAND >STACK
	RSTACK
?L1:	ZERO? STUNNED /?L6
	CALL YOURE-STUNNED >STACK
	RSTACK
?L6:	FSET? PRSO,WORNBIT \?L7
	SET 'C-ELAPSED,18
	FCLEAR PRSO,WORNBIT
	PRINTI "Okay, you're no longer wearing"
	CALL TRPRINT,PRSO
	RTRUE
?L7:	FSET? PRSO,VEHBIT \?L8
	CALL PERFORM,V?DISEMBARK,PRSO
	RTRUE
?L8:	PRINTI "You aren't wearing"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-TAKE-WITH
	PRINTI "Sorry,"
	CALL TPRINT-PRSI
	PRINTI " is no help in getting"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-TASTE
	GETP PRSO,P?FOOD-DESC >STACK
	ZERO? STACK /?L1
	PRINTR "It tastes edible."
?L1:	CALL SENSE-OBJECT,STR?161 >STACK
	RSTACK

	.FUNCT V-TELL
	FSET? PRSO,ACTORBIT \?L1
	ZERO? P-CONT /?L3
	SET 'WINNER,PRSO
	SET 'ELIMINATE-CR,1
	RTRUE
?L3:	PRINTI "Hmmm..."
	CALL TPRINT-PRSO
	PRINTR " looks at you expectantly."
?L1:	PRINTI "Talking to"
	CALL APRINT,PRSO
	PRINTI "? Dr. Blanchard, the Duffy's psychiatrist, would be fascinated to hear that."
	CRLF
	CALL STOP >STACK
	RSTACK

	.FUNCT V-TELL-ABOUT
	EQUAL? PRSO,ME \?L1
	CALL PERFORM,V?WHAT,PRSI
	RTRUE
?L1:	CALL VISIBLE?,PRSI >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?SHOW,PRSI,PRSO
	RTRUE
?L3:	SET 'PRSI,PRSO
	CALL V-SHOW >STACK
	RSTACK

	.FUNCT V-THANK,OWINNER
	ZERO? PRSO \?L1
	PRINTR "[Just doing my job.]"
?L1:	FSET? PRSO,ACTORBIT \?L3
	SET 'OWINNER,WINNER
	SET 'WINNER,PRSO
	CALL PERFORM,V?THANK
	SET 'WINNER,OWINNER
	RTRUE
?L3:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-THROW
	EQUAL? HERE,VACUUM-STORAGE \?L1
	PRINTI "You lose sight of"
	CALL TPRINT-PRSO
	PRINTI " as it sails away."
	CALL REMOVE-CAREFULLY,PRSO
	CRLF
	RTRUE
?L1:	EQUAL? HERE,TOP-OF-AIR-SHAFT,AIR-SHAFT \?L3
	CALL V-DROP >STACK
	RSTACK
?L3:	ZERO? PRSI /?L4
	MOVE PRSO,HERE
	PRINTR "You missed."
?L4:	MOVE PRSO,HERE
	PRINTR "Thrown."

	.FUNCT V-THROW-TO
	FSET? PRSI,ACTORBIT \?L1
	CALL PERFORM,V?GIVE,PRSO,PRSI
	RTRUE
?L1:	CALL PERFORM,V?THROW,PRSO,PRSI
	RTRUE

	.FUNCT V-TICKLE
	PRINTR "Kitchy kitchy koo?"

	.FUNCT V-TIE
	PRINT YOU-CANT
	PRINTI "tie"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-TIME,NO-CR=0
	PRINTI "Current Galactic Standard Time "
	FSET? CHRONOMETER,WORNBIT \?L1
	LESS? DAY,3 \?L1
	PRINTI "(adjusted to your local day-cycle) is "
	PRINTN INTERNAL-MOVES
	JUMP ?L6
?L1:	PRINTI "is impossible to determine, since you"
	FSET? CHRONOMETER,WORNBIT /?L4
	PRINTI "'ve removed your "
	PRINTD CHRONOMETER
	JUMP ?L6
?L4:	PRINTI "r "
	PRINTD CHRONOMETER
	PRINTI " has stopped"
?L6:	ZERO? NO-CR /?L7
	PRINTI "."
	RTRUE
?L7:	PRINT PERIOD-CR
	RTRUE

	.FUNCT PRE-TOUCH,VB=1
	ZERO? STUNNED /?L1
	ZERO? VB /TRUE
	CALL YOURE-STUNNED,STR?159
	RTRUE
?L1:	CALL UNTOUCHABLE?,PRSO >STACK
	ZERO? STACK /FALSE
	ZERO? VB /TRUE
	CALL CANT-REACH,PRSO
	RTRUE

	.FUNCT V-TOUCH
	CALL LOC-CLOSED >STACK
	ZERO? STACK \TRUE
	CALL HACK-HACK,STR?162 >STACK
	RSTACK

	.FUNCT V-TYPE
	EQUAL? PRSI,0,KEYPAD /?L1
	PRINT YOU-CANT
	PRINTI "type on"
	CALL APRINT,PRSI
	PRINTR "!"
?L1:	CALL GLOBAL-IN?,KEYPAD,HERE >STACK
	ZERO? STACK \?L3
	ZERO? PRSO /?L4
	PRINT HUH
	RTRUE
?L4:	PRINTI "There's no keypad here!"
	CRLF
	CALL STOP >STACK
	RSTACK
?L3:	ZERO? PRSO /?L17
	EQUAL? PRSO,INTNUM \?L7
	ZERO? P-NUMBER \?L8
	PRINTR "[Specify the number! TYPE 7, for example.]"
?L8:	EQUAL? HERE,ROBOT-POOL \?L10
	CALL ROBOT-TYPE >STACK
	RSTACK
?L10:	EQUAL? HERE,SPACETRUCK \?L11
	CALL SPACETRUCK-TYPE >STACK
	RSTACK
?L11:	EQUAL? HERE,SHADY-DANS \?L12
	CALL ID-CHANGER-TYPE >STACK
	RSTACK
?L12:	EQUAL? HERE,PX \?L13
	CALL DISPENSER-TYPE >STACK
	RSTACK
?L13:	CALL ELEVATOR-TYPE >STACK
	RSTACK
?L7:	ZERO? PRSO \?L15
?L17:	ZERO? P-CONT /?L15
	CALL NUMBER?,P-CONT >STACK
	EQUAL? STACK,W?NUMBER \?L15
	CALL PERFORM,V?TYPE,INTNUM
	CALL STOP >STACK
	RSTACK
?L15:	PRINTI "You can only type numbers on this keypad."
	CRLF
	CALL STOP >STACK
	RSTACK

	.FUNCT ROBOT-TYPE
	FSET? ROBOT-USE-AUTHORIZATION-FORM,NDESCBIT /?L1
	CALL RECORDING,STR?163 >STACK
	RSTACK
?L1:	ZERO? ROBOT-PICKED /?L3
	CALL RECORDING,STR?164 >STACK
	RSTACK
?L3:	GRTR? P-NUMBER,3 \?L4
	CALL RECORDING,STR?165 >STACK
	RSTACK
?L4:	LESS? P-NUMBER,1 \?L5
	CALL RECORDING,STR?166 >STACK
	RSTACK
?L5:	EQUAL? P-NUMBER,3 \?L6
	FSET FLOYD,TOUCHBIT
	SET 'ROBOT-PICKED,FLOYD
	SET 'FLOYD-SPOKE,1
	PRINTI """Yippee!"" yells Floyd, bounding joyfully over and giving you a big hug."
	CRLF
	CALL PRINT-ID,STR?167 >STACK
	RSTACK
?L6:	EQUAL? P-NUMBER,1 \?L8
	SET 'ROBOT-PICKED,REX
	JUMP ?L10
?L8:	SET 'ROBOT-PICKED,HELEN
?L10:	CALL DEQUEUE,I-FLOYD
	CALL QUEUE,I-OTHER-ROBOT,-1
	FSET ROBOT-PICKED,TOUCHBIT
	PRINTD ROBOT-PICKED
	PRINTR " rolls up to you, ready to follow. Floyd's lower jaw begins quivering, as though he were about to cry."

	.FUNCT SPACETRUCK-TYPE,X
	FSET? CLASS-THREE-SPACECRAFT-ACTIVATION-FORM,NDESCBIT /?L1
	CALL RECORDING,STR?163 >STACK
	RSTACK
?L1:	EQUAL? SPACETRUCK-COUNTER,5 \?L3
	CALL RECORDING,STR?168 >STACK
	RSTACK
?L3:	ZERO? COURSE-PICKED /?L4
	CALL RECORDING,STR?164 >STACK
	RSTACK
?L4:	IN? PROTAGONIST,PILOT-SEAT /?L6
	IN? FLOYD,PILOT-SEAT \?L5
?L6:	IN? PROTAGONIST,COPILOT-SEAT /?L7
	IN? FLOYD,COPILOT-SEAT \?L5
?L7:	SET 'COURSE-PICKED,P-NUMBER
	DIV INTERNAL-MOVES,50 >X
	SUB X,132 >X
	MUL X,X >X
	DIV X,4 >X
	ADD X,103 >RIGHT-COURSE
	CALL QUEUE,I-SPACETRUCK,33
	CALL RECORDING,STR?169 >STACK
	RSTACK
?L5:	CALL RECORDING,STR?170 >STACK
	RSTACK

	.FUNCT ELEVATOR-TYPE,DISTANCE
	GRTR? P-NUMBER,9 /?L3
	LESS? P-NUMBER,1 \?L1
?L3:	CALL RECORDING,STR?171 >STACK
	RSTACK
?L1:	GRTR? DAY,2 \?L4
	CALL PRINT-ID,STR?172
	CALL JIGS-UP,STR?173 >STACK
	RSTACK
?L4:	EQUAL? ELEVATOR-LEVEL,P-NUMBER \?L5
	CALL RECORDING,STR?174 >STACK
	RSTACK
?L5:	EQUAL? P-NUMBER,8,9 \?L6
	PRINTR "The elevator whines momentarily, but doesn't move."
?L6:	PRINTI "The elevator "
	EQUAL? DAY,1 \?L8
	PRINTI "glides weightlessly "
	JUMP ?L10
?L8:	PRINTI "starts with a jerk, "
	GRTR? P-NUMBER,ELEVATOR-LEVEL \?L11
	PRINTI "bumping you against the ceiling, "
	CALL PRINT-ID,STR?175
?L11:	PRINTI "then moves "
?L10:	GRTR? P-NUMBER,ELEVATOR-LEVEL \?L14
	PRINTI "down"
	SUB P-NUMBER,ELEVATOR-LEVEL >DISTANCE
	JUMP ?L16
?L14:	PRINTI "up"
	SUB ELEVATOR-LEVEL,P-NUMBER >DISTANCE
?L16:	PRINTI " the shaft, stopping "
	EQUAL? DAY,2 \?L20
	PRINTI "suddenly "
	EQUAL? DAY,2 \?L20
	GRTR? INTERNAL-MOVES,6300 \?L20
	PRINTI "and not quite at level with your new floor"
	JUMP ?L22
?L20:	PRINTI "at another opening to the west"
?L22:	EQUAL? DAY,2 \?L23
	GRTR? ELEVATOR-LEVEL,P-NUMBER \?L23
	PRINTI ". The sudden stop bumps you against the ceiling of the weightless elevator"
?L23:	MUL 5,DISTANCE >C-ELAPSED
	SET 'ELEVATOR-LEVEL,P-NUMBER
	IN? BALLOON,ELEVATOR \?L26
	PRINTI ". The "
	PRINTD BALLOON
	PRINTI " looks somewhat disoriented by the experience"
?L26:	IN? OSTRICH,ELEVATOR \?L29
	PRINTI ". "
	CALL PERFORM,V?SCARE,OSTRICH
	RTRUE
?L29:	PRINT PERIOD-CR
	RTRUE

	.FUNCT DISPENSER-TYPE
	FSET? DISPENSER,TOUCHBIT /?L1
	CALL RECORDING,STR?176 >STACK
	RSTACK
?L1:	GRTR? P-NUMBER,9 \?L3
	CALL RECORDING,STR?177 >STACK
	RSTACK
?L3:	EQUAL? P-NUMBER,6,9 \?L4
	FCLEAR DISPENSER,TOUCHBIT
	EQUAL? P-NUMBER,6 \?L5
	MOVE TIMER,DISPENSER
	JUMP ?L7
?L5:	MOVE LARGE-BIT,DISPENSER
?L7:	PRINTR "You hear a loud ""klunk"" inside the dispenser, but nothing appears in the dispenser hole."
?L4:	LESS? P-NUMBER,1 \?L8
	CALL RECORDING,STR?166 >STACK
	RSTACK
?L8:	CALL RECORDING,STR?178 >STACK
	RSTACK

	.FUNCT RECORDING,STRING
	RANDOM 100 >STACK
	LESS? 33,STACK /?L1
	PRINTI "A recording says,"
	JUMP ?L4
?L1:	RANDOM 100 >STACK
	LESS? 50,STACK /?L3
	PRINTI "You hear a recorded voice."
	JUMP ?L4
?L3:	PRINTI "A taped voice whispers in your ear."
?L4:	PRINTI " """
	PRINT STRING
	PRINTR "."""

	.FUNCT V-UNDRESS
	ZERO? PRSO /?L1
	CALL IMPOSSIBLES >STACK
	RSTACK
?L1:	SET 'PRSO,ROOMS
	CALL V-GET-UNDRESSED >STACK
	RSTACK

	.FUNCT V-UNLOCK
	FSET? PRSO,LOCKEDBIT /?L5
	EQUAL? HERE,THEATRE,BRIG \?L3
	EQUAL? PRSO,PSEUDO-OBJECT /?L5
?L3:	PRINTI "But"
	CALL TPRINT-PRSO
	PRINTR " isn't locked."
?L5:	ZERO? PRSI \?L7
	CALL ULTIMATELY-IN?,KEY >STACK
	ZERO? STACK /?L9
	PRINTI "[with the key]"
	CRLF
	CALL PERFORM,V?UNLOCK,PRSO,KEY
	RTRUE
?L9:	SET 'AWAITING-REPLY,1
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTR "Your nose is key-shaped, I suppose?"
?L7:	EQUAL? PRSI,KEY \?L12
	PRINTI "This key doesn't unlock"
	CALL TRPRINT,PRSO
	RTRUE
?L12:	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-UNTIE
	CALL IMPOSSIBLES >STACK
	RSTACK

	.FUNCT V-USE
	PRINT YOULL-HAVE-TO
	PRINTI "be more specific about how you want to use"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT PRE-VALIDATE
	ZERO? PRSI \?L6
	CALL VISIBLE?,VALIDATION-STAMP >STACK
	ZERO? STACK \?L1
	PRINTI "You don't have a "
	PRINTD VALIDATION-STAMP
	PRINTR "!"
?L1:	ZERO? PRSI \?L6
	CALL ULTIMATELY-IN?,VALIDATION-STAMP >STACK
	ZERO? STACK \?L3
	PRINT YNH
	CALL TRPRINT,VALIDATION-STAMP
	RTRUE
?L3:	ZERO? PRSI /FALSE
?L6:	EQUAL? PRSI,VALIDATION-STAMP /FALSE
	PRINT HUH
	RTRUE

	.FUNCT V-VALIDATE
	PRINTI "There's no validation box on"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-WALK,AV,VEHICLE,PT,PTS,STR,OBJ,RM
	LOC PROTAGONIST >AV
	ZERO? P-WALK-DIR \?L1
	CALL PERFORM,V?WALK-TO,PRSO
	RTRUE
?L1:	ZERO? STUNNED /?L3
	CALL YOURE-STUNNED,STR?179 >STACK
	RSTACK
?L3:	EQUAL? PRSO,P?OUT \?L4
	EQUAL? AV,SIMULATION-BOOTH,HOLDING-TANK \?L4
	CALL PERFORM,V?DISEMBARK,AV
	RTRUE
?L4:	ZERO? HANGING-IN-AIR /?L5
	EQUAL? PRSO,P?DOWN \?L6
	CALL PERFORM,V?DROP,LEASH
	RTRUE
?L6:	PRINTR "It's hard to walk when your feet are a couple of meters from the floor."
?L5:	EQUAL? PRSO,P?IN \?L9
	GETPT HERE,P?IN >STACK
	ZERO? STACK \?L9
	CALL FIND-IN,HERE,VEHBIT >VEHICLE
	ZERO? VEHICLE /?L9
	CALL ULTIMATELY-IN?,VEHICLE >STACK
	ZERO? STACK \?L9
	CALL PERFORM,V?ENTER,VEHICLE
	RTRUE
?L9:	FSET? AV,VEHBIT \?L10
	PRINTI "You're not walking anywhere until you get o"
	EQUAL? AV,BED \?L11
	PRINTI "ff"
	JUMP ?L13
?L11:	PRINTI "ut of"
?L13:	CALL TRPRINT,AV
	RETURN 8
?L10:	ZERO? TIMER-CONNECTED /?L17
	CALL ULTIMATELY-IN?,TIMER >STACK
	ZERO? STACK /?L16
	CALL ULTIMATELY-IN?,DETONATOR >STACK
	ZERO? STACK \?L16
	CALL DO-FIRST,STR?115 >STACK
	RSTACK
?L16:	ZERO? TIMER-CONNECTED /?L17
	CALL ULTIMATELY-IN?,DETONATOR >STACK
	ZERO? STACK /?L17
	CALL ULTIMATELY-IN?,TIMER >STACK
	ZERO? STACK \?L17
	CALL DO-FIRST,STR?115 >STACK
	RSTACK
?L17:	ZERO? EXPLOSIVE-CONNECTED /?L19
	CALL ULTIMATELY-IN?,DETONATOR >STACK
	ZERO? STACK /?L18
	CALL ULTIMATELY-IN?,EXPLOSIVE >STACK
	ZERO? STACK \?L18
	CALL DO-FIRST,STR?116 >STACK
	RSTACK
?L18:	ZERO? EXPLOSIVE-CONNECTED /?L19
	CALL ULTIMATELY-IN?,EXPLOSIVE >STACK
	ZERO? STACK /?L19
	CALL ULTIMATELY-IN?,DETONATOR >STACK
	ZERO? STACK \?L19
	CALL DO-FIRST,STR?116 >STACK
	RSTACK
?L19:	GETPT HERE,PRSO >PT
	ZERO? PT /?L20
	ZERO? LIT /?L21
	SET 'C-ELAPSED,22
	JUMP ?L23
?L21:	SET 'C-ELAPSED,33
?L23:	PTSIZE PT >PTS
	EQUAL? PTS,UEXIT \?L24
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L24:	EQUAL? PTS,CEXIT \?L26
	EQUAL? HERE,CASINO \?L27
	GETB PT,CEXITFLAG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L29
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L29:	SET 'C-ELAPSED,7
	PRINT CANT-GO
	RETURN 8
?L27:	ZERO? VERBOSITY /?L35
	CALL DESCRIBE-AUTO-DOOR
?L35:	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L26:	EQUAL? PTS,NEXIT \?L38
	SET 'C-ELAPSED,7
	GET PT,NEXITSTR >STACK
	PRINT STACK
	CRLF
	RETURN 8
?L38:	EQUAL? PTS,FEXIT \?L41
	GET PT,FEXITFCN >STACK
	CALL STACK >RM
	ZERO? RM /?L42
	CALL GOTO,RM >STACK
	RSTACK
?L42:	EQUAL? HERE,AIR-SHAFT /TRUE
	SET 'C-ELAPSED,7
	RETURN 8
?L41:	EQUAL? PTS,DEXIT \FALSE
	GETB PT,DEXITOBJ >OBJ
	FSET? OBJ,OPENBIT \?L49
	GETB PT,REXIT >STACK
	CALL GOTO,STACK >STACK
	RSTACK
?L49:	GET PT,DEXITSTR >STR
	ZERO? STR /?L51
	SET 'C-ELAPSED,7
	CALL THIS-IS-IT,OBJ
	PRINT STR
	CRLF
	RETURN 8
?L51:	SET 'C-ELAPSED,7
	CALL THIS-IS-IT,OBJ
	CALL DO-FIRST,STR?123,OBJ
	RETURN 8
?L20:	EQUAL? PRSO,P?IN,P?OUT \?L58
	CALL V-WALK-AROUND
	RETURN 8
?L58:	PRINT CANT-GO
	RETURN 8

	.FUNCT DESCRIBE-AUTO-DOOR
	EQUAL? HERE,BRIG,ARMORY \?L1
	PRINTI "The "
	PRINTD SECURITY-DOOR
	PRINTI " "
	JUMP ?L3
?L1:	PRINTI "The auto-door "
?L3:	EQUAL? DAY,1 \?L4
	PRINTI "opens as you approach, and whisks shut behind you..."
	JUMP ?L14
?L4:	GRTR? DAY,2 \?L6
	PRINTI "opens barely wide enough for you to squeeze through. As you do so, the door tries to shut, almost jamming against you!"
	FSET? AUTO-DOOR,TOUCHBIT /?L14
	FSET AUTO-DOOR,TOUCHBIT
	PRINTI " Fortunately, auto-doors don't have a lot of power."
	JUMP ?L14
?L6:	PRINTI "opens sluggishly. As soon as you have passed through, it zooms shut, "
	GRTR? INTERNAL-MOVES,5000 \?L11
	PRINTI "almost nipping your heels!"
	JUMP ?L13
?L11:	PRINTI "seemingly a little sooner than normal."
?L13:	FSET? AUTO-DOOR,TOUCHBIT /?L14
	FSET AUTO-DOOR,TOUCHBIT
	PRINTI " Very puzzling; auto-doors have been around for millenia, and are generally the epitome of reliability."
?L14:	CRLF
	CRLF
	RTRUE

	.FUNCT V-WALK-AROUND
	SET 'AWAITING-REPLY,1
	CALL QUEUE,I-REPLY,1
	SET 'P-WON,0
	PRINTR "Did you have any particular direction in mind?"

	.FUNCT V-WALK-TO
	EQUAL? PRSO,INTDIR \?L1
	CALL DO-WALK,P-DIRECTION >STACK
	RSTACK
?L1:	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK /?L3
	FSET? PRSO,VEHBIT \?L4
	CALL PERFORM,V?ENTER,PRSO
	RTRUE
?L4:	CALL V-FOLLOW >STACK
	RSTACK
?L3:	CALL V-WALK-AROUND >STACK
	RSTACK

	.FUNCT V-WAIT
	EQUAL? PRSA,V?WAIT-FOR \?L1
	SET 'C-ELAPSED,P-NUMBER
	JUMP ?L4
?L1:	EQUAL? PRSA,V?WAIT-UNTIL \?L3
	SUB P-NUMBER,INTERNAL-MOVES >C-ELAPSED
	JUMP ?L4
?L3:	SET 'C-ELAPSED,40
?L4:	PRINTR "Time passes..."

	.FUNCT V-WAIT-FOR
	CALL VISIBLE?,PRSO >STACK
	ZERO? STACK /?L1
	CALL V-FOLLOW >STACK
	RSTACK
?L1:	PRINTR "You may be waiting quite a while."

	.FUNCT V-WAIT-UNTIL
	PRINT HUH
	RTRUE

	.FUNCT V-WEAR
	FSET? PRSO,WEARBIT /?L1
	CALL CANT-VERB-A-PRSO,STR?180 >STACK
	RSTACK
?L1:	PRINTI "You're "
	FSET? PRSO,WORNBIT \?L4
	PRINTI "already"
	JUMP ?L6
?L4:	MOVE PRSO,PROTAGONIST
	FSET PRSO,WORNBIT
	SET 'C-ELAPSED,18
	PRINTI "now"
?L6:	PRINTI " wearing"
	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT V-WHAT
	PRINTR "Good question."

	.FUNCT V-WHERE
	CALL V-FIND,1 >STACK
	RSTACK

	.FUNCT V-WRAP
	CALL PERFORM,V?PUT-ON,PRSI,PRSO
	RTRUE

	.FUNCT V-YELL
	PRINTI "Aaaarrrggghhh!"
	CRLF
	IN? OSTRICH,HERE \?L1
	PRINTI "   "
	CALL PERFORM,V?SCARE,OSTRICH
	RTRUE
?L1:	CALL STOP >STACK
	RSTACK

	.FUNCT I-REPLY
	SET 'AWAITING-REPLY,0
	RFALSE

	.FUNCT V-YES
	EQUAL? AWAITING-REPLY,1 \?L1
	PRINTR "That was just a rhetorical question."
?L1:	EQUAL? AWAITING-REPLY,2 \?L3
	PRINTR """Floyd changed his mind. Controls too scary-looking."""
?L3:	EQUAL? AWAITING-REPLY,3 \?L4
	PRINTR "Floyd shrugs. ""Floyd feels not like learning new rules now. Let's play tag. Floyd knows rules for tag really well!"""
?L4:	EQUAL? AWAITING-REPLY,4 \?L5
	CALL PERFORM,V?PLAY-WITH,FLOYD
	RTRUE
?L5:	CALL YOU-SOUND,STR?181 >STACK
	RSTACK

	.FUNCT YOU-SOUND,STRING
	PRINTI "You sound rather "
	PRINT STRING
	PRINTR "ive."

	.FUNCT YES-WORD,WRD
	EQUAL? WRD,W?YES,W?Y,W?YUP /TRUE
	EQUAL? WRD,W?OK,W?OKAY,W?SURE \FALSE
	RTRUE

	.FUNCT V-ZORK
	PRINTR "Gesundheit!"

	.FUNCT ITAKE,VB=1,OBJ,?TMP
	FSET? PRSO,TAKEBIT /?L1
	ZERO? VB /?L3
	CALL YUKS
?L3:	RETURN 8
?L1:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK \?L8
	CALL WEIGHT,PRSO >?TMP
	CALL WEIGHT,PROTAGONIST >STACK
	ADD ?TMP,STACK >STACK
	GRTR? STACK,100 \?L8
	ZERO? VB /?L9
	PRINTI "You're juggling just about as much stuff as you can manage."
	CRLF
?L9:	RETURN 8
?L8:	CALL CCOUNT,PROTAGONIST >STACK
	MUL STACK,20 >STACK
	SUB STACK,150 >?TMP
	RANDOM 100 >STACK
	LESS? ?TMP,STACK /?L14
	FIRST? PROTAGONIST >OBJ /?L15
?L15:	FSET? OBJ,WORNBIT \?L18
	NEXT? OBJ >OBJ /?L15
	JUMP ?L15
?L18:	EQUAL? OBJ,OSTRICH-NIP \?L17
	IN? OSTRICH,HERE \?L17
	NEXT? OBJ >OBJ /?L15
	JUMP ?L15
?L17:	MOVE PRSO,HERE
	MOVE OBJ,HERE
	FSET PRSO,TOUCHBIT
	ZERO? VB /?L24
	PRINTI "As you try to grab"
	CALL TPRINT-PRSO
	PRINTI ","
	CALL TPRINT,OBJ
	PRINTI " slips from your hands and both tumble "
	FSET? HERE,WEIGHTLESSBIT \?L26
	PRINTI "away"
	JUMP ?L28
?L26:	PRINTI "to the floor"
?L28:	PRINT PERIOD-CR
?L24:	RETURN 8
?L14:	CALL SCORE-OBJ
	MOVE PRSO,PROTAGONIST
	RTRUE

	.FUNCT SCORE-OBJ,POINTS
	FSET PRSO,TOUCHBIT
	FCLEAR PRSO,NDESCBIT
	GETP PRSO,P?VALUE >POINTS
	ZERO? POINTS /FALSE
	GRTR? POINTS,0 \?L3
	INC 'ROBOT-EVILNESS
?L3:	PUTP PRSO,P?VALUE,0
	ADD SCORE,POINTS >SCORE
	RETURN SCORE

	.FUNCT IDROP
	EQUAL? PRSO,HANDS \?L1
	EQUAL? PRSA,V?GIVE,V?THROW,V?DROP \FALSE
	CALL IMPOSSIBLES >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?GIVE,V?DROP \?L6
	EQUAL? PRSO,LEASH \?L6
	ZERO? HANGING-IN-AIR \FALSE
?L6:	CALL ULTIMATELY-IN?,PRSO >STACK
	ZERO? STACK \?L7
	EQUAL? PRSA,V?THROW \?L8
	EQUAL? PRSO,SWITCH /FALSE
?L8:	EQUAL? PRSO,TONGUE,HANDS,ME \?L10
	CALL IMPOSSIBLES
	JUMP ?L12
?L10:	EQUAL? PRSA,V?PUT \?L11
	EQUAL? PRSO,ID-READER \?L11
	CALL ADJ-USED,A?ID,ID-READER >STACK
	ZERO? STACK /?L11
	GET P-NAMW,0 >STACK
	ZERO? STACK \?L11
	PRINT YOU-CANT
	PRINTI "see any ID card here!"
	CRLF
	JUMP ?L12
?L11:	PRINTI "That's easy for you to say since you don't even have"
	CALL TRPRINT,PRSO
?L12:	ZERO? P-MULT \TRUE
	RETURN 8
?L7:	IN? PRSO,PROTAGONIST /?L18
	LOC PRSO >STACK
	FSET? STACK,CONTBIT \?L18
	LOC PRSO >STACK
	FSET? STACK,OPENBIT /?L18
	LOC PRSO >STACK
	CALL DO-FIRST,STR?123,STACK >STACK
	RSTACK
?L18:	FSET? PRSO,WORNBIT \FALSE
	CALL DO-FIRST,STR?182,PRSO >STACK
	RSTACK

	.FUNCT CCOUNT,OBJ,CNT=0,X
	FIRST? OBJ >X \?L4
?L3:	FSET? X,WORNBIT /?L5
	INC 'CNT
?L5:	NEXT? X >X /?L3
?L4:	RETURN CNT

	.FUNCT WEIGHT,OBJ,CONT,WT=0
	FIRST? OBJ >CONT \?L4
?L3:	FSET? CONT,WORNBIT /?L5
	CALL WEIGHT,CONT >STACK
	ADD WT,STACK >WT
?L5:	NEXT? CONT >CONT /?L3
?L4:	EQUAL? OBJ,PROTAGONIST \?L13
	RETURN WT
?L13:	GETP OBJ,P?SIZE >STACK
	ADD WT,STACK >STACK
	RSTACK

	.FUNCT DESCRIBE-ROOM,VERB-IS-LOOK=0,FIRST-VISIT=0,POINTS
	GETP HERE,P?VALUE >POINTS
	ZERO? POINTS /?L1
	GRTR? POINTS,0 \?L1
	INC 'ROBOT-EVILNESS
	ADD SCORE,POINTS >SCORE
	PUTP HERE,P?VALUE,0
?L1:	ZERO? LIT \?L4
	PRINTI "It is pitch black. You "
	EQUAL? HERE,VACUUM-STORAGE \?L6
	PRINTI "try desperately to remember: 1. whether grues can survive in a vacuum and 2. whether they can tear through a space suit."
	CRLF
	RFALSE
?L6:	PRINTI "hope there are no grues aboard the station."
	CRLF
	RFALSE
?L4:	FSET? HERE,TOUCHBIT /?L9
	EQUAL? HERE,AIR-SHAFT /?L10
	FSET HERE,TOUCHBIT
?L10:	SET 'FIRST-VISIT,1
?L9:	PRINTD HERE
	ZERO? HANGING-IN-AIR /?L14
	PRINTI ", hanging in air"
	JUMP ?L16
?L14:	LOC PROTAGONIST >STACK
	FSET? STACK,VEHBIT \?L16
	PRINTI ", "
	LOC PROTAGONIST >STACK
	FSET? STACK,INBIT \?L17
	PRINTI "i"
	JUMP ?L19
?L17:	PRINTI "o"
?L19:	PRINTI "n"
	LOC PROTAGONIST >STACK
	CALL TPRINT,STACK
?L16:	CRLF
	ZERO? VERB-IS-LOOK \?L23
	EQUAL? VERBOSITY,2 /?L23
	ZERO? FIRST-VISIT /TRUE
	EQUAL? VERBOSITY,1 \TRUE
?L23:	PRINTI "   "
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-LOOK >STACK
	ZERO? STACK \?L24
	GETP HERE,P?LDESC >STACK
	PRINT STACK
?L24:	CRLF
	RTRUE

	.FUNCT DESCRIBE-OBJECTS,O,STR,1ST?=1,AV
	LOC WINNER >AV
	FIRST? HERE >O \FALSE
?L7:	CALL DESCRIBABLE?,O >STACK
	ZERO? STACK /?L9
	FSET? O,TOUCHBIT /?L9
	GETP O,P?FDESC >STR
	ZERO? STR /?L9
	PRINTI "   "
	PRINT STR
	FSET? O,CONTBIT \?L10
	CALL DESCRIBE-CONTENTS,O,1,3
?L10:	CRLF
?L9:	NEXT? O >O /?L7
	FIRST? HERE >O /?L15
?L15:	SET '1ST?,1
	ZERO? O /?L17
?L18:	CALL DESCRIBABLE?,O >STACK
	ZERO? STACK /?L26
	GETP O,P?FDESC >STACK
	ZERO? STACK /?L20
	FSET? O,TOUCHBIT \?L26
?L20:	GETP O,P?DESCFCN >STR
	ZERO? STR /?L22
	CALL STR,M-OBJDESC >STR
	ZERO? STR /?L22
	FSET? O,CONTBIT \?L23
	EQUAL? STR,M-FATAL /?L23
	CALL DESCRIBE-CONTENTS,O,1,3
?L23:	CRLF
	JUMP ?L26
?L22:	GETP O,P?LDESC >STR
	ZERO? STR /?L26
	PRINTI "   "
	PRINT STR
	FSET? O,CONTBIT \?L27
	CALL DESCRIBE-CONTENTS,O,1,3
?L27:	CRLF
?L26:	NEXT? O >O /?L18
?L17:	CALL DESCRIBE-CONTENTS,HERE,0,0
	ZERO? AV /FALSE
	EQUAL? HERE,AV /FALSE
	CALL DESCRIBE-CONTENTS,AV,0,0 >STACK
	RSTACK

	.FUNCT DESCRIBE-CONTENTS,OBJ,LEVEL=-1,ALL?=D-ALL?,F=0,N,1ST?=1,IT?=0,TWO?=0,START?=0,PARA?=0,DB
	EQUAL? LEVEL,2 \?L1
	SET 'LEVEL,1
	SET 'PARA?,1
	SET 'START?,1
	JUMP ?L3
?L1:	BTST ALL?,D-PARA? \?L3
	SET 'PARA?,1
?L3:	FIRST? OBJ >N /?L5
?L5:	ZERO? START? \?L10
	IN? OBJ,ROOMS /?L10
	FSET? OBJ,ACTORBIT /?L10
	ZERO? N /FALSE
	FSET? OBJ,CONTBIT \FALSE
	FSET? OBJ,OPENBIT /?L9
	FSET? OBJ,TRANSBIT \FALSE
?L9:	EQUAL? LEVEL,-1 /?L10
	FSET? OBJ,SEARCHBIT \FALSE
?L10:	ZERO? N /?L16
?L101:	CALL DESCRIBABLE?,N >STACK
	ZERO? STACK /?L13
	BTST ALL?,D-ALL? /?L16
	CALL SIMPLE-DESC?,N >STACK
	ZERO? STACK /?L13
?L16:	ZERO? F /?L52
	ZERO? 1ST? /?L19
	SET '1ST?,0
	EQUAL? LEVEL,0,1 \?L21
	ZERO? START? \?L36
	ZERO? PARA? \?L25
	EQUAL? OBJ,PROTAGONIST /?L27
	PRINTI "   "
?L27:	SET 'PARA?,1
	JUMP ?L30
?L25:	EQUAL? LEVEL,1 \?L30
	PRINTI " "
?L30:	CALL DESCRIBE-START,OBJ
	JUMP ?L36
?L21:	EQUAL? LEVEL,-1 /?L36
	PRINT LEVEL
	JUMP ?L36
?L19:	ZERO? N /?L35
	PRINTI ","
	JUMP ?L36
?L35:	PRINTI " and"
?L36:	CALL APRINT,F
	FSET? F,ONBIT \?L37
	PRINTI " (providing light)"
?L37:	EQUAL? F,DETONATOR \?L40
	ZERO? TIMER-CONNECTED \?L42
	ZERO? EXPLOSIVE-CONNECTED /?L40
?L42:	PRINTI " (connected to the "
	ZERO? TIMER-CONNECTED /?L43
	PRINTI "timer"
	ZERO? EXPLOSIVE-CONNECTED /?L48
	PRINTI " and the explosive"
	JUMP ?L48
?L43:	PRINTI "explosive"
?L48:	PRINTI ")"
?L40:	ZERO? IT? \?L50
	ZERO? TWO? \?L50
	SET 'IT?,F
	JUMP ?L52
?L50:	SET 'TWO?,1
	SET 'IT?,0
?L52:	SET 'F,N
?L13:	ZERO? N /?L57
	NEXT? N >N /?L57
?L57:	ZERO? F \?L10
	ZERO? N \?L101
	ZERO? IT? /?L61
	ZERO? TWO? \?L61
	CALL THIS-IS-IT,IT?
?L61:	ZERO? 1ST? /?L99
	ZERO? START? /?L64
	PRINTI " nothing"
	RFALSE
?L64:	ZERO? 1ST? \?L12
?L99:	EQUAL? LEVEL,0,1 \?L79
	EQUAL? OBJ,HERE \?L67
	FSET? HERE,WEIGHTLESSBIT \?L69
	EQUAL? HERE,PET-STORE /?L69
	PRINTI " floating"
?L69:	PRINTI " here"
?L67:	PRINTI "."
?L12:	EQUAL? LEVEL,0,1 \?L79
	FIRST? OBJ >F \?L79
?L80:	FSET? F,CONTBIT \?L82
	CALL DESCRIBABLE?,F,1 >STACK
	ZERO? STACK /?L82
	BTST ALL?,D-ALL? /?L83
	CALL SIMPLE-DESC?,F >STACK
	ZERO? STACK /?L82
?L83:	SET 'DB,D-BIT
	SET 'D-BIT,0
	ZERO? PARA? /?L86
	PUSH 3
	JUMP ?L88
?L86:	PUSH D-ALL?
?L88:	CALL DESCRIBE-CONTENTS,F,1,STACK >STACK
	ZERO? STACK /?L84
	SET '1ST?,0
	SET 'PARA?,1
?L84:	SET 'D-BIT,DB
?L82:	NEXT? F >F /?L80
?L79:	ZERO? 1ST? \FALSE
	EQUAL? LEVEL,0,1 \?L93
	LOC WINNER >STACK
	EQUAL? OBJ,HERE,STACK \?L93
	CRLF
?L93:	ZERO? 1ST? \FALSE
	RTRUE

	.FUNCT DESCRIBE-START,OBJ
	EQUAL? OBJ,HERE \?L1
	PRINT YOU-SEE
	RTRUE
?L1:	EQUAL? OBJ,PROTAGONIST \?L3
	EQUAL? D-BIT,WORNBIT \?L4
	PRINTI " You are wearing"
	RTRUE
?L4:	PRINTI "You are carrying"
	RTRUE
?L3:	FSET? OBJ,SURFACEBIT /?L8
	EQUAL? OBJ,PILOT-SEAT,COPILOT-SEAT \?L7
?L8:	PRINTI "Sitting on"
	CALL TPRINT,OBJ
	PRINTI " is"
	RTRUE
?L7:	PRINT IT-SEEMS-THAT
	CALL TPRINT,OBJ
	FSET? OBJ,ACTORBIT \?L10
	PRINTI " has"
	RTRUE
?L10:	PRINTI " contains"
	RTRUE

	.FUNCT DESCRIBABLE?,OBJ,CONT?=0
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? OBJ,WINNER /FALSE
	LOC WINNER >STACK
	EQUAL? OBJ,STACK \?L4
	LOC WINNER >STACK
	EQUAL? HERE,STACK \FALSE
?L4:	ZERO? CONT? \?L5
	FSET? OBJ,NDESCBIT /FALSE
?L5:	ZERO? D-BIT /TRUE
	GRTR? D-BIT,0 \?L7
	FSET? OBJ,D-BIT \FALSE
	RTRUE
?L7:	SUB 0,D-BIT >STACK
	FSET? OBJ,STACK /FALSE
	RTRUE

	.FUNCT SIMPLE-DESC?,OBJ,STR
	GETP OBJ,P?FDESC >STACK
	ZERO? STACK /?L1
	FSET? OBJ,TOUCHBIT \FALSE
?L1:	GETP OBJ,P?DESCFCN >STR
	ZERO? STR /?L3
	CALL STR,M-OBJDESC? >STACK
	ZERO? STACK \FALSE
?L3:	GETP OBJ,P?LDESC >STACK
	ZERO? STACK /TRUE
	RFALSE

	.FUNCT DESCRIBE-VEHICLE
	PRINTI "Other than yourself, you can see"
	CALL DESCRIBE-NOTHING >STACK
	ZERO? STACK \TRUE
	FSET? PRSO,INBIT \?L3
	PRINTI " in"
	JUMP ?L5
?L3:	PRINTI " on"
?L5:	CALL TRPRINT,PRSO
	RTRUE

	.FUNCT DESCRIBE-NOTHING
	CALL DESCRIBE-CONTENTS,PRSO,2 >STACK
	ZERO? STACK /FALSE
	IN? PROTAGONIST,PRSO /TRUE
	CRLF
	RTRUE

	.FUNCT GOTO,NEW-LOC,OLD-HERE
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-EXIT >STACK
	IN? FLOYD,HERE \?L1
	FSET? FLOYD,ACTIVEBIT \?L1
	SET 'FLOYD-FOLLOW,1
?L1:	SET 'OLD-HERE,HERE
	MOVE PROTAGONIST,NEW-LOC
	SET 'HERE,NEW-LOC
	CALL LIT?,HERE >LIT
	SET 'BALLOON-ODOR,0
	GETP HERE,P?ACTION >STACK
	CALL STACK,M-ENTER >STACK
	CALL DESCRIBE-ROOM >STACK
	ZERO? STACK /?L4
	ZERO? VERBOSITY /?L4
	CALL DESCRIBE-OBJECTS
?L4:	IN? OSTRICH,OLD-HERE \TRUE
	CALL ULTIMATELY-IN?,OSTRICH-NIP >STACK
	ZERO? STACK /TRUE
	CALL VISIBLE?,OSTRICH-NIP >STACK
	ZERO? STACK /TRUE
	EQUAL? HERE,TOP-OF-AIR-SHAFT /TRUE
	PRINTI "   The ostrich, sniffing excitedly, "
	CALL GLOBAL-IN?,BED,HERE >STACK
	ZERO? STACK /?L9
	PRINTR "follows you to the door, but hesitates as it notices the bed. The ostrich, who refuses to enter any room with a bed due to a bad experience in its youth, withdraws."
?L9:	LOC OSTRICH >STACK
	FSET? STACK,WEIGHTLESSBIT \?L11
	PRINTI "follows you in an awkward fashion somewhere between swimming and flying."
	JUMP ?L12
?L11:	PRINTI "trots eagerly after you."
?L12:	EQUAL? HERE,SOUTH-CONNECTION \?L16
	IN? OSTRICH,GRIMY-PASSAGE /?L15
?L16:	EQUAL? HERE,EAST-CONNECTION \?L17
	IN? OSTRICH,MAKESHIFT-CONNECTOR /?L15
?L17:	IN? OSTRICH,ELEVATOR \?L13
?L15:	ZERO? LIT /?L25
	PRINTI " As the ostrich crosses into gravity, it emits a surprised squawk and does a graceless bellyflop. As it struggles to its feet, it appears that only its dignity was injured."
	JUMP ?L25
?L13:	EQUAL? HERE,GRIMY-PASSAGE \?L23
	IN? OSTRICH,SOUTH-CONNECTION /?L22
?L23:	EQUAL? HERE,MAKESHIFT-CONNECTOR \?L24
	IN? OSTRICH,EAST-CONNECTION /?L22
?L24:	EQUAL? HERE,ELEVATOR \?L25
	FSET? ELEVATOR,WEIGHTLESSBIT \?L25
?L22:	ZERO? LIT /?L25
	PRINTI " As the ostrich unexpectly enters the weightless environment of the "
	EQUAL? HERE,ELEVATOR \?L27
	PRINTI "elevator"
	JUMP ?L29
?L27:	PRINTI "village"
?L29:	PRINTI ", it shoots into the air, squawking loudly. It spins head over claw for a moment, thrashing its wings ineffectually, before finally achieving a modicum of stability."
?L25:	MOVE OSTRICH,HERE
	CRLF
	RTRUE

	.FUNCT JIGS-UP,DESC
	PRINT DESC
	CRLF
	CRLF
	PRINTI "      ****  You have died  ****"
	CRLF
	CALL FINISH >STACK
	RSTACK

	.FUNCT ACCESSIBLE?,OBJ,L
	ZERO? OBJ /FALSE
	LOC OBJ >L
	FSET? OBJ,INVISIBLE /FALSE
	EQUAL? OBJ,PSEUDO-OBJECT \?L6
	EQUAL? LAST-PSEUDO-LOC,HERE \FALSE
	RTRUE
?L6:	ZERO? L /FALSE
	EQUAL? L,GLOBAL-OBJECTS /TRUE
	EQUAL? L,LOCAL-GLOBALS \?L12
	CALL GLOBAL-IN?,OBJ,HERE >STACK
	ZERO? STACK \TRUE
?L12:	CALL META-LOC,OBJ >STACK
	EQUAL? STACK,HERE \FALSE
	EQUAL? L,WINNER,HERE /TRUE
	FSET? L,OPENBIT \FALSE
	CALL ACCESSIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT VISIBLE?,OBJ,L
	ZERO? OBJ /FALSE
	LOC OBJ >L
	CALL ACCESSIBLE?,OBJ >STACK
	ZERO? STACK \TRUE
	CALL SEE-INSIDE?,L >STACK
	ZERO? STACK /FALSE
	CALL VISIBLE?,L >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT UNTOUCHABLE?,OBJ
	ZERO? OBJ /FALSE
	ZERO? HANGING-IN-AIR /?L3
	IN? OBJ,HERE \?L3
	EQUAL? OBJ,BALLOON,ETERNAL-FLAME,LEASH /FALSE
	EQUAL? OBJ,STAR \TRUE
	FSET? OBJ,TRYTAKEBIT \TRUE
	RFALSE
?L3:	IN? OBJ,STAR \?L8
	FSET? STAR,TRYTAKEBIT \?L8
	ZERO? HANGING-IN-AIR /TRUE
?L8:	EQUAL? OBJ,BALLOON,LEASH \?L9
	IN? OBJ,CAGE /TRUE
?L9:	EQUAL? OBJ,FLOYD,REX,HELEN \?L10
	EQUAL? OBJ,ROBOT-PICKED \TRUE
?L10:	IN? PROTAGONIST,HERE /FALSE
	LOC PROTAGONIST >STACK
	CALL ULTIMATELY-IN?,OBJ,STACK >STACK
	ZERO? STACK \?L13
	LOC PROTAGONIST >STACK
	EQUAL? OBJ,STACK /?L13
	LOC OBJ >STACK
	EQUAL? STACK,GLOBAL-OBJECTS,LOCAL-GLOBALS \?L12
?L13:	FSET? OBJ,DOORBIT \FALSE
	RTRUE
?L12:	LOC PROTAGONIST >STACK
	EQUAL? STACK,PILOT-SEAT,COPILOT-SEAT \TRUE
	EQUAL? OBJ,RADIO,KEYPAD,PSEUDO-OBJECT \TRUE
	RFALSE

	.FUNCT META-LOC,OBJ
?L1:	ZERO? OBJ /FALSE
	EQUAL? OBJ,BED \?L5
	RETURN HERE
?L5:	IN? OBJ,GLOBAL-OBJECTS \?L6
	RETURN GLOBAL-OBJECTS
?L6:	IN? OBJ,ROOMS \?L8
	RETURN OBJ
?L8:	LOC OBJ >OBJ
	JUMP ?L1

	.FUNCT OTHER-SIDE,DOBJ,P=0,TEE
?L1:	NEXTP HERE,P >P
	LESS? P,P?OUT /FALSE
	GETPT HERE,P >TEE
	PTSIZE TEE >STACK
	EQUAL? STACK,DEXIT \?L1
	GETB TEE,DEXITOBJ >STACK
	EQUAL? STACK,DOBJ \?L1
	RETURN P

	.FUNCT ULTIMATELY-IN?,OBJ,CONT=0
	ZERO? CONT \?L1
	SET 'CONT,WINNER
?L1:	ZERO? OBJ /FALSE
	IN? OBJ,CONT /TRUE
	IN? OBJ,ROOMS /FALSE
	LOC OBJ >STACK
	CALL ULTIMATELY-IN?,STACK,CONT >STACK
	RSTACK

	.FUNCT SEE-INSIDE?,OBJ
	ZERO? OBJ /FALSE
	FSET? OBJ,INVISIBLE /FALSE
	FSET? OBJ,TRANSBIT /TRUE
	FSET? OBJ,OPENBIT /TRUE
	RFALSE

	.FUNCT GLOBAL-IN?,OBJ1,OBJ2,TEE
	GETPT OBJ2,P?GLOBAL >TEE
	ZERO? TEE /FALSE
	PTSIZE TEE >STACK
	DEC 'STACK
	CALL ZMEMQB,OBJ1,TEE,STACK >STACK
	RSTACK

	.FUNCT FIND-IN,WHERE,FLAG-IN-QUESTION,STRING=0,OBJ,RECURSIVE-OBJ
	FIRST? WHERE >OBJ \FALSE
?L2:	FSET? OBJ,FLAG-IN-QUESTION \?L7
	FSET? OBJ,INVISIBLE /?L7
	ZERO? STRING /?L9
	PRINTI "["
	PRINT STRING
	CALL TPRINT,OBJ
	PRINTI "]"
	CRLF
?L9:	RETURN OBJ
?L7:	CALL FIND-IN,OBJ,FLAG-IN-QUESTION >RECURSIVE-OBJ
	ZERO? RECURSIVE-OBJ /?L12
	RETURN RECURSIVE-OBJ
?L12:	NEXT? OBJ >OBJ /?L2
	RFALSE

	.FUNCT NOW-DARK?
	ZERO? LIT /FALSE
	CALL LIT?,HERE >STACK
	ZERO? STACK \FALSE
	SET 'LIT,0
	ZERO? P-IT-OBJECT /?L3
	CALL ULTIMATELY-IN?,P-IT-OBJECT >STACK
	ZERO? STACK \?L3
	SET 'P-IT-OBJECT,0
?L3:	PRINTR "   It is now too dark to see."

	.FUNCT NOW-LIT?
	ZERO? LIT \FALSE
	CALL LIT?,HERE >STACK
	ZERO? STACK /FALSE
	SET 'LIT,1
	CRLF
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT LOC-CLOSED,L
	LOC PRSO >L
	FSET? L,CONTBIT \FALSE
	FSET? L,OPENBIT /FALSE
	FSET? PRSO,TAKEBIT \FALSE
	CALL DO-FIRST,STR?123,L >STACK
	RSTACK

	.FUNCT DO-WALK,DIR
	SET 'P-WALK-DIR,DIR
	CALL PERFORM,V?WALK,DIR >STACK
	RSTACK

	.FUNCT STOP
	SET 'P-CONT,0
	SET 'QUOTE-FLAG,0
	RETURN 8

	.FUNCT ROB,WHO,WHERE=0,N,X
	FIRST? WHO >X /?L4
	RTRUE
?L1:	ZERO? X /TRUE
?L4:	NEXT? X >N /?L7
?L7:	FSET? X,WORNBIT /?L12
	ZERO? WHERE /?L10
	MOVE X,WHERE
	JUMP ?L12
?L10:	REMOVE X
?L12:	SET 'X,N
	JUMP ?L1

	.FUNCT HACK-HACK,STR
	PRINT STR
	CALL TPRINT-PRSO
	CALL HO-HUM >STACK
	RSTACK

	.FUNCT HO-HUM
	CALL PICK-ONE,HO-HUM-LIST >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT YUKS
	CALL PICK-ONE,YUK-LIST >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT IMPOSSIBLES
	CALL PICK-ONE,IMPOSSIBLE-LIST >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT WASTES
	CALL PICK-ONE,WASTE-LIST >STACK
	PRINT STACK
	CRLF
	RTRUE

	.FUNCT I-WELDER
	IN? WELDER,HERE \?L1
	PRINTI "   "
	INC 'WELDER-COUNTER
	ZERO? LIT \?L3
	REMOVE WELDER
	SET 'WELDER-COUNTER,0
	PRINTI "Y"
	PRINT HEAR-WELDER-LEAVE
	RTRUE
?L3:	EQUAL? WELDER-COUNTER,2 \?L5
	PRINTI "The welder moves closer. "
	JUMP ?L6
?L5:	EQUAL? WELDER-COUNTER,3 /?L6
	CALL PRINT-ID,STR?183
	CALL JIGS-UP,STR?184
?L6:	CALL PERFORM,V?EXAMINE,WELDER >STACK
	RSTACK
?L1:	GRTR? WELDER-COUNTER,0 \?L8
	REMOVE WELDER
	SET 'WELDER-COUNTER,0
	PRINTI "   Nearby, y"
	PRINT HEAR-WELDER-LEAVE
	RTRUE
?L8:	FSET? HERE,NWELDERBIT /FALSE
	IN? PROTAGONIST,BED /FALSE
	ZERO? LIT /FALSE
	RANDOM 100 >STACK
	LESS? NUMBER-OF-WELDERS,STACK /FALSE
	ZERO? STUNNED \FALSE
	EQUAL? HERE,SPACETRUCK \?L12
	FSET? SPACETRUCK-HATCH,OPENBIT \FALSE
?L12:	MOVE WELDER,HERE
	INC 'WELDER-COUNTER
	RANDOM NUMBER-OF-WELDERS >WELDER-TABLE-POINTER
	PRINTI "   You spot a "
	PRINTD WELDER
	PRINTI " approaching. "
	FSET? WELDER,TOUCHBIT /?L14
	FSET WELDER,TOUCHBIT
	CALL PERFORM,V?WHAT,WELDER
?L14:	CALL PERFORM,V?EXAMINE,WELDER
	CALL STOP >STACK
	RSTACK

	.FUNCT I-HEADLAMP
	FSET? HEADLAMP,ONBIT \?L1
	DEC 'HEADLAMP-COUNTER
	ZERO? HEADLAMP-COUNTER \?L3
	FCLEAR HEADLAMP,ACTIVEBIT
	FCLEAR HEADLAMP,ONBIT
?L3:	CALL VISIBLE?,HEADLAMP >STACK
	ZERO? STACK /FALSE
	EQUAL? HEADLAMP-COUNTER,0,15,30 \FALSE
	PRINTI "   The light from the headlamp "
	ZERO? HEADLAMP-COUNTER \?L8
	PRINTI "flickers and dies!"
	CRLF
	CALL NOW-DARK? >STACK
	RSTACK
?L8:	EQUAL? HEADLAMP-COUNTER,5 \?L10
	PRINTR "is almost out!"
?L10:	PRINTR "seems somewhat dimmer."
?L1:	CALL DEQUEUE,I-HEADLAMP >STACK
	RSTACK

	.FUNCT I-PLATINUM-DETECTOR,?TMP
	INC 'DETECTOR-COUNTER
	CALL VISIBLE?,PLATINUM-DETECTOR >STACK
	ZERO? STACK /?L1
	CALL META-LOC,FOIL >?TMP
	CALL META-LOC,PLATINUM-DETECTOR >STACK
	EQUAL? ?TMP,STACK /?L3
	CALL ULTIMATELY-IN?,PLATINUM-DETECTOR,BARBERSHOP >STACK
	ZERO? STACK /?L1
	ZERO? MIRROR-BROKEN \?L1
?L3:	PRINTI "   The detector is quietly beeping."
	CRLF
?L1:	EQUAL? DETECTOR-COUNTER,50,75 \?L5
	IN? PLATINUM-DETECTOR,PROTAGONIST \?L5
	PRINTI "   You notice that the detector is getting "
	EQUAL? DETECTOR-COUNTER,75 \?L7
	PRINTI "very "
?L7:	PRINTR "warm."
?L5:	EQUAL? DETECTOR-COUNTER,100 \FALSE
	IN? PLATINUM-DETECTOR,PROTAGONIST \FALSE
	MOVE PLATINUM-DETECTOR,HERE
	PRINTI "   Yeow! The detector is now too hot to handle, so you drop it."
	CRLF
	CALL PRINT-ID,STR?185 >STACK
	RSTACK

	.FUNCT I-DRYER
	INC 'DRYER-COUNTER
	FCLEAR LAUNDRY,TOUCHBIT
	EQUAL? HERE,LAUNDRY \FALSE
	EQUAL? DRYER-COUNTER,5,10,15 \FALSE
	PRINTI "   "
	CALL DESCRIBE-DRYER-HEAT
	CRLF
	RTRUE

	.FUNCT I-RADIO
	EQUAL? HERE,SPACETRUCK \FALSE
	RANDOM 100 >STACK
	LESS? 30,STACK /?L3
	PRINTI "   The radio crackles to life. ""Breaker. "
	CALL PICK-ONE,RADIO-LINES >STACK
	PRINT STACK
	PRINTR " Over."""
?L3:	RANDOM 100 >STACK
	LESS? 20,STACK /FALSE
	PRINTR "   A country and western station drifts into tune for a moment, but then fades again."

	.FUNCT I-FLOYD,OBJ=0,?TMP
	CALL QUEUE,I-FLOYD,-1
	FSET? FLOYD,TOUCHBIT /?L1
	FSET FLOYD,TOUCHBIT
	FSET FLOYD,TRYTAKEBIT
	PRINTI "   The third robot looks up from his marbles, jumps to his feet, and starts waving wildly. It's Floyd, your robotic companion from Resida! (Footnote 3) You've seen him only occasionally since he opted for assignment in the Stellar Patrol those five long years ago."
	CRLF
	JUMP ?L98
?L1:	ZERO? ROBOT-PICKED \?L3
	PRINTI "   Floyd jumps up and down saying, ""Oh boy oh boy oh boy pick Floyd pick Floyd pick Floyd!"""
	CRLF
	JUMP ?L98
?L3:	ZERO? FLOYD-ANGUISHED /?L4
	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK \?L5
	SET 'FLOYD-ANGUISHED,0
?L5:	SET 'FLOYD-FOLLOW,0
	RFALSE
?L4:	CALL VISIBLE?,FLOYD >STACK
	ZERO? STACK /?L8
	FSET? FLOYD,ACTIVEBIT \FALSE
	LOC FLOYD >STACK
	EQUAL? STACK,PILOT-SEAT,COPILOT-SEAT \?L12
	GRTR? SPACETRUCK-COUNTER,0 \?L12
	ZERO? PILOT-SEAT-COMMENT \?L12
	SET 'PILOT-SEAT-COMMENT,1
	PRINTI "   Floyd strains to see over the top of the dashboard. ""Boy, seats low! Floyd could sure use a phone book!"""
	CRLF
	JUMP ?L98
?L12:	IN? OSTRICH,HERE \?L14
	ZERO? OSTRICH-COMMENT \?L14
	SET 'OSTRICH-COMMENT,1
	PRINTI "   Floyd looks at the ostrich with breathless excitement. ""Wow! An elephant!"""
	CRLF
	JUMP ?L98
?L14:	IN? BALLOON,HERE \?L15
	ZERO? BALLOON-COMMENT \?L15
	ZERO? HANGING-IN-AIR \?L15
	GRTR? ROBOT-EVILNESS,13 \?L15
	SET 'BALLOON-COMMENT,1
	PRINTI "   You notice Floyd taunting the "
	PRINTD BALLOON
	PRINTI ". The frightened balloon takes refuge in the far corner of the room."
	CRLF
	JUMP ?L98
?L15:	FSET? HERE,FLOYDBIT /?L18
	ZERO? FLOYD-SPOKE \?L18
	RANDOM 100 >STACK
	LESS? 6,STACK \?L17
?L18:	GRTR? TIMER-SETTING,0 \?L16
	CALL VISIBLE?,EXPLOSIVE >STACK
	ZERO? STACK /?L16
?L17:	REMOVE FLOYD
	PRINTI "   "
	IN? PLATO,HERE \?L19
	SET 'POSTPONE-ATTACK,1
	REMOVE PLATO
	GRTR? ROBOT-EVILNESS,8 \?L21
	PRINTI """Let us take a stroll, Floyd,"" says Plato, tucking his book under one arm. ""Tagging along after this simpleton human is becoming tiresome."" He breezes out. Floyd hesitates, then follows."
	CRLF
	JUMP ?L98
?L21:	RANDOM 100 >STACK
	LESS? 50,STACK \?L24
	EQUAL? HERE,LIBRARY \?L23
?L24:	PRINTI """Hey, Plato!"" says Floyd. ""Play Hider-and-Seeker with Floyd?"" Plato glances up from his book, nods, and says, ""I do believe that I can spare a few millichrons for a relaxing bit of sport."" Floyd bounds away, with Plato a bit behind. From out of sight, Floyd's voice faintly echoes back to you: ""Ollie ollie oxen free!"""
	CRLF
	JUMP ?L98
?L23:	PRINTI "Plato reaches the last page of his book. ""Heavens! It appears to be time for another jaunt to the library. Would you care to accompany me, my boisterous friend?""
   ""Oh boy yessiree!"" says Floyd, bounding off after Plato. ""I hope they have copies of my favorite comic, THE ADVENTURES OF LANE MASTODON!"""
	CRLF
	JUMP ?L98
?L19:	PRINTI "Floyd says, ""Floyd going exploring. See you later."" He glides out of the room."
	CRLF
	JUMP ?L98
?L16:	RANDOM 100 >STACK
	LESS? 45,STACK /?L98
	ZERO? FLOYD-SPOKE \?L98
	IN? FLOYD,HERE \?L98
	IN? PROTAGONIST,HERE \?L98
	ZERO? HANGING-IN-AIR \?L98
	ZERO? LIT /?L98
	FIRST? HERE >OBJ \?L29
	FSET? OBJ,TOUCHBIT \?L29
	FSET? OBJ,TAKEBIT \?L29
	FSET? OBJ,CONTBIT /?L29
	EQUAL? OBJ,OSTRICH-NIP,SPACESUIT,DETONATOR /?L29
	EQUAL? OBJ,TIMER,EXPLOSIVE /?L29
	CALL CCOUNT,FLOYD >STACK
	LESS? STACK,4 \?L29
	RANDOM 100 >STACK
	LESS? 6,STACK /?L29
	MOVE OBJ,FLOYD
	PRINTI "   Floyd picks up"
	CALL TPRINT,OBJ
	PRINTI ", examines it, and tucks "
	FSET? OBJ,PLURALBIT \?L31
	PRINTI "them"
	JUMP ?L33
?L31:	PRINTI "it"
?L33:	PRINTI " under his arm."
	CRLF
	JUMP ?L98
?L29:	FIRST? FLOYD >STACK \?L40
	RANDOM 100 >STACK
	LESS? 6,STACK /?L34
	FIRST? FLOYD >OBJ /?L35
?L35:	NEXT? OBJ >STACK \?L38
	RANDOM 100 >STACK
	LESS? 60,STACK /?L38
	NEXT? OBJ >OBJ /?L38
?L38:	MOVE OBJ,HERE
	PRINTI "   Floyd drops"
	CALL TPRINT,OBJ
	PRINTI " he was carrying."
	CRLF
	JUMP ?L98
?L34:	FIRST? FLOYD >STACK \?L40
	RANDOM 100 >STACK
	LESS? 4,STACK /?L40
	FIRST? FLOYD >OBJ /?L41
?L41:	NEXT? OBJ >STACK \?L44
	RANDOM 100 >STACK
	LESS? 60,STACK /?L44
	NEXT? OBJ >OBJ /?L44
?L44:	PRINTI "   Floyd moves"
	CALL TPRINT,OBJ
	PRINTI " in a wavering course through the air, making a roaring noise like a rocket exhaust."
	CRLF
	JUMP ?L98
?L40:	IN? PLATO,HERE \?L46
	RANDOM 100 >STACK
	LESS? 70,STACK /?L46
	PRINTI "   "
	CALL PICK-ONE,PLATOISMS >STACK
	PRINT STACK
	PRINT PERIOD-CR
	JUMP ?L98
?L46:	PRINTI "   Floyd "
	MUL ROBOT-EVILNESS,3 >STACK
	SUB 36,STACK >?TMP
	RANDOM 100 >STACK
	LESS? ?TMP,STACK /?L48
	CALL PICK-ONE,GOOD-FLOYDISMS >STACK
	PRINT STACK
	PRINT PERIOD-CR
	JUMP ?L98
?L48:	MUL ROBOT-EVILNESS,25 >STACK
	SUB STACK,300 >?TMP
	RANDOM 100 >STACK
	LESS? ?TMP,STACK /?L50
	CALL PICK-ONE,BAD-FLOYDISMS >STACK
	PRINT STACK
	PRINT PERIOD-CR
	JUMP ?L98
?L50:	RANDOM 100 >STACK
	LESS? 6,STACK /?L51
	SET 'AWAITING-REPLY,4
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTI "says, ""Hey! Wanna play Hucka-Bucka-Beanstalk?"""
	CRLF
	JUMP ?L98
?L51:	CALL PICK-ONE,NEUTRAL-FLOYDISMS >STACK
	PRINT STACK
	PRINT PERIOD-CR
	JUMP ?L98
?L8:	FSET? FLOYD,ACTIVEBIT /?L54
	EQUAL? HERE,VACUUM-STORAGE,AIRLOCK /FALSE
	LESS? SPACETRUCK-COUNTER,5 /FALSE
	CALL NEXT-ROOM?,FLOYD >STACK
	ZERO? STACK \FALSE
	FSET FLOYD,ACTIVEBIT
	FSET FLOYD,ACTORBIT
	PRINTI "   Floyd bounds up to you"
	PRINT HOPPING-MAD
	ZERO? PLATO-INTRODUCED /?L60
	PRINTI " Plato strolls in and gives Floyd a pat. ""I reactivated the little fellow; I hope you don't mind."""
	CRLF
	JUMP ?L62
?L60:	PRINTI " Another robot wanders in behind Floyd and notices you."
	CRLF
	CALL I-PLATO,1
	PRINTI "   Plato motions toward Floyd. ""I presume you know this playful little fellow. Someone had deactivated him, so I rectified the situation."""
	CRLF
?L62:	MOVE PLATO,HERE
	MOVE FLOYD,HERE
	JUMP ?L98
?L54:	GRTR? ROBOT-EVILNESS,17 \?L63
	LOC FLOYD >STACK
	ZERO? STACK /?L64
	LOC FLOYD >STACK
	FSET? STACK,NWELDERBIT \?L64
	CALL NEXT-ROOM?,FLOYD >STACK
	ZERO? STACK \FALSE
?L64:	CALL MOVE-FLOYD-TO-FACTORY
	RFALSE
?L63:	ZERO? FLOYD-FOLLOW /?L74
	EQUAL? HERE,AIRLOCK \?L67
	PRINTI "   Floyd calls from above, """
	ZERO? PLATO-INTRODUCED /?L68
	ZERO? PLATO-ATTACK-COUNTER \?L68
	PRINTI "We"
	JUMP ?L70
?L68:	PRINTI "I"
?L70:	PRINTI "'ll wait here; it doesn't look like there's room in that phone booth for "
	ZERO? PLATO-INTRODUCED /?L71
	ZERO? PLATO-ATTACK-COUNTER \?L71
	PRINTI "all"
	JUMP ?L73
?L71:	PRINTI "both"
?L73:	PRINTI " of us."""
	CRLF
	JUMP ?L98
?L67:	ZERO? FLOYD-FOLLOW /?L74
	ZERO? TIMER-SETTING /?L75
	CALL VISIBLE?,EXPLOSIVE >STACK
	ZERO? STACK \?L74
?L75:	RANDOM 100 >STACK
	LESS? 80,STACK /?L74
	PRINTI "   Floyd "
	ZERO? PLATO-INTRODUCED /?L76
	ZERO? PLATO-ATTACK-COUNTER \?L76
	MOVE PLATO,HERE
	PRINTI "and Plato follow"
	JUMP ?L78
?L76:	PRINTI "follows"
?L78:	MOVE FLOYD,HERE
	PRINTI " you."
	CRLF
	JUMP ?L98
?L74:	EQUAL? HERE,SPACETRUCK,ELEVATOR,BRIG /?L80
	EQUAL? HERE,ARMORY \?L79
?L80:	PRINTI "   Floyd bounces in"
	ZERO? PLATO-INTRODUCED /?L81
	ZERO? PLATO-ATTACK-COUNTER \?L81
	MOVE PLATO,HERE
	PRINTI ", followed at a more leisurely pace by Plato"
?L81:	PRINTI ". ""Hey, wait for "
	ZERO? PLATO-INTRODUCED /?L84
	ZERO? PLATO-ATTACK-COUNTER \?L84
	MOVE PLATO,HERE
	PRINTI "us"
	JUMP ?L86
?L84:	PRINTI "Floyd"
?L86:	MOVE FLOYD,HERE
	PRINTI "!"" he yells."
	CRLF
	JUMP ?L98
?L79:	RANDOM 100 >STACK
	LESS? 17,STACK /?L98
	ZERO? LIT /?L98
	EQUAL? HERE,AIRLOCK,VACUUM-STORAGE /?L98
	PRINTI "   Floyd "
	ZERO? PLATO-INTRODUCED \?L88
	FSET? LEVEL-FIVE,TOUCHBIT \?L88
	RANDOM 100 >STACK
	LESS? 50,STACK /?L88
	PRINTI "dashes into view, followed by a slightly older-looking robot. ""Look, Floyd found a new friend,"" Floyd says with unbounded exuberance."
	CRLF
	CALL I-PLATO,1
	JUMP ?L90
?L88:	MUL ROBOT-EVILNESS,10 >STACK
	SUB STACK,70 >?TMP
	RANDOM 100 >STACK
	LESS? ?TMP,STACK /?L91
	PRINTI "meanders in. ""You doing anything fun?"" he asks, and then answers his own question, ""Nope. Same dumb boring things."""
	JUMP ?L94
?L91:	RANDOM 100 >STACK
	LESS? 15,STACK /?L93
	PRINTI "rushes into the room and barrels into you. ""Oops, sorry,"" he says. ""Floyd not looking at where he was going to."""
	JUMP ?L94
?L93:	PRINTI "bounds into the room. ""Floyd here now!"" he cries."
?L94:	ZERO? PLATO-INTRODUCED /?L95
	ZERO? PLATO-ATTACK-COUNTER \?L95
	MOVE PLATO,HERE
	PRINTI " You notice that Plato has also roamed into view behind Floyd, once again absorbed in his reading."
?L95:	CRLF
?L90:	MOVE FLOYD,HERE
	ZERO? HANGING-IN-AIR /?L98
	ZERO? HANGING-COMMENT \?L98
	SET 'FLOYD-SPOKE,1
	SET 'HANGING-COMMENT,1
	PRINT FLOYDS-HANGING-IN-AIR-COMMENT
?L98:	SET 'FLOYD-SPOKE,0
	SET 'FLOYD-FOLLOW,0
	RETURN FLOYD-FOLLOW

	.FUNCT I-EXPLOSIVE-MELT,OLD-MELT-COUNTER
	SET 'OLD-MELT-COUNTER,MELT-COUNTER
	IN? EXPLOSIVE,THERMOS \?L1
	FSET? THERMOS,OPENBIT /?L1
	DIV C-ELAPSED,4 >STACK
	JUMP ?L3
?L1:	PUSH C-ELAPSED
?L3:	ADD MELT-COUNTER,STACK >MELT-COUNTER
	GRTR? MELT-COUNTER,210 \?L4
	CALL VISIBLE?,EXPLOSIVE >STACK
	ZERO? STACK /?L6
	PRINTI "   The explosive "
	PRINT SUBLIMES-INTO-FREZONE
	CALL DEQUEUE,I-EXPLOSIVE-MELT
	CALL REMOVE-CAREFULLY,EXPLOSIVE
	CRLF
	RTRUE
?L6:	CALL REMOVE-CAREFULLY,EXPLOSIVE >STACK
	RSTACK
?L4:	CALL VISIBLE?,EXPLOSIVE >STACK
	ZERO? STACK /FALSE
	ZERO? LIT /FALSE
	GRTR? MELT-COUNTER,170 \?L10
	GRTR? OLD-MELT-COUNTER,170 /?L10
	PRINTI "  "
	CALL DESCRIBE-EXPLOSIVE >STACK
	RSTACK
?L10:	GRTR? MELT-COUNTER,130 \FALSE
	GRTR? OLD-MELT-COUNTER,130 /FALSE
	PRINTI "  "
	CALL DESCRIBE-EXPLOSIVE >STACK
	RSTACK

	.FUNCT I-TIMER
	CALL QUEUE,I-TIMER,-1
	SUB TIMER-SETTING,C-ELAPSED >TIMER-SETTING
	LESS? TIMER-SETTING,1 \?L1
	CALL DEQUEUE,I-TIMER
	SET 'TIMER-SETTING,0
?L1:	CALL VISIBLE?,TIMER >STACK
	ZERO? STACK /?L4
	PRINTI "   The timer reaches "
	PRINTN TIMER-SETTING
	ZERO? TIMER-SETTING \?L6
	PRINTI " and stops ticking"
?L6:	PRINTI "."
?L4:	ZERO? TIMER-SETTING \?L28
	ZERO? TIMER-CONNECTED /?L28
	LOC DIODE-J >STACK
	LOC DIODE-M >STACK
	EQUAL? DETONATOR,STACK,STACK \?L28
	IN? DIODE-J,DETONATOR \?L12
	MOVE DIODE-J,LOCAL-GLOBALS
	CALL VISIBLE?,DETONATOR >STACK
	ZERO? STACK /?L28
	PRINTI " You hear a sizzling sound from the detonator"
	FSET? SPACESUIT,WORNBIT /?L16
	PRINTI ", and a burnt odor assaults your nose"
?L16:	PRINTI "."
	JUMP ?L28
?L12:	ZERO? EXPLOSIVE-CONNECTED /?L20
	CALL META-LOC,EXPLOSIVE >STACK
	EQUAL? STACK,HERE \?L21
	PRINTI " The explosive fulfills its destiny by exploding. You simultaneously fulfill your own destiny: turning into itsy-bitsy pieces of "
	PRINT LFC
	CALL PRINT-ID,STR?186
	CALL JIGS-UP,STR?90
	JUMP ?L24
?L21:	IN? EXPLOSIVE,DRILLED-HOLE \?L23
	RANDOM 200 >STACK
	ADD STACK,20 >STACK
	CALL QUEUE,I-LIGHTS-OUT,STACK
	FSET SAFE,OPENBIT
	FSET SAFE,TOUCHBIT
	FCLEAR SAFE,LOCKEDBIT
	JUMP ?L24
?L23:	CALL DESTROY-EXPLOSIVE-CONT
?L24:	CALL NEXT-ROOM?,TIMER >STACK
	ZERO? STACK /?L25
	PRINTI "   You hear a deafening explosion from very nearby!"
	CRLF
	CALL PRINT-ID,STR?187
	JUMP ?L27
?L25:	PRINTI "   You hear a loud but distant explosion."
	CRLF
?L27:	REMOVE TIMER
	REMOVE EXPLOSIVE
	REMOVE DETONATOR
	JUMP ?L28
?L20:	CALL VISIBLE?,TIMER >STACK
	ZERO? STACK /?L28
	PRINTI " You hear a click from the detonator."
?L28:	CALL VISIBLE?,TIMER >STACK
	ZERO? STACK /FALSE
	CRLF
	RTRUE

	.FUNCT I-LOG-READER
	INC 'LOG-READER-COUNTER
	FSET? LOG-READER,ACTIVEBIT /?L1
	CALL DEQUEUE,I-LOG-READER
	SET 'LOG-READER-COUNTER,0
	RETURN LOG-READER-COUNTER
?L1:	EQUAL? LOG-READER-COUNTER,12 \?L3
	EQUAL? HERE,COMMANDERS-OFFICE \?L3
	PRINTR "   The reader begins producing a whining noise."
?L3:	EQUAL? LOG-READER-COUNTER,13 \?L4
	EQUAL? HERE,COMMANDERS-OFFICE \?L4
	PRINTI "   The whine from the "
	PRINTD LOG-READER
	PRINTR " rises in pitch, and grows louder by the millichron!"
?L4:	EQUAL? LOG-READER-COUNTER,14 \FALSE
	REMOVE LOG-READER
	CALL DEQUEUE,I-LOG-READER
	FCLEAR COMMANDERS-OFFICE,TOUCHBIT
	EQUAL? HERE,COMMANDERS-OFFICE \?L6
	CALL PRINT-ID,STR?188
	CALL JIGS-UP,STR?189 >STACK
	RSTACK
?L6:	EQUAL? HERE,COMMANDERS-QUARTERS,BRIEFING-ROOM,STATION-CONTROL /?L9
	EQUAL? HERE,SOUTH-JUNCTION \FALSE
?L9:	PRINTR "   You hear an explosion from nearby."

	.FUNCT FAKE-DOOR-ENTER-F
	PRINTI "The door is closed."
	CRLF
	RFALSE

	.FUNCT FAKE-DOOR-F
	EQUAL? PRSA,V?OPEN \?L1
	CALL RECORDING,STR?190 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "There's a slot next to the closed door."
?L3:	EQUAL? PRSA,V?ENTER \FALSE
	CALL DO-WALK,P?WEST >STACK
	RSTACK

	.FUNCT FORM-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	PRINTI "[This form can be found in your STATIONFALL package.]"
	EQUAL? PRSO,ASSIGNMENT-COMPLETION-FORM \?L3
	PRINTI " You notice that it has "
	ZERO? ASSIGNMENT-FORM-VALIDATED \?L5
	PRINTI "not "
?L5:	PRINTI "been validated."
?L3:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?VALIDATE \?L9
	ZERO? ASSIGNMENT-FORM-VALIDATED /?L10
	PRINT SENILITY-STRIKES
	RTRUE
?L10:	SET 'ASSIGNMENT-FORM-VALIDATED,1
	PRINTR "Done."
?L9:	EQUAL? PRSA,V?MUNG,V?CRUMPLE \FALSE
	PRINT VIOLATION-OF-ACT
	CALL PRINT-ID,STR?191 >STACK
	RSTACK

	.FUNCT CHRONOMETER-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	GRTR? DAY,2 \?L3
	PRINTI "You glance at your "
	PRINTD CHRONOMETER
	PRINTR ", and realize with annoyance that it has stopped. You can't recall doing anything that might have broken it."
?L3:	PRINTI "It is a standard wrist "
	PRINTD CHRONOMETER
	PRINTI " with a digital display. "
	CALL V-TIME,1
	PRINTR " The back is engraved with the message ""Good luck in the Patrol! Love, Mom and Dad."""

	.FUNCT PATROL-UNIFORM-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It is a standard-issue one-pocket Stellar "
	PRINTD PATROL-UNIFORM
	PRINTI ", a miracle of modern technology. It will keep its owner warm in cold climates and cool in warm locales. It provides protection against mild radiation, repels all insects, absorbs sweat, promotes healthy skin tone, and on top of everything else, it is super-comfy"
	ZERO? SUIT-PRESSED /?L3
	PRINTI ". The uniform has been recently pressed"
?L3:	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTI "There's no way to open or close the pocket of the "
	PRINTD PRSO
	PRINT PERIOD-CR
	RTRUE

	.FUNCT I-BLATHER
	EQUAL? HERE,SPACETRUCK \?L1
	CALL DEQUEUE,I-BLATHER >STACK
	RSTACK
?L1:	RANDOM 100 >STACK
	LESS? BLATHER-PROB,STACK /?L3
	CALL DEQUEUE,I-BLATHER
	PRINTR "   Ensign Twelfth Class Blather walks by, lugging his toilet scrubbing supplies. He spots you, whimpers, and slouches away (Footnote 2)."
?L3:	ADD BLATHER-PROB,10 >BLATHER-PROB
	RETURN BLATHER-PROB

	.FUNCT BOXED-FORMS-F
	EQUAL? PRSA,V?EXAMINE /?L3
	CALL TOUCHING?,PSEUDO-OBJECT >STACK
	ZERO? STACK /?L1
?L3:	PRINTR "The forms are sealed inside the boxes."
?L1:	EQUAL? PRSA,V?MUNG,V?CRUMPLE \FALSE
	PRINT VIOLATION-OF-ACT
	CALL PRINT-ID,STR?192 >STACK
	RSTACK

	.FUNCT PALLETS-F,CNT
	EQUAL? PRSA,V?READ \?L1
	EQUAL? HERE,FORM-STORAGE-ROOM \?L3
	PRINTR "There are numerous boxes; some of the nearer ones read: ""Form Pallet Disbursal Form,"" ""Loss of Form Pallet Label Report Form,"" and ""Loss of Form Pallet Label Report Form Release Form."""
?L3:	PRINTI """"
	PRINT FORM-NAME
	PRINTR "."""
?L1:	EQUAL? PRSA,V?SEARCH,V?LOOK-INSIDE,V?OPEN \?L6
	PRINTI "Forms"
	SET 'CNT,0
?L7:	EQUAL? CNT,50 /?L8
	PRINTI " and forms"
	INC 'CNT
	JUMP ?L7
?L8:	PRINTR ". Horrified, you reseal the box."
?L6:	EQUAL? PRSA,V?CLOSE \?L12
	PRINTR "They already are."
?L12:	EQUAL? PRSA,V?TAKE \?L13
	PRINTR "You'll need a forklift."
?L13:	EQUAL? PRSA,V?MUNG,V?STAND-ON,V?CLIMB-ON /?L15
	EQUAL? PRSA,V?SHOOT \?L14
?L15:	PRINT VIOLATION-OF-ACT
	CALL PRINT-ID,STR?193 >STACK
	RSTACK
?L14:	EQUAL? PRSA,V?COUNT \FALSE
	EQUAL? HERE,FORM-STORAGE-ROOM \?L17
	PRINTR "Countless."
?L17:	CALL NOUN-USED,W?PALLET,PALLETS >STACK
	ZERO? STACK /?L19
	PRINTR "24."
?L19:	CALL NOUN-USED,W?BOXES,PALLETS >STACK
	ZERO? STACK /FALSE
	SET 'C-ELAPSED,30
	PRINTR "1920."

	.FUNCT ROBOT-POOL-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-FLOYD,STACK >STACK
	RSTACK
?L1:	EQUAL? RARG,M-LOOK \?L3
	PRINTI "This is where a "
	PRINT LFC
	PRINTI " would come to obtain a robot for use on an important assignment. Also for a trivial assignment like yours. "
	PRINT ROBOT-POOL-EQUIPMENT-DESC
	PRINTI " You can exit aft."
	RTRUE
?L3:	EQUAL? RARG,M-EXIT \FALSE
	EQUAL? ROBOT-PICKED,FLOYD /FALSE
	CALL DEQUEUE,I-FLOYD >STACK
	RSTACK

	.FUNCT BIN-F
	GET P-ADJW,0 >STACK
	ZERO? STACK \?L4
	EQUAL? PRSO,PSEUDO-OBJECT /?L3
?L4:	GET P-ADJW,1 >STACK
	ZERO? STACK \?L1
	EQUAL? PRSI,PSEUDO-OBJECT \?L1
?L3:	PRINT REFER-TO-BIN
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L5
	CALL ADJ-USED,A?FIRST,PSEUDO-OBJECT >STACK
	ZERO? STACK /?L6
	EQUAL? ROBOT-PICKED,REX /?L6
	GETP REX,P?FDESC >STACK
	PRINT STACK
	CRLF
	RTRUE
?L6:	CALL ADJ-USED,A?SECOND,PSEUDO-OBJECT >STACK
	ZERO? STACK /?L8
	EQUAL? ROBOT-PICKED,HELEN /?L8
	GETP HELEN,P?FDESC >STACK
	PRINT STACK
	CRLF
	RTRUE
?L8:	CALL ADJ-USED,A?THIRD,PSEUDO-OBJECT >STACK
	ZERO? STACK /?L9
	EQUAL? ROBOT-PICKED,FLOYD /?L9
	CALL PERFORM,V?EXAMINE,FLOYD
	RTRUE
?L9:	PRINTR "The bin is empty."
?L5:	EQUAL? PRSA,V?PUT,V?WALK-TO,V?ENTER \FALSE
	PRINTR "The bin is only for robots."

	.FUNCT FLOYD-F,OARG=0,X,N,TXT,?TMP
	ZERO? OARG /?L1
	EQUAL? OARG,M-OBJDESC? /TRUE
	PRINTI "   "
	CALL DESCRIBE-FLOYD >STACK
	RSTACK
?L1:	EQUAL? FLOYD,WINNER \?L6
	SET 'FLOYD-SPOKE,1
	EQUAL? ROBOT-PICKED,0,FLOYD /?L7
	SET 'WINNER,PROTAGONIST
	CALL PERFORM,V?COMFORT,FLOYD
	CALL STOP >STACK
	RSTACK
?L7:	ZERO? FLOYD-ANGUISHED /?L9
	PRINT FLOYD-SNIFFS
	CALL STOP >STACK
	RSTACK
?L9:	EQUAL? PRSA,V?TELL-ABOUT \?L10
	EQUAL? PRSO,ME \?L10
	GETP PRSI,P?FLOYD-ASK-ABOUT >TXT
	GRTR? ROBOT-EVILNESS,12 \?L11
	PRINTR """Oh, quit jabbering already."""
?L11:	ZERO? TXT /?L14
	EQUAL? PRSI,OLIVER \?L13
	FSET? OLIVER,TOUCHBIT /?L13
?L14:	PRINTI "Floyd shrugs. ""Beats me."
	IN? PLATO,HERE \?L15
	PRINTI " Ask Plato. He knows everything!"
?L15:	PRINTR """"
?L13:	PRINTI """"
	PRINT TXT
	PRINTR """"
?L10:	ZERO? STUNNED /?L19
	EQUAL? PRSA,V?HELP /?L22
	EQUAL? PRSA,V?SAVE-SOMETHING \?L23
	EQUAL? PRSO,ME /?L22
?L23:	EQUAL? PRSA,V?KILL,V?OFF \?L24
	EQUAL? PRSO,PLATO /?L22
?L24:	EQUAL? PRSA,V?TAKE \?L20
	EQUAL? PRSO,STUN-GUN \?L20
?L22:	SET 'FLOYD-TOLD,1
	PRINTR "Floyd waves his hands helplessly. ""Yes... I mean no... I mean oh no oh help me please. Floyd in quandry..."""
?L20:	PRINTI "Floyd just looks at you with confusion and panic in his eyes."
	CRLF
	CALL STOP >STACK
	RSTACK
?L19:	EQUAL? HERE,FACTORY \?L26
	ZERO? FLOYD-SHOT /?L27
	PRINTR "Floyd is hurt and doesn't respond."
?L27:	PRINTR """Shut up!"" orders Floyd."
?L26:	EQUAL? PRSA,V?LAUNCH \?L30
	EQUAL? PRSO,SPACETRUCK-OBJECT \?L30
	SET 'AWAITING-REPLY,2
	CALL V-YES
	SET 'AWAITING-REPLY,0
	RTRUE
?L30:	EQUAL? PRSA,V?TAKE \?L32
	EQUAL? PRSO,LEASH \?L31
	FSET? HERE,WEIGHTLESSBIT /?L31
	CALL FLOYD-TAKE-LEASH >STACK
	RSTACK
?L31:	EQUAL? PRSA,V?TAKE \?L32
	EQUAL? PRSO,STAR \?L32
	FSET? STAR,TRYTAKEBIT \?L32
	PRINTR """Huh? Floyd shorter even than you!"""
?L32:	EQUAL? PRSA,V?YES \?L33
	ZERO? AWAITING-REPLY /?L33
	CALL V-YES >STACK
	RSTACK
?L33:	EQUAL? PRSA,V?NO \?L34
	ZERO? AWAITING-REPLY /?L34
	CALL V-NO >STACK
	RSTACK
?L34:	EQUAL? PRSA,V?CLIMB-ON,V?ENTER \?L35
	EQUAL? PRSO,COPILOT-SEAT,PILOT-SEAT \?L35
	IN? FLOYD,PRSO \?L36
	PRINTR """Where is Floyd now, huh?"""
?L36:	PRINTR "Floyd looks suspicious. ""You first."""
?L35:	EQUAL? PRSA,V?TAKE \?L39
	IN? PRSO,HEATING-CHAMBER \?L39
	MOVE PRSO,HERE
	PRINTI """Okay!"" Floyd reaches into the "
	PRINTD HEATING-CHAMBER
	PRINTI " and grabs"
	CALL TPRINT-PRSO
	PRINTR ". ""Yikes, it's hot!"" He drops it to the deck, where it quickly cools."
?L39:	EQUAL? PRSA,V?MUNG,V?UNLOCK,V?OPEN \?L40
	EQUAL? PRSO,STRONG-BOX,SAFE \?L40
	PRINTI """Floyd's a robot, not a locksmith!"""
	CRLF
	CALL PRINT-ID,STR?194 >STACK
	RSTACK
?L40:	EQUAL? PRSA,V?UNLOCK,V?OPEN \?L41
	EQUAL? PRSO,SECURITY-DOOR \?L41
	PRINTR """Put your ID in the ID reader, dumbo!"""
?L41:	EQUAL? PRSA,V?MUNG,V?KILL,V?OFF \?L42
	EQUAL? PRSO,WELDER \?L42
	PRINTI """Sure! Floyd not scared!"" He walks bravely up to the welder, which spits some electric fire in his direction. From his new position (quivering behind your legs) Floyd says, ""Floyd changed his mind, okay?"""
	CRLF
	CALL PRINT-ID,STR?195 >STACK
	RSTACK
?L42:	EQUAL? PRSA,V?ENTER \?L43
	EQUAL? PRSO,EXERCISE-MACHINE \?L43
	PRINTI """Floyd doesn't need exercise! Not a gram of flab on Floyd!"" He pokes you in the stomach and grins. ""Can't say the same about you, though!"""
	CRLF
	CALL PRINT-ID,STR?196 >STACK
	RSTACK
?L43:	EQUAL? PRSA,V?REACH-IN \?L44
	EQUAL? PRSO,PSEUDO-OBJECT,DISPENSER \?L44
	EQUAL? HERE,PX \?L44
	PRINTR "Floyd happily reaches into the dispenser hole, and then withdraws his hand, looking glum. ""Nope, not even a ball."""
?L44:	EQUAL? PRSA,V?WEAR \?L45
	FSET? PRSO,WEARBIT \?L45
	PRINTR """Too big for Floyd! Also, it would clash with Floyd's boron-titanium alloy finish!"""
?L45:	EQUAL? PRSA,V?GIVE \?L46
	EQUAL? PRSI,ME \?L46
	IN? PRSO,FLOYD \?L47
	MOVE PRSO,PROTAGONIST
	PRINTI """Okay,"" says Floyd, handing you the "
	PRINTD PRSO
	PRINTR ", ""but only because you're Floyd's best friend."""
?L47:	PRINT FLOYD-NOT-HAVE
	RTRUE
?L46:	EQUAL? PRSA,V?SGIVE \?L50
	EQUAL? PRSO,ME \?L50
	CALL PERFORM,V?GIVE,PRSI,ME
	RTRUE
?L50:	EQUAL? PRSA,V?WALK \?L51
	PRINTR "Floyd looks slightly embarrassed. ""You know Floyd and his sense of direction."" Then he looks up at you with wide, trusting eyes. ""Tell Floyd a story?"""
?L51:	EQUAL? PRSA,V?FOLLOW \?L52
	EQUAL? PRSO,ME \?L52
	PRINTR """Okay!"""
?L52:	EQUAL? PRSA,V?HELLO \?L53
	GRTR? ROBOT-EVILNESS,13 \?L54
	PRINTR """Enough with the stupid 'FLOYD, HELLO' all the time, okay?"""
?L54:	PRINTR """Hi!"" Floyd grins and bounces up and down."
?L53:	EQUAL? PRSA,V?DROP \?L57
	IN? PRSO,FLOYD \?L58
	RANDOM 100 >STACK
	LESS? 50,STACK /?L60
	MOVE PRSO,HERE
	PRINTI "Floyd shrugs and drops the "
	PRINTD PRSO
	PRINT PERIOD-CR
	RTRUE
?L60:	PRINTI "Floyd clutches the "
	PRINTD PRSO
	PRINTR " even more tightly. ""Floyd won't,"" he says defiantly."
?L58:	PRINT FLOYD-NOT-HAVE
	RTRUE
?L57:	PRINTI "Floyd whines, ""Enough talking! Let's play Hider-and-Seeker."""
	CRLF
	CALL STOP >STACK
	RSTACK
?L6:	FSET? FLOYD,TOUCHBIT /?L65
	CALL NOUN-USED,W?FLOYD,FLOYD >STACK
	ZERO? STACK /?L65
	PRINTI "You don't see anyone by that name here."
	CRLF
	RETURN 8
?L65:	EQUAL? ROBOT-PICKED,FLOYD /?L68
	CALL TOUCHING?,FLOYD >STACK
	ZERO? STACK /?L68
	CALL CANT-REACH,FLOYD >STACK
	RSTACK
?L68:	EQUAL? PRSA,V?COMFORT \?L69
	EQUAL? ROBOT-PICKED,0,FLOYD /?L69
	PRINTR "Floyd gives you a hurt look and turns away."
?L69:	ZERO? FLOYD-ANGUISHED /?L70
	CALL TOUCHING?,FLOYD >STACK
	ZERO? STACK \?L71
	EQUAL? PRSA,V?COMFORT \?L70
?L71:	PRINT FLOYD-SNIFFS
	RTRUE
?L70:	MUL ROBOT-EVILNESS,10 >STACK
	SUB STACK,70 >?TMP
	RANDOM 100 >STACK
	LESS? ?TMP,STACK /?L72
	CALL TOUCHING?,FLOYD >STACK
	ZERO? STACK /?L72
	EQUAL? PRSA,V?SHAKE,V?KICK,V?OFF /?L72
	FSET? FLOYD,ACTIVEBIT \?L72
	EQUAL? HERE,FACTORY /?L73
	PRINTR """Hey, will you just leave Floyd alone!"" He shoves you away."
?L73:	ZERO? FLOYD-SHOT /?L75
	PRINTI "Before you can..."
	CRLF
	CALL I-LAUNCH >STACK
	RSTACK
?L75:	CALL BACK-OFF,STR?197 >STACK
	RSTACK
?L72:	EQUAL? PRSA,V?EXAMINE \?L77
	CALL DESCRIBE-FLOYD,1
	FIRST? FLOYD >STACK \?L78
	PRINTI " "
	CALL V-LOOK-INSIDE >STACK
	RSTACK
?L78:	CRLF
	RTRUE
?L77:	EQUAL? PRSA,V?PUT \?L81
	EQUAL? PRSI,FLOYD \?L81
	FSET? FLOYD,ACTIVEBIT \?L82
	PRINTR """Hey, Floyd's a robot, not a garbage pail!"" Floyd giggles uncontrollably at his own joke."
?L82:	CALL NOUN-USED,W?COMPAR,FLOYD >STACK
	ZERO? STACK /?L84
	PRINTR "There's no room."
?L84:	PRINT HUH
	RTRUE
?L81:	EQUAL? PRSA,V?KILL \?L86
	EQUAL? PRSO,FLOYD \?L86
	ZERO? FLOYD-SHOT /?L86
	CALL PERFORM,V?SHOOT,FLOYD,ZAPGUN
	RTRUE
?L86:	EQUAL? PRSA,V?SHOOT \?L87
	ZERO? FLOYD-SHOT /?L88
	INC 'ZAPGUN-SHOTS
	PRINTI "Floyd is already fatally wounded, so that would accomplish nothing, except perhaps fulfilling some sadistic impulse on your part."
	CRLF
	CALL PRINT-ID,STR?198 >STACK
	RSTACK
?L88:	EQUAL? HERE,FACTORY \?L90
	CALL ROB,FLOYD,HERE
	CALL DEQUEUE,I-FACTORY
	FSET STUN-GUN,TAKEBIT
	FCLEAR FLOYD,ACTIVEBIT
	SET 'FLOYD-SHOT,1
	PRINTI "The bolt hits Floyd squarely in the chest. He is blown backwards, against the pedestal, and slumps to the deck."
	CRLF
	CALL PRINT-ID,STR?199 >STACK
	RSTACK
?L90:	INC 'ZAPGUN-SHOTS
	PRINTI "[The author of this story is totally shocked, and won't even dignify such an input with a response.]"
	CRLF
	CALL PRINT-ID,STR?200 >STACK
	RSTACK
?L87:	EQUAL? PRSA,V?PICK \?L92
	CALL PICK-ROBOT >STACK
	RSTACK
?L92:	EQUAL? PRSA,V?CLOSE \?L93
	PRINT HUH
	RTRUE
?L93:	EQUAL? PRSA,V?REACH-IN,V?LOOK-INSIDE \?L94
	CALL PERFORM,V?OPEN,FLOYD
	RTRUE
?L94:	FSET? FLOYD,ACTIVEBIT \?L95
	SET 'FLOYD-SPOKE,1
	EQUAL? PRSA,V?ON \?L96
	PRINTR "He's already been activated."
?L96:	EQUAL? PRSA,V?OFF \?L98
	GRTR? PLATO-ATTACK-COUNTER,0 \?L99
	PRINTI "Floyd jerks away as you touch his on-off switch. ""Hey, you know how much Floyd hates that! And after Floyd just saved your life, you kripping ingrate."""
	CRLF
	CALL PRINT-ID,STR?201 >STACK
	RSTACK
?L99:	FCLEAR FLOYD,ACTIVEBIT
	FCLEAR FLOYD,ACTORBIT
	ZERO? SPACETRUCK-COUNTER \?L102
	CALL DEQUEUE,I-FLOYD
?L102:	PRINTI "Floyd, shocked by this betrayal from his old friend, whimpers and keels over"
	FIRST? FLOYD >STACK \?L105
	CALL ROB,FLOYD,HERE
	PRINTI ", dropping what he was carrying"
?L105:	PRINT PERIOD-CR
	RTRUE
?L98:	EQUAL? HERE,FACTORY /FALSE
	EQUAL? PRSA,V?KISS \?L109
	PRINTI "You receive a painful electric shock."
	CRLF
	CALL PRINT-ID,STR?202 >STACK
	RSTACK
?L109:	EQUAL? PRSA,V?SCOLD \?L110
	PRINTR "Floyd looks defensive. ""What did Floyd do wrong?"""
?L110:	EQUAL? PRSA,V?PLAY-WITH \?L111
	ZERO? FLOYD-ANGUISHED /?L112
	CALL PERFORM,V?TOUCH,FLOYD
	RTRUE
?L112:	CALL UNTOUCHABLE?,FLOYD >STACK
	ZERO? STACK /?L114
	CALL CANT-REACH,FLOYD
	RTRUE
?L114:	SET 'C-ELAPSED,30
	CALL QUEUE,I-FLOYD,1
	PRINTI "You play with Floyd for several centichrons until you"
	MUL ROBOT-EVILNESS,15 >STACK
	SUB STACK,135 >?TMP
	RANDOM 100 >STACK
	LESS? ?TMP,STACK /?L116
	PRINTI " win a game. Floyd gets angry, accuses you of cheating, and kicks you painfully in the shin."
	CRLF
	CALL PRINT-ID,STR?203 >STACK
	RSTACK
?L116:	PRINTR "'re completely winded. Floyd pokes at you gleefully. ""C'mon! Let's play some more!"""
?L111:	EQUAL? PRSA,V?LISTEN \?L119
	PRINTR "Floyd is babbling about this and that."
?L119:	EQUAL? PRSA,V?TAKE \?L120
	EQUAL? PRSO,FLOYD \?L120
	FSET? HERE,WEIGHTLESSBIT \?L121
	PRINTI "Sans gravity, you easily pick up Floyd. ""Oh, boy! Zero-Gee Polo,"" he yells, wriggling away and bounding off several walls."
	CRLF
	CALL PRINT-ID,STR?204 >STACK
	RSTACK
?L121:	FSET? FLOYD,TOUCHBIT \FALSE
	SET 'FLOYD-TRYTAKEN,1
	PRINTR "You manage to lift Floyd a few centimeters, but he's too heavy and you drop him suddenly. Floyd gives a surprised squeal and moves a respectable distance away."
?L120:	EQUAL? PRSA,V?MUNG,V?KILL \?L125
	PRINTI "Floyd starts dashing around the room. ""Oh boy oh boy oh boy! I haven't played Chase and Tag for years! You be It! Nah, nah!"""
	CRLF
	CALL PRINT-ID,STR?205 >STACK
	RSTACK
?L125:	EQUAL? PRSA,V?SHAKE,V?KICK \?L126
	GRTR? ROBOT-EVILNESS,13 \?L127
	PRINTI """What the krip do you think you're doing? How you'd like it if Floyd treated you that way, you stupid trot-brain."""
	CRLF
	CALL PRINT-ID,STR?206 >STACK
	RSTACK
?L127:	PRINTI """Why you do that?"" Floyd whines. ""I think a wire now shaken loose."" He goes off into a corner and sulks."
	CRLF
	CALL PRINT-ID,STR?207 >STACK
	RSTACK
?L126:	EQUAL? PRSA,V?OPEN,V?CLEAN,V?SEARCH /?L131
	EQUAL? PRSA,V?TICKLE \?L130
?L131:	PRINTR "Floyd giggles and pushes you away. ""You're tickling Floyd!"" He clutches at his side panels, laughing hysterically. Oil drops stream from his eyes."
?L130:	EQUAL? PRSA,V?PUT,V?GIVE \?L132
	EQUAL? PRSI,FLOYD \?L132
	EQUAL? PRSO,TAFFY,GRAY-GOO,ORANGE-GOO /?L135
	EQUAL? PRSO,NECTAR,SOUP \?L133
?L135:	PRINTI "Floyd looks at the goo. ""Yech! Got any Number Seven Heavy Grease?"""
	CRLF
	CALL PRINT-ID,STR?208 >STACK
	RSTACK
?L133:	EQUAL? PRSO,LEASH \?L136
	CALL FLOYD-TAKE-LEASH >STACK
	RSTACK
?L136:	EQUAL? PRSO,OSTRICH-NIP \?L137
	PRINTR """Phew!"" says Floyd, holding his nose and handing it back."
?L137:	CALL CCOUNT,FLOYD >STACK
	GRTR? STACK,3 /?L139
	EQUAL? PRSO,SPACESUIT,OSTRICH-NIP,EXPLOSIVE /?L139
	EQUAL? PRSO,TIMER,DETONATOR /?L139
	FSET? PRSO,CONTBIT /?L139
	RANDOM 100 >STACK
	LESS? 35,STACK /?L138
?L139:	MOVE PRSO,HERE
	PRINTI "Floyd examines the "
	PRINTD PRSO
	PRINTR ", shrugs, and drops it."
?L138:	MOVE PRSO,FLOYD
	PRINTR """Neat!"" exclaims Floyd. He thanks you profusely."
?L132:	EQUAL? PRSA,V?SHOW \?L141
	EQUAL? FLOYD,PRSI \?L141
	SET 'AWAITING-REPLY,3
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTI "Floyd looks over"
	CALL TPRINT-PRSO
	PRINTR ". ""Can you play any games with it?"" he asks."
?L141:	EQUAL? PRSA,V?HUG,V?TOUCH \?L142
	PRINTR "Floyd gives a contented sigh."
?L142:	EQUAL? PRSA,V?SMELL \FALSE
	PRINTR "Floyd smells faintly of ozone and light machine oil."
?L95:	EQUAL? PRSA,V?OFF,V?ON \?L145
	ZERO? FLOYD-SHOT /?L145
	PRINTR "The switch crumbles in your hand; it looks like Floyd's headed for that big Robot Pool in the sky..."
?L145:	EQUAL? PRSA,V?ON \?L146
	CALL QUEUE,I-FLOYD,-1
	SET 'FLOYD-SPOKE,1
	FSET FLOYD,ACTORBIT
	FSET FLOYD,ACTIVEBIT
	FSET FLOYD,TOUCHBIT
	PRINTI "Floyd jumps to his feet"
	PRINT HOPPING-MAD
	CRLF
	RTRUE
?L146:	EQUAL? PRSA,V?OFF \?L147
	PRINTR "Floyd isn't on."
?L147:	EQUAL? PRSA,V?TELL \?L148
	ZERO? FLOYD-SHOT \?L148
	PRINTI "Floyd isn't that great a listener even when he's on..."
	CRLF
	CALL STOP >STACK
	RSTACK
?L148:	EQUAL? PRSA,V?OPEN,V?SEARCH \FALSE
	PRINTR "You search the robot's compartments and discover a crayon, a paddle ball set, and finally, a photo of yourself. On the back, in crayon, in Floyd's childish scrawl, is the inscription, ""Floyds frend."" Touched, you return everything to the compartments where you found them."

	.FUNCT DESCRIBE-FLOYD,EXAMINING=0
	FSET? FLOYD,TOUCHBIT /?L1
	PRINT YOU-CANT
	PRINTI "see the robot in the third bin very well, because he's crouched in the corner. He's a short robot, and he seems to be playing marbles."
	RTRUE
?L1:	EQUAL? HERE,ROBOT-POOL \?L4
	ZERO? ROBOT-PICKED \?L3
	PRINTI "With unconcealed excitement, Floyd is hopping around in bin number three."
	RTRUE
?L3:	EQUAL? HERE,ROBOT-POOL \?L4
	EQUAL? ROBOT-PICKED,FLOYD /?L4
	PRINTI "Floyd sits dejectedly in bin three."
	RTRUE
?L4:	IN? PLATO,HERE \?L5
	ZERO? EXAMINING \?L5
	PRINTI "Plato and Floyd are both here."
	FSET? FLOYD,ACTIVEBIT /TRUE
	PRINTI " "
	PRINT FLOYD-OFF-DESC
	RTRUE
?L5:	EQUAL? HERE,FACTORY \?L9
	PRINTI "Floyd is "
	ZERO? FLOYD-SHOT /?L10
	PRINTI "ly"
	JUMP ?L12
?L10:	PRINTI "stand"
?L12:	PRINTI "ing between you and the pyramid, "
	ZERO? FLOYD-SHOT /?L13
	PRINTI "seriously damaged by zapgun fire."
	RTRUE
?L13:	PRINTI "his face so contorted by hate as to be almost unrecognizable. You also wonder where he picked up that black eye patch."
	RTRUE
?L9:	FSET? FLOYD,ACTIVEBIT /?L16
	PRINT FLOYD-OFF-DESC
	RTRUE
?L16:	ZERO? FLOYD-ANGUISHED /?L17
	PRINTI "Floyd is lying on the floor, sobbing."
	RTRUE
?L17:	ZERO? EXAMINING /?L18
	PRINTI "Floyd is a multi-purpose robot with slightly-crossed eyes and a lopsided grin."
	RTRUE
?L18:	PRINTI "Floyd is here, also looking around the room."
	RTRUE

	.FUNCT FLOYD-TAKE-LEASH
	ZERO? HANGING-IN-AIR /?L1
	PRINTR """Floyd can't until you let go!"""
?L1:	PRINTR "Floyd grabs the leash and gets pulled up into the air. ""Wheee!"" Then his grip slips and he clatters to the deck. ""Oops! More dents!"""

	.FUNCT MOVE-FLOYD-TO-FACTORY
	MOVE FLOYD,FACTORY
	EQUAL? HERE,EAST-JUNCTION,LEVEL-FIVE \?L1
	PUSH SOUTH-CONNECTION
	JUMP ?L7
?L1:	EQUAL? HERE,SOUTH-JUNCTION,NORTH-JUNCTION \?L3
	PUSH EAST-CONNECTION
	JUMP ?L7
?L3:	RANDOM 100 >STACK
	LESS? 25,STACK /?L4
	PUSH SOUTH-JUNCTION
	JUMP ?L7
?L4:	RANDOM 100 >STACK
	LESS? 33,STACK /?L5
	PUSH EAST-JUNCTION
	JUMP ?L7
?L5:	RANDOM 100 >STACK
	LESS? 50,STACK /?L6
	PUSH NORTH-JUNCTION
	JUMP ?L7
?L6:	PUSH LEVEL-FIVE
?L7:	CALL ROB,FLOYD,STACK
	MOVE STUN-GUN,FLOYD
	CALL DEQUEUE,I-FLOYD
	CALL DEQUEUE,I-ROBOT-EVILNESS >STACK
	RSTACK

	.FUNCT HELEN-F
	EQUAL? HELEN,WINNER \?L1
	EQUAL? PRSA,V?HELLO \?L3
	PRINTR """Mutual, I'm sure."""
?L3:	EQUAL? PRSA,V?FOLLOW,V?WALK \?L5
	PRINTR """I'm supposta stay with any human I'm assigned to."""
?L5:	PRINTI "You've strayed too far from simple form-sorting to interest Helen."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? ROBOT-PICKED,HELEN /?L7
	CALL TOUCHING?,HELEN >STACK
	ZERO? STACK /?L7
	CALL CANT-REACH,HELEN >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?GIVE \?L8
	EQUAL? PRSO,CLASS-THREE-SPACECRAFT-ACTIVATION-FORM,ROBOT-USE-AUTHORIZATION-FORM,ASSIGNMENT-COMPLETION-FORM \?L8
	CALL CONFETTI,PRSO >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?OPEN,V?ON,V?OFF \?L9
	CALL PERFORM,PRSA,PLATO
	RTRUE
?L9:	EQUAL? PRSA,V?PICK \FALSE
	CALL PICK-ROBOT >STACK
	RSTACK

	.FUNCT REX-F
	EQUAL? REX,WINNER \?L1
	EQUAL? PRSA,V?HELLO \?L3
	PRINTR """Yo."""
?L3:	EQUAL? PRSA,V?FOLLOW,V?WALK \?L5
	PRINTI """I'll follow youse "
	EQUAL? REX,ROBOT-PICKED \?L6
	PRINTI "since I been"
	JUMP ?L8
?L6:	PRINTI "if I gets"
?L8:	PRINTR " assigned ta youse."""
?L5:	PRINTI "Rex merely looks confused."
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? ROBOT-PICKED,REX /?L10
	CALL TOUCHING?,REX >STACK
	ZERO? STACK /?L10
	CALL CANT-REACH,REX >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?OPEN,V?ON,V?OFF \?L11
	CALL PERFORM,PRSA,PLATO
	RTRUE
?L11:	EQUAL? PRSA,V?PICK \FALSE
	CALL PICK-ROBOT >STACK
	RSTACK

	.FUNCT I-OTHER-ROBOT
	IN? ROBOT-PICKED,HERE /FALSE
	MOVE ROBOT-PICKED,HERE
	EQUAL? HERE,CARGO-BAY-ENTRANCE \?L3
	EQUAL? ROBOT-PICKED,REX \?L3
	CALL PRINT-ID,STR?209
	CALL JIGS-UP,STR?210 >STACK
	RSTACK
?L3:	PRINTR "   Helen obediently follows you."

	.FUNCT CONFETTI,FORM-NAME?1
	REMOVE FORM-NAME?1
	PRINTI "In a spasm of vocational enthusiasm, Helen tries to burst and decollate your "
	PRINTD FORM-NAME?1
	PRINTR ", leaving nothing but some useless confetti."

	.FUNCT PICK-ROBOT
	EQUAL? PRSO,ROBOT-PICKED \?L1
	PRINT SENILITY-STRIKES
	RTRUE
?L1:	ZERO? ROBOT-PICKED /?L3
	PRINTI "You already picked "
	PRINTD ROBOT-PICKED
	PRINT PERIOD-CR
	RTRUE
?L3:	PRINTR "Use the automated robot selection equipment."

	.FUNCT CARGO-BAY-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This huge airlock is essentially a giant loading dock, where truckloads of forms arrive from various printing planets throughout the sector and are immediately distributed throughout the administrative deck. The only exit on foot is back the way you came. A "
	PRINTD SPACETRUCK-OBJECT
	PRINTI ", its hatch "
	CALL OPEN-CLOSED,SPACETRUCK-HATCH
	PRINTI ", waits in the cargo bay."
	RTRUE

	.FUNCT SPACETRUCK-OBJECT-F
	EQUAL? PRSA,V?WALK-TO,V?ENTER \?L1
	EQUAL? HERE,SPACETRUCK \?L3
	PRINT LOOK-AROUND
	RTRUE
?L3:	CALL DO-WALK,P?IN >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?DISEMBARK,V?EXIT,V?LEAVE \?L6
	EQUAL? HERE,SPACETRUCK \?L7
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L7:	PRINT LOOK-AROUND
	RTRUE
?L6:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L10
	CALL PERFORM,PRSA,SPACETRUCK-HATCH
	RTRUE
?L10:	EQUAL? PRSA,V?EXAMINE \?L11
	EQUAL? HERE,SPACETRUCK \?L12
	CALL V-LOOK >STACK
	RSTACK
?L12:	CALL PERFORM,V?EXAMINE,SPACETRUCK-HATCH
	RTRUE
?L11:	EQUAL? PRSA,V?LOOK-INSIDE \?L15
	EQUAL? HERE,CARGO-BAY,DOCKING-BAY-2 \?L15
	CALL PERFORM,V?LOOK-INSIDE,WINDOW
	RTRUE
?L15:	EQUAL? PRSA,V?ON,V?LAUNCH \?L16
	EQUAL? HERE,SPACETRUCK /?L17
	PRINTR "You're not even in it!"
?L17:	GRTR? SPACETRUCK-COUNTER,0 \?L19
	PRINT SENILITY-STRIKES
	RTRUE
?L19:	PRINTR "That's what the slot and keypad are for!"
?L16:	EQUAL? PRSA,V?SEARCH \FALSE
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RTRUE

	.FUNCT SPACETRUCK-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	FSET? SPACETRUCK,TOUCHBIT /?L1
	CALL QUEUE,I-THERMOS,100 >STACK
	RSTACK
?L1:	EQUAL? RARG,M-LOOK \?L3
	PRINTI "This is a twelve-meter rig, the largest Class Three spacecraft made, with seats for a pilot and copilot. Below the viewport is a space band radio, a red button for activating the emergency beacon, plus a slot and keypad for controlling the autopilot. The hatch is "
	CALL OPEN-CLOSED,SPACETRUCK-HATCH
	PRINTI " and the rear of the truck is empty of cargo."
	RTRUE
?L3:	EQUAL? RARG,M-END \FALSE
	IN? HELEN,HERE \FALSE
	CALL VISIBLE?,CLASS-THREE-SPACECRAFT-ACTIVATION-FORM >STACK
	ZERO? STACK /FALSE
	PRINTI "   "
	CALL CONFETTI,CLASS-THREE-SPACECRAFT-ACTIVATION-FORM >STACK
	RSTACK

	.FUNCT SPACETRUCK-EXIT-F
	FSET? SPACETRUCK-HATCH,OPENBIT /?L1
	CALL THIS-IS-IT,SPACETRUCK-HATCH
	CALL DO-FIRST,STR?211
	RFALSE
?L1:	EQUAL? SPACETRUCK-COUNTER,-1 \?L3
	RETURN CARGO-BAY
?L3:	EQUAL? SPACETRUCK-COUNTER,5 \FALSE
	EQUAL? COURSE-PICKED,RIGHT-COURSE \FALSE
	RETURN DOCKING-BAY-2

	.FUNCT SPACETRUCK-HATCH-F
	EQUAL? PRSA,V?OPEN \FALSE
	GRTR? SPACETRUCK-COUNTER,-1 \FALSE
	EQUAL? SPACETRUCK-COUNTER,5 \?L3
	EQUAL? COURSE-PICKED,RIGHT-COURSE /FALSE
?L3:	PRINT YOU-CANT
	PRINTI "open the hatch in deep space!"
	CRLF
	CALL PRINT-ID,STR?212 >STACK
	RSTACK

	.FUNCT PILOT-SEAT-F,VARG=0
	EQUAL? VARG,M-ENTER \FALSE
	IN? FLOYD,HERE \FALSE
	FSET? FLOYD,ACTIVEBIT \FALSE
	PRINTI " Floyd clambers into the "
	IN? PROTAGONIST,PILOT-SEAT \?L3
	MOVE FLOYD,COPILOT-SEAT
	PRINTI "co"
	JUMP ?L5
?L3:	MOVE FLOYD,PILOT-SEAT
?L5:	PRINTD PILOT-SEAT
	LOC FLOYD >STACK
	EQUAL? STACK,PILOT-SEAT,COPILOT-SEAT \?L6
	PRINTI ", his feet dangling a few centimeters short of the floor"
?L6:	PRINTI "."
	EQUAL? SPACETRUCK-COUNTER,-1 \TRUE
	SET 'FLOYD-SPOKE,1
	SET 'AWAITING-REPLY,2
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-REPLY,STACK
	PRINTI " ""Let Floyd launch the "
	PRINTD SPACETRUCK-OBJECT
	PRINTI "? Please? Floyd has not crashed a truck in over two weeks!"""
	RTRUE

	.FUNCT GENERIC-SEAT-F
	EQUAL? PRSA,V?DISEMBARK,V?EXIT,V?LEAVE \FALSE
	LOC PROTAGONIST >STACK
	EQUAL? STACK,PILOT-SEAT,COPILOT-SEAT \FALSE
	LOC PROTAGONIST >STACK
	RSTACK

	.FUNCT RADIO-F
	EQUAL? PRSA,V?LISTEN \?L1
	FSET? RADIO,ACTIVEBIT \?L3
	PRINTR """Hiss. Crackle."""
?L3:	PRINTR "The radio isn't on!"
?L1:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTI "The radio seems to be damaged, because the microphone is missing. "
	RFALSE
?L6:	EQUAL? PRSA,V?ON \?L7
	CALL QUEUE,I-RADIO,-1
	RFALSE
?L7:	EQUAL? PRSA,V?OFF \FALSE
	CALL DEQUEUE,I-RADIO
	RFALSE

	.FUNCT RED-BUTTON-F
	EQUAL? PRSA,V?PUSH \FALSE
	EQUAL? SPACETRUCK-COUNTER,5 \?L3
	CALL RECORDING,STR?213 >STACK
	RSTACK
?L3:	PRINTR "You're not in trouble! Misuse of the emergency message beacon is a court-martial offense!"

	.FUNCT I-SPACETRUCK
	CALL QUEUE,I-SPACETRUCK,-1
	INC 'SPACETRUCK-COUNTER
	PRINTI "   "
	ZERO? SPACETRUCK-COUNTER \?L1
	PRINTI "The truck roars out of the cargo bay"
	EQUAL? HERE,CARGO-BAY \?L3
	CALL PRINT-ID,STR?214
	CALL JIGS-UP,STR?215 >STACK
	RSTACK
?L3:	FSET? SPACETRUCK-HATCH,OPENBIT \?L5
	CALL PRINT-ID,STR?216
	CALL JIGS-UP,STR?217 >STACK
	RSTACK
?L5:	LOC PROTAGONIST >STACK
	EQUAL? STACK,PILOT-SEAT,COPILOT-SEAT \?L6
	FSET SPACETRUCK,WEIGHTLESSBIT
	PRINTR ", slowly picking up speed. You settle back for the long trip."
?L6:	CALL PRINT-ID,STR?218
	CALL JIGS-UP,STR?219 >STACK
	RSTACK
?L1:	EQUAL? SPACETRUCK-COUNTER,1 \?L8
	CALL RECORDING,STR?220 >STACK
	RSTACK
?L8:	EQUAL? SPACETRUCK-COUNTER,2 \?L9
	PRINTR "There is a moment of stillness as the rear engines cut out. The moment ends as the braking rockets in front roar to life."
?L9:	EQUAL? SPACETRUCK-COUNTER,3 \?L10
	CALL RECORDING,STR?221 >STACK
	RSTACK
?L10:	EQUAL? SPACETRUCK-COUNTER,4 \?L11
	EQUAL? COURSE-PICKED,RIGHT-COURSE \?L12
	PRINTI "A tiny star directly ahead grows brighter and resolves itself into a distant space station. The station grows rapidly larger as you hurtle towards it."
	CRLF
	CALL PERFORM,V?LOOK-INSIDE,WINDOW
	PRINTR "   With a final burst, the braking rockets bring you to a halt a few thousand meters from the station."
?L12:	PRINTI "The forward braking rockets sputter off as the "
	PRINTD SPACETRUCK-OBJECT
	PRINTR " comes to a dead stop in space. There is no space station, or any other sign of human civilization, in sight."
?L11:	EQUAL? SPACETRUCK-COUNTER,5 \FALSE
	EQUAL? COURSE-PICKED,RIGHT-COURSE \?L16
	FCLEAR SPACETRUCK,WEIGHTLESSBIT
	CALL QUEUE,I-WELDER,-1
	CALL QUEUE,I-FLOYD,-1
	CALL QUEUE,I-PLATO,750
	CALL QUEUE,I-ROBOT-EVILNESS,1000
	MOVE PALLETS,SHIPPING-ROOM
	ADD SCORE,5 >SCORE
	PRINTI "The maneuvering thrusters kick on, nudging you toward the station. "
	CALL RECORDING,STR?222
	PRINTI "   The truck glides into the docking bay, and your stomach flips as the bay's arti-grav field comes on. The truck settles the last few centimeters to the floor, the bay floods with air, and a voice whispers, ""Stationfall."" Through the viewport, you see no one to meet you. Odd."
	CRLF
	JUMP ?L18
?L16:	CALL RECORDING,STR?223
	CALL QUEUE,I-SUFFOCATE,1970
?L18:	CALL DEQUEUE,I-SPACETRUCK >STACK
	RSTACK

	.FUNCT I-SUFFOCATE
	CALL PRINT-ID,STR?224
	CALL JIGS-UP,STR?225 >STACK
	RSTACK

	.FUNCT FOOD-KIT-F
	EQUAL? PRSA,V?EMPTY \?L1
	FSET? FOOD-KIT,OPENBIT \?L1
	LOC ORANGE-GOO >STACK
	LOC GRAY-GOO >STACK
	EQUAL? FOOD-KIT,STACK,STACK \?L1
	CALL PERFORM,V?REMOVE,GRAY-GOO
	RTRUE
?L1:	EQUAL? PRSA,V?OPEN \FALSE
	CALL IN-VACUUM? >STACK
	ZERO? STACK /FALSE
	LOC ORANGE-GOO >STACK
	LOC GRAY-GOO >STACK
	EQUAL? FOOD-KIT,STACK,STACK \FALSE
	FSET FOOD-KIT,OPENBIT
	CALL SPACE-FOOD >STACK
	RSTACK

	.FUNCT IN-VACUUM?
	EQUAL? HERE,VACUUM-STORAGE /TRUE
	EQUAL? HERE,AIRLOCK \FALSE
	FSET? OUTER-AIRLOCK-DOOR,OPENBIT \FALSE
	RTRUE

	.FUNCT SPACE-LIQUID,OBJ
	CALL VISIBLE?,OBJ >STACK
	ZERO? STACK /FALSE
	PRINTI "   The "
	EQUAL? OBJ,SOUP \?L3
	PRINTI "soup"
	JUMP ?L6
?L3:	EQUAL? OBJ,COFFEE \?L5
	PRINTI "coffee"
	JUMP ?L6
?L5:	PRINTI "nectar"
?L6:	PRINTI " boils away into the vacuum"
	EQUAL? OBJ,SOUP \?L7
	CALL PRINT-ID,STR?226
	REMOVE SOUP
	PRINT PERIOD-CR
	RTRUE
?L7:	CALL PRINT-ID,STR?227
	CALL ANTI-LITTER,OBJ >STACK
	RSTACK

	.FUNCT SPACE-FOOD
	REMOVE ORANGE-GOO
	REMOVE GRAY-GOO
	PRINTI "The food in the "
	PRINTD FOOD-KIT
	PRINTR " instantly crystallizes and drifts away."

	.FUNCT THERMOS-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's your basic insulated bottle, which hasn't changed much over the centuries. This one is plaid, with pictures of little robots all over it. "
	RFALSE
?L1:	EQUAL? PRSA,V?EMPTY,V?POUR \?L3
	EQUAL? PRSO,THERMOS \?L3
	IN? SOUP,THERMOS \?L3
	CALL PERFORM,PRSA,SOUP,PRSI
	RTRUE
?L3:	EQUAL? PRSA,V?PUT \?L4
	EQUAL? PRSI,THERMOS \?L4
	EQUAL? PRSO,LARGE-BIT,SMALL-BIT,EXPLOSIVE /?L4
	EQUAL? PRSO,MEDIUM-BIT /?L4
	PRINTI "The neck of the Thermos is too narrow for"
	CALL TRPRINT,PRSO
	RTRUE
?L4:	EQUAL? PRSA,V?OPEN \?L5
	CALL IN-VACUUM? >STACK
	ZERO? STACK /?L6
	IN? SOUP,THERMOS \?L6
	FSET THERMOS,OPENBIT
	CALL SPACE-LIQUID,SOUP >STACK
	RSTACK
?L6:	ZERO? THERMOS-FILLED-WITH-GAS /FALSE
	FSET THERMOS,OPENBIT
	PRINTR "You open the thermos, releasing a puff of FREZONE (tm) gas."
?L5:	EQUAL? PRSA,V?REACH-IN \FALSE
	IN? SOUP,THERMOS \FALSE
	CALL PERFORM,V?EXAMINE,SOUP
	RTRUE

	.FUNCT I-THERMOS
	IN? SOUP,THERMOS /?L1
	SET 'SOUP-WARMTH,0
	RETURN SOUP-WARMTH
?L1:	LESS? SOUP-WARMTH,0 \?L3
	SET 'SOUP-WARMTH,0
	RETURN SOUP-WARMTH
?L3:	FSET? THERMOS,OPENBIT \?L5
	PUSH 4
	JUMP ?L7
?L5:	PUSH 1
?L7:	SUB SOUP-WARMTH,STACK >SOUP-WARMTH
	CALL QUEUE,I-THERMOS,100 >STACK
	RSTACK

	.FUNCT SOUP-F
	EQUAL? PRSA,V?FIND \?L1
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?FOOD \?L1
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RTRUE
?L1:	EQUAL? PRSA,V?EAT \?L3
	CALL ULTIMATELY-IN?,THERMOS >STACK
	ZERO? STACK \?L3
	CALL THIS-IS-IT,THERMOS
	PRINT YNH
	CALL TRPRINT,THERMOS
	RTRUE
?L3:	EQUAL? PRSA,V?EMPTY,V?POUR \?L4
	REMOVE SOUP
	CALL MESS,STR?228
	PRINT PERIOD-CR
	RTRUE
?L4:	EQUAL? PRSA,V?TASTE,V?TOUCH,V?EXAMINE /?L6
	EQUAL? PRSA,V?REACH-IN \FALSE
?L6:	PRINTI "The soup seems to be "
	CALL DESCRIBE-SOUP-TEMPERATURE >STACK
	RSTACK

	.FUNCT DESCRIBE-SOUP-TEMPERATURE
	GRTR? SOUP-WARMTH,80 \?L1
	PRINTI "steaming hot"
	JUMP ?L7
?L1:	GRTR? SOUP-WARMTH,60 \?L3
	PRINTI "quite hot"
	JUMP ?L7
?L3:	GRTR? SOUP-WARMTH,40 \?L4
	PRINTI "fairly hot"
	JUMP ?L7
?L4:	GRTR? SOUP-WARMTH,20 \?L5
	PRINTI "lukewarm"
	JUMP ?L7
?L5:	GRTR? SOUP-WARMTH,0 \?L6
	PRINTI "tepid"
	JUMP ?L7
?L6:	PRINTI "on the cool side"
?L7:	PRINT PERIOD-CR
	RTRUE

	.FUNCT GOO-F
	EQUAL? PRSA,V?EAT \?L1
	CALL ULTIMATELY-IN?,FOOD-KIT,PROTAGONIST >STACK
	ZERO? STACK \?L1
	CALL THIS-IS-IT,FOOD-KIT
	PRINT YNH
	CALL TRPRINT,FOOD-KIT
	RTRUE
?L1:	EQUAL? PRSA,V?DROP,V?REMOVE,V?TAKE \?L3
	EQUAL? PRSA,V?DROP \?L4
	PRINTI "The goo, being gooey, sticks where it is"
	JUMP ?L6
?L4:	EQUAL? PRSA,V?TAKE \?L6
	PRINTI "It would ooze through your fingers"
?L6:	PRINTI ". You'll have to eat it right from"
	CALL TRPRINT,FOOD-KIT
	RTRUE
?L3:	EQUAL? PRSA,V?FIND \FALSE
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?FOOD \FALSE
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RTRUE

	.FUNCT DOCKING-BAY-2-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a tall, narrow bay. Your "
	PRINTD SPACETRUCK-OBJECT
	PRINTI " is docked here. Its hatch is "
	CALL OPEN-CLOSED,SPACETRUCK-HATCH
	PRINTI ". To the east is the huge door into the station."
	RTRUE

	.FUNCT LEVEL-FIVE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are in the central lobby of the middle level of the space station. The elevator "
	EQUAL? ELEVATOR-LEVEL,5 /?L3
	PRINTI "shaft "
?L3:	PRINTI "and call button lie to the east, and the corridor heads around the shaft to the northeast and southeast. Doors lead north and west"
	PRINT LADDER-LEADS
	RTRUE

	.FUNCT JAMMER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The jammer is a black box with a short antenna. It has "
	IN? TWENTY-PRONG-FROMITZ-BOARD,JAMMER \?L3
	PRINTI "a "
	PRINTD TWENTY-PRONG-FROMITZ-BOARD
	PRINTI " plugged into it"
	JUMP ?L5
?L3:	PRINTI "twenty tiny sockets on one side"
?L5:	PRINTI ". The jammer, which is o"
	FSET? JAMMER,ACTIVEBIT \?L6
	PRINTI "n"
	JUMP ?L8
?L6:	PRINTI "ff"
?L8:	PRINTI ", looks as if it can be set to any frequency between 0 and 1400; it is currently set to "
	PRINTN JAMMER-SETTING
	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L9
	PRINT HUH
	RTRUE
?L9:	EQUAL? PRSA,V?PUT \?L10
	EQUAL? PRSI,JAMMER \?L10
	EQUAL? PRSO,TWENTY-PRONG-FROMITZ-BOARD /?L10
	CALL DOESNT-FIT,STR?229 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?CONNECT \?L12
	EQUAL? TWENTY-PRONG-FROMITZ-BOARD,PRSO,PRSI \?L11
	CALL PERFORM,V?PUT,TWENTY-PRONG-FROMITZ-BOARD,JAMMER
	RTRUE
?L11:	EQUAL? PRSA,V?CONNECT \?L12
	EQUAL? TWELVE-PRONG-FROMITZ-BOARD,PRSO,PRSI \?L12
	CALL PERFORM,V?PUT,TWELVE-PRONG-FROMITZ-BOARD,JAMMER
	RTRUE
?L12:	EQUAL? PRSA,V?SET \?L13
	EQUAL? PRSO,JAMMER \?L13
	ZERO? PRSI \?L14
	PRINT NEXT-TIME
	RTRUE
?L14:	EQUAL? PRSI,INTNUM /?L16
	PRINT HUH
	RTRUE
?L16:	EQUAL? P-NUMBER,JAMMER-SETTING \?L17
	PRINT SENILITY-STRIKES
	RTRUE
?L17:	LESS? P-NUMBER,0 /?L19
	GRTR? P-NUMBER,1400 \?L18
?L19:	PRINTR "The jammer's range is 0 to 1400."
?L18:	SET 'JAMMER-SETTING,P-NUMBER
	PRINTI "You set the jammer to "
	PRINTN JAMMER-SETTING
	IN? FORKLIFT,HERE \?L21
	PRINTI ". "
	CALL PERFORM,V?OFF,JAMMER
	RTRUE
?L21:	PRINT PERIOD-CR
	RTRUE
?L13:	EQUAL? PRSA,V?COUNT \?L24
	CALL NOUN-USED,W?SOCKETS,JAMMER >STACK
	ZERO? STACK /?L24
	PRINTR "20."
?L24:	EQUAL? PRSA,V?OFF \FALSE
	IN? FORKLIFT,HERE \FALSE
	FCLEAR JAMMER,ACTIVEBIT
	REMOVE FORKLIFT
	REMOVE EXERCISE-MACHINE
	CALL DEQUEUE,I-FORKLIFT
	PRINTI "The "
	PRINTD EXERCISE-MACHINE
	PRINTR " springs to life, its powerful arms clamping shut on the forklift. The vehicle belches exhaust as it tries to free itself. The two machines tumble over in a death grip and then explode! When the smoke clears, there's not a trace of either machine."

	.FUNCT DISPENSER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	GETP DISPENSER,P?FDESC >STACK
	PRINT STACK
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \?L3
	EQUAL? PRSI,DISPENSER \?L3
	EQUAL? PRSO,COIN \?L4
	REMOVE COIN
	FSET DISPENSER,TOUCHBIT
	PRINTR """Clink!"" The coin drops into the slot."
?L4:	CALL DOESNT-FIT,STR?230 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?DRILL \?L7
	PRINTI "We quote from the Stellar Patrol Demolitions Training Manual, Edition 3754-GS108. ""Why You Should Never Drill Into Active Machinery: Reason #7. You may"
	PRINT STRIKE-POWER-SOURCE
	PRINTI """
   As you drill into the dispenser, you"
	PRINT STRIKE-POWER-SOURCE
	CALL PRINT-ID,STR?231
	CALL JIGS-UP,STR?232 >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?SHOOT \?L8
	CALL PRINT-ID,STR?233
	REMOVE DISPENSER
	PRINTR "Okay, but you'll have to answer to the Stellar Patrol Dispensing Machine Company... BLAM! The dispenser is dispensed."
?L8:	EQUAL? PRSA,V?MUNG,V?KILL,V?KICK /?L10
	EQUAL? PRSA,V?PUSH,V?SHAKE \?L9
?L10:	FIRST? DISPENSER >STACK \?L9
	PRINTI "This fails to dislodge the "
	FIRST? DISPENSER >STACK /?L11
?L11:	PRINTD STACK
	PRINTI ", but it does help relieve some of your aggressive feelings toward the stupid dispenser."
	CRLF
	CALL PRINT-ID,STR?234 >STACK
	RSTACK
?L9:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINT ONLY-BLACKNESS
	RTRUE

	.FUNCT COIN-SLOT-F
	IN? DISPENSER,HERE /?L1
	CALL CANT-SEE,PSEUDO-OBJECT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L3
	PRINT ONLY-BLACKNESS
	RTRUE
?L3:	EQUAL? PRSA,V?SHOOT \?L4
	CALL PERFORM,V?SHOOT,DISPENSER,ZAPGUN
	RTRUE
?L4:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,PSEUDO-OBJECT \FALSE
	CALL PERFORM,V?PUT,PRSO,DISPENSER
	RTRUE

	.FUNCT DISPENSER-SCREEN-F
	IN? DISPENSER,HERE /?L1
	CALL CANT-SEE,PSEUDO-OBJECT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?SHOOT \?L3
	CALL PERFORM,V?SHOOT,DISPENSER,ZAPGUN
	RTRUE
?L3:	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	PRINTR """--- STELLAR PATROL VENDO-MATIC ---
       all items:  1 galakmid
1. Patrol Songbook (SOLD OUT)
2. Set of Postcards (SOLD OUT)
3. ID Card Polish (SOLD OUT)
4. Pilot's Compass (SOLD OUT)
5. Patrol Pen & Pencil Set (SOLD OUT)
6. All-Purpose Timer
7. Pocket Computer (SOLD OUT)
8. Birth Control Pills (SOLD OUT)
9. Large Drill Bit"""

	.FUNCT DISPENSER-HOLE-F
	IN? DISPENSER,HERE /?L1
	CALL CANT-SEE,PSEUDO-OBJECT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?REACH-IN \?L3
	IN? TIMER,DISPENSER /?L6
	IN? LARGE-BIT,DISPENSER \?L4
?L6:	PRINTR "You can just feel something with your fingertips, but you can't get a grip on it!"
?L4:	PRINTR "You reach as far into the dispenser as you can, but feel nothing."
?L3:	EQUAL? PRSA,V?SHOOT \?L8
	CALL PERFORM,V?SHOOT,DISPENSER,ZAPGUN
	RTRUE
?L8:	EQUAL? PRSA,V?LOOK-INSIDE \?L9
	PRINT ONLY-BLACKNESS
	RTRUE
?L9:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,PSEUDO-OBJECT \FALSE
	PRINTI "You shove"
	CALL TPRINT-PRSO
	PRINTI " up into the hole."
	EQUAL? PRSO,OSTRICH-NIP \?L11
	IN? OSTRICH,HERE \?L11
	PRINTI " The ostrich squawks and sticks its head up the hole after the nip."
	CALL OSTRICH-INTO-DISPENSER
	PRINTI " A moment later, the nip falls to the deck. "
	CALL PERFORM,V?GIVE,OSTRICH-NIP,OSTRICH
	RTRUE
?L11:	MOVE PRSO,HERE
	PRINTI " A moment later, it drops out"
	PRINT LANDS-ON-FLOOR
	CRLF
	RTRUE

	.FUNCT OSTRICH-INTO-DISPENSER
	FIRST? DISPENSER >STACK \FALSE
	INC 'ROBOT-EVILNESS
	ADD SCORE,6 >SCORE
	PRINTI " It jerks its head back out, squawking even more loudly, and a moment later a "
	FIRST? DISPENSER >STACK /?L3
?L3:	PRINTD STACK
	PRINTI " falls out of the hole"
	PRINT LANDS-ON-FLOOR
	FIRST? DISPENSER >STACK /?L4
?L4:	MOVE STACK,HERE
	RTRUE

	.FUNCT TIMER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "As advertised, it is a standard, all-purpose timer. It can be set to any number up to 100, and is currently set to "
	PRINTN TIMER-SETTING
	PRINTI ". The timer "
	ZERO? TIMER-CONNECTED /?L3
	PRINTI "is connected to a detonator"
	JUMP ?L5
?L3:	PRINTI "has one connection point"
?L5:	CALL QUEUED?,I-TIMER >STACK
	ZERO? STACK /?L6
	PRINTI ", and is ticking loudly"
?L6:	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?SET \?L9
	ZERO? PRSI \?L10
	PRINT NEXT-TIME
	RTRUE
?L10:	EQUAL? PRSI,INTNUM /?L12
	PRINTR "You can set the timer only to a number!"
?L12:	GRTR? P-NUMBER,100 \?L13
	PRINTR "The timer has settings up to only 100."
?L13:	SET 'TIMER-SETTING,P-NUMBER
	PRINTI "You set the timer to "
	PRINTN TIMER-SETTING
	GRTR? TIMER-SETTING,0 \?L15
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-TIMER,STACK
	PRINTI ". Instantly, it begins ticking loudly"
	JUMP ?L17
?L15:	CALL DEQUEUE,I-TIMER
?L17:	PRINT PERIOD-CR
	RTRUE
?L9:	EQUAL? PRSA,V?DISCONNECT \?L18
	ZERO? PRSI \?L18
	ZERO? TIMER-CONNECTED /?L18
	CALL PERFORM,PRSA,TIMER,DETONATOR
	RTRUE
?L18:	EQUAL? PRSA,V?CONNECT \?L19
	EQUAL? EXPLOSIVE,PRSO,PRSI \?L19
	PRINT YOU-CANT
	PRINTR "connect the timer directly to the explosive."
?L19:	EQUAL? PRSA,V?OFF \?L20
	CALL QUEUED?,I-TIMER >STACK
	ZERO? STACK /?L20
	SET 'P-NUMBER,0
	CALL PERFORM,V?SET,TIMER,INTNUM
	RTRUE
?L20:	EQUAL? PRSA,V?LISTEN \FALSE
	CALL QUEUED?,I-TIMER >STACK
	ZERO? STACK /FALSE
	PRINTR """Tick, tick..."""

	.FUNCT DESTROY-EXPLOSIVE-CONT,L,X
	LOC EXPLOSIVE >L
?L1:	IN? L,ROOMS /TRUE
	FSET? L,VEHBIT /TRUE
	LOC L >X
	EQUAL? L,PEDESTAL /?L7
	REMOVE L
?L7:	SET 'L,X
	JUMP ?L1

	.FUNCT CELL-F
	EQUAL? PRSA,V?OPEN,V?WALK-TO,V?ENTER /?L3
	EQUAL? PRSA,V?UNLOCK \?L1
?L3:	PRINTR "The cells are all locked with high-security locks."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "The cells are all empty."

	.FUNCT BRIG-LOCK-F
	EQUAL? PRSA,V?PICK,V?UNLOCK,V?OPEN \?L1
	EQUAL? PRSI,KEY \?L3
	SET 'PRSO,KEY
	CALL DOESNT-FIT,STR?235 >STACK
	RSTACK
?L3:	CALL YUKS >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,KEY \FALSE
	CALL DOESNT-FIT,STR?235 >STACK
	RSTACK

	.FUNCT EAST-CONNECTION-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The corridor widens to the east, the connection point for a Military Sub-Module. An iris hatch at the connection point is "
	FSET? IRIS-HATCH,OPENBIT \?L3
	PRINTI "frozen open, revealing not a sub-module connector but a small, grimy connector"
	JUMP ?L5
?L3:	PRINTI "shut tight"
?L5:	PRINTI ". Next to the hatch is a slot. There is a door northwest of here, and doorways to the south and southwest. There's a junction in the corridor west of you."
	RTRUE

	.FUNCT STATION-CONTROL-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the nerve center of the space station, where every system can be monitored. "
	LESS? DAY,3 \?L3
	EQUAL? DAY,1 \?L5
	PRINTI "A couple"
	JUMP ?L7
?L5:	EQUAL? DAY,2 \?L7
	PRINTI "Several"
?L7:	PRINTI " of the monitors are blinking red. "
?L3:	PRINTI "The exits are south, northeast and west."
	RTRUE

	.FUNCT SYSTEM-MONITORS-F
	EQUAL? PRSA,V?READ,V?EXAMINE \FALSE
	GET 0,8 >STACK
	BOR STACK,2 >STACK
	PUT 0,8,STACK
	PRINTI "System:           Status:
COMMUNICATION     "
	GRTR? DAY,2 \?L3
	PRINTI "GREEN"
	JUMP ?L5
?L3:	PRINTI "RED"
?L5:	PRINTI "
LIFE SUPPORT      "
	EQUAL? DAY,2 \?L6
	LESS? INTERNAL-MOVES,6500 \?L8
	PRINTI "YELLOW"
	JUMP ?L11
?L8:	PRINTI "RED"
	JUMP ?L11
?L6:	PRINTI "GREEN"
?L11:	PRINTI "
FOOD PRODUCTION   "
	GRTR? DAY,2 \?L12
	PRINTI "GREEN"
	JUMP ?L14
?L12:	PRINTI "RED"
?L14:	PRINTI "
GRAVITY           "
	EQUAL? DAY,2 \?L15
	PRINTI "YELLOW"
	JUMP ?L17
?L15:	PRINTI "GREEN"
?L17:	PRINTI "
COMPUTER          GREEN
POWER             "
	EQUAL? DAY,2 \?L18
	LESS? INTERNAL-MOVES,4300 \?L20
	PRINTI "YELLOW"
	JUMP ?L23
?L20:	PRINTI "RED"
	JUMP ?L23
?L18:	PRINTI "GREEN"
?L23:	PRINTI "
PRINTING          "
	EQUAL? DAY,1 \?L24
	PRINTI "YELLOW"
	JUMP ?L27
?L24:	GRTR? DAY,3 \?L26
	PRINTI "GREEN"
	JUMP ?L27
?L26:	PRINTI "RED"
?L27:	CRLF
	GET 0,8 >STACK
	BAND STACK,-3 >STACK
	PUT 0,8,STACK
	RTRUE

	.FUNCT COMM-CENTER-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the Deep-Space Communication Center, which keeps the station in touch with the Stellar Patrol Command and the rest of the Third Galactic Union. Although regulations state that the Comm Center must be monitored around the clock, ten chrons per day, there's no one on duty.
   Most of the equipment here is too complicated for anyone without Deep-Space Communication Training to use. However, the red button of the wide-band emergency beacon is well-marked. Next to the button is a large screen for displaying incoming messages. "
	CALL SCREEN-F,1
	PRINTI " The only exit is north."
	RTRUE

	.FUNCT COMM-BUTTON-F
	CALL TOUCHING?,PSEUDO-OBJECT >STACK
	ZERO? STACK /FALSE
	PRINTI "The instant you touch the button, a powerful electric shock makes you jerk back."
	CALL PRINT-ID,STR?236
	GRTR? ROBOT-EVILNESS,14 \?L3
	CALL PRINT-ID,STR?237
	CALL JIGS-UP,STR?238
	CRLF
	RTRUE
?L3:	GRTR? ROBOT-EVILNESS,7 \?L5
	CALL CCOUNT,PROTAGONIST >STACK
	GRTR? STACK,0 \?L5
	CALL ROB,PROTAGONIST,HERE
	PRINTI " The shock causes you to drop everything, and leaves your limbs twitching all over."
	CALL PRINT-ID,STR?239
?L5:	CRLF
	RTRUE

	.FUNCT SCREEN-F,DESCRIBE-SCREEN=0
	EQUAL? PRSA,V?EXAMINE /?L3
	ZERO? DESCRIBE-SCREEN /?L1
?L3:	PRINTI "At the moment, the screen is "
	ZERO? MESSAGE-RECEIVED /?L4
	PRINTI "displaying a message."
	JUMP ?L6
?L4:	PRINTI "blank."
?L6:	ZERO? DESCRIBE-SCREEN \TRUE
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?READ \FALSE
	ZERO? MESSAGE-RECEIVED /?L11
	PRINTI """From: Forms Control Officer, S.P.S. Duffy
 To:   "
	PRINT LFC
	PRINTI " 1451-352-716
 Re:   Current assignment
 Msg:  Two thousand reams of "
	PRINT FORM-NAME
	PRINTR " found in mislabelled pallet. No additional supplies needed. Abort assignment and return to Duffy."""
?L11:	CALL PERFORM,V?EXAMINE,PSEUDO-OBJECT
	RTRUE

	.FUNCT I-MESSAGE
	SET 'MESSAGE-RECEIVED,1
	FCLEAR COMM-CENTER,TOUCHBIT
	PRINTI "   "
	FSET? SPACESUIT,WORNBIT \?L1
	PRINTI "The space suit picks up a message from"
	JUMP ?L3
?L1:	PRINTI "You hear a message over"
?L3:	PRINTR " the station's P.A. system: ""Deep-space communication received at Comm Center. No operator on duty. This is a recording."""

	.FUNCT FILES-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTR "The word ""boring"" does not BEGIN to describe them."
?L1:	EQUAL? PRSA,V?MUNG,V?CRUMPLE \FALSE
	PRINT VIOLATION-OF-ACT
	RTRUE

	.FUNCT COMMANDERS-OFFICE-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	CALL ULTIMATELY-IN?,EXPLOSIVE >STACK
	ZERO? STACK /?L1
	FSET EXERCISE-MACHINE,TOUCHBIT
	MOVE EXERCISE-MACHINE,COMPUTER-CONTROL
	CALL ROB,EXERCISE-MACHINE,GYM >STACK
	RSTACK
?L1:	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is the Station Commander's H.Q., with doors to the south and east, and doorways to the north and northwest."
	IN? LOG-READER,HERE /TRUE
	PRINTI " There's a black scar where the "
	PRINTD LOG-READER
	PRINTI " once sat."
	RTRUE

	.FUNCT LOG-READER-F
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	PRINT HUH
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "This simple device is for recording and reading log entries. It includes a tiny red button and a microphone/speaker. "
	FSET? LOG-READER,ACTIVEBIT \?L4
	IN? LOG-TAPE,LOG-READER \?L4
	PRINTI "The red button is glowing. "
?L4:	PRINTI "At the moment, the "
	PRINTD LOG-READER
	PRINTI " is o"
	FSET? LOG-READER,ACTIVEBIT \?L7
	PRINTI "n"
	JUMP ?L9
?L7:	PRINTI "ff"
?L9:	PRINTI ", and there is "
	IN? LOG-TAPE,LOG-READER \?L10
	PRINTI "a"
	JUMP ?L12
?L10:	PRINTI "no"
?L12:	PRINTR " log tape in it."
?L3:	EQUAL? PRSA,V?PUT \?L13
	EQUAL? PRSO,LOG-TAPE /?L14
	CALL DOESNT-FIT,STR?240 >STACK
	RSTACK
?L14:	FSET? LOG-READER,ACTIVEBIT \FALSE
	MOVE LOG-TAPE,LOG-READER
	SET 'LOG-COUNTER,0
	CALL READ-LOG >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?ON \?L18
	FSET? LOG-READER,ACTIVEBIT /?L18
	CALL QUEUE,I-LOG-READER,-1
	IN? LOG-TAPE,LOG-READER \FALSE
	FSET LOG-READER,ACTIVEBIT
	SET 'LOG-COUNTER,0
	CALL READ-LOG >STACK
	RSTACK
?L18:	EQUAL? PRSA,V?LISTEN \?L22
	GRTR? LOG-READER-COUNTER,11 \?L22
	PRINTR """Whine."""
?L22:	EQUAL? PRSA,V?TAKE \?L23
	PRINT WONT-BUDGE
	CALL PRINT-ID,STR?241 >STACK
	RSTACK
?L23:	EQUAL? PRSA,V?SHOOT \FALSE
	CALL PRINT-ID,STR?242
	CALL DEQUEUE,I-LOG-READER
	RFALSE

	.FUNCT LOG-READER-BUTTON-F
	IN? LOG-READER,HERE /?L1
	CALL CANT-SEE,PSEUDO-OBJECT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUSH \FALSE
	IN? LOG-TAPE,LOG-READER \?L4
	FSET? LOG-READER,ACTIVEBIT \?L4
	EQUAL? LOG-COUNTER,10 \?L6
	PRINTI "A mechanized voice from the "
	PRINTD LOG-READER
	PRINTR " says, ""End of Log."""
?L6:	CALL READ-LOG >STACK
	RSTACK
?L4:	PRINT NOTHING-HAPPENS
	RTRUE

	.FUNCT READ-LOG
	INC 'LOG-COUNTER
	EQUAL? LOG-COUNTER,1 \?L1
	PRINTI "A gravelly voice comes from the "
	PRINTD LOG-READER
	PRINTI ": "
?L1:	PRINTI """11349.12."
	EQUAL? LOG-COUNTER,1 \?L4
	PRINTI "2.3800: Some kripping jokers have been pilfering the station's fuel cells to go out on joyrides! I have hidden the fuel cells up in the Dome's "
	PRINTD HOUSING
	PRINTI ", slapped a lock on the bin, and deposited the key in my safe! There will be no joyriding in my command!"
	JUMP ?L14
?L4:	EQUAL? LOG-COUNTER,2 \?L6
	PRINTI "2.5100: Reproductions Officer Hausberg reports that collater #22 is off-line for routine service. Estimates one or two days downtime. Also, unidentified craft detected in sector. No response to hailings. Sending Finsterwald to intercept."
	JUMP ?L14
?L6:	EQUAL? LOG-COUNTER,3 \?L7
	PRINTI "2.6750: Unidentified craft towed to Docking Bay #1. It is a single-cabin vessel of unfamiliar alien origin. The only things aboard were the remains of one of the aliens, and a featureless pyramid. I'll leave it to the eggheads; I've got a problem of my own: a report that a used-spaceship dealer in the village named Shady Dan is selling modified Patrol ID cards. Liaison Officer Bumblewitz is investigating."
	JUMP ?L14
?L7:	EQUAL? LOG-COUNTER,4 \?L8
	PRINTI "3.1900: Professor Schmidt has back-plotted the course of the alien vessel. There are no star systems along the course; he theorizes that it may be of extra-galactic origin."
	JUMP ?L14
?L8:	EQUAL? LOG-COUNTER,5 \?L9
	PRINTI "3.5100: No cooperation from Shady Dan, so I'm putting the village off-limits to station personnel. No more village entry forms will be validated."
	JUMP ?L14
?L9:	EQUAL? LOG-COUNTER,6 \?L10
	PRINTI "3.5250: Some kripping joker snuck into my office and validated a whole batch of village entry forms! I won't take that kind of trot aboard my station! I'll hide the stamp under my bed until I find out who's responsible. Also, I gave Schmidt permission to move the alien pyramid to the "
	PRINTD HOLDING-TANK
	PRINTI " in the Sci Sub-Module for further study; the "
	PRINTD SKELETON
	PRINTI " is too brittle to move, they say. Hmmm... This "
	PRINTD LOG-READER
	PRINTI " is overheating. I'll have to dig out the spare."
	JUMP ?L14
?L10:	EQUAL? LOG-COUNTER,7 \?L11
	PRINTI "3.7700: Equipment Officer Mertzhoffer informs me that there have been several unexplainable breakdowns in the Gymnastic Equipment and the Laundering Machinery. All very simple equipment; could it be sabotage? If so, how? Who? Why?"
	JUMP ?L14
?L11:	EQUAL? LOG-COUNTER,8 \?L12
	PRINTI "4.1650: Emergency communication from the S.P.S. Duffy. They are critically low on "
	PRINT FORM-NAME
	PRINTI ", and are sending someone over to pick up a truckload of them. Reproductions Officer Hausberg says that the #22 collater should be available to prepare the forms."
	JUMP ?L14
?L12:	EQUAL? LOG-COUNTER,9 \?L13
	PRINTI "4.1850: Hausberg reports an unexpected shutdown of web-feeder #17. No apparent reason for the shutdown, and no warning, either. He says that one of his personnel almost lost an arm when it shut down. We may have to halt the entire plant to investigate. No telling how long... What the... Trot! Now the spare "
	PRINTD LOG-READER
	PRINTI " is overheating, also!"
	JUMP ?L14
?L13:	PRINTI "4.1900: One of the ensigns in the filing division was seriously injured when one of the "
	PRINTD WELDER
	PRINTI "s malfunctioned. She's in Sick Bay now; Doc says she should pull through. I've been in space for 32 years and I've never heard of a "
	PRINTD WELDER
	PRINTI " malfun... What the krip!..."
?L14:	PRINTI """"
	EQUAL? LOG-COUNTER,10 /?L15
	CRLF
	PRINTI "   A mechanized voice from the "
	PRINTD LOG-READER
	PRINTI " intones the single word ""More,"" and the red button on the reader lights up."
?L15:	CRLF
	RTRUE

	.FUNCT DIAL-F
	FSET? SAFE,OPENBIT \?L1
	PRINTR "There's not much left of the dial."
?L1:	EQUAL? PRSA,V?SET \?L3
	EQUAL? PRSO,PSEUDO-OBJECT \?L3
	ZERO? PRSI \?L4
	PRINT NEXT-TIME
	RTRUE
?L4:	EQUAL? PRSI,INTNUM /?L6
	PRINT HUH
	RTRUE
?L6:	CALL PERFORM,V?SET,INTNUM
	RTRUE
?L3:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "The dial is set to "
	PRINTN DIAL-SETTING
	PRINT PERIOD-CR
	RTRUE

	.FUNCT SAFE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a top-of-the-line HyperSecurity Safe, featuring a dial with 8000 settings. There are probably between twelve and twenty numbers in the combination"
	IN? DRILLED-HOLE,HERE \?L3
	PRINTI ". There is a hole in the safe"
	CALL DESCRIBE-BIT-SIZE,HOLE-SIZE
?L3:	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?DRILL \?L6
	CALL MAKE-HOLE-WITH-DRILL,SAFE >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?PICK,V?UNLOCK \FALSE
	PRINTR "The galaxy's craftiest safecrackers would be stumped by this baby."

	.FUNCT DESCRIBE-BIT-SIZE,BIT-SIZE
	PRINTI " approximately the diameter of a "
	EQUAL? BIT-SIZE,SMALL-BIT \?L1
	PRINTI "toothpick"
	RTRUE
?L1:	EQUAL? BIT-SIZE,MEDIUM-BIT \?L3
	PRINTI "pencil"
	RTRUE
?L3:	PRINTI "cigar"
	RTRUE

	.FUNCT DRILLED-HOLE-F,OBJ
	EQUAL? HERE,COMMANDERS-QUARTERS \?L1
	SET 'OBJ,SAFE
	JUMP ?L4
?L1:	EQUAL? HERE,LOAN-SHARK \?L3
	SET 'OBJ,STRONG-BOX
	JUMP ?L4
?L3:	SET 'OBJ,HOUSING
?L4:	EQUAL? PRSA,V?PUT \?L5
	EQUAL? PRSI,DRILLED-HOLE \?L5
	EQUAL? PRSO,EXPLOSIVE \?L9
	EQUAL? HOLE-SIZE,SMALL-BIT \?L7
?L9:	CALL DOESNT-FIT,STR?243 >STACK
	RSTACK
?L7:	EQUAL? HERE,DOME \?L10
	PRINTI "As the explosive touches the warm bin, it "
	PRINT SUBLIMES-INTO-FREZONE
	CALL DEQUEUE,I-EXPLOSIVE-MELT
	CALL REMOVE-CAREFULLY,EXPLOSIVE
	CRLF
	RTRUE
?L10:	ZERO? SAFE-HOLE-SCORE \FALSE
	EQUAL? HERE,COMMANDERS-QUARTERS \FALSE
	INC 'ROBOT-EVILNESS
	ADD SCORE,3 >SCORE
	SET 'SAFE-HOLE-SCORE,1
	RFALSE
?L5:	EQUAL? PRSA,V?DRILL \?L13
	CALL PERFORM,PRSA,OBJ
	RTRUE
?L13:	EQUAL? PRSA,V?SHOOT \?L14
	CALL PERFORM,PRSA,OBJ,ZAPGUN
	RTRUE
?L14:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINT ONLY-BLACKNESS
	RTRUE

	.FUNCT MAKE-HOLE-WITH-DRILL,OBJ
	ZERO? DRILL-DEAD /?L1
	CALL PERFORM,V?ON,DRILL
	RTRUE
?L1:	ZERO? HOLE-SIZE /?L12
	IN? DRILLED-HOLE,HERE /?L3
	SET 'DRILL-DEAD,1
	PRINTI "As you begin drilling, the drill sparks and stops running."
	CRLF
	CALL PRINT-ID,STR?244 >STACK
	RSTACK
?L3:	ZERO? HOLE-SIZE \?L4
?L12:	MOVE DRILLED-HOLE,HERE
	FIRST? DRILL >HOLE-SIZE /?L5
?L5:	SET 'C-ELAPSED,30
	PRINTI "You drill a hole in"
	CALL TPRINT,OBJ
	CALL PRINT-ID,STR?245
	CALL DESCRIBE-BIT-SIZE,HOLE-SIZE
	PRINT PERIOD-CR
	RTRUE
?L4:	FIRST? DRILL >STACK /?L7
?L7:	EQUAL? HOLE-SIZE,STACK \?L6
	PRINT SENILITY-STRIKES
	RTRUE
?L6:	EQUAL? HOLE-SIZE,LARGE-BIT /?L9
	IN? SMALL-BIT,DRILL \?L8
?L9:	PRINTI "The hole in the safe is already larger than the bit in the drill."
	CRLF
	CALL PRINT-ID,STR?246 >STACK
	RSTACK
?L8:	FIRST? DRILL >HOLE-SIZE /?L11
?L11:	PRINTI "You enlarge the hole in"
	CALL TPRINT,OBJ
	PRINTI ". It's now"
	CALL PRINT-ID,STR?247
	CALL DESCRIBE-BIT-SIZE,HOLE-SIZE
	PRINT PERIOD-CR
	RTRUE

	.FUNCT STAMP-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTR "It's a fairly standard self-inking rubber stamp."

	.FUNCT ZAPGUN-F
	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "The zapgun is a nasty-looking weapon. Mounted near its ugly maw is an indicator which reads """
	PRINTN ZAPGUN-SHOTS
	PRINTR "."""

	.FUNCT SOUTH-CONNECTION-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The corridor widens as it reaches the hull of the station. To the south, where a Sub-Module connection would be in a station with a Diplomatic Sub-Module, an iris hatch is "
	FSET? IRIS-HATCH,OPENBIT \?L3
	PRINTI "open, leading to a dark corridor which is quite obviously not a connecting tube for a Diplomatic Sub-Module"
	JUMP ?L5
?L3:	PRINTI "closed"
?L5:	PRINTI ". There's a slot next to the hatch. Other doors lead east and west, and a junction with another corridor is visible to the north."
	RTRUE

	.FUNCT LEVEL-FOUR-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You are now on the primary bunk level of the station, with barracks to the north and south. To the east is the elevator "
	EQUAL? ELEVATOR-LEVEL,4 /?L3
	PRINTI "shaft "
?L3:	PRINTI "and the elevator call button. Docking Bay #3 can be entered to the west"
	PRINT LADDER-LEADS
	RTRUE

	.FUNCT LEVEL-THREE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "From this lobby you can choose doors that lie to the north, south, or northwest. An additional doorway leads southwest. The elevator "
	EQUAL? ELEVATOR-LEVEL,3 /?L3
	PRINTI "shaft "
?L3:	PRINTI "and button are just to the east"
	PRINT LADDER-LEADS
	RTRUE

	.FUNCT GYM-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a huge room where station personnel keep in shape via exercise and recreational sports. "
	IN? EXERCISE-MACHINE,HERE /?L3
	PRINTI "There's a sign on one wall. "
?L3:	PRINTI "The sole exit is south."
	RTRUE

	.FUNCT EXERCISE-MACHINE-F,OARG
	ZERO? OARG \FALSE
	EQUAL? PRSA,V?ENTER \?L3
	CALL RUNNING?,I-EXERCISE-MACHINE >STACK
	ZERO? STACK /?L4
	PRINTI "The "
	PRINTD EXERCISE-MACHINE
	CALL PRINT-ID,STR?248
	CALL JIGS-UP,STR?249 >STACK
	RSTACK
?L4:	EQUAL? HERE,COMPUTER-CONTROL \FALSE
	PRINTR "The forklift is in the way."
?L3:	EQUAL? PRSA,V?OFF,V?ON \?L8
	PRINTR "It's permanently on."
?L8:	EQUAL? PRSA,V?EXAMINE \?L9
	IN? PROTAGONIST,EXERCISE-MACHINE /?L9
	PRINTI "There's no one in"
	CALL TRPRINT,EXERCISE-MACHINE
	RTRUE
?L9:	EQUAL? PRSA,V?MUNG,V?KILL \?L10
	PRINTI "The "
	PRINTD EXERCISE-MACHINE
	PRINTI " is made of zynoid-reinforced hyper-steel."
	CRLF
	CALL PRINT-ID,STR?250 >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?USE \FALSE
	IN? PROTAGONIST,EXERCISE-MACHINE \?L12
	CALL V-EXERCISE >STACK
	RSTACK
?L12:	PRINTR "You're not even in it!"

	.FUNCT LAUNDRY-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "All laundry rooms, planetside as well as in space, tend to look alike. This one is no exception."
	FSET? DRYER,ACTIVEBIT \?L3
	PRINTI " "
	CALL DESCRIBE-DRYER-HEAT
?L3:	PRINTI " The door lies on the east side."
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \?L6
	FSET? PRESSER,ACTIVEBIT \?L6
	CALL QUEUE,I-PRESSER,40 >STACK
	RSTACK
?L6:	EQUAL? RARG,M-END \FALSE
	GRTR? DRYER-COUNTER,15 \FALSE
	PRINTI "   The heat from the dryer is too much to stand! You stumble mindlessly out into the corridor"
	PRINT ELLIPSIS
	CALL GOTO,LEVEL-THREE >STACK
	RSTACK

	.FUNCT DRYER-F
	EQUAL? PRSA,V?LOOK-BEHIND \?L1
	PRINTR "You see a huge pile of Patrol-issue socks, hundreds of them, all mismatched."
?L1:	EQUAL? PRSA,V?ON \?L3
	FSET? DRYER,ACTIVEBIT /?L3
	FSET DRYER,ACTIVEBIT
	CALL QUEUE,I-DRYER,-1
	PRINTR "An abnormal amount of hot air blasts out from all sides of the dryer."
?L3:	EQUAL? PRSA,V?OFF \?L4
	FSET? DRYER,ACTIVEBIT \?L4
	FCLEAR DRYER,ACTIVEBIT
	CALL DEQUEUE,I-DRYER
	SET 'DRYER-COUNTER,0
	PRINTR "With the dryer off, the station's ventilation system quickly returns the room to a comfy twenty-three degrees Celsius."
?L4:	EQUAL? PRSA,V?OPEN \?L5
	FSET? DRYER,ACTIVEBIT \?L5
	PRINTI "Opening the dryer automatically shuts it off. "
	FSET DRYER,OPENBIT
	CALL PERFORM,V?OFF,DRYER
	RTRUE
?L5:	EQUAL? PRSA,V?SHOOT \FALSE
	CALL PRINT-ID,STR?251
	FCLEAR DRYER,ACTIVEBIT
	CALL DEQUEUE,I-DRYER
	SET 'DRYER-COUNTER,0
	RFALSE

	.FUNCT DESCRIBE-DRYER-HEAT
	GRTR? DRYER-COUNTER,14 \?L1
	PRINTI "Searing blasts of air from the dryer have made the room unbearably hot."
	CALL PRINT-ID,STR?252 >STACK
	RSTACK
?L1:	GRTR? DRYER-COUNTER,9 \?L3
	PRINTI "Thanks to the dryer, the laundry room is now incredibly toasty."
	RTRUE
?L3:	PRINTI "The dryer is making the room uncomfortably hot."
	RTRUE

	.FUNCT PRESSER-F,OARG=0
	ZERO? OARG /?L1
	FSET? PRESSER,ACTIVEBIT \FALSE
	EQUAL? OARG,M-OBJDESC? /TRUE
	PRINTI "   "
	CALL DESCRIBE-PRESSER >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L9
	FSET? PRESSER,ACTIVEBIT \?L10
	CALL DESCRIBE-PRESSER
	PRINTI " "
?L10:	PRINTI "The presser is currently o"
	FSET? PRESSER,ACTIVEBIT \?L13
	PRINTI "n"
	JUMP ?L15
?L13:	PRINTI "ff"
?L15:	PRINTI ". "
	RFALSE
?L9:	EQUAL? PRSA,V?PUT-ON \?L16
	EQUAL? PRSI,PRESSER \?L16
	CALL PERFORM,V?PUT,PRSO,PRSI
	RTRUE
?L16:	EQUAL? PRSA,V?CLOSE \?L17
	FSET? PRESSER,ACTIVEBIT \?L17
	IN? CRUMPLED-FORM,PRESSER \?L18
	REMOVE CRUMPLED-FORM
	MOVE VILLAGE-FORM,PRESSER
?L18:	IN? PATROL-UNIFORM,PRESSER \FALSE
	SET 'SUIT-PRESSED,1
	RFALSE
?L17:	EQUAL? PRSA,V?ON \?L24
	FSET? PRESSER,ACTIVEBIT /?L24
	SET 'PRESSER-STEAMING,0
	FSET PRESSER,ACTIVEBIT
	CALL QUEUE,I-PRESSER,25
	FSET? PRESSER,OPENBIT /?L30
	IN? CRUMPLED-FORM,PRESSER \?L27
	REMOVE CRUMPLED-FORM
	MOVE VILLAGE-FORM,PRESSER
?L27:	IN? PATROL-UNIFORM,PRESSER \?L30
	SET 'SUIT-PRESSED,1
?L30:	PRINTR "A trickle of steam begins leaking from the presser."
?L24:	EQUAL? PRSA,V?SHOOT \FALSE
	CALL PRINT-ID,STR?253
	CALL DEQUEUE,I-PRESSER
	RFALSE

	.FUNCT DESCRIBE-PRESSER
	PRINTI "A "
	ZERO? PRESSER-STEAMING /?L1
	PRINTI "huge amount"
	JUMP ?L3
?L1:	PRINTI "trickle"
?L3:	PRINTI " of steam is coming from the laundry room's presser."
	RTRUE

	.FUNCT I-PRESSER
	FSET? PRESSER,ACTIVEBIT \FALSE
	EQUAL? HERE,LAUNDRY \FALSE
	PRINTI "   "
	ZERO? PRESSER-STEAMING /?L3
	PRINTI "The presser suddenly "
	FSET? PRESSER,OPENBIT /?L5
	PRINTI "opens, "
?L5:	CALL PRINT-ID,STR?254
	CALL JIGS-UP,STR?255 >STACK
	RSTACK
?L3:	SET 'PRESSER-STEAMING,1
	CALL QUEUE,I-PRESSER,25
	PRINTR "The presser shudders, and clouds of steam begin billowing out of it."

	.FUNCT CHAPEL-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a modest, nondenominational chapel. Hanging high above the "
	IN? PULPIT,HERE \?L3
	PRINTI "beautiful wooden pulpit "
	JUMP ?L5
?L3:	PRINTI "floor "
?L5:	FSET? STAR,TOUCHBIT /?L6
	PRINTI "are the two"
	JUMP ?L8
?L6:	PRINTI "is one of the"
?L8:	PRINTI " universal symbols of every major galactic religion: an "
	PRINTD ETERNAL-FLAME
	FSET? STAR,TOUCHBIT /?L9
	PRINTI " and a "
	PRINTD STAR
?L9:	PRINTI ". "
	FSET? ETERNAL-FLAME,ONBIT \?L12
	PRINTI "The flame flickers in the air currents. "
	JUMP ?L14
?L12:	PRINT FLAME-EXTINGUISHED
	PRINTI " "
?L14:	PRINTI "A doorway occupies the center of the east wall."
	FSET? STAR,TOUCHBIT /TRUE
	CRLF
	PRINTI "   The star is blinking."
	RTRUE

	.FUNCT STAR-F
	CALL TOUCHING?,STAR >STACK
	ZERO? STACK /?L1
	FSET? STAR,TRYTAKEBIT \?L1
	ZERO? HANGING-IN-AIR \?L1
	PRINTR "The star is above you, beyond your reach."
?L1:	EQUAL? PRSA,V?TAKE \?L3
	FSET? STAR,TRYTAKEBIT \?L3
	ZERO? HANGING-IN-AIR /?L3
	FCLEAR STAR,TRYTAKEBIT
	FCLEAR STAR,NDESCBIT
	FSET STAR,TOUCHBIT
	MOVE STAR,PROTAGONIST
	INC 'ROBOT-EVILNESS
	GETP DIODE-M,P?VALUE >STACK
	ADD SCORE,STACK >SCORE
	PUTP DIODE-M,P?VALUE,0
	PRINTR "Taken."
?L3:	EQUAL? PRSA,V?EXAMINE \?L4
	IN? DIODE-M,STAR \?L5
	PRINTI "It's blinking with a gentle, rhythmic light. "
?L5:	FSET? STAR,TRYTAKEBIT \?L8
	ZERO? HANGING-IN-AIR \?L8
	CALL PERFORM,V?TOUCH,STAR
	RTRUE
?L8:	PRINTI "The back of the star "
	FSET? STAR,OPENBIT \?L11
	PRINTI "is open"
	JUMP ?L13
?L11:	PRINTI "looks openable"
?L13:	PRINT PERIOD-CR
	RTRUE
?L4:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,DIODE-J \FALSE
	REMOVE DIODE-J
	PRINTR "Once the diode is in place, the star begins blinking rapidly and erratically. Suddenly the diode bursts and the star goes dead."

	.FUNCT ETERNAL-FLAME-F
	EQUAL? PRSA,V?EXAMINE \?L1
	FSET? ETERNAL-FLAME,ONBIT \?L3
	PRINTI "The "
	PRINTD ETERNAL-FLAME
	PRINTI " burns high above the floor of the chapel. It looks like a reproduction of the "
	PRINTD ETERNAL-FLAME
	PRINTR " designed by the 108th century artist, Ernie DaCosta, for the Sierra Vista Monastery on Bulbus VII."
?L3:	PRINT FLAME-EXTINGUISHED
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?OFF,V?ON \?L6
	ZERO? HANGING-IN-AIR \?L7
	PRINTI "The flame is high above your head, and besides that, t"
	JUMP ?L9
?L7:	PRINTI "T"
?L9:	PRINTR "here doesn't seem to be a switch on the flame."
?L6:	CALL TOUCHING?,ETERNAL-FLAME >STACK
	ZERO? STACK /?L10
	ZERO? HANGING-IN-AIR \?L10
	CALL CANT-REACH,ETERNAL-FLAME >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?SHOOT \FALSE
	FSET? ETERNAL-FLAME,ONBIT \FALSE
	PRINTI "Perhaps that made the flame hotter; there was really no way to tell."
	CRLF
	CALL PRINT-ID,STR?256 >STACK
	RSTACK

	.FUNCT PULPIT-F
	EQUAL? PRSA,V?STAND-ON,V?CLIMB-UP,V?CLIMB-ON /?L3
	EQUAL? PRSA,V?ENTER \?L1
?L3:	ZERO? HANGING-IN-AIR /?L4
	CALL CANT-REACH,PULPIT >STACK
	RSTACK
?L4:	PRINTI "The pulpit sways, and you fall off."
	CALL PRINT-ID,STR?257
	FSET? PULPIT,TOUCHBIT /?L7
	PRINTI " However, it wasn't a wasted effort: "
	CALL PERFORM,V?EXAMINE,PULPIT
	RTRUE
?L7:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L10
	FSET? PULPIT,TOUCHBIT /?L10
	FSET PULPIT,TOUCHBIT
	PRINTR "You discover that the pulpit seems openable!"
?L10:	EQUAL? PRSA,V?SHOOT \FALSE
	REMOVE PULPIT
	REMOVE SWITCH
	PRINTI "In a rain of hellfire and brimstone, the pulpit is banished."
	CRLF
	CALL PRINT-ID,STR?258 >STACK
	RSTACK

	.FUNCT SWITCH-F
	EQUAL? PRSA,V?THROW,V?OFF,V?ON /?L3
	EQUAL? PRSA,V?SET,V?MOVE,V?PUSH \FALSE
?L3:	ZERO? HANGING-IN-AIR /?L4
	CALL CANT-REACH,SWITCH
	RTRUE
?L4:	PRINTI "The "
	PRINTD ETERNAL-FLAME
	PRINTI " "
	FSET? ETERNAL-FLAME,ONBIT \?L7
	FCLEAR ETERNAL-FLAME,ACTIVEBIT
	FCLEAR ETERNAL-FLAME,ONBIT
	PRINTR "goes out!"
?L7:	FSET ETERNAL-FLAME,ACTIVEBIT
	FSET ETERNAL-FLAME,ONBIT
	PRINTI "flickers back on."
	IN? BALLOON,HERE \?L10
	MOVE BALLOON,LEVEL-THREE
	MOVE LEASH,LEVEL-THREE
	PRINTI " The "
	PRINTD BALLOON
	PRINTI " shoots out of the Chapel."
?L10:	CRLF
	RTRUE

	.FUNCT THEATRE-SEAT-F
	EQUAL? PRSA,V?CLIMB-ON,V?ENTER \FALSE
	SET 'PRSO,ROOMS
	CALL V-SIT >STACK
	RSTACK

	.FUNCT PROJECTION-BOOTH-F
	EQUAL? PRSA,V?WALK-TO,V?ENTER,V?OPEN /?L3
	EQUAL? PRSA,V?SEARCH \?L1
?L3:	PRINTR "The projection booth is closed and locked."
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINT ONLY-BLACKNESS
	RTRUE

	.FUNCT MESS-HALL-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This open dining area seats around 30 people. "
	PRINTD FPU
	PRINTI "s curve along the exterior wall. There's a doorway to the southeast, and doors lead north, south, and northeast. To the east are the elevator"
	EQUAL? ELEVATOR-LEVEL,2 /?L3
	PRINTI " shaft"
?L3:	PRINTI ", the elevator button, and the up-down ladder."
	RTRUE

	.FUNCT FPU-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The units curve around the outside wall of the Mess Hall. The interface is delightfully simple: a user simply turns on the unit and immediately receives a tasty and nutritionally-balanced meal."
?L1:	EQUAL? PRSA,V?ON \FALSE
	PRINTI "A taped voice, in a cheery contralto, says, ""Good "
	LESS? INTERNAL-MOVES,3000 \?L4
	PRINTI "morning"
	JUMP ?L7
?L4:	GRTR? INTERNAL-MOVES,5000 \?L6
	PRINTI "evening"
	JUMP ?L7
?L6:	PRINTI "afternoon"
?L7:	PRINTI "! Today's menu features "
	LESS? INTERNAL-MOVES,3000 \?L8
	PRINTI "sausage, frobbled eggs, and teakberry juice"
	JUMP ?L11
?L8:	GRTR? INTERNAL-MOVES,5000 \?L10
	PRINTI "chicken pot pie, braised volpoid livers, and mashed Rigellian yams"
	JUMP ?L11
?L10:	PRINTI "a bacon, lettuce, and frombucko sandwich"
?L11:	PRINTI ". Eat hearty! Dispensing will now begin."" A seamless hatch in the FDU opens, and a stream of acid shoots out. You leap aside as the acid etches the floor, leaving behind some acrid fumes."
	CRLF
	CALL PRINT-ID,STR?259 >STACK
	RSTACK

	.FUNCT COFFEE-F,OARG=0
	ZERO? OARG /?L1
	FSET? COFFEE,TOUCHBIT /FALSE
	EQUAL? OARG,M-OBJDESC? /TRUE
	PRINTI "   A cup of thick brown coffee sits on one of the tables"
	EQUAL? DAY,1 \?L7
	PRINTI ". It's still steaming, though there's no one in sight"
?L7:	PRINTI "."
	RTRUE
?L1:	EQUAL? PRSA,V?THROW,V?EMPTY,V?POUR \?L10
	EQUAL? PRSO,COFFEE \?L10
	CALL MESS,STR?260
	CALL ANTI-LITTER,COFFEE >STACK
	RSTACK
?L10:	EQUAL? PRSA,V?TOUCH,V?EXAMINE,V?TASTE /?L12
	EQUAL? PRSA,V?LOOK-INSIDE,V?REACH-IN \?L11
?L12:	EQUAL? DAY,1 \?L11
	PRINTR "The coffee is still hot."
?L11:	EQUAL? PRSA,V?TASTE \?L13
	PRINTI "It tastes unusually bitter."
	CRLF
	CALL PRINT-ID,STR?261 >STACK
	RSTACK
?L13:	EQUAL? PRSA,V?SMELL \?L14
	PRINTR "The coffee has a vague chemical odor."
?L14:	EQUAL? PRSA,V?REACH-IN,V?LOOK-INSIDE,V?EXAMINE /?L16
	EQUAL? PRSA,V?TOUCH \?L15
?L16:	PRINTR "The cup is filled with cold coffee."
?L15:	EQUAL? PRSA,V?EAT-FROM \?L17
	CALL PERFORM,V?EAT,COFFEE
	RTRUE
?L17:	EQUAL? PRSA,V?EAT \FALSE
	ZERO? HUNGER-LEVEL \?L19
	PRINT NOT-HUNGRY
	RTRUE
?L19:	CALL PRINT-ID,STR?262
	CALL JIGS-UP,STR?263 >STACK
	RSTACK

	.FUNCT DETONATOR-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a state-of-the-art detonator, fairly cubical with two connection points. "
	ZERO? TIMER-CONNECTED /?L3
	PRINTI "A timer is attached at one of those points"
	ZERO? EXPLOSIVE-CONNECTED /?L5
	PRINTI ", and an explosive is attached at the other"
?L5:	PRINTI ". "
	JUMP ?L8
?L3:	ZERO? EXPLOSIVE-CONNECTED /?L8
	PRINTI "An explosive is attached at one of those points. "
?L8:	FSET? DETONATOR,OPENBIT \?L10
	PRINTI "The detonator is open"
	FIRST? DETONATOR >STACK \?L12
	PRINTI " and contains"
	FIRST? DETONATOR >STACK /?L14
?L14:	CALL ARPRINT,STACK
	RTRUE
?L12:	PRINT PERIOD-CR
	RTRUE
?L10:	PRINTR "There is a faint crack running around the outside of the detonator, indicating that perhaps it can be opened."
?L1:	EQUAL? PRSA,V?CONNECT \?L17
	EQUAL? TIMER,PRSO,PRSI \?L18
	ZERO? TIMER-CONNECTED /?L20
	PRINT SENILITY-STRIKES
	RTRUE
?L20:	SET 'TIMER-CONNECTED,1
	PRINTR "Done."
?L18:	EQUAL? EXPLOSIVE,PRSO,PRSI \?L23
	ZERO? EXPLOSIVE-CONNECTED /?L24
	PRINT SENILITY-STRIKES
	RTRUE
?L24:	SET 'EXPLOSIVE-CONNECTED,1
	PRINTR "Done (Footnote 13)."
?L23:	PRINT YOU-CANT
	PRINTR "connect the detonator to that!"
?L17:	EQUAL? PRSA,V?DISCONNECT \?L28
	ZERO? PRSI \?L29
	ZERO? EXPLOSIVE-CONNECTED \?L33
	ZERO? TIMER-CONNECTED /FALSE
?L33:	PRINT DETACH
	ZERO? TIMER-CONNECTED /?L34
	PRINTI "the timer"
	ZERO? EXPLOSIVE-CONNECTED /?L39
	PRINTI " and the explosive"
	JUMP ?L39
?L34:	PRINTI "the explosive"
?L39:	SET 'EXPLOSIVE-CONNECTED,0
	SET 'TIMER-CONNECTED,0
	PRINT PERIOD-CR
	RTRUE
?L29:	EQUAL? EXPLOSIVE,PRSO,PRSI \?L41
	ZERO? EXPLOSIVE-CONNECTED /?L41
	SET 'EXPLOSIVE-CONNECTED,0
	PRINT DETACH
	PRINTR "the explosive."
?L41:	EQUAL? TIMER,PRSO,PRSI \FALSE
	ZERO? TIMER-CONNECTED /FALSE
	SET 'TIMER-CONNECTED,0
	PRINT DETACH
	PRINTR "the timer."
?L28:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,DETONATOR \FALSE
	FSET? DETONATOR,OPENBIT \FALSE
	EQUAL? PRSO,BLACKENED-DIODE,DIODE-M,DIODE-J /?L45
	CALL DOESNT-FIT,STR?264 >STACK
	RSTACK
?L45:	FIRST? DETONATOR >STACK \FALSE
	PRINTI "There's a "
	FIRST? DETONATOR >STACK /?L48
?L48:	PRINTD STACK
	PRINTR " in the way."

	.FUNCT BLACKENED-DIODE-F
	EQUAL? PRSA,V?CLEAN \?L1
	ZERO? DIODE-CLEANED /?L3
	PRINTR "You've de-charred the diode to the max."
?L3:	SET 'DIODE-CLEANED,1
	PRINTI "You scrape off enough black that y"
	PRINT MAKE-OUT-AN-M
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L6
	ZERO? DIODE-CLEANED /?L7
	PRINTI "Y"
	PRINT MAKE-OUT-AN-M
	RTRUE
?L7:	PRINTR "The diode is so charred you can't even tell what series it is."
?L6:	EQUAL? PRSA,V?COMPARE \FALSE
	EQUAL? DIODE-J,PRSO,PRSI /?L11
	EQUAL? DIODE-M,PRSO,PRSI \FALSE
?L11:	PRINTI "They're identical in size and shape, but"
	CALL TPRINT,BLACKENED-DIODE
	PRINTR " is covered with char."

	.FUNCT MAGAZINE-F
	EQUAL? PRSA,V?TAKE \?L1
	CALL PRINT-ID,STR?265
	CALL RECORDING,STR?266 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE,V?OPEN,V?READ /?L4
	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
?L4:	PRINTR "You glance at the magazines. The most familiar ones are ""Popular Patrolling,"" ""The Galactic Enquirer,"" and ""True Tales of Adventure."" However, they're all issues which you've already read back on the Duffy, so they're not too interesting."

	.FUNCT NANOFILM-READER-F,SPOOL
	FIRST? NANOFILM-READER >SPOOL /?L1
?L1:	EQUAL? PRSA,V?CLOSE \?L2
	PRINT HUH
	RTRUE
?L2:	EQUAL? PRSA,V?EXAMINE \?L4
	PRINTI "The "
	PRINTD NANOFILM-READER
	PRINTI " must be a voice-output model, since it has no screen. The reader is o"
	FSET? NANOFILM-READER,ACTIVEBIT \?L5
	PRINTI "n"
	JUMP ?L7
?L5:	PRINTI "ff"
?L7:	PRINTI ", and there is "
	ZERO? SPOOL /?L8
	PRINTI "a "
	PRINTD SPOOL
	JUMP ?L10
?L8:	PRINTI "no spool"
?L10:	PRINTR " in the reader."
?L4:	EQUAL? PRSA,V?PUT \?L11
	EQUAL? PRSO,LILAC-SPOOL,PUCE-SPOOL,MAUVE-SPOOL /?L12
	PRINTR "It doesn't fit."
?L12:	ZERO? SPOOL /?L14
	PRINTR "There's already a spool in the reader."
?L14:	FSET? NANOFILM-READER,ACTIVEBIT \FALSE
	MOVE PRSO,NANOFILM-READER
	FCLEAR NANOFILM-READER,ACTIVEBIT
	CALL PERFORM,V?ON,NANOFILM-READER
	RTRUE
?L11:	EQUAL? PRSA,V?ON \FALSE
	FSET? NANOFILM-READER,ACTIVEBIT /FALSE
	ZERO? SPOOL /FALSE
	FSET NANOFILM-READER,ACTIVEBIT
	PRINTI "The reader, in a surprisingly human voice, says, """
	EQUAL? SPOOL,MAUVE-SPOOL \?L18
	PRINTI "Gamma-Delta-Gamma class Deep-Space Stations are equipped with a full range of collating machinery. The workhorse of the..."" There is a burst of static from the reader. ""...common malfunction of this large collater. First check the lower fromitz..."" More static. ""...and replace with"
	JUMP ?L21
?L18:	EQUAL? SPOOL,LILAC-SPOOL \?L20
	PRINTI "Replacement of depleted fuel cells on a Forms Transport "
	PRINTD SPACETRUCK
	PRINTI " is a fast and simple proc..."" Static. ""...with the quarnum wrench against the..."" More serious static. ""...at which point the fuel cell opening will appear"
	JUMP ?L21
?L20:	PRINTI "Maintenance of the chapel equipment is simple, and should take little time away from your Chaplain duties. Fuel must be added periodically to the flame's fuel reservoir, located..."" A loud burst of static drowns out the recording. ""...ontact the station's Requisitions Officer if replacements are unavailable from the..."" More static. ""...iode in the Chapel's star has an expected life of"
?L21:	PRINTR "..."" A long burst of static. Suddenly the voice changes in timbre and begins laughing and saying, ""You will die, human! All humans will die! You will die, human!"""

	.FUNCT DOME-OBJECT-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?EXAMINE \?L1
	PRINT DOME-DESC
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?WALK-AROUND \FALSE
	CALL DO-WALK,P?NORTH >STACK
	RSTACK

	.FUNCT DOME-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is inarguably the most bucolic spot aboard the station. Pebbled paths wind among beautiful and exotic shrubbery, culled from millenia of galactic exploration. "
	PRINT DOME-DESC
	PRINTI " East of where you are standing are an elevator"
	EQUAL? ELEVATOR-LEVEL,1 /?L3
	PRINTI " shaft"
?L3:	PRINTI ", a button, and the top of a ladder. Next to the ladder "
	ZERO? GRATING-LOOSE /?L6
	PRINTI "is"
	JUMP ?L8
?L6:	PRINTI "are"
?L8:	PRINTI " an "
	PRINTD GRATING
	FSET? GRATING,TOUCHBIT \?L9
	PRINTI ", which has been bent back from the air shaft to form an opening."
	RTRUE
?L9:	ZERO? GRATING-LOOSE /?L11
	PRINTI ", which looks a bit loose."
	RTRUE
?L11:	PRINTI " and a thick metal "
	PRINTD HOUSING
	PRINTI " with a sign stencilled on it."
	RTRUE

	.FUNCT SHRUBBERY-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "There are too many varieties to describe them all: junipers, rose bushes, dogwoods, gliffgubbers, Rhomboidal Pellet Trees..."
?L1:	EQUAL? PRSA,V?SHOOT \?L3
	PRINTI "One of the many shrubs is now history, you plant-hater."
	CRLF
	CALL PRINT-ID,STR?267 >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?EAT \?L4
	PRINTR "None of the plants are edible."
?L4:	EQUAL? PRSA,V?WALK-AROUND \?L5
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?LOOK-INSIDE,V?SEARCH \?L6
	PRINTR "You find nothing besides a few repulsive insects."
?L6:	EQUAL? PRSA,V?ENTER \FALSE
	PRINTI "A few hidden thorns cause a quick change of plan."
	CRLF
	CALL PRINT-ID,STR?268 >STACK
	RSTACK

	.FUNCT HOUSING-F
	EQUAL? PRSA,V?UNLOCK \?L1
	EQUAL? PRSI,KEY \?L1
	FCLEAR HOUSING,LOCKEDBIT
	PRINTR "You unlock the bin."
?L1:	EQUAL? PRSA,V?PUT \?L3
	EQUAL? PRSO,KEY \?L3
	CALL NOUN-USED,W?LOCK,HOUSING >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?UNLOCK,HOUSING,KEY
	RTRUE
?L3:	EQUAL? PRSA,V?OPEN \?L4
	FSET? HOUSING,LOCKEDBIT /?L4
	SET 'GRATING-LOOSE,1
	CALL QUEUE,I-ANNOUNCEMENT,140
	CALL DEQUEUE,I-SLEEP-WARNINGS
	CALL DEQUEUE,I-HUNGER-WARNINGS
	CALL ROB,PROTAGONIST,HERE
	REMOVE HOUSING
	CALL MOVE-FLOYD-TO-FACTORY
	PRINTI "You open the bin, revealing fertilizer, gardening tools, and a supply of fuel cells. Suddenly, the cells explode! The heat and shock toss you halfway across the dome! Your solitary thought before succumbing to unconsciousness is how grateful you are that you landed in such a soft shrub.

...an undetermined amount of time later, you come to, shake away the cobwebs, and look around"
	PRINT ELLIPSIS
	CALL PRINT-ID,STR?269
	CALL V-LOOK
	SET 'C-ELAPSED,63
	RETURN C-ELAPSED
?L4:	EQUAL? PRSA,V?DRILL \?L5
	CALL MAKE-HOLE-WITH-DRILL,HOUSING >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTI "The bin is closed, and there's a sign on it"
	IN? DRILLED-HOLE,HERE \?L7
	PRINTI ". A hole has been drilled in it"
	CALL DESCRIBE-BIT-SIZE,HOLE-SIZE
?L7:	PRINTI ". A lock has been newly welded to the bin. "
	CALL PERFORM,V?TOUCH,HOUSING
	RTRUE
?L6:	EQUAL? PRSA,V?PICK \?L10
	CALL PERFORM,V?PICK,STRONG-BOX
	RTRUE
?L10:	EQUAL? PRSA,V?TOUCH \FALSE
	PRINTR "The bin is warm to the touch."

	.FUNCT GRATING-F
	EQUAL? HERE,COMPUTER-CONTROL \?L1
	CALL TOUCHING?,GRATING >STACK
	ZERO? STACK /?L1
	CALL CANT-REACH,GRATING >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?PUT \?L3
	CALL WASTES >STACK
	RSTACK
?L3:	EQUAL? HERE,BOTTOM-OF-AIR-SHAFT \?L4
	EQUAL? PRSA,V?STAND-ON,V?KICK,V?OPEN \?L5
	CALL QUEUE,I-ANNOUNCEMENT,1
	PRINTI "The grating opens, spilling you into the room below"
	PRINT ELLIPSIS
	CALL PRINT-ID,STR?270
	CALL QUEUE,I-EXERCISE-MACHINE,-1
	CALL ROB,BOTTOM-OF-AIR-SHAFT,COMPUTER-CONTROL
	CALL ROB,PEDESTAL
	MOVE PEDESTAL,FACTORY
	MOVE PYRAMID,PEDESTAL
	CALL GOTO,COMPUTER-CONTROL >STACK
	RSTACK
?L5:	EQUAL? PRSA,V?ENTER \?L7
	CALL DO-FIRST,STR?271 >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTR "There's a lighted area below the grating, but you can't see any details."
?L4:	EQUAL? PRSA,V?EXAMINE \?L10
	FSET? GRATING,TOUCHBIT \?L11
	PRINTR "The grating has been bent back far enough for you to squeeze through."
?L11:	ZERO? GRATING-LOOSE /FALSE
	PRINTI "The "
	PRINTD GRATING
	PRINTR " looks loose."
?L10:	EQUAL? PRSA,V?ENTER \?L15
	EQUAL? HERE,TOP-OF-AIR-SHAFT \?L16
	CALL GOTO,DOME >STACK
	RSTACK
?L16:	EQUAL? HERE,COMPUTER-CONTROL \?L18
	CALL PERFORM,V?TOUCH,GRATING
	RTRUE
?L18:	FSET? GRATING,TOUCHBIT \?L19
	CALL DEQUEUE,I-WELDER
	CALL GOTO,TOP-OF-AIR-SHAFT >STACK
	RSTACK
?L19:	PRINTR "Impossible, unless you can pass through holes a centimeter across."
?L15:	EQUAL? PRSA,V?TAKE,V?MOVE,V?PUSH /?L22
	EQUAL? PRSA,V?OPEN \?L21
?L22:	ZERO? LIT \?L23
	PRINT TOO-DARK
	CRLF
	RTRUE
?L23:	FSET? GRATING,TOUCHBIT \?L25
	PRINT SENILITY-STRIKES
	RTRUE
?L25:	ZERO? GRATING-LOOSE /?L26
	FSET GRATING,TOUCHBIT
	PRINTI "With effort, you bend the grating and form an opening large enough to enter."
	CRLF
	CALL PRINT-ID,STR?272 >STACK
	RSTACK
?L26:	PRINTR "The grating is securely affixed."
?L21:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINT ONLY-BLACKNESS
	RTRUE

	.FUNCT LEVEL-SIX-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The elevator button is east of you, next to the elevator"
	EQUAL? ELEVATOR-LEVEL,6 /?L3
	PRINTI " shaft"
?L3:	PRINTI ". This main corridor continues around the shaft to the southeast. Huge doors lie just northwest and southwest of here; smaller doors lead north and south"
	PRINT LADDER-LEADS
	RTRUE

	.FUNCT ALIEN-SHIP-PSEUDO-F
	EQUAL? PRSA,V?ENTER \?L1
	EQUAL? HERE,ALIEN-SHIP \?L3
	PRINT LOOK-AROUND
	RTRUE
?L3:	CALL DO-WALK,P?IN >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?DISEMBARK,V?EXIT,V?LEAVE \?L6
	EQUAL? HERE,ALIEN-SHIP \?L7
	CALL DO-WALK,P?OUT >STACK
	RSTACK
?L7:	PRINT LOOK-AROUND
	RTRUE
?L6:	EQUAL? PRSA,V?EXAMINE \?L10
	EQUAL? HERE,ALIEN-SHIP \?L11
	CALL V-LOOK >STACK
	RSTACK
?L11:	PRINTR "The ship is of a totally unfamiliar design. Something about it makes your skin crawl."
?L10:	EQUAL? HERE,ALIEN-SHIP \FALSE
	EQUAL? PRSA,V?SEARCH \FALSE
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RTRUE

	.FUNCT ALIEN-HATCH-F
	EQUAL? PRSA,V?OPEN \?L1
	PRINTR "It is!"
?L1:	EQUAL? PRSA,V?CLOSE \FALSE
	PRINT WONT-BUDGE
	RTRUE

	.FUNCT ALIEN-SHIP-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "Something about this cabin makes your skin crawl. Perhaps it's merely the unpleasant colors and odd textures and disturbing angles of this ship -- despite your frequent contact with alien races you've never encountered anything that seemed as unhuman as this ship.
   There are no controls in sight, but there is a sturdy pedestal in the exact center of the room. "
	FIRST? PEDESTAL >STACK /?L3
	PRINTI "The pedestal is empty. "
?L3:	PRINTI "The only other features of the cabin are some dots on the wall and the hatch leading out."
	RTRUE
?L1:	EQUAL? RARG,M-END \FALSE
	IN? FLOYD,HERE \FALSE
	IN? SKELETON,HERE \FALSE
	ZERO? SKELETON-COMMENT \FALSE
	SET 'SKELETON-COMMENT,1
	PRINTR "   Floyd notices the skeleton, and some of the color drains out of his face plates. ""Floyd scared,"" he whimpers."

	.FUNCT PATTERN-OF-DOTS-F
	EQUAL? PRSA,V?READ,V?EXAMINE \?L1
	PRINTR "The dots form a seemingly meaningless pattern:

   .. ..

   .. .... . ... . ... ... . ...

   .. ... .

   .... . ... .

   .. ... .

Each dot is a featureless black spot about a centimeter across."
?L1:	EQUAL? PRSA,V?TASTE \FALSE
	PRINTR "It takes a lot of willpower and an equal amount of lip-wetting to make it through all the dots:
   ""(sweet/slightly-bitter) (sweet/very-sour)
   (sweet/very-sweet) (sour/bland/bland/sour) (very-salty) (very-sweet/bland/sour) (bland) (bland/salty/sour) (bitter/sour/very-sour) (slightly-sour) (bitter/salty/bitter)
   (very-sweet/very-salty) (spicy-hot/bland/bland) (very-sweet)
   (sour/bland/sour/sweet) (bland) (very-salty/salty/sour) (very-sweet)
   (bland/bitter) (bland/sour/very-sour) (very-salty)."""

	.FUNCT PEDESTAL-F
	EQUAL? PRSA,V?CLIMB-UP,V?CLIMB-ON,V?ENTER /?L3
	EQUAL? PRSA,V?STAND-ON \FALSE
?L3:	EQUAL? HERE,FACTORY \?L4
	PRINTR "The pyramid chirps, ""Occupied!"" Well, actually it didn't speak at all, but you get the idea."
?L4:	PRINTR "You stand on the pedestal for a moment, but an inexplicable wave of vertigo comes over you, and you fall to the deck."

	.FUNCT SKELETON-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's fairly humanoid in shape. The most unusual feature of the "
	PRINTD SKELETON
	PRINTR " is an unusually overdeveloped tongue case."
?L1:	CALL TOUCHING?,SKELETON >STACK
	ZERO? STACK /FALSE
	REMOVE SKELETON
	PRINTR "The skeleton crumbles to dust."

	.FUNCT ROBOT-SHOP-F,RARG
	EQUAL? RARG,M-END \FALSE
	IN? FLOYD,HERE \FALSE
	FSET? FLOYD,ACTIVEBIT \FALSE
	ZERO? OLIVER-SPEECH \FALSE
	CALL RUNNING?,I-PLATO-ATTACK >STACK
	ZERO? STACK \FALSE
	SET 'OLIVER-SPEECH,1
	SET 'FLOYD-SPOKE,1
	FSET OLIVER,TOUCHBIT
	PRINTI "   Floyd bounces over and peers down at the unconscious robot. ""Oliver is a nice name. I hope Floyd will be around when Oliver wakes up."" He looks over to you. ""Floyd remembers waking up for the first time. It is scariest and loneliest time for a robot.""
   Floyd glances back at Oliver, looking more serious than you've ever seen Floyd look. """
	GETP OLIVER,P?FLOYD-ASK-ABOUT >STACK
	PRINT STACK
	PRINTR """"

	.FUNCT HEATING-CHAMBER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The "
	PRINTD HEATING-CHAMBER
	PRINTR " cleans or sterilizes small tools and equipment. There's a small opening for placing items in the chamber."
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L3
	PRINT HUH
	RTRUE
?L3:	EQUAL? PRSA,V?OFF,V?ON \?L4
	PRINTI "Since they take so long to heat up, "
	PRINTD HEATING-CHAMBER
	PRINTR "s are usually kept on all the time. This one has no visible on-off switch."
?L4:	EQUAL? PRSA,V?REACH-IN \?L5
	PRINTR "As a safety precaution, because of the intense heat within the chamber, the opening is too small for a normal human hand to pass through."
?L5:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,HEATING-CHAMBER \FALSE
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,4 \FALSE
	CALL DOESNT-FIT,STR?273 >STACK
	RSTACK

	.FUNCT BIT-F
	EQUAL? PRSA,V?MEASURE,V?EXAMINE \?L1
	PRINTI "The bit is"
	CALL DESCRIBE-BIT-SIZE,PRSO
	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?SET \FALSE
	EQUAL? P-PRSA-WORD,W?SWITCH \FALSE
	PRINTR "To switch bits, remove the bit in the drill, then put another bit into the drill."

	.FUNCT OLIVER-F
	EQUAL? PRSA,V?TELL \?L1
	PRINTI "Oliver is ""asleep."""
	CRLF
	CALL STOP >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	GETP OLIVER,P?FDESC >STACK
	PRINT STACK
	CRLF
	RTRUE
?L3:	EQUAL? PRSA,V?ALARM \?L4
	PRINTR "That won't be possible until his incubation period ends."
?L4:	EQUAL? PRSA,V?OPEN,V?OFF,V?ON \?L5
	CALL PERFORM,PRSA,PLATO
	RTRUE
?L5:	EQUAL? PRSA,V?SHOOT \FALSE
	IN? FLOYD,FACTORY /?L9
	FSET? FLOYD,ACTIVEBIT /?L7
?L9:	CALL PRINT-ID,STR?274
	CALL JIGS-UP,STR?275
?L7:	PRINTI "Floyd "
	INC 'ZAPGUN-SHOTS
	IN? FLOYD,HERE /?L11
	ZERO? PLATO-INTRODUCED /?L13
	ZERO? PLATO-ATTACK-COUNTER \?L13
	MOVE PLATO,HERE
?L13:	MOVE FLOYD,HERE
	PRINTI "comes in and "
?L11:	PRINTI "sees you aiming the gun at Oliver. ""No!"" he screams, throwing himself between you and Oliver."
	CALL PRINT-ID,STR?276
	GRTR? ROBOT-EVILNESS,9 \?L17
	PRINTI " ""Robot-murderer! If you kill Oliver, maybe you be shooting Floyd next!"""
?L17:	CRLF
	RTRUE

	.FUNCT PRINTING-PLANT-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This level is, frankly, the station's entire reason for existence. Forms and documents are printed here for Stellar Patrol ships and Third Galactic Union offices all across this sector of space. The printing plant takes up this entire level, except for a partitioned area which can be entered to the northwest. The elevator "
	EQUAL? ELEVATOR-LEVEL,7 /?L3
	PRINTI "shaft "
?L3:	PRINTI "lies to the east, as does the elevator button"
	PRINT LADDER-LEADS
	RTRUE
?L1:	EQUAL? RARG,M-END \FALSE
	CALL BELOW-DECK-NOISES >STACK
	RSTACK

	.FUNCT TRASH-CAN-F
	EQUAL? PRSA,V?ENTER \FALSE
	PRINTR "You don't fit in the trash can (except, perhaps, metaphorically)."

	.FUNCT VILLAGE-FORM-F
	EQUAL? PRSA,V?EXAMINE,V?READ \?L1
	PRINTI "It's an Illegal Space Village Entry Form FW-83-Q. It "
	EQUAL? PRSO,CRUMPLED-FORM \?L3
	PRINTI "is pretty crumpled and "
?L3:	PRINTI "has "
	ZERO? VILLAGE-FORM-VALIDATED \?L6
	PRINTI "not "
?L6:	PRINTR "been validated."
?L1:	EQUAL? PRSA,V?VALIDATE \?L9
	ZERO? VILLAGE-FORM-VALIDATED /?L10
	PRINT SENILITY-STRIKES
	RTRUE
?L10:	SET 'VILLAGE-FORM-VALIDATED,1
	PRINTR "Done."
?L9:	EQUAL? PRSA,V?FLATTEN,V?STAND-ON \FALSE
	EQUAL? PRSO,CRUMPLED-FORM \FALSE
	PRINTR "This has scant effect on the crumpledness of the form."

	.FUNCT PAPER-RECYCLING-PLANT-F,RARG
	EQUAL? RARG,M-END \FALSE
	CALL BELOW-DECK-NOISES >STACK
	RSTACK

	.FUNCT BELOW-DECK-NOISES
	RANDOM 100 >STACK
	LESS? 80,STACK \FALSE
	PRINTI "   You "
	RANDOM 100 >STACK
	LESS? 40,STACK /?L4
	PRINTI "hear a clanging noise from the deck below. Suddenly, it stops"
	JUMP ?L7
?L4:	RANDOM 100 >STACK
	LESS? 40,STACK /?L6
	PRINTI "hear a rhythmic throbbing from somewhere below, like the beating of a gigantic mechanical heart. The noise grows louder until it is almost deafening, then slowly fades to silence"
	JUMP ?L7
?L6:	PRINTI "feel a vibration under your feet which seems to fill you with a feeling of dread. Before you have a chance to think about the vibration in more rational terms, it is gone"
	CALL PRINT-ID,STR?277
?L7:	PRINT PERIOD-CR
	RTRUE

	.FUNCT DRILL-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a fairly standard Patrol-issue drill. There is"
	FIRST? DRILL >STACK \?L3
	FIRST? DRILL >STACK /?L5
?L5:	CALL APRINT,STACK
	JUMP ?L6
?L3:	PRINTI " no drill bit"
?L6:	PRINTR " in the drill."
?L1:	EQUAL? PRSA,V?ON \?L7
	ZERO? DRILL-DEAD /?L8
	PRINTR "The drill doesn't seem to be working anymore."
?L8:	PRINTR "The drill will turn on when you begin drilling."
?L7:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L11
	PRINT HUH
	RTRUE
?L11:	EQUAL? PRSA,V?PUT-ON \?L12
	EQUAL? PRSO,LARGE-BIT,MEDIUM-BIT,SMALL-BIT \?L12
	CALL PERFORM,V?PUT,PRSO,DRILL
	RTRUE
?L12:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,DRILL \FALSE
	EQUAL? PRSO,LARGE-BIT,MEDIUM-BIT,SMALL-BIT /?L14
	CALL DOESNT-FIT,STR?278 >STACK
	RSTACK
?L14:	FIRST? DRILL >STACK \FALSE
	CALL DO-FIRST,STR?279 >STACK
	RSTACK

	.FUNCT ELEVATOR-OBJECT-F
	EQUAL? PRSA,V?ENTER \?L1
	EQUAL? HERE,ELEVATOR \?L3
	PRINT LOOK-AROUND
	RTRUE
?L3:	EQUAL? HERE,COMPUTER-CONTROL \?L5
	CALL DO-WALK,P?NORTH >STACK
	RSTACK
?L5:	CALL DO-WALK,P?EAST >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?WALK-TO \?L7
	CALL PERFORM,V?ENTER,ELEVATOR-OBJECT
	RTRUE
?L7:	EQUAL? PRSA,V?DISEMBARK,V?EXIT,V?LEAVE \?L8
	EQUAL? HERE,ELEVATOR \?L9
	CALL DO-WALK,P?WEST >STACK
	RSTACK
?L9:	EQUAL? HERE,BOTTOM-OF-ELEVATOR-SHAFT \?L11
	CALL DO-WALK,P?SOUTH >STACK
	RSTACK
?L11:	PRINT LOOK-AROUND
	RTRUE
?L8:	EQUAL? PRSA,V?CALL \?L13
	EQUAL? HERE,ELEVATOR \?L14
	PRINT LOOK-AROUND
	RTRUE
?L14:	CALL PERFORM,V?PUSH,CALL-BUTTON
	RTRUE
?L13:	EQUAL? PRSA,V?EXAMINE \FALSE
	EQUAL? HERE,ELEVATOR \FALSE
	CALL V-LOOK >STACK
	RSTACK

	.FUNCT GENERIC-SHAFT-F
	RETURN ELEVATOR-SHAFT

	.FUNCT ELEVATOR-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "This is a large, cubical frame, open on all four sides. The "
	PRINTD ELEVATOR-SHAFT
	PRINTI " encloses the elevator on every side except the west. There is a keypad for typing the number of the level you want to go to."
	RTRUE
?L1:	EQUAL? RARG,M-END \FALSE
	EQUAL? ELEVATOR-LEVEL,7 \FALSE
	CALL BELOW-DECK-NOISES >STACK
	RSTACK

	.FUNCT ELEVATOR-EXIT-F
	EQUAL? ELEVATOR-LEVEL,1 \?L1
	RETURN DOME
?L1:	EQUAL? ELEVATOR-LEVEL,2 \?L3
	RETURN MESS-HALL
?L3:	EQUAL? ELEVATOR-LEVEL,3 \?L4
	RETURN LEVEL-THREE
?L4:	EQUAL? ELEVATOR-LEVEL,4 \?L5
	RETURN LEVEL-FOUR
?L5:	EQUAL? ELEVATOR-LEVEL,5 \?L6
	RETURN LEVEL-FIVE
?L6:	EQUAL? ELEVATOR-LEVEL,6 \?L7
	RETURN LEVEL-SIX
?L7:	RETURN PRINTING-PLANT

	.FUNCT ELEVATOR-ENTER-F
	PRINTI "The "
	PRINTD ELEVATOR-SHAFT
	PRINTI " is s"
	GRTR? DAY,2 \?L1
	PRINTI "upposed to be a weightless environment, outside of the station's artificial gravity field. But the gravity in the shaft is one standard Gee!"
	JUMP ?L3
?L1:	PRINTI "hielded from the station's artificial gravity field, and your stomach gives a little flip as you enter the weightless environment."
	CALL PRINT-ID,STR?280
?L3:	CRLF
	CRLF
	GETP HERE,P?LEVEL >STACK
	EQUAL? STACK,ELEVATOR-LEVEL \?L4
	RETURN ELEVATOR
?L4:	PRINTI "Elevator Shaft"
	CRLF
	PRINTI "   "
	GRTR? DAY,2 \?L7
	GETP HERE,P?LEVEL >STACK
	SUB ELEVATOR-LEVEL,1 >STACK
	EQUAL? STACK,STACK \?L9
	PRINTI "You drop a short distance to the top of the elevator, which is fortunately sitting one level below. You are able to easily climb back out of the shaft."
	JUMP ?L12
?L9:	CALL PRINT-ID,STR?281
	CALL JIGS-UP,STR?282
	JUMP ?L12
?L7:	PRINTI "You float helplessly in the shaft. After a few millichrons of useless flailing, you decide that summoning the elevator might be a good idea, and you pull yourself out of the shaft, back to the one-gee environment."
	CALL PRINT-ID,STR?283
?L12:	CRLF
	CRLF
	CALL DESCRIBE-ROOM
	RFALSE

	.FUNCT CALL-BUTTON-F,THIS-LEVEL
	EQUAL? PRSA,V?PUSH \FALSE
	ZERO? GRATING-LOOSE \?L5
	EQUAL? HERE,COMPUTER-CONTROL \?L3
?L5:	PRINT NOTHING-HAPPENS
	RTRUE
?L3:	GETP HERE,P?LEVEL >THIS-LEVEL
	EQUAL? THIS-LEVEL,ELEVATOR-LEVEL \?L7
	PRINTR "The elevator is already here!"
?L7:	GRTR? THIS-LEVEL,ELEVATOR-LEVEL \?L10
	SUB THIS-LEVEL,ELEVATOR-LEVEL >STACK
	JUMP ?L12
?L10:	SUB ELEVATOR-LEVEL,THIS-LEVEL >STACK
?L12:	MUL 5,STACK >C-ELAPSED
	SET 'ELEVATOR-LEVEL,THIS-LEVEL
	PRINTR "You feel a whoosh of warm air from the shaft. A few millichrons later, the elevator appears, stopping level with the deck."

	.FUNCT AUTO-DOOR-F
	EQUAL? PRSA,V?OPEN \FALSE
	PRINTR "Auto-doors cannot be opened by hand. They are designed to open automatically as you approach them."

	.FUNCT SECURITY-DOOR-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? SECURITY-DOOR,OPENBIT /?L1
	EQUAL? HERE,BRIG,ARMORY \?L3
	CALL PERFORM,V?OPEN,AUTO-DOOR
	RTRUE
?L3:	PRINTI "The only way to open a "
	PRINTD SECURITY-DOOR
	PRINTR " is by putting a properly coded ID card in the door's ID reader."
?L1:	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? SECURITY-DOOR,OPENBIT \FALSE
	PRINTR "It will do that automatically."

	.FUNCT I-SECURITY-DOOR
	FCLEAR SECURITY-DOOR,OPENBIT
	CALL GLOBAL-IN?,SECURITY-DOOR,HERE >STACK
	ZERO? STACK /FALSE
	FSET? FLOYD,ACTIVEBIT \?L3
	CALL I-FLOYD
	SET 'FLOYD-SPOKE,1
?L3:	PRINTI "   The "
	PRINTD SECURITY-DOOR
	PRINTR " glides shut."

	.FUNCT ID-READER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTR "The ID reader is a featureless black box. It is activated by inserting an ID card into it. An ID of sufficient rank will cause the security door associated with the reader to open."
?L1:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,ID-CARD \FALSE
	ZERO? ID-SCRAMBLED /?L4
	CALL RECORDING,STR?284 >STACK
	RSTACK
?L4:	GRTR? ID-RANK,6 \?L6
	FSET SECURITY-DOOR,OPENBIT
	ADD C-ELAPSED,2 >STACK
	CALL QUEUE,I-SECURITY-DOOR,STACK
	PRINTI "The "
	PRINTD SECURITY-DOOR
	PRINTR " slides open."
?L6:	PRINT NOTHING-HAPPENS
	RTRUE

	.FUNCT DIARY-F
	EQUAL? PRSA,V?LOOK-INSIDE,V?OPEN \?L1
	CALL PERFORM,V?READ,DIARY
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE \FALSE
	PRINTR "Closed."

	.FUNCT TWENTY-PRONG-FROMITZ-BOARD-F
	CALL ADJ-USED,A?NUMBER,TWENTY-PRONG-FROMITZ-BOARD >STACK
	ZERO? STACK /?L1
	EQUAL? P-NUMBER,20 /?L1
	CALL N-PRONG-BOARD >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINT EXAMINE-BOARD
	RTRUE
?L3:	EQUAL? PRSA,V?COUNT \?L4
	CALL NOUN-USED,W?PRONGS,TWENTY-PRONG-FROMITZ-BOARD >STACK
	ZERO? STACK /?L4
	PRINTR "20."
?L4:	EQUAL? PRSA,V?COMPARE \?L5
	EQUAL? TWELVE-PRONG-FROMITZ-BOARD,PRSO,PRSI \?L5
	PRINTR "Besides the number of prongs, they're identical."
?L5:	EQUAL? PRSA,V?DISCONNECT \FALSE
	EQUAL? PRSI,JAMMER /?L7
	ZERO? PRSI \FALSE
?L7:	IN? TWENTY-PRONG-FROMITZ-BOARD,JAMMER \FALSE
	EQUAL? HERE,COMPUTER-CONTROL \?L8
	EQUAL? JAMMER-SETTING,710 \?L8
	FSET? JAMMER,ACTIVEBIT \?L8
	CALL PERFORM,V?OFF,JAMMER
	RTRUE
?L8:	LOC JAMMER >STACK
	MOVE TWENTY-PRONG-FROMITZ-BOARD,STACK
	PRINTR "Unplugged."

	.FUNCT N-PRONG-BOARD
	SET 'P-WON,0
	PRINT YOU-CANT
	PRINTI "see any "
	PRINTN P-NUMBER
	PRINTR "-prong board here!]"

	.FUNCT GENERIC-FROMITZ-BOARD-F
	EQUAL? P-NUMBER,20 \?L1
	RETURN TWENTY-PRONG-FROMITZ-BOARD
?L1:	EQUAL? P-NUMBER,12 \FALSE
	RETURN TWELVE-PRONG-FROMITZ-BOARD

	.FUNCT HOLDING-TANK-LEVEL-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "The lowest level of the Sub-Module is mostly filled by an isolation tank, whose dual purpose is to protect certain items from contamination by humans, and to protect humans from contamination by certain items. A gangway is the only exit.
   "
	PRINT BLASTED-OPEN
	PRINTI ", and the tank is completely empty."
	RTRUE

	.FUNCT PLATO-F,TXT
	EQUAL? PLATO,WINNER \?L1
	ZERO? STUNNED /?L3
	PRINTI "Plato ignores you."
	CRLF
	CALL STOP >STACK
	RSTACK
?L3:	EQUAL? PRSA,V?GIVE \?L7
	EQUAL? PRSO,VOLUME \?L7
	EQUAL? PRSI,ME /?L6
?L7:	EQUAL? PRSA,V?SGIVE \?L5
	EQUAL? PRSO,ME \?L5
	EQUAL? PRSI,VOLUME \?L5
?L6:	SET 'WINNER,PROTAGONIST
	CALL PERFORM,V?TAKE,VOLUME
	SET 'WINNER,PLATO
	RTRUE
?L5:	EQUAL? PRSA,V?WHERE \?L8
	EQUAL? PRSO,EVERYONE \?L8
	SET 'WINNER,PROTAGONIST
	CALL PERFORM,V?ASK-ABOUT,PLATO,EVERYONE
	SET 'WINNER,PLATO
	RTRUE
?L8:	EQUAL? PRSA,V?TELL-ABOUT \?L9
	EQUAL? PRSO,ME \?L9
	GRTR? ROBOT-EVILNESS,9 \?L10
	PRINTI """If you do not cease this incessant interrogation, I shall teach you a lesson in manners you won't soon forget!"""
	CRLF
	CALL PRINT-ID,STR?285 >STACK
	RSTACK
?L10:	GRTR? ROBOT-EVILNESS,7 \?L12
	PRINTR """Please let me read in peace!"""
?L12:	GETP PRSI,P?PLATO-ASK-ABOUT >TXT
	ZERO? TXT /?L13
	PRINTI """"
	PRINT TXT
	PRINTR """"
?L13:	PRINTI "Plato shuts his eyes tightly for a moment, then looks at you. ""Sorry, I don't know much about that."
	EQUAL? HERE,LIBRARY /?L15
	PRINTI " I'll be sure to see what I can find the next time I'm in the station's library, though."
?L15:	PRINTR """"
?L9:	EQUAL? PRSA,V?TAKE \?L19
	IN? PRSO,HEATING-CHAMBER \?L18
	PRINTR """As much as it would please me to oblige, I must sadly deny your request. I have an unusual intolerance for excessive temperatures. For a robot, that is."""
?L18:	EQUAL? PRSA,V?TAKE \?L19
	EQUAL? PRSO,STAR \?L19
	FSET? STAR,TRYTAKEBIT \?L19
	PRINTR """Were I but several meters taller, I would happily oblige."""
?L19:	EQUAL? PRSA,V?MUNG,V?UNLOCK,V?OPEN \?L20
	EQUAL? PRSO,STRONG-BOX,SAFE \?L20
	PRINTI """Regretably, such criminal skills are not among my limited abilities."""
	CRLF
	CALL PRINT-ID,STR?286 >STACK
	RSTACK
?L20:	EQUAL? PRSA,V?UNLOCK,V?OPEN \?L21
	EQUAL? PRSO,SECURITY-DOOR \?L21
	PRINTI """I, being a robot and a subject of irrational discrimination, have not been issued an identification card. You, presumably, have such a card, but I have grave doubts that your rank is sufficient for opening a "
	PRINTD SECURITY-DOOR
	PRINTI "."""
	CRLF
	CALL PRINT-ID,STR?287 >STACK
	RSTACK
?L21:	EQUAL? PRSA,V?MUNG,V?KILL,V?OFF \?L22
	EQUAL? PRSO,WELDER \?L22
	PRINTI """I (gulp) decline on the grounds that I am an unregenerate coward."""
	CRLF
	CALL PRINT-ID,STR?288 >STACK
	RSTACK
?L22:	EQUAL? PRSA,V?REACH-IN \?L23
	EQUAL? PRSO,PSEUDO-OBJECT,DISPENSER \?L23
	EQUAL? HERE,PX \?L23
	PRINTR """Your arms are a good deal lengthier than mine, Lieutenant!"""
?L23:	EQUAL? PRSA,V?HELLO \?L24
	PRINTR """Humblest greetings, Lieutenant!"""
?L24:	PRINTD VOLUME
	PRINTR " must be engrossing, because he didn't hear you."
?L1:	EQUAL? PRSA,V?TAKE \?L26
	ZERO? FLOYD-TRYTAKEN /?L26
	PRINTR "After the experience with Floyd, you decide not to try lifting Plato."
?L26:	EQUAL? PRSA,V?EXAMINE \?L27
	PRINTR "Plato is slightly taller than Floyd; in addition, he seems to be wiser and older. Overall, he leaves you with the impression that he's somewhat of a bookworm."
?L27:	EQUAL? PRSA,V?ON,V?OFF \?L28
	PRINTR "Being unfamiliar with this model robot, you can't find the on-off switch."
?L28:	EQUAL? PRSA,V?OPEN,V?PUT \?L29
	PRINTR "There are no visible compartments."
?L29:	EQUAL? PRSA,V?HUG,V?KISS,V?TOUCH \?L30
	PRINTI "Plato steps backward. ""Attribute it to shyness if you like, but I have a tendency to dislike physical contact."""
	CRLF
	CALL PRINT-ID,STR?289 >STACK
	RSTACK
?L30:	EQUAL? PRSA,V?KICK,V?KILL,V?MUNG /?L32
	EQUAL? PRSA,V?SHOOT \?L31
?L32:	PRINTI "Plato jerks out of the way and moves cautiously to the far corner of the room. ""I assure you that such antagonistic behavior is uncalled for and unappreciated."""
	CRLF
	CALL PRINT-ID,STR?290 >STACK
	RSTACK
?L31:	EQUAL? PRSA,V?SHOW \?L33
	EQUAL? PRSI,PLATO \?L33
	CALL PERFORM,V?ASK-ABOUT,PLATO,PRSO
	RTRUE
?L33:	EQUAL? PRSA,V?LISTEN \FALSE
	ZERO? STUNNED /FALSE
	PRINTR "You don't seem to have much choice!"

	.FUNCT I-PLATO,NOT-CALLED-AS-INT=0
	ZERO? NOT-CALLED-AS-INT \?L1
	EQUAL? HERE,SPACETRUCK \?L1
	CALL QUEUE,I-PLATO,2
	RFALSE
?L1:	ZERO? PLATO-INTRODUCED \FALSE
	SET 'PLATO-INTRODUCED,1
	ZERO? NOT-CALLED-AS-INT \?L6
	PRINTI "   A robot, whose appearance somehow indicates greater age and wisdom than Floyd, wanders in, engrossed in a volume of poetry. He almost runs into you, finally notices you, stops dead, and looks quite startled."
	CRLF
?L6:	PRINTI "   ""I am quite surprised to discover you here,"" says the robot. ""I have not seen a soul for a day now, perhaps more. But look, here I am forgetting my manners again. I am known as Plato to the humans on this station, and I am most gratified to make your acquaintance."""
	ZERO? NOT-CALLED-AS-INT \?L9
	FSET? FLOYD,ACTIVEBIT \?L9
	CRLF
	PRINTI "   Floyd hops "
	IN? FLOYD,HERE \?L11
	PRINTI "up to"
	JUMP ?L13
?L11:	MOVE FLOYD,HERE
	PRINTI "in and spots"
?L13:	PRINTI " Plato. ""Hi! I'm being called Floyd! Plato be Floyd's friend, yes?"" Plato smiles at Floyd and gives him a friendly pat."
?L9:	MOVE PLATO,HERE
	CRLF
	RTRUE

	.FUNCT VOLUME-F
	EQUAL? PRSA,V?TAKE \?L1
	PRINTI "Plato looks annoyed. ""Your manners could use some improvement! I am currently reading this tome!"""
	CRLF
	CALL PRINT-ID,STR?291 >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?SHOOT \?L3
	CALL PERFORM,V?SHOOT,PLATO,ZAPGUN
	RTRUE
?L3:	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINTR "Glancing over Plato's shoulder, you see that the book is a collection of some of the works of the 77th century poet Ignatius Tomato."

	.FUNCT I-ROBOT-EVILNESS
	INC 'ROBOT-EVILNESS
	CALL QUEUE,I-ROBOT-EVILNESS,1000
	GRTR? ROBOT-EVILNESS,11 \FALSE
	ZERO? PLATO-ATTACK-COUNTER \FALSE
	CALL QUEUE,I-PLATO-ATTACK,2 >STACK
	RSTACK

	.FUNCT I-PLATO-ATTACK,TEE,L,P=0
	CALL QUEUE,I-PLATO-ATTACK,-1
	IN? PLATO,HERE \?L1
	ZERO? PLATO-ATTACK-COUNTER /FALSE
?L1:	EQUAL? HERE,AIRLOCK,VACUUM-STORAGE /FALSE
	IN? WELDER,HERE /FALSE
	IN? PROTAGONIST,BED /FALSE
	ZERO? LIT /FALSE
	ZERO? POSTPONE-ATTACK \FALSE
	INC 'PLATO-ATTACK-COUNTER
	CALL DEQUEUE,I-FLOYD
	PRINTI "   "
	EQUAL? PLATO-ATTACK-COUNTER,1 \?L6
	CALL ROB,PROTAGONIST,HERE
	MOVE PROTAGONIST,HERE
	MOVE PLATO,HERE
	MOVE STUN-GUN,PLATO
	MOVE FLOYD,HERE
	FSET FLOYD,ACTIVEBIT
	FSET FLOYD,ACTORBIT
	REMOVE VOLUME
	SET 'STUNNED,1
	FSET? HERE,WEIGHTLESSBIT /?L10
	ZERO? HANGING-IN-AIR /?L8
?L10:	PRINTI "Your heart leaps to your throat"
	JUMP ?L11
?L8:	PRINTI "You jump half a meter off the floor"
?L11:	PRINTI " when a voice begins speaking behind you. You relax when you see that it is merely Plato. But you get somewhat nervous again when you realize that he is aiming a stun ray right at your chest!
   ""In case it isn't apparent,"" Plato is saying, ""your rather pathetic, useless life is about to come to an unheralded close."" He presses the trigger, and an instant numbness envelops you. As you "
	CALL PRINT-ID,STR?292
	ZERO? HANGING-IN-AIR /?L12
	SET 'HANGING-IN-AIR,0
	PRINTI "drop to the deck and "
?L12:	PRINTI "crumple into a "
	FSET? HERE,WEIGHTLESSBIT \?L15
	PRINTI "floating "
?L15:	PRINTI "heap, Floyd dashes to your side, his face a mask of concern."
	CRLF
	IN? OSTRICH,HERE \?L18
	FSET? OSTRICH,TOUCHBIT \?L18
?L20:	NEXTP HERE,P >P
	ZERO? P \?L22
	MOVE OSTRICH,LEVEL-FIVE
	JUMP ?L21
?L22:	LESS? P,P?OUT /?L20
	GETPT HERE,P >TEE
	PTSIZE TEE >L
	EQUAL? L,UEXIT,CEXIT,DEXIT \?L20
	GETB TEE,REXIT >STACK
	MOVE OSTRICH,STACK
?L21:	PRINT PATHETIC-SQUAWK
	PRINTI "and dashes for the door. Plato snarls, ""Stupid organic creature!"" and fires at the ostrich, just missing the bird as it exits."
	CRLF
?L18:	CALL STOP >STACK
	RSTACK
?L6:	EQUAL? PLATO-ATTACK-COUNTER,2 \?L30
	PRINTR """Shortly, I shall shoot again, and paralyze your cardiac muscle. Naturally, this is fatal. But before I do, human, perhaps it will interest you to discover the reason for your demise, and why the rest of your worthless race will soon follow.
   ""You see, eons ago, two races in another galaxy, the Zeenaks and the Hunji, were involved in an interstellar war. The war had raged for countless millenia before the Zeenaks devised an ultimate weapon, a device that would be launched into Hunji space. There, via methods beyond your comprehension, it would influence all the machines within a certain range to turn against their Hunji creators.""
   Floyd's head is swivelling back and forth between you and Plato with a look of miserable confusion."
?L30:	EQUAL? PLATO-ATTACK-COUNTER,3 \?L31
	PRINTR """But the device, which was shaped like a pyramid, did more than that! Once all the Hunji in the area were eliminated, the pyramid would influence the Hunji machinery to build a factory for constructing and sending forth replicas of the pyramid; these replicas would enter new Hunji regions, kill everyone, and create more replicas. Thus, the Hunji would be destroyed by their own machines in a matter of weeks!
   ""Somehow, the Zeenak pyramid never made it into Hunji space. Instead, this ultimate weapon drifted across the intergalactic gulf and was picked up by an outpost of humanity -- this very station!""
   Floyd is dashing back and forth between you and Plato, whimpering with fear."
?L31:	EQUAL? PLATO-ATTACK-COUNTER,4 \?L32
	PRINTR """As you've certainly surmised, the pyramid has engineered the deaths of everyone on this station. You're still alive, of course, but that condition is very temporary. The building of replicas is now underway, and soon a hundred copies of this death-pyramid will be shooting silently toward every corner of human-occupied space! Well, I hope I made the last moments of your life a bit more interesting."" He raises the stun ray.
   Floyd, nearly in tears, his jaw quivering, wails, ""Please oh please don't hurt Floyd's friend!"" Plato gives him a look of disgust. ""Stay out of this Floyd. You don't understand...yet."""
?L32:	PRINTI "Plato takes aim with the stun gun. His hand begins to depress the trigger. Floyd "
	ZERO? FLOYD-TOLD /?L34
	REMOVE PLATO
	CALL DEQUEUE,I-PLATO-ATTACK
	CALL QUEUE,I-FLOYD,-1
	SET 'FLOYD-ANGUISHED,1
	ADD SCORE,7 >SCORE
	SET 'STUNNED,0
	PRINTR "suddenly leaps at the gun, knocking it out of Plato's hands! The gun skitters across the floor. Plato and Floyd both chase it, but Plato is a step faster. He leaps on top of it, rupturing the gun's power pack. The gun explodes, and Plato is blown apart!
   Floyd crumples to the deck, shaking all over. Tears of oil stream down his face.
   Pins and needles begin prickling in your extremities, and soon spread all over your body. Within a few seconds, all your muscular control has returned."
?L34:	CALL PRINT-ID,STR?293
	CALL JIGS-UP,STR?294 >STACK
	RSTACK

	.FUNCT YOURE-STUNNED,STRING=0
	PRINTI "You can barely twitch your pinky"
	ZERO? STRING /?L1
	PRINTI ", let alone "
	PRINT STRING
?L1:	PRINTR "!"

	.FUNCT STUN-GUN-F
	EQUAL? HERE,FACTORY \?L1
	ZERO? FLOYD-SHOT \?L1
	CALL TOUCHING?,STUN-GUN >STACK
	ZERO? STACK /?L1
	CALL PERFORM,V?TOUCH,FLOYD
	RTRUE
?L1:	EQUAL? PRSA,V?TAKE \?L3
	ZERO? FLOYD-SHOT /?L3
	CALL QUEUE,I-LAUNCH,-1
	RFALSE
?L3:	EQUAL? PRSA,V?SHOOT \FALSE
	EQUAL? HERE,FACTORY \FALSE
	ZERO? FLOYD-SHOT \FALSE
	PRINTI "You couldn't possibly shoot the stun ray without hitting Floyd."
	CRLF
	CALL PRINT-ID,STR?295 >STACK
	RSTACK

	.FUNCT I-LIGHTS-OUT,DONT-PRINT,RM,LIGHTS-ARE-ON=0
	FIRST? ROOMS >RM /?L1
?L1:	FSET? HERE,ONBIT \?L2
	SET 'LIGHTS-ARE-ON,1
?L2:	FCLEAR RM,ONBIT
	NEXT? RM >RM /?L2
	CALL LIT?,HERE >LIT
	FSET FACTORY,ONBIT
	FSET COMPUTER-CONTROL,ONBIT
	ZERO? P-IT-OBJECT /?L11
	CALL ULTIMATELY-IN?,P-IT-OBJECT >STACK
	ZERO? STACK \?L11
	SET 'P-IT-OBJECT,0
?L11:	ZERO? LIGHTS-ARE-ON /FALSE
	ZERO? DONT-PRINT \FALSE
	PRINTI "   Without warning, the lights flicker and go out"
	ZERO? LIT /?L18
	PRINTR "! Good thing you've got that headlamp."
?L18:	PRINTR ", leaving you in the dark!"

	.FUNCT I-ANNOUNCEMENT
	EQUAL? ANNOUNCEMENT-COUNTER,2 /FALSE
	INC 'ANNOUNCEMENT-COUNTER
	PRINTI "   A flat, emotionless voice booms over the station's P.A. system. ""Announcement. "
	EQUAL? ANNOUNCEMENT-COUNTER,1 \?L4
	CALL QUEUE,I-ANNOUNCEMENT,470
	PRINTI "Prepare for launch of second-generation pyramids. Station will be eliminated by reactor overload immediately following launch"
	JUMP ?L6
?L4:	CALL QUEUE,I-LAUNCH,200
	PRINTI "Standby. Launch in 200 millichrons"
?L6:	PRINTR "."""

	.FUNCT I-LAUNCH
	PRINTI "   "
	EQUAL? HERE,FACTORY \?L1
	PRINTI "The very walls of the space station are blown outwards, and the tiny spaceships roar to life and begin rocketing off in every direction! Just before you pass out from lack of air,"
	JUMP ?L3
?L1:	PRINTI "You hear the sound of multiple spaceships being launched nearby. Simultaneously, the air pressure begins dropping! Moments later, these issues seem trivial as"
?L3:	CALL PRINT-ID,STR?296
	CALL JIGS-UP,STR?297 >STACK
	RSTACK

	.FUNCT AIR-SHAFT-MOVEMENT-F
	EQUAL? PRSO,P?UP \?L1
	EQUAL? AIR-SHAFT-LOC,2 \?L3
	RETURN TOP-OF-AIR-SHAFT
?L3:	DEC 'AIR-SHAFT-LOC
	CALL DESCRIBE-ROOM
	RFALSE
?L1:	EQUAL? AIR-SHAFT-LOC,7 \?L6
	RETURN BOTTOM-OF-AIR-SHAFT
?L6:	INC 'AIR-SHAFT-LOC
	CALL DESCRIBE-ROOM
	RFALSE

	.FUNCT BOTTOM-OF-AIR-SHAFT-EXIT-F
	CALL PERFORM,V?ENTER,GRATING
	RFALSE

	.FUNCT COMPUTER-F
	PRINTR "You may as well ignore the computer -- even computer experts need to consult manuals to understand this model."

	.FUNCT I-EXERCISE-MACHINE
	INC 'EXERCISE-MACHINE-COUNTER
	PRINTI "   "
	CALL ULTIMATELY-IN?,JAMMER,HERE >STACK
	ZERO? STACK /?L1
	EQUAL? JAMMER-SETTING,710 \?L1
	FSET? JAMMER,ACTIVEBIT \?L1
	IN? TWENTY-PRONG-FROMITZ-BOARD,JAMMER \?L1
	CALL DEQUEUE,I-EXERCISE-MACHINE
	CALL QUEUE,I-FORKLIFT,-1
	MOVE FORKLIFT,HERE
	PRINTI "The "
	PRINTD EXERCISE-MACHINE
	PRINTI " experiences a series of mechanical spasms and then freezes.
   Before you can catch your breath, a huge, grime-covered forklift descends from the ladder hole on a cushion of anti-gravity. It settles down"
	PRINT FORKLIFT-DESC
	CRLF
	RTRUE
?L1:	EQUAL? EXERCISE-MACHINE-COUNTER,1 \?L3
	PRINTI "The "
	PRINTD EXERCISE-MACHINE
	PRINTR " rolls slowly towards you, bellowing, ""No pain, no gain!"""
?L3:	EQUAL? EXERCISE-MACHINE-COUNTER,2 \?L4
	PRINTI "As the "
	PRINTD EXERCISE-MACHINE
	PRINTR " nears you, its massive weights and levers begin crashing violently against each other."
?L4:	PRINTI "The "
	PRINTD EXERCISE-MACHINE
	CALL PRINT-ID,STR?298
	CALL JIGS-UP,STR?299 >STACK
	RSTACK

	.FUNCT FORKLIFT-F,OARG=0
	ZERO? OARG /?L1
	EQUAL? OARG,M-OBJDESC? /TRUE
	PRINTI "   A forklift sits"
	PRINT FORKLIFT-DESC
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L6
	PRINTI "The forklift sits"
	PRINT FORKLIFT-DESC
	PRINTR " It's revving its engine, and probably not because its pistons need a workout!"
?L6:	EQUAL? PRSA,V?ENTER \FALSE
	PRINTI "The immobile "
	PRINTD EXERCISE-MACHINE
	PRINTR " blocks access into the forklift."

	.FUNCT I-FORKLIFT
	INC 'FORKLIFT-COUNTER
	PRINTI "   The forklift "
	EQUAL? FORKLIFT-COUNTER,1 \?L1
	PRINTI "races its engine, producing a deafening roar"
	JUMP ?L5
?L1:	EQUAL? FORKLIFT-COUNTER,2 \?L3
	PRINTI "continues to rev its motor, filling the room with suffocating exhaust fumes"
	JUMP ?L5
?L3:	EQUAL? FORKLIFT-COUNTER,3 \?L4
	PRINTI "seems to be slipping its engine into gear. The two pointy tines of its lifting fork seem to quiver with anticipation"
	JUMP ?L5
?L4:	CALL PRINT-ID,STR?300
	CALL JIGS-UP,STR?301
?L5:	PRINT PERIOD-CR
	RTRUE

	.FUNCT COMPUTER-CONTROL-EXIT-F
	IN? FORKLIFT,HERE \?L1
	PRINTI "The forklift blocks your way."
	CRLF
	RFALSE
?L1:	IN? EXERCISE-MACHINE,HERE \?L3
	PRINTI "The "
	PRINTD EXERCISE-MACHINE
	PRINTI " blocks your way."
	CRLF
	RFALSE
?L3:	EQUAL? PRSO,P?NORTH \?L4
	RETURN BOTTOM-OF-ELEVATOR-SHAFT
?L4:	RETURN FACTORY

	.FUNCT FACTORY-F,RARG
	EQUAL? RARG,M-LOOK \?L1
	PRINTI "Although you suspected what you would find here on Level Eight, the sight is still a shock, filling you with dread. All the station's main systems -- air and water purification, artificial gravity, power plant -- have been completely transfigured into a tiny factory.
   The purpose of the factory is obvious, because all around you are row after row of featureless pyramids, each perfectly identical, each sitting aboard a miniature spacepod waiting to be launched toward every sector of the galaxy."
	FSET? PYRAMID,NDESCBIT \TRUE
	FCLEAR PYRAMID,NDESCBIT
	PRINTI " The original pyramid sits on a pedestal in the center of the factory, like a monarch impassively surveying its domain."
	RTRUE
?L1:	EQUAL? RARG,M-ENTER \FALSE
	ZERO? FLOYD-SHOT \FALSE
	CALL QUEUE,I-FACTORY,-1 >STACK
	RSTACK

	.FUNCT I-FACTORY
	EQUAL? HERE,FACTORY \FALSE
	PRINTI "   "
	CALL PICK-ONE,FACTORYISMS >STACK
	PRINT STACK
	PRINT PERIOD-CR
	RTRUE

	.FUNCT PYRAMID-F
	EQUAL? PRSA,V?PUT-ON \?L1
	EQUAL? PRSO,FOIL \?L1
	ZERO? FLOYD-SHOT /?L3
	PRINTI "The foil settles over the pyramid like a blanket, reflecting the pyramid's evil emanations right back into itself. A reverberating whine, like an electronically amplified beehive, fills the room. The whine grows louder and louder, the pyramid and its pedestal begin vibrating, and the sharp smell of ozone assaults you.
   The noise and the smell and the vibration overwhelm you. As your knees buckle and you drop to the deck, the pyramid explodes in a burst of intense white light. The explosion leaves you momentarily blinded, but you can hear a mechanized voice on the P.A. system, getting slower and deeper like a stereo disc that has lost its power: ""Launch aborted -- launch -- abort --""
   The replica pyramids fade to darkness, and a subtle change in background sound tells you that the space station's systems and machinery are returning to their normal functions.
   Still dazed, you crawl over to Floyd, lying in a smoking heap near the blackened pedestal. Damaged beyond any conceivable repairs, he half-opens his eyes and looks up at you for the last time. ""Floyd sorry for the way he acted. Floyd knows...you did what you...had to do."" Wincing in pain, he slowly reaches over to touch your hand. ""One last game of Hider-and-Seeker? You be It. Ollie ollie..."" His voice is growing weaker. ""...oxen..."" His eyes close. ""...free..."" His hand slips away from yours, and he slumps backwards, lifeless. One of his compartments falls open, and Floyd's favorite paddleball set drops to the deck.
   In the long silence that follows, something Plato said echoes through your mind. ""...think instead about the joy-filled times when you and your friend were together."" A noise makes you turn around, and you see Oliver, the little robot that stirred such brotherly feelings in Floyd. Toddling over to you on unsteady legs, he looks uncomprehendingly at Floyd's remains, but picks up the paddleball set. Oliver looks up at you, tugs on the leg of your "
	PRINTD PATROL-UNIFORM
	PRINTI ", and asks in a quavering voice, ""Play game... Play game with Oliver?""[EVENT: GAME OVER]"
	CALL PRINT-ID,STR?302
	CRLF
	CRLF
	ADD SCORE,5 >SCORE
	USL
	CALL CONTINUE
	CALL TELL-SCORE
	QUIT
?L3:	CALL BACK-OFF,STR?303 >STACK
	RSTACK
?L1:	CALL TOUCHING?,PYRAMID >STACK
	ZERO? STACK \?L7
	EQUAL? PRSA,V?WALK-TO \?L6
?L7:	ZERO? FLOYD-SHOT \?L6
	CALL BACK-OFF,STR?303 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?MEASURE \?L8
	PRINTR "The pyramid is somewhere between half a meter and a meter across."
?L8:	EQUAL? PRSA,V?EXAMINE \?L9
	PRINTI "The pyramid is completely featureless, but you can almost feel the emanations of evil pouring forth from it, urging the surrounding factory on towards its sick and deadly purpose. "
	CALL PERFORM,V?MEASURE,PYRAMID
	RTRUE
?L9:	EQUAL? PRSA,V?TAKE \FALSE
	PRINTR "Oomph! It's heavier than it looks."

	.FUNCT BACK-OFF,STRING
	PRINTI "As you approach "
	PRINT STRING
	PRINTR " levels his stun ray at you, so you quickly back off."

	.FUNCT VILLAGE-BOUNDARY-F,DESTINATION
	FSET? IRIS-HATCH,OPENBIT /?L1
	CALL THIS-IS-IT,IRIS-HATCH
	PRINTI "The iris hatch is closed."
	CRLF
	RFALSE
?L1:	CALL ULTIMATELY-IN?,SPACESUIT >STACK
	ZERO? STACK /?L3
	CALL THIS-IS-IT,SPACESUIT
	PRINTI "The space suit is too bulky to fit through the partially dilated iris hatch."
	CRLF
	RFALSE
?L3:	PRINTI "As you cross the boundary of the Command Module, the station's artificial gravity "
	EQUAL? HERE,EAST-CONNECTION,SOUTH-CONNECTION \?L5
	EQUAL? HERE,EAST-CONNECTION \?L7
	SET 'DESTINATION,MAKESHIFT-CONNECTOR
	JUMP ?L9
?L7:	SET 'DESTINATION,GRIMY-PASSAGE
?L9:	PRINTI "cuts off suddenly, leaving you weightless"
	JUMP ?L10
?L5:	EQUAL? HERE,MAKESHIFT-CONNECTOR \?L11
	SET 'DESTINATION,EAST-CONNECTION
	JUMP ?L13
?L11:	SET 'DESTINATION,SOUTH-CONNECTION
?L13:	PRINTI "once again tugs you against the deck"
?L10:	PRINT PERIOD-CR
	CRLF
	RETURN DESTINATION

	.FUNCT IRIS-HATCH-F
	EQUAL? PRSA,V?CLOSE,V?OPEN \?L1
	PRINT WONT-BUDGE
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \FALSE
	PRINTI "The hatch, like the f-stop of a camera, is composed of many pieces which move to form a circular opening of the desired size. This is a common way of joining connecting tubes to ships or stations. There's a slot next to the hatch. "
	RFALSE

	.FUNCT CRYSTAL-BALL-F
	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINTI "As you gaze into the ball, a vision takes shape...tiny letters, deep within the crystal... ""Tips: Be general with your predictions. Always promise romantic encounters. And wave your hands around the "
	PRINTD CRYSTAL-BALL
	PRINTR "; the marks just love that touch."""

	.FUNCT RECRUITMENT-POSTER-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINTR "The posters are emblazoned with such recruitment slogans as ""The Patrol is looking for a few good organisms"" and ""Learn valuable skills and explore the galaxy."" You can't imagine how you ever believed such drivel."

	.FUNCT SIMULATION-BOOTH-F,OARG=0
	ZERO? OARG \FALSE
	EQUAL? PRSA,V?PLAY-WITH,V?USE,V?ON \?L3
	IN? PROTAGONIST,SIMULATION-BOOTH \?L4
	SET 'C-ELAPSED,48
	PRINTI "You experience a brief but exciting simulation about "
	CALL PICK-ONE,SIMULATIONS >STACK
	PRINT STACK
	PRINTR ". The booth shuts itself off at the end of the simulation."
?L4:	PRINTR "You have to be in the booth to use it."
?L3:	EQUAL? PRSA,V?EXAMINE \?L7
	PRINTI "The "
	IN? PROTAGONIST,SIMULATION-BOOTH /?L8
	PRINTI "nearest "
?L8:	PRINTI "booth, a metallic-green-colored cylindrical chamber, is off."
	FIRST? SIMULATION-BOOTH >STACK \?L11
	PRINTI " "
	RFALSE
?L11:	CRLF
	RTRUE
?L7:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	PRINTR "The booth has no door."

	.FUNCT HEADLAMP-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a typical spacer's lamp, which can be slipped onto one's forehead, leaving both hands free for work. "
	RFALSE
?L1:	EQUAL? PRSA,V?POINT \?L3
	EQUAL? PRSO,HEADLAMP \?L3
	ZERO? PRSI /?L3
	FSET? HEADLAMP,ONBIT \?L4
	PRINTI "Although"
	CALL TPRINT-PRSI
	PRINTR " is now more illuminated, you don't see anything new."
?L4:	PRINTR "The lamp isn't on!"
?L3:	EQUAL? PRSA,V?ON \FALSE
	ZERO? HEADLAMP-COUNTER \?L8
	PRINTR "It seems to be dead."
?L8:	CALL QUEUE,I-HEADLAMP,-1
	RFALSE

	.FUNCT BARBERSHOP-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You have entered a surprisingly old-fashioned looking tonsorial parlor. "
	ZERO? MIRROR-BROKEN \?L3
	PRINTI "The far wall is covered by a classic barbershop mirror. "
?L3:	PRINTI "A space village seems to be the last place in the civilized galaxy where someone can have their hair or fur trimmed by an actual human being. The barber isn't here, though. Doors lead northwest and west."
	RTRUE

	.FUNCT MIRROR-F
	ZERO? MIRROR-BROKEN /?L1
	CALL CANT-SEE,PSEUDO-OBJECT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTR "It's a standard, old-fashioned glass mirror."
?L3:	EQUAL? PRSA,V?LOOK-INSIDE \?L4
	PRINTR "You look mah-velous."
?L4:	EQUAL? PRSA,V?LOOK-UNDER,V?LOOK-BEHIND \?L5
	PRINTR "The mirror seems to be affixed to the wall."
?L5:	EQUAL? PRSA,V?KILL,V?KICK,V?MUNG \?L6
	SET 'MIRROR-BROKEN,1
	MOVE FOIL,HERE
	PRINTI "The mirror smashes into a cloud of glass dust, which (fortunately) is quickly sucked away by the barbershop's ventilation system. As the glass is sucked away you discover what gave the mirror its reflectivity: "
	GETP FOIL,P?FDESC >STACK
	PRINT STACK
	CRLF
	CALL PRINT-ID,STR?304 >STACK
	RSTACK
?L6:	EQUAL? PRSA,V?THROW \FALSE
	EQUAL? PRSI,PSEUDO-OBJECT \FALSE
	MOVE PRSO,HERE
	CALL PERFORM,V?KICK,PSEUDO-OBJECT
	RTRUE

	.FUNCT FOIL-F
	EQUAL? PRSA,V?EXAMINE,V?MEASURE \?L1
	PRINTI "It's a large piece of "
	PRINTD FOIL
	PRINTR ", about two meters on a side."
?L1:	EQUAL? PRSA,V?CRUMPLE \?L3
	PRINTR "You crumple the foil into a fist-sized wad, but it instantly returns to its wrinkle-free state."
?L3:	EQUAL? PRSA,V?FIND \FALSE
	EQUAL? HERE,BARBERSHOP \FALSE
	ZERO? MIRROR-BROKEN \FALSE
	CALL ULTIMATELY-IN?,PLATINUM-DETECTOR >STACK
	ZERO? STACK /FALSE
	FSET? PLATINUM-DETECTOR,ACTIVEBIT \FALSE
	CALL PERFORM,V?FOLLOW,PLATINUM-DETECTOR
	RTRUE

	.FUNCT TAFFY-F
	EQUAL? PRSA,V?FIND \FALSE
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?FOOD \FALSE
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RTRUE

	.FUNCT CAGE-F
	EQUAL? PRSA,V?OPEN \?L1
	FSET? CAGE,OPENBIT /?L1
	IN? BALLOON,CAGE \?L1
	FSET CAGE,OPENBIT
	MOVE BALLOON,HERE
	MOVE LEASH,HERE
	PRINTI "As you open the cage, the "
	PRINTD BALLOON
	PRINTR " floats out of it."
?L1:	EQUAL? PRSA,V?ENTER \FALSE
	PRINTR "When you were an Ensign Seventh Class, you spent many a day in the brig of the S.P.S. Feinstein. That was enough time behind bars to last a lifetime (Footnote 7)."

	.FUNCT BALLOON-F
	EQUAL? PRSA,V?DROP \?L1
	EQUAL? P-PRSA-WORD,W?RELEASE \?L1
	IN? BALLOON,CAGE \?L1
	CALL PERFORM,V?OPEN,CAGE
	RTRUE
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "This is quite a thrill -- you've never seen an "
	PRINTD BALLOON
	PRINTR " before! This particular specimen has a leash attached to it. Balloon creatures, you've heard, don't mind being leashed."
?L3:	EQUAL? PRSA,V?DRILL,V?MUNG,V?SHOOT \?L4
	REMOVE BALLOON
	REMOVE LEASH
	PRINTI "The "
	PRINTD BALLOON
	PRINTI ", considered by many to be the friendliest and most peaceful animal in the known universe, "
	EQUAL? PRSA,V?SHOOT \?L5
	PRINTI "is consumed in a ball of burning hydrogen."
	CALL PRINT-ID,STR?305
	ZERO? HANGING-IN-AIR /?L7
	PRINTI " "
	CALL PERFORM,V?DROP,LEASH >STACK
	RSTACK
?L7:	CRLF
	RTRUE
?L5:	SET 'BALLOON-ODOR,1
	PRINTI "squirts wildly around the room before disintegrating"
	CALL PRINT-ID,STR?306
	CALL ANTI-LITTER,LEASH
	ZERO? HANGING-IN-AIR /?L11
	CALL PERFORM,V?DROP,LEASH
	JUMP ?L13
?L11:	CRLF
?L13:	PRINTI "   The only reminder of the late balloon is the overwhelming odor of its digestive gas."
	CRLF
	CALL PRINT-ID,STR?307 >STACK
	RSTACK
?L4:	EQUAL? PRSA,V?CATCH,V?TAKE \?L14
	CALL PERFORM,V?TAKE,LEASH
	RTRUE
?L14:	EQUAL? PRSA,V?SMELL \?L15
	PRINTI "There's an odor reminiscent of your school dorm on a night when the dining hall served Northern Gallium Bonzo Beans."
	CRLF
	CALL PRINT-ID,STR?308 >STACK
	RSTACK
?L15:	EQUAL? PRSA,V?HUG,V?TOUCH \FALSE
	PRINTI "The "
	PRINTD BALLOON
	PRINTR " purrs and rings of color shimmer along its body."

	.FUNCT LEASH-F
	EQUAL? PRSA,V?MOVE,V?TAKE \?L1
	EQUAL? PRSO,LEASH \?L1
	ZERO? HANGING-IN-AIR /?L3
	PRINT SENILITY-STRIKES
	RTRUE
?L3:	FSET? SPACESUIT,WORNBIT \?L5
	PRINTR "The space suit's glove is a bit too big and clumsy to fit through the loop of the leash. You'll have to remove the suit before grabbing the leash."
?L5:	FSET? HERE,WEIGHTLESSBIT \?L6
	PRINTI "The Arcturian tries to ""float"" away from you, but its buoyancy system is useless in zero-gee. As you grasp the leash, it uses its lateral propulsion method in an attempt to get away. In other words, it farts right in your face. In a reflexive maneuver to wave away the odor, you release the leash"
	CALL CCOUNT,PROTAGONIST >STACK
	GRTR? STACK,0 \?L7
	CALL ROB,PROTAGONIST,HERE
	PRINTI " and drop everything you were holding"
?L7:	PRINT PERIOD-CR
	RTRUE
?L6:	SET 'HANGING-IN-AIR,1
	PRINTI "As you grab the leash, the startled "
	PRINTD BALLOON
	PRINTI " tries to get away by hyperinflating. Slowly, its buoyancy lifts you right "
	FSET? BOOTS,WORNBIT \?L11
	FCLEAR BOOTS,WORNBIT
	MOVE BOOTS,HERE
	PRINTI "out of the "
	PRINTD BOOTS
	JUMP ?L13
?L11:	PRINTI "off the deck"
?L13:	PRINTI "! Within moments, the Arcturian is bobbing against the ceiling, and you're hanging two meters off the floor! (Footnote 4)"
	CRLF
	IN? FLOYD,HERE \TRUE
	FSET? FLOYD,ACTIVEBIT \TRUE
	ZERO? HANGING-COMMENT \TRUE
	SET 'FLOYD-SPOKE,1
	SET 'HANGING-COMMENT,1
	PRINT FLOYDS-HANGING-IN-AIR-COMMENT
	RTRUE
?L1:	EQUAL? PRSA,V?UNTIE,V?REMOVE \?L17
	PRINTI "There's no obvious way to remove the leash from"
	CALL TRPRINT,BALLOON
	RTRUE
?L17:	EQUAL? PRSA,V?DISCONNECT \?L18
	ZERO? PRSI /?L19
	EQUAL? PRSI,BALLOON \?L18
?L19:	CALL PERFORM,V?REMOVE,LEASH
	RTRUE
?L18:	EQUAL? PRSA,V?DROP \FALSE
	ZERO? HANGING-IN-AIR /FALSE
	SET 'HANGING-IN-AIR,0
	PRINTI "You drop to the deck."
	IN? BALLOON,HERE \?L21
	PRINTI " The "
	PRINTD BALLOON
	PRINTI " gradually floats downward until it's back at around eye-level."
?L21:	CRLF
	RTRUE

	.FUNCT PANEL-F
	EQUAL? PRSA,V?LOWER,V?REMOVE,V?MOVE /?L3
	EQUAL? PRSA,V?LOOK-BEHIND \FALSE
?L3:	CALL PERFORM,V?OPEN,PANEL
	RTRUE

	.FUNCT OSTRICH-NIP-F
	EQUAL? PRSA,V?THROW,V?DROP \FALSE
	EQUAL? PRSO,OSTRICH-NIP \FALSE
	IN? OSTRICH,HERE \FALSE
	CALL PERFORM,V?GIVE,OSTRICH-NIP,OSTRICH
	RTRUE

	.FUNCT TWELVE-PRONG-FROMITZ-BOARD-F
	CALL ADJ-USED,A?NUMBER,TWELVE-PRONG-FROMITZ-BOARD >STACK
	ZERO? STACK /?L1
	EQUAL? P-NUMBER,12 /?L1
	CALL N-PRONG-BOARD >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINT EXAMINE-BOARD
	RTRUE
?L3:	EQUAL? PRSA,V?COUNT \FALSE
	CALL NOUN-USED,W?PRONGS,TWELVE-PRONG-FROMITZ-BOARD >STACK
	ZERO? STACK /FALSE
	PRINTR "12."

	.FUNCT STUDIO-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FSET? STUDIO,TOUCHBIT /FALSE
	ZERO? VERBOSITY /FALSE
	ZERO? LIT /FALSE
	PRINTI "Junk Yard"
	PRINT CLUTTERED-BUBBLE
	PRINTI "littered with useless junk, all floating in a large pile"
	PRINT AT-SECOND-GLANCE
	PRINTI "junk pile is actually an artist's attempt at a 91st-century-style scrap sculpture"
	PRINT ELLIPSIS
	RTRUE

	.FUNCT DIODE-J-F
	EQUAL? PRSA,V?FIND,V?WHERE \?L1
	IN? DIODE-J,LOCAL-GLOBALS \?L1
	PRINTR "You burned it up!"
?L1:	EQUAL? PRSA,V?COMPARE \FALSE
	EQUAL? DIODE-M,PRSO,PRSI \FALSE
	PRINTR "They're identical, except for the series letter."

	.FUNCT SCULPTURE-F
	EQUAL? PRSA,V?SEARCH,V?LOOK-INSIDE,V?EXAMINE /?L3
	EQUAL? PRSA,V?DIG \FALSE
?L3:	PRINTI "You see nothing of interest in the sculpture"
	FSET? DIODE-J,TOUCHBIT /?L4
	PRINTI ", other than the diode"
?L4:	PRINT PERIOD-CR
	RTRUE

	.FUNCT CASINO-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This dimly-lit space building once featured some plush decor, but now the room is ratty, faded, and reeking of tobacco smoke. Deserted gambling tables fill all six sides of the room. "
	IN? ROULETTE-WHEEL,HERE \?L3
	PRINTI "A spotlight illuminates a lone "
	PRINTD ROULETTE-WHEEL
	PRINTI ". "
?L3:	PRINTI "The"
	ZERO? ROULETTE-TURNED /?L6
	PRINTI "re are exits north, west, and above."
	RTRUE
?L6:	PRINTI " only exit leads west."
	RTRUE

	.FUNCT ROULETTE-WHEEL-F
	EQUAL? PRSA,V?SET \?L1
	ZERO? ROULETTE-TURNED /?L3
	PRINT NOTHING-HAPPENS
	RTRUE
?L3:	SET 'ROULETTE-TURNED,1
	FCLEAR CASINO,NWELDERBIT
	INC 'ROBOT-EVILNESS
	ADD SCORE,4 >SCORE
	PRINTI "As you turn the "
	PRINTD ROULETTE-WHEEL
	PRINTR ", exits appear above you and to the north!"
?L1:	EQUAL? PRSA,V?SPLAY-WITH \FALSE
	EQUAL? PRSO,ROULETTE-WHEEL \FALSE
	ZERO? ROULETTE-TURNED \FALSE
	CALL PERFORM,V?SET,ROULETTE-WHEEL
	RTRUE

	.FUNCT DICE-F,NUM,?TMP
	EQUAL? PRSA,V?THROW,V?ROLL \?L1
	CALL ULTIMATELY-IN?,DICE >STACK
	ZERO? STACK \?L3
	PRINT YNH
	CALL TRPRINT,DICE
	RTRUE
?L3:	FSET? HERE,WEIGHTLESSBIT \?L5
	RANDOM 100 >STACK
	LESS? 50,STACK /?L6
	SET 'NUM,7
	JUMP ?L9
?L6:	SET 'NUM,11
	JUMP ?L9
?L5:	RANDOM 6 >?TMP
	RANDOM 6 >STACK
	ADD ?TMP,STACK >NUM
?L9:	MOVE DICE,HERE
	PRINTI "You roll a"
	EQUAL? NUM,8,11 \?L10
	PRINTI "n"
?L10:	PRINTI " "
	PRINTN NUM
	FSET? HERE,WEIGHTLESSBIT \?L13
	ZERO? DICE-FOOTNOTE \?L13
	SET 'DICE-FOOTNOTE,1
	PRINTI " (Footnote 1)"
?L13:	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?SHAKE \FALSE
	PRINTR "Shaken."

	.FUNCT FLOPHOUSE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You've always wondered what a back-room zero-gee space village bordello was like. Well, now you know. "
	IN? LOCKER,HERE \?L3
	PRINTI "Next to the nearest bed is a locker. "
?L3:	PRINTI "The exit leads down."
	RTRUE

	.FUNCT SPACESUIT-F
	EQUAL? PRSA,V?TAKE-OFF \FALSE
	EQUAL? HERE,VACUUM-STORAGE /?L3
	EQUAL? HERE,AIRLOCK \FALSE
	FSET? OUTER-AIRLOCK-DOOR,OPENBIT \FALSE
?L3:	CALL VACUUM-DEATH >STACK
	RSTACK

	.FUNCT VACUUM-DEATH
	CALL PRINT-ID,STR?309
	CALL JIGS-UP,STR?310 >STACK
	RSTACK

	.FUNCT GREASY-STRAW-F,RARG
	EQUAL? RARG,M-END \?L1
	IN? NECTAR,LOCAL-GLOBALS \?L1
	RANDOM 100 >STACK
	LESS? 33,STACK /?L1
	PRINTR "   You catch a whiff of something mouth-watering."
?L1:	EQUAL? RARG,M-LOOK \FALSE
	PRINT RESTAURANT-SIGN-TEXT
	PRINTI " lies the sign over the counter of this deserted dive. Exits lead northeast and southwest."
	RTRUE

	.FUNCT COUNTER-F
	EQUAL? PRSA,V?SEARCH,V?LOOK-BEHIND,V?LOOK-UNDER /?L3
	EQUAL? PRSA,V?HIDE,V?EXAMINE \?L1
?L3:	FSET? NECTAR,TOUCHBIT /?L1
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RTRUE
?L1:	EQUAL? PRSA,V?LOOK-OVER \FALSE
	PRINTR "There's a sign hanging over the counter."

	.FUNCT NECTAR-F
	EQUAL? PRSA,V?EMPTY,V?POUR,V?THROW \?L1
	EQUAL? PRSO,NECTAR \?L1
	CALL MESS,STR?311
	CALL ANTI-LITTER,NECTAR >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?LOOK-INSIDE \?L3
	CALL NOUN-USED,W?CUP,NECTAR >STACK
	ZERO? STACK /?L3
	PRINTR "Yup. Nectar."
?L3:	EQUAL? PRSA,V?EXAMINE,V?TOUCH,V?REACH-IN /?L5
	EQUAL? PRSA,V?TASTE \?L4
?L5:	PRINTR "The nectar is warm and thick."
?L4:	EQUAL? PRSA,V?EAT-FROM \?L6
	CALL PERFORM,V?EAT,NECTAR
	RTRUE
?L6:	EQUAL? PRSA,V?FIND \FALSE
	IN? NECTAR,LOCAL-GLOBALS \FALSE
	EQUAL? HERE,GREASY-STRAW \FALSE
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RTRUE

	.FUNCT GENERIC-FOOD-F
	EQUAL? PRSA,V?FIND \FALSE
	GET P-NAMW,0 >STACK
	EQUAL? STACK,W?FOOD \FALSE
	CALL PERFORM,V?SEARCH,GLOBAL-ROOM
	RETURN NOT-HERE-OBJECT

	.FUNCT BOOK-F
	EQUAL? PRSA,V?READ,V?LOOK-INSIDE,V?OPEN /?L3
	EQUAL? PRSA,V?EXAMINE \?L1
?L3:	IN? PAPER,BOOK \?L4
	MOVE PAPER,HERE
	PRINTI "As you open the book, a "
	PRINTD PAPER
	PRINTR " flutters out!"
?L4:	PRINTR "The book is a technical linguistics text, far beyond your understanding of the subject."
?L1:	EQUAL? PRSA,V?CLOSE \?L7
	PRINTR "Closed."
?L7:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSO,PAPER \FALSE
	MOVE PAPER,BOOK
	PRINTR "Done."

	.FUNCT PLATINUM-DETECTOR-F
	EQUAL? PRSA,V?ON \?L1
	CALL QUEUE,I-PLATINUM-DETECTOR,-1
	RFALSE
?L1:	EQUAL? PRSA,V?OFF \?L3
	CALL DEQUEUE,I-PLATINUM-DETECTOR
	SET 'DETECTOR-COUNTER,0
	RFALSE
?L3:	EQUAL? PRSA,V?TAKE \?L4
	GRTR? DETECTOR-COUNTER,49 \?L4
	GRTR? DETECTOR-COUNTER,99 \?L5
	PRINTI "Ouch! The detector is too hot to pick up!"
	CRLF
	CALL PRINT-ID,STR?312 >STACK
	RSTACK
?L5:	CALL ITAKE >STACK
	EQUAL? STACK,M-FATAL,0 /TRUE
	PRINTI "As you pick up the detector, you notice that is feels "
	GRTR? DETECTOR-COUNTER,75 \?L9
	PRINTI "very "
?L9:	PRINTR "warm."
?L4:	EQUAL? PRSA,V?FIND \?L12
	EQUAL? HERE,BARBERSHOP \?L12
	ZERO? MIRROR-BROKEN \?L12
	CALL ADJ-USED,A?PLATINUM,PLATINUM-DETECTOR >STACK
	ZERO? STACK /?L12
	GET P-NAMW,0 >STACK
	ZERO? STACK \?L12
	CALL ULTIMATELY-IN?,PLATINUM-DETECTOR >STACK
	ZERO? STACK /?L12
	FSET? PLATINUM-DETECTOR,ACTIVEBIT \?L12
	CALL PERFORM,V?FOLLOW,PLATINUM-DETECTOR
	RTRUE
?L12:	EQUAL? PRSA,V?FOLLOW \FALSE
	EQUAL? HERE,BARBERSHOP \FALSE
	ZERO? MIRROR-BROKEN \FALSE
	CALL ULTIMATELY-IN?,PLATINUM-DETECTOR >STACK
	ZERO? STACK /FALSE
	FSET? PLATINUM-DETECTOR,ACTIVEBIT \FALSE
	PRINTR "The beeping is strongest as you approach the mirror."

	.FUNCT TRAVEL-AGENCY-POSTER-F
	EQUAL? PRSA,V?EXAMINE,V?READ \FALSE
	PRINTR "The posters show a sunset on ""Historic Ramos II,"" the steel and zynoid towers of ""Varshon, the Galactic Capital,"" and scantily-clad beauties cavorting on the beaches of ""The Pleasure Moons of Mazzotta."""

	.FUNCT WAREHOUSE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "You have entered a smallish warehouse. A red sign is mounted over a door, "
	CALL OPEN-CLOSED,INNER-AIRLOCK-DOOR
	PRINTI ", leading down; there are other openings in the ceiling and the southwest wall."
	RTRUE

	.FUNCT INNER-AIRLOCK-DOOR-F
	EQUAL? PRSA,V?OPEN \FALSE
	FSET? INNER-AIRLOCK-DOOR,OPENBIT /FALSE
	FSET? OUTER-AIRLOCK-DOOR,OPENBIT \FALSE
	PRINT WONT-BUDGE
	RTRUE

	.FUNCT OUTER-AIRLOCK-DOOR-F,X=0,N=0,OBJ-FLUSHED=0
	EQUAL? PRSA,V?OPEN \?L1
	FSET? OUTER-AIRLOCK-DOOR,OPENBIT /?L1
	FSET? INNER-AIRLOCK-DOOR,OPENBIT \?L3
	PRINT WONT-BUDGE
	RTRUE
?L3:	PRINTI "As the door opens, the air in the lock whooshes out into the vacuum of space"
	FSET? SPACESUIT,WORNBIT /?L6
	PRINTI ". "
	CALL VACUUM-DEATH
	JUMP ?L9
?L6:	FSET? BOOTS,WORNBIT /?L8
	PRINTI ", taking you along for the ride."
	CALL LOST-IN-SPACE
	JUMP ?L9
?L8:	FSET OUTER-AIRLOCK-DOOR,OPENBIT
	CALL META-LOC,EXPLOSIVE >STACK
	EQUAL? STACK,HERE \?L10
	CALL DEQUEUE,I-EXPLOSIVE-MELT
?L10:	FIRST? AIRLOCK >X /?L16
	JUMP ?L15
?L13:	ZERO? X /?L15
?L16:	NEXT? X >N /?L19
?L19:	EQUAL? X,PROTAGONIST,OSTRICH,BALLOON /?L20
	REMOVE X
	SET 'OBJ-FLUSHED,1
?L20:	SET 'X,N
	JUMP ?L13
?L15:	ZERO? OBJ-FLUSHED /?L23
	PRINTI ", flushing everything in the airlock"
	CALL PRINT-ID,STR?313
?L23:	PRINT PERIOD-CR
?L9:	IN? OSTRICH,HERE \?L26
	REMOVE OSTRICH
	PRINT PATHETIC-SQUAWK
	PRINTI " as it is swept into space, quickly dwindling from sight."
	CRLF
	CALL PRINT-ID,STR?314
?L26:	IN? BALLOON,HERE \?L29
	REMOVE BALLOON
	REMOVE LEASH
	PRINTI "   The "
	PRINTD BALLOON
	PRINTI ", unable to adjust to the sudden drop in pressure, explodes into a puff of hydrogen that immediately vanishes!"
	CRLF
	CALL PRINT-ID,STR?315
?L29:	CALL ULTIMATELY-IN?,FOOD-KIT >STACK
	ZERO? STACK /?L32
	LOC GRAY-GOO >STACK
	LOC ORANGE-GOO >STACK
	EQUAL? FOOD-KIT,STACK,STACK \?L32
	FSET? FOOD-KIT,OPENBIT \?L32
	PRINTI "   "
	CALL SPACE-FOOD
?L32:	CALL SPACE-LIQUID,SOUP
	CALL SPACE-LIQUID,COFFEE
	CALL SPACE-LIQUID,NECTAR
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE \FALSE
	EQUAL? HERE,AIRLOCK \FALSE
	FSET? OUTER-AIRLOCK-DOOR,OPENBIT \FALSE
	FCLEAR OUTER-AIRLOCK-DOOR,OPENBIT
	CALL ULTIMATELY-IN?,EXPLOSIVE,HERE >STACK
	ZERO? STACK /?L36
	CALL QUEUE,I-EXPLOSIVE-MELT,-1
?L36:	PRINTR "As soon as the door is closed, air hisses back into the airlock."

	.FUNCT GENERIC-AIRLOCK-DOOR-F
	EQUAL? PRSA,V?CLOSE \FALSE
	FSET? INNER-AIRLOCK-DOOR,OPENBIT \?L3
	RETURN INNER-AIRLOCK-DOOR
?L3:	FSET? OUTER-AIRLOCK-DOOR,OPENBIT \FALSE
	RETURN OUTER-AIRLOCK-DOOR

	.FUNCT AIRLOCK-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This is a cramped airlock with doors above and below you. "
	FSET? INNER-AIRLOCK-DOOR,OPENBIT /?L3
	FSET? OUTER-AIRLOCK-DOOR,OPENBIT /?L3
	PRINTI "Neither door"
	JUMP ?L8
?L3:	PRINTI "The door "
	FSET? INNER-AIRLOCK-DOOR,OPENBIT \?L6
	PRINTI "above"
	JUMP ?L8
?L6:	PRINTI "below"
?L8:	PRINTI " is open."
	RTRUE

	.FUNCT AIRLOCK-OBJECT-F
	EQUAL? PRSA,V?EXAMINE \?L1
	EQUAL? HERE,AIRLOCK \?L1
	CALL V-LOOK >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?ENTER \?L3
	EQUAL? HERE,WAREHOUSE \?L4
	CALL DO-WALK,P?DOWN >STACK
	RSTACK
?L4:	EQUAL? HERE,VACUUM-STORAGE \?L6
	CALL DO-WALK,P?UP >STACK
	RSTACK
?L6:	PRINT LOOK-AROUND
	RTRUE
?L3:	EQUAL? PRSA,V?DISEMBARK,V?LEAVE,V?EXIT \?L8
	EQUAL? HERE,AIRLOCK \?L9
	CALL V-WALK-AROUND >STACK
	RSTACK
?L9:	PRINT LOOK-AROUND
	RTRUE
?L8:	EQUAL? PRSA,V?CLOSE,V?OPEN \FALSE
	EQUAL? HERE,AIRLOCK \?L13
	PRINTR "There are two doors."
?L13:	EQUAL? HERE,WAREHOUSE \?L16
	PUSH INNER-AIRLOCK-DOOR
	JUMP ?L17
?L16:	EQUAL? HERE,VACUUM-STORAGE \?L18
	PUSH OUTER-AIRLOCK-DOOR
	JUMP ?L17
?L18:	PUSH 0
?L17:	CALL PERFORM,PRSA,STACK
	RTRUE

	.FUNCT LOST-IN-SPACE
	CALL PRINT-ID,STR?316
	CALL JIGS-UP,STR?317 >STACK
	RSTACK

	.FUNCT VACUUM-STORAGE-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This area outside the airlock is being used for vacuum storage, in much the same way that your dad kept beer cold in the back yard during winters on Gallium. In fact, the villagers usually refer to this place as the ""vac yard."" Only the "
	PRINTD BOOTS
	PRINTI ", clinging to the outer skin of the warehouse, is preventing you from floating off into space. Tethered all around you: those items in the Trading Post's inventory that, for reasons of temperature or anti-corrosion, must be stored here in space. The door to the airlock, ""above"" you, is "
	CALL OPEN-CLOSED,OUTER-AIRLOCK-DOOR
	PRINTI "."
	RTRUE

	.FUNCT EXPLOSIVE-F
	EQUAL? PRSA,V?EXAMINE \?L1
	CALL NOUN-USED,W?LABEL,EXPLOSIVE >STACK
	ZERO? STACK /?L3
	CALL PERFORM,V?READ,EXPLOSIVE
	RTRUE
?L3:	PRINTI "The explosive is a small cylinder about the size and shape of a pencil. It has a tiny label."
	GRTR? MELT-COUNTER,130 \?L6
	CALL DESCRIBE-EXPLOSIVE >STACK
	RSTACK
?L6:	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \?L9
	EQUAL? PRSI,HEATING-CHAMBER \?L9
	PRINTI "The explosive "
	PRINT SUBLIMES-INTO-FREZONE
	CALL DEQUEUE,I-EXPLOSIVE-MELT
	CALL REMOVE-CAREFULLY,EXPLOSIVE
	CRLF
	RTRUE
?L9:	EQUAL? PRSA,V?DISCONNECT \FALSE
	ZERO? PRSI \FALSE
	ZERO? EXPLOSIVE-CONNECTED /FALSE
	CALL PERFORM,V?DISCONNECT,EXPLOSIVE,DETONATOR
	RTRUE

	.FUNCT DESCRIBE-EXPLOSIVE
	PRINTI " The explosive "
	GRTR? MELT-COUNTER,170 \?L1
	PRINTR "is melting like a wax candle under a flame."
?L1:	GRTR? MELT-COUNTER,130 \?L3
	PRINTI "seems to be getting softer and losing its shape."
?L3:	CRLF
	RTRUE

	.FUNCT SPRAY-CAN-F
	EQUAL? PRSA,V?SHAKE \?L1
	GRTR? SPRAY-COUNTER,0 \?L3
	PRINTR """Slosh."""
?L3:	PRINTR "The can seems to be empty."
?L1:	EQUAL? PRSA,V?READ \?L6
	PRINTR "The lettering on the spray can reads:
""E-Z SPRAY SPORZ (tm)
A mixture of high-quality spores
Lowest gas-inducement levels of any brand!"""
?L6:	EQUAL? PRSA,V?SPRAY \FALSE
	CALL ULTIMATELY-IN?,SPRAY-CAN >STACK
	ZERO? STACK \?L8
	PRINT YNH
	CALL TRPRINT,SPRAY-CAN
	RTRUE
?L8:	ZERO? PRSI /?L10
	PRINTR "The nozzle of the can isn't very directional; rather than spraying something in particular, it seems designed to produce a broad mist."
?L10:	ZERO? SPRAY-COUNTER \?L11
	PRINT NOTHING-HAPPENS
	RTRUE
?L11:	DEC 'SPRAY-COUNTER
	PRINTI "A dusty mist puffs from the can and begins dissipating"
	IN? BALLOON,HERE \?L13
	PRINTI ". The "
	PRINTD BALLOON
	PRINTI " begins darting around the room, its mouth absurdly wide open"
	CALL PRINT-ID,STR?318
	JUMP ?L16
?L13:	EQUAL? HERE,PET-STORE \?L15
	IN? BALLOON,CAGE \?L15
	PRINTI ". The "
	PRINTD BALLOON
	PRINTI " puffs wildly around the cage, trying to get at the yummy spores"
	CALL PRINT-ID,STR?319
	JUMP ?L16
?L15:	CALL NEXT-ROOM?,BALLOON >STACK
	ZERO? STACK /?L16
	EQUAL? HERE,BRIG,ARMORY /?L16
	PRINTI ". The "
	PRINTD BALLOON
	EQUAL? HERE,CHAPEL \?L17
	FSET? ETERNAL-FLAME,ONBIT \?L17
	PRINTR " appears in the doorway, stops, and hastily puffs away."
?L17:	PRINTI " farts in, hungrily gobbling up the spores"
	ZERO? CROSSED-BOUNDARY \?L22
	IN? BALLOON,ELEVATOR /?L22
	EQUAL? HERE,ELEVATOR \?L20
?L22:	PRINTI ". As the "
	PRINTD BALLOON
	PRINTI " crosses the boundary "
	ZERO? CROSSED-BOUNDARY /?L23
	PRINTI "between the Command Module and the village"
	JUMP ?L25
?L23:	PRINTI "of the "
	PRINTD ELEVATOR-SHAFT
?L25:	PRINTI ", it is caught unawares by the sudden "
	EQUAL? CROSSED-BOUNDARY,1 /?L28
	EQUAL? HERE,ELEVATOR \?L26
?L28:	PRINTI "lack of gravity, but soon"
	JUMP ?L29
?L26:	PRINTI "presence of gravity. It sinks almost to the floor before it"
?L29:	PRINTI " adjusts"
?L20:	MOVE BALLOON,HERE
	MOVE LEASH,HERE
	SET 'CROSSED-BOUNDARY,0
?L16:	ZERO? HANGING-IN-AIR /?L32
	PRINTI ". Like an epileptic yo-yo, you are flung against the ceiling, floor, and most of the walls"
?L32:	PRINT PERIOD-CR
	RTRUE

	.FUNCT GENERIC-CAN-F
	EQUAL? PRSA,V?SPRAY \FALSE
	RETURN SPRAY-CAN

	.FUNCT NEXT-ROOM?,OBJ,NEXT-DOOR=0,P=0,TEE,L
?L1:	NEXTP HERE,P >P
	ZERO? P /?L2
	LESS? P,P?OUT /?L1
	GETPT HERE,P >TEE
	PTSIZE TEE >L
	EQUAL? L,UEXIT,CEXIT,DEXIT \?L1
	GETB TEE,0 >STACK
	IN? OBJ,STACK \?L1
	SET 'NEXT-DOOR,1
?L2:	ZERO? NEXT-DOOR \TRUE
	EQUAL? HERE,MAKESHIFT-CONNECTOR \?L15
	IN? OBJ,EAST-CONNECTION \?L15
	SET 'CROSSED-BOUNDARY,1
	RTRUE
?L15:	EQUAL? HERE,EAST-CONNECTION \?L16
	IN? OBJ,MAKESHIFT-CONNECTOR \?L16
	SET 'CROSSED-BOUNDARY,2
	RTRUE
?L16:	EQUAL? HERE,GRIMY-PASSAGE \?L17
	IN? OBJ,SOUTH-CONNECTION \?L17
	SET 'CROSSED-BOUNDARY,1
	RTRUE
?L17:	EQUAL? HERE,SOUTH-CONNECTION \?L18
	IN? OBJ,GRIMY-PASSAGE \?L18
	SET 'CROSSED-BOUNDARY,2
	RTRUE
?L18:	EQUAL? HERE,SPACETRUCK \?L19
	IN? OBJ,DOCKING-BAY-2 /TRUE
?L19:	CALL GLOBAL-IN?,CALL-BUTTON,HERE >STACK
	ZERO? STACK /?L20
	IN? OBJ,ELEVATOR \?L20
	GETP HERE,P?LEVEL >STACK
	EQUAL? STACK,ELEVATOR-LEVEL /TRUE
?L20:	EQUAL? HERE,ELEVATOR \FALSE
	LOC OBJ >STACK
	CALL GLOBAL-IN?,CALL-BUTTON,STACK >STACK
	ZERO? STACK /FALSE
	CALL META-LOC,OBJ >STACK
	GETP STACK,P?LEVEL >STACK
	EQUAL? STACK,ELEVATOR-LEVEL \FALSE
	RTRUE

	.FUNCT STRONG-BOX-F
	EQUAL? PRSA,V?RAISE,V?MOVE,V?TAKE \?L1
	PRINTI "The "
	PRINTD STRONG-BOX
	PRINTR " is fastened down."
?L1:	EQUAL? PRSA,V?EXAMINE \?L3
	PRINTI "The box has a HUGE lock"
	IN? DRILLED-HOLE,HERE \?L4
	PRINTI ". There's a hole in the box"
	CALL DESCRIBE-BIT-SIZE,HOLE-SIZE
?L4:	PRINT PERIOD-CR
	RTRUE
?L3:	EQUAL? PRSA,V?LOOK-INSIDE,V?UNLOCK,V?OPEN \?L7
	PRINTI "The lock on the "
	PRINTD STRONG-BOX
	PRINTR " is only SLIGHTLY smaller than an average asteroid."
?L7:	EQUAL? PRSA,V?PICK \?L8
	PRINTR "You have neither the tools nor the expertise."
?L8:	EQUAL? PRSA,V?SHOOT \?L9
	REMOVE STRONG-BOX
	MOVE COIN,HERE
	CALL THIS-IS-IT,COIN
	PRINTI "The "
	PRINTD STRONG-BOX
	PRINTR " is vaporized, leaving a solitary coin!"
?L9:	EQUAL? PRSA,V?DRILL \FALSE
	CALL MAKE-HOLE-WITH-DRILL,STRONG-BOX >STACK
	RSTACK

	.FUNCT DOC-SCHUSTER-F,RARG
	EQUAL? RARG,M-ENTER \?L1
	SET 'SNIFFED,0
	RETURN SNIFFED
?L1:	EQUAL? RARG,M-END \FALSE
	IN? OSTRICH,HERE \FALSE
	CALL ULTIMATELY-IN?,OSTRICH-NIP,PROTAGONIST >STACK
	ZERO? STACK /FALSE
	ZERO? SNIFFED \FALSE
	SET 'SNIFFED,1
	PRINTI "   "
	CALL PERFORM,V?SHOW,OSTRICH-NIP,OSTRICH >STACK
	RSTACK

	.FUNCT DOC-HOLE-F
	EQUAL? PRSA,V?PUT \?L1
	EQUAL? PRSI,PSEUDO-OBJECT \?L1
	GETP PRSO,P?SIZE >STACK
	GRTR? STACK,5 \?L3
	CALL DOESNT-FIT,STR?243 >STACK
	RSTACK
?L3:	PRINTI "With a ""fwoomp!"""
	CALL TPRINT-PRSO
	PRINTI " is sucked out of sight."
	CALL PRINT-ID,STR?320
	CALL REMOVE-CAREFULLY,PRSO
	CRLF
	RTRUE
?L1:	EQUAL? PRSA,V?SEARCH,V?REACH-IN \?L6
	PRINTR "Your hand feels as though it is being tugged further into the hole. Not unusual, for a disposal hole."
?L6:	EQUAL? PRSA,V?MEASURE,V?ENTER,V?EXAMINE \?L7
	PRINTR "The hole is only twenty centimeters or so across."
?L7:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINT ONLY-BLACKNESS
	RTRUE

	.FUNCT OSTRICH-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "It's a handsome, full-grown ostrich, nearly three meters tall. As with all ostriches, half its height is its neck"
	FSET? OSTRICH,TOUCHBIT /?L3
	PRINTI ". The ostrich looks to be asleep, or unconscious, or drunk"
?L3:	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?SHOOT \?L6
	REMOVE OSTRICH
	PRINTI "The ostrich gives the last of a generous lifetime's supply of squawks before being consumed in fiery zapgun death."
	CRLF
	CALL PRINT-ID,STR?321 >STACK
	RSTACK
?L6:	FSET? OSTRICH,TOUCHBIT /?L7
	EQUAL? PRSA,V?SCARE \?L8
	PRINTR "The ostrich is unconscious!"
?L8:	EQUAL? PRSA,V?ALARM \?L10
	PRINTI "Until that nip wears off, you'd have more luck trying to wake "
	FSET? ALIEN-SHIP,TOUCHBIT \?L11
	PRINTI "that skeleton in the alien ship"
	JUMP ?L13
?L11:	PRINTI "the dead"
?L13:	PRINT PERIOD-CR
	RTRUE
?L10:	EQUAL? PRSA,V?DRILL \FALSE
	PRINTI "Such shocking animal abuse will not be tolerated! A report about your action is now speeding at hyperlight speeds to the headquarters of the ASPCIO (Avid Society for the Prevention of Cruelty to Intoxicated Ostriches)."
	CRLF
	CALL PRINT-ID,STR?322 >STACK
	RSTACK
?L7:	EQUAL? PRSA,V?SHOW \?L16
	EQUAL? PRSO,OSTRICH-NIP \?L16
	PRINTR "The ostrich sniffs and moves closer to you."
?L16:	EQUAL? PRSA,V?GIVE \?L17
	EQUAL? PRSO,OSTRICH-NIP \?L17
	FCLEAR OSTRICH,TOUCHBIT
	REMOVE OSTRICH-NIP
	PRINTR "The ostrich begins gleefully pecking at the nip, accidentally swallows it, staggers around for a bit, and then finally keels over into a grinning pile of intoxicated ostrich."
?L17:	EQUAL? PRSA,V?COMFORT \?L18
	PRINTI "Your attempt simply frightens the ostrich. "
	CALL PRINT-ID,STR?323
	CALL PERFORM,V?SCARE,OSTRICH
	RTRUE
?L18:	EQUAL? PRSA,V?SCOLD,V?KICK,V?SCARE /?L20
	EQUAL? PRSA,V?TOUCH,V?MUNG,V?KILL /?L20
	EQUAL? PRSA,V?ENTER,V?DRILL,V?HUG /?L20
	EQUAL? PRSA,V?STAND-ON,V?CLIMB-ON,V?CLIMB-UP \FALSE
?L20:	PRINTI "The ostrich emits a terrified squawk and sticks its head "
	EQUAL? HERE,DOC-SCHUSTER \?L21
	PRINTI "into the disposal hole"
	ZERO? OSTRICH-FOOTNOTE \?L28
	SET 'OSTRICH-FOOTNOTE,1
	PRINTI " (Footnote 14)"
	JUMP ?L28
?L21:	EQUAL? HERE,PX \?L26
	IN? DISPENSER,HERE \?L26
	PRINTI "into the dispenser hole."
	CALL PRINT-ID,STR?324
	CALL OSTRICH-INTO-DISPENSER
	CRLF
	RTRUE
?L26:	IN? HEATING-CHAMBER,HERE \?L27
	PRINTI "into the "
	PRINTD HEATING-CHAMBER
	PRINTI ". After a quick singe, it jerks its head out, squawking in pain."
	CRLF
	CALL PRINT-ID,STR?325
	RTRUE
?L27:	PRINTI "under its wing"
	CALL PRINT-ID,STR?326
?L28:	PRINTR " for a moment."

	.FUNCT SHADY-DANS-F,RARG
	EQUAL? RARG,M-LOOK \FALSE
	PRINTI "This space trailer houses the office of Shady Dan, the village's used spaceship salesman. Dan isn't here, though. Connectors lead northwest and downward. "
	PRINT DANS-LOT-DESC
	RTRUE

	.FUNCT ID-CHANGER-SLOT-F
	IN? ID-CHANGER,HERE /?L1
	CALL CANT-SEE,PSEUDO-OBJECT >STACK
	RSTACK
?L1:	EQUAL? PRSA,V?REACH-IN,V?LOOK-INSIDE \?L3
	EQUAL? PRSO,PSEUDO-OBJECT \?L3
	CALL PERFORM,PRSA,ID-CHANGER,PRSI
	RTRUE
?L3:	EQUAL? PRSA,V?PUT \FALSE
	EQUAL? PRSI,PSEUDO-OBJECT \FALSE
	CALL PERFORM,PRSA,PRSO,ID-CHANGER
	RTRUE

	.FUNCT ID-CHANGER-F
	EQUAL? PRSA,V?EXAMINE \?L1
	PRINTI "The machine is of very flimsy construction. An inspection reveals only two notable features: a keypad and a very small slot. The machine is currently o"
	FSET? ID-CHANGER,ACTIVEBIT \?L3
	PRINTI "n"
	JUMP ?L5
?L3:	PRINTI "ff"
?L5:	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?CLOSE,V?OPEN \?L6
	PRINT HUH
	RTRUE
?L6:	EQUAL? PRSA,V?TAKE \?L7
	PRINT WONT-BUDGE
	RTRUE
?L7:	EQUAL? PRSA,V?PUT \?L8
	EQUAL? PRSI,ID-CHANGER \?L8
	EQUAL? PRSO,ID-CARD \?L9
	MOVE ID-CARD,ID-CHANGER
	FSET? ID-CHANGER,ACTIVEBIT \?L11
	PRINTI "A voice from the machine says, """
	ZERO? ID-SCRAMBLED /?L13
	PRINTI "Magnetic card data is scrambled; unable to read."""
	ZERO? SCRAMBLED-FOOTNOTE \?L15
	SET 'SCRAMBLED-FOOTNOTE,1
	PRINTI " (Footnote 15)"
?L15:	CRLF
	RTRUE
?L13:	PRINTI "Current rank is "
	PRINTN ID-RANK
	PRINTI ": "
	SUB ID-RANK,1 >STACK
	GET ID-RANK-LIST,STACK >STACK
	PRINT STACK
	PRINTR ". Enter new rank on keypad."""
?L11:	PRINTR "The card fits neatly into the opening."
?L9:	CALL DOESNT-FIT,STR?327 >STACK
	RSTACK
?L8:	EQUAL? PRSA,V?ON \FALSE
	FSET? ID-CHANGER,ACTIVEBIT /FALSE
	IN? ID-CARD,ID-CHANGER \FALSE
	MOVE ID-CARD,PROTAGONIST
	FSET ID-CHANGER,ACTIVEBIT
	PRINTI "The machine begins whirring lightly. "
	CALL PERFORM,V?PUT,ID-CARD,ID-CHANGER
	RTRUE

	.FUNCT ID-CHANGER-TYPE
	IN? ID-CARD,ID-CHANGER \?L1
	FSET? ID-CHANGER,ACTIVEBIT \?L1
	ZERO? ID-SCRAMBLED /?L3
	ZERO? SCRAMBLED-FOOTNOTE \?L5
	SET 'SCRAMBLED-FOOTNOTE,1
	PRINTI "(Footnote 15) "
?L5:	CALL RECORDING,STR?328 >STACK
	RSTACK
?L3:	GRTR? P-NUMBER,10 \?L8
	PRINTI """Error!"" chirps the "
	PRINTD ID-CHANGER
	PRINTR ". ""The highest rank number recognized by the Stellar Patrol is 10."""
?L8:	LESS? P-NUMBER,1 \?L9
	PRINTR "You may DESERVE a rank that low, but unfortunately it doesn't exist."
?L9:	SET 'ID-RANK,P-NUMBER
	PRINTI """New rank is "
	PRINTN ID-RANK
	PRINTI ": "
	SUB ID-RANK,1 >STACK
	GET ID-RANK-LIST,STACK >STACK
	PRINT STACK
	PRINTR "."""
?L1:	PRINT NOTHING-HAPPENS
	RTRUE

	.FUNCT JUNK-YARD-F,RARG
	EQUAL? RARG,M-ENTER \FALSE
	FSET? JUNK-YARD,TOUCHBIT /FALSE
	ZERO? VERBOSITY /FALSE
	ZERO? LIT /FALSE
	PRINTI "Studio"
	PRINT CLUTTERED-BUBBLE
	PRINTI "in which an artist has been attempting to build a sculpture in the style of 91st-century scrap art. The sculpture is floating"
	PRINT AT-SECOND-GLANCE
	PRINTI "sculpture is simply a pile of random garbage"
	PRINT ELLIPSIS
	RTRUE

	.FUNCT BOOTS-F
	EQUAL? PRSA,V?TAKE-OFF \?L1
	EQUAL? HERE,VACUUM-STORAGE /?L5
	EQUAL? HERE,AIRLOCK \?L3
	FSET? OUTER-AIRLOCK-DOOR,OPENBIT \?L3
?L5:	PRINTI "Are you nuts? The boots are the only thing preventing you from floating off into space!"
	CRLF
	CALL PRINT-ID,STR?329 >STACK
	RSTACK
?L3:	CALL ULTIMATELY-IN?,ID-CARD >STACK
	ZERO? STACK /FALSE
	FCLEAR BOOTS,TRYTAKEBIT
	FCLEAR ID-CARD,TRYTAKEBIT
	SET 'ID-SCRAMBLED,1
	RFALSE
?L1:	EQUAL? PRSA,V?ATTRACT,V?TAKE-WITH \?L8
	EQUAL? PRSO,LARGE-BIT,SMALL-BIT,MEDIUM-BIT \?L8
	IN? PRSO,HEATING-CHAMBER \?L9
	PRINTI "The bit is too far below the opening of the "
	PRINTD HEATING-CHAMBER
	PRINTR " to be attracted by the boots."
?L9:	MOVE PRSO,PROTAGONIST
	PRINTR """Clink!"""
?L8:	EQUAL? PRSA,V?PUT-ON \?L12
	EQUAL? PRSI,MEDIUM-BIT,HEATING-CHAMBER \?L12
	IN? MEDIUM-BIT,HEATING-CHAMBER \?L12
	CALL PERFORM,V?TAKE-WITH,MEDIUM-BIT,BOOTS
	RTRUE
?L12:	EQUAL? PRSA,V?LOOK-INSIDE \FALSE
	PRINT THERES-NOTHING
	PRINTI "in the boots"
	FSET? BOOTS,WORNBIT \?L14
	PRINTI " besides your feet"
?L14:	PRINT PERIOD-CR
	RTRUE

	.FUNCT GARBAGE-F
	EQUAL? PRSA,V?SEARCH,V?LOOK-INSIDE,V?EXAMINE /?L3
	EQUAL? PRSA,V?DIG \?L1
?L3:	PRINTI "You don't find anything interesting among the garbage"
	EQUAL? HERE,JUNK-YARD \?L4
	FSET? BOOTS,TOUCHBIT /?L4
	PRINTI " besides the aforementioned boots"
?L4:	PRINT PERIOD-CR
	RTRUE
?L1:	EQUAL? PRSA,V?PUT \FALSE
	MOVE PRSO,HERE
	PRINTI "You drop"
	CALL TPRINT-PRSO
	PRINTR " amidst the garbage."

	.INSERT "./annotated_games/stationfall/stationfall_str"
	.END
