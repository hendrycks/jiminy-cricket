	.NEW 5

	.BYTE 5
	.BYTE FLAGS
	.WORD RELEASEID
	.WORD ENDLOD
	.WORD START
	.WORD VOCAB
	.WORD OBJECT
	.WORD GLOBAL
	.WORD IMPURE
	.WORD FLAGS2
	.BYTE 0,0,0,0,0,0
	.WORD WORDS
	.WORD 0,0
	.WORD 0
	.WORD 0
	.WORD 0
	.WORD 0
	.WORD 0
	.WORD 0
	.WORD 0
	.WORD 0
	.WORD TCHARS
	.WORD 0
	.WORD 0
	.WORD CHRSET
	.WORD EXTAB
	.WORD 0
	.WORD 0
	.WORD 0
	.WORD 0
	.INSERT "./sherlock/sherlock_freq"
	.INSERT "./sherlock/sherlock_data"

	.FUNCT PRINT-DESC1,OBJ
	ZERO? OBJ /FALSE
	ICALL2 DPRINT,OBJ
	RTRUE

	.FUNCT PRINT-ID,ID,CONDITION
	ASSIGNED? 'CONDITION /?L4
	SET 'CONDITION,1
?L4:	ZERO? CONDITION /FALSE
	PRINTI "[ID: "
	PRINT ID
	PRINTI ", PRSO: "
	PRINTI ", PRSI: "
	PRINTI "]"
	RTRUE

	.FUNCT PRINT-DEBUG,TEXT,CONDITION
	ASSIGNED? 'CONDITION /?L4
	SET 'CONDITION,1
?L4:	ZERO? CONDITION /FALSE
	PRINTI "DEBUG FLAG: "
	PRINT TEXT
	RTRUE

	.FUNCT IS-THEFT?
	EQUAL? GL-PRSA,V?TAKE \FALSE
	EQUAL? GL-PRSO,LG-BOATS,LG-PLAQUES,TH-BED /TRUE
	EQUAL? GL-PRSO,TH-BEDSIDE-TABLE,TH-BLIGH-BOAT,TH-BLUE-PAPER /TRUE
	EQUAL? GL-PRSO,TH-BOAT,TH-BOX-KEY,TH-BROWN-PAPER /TRUE
	EQUAL? GL-PRSO,TH-BUNG,TH-BUTT-OF-MALMSEY,TH-CARNATION /TRUE
	EQUAL? GL-PRSO,TH-CHARLES-STATUE,TH-CHAUCER-TOMB,TH-CIGARETTE /TRUE
	EQUAL? GL-PRSO,TH-CLAPPER,TH-CLUE-BOOK,TH-CRAYON /TRUE
	EQUAL? GL-PRSO,TH-CROWN-JEWELS,TH-DRAKE-STATUE,TH-ELIZAS-FLOWERS /TRUE
	EQUAL? GL-PRSO,TH-EMERALD,TH-GARNET,TH-GREEN-PAPER /TRUE
	EQUAL? GL-PRSO,TH-GROWLER-CAB,TH-GUARDS-KEYS,TH-HANSOM-CAB /TRUE
	EQUAL? GL-PRSO,TH-JEWEL-CASE,TH-JOHN-STATUE,TH-LAIR-KEY /TRUE
	EQUAL? GL-PRSO,TH-LIBRARY-TABLE,TH-MACE,TH-MALMSEY /TRUE
	EQUAL? GL-PRSO,TH-MORIARTY-DESK,TH-NELSON-EYE,TH-OAR-1 /TRUE
	EQUAL? GL-PRSO,TH-OAR-2,TH-OAR-LOCK,TH-OPAL /TRUE
	EQUAL? GL-PRSO,TH-ORANGE-PAPER,TH-PACKET-OF-PAPER,TH-PADDLE /TRUE
	EQUAL? GL-PRSO,TH-PARK-FLOWERS,TH-PRAMS,TH-RED-GLASS /TRUE
	EQUAL? GL-PRSO,TH-ROPE,TH-RUBBINGS,TH-RUBY /TRUE
	EQUAL? GL-PRSO,TH-SAFETY-DEPOSIT-BOX,TH-SAPPHIRE,TH-SUIT-OF-ARMOUR /TRUE
	EQUAL? GL-PRSO,TH-TOPAZ,TH-TORCH,TH-TRINKETS /TRUE
	EQUAL? GL-PRSO,TH-TURBAN,TH-VIOLIN,TH-WAX-AX /TRUE
	EQUAL? GL-PRSO,TH-WAX-HEAD,TH-WHITE-PAPER,TH-YELLOW-PAPER /TRUE
	RFALSE

	.FUNCT IS-OBJECT-OR-PROPERTY?
	EQUAL? GL-PRSO,LG-BAKER-ST-DOOR,LG-BANK-VAULT-DOOR,LG-BAR-OF-GOLD-DOOR /TRUE
	EQUAL? GL-PRSO,LG-BOATS,LG-BRITISH-MUSEUM-DOOR,LG-COLUMNS /TRUE
	EQUAL? GL-PRSO,LG-HOLMES-BEDROOM-DOOR,LG-HOLMES-STUDY-DOOR,LG-JERICHO-PARLOUR-DOOR /TRUE
	EQUAL? GL-PRSO,LG-LAIR-DOOR,LG-MARBLE,LG-PARLOUR-DOOR /TRUE
	EQUAL? GL-PRSO,LG-PLAQUES,LG-PORTCULLIS-DOOR,LG-SHOPS /TRUE
	EQUAL? GL-PRSO,LG-STAIRWAY,LG-STREETLIGHT,LG-TOMBS-ABBEY /TRUE
	EQUAL? GL-PRSO,LG-TOWER,LG-WESTMINSTER-DOOR,LG-WINDOW /TRUE
	EQUAL? GL-PRSO,TH-ANCHOR,TH-ANCHOR-CHAIN,TH-ANNE-OF-CLEVES-TOMB /TRUE
	EQUAL? GL-PRSO,TH-ASH,TH-BANK-OF-CANDLES,TH-BED /TRUE
	EQUAL? GL-PRSO,TH-BEDSIDE-TABLE,TH-BELL,TH-BLIGH-BOAT /TRUE
	EQUAL? GL-PRSO,TH-BLUE-PAPER,TH-BOAT,TH-BOOK-PAGE /TRUE
	EQUAL? GL-PRSO,TH-BOX-KEY,TH-BOX-LOCK,TH-BOXES /TRUE
	EQUAL? GL-PRSO,TH-BROWN-PAPER,TH-BUNG,TH-BUTT-OF-MALMSEY /TRUE
	EQUAL? GL-PRSO,TH-CARNATION,TH-CHARLES-STATUE,TH-CHAUCER-TOMB /TRUE
	EQUAL? GL-PRSO,TH-CIGARETTE,TH-CLAPPER,TH-CLUE-BOOK /TRUE
	EQUAL? GL-PRSO,TH-CLUMP-OF-MOSS,TH-CRAYON,TH-CROWN-JEWELS /TRUE
	EQUAL? GL-PRSO,TH-DEAD-PIGEON,TH-DIAL,TH-DICKENS-TOMB /TRUE
	EQUAL? GL-PRSO,TH-DRAKE-STATUE,TH-EDWARD-TOMB,TH-ELIZABETH-STATUE /TRUE
	EQUAL? GL-PRSO,TH-ELIZABETH-TOMB,TH-ELIZAS-FLOWERS,TH-EMERALD /TRUE
	EQUAL? GL-PRSO,TH-ETHERIUM-AMPOULE,TH-ETHERIUM-GAS,TH-FAWKES-STATUE /TRUE
	EQUAL? GL-PRSO,TH-GARNET,TH-GREEN-PAPER,TH-GROWLER-CAB /TRUE
	EQUAL? GL-PRSO,TH-GUARDS-KEYS,TH-GUARDS-POCKET,TH-GUN /TRUE
	EQUAL? GL-PRSO,TH-HANSOM-CAB,TH-HENRY-V-TOMB,TH-HENRY-VII-TOMB /TRUE
	EQUAL? GL-PRSO,TH-JEWEL-CASE,TH-JOHN-STATUE,TH-KNIFE /TRUE
	EQUAL? GL-PRSO,TH-LAB-EQUIPMENT,TH-LAIR-KEY,TH-LAMP /TRUE
	EQUAL? GL-PRSO,TH-LIBRARY-TABLE,TH-LIQUID,TH-LITTLE-PRINCES-TOMB /TRUE
	EQUAL? GL-PRSO,TH-MACE,TH-MAGNIFYING-GLASS,TH-MAIL /TRUE
	EQUAL? GL-PRSO,TH-MALMSEY,TH-MALMSEY-POOL,TH-MANTELPIECE /TRUE
	EQUAL? GL-PRSO,TH-MARY-QUEEN-OF-SCOTS-TOMB,TH-MATCH,TH-MATCHBOOK /TRUE
	EQUAL? GL-PRSO,TH-MORIARTY-DESK,TH-MOROCCO-CASE,TH-NELSON-COLUMN /TRUE
	EQUAL? GL-PRSO,TH-NELSON-EYE,TH-NELSON-STATUE,TH-NEWSPAPER /TRUE
	EQUAL? GL-PRSO,TH-NEWTON-TOMB,TH-OAR-1,TH-OAR-2 /TRUE
	EQUAL? GL-PRSO,TH-OAR-LOCK,TH-OPAL,TH-OPIUM-GAS /TRUE
	EQUAL? GL-PRSO,TH-ORANGE-PAPER,TH-PACKET-OF-PAPER,TH-PADDLE /TRUE
	EQUAL? GL-PRSO,TH-PARK-FLOWERS,TH-PERSIAN-SLIPPER,TH-PHIAL /TRUE
	EQUAL? GL-PRSO,TH-PIPE,TH-PITT-TOMB,TH-POPE-TOMB /TRUE
	EQUAL? GL-PRSO,TH-PORTCULLIS-CHAIN,TH-PRAMS,TH-RAILING /TRUE
	EQUAL? GL-PRSO,TH-RED-GLASS,TH-RING,TH-ROOM /TRUE
	EQUAL? GL-PRSO,TH-ROPE,TH-RUBBINGS,TH-RUBY /TRUE
	EQUAL? GL-PRSO,TH-SAFETY-DEPOSIT-BOX,TH-SAPPHIRE,TH-SHAFT /TRUE
	EQUAL? GL-PRSO,TH-SHILLING,TH-SIXPENCE,TH-SOFA /TRUE
	EQUAL? GL-PRSO,TH-SUIT-OF-ARMOUR,TH-SYRINGE,TH-TELESCOPE /TRUE
	EQUAL? GL-PRSO,TH-THOMAS-STATUE,TH-TOBACCO,TH-TOPAZ /TRUE
	EQUAL? GL-PRSO,TH-TORCH,TH-TRINKETS,TH-TURBAN /TRUE
	EQUAL? GL-PRSO,TH-VERE-TOMB,TH-VIOLIN,TH-WALL /TRUE
	EQUAL? GL-PRSO,TH-WALTER-STATUE,TH-WATERMARK,TH-WAX-AX /TRUE
	EQUAL? GL-PRSO,TH-WAX-HEAD,TH-WESTMINSTER-CLUE,TH-WHITE-PAPER /TRUE
	EQUAL? GL-PRSO,TH-WILLIAM-STATUE,TH-WORKBENCH,TH-YELLOW-PAPER /TRUE
	RFALSE

	.FUNCT IS-PERSON?
	EQUAL? GL-PRSO,CH-AKBAR,CH-BANK-GUARD,CH-BUTLER /TRUE
	EQUAL? GL-PRSO,CH-DENKEEPER,CH-ELIZA-DOOLITTLE,CH-GROWLER-CABBIE /TRUE
	EQUAL? GL-PRSO,CH-HANSOM-CABBIE,CH-HER,CH-HIM /TRUE
	EQUAL? GL-PRSO,CH-HOLMES,CH-HOUSEWIVES,CH-HUDSON /TRUE
	EQUAL? GL-PRSO,CH-LIBRARIAN,CH-MATCH-SNIFFING-DOG,CH-ME /TRUE
	EQUAL? GL-PRSO,CH-MEMBERS,CH-MORIARTY,CH-NANNIES /TRUE
	EQUAL? GL-PRSO,CH-PALACE-GUARD,CH-PRIME-MINISTER,CH-QUEEN /TRUE
	EQUAL? GL-PRSO,CH-SHERMAN,CH-THEM,CH-TOWER-GUARD /TRUE
	EQUAL? GL-PRSO,CH-TRAINED-PIGEON,CH-TUSSAUDS-GUARD,CH-URCHINS /TRUE
	EQUAL? GL-PRSO,CH-VENDOR,CH-WIGGINS,TH-CROWDS /TRUE
	EQUAL? GL-PRSO,TH-ELIZAS-MOUTH,TH-GENERIC-BODY /TRUE
	RFALSE

	.FUNCT IS-ANIMAL?
	EQUAL? GL-PRSO,LG-RAVENS,TH-PIGEONS \FALSE
	RTRUE

	.FUNCT IS-SELF?
	EQUAL? GL-PRSO,CH-PLAYER,CH-YOU,TH-HEAD /TRUE
	EQUAL? GL-PRSO,TH-WATSONS-HEART /TRUE
	RFALSE

	.FUNCT IS-PART-OF-SELF?
	EQUAL? GL-PRSO,TH-EARS,TH-FEET,TH-HANDS /TRUE
	EQUAL? GL-PRSO,TH-PLAYER-BODY /TRUE
	RFALSE

	.FUNCT IS-SELF-OR-PART-OF-SELF?,?TMP
	CALL1 IS-SELF? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL1 IS-PART-OF-SELF? >STACK
	RSTACK

	.FUNCT IS-YOUR-PROPERTY?
	EQUAL? GL-PRSO,TH-BLACK-BAG,TH-BLUE-PILL-BOTTLE,TH-BROWN-PILL-BOTTLE /TRUE
	EQUAL? GL-PRSO,TH-CAB-WHISTLE,TH-CLOTHES,TH-ORANGE-PILL /TRUE
	EQUAL? GL-PRSO,TH-LAPEL,TH-POCKET,TH-POUND-NOTE /TRUE
	EQUAL? GL-PRSO,TH-WATSONS-COAT,TH-WATSONS-HAT,TH-YELLOW-PILL /TRUE
	EQUAL? GL-PRSO,TH-COTTON-BALLS,TH-STETHOSCOPE /TRUE
	RFALSE

	.FUNCT DANGEROUS-DRINK?
	EQUAL? GL-PRSO,LG-WATER \FALSE
	RTRUE

	.FUNCT DANGEROUS-FOOD?
	CALL1 IS-PART-OF-SELF? >STACK
	ZERO? STACK \?L2
	CALL1 IS-OBJECT-OR-PROPERTY? >STACK
	ZERO? STACK /FALSE
?L2:	EQUAL? GL-PRSO,TH-MALMSEY \TRUE
	RFALSE

	.FUNCT IS-OBJ-PROP-ANIMAL?,?TMP
	CALL1 IS-OBJECT-OR-PROPERTY? >?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	CALL1 IS-ANIMAL? >STACK
	RSTACK

	.FUNCT IS-OBJ-PROP-ANIMAL-PRSI?
	EQUAL? GL-PRSI,LG-BAKER-ST-DOOR,LG-BANK-VAULT-DOOR,LG-BAR-OF-GOLD-DOOR /TRUE
	EQUAL? GL-PRSI,LG-BOATS,LG-BRITISH-MUSEUM-DOOR,LG-COLUMNS /TRUE
	EQUAL? GL-PRSI,LG-HOLMES-BEDROOM-DOOR,LG-HOLMES-STUDY-DOOR,LG-JERICHO-PARLOUR-DOOR /TRUE
	EQUAL? GL-PRSI,LG-LAIR-DOOR,LG-MARBLE,LG-PARLOUR-DOOR /TRUE
	EQUAL? GL-PRSI,LG-PLAQUES,LG-PORTCULLIS-DOOR,LG-SHOPS /TRUE
	EQUAL? GL-PRSI,LG-STAIRWAY,LG-STREETLIGHT,LG-TOMBS-ABBEY /TRUE
	EQUAL? GL-PRSI,LG-TOWER,LG-WESTMINSTER-DOOR,LG-WINDOW /TRUE
	EQUAL? GL-PRSI,TH-ANCHOR,TH-ANCHOR-CHAIN,TH-ANNE-OF-CLEVES-TOMB /TRUE
	EQUAL? GL-PRSI,TH-ASH,TH-BANK-OF-CANDLES,TH-BED /TRUE
	EQUAL? GL-PRSI,TH-BEDSIDE-TABLE,TH-BELL,TH-BLIGH-BOAT /TRUE
	EQUAL? GL-PRSI,TH-BLUE-PAPER,TH-BOAT,TH-BOOK-PAGE /TRUE
	EQUAL? GL-PRSI,TH-BOX-KEY,TH-BOX-LOCK,TH-BOXES /TRUE
	EQUAL? GL-PRSI,TH-BROWN-PAPER,TH-BUNG,TH-BUTT-OF-MALMSEY /TRUE
	EQUAL? GL-PRSI,TH-CARNATION,TH-CHARLES-STATUE,TH-CHAUCER-TOMB /TRUE
	EQUAL? GL-PRSI,TH-CIGARETTE,TH-CLAPPER,TH-CLUE-BOOK /TRUE
	EQUAL? GL-PRSI,TH-CLUMP-OF-MOSS,TH-CRAYON,TH-CROWN-JEWELS /TRUE
	EQUAL? GL-PRSI,TH-DEAD-PIGEON,TH-DIAL,TH-DICKENS-TOMB /TRUE
	EQUAL? GL-PRSI,TH-DRAKE-STATUE,TH-EDWARD-TOMB,TH-ELIZABETH-STATUE /TRUE
	EQUAL? GL-PRSI,TH-ELIZABETH-TOMB,TH-ELIZAS-FLOWERS,TH-EMERALD /TRUE
	EQUAL? GL-PRSI,TH-ETHERIUM-AMPOULE,TH-ETHERIUM-GAS,TH-FAWKES-STATUE /TRUE
	EQUAL? GL-PRSI,TH-GARNET,TH-GREEN-PAPER,TH-GROWLER-CAB /TRUE
	EQUAL? GL-PRSI,TH-GUARDS-KEYS,TH-GUARDS-POCKET,TH-GUN /TRUE
	EQUAL? GL-PRSI,TH-HANSOM-CAB,TH-HENRY-V-TOMB,TH-HENRY-VII-TOMB /TRUE
	EQUAL? GL-PRSI,TH-JEWEL-CASE,TH-JOHN-STATUE,TH-KNIFE /TRUE
	EQUAL? GL-PRSI,TH-LAB-EQUIPMENT,TH-LAIR-KEY,TH-LAMP /TRUE
	EQUAL? GL-PRSI,TH-LIBRARY-TABLE,TH-LIQUID,TH-LITTLE-PRINCES-TOMB /TRUE
	EQUAL? GL-PRSI,TH-MACE,TH-MAGNIFYING-GLASS,TH-MAIL /TRUE
	EQUAL? GL-PRSI,TH-MALMSEY,TH-MALMSEY-POOL,TH-MANTELPIECE /TRUE
	EQUAL? GL-PRSI,TH-MARY-QUEEN-OF-SCOTS-TOMB,TH-MATCH,TH-MATCHBOOK /TRUE
	EQUAL? GL-PRSI,TH-MORIARTY-DESK,TH-MOROCCO-CASE,TH-NELSON-COLUMN /TRUE
	EQUAL? GL-PRSI,TH-NELSON-EYE,TH-NELSON-STATUE,TH-NEWSPAPER /TRUE
	EQUAL? GL-PRSI,TH-NEWTON-TOMB,TH-OAR-1,TH-OAR-2 /TRUE
	EQUAL? GL-PRSI,TH-OAR-LOCK,TH-OPAL,TH-OPIUM-GAS /TRUE
	EQUAL? GL-PRSI,TH-ORANGE-PAPER,TH-PACKET-OF-PAPER,TH-PADDLE /TRUE
	EQUAL? GL-PRSI,TH-PARK-FLOWERS,TH-PERSIAN-SLIPPER,TH-PHIAL /TRUE
	EQUAL? GL-PRSI,TH-PIPE,TH-PITT-TOMB,TH-POPE-TOMB /TRUE
	EQUAL? GL-PRSI,TH-PORTCULLIS-CHAIN,TH-PRAMS,TH-RAILING /TRUE
	EQUAL? GL-PRSI,TH-RED-GLASS,TH-RING,TH-ROOM /TRUE
	EQUAL? GL-PRSI,TH-ROPE,TH-RUBBINGS,TH-RUBY /TRUE
	EQUAL? GL-PRSI,TH-SAFETY-DEPOSIT-BOX,TH-SAPPHIRE,TH-SHAFT /TRUE
	EQUAL? GL-PRSI,TH-SHILLING,TH-SIXPENCE,TH-SOFA /TRUE
	EQUAL? GL-PRSI,TH-SUIT-OF-ARMOUR,TH-SYRINGE,TH-TELESCOPE /TRUE
	EQUAL? GL-PRSI,TH-THOMAS-STATUE,TH-TOBACCO,TH-TOPAZ /TRUE
	EQUAL? GL-PRSI,TH-TORCH,TH-TRINKETS,TH-TURBAN /TRUE
	EQUAL? GL-PRSI,TH-VERE-TOMB,TH-VIOLIN,TH-WALL /TRUE
	EQUAL? GL-PRSI,TH-WALTER-STATUE,TH-WATERMARK,TH-WAX-AX /TRUE
	EQUAL? GL-PRSI,TH-WAX-HEAD,TH-WESTMINSTER-CLUE,TH-WHITE-PAPER /TRUE
	EQUAL? GL-PRSI,TH-WILLIAM-STATUE,TH-WORKBENCH,TH-YELLOW-PAPER /TRUE
	EQUAL? GL-PRSI,LG-RAVENS,TH-PIGEONS /TRUE
	RFALSE

	.FUNCT IS-PERSON-ANIMAL-PRSI?
	EQUAL? GL-PRSI,CH-AKBAR,CH-BANK-GUARD,CH-BUTLER /TRUE
	EQUAL? GL-PRSI,CH-DENKEEPER,CH-ELIZA-DOOLITTLE,CH-GROWLER-CABBIE /TRUE
	EQUAL? GL-PRSI,CH-HANSOM-CABBIE,CH-HER,CH-HIM /TRUE
	EQUAL? GL-PRSI,CH-HOLMES,CH-HOUSEWIVES,CH-HUDSON /TRUE
	EQUAL? GL-PRSI,CH-LIBRARIAN,CH-MATCH-SNIFFING-DOG,CH-ME /TRUE
	EQUAL? GL-PRSI,CH-MEMBERS,CH-MORIARTY,CH-NANNIES /TRUE
	EQUAL? GL-PRSI,CH-PALACE-GUARD,CH-PRIME-MINISTER,CH-QUEEN /TRUE
	EQUAL? GL-PRSI,CH-SHERMAN,CH-THEM,CH-TOWER-GUARD /TRUE
	EQUAL? GL-PRSI,CH-TRAINED-PIGEON,CH-TUSSAUDS-GUARD,CH-URCHINS /TRUE
	EQUAL? GL-PRSI,CH-VENDOR,CH-WIGGINS,TH-CROWDS /TRUE
	EQUAL? GL-PRSI,TH-ELIZAS-MOUTH,TH-GENERIC-BODY,LG-RAVENS /TRUE
	EQUAL? GL-PRSI,TH-PIGEONS /TRUE
	RFALSE

	.FUNCT RT-COPY-TIME,TBL1,TBL2
	COPYT TBL1,TBL2,K-A-TWDTH
	RTRUE

	.FUNCT RT-NORM-TIME,TIME-TABLE,TEMP,M-LEN,?TMP
	GETB TIME-TABLE,K-SEC >TEMP
	MOD TEMP,60 >STACK
	PUTB TIME-TABLE,K-SEC,STACK
	DIV TEMP,60 >STACK
	GETB TIME-TABLE,K-MIN >STACK
	ADD STACK,STACK >TEMP
	MOD TEMP,60 >STACK
	PUTB TIME-TABLE,K-MIN,STACK
	DIV TEMP,60 >STACK
	GETB TIME-TABLE,K-HRS >STACK
	ADD STACK,STACK >TEMP
	MOD TEMP,24 >STACK
	PUTB TIME-TABLE,K-HRS,STACK
	GETB TIME-TABLE,K-DAY >?TMP
	DIV TEMP,24 >TEMP
	ADD ?TMP,TEMP >STACK
	PUTB TIME-TABLE,K-DAY,STACK
	RTRUE

	.FUNCT RT-DO-CLOCK-SET,TBL,HRS,MIN,SEC,DAY
	ASSIGNED? 'DAY /?L1
	SET 'DAY,0
?L1:	PUTB TBL,K-SEC,SEC
	PUTB TBL,K-MIN,MIN
	PUTB TBL,K-HRS,HRS
	PUTB TBL,K-DAY,DAY
	RETURN TBL

	.FUNCT RT-CLOCK-INC,N
	ZERO? GL-CLOCK-WAIT /?L1
	SET 'GL-CLOCK-WAIT,0
	RFALSE
?L1:	ZERO? GL-CLOCK-STOP \FALSE
	SET 'N,0
?L5:	GETB GL-TIME-UPDT-INC,N >STACK
	GETB GL-TIME,N >STACK
	ADD STACK,STACK >STACK
	PUTB GL-TIME,N,STACK
	IGRTR? 'N,3 \?L5
	COPYT GL-TIME-UPDT-DEF,GL-TIME-UPDT-INC,K-A-TWDTH
	CALL2 RT-NORM-TIME,GL-TIME >STACK
	RSTACK

	.FUNCT RT-CLOCK-CMP,HRS,MIN,SEC,DAY,TMP
	ASSIGNED? 'DAY /?L14
	SET 'DAY,0
?L14:	ZERO? DAY /?L4
	GETB GL-TIME,K-DAY >TMP
	GRTR? DAY,TMP /TRUE
	LESS? DAY,TMP \?L4
	RETURN -1
?L4:	GETB GL-TIME,K-HRS >TMP
	GRTR? HRS,TMP /TRUE
	LESS? HRS,TMP \?L8
	RETURN -1
?L8:	GETB GL-TIME,K-MIN >TMP
	GRTR? MIN,TMP /TRUE
	LESS? MIN,TMP \?L10
	RETURN -1
?L10:	GETB GL-TIME,K-SEC >TMP
	GRTR? SEC,TMP /TRUE
	LESS? SEC,TMP \FALSE
	RETURN -1

	.FUNCT RT-CLOCK-JMP,HRS,MIN,SEC,DAY
	ASSIGNED? 'DAY /?L4
	SET 'DAY,0
?L4:	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,HRS,MIN,SEC,DAY
	ICALL1 RT-CLOCK-INC
	EQUAL? GL-PRSA,V?WAIT,V?WAIT-FOR \?L1
	PUSH 2
	JUMP ?L3
?L1:	PUSH 1
?L3:	ICALL2 RT-ALARM-CHK,STACK
	SET 'GL-CLOCK-WAIT,1
	RETURN GL-CLOCK-WAIT

	.FUNCT RT-CLK-NTI-MSG,FMT,HRS,MIN,SEC,MSD,MER,AM-PM?
	ASSIGNED? 'FMT /?L45
	SET 'FMT,7
?L45:	SET 'AM-PM?,0
	GETB GL-TIME,K-HRS >HRS
	GETB GL-TIME,K-MIN >MIN
	GETB GL-TIME,K-SEC >SEC
	BTST FMT,K-NTI-HH \?L1
	BTST FMT,K-NTI-MT \?L3
	SET 'MSD,STR?98
	JUMP ?L8
?L3:	ZERO? HRS \?L5
	ADD HRS,12 >HRS
	SET 'MSD,STR?99
	SET 'AM-PM?,1
	JUMP ?L8
?L5:	LESS? HRS,12 \?L6
	SET 'MSD,STR?99
	SET 'AM-PM?,1
	JUMP ?L8
?L6:	EQUAL? HRS,12 \?L7
	SET 'MSD,STR?99
	SET 'AM-PM?,2
	JUMP ?L8
?L7:	SUB HRS,12 >HRS
	SET 'MSD,STR?99
	SET 'AM-PM?,2
?L8:	EQUAL? AM-PM?,1 \?L9
	BTST FMT,K-NTI-SM \?L11
	SET 'MER,STR?100
	JUMP ?L18
?L11:	SET 'MER,STR?101
	JUMP ?L18
?L9:	EQUAL? AM-PM?,2 \?L14
	BTST FMT,K-NTI-SM \?L15
	SET 'MER,STR?102
	JUMP ?L18
?L15:	SET 'MER,STR?103
	JUMP ?L18
?L14:	SET 'MER,STR?99
?L18:	LESS? HRS,10 \?L19
	PRINT MSD
?L19:	PRINTN HRS
?L1:	BTST FMT,K-NTI-MM \?L23
	BTST FMT,K-NTI-HH \?L25
	PRINTI ":"
?L25:	LESS? MIN,10 \?L28
	PRINTI "0"
?L28:	PRINTN MIN
?L23:	BTST FMT,K-NTI-SS \?L32
	BTST FMT,K-NTI-HH /?L36
	BTST FMT,K-NTI-MM \?L34
?L36:	PRINTI ":"
?L34:	LESS? SEC,10 \?L38
	PRINTI "0"
?L38:	PRINTN SEC
?L32:	BTST FMT,K-NTI-HH \FALSE
	PRINT MER
	RTRUE

	.FUNCT RT-CLK-DOW-MSG,FMT,DOW,WDOW
	ASSIGNED? 'FMT /?L8
	SET 'FMT,1
?L8:	GETB GL-TIME,K-DAY >STACK
	SUB STACK,K-DOW-BASE >STACK
	MOD STACK,7 >DOW
	BTST FMT,K-DOW-DW \FALSE
	BTST FMT,K-DOW-EN \?L3
	ADD DOW,14 >STACK
	GET GL-DAY-NAME,STACK >WDOW
	JUMP ?L6
?L3:	BTST FMT,K-DOW-SN \?L5
	ADD DOW,7 >STACK
	GET GL-DAY-NAME,STACK >WDOW
	JUMP ?L6
?L5:	GET GL-DAY-NAME,DOW >WDOW
?L6:	PRINT WDOW
	RTRUE

	.FUNCT RT-ALARM-SET?,RTN,R-PTR,T-PTR
	SET 'R-PTR,0
?L1:	EQUAL? R-PTR,K-A-RSIZE /FALSE
	GET GL-A-ROUT,R-PTR >STACK
	EQUAL? RTN,STACK \?L5
	MUL R-PTR,K-A-TWDTH >T-PTR
	ADD GL-A-TIME,T-PTR >STACK
	ICALL RT-COPY-TIME,STACK,GL-TIME-PARM
	RTRUE
?L5:	INC 'R-PTR
	JUMP ?L1

	.FUNCT RT-ALARM-SET-REL,RTN,TIME,R-PTR,T-PTR,N
	SET 'R-PTR,0
?L1:	EQUAL? R-PTR,K-A-RSIZE \?L3
	CRLF
	PRINTI "*** TOO MANY ALARMS (REL) ***"
	CRLF
	CRLF
	RFALSE
?L3:	GET GL-A-ROUT,R-PTR >STACK
	ZERO? STACK \?L6
	PUT GL-A-ROUT,R-PTR,RTN
	MUL R-PTR,K-A-TWDTH >T-PTR
	ZERO? GL-ALARM-EXEC /?L8
	SET 'N,0
?L10:	GETB TIME,N >STACK
	GETB GL-TIME,N >STACK
	ADD STACK,STACK >STACK
	ADD T-PTR,N >STACK
	PUTB GL-A-TIME,STACK,STACK
	IGRTR? 'N,3 \?L10
	JUMP ?L17
?L8:	SET 'N,0
?L16:	GETB GL-TIME-UPDT-INC,N >STACK
	GETB TIME,N >STACK
	GETB GL-TIME,N >STACK
	ADD STACK,STACK >STACK
	ADD STACK,STACK >STACK
	ADD T-PTR,N >STACK
	PUTB GL-A-TIME,STACK,STACK
	IGRTR? 'N,3 \?L16
?L17:	ADD GL-A-TIME,T-PTR >STACK
	ICALL2 RT-NORM-TIME,STACK
	RTRUE
?L6:	INC 'R-PTR
	JUMP ?L1

	.FUNCT RT-ALARM-SET-ABS,RTN,TIME,R-PTR,T-PTR
	SET 'R-PTR,0
?L1:	EQUAL? R-PTR,K-A-RSIZE \?L3
	CRLF
	PRINTI "*** TOO MANY (ABS) ALARMS ***"
	CRLF
	CRLF
	RFALSE
?L3:	GET GL-A-ROUT,R-PTR >STACK
	ZERO? STACK \?L6
	PUT GL-A-ROUT,R-PTR,RTN
	MUL R-PTR,K-A-TWDTH >T-PTR
	ADD GL-A-TIME,T-PTR >STACK
	COPYT TIME,STACK,K-A-TWDTH
	RTRUE
?L6:	INC 'R-PTR
	JUMP ?L1

	.FUNCT RT-ALARM-CLR,RTN,R-PTR,T-PTR
	SET 'R-PTR,0
?L1:	EQUAL? R-PTR,K-A-RSIZE /FALSE
	GET GL-A-ROUT,R-PTR >STACK
	EQUAL? RTN,STACK \?L5
	PUT GL-A-ROUT,R-PTR,0
	MUL R-PTR,K-A-TWDTH >T-PTR
	ADD GL-A-TIME,T-PTR >STACK
	COPYT STACK,0,K-A-TWDTH
?L5:	INC 'R-PTR
	JUMP ?L1

	.FUNCT RT-ALARM-CHK,PARM,VAL,RTN,R-PTR,R-CNT,T-PTR,HRS,MIN,SEC,DAY,T-TIME
	ASSIGNED? 'PARM /?L48
	SET 'PARM,0
?L48:	SET 'RTN,-1
	SET 'R-PTR,0
	SET 'R-CNT,0
	SET 'RUN-SMELL-ETHERIUM?,0
	ZERO? GL-ALARM-WAIT /?L1
	SET 'GL-ALARM-WAIT,0
	RFALSE
?L1:	ZERO? GL-ALARM-STOP \FALSE
	ICALL RT-COPY-TIME,GL-TIME,GL-TEMP-TIME
?L5:	EQUAL? R-PTR,K-A-RSIZE \?L14
	EQUAL? RTN,-1 \?L9
	ZERO? RUN-SMELL-ETHERIUM? \?L50
	RETURN R-CNT
?L9:	SET 'R-PTR,RTN
	GET GL-A-ROUT,R-PTR >RTN
	MUL R-PTR,K-A-TWDTH >T-PTR
	PUT GL-A-ROUT,R-PTR,0
	ADD GL-A-TIME,T-PTR >T-TIME
	GETB T-TIME,K-SEC >SEC
	GETB T-TIME,K-MIN >MIN
	GETB T-TIME,K-HRS >HRS
	GETB T-TIME,K-DAY >DAY
	COPYT T-TIME,0,K-A-TWDTH
	FSET? CH-PLAYER,FL-ASLEEP /?L15
	ICALL1 RT-UPDATE-STATUS-LINE
?L15:	SET 'GL-ALARM-EXEC,1
	CALL1 RTN >VAL
	ZERO? RUN-SMELL-ETHERIUM? \?L50
	SET 'GL-ALARM-EXEC,0
	ICALL RT-COPY-TIME,GL-TEMP-TIME,GL-TIME
	INC 'R-CNT
	ZERO? VAL /?L27
	XCALL RT-CLOCK-CMP,HRS,MIN,SEC,DAY >STACK
	EQUAL? STACK,-1 \?L27
	EQUAL? PARM,1 \?L23
	PRINTI "[Press any key to continue.]"
	CRLF
	INPUT 1 >STACK
	JUMP ?L27
?L23:	EQUAL? PARM,2 \?L27
	CRLF
	PRINTI "Do you want to continue waiting?"
	CALL1 RT-GET-YES-NO? >STACK
	ZERO? STACK \?L27
	SET 'RTN,-1
	SET 'R-PTR,K-A-RSIZE
	IXCALL RT-DO-CLOCK-SET,GL-TIME,HRS,MIN,SEC,DAY
?L27:	EQUAL? RTN,-1 /?L5
	SET 'RTN,-1
	SET 'R-PTR,0
	JUMP ?L5
?L14:	GET GL-A-ROUT,R-PTR >STACK
	ZERO? STACK /?L39
	MUL R-PTR,K-A-TWDTH >T-PTR
	ADD T-PTR,K-SEC >STACK
	GETB GL-A-TIME,STACK >SEC
	ADD T-PTR,K-MIN >STACK
	GETB GL-A-TIME,STACK >MIN
	ADD T-PTR,K-HRS >STACK
	GETB GL-A-TIME,STACK >HRS
	ADD T-PTR,K-DAY >STACK
	GETB GL-A-TIME,STACK >DAY
	ZERO? PARM /?L49
	XCALL RT-CLOCK-CMP,HRS,MIN,SEC,DAY >STACK
	EQUAL? STACK,-1 /?L41
	ZERO? PARM \?L39
?L49:	XCALL RT-CLOCK-CMP,HRS,MIN,SEC,DAY >STACK
	EQUAL? STACK,-1,0 \?L39
?L41:	IXCALL RT-DO-CLOCK-SET,GL-TIME,HRS,MIN,SEC,DAY
	SET 'RTN,R-PTR
?L39:	INC 'R-PTR
	JUMP ?L5
?L50:	ICALL1 RT-SMELL-ETHERIUM?
	RETURN R-CNT

	.FUNCT RT-META-IN?,OBJ1,OBJ2
?L1:	ZERO? OBJ1 /FALSE
	IN? OBJ1,ROOMS /FALSE
	IN? OBJ1,LOCAL-GLOBALS /FALSE
	EQUAL? OBJ1,OBJ2 /TRUE
	LOC OBJ1 >OBJ1
	JUMP ?L1

	.FUNCT RT-SEE-INSIDE?,THING
	ZERO? THING /FALSE
	FSET? THING,FL-SURFACE /TRUE
	FSET? THING,FL-CONTAINER \?L4
	FSET? THING,FL-OPENED /TRUE
	FSET? THING,FL-TRANSPARENT /TRUE
?L4:	FSET? THING,FL-PERSON /?L7
	FSET? THING,FL-ALIVE \FALSE
?L7:	EQUAL? THING,CH-PLAYER /FALSE
	RTRUE

	.FUNCT RT-VISIBLE?,OBJ
	CALL RT-ACCESSIBLE?,OBJ,1 >STACK
	RSTACK

	.FUNCT CLOSED?,WLOC,VISIBLE?
	ZERO? WLOC /FALSE
	FSET? WLOC,FL-OPENED /FALSE
	ZERO? VISIBLE? /?L3
	FSET? WLOC,FL-TRANSPARENT /FALSE
?L3:	FSET? WLOC,FL-SURFACE /FALSE
	FSET? WLOC,FL-ALIVE /FALSE
	IN? WLOC,ROOMS \TRUE
	RFALSE

	.FUNCT RT-ACCESSIBLE?,OBJ,VISIBLE?,LOC,OLOC,WLOC,RMG,RMGL
	ASSIGNED? 'VISIBLE? /?L41
	SET 'VISIBLE?,0
?L41:	GETPT GL-PLACE-CUR,P?GLOBAL >RMG
	PTSIZE RMG >RMGL
	ZERO? OBJ \?L1
	SET 'GL-CLOSED-OBJECT,0
	RFALSE
?L1:	EQUAL? OBJ,ROOMS /TRUE
	EQUAL? OBJ,PSEUDO-OBJECT \?L4
	EQUAL? LAST-PSEUDO-LOC,GL-PLACE-CUR \FALSE
	RTRUE
?L4:	LOC GL-WINNER >WLOC
?L8:	IN? WLOC,ROOMS /?L9
	CALL CLOSED?,WLOC,VISIBLE? >STACK
	ZERO? STACK \?L9
	LOC WLOC >WLOC
	JUMP ?L8
?L9:	SET 'OLOC,OBJ
	EQUAL? OLOC,WLOC /TRUE
?L13:	ZERO? OLOC /FALSE
	IN? OLOC,GLOBAL-OBJECTS /?L23
	INTBL? OLOC,RMG,RMGL,1 >STACK \?L21
?L23:	IN? OLOC,ROOMS \TRUE
	EQUAL? OLOC,OBJ /TRUE
	RFALSE
?L21:	IN? OLOC,ROOMS /FALSE
	LOC OLOC >OLOC
	EQUAL? OLOC,WLOC /TRUE
	CALL CLOSED?,OLOC,VISIBLE? >STACK
	ZERO? STACK /?L13
	IN? OLOC,GLOBAL-OBJECTS /TRUE
	INTBL? OLOC,RMG,RMGL,1 >STACK /TRUE
	SET 'GL-CLOSED-OBJECT,OLOC
	SET 'GL-IN-OUT,1
	RFALSE

	.FUNCT RT-DONT-ALL?,O,I,L
	LOC O >L
	ZERO? L /TRUE
	EQUAL? O,I /TRUE
	FSET? O,FL-BODYPART /TRUE
	FSET? O,FL-NOALL /TRUE
	EQUAL? GL-PRSA,V?TAKE \?L6
	ZERO? I \?L7
	CALL RT-META-IN?,O,GL-WINNER >STACK
	ZERO? STACK /?L7
	IN? O,GL-WINNER /TRUE
	GET GL-P-NAMW,0 >STACK
	ZERO? STACK /TRUE
	GET GL-P-BUTS,K-P-MATCHLEN >STACK
	ZERO? STACK \TRUE
?L7:	FSET? O,FL-TAKEABLE /?L10
	FSET? O,FL-TRYTAKE \TRUE
?L10:	FSET? L,FL-PERSON \?L11
	EQUAL? L,I \TRUE
?L11:	FSET? L,FL-CONTAINER \?L12
	FSET? L,FL-OPENED \TRUE
?L12:	ZERO? I /?L13
	EQUAL? L,I \TRUE
	CALL2 RT-SEE-INSIDE?,I >STACK
	ZERO? STACK /TRUE
	RFALSE
?L13:	EQUAL? L,GL-PLACE-CUR /FALSE
	CALL2 RT-SEE-INSIDE?,L >STACK
	ZERO? STACK /TRUE
	RFALSE
?L6:	EQUAL? GL-PRSA,V?DROP,V?PUT,V?PUT-ON /?L22
	EQUAL? GL-PRSA,V?THROW,V?THROW-OVER \FALSE
?L22:	EQUAL? O,TH-POCKET /TRUE
	EQUAL? L,TH-POCKET /TRUE
	FSET? O,FL-WORN /TRUE
	EQUAL? L,GL-WINNER \TRUE
	RFALSE

	.FUNCT DPRINT,O,X
	FSET? O,FL-HAS-SDESC \?L1
	GETP O,P?ACTION >X
	ZERO? X /?L1
	CALL2 X,K-M-SDESC >STACK
	RSTACK
?L1:	PRINTD O
	RTRUE

	.FUNCT RT-A-PRINT,O
	ASSIGNED? 'O /?L1
	SET 'O,0
?L1:	ICALL RT-THEO-PRINT,O,0,K-DESC-A
	RTRUE

	.FUNCT RT-THEO-PRINT,O,CAP?,CLASS
	ASSIGNED? 'O /?L33
	SET 'O,0
?L33:	ASSIGNED? 'CAP? /?L34
	SET 'CAP?,0
?L34:	ASSIGNED? 'CLASS /?L35
	SET 'CLASS,K-DESC-THE
?L35:	ZERO? O \?L1
	SET 'O,GL-PRSO
?L1:	ZERO? CAP? /?L4
	DIROUT K-D-SCR-OFF
	DIROUT K-D-TBL-ON,GL-DIROUT-TBL
?L4:	FSET? O,FL-NOARTC /?L9
	FSET? O,FL-YOUR \?L11
	PRINTI "your"
	JUMP ?L20
?L11:	EQUAL? CLASS,K-DESC-ANY \?L13
	PRINTI "any"
	JUMP ?L20
?L13:	EQUAL? CLASS,K-DESC-THE /?L15
	FSET? O,FL-PLURAL \?L16
	FSET? O,FL-PERSON \?L14
?L15:	PRINTI "the"
	JUMP ?L20
?L14:	FSET? O,FL-PLURAL \?L16
	FSET? O,FL-PERSON /?L16
	PRINTI "some"
	JUMP ?L20
?L16:	EQUAL? O,LG-WATER /?L20
	FSET? O,FL-VOWEL \?L18
	PRINTI "an"
	JUMP ?L20
?L18:	PRINTI "a"
?L20:	PRINTC 32
	JUMP ?L22
?L9:	FSET? O,FL-HAS-SDESC \?L22
	GETP O,P?ACTION >STACK
	ICALL STACK,K-M-SDESC,CLASS
	JUMP ?L26
?L22:	EQUAL? O,CH-ME \?L24
	ZERO? CAP? /?L24
	PRINTI "you"
	JUMP ?L26
?L24:	ICALL2 DPRINT,O
?L26:	ZERO? CAP? /TRUE
	DIROUT K-D-TBL-OFF
	DIROUT K-D-SCR-ON
	GETB GL-DIROUT-TBL,2 >CAP?
	LESS? CAP?,97 /?L29
	GRTR? CAP?,122 /?L29
	SUB CAP?,32 >STACK
	PUTB GL-DIROUT-TBL,2,STACK
?L29:	GET GL-DIROUT-TBL,0 >STACK
	PRINTT GL-DIROUT-TBL+2,STACK
	RTRUE

	.FUNCT RT-CTHEO-PRINT,O
	ASSIGNED? 'O /?L1
	SET 'O,0
?L1:	CALL RT-THEO-PRINT,O,1 >STACK
	RSTACK

	.FUNCT RT-THEI-PRINT,I
	ASSIGNED? 'I /?L4
	SET 'I,0
?L4:	ZERO? I \?L1
	SET 'I,GL-PRSI
?L1:	CALL2 RT-THEO-PRINT,I >STACK
	RSTACK

	.FUNCT RT-CTHEI-PRINT,I
	ASSIGNED? 'I /?L4
	SET 'I,0
?L4:	ZERO? I \?L1
	SET 'I,GL-PRSI
?L1:	CALL RT-THEO-PRINT,I,1 >STACK
	RSTACK

	.FUNCT RT-PRINT-SPACES,N,AMT
?L1:	GRTR? N,GL-BLANKS-LEN \?L3
	SET 'AMT,GL-BLANKS-LEN
	JUMP ?L5
?L3:	SET 'AMT,N
?L5:	PRINTT GL-BLANKS,AMT
	SUB N,AMT >N
	GRTR? N,0 /?L1
	RTRUE

	.FUNCT SAY-NUMBER,N,X
	SET 'X,10000
?L1:	LESS? N,X \?L2
	PRINTI " "
	DIV X,10 >X
	LESS? X,10 \?L1
?L2:	PRINTN N
	RTRUE

	.FUNCT RT-UPDATE-STATUS-LINE
	GET 0,8 >STACK
	BTST STACK,4 \?L1
	ICALL2 RT-INIT-SCREEN,1
	GET 0,8 >STACK
	BAND STACK,-5 >STACK
	PUT 0,8,STACK
?L1:	SCREEN K-S-WIN
	HLIGHT K-H-INV
	EQUAL? GL-PLACE-CUR,GL-PLACE-STS /?L11
	ZERO? GL-SHORT-STAT? /?L6
	CURSET GL-SPLIT-ROW,1
	JUMP ?L8
?L6:	CURSET GL-SPLIT-ROW,2
?L8:	CURSET GL-SPLIT-ROW,2
	CALL RT-SAY-ROOM-NAME-IF-LIT,GL-PLACE-CUR,0,1 >STACK
	ZERO? STACK /?L9
	SET 'GL-PLACE-STS,GL-PLACE-CUR
	JUMP ?L11
?L9:	SET 'GL-PLACE-STS,-1
?L11:	CURSET GL-SPLIT-ROW,GL-STAT-T-POS
	ZERO? GL-SHORT-STAT? /?L13
	ICALL2 RT-CLK-DOW-MSG,3
	PRINTI " "
	ICALL2 RT-CLK-NTI-MSG,22
	JUMP ?L15
?L13:	CRLF
	ICALL2 RT-CLK-DOW-MSG,5
	ADD 10,GL-STAT-T-POS >STACK
	CURSET GL-SPLIT-ROW,STACK
	ICALL2 RT-CLK-NTI-MSG,7
?L15:	HLIGHT K-H-NRM
	SCREEN K-S-NOR
	RTRUE

	.FUNCT RT-REFER-TO-MSG
	PRINTR "[To what are you referring?]"

	.FUNCT RT-SAY-ROOM-NAME-IF-LIT,HERE,FORCE?,SL?,LEN,MAXLEN,LC,X,CNT
	ASSIGNED? 'FORCE? /?L27
	SET 'FORCE?,0
?L27:	ASSIGNED? 'SL? /?L28
	SET 'SL?,0
?L28:	SET 'MAXLEN,300
	ASSIGNED? 'HERE /?L1
	SET 'HERE,GL-PLACE-CUR
?L1:	ZERO? SL? /?L2
	SET 'MAXLEN,GL-STAT-MAX-ROOM
?L2:	ZERO? FORCE? \?L7
	ZERO? GL-NOW-LIT? /?L5
?L7:	DIROUT K-D-SCR-OFF
	DIROUT K-D-TBL-ON,GL-DIROUT-TBL
	ICALL2 DPRINT,HERE
	DIROUT K-D-TBL-OFF
	DIROUT K-D-SCR-ON
	GET GL-DIROUT-TBL,0 >LEN
	INC 'LEN
	PUT GL-DIROUT-TBL,0,0
	GRTR? LEN,1 \?L8
	SET 'LC,32
	SET 'CNT,2
?L10:	GETB GL-DIROUT-TBL,CNT >X
	LESS? X,97 /?L14
	GRTR? X,122 /?L14
	EQUAL? CNT,2 /?L16
	EQUAL? LC,32 \?L14
?L16:	SUB X,32 >X
?L14:	PRINTC X
	SET 'LC,X
	IGRTR? 'CNT,LEN /TRUE
	GRTR? CNT,MAXLEN \?L10
	RTRUE
?L8:	GET GL-DIROUT-TBL,2 >STACK
	PRINTC STACK
	RTRUE
?L5:	PRINTI "Darkness"
	RFALSE

	.FUNCT RT-DESCRIBE-PLACE,PLACE,LOOK
	ASSIGNED? 'PLACE /?L14
	SET 'PLACE,0
?L14:	ASSIGNED? 'LOOK /?L15
	SET 'LOOK,0
?L15:	ZERO? PLACE \?L1
	SET 'PLACE,GL-PLACE-CUR
?L1:	CALL RT-IS-LIT?,PLACE,1 >STACK
	ZERO? STACK \?L4
	PRINT K-TOO-DARK-MSG
	CRLF
	RTRUE
?L4:	HLIGHT K-H-BLD
	ICALL RT-SAY-ROOM-NAME-IF-LIT,PLACE,1
	CRLF
	CRLF
	HLIGHT K-H-NRM
	ZERO? LOOK /?L7
	CALL RT-EXEC-RM-DESCFCN,PLACE,K-M-DESC-3 >STACK
	RSTACK
?L7:	FSET? PLACE,FL-TOUCHED /?L9
	FSET PLACE,FL-TOUCHED
	CALL RT-EXEC-RM-DESCFCN,PLACE,K-M-DESC-1 >STACK
	RSTACK
?L9:	EQUAL? GL-DESC-LEVEL,2 \?L10
	CALL RT-EXEC-RM-DESCFCN,PLACE,K-M-DESC-2 >STACK
	RSTACK
?L10:	EQUAL? GL-DESC-LEVEL,1 /TRUE
	ZERO? GL-DESC-LEVEL /FALSE
	RFALSE

	.FUNCT RT-EXEC-RM-DESCFCN,PLACE,CONTEXT,DF
	FSET? PLACE,FL-HAS-DESCFCN \TRUE
	GETP PLACE,P?ACTION >STACK
	CALL2 STACK,CONTEXT >STACK
	ZERO? STACK /TRUE
	RFALSE

	.FUNCT RT-DESCFCN-CONTEXT,CONTEXT
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \FALSE
	RTRUE

	.FUNCT RT-DESC-ALL,PLACE,LOOK,HOLMES-IN-HOUSE?
	ASSIGNED? 'PLACE /?L41
	SET 'PLACE,0
?L41:	ASSIGNED? 'LOOK /?L42
	SET 'LOOK,0
?L42:	SET 'HOLMES-IN-HOUSE?,0
	CALL RT-DESCRIBE-PLACE,PLACE,LOOK >STACK
	ZERO? STACK /?L1
	ICALL RT-DESCRIBE-PLACE-CONTENTS,PLACE,LOOK
?L1:	CALL RT-IS-LIT?,PLACE,1 >STACK
	ZERO? STACK /TRUE
	ZERO? GL-PUPPY-MSG? \?L6
	SET 'GL-PUPPY-MSG?,1
	RTRUE
?L6:	ZERO? GL-PUPPY /TRUE
	EQUAL? GL-PUPPY,CH-HOLMES \?L8
	CRLF
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL,RM-PARLOUR,RM-VESTIBULE /?L12
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY,RM-HOLMES-BEDROOM \?L10
?L12:	SET 'HOLMES-IN-HOUSE?,1
?L10:	ZERO? LOOK /?L14
	IN? CH-HOLMES,TH-BOAT \?L16
	PRINT K-SEASICK-MSG
	JUMP ?L22
?L16:	IN? CH-HOLMES,TH-HANSOM-CAB /?L19
	IN? CH-HOLMES,TH-GROWLER-CAB \?L18
?L19:	PRINT K-SITTING-QUIETLY-MSG
	JUMP ?L22
?L18:	ZERO? HOLMES-IN-HOUSE? /?L20
	CALL2 RT-PICK-NEXT,GL-HOLMES-HOUSE-LOOK-TXT >STACK
	PRINT STACK
	JUMP ?L22
?L20:	FSET? GL-PLACE-CUR,FL-INDOORS \?L21
	CALL2 RT-PICK-NEXT,GL-HOLMES-INDOORS-LOOK-TXT >STACK
	PRINT STACK
	JUMP ?L22
?L21:	CALL2 RT-PICK-NEXT,GL-HOLMES-OUTDOORS-LOOK-TXT >STACK
	PRINT STACK
?L22:	PRINTR "."
?L14:	EQUAL? GL-DESC-LEVEL,2,1 \TRUE
	ZERO? HOLMES-IN-HOUSE? /?L24
	CALL2 RT-PICK-NEXT,GL-HOLMES-HOUSE-ENTER-TXT >STACK
	PRINT STACK
	JUMP ?L27
?L24:	FSET? GL-PLACE-CUR,FL-INDOORS \?L26
	CALL2 RT-PICK-NEXT,GL-HOLMES-INDOORS-ENTER-TXT >STACK
	PRINT STACK
	JUMP ?L27
?L26:	CALL2 RT-PICK-NEXT,GL-HOLMES-OUTDOORS-ENTER-TXT >STACK
	PRINT STACK
?L27:	PRINTR "."
?L8:	EQUAL? GL-PUPPY,CH-WIGGINS \TRUE
	CRLF
	CALL2 RT-PICK-NEXT,GL-WIGGINS-DESC-TXT >STACK
	PRINT STACK
	ZERO? LOOK /?L30
	IN? CH-WIGGINS,TH-BOAT \?L32
	PRINT K-ENJOYING-RIDE-MSG
	JUMP ?L36
?L32:	IN? CH-WIGGINS,TH-HANSOM-CAB /?L35
	IN? CH-WIGGINS,TH-GROWLER-CAB \?L34
?L35:	PRINT K-FIDGETING-MSG
	JUMP ?L36
?L34:	CALL2 RT-PICK-NEXT,GL-WIGGINS-LOOK-TXT >STACK
	PRINT STACK
?L36:	PRINTR "."
?L30:	EQUAL? GL-DESC-LEVEL,2,1 \TRUE
	CALL2 RT-PICK-NEXT,GL-WIGGINS-ENTER-TXT >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT RT-GOTO,NEWPLACE,X,NEWLIT?,OLDPLACE,AMP?,SS?
	SET 'OLDPLACE,GL-PLACE-CUR
	MOVE CH-PLAYER,NEWPLACE
	SET 'GL-PLACE-CUR,NEWPLACE
	CALL1 RT-IS-LIT? >NEWLIT?
	MOVE CH-PLAYER,OLDPLACE
	SET 'GL-PLACE-CUR,OLDPLACE
	ZERO? NEWLIT? \?L1
	ICALL2 TOO-DARK-TO-GO,NEWPLACE
	RTRUE
?L1:	GETP GL-PLACE-CUR,P?ACTION >STACK
	CALL2 STACK,K-M-EXIT >X
	FSET? OLDPLACE,FL-INDOORS /?L4
	FSET? NEWPLACE,FL-INDOORS /?L4
	ICALL RT-CLOCK-JMP,0,5,0
?L4:	SET 'GL-PLACE-PRV,OLDPLACE
	SET 'GL-PLACE-CUR,NEWPLACE
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
	MOVE CH-PLAYER,GL-PLACE-CUR
	GETP GL-PLACE-CUR,P?ACTION >STACK
	CALL2 STACK,K-M-ENTERING >X
	ZERO? GL-PUPPY /?L7
	LOC CH-PLAYER >STACK
	MOVE GL-PUPPY,STACK
	JUMP ?L9
?L7:	ZERO? GL-FORMER-PUPPY /?L9
	IN? GL-FORMER-PUPPY,GL-PLACE-CUR \?L9
	FSET? GL-FORMER-PUPPY,FL-ASLEEP /?L9
	SET 'GL-PUPPY,GL-FORMER-PUPPY
	SET 'GL-FORMER-PUPPY,0
?L9:	ICALL1 RT-DESC-ALL
	IN? TH-ETHERIUM-AMPOULE,CH-PLAYER /?L12
	SET 'AMP?,0
	JUMP ?L14
?L12:	FSET? TH-ETHERIUM-AMPOULE,FL-BROKEN /?L13
	SET 'AMP?,1
	JUMP ?L14
?L13:	SET 'AMP?,0
?L14:	FSET? TH-STETHOSCOPE,FL-WORN /?L15
	SET 'SS?,0
	JUMP ?L16
?L15:	SET 'SS?,1
?L16:	ZERO? AMP? \?L19
	ZERO? SS? /?L17
?L19:	ICALL HOLMES-COMPLAINS,AMP?,SS?
?L17:	GETP GL-PLACE-CUR,P?ACTION >STACK
	CALL2 STACK,K-M-ENTERED >X
	ICALL1 RT-RESET-THEM
	IN? TH-ETHERIUM-GAS,GL-PLACE-CUR \TRUE
	ICALL1 RT-SMELL-ETHERIUM?
	RTRUE

	.FUNCT RT-RESET-THEM
	CALL2 RT-VISIBLE?,GL-P-IT-OBJECT >STACK
	ZERO? STACK \?L1
	SET 'GL-P-IT-OBJECT,TH-NOT-HERE-OBJECT
?L1:	CALL2 RT-VISIBLE?,GL-P-THEM-OBJECT >STACK
	ZERO? STACK \?L4
	SET 'GL-P-THEM-OBJECT,TH-NOT-HERE-OBJECT
?L4:	CALL2 RT-VISIBLE?,GL-P-HIM-OBJECT >STACK
	ZERO? STACK \?L7
	SET 'GL-P-HIM-OBJECT,TH-NOT-HERE-OBJECT
?L7:	CALL2 RT-VISIBLE?,GL-P-HER-OBJECT >STACK
	ZERO? STACK \TRUE
	SET 'GL-P-HER-OBJECT,TH-NOT-HERE-OBJECT
	RTRUE

	.FUNCT RT-UPDATE-SCORE,PTS
	ASSIGNED? 'PTS /?L1
	SET 'PTS,1
?L1:	ADD GL-SCORE-CUR,PTS >GL-SCORE-CUR
	CALL2 RT-NEW-SCORE-MSG,PTS >STACK
	RSTACK

	.FUNCT RT-UPDATE-MOVES,MVS
	ASSIGNED? 'MVS /?L5
	SET 'MVS,1
?L5:	ZERO? GL-CLOCK-WAIT \FALSE
	ZERO? GL-CLOCK-STOP \FALSE
	ADD GL-MOVES-CUR,MVS >GL-MOVES-CUR
	RETURN GL-MOVES-CUR

	.FUNCT RT-UPDATE-CLOCK,HRS,MIN,SEC
	ASSIGNED? 'HRS /?L5
	SET 'HRS,0
?L5:	ASSIGNED? 'MIN /?L6
	SET 'MIN,0
?L6:	ASSIGNED? 'SEC /?L7
	SET 'SEC,0
?L7:	ZERO? HRS \?L3
	ZERO? MIN \?L3
	ZERO? SEC /?L1
?L3:	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,HRS,MIN,SEC
?L1:	CALL1 RT-CLOCK-INC >STACK
	RSTACK

	.FUNCT RT-MAIN-LOOP,ICNT,OCNT,NUM,CNT,OBJ,TBL,V,PTBL,OBJ1,TMP,X,TOUCH-VERB?,MYCROFT?,TV
	SET 'V,0
	SET 'TOUCH-VERB?,0
	SET 'MYCROFT?,0
?L1:	SET 'CNT,0
	SET 'OBJ,0
	SET 'PTBL,1
	SET 'GL-P-MULT?,0
	EQUAL? GL-PLACE-CUR,GL-P-QCONTEXT-RM /?L3
	SET 'GL-P-QCONTEXT-TH,0
?L3:	CALL1 RT-PARSER >GL-P-GOOD
	ZERO? GL-P-GOOD /?L6
	GET GL-P-PRSI,K-P-MATCHLEN >ICNT
	GET GL-P-PRSO,K-P-MATCHLEN >OCNT
	ZERO? GL-P-IT-OBJECT /?L8
	CALL2 RT-ACCESSIBLE?,GL-P-IT-OBJECT >STACK
	ZERO? STACK /?L8
	SET 'TMP,0
?L10:	IGRTR? 'CNT,ICNT /?L11
	GET GL-P-PRSI,CNT >STACK
	EQUAL? STACK,TH-IT \?L10
	PUT GL-P-PRSI,CNT,GL-P-IT-OBJECT
	SET 'TMP,1
?L11:	ZERO? TMP \?L21
	SET 'CNT,0
?L20:	IGRTR? 'CNT,OCNT /?L21
	GET GL-P-PRSO,CNT >STACK
	EQUAL? STACK,TH-IT \?L20
	PUT GL-P-PRSO,CNT,GL-P-IT-OBJECT
?L21:	SET 'CNT,0
?L8:	ZERO? OCNT \?L30
	SET 'NUM,OCNT
	JUMP ?L37
?L30:	GRTR? OCNT,1 \?L32
	SET 'TBL,GL-P-PRSO
	ZERO? ICNT \?L33
	SET 'OBJ,0
	JUMP ?L35
?L33:	GET GL-P-PRSI,1 >OBJ
?L35:	SET 'NUM,OCNT
	JUMP ?L37
?L32:	GRTR? ICNT,1 \?L36
	SET 'PTBL,0
	SET 'TBL,GL-P-PRSI
	GET GL-P-PRSO,1 >OBJ
	SET 'NUM,ICNT
	JUMP ?L37
?L36:	SET 'NUM,1
?L37:	ZERO? OBJ \?L38
	EQUAL? ICNT,1 \?L38
	GET GL-P-PRSI,1 >OBJ
?L38:	EQUAL? GL-PRSA,V?WALK \?L41
	CALL RT-PERFORM,GL-PRSA,GL-PRSO >V
	JUMP ?L130
?L41:	ZERO? NUM \?L43
	GETB GL-P-SYNTAX,0 >STACK
	SHIFT STACK,-6 >STACK
	ZERO? STACK \?L44
	CALL2 RT-PERFORM,GL-PRSA >V
	SET 'GL-PRSO,0
	JUMP ?L130
?L44:	ZERO? GL-NOW-LIT? \?L46
	ICALL1 RT-P-CLEAR
	PRINT K-TOO-DARK-MSG
	CRLF
	JUMP ?L130
?L46:	ICALL1 RT-P-CLEAR
	PRINTI "[There isn't anything to "
	GET GL-P-ITBL,K-P-VERBN >TMP
	CALL1 RT-TALK-VERB? >STACK
	ZERO? STACK /?L48
	PRINTI "talk to"
	JUMP ?L52
?L48:	ZERO? GL-P-MERGED \?L51
	ZERO? GL-P-ORPH /?L50
?L51:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L52
?L50:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	CALL RT-WORD-PRINT,STACK,STACK >V
?L52:	PRINTI ".]"
	CRLF
	SET 'V,0
	JUMP ?L130
?L43:	SET 'X,0
	GRTR? NUM,1 \?L54
	SET 'GL-P-MULT?,1
?L54:	SET 'TMP,0
?L57:	IGRTR? 'CNT,NUM \?L59
	GRTR? X,0 \?L61
	PRINTI "[The "
	EQUAL? X,NUM /?L63
	PRINTI "other "
?L63:	PRINTI "object"
	EQUAL? X,1 /?L66
	PRINTI "s"
?L66:	PRINTI " that you mentioned "
	EQUAL? X,1 /?L69
	PRINTI "are"
	JUMP ?L71
?L69:	PRINTI "is"
?L71:	PRINTI "n't here.]"
	CRLF
	JUMP ?L58
?L61:	ZERO? TMP \?L58
	ICALL1 RT-REFER-TO-MSG
	JUMP ?L58
?L59:	ZERO? PTBL /?L75
	GET GL-P-PRSO,CNT >OBJ1
	JUMP ?L77
?L75:	GET GL-P-PRSI,CNT >OBJ1
?L77:	GRTR? NUM,1 /?L80
	GET GL-P-ITBL,K-P-NC1 >STACK
	GET STACK,0 >STACK
	EQUAL? STACK,W?ALL,W?EVERYTHING \?L86
?L80:	EQUAL? OBJ1,TH-NOT-HERE-OBJECT \?L81
	INC 'X
	JUMP ?L57
?L81:	EQUAL? GL-P-GET-FLAGS,K-P-ALL \?L83
	CALL RT-DONT-ALL?,OBJ1,OBJ >STACK
	ZERO? STACK \?L57
?L83:	CALL2 RT-ACCESSIBLE?,OBJ1 >STACK
	ZERO? STACK /?L57
	EQUAL? OBJ1,CH-PLAYER /?L57
	EQUAL? OBJ1,TH-IT \?L87
	ICALL2 RT-CTHEO-PRINT,GL-P-IT-OBJECT
	JUMP ?L89
?L87:	ICALL2 RT-CTHEO-PRINT,OBJ1
?L89:	PRINTI ": "
?L86:	SET 'TMP,1
	ZERO? PTBL /?L91
	SET 'GL-PRSO,OBJ1
	JUMP ?L93
?L91:	SET 'GL-PRSO,OBJ
?L93:	ZERO? PTBL /?L94
	SET 'GL-PRSI,OBJ
	JUMP ?L96
?L94:	SET 'GL-PRSI,OBJ1
?L96:	EQUAL? GL-WINNER,CH-BUTLER \?L97
	GET GL-P-NAMW,0 >STACK
	EQUAL? STACK,W?HOLMES,W?MYCROFT \?L97
	SET 'MYCROFT?,1
	SET 'TOUCH-VERB?,0
?L97:	ZERO? MYCROFT? \?L108
	EQUAL? GL-PRSA,V?FIND /?L108
	CALL1 RT-TOUCH-VERB? >TOUCH-VERB?
	ZERO? TOUCH-VERB? \?L102
	GET GL-SEE-VERBS,0 >STACK
	INTBL? GL-PRSA,GL-SEE-VERBS+2,STACK >TV \?L108
?L102:	ZERO? GL-PRSO /?L103
	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK \?L103
	ICALL2 RT-CANT-SEE-ANY-MSG,GL-PRSO
	GRTR? OCNT,1 /?L57
	SET 'V,FATAL-VALUE
	JUMP ?L58
?L103:	ZERO? GL-PRSI /?L108
	CALL2 RT-VISIBLE?,GL-PRSI >STACK
	ZERO? STACK \?L108
	ICALL2 RT-CANT-SEE-ANY-MSG,GL-PRSI
	GRTR? ICNT,1 /?L57
	SET 'V,FATAL-VALUE
	JUMP ?L58
?L108:	ZERO? TOUCH-VERB? /?L121
	ZERO? GL-PRSO /?L116
	CALL2 RT-ACCESSIBLE?,GL-PRSO >STACK
	ZERO? STACK \?L116
	ICALL RT-CANT-TOUCH-MSG,GL-PRSO,GL-CLOSED-OBJECT,GL-IN-OUT
	GRTR? OCNT,1 /?L57
	SET 'V,FATAL-VALUE
	JUMP ?L58
?L116:	ZERO? GL-PRSI /?L121
	CALL2 RT-ACCESSIBLE?,GL-PRSI >STACK
	ZERO? STACK \?L121
	ICALL RT-CANT-TOUCH-MSG,GL-PRSI,GL-CLOSED-OBJECT,GL-IN-OUT
	GRTR? ICNT,1 /?L57
	SET 'V,FATAL-VALUE
	JUMP ?L58
?L121:	CALL RT-PERFORM,GL-PRSA,GL-PRSO,GL-PRSI >V
	EQUAL? V,FATAL-VALUE \?L57
?L58:	ZERO? GL-P-OVERFLOW /?L130
	CRLF
	PRINTI "[Note: There are so many objects here that a few may have been overlooked. Please double check to make sure you have accomplished what you intended.]"
	CRLF
?L130:	EQUAL? V,FATAL-VALUE \?L136
	SET 'GL-P-CONT,0
	JUMP ?L136
?L6:	SET 'GL-P-CONT,0
?L136:	ZERO? GL-P-GOOD /?L137
	EQUAL? V,FATAL-VALUE /?L137
	GET GL-GAME-VERBS,0 >STACK
	INTBL? GL-PRSA,GL-GAME-VERBS+2,STACK >TV /?L137
	ICALL1 RT-UPDATE-MOVES
	ICALL1 RT-UPDATE-CLOCK
	ICALL1 RT-ALARM-CHK
?L137:	ICALL1 RT-TIME-OF-DAY-MSG
	SET 'GL-PRSA,0
	SET 'GL-PRSO,0
	SET 'GL-PRSI,0
	JUMP ?L1

	.FUNCT RT-TOUCH-VERB?
	GET GL-TOUCH-VERBS,0 >STACK
	INTBL? GL-PRSA,GL-TOUCH-VERBS+2,STACK >STACK /?L1
?L1:	RSTACK

	.FUNCT RT-TALK-VERB?
	GET GL-TALK-VERBS,0 >STACK
	INTBL? GL-PRSA,GL-TALK-VERBS+2,STACK >STACK /?L1
?L1:	RSTACK

	.FUNCT RT-AC-CH-PLAYER,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	SET 'GL-WAIT-BELL,0
	EQUAL? CONTEXT,K-M-WINNER \?L1
	EQUAL? GL-PRSA,V?TELL \?L3
	SET 'GL-CLOCK-WAIT,0
	RFALSE
?L3:	EQUAL? GL-PRSO,TH-HANDS /?L6
	EQUAL? GL-PRSI,TH-HANDS \?L5
?L6:	CALL1 RT-CHECK-HANDS >STACK
	ZERO? STACK \FALSE
?L5:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	FSET? TH-HANDS,FL-LOCKED \FALSE
	CALL1 RT-HANDS-COVERING-EARS >STACK
	RSTACK
?L1:	CALL1 RT-AC-CH-PLAYER-AUX >STACK
	RSTACK

	.FUNCT RT-CAPITALIZE,PTR
	ZERO? GL-P-ORPH \?L3
	ZERO? GL-P-MERGED /?L1
?L3:	GET PTR,0 >STACK
	PRINTB STACK
	RTRUE
?L1:	GETB PTR,3 >STACK
	GETB GL-P-PIBUF,STACK >STACK
	SUB STACK,32 >STACK
	PRINTC STACK
	GETB PTR,3 >STACK
	INC 'STACK
	GETB PTR,2 >STACK
	DEC 'STACK
	CALL RT-WORD-PRINT,STACK,STACK >STACK
	RSTACK

	.FUNCT RT-WORD-PRINT,CNT,BUF
	ADD GL-P-PIBUF,BUF >STACK
	PRINTT STACK,CNT
	RTRUE

	.FUNCT RT-VERB-PRINT,TMP
	GET GL-P-ITBL,K-P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	RTRUE
?L1:	GETB GL-P-VTBL,2 >STACK
	ZERO? STACK \?L3
	GET TMP,0 >STACK
	PRINTB STACK
	RTRUE
?L3:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	ICALL RT-WORD-PRINT,STACK,STACK
	PUTB GL-P-VTBL,2,0
	RTRUE

	.FUNCT RT-PREP-PRINT,PREP,SP?,WRD
	ASSIGNED? 'SP? /?L13
	SET 'SP?,1
?L13:	ZERO? PREP /FALSE
	ZERO? GL-P-END-ON-PREP \FALSE
	ZERO? SP? /?L3
	PRINTI " "
?L3:	CALL2 RT-PREP-FIND,PREP >WRD
	PRINTB WRD
	GET GL-P-ITBL,K-P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?SIT,STACK \?L6
	EQUAL? W?DOWN,WRD \?L6
	PRINTI " on"
?L6:	GET GL-P-ITBL,K-P-VERBN >STACK
	GET STACK,0 >STACK
	EQUAL? W?GET,STACK \TRUE
	EQUAL? W?OUT,WRD \TRUE
	PRINTI " of"
	RTRUE

	.FUNCT RT-CLAUSE-PRINT,BPTR,EPTR,THE?
	ASSIGNED? 'THE? /?L1
	SET 'THE?,1
?L1:	GET GL-P-ITBL,EPTR >STACK
	GET GL-P-ITBL,BPTR >STACK
	CALL RT-BUFFER-PRINT,STACK,STACK,THE? >STACK
	RSTACK

	.FUNCT RT-BUFFER-PRINT,BEG,END,CP,NOSP,WRD,FIRST??,PN
	SET 'NOSP,0
	SET 'FIRST??,1
	SET 'PN,0
?L1:	EQUAL? BEG,END /TRUE
	ZERO? NOSP /?L6
	SET 'NOSP,0
	JUMP ?L8
?L6:	PRINTI " "
?L8:	GET BEG,0 >WRD
	EQUAL? WRD,W?HIM \?L12
	CALL2 RT-VISIBLE?,GL-P-HIM-OBJECT >STACK
	ZERO? STACK /?L11
?L12:	EQUAL? WRD,W?HER \?L13
	CALL2 RT-VISIBLE?,GL-P-HER-OBJECT >STACK
	ZERO? STACK /?L11
?L13:	EQUAL? WRD,W?THEM \?L9
	CALL2 RT-VISIBLE?,GL-P-THEM-OBJECT >STACK
	ZERO? STACK \?L9
?L11:	SET 'PN,1
?L9:	EQUAL? WRD,W?$PERIOD \?L15
	SET 'NOSP,1
	JUMP ?L20
?L15:	EQUAL? WRD,W?ALL,W?OF /?L17
	GETB WRD,6 >STACK
	BAND STACK,12 >STACK
	ZERO? STACK /?L17
	GETB WRD,6 >STACK
	BAND STACK,160 >STACK
	ZERO? STACK \?L17
	SET 'NOSP,1
	JUMP ?L20
?L17:	EQUAL? WRD,W?ME \?L18
	ICALL2 DPRINT,CH-PLAYER
	SET 'PN,1
	JUMP ?L20
?L18:	GET K-CAPS,0 >STACK
	INTBL? WRD,K-CAPS+2,STACK >STACK \?L19
	ICALL2 RT-CAPITALIZE,BEG
	SET 'PN,1
	JUMP ?L20
?L19:	ZERO? FIRST?? /?L21
	ZERO? PN \?L21
	ZERO? CP /?L21
	PRINTI "the "
?L21:	ZERO? GL-P-ORPH \?L26
	ZERO? GL-P-MERGED /?L24
?L26:	PRINTB WRD
	JUMP ?L31
?L24:	EQUAL? WRD,W?IT \?L27
	CALL2 RT-VISIBLE?,GL-P-IT-OBJECT >STACK
	ZERO? STACK /?L27
	ICALL2 DPRINT,GL-P-IT-OBJECT
	JUMP ?L31
?L27:	EQUAL? WRD,W?HER \?L28
	ZERO? PN \?L28
	ICALL2 DPRINT,GL-P-HER-OBJECT
	JUMP ?L31
?L28:	EQUAL? WRD,W?THEM \?L29
	ZERO? PN \?L29
	ICALL2 DPRINT,GL-P-THEM-OBJECT
	JUMP ?L31
?L29:	EQUAL? WRD,W?HIM \?L30
	ZERO? PN \?L30
	ICALL2 DPRINT,GL-P-HIM-OBJECT
	JUMP ?L31
?L30:	GETB BEG,3 >STACK
	GETB BEG,2 >STACK
	ICALL RT-WORD-PRINT,STACK,STACK
?L31:	SET 'FIRST??,0
?L20:	ADD BEG,K-P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT RT-DONT-KNOW-WORD-MSG,PTR,BUF,MSG,?TMP
	ZERO? GL-LONG-OOPS \?L1
	PRINTI "[You don't need to use the word """
	JUMP ?L3
?L1:	DEC 'GL-LONG-OOPS
	PRINTI "[You can play the game from start to finish, solve all the puzzles, get all the points, and STILL never need to use the word """
?L3:	MUL PTR,2 >BUF
	ADD GL-P-P-LEX,BUF >STACK
	GETB STACK,2 >?TMP
	ADD GL-P-P-LEX,BUF >STACK
	GETB STACK,3 >STACK
	ICALL RT-WORD-PRINT,?TMP,STACK
	PRINTI """.]"
	CRLF
	PUT GL-OOPS-TABLE,K-O-PTR,PTR
	SET 'GL-P-QUOT,0
	SET 'GL-P-ORPH,0
	RTRUE

	.FUNCT RT-DONT-KNOW-WORD-USE-MSG,PTR,BUF,?TMP
	PRINTI "[This story cannot understand the word """
	MUL PTR,2 >BUF
	ADD GL-P-P-LEX,BUF >STACK
	GETB STACK,2 >?TMP
	ADD GL-P-P-LEX,BUF >STACK
	GETB STACK,3 >STACK
	ICALL RT-WORD-PRINT,?TMP,STACK
	PRINTI """ when you use it that way.]"
	CRLF
	SET 'GL-P-QUOT,0
	SET 'GL-P-ORPH,0
	RTRUE

	.FUNCT RT-CANT-SEE-ANY-MSG,THING,STRING?,PRSO?,WRD
	ASSIGNED? 'THING /?L18
	SET 'THING,0
?L18:	ASSIGNED? 'STRING? /?L19
	SET 'STRING?,0
?L19:	ASSIGNED? 'PRSO? /?L20
	SET 'PRSO?,1
?L20:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	EQUAL? GL-PRSA,V?LISTEN \?L1
	PRINTI "hear"
	JUMP ?L4
?L1:	EQUAL? GL-PRSA,V?SMELL \?L3
	PRINTI "smell"
	JUMP ?L4
?L3:	PRINTI "see"
?L4:	ZERO? STRING? /?L5
	PRINT STRING?
	JUMP ?L8
?L5:	ZERO? THING /?L9
	EQUAL? THING,TH-NOT-HERE-OBJECT /?L7
	PRINTI " "
	ICALL RT-THEO-PRINT,THING,0,K-DESC-ANY
	JUMP ?L8
?L7:	ZERO? THING /?L9
	EQUAL? GL-PRSI,TH-NOT-HERE-OBJECT \?L9
	SET 'PRSO?,0
?L9:	ZERO? PRSO? /?L12
	PUSH 0
	JUMP ?L14
?L12:	PUSH 1
?L14:	GET GL-P-NAMW,STACK >WRD
	GET K-CAPS,0 >STACK
	INTBL? WRD,K-CAPS+2,STACK >STACK /?L15
	PRINTI " any"
?L15:	ICALL2 RT-NOT-HERE-PRINT,PRSO?
?L8:	PRINTI " here."
	CRLF
	SET 'GL-P-IT-OBJECT,TH-NOT-HERE-OBJECT
	ICALL1 RT-P-CLEAR
	RTRUE

	.FUNCT RT-TH-NOT-HERE-OBJECT,TBL,PRSO?,OBJ
	SET 'PRSO?,1
	EQUAL? GL-PRSO,TH-NOT-HERE-OBJECT \?L3
	EQUAL? GL-PRSI,TH-NOT-HERE-OBJECT \?L1
	PRINTR "Those things aren't here."
?L1:	EQUAL? GL-PRSO,TH-NOT-HERE-OBJECT \?L3
	SET 'TBL,GL-P-PRSO
	JUMP ?L4
?L3:	SET 'TBL,GL-P-PRSI
	SET 'PRSO?,0
?L4:	ZERO? PRSO? /?L5
	EQUAL? GL-PRSA,V?FIND,V?WHO,V?WHAT /?L10
	EQUAL? GL-PRSA,V?WHERE,V?WAIT-FOR,V?WAIT /?L10
	EQUAL? GL-PRSA,V?SAY,V?DRIVE,V?CALL /?L10
	EQUAL? GL-PRSA,V?MAKE,V?PASSWORD,V?WALK-TO /?L10
	EQUAL? GL-PRSA,V?TAKE \?L27
	EQUAL? GL-PLACE-CUR,RM-DIOGENES-CLUB \?L11
	EQUAL? GL-WINNER,CH-BUTLER /?L10
?L11:	EQUAL? GL-PLACE-CUR,RM-SHERMANS-HOUSE \?L27
	EQUAL? GL-WINNER,CH-SHERMAN \?L27
?L10:	CALL RT-FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,TH-NOT-HERE-OBJECT /?L27
	RETURN 2
?L5:	EQUAL? GL-PRSA,V?TELL-ABOUT,V?ASK-ABOUT,V?ASK-FOR \?L27
	CALL RT-FIND-NOT-HERE,TBL,PRSO? >OBJ
	ZERO? OBJ /FALSE
	EQUAL? OBJ,TH-NOT-HERE-OBJECT /?L27
	RETURN 2
?L27:	PRINTI "["
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	EQUAL? GL-PRSA,V?LISTEN \?L29
	PRINTI "hear"
	JUMP ?L32
?L29:	EQUAL? GL-PRSA,V?SMELL \?L31
	PRINTI "smell"
	JUMP ?L32
?L31:	PRINTI "see"
?L32:	GET K-CAPS,0 >STACK
	INTBL? GL-P-XNAM,K-CAPS+2,STACK >STACK /?L33
	PRINTI " any"
?L33:	ICALL2 RT-NOT-HERE-PRINT,PRSO?
	PRINTI " here.]"
	CRLF
	ICALL1 RT-P-CLEAR
	RETURN 2

	.FUNCT RT-FAKE-ORPHAN-MSG,TMP
	ICALL RT-ORPHAN,GL-P-SYNTAX,0
	PRINT K-BE-SPECIFIC-MSG
	GET GL-P-OTBL,K-P-VERBN >TMP
	ZERO? TMP \?L1
	PRINTI "tell"
	JUMP ?L4
?L1:	GETB GL-P-VTBL,2 >STACK
	ZERO? STACK \?L3
	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L4
?L3:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	ICALL RT-WORD-PRINT,STACK,STACK
	PUTB GL-P-VTBL,2,0
?L4:	PRINTI "?]"
	CRLF
	SET 'GL-P-ORPH,1
	SET 'GL-P-GOOD,0
	RTRUE

	.FUNCT RT-TIME-OF-DAY-MSG,WAIT?,TOD
	ASSIGNED? 'WAIT? /?L15
	SET 'WAIT?,0
?L15:	CALL1 RT-TIME-OF-DAY >TOD
	FSET? GL-PLACE-CUR,FL-INDOORS /FALSE
	EQUAL? GL-LAST-OUT-TOD,TOD /FALSE
	ZERO? WAIT? /?L5
	ICALL2 RT-WAIT-TOD-MSG,TOD
	JUMP ?L12
?L5:	CRLF
	ICALL RT-CYOU-MSG,STR?105,STR?104
	PRINTI "that "
	EQUAL? TOD,1 \?L8
	PRINTI "the sky is lighter. Soon it will be sunrise."
	CRLF
	JUMP ?L12
?L8:	EQUAL? TOD,2 \?L10
	PRINTI "the sun has risen... as much as it ever does in England."
	CRLF
	JUMP ?L12
?L10:	EQUAL? TOD,3 \?L11
	PRINTI "the setting sun marks the end of another day. Soon it will be dark."
	CRLF
	JUMP ?L12
?L11:	PRINTI "the sun has set and the mists have rolled in."
	CRLF
?L12:	SET 'GL-LAST-OUT-TOD,TOD
	RETURN GL-LAST-OUT-TOD

	.FUNCT RT-TIME-OF-DAY,TOD
	SET 'TOD,0
	CALL RT-CLOCK-CMP,6,30,0 >STACK
	EQUAL? STACK,1 \?L1
	SET 'TOD,0
	RETURN TOD
?L1:	CALL RT-CLOCK-CMP,7,0,0 >STACK
	EQUAL? STACK,1 \?L3
	SET 'TOD,1
	RETURN TOD
?L3:	CALL RT-CLOCK-CMP,19,30,0 >STACK
	EQUAL? STACK,1 \?L4
	SET 'TOD,2
	RETURN TOD
?L4:	CALL RT-CLOCK-CMP,20,0,0 >STACK
	EQUAL? STACK,1 \?L5
	SET 'TOD,3
	RETURN TOD
?L5:	SET 'TOD,0
	RETURN TOD

	.FUNCT RT-SPOKEN-TO-MSG,WHO
	EQUAL? WHO,GL-P-QCONTEXT-TH \?L3
	EQUAL? GL-PLACE-CUR,GL-P-QCONTEXT-RM /TRUE
?L3:	SET 'GL-P-QCONTEXT-TH,WHO
	LOC WHO >GL-P-QCONTEXT-RM
	ICALL2 RT-THIS-IS-IT,WHO
	PRINTI "[spoken to "
	ICALL2 RT-THEO-PRINT,WHO
	PRINTR "]"

	.FUNCT RT-GET-PREP,SYN,WHICH,PREP
	EQUAL? WHICH,1 \?L1
	GETB SYN,K-P-SPREP1 >PREP
	JUMP ?L3
?L1:	GETB SYN,K-P-SPREP2 >PREP
?L3:	BAND PREP,63 >PREP
	ZERO? PREP /FALSE
	ADD PREP,192 >STACK
	RSTACK

	.FUNCT RT-SYNTAX-CHECK,SYN,LEN,NUM,OBJ,DRIVE1,DRIVE2,PREP,VERB,TPREP,?TMP,?TMP?1
	SET 'DRIVE1,0
	SET 'DRIVE2,0
	GET GL-P-ITBL,K-P-VERB >VERB
	ZERO? VERB \?L1
	ICALL2 RT-NOT-IN-SENTENCE-MSG,STR?106
	RFALSE
?L1:	SUB 255,VERB >STACK
	GET VERBS,STACK >SYN
	GETB SYN,0 >LEN
	INC 'SYN
?L4:	GETB SYN,0 >STACK
	SHIFT STACK,-6 >NUM
	GRTR? GL-P-NCN,NUM /?L14
	LESS? NUM,1 /?L8
	ZERO? GL-P-NCN \?L8
	GET GL-P-ITBL,K-P-PREP1 >PREP
	ZERO? PREP /?L9
	CALL RT-GET-PREP,SYN,1 >STACK
	EQUAL? PREP,STACK \?L8
?L9:	SET 'DRIVE1,SYN
	JUMP ?L14
?L8:	CALL RT-GET-PREP,SYN,1 >?TMP
	GET GL-P-ITBL,K-P-PREP1 >STACK
	EQUAL? ?TMP,STACK \?L14
	EQUAL? NUM,2 \?L11
	EQUAL? GL-P-NCN,1 \?L11
	SET 'DRIVE2,SYN
	JUMP ?L14
?L11:	GRTR? NUM,1 /?L56
	GET GL-P-ITBL,K-P-PREP2 >STACK
	ZERO? STACK \?L14
	GRTR? NUM,1 \?L15
?L56:	CALL RT-GET-PREP,SYN,2 >?TMP
	GET GL-P-ITBL,K-P-PREP2 >STACK
	EQUAL? ?TMP,STACK \?L14
?L15:	ICALL2 RT-SYNTAX-FOUND,SYN
	RTRUE
?L14:	DLESS? 'LEN,1 \?L18
	ZERO? DRIVE1 \?L57
	ZERO? DRIVE2 \?L5
	EQUAL? GL-P-NCN,2 \?L23
	ZERO? GL-FUNNY-CLAUSE? /?L23
	SET 'GL-P-NCN,1
	SET 'GL-FUNNY-CLAUSE?,0
	GET GL-P-ITBL,K-P-NC2L >STACK
	PUT GL-P-ITBL,K-P-NC1L,STACK
	CALL1 RT-SYNTAX-CHECK >STACK
	RSTACK
?L23:	PRINT K-DONT-UNDERSTAND-MSG
	CRLF
	RFALSE
?L18:	ZERO? NUM \?L26
	ADD SYN,K-P-SLEN-0 >SYN
	JUMP ?L4
?L26:	EQUAL? NUM,1 \?L28
	ADD SYN,K-P-SLEN-1 >SYN
	JUMP ?L4
?L28:	ADD SYN,K-P-SLEN-2 >SYN
	JUMP ?L4
?L5:	ZERO? DRIVE1 /?L30
?L57:	GETB DRIVE1,K-P-SFWIM1 >?TMP
	GETB DRIVE1,K-P-SLOC1 >?TMP?1
	CALL RT-GET-PREP,DRIVE1,1 >STACK
	CALL RT-GET-WHAT-I-MEAN,?TMP,?TMP?1,STACK >OBJ
	ZERO? OBJ /?L30
	PUT GL-P-PRSO,K-P-MATCHLEN,1
	PUT GL-P-PRSO,1,OBJ
	ICALL2 RT-SYNTAX-FOUND,DRIVE1
	RTRUE
?L30:	ZERO? DRIVE2 /?L32
	GETB DRIVE2,K-P-SFWIM2 >?TMP
	GETB DRIVE2,K-P-SLOC2 >?TMP?1
	CALL RT-GET-PREP,DRIVE2,2 >STACK
	CALL RT-GET-WHAT-I-MEAN,?TMP,?TMP?1,STACK >OBJ
	ZERO? OBJ /?L32
	PUT GL-P-PRSI,K-P-MATCHLEN,1
	PUT GL-P-PRSI,1,OBJ
	ICALL2 RT-SYNTAX-FOUND,DRIVE2
	RTRUE
?L32:	EQUAL? VERB,ACT?FIND \?L33
	PRINT K-DO-IT-YOURSELF-MSG
	CRLF
	RFALSE
?L33:	EQUAL? GL-WINNER,CH-PLAYER \?L35
	ICALL RT-ORPHAN,DRIVE1,DRIVE2
	PRINTI "[Wh"
	JUMP ?L37
?L35:	PRINTI "[Your command was not complete. Type wh"
?L37:	EQUAL? VERB,ACT?WALK,ACT?GO \?L38
	PRINTI "ere"
	JUMP ?L43
?L38:	ZERO? DRIVE1 /?L42
	GETB DRIVE1,K-P-SFWIM1 >STACK
	EQUAL? STACK,FL-PERSON /?L41
?L42:	ZERO? DRIVE2 /?L40
	GETB DRIVE2,K-P-SFWIM2 >STACK
	EQUAL? STACK,FL-PERSON \?L40
?L41:	PRINTI "om"
	JUMP ?L43
?L40:	PRINTI "at"
?L43:	EQUAL? GL-WINNER,CH-PLAYER \?L44
	PRINTI " do you want to "
	JUMP ?L46
?L44:	PRINTI " you want "
	ICALL2 RT-THEO-PRINT,GL-WINNER
	PRINTI " to "
?L46:	ICALL1 RT-VERB-PRINT
	ZERO? DRIVE2 /?L47
	ICALL RT-CLAUSE-PRINT,K-P-NC1,K-P-NC1L
?L47:	SET 'GL-P-END-ON-PREP,0
	ZERO? DRIVE1 /?L50
	CALL RT-GET-PREP,DRIVE1,1 >STACK
	JUMP ?L52
?L50:	CALL RT-GET-PREP,DRIVE2,2 >STACK
?L52:	ICALL2 RT-PREP-PRINT,STACK
	EQUAL? GL-WINNER,CH-PLAYER \?L53
	SET 'GL-P-ORPH,1
	PRINTI "?]"
	CRLF
	RFALSE
?L53:	SET 'GL-P-ORPH,0
	PRINTI ".]"
	CRLF
	RFALSE

	.FUNCT RT-CLAUSE,PTR,VAL,WRD,OFF,NUM,ANDFLG,FIRST??,NW,LW,TPTR,TMP
	SET 'ANDFLG,0
	SET 'FIRST??,1
	SET 'LW,0
	SUB GL-P-NCN,1 >STACK
	MUL STACK,2 >OFF
	ZERO? VAL /?L1
	ADD K-P-PREP1,OFF >NUM
	PUT GL-P-ITBL,NUM,VAL
	ADD NUM,1 >STACK
	PUT GL-P-ITBL,STACK,WRD
	ADD PTR,K-P-LEXELEN >PTR
	JUMP ?L3
?L1:	INC 'GL-P-LEN
?L3:	ZERO? GL-P-LEN \?L4
	DEC 'GL-P-NCN
	RETURN -1
?L4:	ADD K-P-NC1,OFF >NUM
	MUL PTR,2 >STACK
	ADD GL-P-P-LEX,STACK >STACK
	PUT GL-P-ITBL,NUM,STACK
	GET GL-P-P-LEX,PTR >STACK
	EQUAL? STACK,W?THE,W?A,W?AN \?L7
	GET GL-P-ITBL,NUM >STACK
	ADD STACK,4 >STACK
	PUT GL-P-ITBL,NUM,STACK
?L7:	DLESS? 'GL-P-LEN,0 \?L12
	MUL PTR,2 >STACK
	ADD GL-P-P-LEX,STACK >STACK
	ADD NUM,1 >STACK
	PUT GL-P-ITBL,STACK,STACK
	RETURN -1
?L12:	GET GL-P-P-LEX,PTR >WRD
	ZERO? WRD \?L17
	CALL2 RT-NUMBER?,PTR >WRD
	ZERO? WRD /?L15
?L17:	ZERO? GL-P-LEN \?L18
	SET 'NW,0
	JUMP ?L23
?L18:	ADD PTR,K-P-LEXELEN >TPTR
	GET GL-P-P-LEX,TPTR >NW
	ZERO? NW \?L23
	EQUAL? WRD,W?INTNUM /?L23
	CALL2 RT-NUMBER?,TPTR >NW
	PUT GL-P-P-LEX,TPTR,NW
?L23:	EQUAL? WRD,W?$PERIOD \?L27
	EQUAL? LW,W?MR,W?MRS,W?MISS /?L29
	EQUAL? LW,W?DR \?L27
?L29:	SET 'LW,0
	JUMP ?L65
?L27:	EQUAL? WRD,W?AND,W?$COMMA \?L30
	SET 'ANDFLG,1
	JUMP ?L65
?L30:	EQUAL? WRD,W?ALL,W?BOTH,W?EVERYTHING \?L31
	EQUAL? NW,W?OF \?L65
	DEC 'GL-P-LEN
	ADD PTR,K-P-LEXELEN >PTR
	JUMP ?L65
?L31:	EQUAL? WRD,W?THEN,W?$PERIOD /?L36
	GETB WRD,6 >STACK
	BTST STACK,8 \?L35
	GET GL-P-ITBL,K-P-VERB >STACK
	ZERO? STACK /?L35
	ZERO? FIRST?? \?L35
?L36:	INC 'GL-P-LEN
	MUL PTR,2 >STACK
	ADD GL-P-P-LEX,STACK >STACK
	ADD NUM,1 >STACK
	PUT GL-P-ITBL,STACK,STACK
	SUB PTR,K-P-LEXELEN >STACK
	RSTACK
?L35:	ZERO? ANDFLG /?L37
	GET GL-P-ITBL,K-P-VERBN >STACK
	ZERO? STACK /?L38
	CALL2 RT-VERB-DIR-ONLY?,WRD >STACK
	ZERO? STACK /?L37
?L38:	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	ICALL RT-CHANGE-LEXV,STACK,W?THEN
	ADD GL-P-LEN,2 >GL-P-LEN
	JUMP ?L65
?L37:	GETB WRD,6 >STACK
	BTST STACK,128 \?L39
	GRTR? GL-P-LEN,0 \?L40
	EQUAL? NW,W?OF \?L40
	EQUAL? WRD,W?ALL,W?EVERYTHING /?L40
	SUB GL-P-NCN,1 >STACK
	PUT GL-P-OFW,STACK,WRD
	JUMP ?L65
?L40:	GETB WRD,6 >STACK
	BTST STACK,32 \?L42
	ZERO? NW /?L42
	GETB NW,6 >STACK
	BTST STACK,128 \?L42
	EQUAL? WRD,W?INTNUM \?L43
	EQUAL? NW,W?HOUR,W?HOURS,W?MINUTE /?L65
	EQUAL? NW,W?MINUTES /?L65
?L43:	EQUAL? NW,W?TOMB /?L65
	EQUAL? WRD,W?BOX \?L48
	EQUAL? NW,W?INTNUM /?L53
	SET 'TMP,1
	JUMP ?L53
?L48:	EQUAL? WRD,W?TOMB \?L53
	SET 'TMP,1
?L53:	ZERO? TMP /?L65
	SET 'GL-FUNNY-CLAUSE?,1
	INC 'NUM
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD GL-P-P-LEX,STACK >STACK
	PUT GL-P-ITBL,NUM,STACK
	RETURN PTR
?L42:	ZERO? ANDFLG \?L58
	EQUAL? NW,W?BUT,W?EXCEPT,W?AND /?L58
	EQUAL? NW,W?$COMMA /?L58
	ADD PTR,2 >STACK
	MUL STACK,2 >STACK
	ADD GL-P-P-LEX,STACK >STACK
	ADD NUM,1 >STACK
	PUT GL-P-ITBL,STACK,STACK
	RETURN PTR
?L58:	SET 'ANDFLG,0
	JUMP ?L65
?L39:	ZERO? GL-P-MERGED \?L61
	ZERO? GL-P-ORPH \?L61
	GET GL-P-ITBL,K-P-VERB >STACK
	ZERO? STACK /?L60
?L61:	GETB WRD,6 >STACK
	BAND STACK,36 >STACK
	ZERO? STACK \?L65
?L60:	ZERO? ANDFLG /?L62
	GET GL-P-ITBL,K-P-VERB >STACK
	ZERO? STACK \?L62
	SUB PTR,4 >PTR
	ADD PTR,2 >STACK
	ICALL RT-CHANGE-LEXV,STACK,W?THEN
	ADD GL-P-LEN,2 >GL-P-LEN
	JUMP ?L65
?L62:	GETB WRD,6 >STACK
	BTST STACK,8 /?L65
	ICALL2 RT-DONT-KNOW-WORD-USE-MSG,PTR
	RFALSE
?L15:	ICALL2 RT-DONT-KNOW-WORD-MSG,PTR
	RFALSE
?L65:	SET 'LW,WRD
	SET 'FIRST??,0
	ADD PTR,K-P-LEXELEN >PTR
	JUMP ?L7

	.FUNCT RT-GET-WHAT-I-MEAN,GBIT,LBIT,PREP,NO-ROOMS?,SILENT?,OBJ
	ASSIGNED? 'NO-ROOMS? /?L20
	SET 'NO-ROOMS?,0
?L20:	ASSIGNED? 'SILENT? /?L21
	SET 'SILENT?,0
?L21:	EQUAL? GBIT,FL-LOCATION \?L1
	RETURN ROOMS
?L1:	ZERO? GL-P-IT-OBJECT /?L3
	FSET? GL-P-IT-OBJECT,GBIT \?L3
	ZERO? SILENT? \?L4
	PRINTI "["
	ICALL2 RT-THEO-PRINT,GL-P-IT-OBJECT
	PRINTI "]"
	CRLF
?L4:	RETURN GL-P-IT-OBJECT
?L3:	SET 'INHIBIT-ROOMS,NO-ROOMS?
	SET 'GL-P-GWIMBIT,GBIT
	SET 'GL-P-SLOCBITS,LBIT
	PUT GL-P-MERGE,K-P-MATCHLEN,0
	CALL RT-GET-OBJECT,GL-P-MERGE,0 >STACK
	ZERO? STACK /?L8
	SET 'GL-P-GWIMBIT,0
	GET GL-P-MERGE,K-P-MATCHLEN >STACK
	EQUAL? STACK,1 \FALSE
	GET GL-P-MERGE,1 >OBJ
	EQUAL? GL-WINNER,CH-PLAYER \?L12
	EQUAL? OBJ,TH-HANDS /?L12
	ZERO? SILENT? \?L12
	PRINTI "["
	CALL RT-PREP-PRINT,PREP,0 >STACK
	ZERO? STACK /?L14
	PRINTC 32
?L14:	ICALL2 RT-THEO-PRINT,OBJ
	PRINTI "]"
	CRLF
?L12:	SET 'INHIBIT-ROOMS,0
	RETURN OBJ
?L8:	SET 'GL-P-GWIMBIT,0
	SET 'INHIBIT-ROOMS,0
	RFALSE

	.FUNCT RT-P-CLEAR
	SET 'GL-P-CONT,0
	SET 'GL-P-QUOT,0
	RTRUE

	.FUNCT RT-PICK-NEXT,TBL,CNT,STR,NT
	GETB TBL,0 >CNT
	ADD TBL,1 >STACK
	GET STACK,0 >NT
	GET NT,CNT >STR
	INC 'CNT
	GET NT,0 >STACK
	GRTR? CNT,STACK \?L1
	SET 'CNT,1
?L1:	PUTB TBL,0,CNT
	RETURN STR

	.FUNCT RT-QCONTEXT-GOOD?
	ZERO? GL-WHERE-TO-ORPH? \FALSE
	ZERO? GL-P-QCONTEXT-TH /FALSE
	FSET? GL-P-QCONTEXT-TH,FL-PERSON \FALSE
	EQUAL? GL-PLACE-CUR,GL-P-QCONTEXT-RM \FALSE
	CALL2 RT-VISIBLE?,GL-P-QCONTEXT-TH >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT RT-FIND-PERSON,THING,OBJ,OBJ1,WHO-P,WHO-A
	SET 'WHO-P,0
	SET 'WHO-A,0
	FIRST? THING >OBJ \?L25
?L4:	FSET? OBJ,FL-PERSON \?L6
	FSET? OBJ,FL-PLURAL /?L14
	EQUAL? OBJ,CH-PLAYER,GL-WINNER /?L14
	FSET? OBJ,FL-ASLEEP /?L14
	EQUAL? OBJ,GL-PUPPY \?L3
	SET 'WHO-P,OBJ
	JUMP ?L14
?L6:	FSET? OBJ,FL-SURFACE /?L15
	FSET? OBJ,FL-CONTAINER \?L14
	FSET? OBJ,FL-OPENED \?L14
?L15:	SET 'OBJ1,OBJ
	CALL2 RT-FIND-PERSON,OBJ >OBJ
	ZERO? OBJ /?L21
	FSET? OBJ,FL-ASLEEP /?L21
	EQUAL? OBJ,GL-PUPPY \?L3
	SET 'WHO-P,OBJ
?L21:	SET 'OBJ,OBJ1
?L14:	NEXT? OBJ >OBJ /?L4
?L3:	ZERO? OBJ /?L25
	RETURN OBJ
?L25:	ZERO? WHO-P /FALSE
	RETURN WHO-P

	.FUNCT RT-ANYONE-HERE?
	CALL1 RT-QCONTEXT-GOOD? >STACK
	ZERO? STACK /?L1
	RETURN GL-P-QCONTEXT-TH
?L1:	CALL2 RT-FIND-PERSON,GL-PLACE-CUR >STACK
	RSTACK

	.FUNCT RT-MOVE-ALL,FROM,TO,OBJ,NXT
	FIRST? FROM >OBJ /?L4
	RTRUE
?L1:	ZERO? OBJ /TRUE
?L4:	NEXT? OBJ >NXT /?L7
?L7:	MOVE OBJ,TO
	SET 'OBJ,NXT
	JUMP ?L1

	.FUNCT RT-GOT?,OBJ
	ZERO? OBJ /FALSE
	EQUAL? GL-WINNER,CH-PLAYER \?L3
	IN? OBJ,TH-POCKET /TRUE
?L3:	CALL2 RT-HELD?,OBJ >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT RT-HELD?,OBJ,L
	ZERO? OBJ /FALSE
	FSET? OBJ,FL-TAKEABLE /?L3
	FSET? OBJ,FL-TRYTAKE \FALSE
?L3:	LOC OBJ >L
	EQUAL? L,0,ROOMS,GLOBAL-OBJECTS /FALSE
	EQUAL? L,GL-WINNER /TRUE
	EQUAL? GL-WINNER,CH-PLAYER \?L8
	EQUAL? L,TH-POCKET /FALSE
?L8:	CALL2 RT-HELD?,L >STACK
	RSTACK

	.FUNCT RT-THIS-IS-IT,OBJ
	EQUAL? OBJ,0,CH-PLAYER,TH-NOT-HERE-OBJECT /TRUE
	EQUAL? OBJ,TH-INTDIR,TH-INTNUM,TH-LEFT /TRUE
	EQUAL? OBJ,TH-RIGHT /TRUE
	EQUAL? GL-PRSA,V?WALK,V?WALK-TO \?L4
	EQUAL? OBJ,GL-PRSO /TRUE
?L4:	FSET? OBJ,FL-PERSON \?L6
	FSET? OBJ,FL-FEMALE \?L5
	SET 'GL-P-HER-OBJECT,OBJ
	RTRUE
?L5:	FSET? OBJ,FL-PERSON \?L6
	FSET? OBJ,FL-FEMALE /?L6
	SET 'GL-P-HIM-OBJECT,OBJ
	RTRUE
?L6:	FSET? OBJ,FL-COLLECTIVE \?L7
	SET 'GL-P-THEM-OBJECT,OBJ
	SET 'GL-P-IT-OBJECT,OBJ
	RTRUE
?L7:	FSET? OBJ,FL-PLURAL \?L8
	SET 'GL-P-THEM-OBJECT,OBJ
	RTRUE
?L8:	FSET? OBJ,FL-NEEDS-IDENTITY \?L10
	GETP OBJ,P?OBJ-NOUN >STACK
	PUTP TH-IT,P?OBJ-NOUN,STACK
	GETP OBJ,P?OBJ-ADJ >STACK
	PUTP TH-IT,P?OBJ-ADJ,STACK
	JUMP ?L12
?L10:	PUTP TH-IT,P?OBJ-NOUN,0
	PUTP TH-IT,P?OBJ-ADJ,0
?L12:	SET 'GL-P-IT-OBJECT,OBJ
	RTRUE

	.FUNCT RT-CHANGE-LEXV,PTR,WRD,PTRS?,X,Y,Z
	ASSIGNED? 'PTRS? /?L4
	SET 'PTRS?,0
?L4:	ZERO? PTRS? /?L1
	SUB PTR,K-P-LEXELEN >STACK
	MUL 2,STACK >STACK
	ADD 2,STACK >X
	GETB GL-P-P-LEX,X >Y
	MUL 2,PTR >STACK
	ADD 2,STACK >Z
	PUTB GL-P-P-LEX,Z,Y
	PUTB GL-P-S-LEX,Z,Y
	ADD 1,X >STACK
	GETB GL-P-P-LEX,STACK >Y
	MUL 2,PTR >STACK
	ADD 3,STACK >Z
	PUTB GL-P-P-LEX,Z,Y
	PUTB GL-P-S-LEX,Z,Y
?L1:	PUT GL-P-P-LEX,PTR,WRD
	PUT GL-P-S-LEX,PTR,WRD
	RTRUE

	.FUNCT RT-WT?,PTR,BIT,B1,OFFS,TYP,TBL
	ASSIGNED? 'B1 /?L11
	SET 'B1,5
?L11:	SET 'OFFS,K-P-P1OFF
	GETB PTR,K-P-PSOFF >TYP
	BTST TYP,BIT \FALSE
	GRTR? B1,4 /TRUE
	EQUAL? BIT,PS?PREPOSITION \?L5
	GET PREPOSITIONS,0 >STACK
	ADD PREPOSITIONS,2 >STACK
	INTBL? PTR,STACK,STACK,131 >TBL \FALSE
	GETB TBL,2 >STACK
	RSTACK
?L5:	BAND TYP,K-P-P1BITS >TYP
	GETB PTR,OFFS >STACK
	RSTACK

	.FUNCT RT-VERB-DIR-ONLY?,WRD
	GETB WRD,6 >STACK
	BAND STACK,160 >STACK
	ZERO? STACK \FALSE
	GETB WRD,6 >STACK
	BAND STACK,80 >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT RT-STUFF,DEST,SRC,MAX
	ASSIGNED? 'MAX /?L1
	SET 'MAX,29
?L1:	MUL MAX,K-P-WORDLEN >STACK
	ADD K-P-LEXSTART,STACK >STACK
	COPYT SRC,DEST,STACK
	RTRUE

	.FUNCT RT-INBUF-ADD,LEN,BEG,SLOT,DBEG,CTR,TMP,?TMP
	SET 'CTR,0
	GET GL-OOPS-TABLE,K-O-END >TMP
	ZERO? TMP /?L1
	SET 'DBEG,TMP
	JUMP ?L3
?L1:	GET GL-OOPS-TABLE,K-O-LENGTH >TMP
	GETB GL-P-S-LEX,TMP >?TMP
	ADD TMP,1 >STACK
	GETB GL-P-S-LEX,STACK >STACK
	ADD ?TMP,STACK >DBEG
?L3:	ADD DBEG,LEN >STACK
	PUT GL-OOPS-TABLE,K-O-END,STACK
	ADD GL-OOPS-INBUF,DBEG >STACK
	ADD GL-P-PIBUF,BEG >STACK
	COPYT STACK,STACK,LEN
	PUTB GL-P-S-LEX,SLOT,DBEG
	SUB SLOT,1 >STACK
	PUTB GL-P-S-LEX,STACK,LEN
	RTRUE

	.FUNCT RT-ACLAUSE-WIN,ADJ,X
	GET GL-P-OTBL,K-P-VERB >STACK
	PUT GL-P-ITBL,K-P-VERB,STACK
	ADD GL-P-ACLAUSE,1 >X
	IXCALL RT-CLAUSE-COPY,GL-P-OTBL,GL-P-OTBL,GL-P-ACLAUSE,X,GL-P-ACLAUSE,X,ADJ
	GET GL-P-OTBL,K-P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'GL-P-NCN,2
?L1:	SET 'GL-P-ACLAUSE,0
	RTRUE

	.FUNCT RT-NCLAUSE-WIN
	ADD GL-P-ACLAUSE,1 >STACK
	IXCALL RT-CLAUSE-COPY,GL-P-ITBL,GL-P-OTBL,K-P-NC1,K-P-NC1L,GL-P-ACLAUSE,STACK
	GET GL-P-OTBL,K-P-NC2 >STACK
	ZERO? STACK /?L1
	SET 'GL-P-NCN,2
?L1:	SET 'GL-P-ACLAUSE,0
	RTRUE

	.FUNCT RT-ORPHAN-VERB,VERB,PREVERB
	PUT GL-P-VTBL,0,VERB
	PUT GL-P-OTBL,K-P-VERB,PREVERB
	PUT GL-P-OTBL,K-P-VERBN,GL-P-VTBL
	PUT GL-P-OTBL,K-P-PREP1,0
	PUT GL-P-OTBL,K-P-PREP1N,0
	PUT GL-P-OTBL,K-P-PREP2,0
	PUT GL-P-OTBL,5,0
	PUT GL-P-OTBL,K-P-NC1,1
	PUT GL-P-OTBL,K-P-NC1L,0
	PUT GL-P-OTBL,K-P-NC2,0
	PUT GL-P-OTBL,K-P-NC2L,0
	SET 'GL-P-ORPH,1
	RETURN GL-P-ORPH

	.FUNCT RT-ORPHAN,D1,D2,CNT
	SET 'CNT,-1
	ZERO? GL-P-MERGED \?L1
	PUT GL-P-OCLAUSE,K-P-MATCHLEN,0
?L1:	GET GL-P-VTBL,0 >STACK
	PUT GL-P-OVTBL,0,STACK
	GETB GL-P-VTBL,2 >STACK
	PUTB GL-P-OVTBL,2,STACK
	GETB GL-P-VTBL,3 >STACK
	PUTB GL-P-OVTBL,3,STACK
	COPYT GL-P-ITBL,GL-P-OTBL,20
	EQUAL? GL-P-NCN,2 \?L4
	IXCALL RT-CLAUSE-COPY,GL-P-ITBL,GL-P-OTBL,K-P-NC2,K-P-NC2L,K-P-NC2,K-P-NC2L
?L4:	LESS? GL-P-NCN,1 /?L7
	IXCALL RT-CLAUSE-COPY,GL-P-ITBL,GL-P-OTBL,K-P-NC1,K-P-NC1L,K-P-NC1,K-P-NC1L
?L7:	ZERO? D1 /?L10
	CALL RT-GET-PREP,D1,1 >STACK
	PUT GL-P-OTBL,K-P-PREP1,STACK
	PUT GL-P-OTBL,K-P-NC1,1
	RTRUE
?L10:	ZERO? D2 /FALSE
	CALL RT-GET-PREP,D2,2 >STACK
	PUT GL-P-OTBL,K-P-PREP2,STACK
	PUT GL-P-OTBL,K-P-NC2,1
	RTRUE

	.FUNCT RT-ORPHAN-MERGE,CNT,TEMP,VERB,BEG,END,ADJ,WRD
	SET 'CNT,-1
	SET 'ADJ,0
	SET 'GL-P-ORPH,0
	GET GL-P-ITBL,K-P-VERBN >WRD
	ZERO? WRD /?L7
	GET WRD,0 >WRD
	ZERO? WRD /?L7
	GET GL-P-OTBL,K-P-VERB >STACK
	GET GL-P-ITBL,K-P-VERBN >STACK
	GET STACK,0 >WRD
	CALL RT-WT?,WRD,64,1 >STACK
	EQUAL? STACK,STACK /?L5
	GETB WRD,6 >STACK
	BTST STACK,32 \?L4
?L5:	SET 'ADJ,1
	JUMP ?L7
?L4:	GET GL-P-ITBL,K-P-VERBN >STACK
	GET STACK,0 >WRD
	GETB WRD,6 >STACK
	BTST STACK,32 \?L6
	SET 'ADJ,1
	JUMP ?L7
?L6:	GETB WRD,6 >STACK
	BTST STACK,128 \?L7
	ZERO? GL-P-NCN \?L7
	GET GL-P-ITBL,K-P-VERB >VERB
	ZERO? VERB /?L7
	PUT GL-P-ITBL,K-P-VERB,0
	PUT GL-P-ITBL,K-P-VERBN,0
	PUT GL-P-ITBL,K-P-NC1,GL-P-P-LEX+2
	PUT GL-P-ITBL,K-P-NC1L,GL-P-P-LEX+6
	SET 'GL-P-NCN,1
?L7:	GET GL-P-ITBL,K-P-VERB >VERB
	ZERO? VERB /?L9
	ZERO? ADJ \?L9
	GET GL-P-OTBL,K-P-VERB >STACK
	EQUAL? VERB,STACK \FALSE
?L9:	EQUAL? GL-P-NCN,2 \?L11
	ZERO? GL-FUNNY-CLAUSE? /FALSE
	SET 'GL-P-NCN,1
	SET 'GL-FUNNY-CLAUSE?,0
	GET GL-P-ITBL,K-P-NC2L >STACK
	PUT GL-P-ITBL,K-P-NC1L,STACK
	CALL1 RT-ORPHAN-MERGE >STACK
	RSTACK
?L11:	GET GL-P-OTBL,K-P-NC1 >STACK
	EQUAL? STACK,1 \?L15
	GET GL-P-ITBL,K-P-PREP1 >TEMP
	GET GL-P-OTBL,K-P-PREP1 >STACK
	EQUAL? TEMP,STACK /?L18
	ZERO? TEMP \FALSE
?L18:	ZERO? ADJ /?L19
	PUT GL-P-OTBL,K-P-NC1,GL-P-P-LEX+2
	GET GL-P-ITBL,K-P-NC1L >STACK
	ZERO? STACK \?L21
	PUT GL-P-ITBL,K-P-NC1L,GL-P-P-LEX+6
?L21:	ZERO? GL-P-NCN \?L27
	SET 'GL-P-NCN,1
	JUMP ?L27
?L19:	GET GL-P-ITBL,K-P-NC1 >STACK
	PUT GL-P-OTBL,K-P-NC1,STACK
?L27:	GET GL-P-ITBL,K-P-NC1L >STACK
	PUT GL-P-OTBL,K-P-NC1L,STACK
	JUMP ?L48
?L15:	GET GL-P-OTBL,K-P-NC2 >STACK
	EQUAL? STACK,1 \?L29
	GET GL-P-ITBL,K-P-PREP1 >TEMP
	GET GL-P-OTBL,K-P-PREP2 >STACK
	EQUAL? TEMP,STACK /?L32
	ZERO? TEMP \FALSE
?L32:	ZERO? ADJ /?L35
	PUT GL-P-ITBL,K-P-NC1,GL-P-P-LEX+2
	GET GL-P-ITBL,K-P-NC1L >STACK
	ZERO? STACK \?L35
	PUT GL-P-ITBL,K-P-NC1L,GL-P-P-LEX+6
?L35:	GET GL-P-ITBL,K-P-NC1 >STACK
	PUT GL-P-OTBL,K-P-NC2,STACK
	GET GL-P-ITBL,K-P-NC1L >STACK
	PUT GL-P-OTBL,K-P-NC2L,STACK
	SET 'GL-P-NCN,2
	JUMP ?L48
?L29:	ZERO? GL-P-ACLAUSE /?L48
	EQUAL? GL-P-NCN,1 /?L41
	ZERO? ADJ \?L41
	SET 'GL-P-ACLAUSE,0
	RFALSE
?L41:	GET GL-P-ITBL,K-P-NC1 >BEG
	ZERO? ADJ /?L44
	SET 'BEG,GL-P-P-LEX+2
	SET 'ADJ,0
?L44:	GET GL-P-ITBL,K-P-NC1L >END
?L47:	GET BEG,0 >WRD
	EQUAL? BEG,END \?L49
	ZERO? ADJ /?L51
	ICALL2 RT-ACLAUSE-WIN,ADJ
	JUMP ?L48
?L51:	SET 'GL-P-ACLAUSE,0
	RFALSE
?L49:	GETB WRD,K-P-PSOFF >STACK
	BTST STACK,PS?ADJECTIVE \?L56
	CALL RT-ADJ-CHECK,WRD,ADJ >STACK
	ZERO? STACK \?L55
?L56:	EQUAL? WRD,W?ALL,W?EVERYTHING \?L54
?L55:	SET 'ADJ,WRD
	JUMP ?L57
?L54:	GETB WRD,K-P-PSOFF >STACK
	BTST STACK,PS?OBJECT \?L57
	EQUAL? WRD,GL-P-ANAM \?L58
	ICALL2 RT-ACLAUSE-WIN,ADJ
	JUMP ?L48
?L58:	ICALL1 RT-NCLAUSE-WIN
	JUMP ?L48
?L57:	ADD BEG,K-P-WORDLEN >BEG
	ZERO? END \?L47
	SET 'END,BEG
	SET 'GL-P-NCN,1
	SUB BEG,4 >STACK
	PUT GL-P-ITBL,K-P-NC1,STACK
	PUT GL-P-ITBL,K-P-NC1L,BEG
	JUMP ?L47
?L48:	GET GL-P-OVTBL,0 >STACK
	PUT GL-P-VTBL,0,STACK
	GETB GL-P-OVTBL,2 >STACK
	PUTB GL-P-VTBL,2,STACK
	GETB GL-P-OVTBL,3 >STACK
	PUTB GL-P-VTBL,3,STACK
	PUT GL-P-OTBL,K-P-VERBN,GL-P-VTBL
	PUTB GL-P-VTBL,2,0
	COPYT GL-P-OTBL,GL-P-ITBL,20
	SET 'GL-P-MERGED,1
	RTRUE

	.FUNCT RT-ADJ-CHECK,WRD,ADJ
	EQUAL? WRD,W?BROWN,W?BLUE /TRUE
	ZERO? ADJ /TRUE
	RFALSE

	.FUNCT RT-CLAUSE-COPY,SRC,DEST,SRCBEG,SRCEND,DESTBEG,DESTEND,INSRT,BEG,END
	ASSIGNED? 'INSRT /?L9
	SET 'INSRT,0
?L9:	GET SRC,SRCBEG >BEG
	GET SRC,SRCEND >END
	GET GL-P-OCLAUSE,K-P-MATCHLEN >STACK
	MUL STACK,K-P-LEXELEN >STACK
	ADD STACK,2 >STACK
	ADD GL-P-OCLAUSE,STACK >STACK
	PUT DEST,DESTBEG,STACK
?L1:	EQUAL? BEG,END \?L3
	GET GL-P-OCLAUSE,K-P-MATCHLEN >STACK
	MUL STACK,K-P-LEXELEN >STACK
	ADD 2,STACK >STACK
	ADD GL-P-OCLAUSE,STACK >STACK
	PUT DEST,DESTEND,STACK
	RTRUE
?L3:	ZERO? INSRT /?L6
	GET BEG,0 >STACK
	EQUAL? GL-P-ANAM,STACK \?L6
	ICALL2 RT-CLAUSE-ADD,INSRT
?L6:	GET BEG,0 >STACK
	ICALL2 RT-CLAUSE-ADD,STACK
	ADD BEG,K-P-WORDLEN >BEG
	JUMP ?L1

	.FUNCT RT-CLAUSE-ADD,WRD,PTR
	GET GL-P-OCLAUSE,K-P-MATCHLEN >STACK
	ADD STACK,2 >PTR
	SUB PTR,1 >STACK
	PUT GL-P-OCLAUSE,STACK,WRD
	PUT GL-P-OCLAUSE,PTR,0
	PUT GL-P-OCLAUSE,K-P-MATCHLEN,PTR
	RTRUE

	.FUNCT RT-PREP-FIND,PREP,CNT,SIZE,TBL
	SET 'CNT,0
	GET PREPOSITIONS,0 >STACK
	ADD PREPOSITIONS,4 >STACK
	INTBL? PREP,STACK,STACK,3 >TBL \FALSE
	SUB TBL,2 >STACK
	GET STACK,0 >STACK
	RSTACK

	.FUNCT RT-SYNTAX-FOUND,SYN
	SET 'GL-P-SYNTAX,SYN
	GETB SYN,K-P-SACTION >GL-PRSA
	RETURN GL-PRSA

	.FUNCT RT-BUT-MERGE,TBL,LEN,BUTLEN,CNT,MATCHES,OBJ,NTBL
	SET 'CNT,1
	SET 'MATCHES,0
	GET TBL,K-P-MATCHLEN >LEN
	PUT GL-P-MERGE,K-P-MATCHLEN,0
?L1:	DLESS? 'LEN,0 /?L2
	GET TBL,CNT >OBJ
	GET GL-P-BUTS,0 >STACK
	INTBL? OBJ,GL-P-BUTS+2,STACK >STACK /?L8
	ADD MATCHES,1 >STACK
	PUT GL-P-MERGE,STACK,OBJ
	INC 'MATCHES
?L8:	INC 'CNT
	JUMP ?L1
?L2:	PUT GL-P-MERGE,K-P-MATCHLEN,MATCHES
	SET 'NTBL,GL-P-MERGE
	SET 'GL-P-MERGE,TBL
	RETURN NTBL

	.FUNCT RT-SNARF-OBJECTS,PTR,NUM
	GETB GL-P-SYNTAX,0 >STACK
	SHIFT STACK,-6 >NUM
	GRTR? NUM,0 \?L5
	GET GL-P-ITBL,K-P-NC1 >PTR
	ZERO? PTR /?L5
	SET 'GL-P-PHR,0
	GETB GL-P-SYNTAX,K-P-SLOC1 >GL-P-SLOCBITS
	GET GL-P-ITBL,K-P-NC1L >STACK
	CALL RT-SNARF,PTR,STACK,GL-P-PRSO >STACK
	ZERO? STACK /FALSE
	GET GL-P-BUTS,K-P-MATCHLEN >STACK
	ZERO? STACK /?L5
	CALL2 RT-BUT-MERGE,GL-P-PRSO >GL-P-PRSO
?L5:	GRTR? NUM,1 \TRUE
	GET GL-P-ITBL,K-P-NC2 >PTR
	ZERO? PTR /TRUE
	SET 'GL-P-PHR,1
	GETB GL-P-SYNTAX,K-P-SLOC2 >GL-P-SLOCBITS
	GET GL-P-ITBL,K-P-NC2L >STACK
	CALL RT-SNARF,PTR,STACK,GL-P-PRSI >STACK
	ZERO? STACK /FALSE
	GET GL-P-BUTS,K-P-MATCHLEN >STACK
	ZERO? STACK /TRUE
	GET GL-P-PRSI,K-P-MATCHLEN >STACK
	EQUAL? STACK,1 \?L14
	CALL2 RT-BUT-MERGE,GL-P-PRSO >GL-P-PRSO
	RTRUE
?L14:	CALL2 RT-BUT-MERGE,GL-P-PRSI >GL-P-PRSI
	RTRUE

	.FUNCT RT-SNARF,PTR,EPTR,TBL,BUT,LEN,WV,WRD,NW,WAS-ALL?,ONEOBJ
	SET 'BUT,0
	SET 'WAS-ALL?,0
	SET 'GL-P-AND,0
	EQUAL? GL-P-GET-FLAGS,K-P-ALL \?L1
	SET 'WAS-ALL?,1
?L1:	SET 'GL-P-GET-FLAGS,0
	PUT GL-P-BUTS,K-P-MATCHLEN,0
	PUT TBL,K-P-MATCHLEN,0
	GET PTR,0 >WRD
?L4:	EQUAL? PTR,EPTR \?L6
?L57:	ZERO? BUT /?L9
	PUSH BUT
	JUMP ?L8
?L9:	PUSH TBL
?L8:	CALL2 RT-GET-OBJECT,STACK >WV
	ZERO? WAS-ALL? /?L10
	SET 'GL-P-GET-FLAGS,K-P-ALL
?L10:	RETURN WV
?L6:	ADD PTR,K-P-WORDLEN >STACK
	EQUAL? EPTR,STACK \?L14
	SET 'NW,0
	JUMP ?L16
?L14:	GET PTR,K-P-LEXELEN >NW
?L16:	EQUAL? WRD,W?ALL,W?BOTH,W?EVERYTHING \?L17
	SET 'GL-P-GET-FLAGS,K-P-ALL
	EQUAL? NW,W?OF \?L52
	ADD PTR,K-P-WORDLEN >PTR
	JUMP ?L52
?L17:	EQUAL? WRD,W?BUT,W?EXCEPT \?L22
	ZERO? BUT /?L26
	PUSH BUT
	JUMP ?L25
?L26:	PUSH TBL
?L25:	CALL2 RT-GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	SET 'BUT,GL-P-BUTS
	PUT BUT,K-P-MATCHLEN,0
	JUMP ?L52
?L22:	EQUAL? WRD,W?A \?L27
	ZERO? GL-P-ADJ \?L28
	SET 'GL-P-GET-FLAGS,K-P-ONE
	EQUAL? NW,W?OF \?L52
	ADD PTR,K-P-WORDLEN >PTR
	JUMP ?L52
?L28:	SET 'GL-P-NAM,ONEOBJ
	ZERO? BUT /?L37
	PUSH BUT
	JUMP ?L36
?L37:	PUSH TBL
?L36:	CALL2 RT-GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	ZERO? NW /TRUE
	JUMP ?L52
?L27:	EQUAL? WRD,W?AND,W?$COMMA \?L40
	EQUAL? NW,W?AND,W?$COMMA /?L40
	SET 'GL-P-AND,1
	ZERO? BUT /?L44
	PUSH BUT
	JUMP ?L43
?L44:	PUSH TBL
?L43:	CALL2 RT-GET-OBJECT,STACK >STACK
	ZERO? STACK /FALSE
	JUMP ?L52
?L40:	GETB WRD,6 >STACK
	BTST STACK,4 /?L52
	EQUAL? WRD,W?AND,W?$COMMA /?L52
	EQUAL? WRD,W?OF \?L47
	ZERO? GL-P-GET-FLAGS \?L52
	SET 'GL-P-GET-FLAGS,K-P-INHIBIT
	JUMP ?L52
?L47:	GETB WRD,6 >STACK
	BTST STACK,32 \?L51
	ZERO? GL-P-ADJ \?L51
	EQUAL? NW,W?OF /?L51
	SET 'GL-P-ADJ,WRD
	JUMP ?L52
?L51:	GETB WRD,6 >STACK
	BTST STACK,128 \?L52
	SET 'GL-P-NAM,WRD
	SET 'ONEOBJ,WRD
?L52:	EQUAL? PTR,EPTR /?L57
	ADD PTR,K-P-WORDLEN >PTR
	SET 'WRD,NW
	JUMP ?L4

	.FUNCT RT-GET-OBJECT,TBL,VRB,NO-ROOMS?,BTS,LEN,XBITS,TLEN,GCHECK,OLEN,OBJ,ADJ,X
	ASSIGNED? 'VRB /?L71
	SET 'VRB,1
?L71:	ASSIGNED? 'NO-ROOMS? /?L72
	SET 'NO-ROOMS?,0
?L72:	SET 'GCHECK,0
	SET 'OLEN,0
	SET 'XBITS,GL-P-SLOCBITS
	GET TBL,K-P-MATCHLEN >TLEN
	BTST GL-P-GET-FLAGS,K-P-INHIBIT /TRUE
	SET 'ADJ,GL-P-ADJ
	ZERO? GL-P-NAM \?L11
	ZERO? GL-P-ADJ /?L8
	GETB GL-P-ADJ,6 >STACK
	BTST STACK,128 \?L6
	SET 'GL-P-NAM,GL-P-ADJ
	SET 'GL-P-ADJ,0
	JUMP ?L8
?L6:	CALL RT-WT?,GL-P-ADJ,16,3 >BTS
	ZERO? BTS /?L8
	SET 'GL-P-ADJ,0
	PUT TBL,K-P-MATCHLEN,1
	PUT TBL,1,TH-INTDIR
	SET 'GL-P-DIRECTION,BTS
	RTRUE
?L8:	ZERO? GL-P-NAM \?L11
	ZERO? GL-P-ADJ \?L11
	EQUAL? GL-P-GET-FLAGS,K-P-ALL /?L73
	ZERO? GL-P-GWIMBIT \?L11
	ZERO? VRB /FALSE
	ICALL2 RT-NOT-IN-SENTENCE-MSG,STR?107
	RFALSE
?L11:	EQUAL? GL-P-GET-FLAGS,K-P-ALL \?L19
?L73:	ZERO? GL-P-SLOCBITS \?L17
?L19:	SET 'GL-P-SLOCBITS,-1
?L17:	EQUAL? TBL,GL-P-PRSO \?L21
	GET GL-P-OFW,0 >GL-P-OF
	JUMP ?L23
?L21:	GET GL-P-OFW,1 >GL-P-OF
?L23:	SET 'GL-P-TABLE,TBL
?L24:	ZERO? GCHECK /?L26
	ICALL2 RT-GLOBAL-CHECK,TBL
	JUMP ?L28
?L26:	ZERO? GL-NOW-LIT? /?L29
	FCLEAR CH-PLAYER,FL-TRANSPARENT
	ICALL RT-DO-SL,GL-PLACE-CUR,SOG,SIR
	FSET CH-PLAYER,FL-TRANSPARENT
?L29:	ICALL RT-DO-SL,CH-PLAYER,SH,SC
?L28:	GET TBL,K-P-MATCHLEN >STACK
	SUB STACK,TLEN >LEN
	BTST GL-P-GET-FLAGS,K-P-ALL /?L66
	BTST GL-P-GET-FLAGS,K-P-ONE \?L34
	ZERO? LEN /?L34
	EQUAL? LEN,1 /?L35
	RANDOM LEN >STACK
	GET TBL,STACK >STACK
	PUT TBL,1,STACK
	PRINTI "[How about "
	GET TBL,1 >STACK
	ICALL2 RT-THEO-PRINT,STACK
	PRINTI "?]"
	CRLF
?L35:	PUT TBL,K-P-MATCHLEN,1
	JUMP ?L66
?L34:	GRTR? LEN,1 /?L39
	ZERO? LEN \?L66
	EQUAL? GL-P-SLOCBITS,-1 /?L38
?L39:	EQUAL? GL-P-SLOCBITS,-1 \?L40
	SET 'GL-P-SLOCBITS,XBITS
	SET 'OLEN,LEN
	GET TBL,K-P-MATCHLEN >STACK
	SUB STACK,LEN >STACK
	PUT TBL,K-P-MATCHLEN,STACK
	JUMP ?L24
?L40:	PUT GL-P-NAMW,GL-P-PHR,GL-P-NAM
	PUT GL-P-ADJW,GL-P-PHR,GL-P-ADJ
	ZERO? LEN \?L43
	SET 'LEN,OLEN
?L43:	ZERO? GL-P-NAM /?L46
	ADD TLEN,1 >STACK
	GET TBL,STACK >OBJ
	ZERO? OBJ /?L46
	GETP OBJ,P?GENERIC >STACK
	CALL STACK,TBL,LEN >OBJ
	ZERO? OBJ /?L46
	EQUAL? OBJ,TH-NOT-HERE-OBJECT /FALSE
	PUT TBL,1,OBJ
	PUT TBL,K-P-MATCHLEN,1
	SET 'GL-P-NAM,0
	SET 'GL-P-ADJ,0
	RTRUE
?L46:	ZERO? VRB /?L56
	EQUAL? GL-WINNER,CH-PLAYER /?L51
	PRINT K-DONT-UNDERSTAND-MSG
	CRLF
	RFALSE
?L51:	ZERO? VRB /?L56
	ZERO? GL-P-NAM /?L52
	ICALL RT-WHICH-PRINT,TLEN,LEN,TBL
	EQUAL? TBL,GL-P-PRSO \?L53
	SET 'GL-P-ACLAUSE,K-P-NC1
	JUMP ?L55
?L53:	SET 'GL-P-ACLAUSE,K-P-NC2
?L55:	SET 'GL-P-AADJ,GL-P-ADJ
	SET 'GL-P-ANAM,GL-P-NAM
	ICALL RT-ORPHAN,0,0
	SET 'GL-P-ORPH,1
	JUMP ?L56
?L52:	ZERO? VRB /?L56
	ICALL2 RT-NOT-IN-SENTENCE-MSG,STR?107
?L56:	SET 'GL-P-NAM,0
	SET 'GL-P-ADJ,0
	RFALSE
?L38:	ZERO? LEN \?L66
	ZERO? GCHECK /?L58
	PUT GL-P-NAMW,GL-P-PHR,GL-P-NAM
	PUT GL-P-ADJW,GL-P-PHR,GL-P-ADJ
	ZERO? VRB /?L64
	SET 'GL-P-SLOCBITS,XBITS
	ZERO? GL-NOW-LIT? \?L63
	CALL1 RT-TALK-VERB? >STACK
	ZERO? STACK /?L61
?L63:	ICALL RT-OBJ-FOUND,TH-NOT-HERE-OBJECT,TBL
	SET 'GL-P-XNAM,GL-P-NAM
	SET 'GL-P-NAM,0
	SET 'GL-P-XADJ,GL-P-ADJ
	SET 'GL-P-ADJ,0
	RTRUE
?L61:	PRINT K-TOO-DARK-MSG
	CRLF
?L64:	SET 'GL-P-NAM,0
	SET 'GL-P-ADJ,0
	RFALSE
?L58:	ZERO? LEN \?L66
	SET 'GCHECK,1
	JUMP ?L24
?L66:	ADD TLEN,1 >STACK
	GET TBL,STACK >X
	ZERO? GL-P-ADJ /?L68
	ZERO? GL-P-NAM \?L68
	ZERO? X /?L68
	PRINTI "["
	ICALL2 RT-THEO-PRINT,X
	PRINTI "]"
	CRLF
	CRLF
?L68:	SET 'GL-P-SLOCBITS,XBITS
	PUT GL-P-NAMW,GL-P-PHR,GL-P-NAM
	PUT GL-P-ADJW,GL-P-PHR,GL-P-ADJ
	SET 'GL-P-NAM,0
	SET 'GL-P-ADJ,0
	RTRUE

	.FUNCT RT-MOBY-FIND,TBL,OBJ,LEN,FOO,NAM,ADJ,TTBL,COBJ-GOOD?,CT
	SET 'OBJ,1
	SET 'TTBL,0
	SET 'COBJ-GOOD?,0
	SET 'CT,0
	SET 'NAM,GL-P-NAM
	SET 'ADJ,GL-P-ADJ
	SET 'GL-P-NAM,GL-P-XNAM
	SET 'GL-P-ADJ,GL-P-XADJ
	PUT TBL,K-P-MATCHLEN,0
?L1:	CALL2 RT-THIS-IT?,OBJ >STACK
	ZERO? STACK /?L17
	LOC OBJ >STACK
	ZERO? STACK /?L7
	LOC OBJ >STACK
	CALL2 RT-THIS-IT?,STACK >STACK
	ZERO? STACK \?L5
?L7:	GET TBL,K-P-MATCHLEN >CT
	LOC OBJ >STACK
	ZERO? STACK \?L10
	FSET? OBJ,FL-PERSON /?L10
	GET FIND-NO-LOCS,0 >STACK
	INTBL? OBJ,FIND-NO-LOCS+2,STACK >STACK \?L8
?L10:	EQUAL? CT,1 \?L11
	ZERO? COBJ-GOOD? \?L11
	SET 'COBJ-GOOD?,1
	PUT TBL,K-P-MATCHLEN,0
	JUMP ?L13
?L11:	ZERO? CT \?L13
	SET 'COBJ-GOOD?,1
?L13:	ICALL RT-OBJ-FOUND,OBJ,TBL
	JUMP ?L17
?L8:	ZERO? CT \?L17
	CALL RT-OBJ-FOUND,OBJ,TBL >FOO
	JUMP ?L17
?L5:	IN? OBJ,ROOMS \?L17
	GET TBL,K-P-MATCHLEN >STACK
	ZERO? STACK \?L17
	CALL2 RT-MATCH-PSEUDO,OBJ >STACK
	ZERO? STACK /?L17
	CALL RT-OBJ-FOUND,OBJ,TBL >FOO
?L17:	IGRTR? 'OBJ,LAST-OBJECT \?L1
	GET TBL,K-P-MATCHLEN >CT
	ZERO? CT /?L25
	ZERO? COBJ-GOOD? /?L25
	EQUAL? GL-PLACE-CUR,RM-DIOGENES-CLUB \?L26
	GET TBL,K-P-MATCHLEN >STACK
	ADD TBL,2 >STACK
	INTBL? CH-HOLMES,STACK,STACK >TTBL \?L26
?L25:	CALL RT-PARSE-EVENT?,GL-P-NAM,GL-P-ADJ >OBJ
	ZERO? OBJ /?L26
	ZERO? TTBL /?L28
	PUT TTBL,0,OBJ
	JUMP ?L30
?L28:	ZERO? COBJ-GOOD? \?L31
	GRTR? CT,0 \?L31
	SUB CT,1 >STACK
	PUT TBL,K-P-MATCHLEN,STACK
?L31:	ICALL RT-OBJ-FOUND,OBJ,TBL
?L30:	SET 'COBJ-GOOD?,1
?L26:	GET TBL,K-P-MATCHLEN >LEN
	EQUAL? LEN,1 \?L40
	ZERO? COBJ-GOOD? \?L38
	SET 'GL-P-MOBY-FOUND,TH-NOT-HERE-OBJECT
	JUMP ?L40
?L38:	GET TBL,1 >GL-P-MOBY-FOUND
?L40:	SET 'GL-P-NAM,NAM
	SET 'GL-P-ADJ,ADJ
	RETURN LEN

	.FUNCT RT-MATCH-PSEUDO,OBJ,RMG,RMGL,TTBL
	GETP OBJ,P?PSEUDOS >RMG
	ZERO? RMG /FALSE
	GETB RMG,0 >RMGL
	INC 'RMG
?L4:	GET RMG,1 >TTBL
	ZERO? TTBL /?L6
	GETB TTBL,0 >STACK
	ADD TTBL,1 >STACK
	INTBL? GL-P-NAM,STACK,STACK >STACK \?L6
	ZERO? GL-P-ADJ /?L8
	GET RMG,0 >TTBL
	ZERO? TTBL /?L6
	GETB TTBL,0 >STACK
	ADD TTBL,1 >STACK
	INTBL? GL-P-ADJ,STACK,STACK >STACK \?L6
?L8:	RETURN RMG
?L6:	ADD RMG,6 >RMG
	DLESS? 'RMGL,1 \?L4
	RFALSE

	.FUNCT RT-GLOBAL-CHECK,TBL,LEN,RMG,RMGL,CNT,OBJ,OBITS,FOO
	SET 'CNT,0
	GET TBL,K-P-MATCHLEN >LEN
	SET 'OBITS,GL-P-SLOCBITS
	CALL2 RT-THIS-IT?,GL-PLACE-CUR >STACK
	ZERO? STACK /?L1
	ICALL RT-OBJ-FOUND,GL-PLACE-CUR,TBL
?L1:	GETPT GL-PLACE-CUR,P?GLOBAL >RMG
	ZERO? RMG /?L7
	PTSIZE RMG >RMGL
	DEC 'RMGL
?L6:	GETB RMG,CNT >OBJ
	FIRST? OBJ >STACK \?L8
	IN? OBJ,ROOMS /?L8
	ICALL RT-SEARCH-LIST,OBJ,TBL,K-P-SRCALL
?L8:	CALL2 RT-THIS-IT?,OBJ >STACK
	ZERO? STACK /?L11
	ICALL RT-OBJ-FOUND,OBJ,TBL
?L11:	IGRTR? 'CNT,RMGL \?L6
?L7:	GET TBL,K-P-MATCHLEN >STACK
	ZERO? STACK \?L18
	CALL2 RT-MATCH-PSEUDO,GL-PLACE-CUR >RMG
	ZERO? RMG /?L18
	SET 'LAST-PSEUDO-LOC,GL-PLACE-CUR
	GET RMG,2 >STACK
	PUTP PSEUDO-OBJECT,P?ACTION,STACK
	ICALL RT-OBJ-FOUND,PSEUDO-OBJECT,TBL
?L18:	GET TBL,K-P-MATCHLEN >STACK
	EQUAL? STACK,LEN \FALSE
	SET 'GL-P-SLOCBITS,-1
	SET 'GL-P-TABLE,TBL
	ICALL RT-DO-SL,GLOBAL-OBJECTS,1,1
	SET 'GL-P-SLOCBITS,OBITS
	GET TBL,K-P-MATCHLEN >STACK
	ZERO? STACK \FALSE
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON,V?LOOK-INSIDE /?L27
	EQUAL? GL-PRSA,V?FIND,V?FOLLOW,V?EXIT /?L27
	EQUAL? GL-PRSA,V?SEARCH,V?SMELL,V?WALK-TO /?L27
	EQUAL? GL-PRSA,V?THROUGH,V?WAIT-FOR,V?WAIT \FALSE
?L27:	ZERO? INHIBIT-ROOMS \FALSE
	CALL RT-DO-SL,ROOMS,1,1 >STACK
	RSTACK

	.FUNCT RT-DO-SL,OBJ,BIT1,BIT2,BITS
	ADD BIT1,BIT2 >STACK
	BTST GL-P-SLOCBITS,STACK \?L1
	CALL RT-SEARCH-LIST,OBJ,GL-P-TABLE,K-P-SRCALL >STACK
	RSTACK
?L1:	BTST GL-P-SLOCBITS,BIT1 \?L4
	CALL RT-SEARCH-LIST,OBJ,GL-P-TABLE,K-P-SRCTOP >STACK
	RSTACK
?L4:	BTST GL-P-SLOCBITS,BIT2 \TRUE
	CALL RT-SEARCH-LIST,OBJ,GL-P-TABLE,K-P-SRCBOT >STACK
	RSTACK

	.FUNCT RT-SEARCH-LIST,OBJ,TBL,LVL
	FIRST? OBJ >OBJ \FALSE
?L4:	EQUAL? LVL,K-P-SRCBOT /?L6
	GETPT OBJ,P?SYNONYM >STACK
	ZERO? STACK /?L6
	CALL2 RT-THIS-IT?,OBJ >STACK
	ZERO? STACK /?L6
	ICALL RT-OBJ-FOUND,OBJ,TBL
?L6:	EQUAL? LVL,K-P-SRCTOP \?L11
	FSET? OBJ,FL-SURFACE /?L11
	FSET? OBJ,FL-PERSON \?L9
?L11:	FIRST? OBJ >STACK \?L9
	CALL2 RT-SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /?L9
	FSET? OBJ,FL-SURFACE /?L14
	FSET? OBJ,FL-PERSON \?L12
?L14:	PUSH K-P-SRCALL
	JUMP ?L17
?L12:	FSET? OBJ,FL-CONTAINER \?L15
	FSET? OBJ,FL-OPENED /?L16
	FSET? OBJ,FL-TRANSPARENT \?L15
?L16:	PUSH K-P-SRCALL
	JUMP ?L17
?L15:	PUSH K-P-SRCTOP
?L17:	ICALL RT-SEARCH-LIST,OBJ,TBL,STACK
?L9:	NEXT? OBJ >OBJ /?L4
	RTRUE

	.FUNCT RT-THIS-IT?,OBJ,SYNS,SYNSIZE,ADJS,ADJSIZE
	SET 'SYNS,0
	SET 'ADJS,0
	ZERO? GL-P-NAM /?L1
	GETPT OBJ,P?SYNONYM >SYNS
	ZERO? SYNS /FALSE
	PTSIZE SYNS >STACK
	DIV STACK,2 >SYNSIZE
	INTBL? GL-P-NAM,SYNS,SYNSIZE >STACK \FALSE
?L1:	ZERO? GL-P-ADJ /?L4
	GETPT OBJ,P?ADJECTIVE >ADJS
	ZERO? ADJS /FALSE
	PTSIZE ADJS >STACK
	DIV STACK,2 >ADJSIZE
	INTBL? GL-P-ADJ,ADJS,ADJSIZE >STACK \FALSE
?L4:	ZERO? INHIBIT-ROOMS /?L7
	IN? OBJ,ROOMS /FALSE
?L7:	ZERO? GL-P-OF /?L9
	ZERO? ADJS /?L10
	INTBL? GL-P-OF,ADJS,ADJSIZE >STACK /TRUE
?L10:	ZERO? SYNS /FALSE
	INTBL? GL-P-OF,SYNS,SYNSIZE >STACK \FALSE
	RTRUE
?L9:	ZERO? GL-P-GWIMBIT /TRUE
	FSET? OBJ,GL-P-GWIMBIT /TRUE
	RFALSE

	.FUNCT RT-OBJ-FOUND,OBJ,TBL,PTR
	GET TBL,K-P-MATCHLEN >STACK
	ADD STACK,1 >PTR
	LESS? PTR,K-P-OBJ-TBL-LEN /?L11
	SET 'GL-P-OVERFLOW,1
	RFALSE
?L11:	SET 'GL-P-OVERFLOW,0
	PUT TBL,PTR,OBJ
	PUT TBL,K-P-MATCHLEN,PTR
	FSET? OBJ,FL-NEEDS-IDENTITY \TRUE
	PUTP OBJ,P?OBJ-ADJ,GL-P-ADJ
	EQUAL? OBJ,TH-EVENT /TRUE
	PUTP OBJ,P?OBJ-NOUN,GL-P-NAM
	RTRUE

	.FUNCT RT-ITAKE,VB,L
	ASSIGNED? 'VB /?L23
	SET 'VB,1
?L23:	ZERO? GL-PRSO /?L3
	LOC GL-PRSO >STACK
	ZERO? STACK \?L1
?L3:	ICALL1 RT-CANT-SEE-ANY-MSG
	RFALSE
?L1:	LOC GL-PRSO >L
	ICALL2 RT-THIS-IS-IT,GL-PRSO
	FSET? GL-PRSO,FL-TAKEABLE /?L5
	ZERO? VB /FALSE
	ICALL1 RT-IMPOSSIBLE-MSG
	RFALSE
?L5:	FSET? L,FL-CONTAINER \?L10
	FSET? L,FL-OPENABLE \?L10
	FSET? L,FL-OPENED /?L10
	ZERO? VB /FALSE
	ICALL RT-YOUD-HAVE-TO-MSG,STR?108,L
	RFALSE
?L10:	IN? L,GL-WINNER /?L14
	CALL RT-OBJ-TOO-HEAVY?,GL-PRSO,GL-WINNER >STACK
	ZERO? STACK /?L14
	ZERO? VB /FALSE
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSO
	PRINTI "too heavy."
	CRLF
	RFALSE
?L14:	CALL RT-OBJ-TOO-MANY?,GL-PRSO,GL-WINNER >STACK
	ZERO? STACK /?L18
	ZERO? VB /FALSE
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "holding too much already."
	CRLF
	RFALSE
?L18:	FSET GL-PRSO,FL-SEEN
	FSET GL-PRSO,FL-TOUCHED
	FCLEAR GL-PRSO,FL-WORN
	FCLEAR GL-PRSO,FL-NODESC
	FCLEAR GL-PRSO,FL-NOALL
	MOVE GL-PRSO,GL-WINNER
	RETURN L

	.FUNCT RT-ITAKE-CHECK,TBL,BITS,PRSO?,PTR,LEN,OBJ,L,GOT,TRIED-TAKE?,NEED-TAKE?
	ASSIGNED? 'PRSO? /?L80
	SET 'PRSO?,0
?L80:	SET 'PTR,1
	SET 'TRIED-TAKE?,0
	SET 'NEED-TAKE?,0
	GET TBL,K-P-MATCHLEN >LEN
	ZERO? LEN /TRUE
	BAND BITS,10 >STACK
	ZERO? STACK /TRUE
?L4:	GET TBL,PTR >OBJ
	EQUAL? OBJ,TH-IT \?L6
	CALL2 RT-ACCESSIBLE?,GL-P-IT-OBJECT >STACK
	ZERO? STACK \?L8
	PRINT K-BE-MORE-SPECIFIC-MSG
	CRLF
	RFALSE
?L8:	FSET? OBJ,FL-NEEDS-IDENTITY \?L11
	GETP TH-IT,P?OBJ-NOUN >STACK
	PUTP OBJ,P?OBJ-NOUN,STACK
	GETP TH-IT,P?OBJ-ADJ >STACK
	PUTP OBJ,P?OBJ-ADJ,STACK
?L11:	SET 'OBJ,GL-P-IT-OBJECT
	JUMP ?L22
?L6:	EQUAL? OBJ,CH-THEM \?L14
	CALL2 RT-ACCESSIBLE?,GL-P-THEM-OBJECT >STACK
	ZERO? STACK \?L15
	PRINT K-BE-MORE-SPECIFIC-MSG
	CRLF
	RFALSE
?L15:	SET 'OBJ,GL-P-THEM-OBJECT
	JUMP ?L22
?L14:	EQUAL? OBJ,CH-HER \?L18
	CALL2 RT-ACCESSIBLE?,GL-P-HER-OBJECT >STACK
	ZERO? STACK \?L19
	PRINT K-BE-MORE-SPECIFIC-MSG
	CRLF
	RFALSE
?L19:	SET 'OBJ,GL-P-HER-OBJECT
	JUMP ?L22
?L18:	EQUAL? OBJ,CH-HIM \?L22
	CALL2 RT-ACCESSIBLE?,GL-P-HIM-OBJECT >STACK
	ZERO? STACK \?L23
	PRINT K-BE-MORE-SPECIFIC-MSG
	CRLF
	RFALSE
?L23:	SET 'OBJ,GL-P-HIM-OBJECT
?L22:	EQUAL? OBJ,TH-POCKET,TH-HANDS,TH-FEET /?L57
	EQUAL? OBJ,CH-ME,CH-PLAYER,CH-YOU /?L57
	EQUAL? OBJ,ROOMS,TH-PLAYER-BODY,TH-INTDIR /?L57
	EQUAL? OBJ,TH-RIGHT,TH-LEFT /?L57
	BTST BITS,SC /?L29
	BTST BITS,SH \?L29
	IN? OBJ,GL-WINNER /?L39
	SET 'NEED-TAKE?,1
	JUMP ?L39
?L29:	CALL2 RT-HELD?,OBJ >STACK
	ZERO? STACK \?L39
	ZERO? PRSO? /?L81
	GET GL-P-NAMW,0 >STACK
	ZERO? STACK /?L37
	ZERO? PRSO? \?L35
?L81:	GET GL-P-NAMW,1 >STACK
	ZERO? STACK \?L35
?L37:	IN? OBJ,TH-POCKET /?L39
?L35:	SET 'NEED-TAKE?,1
?L39:	ZERO? NEED-TAKE? /?L57
	SET 'NEED-TAKE?,0
	SET 'GL-PRSO,OBJ
	LOC OBJ >L
	ZERO? L \?L43
	SET 'GOT,0
	JUMP ?L56
?L43:	FSET? OBJ,FL-TRYTAKE \?L45
	FSET? OBJ,FL-TAKEABLE /?L45
	SET 'GOT,0
	JUMP ?L56
?L45:	EQUAL? GL-WINNER,CH-PLAYER /?L46
	SET 'GOT,0
	JUMP ?L56
?L46:	EQUAL? L,GL-WINNER \?L47
	BTST BITS,SHAVE \?L47
	SET 'GOT,1
	JUMP ?L56
?L47:	CALL RT-META-IN?,L,GL-WINNER >STACK
	ZERO? STACK /?L48
	ZERO? GL-P-MULT? \?L48
	BTST BITS,STAKE \?L48
	PRINTI "[taking "
	ICALL2 RT-THEO-PRINT,OBJ
	ZERO? L /?L49
	FSET? L,FL-CONTAINER \?L51
	PRINTI " out of "
	JUMP ?L54
?L51:	FSET? L,FL-SURFACE \?L53
	PRINTI " off "
	JUMP ?L54
?L53:	PRINTI " from "
?L54:	ICALL2 RT-THEO-PRINT,L
?L49:	PRINTI " first]."
	CRLF
	SET 'NEED-TAKE?,1
	CALL1 RT-ITAKE >GOT
	JUMP ?L56
?L48:	SET 'GOT,0
?L56:	ZERO? GOT \?L57
	BTST BITS,SHAVE \?L57
	ZERO? NEED-TAKE? \FALSE
	EQUAL? LEN,PTR \?L63
	ZERO? GL-P-MULT? \?L61
?L63:	EQUAL? OBJ,TH-NOT-HERE-OBJECT /?L61
	LOC OBJ >STACK
	EQUAL? STACK,GLOBAL-OBJECTS,LOCAL-GLOBALS \?L61
	PRINTI "Don't be silly"
	JUMP ?L71
?L61:	ICALL1 RT-WINNER-NOT-HOLDING-MSG
	EQUAL? LEN,PTR \?L65
	ZERO? GL-P-MULT? /?L65
	PRINTI "all of those things"
	JUMP ?L71
?L65:	EQUAL? OBJ,TH-NOT-HERE-OBJECT \?L67
	SET 'GL-P-IT-OBJECT,OBJ
	ICALL2 DPRINT,OBJ
	JUMP ?L71
?L67:	ICALL2 RT-THIS-IS-IT,OBJ
	FSET? OBJ,FL-PLURAL \?L69
	PRINTI "any "
	ICALL2 DPRINT,OBJ
	JUMP ?L71
?L69:	ICALL2 RT-A-PRINT,OBJ
?L71:	PRINTI "."
	CRLF
	RFALSE
?L57:	IGRTR? 'PTR,LEN \?L4
	RTRUE

	.FUNCT RT-MANY-CHECK,LOSS,TMP
	SET 'LOSS,0
	GET GL-P-PRSO,K-P-MATCHLEN >STACK
	GRTR? STACK,1 \?L1
	GETB GL-P-SYNTAX,K-P-SLOC1 >STACK
	BTST STACK,SMANY /?L1
	SET 'LOSS,1
	JUMP ?L3
?L1:	GET GL-P-PRSI,K-P-MATCHLEN >STACK
	GRTR? STACK,1 \?L3
	GETB GL-P-SYNTAX,K-P-SLOC2 >STACK
	BTST STACK,SMANY /?L3
	SET 'LOSS,2
?L3:	ZERO? LOSS /TRUE
	PRINTI "[You cannot refer to more than one object at a time with """
	GET GL-P-ITBL,K-P-VERBN >TMP
	ZERO? TMP \?L7
	PRINTI "tell"
	JUMP ?L11
?L7:	ZERO? GL-P-ORPH \?L10
	ZERO? GL-P-MERGED /?L9
?L10:	GET TMP,0 >STACK
	PRINTB STACK
	JUMP ?L11
?L9:	GETB TMP,3 >STACK
	GETB TMP,2 >STACK
	ICALL RT-WORD-PRINT,STACK,STACK
?L11:	PRINTI ".""]"
	CRLF
	RFALSE

	.FUNCT RT-IS-LIT?,RM,RMFLG,OHERE,LIT
	ASSIGNED? 'RM /?L23
	SET 'RM,0
?L23:	ASSIGNED? 'RMFLG /?L24
	SET 'RMFLG,1
?L24:	SET 'LIT,0
	ZERO? RM \?L1
	SET 'RM,GL-PLACE-CUR
?L1:	ZERO? RMFLG /?L4
	FSET? RM,FL-LIGHTED /TRUE
?L4:	ZERO? GL-ALW-LIT? /?L6
	EQUAL? GL-WINNER,CH-PLAYER /TRUE
?L6:	FSET? RM,FL-INDOORS /?L10
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \TRUE
?L10:	SET 'GL-P-GWIMBIT,FL-LIGHTED
	SET 'OHERE,GL-PLACE-CUR
	SET 'GL-PLACE-CUR,RM
	PUT GL-P-MERGE,K-P-MATCHLEN,0
	SET 'GL-P-TABLE,GL-P-MERGE
	SET 'GL-P-SLOCBITS,-1
	SET 'GL-P-OF,0
	EQUAL? OHERE,RM \?L16
	ICALL RT-DO-SL,GL-WINNER,1,1
	EQUAL? GL-WINNER,CH-PLAYER /?L16
	IN? CH-PLAYER,RM \?L16
	ICALL RT-DO-SL,CH-PLAYER,1,1
?L16:	ICALL RT-DO-SL,RM,1,1
	GET GL-P-TABLE,K-P-MATCHLEN >STACK
	GRTR? STACK,0 \?L20
	SET 'LIT,1
?L20:	SET 'GL-PLACE-CUR,OHERE
	SET 'GL-P-GWIMBIT,0
	RETURN LIT

	.FUNCT RT-PERFORM,A,O,I,W-ROOM,W-LOC,I-LOC,O-LOC,V,OA,OO,OI,ONP,WHO
	ASSIGNED? 'O /?L168
	SET 'O,0
?L168:	ASSIGNED? 'I /?L169
	SET 'I,0
?L169:	ZERO? WINNER-IS-WIGGINS /?L1
	EQUAL? GL-WINNER,CH-PLAYER \?L1
	EQUAL? GL-PRSA,V?TELL /?L1
	SET 'GL-WINNER,CH-WIGGINS
	ICALL2 RT-SPOKEN-TO-MSG,GL-WINNER
?L1:	SET 'WINNER-IS-WIGGINS,0
	FSET? GL-WINNER,FL-ALIVE /?L4
	ICALL RT-NOT-LIKELY-MSG,GL-WINNER,STR?111
	ICALL1 RT-P-CLEAR
	RETURN 2
?L4:	GET GL-SEE-VERBS,0 >STACK
	INTBL? A,GL-SEE-VERBS+2,STACK >STACK \?L7
	ZERO? GL-NOW-LIT? \?L7
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L7:	SET 'OA,GL-PRSA
	SET 'OO,GL-PRSO
	SET 'OI,GL-PRSI
	SET 'ONP,GL-NOW-PRSI?
	CALL1 RT-ANYONE-HERE? >WHO
	SET 'V,0
	EQUAL? A,V?WALK /?L106
	EQUAL? GL-WINNER,CH-PLAYER \?L29
	EQUAL? GL-PRSA,V?WHO,V?WHAT,V?WHERE \?L12
	ZERO? WHO \?L14
	ICALL1 RT-NOBODY-TO-ASK-MSG
	RETURN 2
?L14:	SET 'GL-WINNER,WHO
	ICALL2 RT-SPOKEN-TO-MSG,WHO
	JUMP ?L29
?L12:	EQUAL? GL-WINNER,CH-PLAYER \?L29
	EQUAL? GL-PRSA,V?ASK-FOR-1,V?ASK-ABOUT-1 \?L17
	ZERO? WHO \?L18
	ICALL1 RT-NOBODY-TO-ASK-MSG
	RETURN 2
?L18:	ICALL2 RT-SPOKEN-TO-MSG,WHO
	SET 'GL-PRSI,GL-PRSO
	SET 'GL-PRSO,WHO
	EQUAL? GL-PRSA,V?ASK-FOR-1 \?L21
	SET 'GL-PRSA,V?ASK-FOR
	JUMP ?L23
?L21:	EQUAL? GL-PRSA,V?ASK-ABOUT-1 \?L23
	SET 'GL-PRSA,V?ASK-ABOUT
?L23:	SET 'A,GL-PRSA
	SET 'O,GL-PRSO
	SET 'I,GL-PRSI
	JUMP ?L29
?L17:	EQUAL? GL-WINNER,CH-PLAYER \?L29
	EQUAL? O,CH-ME,CH-PLAYER \?L29
	EQUAL? GL-PRSA,V?TELL,V?TELL-ABOUT,V?ASK-ABOUT /?L26
	EQUAL? GL-PRSA,V?ASK-FOR,V?QUESTION,V?REPLY /?L26
	EQUAL? GL-PRSA,V?THANK,V?YELL,V?HELLO /?L26
	EQUAL? GL-PRSA,V?GOODBYE,V?SAY,V?ALARM /?L26
	EQUAL? GL-PRSA,V?PASSWORD \?L29
?L26:	ZERO? WHO \?L27
	ICALL1 RT-TALK-TO-SELF-MSG
	RETURN 2
?L27:	SET 'GL-WINNER,WHO
	ICALL2 RT-SPOKEN-TO-MSG,WHO
?L29:	EQUAL? CH-YOU,I,O \?L42
	EQUAL? GL-WINNER,CH-PLAYER \?L33
	ZERO? WHO \?L35
	ICALL1 RT-TALK-TO-SELF-MSG
	RETURN 2
?L35:	SET 'GL-WINNER,WHO
	ICALL2 RT-SPOKEN-TO-MSG,WHO
	JUMP ?L38
?L33:	SET 'GL-P-QCONTEXT-TH,GL-WINNER
	SET 'GL-P-QCONTEXT-RM,GL-PLACE-CUR
	SET 'WHO,GL-WINNER
?L38:	EQUAL? I,CH-YOU \?L39
	SET 'I,WHO
?L39:	EQUAL? O,CH-YOU \?L42
	SET 'O,WHO
?L42:	EQUAL? TH-IT,I,O \?L46
	CALL2 RT-ACCESSIBLE?,GL-P-IT-OBJECT >STACK
	ZERO? STACK \?L46
	ZERO? I \?L48
	ICALL1 RT-FAKE-ORPHAN-MSG
	RETURN 2
?L48:	ICALL2 RT-CANT-SEE-ANY-MSG,GL-P-IT-OBJECT
	RETURN 2
?L46:	EQUAL? CH-THEM,I,O \?L62
	CALL2 RT-VISIBLE?,GL-P-THEM-OBJECT >STACK
	ZERO? STACK /?L54
	EQUAL? CH-THEM,O \?L56
	SET 'O,GL-P-THEM-OBJECT
?L56:	EQUAL? CH-THEM,I \?L62
	SET 'I,GL-P-THEM-OBJECT
	JUMP ?L62
?L54:	ZERO? I \?L63
	ICALL1 RT-FAKE-ORPHAN-MSG
	RETURN 2
?L63:	ICALL2 RT-CANT-SEE-ANY-MSG,GL-P-THEM-OBJECT
	RETURN 2
?L62:	EQUAL? CH-HER,I,O \?L80
	CALL2 RT-VISIBLE?,GL-P-HER-OBJECT >STACK
	ZERO? STACK /?L69
	EQUAL? GL-P-HER-OBJECT,GL-WINNER \?L71
	CALL2 RT-NO-OTHER?,1 >STACK
	ZERO? STACK /?L71
	RETURN 2
?L71:	EQUAL? CH-HER,O \?L74
	SET 'O,GL-P-HER-OBJECT
?L74:	EQUAL? CH-HER,I \?L80
	SET 'I,GL-P-HER-OBJECT
	JUMP ?L80
?L69:	ZERO? I \?L81
	ICALL1 RT-FAKE-ORPHAN-MSG
	RETURN 2
?L81:	ICALL2 RT-CANT-SEE-ANY-MSG,GL-P-HER-OBJECT
	RETURN 2
?L80:	EQUAL? CH-HIM,I,O \?L98
	CALL2 RT-VISIBLE?,GL-P-HIM-OBJECT >STACK
	ZERO? STACK /?L87
	EQUAL? GL-P-HIM-OBJECT,GL-WINNER \?L89
	CALL1 RT-NO-OTHER? >STACK
	ZERO? STACK /?L89
	RETURN 2
?L89:	EQUAL? CH-HIM,O \?L92
	SET 'O,GL-P-HIM-OBJECT
?L92:	EQUAL? CH-HIM,I \?L98
	SET 'I,GL-P-HIM-OBJECT
	JUMP ?L98
?L87:	ZERO? I \?L99
	ICALL1 RT-FAKE-ORPHAN-MSG
	RETURN 2
?L99:	ICALL2 RT-CANT-SEE-ANY-MSG,GL-P-HIM-OBJECT
	RETURN 2
?L98:	EQUAL? O,TH-IT \?L103
	SET 'O,GL-P-IT-OBJECT
?L103:	EQUAL? I,TH-IT \?L106
	SET 'I,GL-P-IT-OBJECT
?L106:	EQUAL? A,V?TAKE \?L110
	ZERO? O /?L110
	ZERO? I \?L110
	LOC O >STACK
	ZERO? STACK /?L110
	LOC O >I
?L110:	SET 'GL-PRSA,A
	SET 'GL-PRSI,I
	SET 'GL-PRSO,O
	EQUAL? A,V?WALK /?L115
	EQUAL? TH-NOT-HERE-OBJECT,O,I \?L115
	CALL1 RT-TH-NOT-HERE-OBJECT >V
	ZERO? V /?L115
	SET 'GL-P-GOOD,0
?L115:	ICALL2 RT-THIS-IS-IT,GL-PRSI
	ICALL2 RT-THIS-IS-IT,GL-PRSO
	SET 'I,GL-PRSI
	SET 'O,GL-PRSO
	EQUAL? O,ROOMS \?L119
	SET 'O,0
?L119:	LOC GL-WINNER >W-LOC
	FSET? W-LOC,FL-VEHICLE /?L124
	FSET? W-LOC,FL-CONTAINER /?L124
	FSET? W-LOC,FL-SURFACE \?L122
?L124:	LOC W-LOC >W-ROOM
	JUMP ?L125
?L122:	SET 'W-ROOM,W-LOC
?L125:	ZERO? V \?L159
	GETP GL-WINNER,P?ACTION >STACK
	CALL2 STACK,K-M-WINNER >V
	ZERO? V \?L159
	GETP W-ROOM,P?ACTION >STACK
	CALL2 STACK,K-M-BEG >V
	ZERO? V \?L159
	GET PREACTIONS,A >STACK
	CALL1 STACK >V
	ZERO? V \?L159
	EQUAL? GL-WINNER,CH-PLAYER \?L135
	FSET? W-LOC,FL-VEHICLE /?L137
	FSET? W-LOC,FL-CONTAINER /?L137
	FSET? W-LOC,FL-SURFACE \?L135
?L137:	GETP W-LOC,P?CONTFCN >STACK
	CALL2 STACK,K-M-CANT >V
?L135:	ZERO? V \?L159
	EQUAL? A,V?WALK,V?TELL-ABOUT,V?ASK-ABOUT /?L149
	EQUAL? A,V?ASK-FOR /?L149
	ZERO? I /?L141
	LOC I >I-LOC
	ZERO? I-LOC /?L141
	FSET? I-LOC,FL-VEHICLE /?L143
	FSET? I-LOC,FL-CONTAINER /?L143
	FSET? I-LOC,FL-SURFACE /?L143
	FSET? I-LOC,FL-ALIVE \?L141
?L143:	SET 'GL-NOW-PRSI?,1
	GETP I-LOC,P?CONTFCN >STACK
	CALL2 STACK,K-M-CONT >V
?L141:	ZERO? O /?L145
	LOC O >O-LOC
	ZERO? O-LOC /?L145
	FSET? O-LOC,FL-VEHICLE /?L147
	FSET? O-LOC,FL-CONTAINER /?L147
	FSET? O-LOC,FL-SURFACE /?L147
	FSET? O-LOC,FL-ALIVE \?L145
?L147:	SET 'GL-NOW-PRSI?,0
	GETP O-LOC,P?CONTFCN >STACK
	CALL2 STACK,K-M-CONT >V
?L145:	ZERO? I /?L149
	SET 'GL-NOW-PRSI?,1
	GETP I,P?ACTION >STACK
	CALL1 STACK >V
?L149:	ZERO? V \?L159
	ZERO? O /?L153
	EQUAL? A,V?WALK /?L153
	SET 'GL-NOW-PRSI?,0
	GETP O,P?ACTION >STACK
	CALL1 STACK >V
?L153:	ZERO? V \?L159
	GET ACTIONS,A >STACK
	CALL1 STACK >V
	ZERO? V \?L159
	GETP W-LOC,P?ACTION >STACK
	CALL2 STACK,K-M-END >V
?L159:	ZERO? GL-PRSI /?L162
	FSET? GL-PRSI,FL-LOSE-IDENTITY \?L162
	PUTP GL-PRSI,P?OBJ-NOUN,0
	PUTP GL-PRSI,P?OBJ-ADJ,0
?L162:	ZERO? GL-PRSO /?L165
	FSET? GL-PRSO,FL-LOSE-IDENTITY \?L165
	PUTP GL-PRSO,P?OBJ-NOUN,0
	PUTP GL-PRSO,P?OBJ-ADJ,0
?L165:	SET 'GL-PRSA,OA
	SET 'GL-PRSO,OO
	SET 'GL-PRSI,OI
	SET 'GL-NOW-PRSI?,ONP
	RETURN V

	.FUNCT RT-SET-GL-PLACE-CUR
	LOC GL-WINNER >STACK
	FSET? STACK,FL-VEHICLE \?L1
	LOC GL-WINNER >STACK
	LOC STACK >GL-PLACE-CUR
	RETURN GL-PLACE-CUR
?L1:	LOC GL-WINNER >GL-PLACE-CUR
	RETURN GL-PLACE-CUR

	.FUNCT RT-PARSER,PTR,WRD,VAL,VERB,OF-FLAG,LEN,DIR,NW,LW,CNT,OWINNER,OMERGED,TMP1,?TMP
?L0:	SET 'PTR,K-P-LEXSTART
	SET 'VAL,0
	SET 'VERB,0
	SET 'OF-FLAG,0
	SET 'LEN,0
	SET 'DIR,0
	SET 'NW,0
	SET 'LW,0
	SET 'CNT,0
	SET 'TMP1,0
	SET 'GL-FUNNY-CLAUSE?,0
	ZERO? GL-P-ORPH \?L1
	COPYT GL-P-ITBL,GL-P-OTBL,20
?L1:	COPYT GL-P-ITBL,0,20
	SET 'GL-P-NAM,0
	SET 'GL-P-ADJ,0
	SET 'GL-P-XNAM,0
	SET 'GL-P-XADJ,0
	SET 'GL-P-DIR-WORD,0
	ZERO? GL-P-ORPH \?L4
	PUT GL-P-NAMW,0,0
	PUT GL-P-NAMW,1,0
	PUT GL-P-ADJW,0,0
	PUT GL-P-ADJW,1,0
	PUT GL-P-OFW,0,0
	PUT GL-P-OFW,1,0
?L4:	SET 'OMERGED,GL-P-MERGED
	SET 'OWINNER,GL-WINNER
	SET 'GL-P-MERGED,0
	SET 'GL-P-END-ON-PREP,0
	PUT GL-P-PRSO,K-P-MATCHLEN,0
	PUT GL-P-PRSI,K-P-MATCHLEN,0
	PUT GL-P-BUTS,K-P-MATCHLEN,0
	ZERO? GL-P-QUOT \?L7
	EQUAL? GL-WINNER,CH-PLAYER /?L7
	SET 'GL-WINNER,CH-PLAYER
	ICALL1 RT-SET-GL-PLACE-CUR
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
?L7:	ZERO? GL-RESERVE-PTR /?L10
	SET 'PTR,GL-RESERVE-PTR
	ICALL RT-STUFF,GL-P-P-LEX,GL-P-T-LEX
	COPYT GL-P-RIBUF,GL-P-PIBUF,K-P-INBUF-SIZE
	ZERO? GL-DESC-LEVEL /?L12
	EQUAL? CH-PLAYER,GL-WINNER \?L12
	CRLF
?L12:	SET 'GL-RESERVE-PTR,0
	SET 'GL-P-CONT,0
	JUMP ?L19
?L10:	ZERO? GL-P-CONT /?L15
	SET 'PTR,GL-P-CONT
	SET 'GL-P-CONT,0
	ZERO? GL-DESC-LEVEL /?L19
	EQUAL? CH-PLAYER,GL-WINNER \?L19
	CRLF
	JUMP ?L19
?L15:	SET 'GL-WINNER,CH-PLAYER
	SET 'GL-P-QUOT,0
	ICALL1 RT-SET-GL-PLACE-CUR
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
	GET 0,8 >STACK
	BTST STACK,4 \?L20
	GET 0,8 >STACK
	BAND STACK,-5 >STACK
	PUT 0,8,STACK
	ICALL1 RT-INIT-SCREEN
?L20:	ICALL1 RT-UPDATE-STATUS-LINE
	ZERO? GL-WHERE-TO-PROMPT? /?L23
	CRLF
	PRINTI """Where to, guv'nor?"""
	CRLF
?L23:	ZERO? GL-WHERE-TO-ORPH? /?L26
	SET 'GL-WINNER,CH-PLAYER
	ICALL RT-ORPHAN-VERB,W?DRIVE,ACT?DRIVE
?L26:	CRLF
	PRINTI ">"
	PUTB GL-P-P-LEX,0,59
	PUTB GL-P-PIBUF,1,0
	READ GL-P-PIBUF,GL-P-P-LEX >STACK
?L19:	GETB GL-P-P-LEX,K-P-LEXWORDS >GL-P-LEN
	GET GL-P-P-LEX,PTR >?TMP
	EQUAL? ?TMP,W?$QUOTE,W?$PERIOD,W?THEN /?L31
	EQUAL? ?TMP,W?PLEASE,W?SO \?L29
?L31:	ADD PTR,K-P-LEXELEN >PTR
	DEC 'GL-P-LEN
?L29:	GET GL-P-P-LEX,PTR >TMP1
	LESS? 1,GL-P-LEN \?L33
	GET GL-P-P-LEX,PTR >STACK
	EQUAL? STACK,W?GO \?L33
	ADD PTR,K-P-LEXELEN >STACK
	GET GL-P-P-LEX,STACK >NW
	ZERO? NW /?L33
	GETB NW,6 >STACK
	BTST STACK,64 \?L33
	ADD PTR,K-P-LEXELEN >PTR
	DEC 'GL-P-LEN
?L33:	ZERO? GL-P-LEN \?L36
	PRINTI "[What?]"
	CRLF
	RFALSE
?L36:	GET GL-P-P-LEX,PTR >STACK
	EQUAL? STACK,W?UNDO \?L39
	ICALL1 V-UNDO
	RFALSE
?L39:	ISAVE >GL-CAN-UNDO
	EQUAL? GL-CAN-UNDO,2 \?L42
	ICALL1 V-REFRESH
	SET 'SOUND-QUEUED?,0
	ZERO? SOUND-ON? /?L44
	ICALL1 CHECK-LOOPING
?L44:	PRINTI "[UNDO completed.]"
	CRLF
	JUMP ?L0
?L42:	GET GL-P-P-LEX,PTR >STACK
	EQUAL? STACK,W?OOPS,W?O \?L48
	ADD PTR,K-P-LEXELEN >STACK
	GET GL-P-P-LEX,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA \?L50
	ADD PTR,K-P-LEXELEN >PTR
	DEC 'GL-P-LEN
?L50:	GRTR? GL-P-LEN,1 /?L53
	PRINTI "[You cannot use OOPS that way.]"
	CRLF
	RFALSE
?L53:	GET GL-OOPS-TABLE,K-O-PTR >STACK
	ZERO? STACK /?L55
	GRTR? GL-P-LEN,2 \?L56
	PRINTI "[Only the first word after OOPS is used.]"
	CRLF
?L56:	ADD PTR,K-P-LEXELEN >STACK
	GET GL-P-P-LEX,STACK >STACK
	GET GL-OOPS-TABLE,K-O-PTR >STACK
	PUT GL-P-S-LEX,STACK,STACK
	SET 'GL-WINNER,OWINNER
	GET GL-OOPS-TABLE,K-O-PTR >STACK
	MUL STACK,K-P-LEXELEN >STACK
	ADD STACK,3 >STACK
	MUL PTR,K-P-LEXELEN >STACK
	ADD STACK,7 >STACK
	GETB GL-P-P-LEX,STACK >STACK
	MUL PTR,K-P-LEXELEN >STACK
	ADD STACK,6 >STACK
	GETB GL-P-P-LEX,STACK >STACK
	ICALL RT-INBUF-ADD,STACK,STACK,STACK
	ICALL RT-STUFF,GL-P-P-LEX,GL-P-S-LEX
	GETB GL-P-P-LEX,K-P-LEXWORDS >GL-P-LEN
	GET GL-OOPS-TABLE,K-O-START >PTR
	COPYT GL-OOPS-INBUF,GL-P-PIBUF,K-P-INBUF-SIZE
	JUMP ?L60
?L55:	PUT GL-OOPS-TABLE,K-O-END,0
	PRINTI "[There was no word to replace in that sentence.]"
	CRLF
	RFALSE
?L48:	PUT GL-OOPS-TABLE,K-O-END,0
?L60:	GET GL-P-P-LEX,PTR >STACK
	EQUAL? STACK,W?AGAIN,W?G \?L61
	ZERO? GL-P-ORPH \?L65
	ZERO? GL-P-GOOD /?L65
	GETB GL-OOPS-INBUF,1 >STACK
	ZERO? STACK \?L63
?L65:	PRINTI "[You cannot use AGAIN that way.]"
	CRLF
	RFALSE
?L63:	GRTR? GL-P-LEN,1 \?L66
	ADD PTR,K-P-LEXELEN >STACK
	GET GL-P-P-LEX,STACK >STACK
	EQUAL? STACK,W?$PERIOD,W?$COMMA,W?THEN /?L69
	ADD PTR,K-P-LEXELEN >STACK
	GET GL-P-P-LEX,STACK >STACK
	EQUAL? STACK,W?AND \?L67
?L69:	ADD PTR,4 >PTR
	GETB GL-P-P-LEX,K-P-LEXWORDS >STACK
	SUB STACK,2 >STACK
	PUTB GL-P-P-LEX,K-P-LEXWORDS,STACK
	JUMP ?L71
?L67:	PRINT K-DONT-UNDERSTAND-MSG
	CRLF
	RFALSE
?L66:	ADD PTR,K-P-LEXELEN >PTR
	GETB GL-P-P-LEX,K-P-LEXWORDS >STACK
	DEC 'STACK
	PUTB GL-P-P-LEX,K-P-LEXWORDS,STACK
?L71:	GETB GL-P-P-LEX,K-P-LEXWORDS >STACK
	GRTR? STACK,0 \?L72
	ICALL RT-STUFF,GL-P-T-LEX,GL-P-P-LEX
	COPYT GL-P-PIBUF,GL-P-RIBUF,K-P-INBUF-SIZE
	SET 'GL-RESERVE-PTR,PTR
	JUMP ?L74
?L72:	SET 'GL-RESERVE-PTR,0
?L74:	CALL2 RT-VISIBLE?,OWINNER >STACK
	ZERO? STACK /?L75
	SET 'GL-WINNER,OWINNER
	JUMP ?L77
?L75:	ICALL2 RT-CTHEO-PRINT,OWINNER
	ICALL2 RT-ISNT-ARENT-MSG,OWINNER
	PRINTI "here anymore."
	CRLF
	RFALSE
?L77:	SET 'GL-P-MERGED,OMERGED
	COPYT GL-OOPS-INBUF,GL-P-PIBUF,K-P-INBUF-SIZE
	ICALL RT-STUFF,GL-P-P-LEX,GL-P-S-LEX
	SET 'CNT,-1
	SET 'DIR,GL-AGAIN-DIR
	COPYT GL-P-OTBL,GL-P-ITBL,20
	JUMP ?L83
?L61:	ZERO? GL-P-ORPH \?L79
	SET 'GL-P-NUMBER,-1
?L79:	ICALL RT-STUFF,GL-P-S-LEX,GL-P-P-LEX
	COPYT GL-P-PIBUF,GL-OOPS-INBUF,K-P-INBUF-SIZE
	PUT GL-OOPS-TABLE,K-O-START,PTR
	MUL 4,GL-P-LEN >STACK
	PUT GL-OOPS-TABLE,K-O-LENGTH,STACK
	GETB GL-P-P-LEX,K-P-LEXWORDS >STACK
	MUL K-P-LEXELEN,STACK >STACK
	ADD PTR,STACK >STACK
	MUL 2,STACK >LEN
	SUB LEN,2 >STACK
	GETB GL-P-P-LEX,STACK >STACK
	SUB LEN,1 >STACK
	GETB GL-P-P-LEX,STACK >STACK
	ADD STACK,STACK >STACK
	PUT GL-OOPS-TABLE,K-O-END,STACK
	SET 'GL-RESERVE-PTR,0
	SET 'LEN,GL-P-LEN
	SET 'GL-P-DIR,0
	SET 'GL-P-NCN,0
	SET 'GL-P-GET-FLAGS,0
	PUT GL-P-ITBL,K-P-VERBN,0
?L82:	DLESS? 'GL-P-LEN,0 \?L84
	SET 'GL-P-QUOT,0
	JUMP ?L83
?L84:	GET GL-P-P-LEX,PTR >WRD
	ZERO? WRD \?L87
	CALL2 RT-NUMBER?,PTR >WRD
	ZERO? WRD /?L86
?L87:	ZERO? GL-P-LEN \?L88
	SET 'NW,0
	JUMP ?L90
?L88:	ADD PTR,K-P-LEXELEN >STACK
	GET GL-P-P-LEX,STACK >NW
?L90:	EQUAL? WRD,W?TO \?L91
	EQUAL? VERB,ACT?TELL,ACT?ASK \?L91
	PUT GL-P-ITBL,K-P-VERB,ACT?TELL
	SET 'WRD,W?$QUOTE
	JUMP ?L94
?L91:	EQUAL? WRD,W?THEN \?L93
	GRTR? GL-P-LEN,0 \?L93
	ZERO? VERB \?L93
	ZERO? GL-P-QUOT \?L93
	PUT GL-P-ITBL,K-P-VERB,ACT?TELL
	PUT GL-P-ITBL,K-P-VERBN,0
	SET 'WRD,W?$QUOTE
	SET 'GL-P-ORPH,0
	JUMP ?L94
?L93:	EQUAL? WRD,W?$PERIOD \?L94
	EQUAL? LW,W?MR,W?MRS,W?MISS /?L95
	EQUAL? LW,W?DR \?L94
?L95:	DEC 'GL-P-NCN
	ICALL RT-CHANGE-LEXV,PTR,LW,1
	SET 'WRD,LW
	SET 'LW,0
?L94:	EQUAL? WRD,W?THEN,W?$PERIOD,W?$QUOTE \?L97
	EQUAL? WRD,W?$QUOTE \?L103
	ZERO? GL-P-QUOT /?L101
	SET 'GL-P-QUOT,0
	JUMP ?L103
?L101:	SET 'GL-P-QUOT,1
?L103:	ZERO? GL-P-LEN /?L105
	ADD PTR,K-P-LEXELEN >GL-P-CONT
?L105:	PUTB GL-P-P-LEX,K-P-LEXWORDS,GL-P-LEN
	JUMP ?L83
?L97:	CALL RT-WT?,WRD,16,3 >VAL
	ZERO? VAL /?L107
	EQUAL? VERB,0,ACT?WALK,ACT?GO \?L107
	EQUAL? LEN,1 /?L108
	EQUAL? LEN,2 \?L109
	EQUAL? VERB,ACT?WALK,ACT?GO /?L108
?L109:	EQUAL? NW,W?THEN,W?$PERIOD,W?$QUOTE \?L110
	GRTR? LEN,1 /?L108
?L110:	ZERO? GL-P-QUOT /?L111
	EQUAL? LEN,2 \?L111
	EQUAL? NW,W?$QUOTE /?L108
?L111:	GRTR? LEN,2 \?L107
	EQUAL? NW,W?$COMMA,W?AND \?L107
?L108:	SET 'DIR,VAL
	SET 'GL-P-DIR-WORD,WRD
	EQUAL? NW,W?$COMMA,W?AND \?L112
	ADD PTR,K-P-LEXELEN >STACK
	ICALL RT-CHANGE-LEXV,STACK,W?THEN
?L112:	GRTR? LEN,2 /?L144
	SET 'GL-P-QUOT,0
	JUMP ?L83
?L107:	CALL RT-WT?,WRD,64,1 >VAL
	ZERO? VAL /?L118
	ZERO? VERB \?L118
	SET 'GL-P-PRSA-WORD,WRD
	SET 'VERB,VAL
	PUT GL-P-ITBL,K-P-VERB,VAL
	PUT GL-P-ITBL,K-P-VERBN,GL-P-VTBL
	PUT GL-P-VTBL,0,WRD
	MUL PTR,2 >STACK
	ADD STACK,2 >TMP1
	GETB GL-P-P-LEX,TMP1 >STACK
	PUTB GL-P-VTBL,2,STACK
	ADD TMP1,1 >STACK
	GETB GL-P-P-LEX,STACK >STACK
	PUTB GL-P-VTBL,3,STACK
	JUMP ?L144
?L118:	CALL RT-WT?,WRD,8,0 >VAL
	ZERO? VAL \?L120
	EQUAL? WRD,W?A,W?EVERYTHING,W?BOTH /?L120
	EQUAL? WRD,W?ALL /?L120
	GETB WRD,6 >STACK
	BAND STACK,160 >STACK
	ZERO? STACK /?L119
?L120:	GRTR? GL-P-LEN,1 \?L121
	EQUAL? NW,W?OF \?L121
	EQUAL? VERB,ACT?TAKE /?L121
	ZERO? VAL \?L163
	EQUAL? WRD,W?A,W?ALL,W?BOTH /?L121
	EQUAL? WRD,W?EVERYTHING /?L121
	PUT GL-P-OFW,GL-P-NCN,WRD
	SET 'OF-FLAG,1
	JUMP ?L144
?L121:	ZERO? VAL /?L123
?L163:	ZERO? GL-P-LEN /?L124
	EQUAL? NW,W?THEN,W?$PERIOD \?L123
?L124:	SET 'GL-P-END-ON-PREP,1
	LESS? GL-P-NCN,2 \?L144
	PUT GL-P-ITBL,K-P-PREP1,VAL
	PUT GL-P-ITBL,K-P-PREP1N,WRD
	JUMP ?L144
?L123:	EQUAL? GL-P-NCN,2 \?L128
	PRINTI "[There are too many nouns in that sentence.]"
	CRLF
	RFALSE
?L128:	INC 'GL-P-NCN
	CALL RT-CLAUSE,PTR,VAL,WRD >PTR
	ZERO? PTR /FALSE
	LESS? PTR,0 \?L144
	SET 'GL-P-QUOT,0
	JUMP ?L83
?L119:	EQUAL? WRD,W?OF \?L135
	ZERO? OF-FLAG /?L138
	EQUAL? NW,W?$PERIOD,W?THEN \?L136
?L138:	ICALL2 RT-DONT-KNOW-WORD-USE-MSG,PTR
	RFALSE
?L136:	SET 'OF-FLAG,0
	JUMP ?L144
?L135:	GETB WRD,6 >STACK
	BTST STACK,4 /?L144
	EQUAL? WRD,W?MARX /?L144
	EQUAL? VERB,ACT?TELL \?L142
	GETB WRD,6 >STACK
	BTST STACK,64 \?L142
	ICALL1 RT-WAY-TO-TALK-MSG
	RFALSE
?L142:	ICALL2 RT-DONT-KNOW-WORD-USE-MSG,PTR
	RFALSE
?L86:	ICALL2 RT-DONT-KNOW-WORD-MSG,PTR
	RFALSE
?L144:	SET 'LW,WRD
	ADD PTR,K-P-LEXELEN >PTR
	JUMP ?L82
?L83:	PUT GL-OOPS-TABLE,K-O-PTR,0
	ZERO? DIR /?L145
	SET 'GL-PRSA,V?WALK
	SET 'GL-P-WALK-DIR,DIR
	SET 'GL-AGAIN-DIR,DIR
	SET 'GL-PRSO,DIR
	SET 'GL-P-ORPH,0
	RTRUE
?L145:	SET 'GL-P-WALK-DIR,0
	SET 'GL-AGAIN-DIR,0
	ZERO? GL-P-ORPH /?L148
	CALL1 RT-ORPHAN-MERGE >STACK
	ZERO? STACK /?L148
	ZERO? GL-WHERE-TO-ORPH? \?L148
	SET 'GL-WINNER,OWINNER
?L148:	CALL1 RT-SYNTAX-CHECK >STACK
	ZERO? STACK /FALSE
	CALL1 RT-SNARF-OBJECTS >STACK
	ZERO? STACK /FALSE
	CALL1 RT-MANY-CHECK >STACK
	ZERO? STACK /FALSE
	GETB GL-P-SYNTAX,0 >STACK
	SHIFT STACK,-6 >TMP1
	GRTR? TMP1,0 \TRUE
	GETB GL-P-SYNTAX,K-P-SLOC1 >STACK
	CALL RT-ITAKE-CHECK,GL-P-PRSO,STACK,1 >STACK
	ZERO? STACK /FALSE
	GRTR? TMP1,1 \TRUE
	GETB GL-P-SYNTAX,K-P-SLOC2 >STACK
	CALL RT-ITAKE-CHECK,GL-P-PRSI,STACK >STACK
	RSTACK

	.FUNCT RT-WHICH-PRINT,TLEN,LEN,TBL,OBJ,RLEN
	SET 'RLEN,LEN
	PRINTI "Which"
	ZERO? GL-P-ORPH \?L3
	ZERO? GL-P-MERGED \?L3
	ZERO? GL-P-AND /?L1
?L3:	PRINTI " "
	PRINTB GL-P-NAM
	JUMP ?L5
?L1:	EQUAL? TBL,GL-P-PRSO \?L4
	ICALL RT-CLAUSE-PRINT,K-P-NC1,K-P-NC1L,0
	JUMP ?L5
?L4:	ICALL RT-CLAUSE-PRINT,K-P-NC2,K-P-NC2L,0
?L5:	PRINTI " do you mean,"
?L6:	INC 'TLEN
	GET TBL,TLEN >OBJ
	PRINTI " "
	ICALL2 RT-THEO-PRINT,OBJ
	EQUAL? LEN,2 \?L8
	EQUAL? RLEN,2 /?L10
	PRINTI ","
?L10:	PRINTI " or"
	JUMP ?L13
?L8:	GRTR? LEN,2 \?L13
	PRINTI ","
?L13:	DLESS? 'LEN,1 \?L6
	PRINTR "?"

	.FUNCT RT-FIND-NOT-HERE,TBL,PRSO?,M-F,OBJ
	CALL2 RT-MOBY-FIND,TBL >M-F
	ZERO? M-F \?L1
	PRINTI "[There is no"
	ICALL2 RT-NOT-HERE-PRINT,PRSO?
	PRINTR " in this story.]"
?L1:	EQUAL? M-F,1 \?L3
	ZERO? PRSO? /?L4
	SET 'GL-PRSO,GL-P-MOBY-FOUND
	RFALSE
?L4:	SET 'GL-PRSI,GL-P-MOBY-FOUND
	RFALSE
?L3:	GRTR? M-F,1 \?L7
	GET TBL,1 >OBJ
	GETP OBJ,P?GENERIC >STACK
	CALL2 STACK,TBL >OBJ
	ZERO? OBJ /?L7
	EQUAL? OBJ,TH-NOT-HERE-OBJECT /TRUE
	ZERO? PRSO? /?L10
	SET 'GL-PRSO,OBJ
	RFALSE
?L10:	SET 'GL-PRSI,OBJ
	RFALSE
?L7:	EQUAL? GL-PRSA,V?ASK-ABOUT,V?TELL-ABOUT,V?ASK-FOR /FALSE
	EQUAL? GL-PRSA,V?SAY,V?DRIVE,V?CALL /FALSE
	EQUAL? GL-PRSA,V?MAKE,V?WHO,V?WHAT /FALSE
	EQUAL? GL-PRSA,V?WHERE,V?FIND,V?FOLLOW /FALSE
	EQUAL? GL-PRSA,V?TELL,V?PASSWORD /FALSE
	ZERO? PRSO? \?L14
	ICALL1 RT-CYOU-MSG
	PRINTI "would not find any"
	ICALL2 RT-NOT-HERE-PRINT,PRSO?
	PRINTR " there."
?L14:	RETURN TH-NOT-HERE-OBJECT

	.FUNCT RT-NOT-HERE-PRINT,PRSO?
	ASSIGNED? 'PRSO? /?L12
	SET 'PRSO?,0
?L12:	ZERO? GL-P-ORPH \?L3
	ZERO? GL-P-MERGED /?L1
?L3:	ZERO? GL-P-XADJ /?L4
	PRINTC 32
	PRINTB GL-P-XADJ
?L4:	ZERO? GL-P-XNAM /FALSE
	PRINTC 32
	PRINTB GL-P-XNAM
	RTRUE
?L1:	ZERO? PRSO? /?L10
	GET GL-P-ITBL,K-P-NC1L >STACK
	GET GL-P-ITBL,K-P-NC1 >STACK
	CALL RT-BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK
?L10:	GET GL-P-ITBL,K-P-NC2L >STACK
	GET GL-P-ITBL,K-P-NC2 >STACK
	CALL RT-BUFFER-PRINT,STACK,STACK,0 >STACK
	RSTACK

	.FUNCT SET-SIZE-TO-ONE,OBJ,NUM
	GETP OBJ,P?SIZE >NUM
	DIV NUM,SIZE-VALS >STACK
	MUL STACK,SIZE-VALS >STACK
	INC 'STACK
	PUTP OBJ,P?SIZE,STACK
	RTRUE

	.FUNCT GET-SIZE,OBJ,NUM
	GETP OBJ,P?SIZE >NUM
	MOD NUM,SIZE-VALS >NUM
	LESS? NUM,6 \?L1
	RETURN NUM
?L1:	SUB NUM,6 >STACK
	GETB SIZE-TABLE,STACK >STACK
	RSTACK

	.FUNCT SET-MASS-TO-ONE,OBJ,NUM
	GETP OBJ,P?SIZE >NUM
	DIV NUM,143 >STACK
	MUL STACK,143 >STACK
	MOD NUM,SIZE-VALS >STACK
	ADD SIZE-VALS,STACK >STACK
	ADD STACK,STACK >STACK
	PUTP OBJ,P?SIZE,STACK
	RTRUE

	.FUNCT GET-MASS,OBJ,NUM
	GETP OBJ,P?SIZE >NUM
	DIV NUM,SIZE-VALS >STACK
	MOD STACK,MASS-VALS >NUM
	LESS? NUM,6 \?L1
	RETURN NUM
?L1:	SUB NUM,6 >STACK
	GETB MASS-TABLE,STACK >STACK
	RSTACK

	.FUNCT GET-CAPACITY,OBJ,NUM
	GETP OBJ,P?SIZE >NUM
	DIV NUM,143 >NUM
	GRTR? NUM,100 \?L1
	RETURN 999
?L1:	RETURN NUM

	.FUNCT SET-CAPACITY-TO-ONE,OBJ,NUM
	GETP OBJ,P?SIZE >NUM
	MOD NUM,143 >STACK
	ADD 143,STACK >STACK
	PUTP OBJ,P?SIZE,STACK
	RTRUE

	.FUNCT RT-SEE-ANYTHING-IN?,THING,OBJ
	FIRST? THING >OBJ \FALSE
?L4:	FSET? OBJ,FL-NODESC /?L6
	EQUAL? OBJ,GL-WINNER \TRUE
?L6:	NEXT? OBJ >OBJ /?L4
	RFALSE

	.FUNCT RT-CANT-TOUCH-MSG,OBJ,CLSD,IN-OUT
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL2 RT-THEO-PRINT,OBJ
	ZERO? CLSD /?L1
	PRINTI " because "
	FSET? OBJ,FL-PLURAL \?L3
	FSET? OBJ,FL-COLLECTIVE /?L3
	PRINTI "they are"
	JUMP ?L5
?L3:	PRINTI "it is"
?L5:	PRINTI " "
	ZERO? IN-OUT /?L6
	PRINTI "inside"
	JUMP ?L8
?L6:	PRINTI "outside"
?L8:	PRINTI " "
	ICALL2 RT-THEO-PRINT,CLSD
	PRINTI ", which is closed"
?L1:	PRINTR "."

	.FUNCT RT-TOTAL-SIZE-IN-OBJ,OBJ1,OBJ,TOTSIZ
	SET 'TOTSIZ,0
	FIRST? OBJ1 >OBJ /?L4
	RETURN TOTSIZ
?L4:	CALL2 GET-SIZE,OBJ >STACK
	ADD TOTSIZ,STACK >TOTSIZ
	NEXT? OBJ >OBJ /?L4
	RETURN TOTSIZ

	.FUNCT RT-TOTAL-MASS-OF-OBJ,OBJ1,OBJ,TOTMAS
	SET 'TOTMAS,0
	FIRST? OBJ1 >OBJ \?L3
?L4:	CALL2 RT-TOTAL-MASS-OF-OBJ,OBJ >STACK
	ADD TOTMAS,STACK >TOTMAS
	NEXT? OBJ >OBJ /?L4
?L3:	CALL2 GET-MASS,OBJ1 >STACK
	ADD TOTMAS,STACK >TOTMAS
	RETURN TOTMAS

	.FUNCT RT-TOTAL-COUNT-IN-OBJ,OBJ1,OBJ,TOTCNT
	SET 'TOTCNT,0
	FIRST? OBJ1 >OBJ /?L4
	RETURN TOTCNT
?L4:	FSET? OBJ,FL-WORN \?L6
	IN? OBJ,CH-PLAYER /?L8
?L6:	FSET? OBJ,FL-BODYPART /?L8
	INC 'TOTCNT
?L8:	NEXT? OBJ >OBJ /?L4
	RETURN TOTCNT

	.FUNCT RT-OBJ-TOO-LARGE?,OBJ1,OBJ2,?TMP
	CALL2 GET-SIZE,OBJ1 >?TMP
	CALL2 RT-TOTAL-SIZE-IN-OBJ,OBJ2 >STACK
	ADD ?TMP,STACK >?TMP
	CALL2 GET-CAPACITY,OBJ2 >STACK
	GRTR? ?TMP,STACK \FALSE
	RTRUE

	.FUNCT RT-OBJ-TOO-HEAVY?,OBJ1,OBJ2,?TMP
	CALL2 RT-TOTAL-MASS-OF-OBJ,OBJ1 >?TMP
	CALL2 RT-TOTAL-MASS-OF-OBJ,OBJ2 >STACK
	ADD ?TMP,STACK >?TMP
	GETP OBJ2,P?STRENGTH >STACK
	GRTR? ?TMP,STACK \FALSE
	RTRUE

	.FUNCT RT-OBJ-TOO-MANY?,OBJ1,OBJ2,?TMP
	CALL2 RT-TOTAL-COUNT-IN-OBJ,OBJ2 >STACK
	INC 'STACK
	POP '?TMP
	GETP OBJ2,P?DEXTERITY >STACK
	GRTR? ?TMP,STACK \FALSE
	RTRUE

	.FUNCT RT-REMOVE-ALL,OBJ1,OBJ,NXT,CNT
	SET 'CNT,0
	FIRST? OBJ1 >OBJ /?L4
	RETURN CNT
?L1:	ZERO? OBJ /?L3
?L4:	NEXT? OBJ >NXT /?L7
?L7:	REMOVE OBJ
	INC 'CNT
	SET 'OBJ,NXT
	JUMP ?L1
?L3:	RETURN CNT

	.FUNCT RT-MOVE-ALL-BUT-WORN,OBJ1,OBJ2,OBJ,NXT,CNT
	SET 'CNT,0
	FIRST? OBJ1 >OBJ /?L4
	RETURN CNT
?L1:	ZERO? OBJ /?L3
?L4:	NEXT? OBJ >NXT /?L7
?L7:	FSET? OBJ,FL-WORN /?L8
	EQUAL? OBJ,TH-POCKET /?L8
	MOVE OBJ,OBJ2
	INC 'CNT
?L8:	SET 'OBJ,NXT
	JUMP ?L1
?L3:	RETURN CNT

	.FUNCT RT-MOVE-NODESC-OBJS,OBJ1,OBJ2,OBJ,NXT,CNT
	SET 'CNT,0
	FIRST? OBJ1 >OBJ /?L4
	RETURN CNT
?L1:	ZERO? OBJ /?L3
?L4:	NEXT? OBJ >NXT /?L7
?L7:	FSET? OBJ,FL-NODESC \?L8
	MOVE OBJ,OBJ2
	INC 'CNT
?L8:	SET 'OBJ,NXT
	JUMP ?L1
?L3:	RETURN CNT

	.FUNCT RT-FIND-IN?,OBJ1,FLG,OBJ
	FIRST? OBJ1 >OBJ \FALSE
?L4:	FSET? OBJ,FLG \?L6
	RETURN OBJ
?L6:	NEXT? OBJ >OBJ /?L4
	RFALSE

	.FUNCT RT-GET-ANY-KEY,X
	PRINTI "[Press any key.]"
	CRLF
	INPUT 1 >X
	RTRUE

	.FUNCT RT-GET-YES-NO?,WORD
?L1:	CRLF
	PRINTI "Please type YES or NO > "
	PUTB GL-YES-LEXV,0,4
	PUTB GL-YES-IBUF,1,0
	READ GL-YES-IBUF,GL-YES-LEXV >STACK
	GET GL-YES-LEXV,K-P-LEXSTART >WORD
	GETB GL-YES-LEXV,K-P-LEXWORDS >STACK
	ZERO? STACK /?L1
	ZERO? WORD /?L1
	EQUAL? WORD,W?Y,W?YES /TRUE
	EQUAL? WORD,W?N,W?NO \?L1
	RFALSE

	.FUNCT RT-INIT-SCREEN,FAST?
	ASSIGNED? 'FAST? /?L4
	SET 'FAST?,0
?L4:	ZERO? FAST? /?L1
	SPLIT GL-SPLIT-ROW
	CLEAR 1
	JUMP ?L3
?L1:	CLEAR -1
	SPLIT GL-SPLIT-ROW
?L3:	SCREEN K-S-WIN
	HLIGHT K-H-INV
	CURSET GL-SPLIT-ROW,1
	SET 'GL-PLACE-STS,-1
	SET 'GL-MOVES-STS,-1
	SET 'GL-SCORE-STS,-1
	CURSET GL-SPLIT-ROW,GL-STAT-S-POS
	HLIGHT K-H-NRM
	SCREEN K-S-NOR
	RTRUE

	.FUNCT RT-GAMETITLE-MSG
	PRINTR "Sherlock: The Riddle of the Crown Jewels"

	.FUNCT RT-COPYRIGHT-MSG
	PRINTR "Copyright 1987 Infocom, Inc."

	.FUNCT RT-TRADEMARK-MSG
	PRINTR "Sherlock: The Riddle of the Crown Jewels is a trademark of Infocom, Inc."

	.FUNCT RT-ID-MSG,?TMP
	PRINTI "Release "
	GET 0,1 >STACK
	BAND STACK,2047 >STACK
	PRINTN STACK
	PRINTI " Interpreter "
	GETB 0,30 >STACK
	PRINTN STACK
	PRINTI " Version "
	GETB 0,31 >STACK
	PRINTC STACK
	PRINTI " Serial Number "
	SET '?TMP,18
?L1:	GETB 0,?TMP >STACK
	PRINTC STACK
	IGRTR? '?TMP,23 \?L1
	CRLF
	RTRUE

	.FUNCT RT-VERSION-MSG
	HLIGHT K-H-BLD
	ICALL1 RT-GAMETITLE-MSG
	ICALL1 RT-COPYRIGHT-MSG
	ICALL1 RT-TRADEMARK-MSG
	ICALL1 RT-ID-MSG
	HLIGHT K-H-NRM
	RTRUE

	.FUNCT RT-DESC-PL-CONT-1,SURFACE,CNT,OBJ,NXT,FIRST,PERSON-COUNT,PERSON-PLURAL
	SET 'PERSON-COUNT,0
	SET 'PERSON-PLURAL,0
	FIRST? SURFACE >OBJ /?L1
?L1:	SET 'FIRST,1
?L2:	ZERO? OBJ /?L3
?L4:	FSET? OBJ,FL-NODESC /?L7
	EQUAL? OBJ,GL-PUPPY \?L6
?L7:	NEXT? OBJ >OBJ /?L4
	JUMP ?L3
?L6:	FSET? OBJ,FL-PERSON \?L9
	INC 'PERSON-COUNT
	NEXT? OBJ >OBJ /?L4
	JUMP ?L3
?L9:	ZERO? FIRST /?L11
	GRTR? CNT,0 \?L12
	PRINTI " "
	JUMP ?L14
?L12:	CRLF
?L14:	PRINTI "You see "
	SET 'FIRST,0
?L11:	ICALL2 RT-A-PRINT,OBJ
	INC 'CNT
	NEXT? OBJ >OBJ \?L26
?L19:	EQUAL? OBJ,GL-PUPPY /?L24
	FSET? OBJ,FL-NODESC /?L24
	FSET? OBJ,FL-PERSON \?L18
	FSET? OBJ,FL-NODESC /?L18
	INC 'PERSON-COUNT
?L24:	NEXT? OBJ >OBJ /?L19
?L18:	ZERO? OBJ /?L26
	NEXT? OBJ >NXT \?L88
?L31:	FSET? NXT,FL-NODESC /?L33
	EQUAL? NXT,GL-PUPPY /?L33
	FSET? NXT,FL-PERSON \?L30
?L33:	NEXT? NXT >NXT /?L31
?L30:	ZERO? NXT \?L36
?L88:	PRINTI " and "
	JUMP ?L2
?L36:	PRINTI ", "
	JUMP ?L2
?L26:	IN? SURFACE,ROOMS /?L40
	PRINTI " on "
	ICALL2 RT-THEO-PRINT,SURFACE
?L40:	PRINTI "."
	JUMP ?L2
?L3:	GRTR? PERSON-COUNT,0 \?L53
	GRTR? CNT,0 \?L45
	PRINTI " "
	JUMP ?L47
?L45:	CRLF
?L47:	ADD CNT,PERSON-COUNT >CNT
	GRTR? PERSON-COUNT,1 \?L48
	SET 'PERSON-PLURAL,1
?L48:	FIRST? SURFACE >OBJ /?L51
?L51:	SET 'FIRST,1
?L52:	FSET? OBJ,FL-NODESC /?L70
	EQUAL? OBJ,GL-PUPPY /?L70
	FSET? OBJ,FL-PERSON \?L70
	ZERO? FIRST /?L58
	ICALL RT-THEO-PRINT,OBJ,1,K-DESC-A
	JUMP ?L60
?L58:	ICALL2 RT-A-PRINT,OBJ
?L60:	SET 'FIRST,0
	FSET? OBJ,FL-PLURAL \?L61
	SET 'PERSON-PLURAL,1
?L61:	DEC 'PERSON-COUNT
	ZERO? PERSON-COUNT \?L64
	ZERO? PERSON-PLURAL /?L66
	PRINTI " are"
	JUMP ?L68
?L66:	PRINTI " is"
?L68:	PRINTI " here."
	JUMP ?L53
?L64:	EQUAL? PERSON-COUNT,1 \?L69
	PRINTI " and "
	JUMP ?L70
?L69:	PRINTI ", "
?L70:	NEXT? OBJ >OBJ /?L52
	JUMP ?L52
?L53:	FIRST? SURFACE >OBJ /?L77
	RETURN CNT
?L77:	FSET? OBJ,FL-SURFACE \?L79
	CALL RT-DESC-PL-CONT-1,OBJ,CNT >CNT
?L79:	NEXT? OBJ >OBJ /?L77
	RETURN CNT

	.FUNCT RT-DESCRIBE-PLACE-CONTENTS,PLACE,LOOK,OBJ,PREV,CNT,LIGHT
	ASSIGNED? 'PLACE /?L7
	SET 'PLACE,0
?L7:	ASSIGNED? 'LOOK /?L8
	SET 'LOOK,0
?L8:	SET 'CNT,0
	ZERO? PLACE \?L1
	SET 'PLACE,GL-PLACE-CUR
?L1:	CALL RT-DESC-PL-CONT-1,PLACE,0 >STACK
	ZERO? STACK /TRUE
	CRLF
	RTRUE

	.FUNCT RT-RANK-STR,PTS
	LESS? PTS,1 \?L1
	RETURN STR?112
?L1:	LESS? PTS,21 \?L3
	RETURN STR?113
?L3:	LESS? PTS,41 \?L4
	RETURN STR?114
?L4:	LESS? PTS,61 \?L5
	RETURN STR?115
?L5:	LESS? PTS,81 \?L6
	RETURN STR?116
?L6:	LESS? PTS,91 \?L7
	RETURN STR?117
?L7:	LESS? PTS,100 \?L8
	RETURN STR?118
?L8:	RETURN STR?119

	.FUNCT RT-NEW-SCORE-MSG,PTS
	ZERO? PTS /FALSE
	HLIGHT K-H-BLD
	ZERO? GL-SCORE-MSG /?L4
	CRLF
	PRINTI "[Your score just went up by "
	PRINTN PTS
	PRINTI " point"
	GRTR? PTS,1 \?L6
	PRINTI "s"
?L6:	PRINTI ". The total is now "
	PRINTN GL-SCORE-CUR
	PRINTI " out of "
	PRINTN GL-SCORE-MAX
	PRINTI ".]"
	CRLF
?L4:	HLIGHT K-H-NRM
	RTRUE

	.FUNCT RT-PARSE-EVENT?,NOUN,ADJ,OBJ,N,TB,NTB,ATB,FLGS,?TMP
	SET 'OBJ,TH-EVENT
	GET TH-EVENT-NAMES,0 >STACK
	DIV STACK,EN-ENTLEN >N
	SET 'TB,TH-EVENT-NAMES+2
?L1:	GET TB,0 >NTB
	ADD NTB,2 >?TMP
	GET NTB,0 >STACK
	INTBL? NOUN,?TMP,STACK >STACK \?L17
	ZERO? ADJ /?L7
	GET TB,1 >ATB
	ZERO? ATB /FALSE
	GET ATB,0 >STACK
	ADD ATB,2 >STACK
	INTBL? ADJ,STACK,STACK >STACK \FALSE
?L7:	GET NTB,1 >STACK
	PUTP OBJ,P?OBJ-NOUN,STACK
	GET TB,3 >FLGS
	BTST FLGS,EN-ALIVE \?L8
	FSET OBJ,FL-ALIVE
	JUMP ?L10
?L8:	FCLEAR OBJ,FL-ALIVE
?L10:	BTST FLGS,EN-PERSON \?L11
	FSET OBJ,FL-PERSON
	JUMP ?L13
?L11:	FCLEAR OBJ,FL-PERSON
?L13:	BTST FLGS,EN-VOWEL \?L14
	FSET OBJ,FL-VOWEL
	RETURN OBJ
?L14:	FCLEAR OBJ,FL-VOWEL
	RETURN OBJ
?L17:	DLESS? 'N,1 /FALSE
	ADD TB,8 >TB
	JUMP ?L1

	.FUNCT RT-IDENTIFY-EVENT?,WD,OBJ,NAM,N,TB,NTB
	ASSIGNED? 'OBJ /?L15
	SET 'OBJ,0
?L15:	GETP TH-EVENT,P?OBJ-NOUN >NAM
	EQUAL? OBJ,0,TH-EVENT \FALSE
	GET TH-EVENT-NAMES,0 >STACK
	DIV STACK,EN-ENTLEN >N
	SET 'TB,TH-EVENT-NAMES+2
?L4:	GET TB,0 >NTB
	GET NTB,1 >STACK
	EQUAL? WD,STACK \?L10
	GET NTB,0 >STACK
	ADD NTB,2 >STACK
	INTBL? NAM,STACK,STACK >STACK \FALSE
	RTRUE
?L10:	DLESS? 'N,1 /FALSE
	ADD TB,8 >TB
	JUMP ?L4

	.FUNCT RT-DESC-EVENT,CLASS,WD,FLAGS,N,TB
	ASSIGNED? 'CLASS /?L24
	SET 'CLASS,0
?L24:	GETP TH-EVENT,P?OBJ-NOUN >WD
	GET TH-EVENT-NAMES,0 >STACK
	DIV STACK,EN-ENTLEN >N
	SET 'TB,TH-EVENT-NAMES+2
?L1:	GET TB,0 >STACK
	GET STACK,1 >STACK
	EQUAL? WD,STACK \?L3
	GET TB,3 >FLAGS
	GET TB,2 >STACK
	ZERO? STACK /?L5
	FSET? TH-EVENT,FL-VOWEL /?L7
	PUSH 0
	JUMP ?L8
?L7:	PUSH 1
?L8:	FSET? TH-EVENT,FL-PLURAL /?L9
	PUSH 0
	JUMP ?L10
?L9:	PUSH 1
?L10:	BAND FLAGS,EN-NOARTC >STACK
	ZERO? STACK /?L11
	PUSH 1
	JUMP ?L12
?L11:	PUSH 0
?L12:	GET TB,2 >STACK
	IXCALL PRINT-SDESC,STACK,CLASS,STACK,STACK,STACK
	RTRUE
?L5:	FSET? TH-EVENT,FL-VOWEL /?L14
	PUSH 0
	JUMP ?L15
?L14:	PUSH 1
?L15:	FSET? TH-EVENT,FL-PLURAL /?L16
	PUSH 0
	JUMP ?L17
?L16:	PUSH 1
?L17:	BAND FLAGS,EN-NOARTC >STACK
	ZERO? STACK /?L18
	PUSH 1
	JUMP ?L19
?L18:	PUSH 0
?L19:	IXCALL PRINT-SDESC,WD,CLASS,STACK,STACK,STACK,1
	RTRUE
?L3:	DLESS? 'N,1 /FALSE
	ADD TB,8 >TB
	JUMP ?L1

	.FUNCT RT-AC-TH-EVENT,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	ASSIGNED? 'CLASS /?L6
	SET 'CLASS,0
?L6:	EQUAL? CONTEXT,K-M-SDESC \?L1
	CALL2 RT-DESC-EVENT,CLASS >STACK
	RSTACK
?L1:	CALL1 RT-TALK-VERB? >STACK
	ZERO? STACK \FALSE
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT RT-TO-DO-THING-USE-MSG,STR1,STR2
	PRINTI "[To "
	PRINT STR1
	PRINTI " something, use the command: "
	PRINT STR2
	PRINTR " THING.]"

	.FUNCT RT-NOT-IN-SENTENCE-MSG,STR
	PRINTI "[There are not "
	PRINT STR
	PRINTR " in that sentence.]"

	.FUNCT RT-IMPOSSIBLE-MSG,WHO
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES,CH-WIGGINS \?L1
	EQUAL? WHO,CH-HOLMES \?L3
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	PRINTI " looks at you "
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESPAIR-TXT >STACK
	PRINT STACK
	PRINTI " and says, """
	CALL2 RT-PICK-NEXT,GL-HOLMES-IMPOSSIBLE-TXT >STACK
	PRINT STACK
	JUMP ?L5
?L3:	EQUAL? WHO,CH-WIGGINS \?L5
	CALL2 RT-PICK-NEXT,GL-WIGGINS-DESC-TXT >STACK
	PRINT STACK
	PRINTI " says, """
	CALL2 RT-PICK-NEXT,GL-WIGGINS-IMPOSSIBLE-TXT >STACK
	PRINT STACK
?L5:	PRINTR "."""
?L1:	CALL2 RT-PICK-NEXT,GL-IMPOSSIBLE-TXT >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT RT-NOT-LIKELY-MSG,THING,STR
	PRINTI "It"
	CALL2 RT-PICK-NEXT,GL-NOT-LIKELY-TXT >STACK
	PRINT STACK
	PRINTI " that "
	ICALL2 RT-THEO-PRINT,THING
	PRINTI " "
	PRINT STR
	PRINTR "."

	.FUNCT RT-LOOKS-PUZZLED-MSG,WHO
	ICALL2 RT-CTHEO-PRINT,WHO
	PRINTI " "
	CALL2 RT-PICK-NEXT,GL-LOOKS-TXT >STACK
	PRINT STACK
	PRINTI " "
	CALL2 RT-PICK-NEXT,GL-PUZZLED-TXT >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT RT-WINNER-NOT-HOLDING-MSG
	ICALL2 RT-CTHEO-PRINT,GL-WINNER
	ICALL2 RT-ISNT-ARENT-MSG,GL-WINNER
	PRINTI "holding "
	RTRUE

	.FUNCT RT-YOUD-HAVE-TO-MSG,STR,THING
	PRINTI "You would have to "
	PRINT STR
	PRINTI " "
	ICALL2 RT-THEO-PRINT,THING
	PRINTI " to do that."
	CRLF
	ICALL2 RT-THIS-IS-IT,THING
	RTRUE

	.FUNCT RT-WOULD-HAVE-TO-MSG,STR,THING
	ASSIGNED? 'STR /?L4
	SET 'STR,0
?L4:	ASSIGNED? 'THING /?L5
	SET 'THING,0
?L5:	PRINTI "would have to "
	PRINT STR
	PRINTI " "
	ZERO? THING /?L1
	ICALL2 RT-THEO-PRINT,THING
?L1:	ICALL2 RT-THIS-IS-IT,THING
	RTRUE

	.FUNCT RT-NOBODY-TO-ASK-MSG
	PRINTI "[There is nobody here to ask.]"
	CRLF
	ICALL1 RT-P-CLEAR
	RTRUE

	.FUNCT RT-TALK-TO-SELF-MSG
	PRINTI "[You must address characters directly.]"
	CRLF
	ICALL1 RT-P-CLEAR
	RTRUE

	.FUNCT RT-WAY-TO-TALK-MSG
	PRINTI "[Refer to your instruction manual for the correct way to address characters.]"
	CRLF
	ICALL1 RT-P-CLEAR
	RETURN 2

	.FUNCT RT-I-SUN-UP-DOWN-MSG,TOD
	FSET? GL-PLACE-CUR,FL-INDOORS /FALSE
	CALL RT-CLOCK-CMP,6,30,0 >STACK
	ZERO? STACK \?L3
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,30,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-SUN-UP-DOWN-MSG,STACK
	SET 'GL-LAST-OUT-TOD,1
	CRLF
	PRINTI "Visibility increases in the gathering light of the new day."
	EQUAL? GL-PLACE-CUR,RM-THAMES-ONE,RM-THAMES-TWO,RM-THAMES-THREE /?L4
	EQUAL? GL-PLACE-CUR,RM-THAMES-FOUR,RM-THAMES-FIVE /?L4
	PRINTI " Tourists are beginning to crowd into the streets."
?L4:	CRLF
	RTRUE
?L3:	CALL RT-CLOCK-CMP,7,0,0 >STACK
	ZERO? STACK \?L7
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,12,30,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-SUN-UP-DOWN-MSG,STACK
	SET 'GL-LAST-OUT-TOD,2
	CRLF
	PRINTI "The sun comes up, as much as it ever comes up in England."
	CRLF
	RFALSE
?L7:	CALL RT-CLOCK-CMP,19,30,0 >STACK
	ZERO? STACK \?L8
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,30,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-SUN-UP-DOWN-MSG,STACK
	SET 'GL-LAST-OUT-TOD,3
	CRLF
	PRINTR "Daylight begins to fade. Soon it will be dark."
?L8:	CALL RT-CLOCK-CMP,20,0,0 >STACK
	ZERO? STACK \FALSE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,10,30,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-SUN-UP-DOWN-MSG,STACK
	SET 'GL-LAST-OUT-TOD,0
	CRLF
	PRINTI "Darkness falls and the mists come in."
	CRLF
	RFALSE

	.FUNCT RT-NO-OTHER?,FEMALE?,OBJ
	ASSIGNED? 'FEMALE? /?L18
	SET 'FEMALE?,0
?L18:	FIRST? GL-PLACE-CUR >OBJ \FALSE
?L4:	EQUAL? OBJ,GL-WINNER /?L11
	FSET? OBJ,FL-PERSON \?L11
	ZERO? FEMALE? /?L20
	FSET? OBJ,FL-FEMALE /?L3
	ZERO? FEMALE? \?L11
?L20:	FSET? OBJ,FL-FEMALE \?L3
?L11:	NEXT? OBJ >OBJ /?L4
?L3:	ZERO? OBJ /FALSE
	ICALL2 RT-LOOKS-PUZZLED-MSG,GL-WINNER
	PRINTR "To whom are you referring?"

	.FUNCT RT-GLOBAL-IN?,OBJ1,OBJ2,TBL
	GETPT OBJ2,P?GLOBAL >TBL
	ZERO? TBL /FALSE
	GRTR? OBJ1,255 /FALSE
	PTSIZE TBL >STACK
	INTBL? OBJ1,TBL,STACK,1 >STACK \FALSE
	RTRUE

	.FUNCT RT-META-LOC,OBJ
?L1:	ZERO? OBJ /FALSE
	IN? OBJ,GLOBAL-OBJECTS \?L5
	RETURN GLOBAL-OBJECTS
?L5:	IN? OBJ,ROOMS \?L6
	RETURN OBJ
?L6:	LOC OBJ >OBJ
	JUMP ?L1

	.FUNCT GO
START::
?L0:	SET 'GL-CLOCK-FMT,0
	SET 'GL-SCORE-MSG,1
	SET 'GL-SCORE-MAX,100
	SET 'GL-PLACE-CUR,RM-221B-BAKER-ST
	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,0,1,0
	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-DEF,0,1,0
	IXCALL RT-DO-CLOCK-SET,GL-TIME,5,0,0,18
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,6,0,0,18 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-BIGBEN,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,6,30,0,18 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-SUN-UP-DOWN-MSG,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,6,30,0,18 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-PM-QUITS,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,7,0,0,18 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-OPEN-WESTMINSTER-DOOR,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,6,55,0,18 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-WESTMINSTER-LIGHTS-ON,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,17,50,0,18 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-FLASH-WESTMINSTER-LIGHTS,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,18,5,0,18 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-WESTMINSTER-LIGHTS-OFF,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,6,55,0,19 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-WESTMINSTER-LIGHTS-ON,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,17,50,0,19 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-FLASH-WESTMINSTER-LIGHTS,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,18,1,0,19 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-LOCKED-IN-END-GAME,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,8,0,0,18 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-OPEN-MUSEUM-DOOR,STACK
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,9,0,0,20 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-OUT-OF-TIME,STACK
	SET 'GL-SCORE-CUR,0
	SET 'GL-MOVES-CUR,0
	SET 'GL-SCORE-STS,-1
	SET 'GL-MOVES-STS,-1
	SET 'GL-PLACE-STS,-1
	SET 'GL-PLACE-PRV,-1
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
	SET 'GL-WINNER,CH-PLAYER
	GETB 0,33 >GL-ALLSCREEN
	DIV GL-ALLSCREEN,2 >GL-MIDSCREEN
	LESS? GL-ALLSCREEN,60 \?L1
	SET 'GL-SHORT-STAT?,1
	SET 'GL-STAT-S-POS,4
	SET 'GL-STAT-T-POS,17
	SET 'GL-SCORE-HEADER-LEN,0
	SUB GL-ALLSCREEN,19 >GL-STAT-MAX-ROOM
?L1:	SUB GL-ALLSCREEN,GL-STAT-S-POS >GL-STAT-S-POS
	SUB GL-ALLSCREEN,GL-STAT-T-POS >GL-STAT-T-POS
	SET 'GL-SPLIT-ROW,1
	MOVE CH-PLAYER,GL-PLACE-CUR
	CLEAR -1
	CRLF
	ICALL1 RT-GAMETITLE-MSG
	ICALL1 RT-COPYRIGHT-MSG
	ICALL1 RT-TRADEMARK-MSG
	ICALL1 RT-ID-MSG
	CRLF
	ICALL1 RT-GET-ANY-KEY
	ICALL1 RT-INIT-SCREEN
	ICALL1 RT-DESC-ALL
	ICALL1 RT-P-CLEAR
	ICALL1 RT-MAIN-LOOP
	JUMP ?L0

	.FUNCT RT-NUMBER?,PTR,TMP,CNT,BPTR,TPTR,CHR,SUM,TIM,AM-PM?
	SET 'TPTR,K-HRS
	SET 'SUM,0
	SET 'TIM,0
	SET 'AM-PM?,0
	MUL PTR,2 >STACK
	ADD GL-P-P-LEX,STACK >TMP
	GET TMP,K-P-LEXELEN >CNT
	EQUAL? CNT,W?AM \?L1
	SET 'AM-PM?,1
	JUMP ?L3
?L1:	EQUAL? CNT,W?PM \?L3
	SET 'AM-PM?,2
?L3:	ZERO? AM-PM? /?L5
	SET 'BELIEVE-WAIT-TIME?,1
	JUMP ?L7
?L5:	SET 'BELIEVE-WAIT-TIME?,0
?L7:	GETB TMP,2 >CNT
	GETB TMP,3 >BPTR
?L8:	DLESS? 'CNT,0 /?L9
	GETB GL-P-PIBUF,BPTR >CHR
	EQUAL? CHR,58 \?L13
	PUTB GL-P-TIME,TPTR,SUM
	EQUAL? TPTR,K-HRS \?L15
	GRTR? SUM,23 /FALSE
	EQUAL? AM-PM?,2 \?L20
	LESS? SUM,12 \?L20
	ADD SUM,12 >SUM
	PUTB GL-P-TIME,K-HRS,SUM
?L20:	SET 'TPTR,K-MIN
	JUMP ?L24
?L15:	EQUAL? TPTR,K-MIN,K-SEC /FALSE
?L24:	SET 'TIM,1
	SET 'SUM,0
	JUMP ?L29
?L13:	GRTR? SUM,9999 /FALSE
	GRTR? CHR,57 /FALSE
	LESS? CHR,48 /FALSE
	SUB CHR,48 >STACK
	MUL SUM,10 >STACK
	ADD STACK,STACK >SUM
?L29:	INC 'BPTR
	JUMP ?L8
?L9:	ZERO? TIM /?L30
	PUTB GL-P-TIME,TPTR,SUM
	EQUAL? TPTR,K-HRS /FALSE
	EQUAL? TPTR,K-MIN \?L34
	LESS? SUM,0 /FALSE
	GRTR? SUM,59 \?L41
	RFALSE
?L34:	EQUAL? TPTR,K-SEC \?L41
	RFALSE
?L30:	EQUAL? AM-PM?,2 \?L42
	LESS? SUM,12 \?L42
	ADD SUM,12 >SUM
?L42:	PUTB GL-P-TIME,K-HRS,SUM
	PUTB GL-P-TIME,K-MIN,0
	PUTB GL-P-TIME,K-SEC,0
?L41:	ICALL RT-CHANGE-LEXV,PTR,W?INTNUM
	GRTR? SUM,9999 /FALSE
	ZERO? TIM /?L47
	SET 'SUM,0
?L47:	SET 'GL-P-TIME-FLAG,TIM
	SET 'GL-P-NUMBER,SUM
	RETURN W?INTNUM

	.FUNCT V-WAIT-FOR,H,M,S,N
	EQUAL? GL-PRSO,TH-TIME \?L1
	SET 'N,GL-P-NUMBER
	EQUAL? N,-1 \?L3
	SET 'N,1
?L3:	GETP GL-PRSO,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?MINUTE,W?MINUTES \?L6
	SET 'H,0
	SET 'M,N
	JUMP ?L8
?L6:	SET 'H,N
	SET 'M,0
?L8:	SET 'S,0
	PRINTI "Time passes..."
	CRLF
	CALL RT-CLOCK-JMP,H,M,S >STACK
	RSTACK
?L1:	ZERO? GL-P-TIME-FLAG \?L9
	EQUAL? GL-PRSO,TH-INTNUM /?L9
	ICALL1 RT-CYOU-MSG
	PRINT K-CANT-WAIT-MSG
	CRLF
	RETURN 2
?L9:	GETB GL-P-TIME,K-HRS >H
	GETB GL-P-TIME,K-MIN >M
	GETB GL-P-TIME,K-SEC >S
	EQUAL? GL-PRSO,TH-INTNUM \?L11
	ZERO? GL-P-TIME-FLAG \?L11
	PRINTI "["
	PRINTN H
	PRINTI ":00]"
	CRLF
	CRLF
?L11:	GRTR? H,23 \?L14
	ICALL1 RT-CYOU-MSG
	PRINT K-CANT-WAIT-MSG
	CRLF
	RETURN 2
?L14:	ZERO? BELIEVE-WAIT-TIME? \?L17
	GRTR? H,12 \?L16
?L17:	GETB GL-TIME,K-HRS >STACK
	SUB H,STACK >H
	GETB GL-TIME,K-MIN >STACK
	SUB M,STACK >M
	GETB GL-TIME,K-SEC >STACK
	SUB S,STACK >S
	JUMP ?L18
?L16:	GETB GL-TIME,K-HRS >STACK
	DEC 'STACK
	MOD STACK,12 >STACK
	INC 'STACK
	SUB H,STACK >H
	GETB GL-TIME,K-MIN >STACK
	SUB M,STACK >M
	GETB GL-TIME,K-SEC >STACK
	SUB S,STACK >S
?L18:	SUB S,59 >STACK
	DIV STACK,60 >N
	ADD M,N >M
	MUL N,60 >STACK
	SUB S,STACK >S
	SUB M,59 >STACK
	DIV STACK,60 >N
	ADD H,N >H
	MUL N,60 >STACK
	SUB M,STACK >M
?L19:	LESS? H,0 \?L20
	ZERO? BELIEVE-WAIT-TIME? /?L24
	ADD H,24 >H
	JUMP ?L19
?L24:	ADD H,12 >H
	JUMP ?L19
?L20:	ZERO? H \?L27
	ZERO? M \?L27
	ZERO? S \?L27
	PRINTI "It is"
	GETB GL-TIME,K-HRS >STACK
	DEC 'STACK
	MOD STACK,12 >STACK
	INC 'STACK
	GRTR? STACK,9 \?L29
	PRINTI " "
?L29:	ICALL2 RT-CLK-NTI-MSG,6
	PRINTI " now."
	CRLF
	ICALL2 RT-TIME-OF-DAY-MSG,1
	RETURN 2
?L27:	PRINTI "Time passes..."
	CRLF
	ICALL RT-CLOCK-JMP,H,M,S
	ICALL2 RT-TIME-OF-DAY-MSG,1
	RTRUE

	.FUNCT RT-WAIT-TOD-MSG,TOD
	CRLF
	PRINTI "While you were waiting, "
	ZERO? TOD \?L1
	PRINTR "the sun set and the mists rolled in."
?L1:	EQUAL? TOD,1 \?L3
	PRINTR "the sky started to lighten. Soon it will be sunrise."
?L3:	EQUAL? TOD,2 \?L4
	PRINTR "the sun rose... as much as it ever does here."
?L4:	PRINTR "the sun set. Soon it will be dark."

	.FUNCT RT-WINDOW,TABLE,MARGIN,Y,I,WIDTH,LINES,STR,PLINES
	ASSIGNED? 'MARGIN /?L32
	SET 'MARGIN,0
?L32:	SET 'Y,8
	SET 'I,2
	GET TABLE,0 >LINES
	GET TABLE,1 >WIDTH
	SET 'PLINES,LINES
	GRTR? WIDTH,GL-ALLSCREEN \?L1
	PRINTR "[*** Window too wide ***]"
?L1:	ZERO? MARGIN \?L4
	DIV WIDTH,2 >STACK
	SUB GL-MIDSCREEN,STACK >MARGIN
?L4:	GETB 0,32 >STACK
	LESS? STACK,25 \?L7
	DEC 'Y
?L7:	ADD LINES,6 >STACK
	SPLIT STACK
	SCREEN K-S-WIN
	HLIGHT K-H-INV
	CURSET Y,MARGIN
	ICALL2 RT-PRINT-SPACES,WIDTH
?L10:	INC 'Y
	CURSET Y,MARGIN
	DEC 'LINES
	ZERO? LINES \?L12
	ICALL2 RT-PRINT-SPACES,WIDTH
	JUMP ?L11
?L12:	GET TABLE,I >STR
	ZERO? STR \?L15
	ICALL2 RT-PRINT-SPACES,WIDTH
	JUMP ?L17
?L15:	PRINTI " "
	PRINT STR
	PRINTI " "
?L17:	INC 'I
	JUMP ?L10
?L11:	HLIGHT K-H-NRM
	SCREEN K-S-NOR
	SPLIT 1
	DIROUT K-D-SCR-OFF
	SET 'I,2
	CRLF
	PRINTI "["
?L18:	DEC 'PLINES
	ZERO? PLINES /?L19
	GET TABLE,I >STR
	ZERO? STR /?L28
	EQUAL? I,2 /?L25
	PRINTI " "
?L25:	PRINT STR
	EQUAL? PLINES,1 \?L28
	PRINTI "]"
?L28:	CRLF
	INC 'I
	JUMP ?L18
?L19:	CRLF
	DIROUT K-D-SCR-ON
	RTRUE

	.FUNCT HOLMES-COMPLAINS,AMP?,SS?
	ZERO? AMP? /?L3
	CALL1 RT-ANYONE-HERE? >STACK
	EQUAL? STACK,0,CH-HOLMES \?L3
	SET 'AMP?,0
?L3:	ZERO? SS? \?L9
	ZERO? AMP? /FALSE
?L9:	CALL1 RT-WHO-SAYS? >STACK
	EQUAL? STACK,CH-HOLMES \FALSE
	CRLF
	PRINTI "Holmes "
	ZERO? AMP? /?L10
	PRINTI "takes you aside and whispers, ""Watson, you must keep the ampoule hidden"
	ICALL2 PRINT-ID,STR?120
?L10:	ZERO? SS? /?L13
	ZERO? AMP? /?L15
	PRINTI ", and"
	JUMP ?L17
?L15:	PRINTI "says, ""Watson,"
?L17:	PRINTI " take that ridiculous thing out of your ears"
?L13:	PRINTR "."""

	.FUNCT TOO-DARK-TO-GO,NEWPLACE
	PRINTI "You start off into the "
	FSET? NEWPLACE,FL-INDOORS \?L1
	PRINTI "darkness"
	JUMP ?L3
?L1:	PRINTI "fog"
?L3:	PRINTR ", but think better of it when you realize you have no light to guide your way."

	.FUNCT RT-AC-CH-PLAYER-AUX
	ZERO? GL-NOW-PRSI? /?L11
	EQUAL? GL-WINNER,CH-PLAYER \FALSE
	EQUAL? GL-PRSA,V?GIVE \FALSE
	ICALL RT-PERFORM,V?TAKE,GL-PRSO
	RTRUE
?L11:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON,V?SEARCH \FALSE
	PRINTR "You don't look any uglier than usual."

	.FUNCT RT-CHECK-HANDS
	EQUAL? GL-PRSA,V?TAKE-OFF \?L1
	EQUAL? GL-PRSO,TH-HANDS /TRUE
?L1:	EQUAL? GL-PRSA,V?PUT-ON,V?TAKE \?L3
	EQUAL? GL-PRSO,TH-HANDS \?L3
	EQUAL? GL-PRSI,TH-EARS /TRUE
?L3:	EQUAL? GL-PRSA,V?COVER \FALSE
	EQUAL? GL-PRSI,TH-HANDS \FALSE
	EQUAL? GL-PRSO,TH-EARS /TRUE
	RFALSE

	.FUNCT RT-HANDS-COVERING-EARS
	PRINTI "You cannot do that because "
	ICALL2 RT-THEO-PRINT,TH-HANDS
	PRINTI " are covering "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."

	.FUNCT V-VERIFY
	PRINTI "Verifying Game."
	CRLF
	CRLF
	VERIFY \?L1
	PRINTI "Good."
	CRLF
	RETURN 2
?L1:	PRINTI "Failed."
	CRLF
	RETURN 2

	.FUNCT V-REFRESH
	SET 'GL-SPLIT-ROW,1
	ICALL1 RT-INIT-SCREEN
	ICALL1 RT-UPDATE-STATUS-LINE
	ICALL RT-DESC-ALL,0,1
	RETURN 2

	.FUNCT V-HINTS-NO
	EQUAL? GL-PRSO,ROOMS /?L1
	PRINT K-DONT-UNDERSTAND-MSG
	CRLF
	RETURN 2
?L1:	SET 'GL-HINTS-OFF,1
	PRINTI "[Hints have been disallowed for this session.]"
	CRLF
	RETURN 2

	.FUNCT V-HINT,CHR,MAXC,C,Q,WHO
?L0:	SET 'C,0
	SET 'WHO,0
	ZERO? GL-HINTS-OFF /?L1
	ICALL RT-PERFORM,V?HINTS-NO,ROOMS
	RETURN 2
?L1:	ZERO? GL-HINT-WARNING \?L3
	SET 'GL-HINT-WARNING,1
	PRINTI "[Warning: It is recognized that the temptation for help may at times be so exceedingly strong that you might fetch hints prematurely. Therefore, you may at any time during the story type HINTS OFF, and this will disallow the seeking out of help for the present session of the story. If you still want a hint now, indicate HINT.]"
	CRLF
	RETURN 2
?L3:	ZERO? WHO \?L5
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES,CH-WIGGINS \?L5
	EQUAL? WHO,CH-HOLMES \?L7
	PRINTI "Holmes looks at you impatiently and sighs, ""Very well, Watson. If you must."""
	JUMP ?L9
?L7:	PRINTI "Wiggins looks up at you with relief and says, ""Good idea, guv. We'll never work this out on our own."""
?L9:	CRLF
	CRLF
	PRINTI "[Press any key to continue.]"
	CRLF
	INPUT 1 >STACK
	ICALL2 0,STACK
?L5:	SET 'SOUND-QUEUED?,0
	ICALL1 KILL-SOUNDS
	GET K-HINTS,0 >MAXC
	ICALL1 RT-INIT-HINT-SCREEN
	CURSET 5,1
	ICALL1 RT-PUT-UP-CHAPTERS
	SUB GL-CHAPT-NUM,1 >GL-CUR-POS
	ICALL1 RT-NEW-CURSOR
?L12:	INPUT 1 >CHR
	EQUAL? CHR,81,113 \?L14
	SET 'Q,1
	JUMP ?L13
?L14:	EQUAL? CHR,78,110 \?L16
	ICALL1 RT-ERASE-CURSOR
	EQUAL? GL-CHAPT-NUM,MAXC \?L17
	SET 'GL-CUR-POS,0
	SET 'GL-CHAPT-NUM,1
	SET 'GL-QUEST-NUM,1
	JUMP ?L19
?L17:	INC 'GL-CUR-POS
	INC 'GL-CHAPT-NUM
	SET 'GL-QUEST-NUM,1
?L19:	ICALL1 RT-NEW-CURSOR
	JUMP ?L12
?L16:	EQUAL? CHR,80,112 \?L20
	ICALL1 RT-ERASE-CURSOR
	EQUAL? GL-CHAPT-NUM,1 \?L21
	SET 'GL-CHAPT-NUM,MAXC
	SUB MAXC,1 >GL-CUR-POS
	JUMP ?L23
?L21:	DEC 'GL-CUR-POS
	DEC 'GL-CHAPT-NUM
?L23:	SET 'GL-QUEST-NUM,1
	ICALL1 RT-NEW-CURSOR
	JUMP ?L12
?L20:	EQUAL? CHR,13,10 \?L12
	ICALL1 RT-PICK-QUESTION
?L13:	ZERO? Q /?L0
	CLEAR -1
	ICALL1 V-REFRESH
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L29
	CRLF
	PRINTI "Holmes barely glances at you and snaps, ""At last. Now may we proceed?"""
	CRLF
	JUMP ?L32
?L29:	EQUAL? WHO,CH-WIGGINS \?L31
	CRLF
	PRINTI "Wiggins tugs your sleeve and asks hopefully, ""Learn anything?"""
	CRLF
	JUMP ?L32
?L31:	CRLF
	PRINTI "Back to the story..."
	CRLF
?L32:	ZERO? SOUND-ON? /?L33
	ICALL1 CHECK-LOOPING
?L33:	RETURN 2

	.FUNCT RT-PICK-QUESTION,CHR,MAXQ,Q
?L0:	SET 'Q,0
	ICALL2 RT-INIT-HINT-SCREEN,0
	ICALL RT-LEFT-LINE,3,RETURN-SEE-HINT,RETURN-SEE-HINT-LEN
	ICALL RT-RIGHT-LINE,3,Q-MAIN-MENU,Q-MAIN-MENU-LEN
	GET K-HINTS,GL-CHAPT-NUM >STACK
	GET STACK,0 >STACK
	SUB STACK,1 >MAXQ
	CURSET 5,1
	ICALL1 RT-PUT-UP-QUESTIONS
	SUB GL-QUEST-NUM,1 >GL-CUR-POS
	ICALL1 RT-NEW-CURSOR
?L1:	INPUT 1 >CHR
	EQUAL? CHR,81,113 \?L3
	SET 'Q,1
	JUMP ?L2
?L3:	EQUAL? CHR,78,110 \?L5
	ICALL1 RT-ERASE-CURSOR
	EQUAL? GL-QUEST-NUM,MAXQ \?L6
	SET 'GL-CUR-POS,0
	SET 'GL-QUEST-NUM,1
	JUMP ?L8
?L6:	INC 'GL-CUR-POS
	INC 'GL-QUEST-NUM
?L8:	ICALL1 RT-NEW-CURSOR
	JUMP ?L1
?L5:	EQUAL? CHR,80,112 \?L9
	ICALL1 RT-ERASE-CURSOR
	EQUAL? GL-QUEST-NUM,1 \?L10
	SET 'GL-QUEST-NUM,MAXQ
	SUB MAXQ,1 >GL-CUR-POS
	JUMP ?L12
?L10:	DEC 'GL-CUR-POS
	DEC 'GL-QUEST-NUM
?L12:	ICALL1 RT-NEW-CURSOR
	JUMP ?L1
?L9:	EQUAL? CHR,13,10 \?L1
	ICALL1 RT-DISPLAY-HINT
?L2:	ZERO? Q /?L0
	RFALSE

	.FUNCT RT-ERASE-CURSOR
	GET GL-COLUMN-TABLE,GL-CUR-POS >STACK
	SUB STACK,2 >STACK
	GET GL-LINE-TABLE,GL-CUR-POS >STACK
	CURSET STACK,STACK
	PRINTI " "
	RTRUE

	.FUNCT RT-NEW-CURSOR
	GET GL-COLUMN-TABLE,GL-CUR-POS >STACK
	SUB STACK,2 >STACK
	GET GL-LINE-TABLE,GL-CUR-POS >STACK
	CURSET STACK,STACK
	PRINTI ">"
	RTRUE

	.FUNCT RT-INVERSE-LINE,CENTER-HALF
	SET 'CENTER-HALF,0
	HLIGHT K-H-INV
	GETB 0,33 >STACK
	ICALL2 RT-PRINT-SPACES,STACK
	HLIGHT K-H-NRM
	RTRUE

	.FUNCT RT-DISPLAY-HINT,H,MX,CNT,CHR,FLG,N,CV,SHIFT?,COUNT-OFFS,CURCX,CURC
	SET 'CNT,2
	SET 'FLG,1
	CLEAR -1
	SPLIT 3
	SCREEN K-S-WIN
	CURSET 1,1
	ICALL1 RT-INVERSE-LINE
	ICALL RT-CENTER-LINE,1,STR?121,16
	CURSET 3,1
	ICALL1 RT-INVERSE-LINE
	ICALL RT-LEFT-LINE,3,STR?122
	ICALL RT-RIGHT-LINE,3,STR?123,17
	CURSET 2,1
	ICALL1 RT-INVERSE-LINE
	HLIGHT K-H-BLD
	ADD GL-QUEST-NUM,1 >STACK
	GET K-HINTS,GL-CHAPT-NUM >STACK
	GET STACK,STACK >H
	SUB GL-CHAPT-NUM,1 >STACK
	GET K-HINT-COUNTS,STACK >CV
	GET H,1 >STACK
	ICALL RT-CENTER-LINE,2,STACK
	HLIGHT K-H-NRM
	GET H,0 >MX
	SCREEN K-S-NOR
	CRLF
	MOD GL-QUEST-NUM,2 >SHIFT?
	SUB GL-QUEST-NUM,1 >STACK
	DIV STACK,2 >COUNT-OFFS
	GETB CV,COUNT-OFFS >CURCX
	ZERO? SHIFT? /?L1
	SHIFT CURCX,-4 >STACK
	JUMP ?L3
?L1:	PUSH CURCX
?L3:	BAND STACK,15 >STACK
	ADD 2,STACK >CURC
?L4:	EQUAL? CNT,CURC /?L5
	GET H,CNT >STACK
	PRINT STACK
	CRLF
	INC 'CNT
	JUMP ?L4
?L5:	ZERO? FLG /?L13
	GRTR? CNT,MX \?L11
	SET 'FLG,0
	PRINTI "[That's all.]"
	CRLF
	JUMP ?L13
?L11:	ZERO? FLG /?L13
	SUB MX,CNT >STACK
	ADD STACK,1 >N
	PRINTI "["
	PRINTN N
	PRINTI " hint"
	EQUAL? N,1 /?L14
	PRINTI "s"
?L14:	PRINTI " left.]"
	PRINTI " -> "
	SET 'FLG,0
?L13:	INPUT 1 >CHR
	EQUAL? CHR,81,113 \?L18
	ZERO? SHIFT? /?L20
	SUB CNT,2 >STACK
	SHIFT STACK,4 >STACK
	GETB CV,COUNT-OFFS >STACK
	BAND STACK,15 >STACK
	BOR STACK,STACK >STACK
	PUTB CV,COUNT-OFFS,STACK
	RTRUE
?L20:	SUB CNT,2 >STACK
	GETB CV,COUNT-OFFS >STACK
	BAND STACK,240 >STACK
	BOR STACK,STACK >STACK
	PUTB CV,COUNT-OFFS,STACK
	RTRUE
?L18:	EQUAL? CHR,13,10 \?L5
	GRTR? CNT,MX /?L5
	SET 'FLG,1
	GET H,CNT >STACK
	PRINT STACK
	CRLF
	IGRTR? 'CNT,MX \?L5
	SET 'FLG,0
	PRINTI "[Final hint]"
	CRLF
	JUMP ?L5

	.FUNCT RT-PUT-UP-QUESTIONS,ST,MXQ,MXL
	SET 'ST,1
	GET K-HINTS,GL-CHAPT-NUM >STACK
	GET STACK,0 >STACK
	SUB STACK,1 >MXQ
	GETB 0,32 >STACK
	SUB STACK,1 >MXL
?L1:	GRTR? ST,MXQ /TRUE
	SUB ST,1 >STACK
	GET GL-COLUMN-TABLE,STACK >STACK
	DEC 'STACK
	SUB ST,1 >STACK
	GET GL-LINE-TABLE,STACK >STACK
	CURSET STACK,STACK
	PRINTI " "
	ADD ST,1 >STACK
	GET K-HINTS,GL-CHAPT-NUM >STACK
	GET STACK,STACK >STACK
	GET STACK,1 >STACK
	PRINT STACK
	INC 'ST
	JUMP ?L1

	.FUNCT RT-PUT-UP-CHAPTERS,ST,MXC,MXL
	SET 'ST,1
	GET K-HINTS,0 >MXC
	GETB 0,32 >STACK
	SUB STACK,1 >MXL
?L1:	GRTR? ST,MXC /TRUE
	SUB ST,1 >STACK
	GET GL-COLUMN-TABLE,STACK >STACK
	DEC 'STACK
	SUB ST,1 >STACK
	GET GL-LINE-TABLE,STACK >STACK
	CURSET STACK,STACK
	PRINTI " "
	GET K-HINTS,ST >STACK
	GET STACK,1 >STACK
	PRINT STACK
	INC 'ST
	JUMP ?L1

	.FUNCT RT-INIT-HINT-SCREEN,THIRD
	ASSIGNED? 'THIRD /?L4
	SET 'THIRD,1
?L4:	CLEAR -1
	GETB 0,32 >STACK
	DEC 'STACK
	SPLIT STACK
	SCREEN K-S-WIN
	CURSET 1,1
	ICALL1 RT-INVERSE-LINE
	CURSET 2,1
	ICALL1 RT-INVERSE-LINE
	CURSET 3,1
	ICALL1 RT-INVERSE-LINE
	ICALL RT-CENTER-LINE,1,STR?121,16
	ICALL RT-LEFT-LINE,2,STR?124
	ICALL RT-RIGHT-LINE,2,STR?125,12
	ZERO? THIRD /FALSE
	ICALL RT-LEFT-LINE,3,STR?126
	CALL RT-RIGHT-LINE,3,STR?127,16 >STACK
	RSTACK

	.FUNCT RT-CENTER-LINE,LN,STR,LEN,INV
	ASSIGNED? 'LEN /?L10
	SET 'LEN,0
?L10:	ASSIGNED? 'INV /?L11
	SET 'INV,1
?L11:	ZERO? LEN \?L1
	DIROUT K-D-TBL-ON,GL-DIROUT-TBL
	PRINT STR
	DIROUT K-D-TBL-OFF
	GET GL-DIROUT-TBL,0 >LEN
?L1:	GETB 0,33 >STACK
	SUB STACK,LEN >STACK
	DIV STACK,2 >STACK
	CURSET LN,STACK
	ZERO? INV /?L4
	HLIGHT K-H-INV
?L4:	PRINT STR
	ZERO? INV /FALSE
	HLIGHT K-H-NRM
	RTRUE

	.FUNCT RT-LEFT-LINE,LN,STR,INV
	ASSIGNED? 'INV /?L7
	SET 'INV,1
?L7:	CURSET LN,1
	ZERO? INV /?L1
	HLIGHT K-H-INV
?L1:	PRINT STR
	ZERO? INV /FALSE
	HLIGHT K-H-NRM
	RTRUE

	.FUNCT RT-RIGHT-LINE,LN,STR,LEN,INV
	ASSIGNED? 'LEN /?L10
	SET 'LEN,0
?L10:	ASSIGNED? 'INV /?L11
	SET 'INV,1
?L11:	ZERO? LEN \?L1
	DIROUT 3,GL-DIROUT-TBL
	PRINT STR
	DIROUT -3
	GET GL-DIROUT-TBL,0 >LEN
?L1:	GETB 0,33 >STACK
	SUB STACK,LEN >STACK
	CURSET LN,STACK
	ZERO? INV /?L4
	HLIGHT K-H-INV
?L4:	PRINT STR
	ZERO? INV /FALSE
	HLIGHT K-H-NRM
	RTRUE

	.FUNCT SOUNDS,N,OP,VOL,NUM,RTN
	ASSIGNED? 'OP /?L34
	SET 'OP,S-START
?L34:	ASSIGNED? 'VOL /?L35
	SET 'VOL,8
?L35:	ASSIGNED? 'NUM /?L36
	SET 'NUM,1
?L36:	LESS? LOOPING?,0 \?L1
	EQUAL? OP,S-START \?L1
	SET 'LOOPING?,0
	CRLF
	PRINTI "[Use $SOUND to toggle sound usage on and off.]"
	CRLF
?L1:	EQUAL? OP,S-INIT \?L4
	ZERO? SOUND-QUEUED? \TRUE
	ZERO? LOOPING? \TRUE
?L4:	EQUAL? N,S-CROWD \?L8
	SET 'VOL,6
	JUMP ?L10
?L8:	EQUAL? N,S-BADVIOL \?L10
	SET 'VOL,6
?L10:	EQUAL? N,S-CROWD,S-BOATING,S-SNORE \?L12
	EQUAL? OP,S-START \?L14
	SET 'LOOPING?,N
	SET 'LOOP-VOL,VOL
	SET 'NUM,-1
	JUMP ?L16
?L14:	EQUAL? OP,S-STOP \?L16
	SET 'LOOPING?,0
?L16:	ZERO? SOUND-QUEUED? /?L22
	RTRUE
?L12:	ZERO? RTN \?L22
	SET 'RTN,CHECK-LOOPING
?L22:	ZERO? SOUND-ON? /TRUE
	EQUAL? OP,S-START \?L27
	EQUAL? N,S-CROWD,S-BOATING,S-SNORE /?L29
	SET 'SOUND-QUEUED?,N
?L29:	SHIFT NUM,8 >STACK
	BOR STACK,VOL >STACK
	SOUND N,OP,STACK,RTN
	RTRUE
?L27:	SOUND N,OP
	RTRUE

	.FUNCT CHECK-LOOPING
	SET 'SOUND-QUEUED?,0
	GRTR? LOOPING?,0 \TRUE
	ICALL SOUNDS,LOOPING?,S-START,LOOP-VOL
	RTRUE

	.FUNCT RT-S-CAB-ARRIVES
	ZERO? CAB-RAMP \?L1
	CALL SOUNDS,S-HORSE,S-START,4 >STACK
	RSTACK
?L1:	DEC 'CAB-RAMP
	SUB 2,CAB-RAMP >STACK
	XCALL SOUNDS,S-HORSE,S-START,STACK,1,RT-S-CAB-ARRIVES >STACK
	RSTACK

	.FUNCT RT-S-CAB-LEAVES
	ZERO? SOUND-QUEUED? /?L3
	EQUAL? SOUND-QUEUED?,S-HORSE \FALSE
?L3:	SET 'CAB-RAMP,2
	CALL1 RT-S-CAB-GOES >STACK
	RSTACK

	.FUNCT RT-S-CAB-GOES
	ZERO? CAB-RAMP \?L1
	CALL SOUNDS,S-HORSE,S-START,1 >STACK
	RSTACK
?L1:	DEC 'CAB-RAMP
	ADD CAB-RAMP,1 >STACK
	MUL STACK,2 >STACK
	XCALL SOUNDS,S-HORSE,S-START,STACK,1,RT-S-CAB-GOES >STACK
	RSTACK

	.FUNCT END-FANFARE
	SET 'SOUND-QUEUED?,0
	CALL1 KILL-SOUNDS >STACK
	RSTACK

	.FUNCT KILL-SOUNDS
	EQUAL? SOUND-QUEUED?,S-FANFARE /TRUE
	SET 'SOUND-QUEUED?,0
	ICALL SOUNDS,0,S-STOP
	RTRUE

	.FUNCT V-$0024SOUND
	LESS? LOOPING?,0 \?L1
	SET 'LOOPING?,0
?L1:	PRINTI "Sound "
	ZERO? SOUND-ON? /?L4
	SET 'SOUND-QUEUED?,0
	ICALL1 KILL-SOUNDS
	SET 'SOUND-ON?,0
	PRINTR "off."
?L4:	PRINTI "on."
	CRLF
	SET 'SOUND-ON?,1
	CALL1 CHECK-LOOPING >STACK
	RSTACK

	.FUNCT PRE-CALL
	EQUAL? GL-PRSI,TH-CAB-WHISTLE /FALSE
	EQUAL? GL-PRSO,ROOMS \?L3
	EQUAL? GL-P-PRSA-WORD,W?HAIL \?L4
	PRINTR "Greetings, O strange one."
?L4:	PRINTR "Helllloooooooo."
?L3:	GET GL-P-ADJW,0 >STACK
	EQUAL? STACK,W?MARY \?L7
	EQUAL? GL-P-PRSA-WORD,W?HAIL \?L7
	PRINTR "Praying isn't a bad idea. But if you really need help, simply type HINT."
?L7:	GET GL-P-NAMW,0 >STACK
	EQUAL? STACK,W?CAB \?L8
	FSET? GL-PLACE-CUR,FL-INDOORS \?L9
	ICALL1 RT-CYOU-MSG
	PRINTI "can't "
	PRINTB GL-P-PRSA-WORD
	PRINTR " a cab while indoors."
?L9:	LOC TH-HANSOM-CAB >STACK
	LOC TH-GROWLER-CAB >STACK
	EQUAL? GL-PLACE-CUR,STACK,STACK \?L11
	PRINT K-CAB-HERE-MSG
	CRLF
	RTRUE
?L11:	EQUAL? GL-P-PRSA-WORD,W?HAIL \?L13
	ICALL RT-CYOU-MSG,STR?129,STR?128
	PRINTI "a hand in the air"
	JUMP ?L15
?L13:	ICALL RT-CYOU-MSG,STR?131,STR?130
	PRINTI "for a few moments"
?L15:	PRINTI ", but nothing happens. Apparently that isn't how Victorians "
	PRINTB GL-P-PRSA-WORD
	PRINTR " cabs."
?L8:	FSET? GL-PRSO,FL-ALIVE \?L17
	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK \FALSE
?L17:	PRINTR "Nothing happens."

	.FUNCT PRE-DROP
	EQUAL? GL-PRSO,TH-ANCHOR /FALSE
	IN? GL-PRSO,GL-WINNER /FALSE
	IN? GL-PRSO,GLOBAL-OBJECTS \?L4
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L4:	FSET? GL-PRSO,FL-BODYPART \?L5
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L5:	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
	RETURN 2

	.FUNCT PRE-DUMB-EXAMINE
	CALL1 PRE-EXAMINE >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT PRE-EXAMINE
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	EQUAL? GL-PRSO,TH-INTDIR \FALSE
	EQUAL? GL-P-DIRECTION,P?UP \?L4
	ICALL RT-PERFORM,V?LOOK-UP,ROOMS
	RTRUE
?L4:	EQUAL? GL-P-DIRECTION,P?DOWN \?L6
	ICALL RT-PERFORM,V?LOOK-DOWN,ROOMS
	RTRUE
?L6:	PRINTR "You peer off into the middle distance, but then return your attention to the matters at hand."

	.FUNCT PRE-FEED
	CALL2 PRE-GIVE,1 >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT PRE-GIVE,FEED?
	ASSIGNED? 'FEED? /?L14
	SET 'FEED?,0
?L14:	ZERO? GL-PRSO /?L3
	ZERO? GL-PRSI \?L1
?L3:	PRINT K-REFERRING-MSG
	CRLF
	RTRUE
?L1:	EQUAL? GL-PRSO,GL-PRSI /?L5
	IN? GL-PRSI,GLOBAL-OBJECTS \?L4
?L5:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L4:	FSET? GL-PRSI,FL-ALIVE /?L6
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	ZERO? FEED? /?L7
	PRINTI "feed "
	JUMP ?L9
?L7:	PRINTI "give "
?L9:	PRINTI "anything to "
	ICALL2 RT-A-PRINT,GL-PRSI
	PRINTR "."
?L6:	EQUAL? GL-PRSI,CH-ME,CH-PLAYER \?L15
	IN? GL-PRSO,CH-PLAYER \?L10
	ICALL1 RT-ALREADY-HAVE-PRSO-MSG
	RTRUE
?L10:	EQUAL? GL-PRSI,CH-ME,CH-PLAYER /?L11
?L15:	CALL2 RT-DONT-HAVE-MSG,GL-PRSO >STACK
	ZERO? STACK \TRUE
?L11:	FSET? GL-PRSO,FL-WORN \FALSE
	IN? GL-PRSO,CH-PLAYER \FALSE
	ICALL1 RT-TAKE-OFF-PRSO-FIRST-MSG
	RFALSE

	.FUNCT PRE-LISTEN
	FSET? TH-COTTON-BALLS,FL-WORN \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTR "can't hear anything very clearly, but then what did you expect with those huge wads of cotton plugging up your ears?"

	.FUNCT PRE-POCKET
	EQUAL? GL-WINNER,CH-PLAYER /?L1
	PRINTR "[You cannot tell characters to do that.]"
?L1:	IN? GL-PRSO,GLOBAL-OBJECTS \?L3
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	IN? GL-PRSO,TH-POCKET \FALSE
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-IS-ARE-MSG
	PRINTI "already in "
	ICALL2 DPRINT,TH-POCKET
	PRINTR "."

	.FUNCT PRE-PUT,PTR,OLOC,CNT
	IN? GL-PRSO,GLOBAL-OBJECTS /FALSE
	EQUAL? GL-PRSO,TH-ANCHOR /?L3
	IN? GL-PRSO,GL-WINNER /?L3
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
	RETURN 2
?L3:	EQUAL? GL-PRSO,TH-CLOTHES \?L4
	PRINT K-INAPPROPRIATE-MSG
	CRLF
	ICALL2 PRINT-ID,STR?132
	RTRUE
?L4:	EQUAL? GL-PRSO,GL-PRSI \?L5
	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE
?L5:	EQUAL? GL-PRSI,TH-INTDIR,TH-RIGHT,TH-LEFT \?L6
	PRINTR "[You must specify an object.]"
?L6:	EQUAL? GL-PRSI,TH-HANDS \?L7
	ICALL RT-NOT-LIKELY-MSG,GL-PRSO,STR?133
	RTRUE
?L7:	EQUAL? TH-FEET,GL-PRSO,GL-PRSI \?L8
	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE
?L8:	EQUAL? TH-EARS,GL-PRSO,GL-PRSI /FALSE
	EQUAL? GL-PRSO,TH-HANDS \?L10
	ICALL RT-PERFORM,V?REACH-IN,GL-PRSI
	RTRUE
?L10:	IN? GL-PRSI,GLOBAL-OBJECTS /FALSE
	EQUAL? GL-PRSO,TH-PIPE \?L12
	EQUAL? GL-PRSI,W?MOUTH,W?LIPS \?L12
	CALL RT-PERFORM,V?SMOKE,TH-PIPE >STACK
	RSTACK
?L12:	FSET? GL-PRSO,FL-BODYPART \?L13
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L13:	IN? GL-PRSO,GL-PRSI \?L14
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-IS-ARE-MSG
	PRINTI "already"
	ICALL2 RT-IN-ON-MSG,GL-PRSI
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L14:	EQUAL? GL-PRSO,GL-PRSI /?L16
	IN? GL-PRSO,GLOBAL-OBJECTS /?L16
	FSET? GL-PRSO,FL-TAKEABLE /?L15
?L16:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L15:	CALL2 RT-ACCESSIBLE?,GL-PRSI >STACK
	ZERO? STACK \?L17
	ICALL2 RT-CANT-SEE-ANY-MSG,GL-PRSI
	RTRUE
?L17:	EQUAL? GL-PRSO,TH-STETHOSCOPE \?L18
	FSET? GL-PRSI,FL-PERSON /FALSE
?L18:	CALL RT-CHECK-MOVE-MSG?,GL-PRSO,GL-PRSI >STACK
	ZERO? STACK \TRUE
	FSET? GL-PRSO,FL-WORN \FALSE
	IN? GL-PRSO,CH-PLAYER \FALSE
	EQUAL? GL-PRSI,CH-ME,CH-PLAYER /FALSE
	ICALL1 RT-TAKE-OFF-PRSO-FIRST-MSG
	RFALSE

	.FUNCT PRE-PUT-ON
	CALL1 PRE-PUT >STACK
	ZERO? STACK \TRUE
	FSET? GL-PRSI,FL-ALIVE /FALSE
	FSET? GL-PRSI,FL-SURFACE /FALSE
	ICALL1 RT-NO-GOOD-SURFACE-MSG
	RTRUE

	.FUNCT PRE-SHOW
	EQUAL? 0,GL-PRSO,GL-PRSI \?L1
	PRINT K-REFERRING-MSG
	CRLF
	RTRUE
?L1:	EQUAL? GL-PRSI,CH-ME,CH-PLAYER \?L3
	CALL RT-META-IN?,GL-PRSO,CH-PLAYER >STACK
	ZERO? STACK /FALSE
	CALL RT-PERFORM,V?EXAMINE,GL-PRSO >STACK
	RSTACK
?L3:	EQUAL? GL-PRSO,GL-PRSI /?L8
	IN? GL-PRSI,GLOBAL-OBJECTS \?L7
?L8:	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L7:	FSET? GL-PRSI,FL-ALIVE /FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot show things to "
	ICALL2 RT-A-PRINT,GL-PRSI
	PRINTR "."

	.FUNCT PRE-SHOOT
	EQUAL? GL-PRSI,0,TH-GUN /?L1
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot shoot anything with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L1:	EQUAL? GL-PRSI,GL-PRSO \?L3
	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE
?L3:	IN? TH-GUN,CH-PLAYER /?L4
	PRINTR "Clever thinking. If only you had something to shoot with!"
?L4:	EQUAL? GL-PRSO,CH-ME,TH-EARS,CH-PLAYER /?L6
	EQUAL? GL-PRSO,TH-HEAD,TH-WATSONS-HEART \?L5
?L6:	PRINT K-SUICIDE-MSG
	CRLF
	RTRUE
?L5:	EQUAL? GL-PRSO,TH-BREATH /FALSE
	FSET? GL-PRSO,FL-BODYPART \?L8
	PRINTI "Is this how you got sent home from the Afghan Campaign?"
	CRLF
	CALL2 PRINT-ID,STR?134 >STACK
	RSTACK
?L8:	EQUAL? GL-PRSO,TH-GUN /?L9
	CALL RT-META-IN?,GL-PRSO,CH-PLAYER >STACK
	ZERO? STACK /?L9
	PRINT K-DROP-IT-FIRST-MSG
	CRLF
	RTRUE
?L9:	ZERO? TH-GUN-AUX1 \?L10
	PRINTR "Click!"
?L10:	DEC 'TH-GUN-AUX1
	RFALSE

	.FUNCT PRE-TAKE,L
	EQUAL? GL-PRSO,TH-BREATH \?L1
	EQUAL? GL-WINNER,CH-PLAYER \?L1
	ICALL1 V-INHALE
	RTRUE
?L1:	IN? GL-PRSO,GLOBAL-OBJECTS /FALSE
	LOC GL-WINNER >STACK
	EQUAL? GL-PRSO,STACK \?L7
	ICALL1 RT-CYOU-MSG
	PRINTI "are already inside "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L7:	LOC GL-PRSO >L
	FSET? GL-PRSO,FL-BODYPART \?L10
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L10:	EQUAL? GL-PRSO,TH-STETHOSCOPE,TH-WATSONS-HAT,TH-COTTON-BALLS \?L12
	FSET? GL-PRSO,FL-WORN /FALSE
?L12:	EQUAL? L,GL-WINNER \?L13
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "already "
	FSET? GL-PRSO,FL-WORN \?L14
	PRINTI "wearing "
	JUMP ?L16
?L14:	PRINTI "holding "
?L16:	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L13:	ZERO? L /?L17
	FSET? L,FL-CONTAINER \?L17
	FSET? L,FL-OPENABLE \?L17
	FSET? L,FL-OPENED /?L17
	ICALL1 RT-CYOU-MSG
	PRINTI "can't reach into "
	ICALL2 RT-THEO-PRINT,L
	PRINTR ". It is closed."
?L17:	ZERO? GL-PRSI /FALSE
	EQUAL? GL-PRSO,GL-PRSI \?L19
	GET GL-P-NAMW,1 >STACK
	GET GL-P-NAMW,0 >STACK
	EQUAL? STACK,STACK /?L23
	GET GL-P-ADJW,1 >STACK
	GET GL-P-ADJW,0 >STACK
	EQUAL? STACK,STACK \FALSE
?L23:	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L19:	EQUAL? GL-PRSI,CH-ME,CH-PLAYER \?L25
	EQUAL? GL-WINNER,CH-PLAYER \?L26
	ICALL1 RT-NOBODY-TO-ASK-MSG
	RTRUE
?L26:	EQUAL? L,CH-PLAYER /FALSE
	ICALL RT-CYOU-MSG,STR?136,STR?135
	PRINTI "have "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L25:	EQUAL? GL-PRSI,CH-BANK-GUARD \?L30
	EQUAL? L,TH-GUARDS-POCKET \?L30
	CALL RT-PERFORM,V?TAKE,GL-PRSO,TH-GUARDS-POCKET >STACK
	RSTACK
?L30:	EQUAL? L,GL-PRSI /FALSE
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	ICALL RT-IN-ON-MSG,GL-PRSI,0
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT PRE-THROW
	CALL1 PRE-PUT >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT PRE-THROW-OVER
	CALL1 PRE-THROW >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT PRE-WATCH
	CALL1 PRE-EXAMINE >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT V-ADJUST
	EQUAL? GL-P-PRSA-WORD,W?ADJUST \?L1
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-DONT-DOESNT-MSG,GL-PRSO
	PRINTR "need adjustment."
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot focus "
	ICALL2 RT-A-PRINT,GL-PRSO
	PRINTR "."

	.FUNCT V-ALARM
	CALL1 RT-FOOLISH-TO-TALK-MSG >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	EQUAL? GL-PRSO,ROOMS \?L3
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTR "already wide awake."
?L3:	FSET? GL-PRSO,FL-ALIVE \?L4
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSO
	FSET? GL-PRSO,FL-ASLEEP \?L5
	PRINTR "unconscious, not asleep."
?L5:	PRINTR "already wide awake."
?L4:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-ARREST
	PRINTI "Unfortunately,"
	ICALL RT-YOU-MSG,STR?138,STR?137
	PRINTI "not have the authority to arrest any"
	FSET? GL-PRSO,FL-PERSON \?L1
	PRINTI "one"
	JUMP ?L3
?L1:	PRINTI "thing"
?L3:	PRINTR "."

	.FUNCT V-ASK-ABOUT-1
	RTRUE

	.FUNCT V-ASK-ABOUT
	CALL1 RT-FOOLISH-TO-TALK-MSG >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	EQUAL? GL-WINNER,GL-PRSI \?L3
	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RETURN 2
?L3:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L4
	ICALL1 RT-TALK-TO-SELF-MSG
	RTRUE
?L4:	ICALL1 RT-NO-RESPONSE-MSG
	RTRUE

	.FUNCT V-ASK-FOR-1
	RTRUE

	.FUNCT V-ASK-FOR,WHO
	CALL1 RT-FOOLISH-TO-TALK-MSG >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	EQUAL? GL-WINNER,GL-PRSI \?L3
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	FSET? GL-PRSI,FL-TAKEABLE /?L4
	ICALL2 RT-CTHEO-PRINT,GL-PRSO
	PRINTI " say"
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTI ", ""Unfortunately, "
	FSET? GL-PRSO,FL-PLURAL /?L5
	PRINTI "I"
	JUMP ?L7
?L5:	PRINTI "we"
?L7:	PRINTR " can't help you with that."""
?L4:	ICALL1 RT-NO-RESPONSE-MSG
	RTRUE

	.FUNCT V-BLOW-INTO
	FSET? GL-PRSO,FL-PERSON \?L1
	ICALL RT-PERFORM,V?USE,GL-PRSO
	RTRUE
?L1:	ICALL2 RT-NO-POINT-MSG,STR?139
	RTRUE

	.FUNCT V-BOW
	ICALL2 RT-NO-POINT-MSG,STR?140
	RTRUE

	.FUNCT V-BURN,OBJ,FIX-LAMP?
	SET 'FIX-LAMP?,0
	CALL RT-META-IN?,TH-LAMP,GL-WINNER >STACK
	ZERO? STACK /?L1
	FSET? TH-LAMP,FL-LIGHTED \?L1
	SET 'FIX-LAMP?,1
	FCLEAR TH-LAMP,FL-LIGHTED
?L1:	XCALL RT-GET-WHAT-I-MEAN,FL-LIGHTED,194,PR?WITH,1,1 >OBJ
	EQUAL? OBJ,0,TH-LAMP /?L4
	ZERO? FIX-LAMP? /?L6
	FSET TH-LAMP,FL-LIGHTED
?L6:	PRINTI "[with "
	ICALL2 RT-THEO-PRINT,OBJ
	PRINTI "]"
	CRLF
	ICALL RT-PERFORM,V?BURN-WITH,GL-PRSO,OBJ
	RTRUE
?L4:	ZERO? FIX-LAMP? /?L10
	FSET TH-LAMP,FL-LIGHTED
?L10:	PUT GL-P-ITBL,K-P-PREP2,PR?WITH
	ICALL1 RT-SYNTAX-CHECK
	SET 'GL-P-GOOD,0
	RETURN 2

	.FUNCT V-BURN-WITH
	FSET? GL-PRSO,FL-BURNABLE \?L1
	FSET? GL-PRSI,FL-BURNABLE \?L3
	FSET? GL-PRSI,FL-LIGHTED \?L3
	CALL RT-META-IN?,TH-ETHERIUM-AMPOULE,GL-PRSO >STACK
	ZERO? STACK /?L5
	FSET? TH-ETHERIUM-AMPOULE,FL-BROKEN /?L5
	ICALL1 RT-CTHEO-PRINT
	PRINTI " catches fire, and quickly generates enough heat to affect the etherium you left inside it."
	ICALL2 PRINT-ID,STR?141
	ICALL RT-PERFORM,V?BURN-WITH,TH-ETHERIUM-AMPOULE,GL-PRSI
	RTRUE
?L5:	REMOVE GL-PRSO
	FCLEAR GL-PRSO,FL-WORN
	ICALL1 RT-CTHEO-PRINT
	PRINTI " catches fire and is quickly consumed."
	CRLF
	CALL2 PRINT-ID,STR?142 >STACK
	RSTACK
?L3:	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSI
	PRINTI "burning."
	CRLF
	CALL2 PRINT-ID,STR?143 >STACK
	RSTACK
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "can't "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
	CALL2 PRINT-ID,STR?144 >STACK
	RSTACK

	.FUNCT V-BUY
	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK \?L1
	ICALL2 RT-CANT-SEE-ANY-MSG,GL-PRSO
	RETURN 2
?L1:	CALL2 RT-HELD?,GL-PRSO >STACK
	ZERO? STACK /?L3
	ICALL1 RT-ALREADY-HAVE-PRSO-MSG
	RTRUE
?L3:	FSET? GL-PRSO,FL-BUYABLE /?L4
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	PRINTR "for sale."
?L4:	EQUAL? GL-WINNER,CH-PLAYER \?L5
	IN? GL-PRSO,TH-POCKET \?L5
	ICALL1 RT-SAY-ITS-MSG
	PRINTI "in "
	ICALL2 RT-THEO-PRINT,TH-POCKET
	PRINTR "."
?L5:	ZERO? GL-PRSI /?L6
	ICALL RT-CYOU-MSG,STR?146,STR?145
	PRINTI "buy "
	ICALL1 RT-THEO-PRINT
	PRINTI " with "
	ICALL2 RT-A-PRINT,GL-PRSI
	PRINTR "."
?L6:	ICALL1 RT-NO-MONEY-MSG
	RTRUE

	.FUNCT V-BUY-FROM
	PRINTI "It's not for sale."
	CRLF
	RETURN 2

	.FUNCT V-CALL
	LOC GL-PRSO >STACK
	EQUAL? STACK,GL-PLACE-CUR \?L1
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSO
	PRINTR "right in front of you."
?L1:	PRINTR "Nothing happens."

	.FUNCT V-CAST-OFF
	EQUAL? GL-PRSO,ROOMS,TH-BOAT /?L1
	ICALL1 V-DROP
	RTRUE
?L1:	IN? CH-PLAYER,TH-BOAT /?L4
	LOC TH-BOAT >STACK
	LOC CH-PLAYER >STACK
	EQUAL? STACK,STACK \?L3
?L4:	ICALL1 RT-LAUNCH-BOAT
	RTRUE
?L3:	PRINTR "Clever idea. Now, if only you were in a boat...."

	.FUNCT V-CLEAN
	PRINTI "Sorry. You get no points for neatness."
	CRLF
	RETURN 2

	.FUNCT V-CLEAN-OFF
	EQUAL? GL-PRSO,GL-PRSI \?L1
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " on "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT V-CLIMB-DOWN
	EQUAL? GL-P-PRSA-WORD,W?JUMP,W?LEAP \?L1
	ICALL RT-PERFORM,V?DIVE,GL-PRSO
	RTRUE
?L1:	EQUAL? GL-PRSO,ROOMS \?L3
	ICALL2 RT-DO-WALK,P?DOWN
	RTRUE
?L3:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-CLIMB-ON
	EQUAL? GL-P-PRSA-WORD,W?TAKE \?L1
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?147,STACK
	ICALL RT-NOT-LIKELY-MSG,GL-PRSO,STR?148
	RTRUE
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " onto "
	ICALL1 RT-SAY-HIM-HER-THEM-IT-MSG
	PRINTR "."

	.FUNCT V-CLIMB-OVER
	EQUAL? GL-PRSO,ROOMS \?L1
	ICALL1 V-WALK-AROUND
	RTRUE
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot climb over "
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?149,STACK
	ICALL1 RT-SAY-HIM-HER-THEM-IT-MSG
	PRINTR "."

	.FUNCT V-CLIMB-UP
	EQUAL? GL-PRSO,ROOMS \?L1
	ICALL2 RT-DO-WALK,P?UP
	RTRUE
?L1:	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?150,STACK
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-CLOSE
	FSET? GL-PRSO,FL-OPENABLE \?L1
	FSET? GL-PRSO,FL-OPENED /?L3
	ICALL2 RT-ITS-ALREADY-MSG,STR?151
	RTRUE
?L3:	FSET? GL-PRSO,FL-LOCKED \?L5
	PRINTR "The door is fixed in the open position. It cannot be closed."
?L5:	ICALL1 RT-YOU-CLOSE-MSG
	RTRUE
?L1:	ICALL1 RT-CANT-CLOSE-THAT-MSG
	RTRUE

	.FUNCT V-COUNT,?TMP
	GET GL-P-NAMW,0 >?TMP
	EQUAL? ?TMP,W?ARMS,W?EARS,W?EYES /?L3
	EQUAL? ?TMP,W?FEET,W?HANDS,W?LEGS /?L3
	EQUAL? ?TMP,W?LIPS \?L1
?L3:	PRINTR "Two."
?L1:	FSET? GL-PRSO,FL-PLURAL /?L5
	EQUAL? GL-PRSO,TH-BANK-OF-CANDLES \?L4
?L5:	ICALL RT-CYOU-MSG,STR?153,STR?152
	PRINTI "distracted and lose"
	EQUAL? GL-WINNER,CH-PLAYER /?L6
	PRINTI "s"
?L6:	PRINTR " count."
?L4:	ICALL RT-CYOU-MSG,STR?155,STR?154
	PRINTR "only one."

	.FUNCT V-COVER
	ICALL RT-PERFORM,V?PUT-ON,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-CROSS
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot cross "
	ICALL1 RT-SAY-HIM-HER-THEM-IT-MSG
	PRINTR "."

	.FUNCT V-CUT,?TMP
	PRINTI "That would"
	CALL1 IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
?L1:	ICALL PRINT-ID,STR?156,STACK
	CALL1 IS-SELF-OR-PART-OF-SELF? >STACK
	ICALL PRINT-ID,STR?157,STACK
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-DETONATE
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?158,STACK
	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
	ICALL PRINT-ID,STR?159,STACK
	CALL1 IS-SELF-OR-PART-OF-SELF? >STACK
	ICALL PRINT-ID,STR?160,STACK
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-DIAGNOSE
	FSET? GL-PRSO,FL-ALIVE /?L1
	PRINTR "Don't be ridiculous."
?L1:	FSET? GL-PRSO,FL-ASLEEP \?L3
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSO
	PRINTR "asleep."
?L3:	EQUAL? GL-PRSO,CH-PLAYER,CH-ME \?L4
	PRINTR "You're doing fine. Now quit fooling around and get back to solving the game."
?L4:	ICALL1 RT-CTHEO-PRINT
	PRINTI " appear"
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTR " to be in good health."

	.FUNCT V-DIVE
	EQUAL? GL-PRSO,ROOMS \?L1
	EQUAL? GL-PLACE-CUR,RM-THE-EMBANKMENT,RM-SWAN-LANE,RM-LONDON-BRIDGE \?L1
	PRINTI "Yuck! Have you looked at that water?"
	CRLF
	ICALL2 PRINT-ID,STR?161
	RETURN 2
?L1:	PRINTI "That would be a foolish thing to do."
	CRLF
	RETURN 2

	.FUNCT V-DRESS
	EQUAL? GL-PRSO,ROOMS \?L1
	PRINTR "You are already dressed."
?L1:	FSET? GL-PRSO,FL-PERSON \?L3
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTR "already dressed."
?L3:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot dress "
	ICALL2 RT-A-PRINT,GL-PRSO
	PRINTR "."

	.FUNCT V-DRINK,FROM?
	ASSIGNED? 'FROM? /?L4
	SET 'FROM?,0
?L4:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot drink "
	ZERO? FROM? /?L1
	PRINTI "from "
?L1:	ICALL2 DPRINT,TH-NOT-HERE-OBJECT
	PRINTR "."

	.FUNCT V-DRINK-FROM
	ICALL2 V-DRINK,1
	RTRUE

	.FUNCT V-DRIVE
	LOC GL-WINNER >STACK
	EQUAL? STACK,TH-HANSOM-CAB,TH-GROWLER-CAB \?L1
	EQUAL? GL-PRSO,ROOMS /TRUE
	SET 'GL-WHERE-TO-PROMPT?,0
	PRINTR """Sorry, guv. Could you be a little more specific?"""
?L1:	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTR "not in a cab."

	.FUNCT V-DROP
	CALL1 RT-IDROP-MSG >STACK
	ZERO? STACK /TRUE
	ICALL1 RT-SAY-DROPPED-MSG
	RTRUE

	.FUNCT V-DUMB-EXAMINE
	CALL1 V-EXAMINE >STACK
	ZERO? STACK /FALSE
	RTRUE

	.FUNCT V-EAT
	EQUAL? GL-WINNER,CH-PLAYER \?L1
	CALL1 DANGEROUS-FOOD? >STACK
	ICALL PRINT-ID,STR?162,STACK
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?163,STACK
	ICALL RT-NOT-LIKELY-MSG,GL-PRSO,STR?164
	RTRUE
?L1:	PRINTI """It"
	CALL2 RT-PICK-NEXT,GL-NOT-LIKELY-TXT >STACK
	PRINT STACK
	PRINTI " that "
	ICALL1 RT-THEO-PRINT
	PRINTI " would agree with me."""
	CRLF
	CALL1 DANGEROUS-FOOD? >STACK
	ICALL PRINT-ID,STR?165,STACK
	RTRUE

	.FUNCT V-EMPTY,DEST
	ASSIGNED? 'DEST /?L11
	SET 'DEST,0
?L11:	ZERO? DEST \?L1
	SET 'DEST,CH-PLAYER
?L1:	FSET? GL-PRSO,FL-SURFACE \?L4
	ICALL2 RT-EMPTY-PRSO-MSG,DEST
	RTRUE
?L4:	FSET? GL-PRSO,FL-CONTAINER \?L6
	FSET? GL-PRSO,FL-OPENED \?L7
	ICALL2 RT-EMPTY-PRSO-MSG,DEST
	RTRUE
?L7:	ICALL2 RT-ITS-CLOSED-MSG,GL-PRSO
	RTRUE
?L6:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot possibly empty "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-EMPTY-INTO
	EQUAL? GL-PRSI,TH-HANDS,CH-ME,CH-PLAYER \?L1
	CALL2 V-EMPTY,CH-PLAYER >STACK
	RSTACK
?L1:	CALL RT-IDENTIFY-FLOOR?,W?GROUND,GL-PRSI >STACK
	ZERO? STACK \?L4
	CALL RT-IDENTIFY-FLOOR?,W?FLOOR,GL-PRSI >STACK
	ZERO? STACK /?L3
?L4:	CALL2 V-EMPTY,GL-PRSI >STACK
	RSTACK
?L3:	FSET? GL-PRSI,FL-SURFACE \?L5
	CALL2 V-EMPTY,GL-PRSI >STACK
	RSTACK
?L5:	FSET? GL-PRSI,FL-CONTAINER \?L6
	FSET? GL-PRSI,FL-OPENED \?L7
	FSET? GL-PRSI,TH-WATSONS-COAT \?L9
	CALL2 V-EMPTY,TH-POCKET >STACK
	RSTACK
?L9:	CALL2 V-EMPTY,GL-PRSI >STACK
	RSTACK
?L7:	CALL2 RT-ITS-CLOSED-MSG,GL-PRSI >STACK
	RSTACK
?L6:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot empty "
	ICALL1 RT-THEO-PRINT
	PRINTI " into "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT V-ENTER,VEH
	EQUAL? GL-PRSO,GL-PLACE-CUR \?L1
	ICALL1 RT-ALREADY-IN-ROOM-MSG
	RTRUE
?L1:	CALL RT-FIND-IN?,GL-PLACE-CUR,FL-VEHICLE >VEH
	ZERO? VEH /?L7
	EQUAL? GL-PRSO,ROOMS,VEH \?L7
	IN? GL-WINNER,VEH \?L6
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "already in "
	ICALL2 RT-THEO-PRINT,VEH
	PRINTR "."
?L6:	ICALL RT-PERFORM,V?ENTER,VEH
	RTRUE
?L7:	EQUAL? GL-PRSO,ROOMS \?L9
	ICALL2 RT-DO-WALK,P?IN
	RTRUE
?L9:	FSET? GL-PRSO,FL-CLOTHING \?L11
	PRINTI "[Presumably, you mean WEAR "
	ICALL1 RT-THEO-PRINT
	PRINTI ".]"
	CRLF
	ICALL RT-PERFORM,V?WEAR,GL-PRSO
	RTRUE
?L11:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-ESCAPE
	ICALL1 V-WALK-AROUND
	RTRUE

	.FUNCT V-EXAMINE,ODF,NUM,DRES
	SET 'ODF,0
	SET 'DRES,0
	FSET? GL-PRSO,FL-HAS-DESCFCN \?L1
	GETP GL-PRSO,P?ACTION >ODF
?L1:	CALL2 RT-HOLE?,GL-PRSO >NUM
	ZERO? NUM /?L4
	PRINTI "There "
	EQUAL? NUM,1 \?L6
	PRINTI "is one"
	JUMP ?L14
?L6:	PRINTI "are "
	EQUAL? NUM,2 \?L9
	PRINTI "two"
	JUMP ?L14
?L9:	EQUAL? NUM,3 \?L11
	PRINTI "three"
	JUMP ?L14
?L11:	EQUAL? NUM,4 \?L12
	PRINTI "four"
	JUMP ?L14
?L12:	EQUAL? NUM,5 \?L13
	PRINTI "five"
	JUMP ?L14
?L13:	PRINTI "six"
?L14:	PRINTI " bullet hole"
	GRTR? NUM,1 \?L15
	PRINTI "s"
?L15:	PRINTI " in "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
?L4:	ZERO? ODF /?L19
	CALL2 ODF,K-M-DESCFCN >DRES
	EQUAL? DRES,1 \?L19
	FSET GL-PRSO,FL-SEEN
	RTRUE
?L19:	FSET? GL-PRSO,FL-OPENABLE \?L21
	ICALL1 RT-OPEN-CLOSED-MSG
	CRLF
	FSET GL-PRSO,FL-SEEN
	RTRUE
?L21:	FSET? GL-PRSO,FL-SURFACE \?L22
	PRINTI "On "
	ICALL1 RT-THEO-PRINT
	PRINTI " can be seen "
	ICALL2 RT-PRINT-CONTENTS-2,GL-PRSO
	PRINTI "."
	CRLF
	FSET GL-PRSO,FL-SEEN
	RTRUE
?L22:	FSET? GL-PRSO,FL-CONTAINER \?L23
	FSET? GL-PRSO,FL-OPENED /?L26
	FSET? GL-PRSO,FL-TRANSPARENT \?L24
?L26:	ICALL1 V-LOOK-INSIDE
	FSET GL-PRSO,FL-SEEN
	RTRUE
?L24:	ICALL2 RT-ITS-CLOSED-MSG,GL-PRSO
	CRLF
	FSET GL-PRSO,FL-SEEN
	RTRUE
?L23:	FSET? GL-PRSO,FL-PERSON \?L28
	CALL2 RT-SEE-ANYTHING-IN?,GL-PRSO >STACK
	ZERO? STACK /?L28
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSO
	PRINTI "holding "
	ICALL2 RT-PRINT-CONTENTS-2,GL-PRSO
	PRINTI "."
	CRLF
	FSET GL-PRSO,FL-SEEN
	RTRUE
?L28:	ZERO? NUM \TRUE
	ZERO? DRES \TRUE
	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTI " about "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
	FSET GL-PRSO,FL-SEEN
	RTRUE

	.FUNCT V-EXHALE
	EQUAL? GL-PRSO,TH-BREATH,ROOMS /?L1
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	FSET? TH-BREATH,FL-LOCKED /?L3
	ICALL1 RT-CYOU-MSG
	ICALL2 RT-WOULD-HAVE-TO-MSG,STR?166
	RTRUE
?L3:	FCLEAR TH-BREATH,FL-LOCKED
	PRINTI "You begin to breathe normally."
	CRLF
	ICALL2 RT-ALARM-CLR,RT-I-EXHALE
	ICALL2 RT-ALARM-CLR,RT-I-INHALE
	ICALL1 RT-SMELL-ETHERIUM?
	RTRUE

	.FUNCT V-EXIT,VEH,L
	CALL RT-FIND-IN?,GL-PLACE-CUR,FL-VEHICLE >VEH
	ZERO? VEH /?L7
	EQUAL? GL-PRSO,ROOMS,VEH \?L7
	EQUAL? GL-PRSO,ROOMS \?L5
	LOC GL-WINNER >STACK
	FSET? STACK,FL-VEHICLE \?L5
	LOC GL-WINNER >STACK
	ICALL RT-PERFORM,V?EXIT,STACK
	RTRUE
?L5:	IN? GL-WINNER,VEH /?L6
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not in "
	ICALL2 RT-THEO-PRINT,VEH
	PRINTR "."
?L6:	ICALL RT-PERFORM,V?EXIT,VEH
	RTRUE
?L7:	LOC GL-PRSO >L
	EQUAL? GL-PRSO,ROOMS \?L9
	ICALL2 RT-DO-WALK,P?OUT
	RTRUE
?L9:	EQUAL? GL-PRSO,GL-PLACE-CUR \?L11
	PRINT K-SPECIFY-DIR-MSG
	CRLF
	RTRUE
?L11:	EQUAL? L,ROOMS \?L12
	ICALL1 RT-NOT-IN-ROOM-MSG
	RTRUE
?L12:	FSET? L,FL-CONTAINER \?L13
	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK /?L13
	PRINTI "[from "
	ICALL2 DPRINT,L
	PRINTI "]"
	CRLF
	ICALL RT-PERFORM,V?TAKE,GL-PRSO
	RTRUE
?L13:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-FEED
	EQUAL? GL-PRSI,GL-WINNER \?L1
	ICALL1 RT-CYOU-MSG
	JUMP ?L3
?L1:	ICALL2 RT-CTHEO-PRINT,GL-PRSI
	PRINTI " "
?L3:	PRINTI "cannot eat "
	ICALL2 RT-THEO-PRINT,GL-PRSO
	PRINTI "."
	CRLF
	CALL1 DANGEROUS-FOOD? >STACK
	ZERO? STACK \?L5
	PUSH 0
	JUMP ?L4
?L5:	CALL1 IS-PERSON-ANIMAL-PRSI? >STACK
?L4:	ICALL PRINT-ID,STR?167,STACK
	RTRUE

	.FUNCT V-FEED-SWP
	ICALL RT-PERFORM,V?FEED,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-FILL
	ICALL RT-PERFORM,V?PUT,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-FIND,L
	LOC GL-PRSO >L
	ZERO? L \?L1
	PRINT K-DO-IT-YOURSELF-MSG
	CRLF
	RTRUE
?L1:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER,TH-HANDS /?L4
	EQUAL? GL-PRSO,TH-WATSONS-HEART,TH-FEET,TH-EARS /?L4
	EQUAL? GL-PRSO,TH-HEAD,TH-PLAYER-BODY,TH-BREATH /?L4
	EQUAL? GL-PRSO,TH-CLOTHES \?L3
?L4:	PRINTR "You're right here."
?L3:	IN? GL-PRSO,CH-PLAYER \?L5
	PRINTI "You're "
	FSET? GL-PRSO,FL-WORN \?L6
	PRINTI "wearing"
	JUMP ?L8
?L6:	PRINTI "holding"
?L8:	PRINTI " "
	ICALL1 RT-SAY-HIM-HER-THEM-IT-MSG
	PRINTR "."
?L5:	IN? GL-PRSO,GL-PLACE-CUR /?L10
	EQUAL? GL-PRSO,GL-PLACE-CUR /?L10
	IN? GL-PRSO,LOCAL-GLOBALS /?L11
	IN? GL-PRSO,ROOMS \?L9
?L11:	CALL RT-GLOBAL-IN?,GL-PRSO,GL-PLACE-CUR >STACK
	ZERO? STACK /?L9
?L10:	ICALL1 RT-ITS-RIGHT-HERE-MSG
	RTRUE
?L9:	FSET? L,FL-PERSON /?L13
	FSET? L,FL-ALIVE \?L12
?L13:	CALL2 RT-VISIBLE?,L >STACK
	ZERO? STACK /?L12
	ICALL2 RT-CTHEO-PRINT,L
	PRINTI " ha"
	FSET? L,FL-PLURAL /?L14
	PRINTI "s"
	JUMP ?L16
?L14:	PRINTI "ve"
?L16:	PRINTR " it."
?L12:	CALL2 RT-SEE-INSIDE?,L >STACK
	ZERO? STACK /?L17
	CALL2 RT-VISIBLE?,L >STACK
	ZERO? STACK /?L17
	ICALL1 RT-SAY-ITS-MSG
	ICALL RT-IN-ON-MSG,L,0
	ICALL2 RT-THEO-PRINT,L
	PRINTR "."
?L17:	PRINT K-DO-IT-YOURSELF-MSG
	CRLF
	RTRUE

	.FUNCT V-FLIP
	FSET? GL-PRSO,FL-TAKEABLE /?L1
	FSET? GL-PRSO,FL-TRYTAKE /?L1
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	ICALL2 RT-NO-POINT-MSG,STR?168
	RTRUE

	.FUNCT V-FLY
	ICALL1 RT-CYOU-MSG
	PRINTR "cannot possibly do that."

	.FUNCT V-FOCUS-ON
	ZERO? GL-PRSI \?L1
	EQUAL? GL-PRSO,TH-TELESCOPE \?L3
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	IN? TH-TELESCOPE,CH-PLAYER \?L5
	ICALL RT-PERFORM,V?LOOK-THRU,GL-PRSO,TH-TELESCOPE
	RTRUE
?L5:	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE
?L1:	EQUAL? GL-PRSO,TH-TELESCOPE \?L8
	ICALL RT-PERFORM,V?LOOK-THRU,GL-PRSI,GL-PRSO
	RTRUE
?L8:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot focus "
	ICALL1 RT-THEO-PRINT
	PRINTI " on "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT V-FOLD
	ICALL2 RT-NO-POINT-MSG,STR?169
	RTRUE

	.FUNCT V-FOLLOW
	ZERO? GL-PRSO \?L1
	ICALL1 RT-CANT-SEE-ANY-MSG
	RETURN 2
?L1:	CALL RT-META-IN?,GL-PRSO,GL-PLACE-CUR >STACK
	ZERO? STACK \?L3
	LOC GL-PRSO >STACK
	EQUAL? STACK,LOCAL-GLOBALS,GLOBAL-OBJECTS /?L3
	ICALL2 RT-CANT-SEE-ANY-MSG,GL-PRSO
	RETURN 2
?L3:	PRINTI "But "
	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L5
	PRINTR "you're right here."
?L5:	ICALL1 RT-THEO-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSO
	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK \?L10
	IN? GL-PRSO,GLOBAL-OBJECTS \?L8
?L10:	PRINTI "right here"
	JUMP ?L11
?L8:	PRINTI "not visible at the moment"
?L11:	PRINTR "."

	.FUNCT V-FOO
	EQUAL? GL-P-PRSA-WORD,W?RENT \?L1
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	PRINTR "for rent."
?L1:	EQUAL? GL-PRSO,ROOMS \FALSE
	PRINTR "Same to you, fella."

	.FUNCT V-GET-FOR
	ICALL RT-PERFORM,V?TAKE,GL-PRSO
	RTRUE

	.FUNCT V-GET-FOR-SWP
	ICALL RT-PERFORM,V?TAKE,GL-PRSI
	RTRUE

	.FUNCT V-GIN,WHO
	EQUAL? GL-PLACE-CUR,RM-BYWARD-TOWER \?L1
	ICALL2 RT-CTHEO-PRINT,CH-TOWER-GUARD
	PRINTI " takes a quick look around and says, ""Thanks. Don't mind if I do,"" whereupon he whips out a hip flask and takes a quick slug. Just as quickly, he tucks it away and resumes staring at you."
	CRLF
	ICALL2 PRINT-ID,STR?170
	RTRUE
?L1:	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L4
	PRINTI "Holmes shakes his head and says, ""No drinks for you until we recover the Crown Jewels."""
	CRLF
	ICALL2 PRINT-ID,STR?171
	RTRUE
?L4:	EQUAL? WHO,CH-WIGGINS \?L6
	PRINTR "Wiggins says, ""Good idea. I could use a belt."""
?L6:	PRINTR "Wrong game, dummy."

	.FUNCT V-GIVE
	EQUAL? GL-PRSI,CH-ME,CH-PLAYER \?L1
	ICALL1 RT-NOBODY-TO-ASK-MSG
	RTRUE
?L1:	EQUAL? GL-PRSI,CH-TOWER-GUARD,CH-PALACE-GUARD,CH-TUSSAUDS-GUARD \?L3
	FSET? GL-PRSO,FL-MONEY \?L3
	ICALL1 RT-CTHEI-PRINT
	PRINTI " doesn't even glance at "
	ICALL1 RT-THEO-PRINT
	PRINTI ". Clearly he cannot be bribed."
	CRLF
	ICALL2 PRINT-ID,STR?172
	RTRUE
?L3:	FSET? GL-PRSI,FL-PERSON \?L4
	ICALL1 RT-CTHEI-PRINT
	PRINTI " show"
	ICALL2 RT-S-NOS-MSG,GL-PRSI
	PRINTR " little interest in your offer."
?L4:	ICALL RT-NOT-LIKELY-MSG,GL-PRSI,STR?173
	RTRUE

	.FUNCT V-GIVE-SWP
	ICALL RT-PERFORM,V?GIVE,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-GOODBYE
	CALL1 RT-HI-BYE-MSG >STACK
	RSTACK

	.FUNCT V-GUESS,WHO
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-WIGGINS \?L1
	PRINTR "Wiggins says, ""Mr 'Olmes doesn't like people guessing about things."""
?L1:	EQUAL? GL-WINNER,CH-HOLMES \?L4
	PRINTI "Holmes looks at you in shock and says, ""I never"
	JUMP ?L7
?L4:	EQUAL? WHO,CH-HOLMES \?L6
	PRINTI "Holmes shakes his head and says, ""Never"
	JUMP ?L7
?L6:	PRINTI "Holmes's words come back to you, ""Never"
?L7:	PRINTR " guess, Watson. It is a shocking habit - destructive to the logical faculty."""

	.FUNCT V-HAGGLE
	FSET? GL-PRSO,FL-PERSON /?L1
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " with "
	ICALL1 RT-A-PRINT
	PRINTR "."
?L1:	EQUAL? GL-PRSO,CH-HOLMES \?L3
	PRINTI "There is nothing to negotiate with "
	ICALL2 RT-THEO-PRINT,CH-HOLMES
	PRINTR " about."
?L3:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L4
	PRINTR "You have nothing to negotiate."
?L4:	ICALL1 RT-CTHEO-PRINT
	PRINTI " refuse"
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTR " to negotiate."

	.FUNCT V-HAUL
	PRINTR "You're a doctor, not a sailor."

	.FUNCT V-HEAT
	CALL2 RT-NO-POINT-MSG,STR?174 >STACK
	RSTACK

	.FUNCT V-HELLO
	CALL1 RT-HI-BYE-MSG >STACK
	RSTACK

	.FUNCT V-HIDE
	PRINTR "You can run, but you cannot hide."

	.FUNCT V-HIT,?TMP
	PRINTI "Attacking "
	ICALL1 RT-THEO-PRINT
	EQUAL? GL-PRSI,0,TH-HANDS /?L1
	PRINTI " with "
	ICALL2 RT-A-PRINT,GL-PRSI
?L1:	PRINT K-WONT-HELP-MSG
	CRLF
	CALL1 IS-PERSON? >?TMP
	ZERO? ?TMP /?L5
	PUSH ?TMP
	JUMP ?L4
?L5:	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
?L4:	ICALL PRINT-ID,STR?175,STACK
	CALL1 IS-SELF-OR-PART-OF-SELF? >STACK
	ICALL PRINT-ID,STR?176,STACK
	RTRUE

	.FUNCT V-HOLD-OVER
	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-HUSH
	PRINTR "Silence is golden."

	.FUNCT V-INHALE
	EQUAL? GL-PRSO,TH-BREATH,ROOMS /?L1
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	FSET? TH-BREATH,FL-LOCKED \?L3
	EQUAL? GL-P-PRSA-WORD,W?BREATHE \?L4
	ICALL1 V-EXHALE
	RTRUE
?L4:	PRINTI "You are already holding "
	ICALL2 RT-THEO-PRINT,TH-BREATH
	PRINTR "."
?L3:	PRINTI "You take a deep breath."
	EQUAL? GL-PUPPY,CH-HOLMES \?L8
	PRINTI " "
	ICALL2 RT-CTHEO-PRINT,CH-HOLMES
	PRINTI " notices your action and surreptitiously does likewise."
?L8:	CRLF
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,2,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-EXHALE,STACK
	FSET TH-BREATH,FL-LOCKED
	SET 'GL-CLOCK-WAIT,1
	RTRUE

	.FUNCT V-KICK,?TMP
	CALL1 IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
?L1:	ICALL PRINT-ID,STR?177,STACK
	CALL1 IS-SELF-OR-PART-OF-SELF? >STACK
	ICALL PRINT-ID,STR?178,STACK
	ICALL2 RT-NO-POINT-MSG,STR?179
	RTRUE

	.FUNCT V-KILL
	PRINTI "Calm down."
	CRLF
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?180,STACK
	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
	ICALL PRINT-ID,STR?181,STACK
	CALL1 IS-SELF-OR-PART-OF-SELF? >STACK
	ICALL PRINT-ID,STR?182,STACK
	RTRUE

	.FUNCT V-KISS
	PRINTI "You really can't wait for the Victorian Era to end, can you?"
	CRLF
	CALL1 IS-PERSON? >STACK
	CALL PRINT-ID,STR?183,STACK >STACK
	RSTACK

	.FUNCT V-KNOCK
	FSET? GL-PRSO,FL-DOOR \?L1
	FSET? GL-PRSO,FL-OPENED \?L3
	ICALL2 RT-ITS-ALREADY-MSG,STR?108
	RTRUE
?L3:	PRINTR "There's no answer."
?L1:	FSET? GL-PRSO,FL-PERSON \?L6
	ICALL RT-PERFORM,V?USE,GL-PRSO
	RTRUE
?L6:	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-LEAP
	EQUAL? GL-PRSO,ROOMS /?L1
	PRINTR "No."
?L1:	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-LIE-DOWN
	PRINTR "With so much at stake, resting is out of the question."

	.FUNCT V-LIGHT,OBJ,FIX-LAMP?
	SET 'FIX-LAMP?,0
	CALL RT-META-IN?,TH-LAMP,GL-WINNER >STACK
	ZERO? STACK /?L1
	FSET? TH-LAMP,FL-LIGHTED \?L1
	SET 'FIX-LAMP?,1
	FCLEAR TH-LAMP,FL-LIGHTED
?L1:	XCALL RT-GET-WHAT-I-MEAN,FL-LIGHTED,194,PR?WITH,1,1 >OBJ
	EQUAL? OBJ,0,TH-LAMP /?L4
	ZERO? FIX-LAMP? /?L6
	FSET TH-LAMP,FL-LIGHTED
?L6:	PRINTI "[with "
	ICALL2 RT-THEO-PRINT,OBJ
	PRINTI "]"
	CRLF
	ICALL RT-PERFORM,V?LIGHT-WITH,GL-PRSO,OBJ
	RTRUE
?L4:	ZERO? FIX-LAMP? /?L10
	FSET TH-LAMP,FL-LIGHTED
?L10:	PUT GL-P-ITBL,K-P-PREP2,PR?WITH
	ICALL1 RT-SYNTAX-CHECK
	SET 'GL-P-GOOD,0
	RETURN 2

	.FUNCT V-LIGHT-WITH,OBJ
	EQUAL? GL-PRSI,TH-LAMP \?L1
	EQUAL? GL-PRSI,GL-PRSO \?L3
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	ICALL RT-PERFORM,V?SHINE-AT,GL-PRSI,GL-PRSO
	RTRUE
?L1:	ICALL1 V-BURN-WITH
	RTRUE

	.FUNCT V-LISTEN,OBJ
	SET 'OBJ,0
	EQUAL? GL-PRSO,ROOMS \?L1
	FSET? GL-PLACE-CUR,RM-DIOGENES-CLUB \?L3
	ICALL2 RT-CTHEO-PRINT,CH-MEMBERS
	PRINTI " are all asleep."
	CRLF
	JUMP ?L6
?L3:	FSET? GL-PLACE-CUR,FL-INDOORS \?L5
	PRINTI "From afar you"
	JUMP ?L6
?L5:	PRINTI "You"
?L6:	PRINTI " hear the sounds of the "
	IN? CH-PLAYER,TH-BOAT \?L7
	PRINTI "river "
	JUMP ?L9
?L7:	PRINTI "city "
?L9:	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L10
	PRINTI "at night"
	JUMP ?L14
?L10:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1 \?L12
	PRINTI "waking up"
	JUMP ?L14
?L12:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,2 \?L13
	PRINTI "going about its business"
	JUMP ?L14
?L13:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L14
	PRINTI "going to sleep"
?L14:	PRINTR "."
?L1:	EQUAL? GL-PRSI,0,TH-STETHOSCOPE,TH-EARS /?L16
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot listen to anything with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L16:	EQUAL? GL-PRSI,TH-STETHOSCOPE \?L17
	FSET? TH-STETHOSCOPE,FL-WORN /?L17
	ICALL1 RT-CTHEI-PRINT
	PRINTI " is not in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L17:	FSET? GL-PRSO,FL-ALIVE \?L18
	EQUAL? GL-PRSI,TH-STETHOSCOPE \?L18
	EQUAL? GL-PRSO,CH-HOLMES \?L19
	FSET? CH-HOLMES,FL-ASLEEP \?L19
	ICALL1 RT-THEO-PRINT
	PRINTR " is suffering from a mental, not physical, malaise."
?L19:	PRINTI "You don't need to. Your experienced eye tells you there is nothing wrong with "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L18:	PRINTI "At the moment, "
	EQUAL? GL-PRSO,CH-PLAYER,CH-ME \?L23
	PRINTI "you"
	JUMP ?L25
?L23:	ICALL1 RT-THEO-PRINT
?L25:	ICALL1 RT-IS-ARE-MSG
	PRINTI "silent."
	CRLF
	SET 'GL-LISTEN-OBJ,GL-PRSO
	RTRUE

	.FUNCT V-LOCK
	FSET? GL-PRSO,FL-OPENABLE /?L3
	FSET? GL-PRSO,FL-CONTAINER \?L1
?L3:	FSET? GL-PRSO,FL-OPENED \?L4
	ICALL RT-YOUD-HAVE-TO-MSG,STR?184,GL-PRSO
	RTRUE
?L4:	FSET? GL-PRSO,FL-LOCKED \?L6
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-IS-ARE-MSG
	PRINTR "already locked."
?L6:	ICALL RT-THING-WONT-LOCK-MSG,GL-PRSI,GL-PRSO
	RTRUE
?L1:	ICALL1 RT-CANT-LOCK-MSG
	RTRUE

	.FUNCT V-LOOK
	ICALL RT-DESC-ALL,0,1
	RTRUE

	.FUNCT V-LOOK-BEHIND
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	FSET? GL-PRSO,FL-DOOR \?L3
	FSET? GL-PRSO,FL-OPENED \?L4
	ICALL1 RT-CANT-SEE-MUCH-MSG
	RTRUE
?L4:	ICALL2 RT-ITS-CLOSED-MSG,GL-PRSO
	RTRUE
?L3:	PRINTI "There's nothing behind "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-LOOK-DOWN,X
	SET 'X,0
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	EQUAL? GL-PRSO,ROOMS \?L3
	EQUAL? GL-PLACE-CUR,RM-CLOCK-TOWER \?L4
	ICALL RT-PERFORM,V?EXAMINE,TH-SHAFT
	RTRUE
?L4:	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTR " down there."
?L3:	PRINTI "You cannot look down "
	ICALL1 RT-A-PRINT
	PRINTR "."

	.FUNCT V-LOOK-INSIDE,ODF
	ZERO? ODF /?L3
	CALL1 ODF >STACK
	ZERO? STACK \TRUE
?L3:	ZERO? GL-NOW-LIT? \?L7
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L7:	FSET? GL-PRSO,FL-PERSON \?L9
	ICALL2 RT-YOURE-NOT-A-MSG,STR?185
	RTRUE
?L9:	FSET? GL-PRSO,FL-ALIVE \?L10
	ICALL2 RT-YOURE-NOT-A-MSG,STR?186
	RTRUE
?L10:	FSET? GL-PRSO,FL-CONTAINER \?L11
	FSET? GL-PRSO,FL-OPENED /?L12
	FSET? GL-PRSO,FL-TRANSPARENT /?L12
	ICALL RT-YOUD-HAVE-TO-MSG,STR?108,GL-PRSO
	RTRUE
?L12:	PRINTI "In "
	ICALL1 RT-THEO-PRINT
	PRINTI " you see "
	ICALL2 RT-PRINT-CONTENTS-2,GL-PRSO
	PRINTR "."
?L11:	FSET? GL-PRSO,FL-DOOR \?L15
	FSET? GL-PRSO,FL-OPENED \?L16
	ICALL1 RT-CANT-SEE-MUCH-MSG
	RTRUE
?L16:	ICALL2 RT-ITS-CLOSED-MSG,GL-PRSO
	RTRUE
?L15:	PRINTI "You cannot look inside "
	ICALL1 RT-A-PRINT
	PRINTR "."

	.FUNCT V-LOOK-ON
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	FSET? GL-PRSO,FL-SURFACE \?L3
	PRINTI "On "
	ICALL1 RT-THEO-PRINT
	PRINTI " you see "
	ICALL2 RT-PRINT-CONTENTS-2,GL-PRSO
	PRINTR "."
?L3:	FSET? GL-PRSO,FL-READABLE \?L4
	ICALL1 RT-CTHEO-PRINT
	PRINTR " has something written on it."
?L4:	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTI " on "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-LOOK-OUTSIDE
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	EQUAL? GL-PRSO,ROOMS \?L3
	FSET? GL-PLACE-CUR,FL-INDOORS \?L4
	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTR " outside."
?L4:	PRINTR "You are outside."
?L3:	FSET? GL-PRSO,FL-DOOR \?L7
	FSET? GL-PRSO,FL-OPENED \?L8
	ICALL1 RT-CANT-SEE-MUCH-MSG
	RTRUE
?L8:	ICALL2 RT-ITS-CLOSED-MSG,GL-PRSO
	RTRUE
?L7:	PRINTI "You cannot look out of "
	ICALL1 RT-A-PRINT
	PRINTR "."

	.FUNCT V-LOOK-THRU
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	EQUAL? GL-P-PRSA-WORD,W?EXAMINE,W?X \?L3
	EQUAL? GL-PRSI,TH-STETHOSCOPE \?L3
	FSET? GL-PRSO,FL-PERSON \?L3
	CALL RT-PERFORM,V?LISTEN,GL-PRSO,GL-PRSI >STACK
	RSTACK
?L3:	ZERO? GL-PRSI /?L5
	FSET? GL-PRSI,FL-TRANSPARENT /?L4
	PRINTI "You can't look through "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L4:	ZERO? GL-PRSI /?L5
	FSET? GL-PRSI,FL-TRANSPARENT \?L5
	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTI " through "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L5:	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTR "at all."

	.FUNCT V-LOOK-THRU-SWP
	CALL RT-PERFORM,V?LOOK-THRU,GL-PRSI,GL-PRSO >STACK
	RSTACK

	.FUNCT V-LOOK-UNDER
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	IN? GL-PRSO,CH-PLAYER \?L3
	PRINTI "You are already "
	FSET? GL-PRSO,FL-WORN \?L4
	PRINTI "wearing"
	JUMP ?L6
?L4:	PRINTI "holding"
?L6:	PRINTR " that."
?L3:	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTI " under "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-LOOK-UP,X
	SET 'X,0
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	EQUAL? GL-PRSO,ROOMS \?L3
	FSET? GL-PLACE-CUR,FL-INDOORS \?L4
	PUTP TH-FLOOR-ETC,P?OBJ-NOUN,W?CEILING
	ICALL RT-PERFORM,V?EXAMINE,TH-FLOOR-ETC
	RTRUE
?L4:	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTR " up there."
?L3:	PRINTI "You cannot look up "
	ICALL1 RT-A-PRINT
	PRINTR "."

	.FUNCT V-LOOSEN
	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-LOWER
	EQUAL? GL-PRSO,ROOMS \?L1
	ICALL2 RT-DO-WALK,P?DOWN
	RTRUE
?L1:	ICALL1 V-RAISE
	RTRUE

	.FUNCT V-LAND
	EQUAL? GL-PRSO,ROOMS \?L1
	IN? CH-PLAYER,TH-BOAT \?L3
	ICALL1 RT-LAND-BOAT
	RTRUE
?L3:	PRINTR "Very good. Next week, we'll learn the word for water."
?L1:	EQUAL? GL-PRSO,TH-BOAT \?L6
	IN? CH-PLAYER,TH-BOAT \?L7
	ICALL1 RT-LAND-BOAT
	RTRUE
?L7:	PRINT K-MUST-BE-IN-BOAT-MSG
	PRINTR "land it."
?L6:	PRINTI "You can't land "
	ICALL1 RT-THEO-PRINT
	PRINTR "!"

	.FUNCT RT-LAND-BOAT
	IN? TH-BOAT,RM-THE-EMBANKMENT \?L1
	PRINTR "The boat is already on the Embankment."
?L1:	IN? TH-BOAT,RM-OUTSIDE-TRAITORS-GATE \?L3
	PRINTR "The boat is already at Traitors Gate."
?L3:	IN? TH-ANCHOR,TH-BOAT /?L4
	PRINTR "You can't land the boat. The anchor seems to be doing its job."
?L4:	IN? TH-BOAT,RM-THAMES-ONE \?L5
	ICALL SOUNDS,S-BOATING,S-STOP
	PRINTI "You land the boat on the Embankment."
	CRLF
	MOVE TH-BOAT,RM-THE-EMBANKMENT
	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	RTRUE
?L5:	IN? TH-BOAT,RM-THAMES-FOUR \?L6
	ICALL SOUNDS,S-BOATING,S-STOP
	PRINTI "You land the boat outside Traitors Gate."
	CRLF
	MOVE TH-BOAT,RM-OUTSIDE-TRAITORS-GATE
	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	RTRUE
?L6:	PRINTI "There doesn't seem to be any place to land the boat."
	CRLF
	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	RTRUE

	.FUNCT V-LAMP-OFF
	ICALL2 V-LAMP-ON,1
	RTRUE

	.FUNCT V-LAMP-ON,OFF?
	ASSIGNED? 'OFF? /?L12
	SET 'OFF?,0
?L12:	ICALL1 RT-CYOU-MSG
	PRINTI "couldn't "
	EQUAL? GL-P-PRSA-WORD,W?EXTINGUISH \?L1
	PRINTI "extinguish"
	JUMP ?L3
?L1:	PRINTB GL-P-PRSA-WORD
?L3:	PRINTI " that"
	ZERO? OFF? /?L13
	EQUAL? GL-P-PRSA-WORD,W?CLOSE,W?SHUT,W?TURN \?L4
	PRINTI " off"
	JUMP ?L7
?L4:	ZERO? OFF? /?L13
	EQUAL? GL-P-PRSA-WORD,W?BLOW,W?PUT \?L6
	PRINTI " out"
	JUMP ?L7
?L6:	ZERO? OFF? \?L7
?L13:	EQUAL? GL-P-PRSA-WORD,W?TURN \?L7
	PRINTI " on"
?L7:	EQUAL? GL-PRSI,0,TH-HANDS /?L9
	PRINTI ", "
	ICALL2 DPRINT,GL-PRSI
	PRINTI " or no "
	ICALL2 DPRINT,GL-PRSI
?L9:	PRINTR "."

	.FUNCT V-LAUNCH
	EQUAL? GL-PRSO,ROOMS \?L1
	IN? CH-PLAYER,TH-BOAT /?L5
	LOC TH-BOAT >STACK
	LOC CH-PLAYER >STACK
	EQUAL? STACK,STACK \?L3
?L5:	ICALL1 RT-LAUNCH-BOAT
	RTRUE
?L3:	PRINTR "That usually works better when one is in a boat."
?L1:	EQUAL? GL-PRSO,TH-BOAT \?L7
	ICALL1 RT-LAUNCH-BOAT
	RTRUE
?L7:	PRINTI "You can't launch "
	ICALL1 RT-THEO-PRINT
	PRINTR ". Perhaps you meant to throw it?"

	.FUNCT RT-LAUNCH-BOAT
	IN? TH-ANCHOR,TH-BOAT /?L1
	ICALL2 RT-THIS-IS-IT,TH-ANCHOR
	PRINTR "The anchor is restraining the boat."
?L1:	IN? CH-PLAYER,TH-BOAT /?L3
	PRINTI "You push the boat into the Thames, and then watch as it slowly floats away. Too bad you weren't in it."
	CRLF
	REMOVE TH-BOAT
	RTRUE
?L3:	IN? TH-BOAT,RM-THE-EMBANKMENT \?L4
	PRINTI "The boat slips away from the Embankment. You are now in the middle of the Thames."
	CRLF
	ICALL SOUNDS,S-BOATING,S-START
	MOVE TH-BOAT,RM-THAMES-ONE
	RTRUE
?L4:	IN? TH-BOAT,RM-OUTSIDE-TRAITORS-GATE \?L5
	PRINTI "The boat slips out into the river."
	CRLF
	ICALL SOUNDS,S-BOATING,S-START
	MOVE TH-BOAT,RM-THAMES-FOUR
	RTRUE
?L5:	PRINTR "You are already on the Thames. You don't need to launch the boat again."

	.FUNCT V-MAKE
	EQUAL? GL-PRSO,TH-RUBBINGS \?L1
	PRINTI "[To make a rubbing, put a blank piece of paper on a tomb, and then rub the paper with the crayon.]"
	CRLF
	RETURN 2
?L1:	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE

	.FUNCT V-ECHO
	EQUAL? GL-P-PRSA-WORD,W?MARX \?L1
	PRINTR "Cocoanuts."
?L1:	EQUAL? GL-P-PRSA-WORD,W?CHICO \?L3
	PRINTR """Wattsa matta you? You needa de password? I sell it you."""
?L3:	EQUAL? GL-P-PRSA-WORD,W?GROUCHO \?L4
	PRINTR """Say the secret woid, and the guy will let you in."""
?L4:	EQUAL? GL-P-PRSA-WORD,W?GUMMO \?L5
	PRINTR "This isn't a trivia game. Get back to work."
?L5:	EQUAL? GL-P-PRSA-WORD,W?HARPO \?L6
	CRLF
	RTRUE
?L6:	EQUAL? GL-P-PRSA-WORD,W?ZEPPO \?L7
	PRINTR "Did you really think saying ""Zeppo"" was going to get you anywhere?"
?L7:	EQUAL? GL-P-PRSA-WORD,W?PUNT \?L8
	PRINTR "But it's not even fourth down!"
?L8:	EQUAL? GL-P-PRSA-WORD,W?HUM,W?WHISTLE,W?SING \?L9
	PRINTI "You "
	PRINTB GL-P-PRSA-WORD
	PRINTR " tunelessly for a few moments until you remember that you're tone deaf and know next to nothing about music."
?L9:	EQUAL? GL-P-PRSA-WORD,W?ECHO \FALSE
	PRINTR "ECHO...Echo...echo...."

	.FUNCT V-MELT
	PRINT K-HOW-TO-MSG
	CRLF
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?187,STACK
	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
	ICALL PRINT-ID,STR?188,STACK
	CALL1 IS-SELF-OR-PART-OF-SELF? >STACK
	ICALL PRINT-ID,STR?189,STACK
	RTRUE

	.FUNCT V-MOVE
	EQUAL? GL-PRSO,ROOMS \?L1
	ICALL1 V-WALK-AROUND
	RTRUE
?L1:	FSET? GL-PRSO,FL-TAKEABLE \?L3
	PRINTI "Moving "
	ICALL1 RT-THEO-PRINT
	PRINTI " would"
	CALL2 RT-PICK-NEXT,GL-NO-POINT-TXT >STACK
	PRINT STACK
	PRINTR "."
?L3:	PRINTI "You cannot possibly move "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-MUNG
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?190,STACK
	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
	ICALL PRINT-ID,STR?191,STACK
	CALL1 IS-SELF-OR-PART-OF-SELF? >STACK
	ICALL PRINT-ID,STR?192,STACK
	ICALL2 RT-NO-POINT-MSG,STR?193
	RTRUE

	.FUNCT V-OPEN
	FSET? GL-PRSO,FL-OPENABLE /?L1
	ICALL1 RT-CANT-OPEN-PRSO-MSG
	RTRUE
?L1:	FSET? GL-PRSO,FL-OPENED \?L3
	ICALL2 RT-ITS-ALREADY-MSG,STR?108
	RTRUE
?L3:	FSET? GL-PRSO,FL-LOCKED \?L4
	ICALL1 RT-OBJECT-IS-LOCKED-MSG
	RTRUE
?L4:	ICALL1 RT-YOU-OPEN-MSG
	FSET? GL-PRSO,FL-CONTAINER \TRUE
	ZERO? GL-NOW-LIT? \?L8
	PRINTR "It is too dark to see inside."
?L8:	PRINTI "Inside you see "
	ICALL2 RT-PRINT-CONTENTS-2,GL-PRSO
	PRINTR "."

	.FUNCT V-OPEN-WITH
	FSET? GL-PRSO,FL-OPENABLE /?L1
	ICALL1 RT-CANT-OPEN-PRSO-MSG
	RTRUE
?L1:	FSET? GL-PRSO,FL-OPENED \?L3
	ICALL2 RT-ITS-ALREADY-MSG,STR?108
	RTRUE
?L3:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT V-PADDLE
	IN? GL-WINNER,TH-BOAT \?L1
	EQUAL? GL-PRSO,TH-BOAT,TH-INTDIR \?L3
	PRINT K-BETTER-SUCCESS-MSG
	CRLF
	RTRUE
?L3:	CALL1 V-HIT >STACK
	RSTACK
?L1:	EQUAL? GL-PRSO,TH-INTDIR \?L6
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTR "not in a boat."
?L6:	CALL1 V-HIT >STACK
	RSTACK

	.FUNCT V-PADDLE-WITH
	EQUAL? GL-PRSI,TH-VIOLIN \?L1
	PRINTR "How could you even THINK of using such a beautiful instrument in such a manner?"
?L1:	IN? GL-WINNER,TH-BOAT \?L3
	EQUAL? GL-PRSO,TH-INTDIR \?L4
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTR "not in a boat."
?L4:	PRINT K-BETTER-SUCCESS-MSG
	CRLF
	RTRUE
?L3:	EQUAL? GL-PRSO,TH-INTDIR \?L7
	ICALL1 RT-CYOU-MSG
	PRINTI "can't paddle anywhere with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L7:	CALL1 V-HIT >STACK
	RSTACK

	.FUNCT V-PASSWORD,WRD
	GET GL-P-NAMW,0 >WRD
	EQUAL? WRD,W?SWORDFISH \?L1
	CALL2 RT-PERFORM,V?SWORDFISH >STACK
	RSTACK
?L1:	EQUAL? WRD,W?PARR \?L3
	CALL2 RT-PERFORM,V?PARR >STACK
	RSTACK
?L3:	EQUAL? WRD,W?CLEVES \?L4
	CALL2 RT-PERFORM,V?CLEVES >STACK
	RSTACK
?L4:	EQUAL? WRD,W?ARAGON \?L5
	CALL2 RT-PERFORM,V?ARAGON >STACK
	RSTACK
?L5:	EQUAL? WRD,W?HOWARD \?L6
	CALL2 RT-PERFORM,V?HOWARD >STACK
	RSTACK
?L6:	EQUAL? WRD,W?SEYMOUR \?L7
	CALL2 RT-PERFORM,V?SEYMOUR >STACK
	RSTACK
?L7:	EQUAL? WRD,W?BOLEYN \?L8
	CALL2 RT-PERFORM,V?BOLEYN >STACK
	RSTACK
?L8:	EQUAL? WRD,W?GIN \?L9
	CALL2 RT-PERFORM,V?GIN >STACK
	RSTACK
?L9:	PRINTR """No, it isn't."""

	.FUNCT V-PAY
	ICALL RT-PERFORM,V?GIVE,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-PICK
	FSET? GL-PRSO,FL-OPENABLE \?L1
	FSET? GL-PRSO,FL-LOCKED /?L4
	PUSH 0
	JUMP ?L5
?L4:	EQUAL? GL-PRSO,LG-BANK-VAULT-DOOR,LG-LAIR-DOOR,LG-WESTMINSTER-DOOR /?L7
	EQUAL? GL-PRSO,LG-BRITISH-MUSEUM-DOOR,LG-PORTCULLIS-DOOR,LG-BAR-OF-GOLD-DOOR /?L7
	EQUAL? GL-PRSO,LG-JERICHO-PARLOUR-DOOR /?L9
	PUSH 0
	JUMP ?L5
?L9:	PUSH 1
	JUMP ?L5
?L7:	PUSH 1
?L5:	ICALL PRINT-ID,STR?194,STACK
	ICALL2 RT-YOURE-NOT-A-MSG,STR?195
	RTRUE
?L1:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-PLAY
	EQUAL? GL-PRSO,ROOMS \?L1
	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE
?L1:	ICALL2 RT-NO-POINT-MSG,STR?196
	RTRUE

	.FUNCT V-PLUG
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " into "
	ZERO? GL-PRSI /?L1
	ICALL1 RT-THEI-PRINT
	JUMP ?L3
?L1:	PRINTI "anything"
?L3:	PRINTR "."

	.FUNCT V-POCKET
	ICALL RT-PERFORM,V?PUT,GL-PRSO,TH-POCKET
	RTRUE

	.FUNCT V-POINT
	ICALL2 RT-NO-POINT-MSG,STR?197
	RTRUE

	.FUNCT V-POINT-AT
	ICALL2 RT-NO-POINT-MSG,STR?198
	RTRUE

	.FUNCT V-POINT-AT-SWP
	ICALL2 RT-NO-POINT-MSG,STR?198
	RETURN 2

	.FUNCT V-POUR
	EQUAL? GL-PRSO,TH-HANDS \?L1
	PRINTI "[To do that, just DROP EVERYTHING.]"
	CRLF
	RETURN 2
?L1:	EQUAL? GL-PRSO,TH-POCKET \?L3
	ICALL RT-YOUD-HAVE-TO-MSG,STR?199,TH-CLOTHES
	RTRUE
?L3:	FSET? GL-PRSO,FL-SURFACE \?L4
	ICALL2 RT-EMPTY-PRSO-MSG,0
	RTRUE
?L4:	FSET? GL-PRSO,FL-CONTAINER \?L5
	FSET? GL-PRSO,FL-OPENED \?L6
	ICALL2 RT-EMPTY-PRSO-MSG,0
	RTRUE
?L6:	ICALL1 RT-ITS-CLOSED-MSG
	RTRUE
?L5:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot empty "
	ICALL1 RT-SAY-HIM-HER-THEM-IT-MSG
	PRINTR "."

	.FUNCT V-POUR-FROM
	EQUAL? GL-PRSI,TH-HANDS \?L1
	ICALL RT-PERFORM,V?DROP,GL-PRSO
	RTRUE
?L1:	EQUAL? GL-PRSI,TH-POCKET \?L3
	ICALL RT-YOUD-HAVE-TO-MSG,STR?199,TH-CLOTHES
	RTRUE
?L3:	FSET? GL-PRSI,FL-CONTAINER /?L11
	FSET? GL-PRSI,FL-SURFACE /?L4
	PRINTI "You cannot"
	PRINTB GL-P-PRSA-WORD
	PRINTI " things from "
	ICALL2 RT-A-PRINT,GL-PRSI
	PRINTR "."
?L4:	FSET? GL-PRSI,FL-CONTAINER \?L5
?L11:	FSET? GL-PRSI,FL-OPENED /?L5
	ICALL2 RT-ITS-CLOSED-MSG,GL-PRSI
	RTRUE
?L5:	IN? GL-PRSO,GL-PRSI \?L6
	FSET? GL-PRSO,FL-TAKEABLE \?L7
	ICALL1 RT-CTHEO-PRINT
	PRINTI " "
	ICALL1 RT-LANDS-AT-YOUR-FEET-MSG
	RTRUE
?L7:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L6:	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSO
	PRINTI "in "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT V-PRAY
	PRINTR "Good idea. You could use the help."

	.FUNCT V-PULL
	ICALL2 RT-NO-POINT-MSG,STR?200
	RTRUE

	.FUNCT V-PUSH
	ICALL2 RT-NO-POINT-MSG,STR?201
	RTRUE

	.FUNCT V-PUSH-TO
	EQUAL? GL-PRSO,TH-HANDS \?L1
	ZERO? GL-PRSI /?L1
	ICALL RT-PERFORM,V?REACH-IN,GL-PRSI
	RTRUE
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot push "
	ICALL1 RT-THEO-PRINT
	PRINTR " around like that."

	.FUNCT V-PUT,L,WRD
	LOC GL-PRSO >L
	EQUAL? L,GLOBAL-OBJECTS \?L1
	PRINTI "That would"
	CALL1 RT-WASTE-OF-TIME-MSG >STACK
	RSTACK
?L1:	FSET? GL-PRSO,FL-BODYPART \?L3
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	CALL RT-IDENTIFY-FLOOR?,W?FLOOR,GL-PRSI >STACK
	ZERO? STACK \?L5
	CALL RT-IDENTIFY-FLOOR?,W?GROUND,GL-PRSI >STACK
	ZERO? STACK /?L4
?L5:	MOVE GL-PRSO,GL-PLACE-CUR
	ZERO? GL-P-MULT? /?L6
	PRINTR "Done."
?L6:	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	ICALL2 RT-IN-ON-MSG,GL-PRSI
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L4:	ZERO? L /?L10
	ZERO? GL-PRSI /?L9
	FSET? GL-PRSI,FL-SURFACE /?L9
	FSET? GL-PRSI,FL-CONTAINER /?L9
	FSET? GL-PRSI,FL-OPENED /?L11
	FSET? GL-PRSI,FL-OPENABLE /?L9
?L10:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L9:	FSET? GL-PRSI,FL-OPENED /?L11
	FSET? GL-PRSI,FL-SURFACE /?L11
	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSI
	PRINTR "open."
?L11:	CALL RT-ROOM-IN-ON-MSG?,GL-PRSO,GL-PRSI >STACK
	ZERO? STACK \TRUE
	EQUAL? L,GL-WINNER /?L13
	PRINTI "Maybe"
	ICALL1 RT-YOU-MSG
	PRINTI "should take "
	ICALL1 RT-THEO-PRINT
	ICALL2 RT-OUT-OFF-MSG,L
	ICALL2 RT-THEO-PRINT,L
	PRINTR " first."
?L13:	MOVE GL-PRSO,GL-PRSI
	FSET GL-PRSO,FL-TOUCHED
	FSET? GL-PRSI,FL-CONTAINER \?L15
	CALL2 RT-PUT-OUT,GL-PRSO >STACK
	ZERO? STACK \TRUE
?L15:	ZERO? GL-P-MULT? /?L17
	PRINTR "Done."
?L17:	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	ICALL2 RT-IN-ON-MSG,GL-PRSI
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT V-PUT-BEHIND
	PRINTR "That hiding place is too obvious."

	.FUNCT V-PUT-ON
	EQUAL? GL-PRSI,CH-ME,CH-PLAYER \?L1
	ICALL RT-PERFORM,V?WEAR,GL-PRSO
	RTRUE
?L1:	ICALL1 V-PUT
	RTRUE

	.FUNCT V-PUT-UNDER
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot put anything under "
	ICALL1 RT-SAY-HIM-HER-THEM-IT-MSG
	PRINTR "."

	.FUNCT V-QUESTION
	EQUAL? GL-WINNER,CH-PLAYER \?L1
	ICALL RT-TO-DO-THING-USE-MSG,STR?205,STR?204
	RETURN 2
?L1:	ICALL1 RT-NO-RESPONSE-MSG
	RTRUE

	.FUNCT V-RAISE
	EQUAL? GL-PRSO,ROOMS \?L1
	ICALL1 V-STAND
	RTRUE
?L1:	ICALL2 RT-NO-POINT-MSG,STR?206
	RTRUE

	.FUNCT V-REACH-IN,OBJ
	FIRST? GL-PRSO >OBJ /?L1
?L1:	FSET? GL-PRSO,FL-PERSON /?L4
	FSET? GL-PRSO,FL-ALIVE \?L2
?L4:	ICALL2 RT-YOURE-NOT-A-MSG,STR?185
	RTRUE
?L2:	FSET? GL-PRSO,FL-DOOR \?L5
	FSET? GL-PRSO,FL-OPENED \?L6
	PRINTI "You reach into "
	ICALL1 RT-THEO-PRINT
	PRINTI ", but experience nothing "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
	PRINTR "."
?L6:	ICALL1 RT-ITS-CLOSED-MSG
	RTRUE
?L5:	FSET? GL-PRSO,FL-CONTAINER /?L9
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L9:	FSET? GL-PRSO,FL-OPENED /?L10
	PRINTR "It's not open."
?L10:	ZERO? OBJ /?L12
	FSET? OBJ,FL-TAKEABLE /?L11
?L12:	FSET? GL-PRSO,FL-PLURAL \?L13
	FSET? GL-PRSO,FL-COLLECTIVE /?L13
	PRINTI "They're"
	JUMP ?L15
?L13:	PRINTI "It's"
?L15:	PRINTR " empty."
?L11:	SET 'GL-P-IT-OBJECT,OBJ
	PRINTI "You "
	EQUAL? GL-PRSO,TH-EARS \?L17
	PRINTI "put your hands to "
	JUMP ?L19
?L17:	PRINTI "reach into "
?L19:	ICALL1 RT-THEO-PRINT
	PRINTR ". There's something in there."

	.FUNCT V-READ
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	FSET? GL-PRSO,FL-READABLE /?L3
	ICALL1 RT-HOW-READ-MSG
	PRINTR "?"
?L3:	PRINTR "There's nothing written on it."

	.FUNCT V-READ-TO
	ZERO? GL-NOW-LIT? \?L1
	PRINT K-TOO-DARK-MSG
	CRLF
	RETURN 2
?L1:	FSET? GL-PRSO,FL-READABLE /?L3
	ICALL1 RT-HOW-READ-MSG
	PRINTI " to "
	ICALL2 RT-A-PRINT,GL-PRSI
	PRINTR "?"
?L3:	EQUAL? GL-WINNER,CH-PLAYER \?L4
	ICALL RT-NOT-LIKELY-MSG,GL-PRSI,STR?207
	RTRUE
?L4:	PRINTR "Maybe you ought to do it."

	.FUNCT V-READ-TO-SWP
	ICALL RT-PERFORM,V?READ-TO,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-REFUSE
	FSET? GL-PRSO,FL-TAKEABLE /?L1
	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE
?L1:	PRINTI "How could you turn down such a tempting "
	ICALL2 DPRINT,GL-PRSO
	PRINTR "?"

	.FUNCT V-RELEASE
	IN? GL-PRSO,GL-WINNER \?L1
	ICALL RT-PERFORM,V?DROP,GL-PRSO
	RTRUE
?L1:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L4
	PRINTI "You aren't "
	JUMP ?L6
?L4:	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
?L6:	PRINTR "confined by anything."

	.FUNCT V-REPAIR
	EQUAL? GL-PRSO,TH-LAMP,TH-ETHERIUM-AMPOULE \?L1
	FSET? GL-PRSO,FL-BROKEN \?L1
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is hopelessly beyond repair."
?L1:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L3
	PRINTI "You aren't "
	JUMP ?L4
?L3:	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
?L4:	PRINTR "in need of repair."

	.FUNCT V-REPLACE
	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L1
	PRINTR "Easily done."
?L1:	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-DONT-DOESNT-MSG,GL-PRSO
	PRINTR "need replacement."

	.FUNCT V-REPLY,WHO
	CALL1 RT-FOOLISH-TO-TALK-MSG >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	ICALL1 RT-NO-RESPONSE-MSG
	RTRUE

	.FUNCT V-RESCUE
	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L1
	EQUAL? GL-WINNER,CH-PLAYER \?L3
	ICALL1 V-HINT
	RTRUE
?L3:	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE
?L1:	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-DONT-DOESNT-MSG,GL-PRSO
	PRINTR "need any help."

	.FUNCT V-RIDE
	FSET? GL-PRSO,FL-ALIVE \?L1
	ICALL RT-NOT-LIKELY-MSG,GL-PRSO,STR?208
	RTRUE
?L1:	PRINTR "You cannot ride that."

	.FUNCT V-RING
	EQUAL? GL-PRSO,TH-BELL \?L1
	CALL2 RT-ALARM-SET?,RT-I-SWING-BELL >STACK
	ZERO? STACK /?L3
	PRINTR "The bell is already ringing."
?L3:	PRINTR "The bell is too heavy for you to move, but your effort makes it vibrate softly."
?L1:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-RIP,?TMP
	PRINTI "That would"
	CALL1 IS-PERSON? >?TMP
	ZERO? ?TMP /?L2
	PUSH ?TMP
	JUMP ?L1
?L2:	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
?L1:	ICALL PRINT-ID,STR?209,STACK
	CALL1 IS-SELF-OR-PART-OF-SELF? >STACK
	ICALL PRINT-ID,STR?210,STACK
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-ROB
	ICALL RT-PERFORM,V?STEAL,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-ROW
	IN? CH-PLAYER,TH-BOAT \?L1
	PRINTR "You'd have better success if you launched the boat first."
?L1:	EQUAL? GL-PRSO,TH-INTDIR \?L3
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTR "not in a boat."
?L3:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-RUB-WITH
	ICALL2 RT-NO-POINT-MSG,STR?211
	RTRUE

	.FUNCT V-SAY,WRD
	EQUAL? GL-WINNER,CH-PLAYER \?L1
	CALL1 RT-ANYONE-HERE? >STACK
	ZERO? STACK /?L3
	GET GL-P-NAMW,0 >WRD
	EQUAL? WRD,W?SWORDFISH \?L5
	ICALL2 RT-PERFORM,V?SWORDFISH
	RTRUE
?L5:	EQUAL? WRD,W?PARR \?L7
	ICALL2 RT-PERFORM,V?PARR
	RTRUE
?L7:	EQUAL? WRD,W?CLEVES \?L8
	ICALL2 RT-PERFORM,V?CLEVES
	RTRUE
?L8:	EQUAL? WRD,W?ARAGON \?L9
	ICALL2 RT-PERFORM,V?ARAGON
	RTRUE
?L9:	EQUAL? WRD,W?HOWARD \?L10
	ICALL2 RT-PERFORM,V?HOWARD
	RTRUE
?L10:	EQUAL? WRD,W?SEYMOUR \?L11
	ICALL2 RT-PERFORM,V?SEYMOUR
	RTRUE
?L11:	EQUAL? WRD,W?BOLEYN \?L12
	ICALL2 RT-PERFORM,V?BOLEYN
	RTRUE
?L12:	EQUAL? WRD,W?GIN \?L13
	ICALL2 RT-PERFORM,V?GIN
	RTRUE
?L13:	ICALL1 RT-WAY-TO-TALK-MSG
	RTRUE
?L3:	ICALL1 RT-TALK-TO-SELF-MSG
	RTRUE
?L1:	ICALL1 RT-NO-RESPONSE-MSG
	RTRUE

	.FUNCT V-SEARCH
	FSET? GL-PRSO,FL-CONTAINER \?L1
	FSET? GL-PRSO,FL-OPENED /?L3
	FSET? GL-PRSO,FL-TRANSPARENT /?L3
	ICALL RT-YOUD-HAVE-TO-MSG,STR?108,GL-PRSO
	RTRUE
?L3:	PRINTI "You see "
	ICALL2 RT-PRINT-CONTENTS-2,GL-PRSO
	PRINTI " inside "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L1:	FSET? GL-PRSO,FL-SURFACE \?L6
	PRINTI "You see "
	ICALL2 RT-PRINT-CONTENTS-2,GL-PRSO
	PRINTI " on "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L6:	FSET? GL-PRSO,FL-PERSON \?L7
	ICALL RT-PERFORM,V?USE,GL-PRSO
	RTRUE
?L7:	ICALL1 RT-NOTHING-INTERESTING-MSG
	PRINTR "."

	.FUNCT V-SELL
	EQUAL? GL-WINNER,CH-PLAYER /?L1
	ICALL RT-NOT-LIKELY-MSG,GL-WINNER,STR?212
	RTRUE
?L1:	EQUAL? GL-PRSI,GL-PRSO,CH-ME,CH-PLAYER /?L4
	EQUAL? GL-PRSI,GL-WINNER \?L3
?L4:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	FSET? GL-PRSI,FL-PERSON /?L5
	ICALL RT-NOT-LIKELY-MSG,GL-PRSI,STR?213
	RTRUE
?L5:	ICALL2 RT-YOURE-NOT-A-MSG,STR?214
	RTRUE

	.FUNCT V-SELL-SWP
	ICALL RT-PERFORM,V?SELL,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-SHAKE,X
	FSET? GL-PRSO,FL-PERSON \?L1
	ICALL RT-PERFORM,V?ALARM,GL-PRSO
	RTRUE
?L1:	FSET? GL-PRSO,FL-TAKEABLE /?L3
	FSET? GL-PRSO,FL-TRYTAKE /?L3
	ICALL2 RT-NO-POINT-MSG,STR?215
	RTRUE
?L3:	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-SHINE-AT
	PRINTI "You cannot illuminate anything with "
	ICALL2 RT-A-PRINT,GL-PRSO
	PRINTR "."

	.FUNCT V-SHINE-AT-SWP
	ICALL RT-PERFORM,V?SHINE-AT,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-SHOOT,NUM
	EQUAL? GL-PRSO,TH-GUN \?L1
	PRINTI "BANG!! The bullet barely misses your foot."
	CRLF
	ICALL2 PRINT-ID,STR?216
	RTRUE
?L1:	FSET? GL-PRSO,FL-PERSON /?L4
	EQUAL? GL-PRSO,TH-GENERIC-BODY \?L3
?L4:	FSET? GL-PRSO,FL-NEEDS-IDENTITY \?L5
	PUTP GL-PRSO,P?OBJ-NOUN,0
	PUTP GL-PRSO,P?OBJ-ADJ,0
?L5:	PRINTI "You shoot "
	EQUAL? GL-PRSO,TH-GENERIC-BODY /?L8
	PRINTI "and kill "
?L8:	ICALL2 RT-THEO-PRINT,GL-PRSO
	PRINTI ". Inspector Lestrade "
	IN? CH-PLAYER,TH-BOAT \?L11
	PRINTI "pulls up alongside you in a Scotland Yard launch"
	JUMP ?L13
?L11:	PRINTI "appears out of nowhere"
?L13:	PRINTI " and says,"
	EQUAL? GL-PRSO,CH-HOLMES \?L14
	PRINT K-PLUG-HIM-MYSELF-MSG
	ICALL2 PRINT-ID,STR?217
	JUMP ?L16
?L14:	PRINTI " ""You may be on our side, doctor, but killing people is still against the law. I'm afraid I'm going to have to arrest you."""
	ICALL2 PRINT-ID,STR?218
?L16:	CRLF
	CRLF
	PRINT K-LESTRADE-ARRESTS-MSG
	CRLF
	CRLF
	CALL1 RT-QSR >STACK
	RSTACK
?L3:	EQUAL? GL-PRSO,TH-SAPPHIRE,TH-EMERALD,TH-OPAL /?L18
	EQUAL? GL-PRSO,TH-RUBY,TH-TOPAZ,TH-GARNET \?L17
?L18:	REMOVE GL-PRSO
	PRINTI "You shoot "
	ICALL1 RT-THEO-PRINT
	PRINTI ", which shatters and disappears."
	CRLF
	CALL2 PRINT-ID,STR?219 >STACK
	RSTACK
?L17:	EQUAL? GL-PRSO,TH-CROWN-JEWELS \?L19
	PRINTI "The jewels shatter and Holmes throws up his arms in exasperation. ""That's it, Watson. You have pushed me to the limit."" He leaps for your throat, and the ensuing struggle attracts the attention of the local constabulary, with what should by now be predictable results."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?220
	CALL1 RT-QSR >STACK
	RSTACK
?L19:	EQUAL? GL-PRSO,TH-SHAFT /?L21
	EQUAL? GL-PRSO,PSEUDO-OBJECT \?L20
	GETP PSEUDO-OBJECT,P?ACTION >STACK
	EQUAL? STACK,RT-AC-TH-FIREPLACE \?L20
?L21:	PRINTI "The bullet disappears into "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
	CALL2 PRINT-ID,STR?221 >STACK
	RSTACK
?L20:	EQUAL? GL-PRSO,TH-INTNUM,TH-INTDIR /?L23
	IN? GL-PRSO,ROOMS \?L22
?L23:	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L22:	FSET? GL-PRSO,FL-PLURAL \?L24
	PRINTI "There are so many of them, you don't know where to begin."
	CRLF
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?222,STACK
	CALL1 IS-OBJ-PROP-ANIMAL? >STACK
	CALL PRINT-ID,STR?223,STACK >STACK
	RSTACK
?L24:	FSET? GL-PRSO,FL-MONEY \?L25
	PRINTI "You take aim at "
	ICALL1 RT-THEO-PRINT
	PRINTR ", but your frugal nature prevents you from going through with it."
?L25:	GET GL-HOLES,0 >NUM
	MUL NUM,2 >STACK
	INC 'STACK
	PUT GL-HOLES,STACK,GL-PRSO
	LOC GL-PRSO >STACK
	EQUAL? STACK,LOCAL-GLOBALS,ROOMS,GLOBAL-OBJECTS \?L27
	MUL NUM,2 >STACK
	ADD STACK,2 >STACK
	PUT GL-HOLES,STACK,GL-PLACE-CUR
?L27:	ADD NUM,1 >STACK
	PUT GL-HOLES,0,STACK
	PRINTI "The bullet puts a neat hole in "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-SHOOT-SWP
	ICALL RT-PERFORM,V?SHOOT,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-SHOW
	FSET? GL-PRSI,FL-ASLEEP \?L1
	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSI
	PRINTI "in no condition to appreciate "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L1:	EQUAL? GL-PRSI,CH-ME,CH-PLAYER \?L3
	ICALL RT-PERFORM,V?EXAMINE,GL-PRSO
	RTRUE
?L3:	ICALL1 RT-CTHEI-PRINT
	PRINTI " glance"
	ICALL2 RT-S-NOS-MSG,GL-PRSI
	PRINTI " at "
	ICALL1 RT-THEO-PRINT
	PRINTR ", but makes no comment."

	.FUNCT V-SHOW-SWP
	ICALL RT-PERFORM,V?SHOW,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-SIT
	CALL RT-IDENTIFY-FLOOR?,W?GROUND,GL-PRSO >STACK
	ZERO? STACK \?L3
	CALL RT-IDENTIFY-FLOOR?,W?FLOOR,GL-PRSO >STACK
	ZERO? STACK \?L3
	EQUAL? GL-PRSO,ROOMS /?L3
	FSET? GL-PRSO,FL-SURFACE \?L1
?L3:	PRINT K-NO-RESTING-MSG
	CRLF
	RTRUE
?L1:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-SMELL,OBJ
	SET 'OBJ,0
	CALL RT-IDENTIFY-FLOOR?,W?SKY,GL-PRSO >STACK
	ZERO? STACK \?L3
	EQUAL? GL-PRSO,ROOMS \?L1
?L3:	PRINTI "You do not smell anything "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
	PRINTR "."
?L1:	EQUAL? GL-PRSO,TH-BUNG,TH-MALMSEY,TH-MALMSEY-POOL /?L5
	EQUAL? GL-PRSO,TH-BUTT-OF-MALMSEY,TH-GARNET \?L4
?L5:	PRINT K-EAU-DE-MSG
	CRLF
	RTRUE
?L4:	PRINTI "It smells just like "
	ICALL2 RT-A-PRINT,GL-PRSO
	PRINTR "."

	.FUNCT V-SMOKE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot smoke "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-SPIN
	EQUAL? GL-PRSO,ROOMS \?L1
	PRINT K-DIZZY-MSG
	CRLF
	RTRUE
?L1:	PRINTI "You cannot spin "
	ICALL1 RT-SAY-HIM-HER-THEM-IT-MSG
	PRINTR "."

	.FUNCT V-STAND
	PRINTR "You are already standing."

	.FUNCT V-STAND-ON
	PRINTI "Standing on "
	ICALL1 RT-THEO-PRINT
	PRINTI " would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-STAND-UNDER
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-STEAL
	PRINT K-THEFT-MSG
	CRLF
	ICALL2 PRINT-ID,STR?224
	RTRUE

	.FUNCT V-STRIKE
	ICALL1 V-HIT
	RTRUE

	.FUNCT V-SWIM
	EQUAL? GL-PRSO,ROOMS \?L1
	EQUAL? GL-PLACE-CUR,RM-THE-EMBANKMENT,RM-SWAN-LANE,RM-LONDON-BRIDGE \?L3
	PRINTI "Yuck! Have you looked at that water?"
	CRLF
	ICALL2 PRINT-ID,STR?225
	RTRUE
?L3:	PRINT K-NO-SWIM-MSG
	CRLF
	RTRUE
?L1:	EQUAL? GL-PRSO,TH-INTDIR \?L6
	ZERO? GL-P-DIRECTION /?L6
	EQUAL? GL-WINNER,CH-PLAYER \?L6
	PRINTI "You cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTR " that way from here."
?L6:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-SWING
	ZERO? GL-PRSI \?L1
	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE
?L1:	ICALL RT-PERFORM,V?KILL,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-TAKE,L
	LOC GL-PRSO >STACK
	EQUAL? GLOBAL-OBJECTS,STACK \?L1
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	ZERO? GL-PRSI /?L3
	LOC GL-PRSI >STACK
	EQUAL? GLOBAL-OBJECTS,STACK \?L7
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	FSET? GL-PRSO,FL-WORN \?L7
	ICALL RT-PERFORM,V?TAKE-OFF,GL-PRSO
	RTRUE
?L7:	CALL1 RT-ITAKE >L
	ZERO? L /TRUE
	ZERO? GL-P-MULT? /?L11
	PRINTI "Taken."
	CRLF
	CALL1 IS-THEFT? >STACK
	ICALL PRINT-ID,STR?226,STACK
	JUMP ?L15
?L11:	FSET? L,FL-CONTAINER /?L14
	FSET? L,FL-SURFACE /?L14
	FSET? L,FL-PERSON /?L14
	FSET? L,FL-ALIVE \?L13
?L14:	ICALL RT-CYOU-MSG,STR?228,STR?227
	ICALL1 RT-THEO-PRINT
	ICALL2 RT-OUT-OFF-MSG,L
	ICALL2 RT-THEO-PRINT,L
	PRINTI "."
	CRLF
	JUMP ?L15
?L13:	ICALL RT-CYOU-MSG,STR?228,STR?227
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
?L15:	GETP GL-PRSO,P?VALUE >L
	ZERO? L /TRUE
	PUTP GL-PRSO,P?VALUE,0
	ICALL1 RT-TOPAZ-MSG
	ICALL2 RT-UPDATE-SCORE,L
	ICALL1 RT-UPDATE-STATUS-LINE
	RTRUE

	.FUNCT V-TAKE-OFF
	EQUAL? GL-PRSO,TH-CLOTHES,TH-FEET \?L1
	PRINT K-INAPPROPRIATE-MSG
	CRLF
	RTRUE
?L1:	FSET? GL-PRSO,FL-TAKEABLE \?L3
	IN? GL-PRSO,GL-WINNER \?L4
	FSET? GL-PRSO,FL-WORN \?L4
	FCLEAR GL-PRSO,FL-WORN
	PRINTI "You take off "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L4:	ICALL RT-PERFORM,V?TAKE,GL-PRSO
	RTRUE
?L3:	FSET? GL-PRSO,FL-VEHICLE \?L7
	ICALL RT-PERFORM,V?EXIT,GL-PRSO
	RTRUE
?L7:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-TAKE-WITH
	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE

	.FUNCT V-TASTE
	ICALL RT-PERFORM,V?EAT,GL-PRSO
	RTRUE

	.FUNCT V-TELL,N,M,WRD
	CALL1 RT-FOOLISH-TO-TALK-MSG >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L3
	EQUAL? GL-WINNER,CH-PLAYER \?L4
	ICALL1 RT-TALK-TO-SELF-MSG
	RTRUE
?L4:	ICALL1 RT-NO-RESPONSE-MSG
	RTRUE
?L3:	SET 'GL-P-QCONTEXT-TH,GL-PRSO
	LOC GL-PRSO >GL-P-QCONTEXT-RM
	ZERO? GL-P-CONT /?L8
	SET 'GL-WINNER,GL-PRSO
	ICALL2 RT-THIS-IS-IT,GL-PRSO
	SET 'GL-CLOCK-WAIT,1
	SET 'N,GL-P-CONT
	SET 'M,GL-P-LEN
?L10:	GET GL-P-P-LEX,N >WRD
	EQUAL? WRD,W?$QUOTE \?L12
	PUT GL-P-P-LEX,N,W?THE
	JUMP ?L14
?L12:	EQUAL? WRD,W?THEN,W?$PERIOD /TRUE
?L14:	ADD N,K-P-LEXELEN >N
	DLESS? 'M,1 \?L10
	RTRUE
?L8:	ICALL1 RT-NO-RESPONSE-MSG
	RTRUE

	.FUNCT V-TELL-ABOUT
	CALL1 RT-WHO-WHAT-WHERE-MSG >STACK
	ZERO? STACK /TRUE
	RETURN 2

	.FUNCT V-TELL-WHO
	PRINTR "You must use TELL ME ABOUT SOMETHING or TELL CHARACTER ABOUT SOMETHING."

	.FUNCT V-THANK
	CALL1 RT-ANYONE-HERE? >STACK
	ZERO? STACK \?L1
	PRINTR "[There's nobody here to thank.]"
?L1:	EQUAL? GL-WINNER,CH-PLAYER \?L3
	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L4
	PRINTI "Patting yourself on the back"
	PRINT K-WONT-HELP-MSG
	CRLF
	RTRUE
?L4:	FSET? GL-PRSO,FL-ASLEEP \?L6
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSO
	PRINTR "in any condition to accept your thanks."
?L6:	PRINTR """You're welcome."""
?L3:	ICALL1 RT-FOOLISH-TO-TALK-MSG
	RTRUE

	.FUNCT V-THROUGH
	EQUAL? GL-PRSO,ROOMS \?L1
	ICALL2 RT-DO-WALK,P?IN
	RTRUE
?L1:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-THROW
	EQUAL? GL-P-PRSA-WORD,W?PUT \?L1
	EQUAL? GL-PRSO,TH-HANDS,TH-FEET \?L1
	FSET? GL-PRSI,FL-DOOR \?L3
	FSET? GL-PRSI,FL-OPENED \?L5
	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	PRINTI " through "
	ICALL1 RT-THEI-PRINT
	PRINTR ", but can't reach anything on the other side."
?L5:	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSI
	PRINTR "closed."
?L3:	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	IN? GL-PRSO,GLOBAL-OBJECTS \?L9
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L9:	CALL1 RT-IDROP-MSG >STACK
	ZERO? STACK /TRUE
	FSET? CH-HOLMES,FL-ASLEEP \?L20
	EQUAL? GL-PRSI,CH-HOLMES,TH-PHIAL,TH-SYRINGE /?L13
	EQUAL? GL-PRSI,TH-MOROCCO-CASE \?L20
?L13:	EQUAL? GL-PRSO,TH-KNIFE \?L14
	EQUAL? GL-PRSI,CH-HOLMES \?L16
	PRINTI "Holmes absentmindedly dodges the knife"
	ICALL2 PRINT-ID,STR?229
	JUMP ?L18
?L16:	EQUAL? GL-PRSI,TH-PHIAL,TH-SYRINGE,TH-MOROCCO-CASE \?L18
	PRINTI "Holmes casually moves "
	ICALL1 RT-THEI-PRINT
	PRINTI " out of harm's way"
	ICALL2 PRINT-ID,STR?230
?L18:	PRINTR " and continues staring at the phial."
?L14:	PRINTI "Holmes absentmindedly catches "
	ICALL1 RT-THEO-PRINT
	PRINTI " with his free hand and bops you over the head with it before letting it fall to the ground. He then continues staring at the phial."
	CRLF
	ICALL2 PRINT-ID,STR?231
	RTRUE
?L20:	ICALL1 RT-CTHEO-PRINT
	PRINTI " miss"
	ICALL2 RT-ES-NOES-MSG,GL-PRSO
	PRINTI " "
	ICALL1 RT-THEI-PRINT
	PRINTI " by a mile and land"
	ICALL2 RT-S-NOS-MSG,GL-PRSI
	EQUAL? GL-PLACE-CUR,RM-THAMES-ONE,RM-THAMES-TWO,RM-THAMES-THREE /?L24
	EQUAL? GL-PLACE-CUR,RM-THAMES-FOUR,RM-THAMES-FIVE \?L22
?L24:	PRINTI " in the water."
	MOVE GL-PRSO,LG-WATER
	EQUAL? GL-PRSO,CH-TRAINED-PIGEON \?L25
	ICALL1 RT-KILL-PIGEON
?L25:	PRINTR " Plop."
?L22:	PRINTI " on the "
	FSET? GL-PLACE-CUR,FL-INDOORS \?L29
	PRINTI "floor"
	JUMP ?L31
?L29:	PRINTI "ground"
?L31:	PRINTR " nearby."

	.FUNCT V-THROW-SWP
	ICALL RT-PERFORM,V?THROW,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-THROW-OVER
	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-TIE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot possibly tie "
	ICALL1 RT-THEO-PRINT
	ZERO? GL-PRSI /?L1
	PRINTI " to "
	ICALL1 RT-THEI-PRINT
?L1:	PRINTR "."

	.FUNCT V-TIE-UP
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot tie up "
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?232,STACK
	EQUAL? GL-PRSI,0,ROOMS \?L1
	PRINTI "that"
	JUMP ?L3
?L1:	PRINTI "anything with "
	ICALL1 RT-THEI-PRINT
?L3:	PRINTR "."

	.FUNCT V-TIP
	FSET? GL-PRSO,FL-PERSON \?L1
	ICALL RT-CYOU-MSG,STR?234,STR?233
	PRINTI "confidentially, ""Buy low, sell high."""
	CRLF
	CRLF
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-DONT-DOESNT-MSG,GL-PRSO
	PRINTR "look impressed."
?L1:	ICALL1 RT-CYOU-MSG
	PRINTR "can't do that."

	.FUNCT V-TOUCH
	CALL1 IS-PERSON? >STACK
	ICALL PRINT-ID,STR?235,STACK
	ICALL2 RT-NO-POINT-MSG,STR?236
	RTRUE

	.FUNCT V-TOUCH-TO
	EQUAL? GL-PRSO,TH-HANDS \?L1
	ICALL RT-PERFORM,V?TOUCH,GL-PRSI
	RTRUE
?L1:	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	PRINTI " next to "
	ICALL1 RT-THEI-PRINT
	PRINTI ", but nothing "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
	PRINTR " happens."

	.FUNCT V-TOUCH-TO-SWP
	ICALL RT-PERFORM,V?TOUCH-TO,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-TRANSLATE
	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE

	.FUNCT V-TUNE-TO
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT V-TURN
	FSET? GL-PRSO,FL-TAKEABLE /?L1
	FSET? GL-PRSO,FL-TRYTAKE /?L1
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	ICALL2 RT-NO-POINT-MSG,STR?237
	RTRUE

	.FUNCT V-TURN-DOWN
	ICALL1 V-REFUSE
	RTRUE

	.FUNCT V-TURN-TO
	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK /?L1
	ICALL RT-PERFORM,V?WATCH,GL-PRSO
	RTRUE
?L1:	ICALL RT-CYOU-MSG,STR?136,STR?135
	PRINTI "see "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-TURN-UP
	ICALL1 V-LOOK-UNDER
	RTRUE

	.FUNCT V-UNDRESS
	EQUAL? GL-PRSO,ROOMS /?L3
	FSET? GL-PRSO,FL-PERSON \?L1
?L3:	PRINT K-INAPPROPRIATE-MSG
	CRLF
	ICALL2 PRINT-ID,STR?238
	RTRUE
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot undress "
	ICALL2 RT-A-PRINT,GL-PRSO
	PRINTR "."

	.FUNCT V-UNFOLD
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	PRINTR "folded up."

	.FUNCT V-UNLOCK
	FSET? GL-PRSO,FL-OPENABLE /?L3
	FSET? GL-PRSO,FL-CONTAINER \?L1
?L3:	FSET? GL-PRSO,FL-OPENED /?L6
	FSET? GL-PRSO,FL-LOCKED /?L4
?L6:	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	PRINTR "locked."
?L4:	ICALL RT-THING-WONT-LOCK-MSG,GL-PRSI,GL-PRSO,1
	RTRUE
?L1:	ICALL2 RT-CANT-LOCK-MSG,1
	RTRUE

	.FUNCT V-UNPLUG
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	PRINTI "connected to "
	ZERO? GL-PRSI /?L1
	ICALL1 RT-THEI-PRINT
	JUMP ?L3
?L1:	PRINTI "anything"
?L3:	PRINTR "."

	.FUNCT V-UNSCREW-FROM
	EQUAL? GL-PRSO,GL-PRSI \?L1
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	IN? GL-PRSO,GL-PRSI /?L3
	FSET? GL-PRSI,FL-ALIVE \?L4
	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-DONT-DOESNT-MSG,GL-PRSI
	PRINTI "have "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L4:	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	ICALL RT-IN-ON-MSG,GL-PRSI,0
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L3:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot unscrew "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-UNTIE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot untie "
	ICALL2 RT-A-PRINT,GL-PRSO
	PRINTR "."

	.FUNCT V-USE
	FSET? GL-PRSO,FL-PERSON \?L1
	ICALL1 RT-CTHEO-PRINT
	PRINTR " might resent that."
?L1:	PRINTI "[You must specify what you want to do with "
	ICALL1 RT-THEO-PRINT
	PRINTR ".]"

	.FUNCT V-USE-ON
	PRINTI "Using "
	ICALL1 RT-THEO-PRINT
	PRINTI " on "
	ICALL1 RT-THEI-PRINT
	PRINTI " would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE

	.FUNCT V-WAIT,H,M,S,N
	EQUAL? GL-P-NUMBER,-1 \?L1
	SET 'N,1
	JUMP ?L3
?L1:	SET 'N,GL-P-NUMBER
?L3:	EQUAL? GL-PRSO,TH-TIME \?L4
	GETP GL-PRSO,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?MINUTE,W?MINUTES \?L6
	SET 'H,0
	SET 'M,N
	JUMP ?L14
?L6:	SET 'H,N
	SET 'M,0
	JUMP ?L14
?L4:	EQUAL? GL-PRSO,TH-INTNUM \?L9
	SET 'H,0
	SET 'M,N
	PRINTI "["
	PRINTN M
	PRINTI " minute"
	EQUAL? M,1 /?L10
	PRINTI "s"
?L10:	PRINTI "]"
	CRLF
	CRLF
	JUMP ?L14
?L9:	EQUAL? GL-PRSO,ROOMS /?L13
	ICALL1 RT-CYOU-MSG
	PRINTR "can't wait for that."
?L13:	SET 'H,0
	SET 'M,10
?L14:	SET 'S,0
	PRINTI "Time passes..."
	CRLF
	ICALL RT-CLOCK-JMP,H,M,S
	ICALL2 RT-TIME-OF-DAY-MSG,1
	RTRUE

	.FUNCT V-WALK,PT,PTS,STR,OBJ,RM
	GETPT GL-PLACE-CUR,GL-PRSO >PT
	ZERO? GL-P-WALK-DIR \?L1
	PRINTR "[You must specify a direction.]"
?L1:	ZERO? PT /?L3
	PTSIZE PT >PTS
	EQUAL? PTS,K-UEXIT \?L4
	LOC GL-WINNER >STACK
	FSET? STACK,FL-VEHICLE \?L8
	LOC GL-WINNER >STACK
	ICALL RT-PERFORM,V?EXIT,STACK
	LOC GL-WINNER >STACK
	FSET? STACK,FL-VEHICLE \?L8
	RETURN 2
?L8:	GETB PT,K-REXIT >RM
	ICALL2 RT-GOTO,RM
	RTRUE
?L4:	EQUAL? PTS,K-NEXIT \?L12
	GET PT,K-NEXITSTR >STR
	PRINT STR
	CRLF
	RETURN 2
?L12:	EQUAL? PTS,K-PEXIT \?L13
	GET PT,K-PEXITRTN >STACK
	CALL1 STACK >RM
	ZERO? RM /?L14
	ICALL2 RT-GOTO,RM
	RTRUE
?L14:	RETURN 2
?L13:	EQUAL? PTS,K-CEXIT \?L17
	GETB PT,K-CEXITFLG >STACK
	VALUE STACK >STACK
	ZERO? STACK /?L18
	GETB PT,K-REXIT >RM
	ICALL2 RT-GOTO,RM
	RTRUE
?L18:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot go that way."
	CRLF
	RETURN 2
?L17:	EQUAL? PTS,K-DEXIT \FALSE
	LOC GL-WINNER >STACK
	FSET? STACK,FL-VEHICLE \?L24
	LOC GL-WINNER >STACK
	ICALL RT-PERFORM,V?EXIT,STACK
	LOC GL-WINNER >STACK
	FSET? STACK,FL-VEHICLE \?L24
	RETURN 2
?L24:	ADD PT,1 >STACK
	GET STACK,0 >OBJ
	FSET? OBJ,FL-OPENED \?L28
	GETB PT,K-REXIT >RM
	ICALL2 RT-GOTO,RM
	RTRUE
?L28:	PRINTI "The door is not open."
	CRLF
	RETURN 2
?L3:	EQUAL? GL-P-WALK-DIR,P?OUT \?L32
	FSET? GL-PLACE-CUR,FL-INDOORS /?L32
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "already outside."
	CRLF
	RETURN 2
?L32:	EQUAL? GL-P-WALK-DIR,P?IN \?L33
	FSET? GL-PLACE-CUR,FL-INDOORS \?L33
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "already inside."
	CRLF
	RETURN 2
?L33:	PRINTI "You cannot go that way."
	CRLF
	RETURN 2

	.FUNCT V-WALK-AROUND
	PRINTI "[Which way do you want to go?]"
	CRLF
	RETURN 2

	.FUNCT V-WALK-TO
	EQUAL? GL-PRSO,TH-INTDIR \?L1
	ICALL2 RT-DO-WALK,GL-P-DIRECTION
	RTRUE
?L1:	EQUAL? GL-PRSO,TH-RIGHT,TH-LEFT /?L4
	IN? GL-PRSO,ROOMS \?L3
?L4:	PRINT K-BE-MORE-SPECIFIC-MSG
	CRLF
	RTRUE
?L3:	ICALL1 V-FOLLOW
	RTRUE

	.FUNCT V-WATCH
	FSET? GL-PRSO,FL-PERSON \?L1
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	PRINTI "doing anything "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
	JUMP ?L3
?L1:	PRINTI "Nothing "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
	PRINTI " is happening"
?L3:	PRINTR "."

	.FUNCT V-WAVE-AT
	CALL1 RT-WHO-WHAT-WHERE-MSG >STACK
	ZERO? STACK /TRUE
	RETURN 2

	.FUNCT V-WEAR
	IN? GL-PRSO,GL-WINNER \?L4
	FSET? GL-PRSO,FL-WORN /?L3
?L4:	EQUAL? GL-PRSO,TH-CLOTHES \?L1
?L3:	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "already wearing "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L1:	FSET? GL-PRSO,FL-CLOTHING /?L5
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot wear "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L5:	CALL2 RT-DONT-HAVE-MSG,GL-PRSO >STACK
	ZERO? STACK \TRUE
	FSET GL-PRSO,FL-WORN
	ICALL RT-CYOU-MSG,STR?203,STR?202
	PRINTI "on "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT V-WEDGE
	ICALL RT-PERFORM,V?LOOSEN,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-WEIGH
	PRINTR "You haven't got any scales to weigh things with."

	.FUNCT V-WHAT
	CALL1 RT-WHO-WHAT-WHERE-MSG >STACK
	ZERO? STACK /TRUE
	RETURN 2

	.FUNCT V-WHERE
	CALL1 RT-WHO-WHAT-WHERE-MSG >STACK
	ZERO? STACK /TRUE
	RETURN 2

	.FUNCT V-WHO
	CALL1 RT-WHO-WHAT-WHERE-MSG >STACK
	ZERO? STACK /TRUE
	RETURN 2

	.FUNCT V-WIND
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot wind "
	ICALL2 RT-A-PRINT,GL-PRSO
	PRINTR "."

	.FUNCT V-WRAP-AROUND
	ICALL1 RT-CYOU-MSG
	PRINTI "could not possibly "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " around "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT V-WRAP-AROUND-SWP
	ICALL RT-PERFORM,V?WRAP-AROUND,GL-PRSI,GL-PRSO
	RTRUE

	.FUNCT V-YELL
	EQUAL? GL-PRSO,ROOMS \?L1
	EQUAL? GL-P-PRSA-WORD,W?CRY \?L3
	PRINTR "Awww. Don't cry. You'll figure it out eventually."
?L3:	PRINTR "The idea of the primal scream as a technique to relieve anxiety will not be discovered for eighty years. But if it makes you feel better, go right ahead."
?L1:	ICALL RT-NOT-LIKELY-MSG,GL-PRSO,STR?111
	RTRUE

	.FUNCT RT-CANT-SEE-MUCH-MSG
	ICALL1 RT-CYOU-MSG
	PRINTR "cannot see much from here."

	.FUNCT RT-NO-MONEY-MSG
	ICALL RT-CYOU-MSG,STR?136,STR?135
	PRINTR "have any money."

	.FUNCT RT-IN-VEHICLE-MSG
	IN? CH-PLAYER,TH-HANSOM-CAB /?L3
	IN? CH-PLAYER,TH-GROWLER-CAB \?L1
?L3:	PRINTI " in a cab "
	RTRUE
?L1:	IN? CH-PLAYER,TH-BOAT \?L4
	PRINTI " in a boat "
	RTRUE
?L4:	PRINTI " standing "
	RTRUE

	.FUNCT RT-DRIVE-WALK-MSG?
	IN? CH-PLAYER,TH-HANSOM-CAB /?L3
	IN? CH-PLAYER,TH-GROWLER-CAB \?L1
?L3:	PRINTI " drive "
	RTRUE
?L1:	PRINTI " walk "
	RTRUE

	.FUNCT RT-ALREADY-IN-ROOM-MSG
	PRINTI "You are already in "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT RT-NOT-IN-ROOM-MSG
	PRINTI "You are not in "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT RT-OBJECT-IS-LOCKED-MSG
	ICALL1 RT-CYOU-MSG
	PRINTR "cannot do that. It is locked."

	.FUNCT RT-NOTHING-INTERESTING-MSG
	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTI "not see anything "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
	RTRUE

	.FUNCT RT-WASTE-OF-TIME-MSG
	CALL2 RT-PICK-NEXT,GL-NO-POINT-TXT >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT RT-FOG-MSG
	CALL2 RT-PICK-NEXT,GL-FOG-TXT >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT RT-ITS-RIGHT-HERE-MSG
	ICALL1 RT-SAY-ITS-MSG
	PRINTR "right here in front of you."

	.FUNCT RT-WHO-WHAT-WHERE-MSG
	CALL1 RT-FOOLISH-TO-TALK-MSG >STACK
	ZERO? STACK \TRUE
	EQUAL? GL-PRSA,V?WHO,V?WHAT,V?WHERE \?L4
	PUSH GL-WINNER
	JUMP ?L5
?L4:	PUSH 0
?L5:	ICALL2 RT-NO-RESPONSE-MSG,STACK
	RFALSE

	.FUNCT RT-HI-BYE-MSG
	CALL1 RT-FOOLISH-TO-TALK-MSG >STACK
	ZERO? STACK /?L1
	RETURN 2
?L1:	EQUAL? GL-PRSO,ROOMS \?L3
	ICALL1 RT-TALK-TO-SELF-MSG
	RTRUE
?L3:	ICALL1 RT-NO-RESPONSE-MSG
	RTRUE

	.FUNCT RT-NO-RESPONSE-MSG,WHO
	ASSIGNED? 'WHO /?L4
	SET 'WHO,0
?L4:	ZERO? WHO \?L1
	SET 'WHO,GL-PRSO
?L1:	ICALL2 RT-CTHEO-PRINT,WHO
	ICALL2 RT-DONT-DOESNT-MSG,WHO
	PRINTR "respond."

	.FUNCT RT-TAKE-OFF-PRSO-FIRST-MSG
	PRINTI "[taking off "
	ICALL1 RT-THEO-PRINT
	PRINTI " first]"
	CRLF
	FCLEAR GL-PRSO,FL-WORN
	EQUAL? GL-PRSO,TH-WATSONS-HAT \?L1
	FSET TH-WATSONS-HAT,FL-OPENED
	RTRUE
?L1:	EQUAL? GL-PRSO,TH-SUIT-OF-ARMOUR \TRUE
	MOVE TH-SUIT-OF-ARMOUR,GL-PLACE-CUR
	RTRUE

	.FUNCT RT-SAY-DROPPED-MSG
	ZERO? GL-P-MULT? /?L1
	PRINTR "Dropped."
?L1:	ICALL RT-CYOU-MSG,STR?240,STR?239
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT RT-FOOLISH-TO-TALK-MSG
	EQUAL? GL-WINNER,CH-ME,CH-PLAYER /?L1
	ICALL2 RT-CTHEO-PRINT,GL-WINNER
	ICALL2 RT-DONT-DOESNT-MSG,GL-WINNER
	PRINTR "respond."
?L1:	EQUAL? GL-PRSO,0,ROOMS /FALSE
	FSET? GL-PRSO,FL-ALIVE /?L4
	ICALL RT-NOT-LIKELY-MSG,GL-PRSO,STR?111
	ICALL1 RT-P-CLEAR
	RTRUE
?L4:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER,GL-PRSI /?L6
	EQUAL? GL-PRSO,GL-WINNER \?L5
?L6:	PRINTI "That would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	ICALL1 RT-P-CLEAR
	RTRUE
?L5:	ICALL2 RT-THIS-IS-IT,GL-PRSO
	RFALSE

	.FUNCT RT-YOU-MSG,WRD1,WRD2,PRONOUN?
	ASSIGNED? 'WRD1 /?L20
	SET 'WRD1,0
?L20:	ASSIGNED? 'WRD2 /?L21
	SET 'WRD2,0
?L21:	ASSIGNED? 'PRONOUN? /?L22
	SET 'PRONOUN?,0
?L22:	EQUAL? GL-WINNER,CH-PLAYER \?L1
	PRINTI " you "
	ZERO? WRD1 /FALSE
	PRINT WRD1
	PRINTI " "
	RTRUE
?L1:	PRINTI " "
	ZERO? PRONOUN? /?L7
	FSET? GL-WINNER,FL-PLURAL \?L9
	FSET? GL-WINNER,FL-COLLECTIVE /?L9
	PRINTI "they"
	JUMP ?L16
?L9:	FSET? GL-WINNER,FL-PERSON \?L11
	FSET? GL-WINNER,FL-FEMALE \?L12
	PRINTI "she"
	JUMP ?L16
?L12:	PRINTI "he"
	JUMP ?L16
?L11:	PRINTI "it"
	JUMP ?L16
?L7:	ICALL2 RT-THEO-PRINT,GL-WINNER
?L16:	PRINTI " "
	ZERO? WRD2 /FALSE
	PRINT WRD2
	PRINTI " "
	RTRUE

	.FUNCT RT-CYOU-MSG,WRD1,WRD2,PRONOUN?
	ASSIGNED? 'WRD1 /?L20
	SET 'WRD1,0
?L20:	ASSIGNED? 'WRD2 /?L21
	SET 'WRD2,0
?L21:	ASSIGNED? 'PRONOUN? /?L22
	SET 'PRONOUN?,0
?L22:	EQUAL? GL-WINNER,CH-PLAYER \?L1
	PRINTI "You "
	ZERO? WRD1 /FALSE
	PRINT WRD1
	PRINTI " "
	RTRUE
?L1:	ZERO? PRONOUN? /?L7
	FSET? GL-WINNER,FL-PLURAL \?L9
	FSET? GL-WINNER,FL-COLLECTIVE /?L9
	PRINTI "They"
	JUMP ?L16
?L9:	FSET? GL-WINNER,FL-PERSON \?L11
	FSET? GL-WINNER,FL-FEMALE \?L12
	PRINTI "She"
	JUMP ?L16
?L12:	PRINTI "He"
	JUMP ?L16
?L11:	PRINTI "It"
	JUMP ?L16
?L7:	ICALL2 RT-CTHEO-PRINT,GL-WINNER
?L16:	PRINTI " "
	ZERO? WRD2 /FALSE
	PRINT WRD2
	PRINTI " "
	RTRUE

	.FUNCT RT-ITS-ALREADY-MSG,STR
	PRINTI "It is already "
	PRINT STR
	PRINTR "."

	.FUNCT RT-YOURE-NOT-A-MSG,STR
	PRINTI "You're a general practitioner, not a "
	PRINT STR
	PRINTR "."

	.FUNCT RT-NO-POINT-MSG,STR
	PRINT STR
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " would"
	CALL2 RT-PICK-NEXT,GL-NO-POINT-TXT >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT RT-IS-ARE-MSG,THING
	ASSIGNED? 'THING /?L8
	SET 'THING,0
?L8:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	EQUAL? THING,CH-ME,CH-PLAYER /?L6
	FSET? THING,FL-PLURAL \?L4
	FSET? THING,FL-COLLECTIVE /?L4
?L6:	PRINTI " are "
	RTRUE
?L4:	PRINTI " is "
	RTRUE

	.FUNCT RT-ISNT-ARENT-MSG,THING
	ASSIGNED? 'THING /?L8
	SET 'THING,0
?L8:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	EQUAL? THING,CH-ME,CH-PLAYER /?L6
	FSET? THING,FL-PLURAL \?L4
	FSET? THING,FL-COLLECTIVE /?L4
?L6:	PRINTI " are not "
	RTRUE
?L4:	PRINTI " is not "
	RTRUE

	.FUNCT RT-S-NOS-MSG,THING
	ASSIGNED? 'THING /?L8
	SET 'THING,0
?L8:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	EQUAL? THING,CH-ME,CH-PLAYER /TRUE
	FSET? THING,FL-PLURAL \?L6
	FSET? THING,FL-COLLECTIVE \TRUE
?L6:	PRINTI "s"
	RTRUE

	.FUNCT RT-ES-NOES-MSG,THING
	ASSIGNED? 'THING /?L8
	SET 'THING,0
?L8:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	EQUAL? THING,CH-ME,CH-PLAYER /TRUE
	FSET? THING,FL-PLURAL \?L6
	FSET? THING,FL-COLLECTIVE \TRUE
?L6:	PRINTI "es"
	RTRUE

	.FUNCT RT-DONT-DOESNT-MSG,THING
	ASSIGNED? 'THING /?L8
	SET 'THING,0
?L8:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	EQUAL? THING,CH-ME,CH-PLAYER /?L6
	FSET? THING,FL-PLURAL \?L4
	FSET? THING,FL-COLLECTIVE /?L4
?L6:	PRINTI " do not "
	RTRUE
?L4:	PRINTI " does not "
	RTRUE

	.FUNCT RT-SAY-ITS-MSG,THING
	ASSIGNED? 'THING /?L9
	SET 'THING,0
?L9:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	FSET? THING,FL-PLURAL \?L4
	FSET? THING,FL-COLLECTIVE /?L4
	PRINTI "They are "
	RTRUE
?L4:	FSET? THING,FL-PERSON \?L7
	FSET? THING,FL-FEMALE \?L6
	PRINTI "She is "
	RTRUE
?L6:	FSET? THING,FL-PERSON \?L7
	FSET? THING,FL-FEMALE /?L7
	PRINTI "He is "
	RTRUE
?L7:	PRINTI "It is "
	RTRUE

	.FUNCT RT-SAY-HIM-HER-THEM-IT-MSG,THING
	ASSIGNED? 'THING /?L15
	SET 'THING,0
?L15:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	EQUAL? THING,CH-PLAYER,CH-ME \?L4
	EQUAL? GL-WINNER,CH-PLAYER,CH-ME \?L6
	PRINTI "yourself"
	RTRUE
?L6:	PRINTI "you"
	RTRUE
?L4:	FSET? THING,FL-PLURAL \?L9
	FSET? THING,FL-COLLECTIVE /?L9
	PRINTI "them"
	RTRUE
?L9:	FSET? THING,FL-PERSON \?L10
	FSET? THING,FL-FEMALE \?L11
	PRINTI "her"
	RTRUE
?L11:	PRINTI "him"
	RTRUE
?L10:	PRINTI "it"
	RTRUE

	.FUNCT RT-YOUR-MSG,THING
	ASSIGNED? 'THING /?L12
	SET 'THING,0
?L12:	ZERO? THING \?L1
	SET 'THING,GL-WINNER
?L1:	EQUAL? THING,CH-PLAYER,CH-ME \?L4
	PRINTI "your "
	RTRUE
?L4:	FSET? THING,FL-PLURAL \?L6
	FSET? THING,FL-COLLECTIVE /?L6
	PRINTI "their "
	RTRUE
?L6:	FSET? THING,FL-PERSON \?L7
	FSET? THING,FL-FEMALE \?L8
	PRINTI "her "
	RTRUE
?L8:	PRINTI "his "
	RTRUE
?L7:	PRINTI "its "
	RTRUE

	.FUNCT RT-ITS-CLOSED-MSG,THING
	ASSIGNED? 'THING /?L4
	SET 'THING,0
?L4:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	ICALL2 RT-CTHEO-PRINT,THING
	ICALL2 RT-IS-ARE-MSG,THING
	PRINTR "closed."

	.FUNCT RT-WHY-SHOOT-MSG,OBJ
	ASSIGNED? 'OBJ /?L4
	SET 'OBJ,0
?L4:	ZERO? OBJ \?L1
	SET 'OBJ,GL-PRSO
?L1:	PRINTI "Why would"
	ICALL1 RT-YOU-MSG
	PRINTI "want to shoot the poor, little, innocent "
	ICALL2 DPRINT,OBJ
	PRINTR "?"

	.FUNCT RT-HOW-READ-MSG,THING
	ASSIGNED? 'THING /?L4
	SET 'THING,0
?L4:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	PRINTI "How can"
	ICALL1 RT-YOU-MSG
	PRINTI "read "
	ICALL2 RT-A-PRINT,THING
	RTRUE

	.FUNCT RT-ALREADY-HAVE-PRSO-MSG,THING
	ASSIGNED? 'THING /?L4
	SET 'THING,0
?L4:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	ICALL RT-CYOU-MSG,STR?242,STR?241
	ICALL2 RT-A-PRINT,THING
	PRINTR "."

	.FUNCT RT-CANT-OPEN-PRSO-MSG,THING
	ASSIGNED? 'THING /?L4
	SET 'THING,0
?L4:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "could not possibly open "
	ICALL2 RT-THEO-PRINT,THING
	PRINTR "."

	.FUNCT RT-CANT-CLOSE-THAT-MSG,THING
	ASSIGNED? 'THING /?L7
	SET 'THING,0
?L7:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot close "
	ZERO? THING /?L4
	ICALL2 RT-THEO-PRINT,THING
	JUMP ?L6
?L4:	ICALL2 DPRINT,TH-NOT-HERE-OBJECT
?L6:	PRINTR "."

	.FUNCT RT-NO-GOOD-SURFACE-MSG,THING
	ASSIGNED? 'THING /?L4
	SET 'THING,0
?L4:	ZERO? THING \?L1
	SET 'THING,GL-PRSI
?L1:	PRINTI "There is no good surface on "
	ICALL2 RT-THEO-PRINT,THING
	PRINTR "."

	.FUNCT RT-LANDS-AT-YOUR-FEET-MSG,THING
	ASSIGNED? 'THING /?L4
	SET 'THING,0
?L4:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	PRINTI "land"
	ICALL2 RT-S-NOS-MSG,THING
	PRINTI " at your feet."
	CRLF
	MOVE THING,GL-PLACE-CUR
	RTRUE

	.FUNCT RT-OPEN-CLOSED-MSG,THING
	ASSIGNED? 'THING /?L7
	SET 'THING,0
?L7:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	ICALL2 RT-CTHEO-PRINT,THING
	ICALL2 RT-IS-ARE-MSG,THING
	FSET? THING,FL-OPENED \?L4
	PRINTI "open"
	JUMP ?L6
?L4:	PRINTI "closed"
?L6:	PRINTI "."
	RTRUE

	.FUNCT RT-YOU-OPEN-MSG,THING
	ASSIGNED? 'THING /?L4
	SET 'THING,0
?L4:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	FSET THING,FL-OPENED
	ICALL RT-CYOU-MSG,STR?108,STR?243
	ICALL2 RT-THEO-PRINT,THING
	PRINTR "."

	.FUNCT RT-YOU-CLOSE-MSG,THING
	ASSIGNED? 'THING /?L4
	SET 'THING,0
?L4:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	FCLEAR THING,FL-OPENED
	ICALL RT-CYOU-MSG,STR?184,STR?244
	ICALL2 RT-THEO-PRINT,THING
	PRINTR "."

	.FUNCT RT-IN-ON-MSG,THING,SPACE?
	ASSIGNED? 'THING /?L11
	SET 'THING,0
?L11:	ASSIGNED? 'SPACE? /?L12
	SET 'SPACE?,1
?L12:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	ZERO? SPACE? /?L4
	PRINTI " "
?L4:	FSET? THING,FL-CONTAINER \?L7
	PRINTI "in"
	JUMP ?L10
?L7:	FSET? THING,FL-SURFACE \?L9
	PRINTI "on"
	JUMP ?L10
?L9:	PRINTI "held by"
?L10:	PRINTI " "
	RTRUE

	.FUNCT RT-CIN-CON-MSG,THING
	ASSIGNED? 'THING /?L8
	SET 'THING,0
?L8:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	FSET? THING,FL-SURFACE \?L4
	PRINTI "On "
	RTRUE
?L4:	FSET? THING,FL-CONTAINER \?L6
	PRINTI "In "
	RTRUE
?L6:	PRINTI "Held by "
	RTRUE

	.FUNCT RT-OUT-OFF-MSG,THING
	ASSIGNED? 'THING /?L8
	SET 'THING,0
?L8:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	FSET? THING,FL-SURFACE \?L4
	PRINTI " off of "
	RTRUE
?L4:	FSET? THING,FL-CONTAINER \?L6
	PRINTI " out of "
	RTRUE
?L6:	PRINTI " from "
	RTRUE

	.FUNCT RT-CANT-LOCK-MSG,UN?,THING
	ASSIGNED? 'UN? /?L7
	SET 'UN?,0
?L7:	ASSIGNED? 'THING /?L8
	SET 'THING,0
?L8:	ZERO? THING \?L1
	SET 'THING,GL-PRSO
?L1:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	ZERO? UN? /?L4
	PRINTI "un"
?L4:	PRINTI "lock "
	ICALL2 RT-A-PRINT,THING
	PRINTR "."

	.FUNCT RT-THING-WONT-LOCK-MSG,THING,CLOSED-THING,UN?
	ASSIGNED? 'UN? /?L4
	SET 'UN?,0
?L4:	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	ZERO? UN? /?L1
	PRINTI "un"
?L1:	PRINTI "lock "
	ICALL2 RT-THEO-PRINT,CLOSED-THING
	PRINTI " with "
	ICALL2 RT-THEO-PRINT,THING
	PRINTR "."

	.FUNCT RT-DONT-HAVE-MSG,OBJ,L,O
	LOC OBJ >L
	ZERO? L /?L7
	EQUAL? L,GL-WINNER /FALSE
	IN? L,CH-PLAYER \?L7
	EQUAL? GL-WINNER,CH-PLAYER \?L7
	SET 'O,GL-PRSO
	SET 'GL-PRSO,OBJ
	CALL2 RT-ITAKE,0 >STACK
	ZERO? STACK /?L5
	PRINTI "[taking "
	ICALL1 RT-THEO-PRINT
	ICALL2 RT-OUT-OFF-MSG,L
	ICALL2 RT-THEO-PRINT,L
	PRINTI " first]"
	CRLF
	SET 'GL-PRSO,O
	ICALL2 RT-THIS-IS-IT,GL-PRSO
	RFALSE
?L5:	SET 'GL-PRSO,O
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?228,OBJ
	ICALL2 RT-OUT-OFF-MSG,L
	ICALL2 RT-THEO-PRINT,L
	PRINTR " first."
?L7:	ICALL1 RT-WINNER-NOT-HOLDING-MSG
	ZERO? OBJ /?L9
	ICALL2 RT-THEO-PRINT,OBJ
	JUMP ?L13
?L9:	ICALL2 RT-THEO-PRINT,TH-NOT-HERE-OBJECT
?L13:	PRINTR "."

	.FUNCT RT-ROOM-IN-ON-MSG?,OBJ1,OBJ2
	CALL RT-OBJ-TOO-LARGE?,OBJ1,OBJ2 >STACK
	ZERO? STACK /FALSE
	PRINTI "There is not enough room"
	ICALL2 RT-IN-ON-MSG,OBJ2
	ICALL2 RT-THEO-PRINT,OBJ2
	PRINTR "."

	.FUNCT RT-IMPOSSIBLE-PUT-IN-ON-MSG,OBJ
	ZERO? OBJ \?L1
	SET 'OBJ,GL-PRSI
?L1:	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	EQUAL? GL-PRSI,OBJ \FALSE
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT RT-CANT-PUT-IN-ON-MSG,OBJ
	ZERO? OBJ \?L1
	SET 'OBJ,GL-PRSI
?L1:	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	EQUAL? GL-PRSI,OBJ \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot put "
	ICALL1 RT-THEO-PRINT
	PRINTI " "
	FSET? GL-PRSO,FL-CONTAINER \?L6
	PRINTI "in"
	JUMP ?L10
?L6:	FSET? GL-PRSO,FL-SURFACE \?L8
	PRINTI "on"
	JUMP ?L10
?L8:	EQUAL? GL-PRSA,V?PUT \?L9
	PRINTI "in"
	JUMP ?L10
?L9:	PRINTI "on"
?L10:	PRINTI " "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT RT-CHECK-MOVE-MSG?,SRC,DEST,PTR,OLOC,CNT
	ZERO? DEST /FALSE
	SET 'PTR,GL-LOC-TRAIL
	SET 'OLOC,DEST
?L3:	PUT PTR,0,OLOC
	INC 'CNT
	ZERO? OLOC /?L4
	IN? OLOC,ROOMS /?L4
	IN? OLOC,LOCAL-GLOBALS /?L4
	IN? OLOC,GLOBAL-OBJECTS /?L4
	LOC OLOC >OLOC
	ADD PTR,2 >PTR
	EQUAL? OLOC,DEST \?L3
?L4:	INTBL? SRC,GL-LOC-TRAIL,CNT >STACK \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot put "
	ICALL2 RT-THEO-PRINT,SRC
	ICALL2 RT-IN-ON-MSG,SRC
	PRINTI "itself, or"
	ICALL2 RT-IN-ON-MSG,SRC
	PRINTI "something that is already"
	ICALL2 RT-IN-ON-MSG,SRC
	PRINTR "it."

	.FUNCT RT-EMPTY-PRSO-MSG,DEST,OBJ,NXT,X
	FIRST? GL-PRSO >OBJ /?L2
	PRINTI "There is nothing"
	ICALL2 RT-IN-ON-MSG,GL-PRSO
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L2:	SET 'GL-P-MULT?,1
?L5:	ZERO? OBJ /?L6
	ICALL2 RT-CTHEO-PRINT,OBJ
	PRINTI ": "
	NEXT? OBJ >NXT /?L10
?L10:	EQUAL? DEST,CH-PLAYER \?L11
	CALL RT-PERFORM,V?TAKE,OBJ,GL-PRSO >X
	EQUAL? X,FATAL-VALUE \?L22
	JUMP ?L6
?L11:	ZERO? DEST \?L16
	FSET? GL-PRSO,FL-PLURAL \?L17
	FSET? GL-PRSO,FL-COLLECTIVE /?L17
	PRINTI "They "
	JUMP ?L19
?L17:	PRINTI "It "
?L19:	ICALL1 RT-LANDS-AT-YOUR-FEET-MSG
	JUMP ?L22
?L16:	CALL RT-ROOM-IN-ON-MSG?,OBJ,DEST >STACK
	ZERO? STACK \?L22
	CALL RT-CHECK-MOVE-MSG?,OBJ,DEST >STACK
	ZERO? STACK \?L6
	MOVE OBJ,DEST
	PRINTI "Done."
	CRLF
?L22:	SET 'OBJ,NXT
	JUMP ?L5
?L6:	SET 'GL-P-MULT?,0
	RTRUE

	.FUNCT RT-IDROP-MSG,L,?TMP
	LOC GL-PRSO >L
	ZERO? L /?L3
	EQUAL? GL-PRSO,GL-WINNER,CH-ME,CH-PLAYER \?L1
?L3:	ICALL1 RT-IMPOSSIBLE-MSG
	RFALSE
?L1:	EQUAL? L,GL-WINNER /?L4
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?228,GL-PRSO
	ICALL2 RT-OUT-OFF-MSG,L
	ICALL2 RT-THEO-PRINT,L
	PRINTI " first."
	CRLF
	RFALSE
?L4:	FSET? GL-PRSO,FL-WORN \?L5
	IN? GL-PRSO,GL-WINNER \?L5
	ICALL1 RT-TAKE-OFF-PRSO-FIRST-MSG
?L5:	EQUAL? GL-PRSA,V?THROW \?L7
	SET '?TMP,GL-PRSO
	CALL2 RT-META-LOC,GL-WINNER >STACK
	MOVE ?TMP,STACK
	RTRUE
?L7:	LOC GL-WINNER >STACK
	MOVE GL-PRSO,STACK
	RTRUE

	.FUNCT RT-PRINT-CONTENTS-1,THING,OBJ,CNT,TMP
	SET 'CNT,0
	ICALL RT-MOVE-NODESC-OBJS,THING,TH-Y-OBJECT
	FIRST? THING >OBJ \?L3
?L4:	FSET OBJ,FL-SEEN
	PRINTI "  "
	ICALL2 RT-A-PRINT,OBJ
	FSET? OBJ,FL-LIGHTED \?L7
	PRINTI " (providing light)"
?L7:	PRINTI "."
	CRLF
	INC 'CNT
	NEXT? OBJ >OBJ /?L4
?L3:	ZERO? CNT \?L11
	PRINTI "  nothing."
	CRLF
?L11:	ICALL RT-MOVE-ALL,TH-Y-OBJECT,THING
	FIRST? THING >OBJ \TRUE
?L17:	CALL2 RT-SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /?L20
	ICALL2 RT-PRINT-CONTENTS-3,OBJ
?L20:	NEXT? OBJ >OBJ /?L17
	RTRUE

	.FUNCT RT-PRINT-CONTENTS-2,THING,OBJ,CNT
	SET 'CNT,0
	ICALL RT-MOVE-NODESC-OBJS,THING,TH-Y-OBJECT
	FIRST? THING >OBJ /?L4
	JUMP ?L3
?L1:	ZERO? OBJ /?L3
?L4:	FSET OBJ,FL-SEEN
	ICALL2 RT-A-PRINT,OBJ
	FSET? OBJ,FL-LIGHTED \?L7
	PRINTI " (providing light)"
?L7:	INC 'CNT
	NEXT? OBJ >OBJ \?L3
	NEXT? OBJ >STACK /?L15
?L15:	ZERO? STACK \?L13
	PRINTI " and "
	JUMP ?L1
?L13:	PRINTI ", "
	JUMP ?L1
?L3:	ZERO? CNT \?L18
	PRINTI "nothing"
?L18:	ICALL RT-MOVE-ALL,TH-Y-OBJECT,THING
	RTRUE

	.FUNCT RT-PRINT-CONTENTS-3,THING,OBJ,FIRST,CNT
	SET 'FIRST,1
	SET 'CNT,0
	FIRST? THING >OBJ \TRUE
?L4:	FSET? OBJ,FL-NODESC /?L6
	ZERO? FIRST /?L7
	SET 'FIRST,0
	LOC OBJ >STACK
	ICALL2 RT-CIN-CON-MSG,STACK
	LOC OBJ >STACK
	ICALL2 RT-THEO-PRINT,STACK
	PRINTI " you see:"
	CRLF
?L7:	PRINTI "  "
	ICALL2 RT-A-PRINT,OBJ
	CRLF
?L6:	NEXT? OBJ >OBJ /?L4
	FIRST? THING >OBJ \TRUE
?L15:	CALL2 RT-SEE-INSIDE?,OBJ >STACK
	ZERO? STACK /?L18
	ICALL2 RT-PRINT-CONTENTS-3,OBJ
?L18:	NEXT? OBJ >OBJ /?L15
	RTRUE

	.FUNCT RT-DO-WALK,DIR1,DIR2,DIR3,X
	ASSIGNED? 'DIR2 /?L7
	SET 'DIR2,0
?L7:	ASSIGNED? 'DIR3 /?L8
	SET 'DIR3,0
?L8:	SET 'GL-P-WALK-DIR,DIR1
	CALL RT-PERFORM,V?WALK,DIR1 >X
	ZERO? DIR2 /?L3
	EQUAL? X,0,FATAL-VALUE /?L3
	SET 'GL-P-WALK-DIR,DIR2
	CALL RT-PERFORM,V?WALK,DIR2 >X
	ZERO? DIR3 /?L3
	EQUAL? X,0,FATAL-VALUE /?L3
	SET 'GL-P-WALK-DIR,DIR3
	CALL RT-PERFORM,V?WALK,DIR3 >X
?L3:	RETURN X

	.FUNCT RT-WHO-SAYS?,?TMP
	SET '?TMP,GL-PLACE-CUR
	CALL2 RT-META-LOC,CH-HOLMES >STACK
	EQUAL? ?TMP,STACK \?L1
	FSET? CH-HOLMES,FL-ASLEEP /?L1
	FSET? CH-HOLMES,FL-LOCKED /?L1
	RETURN CH-HOLMES
?L1:	SET '?TMP,GL-PLACE-CUR
	CALL2 RT-META-LOC,CH-WIGGINS >STACK
	EQUAL? ?TMP,STACK \FALSE
	FSET? CH-WIGGINS,FL-ASLEEP /FALSE
	FSET? CH-WIGGINS,FL-LOCKED /FALSE
	RETURN CH-WIGGINS

	.FUNCT RT-TRANSCRIPT,STR
	DIROUT K-D-SCR-OFF
	CRLF
	PRINTI "Transcript: "
	PRINT STR
	CRLF
	ICALL1 RT-VERSION-MSG
	DIROUT K-D-SCR-ON
	RTRUE

	.FUNCT RT-QSR,KEY
	ICALL1 KILL-SOUNDS
	PRINTI "The game is no longer afoot.[EVENT: GAME OVER]"
	CRLF
	CRLF
?L1:	PRINTI "Do you wish to: (1) Quit, (2) Restart, (3) Restore, (4) Hints"
	ZERO? GL-CAN-UNDO /?L3
	PRINTI ", (5) Undo"
?L3:	PRINTI " ?"
	CRLF
	INPUT 1 >KEY
	EQUAL? KEY,49 \?L6
	QUIT
?L6:	EQUAL? KEY,50 \?L8
	RESTART
?L8:	EQUAL? KEY,51 \?L9
	ZERO? GL-DEBUG-FLAG /?L10
	ICALL1 V-REFRESH
?L10:	ICALL1 RT-P-CLEAR
	PUTB GL-OOPS-INBUF,1,0
	RESTORE >STACK
	PRINTI "Restore failed."
	CRLF
	JUMP ?L1
?L9:	EQUAL? KEY,52 \?L13
	ICALL1 V-HINT
	ICALL1 V-REFRESH
	JUMP ?L1
?L13:	EQUAL? KEY,53 \?L1
	ZERO? GL-CAN-UNDO /?L1
	ICALL1 V-UNDO
	JUMP ?L1

	.FUNCT V-YES
	PRINT K-GOOD-SHOW-MSG
	CRLF
	RETURN 2

	.FUNCT V-NO
	PRINT K-PITY-MSG
	CRLF
	RETURN 2

	.FUNCT V-MAYBE
	PRINT K-MAYBE-MSG
	CRLF
	RETURN 2

	.FUNCT V-DESC-LEVEL
	PRINTI "["
	EQUAL? GL-P-PRSA-WORD,W?VERBOSE \?L1
	SET 'GL-DESC-LEVEL,2
	PRINTI "Verbose"
	JUMP ?L4
?L1:	EQUAL? GL-P-PRSA-WORD,W?BRIEF \?L3
	SET 'GL-DESC-LEVEL,1
	PRINTI "Brief"
	JUMP ?L4
?L3:	EQUAL? GL-P-PRSA-WORD,W?SUPER,W?SUPERBRIEF \?L4
	SET 'GL-DESC-LEVEL,0
	PRINTI "Superbrief"
?L4:	PRINTI " descriptions]"
	CRLF
	RETURN 2

	.FUNCT V-QUIT
	PRINTI "[Your score is "
	PRINTN GL-SCORE-CUR
	PRINTI " out of "
	PRINTN GL-SCORE-MAX
	PRINTI ", which earns you a ranking of "
	CALL2 RT-RANK-STR,GL-SCORE-CUR >STACK
	PRINT STACK
	PRINTI ".]"
	CRLF
	CRLF
	PRINTI "Are you sure you want to quit?"
	CALL1 RT-GET-YES-NO? >STACK
	ZERO? STACK /?L1
	QUIT
?L1:	CRLF
	PRINTI "Continuing."
	CRLF
	RETURN 2

	.FUNCT V-RESTART
	PRINTI "Are you sure you want to restart?"
	CALL1 RT-GET-YES-NO? >STACK
	ZERO? STACK /?L1
	ICALL1 KILL-SOUNDS
	RESTART
?L1:	CRLF
	PRINTI "Continuing."
	CRLF
	RETURN 2

	.FUNCT V-SAVE,X,WHO
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L1
	ICALL2 RT-CTHEO-PRINT,CH-HOLMES
	PRINTI " nods in approval and says, ""A wise move, Watson. These are dangerous times."""
	CRLF
	CRLF
	JUMP ?L3
?L1:	EQUAL? WHO,CH-WIGGINS \?L3
	ICALL2 RT-CTHEO-PRINT,CH-WIGGINS
	PRINTI " glances around in alarm and says, ""Do you know somefing I don't know?"""
	CRLF
	CRLF
?L3:	ZERO? GL-DEBUG-FLAG /?L5
	ICALL1 V-REFRESH
?L5:	SET 'GL-SCORE-STS,-1
	SET 'GL-MOVES-STS,-1
	SET 'GL-PLACE-STS,-1
	ICALL1 RT-P-CLEAR
	PUTB GL-OOPS-INBUF,1,0
	SET 'SOUND-QUEUED?,0
	ICALL1 KILL-SOUNDS
	SAVE >X
	ZERO? SOUND-ON? /?L8
	ICALL1 CHECK-LOOPING
?L8:	ICALL1 RT-UPDATE-STATUS-LINE
	ZERO? X \?L11
	PRINTI "Save failed."
	CRLF
	RETURN 2
?L11:	EQUAL? X,1 \?L13
	PRINTI "Save completed."
	CRLF
	RETURN 2
?L13:	PRINTI "Restore completed."
	CRLF
	CRLF
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L15
	ICALL2 RT-CTHEO-PRINT,CH-HOLMES
	PRINTI " looks up and says impatiently, ""Where have you been, Watson? We have work to do."""
	CRLF
	CRLF
	JUMP ?L17
?L15:	EQUAL? WHO,CH-WIGGINS \?L17
	ICALL2 RT-CTHEO-PRINT,CH-WIGGINS
	PRINTI " jumps nervously and then says, ""Crikey! You scared me. Don't sneak up on people that way."""
	CRLF
	CRLF
?L17:	ICALL RT-DESC-ALL,0,1
	RETURN 2

	.FUNCT V-RESTORE
	SET 'SOUND-QUEUED?,0
	ICALL1 KILL-SOUNDS
	ZERO? GL-DEBUG-FLAG /?L1
	ICALL1 V-REFRESH
?L1:	ICALL1 RT-P-CLEAR
	PUTB GL-OOPS-INBUF,1,0
	RESTORE >STACK
	GET 0,8 >STACK
	BTST STACK,4 \?L4
	ICALL2 RT-INIT-SCREEN,1
	ICALL1 RT-UPDATE-STATUS-LINE
	GET 0,8 >STACK
	BAND STACK,-5 >STACK
	PUT 0,8,STACK
?L4:	PRINTI "Restore failed."
	CRLF
	ZERO? SOUND-ON? /?L7
	ICALL1 CHECK-LOOPING
?L7:	RETURN 2

	.FUNCT V-SCRIPT
	PRINTI "[Scripting "
	EQUAL? GL-P-PRSA-WORD,W?SCRIPT \?L1
	PRINTI "on"
	JUMP ?L3
?L1:	PRINTI "off"
?L3:	PRINTI "]"
	CRLF
	EQUAL? GL-P-PRSA-WORD,W?SCRIPT \?L4
	DIROUT K-D-PRN-ON
	ICALL2 RT-TRANSCRIPT,STR?245
	RETURN 2
?L4:	ICALL2 RT-TRANSCRIPT,STR?246
	DIROUT K-D-PRN-OFF
	RETURN 2

	.FUNCT V-VERSION
	ICALL1 RT-VERSION-MSG
	RETURN 2

	.FUNCT V-INVENTORY,POCKET,PLOC,OBJ,NXT,OLDIT
	SET 'POCKET,0
	SET 'OLDIT,GL-P-IT-OBJECT
	LOC TH-POCKET >PLOC
	FIRST? TH-POCKET >POCKET /?L1
?L1:	REMOVE TH-POCKET
	FIRST? CH-PLAYER >OBJ /?L5
	JUMP ?L4
?L2:	ZERO? OBJ /?L4
?L5:	NEXT? OBJ >NXT /?L8
?L8:	FSET? OBJ,FL-WORN \?L9
	EQUAL? OBJ,TH-COTTON-BALLS,TH-STETHOSCOPE /?L9
	MOVE OBJ,TH-X-OBJECT
?L9:	SET 'OBJ,NXT
	JUMP ?L2
?L4:	FIRST? TH-X-OBJECT >STACK \?L12
	PRINTI "You are wearing:"
	CRLF
	ICALL2 RT-PRINT-CONTENTS-1,TH-X-OBJECT
?L12:	FSET? TH-COTTON-BALLS,FL-WORN /?L17
	FSET? TH-STETHOSCOPE,FL-WORN \?L20
?L17:	PRINTI "You have in your ears:"
	CRLF
	PRINTI "  "
	FSET? TH-COTTON-BALLS,FL-WORN \?L18
	MOVE TH-COTTON-BALLS,TH-X-OBJECT
	ICALL2 RT-A-PRINT,TH-COTTON-BALLS
	PRINTI "."
	CRLF
	JUMP ?L20
?L18:	MOVE TH-STETHOSCOPE,TH-X-OBJECT
	ICALL2 RT-A-PRINT,TH-STETHOSCOPE
	PRINTI "."
	CRLF
?L20:	FSET? TH-WATSONS-COAT,FL-WORN \?L22
	FIRST? TH-POCKET >STACK \?L22
	PRINTI "Your pocket contains:"
	CRLF
	ICALL2 RT-PRINT-CONTENTS-1,TH-POCKET
?L22:	PRINTI "You are holding:"
	CRLF
	ICALL2 RT-PRINT-CONTENTS-1,CH-PLAYER
	ICALL RT-MOVE-ALL,TH-X-OBJECT,CH-PLAYER
	MOVE TH-POCKET,PLOC
	SET 'GL-P-IT-OBJECT,OLDIT
	RETURN 2

	.FUNCT V-NOTIFY
	ZERO? GL-SCORE-MSG \?L1
	SET 'GL-SCORE-MSG,1
	JUMP ?L2
?L1:	SET 'GL-SCORE-MSG,0
?L2:	PRINTI "[Score Notification "
	ZERO? GL-SCORE-MSG /?L3
	PRINTI "Enabled"
	JUMP ?L5
?L3:	PRINTI "Disabled"
?L5:	PRINTI "]"
	CRLF
	RETURN 2

	.FUNCT V-SCORE
	PRINTI "[You have "
	PRINTN GL-SCORE-CUR
	PRINTI " out of "
	PRINTN GL-SCORE-MAX
	PRINTI " points, which earns you a ranking of "
	CALL2 RT-RANK-STR,GL-SCORE-CUR >STACK
	PRINT STACK
	PRINTI ".]"
	CRLF
	RETURN 2

	.FUNCT V-UNDO
	SET 'SOUND-QUEUED?,0
	ICALL1 KILL-SOUNDS
	SET 'GL-PLACE-STS,0
	IRESTORE >STACK
	ZERO? STACK \?L1
	PRINTI "[UNDO failed.]"
	CRLF
	JUMP ?L3
?L1:	PRINTI "[UNDO is not available.]"
	CRLF
?L3:	ZERO? SOUND-ON? /FALSE
	CALL1 CHECK-LOOPING >STACK
	RSTACK

	.FUNCT RT-LIBRARIAN-SAYS-MSG
	FSET? CH-LIBRARIAN,FL-OPENED /?L1
	PRINTI """"
	CALL2 RT-PICK-NEXT,GL-LIBRARIAN-TXT1 >STACK
	PRINT STACK
	PRINTR "."""
?L1:	PRINTI """"
	CALL2 RT-PICK-NEXT,GL-LIBRARIAN-TXT2 >STACK
	PRINT STACK
	PRINTR """"

	.FUNCT RT-TELL-ABOUT?,PERSON,?TMP
	EQUAL? GL-PRSA,V?ASK-ABOUT /?L4
	PUSH 0
	JUMP ?L6
?L4:	EQUAL? GL-PRSO,PERSON /?L5
	PUSH 0
	JUMP ?L6
?L5:	PUSH 1
?L6:	POP '?TMP
	ZERO? ?TMP /?L2
	RETURN ?TMP
?L2:	EQUAL? GL-PRSA,V?TELL-ABOUT /?L9
	PUSH 0
	JUMP ?L12
?L9:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER /?L10
	PUSH 0
	JUMP ?L12
?L10:	EQUAL? GL-WINNER,PERSON /?L11
	PUSH 0
	JUMP ?L12
?L11:	PUSH 1
?L12:	POP '?TMP
	ZERO? ?TMP /?L7
	RETURN ?TMP
?L7:	EQUAL? GL-PRSA,V?WHO /?L15
	PUSH 0
	JUMP ?L18
?L15:	FSET? GL-PRSO,FL-PERSON /?L16
	PUSH 0
	JUMP ?L18
?L16:	EQUAL? GL-WINNER,PERSON /?L17
	PUSH 0
	JUMP ?L18
?L17:	PUSH 1
?L18:	POP '?TMP
	ZERO? ?TMP /?L13
	RETURN ?TMP
?L13:	EQUAL? GL-PRSA,V?WHAT \FALSE
	EQUAL? GL-WINNER,PERSON \FALSE
	RTRUE

	.FUNCT RT-WHO-WHAT-FAIL?
	EQUAL? GL-PRSA,V?WHO,V?WHAT \FALSE
	PRINTR """Sorry. I don't know what you're talking about."""

	.FUNCT RT-NO-CONDITION-MSG,PERSON,STR
	ASSIGNED? 'STR /?L4
	SET 'STR,0
?L4:	ICALL2 RT-CTHEO-PRINT,PERSON
	ICALL2 RT-IS-ARE-MSG,PERSON
	PRINTI "in no condition to "
	ZERO? STR /?L1
	PRINT STR
	JUMP ?L3
?L1:	PRINTI "respond"
?L3:	PRINTR "."

	.FUNCT RT-AC-CH-HOLMES,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L120
	SET 'CONTEXT,0
?L120:	ICALL2 RT-THIS-IS-IT,CH-HOLMES
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	ICALL2 RT-THIS-IS-IT,CH-HOLMES
	FSET? CH-HOLMES,FL-ASLEEP \?L3
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	PRINTR " is slouched on the sofa, lost in a black mood of despair. He is pale and emaciated, and his sharp eyes burn with fever. He is staring at a phial that he holds in one hand. His free hand rests near a hypodermic syringe in a neat morocco case at his side. You realize that he is fighting a depression brought on by what he calls ""the dull routine of existence."""
?L3:	FSET? CH-HOLMES,FL-LOCKED \?L5
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	PRINT K-SECURELY-BOUND-MSG
	JUMP ?L14
?L5:	FSET? CH-MORIARTY,FL-LOCKED \?L6
	PRINTI "Despite his cool exterior, you can tell that Holmes is excited about nearing the end of the chase"
	JUMP ?L14
?L6:	IN? CH-HOLMES,TH-BOAT \?L7
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	PRINT K-SEASICK-MSG
	JUMP ?L14
?L7:	IN? CH-HOLMES,TH-HANSOM-CAB /?L9
	IN? CH-HOLMES,TH-GROWLER-CAB \?L8
?L9:	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	PRINT K-SITTING-QUIETLY-MSG
	JUMP ?L14
?L8:	IN? CH-HOLMES,TH-SOFA \?L10
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	PRINTI " is sitting on the sofa, gazing intently at you"
	JUMP ?L14
?L10:	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL,RM-PARLOUR,RM-VESTIBULE /?L12
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY,RM-HOLMES-BEDROOM \?L11
?L12:	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	CALL2 RT-PICK-NEXT,GL-HOLMES-HOUSE-LOOK-TXT >STACK
	PRINT STACK
	JUMP ?L14
?L11:	FSET? GL-PLACE-CUR,FL-INDOORS \?L13
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	CALL2 RT-PICK-NEXT,GL-HOLMES-INDOORS-LOOK-TXT >STACK
	PRINT STACK
	JUMP ?L14
?L13:	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	CALL2 RT-PICK-NEXT,GL-HOLMES-OUTDOORS-LOOK-TXT >STACK
	PRINT STACK
?L14:	PRINTI "."
	CRLF
	RETURN 2
?L1:	CALL2 RT-TELL-ABOUT?,CH-HOLMES >STACK
	ZERO? STACK /?L15
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L16
	SET 'OBJ,GL-PRSO
	JUMP ?L18
?L16:	SET 'OBJ,GL-PRSI
?L18:	CALL2 RT-HOLMES-DESCRIBE-MSG?,OBJ >STACK
	ZERO? STACK \TRUE
	PRINTR """You must draw your own inferences, Watson."""
?L15:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L22
	RETURN 2
?L22:	EQUAL? CONTEXT,K-M-WINNER \?L23
	FSET? CH-HOLMES,FL-ASLEEP \?L24
	ICALL2 RT-CTHEO-PRINT,CH-HOLMES
	PRINT K-SEEMS-TO-HEAR-MSG
	CRLF
	RTRUE
?L24:	EQUAL? GL-PRSA,V?HELLO \?L26
	PRINTR "Holmes returns your greeting."
?L26:	EQUAL? GL-PRSA,V?GOODBYE \?L27
	PRINTR """Farewell for now, Watson."""
?L27:	EQUAL? GL-PRSA,V?THANK \?L28
	PRINTR """No need for thanks, Watson. The work itself is my reward."""
?L28:	EQUAL? GL-PRSA,V?WHERE \?L29
	EQUAL? GL-PRSO,TH-STETHOSCOPE \?L30
	FSET? TH-STETHOSCOPE,FL-TOUCHED /?L30
	PRINT K-CUSTOMARILY-KEEP-MSG
	CRLF
	RTRUE
?L30:	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK /?L32
	PRINTI """There's your problem in a nutshell, Watson. You see, but you do not observe. "
	EQUAL? GL-PRSO,CH-HOLMES \?L33
	PRINTI "I am "
	JUMP ?L36
?L33:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L35
	PRINTI "You are "
	JUMP ?L36
?L35:	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-IS-ARE-MSG
?L36:	PRINTR "right here!"""
?L32:	PRINT K-WORK-OUT-YOURSELF-MSG
	CRLF
	RTRUE
?L29:	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L38
	PRINT K-WORK-OUT-YOURSELF-MSG
	CRLF
	RTRUE
?L38:	EQUAL? GL-PRSA,V?YES \?L39
	PRINT K-GOOD-SHOW-MSG
	CRLF
	RTRUE
?L39:	EQUAL? GL-PRSA,V?NO \?L40
	PRINT K-PITY-MSG
	CRLF
	RTRUE
?L40:	EQUAL? GL-PRSA,V?MAYBE \?L41
	PRINT K-MAYBE-MSG
	CRLF
	RTRUE
?L41:	EQUAL? GL-PRSA,V?TAKE \?L44
	EQUAL? GL-PRSO,TH-BREATH /?L43
?L44:	EQUAL? GL-PRSA,V?INHALE \?L42
?L43:	FSET? TH-BREATH,FL-LOCKED \?L45
	PRINTR "Holmes seems to be holding his breath already."
?L45:	PRINTI "Holmes hears your whispered instruction, and as you draw a deep breath, he surreptitiously does the same."
	CRLF
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,2,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-EXHALE,STACK
	FSET TH-BREATH,FL-LOCKED
	SET 'GL-CLOCK-WAIT,1
	RTRUE
?L42:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L48
	FSET? CH-HOLMES,FL-LOCKED \?L48
	PRINTR "Holmes can't do that. He is tied up."
?L48:	EQUAL? GL-PRSA,V?TAKE,V?WEAR \?L49
	EQUAL? GL-PRSO,TH-RING /?L50
	EQUAL? GL-PRSO,TH-ETHERIUM-AMPOULE \?L49
	FSET? TH-ETHERIUM-AMPOULE,FL-BROKEN /?L49
?L50:	PRINT K-PLEASE-KEEP-IT-MSG
	CRLF
	RTRUE
?L49:	EQUAL? GL-PRSA,V?RAISE,V?TAKE \?L51
	EQUAL? GL-PRSO,CH-PLAYER,CH-ME \?L51
	PRINTI "Holmes struggles to lift you"
	IN? CH-PLAYER,TH-BOAT \?L52
	PRINTI ", the boat starts to rock violently"
?L52:	PRINTR ", then he thinks better of it and abandons the attempt."
?L51:	EQUAL? GL-PRSA,V?TAKE,V?GUESS,V?DROP /FALSE
	EQUAL? GL-PRSA,V?GIVE-SWP /FALSE
	EQUAL? GL-PRSA,V?READ,V?EXAMINE,V?LOOK-ON /?L58
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?OPEN,V?SEARCH \?L57
?L58:	EQUAL? GL-PRSO,TH-MAIL \?L57
	PRINTR "Holmes glances at the envelopes and shrugs. ""They are of no consequence, Watson."""
?L57:	EQUAL? GL-PRSA,V?PLAY \?L59
	EQUAL? GL-PRSO,TH-VIOLIN \?L59
	IN? TH-VIOLIN,CH-HOLMES /?L60
	PRINTI "Holmes is not holding "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L60:	ICALL2 SOUNDS,S-VIOLIN
	PRINTR "Holmes pauses for a moment in meditation, then lifts the violin to his chin and plays a brief, haunting melody whose melancholy notes fill the air with beauty. Then, just as quickly, he is finished."
?L59:	EQUAL? GL-PRSA,V?GIVE \?L63
	EQUAL? GL-PRSI,CH-ME,CH-PLAYER \?L63
	IN? GL-PRSO,CH-HOLMES \?L64
	MOVE GL-PRSO,CH-PLAYER
	PRINTI "Holmes gives you "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L64:	EQUAL? GL-PRSO,TH-RING \?L66
	IN? TH-RING,LOCAL-GLOBALS \?L66
	PRINTR "Holmes says, ""I haven't mentioned any ring, Watson."""
?L66:	PRINTI "Holmes says, ""I do not have "
	ICALL1 RT-THEO-PRINT
	PRINTR "."""
?L63:	EQUAL? GL-PRSA,V?FOLLOW \?L68
	IN? CH-HOLMES,TH-SOFA \?L69
	PRINTR "Holmes says, ""We shouldn't leave until we have spoken with our visitor."""
?L69:	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L71
	PRINTI "Holmes says, ""Lead the way, Watson."""
	CRLF
	SET 'GL-PUPPY,CH-HOLMES
	RETURN GL-PUPPY
?L71:	PRINTR "Holmes says, ""We should remain together, Watson."""
?L68:	PRINTR """Come now, Watson. You must try it yourself."""
?L23:	ZERO? GL-NOW-PRSI? /?L121
	EQUAL? GL-PRSA,V?GIVE \?L75
	EQUAL? GL-PRSO,TH-NEWSPAPER \?L77
	FSET? CH-HOLMES,FL-ASLEEP \?L79
	RFALSE
?L77:	FSET? CH-HOLMES,FL-ASLEEP \?L79
	PRINTI "Holmes glances at "
	ICALL1 RT-THEO-PRINT
	PRINTR ", but it doesn't seem to arouse his interest."
?L79:	FSET? CH-HOLMES,FL-LOCKED \?L80
	PRINTR "Holmes's hands aren't free. You can't give him anything."
?L80:	EQUAL? GL-PRSO,TH-RING /?L82
	EQUAL? GL-PRSO,TH-ETHERIUM-AMPOULE \?L81
	FSET? TH-ETHERIUM-AMPOULE,FL-BROKEN /?L81
?L82:	PRINT K-PLEASE-KEEP-IT-MSG
	CRLF
	RTRUE
?L81:	MOVE GL-PRSO,CH-HOLMES
	ICALL RT-CYOU-MSG,STR?248,STR?247
	ICALL1 RT-THEO-PRINT
	PRINTI " to him. He examines it briefly and says, "
	CALL2 RT-HOLMES-DESCRIBE-MSG?,GL-PRSO >STACK
	ZERO? STACK \TRUE
	PRINTR """Hmmph."""
?L75:	EQUAL? GL-PRSA,V?SHOW \FALSE
	EQUAL? GL-PRSO,TH-NEWSPAPER \?L88
	FSET? CH-HOLMES,FL-ASLEEP /FALSE
?L88:	CALL2 RT-HOLMES-DESCRIBE-MSG?,GL-PRSO >STACK
	ZERO? STACK \TRUE
	PRINTI "Holmes glances at "
	ICALL1 RT-THEO-PRINT
	PRINTR ", but makes no comment."
?L121:	EQUAL? GL-PRSA,V?DIAGNOSE \?L94
	FSET? CH-HOLMES,FL-ASLEEP \FALSE
	PRINTR "He is in a trance-like state as he stares at the phial. You quickly realize that unless he hears something of interest, he will turn to the deadly drug to relieve his boredom."
?L94:	EQUAL? GL-PRSA,V?HIT,V?ALARM \?L99
	FSET? CH-HOLMES,FL-ASLEEP \FALSE
	PRINT K-HOLMES-DISTRACTION-MSG
	CRLF
	EQUAL? GL-PRSA,V?HIT /?L102
	PUSH 0
	JUMP ?L103
?L102:	PUSH 1
?L103:	CALL PRINT-ID,STR?249,STACK >STACK
	RSTACK
?L99:	EQUAL? GL-PRSA,V?ASK-FOR \?L105
	FSET? CH-HOLMES,FL-ASLEEP \?L106
	PRINTR "Holmes does not respond."
?L106:	FSET? CH-HOLMES,FL-LOCKED \?L108
	PRINTR "Holmes can't give you anything. He is tied up."
?L108:	EQUAL? GL-PRSI,TH-RING \?L109
	IN? TH-RING,LOCAL-GLOBALS \?L109
	PRINTR "Holmes says, ""I haven't mentioned any ring, Watson."""
?L109:	IN? GL-PRSI,CH-HOLMES \?L110
	MOVE GL-PRSI,CH-PLAYER
	PRINTI "Holmes gives you "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L110:	PRINTI "Holmes says, ""I do not have "
	ICALL1 RT-THEI-PRINT
	PRINTR "."""
?L105:	EQUAL? GL-PRSA,V?TELL-ABOUT \FALSE
	EQUAL? GL-PRSI,LG-TOWER,TH-NEWSPAPER,CH-PRIME-MINISTER \?L113
	FSET? CH-HOLMES,FL-ASLEEP \?L115
	FSET GL-PRSI,FL-HOLMES-TOLD
	CALL1 RT-WAKE-UP-HOLMES >STACK
	RSTACK
?L113:	FSET? CH-HOLMES,FL-ASLEEP \?L115
	ICALL2 RT-CTHEO-PRINT,CH-HOLMES
	PRINT K-SEEMS-TO-HEAR-MSG
	CRLF
	RTRUE
?L115:	FSET? GL-PRSI,FL-HOLMES-TOLD /?L116
	FSET GL-PRSI,FL-HOLMES-TOLD
	PRINTR "Holmes nods thoughtfully and says, ""Most interesting, old fellow."""
?L116:	PRINTI """Don't be tedious, Watson. You have mentioned "
	ICALL2 RT-SAY-HIM-HER-THEM-IT-MSG,GL-PRSI
	PRINTR " to me already."""

	.FUNCT RT-HOLMES-SAYS-AGRA-MSG
	PRINTI " says, ""It's obviously not one of the Crown Jewels, Watson. In fact, this gem belongs to the Agra treasure, which was stolen in India many years ago and has never been recovered."""
	CRLF
	CRLF
	PRINTR """The case grows more complex, Watson. We are in more danger than I had at first suspected."" He removes a ring from one of his long, slender fingers and hands it to you. ""Here, Watson. Take this signet ring of mine. If anything should happen to me, take it to my brother Mycroft at the Diogenes Club. He'll tell you what to do."""

	.FUNCT RT-HOLMES-DESCRIBE-MSG?,OBJ,WRD
	FSET? CH-HOLMES,FL-ASLEEP \?L1
	ICALL2 RT-CTHEO-PRINT,CH-HOLMES
	PRINT K-SEEMS-TO-HEAR-MSG
	CRLF
	RTRUE
?L1:	FSET? CH-MORIARTY,FL-LOCKED \?L3
	PRINTR """There is no time for questions, Watson. We must get the Crown Jewels to Buckingham Palace before nine o'clock."""
?L3:	EQUAL? GL-PRSA,V?WHO \?L4
	EQUAL? GL-PRSO,CH-HOLMES \?L4
	PRINTR """Watson, as my biographer, you know me as well as anyone."""
?L4:	EQUAL? OBJ,CH-MORIARTY \?L5
	FSET? CH-HOLMES,FL-LOCKED \?L6
	PRINTR """He appears to have the upper hand, Watson."""
?L6:	PRINTR """He is the Napoleon of crime, Watson. He is the organizer of half that is evil and of nearly all that is undetected in this great city."""
?L5:	CALL RT-IDENTIFY-EVENT?,W?MYCROFT,OBJ >STACK
	ZERO? STACK /?L9
	PRINTR """Mycroft is my older brother, of whom you have heard me speak. As you know, he is a highly placed official within Her Majesty's government. Because of the confidential nature of his work, you cannot call upon him in his offices. However, he is usually to be found in his club, just off Trafalgar Square."""
?L9:	EQUAL? OBJ,CH-HOLMES \?L10
	PRINTR """I'm well, Watson. Thank you for asking."""
?L10:	EQUAL? OBJ,CH-PRIME-MINISTER \?L11
	IN? CH-PRIME-MINISTER,RM-HOLMES-STUDY \?L12
	PRINTR """Hush, my friend. Wait until we're alone."""
?L12:	FSET? CH-PRIME-MINISTER,FL-SEEN /?L14
	PRINTR """I haven't seen this visitor of whom you speak, Watson, but surely it is obvious that he has come because the Crown Jewels have been stolen from the Tower of London."""
?L14:	PRINTR """Surely you recognized him, old fellow. He is the Prime Minister of England."""
?L11:	EQUAL? OBJ,CH-QUEEN \?L16
	PRINTR """She must be worried, Watson. We must get the gems back for her."""
?L16:	EQUAL? OBJ,CH-WIGGINS \?L17
	PRINTR """Surely you remember him, dear fellow. He is the head of the Baker Street Irregulars."""
?L17:	CALL RT-IDENTIFY-EVENT?,W?LESTRADE,OBJ >STACK
	ZERO? STACK /?L18
	PRINTR """Be kind to him, Watson. He has delusions of adequacy."""
?L18:	CALL RT-IDENTIFY-EVENT?,W?THEFT,OBJ >STACK
	ZERO? STACK /?L19
	PRINTR """We must recover the jewels and return them to the Palace. The alternative is too horrible to consider."""
?L19:	EQUAL? OBJ,TH-CROWN-JEWELS \?L20
	PRINTR """We must recover them and return them to the Palace. The alternative is too horrible to consider."""
?L20:	EQUAL? OBJ,LG-TOWER /?L22
	CALL RT-IDENTIFY-EVENT?,W?THEFT,OBJ >STACK
	ZERO? STACK /?L21
?L22:	PRINTR """The Tower is the safest stronghold in the nation. Our adversary must be formidable indeed."""
?L21:	CALL RT-IDENTIFY-EVENT?,W?JUBILEE,OBJ >STACK
	ZERO? STACK /?L23
	PRINTR """The Coronation Day festivities begin Monday morning at 9:00. We must recover the Crown Jewels before then."""
?L23:	EQUAL? OBJ,LG-TOMBS-ABBEY \?L24
	PRINTR """It is the burial place of our royalty, Watson. The spiritual centre of the empire."""
?L24:	CALL RT-IDENTIFY-EVENT?,W?PASSWORD,OBJ >STACK
	ZERO? STACK /?L25
	FSET? CH-HOLMES,FL-LOCKED \?L26
	PRINTR """Obviously you were able to deduce it without my help, Watson. Good show!"""
?L26:	PRINTR """Patience, old fellow. We are not yet in possession of all the facts."""
?L25:	EQUAL? OBJ,TH-WALL /?L30
	CALL RT-IDENTIFY-FLOOR?,W?GROUND,OBJ >STACK
	ZERO? STACK \?L30
	CALL RT-IDENTIFY-FLOOR?,W?FLOOR,OBJ >STACK
	ZERO? STACK /?L29
?L30:	PRINTR """No need to ask about that, old fellow. I'll tell you straight away if I find anything of interest."""
?L29:	CALL RT-IDENTIFY-FLOOR?,W?SKY,OBJ >STACK
	ZERO? STACK /?L31
	PRINTI "Holmes glances up and says, ""It's an uncommonly fine "
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L32
	PRINTI "night"
	JUMP ?L36
?L32:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1 \?L34
	PRINTI "morning"
	JUMP ?L36
?L34:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,2 \?L35
	PRINTI "day"
	JUMP ?L36
?L35:	PRINTI "evening"
?L36:	PRINTR ", Watson."""
?L31:	EQUAL? OBJ,TH-STETHOSCOPE \?L37
	FSET? TH-STETHOSCOPE,FL-TOUCHED /?L37
	PRINT K-CUSTOMARILY-KEEP-MSG
	CRLF
	RTRUE
?L37:	CALL RT-IDENTIFY-EVENT?,W?HENRY,OBJ >STACK
	ZERO? STACK /?L38
	PRINTR """He was the son of John of Gaunt, and the father of Henry V."""
?L38:	CALL RT-IDENTIFY-EVENT?,W?WELLINGTON,OBJ >STACK
	ZERO? STACK /?L39
	PRINTR """My dear fellow, your memory is fading prematurely. Surely you remember that the Duke of Wellington was the hero of the battle of Waterloo."""
?L39:	CALL RT-IDENTIFY-EVENT?,W?TOBY,OBJ >STACK
	ZERO? STACK /?L40
	PRINTI """He is a noble hound whose olfactory prowess is unrivaled."
	FSET? CH-SHERMAN,FL-SEEN \?L41
	PRINTI " It is unfortunate that he is unavailable to help us in our quest."
?L41:	PRINTR """"
?L40:	CALL RT-IDENTIFY-EVENT?,W?AGRA,OBJ >STACK
	ZERO? STACK /?L44
	PRINTR """The Agra treasure disappeared during the Sepoy rebellion in India. Clearly it has found its way to London."""
?L44:	CALL RT-IDENTIFY-EVENT?,W?KIDNAPPING,OBJ >STACK
	ZERO? STACK /?L45
	BAND MYCROFT-STATE,MYCROFT-SEEN >STACK
	ZERO? STACK \?L46
	PRINT K-NEVER-THEORIZE-MSG
	CRLF
	RTRUE
?L46:	PRINTR """The professor was as surprised as we, Watson. Evidently it was a mistake on the part of one of his minions."""
?L45:	EQUAL? OBJ,CH-HUDSON \?L49
	PRINTR """A splendid housekeeper, Watson, although she worries about me too much."""
?L49:	EQUAL? OBJ,CH-PLAYER,CH-ME \?L50
	PRINTR """Good old Watson! You are the one fixed point in a changing age. I am honoured that you have become my biographer."""
?L50:	EQUAL? OBJ,TH-PHIAL,TH-SYRINGE,TH-LIQUID \?L51
	PRINTR "Holmes gives you a grateful look and says, ""We need no longer worry about that, Watson, thanks to your timely intervention."""
?L51:	FSET? OBJ,FL-SEEN /?L52
	PRINT K-NEVER-THEORIZE-MSG
	CRLF
	RTRUE
?L52:	EQUAL? OBJ,CH-MATCH-SNIFFING-DOG \?L53
	PRINTR """It's not the Hound of the Baskervilles. But I certainly wouldn't care to make it angry."""
?L53:	EQUAL? OBJ,CH-TUSSAUDS-GUARD \?L54
	PRINTR """Beyond the obvious facts that he is left-handed, ate kippers for breakfast, and had a poor night's sleep, I can tell you that he is a good, honest workman. Britain could use more like him."""
?L54:	EQUAL? OBJ,CH-TRAINED-PIGEON \?L55
	PRINTI """A fine bird, Watson."
	CALL2 RT-VISIBLE?,CH-TRAINED-PIGEON >STACK
	ZERO? STACK /?L56
	PRINTI " Note the broad band on his wing that distinguishes his breed from all others."
?L56:	PRINTR """"
?L55:	EQUAL? OBJ,CH-SHERMAN \?L59
	PRINTR """Oh, he's an old friend of mine. He has an extraordinary bloodhound named Toby who has been of invaluable assistance to me in the past."""
?L59:	EQUAL? OBJ,CH-BANK-GUARD \?L60
	PRINTR """Watch him carefully, Watson. He is a petty criminal on the lowest rung of Moriarty's organization. He's not to be trusted."""
?L60:	EQUAL? OBJ,CH-AKBAR \?L61
	PRINTR """He is the gentleman from India whom we discussed earlier."""
?L61:	EQUAL? OBJ,CH-DENKEEPER \?L62
	PRINTR """Be careful of him Watson. He is one of Moriarty's minions."""
?L62:	EQUAL? OBJ,CH-LIBRARIAN \?L63
	PRINTR """He's just a harmless old fellow who is starved for companionship. It's a wonder he hasn't retired and joined his twin brother who lives in New Zealand."""
?L63:	EQUAL? OBJ,CH-URCHINS \?L64
	PRINTR """They're all members of the Baker Street Irregulars."""
?L64:	EQUAL? OBJ,CH-VENDOR \?L65
	PRINTR """He's harmless enough, although his goods are terribly overpriced."""
?L65:	EQUAL? OBJ,CH-GROWLER-CABBIE \?L66
	PRINTR """He doesn't seem very bright, does he?"""
?L66:	EQUAL? OBJ,CH-HANSOM-CABBIE \?L67
	PRINTR """It's clear that he has a loving wife and that he is a retired marine sergeant. Beyond that I can tell you little."""
?L67:	EQUAL? OBJ,CH-BUTLER \?L68
	PRINTR """He's a supercilious old coot who ought to be stuffed."""
?L68:	EQUAL? OBJ,CH-NANNIES \?L69
	PRINTR """They are the backbone of the empire, Watson."""
?L69:	EQUAL? OBJ,CH-PALACE-GUARD \?L70
	PRINTR """He is obviously one of the Queen's finest - dedicated, loyal, and completely incorruptible."""
?L70:	EQUAL? OBJ,CH-TOWER-GUARD \?L71
	PRINTR """I can tell you little about him, other than that he is incorruptible, he lives near Wandsworth Common, and he once worked in a tin mine."""
?L71:	EQUAL? OBJ,CH-ELIZA-DOOLITTLE \?L72
	FSET? CH-ELIZA-DOOLITTLE,FL-ASLEEP \?L73
	PRINTR """I bow to your medical expertise, doctor. What is your diagnosis?"""
?L73:	PRINTR """You saved her life, Watson. Professor Higgins will be most grateful."""
?L72:	EQUAL? OBJ,LG-RAVENS \?L76
	PRINTR """According to the legend, when the ravens leave the Tower of London, the British Empire will fall."""
?L76:	EQUAL? OBJ,TH-GUN,TH-TOBACCO,TH-PERSIAN-SLIPPER /?L78
	EQUAL? OBJ,TH-MAGNIFYING-GLASS,TH-LAMP,TH-BED /?L78
	EQUAL? OBJ,TH-BEDSIDE-TABLE,TH-PIPE \?L77
?L78:	PRINTR """Surely you remember it, Watson. Little has changed in the time since you left."""
?L77:	EQUAL? OBJ,TH-WATSONS-HAT,TH-STETHOSCOPE,TH-POCKET /?L80
	EQUAL? OBJ,TH-WATSONS-COAT,TH-BLACK-BAG,TH-CAB-WHISTLE \?L79
?L80:	PRINTR """Other than the obvious fact that it belongs to you, I can tell you nothing."""
?L79:	EQUAL? OBJ,TH-BLUE-PILL-BOTTLE,TH-BROWN-PILL-BOTTLE,TH-ORANGE-PILL /?L82
	EQUAL? OBJ,TH-YELLOW-PILL \?L81
?L82:	PRINTR """Surely you know more about it than I, Doctor."""
?L81:	EQUAL? OBJ,TH-LAB-EQUIPMENT,TH-ETHERIUM-GAS,TH-ETHERIUM-AMPOULE /?L84
	EQUAL? OBJ,TH-WORKBENCH \?L83
?L84:	PRINTR "Holmes glances around quickly and then whispers, ""I know I can trust your discretion, Watson, but you must promise to keep this under your hat. I have been conducting secret experiments for the government at Mycroft's request, and I have developed a new knockout gas that I call 'etherium.' It is an extremely powerful derivative of ether, and one ampoule of it will render unconscious an entire room of people for several hours. It has no harmful side effects, but it is highly explosive and extremely dangerous to use near open flames. You may keep it if you wish, but please carry it in a secure place, safe from prying eyes."""
?L83:	EQUAL? OBJ,TH-CHARLES-STATUE \?L85
	PRINTR """He is the only English king to have been beheaded."""
?L85:	EQUAL? OBJ,TH-WILLIAM-STATUE \?L86
	PRINTR """They say when he first came ashore, he stumbled and fell, and his soldiers took it as a bad omen. But then he arose with two fistfuls of sand and shouted, 'See! Already I have taken my kingdom into my grasp.' His men cheered and they marched on to victory at the Battle of Hastings."""
?L86:	EQUAL? OBJ,TH-WALTER-STATUE \?L87
	PRINTR """His chivalry did him no good. Although a favourite of the Queen for many years, his life ended on the executioner's block."""
?L87:	EQUAL? OBJ,TH-VIOLIN \?L88
	PRINTR """It's a Stradivarius."""
?L88:	EQUAL? OBJ,TH-RING \?L89
	PRINTR """It's an heirloom that's been in my family for generations."""
?L89:	EQUAL? OBJ,TH-TRINKETS \?L90
	PRINTR """They've been marked up for the Jubilee. I certainly wouldn't pay full price for them."""
?L90:	EQUAL? OBJ,TH-WESTMINSTER-CLUE \?L91
	PRINTR """Most curious, don't you agree Watson? All thieves unintentionaly leave behind clues that are discernable to the trained eye. But it is highly irregular for a thief to taunt the authorities with an actual message. Especially one with references as obvious as this."""
?L91:	EQUAL? OBJ,TH-RUBY,TH-EMERALD,TH-SAPPHIRE /?L93
	EQUAL? OBJ,TH-GARNET,TH-OPAL,TH-TOPAZ \?L92
?L93:	BTST CH-HOLMES-AUX1,K-HOLMES-GEM? \?L94
	PRINTR """We have already discussed the significance of these gems, Watson."""
?L94:	FSET? OBJ,FL-TOUCHED \?L96
	BOR CH-HOLMES-AUX1,K-HOLMES-GEM? >CH-HOLMES-AUX1
	MOVE TH-RING,CH-PLAYER
	FSET TH-RING,FL-SEEN
	FSET TH-RING,FL-TOUCHED
	FCLEAR TH-RING,FL-NODESC
	PRINTI "Holmes"
	ICALL1 RT-HOLMES-SAYS-AGRA-MSG
	GETP TH-RING,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-RING,P?VALUE,0
	RTRUE
?L96:	PRINTR """We haven't had a good enough look at it yet, old fellow."""
?L92:	EQUAL? OBJ,TH-ASH \FALSE
	PRINTI """"
	CALL2 RT-VISIBLE?,TH-ASH >STACK
	ZERO? STACK /?L99
	PRINTI "Note the characteristic texture, Watson. "
?L99:	PRINTI "It is the ash of a Trichinopoly cigar, which is made from the dark tobacco that grows only in the Madras district of India."
	CRLF
	CRLF
	PRINTR "Unless I miss my guess, Watson, our mastermind friend has joined forces with an Indian accomplice who does his dirty work for him."""

	.FUNCT RT-AC-CH-MATCH-SNIFFING-DOG,CONTEXT
	ASSIGNED? 'CONTEXT /?L23
	SET 'CONTEXT,0
?L23:	ICALL2 RT-THIS-IS-IT,CH-MATCH-SNIFFING-DOG
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	ICALL2 RT-CTHEO-PRINT,CH-MATCH-SNIFFING-DOG
	PRINTR " glares back at you menacingly."
?L1:	EQUAL? CONTEXT,K-M-WINNER \?L4
	ICALL2 RT-CTHEO-PRINT,CH-MATCH-SNIFFING-DOG
	PRINT K-GNAWS-MSG
	CRLF
	RTRUE
?L4:	ZERO? GL-NOW-PRSI? /?L24
	EQUAL? GL-PRSA,V?GIVE,V?SHOW \FALSE
	EQUAL? GL-PRSO,TH-TOBACCO /?L10
	FSET? GL-PRSO,FL-BURNABLE \?L10
	FSET? GL-PRSO,FL-LIGHTED /?L9
?L10:	EQUAL? GL-PRSO,TH-MATCH \?L11
	FSET? GL-PRSO,FL-BURNABLE /?L9
?L11:	EQUAL? GL-PRSO,TH-LAMP \FALSE
?L9:	IXCALL SOUNDS,S-BARK,S-START,8,4
	ICALL1 RT-CTHEI-PRINT
	PRINTI " barks loudly at "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L24:	EQUAL? GL-PRSA,V?TOUCH,V?KICK \?L14
	PRINTI "A quick snap and a glimpse of flashing teeth changes your mind."
	CRLF
	EQUAL? GL-PRSA,V?KICK /?L16
	PUSH 0
	JUMP ?L17
?L16:	PUSH 1
?L17:	ICALL PRINT-ID,STR?250,STACK
	RTRUE
?L14:	EQUAL? GL-PRSA,V?LISTEN \?L18
	ICALL1 RT-CTHEO-PRINT
	PRINTI " growls at you."
	CRLF
	ICALL2 SOUNDS,S-GROWL
	RTRUE
?L18:	EQUAL? GL-PRSA,V?ASK-FOR,V?ASK-ABOUT \?L19
	ICALL2 RT-CTHEO-PRINT,CH-MATCH-SNIFFING-DOG
	PRINT K-GNAWS-MSG
	CRLF
	RTRUE
?L19:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	EQUAL? GL-PRSO,CH-MATCH-SNIFFING-DOG \FALSE
	ICALL RT-CYOU-MSG,STR?252,STR?251
	PRINTI "the unfortunate dog. The guard, enraged by this callous behavior, wrestles you to the ground and calls for a policeman. Lestrade pops up out of nowhere and says, ""Tut, tut. Killing a poor defenceless dog now, is it? You should be ashamed of yourself."""
	CRLF
	CRLF
	PRINTI "He hauls you away and enrolls you in a six-month course sponsored by the RSPCA which teaches you to love animals and eat vegetables. You emerge from the course a better man. Unfortunately no one cares because by then the country has gone to the dogs."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?253
	ICALL1 RT-QSR
	RFALSE

	.FUNCT RT-AC-CH-TUSSAUDS-GUARD,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L23
	SET 'CONTEXT,0
?L23:	ICALL2 RT-THIS-IS-IT,CH-TUSSAUDS-GUARD
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	ICALL2 RT-CTHEO-PRINT,CH-TUSSAUDS-GUARD
	PRINTR " has his collar turned up against the cold. He is pacing back and forth, puffing on a cigarette, and stamping his feet, all in a futile effort to keep warm."
?L1:	EQUAL? GL-PRSA,V?ASK-FOR \?L3
	EQUAL? GL-PRSI,TH-CIGARETTE \?L3
	PRINTR """Sorry, sir. I'm running low."""
?L3:	EQUAL? GL-PRSA,V?ASK-ABOUT \?L4
	EQUAL? GL-PRSI,TH-CIGARETTE \?L4
	PRINTR """I'm a chain smoker. Fortunately, the dog doesn't seem to mind."""
?L4:	CALL2 RT-TELL-ABOUT?,CH-TUSSAUDS-GUARD >STACK
	ZERO? STACK /?L5
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L6
	SET 'OBJ,GL-PRSO
	JUMP ?L8
?L6:	SET 'OBJ,GL-PRSI
?L8:	PRINT K-ON-DUTY-MSG
	CRLF
	RTRUE
?L5:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L9
	RETURN 2
?L9:	EQUAL? CONTEXT,K-M-WINNER \?L10
	EQUAL? GL-PRSA,V?WHERE \?L11
	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK /?L11
	PRINTR """Right here, sir."""
?L11:	EQUAL? GL-PRSA,V?YES \?L13
	PRINT K-GOOD-SHOW-MSG
	CRLF
	RTRUE
?L13:	EQUAL? GL-PRSA,V?NO \?L14
	PRINT K-PITY-MSG
	CRLF
	RTRUE
?L14:	EQUAL? GL-PRSA,V?MAYBE \?L15
	PRINT K-MAYBE-MSG
	CRLF
	RTRUE
?L15:	PRINT K-ON-DUTY-MSG
	CRLF
	RTRUE
?L10:	ZERO? GL-NOW-PRSI? /FALSE
	EQUAL? GL-PRSA,V?TAKE \FALSE
	ICALL2 PRINT-ID,STR?254
	CALL RT-IMPOLITE-MSG,STR?256,STR?255 >STACK
	RSTACK

	.FUNCT RT-PIGEON-PANIC
	MOVE CH-TRAINED-PIGEON,CH-PLAYER
	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	PRINTR " flies about in a panic for a few moments and then flies right back into your hands."

	.FUNCT RT-PIGEON-FLY
	PRINTI " flies up into the air"
	EQUAL? GL-PLACE-CUR,RM-TRAFALGAR-SQUARE \?L6
	SET 'CH-TRAINED-PIGEON-AUX3,TH-RED-GLASS
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-SHOWN-RUBY \?L5
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-GET-RUBY \?L3
	PRINTI ", gets "
	ICALL2 RT-THEO-PRINT,TH-RUBY
	PRINTI ","
	SET 'CH-TRAINED-PIGEON-AUX3,TH-RUBY
	JUMP ?L6
?L3:	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-SHOWN-RUBY \?L5
	PRINTI ", sees "
	ICALL2 RT-THEO-PRINT,TH-RUBY
	PRINTI " and "
	ICALL2 RT-A-PRINT,TH-RED-GLASS
	PRINTI " that you didn't see, chooses "
	ICALL2 RT-THEO-PRINT,TH-RED-GLASS
	PRINTI ","
	JUMP ?L6
?L5:	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-GET-RUBY \?L6
	PRINTI ", sees "
	ICALL2 RT-A-PRINT,TH-RED-GLASS
	PRINTI " that you didn't see, gets it,"
?L6:	ZERO? CH-TRAINED-PIGEON-AUX3 /?L9
	FSET CH-TRAINED-PIGEON-AUX3,FL-TAKEABLE
	MOVE CH-TRAINED-PIGEON-AUX3,CH-TRAINED-PIGEON
?L9:	MOVE CH-TRAINED-PIGEON,GL-PLACE-CUR
	FSET CH-TRAINED-PIGEON,FL-NODESC
	SET 'CH-TRAINED-PIGEON-AUX2,1
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-PIGEON-CIRCLE,STACK
	PRINTR " and starts to circle high over your head."

	.FUNCT RT-AC-CH-TRAINED-PIGEON,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L76
	SET 'CONTEXT,0
?L76:	ICALL2 RT-THIS-IS-IT,CH-TRAINED-PIGEON
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	IN? CH-TRAINED-PIGEON,CH-SHERMAN \?L3
	ICALL2 DPRINT,CH-SHERMAN
	PRINTI " is holding "
	ICALL2 RT-THEO-PRINT,CH-TRAINED-PIGEON
	JUMP ?L10
?L3:	ZERO? CH-TRAINED-PIGEON-AUX2 \TRUE
	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-SHOWN-RUBY \?L7
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-GET-RUBY \?L7
	PRINTI " trembles with excitement"
	JUMP ?L10
?L7:	BAND CH-TRAINED-PIGEON-AUX1,3 >STACK
	ZERO? STACK /?L9
	PRINTI " looks interested"
	JUMP ?L10
?L9:	PRINTI " doesn't seem interested in anything"
?L10:	PRINTR "."
?L1:	CALL2 RT-TELL-ABOUT?,CH-TRAINED-PIGEON >STACK
	ZERO? STACK /?L11
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L12
	SET 'OBJ,GL-PRSO
	JUMP ?L14
?L12:	SET 'OBJ,GL-PRSI
?L14:	PRINT K-CONFUSED-MSG
	CRLF
	RTRUE
?L11:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L15
	RETURN 2
?L15:	EQUAL? CONTEXT,K-M-WINNER \?L16
	EQUAL? GL-PRSA,V?TAKE \?L17
	EQUAL? GL-PRSO,TH-RUBY \?L17
	ICALL2 RT-THIS-IS-IT,TH-RUBY
	ICALL2 RT-PIGEON-INTEREST,K-PIGEON-GET-RUBY
	RTRUE
?L17:	PRINT K-CONFUSED-MSG
	CRLF
	RTRUE
?L16:	EQUAL? GL-PRSA,V?PUT \?L20
	ZERO? GL-NOW-PRSI? \?L20
	EQUAL? GL-PRSI,TH-SHAFT \?L21
	SET 'CH-TRAINED-PIGEON-AUX1,0
	ICALL1 RT-PIGEON-PANIC
	RTRUE
?L21:	EQUAL? GL-PRSI,TH-POCKET \?L24
	FSET? GL-PLACE-CUR,FL-INDOORS \?L23
?L24:	ICALL1 RT-PIGEON-PANIC
	RTRUE
?L23:	PRINTI "As soon as"
	ICALL RT-YOU-MSG,STR?258,STR?257
	PRINTI "go of it, the pigeon"
	ICALL1 RT-PIGEON-FLY
	RTRUE
?L20:	EQUAL? GL-PRSA,V?DROP,V?RELEASE,V?THROW \?L26
	ZERO? GL-NOW-PRSI? \?L26
	IN? CH-TRAINED-PIGEON,CH-PLAYER \?L27
	ICALL2 RT-ALARM-CLR,RT-I-PIGEON-LOSE-INTEREST
	ICALL2 RT-ALARM-CLR,RT-I-PIGEON-IMPATIENT
	FSET? GL-PLACE-CUR,FL-INDOORS \?L29
	ICALL1 RT-PIGEON-PANIC
	SET 'CH-TRAINED-PIGEON-AUX1,0
	RTRUE
?L29:	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	ICALL1 RT-PIGEON-FLY
	RTRUE
?L27:	ICALL1 RT-CYOU-MSG
	PRINTR "would have to be holding the pigeon."
?L26:	EQUAL? GL-PRSA,V?TAKE \?L33
	ZERO? CH-TRAINED-PIGEON-AUX2 /?L34
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot reach "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L34:	IN? CH-TRAINED-PIGEON,CH-SHERMAN \FALSE
	ICALL RT-IMPOLITE-MSG,STR?256,STR?255
	RTRUE
?L33:	EQUAL? GL-PRSA,V?ASK-FOR \?L38
	ZERO? GL-NOW-PRSI? /?L38
	ICALL1 RT-GET-PIGEON
	RTRUE
?L38:	EQUAL? GL-PRSA,V?SHOW \?L39
	ZERO? GL-NOW-PRSI? /?L39
	EQUAL? GL-PRSO,TH-RUBY \?L40
	ICALL2 RT-THIS-IS-IT,TH-RUBY
	ICALL2 RT-PIGEON-INTEREST,K-PIGEON-SHOWN-RUBY
	RTRUE
?L40:	PRINTI "The pigeon doesn't seem to be interested in "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L39:	EQUAL? GL-PRSA,V?KILL,V?SHOOT \?L43
	EQUAL? GL-PRSO,CH-TRAINED-PIGEON \?L43
	EQUAL? GL-PRSI,TH-GUN /?L46
	EQUAL? GL-PRSA,V?SHOOT \?L44
?L46:	CALL RT-META-IN?,GL-PRSO,CH-PLAYER >STACK
	ZERO? STACK /?L47
	PRINT K-DROP-IT-FIRST-MSG
	CRLF
	RTRUE
?L47:	ZERO? CH-TRAINED-PIGEON-AUX2 /?L50
	PRINTI "Flap. Flap. Flap. Thud."
	CRLF
	ICALL2 PRINT-ID,STR?259
	JUMP ?L62
?L50:	PRINTI "You shoot "
	ICALL1 RT-THEO-PRINT
	PRINTI " and it dies."
	CRLF
	ICALL2 PRINT-ID,STR?260
	JUMP ?L62
?L44:	EQUAL? GL-PRSI,TH-KNIFE /?L54
	EQUAL? GL-P-PRSA-WORD,W?STAB \?L53
?L54:	ZERO? CH-TRAINED-PIGEON-AUX2 /?L55
	PRINTI "You throw "
	ICALL1 RT-THEI-PRINT
	PRINTI " at "
	ICALL1 RT-THEO-PRINT
	PRINTI ". Fortunately, it misses and falls on the ground nearby."
	CRLF
	ICALL2 PRINT-ID,STR?261
	MOVE GL-PRSI,GL-PLACE-CUR
	RTRUE
?L55:	PRINTI "You slice "
	ICALL1 RT-THEO-PRINT
	PRINTI " into luncheon meat and cry out, ""Squab, anyone?"""
	CRLF
	ICALL2 PRINT-ID,STR?262
	JUMP ?L62
?L53:	EQUAL? GL-PRSI,TH-HANDS \?L58
	ZERO? CH-TRAINED-PIGEON-AUX2 /?L59
	PRINTI "You can't reach the pigeon."
	CRLF
	ICALL2 PRINT-ID,STR?263
	RTRUE
?L59:	PRINTI "You throttle the poor bird."
	CRLF
	ICALL2 PRINT-ID,STR?264
	JUMP ?L62
?L58:	PRINTI "You can't kill "
	ICALL1 RT-THEO-PRINT
	PRINTI " with "
	ICALL1 RT-THEI-PRINT
	PRINTI "."
	CRLF
	ICALL2 PRINT-ID,STR?265
	RTRUE
?L62:	ZERO? CH-TRAINED-PIGEON-AUX2 /?L63
	ZERO? CH-TRAINED-PIGEON-AUX3 /?L63
	MOVE CH-TRAINED-PIGEON-AUX3,GL-PLACE-CUR
?L63:	ICALL1 RT-KILL-PIGEON
	RTRUE
?L43:	EQUAL? GL-PRSA,V?TOUCH \?L66
	ZERO? GL-NOW-PRSI? \?L66
	ICALL1 RT-CTHEO-PRINT
	PRINTI " coos and nuzzles your hand."
	CRLF
	CALL2 PRINT-ID,STR?266 >STACK
	RSTACK
?L66:	EQUAL? GL-PRSA,V?CALL \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	CALL RT-META-IN?,CH-TRAINED-PIGEON,GL-WINNER >STACK
	ZERO? STACK /?L68
	ICALL RT-CYOU-MSG,STR?242,STR?241
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L68:	ZERO? CH-TRAINED-PIGEON-AUX2 /?L70
	ICALL1 RT-CTHEO-PRINT
	PRINTI " ignores "
	EQUAL? GL-WINNER,CH-PLAYER,CH-ME \?L71
	PRINTI "you"
	JUMP ?L73
?L71:	ICALL2 RT-THEO-PRINT,GL-WINNER
?L73:	PRINTR ", intent on its task."
?L70:	ICALL1 RT-CTHEO-PRINT
	PRINTI " looks at"
	ICALL1 RT-YOU-MSG
	PRINTR "briefly, then loses interest."

	.FUNCT RT-AC-CH-SHERMAN,CONTEXT,OBJ,OBJ1,P-OBJ,WHO
	ASSIGNED? 'CONTEXT /?L56
	SET 'CONTEXT,0
?L56:	ICALL2 RT-THIS-IS-IT,CH-SHERMAN
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? CH-SHERMAN,FL-ASLEEP \FALSE
	PRINTR "Sherman is quite unconscious."
?L1:	SET 'P-OBJ,CH-TRAINED-PIGEON-AUX3
	EQUAL? CONTEXT,K-M-WINNER \?L7
	FSET? CH-SHERMAN,FL-ASLEEP \?L7
	CALL2 RT-NO-CONDITION-MSG,GL-WINNER >STACK
	RSTACK
?L7:	CALL2 RT-TELL-ABOUT?,CH-SHERMAN >STACK
	ZERO? STACK /?L9
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L10
	SET 'OBJ,GL-PRSO
	JUMP ?L12
?L10:	SET 'OBJ,GL-PRSI
?L12:	FSET? CH-SHERMAN,FL-ASLEEP \?L13
	ICALL2 RT-NO-CONDITION-MSG,CH-SHERMAN
	RTRUE
?L13:	EQUAL? OBJ,CH-TRAINED-PIGEON \?L15
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-TIRED \?L16
	IN? P-OBJ,CH-SHERMAN \?L18
	PRINTI "Sherman says, ""He came back with "
	ICALL2 RT-A-PRINT,P-OBJ
	PRINTI ". I don't know where he found it."" He gives you "
	ICALL2 RT-THEO-PRINT,P-OBJ
	PRINTI "."
	CRLF
	ICALL2 RT-PIGEON-OBJ,P-OBJ
	RTRUE
?L18:	PRINTR """He's resting now."""
?L16:	PRINTR """He's a wonderful bird. All you have to do is show him something and tell him to get it, and away he goes. The only catch is, he only seems to like things that are red."""
?L15:	CALL RT-IDENTIFY-EVENT?,W?TOBY,OBJ >STACK
	ZERO? STACK /?L22
	PRINTR """He seems to have a cold, which in his line of work renders him completely useless."""
?L22:	EQUAL? OBJ,CH-SHERMAN \?L23
	PRINTR """I'm well. Thank you for asking."""
?L23:	EQUAL? OBJ,CH-HOLMES \?L24
	PRINTR """Sherlock and me? We've been mates for years."""
?L24:	EQUAL? OBJ,P-OBJ \?L25
	IN? P-OBJ,CH-SHERMAN \?L25
	PRINTI "Sherman says, ""The pigeon came back with "
	ICALL2 RT-A-PRINT,P-OBJ
	PRINTI ". I don't know where he found it."" He gives you "
	ICALL2 RT-THEO-PRINT,P-OBJ
	PRINTI "."
	CRLF
	ICALL2 RT-PIGEON-OBJ,P-OBJ
	RTRUE
?L25:	PRINTI """I don't know anything about "
	ICALL2 RT-THEO-PRINT,OBJ
	PRINTR "."""
?L9:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L27
	RETURN 2
?L27:	EQUAL? CONTEXT,K-M-WINNER \?L28
	EQUAL? GL-PRSA,V?TAKE \?L28
	EQUAL? GL-PRSO,CH-TRAINED-PIGEON /?L29
	CALL RT-IDENTIFY-EVENT?,W?TOBY,GL-PRSO >STACK
	ZERO? STACK /?L28
?L29:	SET 'GL-WINNER,CH-PLAYER
	ICALL RT-PERFORM,V?ASK-FOR,CH-SHERMAN,GL-PRSO
	RTRUE
?L28:	EQUAL? GL-PRSA,V?ASK-FOR \?L32
	ZERO? GL-NOW-PRSI? \?L32
	SET 'OBJ1,GL-PRSI
	ZERO? OBJ1 \?L31
?L32:	EQUAL? GL-PRSA,V?GIVE \?L30
	EQUAL? GL-PRSI,CH-ME,CH-PLAYER \?L30
	EQUAL? CONTEXT,K-M-WINNER \?L30
	SET 'OBJ1,GL-PRSO
	ZERO? OBJ1 /?L30
?L31:	FSET? CH-SHERMAN,FL-ASLEEP \?L33
	ICALL2 RT-NO-CONDITION-MSG,CH-SHERMAN
	RTRUE
?L33:	EQUAL? OBJ1,CH-TRAINED-PIGEON \?L35
	ICALL1 RT-GET-PIGEON
	RTRUE
?L35:	CALL RT-IDENTIFY-EVENT?,W?TOBY,OBJ1 >STACK
	ZERO? STACK /?L36
	PRINTR """He's not well enough to work."""
?L36:	EQUAL? OBJ1,P-OBJ \?L37
	IN? P-OBJ,CH-SHERMAN \?L38
	PRINTI "Sherman says, ""Oh, yes. The pigeon came back with "
	ICALL2 RT-A-PRINT,P-OBJ
	PRINTI ". I don't know where he found it."" He gives you "
	ICALL2 RT-THEO-PRINT,P-OBJ
	PRINTI "."
	CRLF
	ICALL2 RT-PIGEON-OBJ,P-OBJ
	RTRUE
?L38:	PRINTR """I already gave it to you."""
?L37:	IN? GL-PRSI,CH-SHERMAN \?L41
	PRINTI "He gives you "
	ICALL2 RT-THEO-PRINT,OBJ1
	PRINTI "."
	CRLF
	MOVE OBJ1,CH-PLAYER
	ICALL2 RT-THIS-IS-IT,OBJ1
	FSET OBJ1,FL-SEEN
	FSET OBJ1,FL-TOUCHED
	FCLEAR OBJ1,FL-NODESC
	RTRUE
?L41:	PRINTI """I don't have "
	ICALL2 RT-A-PRINT,OBJ1
	PRINTR "."""
?L30:	EQUAL? GL-PRSA,V?TAKE \?L43
	ZERO? GL-NOW-PRSI? /?L43
	ICALL RT-IMPOLITE-MSG,STR?256,STR?255
	RTRUE
?L43:	EQUAL? CONTEXT,K-M-WINNER \FALSE
	EQUAL? GL-PRSA,V?HELLO \?L45
	PRINTR """Hello, Dr Watson."""
?L45:	EQUAL? GL-PRSA,V?GOODBYE \?L47
	PRINTR """Goodbye, Dr Watson."""
?L47:	EQUAL? GL-PRSA,V?THANK \?L48
	PRINTR """You're welcome."""
?L48:	EQUAL? GL-PRSA,V?GIVE-SWP /FALSE
	EQUAL? GL-PRSA,V?YES \?L50
	PRINT K-GOOD-SHOW-MSG
	CRLF
	RTRUE
?L50:	EQUAL? GL-PRSA,V?WHERE \?L51
	CALL2 RT-VISIBLE?,GL-PRSO >STACK
	ZERO? STACK /?L51
	PRINTR """Right here, Doctor."""
?L51:	EQUAL? GL-PRSA,V?NO \?L52
	PRINT K-PITY-MSG
	CRLF
	RTRUE
?L52:	EQUAL? GL-PRSA,V?MAYBE \?L53
	PRINT K-MAYBE-MSG
	CRLF
	RTRUE
?L53:	ICALL2 RT-CTHEO-PRINT,CH-SHERMAN
	PRINTR " says, ""Unfortunately, I won't be able to help you with that."""

	.FUNCT RT-AC-CH-PRIME-MINISTER,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L31
	SET 'CONTEXT,0
?L31:	ICALL2 RT-THIS-IS-IT,CH-PRIME-MINISTER
	EQUAL? CONTEXT,K-M-CONT \?L1
	PRINTI "You should be ashamed of yourself."
	CRLF
	ICALL2 PRINT-ID,STR?267
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L3
	PRINTI "He is an elderly man with bushy eyebrows and muttonchop whiskers."
	FSET? CH-PRIME-MINISTER,FL-ASLEEP \?L4
	PRINTI " He is also unconscious, thanks to you."
?L4:	CRLF
	RTRUE
?L3:	EQUAL? CONTEXT,K-M-WINNER \?L7
	FSET? GL-WINNER,FL-ASLEEP \?L7
	ICALL2 RT-NO-CONDITION-MSG,GL-WINNER
	RFALSE
?L7:	CALL2 RT-TELL-ABOUT?,CH-PRIME-MINISTER >STACK
	ZERO? STACK /?L8
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L9
	SET 'OBJ,GL-PRSO
	JUMP ?L11
?L9:	SET 'OBJ,GL-PRSI
?L11:	EQUAL? OBJ,CH-QUEEN \?L12
	PRINTR """It was she herself who suggested consulting Mr Holmes."""
?L12:	EQUAL? OBJ,TH-WESTMINSTER-CLUE \?L14
	PRINTR """We are all baffled by it. That is why we have come to Mr Holmes."""
?L14:	EQUAL? OBJ,LG-TOWER \?L15
	PRINTR """Naturally we have closed it until the investigation is terminated. No one has been allowed to leave since the theft was discovered."""
?L15:	EQUAL? OBJ,CH-HOLMES \?L16
	PRINTR """We learned of his talents from his brother, Mycroft."""
?L16:	CALL RT-IDENTIFY-EVENT?,W?MYCROFT,OBJ >STACK
	ZERO? STACK /?L17
	PRINTR """As you are no doubt aware, his involvement with the government is too sensitive for me to discuss."""
?L17:	EQUAL? OBJ,CH-HUDSON \?L18
	PRINTR """She was good enough to serve me tea while I waited. Splendid woman."""
?L18:	EQUAL? OBJ,CH-MORIARTY \?L19
	PRINTR """I don't believe I'm familiar with that name."""
?L19:	EQUAL? OBJ,TH-CROWN-JEWELS /?L21
	CALL RT-IDENTIFY-EVENT?,W?THEFT,OBJ >STACK
	ZERO? STACK /?L20
?L21:	PRINTR """If the theft is discovered, the public's faith in this government will be shattered. I shall be forced to resign."""
?L20:	PRINTR """Come, Doctor. Let us stick to the essentials."""
?L8:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L23
	RETURN 2
?L23:	EQUAL? CONTEXT,K-M-WINNER \FALSE
	EQUAL? GL-PRSA,V?YES \?L25
	PRINT K-GOOD-SHOW-MSG
	CRLF
	RFALSE
?L25:	EQUAL? GL-PRSA,V?NO \?L27
	PRINT K-PITY-MSG
	CRLF
	RFALSE
?L27:	EQUAL? GL-PRSA,V?MAYBE \?L28
	PRINT K-MAYBE-MSG
	CRLF
	RFALSE
?L28:	PRINTR """Surely, Doctor, we should not waste our time on such trivial activities."""

	.FUNCT RT-AC-CH-AKBAR,CONTEXT,HAT,OBJ,WRD,ADJ
	ASSIGNED? 'CONTEXT /?L57
	SET 'CONTEXT,0
?L57:	SET 'HAT,0
	ICALL2 RT-THIS-IS-IT,CH-AKBAR
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "He is a tall, dark-skinned Indian who wears a white turban."
?L1:	EQUAL? CONTEXT,K-M-WINNER \?L3
	FSET? GL-WINNER,FL-ASLEEP \?L3
	CALL2 RT-NO-CONDITION-MSG,GL-WINNER >STACK
	RSTACK
?L3:	CALL2 RT-TELL-ABOUT?,CH-AKBAR >STACK
	ZERO? STACK /?L4
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L5
	SET 'OBJ,GL-PRSO
	JUMP ?L7
?L5:	SET 'OBJ,GL-PRSI
?L7:	FSET? CH-AKBAR,FL-ASLEEP \?L8
	CALL2 RT-NO-CONDITION-MSG,CH-AKBAR >STACK
	RSTACK
?L8:	PRINTI """I know little"
	FSET? TH-WATSONS-HAT,FL-WORN \?L11
	PRINTI ", honoured sir"
?L11:	PRINTR ". I have only been in your country a short distance."""
?L4:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L14
	RETURN 2
?L14:	EQUAL? CONTEXT,K-M-WINNER \?L15
	FSET? CH-AKBAR,FL-ASLEEP \?L16
	CALL2 RT-NO-CONDITION-MSG,CH-AKBAR >STACK
	RSTACK
?L16:	EQUAL? GL-PRSA,V?YES \?L18
	PRINT K-GOOD-SHOW-MSG
	CRLF
	RTRUE
?L18:	EQUAL? GL-PRSA,V?NO \?L19
	PRINT K-PITY-MSG
	CRLF
	RTRUE
?L19:	EQUAL? GL-PRSA,V?MAYBE \?L20
	PRINT K-MAYBE-MSG
	CRLF
	RTRUE
?L20:	CALL RT-NOT-LIKELY-MSG,CH-AKBAR,STR?268 >STACK
	RSTACK
?L15:	ZERO? GL-NOW-PRSI? \?L58
	EQUAL? GL-PRSA,V?CALL \?L23
	FSET? CH-AKBAR,FL-ASLEEP \?L25
	CALL2 RT-NO-CONDITION-MSG,CH-AKBAR >STACK
	RSTACK
?L25:	PRINTI """I am here"
	FSET? TH-WATSONS-HAT,FL-WORN \?L28
	PRINTI ", sahib"
?L28:	PRINTR ". What is it you wish?"""
?L23:	EQUAL? GL-PRSA,V?TELL-ABOUT \FALSE
	GET GL-P-NAMW,1 >WRD
	GET GL-P-ADJW,1 >ADJ
	FSET? CH-AKBAR,FL-ASLEEP \?L32
	CALL2 RT-NO-CONDITION-MSG,CH-AKBAR >STACK
	RSTACK
?L32:	EQUAL? WRD,W?SWORDFISH,W?PASSWORD,W?HUSH \?L34
	PRINTR """Passwords are for others. I must have something tangible."""
?L34:	EQUAL? WRD,W?GIN \?L35
	PRINTR """No thank you. My religion forbids alcoholic beverages."""
?L35:	CALL RT-IDENTIFY-EVENT?,W?PASSWORD,GL-PRSI >STACK
	ZERO? STACK /?L36
	PRINTR """She sounds interesting. Can she make curried mongoose?"""
?L36:	EQUAL? GL-PRSI,TH-GARNET \?L37
	PRINTR """I must see it before I believe it."""
?L37:	EQUAL? GL-PRSI,TH-ASH \?L38
	PRINTR "Akbar hesitates, then says, ""I do not know what you are talking about."""
?L38:	PRINTI """"
	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-DONT-DOESNT-MSG,GL-PRSI
	PRINTR "interest me."""
?L58:	EQUAL? GL-PRSA,V?GIVE,V?SHOW \FALSE
	EQUAL? GL-PRSO,TH-GARNET \FALSE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,50,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-OUT-OF-TIME,STACK
	FSET? TH-WATSONS-HAT,FL-WORN /?L44
	SET 'HAT,0
	JUMP ?L45
?L44:	SET 'HAT,1
?L45:	CALL RT-META-IN?,TH-BOX-KEY,CH-PLAYER >STACK
	ZERO? STACK /?L46
	REMOVE TH-BOX-KEY
?L46:	ICALL RT-MOVE-ALL,CH-PLAYER,RM-LAIR
	ICALL RT-MOVE-ALL,TH-LAPEL,RM-LAIR
	ICALL RT-MOVE-ALL,TH-POCKET,RM-LAIR
	ICALL RT-MOVE-ALL,TH-WATSONS-COAT,RM-LAIR
	ICALL RT-MOVE-ALL,TH-EARS,RM-LAIR
	MOVE TH-LAPEL,TH-WATSONS-COAT
	MOVE TH-POCKET,TH-WATSONS-COAT
	MOVE TH-WATSONS-COAT,CH-PLAYER
	ZERO? HAT /?L49
	MOVE TH-WATSONS-HAT,CH-PLAYER
	JUMP ?L51
?L49:	FCLEAR TH-WATSONS-HAT,FL-WORN
?L51:	FCLEAR TH-CAB-WHISTLE,FL-WORN
	FCLEAR TH-STETHOSCOPE,FL-WORN
	MOVE CH-AKBAR,RM-LAIR
	REMOVE CH-WIGGINS
	PRINTI "Akbar takes "
	ICALL1 RT-THEO-PRINT
	PRINTI " and examines it closely. Then he "
	FSET? TH-WATSONS-HAT,FL-WORN \?L52
	PRINTI "says, ""I must ask you to come with me, sir. But first, I ask that you give me all that you carry."" He takes everything you give him, and then apologizes as he places a blindfold over your eyes. He"
	JUMP ?L54
?L52:	PRINTI "grabs you by the arm and drags you into a back room. He frisks you and takes away everything you are carrying. Then he blindfolds you and"
?L54:	PRINTI " leads you down a series of long winding corridors. You hear a door close behind you, and when he finally removes the blindfold, you are standing in Moriarty's lair. Akbar locks the door behind you, drops the key on Moriarty's desk, and piles most of what you were carrying onto the floor."
	CRLF
	ICALL2 RT-UPDATE-SCORE,5
	CRLF
	CALL2 RT-GOTO,RM-LAIR >STACK
	RSTACK

	.FUNCT RT-AC-CH-MORIARTY,CONTEXT,OBJ,WRD,ADJ,OFF
	ASSIGNED? 'CONTEXT /?L38
	SET 'CONTEXT,0
?L38:	ICALL2 RT-THIS-IS-IT,CH-MORIARTY
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The Professor has a high domed forehead that rises above heavily lidded, almost reptilian eyes."
?L1:	EQUAL? CONTEXT,K-M-WINNER \?L3
	FSET? GL-WINNER,FL-ASLEEP \?L3
	CALL2 RT-NO-CONDITION-MSG,GL-WINNER >STACK
	RSTACK
?L3:	CALL2 RT-TELL-ABOUT?,CH-MORIARTY >STACK
	ZERO? STACK /?L4
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L5
	SET 'OBJ,GL-PRSO
	JUMP ?L7
?L5:	SET 'OBJ,GL-PRSI
?L7:	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L8
	SET 'OFF,0
	JUMP ?L10
?L8:	SET 'OFF,1
?L10:	GET GL-P-NAMW,OFF >WRD
	GET GL-P-ADJW,OFF >ADJ
	FSET? CH-MORIARTY,FL-ASLEEP \?L11
	CALL2 RT-NO-CONDITION-MSG,CH-MORIARTY >STACK
	RSTACK
?L11:	FSET? CH-MORIARTY,FL-LOCKED \?L13
	PRINTR "The Professor's cold, reptilian eyes glare at you in silent hatred."
?L13:	EQUAL? OBJ,CH-MORIARTY \?L14
	PRINTR """I am a mathematical machine, Doctor. I think. I plan. And as you and the 'great' Sherlock Holmes have now learned, all who oppose me suffer inexorable destruction."""
?L14:	EQUAL? OBJ,CH-HOLMES,CH-BANK-GUARD /?L16
	CALL RT-IDENTIFY-EVENT?,W?KIDNAPPING,OBJ >STACK
	ZERO? STACK /?L15
?L16:	PRINTR """Holmes is a worthy adversary, Doctor. And his kidnapping was purely accidental. It was nothing more than a blunder on the part of an overeager subordinate. The guard at the bank knew nothing of my plan. He merely saw a chance to capture and deliver to me the famous Sherlock Holmes, and he took it."""
?L15:	EQUAL? OBJ,CH-AKBAR \?L17
	PRINTR """A trusted associate who was sensible enough to see the advantages of joining forces with me."""
?L17:	EQUAL? OBJ,TH-CROWN-JEWELS /?L39
	CALL RT-IDENTIFY-EVENT?,W?THEFT,OBJ >STACK
	ZERO? STACK /?L18
	EQUAL? OBJ,TH-CROWN-JEWELS \?L20
?L39:	PRINTI """Pretty, are they not? I purloined them"
	JUMP ?L22
?L20:	PRINTI "I purloined the Crown Jewels"
?L22:	PRINTR " at the request of a foreign government whose identity need not concern you. My clients care nothing about the Crown Jewels themselves - they wish only to undermine confidence in the British monarchy as a first step towards weakening and ultimately destroying the British Empire."""
?L18:	EQUAL? OBJ,TH-SAPPHIRE,TH-EMERALD,TH-RUBY /?L24
	EQUAL? OBJ,TH-OPAL,TH-GARNET,TH-TOPAZ /?L24
	CALL RT-IDENTIFY-EVENT?,W?AGRA,OBJ >STACK
	ZERO? STACK /?L23
?L24:	PRINTR """Merely bait to be used in the hunting of a greater prey."""
?L23:	EQUAL? OBJ,CH-QUEEN \?L25
	PRINTR """A foolish old woman. Her empire deserves to fail."""
?L25:	PRINTI """Your lives and the fate of your precious monarchy hang in the balance, Doctor. Have you nothing better to do than to query me about "
	ICALL2 RT-THEO-PRINT,OBJ
	PRINTR "?"""
?L4:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L27
	RETURN 2
?L27:	EQUAL? CONTEXT,K-M-WINNER \?L28
	FSET? CH-MORIARTY,FL-ASLEEP \?L29
	CALL2 RT-NO-CONDITION-MSG,CH-MORIARTY >STACK
	RSTACK
?L29:	EQUAL? GL-PRSA,V?YES \?L31
	PRINT K-GOOD-SHOW-MSG
	CRLF
	RTRUE
?L31:	EQUAL? GL-PRSA,V?NO \?L32
	PRINT K-PITY-MSG
	CRLF
	RTRUE
?L32:	EQUAL? GL-PRSA,V?MAYBE \?L33
	PRINT K-MAYBE-MSG
	CRLF
	RTRUE
?L33:	ICALL RT-NOT-LIKELY-MSG,CH-MORIARTY,STR?268
	RTRUE
?L28:	ZERO? GL-NOW-PRSI? /FALSE
	RFALSE

	.FUNCT RT-AC-CH-HUDSON,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L32
	SET 'CONTEXT,0
?L32:	ICALL2 RT-THIS-IS-IT,CH-HUDSON
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? CH-HOLMES,FL-ASLEEP \?L3
	PRINTR "Mrs Hudson appears agitated. She looks at you and says, ""Mr Holmes is upstairs, Doctor. Please see what you can do for him."""
?L3:	PRINTR "Mrs Hudson appears happy that things are back to normal."
?L1:	CALL2 RT-TELL-ABOUT?,CH-HUDSON >STACK
	ZERO? STACK /?L6
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L7
	SET 'OBJ,GL-PRSO
	JUMP ?L9
?L7:	SET 'OBJ,GL-PRSI
?L9:	FSET? CH-HOLMES,FL-ASLEEP \?L10
	EQUAL? OBJ,CH-HOLMES \?L12
	PRINTR """He doesn't eat. He doesn't drink. He doesn't read the newspaper. I'm very worried about him."""
?L12:	EQUAL? OBJ,CH-PRIME-MINISTER \?L14
	PRINTR """He seems very worried. I gave him some tea."""
?L14:	ICALL2 RT-CTHEO-PRINT,CH-HUDSON
	PRINTR " wrings her hands and looks at you anxiously. ""I'm too worried to think, Doctor. Won't you see what you can do for Mr Holmes?"""
?L10:	EQUAL? OBJ,CH-HOLMES \?L17
	PRINTR """He seems much better now, Doctor. Thank you so much."""
?L17:	PRINTR """Shouldn't you be asking Mr Holmes?"""
?L6:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L20
	RETURN 2
?L20:	EQUAL? CONTEXT,K-M-WINNER \FALSE
	EQUAL? GL-PRSA,V?HELLO \?L22
	PRINTR """Hello, Dr Watson."""
?L22:	EQUAL? GL-PRSA,V?GOODBYE \?L24
	PRINTR """Goodbye, Dr Watson."""
?L24:	EQUAL? GL-PRSA,V?YES \?L25
	PRINT K-GOOD-SHOW-MSG
	CRLF
	RTRUE
?L25:	EQUAL? GL-PRSA,V?NO \?L26
	PRINT K-PITY-MSG
	CRLF
	RTRUE
?L26:	EQUAL? GL-PRSA,V?MAYBE \?L27
	PRINT K-MAYBE-MSG
	CRLF
	RTRUE
?L27:	EQUAL? GL-PRSA,V?THANK \?L28
	PRINTR """You're quite welcome, Dr Watson."""
?L28:	FSET? CH-HOLMES,FL-ASLEEP \?L29
	PRINTR """I'm sorry Doctor, but I cannot do anything for you until you have attended to Mr Holmes."""
?L29:	PRINTR """I'm sorry. I must get back to my other duties."""

	.FUNCT RT-AC-CH-DENKEEPER,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L18
	SET 'CONTEXT,0
?L18:	ICALL2 RT-THIS-IS-IT,CH-DENKEEPER
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "He is a scrawny character with a weasel-like face and shifty eyes."
?L1:	CALL2 RT-TELL-ABOUT?,CH-DENKEEPER >STACK
	ZERO? STACK /?L3
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L4
	SET 'OBJ,GL-PRSO
	RFALSE
?L4:	SET 'OBJ,GL-PRSI
	RFALSE
?L3:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L7
	RETURN 2
?L7:	EQUAL? GL-PRSA,V?CALL \?L10
	EQUAL? GL-PRSO,CH-AKBAR /?L9
?L10:	EQUAL? GL-PRSA,V?ASK-FOR,V?ASK-ABOUT \?L8
	EQUAL? GL-PRSI,CH-AKBAR \?L8
?L9:	FSET? CH-AKBAR,FL-SEEN \?L13
	IN? CH-AKBAR,RM-BAR-OF-GOLD /?L11
?L13:	ICALL2 RT-CTHEO-PRINT,CH-DENKEEPER
	PRINTI " gives"
	ICALL1 RT-YOU-MSG
	PRINTR "a sideways look and says, ""He might be here, and then again he might not. What's the password?"""
?L11:	ICALL2 RT-CTHEO-PRINT,CH-DENKEEPER
	PRINTR " says, ""He's right there in front of you."""
?L8:	EQUAL? GL-PRSA,V?GIVE \?L15
	FCLEAR GL-PRSO,FL-WORN
	REMOVE GL-PRSO
	PRINTI "The denkeeper gives you a quick look of surprise, then he shrugs his shoulders and disappears briefly into a back room, returning moments later without "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L15:	EQUAL? CONTEXT,K-M-WINNER \FALSE
	EQUAL? GL-PRSA,V?SWORDFISH,V?PASSWORD /FALSE
	ICALL RT-NOT-LIKELY-MSG,CH-DENKEEPER,STR?268
	RTRUE

	.FUNCT RT-AC-CH-LIBRARIAN,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	ICALL2 RT-THIS-IS-IT,CH-LIBRARIAN
	CALL2 RT-TELL-ABOUT?,CH-LIBRARIAN >STACK
	ZERO? STACK /?L1
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L3
	SET 'OBJ,GL-PRSO
	JUMP ?L5
?L3:	SET 'OBJ,GL-PRSI
?L5:	PRINTR """Let me finish telling you about this first."""
?L1:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L6
	RETURN 2
?L6:	EQUAL? CONTEXT,K-M-WINNER \?L7
	EQUAL? GL-PRSA,V?HUSH /?L7
	PRINTR """I will in a moment, but first let me finish telling you about this."""
?L7:	ZERO? GL-NOW-PRSI? /FALSE
	RFALSE

	.FUNCT RT-AC-CH-NANNIES,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	ICALL2 RT-THIS-IS-IT,CH-NANNIES
	CALL2 RT-TELL-ABOUT?,CH-NANNIES >STACK
	ZERO? STACK /?L1
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L3
	SET 'OBJ,GL-PRSO
	JUMP ?L5
?L3:	SET 'OBJ,GL-PRSI
?L5:	PRINT K-TOO-HAUGHTY-MSG
	CRLF
	RTRUE
?L1:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L6
	RETURN 2
?L6:	EQUAL? CONTEXT,K-M-WINNER \?L7
	PRINT K-TOO-HAUGHTY-MSG
	CRLF
	RTRUE
?L7:	ZERO? GL-NOW-PRSI? /FALSE
	RFALSE

	.FUNCT RT-AC-CH-HOUSEWIVES,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L21
	SET 'CONTEXT,0
?L21:	ICALL2 RT-THIS-IS-IT,CH-HOUSEWIVES
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	IN? CH-ELIZA-DOOLITTLE,RM-COVENT-GARDEN \?L3
	PRINTR "The women have gathered in a circle around the girl. They keep looking at you as if they expect you to do something."
?L3:	PRINTR "The housewives mill among the stalls, haggling with merchants over prices and looking for bargains."
?L1:	CALL2 RT-TELL-ABOUT?,CH-HOUSEWIVES >STACK
	ZERO? STACK /?L6
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L7
	SET 'OBJ,GL-PRSO
	JUMP ?L9
?L7:	SET 'OBJ,GL-PRSI
?L9:	PRINTR "The women do not respond."
?L6:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L10
	RETURN 2
?L10:	EQUAL? CONTEXT,K-M-WINNER \?L11
	IN? CH-ELIZA-DOOLITTLE,RM-COVENT-GARDEN \?L12
	PRINTR "The women are too upset about the girl to respond."
?L12:	PRINTR "The housewives, intent on a bargain, ignore you."
?L11:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?LISTEN \FALSE
	ICALL1 RT-CTHEO-PRINT
	PRINTR " are making a lot of noise."

	.FUNCT RT-AC-CH-PALACE-GUARD,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	ICALL2 RT-THIS-IS-IT,CH-PALACE-GUARD
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTI "Looks like any other "
	ICALL2 DPRINT,CH-PALACE-GUARD
	PRINTR "."
?L1:	CALL2 RT-TELL-ABOUT?,CH-PALACE-GUARD >STACK
	ZERO? STACK \?L4
	EQUAL? CONTEXT,K-M-WINNER \?L3
?L4:	ICALL2 RT-CTHEO-PRINT,CH-PALACE-GUARD
	PRINTR " stares straight ahead."
?L3:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L5
	RETURN 2
?L5:	EQUAL? GL-PRSA,V?GIVE,V?SHOW \?L8
	EQUAL? GL-PRSO,TH-CROWN-JEWELS /?L7
?L8:	EQUAL? CONTEXT,K-M-WINNER \FALSE
	EQUAL? GL-PRSA,V?TAKE \FALSE
	EQUAL? GL-PRSO,TH-CROWN-JEWELS \FALSE
?L7:	ICALL2 RT-CTHEO-PRINT,CH-PALACE-GUARD
	PRINTI " examines the regalia closely and then disappears inside the palace. Moments later, he reappears with the Prime Minister, who quickly ushers you and Holmes into the presence of the Queen."
	CRLF
	CRLF
	PRINTI "Overcome by emotion, for a few moments she says nothing. Finally she smiles and says, ""Once again, Mr Holmes, we find ourselves in your debt. Until now you have always refused our offers of gratitude. Do you intend to refuse your Queen yet again?"""
	CRLF
	CRLF
	PRINTI "Holmes returns her smile. ""I do, Your Majesty. But only because your thanks would be misdirected. It is Doctor Watson here who deserves your gratitude."""
	CRLF
	CRLF
	PRINTI "The Queen turns her gaze towards you. ""Indeed? And what reward would you ask of us, Doctor?"""
	CRLF
	CRLF
	PRINTI "Flustered, you stammer something about the service itself being reward enough, and before you know it you have been royally thanked and ushered back out of the palace into Queens Gardens. There, you and Holmes join the cheering multitudes who greet the Queen when, promptly at 9:00 and wearing the full regalia, she steps onto the balcony to begin the Coronation Day festivities."
	CRLF
	ICALL2 PRINT-ID,STR?269
	IXCALL SOUNDS,S-FANFARE,S-START,8,1,END-FANFARE
	ICALL2 RT-UPDATE-SCORE,1
	CRLF
	PRINTI "[Your score is "
	PRINTN GL-SCORE-CUR
	PRINTI " out of "
	PRINTN GL-SCORE-MAX
	PRINTI ", which earns you a ranking of "
	CALL2 RT-RANK-STR,GL-SCORE-CUR >STACK
	PRINT STACK
	PRINTI ".]"
	CRLF
	CRLF
	ICALL1 RT-UPDATE-STATUS-LINE
	ICALL1 RT-QSR
	RFALSE

	.FUNCT RT-AC-CH-URCHINS,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	ICALL2 RT-THIS-IS-IT,CH-URCHINS
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L3
	PRINTI "Despite the hour, the"
	JUMP ?L5
?L3:	PRINTI "The"
?L5:	PRINTI " urchins are playing games in the street."
	CRLF
	FSET? CH-WIGGINS,FL-BROKEN \FALSE
	CRLF
	PRINT K-URCHIN-MSG
	CRLF
	RTRUE
?L1:	CALL2 RT-TELL-ABOUT?,CH-URCHINS >STACK
	ZERO? STACK \?L10
	EQUAL? CONTEXT,K-M-WINNER \?L9
?L10:	ICALL2 RT-CTHEO-PRINT,CH-URCHINS
	PRINTR " ignore you."
?L9:	ZERO? GL-NOW-PRSI? /FALSE
	RFALSE

	.FUNCT RT-AC-CH-MEMBERS,CONTEXT
	ASSIGNED? 'CONTEXT /?L12
	SET 'CONTEXT,0
?L12:	ICALL2 RT-THIS-IS-IT,CH-MEMBERS
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	ICALL2 RT-CTHEO-PRINT,CH-MEMBERS
	PRINTR " are all asleep."
?L1:	CALL2 RT-TELL-ABOUT?,CH-MEMBERS >STACK
	ZERO? STACK \?L4
	EQUAL? CONTEXT,K-M-WINNER \?L3
?L4:	ICALL2 RT-CTHEO-PRINT,CH-MEMBERS
	PRINTR " are all asleep."
?L3:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?ALARM \?L7
	ICALL1 RT-CYOU-MSG
	PRINTR "can't. No one can."
?L7:	EQUAL? GL-PRSA,V?LISTEN \FALSE
	ICALL2 RT-CTHEO-PRINT,CH-MEMBERS
	PRINTR " are all asleep."

	.FUNCT RT-GN-PAPER,TBL,LEN,PTR,OBJ,PAPER,CONT,C-PAPER,HELD,H-PAPER,GND,G-PAPER
	ASSIGNED? 'LEN /?L31
	SET 'LEN,0
?L31:	SET 'CONT,0
	SET 'C-PAPER,0
	SET 'HELD,0
	SET 'H-PAPER,0
	SET 'GND,0
	SET 'G-PAPER,0
	ZERO? LEN \?L1
	GET TBL,0 >LEN
?L1:	ADD TBL,2 >PTR
	INTBL? GL-P-IT-OBJECT,PTR,LEN >STACK \?L4
	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,GL-P-IT-OBJECT
	PRINTI "]"
	CRLF
	RETURN GL-P-IT-OBJECT
?L4:	MUL LEN,2 >STACK
	ADD TBL,STACK >STACK
	GRTR? PTR,STACK /?L8
	GET PTR,0 >OBJ
	LOC OBJ >STACK
	FSET? STACK,FL-SURFACE /?L8
	LOC OBJ >STACK
	EQUAL? STACK,CH-PLAYER \?L14
	ZERO? HELD \?L15
	SET 'HELD,1
	SET 'H-PAPER,OBJ
	JUMP ?L23
?L15:	SET 'H-PAPER,0
	JUMP ?L23
?L14:	LOC OBJ >STACK
	EQUAL? STACK,GL-PLACE-CUR \?L18
	ZERO? GND \?L19
	SET 'GND,1
	SET 'G-PAPER,OBJ
	JUMP ?L23
?L19:	SET 'G-PAPER,0
	JUMP ?L23
?L18:	ZERO? CONT \?L22
	LOC OBJ >STACK
	FSET? STACK,FL-CONTAINER \?L22
	LOC OBJ >CONT
	SET 'C-PAPER,OBJ
	JUMP ?L23
?L22:	LOC OBJ >STACK
	FSET? STACK,FL-CONTAINER \?L23
	ZERO? CONT /?L23
	LOC OBJ >STACK
	EQUAL? STACK,CONT /?L23
	SET 'C-PAPER,0
?L23:	ADD PTR,2 >PTR
	JUMP ?L4
?L8:	ZERO? OBJ /?L25
	LOC OBJ >STACK
	FSET? STACK,FL-SURFACE \?L25
	SET 'PAPER,OBJ
	JUMP ?L30
?L25:	ZERO? H-PAPER /?L27
	SET 'PAPER,H-PAPER
	JUMP ?L30
?L27:	ZERO? G-PAPER /?L28
	SET 'PAPER,G-PAPER
	JUMP ?L30
?L28:	ZERO? C-PAPER /FALSE
	SET 'PAPER,C-PAPER
?L30:	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,PAPER
	PRINTI "]"
	CRLF
	CRLF
	RETURN PAPER

	.FUNCT RT-GN-GEM,TBL,LEN,PTR,OBJ,GEM,CONT,C-GEM,HELD,H-GEM,GND,G-GEM
	ASSIGNED? 'LEN /?L30
	SET 'LEN,0
?L30:	SET 'CONT,0
	SET 'C-GEM,0
	SET 'HELD,0
	SET 'H-GEM,0
	SET 'GND,0
	SET 'G-GEM,0
	ZERO? LEN \?L1
	GET TBL,0 >LEN
?L1:	ADD TBL,2 >PTR
	INTBL? GL-P-IT-OBJECT,PTR,LEN >STACK \?L4
	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,GL-P-IT-OBJECT
	PRINTI "]"
	CRLF
	CRLF
	RETURN GL-P-IT-OBJECT
?L4:	EQUAL? GL-PLACE-CUR,RM-CLOCK-TOWER \?L6
	IN? TH-SAPPHIRE,TH-CLAPPER \?L6
	RETURN TH-SAPPHIRE
?L6:	MUL LEN,2 >STACK
	ADD TBL,STACK >STACK
	GRTR? PTR,STACK /?L9
	GET PTR,0 >OBJ
	LOC OBJ >STACK
	EQUAL? STACK,CH-PLAYER \?L13
	ZERO? HELD \?L15
	SET 'HELD,1
	SET 'H-GEM,OBJ
	JUMP ?L23
?L15:	SET 'H-GEM,0
	JUMP ?L23
?L13:	LOC OBJ >STACK
	EQUAL? STACK,GL-PLACE-CUR \?L18
	ZERO? GND \?L19
	SET 'GND,1
	SET 'G-GEM,OBJ
	JUMP ?L23
?L19:	SET 'G-GEM,0
	JUMP ?L23
?L18:	LOC OBJ >STACK
	ZERO? STACK /?L22
	ZERO? CONT \?L22
	LOC OBJ >STACK
	FSET? STACK,FL-CONTAINER \?L22
	LOC OBJ >CONT
	SET 'C-GEM,OBJ
	JUMP ?L23
?L22:	LOC OBJ >STACK
	ZERO? STACK /?L23
	LOC OBJ >STACK
	FSET? STACK,FL-CONTAINER \?L23
	ZERO? CONT /?L23
	LOC OBJ >STACK
	EQUAL? STACK,CONT /?L23
	SET 'C-GEM,0
?L23:	ADD PTR,2 >PTR
	JUMP ?L6
?L9:	ZERO? H-GEM /?L25
	SET 'GEM,H-GEM
	JUMP ?L29
?L25:	ZERO? G-GEM /?L27
	SET 'GEM,G-GEM
	JUMP ?L29
?L27:	ZERO? C-GEM /FALSE
	SET 'GEM,C-GEM
?L29:	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,GEM
	PRINTI "]"
	CRLF
	CRLF
	RETURN GEM

	.FUNCT RT-GN-PIGEON,TBL,LEN
	ASSIGNED? 'LEN /?L4
	SET 'LEN,0
?L4:	FSET? CH-TRAINED-PIGEON,FL-ALIVE /?L1
	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,TH-DEAD-PIGEON
	PRINTI "]"
	CRLF
	CRLF
	RETURN TH-DEAD-PIGEON
?L1:	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	PRINTI "]"
	CRLF
	CRLF
	RETURN CH-TRAINED-PIGEON

	.FUNCT RT-GN-OAR,TBL,LEN
	ASSIGNED? 'LEN /?L4
	SET 'LEN,0
?L4:	EQUAL? GL-P-IT-OBJECT,TH-OAR-1,TH-OAR-2 \?L1
	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,GL-P-IT-OBJECT
	PRINTI "]"
	CRLF
	CRLF
	RETURN GL-P-IT-OBJECT
?L1:	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,TH-OAR-2
	PRINTI "]"
	CRLF
	CRLF
	RETURN TH-OAR-2

	.FUNCT RT-GN-BOX,TBL,LEN,PTR
	ASSIGNED? 'LEN /?L7
	SET 'LEN,0
?L7:	ZERO? LEN \?L1
	GET TBL,0 >LEN
?L1:	ADD TBL,2 >PTR
	INTBL? GL-P-IT-OBJECT,PTR,LEN >STACK \FALSE
	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,GL-P-IT-OBJECT
	PRINTI "]"
	CRLF
	CRLF
	RETURN GL-P-IT-OBJECT

	.FUNCT RT-GN-DOOR,TBL,LEN,PTR,OBJ,DOOR
	ASSIGNED? 'LEN /?L28
	SET 'LEN,0
?L28:	SET 'OBJ,0
	SET 'DOOR,0
	ZERO? LEN \?L1
	GET TBL,0 >LEN
?L1:	ADD TBL,2 >PTR
?L4:	MUL LEN,2 >STACK
	ADD TBL,STACK >STACK
	GRTR? PTR,STACK /?L5
	GET PTR,0 >OBJ
	EQUAL? GL-PRSA,V?OPEN \?L9
	FSET? OBJ,FL-OPENED /?L22
	ZERO? DOOR \FALSE
	SET 'DOOR,OBJ
	JUMP ?L22
?L9:	EQUAL? GL-PRSA,V?CLOSE \?L22
	FSET? OBJ,FL-OPENED \?L22
	ZERO? DOOR \FALSE
	SET 'DOOR,OBJ
?L22:	ADD PTR,2 >PTR
	JUMP ?L4
?L5:	ZERO? DOOR /?L25
	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,DOOR
	PRINTI "]"
	CRLF
	CRLF
?L25:	RETURN DOOR

	.FUNCT RT-GN-BOTTLE,TBL,LEN,PTR,OBJ,BOTTLE
	ASSIGNED? 'LEN /?L21
	SET 'LEN,0
?L21:	SET 'BOTTLE,0
	ZERO? LEN \?L1
	GET TBL,0 >LEN
?L1:	ADD TBL,2 >PTR
?L4:	MUL LEN,2 >STACK
	ADD TBL,STACK >STACK
	GRTR? PTR,STACK /?L5
	GET PTR,0 >OBJ
	EQUAL? GL-PRSA,V?OPEN \?L12
	ZERO? GL-NOW-PRSI? \?L12
	FSET? OBJ,FL-OPENED \?L11
?L12:	EQUAL? GL-PRSA,V?CLOSE \?L13
	ZERO? GL-NOW-PRSI? \?L13
	FSET? OBJ,FL-OPENED /?L11
?L13:	EQUAL? GL-PRSA,V?PUT \?L16
	ZERO? GL-NOW-PRSI? /?L16
	FSET? OBJ,FL-OPENED \?L16
?L11:	ZERO? BOTTLE \FALSE
	SET 'BOTTLE,OBJ
?L16:	ADD PTR,2 >PTR
	JUMP ?L4
?L5:	ZERO? BOTTLE /?L18
	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,BOTTLE
	PRINTI "]"
	CRLF
	CRLF
?L18:	RETURN BOTTLE

	.FUNCT RT-GN-PILL,TBL,LEN,PTR,OBJ,PILL
	ASSIGNED? 'LEN /?L21
	SET 'LEN,0
?L21:	SET 'PILL,0
	ZERO? LEN \?L1
	GET TBL,0 >LEN
?L1:	ADD TBL,2 >PTR
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L7
?L6:	MUL LEN,2 >STACK
	ADD TBL,STACK >STACK
	GRTR? PTR,STACK /?L7
	GET PTR,0 >OBJ
	CALL2 RT-ACCESSIBLE?,OBJ >STACK
	ZERO? STACK /?L15
	ZERO? PILL \FALSE
	SET 'PILL,OBJ
?L15:	ADD PTR,2 >PTR
	JUMP ?L6
?L7:	ZERO? PILL /?L18
	PRINTI "["
	ICALL2 RT-CTHEO-PRINT,PILL
	PRINTI "]"
	CRLF
	CRLF
?L18:	RETURN PILL

	.FUNCT RT-GN-TH-CLOTHES,TBL,LEN
	ASSIGNED? 'LEN /?L1
	SET 'LEN,0
?L1:	RETURN TH-CLOTHES

	.FUNCT RT-GN-BODY,TBL,LEN,PTR,OBJ
	ASSIGNED? 'LEN /?L13
	SET 'LEN,0
?L13:	SET 'OBJ,0
	ZERO? LEN \?L1
	GET TBL,0 >LEN
?L1:	ADD TBL,2 >PTR
	INTBL? TH-CLOTHES,PTR,LEN >STACK \?L4
	RETURN TH-CLOTHES
?L4:	ZERO? LEN /FALSE
	GET PTR,0 >OBJ
	FSET? OBJ,FL-BODYPART \?L11
	RETURN OBJ
?L11:	ADD PTR,2 >PTR
	DEC 'LEN
	JUMP ?L4

	.FUNCT RT-GN-INTNUM,TBL,LEN
	ASSIGNED? 'LEN /?L4
	SET 'LEN,0
?L4:	EQUAL? GL-PRSA,V?WAIT,V?WAIT-FOR \?L1
	RETURN TH-INTNUM
?L1:	RETURN TH-SAFETY-DEPOSIT-BOX

	.FUNCT RT-GN-ETHERIUM,TBL,LEN
	ASSIGNED? 'LEN /?L5
	SET 'LEN,0
?L5:	EQUAL? GL-PRSA,V?SMELL,V?INHALE \?L1
	RETURN TH-ETHERIUM-GAS
?L1:	EQUAL? GL-PRSA,V?MUNG,V?OPEN,V?LOOK-INSIDE \FALSE
	RETURN TH-ETHERIUM-AMPOULE

	.FUNCT RT-GN-TOWER,TBL,LEN
	ASSIGNED? 'LEN /?L1
	SET 'LEN,0
?L1:	RETURN LG-TOWER

	.FUNCT RT-AC-RM-221B-BAKER-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L37
	SET 'CONTEXT,0
?L37:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-2 \?L12
	EQUAL? GL-PLACE-PRV,RM-ENTRY-HALL \?L13
	PRINTI "You emerge from the house into"
	JUMP ?L15
?L13:	PRINTI "You"
	ICALL1 RT-DRIVE-WALK-MSG?
	PRINTI "into"
?L15:	PRINTI " Baker Street."
	CRLF
	CRLF
?L12:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L17
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,0,1,3 \?L19
	PRINTI "in the spill of a gas streetlight "
?L19:	PRINTI "outside Holmes's house. The street "
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L22
	PRINTI "disappears into the fog"
	JUMP ?L24
?L22:	PRINTI "continues"
?L24:	PRINTI " to the north and south. The door to the house is to the west."
	CRLF
?L17:	EQUAL? CONTEXT,K-M-DESC-1 \?L26
	FSET LG-BAKER-ST-DOOR,FL-SEEN
	FSET CH-PLAYER,FL-SEEN
	CRLF
	PRINTR "You have come in response to an urgent summons from your old landlady, Mrs Hudson. As the fog swirls around you, you huddle into your coat and shiver in the predawn chill."
?L26:	EQUAL? CONTEXT,K-M-DESC-3,K-M-DESC-2 \?L28
	IN? CH-HOLMES,RM-221B-BAKER-ST \FALSE
	ZERO? GL-PUPPY \FALSE
	CRLF
	ICALL2 RT-CTHEO-PRINT,CH-HOLMES
	PRINTI " says, ""Ah, there you are Watson. While you were inside I gave our little problem some thought. Obviously the person who stole the Crown Jewels wanted the authorities to turn to me for help, and it is equally obvious that the thief has laid down a trail for me to follow, in hopes of somehow entrapping me."
	CRLF
	CRLF
	PRINTI """So let's play his game, Doctor. But let's play it by our rules. The thief will have tried to anticipate the sequence of my actions, and I'm sure he has laid his trap accordingly. But if "
	HLIGHT K-H-ITL
	PRINTI "you"
	HLIGHT K-H-NRM
	PRINTI " were to guide the course of our investigations, he will certainly be thrown off the scent."
	CRLF
	CRLF
	PRINTI """Therefore, let us take surprise onto our side and rely on your instincts as the man of action I know you to be - despite your frequent modest assertions to the contrary."" He steps to one side and says, ""Lead on, good Doctor. I will follow."" Holmes gestures for you to lead the way."
	CRLF
	SET 'GL-PUPPY,CH-HOLMES
	SET 'GL-PUPPY-MSG?,0
	RTRUE
?L28:	EQUAL? CONTEXT,K-M-DESC-2,K-M-DESC-3 /FALSE
	RFALSE

	.FUNCT RT-AC-RM-ENTRY-HALL,CONTEXT
	ASSIGNED? 'CONTEXT /?L23
	SET 'CONTEXT,0
?L23:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-221B-BAKER-ST \?L8
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L8:	EQUAL? GL-PLACE-CUR,RM-PARLOUR \?L10
	ICALL2 RT-DO-WALK,P?SOUTH
	RTRUE
?L10:	EQUAL? GL-PLACE-CUR,RM-VESTIBULE \?L11
	ICALL2 RT-DO-WALK,P?DOWN
	RTRUE
?L11:	PRINTI "You'll have to be more explicit."
	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-DESC-1 \?L14
	FSET CH-HUDSON,FL-SEEN
	FSET RM-ENTRY-HALL,FL-TOUCHED
	CRLF
	PRINTI "You step inside and Mrs Hudson closes the door behind you. The entry hall is just as you remember it - small, underheated, and lit by a feeble gas light. "
	PRINT K-WELL-WORN-MSG
	RTRUE
?L14:	EQUAL? CONTEXT,K-M-DESC-2 \?L15
	EQUAL? GL-PLACE-PRV,RM-221B-BAKER-ST \?L16
	PRINTI "You enter the house and pause in the entry hall. "
	PRINT K-WELL-WORN-MSG
	CRLF
	RFALSE
?L16:	EQUAL? GL-PLACE-PRV,RM-VESTIBULE \?L18
	PRINTI "You descend the stairs into the entry hall. The parlour door is to the north. "
	ICALL2 RT-OPEN-CLOSED-MSG,LG-BAKER-ST-DOOR
	CRLF
	RFALSE
?L18:	PRINTI "You walk out into the entry hall. "
	ICALL2 RT-OPEN-CLOSED-MSG,LG-BAKER-ST-DOOR
	CRLF
	RFALSE
?L15:	EQUAL? CONTEXT,K-M-DESC-3 \?L20
	PRINT K-WELL-WORN-MSG
	PRINTI " "
	ICALL2 RT-OPEN-CLOSED-MSG,LG-BAKER-ST-DOOR
	CRLF
	RFALSE
?L20:	GETP RM-ENTRY-HALL,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?HOUSE \FALSE
	CALL1 RT-AC-LG-HOLMES-HOUSE >STACK
	RSTACK

	.FUNCT RT-AC-RM-PARLOUR,CONTEXT
	ASSIGNED? 'CONTEXT /?L22
	SET 'CONTEXT,0
?L22:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L6
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \FALSE
	ICALL2 RT-DO-WALK,P?NORTH
	RTRUE
?L6:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-PARLOUR \FALSE
	ICALL2 RT-DO-WALK,P?SOUTH
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1 \?L16
	FSET TH-MATCHBOOK,FL-SEEN
?L16:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L18
	PRINTI "You walk into"
	JUMP ?L20
?L18:	EQUAL? CONTEXT,K-M-DESC-3 \?L20
	PRINTI "You are in"
?L20:	PRINTI " a dreary, late Victorian Era parlour."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-VESTIBULE,CONTEXT
	ASSIGNED? 'CONTEXT /?L24
	SET 'CONTEXT,0
?L24:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \?L8
	ICALL2 RT-DO-WALK,P?SOUTH
	RTRUE
?L8:	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \FALSE
	ICALL2 RT-DO-WALK,P?UP
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L19
	EQUAL? GL-PLACE-PRV,RM-ENTRY-HALL \?L14
	PRINTI "You climb the stairs"
	JUMP ?L16
?L14:	PRINTI "You leave the study"
?L16:	PRINTI " and pause outside the door"
	EQUAL? CONTEXT,K-M-DESC-1 \?L17
	FSET LG-HOLMES-STUDY-DOOR,FL-SEEN
	PRINTI " to Holmes's study, nervous about what you might find inside. "
	JUMP ?L19
?L17:	PRINTI ". "
?L19:	EQUAL? CONTEXT,K-M-DESC-2,K-M-DESC-3 \?L21
	PRINTI "You are on a landing at the top of the stairs."
?L21:	CRLF
	CRLF
	PRINTI "Holmes's study is to the north."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-HOLMES-STUDY,CONTEXT
	ASSIGNED? 'CONTEXT /?L38
	SET 'CONTEXT,0
?L38:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-VESTIBULE \?L8
	ICALL2 RT-DO-WALK,P?NORTH
	RTRUE
?L8:	EQUAL? GL-PLACE-CUR,RM-HOLMES-BEDROOM \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1 \?L13
	PRINTI "You step back through time to your bachelor days, when you shared these cluttered digs with the world's only consulting detective. Despite the mess, you can see that the room is unchanged. The fireplace to the north has a pile of letters transfixed to its mantelpiece by a jackknife. Next to them lies Holmes's six-shot revolver, the tobacco slipper, and Holmes's favorite pipe. The violin has been carelessly tossed onto a stack of obviously unread newspapers."
	CRLF
	CRLF
	ICALL2 RT-AC-CH-HOLMES,K-M-DESCFCN
	CRLF
	FSET TH-MANTELPIECE,FL-SEEN
	FSET TH-VIOLIN,FL-SEEN
	FSET TH-NEWSPAPER,FL-SEEN
	FSET TH-SYRINGE,FL-SEEN
	FSET TH-PHIAL,FL-SEEN
	FSET TH-MAIL,FL-SEEN
	FSET TH-GUN,FL-SEEN
	FSET TH-KNIFE,FL-SEEN
	FSET TH-PERSIAN-SLIPPER,FL-SEEN
	FSET TH-PIPE,FL-SEEN
	FSET TH-LIQUID,FL-SEEN
	FSET TH-MOROCCO-CASE,FL-SEEN
	FSET TH-SOFA,FL-SEEN
	FSET CH-HOLMES,FL-SEEN
	FSET LG-HOLMES-BEDROOM-DOOR,FL-SEEN
?L13:	EQUAL? CONTEXT,K-M-DESC-2 \?L15
	PRINTI "You return to Holmes's study, which"
	JUMP ?L17
?L15:	EQUAL? CONTEXT,K-M-DESC-3 \?L17
	PRINTI "The study"
?L17:	EQUAL? CONTEXT,K-M-DESC-2,K-M-DESC-3 \?L29
	PRINTI " is in its usual disarray."
	CRLF
	FSET? CH-HOLMES,FL-ASLEEP \?L21
	CRLF
	ICALL2 RT-AC-CH-HOLMES,K-M-DESCFCN
?L21:	IN? CH-PRIME-MINISTER,RM-HOLMES-STUDY \?L24
	CRLF
	FSET? CH-PRIME-MINISTER,FL-SEEN /?L26
	FSET CH-PRIME-MINISTER,FL-SEEN
	ICALL2 RT-THIS-IS-IT,CH-PRIME-MINISTER
	PRINTI "You see a distinguished-looking visitor sitting in the armchair. "
	JUMP ?L29
?L26:	PRINTI "The visitor fidgets nervously in his chair. "
	JUMP ?L29
?L24:	CRLF
?L29:	ICALL2 RT-CTHEO-PRINT,LG-HOLMES-BEDROOM-DOOR
	PRINTI " to the west is "
	FSET? LG-HOLMES-BEDROOM-DOOR,FL-OPENED \?L31
	PRINTI "open"
	JUMP ?L33
?L31:	PRINTI "closed"
?L33:	PRINTI ". The only other exit is the door to the south."
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 /TRUE
	EQUAL? CONTEXT,K-M-DESC-2,K-M-DESC-3 /FALSE
	RFALSE

	.FUNCT RT-AC-RM-HOLMES-BEDROOM,CONTEXT
	ASSIGNED? 'CONTEXT /?L20
	SET 'CONTEXT,0
?L20:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L1:	PRINTI "This is a sparsely furnished room, whose walls are adorned only by scores of pictures of famous criminals. On a disorderly workbench in the corner, a jumble of laboratory equipment suggests that Holmes is in the middle of one of his chemical experiments. "
	IN? TH-ETHERIUM-AMPOULE,TH-WORKBENCH \?L13
	PRINTI "Set off to one side is a single ampoule with a neatly lettered label affixed to it. "
?L13:	PRINTI "The room's only exit is to the east."
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 \?L16
	FSET TH-BED,FL-SEEN
	FSET TH-BEDSIDE-TABLE,FL-SEEN
	FSET TH-ETHERIUM-AMPOULE,FL-SEEN
	FSET TH-LAB-EQUIPMENT,FL-SEEN
	FSET TH-WORKBENCH,FL-SEEN
	FSET TH-LAMP,FL-SEEN
	FSET TH-MAGNIFYING-GLASS,FL-SEEN
	CRLF
	PRINTR "Next to the bed there is a table, on which you see a lamp and Holmes's favorite magnifying glass. "
?L16:	EQUAL? CONTEXT,K-M-DESC-2,K-M-DESC-3 /FALSE
	RFALSE

	.FUNCT RT-AC-RM-YORK-PLACE,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L3
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L4
	PRINTI "Through the mist you see"
	JUMP ?L6
?L4:	PRINTI "This is"
?L6:	PRINTI " a quiet, residential street, lined with undistinguished, four storey Georgian houses. To the south, York Place opens up into Baker Street, and Marylebone Road comes in from the east."
	CRLF
?L3:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \FALSE
	CRLF
	PRINTI "The street isn't as quiet as usual, due to the surging crowds of tourists."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-MARYLEBONE-RD,CONTEXT,WHO
	ASSIGNED? 'CONTEXT /?L43
	SET 'CONTEXT,0
?L43:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-MADAME-TUSSAUDS \FALSE
	ICALL2 RT-DO-WALK,P?SOUTH
	RTRUE
?L1:	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L13
	EQUAL? GL-PLACE-PRV,RM-MADAME-TUSSAUDS \?L15
	PRINTI "You go out the door and are now"
	JUMP ?L18
?L15:	PRINTI "You find yourself"
	JUMP ?L18
?L13:	PRINTI "You are"
?L18:	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "in front of Madame Tussaud's famous wax museum. From here the street continues east and west."
	CRLF
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L19
	PRINTI "The museum is closed for renovations, and there is a guard and a dog patrolling the street outside the entrance, which is just to the north of you. The guard "
	RANDOM 100 >STACK
	LESS? 33,STACK /?L21
	PRINTI "lights"
	JUMP ?L24
?L21:	RANDOM 100 >STACK
	LESS? 50,STACK /?L23
	PRINTI "puffs on"
	JUMP ?L24
?L23:	PRINTI "puts out"
?L24:	PRINTI " a cigarette, tips his hat, and says, """
	EQUAL? GL-PLACE-PRV,RM-MADAME-TUSSAUDS \?L25
	PRINTI "Goodbye"
	JUMP ?L30
?L25:	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L27
	PRINTI "Hello"
	JUMP ?L30
?L27:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1 \?L28
	PRINTI "Top of the morning to you"
	JUMP ?L30
?L28:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,2 \?L29
	PRINTI "Good day"
	JUMP ?L30
?L29:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L30
	PRINTI "Good evening"
?L30:	EQUAL? WHO,CH-HOLMES \?L32
	PRINTI ", Mr Holmes"
	JUMP ?L34
?L32:	PRINTI ", Doctor Watson"
?L34:	PRINTI "."""
	CRLF
	JUMP ?L35
?L19:	EQUAL? CONTEXT,K-M-DESC-3 \?L35
	PRINTI "The guard and the dog are still here, and they show no signs of leaving."
	CRLF
?L35:	IN? CH-PLAYER,TH-HANSOM-CAB /?L37
	IN? CH-PLAYER,TH-GROWLER-CAB /?L37
	ICALL2 SOUNDS,S-GROWL
	CRLF
	PRINTI "The dog growls at you."
	CRLF
?L37:	EQUAL? CONTEXT,K-M-DESC-1 \FALSE
	FSET CH-TUSSAUDS-GUARD,FL-SEEN
	FSET CH-MATCH-SNIFFING-DOG,FL-SEEN
	FSET TH-CIGARETTE,FL-SEEN
	RTRUE

	.FUNCT RT-AC-RM-CHAMBER-OF-HORRORS,CONTEXT
	ASSIGNED? 'CONTEXT /?L21
	SET 'CONTEXT,0
?L21:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L6
	EQUAL? GL-PLACE-CUR,RM-MADAME-TUSSAUDS \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L6:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-CHAMBER-OF-HORRORS \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1 \?L16
	FSET TH-CHARLES-STATUE,FL-SEEN
	FSET TH-THOMAS-STATUE,FL-SEEN
	FSET TH-FAWKES-STATUE,FL-SEEN
?L16:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L18
	PRINTI "You enter"
	JUMP ?L20
?L18:	PRINTI "You are in"
?L20:	PRINTI " the Chamber of Horrors. Scattered around the room are wax groupings of some of the most gruesome scenes from English history. The only exit is to the east."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-TOTTENHAM-COURT-RD,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET LG-SHOPS,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L5
	PRINTI "This part of London is known for its furniture dealers, but all the shops seem to be closed for the Jubilee."
	CRLF
	CRLF
	PRINTI "Marylebone Road goes off to the west here, and Tottenham Court Road continues to the south."
	CRLF
?L5:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L8
	CRLF
	PRINTI "Throngs of shoppers peer in the windows of the closed shops."
	CRLF
	RFALSE
?L8:	CRLF
	ICALL1 RT-FOG-MSG
	RFALSE

	.FUNCT RT-AC-RM-ST-GILES-CIRCUS,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \FALSE
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "in St Giles Circus. Roads lead off in many directions."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-OXFORD-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L16
	SET 'CONTEXT,0
?L16:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "Oxford Street is London's busiest shopping thoroughfare"
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L4
	PRINTI ", although at this hour the street is deserted"
?L4:	PRINTI ". Fashionable emporiums line the street on either side, offering goods from all over the British Empire. Unfortunately, they all seem to be closed for the Jubilee."
	CRLF
	CRLF
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L7
	PRINTI "Hoards of frustrated tourists mill about, peering in the windows of the closed shops."
	CRLF
	CRLF
?L7:	PRINTI "The street continues to the east and west."
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 \FALSE
	FSET LG-SHOPS,FL-SEEN
	CALL2 RT-META-LOC,TH-GROWLER-CAB >STACK
	EQUAL? STACK,RM-OXFORD-ST \TRUE
	IN? CH-PLAYER,TH-GROWLER-CAB /TRUE
	FSET TH-GROWLER-CAB,FL-SEEN
	CRLF
	PRINTR "At a cabstand along the curb you see a growler cab."

	.FUNCT RT-AC-RM-ORCHARD-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L15
	SET 'CONTEXT,0
?L15:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L3
	PRINTI "Orchard Street is the southern extension of Baker Street. From here you can see Oxford Street off to the east, Baker Street to the north, and Audley Street "
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L4
	PRINTI "fading into the mists"
	JUMP ?L6
?L4:	PRINTI "continuing"
?L6:	PRINTI " to the south."
	CRLF
	CRLF
?L3:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2 \?L8
	PRINTI "Crowds of tourists stream eastward, "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1 \?L10
	PRINTI "looking forward to spending the day in the shops along Oxford Street."
	CRLF
	RFALSE
?L10:	PRINTI "intent on finding some bargains in the shops on Oxford Street."
	CRLF
	RFALSE
?L8:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L13
	PRINTI "Frustrated tourists stream westward, angered by the closed shops in Oxford Street."
	CRLF
	RFALSE
?L13:	ICALL1 RT-FOG-MSG
	RFALSE

	.FUNCT RT-AC-RM-AUDLEY-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "This is a pleasant street that winds through Mayfair, a fashionable district which takes its name from an ancient fair held there in May of each year."
	CRLF
	CRLF
	PRINTI "To the south is Hyde Park Corner, and to the north is Orchard Street."
	CRLF
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \FALSE
	CRLF
	ICALL1 RT-FOG-MSG
	RFALSE

	.FUNCT RT-AC-RM-HYDE-PARK-CORNER,CONTEXT
	ASSIGNED? 'CONTEXT /?L17
	SET 'CONTEXT,0
?L17:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-KENSINGTON-GARDENS \FALSE
	ICALL2 RT-DO-WALK,P?SE
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L11
	PRINTI "Hyde Park Corner is dominated by the Wellington Arch, a soaring monument to the ""Iron Duke,"" who defeated Napoleon at the Battle of Waterloo."
	CRLF
	CRLF
?L11:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L14
	PRINTI "Huge crowds of tourists gape up at the Arch."
	CRLF
	CRLF
	JUMP ?L16
?L14:	PRINTI "The arch is enshrouded in fog."
	CRLF
	CRLF
?L16:	PRINTI "Roads lead off in many directions."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-KENSINGTON-GARDENS,CONTEXT
	ASSIGNED? 'CONTEXT /?L17
	SET 'CONTEXT,0
?L17:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-HYDE-PARK-CORNER \FALSE
	ICALL2 RT-DO-WALK,P?NW
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1 \?L12
	FSET CH-NANNIES,FL-SEEN
	FSET TH-PRAMS,FL-SEEN
	FSET TH-PARK-FLOWERS,FL-SEEN
?L12:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L14
	PRINTI "A tide of perambulators pushed by well-starched nannies surges along the crowded walk. Everywhere you look there are rows and rows of beautiful flowers."
	CRLF
	RFALSE
?L14:	PRINTI "The flower gardens are deserted."
	CRLF
	CRLF
	ICALL1 RT-FOG-MSG
	RFALSE

	.FUNCT RT-AC-RM-TRAFALGAR-SQUARE,CONTEXT
	ASSIGNED? 'CONTEXT /?L21
	SET 'CONTEXT,0
?L21:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-DIOGENES-CLUB \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1 \?L10
	FSET TH-PIGEONS,FL-SEEN
	FSET TH-NELSON-COLUMN,FL-SEEN
	FSET TH-NELSON-EYE,FL-SEEN
	FSET TH-NELSON-STATUE,FL-SEEN
?L10:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L12
	PRINTI "Pigeons, pigeons, everywhere. You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "in one of the great open spaces of London, named for Nelson's naval victory over Napoleon in 1805. Streets come in and go out at all angles, and everywhere you look there are "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L14
	PRINTI "people feeding "
?L14:	PRINTI "pigeons."
	CRLF
	CRLF
	PRINTI "The square is dominated by Nelson's Column, a 167 foot tall Corinthian column with"
	PRINT K-NELSON-STATUE-MSG
	CRLF
	CRLF
	PRINTI "The entrance to the Diogenes Club is to the west."
	CRLF
?L12:	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \FALSE
	CRLF
	ICALL1 RT-FOG-MSG
	RFALSE

	.FUNCT RT-AC-RM-DIOGENES-CLUB,CONTEXT
	ASSIGNED? 'CONTEXT /?L25
	SET 'CONTEXT,0
?L25:	EQUAL? CONTEXT,K-M-ENTERED \?L1
	ICALL SOUNDS,S-SNORE,S-START
	JUMP ?L3
?L1:	EQUAL? CONTEXT,K-M-EXIT \?L3
	ICALL SOUNDS,S-SNORE,S-STOP
?L3:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L5
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-TRAFALGAR-SQUARE \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L5:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L14
	PRINTI "You enter the hushed atmosphere of the Diogenes Club. The furnishings are aging and opulent. The members are aging and asleep. The only exit is to the east."
	CRLF
	CRLF
	FSET? CH-BUTLER,FL-ASLEEP /?L15
	PRINTI "An ancient butler totters forward to greet you and says in a barely audible whisper, ""May I be of some assistance?"""
	CRLF
	JUMP ?L18
?L15:	PRINT K-EVERYONE-OUT-MSG
	CRLF
	JUMP ?L18
?L14:	PRINTI "You are in the Diogenes Club. "
	FSET? CH-BUTLER,FL-ASLEEP /?L19
	PRINTI "The butler is here, waiting to serve you."
	JUMP ?L21
?L19:	PRINT K-EVERYONE-OUT-MSG
?L21:	CRLF
?L18:	EQUAL? CONTEXT,K-M-DESC-1 \FALSE
	FSET CH-BUTLER,FL-SEEN
	FSET CH-MEMBERS,FL-SEEN
	RTRUE

	.FUNCT RT-AC-RM-GREAT-RUSSELL-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L1
	PRINTI "Great Russell Street is the home of the British Museum, the entrance of which is to the north. There is a sign next to the door."
	CRLF
	CRLF
	PRINTI "To the southwest you can see St Giles Circus."
	CRLF
	RFALSE
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-BRITISH-MUSEUM \FALSE
	ICALL2 RT-DO-WALK,P?SOUTH
	RTRUE

	.FUNCT RT-AC-RM-BRITISH-MUSEUM,CONTEXT
	ASSIGNED? 'CONTEXT /?L16
	SET 'CONTEXT,0
?L16:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-GREAT-RUSSELL-ST \?L6
	ICALL2 RT-DO-WALK,P?NORTH
	RTRUE
?L6:	EQUAL? GL-PLACE-CUR,RM-MANUSCRIPT-ROOM \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L11
	EQUAL? GL-PLACE-PRV,RM-GREAT-RUSSELL-ST \?L12
	PRINTI "You walk up the grand staircase and into"
	JUMP ?L15
?L12:	PRINTI "You walk back down the long corridor and return to"
	JUMP ?L15
?L11:	PRINTI "You are standing in"
?L15:	PRINTI " the entrance hall of the museum. All the corridors leading to the exhibit halls are packed with tourists, and there is a steady stream of people going in and out of the street entrance to the south. Only the corridor to the east seems to be of no interest to the sightseers."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-GROSVENOR-PLACE,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "This is a pleasant but out-of-the-way street that runs northwest to southeast. Few tourists ever visit here. "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,3 \?L4
	PRINTI "Despite the "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1 \?L6
	PRINTI "early"
	JUMP ?L8
?L6:	PRINTI "late"
?L8:	PRINTI " hour, some"
	JUMP ?L9
?L4:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,2 \?L9
	PRINTI "Some"
?L9:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L11
	PRINTI " people are standing on the corner."
	CRLF
	RFALSE
?L11:	ICALL1 RT-FOG-MSG
	RFALSE

	.FUNCT RT-AC-RM-VICTORIA-SQUARE,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	PRINTI "You come upon"
	JUMP ?L4
?L3:	PRINTI "You are in"
?L4:	PRINTI " Victoria Square. Streets go off in many directions."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-BROAD-SANCTUARY,CONTEXT
	ASSIGNED? 'CONTEXT /?L15
	SET 'CONTEXT,0
?L15:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L1
	FSET LG-WESTMINSTER-DOOR,FL-SEEN
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L3
	PRINTI "in the midst of a crowd of tourists "
?L3:	PRINTI "in front of the west door of Westminster Abbey. The towers of the Abbey"
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L6
	PRINTI " loom in the fog"
	JUMP ?L8
?L6:	PRINTI " soar high"
?L8:	PRINTI " above you, and you marvel at this perfect example of Gothic architecture, as generations have done before you."
	CRLF
	CRLF
	ICALL2 RT-OPEN-CLOSED-MSG,LG-WESTMINSTER-DOOR
	CRLF
	CRLF
	PRINTI "On the wall next to the door is a small, discreet sign."
	CRLF
	RFALSE
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-NAVE \FALSE
	CALL2 RT-DO-WALK,P?WEST >STACK
	RSTACK

	.FUNCT RT-AC-RM-PARLIAMENT-SQUARE,CONTEXT
	ASSIGNED? 'CONTEXT /?L15
	SET 'CONTEXT,0
?L15:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L1
	PRINTI "This is an attractive square at the foot of Whitehall. "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L3
	PRINTI "Large crowds mill around"
	JUMP ?L5
?L3:	PRINTI "Through the mist you see"
?L5:	PRINTI " the entrance to the Houses of Parliament to the southeast. To the west is Birdcage Walk. Broad Sanctuary goes off to the southwest, and Whitehall "
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L6
	PRINTI "disappears into the gloom"
	JUMP ?L8
?L6:	PRINTI "is"
?L8:	PRINTI " to the north."
	CRLF
	RFALSE
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-PARLIAMENT \FALSE
	ICALL2 RT-DO-WALK,P?NW
	RFALSE

	.FUNCT RT-AC-RM-PARLIAMENT,CONTEXT
	ASSIGNED? 'CONTEXT /?L30
	SET 'CONTEXT,0
?L30:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-PARLIAMENT-SQUARE \FALSE
	ICALL2 RT-DO-WALK,P?SE
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L10
	EQUAL? GL-PLACE-PRV,RM-PARLIAMENT-SQUARE \?L11
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L13
	PRINTI "You enter"
	JUMP ?L17
?L13:	PRINTI "You push your way into"
	JUMP ?L17
?L11:	PRINTI "You descend the stairs into"
	JUMP ?L17
?L10:	PRINTI "You are standing in"
?L17:	PRINTI " the "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L18
	PRINTI "jam-packed "
?L18:	PRINTI "entrance hall of the House of Commons."
	CRLF
	CRLF
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L21
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,3 \?L23
	PRINTI "Despite the "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1 \?L25
	PRINTI "early"
	JUMP ?L27
?L25:	PRINTI "late"
?L27:	PRINTI " hour, there"
	JUMP ?L28
?L23:	PRINTI "There"
?L28:	PRINTI " are hundreds of people lined up to get in. But"
	JUMP ?L29
?L21:	PRINTI "The Chamber is closed, but"
?L29:	PRINTI " off to one side you see a flight of old stone steps leading up into the darkness."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-BUCKINGHAM-PALACE-RD,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "Buckingham Palace Road connects Queens Gardens to the northeast with Victoria Square to the southwest."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-QUEENS-GARDENS,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET CH-PALACE-GUARD,FL-SEEN
?L3:	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "outside the gate to Buckingham Palace."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-BIRDCAGE-WALK,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	PRINTI "As you enter Birdcage Walk, your attention is diverted to"
	JUMP ?L4
?L3:	PRINTI "You see"
?L4:	PRINTI " a man who has set up a small souvenir stand near where the parade will pass on Tuesday. "
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L5
	PRINTI "Oblivious to the fact that there are no crowds here to buy his wares"
	JUMP ?L7
?L5:	PRINTI "Hoping to attract the attention of the crowd"
?L7:	PRINTI ", he is waving a handful of overpriced trinkets over his head."
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 \FALSE
	FSET CH-VENDOR,FL-SEEN
	FSET TH-TELESCOPE,FL-SEEN
	FSET TH-TRINKETS,FL-SEEN
	CRLF
	PRINTI "As soon as he sees you, the salesman "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L10
	PRINTI "ignores everyone else and "
?L10:	PRINTR "says, ""'Ere, Guv. Come early for the parade, 'ave you? There'll be thousands of people, you know. Now at the last Jubilee - about a year and a 'alf ago, as I remembers it - I could 'ardly see a fing. But if you was to buy one of my telescopes, you wouldn't 'ardly 'ave any problem, now would you? 'Ow 'bout it, Guv?"""

	.FUNCT RT-AC-RM-THE-MALL,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "The Mall runs southwest to northeast between the Queens Gardens and Trafalgar Square."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-WHITEHALL,CONTEXT
	ASSIGNED? 'CONTEXT /?L9
	SET 'CONTEXT,0
?L9:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L1
	PRINTI "Impressive government buildings line the street on either side. The street continues north and south, and the entrance to Scotland Yard is to the east."
	CRLF
	RFALSE
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-SCOTLAND-YARD \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE

	.FUNCT RT-AC-RM-SCOTLAND-YARD,CONTEXT
	ASSIGNED? 'CONTEXT /?L22
	SET 'CONTEXT,0
?L22:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L5
	EQUAL? GL-PLACE-CUR,RM-THE-BLACK-MUSEUM \?L6
	ICALL1 RT-ALREADY-IN-ROOM-MSG
	RTRUE
?L6:	EQUAL? GL-PLACE-CUR,RM-WHITEHALL \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L5:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-SCOTLAND-YARD \?L11
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L11:	EQUAL? GL-PLACE-CUR,RM-THE-BLACK-MUSEUM \FALSE
	ICALL2 RT-DO-WALK,P?UP
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L16
	EQUAL? GL-PLACE-PRV,RM-WHITEHALL \?L17
	PRINTI "You walk up the steps and into the building. Inside, it"
	JUMP ?L21
?L17:	EQUAL? GL-PLACE-PRV,RM-THE-BLACK-MUSEUM \?L21
	PRINTI "You return to the ground floor. It"
	JUMP ?L21
?L16:	PRINTI "It"
?L21:	PRINTI " looks just like any other government building - drab and worn. The door to the street is to the west, and you see some steps leading down."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-THE-BLACK-MUSEUM,CONTEXT
	ASSIGNED? 'CONTEXT /?L18
	SET 'CONTEXT,0
?L18:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L5
	EQUAL? GL-PLACE-CUR,RM-SCOTLAND-YARD \FALSE
	ICALL2 RT-DO-WALK,P?DOWN
	RTRUE
?L5:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-THE-BLACK-MUSEUM \FALSE
	ICALL2 RT-DO-WALK,P?UP
	RTRUE
?L1:	FSET TH-BLIGH-BOAT,FL-SEEN
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \FALSE
	PRINTI "This is the Black Museum, where the Yard keeps relics and mementos of famous crimes."
	CRLF
	CRLF
	PRINTI "Along one wall is a full-size rowboat with a small sign attached to it."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-NEW-OXFORD-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L15
	SET 'CONTEXT,0
?L15:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	EQUAL? GL-PLACE-PRV,RM-CHEAPSIDE,RM-ST-GILES-CIRCUS \?L4
	PRINTI "The quality of the neighborhood seems to be "
	EQUAL? GL-PLACE-PRV,RM-ST-GILES-CIRCUS \?L6
	PRINTI "deteriorating"
	JUMP ?L8
?L6:	PRINTI "improving"
?L8:	PRINTI " as you"
	ICALL1 RT-DRIVE-WALK-MSG?
	EQUAL? GL-PLACE-PRV,RM-ST-GILES-CIRCUS \?L9
	PRINTI "eastward"
	JUMP ?L11
?L9:	PRINTI "westward"
?L11:	PRINTI " along"
	JUMP ?L14
?L4:	EQUAL? GL-PLACE-PRV,RM-COVENT-GARDEN \?L12
	PRINTI "You leave Covent Garden and enter"
	JUMP ?L14
?L12:	PRINTI "The cab stops in"
	JUMP ?L14
?L3:	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "in"
?L14:	PRINTI " New Oxford Street."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-COVENT-GARDEN,CONTEXT
	ASSIGNED? 'CONTEXT /?L21
	SET 'CONTEXT,0
?L21:	EQUAL? CONTEXT,K-M-ENTERED \?L1
	ICALL SOUNDS,S-CROWD,S-START
	JUMP ?L3
?L1:	EQUAL? CONTEXT,K-M-EXIT \?L3
	ICALL SOUNDS,S-CROWD,S-STOP
?L3:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L7
	PRINTI "You enter"
	JUMP ?L8
?L7:	PRINTI "You are in"
?L8:	PRINTI " Covent Garden, which is the central market for all of London. Everywhere you look there are stalls packed with produce from the English countryside."
	CRLF
	CRLF
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L9
	PRINTI "Despite the hour, the"
	JUMP ?L11
?L9:	PRINTI "The"
?L11:	PRINTI " open-air market is crowded with housewives who are shopping for fruits and vegetables."
	CRLF
	IN? CH-ELIZA-DOOLITTLE,RM-COVENT-GARDEN \?L12
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L14
	PRINTI "After looking around for a few moments, you"
	JUMP ?L16
?L14:	PRINTI "You"
?L16:	PRINTI " see a crowd of women gathered around a girl who has collapsed on the ground. Her lifeless hand clutches a bunch of flowers."
	CRLF
?L12:	EQUAL? CONTEXT,K-M-DESC-1 \FALSE
	FSET CH-ELIZA-DOOLITTLE,FL-SEEN
	FSET CH-HOUSEWIVES,FL-SEEN
	FSET TH-ELIZAS-FLOWERS,FL-SEEN
	FSET TH-ELIZAS-MOUTH,FL-SEEN
	RTRUE

	.FUNCT RT-AC-RM-THE-STRAND,CONTEXT
	ASSIGNED? 'CONTEXT /?L17
	SET 'CONTEXT,0
?L17:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L4
	PRINTI "You enter"
	JUMP ?L6
?L4:	PRINTI "You are lingering in"
?L6:	PRINTI " the Strand, which is the heart of London's theatre district"
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L7
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L9
	PRINTI ", and fight your way through"
	JUMP ?L11
?L9:	PRINTI ", and you are enjoying being in the midst of"
?L11:	PRINTI " the crowds of happy theatre goers"
	JUMP ?L12
?L7:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2 \?L12
	PRINTI "."
	CRLF
	CRLF
	PRINTI "Crowds are gathering in front of the theatres, trying to select a show to see later in the day"
?L12:	PRINTI ". Streets lead off to the north, east, and southwest."
	CRLF
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \FALSE
	CRLF
	PRINTI "As you"
	ICALL1 RT-DRIVE-WALK-MSG?
	PRINTI "through the fog, the empty streets seem haunted by the ghosts of actors from years gone by."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-FLEET-STREET,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "Fleet Street is the centre of London's thriving newspaper industry"
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L4
	PRINTI ". The presses roar all night, turning out papers that will be delivered by train around the country the next day."
	CRLF
	JUMP ?L6
?L4:	PRINTI ", and it is crowded with the thousands of people who put out the nation's newspapers."
	CRLF
?L6:	CRLF
	PRINTI "A street leads off to the west, and there is a passage south to the Embankment."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-THE-EMBANKMENT,CONTEXT
	ASSIGNED? 'CONTEXT /?L20
	SET 'CONTEXT,0
?L20:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-THAMES-ONE \FALSE
	ICALL2 RT-DO-WALK,P?NORTH
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L10
	PRINTI "You arrive at"
	JUMP ?L11
?L10:	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "on"
?L11:	PRINTI " the Victoria Embankment, on the left bank of the Thames. "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1 \?L12
	PRINTI "The early morning mist clings to the water and muffles the sounds of the river."
	JUMP ?L16
?L12:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,2 \?L14
	PRINTI "The river is crowded with pleasure boats here for the Jubilee."
	JUMP ?L16
?L14:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L15
	PRINTI "The river looks quiet and peaceful in the fading light."
	JUMP ?L16
?L15:	PRINTI "The river is barely visible through the thick fog."
?L16:	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 \FALSE
	FSET TH-BOAT,FL-SEEN
	FSET TH-OAR-1,FL-SEEN
	FSET TH-OAR-LOCK,FL-SEEN
	CRLF
	PRINTR "There is an incredibly old rowboat here. It's got one empty oarlock, and it probably leaks, but it looks as if it might float."

	.FUNCT RT-AC-RM-UPPER-THAMES-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "Upper Thames Street runs east and west between the Embankment and Lower Thames Street."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-PINCHIN-LANE,CONTEXT
	ASSIGNED? 'CONTEXT /?L26
	SET 'CONTEXT,0
?L26:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-SHERMANS-HOUSE \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L10
	EQUAL? GL-PLACE-PRV,RM-CHEAPSIDE \?L11
	PRINTI "You enter"
	JUMP ?L15
?L11:	EQUAL? GL-PLACE-PRV,RM-SHERMANS-HOUSE \?L13
	PRINTI "You emerge from Sherman's shop into"
	JUMP ?L15
?L13:	PRINTI "The cab stops in"
	JUMP ?L15
?L10:	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "in"
?L15:	PRINTI " Pinchin Lane, a dingy little alley that runs"
	EQUAL? GL-PLACE-PRV,RM-CHEAPSIDE \?L16
	PRINTI " south from"
	JUMP ?L18
?L16:	PRINTI " north to"
?L18:	PRINTI " Cheapside."
	CRLF
	CRLF
	PRINTI "To the west is the entrance to "
	EQUAL? CONTEXT,K-M-DESC-1 /?L21
	FSET? RM-SHERMANS-HOUSE,FL-SEEN /?L19
?L21:	PRINTI "what looks like a pet shop"
	JUMP ?L22
?L19:	PRINTI "Sherman's shop"
?L22:	PRINTI "."
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L23
	EQUAL? GL-PLACE-PRV,RM-SHERMANS-HOUSE /?L23
	PRINTI " Despite the hour, you see a light shining inside."
	CRLF
	RFALSE
?L23:	CRLF
	RFALSE

	.FUNCT RT-AC-RM-CHEAPSIDE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \FALSE
	PRINTI "This is a ramshackle part of town, with dark alleys leading off the main street, which continues east and west. Pinchin Lane leads off to the south."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-BANK-OF-ENGLAND,CONTEXT
	ASSIGNED? 'CONTEXT /?L19
	SET 'CONTEXT,0
?L19:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L5
	EQUAL? GL-PLACE-CUR,RM-THREADNEEDLE-ST \FALSE
	ICALL2 RT-DO-WALK,P?NORTH
	RTRUE
?L5:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-BANK-OF-ENGLAND \?L10
	ICALL2 RT-DO-WALK,P?SOUTH
	RTRUE
?L10:	EQUAL? GL-PLACE-CUR,RM-BANK-VAULT \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L1:	FSET LG-BANK-VAULT-DOOR,FL-SEEN
	FSET TH-DIAL,FL-SEEN
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \FALSE
	PRINTI "The bank has the eerie silence that normally crowded places have when no one is there. The door to the vault is set into the west wall."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-BANK-VAULT,CONTEXT
	ASSIGNED? 'CONTEXT /?L43
	SET 'CONTEXT,0
?L43:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK \?L1
	EQUAL? CONTEXT,K-M-DESCFCN \?L3
	EQUAL? GL-PLACE-CUR,RM-BANK-OF-ENGLAND \?L5
	FSET? LG-BANK-VAULT-DOOR,FL-OPENED \?L7
	ICALL2 RT-AC-RM-BANK-VAULT,K-M-DESC-3
	ICALL2 RT-DESCRIBE-PLACE-CONTENTS,RM-BANK-VAULT
	RTRUE
?L7:	PRINTI "It's a huge, reinforced-steel door that's set firmly into the wall."
	CRLF
	CRLF
	PRINTR "In the middle of the door you see a big shiny dial."
?L5:	ICALL2 RT-AC-RM-BANK-VAULT,K-M-DESC-3
	ICALL2 RT-DESCRIBE-PLACE-CONTENTS,RM-BANK-VAULT
	RTRUE
?L3:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L13
	EQUAL? GL-PLACE-CUR,RM-BANK-OF-ENGLAND \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L13:	EQUAL? GL-PRSA,V?EXIT \?L18
	EQUAL? GL-PLACE-CUR,RM-BANK-VAULT \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L18:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L22
	FSET? LG-BANK-VAULT-DOOR,FL-OPENED \?L23
	ICALL RT-CYOU-MSG,STR?155,STR?154
	PRINTI "row upon row of "
	ICALL2 DPRINT,TH-BOXES
	PRINTR "."
?L23:	ICALL2 RT-CTHEO-PRINT,LG-BANK-VAULT-DOOR
	PRINTR " is closed."
?L22:	EQUAL? GL-PRSA,V?UNLOCK \?L26
	FSET? LG-BANK-VAULT-DOOR,FL-OPENED \?L27
	ICALL2 RT-CTHEO-PRINT,LG-BANK-VAULT-DOOR
	PRINTR " is already opened."
?L27:	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE
?L26:	EQUAL? GL-PRSA,V?OPEN \?L30
	FSET? LG-BANK-VAULT-DOOR,FL-OPENED \?L31
	PRINTR "The vault door is already open."
?L31:	FSET? TH-DIAL,FL-LOCKED \?L33
	PRINTR "The vault door is locked."
?L33:	FSET LG-BANK-VAULT-DOOR,FL-OPENED
	PRINTR "The vault door swings open."
?L30:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	ICALL2 PRINT-ID,STR?270
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESC-1 \?L38
	FSET TH-BOXES,FL-SEEN
	FSET TH-BOX-LOCK,FL-SEEN
	FSET TH-SAFETY-DEPOSIT-BOX,FL-SEEN
?L38:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L40
	PRINTI "Upon entering, you"
	JUMP ?L42
?L40:	PRINTI "You"
?L42:	PRINTI " see rows and rows of safety deposit boxes."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-KING-WILLIAM-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "King William Street runs northwest to southeast, from Threadneedle Street to Monument."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-MONUMENT,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \?L1
	PRINTI "The intersection is dominated by the Monument, a huge obelisk that commemorates the Great Fire of London. On the side of the monument is a plaque."
	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L3
	PRINTR "It's a huge obelisk designed by Christopher Wren that towers 202 feet in the air."
?L3:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L5
	EQUAL? GL-PLACE-CUR,RM-MONUMENT \FALSE
	PRINTI "You can't go inside "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L5:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-MONUMENT \FALSE
	PRINTI "You're not in "
	ICALL1 RT-THEO-PRINT
	PRINTR "."

	.FUNCT RT-AC-RM-LOWER-THAMES-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	PRINTI "You enter"
	JUMP ?L4
?L3:	PRINTI "You are in"
?L4:	PRINTI " Lower Thames Street. Roads lead off in many directions, some more savory than others. There is a set of particularly slovenly stairs leading down to an alley that runs alongside the river."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-TOWER-ENTRANCE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2,K-M-DESC-3 \FALSE
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "outside the entrance to the Tower of London. Next to the entrance there is a sign."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-SOUTH-AISLE,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-POPE-TOMB,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L5
	PRINTI "You enter"
	JUMP ?L7
?L5:	PRINTI "You are in"
?L7:	PRINTI " the South Aisle of the Nave. "
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L8
	PRINTI "In the gloom, you bump into one of the tombs. "
?L8:	PRINTI "There is an exit to the southeast and a door set into the south wall."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-JERICHO-PARLOUR,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	EQUAL? GL-PLACE-PRV,RM-SOUTH-AISLE \?L4
	PRINTI "From the vastness of the Nave, you pass into"
	JUMP ?L6
?L4:	PRINTI "You leave the Chamber for"
?L6:	PRINTI " the more intimate"
	JUMP ?L7
?L3:	PRINTI "You are in the"
?L7:	PRINTI " Jericho Parlour"
	EQUAL? CONTEXT,K-M-DESC-2 \?L8
	EQUAL? GL-PLACE-PRV,RM-JERUSALEM-CHAMBER \?L8
	PRINTI "."
	CRLF
	JUMP ?L10
?L8:	PRINTI ", which is the anteroom to the famous Jerusalem Chamber just to the west."
	CRLF
?L10:	CRLF
	PRINTI "The exit to the Nave is to the north."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-JERUSALEM-CHAMBER,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L4
	PRINTI "You enter"
	JUMP ?L6
?L4:	PRINTI "You are standing in"
?L6:	PRINTI " the Jerusalem Chamber, one of the oldest parts of the Abbey. In contrast to the cold and forbidding stone elsewhere in the Abbey, this room is panelled in oak and cedar. Just inside the entrance you see a small sign."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-NORTH-CLOISTER,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-PACKET-OF-PAPER,FL-SEEN
	FSET TH-CRAYON,FL-SEEN
	FSET TH-RUBBINGS,FL-SEEN
	PRINTI "You enter"
	JUMP ?L4
?L3:	PRINTI "You are now in"
?L4:	PRINTI " the North Cloister, which is the brass-rubbing centre of the abbey. On the walls are completed rubbings that others have made."
	EQUAL? CONTEXT,K-M-DESC-1 \?L5
	PRINTR " Someone has left a pacquet of paper and a rubbing crayon here."
?L5:	CRLF
	RFALSE

	.FUNCT RT-DF-RM-SOUTH-TRANSEPT,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-DICKENS-TOMB,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L5
	PRINTI "You enter"
	JUMP ?L7
?L5:	PRINTI "You are in"
?L7:	PRINTI " the South "
	PRINT K-TRANSEPT-MSG
	CRLF
	CRLF
	PRINT K-SHAFT-OF-LIGHT-MSG
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-NORTH-TRANSEPT,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-PITT-TOMB,FL-SEEN
	FSET TH-FIGURES,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L5
	PRINTI "You enter"
	JUMP ?L7
?L5:	PRINTI "You are in"
?L7:	PRINTI " the North "
	PRINT K-TRANSEPT-MSG
	CRLF
	CRLF
	PRINT K-SHAFT-OF-LIGHT-MSG
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-POETS-CORNER,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-CHAUCER-TOMB,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L5
	PRINTI "You walk into"
	JUMP ?L7
?L5:	PRINTI "You are in"
?L7:	PRINTI " the hushed, secluded part of the Abbey known as Poets' Corner. The monuments here are dedicated to Britain's literary giants. The oldest of the tombs is that of Geoffrey Chaucer, who died in the year 1400."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-SOUTH-AMBULATORY,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINT K-AMBULATORY-MSG
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-SANCTUARY,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-ANNE-OF-CLEVES-TOMB,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L5
	PRINTI "You walk into"
	JUMP ?L7
?L5:	PRINTI "You are in"
?L7:	PRINTI " the Sanctuary. This is where the actual Coronation Ceremony takes place whenever a new monarch is crowned. A modest tomb is near the south wall."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-NORTH-AMBULATORY,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINT K-AMBULATORY-MSG
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-CONFESSOR-CHAPEL,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-EDWARD-TOMB,FL-SEEN
	FSET TH-HENRY-V-TOMB,FL-SEEN
?L3:	PRINTI "The Confessor Chapel is dominated by the tomb of the founder of the Abbey, although there are several other tombs here. It is this chapel that first gave Westminster the name ""Burial place of kings."""
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-SOUTH-CHAPEL-AISLE,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-MARY-QUEEN-OF-SCOTS-TOMB,FL-SEEN
?L3:	PRINTI "The South Chapel Aisle is the final resting place of Mary, Queen of Scots."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-NORTH-CHAPEL-AISLE,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-ELIZABETH-TOMB,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L5
	PRINTI "You enter"
	JUMP ?L7
?L5:	PRINTI "You are in"
?L7:	PRINTI " the North Chapel Aisle. There is a very large tomb here."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-INNOCENTS-CORNER,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-LITTLE-PRINCES-TOMB,FL-SEEN
?L3:	PRINTI "This is Innocents' corner, the traditional burial site of royalty who die in infancy. There are several tombs here."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-DRAWBRIDGE,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? CONTEXT,K-M-ENTERED \?L1
	SET 'ALLOW-IN-TOWER,0
	RFALSE
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L4
	PRINTI "So far, so good. No one has challenged your right to be here. Maybe the Tower has been left unguarded."
	JUMP ?L9
?L4:	EQUAL? CONTEXT,K-M-DESC-2 \?L5
	EQUAL? GL-PLACE-PRV,RM-TOWER-ENTRANCE \?L6
	PRINTI "You walk back up onto the drawbridge."
	JUMP ?L9
?L6:	PRINTI "Stung by the guard's rejection, you retrace your steps to the drawbridge."
	JUMP ?L9
?L5:	PRINTI "You are standing on the drawbridge to the Tower of London."
?L9:	CRLF
	CRLF
	PRINTI "To the east you see the Byward Tower, and to the west is the Tower Entrance."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-BYWARD-TOWER,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L6
	FSET CH-TOWER-GUARD,FL-SEEN
	FSET LG-RAVENS,FL-SEEN
	PRINTI "Your luck runs out. "
?L6:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L8
	PRINTI "A costumed Yeoman of the Guard steps forward to challenge you."
	CRLF
?L8:	EQUAL? CONTEXT,K-M-DESC-3 \?L11
	PRINTI "You are standing in the Byward Tower, which was built by Edward I in the thirteenth century to control access to the fortress. A burly Beefeater stands in your path."
	CRLF
?L11:	CRLF
	PRINTI "A few of the Tower's famous ravens are perched here, watching your every move."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-OUTER-WARD,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "This is the Outer Ward. From here you can go north, south, or west."
	CRLF
	CRLF
	PRINTI "A few of the Tower's famous ravens are perched here, watching your every move."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-BLOODY-TOWER,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L6
	PRINTI "You enter"
	JUMP ?L7
?L6:	PRINTI "You are in"
?L7:	PRINTI " the Bloody Tower where, allegedly, the ""Little Princes in the Tower"" met their death. One exit leads north. The other leads south."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-WAKEFIELD-TOWER,CONTEXT
	ASSIGNED? 'CONTEXT /?L20
	SET 'CONTEXT,0
?L20:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? GL-PLACE-PRV,RM-TOWER-GREEN \?L6
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L14
	PRINTI "You leave the"
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,0,1,3 \?L9
	PRINTI " gloom of the"
?L9:	PRINTI " Tower Green for the gloom of the Wakefield Tower."
	JUMP ?L14
?L6:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L14
	PRINTI "You descend the stairs into the ground floor of the Wakefield Tower."
?L14:	EQUAL? CONTEXT,K-M-DESC-3 \?L17
	PRINTI "You see only the thick stone walls of the Wakefield Tower."
?L17:	CRLF
	CRLF
	PRINTI "There is a dark stone staircase leading up, and the only other exit is to the northwest."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-JEWEL-ROOM,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L6
	PRINTI "The stairs take you up to"
	JUMP ?L7
?L6:	PRINTI "You are in"
?L7:	PRINTI " the Jewel Room of the Tower of London. The case that once held the Regalia is twisted and smashed"
	EQUAL? CONTEXT,K-M-DESC-1 \?L8
	FSET TH-MACE,FL-SEEN
	FSET TH-JEWEL-CASE,FL-SEEN
	PRINTR ", and the weapon that the thief used is lying on the ground nearby."
?L8:	PRINTI "."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-DUNGEON,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L6
	PRINTI "You inch your way down the dark stairs and arrive"
	JUMP ?L7
?L6:	PRINTI "You are"
?L7:	PRINTI " in the oldest part of the Tower, the Dungeon."
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 \FALSE
	FSET TH-SUIT-OF-ARMOUR,FL-SEEN
	ICALL SOUNDS,S-ARMOR,S-INIT
	CRLF
	PRINTR "The room has been converted into museum space, and prominently featured is a man-size suit of armour."

	.FUNCT RT-DF-RM-TORTURE-ROOM,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L7
	PRINTI "You enter"
	JUMP ?L9
?L7:	PRINTI "You are in"
?L9:	PRINTI " the torture room below the Bowyer Tower. Around the walls are hung various instruments of torture. The stairs leading up are the only way out."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-WHITE-TOWER,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "This is the White Tower, which was started by William the Conqueror in 1078. Exits lead out and down."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-TOWER-GREEN,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	PRINTI "You are on Tower Green, which is at the centre of the Tower of London. Entrances to various towers lie to the northeast, east, southeast, and south. A few ravens are strolling around the green, eyeing you with interest."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-BOWYER-TOWER,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L6
	FSET TH-BUNG,FL-SEEN
	FSET TH-BUTT-OF-MALMSEY,FL-SEEN
	FSET TH-MALMSEY,FL-SEEN
?L6:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L8
	PRINTI "You enter"
	JUMP ?L10
?L8:	PRINTI "You are in"
?L10:	PRINTI " the Bowyer Tower. It was in this room that the Duke of Clarence was drowned in a Butt of Malmsey in 1478. The keg still stands over in the corner."
	CRLF
	CRLF
	PRINTI "Exits lead out and down."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-INSIDE-TRAITORS-GATE,CONTEXT
	ASSIGNED? 'CONTEXT /?L17
	SET 'CONTEXT,0
?L17:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1 \?L6
	FSET TH-PORTCULLIS-CHAIN,FL-SEEN
?L6:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L8
	EQUAL? GL-PLACE-PRV,RM-OUTSIDE-TRAITORS-GATE \?L10
	PRINTI "You pass under the portcullis"
	JUMP ?L12
?L10:	PRINTI "You walk south from the Outer Ward"
?L12:	PRINTI " and find yourself"
	JUMP ?L13
?L8:	PRINTI "You are"
?L13:	PRINTI " just north of Traitors Gate. The portcullis is "
	FSET? LG-PORTCULLIS-DOOR,FL-OPENED \?L14
	PRINTI "up"
	JUMP ?L16
?L14:	PRINTI "down"
?L16:	PRINTI ". From the wall near the portcullis hangs a chain, and perched on top of the wall are some ravens."
	CRLF
	RFALSE

	.FUNCT RT-DF-RM-OUTSIDE-TRAITORS-GATE,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	EQUAL? CONTEXT,K-M-EXIT \?L1
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	ICALL2 SOUNDS,S-ARMOR
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /FALSE
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L6
	EQUAL? GL-PLACE-PRV,RM-INSIDE-TRAITORS-GATE \?L7
	PRINTI "You pass under the portcullis"
	JUMP ?L9
?L7:	PRINTI "You leave the boat"
?L9:	PRINTI " and find yourself"
	JUMP ?L10
?L6:	PRINTI "You are"
?L10:	PRINTI " just south of Traitors Gate, through which condemned prisoners were brought in to the Tower prior to being executed. The massive iron portcullis is "
	FSET? LG-PORTCULLIS-DOOR,FL-OPENED \?L11
	PRINTI "up"
	JUMP ?L13
?L11:	PRINTI "down"
?L13:	PRINTI "."
	CRLF
	RFALSE

	.FUNCT RT-SURGE
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L1
	PRINTI "The fog is so thick that even your light cannot penetrate it, so you retrace your steps."
	CRLF
	RFALSE
?L1:	PRINTI "Surging crowds of "
	EQUAL? GL-PLACE-CUR,RM-KENSINGTON-GARDENS \?L4
	PRINTI "haughty nannies"
	JUMP ?L7
?L4:	EQUAL? GL-PLACE-CUR,RM-COVENT-GARDEN \?L6
	PRINTI "housewives intent on a bargain"
	JUMP ?L7
?L6:	PRINTI "tourists"
?L7:	PRINTI " block your path."
	CRLF
	RFALSE

	.FUNCT RT-AC-RM-MADAME-TUSSAUDS,CONTEXT
	ASSIGNED? 'CONTEXT /?L25
	SET 'CONTEXT,0
?L25:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-ASH,FL-SEEN
	FSET TH-WILLIAM-STATUE,FL-SEEN
	FSET TH-WALTER-STATUE,FL-SEEN
	FSET TH-ELIZABETH-STATUE,FL-SEEN
	FSET TH-DRAKE-STATUE,FL-SEEN
	FSET TH-JOHN-STATUE,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L6
	EQUAL? GL-PLACE-PRV,RM-MARYLEBONE-RD \?L8
	PRINTI "You come in off the street and are now standing in"
	JUMP ?L11
?L8:	PRINTI "You leave the Chamber of Horrors and go back into"
	JUMP ?L11
?L6:	PRINTI "You are in"
?L11:	PRINTI " the lobby."
	CRLF
	CRLF
	PRINTI "All around you are wax statues of famous people. To the west is a dark and ominous-looking doorway with a sign over it. The exit to the street is to the south."
	CRLF
	FSET? TH-ASH,FL-ASLEEP \FALSE
	IN? CH-HOLMES,GL-PLACE-CUR \FALSE
	FSET TH-ASH,FL-SEEN
	FCLEAR TH-ASH,FL-ASLEEP
	FCLEAR TH-ASH,FL-NODESC
	CRLF
	ICALL2 RT-CTHEO-PRINT,CH-HOLMES
	PRINTI " drops to his hands and knees and begins a minute examination of the floor. After a few moments he cries, ""Aha! Look here, Watson."" He points to a miniscule speck of ash on the floor."
	CRLF
	SET 'GL-PUPPY-MSG?,0
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-ENTERED \?L15
	FSET? TH-TOBACCO,FL-ASLEEP /?L15
	FSET? TH-TOBACCO,FL-LIGHTED \?L15
	ICALL2 RT-UPDATE-SCORE,1
	FSET TH-TOBACCO,FL-ASLEEP
	RFALSE
?L15:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-MARYLEBONE-RD \?L19
	ICALL2 RT-DO-WALK,P?NORTH
	RTRUE
?L19:	EQUAL? GL-PLACE-CUR,RM-CHAMBER-OF-HORRORS \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE

	.FUNCT RT-AC-RM-MANUSCRIPT-ROOM,CONTEXT,VALUE
	ASSIGNED? 'CONTEXT /?L54
	SET 'CONTEXT,0
?L54:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	PRINTI "The deserted corridor leads to"
	JUMP ?L5
?L3:	PRINTI "You are in"
?L5:	PRINTI " the manuscript room, which contains a dusty collection of old books on obscure subjects. "
	IN? CH-LIBRARIAN,RM-MANUSCRIPT-ROOM \?L6
	PRINTI "There is an old librarian here, on whose desk sits a handwritten sign that reads ""Quiet, please."" "
?L6:	PRINTI "There are thousands of books behind glass cases"
	EQUAL? CONTEXT,K-M-DESC-1 \?L9
	PRINTI ", but one is lying unattended on a table"
?L9:	PRINTI ". The only exit is to the west."
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 \FALSE
	FSET CH-LIBRARIAN,FL-SEEN
	FSET TH-CLUE-BOOK,FL-SEEN
	FSET TH-LIBRARY-TABLE,FL-SEEN
	CRLF
	PRINTI "The librarian - who is as dusty as the books - looks up in surprise as you come in. He "
	FSET? TH-COTTON-BALLS,FL-WORN \?L14
	PRINTI "whispers"
	JUMP ?L16
?L14:	PRINTI "says loudly"
?L16:	PRINTI ", ""Oh, I say! Hello! I don't get many visitors here. Is there something I can help you with? Some information about the Jubilee, perhaps? It's quite rare, you know, for a British ruler to celebrate 50 years on the throne. Unique, in fact. The closest anyone else came was Elizabeth, who ruled 45 years - although our records are somewhat vague before the year 900. The Anglo-Saxon chronicles do get rather sketchy, what? Still, they're the best we have. I think I can find a copy for you somewhere here."""
	CRLF
	CRLF
	PRINTR "The librarian's voice trails off as he bustles from shelf to shelf, squinting at the books to find the one he thinks you want."
?L1:	ZERO? CONTEXT /?L42
	IN? CH-LIBRARIAN,RM-MANUSCRIPT-ROOM \?L18
	FSET? CH-LIBRARIAN,FL-ASLEEP /?L18
	EQUAL? CONTEXT,K-M-ENTERED \?L19
	FSET? CH-LIBRARIAN,FL-OPENED \?L19
	CRLF
	ICALL2 RT-CTHEO-PRINT,CH-LIBRARIAN
	PRINTR " says, ""Welcome back! I have more interesting things to tell you!"""
?L19:	EQUAL? CONTEXT,K-M-EXIT \?L21
	PRINTI "As you leave, the librarian calls out, ""Must you be going? I have so many other interesting things to tell you."""
	CRLF
	CRLF
	FSET CH-LIBRARIAN,FL-OPENED
	RTRUE
?L21:	EQUAL? CONTEXT,K-M-BEG \FALSE
	EQUAL? GL-PRSA,V?WALK,V?EXIT /FALSE
	GET GL-GAME-VERBS,0 >STACK
	INTBL? GL-PRSA,GL-GAME-VERBS+2,STACK >STACK /FALSE
	EQUAL? GL-PRSA,V?WAIT,V?LISTEN \?L26
	PRINTI "The librarian says "
	FSET? TH-COTTON-BALLS,FL-WORN \?L27
	PRINTI "softly"
	JUMP ?L29
?L27:	PRINTI "loudly"
?L29:	PRINTI ", "
	ICALL1 RT-LIBRARIAN-SAYS-MSG
	RTRUE
?L26:	EQUAL? GL-PRSA,V?HUSH \?L30
	PRINTI "The librarian stops in midsentence and gets an embarrassed look on his face. ""Oh, I say. I'm sorry to have rambled on like this, but I do so enjoy speaking with visitors. I get them so seldom, you know. Thank you for listening."""
	CRLF
	CRLF
	PRINTI "He leaves the room, mumbling something to himself about the articulation of the third joint of the hind leg of an extinct species of dung beetle."
	CRLF
	REMOVE CH-LIBRARIAN
	RTRUE
?L30:	EQUAL? GL-PRSA,V?LOOK \?L31
	ICALL RT-DESC-ALL,0,1
	CRLF
	PRINTI "As you look around, the librarian says "
	FSET? TH-COTTON-BALLS,FL-WORN \?L32
	PRINTI "softly"
	JUMP ?L34
?L32:	PRINTI "loudly"
?L34:	PRINTI ", "
	ICALL1 RT-LIBRARIAN-SAYS-MSG
	RTRUE
?L31:	EQUAL? GL-PRSA,V?TELL \?L35
	EQUAL? GL-PRSO,CH-LIBRARIAN /FALSE
?L35:	CALL1 RT-TALK-VERB? >STACK
	ZERO? STACK /?L36
	PRINTI "The librarian interrupts you as you attempt to speak, and "
	FSET? TH-COTTON-BALLS,FL-WORN \?L37
	PRINTI "whispers"
	JUMP ?L39
?L37:	PRINTI "says"
?L39:	PRINTI ", "
	ICALL1 RT-LIBRARIAN-SAYS-MSG
	RETURN 2
?L36:	PRINTI "The librarian launches off into another speech, and it distracts you from what you wanted to do. "
	ICALL1 RT-LIBRARIAN-SAYS-MSG
	RTRUE
?L18:	ZERO? CONTEXT \FALSE
?L42:	EQUAL? GL-PRSA,V?ENTER \?L44
	EQUAL? GL-PLACE-CUR,RM-BRITISH-MUSEUM \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L44:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-MANUSCRIPT-ROOM \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE

	.FUNCT RT-AC-RM-VICTORIA-STREET,CONTEXT
	ASSIGNED? 'CONTEXT /?L12
	SET 'CONTEXT,0
?L12:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	PRINTI "You enter"
	JUMP ?L5
?L3:	PRINTI "You are loitering in"
?L5:	PRINTI " Victoria Street, which runs east and west between Victoria Square and Broad Sanctuary."
	CRLF
	CRLF
	PRINTI "You see a sign outside one of the shops."
	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-BEG \?L6
	EQUAL? GL-PRSA,V?WAIT \?L6
	FSET? RM-VICTORIA-STREET,FL-ASLEEP /?L7
	FSET RM-VICTORIA-STREET,FL-ASLEEP
	PRINTI "After a few moments, a constable strolls by, bops you on the head with his billy club, and says, ""Move along, you."""
	CRLF
	ICALL2 PRINT-ID,STR?271
	RTRUE
?L7:	PRINTI "The same constable as before walks by and says, ""You again? That's it, mate. Come along with me."" He bops you on the head again and arrests you on a charge of vagrancy."
	CRLF
	CRLF
	PRINTI "You spend the night in gaol, and in the morning Inspector Lestrade drops by to tell you that there has been a mix-up in the paperwork and you are to be deported to Australia the following day. He gives you a letter to deliver to his sister in Melbourne and wishes you luck."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?272
	CALL1 RT-QSR >STACK
	RSTACK
?L6:	ZERO? CONTEXT \FALSE
	RFALSE

	.FUNCT RT-AC-RM-CLOCK-TOWER,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	PRINTI "The stairs seem to wind up forever. Finally, you emerge into"
	JUMP ?L5
?L3:	PRINTI "You are in"
?L5:	PRINTI " the interior of the clock tower, high above the Houses of Parliament."
	CRLF
	CRLF
	PRINTI "The immense bell known as Big Ben is hanging from the ceiling, suspended over a hollow shaft that is so deep it might as well be bottomless. A wooden railing runs around the shaft for safety."
	CRLF
	CRLF
	PRINTI "Inside the bell, you see an enormous clapper"
	EQUAL? CONTEXT,K-M-DESC-1 \?L6
	FSET TH-BELL,FL-SEEN
	FSET TH-SAPPHIRE,FL-SEEN
	FSET TH-CLAPPER,FL-SEEN
	FSET TH-SHAFT,FL-SEEN
	FSET TH-RAILING,FL-SEEN
	PRINT K-SAPPHIRE-MSG
	CRLF
	RTRUE
?L6:	IN? TH-SAPPHIRE,TH-CLAPPER \?L9
	PRINT K-SAPPHIRE-MSG
	CRLF
	RFALSE
?L9:	PRINTI "."
	CRLF
	RFALSE
?L1:	CALL2 RT-ALARM-SET?,RT-I-SWING-BELL >STACK
	ZERO? STACK \FALSE
	ICALL1 RT-ZERO-SECONDS
	RFALSE

	.FUNCT RT-AC-RM-THAMES-ONE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "on the Thames, just south of the Embankment."
	CRLF
	RFALSE
?L1:	CALL1 RT-PROCESS-BOAT-ON-THAMES >STACK
	RSTACK

	.FUNCT RT-AC-RM-THAMES-TWO,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "on the Thames. Downstream you can see London Bridge."
	CRLF
	RFALSE
?L1:	CALL1 RT-PROCESS-BOAT-ON-THAMES >STACK
	RSTACK

	.FUNCT RT-AC-RM-THAMES-THREE,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "underneath London Bridge."
	CRLF
	RFALSE
?L1:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-UNDER \?L5
	EQUAL? GL-PRSO,RM-LONDON-BRIDGE /?L4
?L5:	EQUAL? GL-PRSA,V?LOOK-UP \?L3
	EQUAL? GL-PRSO,ROOMS,RM-LONDON-BRIDGE \?L3
?L4:	PRINTI "You see nothing of interest"
	IN? TH-CLUMP-OF-MOSS,RM-THAMES-THREE \?L6
	FSET TH-CLUMP-OF-MOSS,FL-SEEN
	PRINTI ", other than a clump of moss lodged among the supports overhead."
	CRLF
	JUMP ?L8
?L6:	PRINTI "."
	CRLF
?L8:	ICALL1 RT-PROCESS-BOAT-ON-THAMES
	RTRUE
?L3:	CALL1 RT-PROCESS-BOAT-ON-THAMES >STACK
	RSTACK

	.FUNCT RT-AC-RM-THAMES-FOUR,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "on the Thames, just south of Traitor's Gate."
	CRLF
	RFALSE
?L1:	CALL1 RT-PROCESS-BOAT-ON-THAMES >STACK
	RSTACK

	.FUNCT RT-AC-RM-THAMES-FIVE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "on the Thames, in danger of drifting out to sea."
	CRLF
	RFALSE
?L1:	CALL1 RT-PROCESS-BOAT-ON-THAMES >STACK
	RSTACK

	.FUNCT RT-AC-RM-SHERMANS-HOUSE,CONTEXT
	ASSIGNED? 'CONTEXT /?L23
	SET 'CONTEXT,0
?L23:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	ICALL2 RT-THIS-IS-IT,CH-SHERMAN
	FSET CH-SHERMAN,FL-SEEN
	FSET RM-SHERMANS-HOUSE,FL-SEEN
	PRINTI "You enter the cramped quarters of Sherman's shop. The old animal-trainer's eyes brighten up when he sees you."
	CRLF
	CRLF
	PRINTR """You've probably come looking for Toby,"" he says. ""But I'm afraid I won't be able to help you this time. Toby's not feeling too well, and all my other animals are already out on loan. All I have left is a half-trained pigeon."""
?L3:	EQUAL? CONTEXT,K-M-DESC-2,K-M-DESC-3 \FALSE
	PRINTI "Sherman's shop is dingy and cramped. Dozens of empty cages are stacked up against the walls."
	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-ENTERED \?L7
	FSET? RM-SHERMANS-HOUSE,FL-ASLEEP \?L8
	FCLEAR RM-SHERMANS-HOUSE,FL-ASLEEP
	RFALSE
?L8:	FSET? CH-SHERMAN,FL-ASLEEP /FALSE
	FSET? CH-TRAINED-PIGEON,FL-ALIVE \?L11
	CRLF
	PRINTI "Sherman says, ""Welcome back. It's a pleasure to see you again."""
	CRLF
	CALL2 RT-THIS-IS-IT,CH-SHERMAN >STACK
	RSTACK
?L11:	CALL2 RT-SHERMAN-RAGE,1 >STACK
	RSTACK
?L7:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L14
	EQUAL? GL-PLACE-CUR,RM-PINCHIN-LANE \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L14:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-SHERMANS-HOUSE \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE

	.FUNCT RT-AC-RM-THREADNEEDLE-ST,CONTEXT
	ASSIGNED? 'CONTEXT /?L31
	SET 'CONTEXT,0
?L31:	ZERO? CONTEXT \?L1
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-BANK-OF-ENGLAND \FALSE
	ICALL2 RT-DO-WALK,P?SOUTH
	RTRUE
?L1:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L10
	FSET CH-BANK-GUARD,FL-SEEN
	FSET CH-URCHINS,FL-SEEN
	FSET TH-GUARDS-POCKET,FL-SEEN
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L12
	EQUAL? GL-PLACE-PRV,RM-BANK-OF-ENGLAND \?L14
	PRINTI "You emerge into"
	JUMP ?L16
?L14:	PRINTI "You enter"
?L16:	PRINTI " Threadneedle Street and are now"
	JUMP ?L17
?L12:	PRINTI "You are"
?L17:	PRINTI " in front of the Bank of England. The entrance to the bank is to the north, Cheapside leads off to the west, and King William Street "
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L18
	PRINTI "disappears off into the darkness"
	JUMP ?L20
?L18:	PRINTI "continues"
?L20:	PRINTI " to the southeast. On the wall is a small sign."
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 /?L23
	IN? CH-BANK-GUARD,RM-THREADNEEDLE-ST \?L21
?L23:	CRLF
	PRINTI "A bank guard is lounging up against the wall, idly jangling some keys in his pocket while he watches a group of urchins playing in the street."
	CRLF
	FSET? CH-WIGGINS,FL-BROKEN \FALSE
	CRLF
	PRINT K-URCHIN-MSG
	CRLF
	RTRUE
?L21:	CRLF
	PRINTI "A group of urchins is playing in the street."
	CRLF
	RFALSE
?L10:	EQUAL? CONTEXT,K-M-BEG \?L28
	IN? CH-HOLMES,RM-LAIR \?L28
	FSET? TH-TOPAZ,FL-LOCKED /?L28
	ICALL1 RT-WIGGINS-HELP-MSG
	CRLF
	FSET TH-TOPAZ,FL-LOCKED
	RFALSE
?L28:	EQUAL? CONTEXT,K-M-ENTERED \FALSE
	EQUAL? GL-PLACE-PRV,RM-BANK-OF-ENGLAND \FALSE
	FSET? TH-TOPAZ,FL-ASLEEP /FALSE
	ICALL1 RT-KIDNAP
	FSET TH-TOPAZ,FL-ASLEEP
	RFALSE

	.FUNCT RT-AC-RM-LONDON-BRIDGE,CONTEXT
	ASSIGNED? 'CONTEXT /?L34
	SET 'CONTEXT,0
?L34:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	EQUAL? GL-PLACE-PRV,RM-LAIR \?L5
	PRINTR "When you emerge from the lair you are momentarily disoriented, blinking your eyes in the bright sunlight. After a few moments, you realize you are standing on London bridge, but you have no idea from which direction you came."
?L5:	PRINTI "You"
	ICALL1 RT-DRIVE-WALK-MSG?
	PRINTI "up onto"
	JUMP ?L8
?L3:	PRINTI "You are"
	ICALL1 RT-IN-VEHICLE-MSG
	PRINTI "on"
?L8:	PRINTI " London Bridge. "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L9
	PRINTI "The view of the river from here is spectacular, and hoards of sightseers are here with you to share the view."
	CRLF
	RFALSE
?L9:	PRINTI "The fog is so dense you can barely see the river from here."
	CRLF
	RFALSE
?L1:	ZERO? CONTEXT \?L14
	EQUAL? GL-PRSA,V?LOOK-UNDER,V?LOOK-DOWN \?L14
	EQUAL? GL-PRSO,RM-LONDON-BRIDGE /?L13
?L14:	EQUAL? CONTEXT,K-M-BEG \?L12
	EQUAL? GL-PRSA,V?LOOK-DOWN \?L12
	EQUAL? GL-PRSO,ROOMS \?L12
?L13:	PRINTR "You see the Thames flowing slowly by, just as it has done for centuries past."
?L12:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \?L35
	EQUAL? GL-PRSA,V?ENTER \?L17
	EQUAL? GL-PLACE-CUR,RM-LOWER-THAMES-ST \?L19
	ICALL2 RT-DO-WALK,P?SOUTH
	RTRUE
?L19:	EQUAL? GL-PLACE-CUR,RM-THAMES-THREE \FALSE
	PRINTR "You can't climb onto the bridge."
?L17:	EQUAL? GL-PRSA,V?EXIT \?L23
	EQUAL? GL-PLACE-CUR,RM-LONDON-BRIDGE \FALSE
	ICALL2 RT-DO-WALK,P?NORTH
	RTRUE
?L23:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	ICALL2 PRINT-ID,STR?273
	RTRUE
?L35:	IN? CH-PLAYER,TH-BOAT \FALSE
	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	PRINTR "You can't attach anything to the bridge."

	.FUNCT RT-AC-RM-SWAN-LANE,CONTEXT
	ASSIGNED? 'CONTEXT /?L19
	SET 'CONTEXT,0
?L19:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L3
	EQUAL? GL-PLACE-PRV,RM-LOWER-THAMES-ST \?L5
	PRINTI "With increasing apprehension, you descend"
	JUMP ?L7
?L5:	PRINTI "With considerable relief, you emerge"
?L7:	PRINTI " into"
	JUMP ?L8
?L3:	PRINTI "With increasing apprehension, you are standing in"
?L8:	PRINTI " Swan Lane, which runs along the waterfront of the Thames."
	CRLF
	CRLF
	EQUAL? CONTEXT,K-M-DESC-1 \?L9
	PRINTI "It is a seedy, disreputable, run-down part of town that normally you wouldn't be caught dead in. After a moment's reflection, you wish you hadn't thought of it in quite those terms."
	CRLF
	CRLF
?L9:	PRINTI "To the west is the entrance to one of the least savory buildings you have ever seen. There is a faded sign above the door that informs you that the establishment was, in better days, known as the Bar of Gold."
	CRLF
	CRLF
	PRINTI "Fortunately, it is only a short walk back up the stairs to Lower Thames Street."
	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-ENTERED \?L12
	EQUAL? GL-PLACE-PRV,RM-BAR-OF-GOLD \?L12
	IN? CH-WIGGINS,RM-SWAN-LANE \?L12
	CRLF
	ICALL2 RT-CTHEO-PRINT,CH-WIGGINS
	PRINTI " says, ""Blimey!! I didn't think you would make it out of there alive."""
	CRLF
	SET 'GL-PUPPY,CH-WIGGINS
	RETURN GL-PUPPY
?L12:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PLACE-CUR,RM-BAR-OF-GOLD \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE

	.FUNCT RT-AC-RM-BAR-OF-GOLD,CONTEXT
	ASSIGNED? 'CONTEXT /?L23
	SET 'CONTEXT,0
?L23:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET CH-DENKEEPER,FL-SEEN
	FSET TH-OPIUM-GAS,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L6
	PRINTI "After fighting the urge to turn and run, you enter and find yourself "
	JUMP ?L8
?L6:	PRINTI "You are standing - rather nervously - "
?L8:	PRINTI "in the Bar of Gold, the most infamous opium den in London. The proprietor is a most unsavory character who "
	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L9
	PRINTI "gives you a sidelong glance as you enter and then ignores you"
	JUMP ?L11
?L9:	PRINTI "hasn't given you a second look since you came in"
?L11:	PRINTI "."
	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-ENTERING \?L12
	EQUAL? GL-PUPPY,CH-WIGGINS \?L12
	ICALL2 RT-THEO-PRINT,CH-WIGGINS
	PRINTI " says, ""You must be stark raving bonkers. That's the most dangerous place in London. I'll wait out here, thank you very much!"""
	CRLF
	CRLF
	SET 'GL-PUPPY,0
	RETURN GL-PUPPY
?L12:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L14
	EQUAL? GL-PLACE-CUR,RM-SWAN-LANE \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L14:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-BAR-OF-GOLD \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE

	.FUNCT RT-AC-RM-LAIR,CONTEXT
	ASSIGNED? 'CONTEXT /?L79
	SET 'CONTEXT,0
?L79:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET CH-MORIARTY,FL-SEEN
	FSET TH-LAIR-KEY,FL-SEEN
	FSET TH-CROWN-JEWELS,FL-SEEN
	FSET TH-MORIARTY-DESK,FL-SEEN
	FSET TH-ROPE,FL-SEEN
	PRINTI "At last you come face to face with the evil Professor. He is sitting placidly behind his desk, looking at you as if you were some botanical specimen."
	CRLF
	CRLF
	PRINTI "As you look around the room, you see Sherlock Holmes tied to a chair. He is only inches away from the Crown Jewels, which Moriarty has spread out on his desk, the better to taunt Holmes."
	CRLF
	CRLF
	PRINTI "Holmes looks up and says, ""Ah, there you are Watson."" He turns his head towards Moriarty and says, ""You see, Professor, you grossly underestimate the intelligence and determination of your fellow countrymen."""
	CRLF
	CRLF
	PRINTR """Watson,"" he continues. ""The Professor and I have just been chatting about why he led us on this merry chase. If you care to ask him, I'm sure he would be happy to fill you in as well."""
?L3:	EQUAL? CONTEXT,K-M-DESC-3 \FALSE
	PRINTI "The room is simply, but elegantly, furnished."
	FSET? CH-HOLMES,FL-LOCKED \?L6
	SET 'GL-PUPPY-MSG?,0
	PRINTI " "
	CALL2 RT-PICK-NEXT,GL-HOLMES-DESC-TXT >STACK
	PRINT STACK
	PRINT K-SECURELY-BOUND-MSG
	PRINTI "."
?L6:	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-ENTERED \?L10
	SET 'GL-PUPPY,CH-HOLMES
?L10:	EQUAL? CONTEXT,K-M-BEG \FALSE
	EQUAL? GL-PRSA,V?TAKE,V?SHOW \?L14
	EQUAL? GL-PRSO,TH-BREATH /FALSE
	FSET? GL-PRSO,FL-BODYPART /FALSE
	FSET? GL-PRSO,FL-WORN /FALSE
	FSET? CH-MORIARTY,FL-LOCKED /FALSE
	FSET? CH-MORIARTY,FL-ASLEEP /FALSE
	CALL RT-META-IN?,GL-PRSO,GL-WINNER >STACK
	ZERO? STACK /?L21
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,2,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-TAKE-WATSONS-STUFF,STACK
	MOVE GL-PRSO,GL-WINNER
	PRINTI "Moriarty's normally emotionless features dissolve in rage. He shouts at Akbar, ""Why didn't you take that from him when you brought him in?"""
	CRLF
	CRLF
	PRINTR "The outburst startles Akbar into momentary inaction, but he quickly recovers and starts to come towards you with a violent look in his eyes."
?L21:	PRINTI "Akbar steps in your way"
	FSET? TH-WATSONS-HAT,FL-WORN \?L24
	PRINTI ", says, ""Pardon me, honourable sir,"""
?L24:	PRINTI " and stops you from taking "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L14:	EQUAL? GL-PRSA,V?RELEASE \?L28
	EQUAL? GL-PRSO,TH-BREATH /FALSE
?L28:	EQUAL? GL-PRSA,V?UNTIE,V?RELEASE \?L29
	EQUAL? GL-PRSO,TH-ROPE /FALSE
	FSET? GL-PRSO,FL-LOCKED \?L32
	FSET? CH-AKBAR,FL-ASLEEP /?L35
	FSET? CH-AKBAR,FL-LOCKED \?L33
?L35:	FCLEAR GL-PRSO,FL-LOCKED
	ICALL RT-CYOU-MSG,STR?275,STR?274
	ICALL1 RT-THEO-PRINT
	EQUAL? GL-PRSO,TH-ROPE-AUX1 \?L36
	SET 'TH-ROPE-AUX1,TH-ROPE-AUX2
	SET 'TH-ROPE-AUX2,-1
	EQUAL? TH-ROPE-AUX1,-1 \?L41
	MOVE TH-ROPE,CH-PLAYER
	FCLEAR TH-ROPE,FL-NODESC
	PRINTI ", keeping "
	ICALL2 RT-THEO-PRINT,TH-ROPE
	JUMP ?L41
?L36:	EQUAL? GL-PRSO,TH-ROPE-AUX2 \?L41
	SET 'TH-ROPE-AUX2,-1
?L41:	PRINTI "."
	CRLF
	EQUAL? GL-PRSO,CH-MORIARTY,CH-AKBAR \TRUE
	FSET? CH-AKBAR,FL-ASLEEP /TRUE
	CRLF
	EQUAL? GL-PRSO,CH-MORIARTY \?L45
	PRINTI "Bad move. As soon as he is free, Moriarty"
	JUMP ?L47
?L45:	PRINTI "Akbar immediately unties Moriarty, who"
?L47:	PRINTI " unlocks his desk and pulls out a pistol. ""Thank you for releasing me, gentlemen,"" he says, waving the gun at you. ""Very sporting of you."" He glances at his pocketwatch. ""We shouldn't have too long to wait."" Minutes later you hear newsboys running through the streets shouting about the resignation of the Prime Minister."
	CRLF
	ICALL2 PRINT-ID,STR?276
	ICALL1 RT-QSR
	RTRUE
?L33:	CALL1 RT-ROPE-MSG >STACK
	RSTACK
?L32:	EQUAL? GL-PRSA,V?RELEASE /FALSE
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSO
	PRINTR "tied up."
?L29:	EQUAL? GL-PRSA,V?TIE-UP \?L52
	EQUAL? GL-PRSI,TH-ROPE,ROOMS /?L52
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L52:	EQUAL? GL-PRSA,V?TIE,V?TIE-UP \FALSE
	EQUAL? GL-PRSO,CH-PLAYER,CH-ME /?L54
	EQUAL? GL-PRSI,CH-PLAYER,CH-ME \?L53
?L54:	PRINTR "We'll assume you're joking."
?L53:	EQUAL? GL-PRSA,V?TIE,V?TIE-UP \FALSE
	CALL2 RT-VISIBLE?,TH-ROPE >STACK
	ZERO? STACK /?L56
	FSET? CH-AKBAR,FL-ASLEEP /?L60
	FSET? CH-AKBAR,FL-LOCKED \?L58
?L60:	EQUAL? CH-HOLMES,GL-PRSI,GL-PRSO \?L61
	PRINTR "Surely you jest."
?L61:	EQUAL? TH-ROPE-AUX1,-1 \?L64
	SET 'TH-ROPE-AUX1,GL-PRSO
	JUMP ?L67
?L64:	EQUAL? TH-ROPE-AUX2,-1 \?L66
	SET 'TH-ROPE-AUX2,GL-PRSO
	JUMP ?L67
?L66:	ICALL2 RT-CTHEO-PRINT,TH-ROPE
	PRINTR " is not long enough."
?L67:	EQUAL? GL-PRSI,ROOMS \?L68
	SET 'GL-PRSI,0
?L68:	MOVE TH-ROPE,GL-PLACE-CUR
	FSET TH-ROPE,FL-NODESC
	FSET GL-PRSO,FL-LOCKED
	EQUAL? GL-PRSI,0,TH-ROPE \?L71
	ICALL RT-CYOU-MSG,STR?278,STR?277
	PRINTI "up "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L71:	EQUAL? TH-ROPE-AUX2,-1 /?L73
	ICALL RT-CYOU-MSG,STR?278,STR?277
	PRINTI "up "
	ICALL1 RT-THEO-PRINT
	PRINTI ", but "
	ICALL2 RT-THEO-PRINT,TH-ROPE
	PRINTI " is not long enough to tie up "
	ICALL1 RT-THEI-PRINT
	PRINTR " as well."
?L73:	FSET GL-PRSI,FL-LOCKED
	PRINTI "You tie "
	ICALL1 RT-THEO-PRINT
	PRINTI " to "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L58:	CALL1 RT-ROPE-MSG >STACK
	RSTACK
?L56:	PRINTI "You don't have "
	ICALL2 RT-A-PRINT,TH-ROPE
	PRINTR "."

	.FUNCT RT-AC-RM-NAVE,CONTEXT
	ASSIGNED? 'CONTEXT /?L17
	SET 'CONTEXT,0
?L17:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-NEWTON-TOMB,FL-SEEN
	PRINTI "You enter the Abbey and pause in the Nave, struck by the sheer magnificence of the building. Massive Purbeck columns march the length of the Nave, and they rise in perfect proportion to meet each other in a series of pointed arches that are the hallmark of the Gothic style."
	CRLF
	CRLF
	PRINTR "The interior of the Abbey is dark, cold, and gloomy - but after a few moments your eyes adjust and you can make out a tomb at the far end of the room."
?L3:	EQUAL? CONTEXT,K-M-DESC-2,K-M-DESC-3 \FALSE
	EQUAL? CONTEXT,K-M-DESC-2 \?L6
	EQUAL? GL-PLACE-PRV,RM-BROAD-SANCTUARY \?L8
	PRINTI "You walk through the massive door and find yourself once again in"
	JUMP ?L11
?L8:	PRINTI "You return to"
	JUMP ?L11
?L6:	EQUAL? CONTEXT,K-M-DESC-3 \?L11
	PRINTI "You are standing in"
?L11:	PRINTI " the Nave. Amidst the massive columns, one tomb in particular catches your attention."
	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-ENTERED \?L14
	SET 'PLAYER-IN-ABBEY,1
	RFALSE
?L14:	EQUAL? CONTEXT,K-M-EXIT \FALSE
	EQUAL? GL-P-WALK-DIR,P?OUT,P?WEST \FALSE
	SET 'PLAYER-IN-ABBEY,0
	RFALSE

	.FUNCT RT-AC-RM-EVANGELIST-CHAPEL,CONTEXT
	ASSIGNED? 'CONTEXT /?L9
	SET 'CONTEXT,0
?L9:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-BANK-OF-CANDLES,FL-SEEN
	FSET TH-VERE-TOMB,FL-SEEN
	PRINTI "You enter the Evangelist Chapel and wonder what it is about this room that makes you feel it is somehow different from the rest of the Abbey."
	CRLF
	RFALSE
?L3:	EQUAL? CONTEXT,K-M-DESC-2 \?L5
	PRINTI "You return to the welcome warmth provided by the array of candles in the Evangelist Chapel."
	CRLF
	RFALSE
?L5:	PRINTI "Light! Warmth! There is a bank of candles here lit by devoted worshippers. The candles warm the room so effectively that after a few moments you actually become uncomfortable."
	CRLF
	CRLF
	PRINTI "One of the most unusual tombs in the Abbey is here."
	CRLF
	RFALSE
?L1:	EQUAL? CONTEXT,K-M-BEG \FALSE
	ICALL2 RT-PAPER-WARMING,TH-WHITE-PAPER
	ICALL2 RT-PAPER-WARMING,TH-BLUE-PAPER
	ICALL2 RT-PAPER-WARMING,TH-ORANGE-PAPER
	ICALL2 RT-PAPER-WARMING,TH-YELLOW-PAPER
	ICALL2 RT-PAPER-WARMING,TH-BROWN-PAPER
	ICALL2 RT-PAPER-WARMING,TH-GREEN-PAPER
	RFALSE

	.FUNCT RT-AC-RM-HENRY-VII-CHAPEL,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	CALL2 RT-DESCFCN-CONTEXT,CONTEXT >STACK
	ZERO? STACK /?L1
	EQUAL? CONTEXT,K-M-DESC-1 \?L3
	FSET TH-HENRY-VII-TOMB,FL-SEEN
?L3:	EQUAL? CONTEXT,K-M-DESC-1,K-M-DESC-2 \?L6
	PRINTI "You enter"
	JUMP ?L8
?L6:	PRINTI "You are in"
?L8:	PRINTI " Henry VII's chapel, which is one of the most beautiful chapels in the world. The ceiling is a masterpiece of delicate fan vaulting, and the Renaissance gilt-bronze tomb is obviously the work of one of the Italian masters."
	CRLF
	RFALSE
?L1:	EQUAL? GL-PRSA,V?LOOK-UP \FALSE
	PRINT K-BREATH-TAKING-MSG
	CRLF
	RTRUE

	.FUNCT RT-EX-ENTER-BANK-OF-ENGLAND
	LESS? CH-BANK-GUARD-AUX1,4 \?L1
	PRINTI "The guard stops you as you try to enter. ""Excuse me, sir. You can't go in there. And don't even THINK about trying to bribe me."""
	CRLF
	ICALL2 PRINT-ID,STR?279
	ICALL2 RT-THIS-IS-IT,CH-BANK-GUARD
	RFALSE
?L1:	IN? TH-BOX-KEY,TH-GUARDS-POCKET \?L3
	PRINTI "Holmes takes you to one side and whispers, ""It is obvious, dear fellow, that it would be pointless to enter the bank with no means of unlocking anything we may find inside."""
	CRLF
	RFALSE
?L3:	IN? CH-BANK-GUARD,RM-THREADNEEDLE-ST \?L5
	PRINTI "As soon as you enter, the guard leaves."
	CRLF
	CRLF
	REMOVE CH-BANK-GUARD
?L5:	RETURN RM-BANK-OF-ENGLAND

	.FUNCT RT-AC-RM-BUCKINGHAM-PALACE,CONTEXT
	ASSIGNED? 'CONTEXT /?L12
	SET 'CONTEXT,0
?L12:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L3
	EQUAL? GL-PLACE-CUR,RM-QUEENS-GARDENS \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L3:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-BUCKINGHAM-PALACE \FALSE
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE

	.FUNCT RT-EX-RM-ENTER-BUCKINGHAM-PALACE
	EQUAL? GL-PRSO,P?WEST,P?IN \FALSE
	EQUAL? GL-PLACE-CUR,RM-QUEENS-GARDENS \FALSE
	ICALL2 RT-CTHEO-PRINT,CH-PALACE-GUARD
	PRINTI " steps into your path and says, ""I'm sorry, but I've been instructed to let no one into the Palace unless I receive certain items of interest to the Crown."""
	CRLF
	ICALL2 PRINT-ID,STR?280
	RFALSE

	.FUNCT RT-EX-RM-STEER-BOAT
	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	PRINTI "[To move the boat, ROW or PADDLE in a given direction, or LAND it.]"
	CRLF
	RFALSE

	.FUNCT RT-EX-RM-LAND-BOAT
	PRINTI "[Land the Boat.]"
	CRLF
	ICALL1 RT-LAND-BOAT
	RFALSE

	.FUNCT RT-EX-RM-LAUNCH-BOAT
	IN? CH-PLAYER,TH-BOAT \?L1
	PRINTI "[Launch the Boat.]"
	CRLF
	ICALL1 RT-LAUNCH-BOAT
	RFALSE
?L1:	PRINTI "The last man who walked on water was killed by a bunch of Romans. Why don't you play it safe and use a boat?"
	CRLF
	RFALSE

	.FUNCT RT-EX-PARLOUR-ENTRY
	FSET? CH-HOLMES,FL-ASLEEP \?L1
	ICALL2 RT-CTHEO-PRINT,CH-HUDSON
	PRINT K-HUDSON-WORRIED-MSG
	CRLF
	RFALSE
?L1:	FSET? LG-PARLOUR-DOOR,FL-OPENED /?L3
	ICALL2 RT-CTHEO-PRINT,LG-PARLOUR-DOOR
	PRINTI " is closed."
	CRLF
	RFALSE
?L3:	EQUAL? GL-PRSO,P?NORTH,P?IN \FALSE
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \FALSE
	RETURN RM-PARLOUR

	.FUNCT RT-EX-LEAVE-EMBANKMENT
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L1
	PRINT K-HEAVY-ARMOUR-MSG
	CRLF
	RFALSE
?L1:	IN? GL-WINNER,TH-BOAT \?L6
	ICALL RT-PERFORM,V?EXIT,TH-BOAT
	IN? GL-WINNER,RM-THE-EMBANKMENT \FALSE
?L6:	EQUAL? GL-PRSO,P?NORTH \?L10
	EQUAL? GL-PLACE-CUR,RM-THE-EMBANKMENT \?L10
	RETURN RM-FLEET-STREET
?L10:	EQUAL? GL-PRSO,P?EAST \FALSE
	EQUAL? GL-PLACE-CUR,RM-THE-EMBANKMENT \FALSE
	RETURN RM-UPPER-THAMES-ST

	.FUNCT RT-DF-TH-ROOM,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	FSET? GL-PLACE-CUR,FL-INDOORS /?L4
	PRINTR "You're not inside a room."
?L4:	CALL1 V-LOOK >STACK
	RSTACK

	.FUNCT RT-AC-TH-NOT-HERE-OBJECT
	CALL1 RT-TH-NOT-HERE-OBJECT >STACK
	RSTACK

	.FUNCT RT-AC-TH-INTDIR
	EQUAL? GL-PRSA,V?SHOOT \?L1
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK
?L1:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT RT-AC-TH-TIME,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	EQUAL? CONTEXT,K-M-SDESC \?L1
	GETP TH-TIME,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?MINUTE,W?MINUTES \?L3
	PRINTI "minute"
	RTRUE
?L3:	PRINTI "hour"
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \?L7
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L7:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L8
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L8:	GET GL-SEE-VERBS,0 >STACK
	INTBL? GL-PRSA,GL-SEE-VERBS+2,STACK >STACK \FALSE
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT RT-AC-TH-HANDS
	ZERO? GL-NOW-PRSI? \?L28
	ZERO? GL-PRSI \?L3
	EQUAL? GL-PRSA,V?TAKE,V?TAKE-OFF \?L3
	FSET? TH-HANDS,FL-LOCKED \?L3
	FCLEAR TH-HANDS,FL-LOCKED
	ICALL RT-CYOU-MSG,STR?228,STR?227
	SET 'HEARD-SWING?,0
	ICALL2 RT-THEO-PRINT,TH-HANDS
	PRINTI " off of "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L3:	EQUAL? GL-PRSI,TH-EARS \FALSE
	EQUAL? GL-PRSA,V?TAKE \?L6
	FSET? TH-HANDS,FL-LOCKED /?L8
	PRINTI "Your hands are not on "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L8:	FCLEAR TH-HANDS,FL-LOCKED
	ICALL RT-CYOU-MSG,STR?228,STR?227
	SET 'HEARD-SWING?,0
	ICALL2 RT-THEO-PRINT,TH-HANDS
	PRINTI " off of "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L6:	EQUAL? GL-PRSA,V?PUT-ON \FALSE
	FSET? TH-HANDS,FL-LOCKED \?L12
	PRINTI "Your hands are already on "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L12:	FSET TH-HANDS,FL-LOCKED
	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL2 RT-THEO-PRINT,TH-HANDS
	PRINTI " on "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L28:	EQUAL? GL-PRSO,TH-EARS \FALSE
	EQUAL? GL-PRSA,V?COVER \FALSE
	FSET? TH-HANDS,FL-LOCKED \?L22
	PRINTI "Your hands are already on "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L22:	FSET TH-HANDS,FL-LOCKED
	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL2 RT-THEO-PRINT,TH-HANDS
	PRINTI " on "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."

	.FUNCT RT-AC-TH-WATSONS-HEART
	EQUAL? GL-PRSA,V?LISTEN \FALSE
	FSET? TH-COTTON-BALLS,FL-WORN \?L3
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot hear a thing with "
	ICALL2 RT-THEO-PRINT,TH-COTTON-BALLS
	PRINTI " in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	JUMP ?L12
?L3:	FSET? TH-STETHOSCOPE,FL-WORN \?L5
	EQUAL? GL-PLACE-CUR,RM-BAR-OF-GOLD,RM-LAIR,RM-SWAN-LANE \?L6
	PUSH 8
	JUMP ?L8
?L6:	PUSH 6
?L8:	IXCALL SOUNDS,S-HEART2,S-START,STACK,8
	PRINTI "Your heart is beating "
	EQUAL? GL-PLACE-CUR,RM-BAR-OF-GOLD,RM-LAIR,RM-SWAN-LANE \?L9
	PRINTI "so loudly you're surprised everyone can't hear it"
	JUMP ?L12
?L9:	PRINTI "normally"
	JUMP ?L12
?L5:	ICALL1 RT-CYOU-MSG
	PRINTI "should wear the stethoscope, first"
?L12:	PRINTR "."

	.FUNCT RT-AC-TH-EARS
	ZERO? GL-NOW-PRSI? /?L30
	EQUAL? GL-PRSA,V?PUT \?L3
	EQUAL? GL-PRSO,TH-HANDS,TH-STETHOSCOPE /FALSE
	EQUAL? GL-PRSO,TH-COTTON-BALLS \?L7
	FSET? GL-PRSO,FL-WORN \?L8
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-IS-ARE-MSG
	PRINTI "already in "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L8:	FSET? TH-STETHOSCOPE,FL-WORN \?L10
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?281,TH-STETHOSCOPE
	PRINTR " first."
?L10:	SET 'GL-LISTEN-OBJ,0
	FSET TH-COTTON-BALLS,FL-WORN
	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	PRINTI " in "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L7:	PRINTI "You cannot put that in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L3:	EQUAL? GL-PRSA,V?TAKE \?L13
	EQUAL? GL-PRSO,TH-HANDS,TH-STETHOSCOPE /FALSE
	EQUAL? GL-PRSO,TH-COTTON-BALLS \FALSE
	SET 'GL-LISTEN-OBJ,0
	FCLEAR TH-COTTON-BALLS,FL-WORN
	PRINTR "You take the cotton balls out of your ears."
?L13:	EQUAL? GL-PRSA,V?EMPTY,V?EMPTY-INTO \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot empty anything into "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L30:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?LOOK-ON,V?EXAMINE \?L21
	PRINT K-EYES-HINGED-MSG
	CRLF
	RTRUE
?L21:	EQUAL? GL-PRSA,V?REACH-IN,V?SEARCH \FALSE
	FSET? TH-STETHOSCOPE,FL-WORN \?L24
	ICALL RT-CYOU-MSG,STR?283,STR?282
	ICALL2 RT-THEO-PRINT,TH-STETHOSCOPE
	PRINTR "."
?L24:	FSET? TH-COTTON-BALLS,FL-WORN \FALSE
	ICALL RT-CYOU-MSG,STR?283,STR?282
	ICALL2 RT-THEO-PRINT,TH-COTTON-BALLS
	PRINTR "."

	.FUNCT RT-AC-TH-HEAD
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?TOUCH,V?SEARCH \?L4
	FSET? TH-WATSONS-HAT,FL-WORN \?L4
	PRINTI "You are wearing "
	ICALL2 RT-THEO-PRINT,TH-WATSONS-HAT
	PRINTR "."
?L4:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \FALSE
	PRINT K-EYES-HINGED-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-BREATH
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-INSIDE,V?SEARCH \?L4
	PRINTI "It is not cold enough to see "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L4:	EQUAL? GL-PRSA,V?SMELL \?L6
	PRINTR "It smells no worse than usual."
?L6:	EQUAL? GL-PRSA,V?RELEASE \?L7
	CALL1 V-EXHALE >STACK
	RSTACK
?L7:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINTR "It's bad, but it doesn't deserve to die."

	.FUNCT RT-AC-TH-CLOTHES
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L1
	ICALL RT-PERFORM,V?LOOK-INSIDE,TH-POCKET
	RTRUE
?L1:	EQUAL? GL-PRSA,V?PUT \?L3
	EQUAL? GL-PRSI,TH-CLOTHES \?L3
	PRINTI "[in "
	ICALL2 RT-THEO-PRINT,TH-POCKET
	PRINTI "]"
	CRLF
	ICALL RT-PERFORM,V?PUT,GL-PRSO,TH-POCKET
	RTRUE
?L3:	EQUAL? GL-PRSA,V?WEAR \?L4
	PRINTR "You are already wearing them."
?L4:	EQUAL? GL-PRSA,V?TAKE-OFF,V?DROP,V?RAISE \FALSE
	PRINT K-INAPPROPRIATE-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-WATERMARK,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	CALL2 RT-VISIBLE?,TH-GREEN-PAPER >STACK
	ZERO? STACK \FALSE
	CALL2 RT-VISIBLE?,TH-WHITE-PAPER >STACK
	ZERO? STACK \FALSE
	CALL2 RT-VISIBLE?,TH-BLUE-PAPER >STACK
	ZERO? STACK \FALSE
	CALL2 RT-VISIBLE?,TH-ORANGE-PAPER >STACK
	ZERO? STACK \FALSE
	CALL2 RT-VISIBLE?,TH-YELLOW-PAPER >STACK
	ZERO? STACK \FALSE
	CALL2 RT-VISIBLE?,TH-BROWN-PAPER >STACK
	ZERO? STACK \FALSE
	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTI "not see any "
	ICALL2 DPRINT,TH-WATERMARK
	PRINTR "here."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-VISIBLE?,TH-GREEN-PAPER >STACK
	ZERO? STACK \?L9
	CALL2 RT-VISIBLE?,TH-WHITE-PAPER >STACK
	ZERO? STACK \?L9
	CALL2 RT-VISIBLE?,TH-BLUE-PAPER >STACK
	ZERO? STACK \?L9
	CALL2 RT-VISIBLE?,TH-ORANGE-PAPER >STACK
	ZERO? STACK \?L9
	CALL2 RT-VISIBLE?,TH-YELLOW-PAPER >STACK
	ZERO? STACK \?L9
	CALL2 RT-VISIBLE?,TH-BROWN-PAPER >STACK
	ZERO? STACK /?L8
?L9:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK
?L8:	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTI "not see any "
	ICALL2 DPRINT,TH-WATERMARK
	PRINTR " here."

	.FUNCT RT-AC-TH-SESAME
	EQUAL? GL-PRSA,V?OPEN \?L1
	PRINTR "Ali Baba you're not."
?L1:	CALL1 RT-TALK-VERB? >STACK
	ZERO? STACK \FALSE
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT RT-AC-TH-RIGHT
	ZERO? GL-NOW-PRSI? \FALSE
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L3
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L3:	GET GL-SEE-VERBS,0 >STACK
	INTBL? GL-PRSA,GL-SEE-VERBS+2,STACK >STACK \?L5
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L5:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-LEFT
	ZERO? GL-NOW-PRSI? \FALSE
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L3
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L3:	GET GL-SEE-VERBS,0 >STACK
	INTBL? GL-PRSA,GL-SEE-VERBS+2,STACK >STACK \?L5
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L5:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-BULLET-HOLE,NUM,OFF,HOLE,PLACE
	SET 'NUM,0
	SET 'HOLE,0
?L1:	MUL NUM,2 >OFF
	GET GL-HOLES,0 >STACK
	EQUAL? NUM,STACK /?L2
	ADD OFF,1 >STACK
	GET GL-HOLES,STACK >STACK
	CALL2 RT-VISIBLE?,STACK >STACK
	ZERO? STACK /?L6
	ADD OFF,2 >STACK
	GET GL-HOLES,STACK >PLACE
	ZERO? PLACE /?L8
	EQUAL? GL-PLACE-CUR,PLACE \?L6
?L8:	SET 'HOLE,1
	JUMP ?L2
?L6:	INC 'NUM
	JUMP ?L1
?L2:	ZERO? HOLE \?L11
	CALL2 RT-CANT-SEE-ANY-MSG,TH-BULLET-HOLE >STACK
	RSTACK
?L11:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-ANNIE-OAKELEY-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-GENERIC-BODY,CONTEXT,CLASS,ADJ,S1,S2,WHICH
	ASSIGNED? 'CONTEXT /?L33
	SET 'CONTEXT,0
?L33:	ASSIGNED? 'CLASS /?L34
	SET 'CLASS,0
?L34:	SET 'WHICH,CH-PLAYER
	GETP TH-GENERIC-BODY,P?OBJ-ADJ >ADJ
	EQUAL? ADJ,W?WIGGINS$0027 \?L1
	SET 'WHICH,CH-WIGGINS
	JUMP ?L15
?L1:	EQUAL? ADJ,W?HOLMES$0027,W?HOLMES$0027S \?L3
	SET 'WHICH,CH-HOLMES
	JUMP ?L15
?L3:	EQUAL? ADJ,W?HUDSON$0027S \?L4
	SET 'WHICH,CH-HUDSON
	JUMP ?L15
?L4:	EQUAL? ADJ,W?ELIZA$0027S,W?GIRL$0027S \?L5
	SET 'WHICH,CH-ELIZA-DOOLITTLE
	JUMP ?L15
?L5:	EQUAL? ADJ,W?HER \?L6
	CALL2 RT-VISIBLE?,CH-HUDSON >STACK
	ZERO? STACK /?L7
	SET 'WHICH,CH-HUDSON
	JUMP ?L15
?L7:	SET 'WHICH,CH-ELIZA-DOOLITTLE
	JUMP ?L15
?L6:	EQUAL? ADJ,W?LEFT,W?RIGHT \?L15
	CALL2 RT-VISIBLE?,CH-WIGGINS >STACK
	ZERO? STACK /?L11
	SET 'WHICH,CH-WIGGINS
	JUMP ?L15
?L11:	CALL2 RT-VISIBLE?,CH-HOLMES >STACK
	ZERO? STACK /?L13
	SET 'WHICH,CH-HOLMES
	JUMP ?L15
?L13:	CALL2 RT-VISIBLE?,CH-HUDSON >STACK
	ZERO? STACK /?L14
	SET 'WHICH,CH-HUDSON
	JUMP ?L15
?L14:	CALL2 RT-VISIBLE?,CH-ELIZA-DOOLITTLE >STACK
	ZERO? STACK /?L15
	SET 'WHICH,CH-ELIZA-DOOLITTLE
?L15:	EQUAL? WHICH,CH-WIGGINS \?L18
	SET 'S1,STR?284
	SET 'S2,STR?285
	JUMP ?L23
?L18:	EQUAL? WHICH,CH-HOLMES \?L20
	SET 'S1,STR?286
	SET 'S2,STR?287
	JUMP ?L23
?L20:	EQUAL? WHICH,CH-HUDSON \?L21
	SET 'S1,STR?288
	SET 'S2,STR?289
	JUMP ?L23
?L21:	EQUAL? WHICH,CH-ELIZA-DOOLITTLE \?L22
	SET 'S1,STR?290
	SET 'S2,STR?291
	JUMP ?L23
?L22:	EQUAL? WHICH,CH-PLAYER \?L23
	SET 'S1,STR?292
	SET 'S2,STR?293
?L23:	EQUAL? CONTEXT,K-M-SDESC \?L25
	PRINT S1
	RTRUE
?L25:	ZERO? CONTEXT \FALSE
	CALL2 RT-VISIBLE?,WHICH >STACK
	ZERO? STACK \?L29
	ICALL RT-CANT-SEE-ANY-MSG,0,S1,1
	RETURN 2
?L29:	EQUAL? WHICH,CH-ELIZA-DOOLITTLE \?L31
	PRINTI "[You do not need to refer to"
	ICALL RT-CLAUSE-PRINT,K-P-NC1,K-P-NC1L
	PRINTI ".]"
	CRLF
	RETURN 2
?L31:	PRINTI "[You do not need to refer to any part of "
	PRINT S2
	PRINTI " body.]"
	CRLF
	RETURN 2

	.FUNCT RT-AC-TH-POCKET
	EQUAL? GL-PRSA,V?PUT \FALSE
	ZERO? GL-NOW-PRSI? /FALSE
	EQUAL? GL-PRSO,TH-PADDLE,TH-MACE,TH-ANCHOR /?L3
	EQUAL? GL-PRSO,TH-LAMP,TH-VIOLIN,TH-PACKET-OF-PAPER /?L3
	EQUAL? GL-PRSO,TH-SUIT-OF-ARMOUR,TH-OAR-1,TH-OAR-2 /?L3
	EQUAL? GL-PRSO,TH-TORCH,TH-WAX-AX,TH-WAX-HEAD \FALSE
?L3:	CALL2 RT-CANT-PUT-IN-ON-MSG,TH-POCKET >STACK
	RSTACK

	.FUNCT RT-AC-TH-GUN,CONTEXT
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The gun is a six-shot revolver."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?OPEN,V?LOOK-INSIDE,V?SEARCH \FALSE
	PRINTR "The gun is jammed shut. You can't open it."

	.FUNCT RT-AC-TH-KNIFE,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's a nasty-looking jackknife."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?CUT \?L4
	FSET? TH-KNIFE,FL-OPENED /FALSE
	ICALL2 RT-CTHEO-PRINT,TH-KNIFE
	PRINTR " isn't open."
?L4:	EQUAL? GL-PRSA,V?TAKE \FALSE
	SET 'KNIFE-COLD?,0
	RFALSE

	.FUNCT RT-AC-TH-MAGNIFYING-GLASS,CONTEXT
	ASSIGNED? 'CONTEXT /?L26
	SET 'CONTEXT,0
?L26:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It is of Swiss manufacture, with a precision-ground lens."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSO,TH-SAPPHIRE,TH-EMERALD,TH-OPAL /FALSE
	EQUAL? GL-PRSO,TH-RUBY,TH-TOPAZ,TH-GARNET /FALSE
	EQUAL? GL-PRSO,TH-WESTMINSTER-CLUE,TH-JEWEL-CASE /FALSE
	SET 'GL-P-IT-OBJECT,TH-MAGNIFYING-GLASS
	ZERO? GL-NOW-PRSI? /?L7
	EQUAL? GL-PRSA,V?LOOK-THRU \FALSE
	IN? GL-PRSI,CH-PLAYER /?L11
	ICALL RT-YOUD-HAVE-TO-MSG,STR?294,GL-PRSI
	RTRUE
?L11:	EQUAL? GL-PRSO,TH-MAGNIFYING-GLASS \?L13
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L13:	EQUAL? GL-LASTFOC,GL-PRSO /?L14
	SET 'GL-LASTFOC,GL-PRSO
	PRINTI "You train the magnifying glass on "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
?L14:	FSET? GL-PRSO,FL-PLURAL \?L16
	FSET? GL-PRSO,FL-COLLECTIVE /?L16
	PRINTI "They appear "
	JUMP ?L20
?L16:	FSET? GL-PRSO,FL-PERSON \?L19
	FSET? GL-PRSO,FL-FEMALE \?L18
	PRINTI "She appears "
	JUMP ?L20
?L18:	FSET? GL-PRSO,FL-PERSON \?L19
	FSET? GL-PRSO,FL-FEMALE /?L19
	PRINTI "He appears "
	JUMP ?L20
?L19:	PRINTI "It appears "
?L20:	PRINTR "much larger now."
?L7:	EQUAL? GL-PRSA,V?SHOOT \?L22
	ICALL1 RT-CTHEO-PRINT
	PRINT K-SHATTER-MSG
	CRLF
	CALL2 PRINT-ID,STR?295 >STACK
	RSTACK
?L22:	EQUAL? GL-PRSA,V?LOOK-INSIDE \?L23
	PRINTR "Everything appears much larger."
?L23:	EQUAL? GL-PRSA,V?ADJUST,V?PLAY \FALSE
	PRINTR "You cannot adjust a magnifying glass."

	.FUNCT RT-AC-TH-VIOLIN,CONTEXT,WHO
	ASSIGNED? 'CONTEXT /?L18
	SET 'CONTEXT,0
?L18:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It is a Stradivarius violin of exceptional quality."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?PLAY \FALSE
	IN? TH-VIOLIN,GL-WINNER /?L5
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L5:	ICALL2 SOUNDS,S-BADVIOL
	IN? TH-PHIAL,CH-HOLMES \?L8
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \?L8
	PRINTI "Even the grotesque noises"
	ICALL RT-YOU-MSG,STR?297,STR?296
	PRINTR "with the violin aren't enough to distract Holmes's attention from the phial."
?L8:	CALL1 RT-ANYONE-HERE? >WHO
	ZERO? WHO /?L11
	FSET WHO,FL-ASLEEP
	CALL1 RT-ANYONE-HERE? >STACK
	ZERO? STACK /?L13
	PRINTI "Everyone"
	JUMP ?L15
?L13:	ICALL2 RT-CTHEO-PRINT,WHO
?L15:	FCLEAR WHO,FL-ASLEEP
	PRINTI " grimace"
	ICALL2 RT-S-NOS-MSG,WHO
	PRINTI " in pain and glare"
	ICALL2 PRINT-ID,STR?298
	ICALL2 RT-S-NOS-MSG,WHO
	PRINTR " at you."
?L11:	PRINTR "Even you cannot abide the grotesque screeches that emanate from the tortured instrument, so you quickly stop."

	.FUNCT RT-AC-TH-PHIAL,HITS
	EQUAL? GL-PRSA,V?SHOOT \?L1
	SET 'HITS,TH-PHIAL-AUX1
	ADD 1,HITS >TH-PHIAL-AUX1
	ZERO? HITS \?L3
	PRINTI "Nice shot! The phial explodes. You hear a muffled scream from downstairs as Mrs Hudson lets out a shriek."
	CRLF
	CRLF
	PRINT K-HOLMES-LICKS-MSG
	PRINTI "eyes begin to cloud over from the small dose you have caused him to take."
	CRLF
	CRLF
	PRINT K-ANOTHER-PHIAL-MSG
	CRLF
	ICALL2 PRINT-ID,STR?299
	RTRUE
?L3:	EQUAL? 1,HITS \?L5
	PRINTI "The phial explodes. From downstairs you hear a dull thud as Mrs Hudson faints and hits the floor."
	CRLF
	CRLF
	PRINT K-HOLMES-LICKS-MSG
	PRINTI "body stiffens as the increased dosage of the drug enters his system."
	CRLF
	CRLF
	PRINT K-ANOTHER-PHIAL-MSG
	CRLF
	CRLF
	PRINTI "As a doctor, you know that another dose may be fatal."
	CRLF
	ICALL2 PRINT-ID,STR?300
	RTRUE
?L5:	EQUAL? 2,HITS \FALSE
	PRINTI "That persistent, are you? Too bad. The chill you caught from the damp air outside causes you to sneeze just as you pull the trigger. You have shot and killed Sherlock Holmes."
	CRLF
	CRLF
	PRINTI "Inspector Lestrade appears at the door and says,"
	PRINT K-PLUG-HIM-MYSELF-MSG
	CRLF
	CRLF
	PRINT K-LESTRADE-ARRESTS-MSG
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?301
	ICALL1 RT-QSR
	RFALSE
?L1:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	ICALL2 RT-HOLMES-HITS,TH-PHIAL
	RTRUE

	.FUNCT RT-HOLMES-HITS,THING
	PRINTI "Holmes is faster than you are. He moves "
	ICALL2 RT-THEO-PRINT,THING
	PRINTI " beyond your reach and absentmindedly hits you on the head with his free hand."
	CRLF
	CRLF
	PRINTI "Holmes continues staring at the phial."
	CRLF
	CALL2 PRINT-ID,STR?302 >STACK
	RSTACK

	.FUNCT RT-AC-TH-GREEN-PAPER
	CALL2 RT-PROCESS-PAPER,TH-GREEN-PAPER >STACK
	RSTACK

	.FUNCT RT-AC-TH-WHITE-PAPER
	CALL2 RT-PROCESS-PAPER,TH-WHITE-PAPER >STACK
	RSTACK

	.FUNCT RT-AC-TH-BLUE-PAPER
	CALL2 RT-PROCESS-PAPER,TH-BLUE-PAPER >STACK
	RSTACK

	.FUNCT RT-AC-TH-ORANGE-PAPER
	CALL2 RT-PROCESS-PAPER,TH-ORANGE-PAPER >STACK
	RSTACK

	.FUNCT RT-AC-TH-YELLOW-PAPER
	CALL2 RT-PROCESS-PAPER,TH-YELLOW-PAPER >STACK
	RSTACK

	.FUNCT RT-AC-TH-BROWN-PAPER
	CALL2 RT-PROCESS-PAPER,TH-BROWN-PAPER >STACK
	RSTACK

	.FUNCT RT-AC-TH-ELIZABETH-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The tomb is that of Elizabeth and her half-sister, Mary Tudor. It is surrounded by twelve black marble pillars, and on the base is an inscription."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,1 >STACK
	RSTACK

	.FUNCT RT-AC-TH-NEWTON-TOMB,CONTEXT,CLASS,WRD
	ASSIGNED? 'CONTEXT /?L23
	SET 'CONTEXT,0
?L23:	ASSIGNED? 'CLASS /?L24
	SET 'CLASS,0
?L24:	GETP TH-NEWTON-TOMB,P?OBJ-NOUN >WRD
	EQUAL? WRD,W?STATUE \?L1
	EQUAL? CONTEXT,K-M-SDESC \?L3
	XCALL PRINT-SDESC,STR?303,CLASS,0,0 >STACK
	RSTACK
?L3:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "The great mathematician is shown reclining in a pensive mood."
?L1:	EQUAL? WRD,W?CHERUB,W?ANGEL,W?CHERUBS /?L8
	EQUAL? WRD,W?ANGELS \?L7
?L8:	EQUAL? CONTEXT,K-M-SDESC \?L9
	XCALL PRINT-SDESC,STR?304,CLASS,0,1 >STACK
	RSTACK
?L9:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "Cute, aren't they?"
?L7:	EQUAL? WRD,W?DIAGRAM,W?SYSTEM \?L13
	EQUAL? CONTEXT,K-M-SDESC \FALSE
	XCALL PRINT-SDESC,STR?305,CLASS,0,0 >STACK
	RSTACK
?L13:	EQUAL? CONTEXT,K-M-SDESC \?L18
	XCALL PRINT-SDESC,STR?306,CLASS,1,0 >STACK
	RSTACK
?L18:	EQUAL? CONTEXT,K-M-DESCFCN \?L20
	PRINTR "It's a white marble sarcophagus with ""ISAACVS NEWTON   Eques Auratus"" written on the front. Above it is a marble statue of Newton, and a carving of two cherubs who are holding a diagram of the solar system."
?L20:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,2 >STACK
	RSTACK

	.FUNCT PRINT-SDESC,BASE,CLASS,NOART?,PLURAL?,VOWEL?,PRINTB?,IS
	ASSIGNED? 'VOWEL? /?L19
	SET 'VOWEL?,0
?L19:	ASSIGNED? 'PRINTB? /?L20
	SET 'PRINTB?,0
?L20:	SET 'IS,0
	ZERO? NOART? \?L1
	EQUAL? CLASS,K-DESC-ANY \?L3
	SET 'IS,STR?307
	JUMP ?L11
?L3:	EQUAL? CLASS,K-DESC-THE /?L6
	ZERO? PLURAL? /?L7
?L6:	SET 'IS,STR?308
	JUMP ?L11
?L7:	ZERO? VOWEL? /?L9
	SET 'IS,STR?310
	JUMP ?L11
?L9:	SET 'IS,STR?311
?L11:	ZERO? IS /?L12
	PRINT IS
?L12:	PRINTC 32
?L1:	ZERO? PRINTB? /?L16
	PRINTB BASE
	RTRUE
?L16:	PRINT BASE
	RTRUE

	.FUNCT RT-AC-TH-HENRY-V-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's an old wooden coffin on a raised platform. On the top is an effigy of Henry V, and there is an inscription carved into the side."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,3 >STACK
	RSTACK

	.FUNCT RT-AC-TH-EDWARD-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's the tomb of Edward the Confessor, the founder of Westminster Abbey, and the only English king ever to be canonized. Around the tomb is a frieze that shows scenes from Edward's life, and on the base there is a faded inscription."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,4 >STACK
	RSTACK

	.FUNCT RT-AC-TH-POPE-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINT K-SIMPLE-TOMB-MSG
	CRLF
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,5 >STACK
	RSTACK

	.FUNCT RT-AC-TH-DICKENS-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINT K-SIMPLE-TOMB-MSG
	CRLF
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,6 >STACK
	RSTACK

	.FUNCT RT-AC-TH-CHAUCER-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's the tomb of Geoffrey Chaucer, who died in 1400 and became the first person to be buried in Poet's Corner. The inscription above the sarcophagus is so faded that it is almost illegible."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,7 >STACK
	RSTACK

	.FUNCT RT-AC-TH-ANNE-OF-CLEVES-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINT K-SIMPLE-TOMB-MSG
	CRLF
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,8 >STACK
	RSTACK

	.FUNCT RT-AC-TH-LITTLE-PRINCES-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "According to the inscription, the urn contains the remains of the Little Princes in the Tower."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,9 >STACK
	RSTACK

	.FUNCT RT-AC-TH-MARY-QUEEN-OF-SCOTS-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The tomb is a simple sarcophagus with a marble effigy of Mary, Queen of Scots on it."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,10 >STACK
	RSTACK

	.FUNCT RT-AC-TH-HENRY-VII-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's an incredibly lavish tomb which is surmounted by gilt effigies of Henry VII and his wife Elizabeth of York."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,11 >STACK
	RSTACK

	.FUNCT RT-AC-TH-PITT-TOMB,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTI "It's a huge monument to William Pitt. On the base of the monument are five "
	ICALL2 DPRINT,TH-FIGURES
	PRINTR " and an elaborate inscription."
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,12 >STACK
	RSTACK

	.FUNCT RT-AC-TH-FIGURES,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "You've never understood allegorical figures before. What makes you think you can start now?"

	.FUNCT RT-AC-TH-VERE-TOMB,CONTEXT,CLASS,CAP?,WRD
	ASSIGNED? 'CONTEXT /?L16
	SET 'CONTEXT,0
?L16:	ASSIGNED? 'CLASS /?L17
	SET 'CLASS,0
?L17:	ASSIGNED? 'CAP? /?L18
	SET 'CAP?,0
?L18:	GETP TH-VERE-TOMB,P?OBJ-NOUN >WRD
	EQUAL? WRD,W?KNIGHT,W?KNIGHTS \?L1
	EQUAL? CONTEXT,K-M-SDESC \FALSE
	XCALL PRINT-SDESC,STR?312,CLASS,0,1 >STACK
	RSTACK
?L1:	EQUAL? WRD,W?SUIT,W?ARMOUR,W?ARMOR \?L6
	EQUAL? CONTEXT,K-M-SDESC \?L7
	XCALL PRINT-SDESC,STR?313,CLASS,0,0,1 >STACK
	RSTACK
?L7:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?314 >STACK
	RSTACK
?L6:	EQUAL? CONTEXT,K-M-SDESC \?L12
	XCALL PRINT-SDESC,STR?315,CLASS,1,0 >STACK
	RSTACK
?L12:	EQUAL? CONTEXT,K-M-DESCFCN \?L13
	PRINTR "It's an effigy of a man surrounded by four knights, who are holding up a marble slab on their shoulders. On the slab is the dead man's armour."
?L13:	ZERO? CONTEXT \FALSE
	CALL2 RT-PROCESS-TOMB,13 >STACK
	RSTACK

	.FUNCT RT-AC-TH-LAMP,CONTEXT
	ASSIGNED? 'CONTEXT /?L36
	SET 'CONTEXT,0
?L36:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It is a battered old brass lamp that has accompanied you on many adventures in the past."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? /?L4
	EQUAL? GL-PRSA,V?THROW \?L5
	CALL2 GET-MASS,GL-PRSO >STACK
	GRTR? STACK,5 \FALSE
	ICALL1 RT-BREAK-LAMP
	CRLF
	ICALL1 RT-CTHEO-PRINT
	PRINTI " "
	ICALL1 RT-LANDS-AT-YOUR-FEET-MSG
	RTRUE
?L5:	EQUAL? GL-PRSA,V?PUT \FALSE
	CALL1 RT-LAMP-SEALED >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?SHOOT,V?KICK,V?MUNG \?L13
	CALL1 RT-BREAK-LAMP >STACK
	RSTACK
?L13:	EQUAL? GL-PRSA,V?OPEN,V?CLOSE,V?OPEN-WITH /?L16
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH,V?REACH-IN /?L16
	EQUAL? GL-PRSA,V?EMPTY,V?EMPTY-INTO \?L15
?L16:	CALL1 RT-LAMP-SEALED >STACK
	RSTACK
?L15:	EQUAL? GL-PRSA,V?LAMP-ON,V?LIGHT-WITH,V?TURN-UP /?L18
	EQUAL? GL-PRSA,V?LIGHT \?L17
?L18:	FSET? TH-LAMP,FL-BROKEN \?L19
	FCLEAR TH-LAMP,FL-ASLEEP
	PRINTR "Nothing happens."
?L19:	FSET? TH-LAMP,FL-ASLEEP /?L21
	ICALL2 RT-CTHEO-PRINT,TH-LAMP
	PRINTR " is already on."
?L21:	FCLEAR TH-LAMP,FL-ASLEEP
	FSET TH-LAMP,FL-LIGHTED
	PRINTI "You turn up the wick. "
	ICALL2 RT-CTHEO-PRINT,TH-LAMP
	PRINTR " emits a warm glow that lights up the area around you."
?L17:	EQUAL? GL-PRSA,V?LAMP-OFF,V?TURN-DOWN \?L23
	FSET? TH-LAMP,FL-ASLEEP \?L24
	ICALL2 RT-CTHEO-PRINT,TH-LAMP
	PRINTR " is already off."
?L24:	FSET? TH-LAMP,FL-BROKEN \?L26
	FSET TH-LAMP,FL-ASLEEP
	PRINTR "Nothing happens."
?L26:	FSET TH-LAMP,FL-ASLEEP
	FCLEAR TH-LAMP,FL-LIGHTED
	PRINTI "You turn down the wick. "
	ICALL2 RT-CTHEO-PRINT,TH-LAMP
	PRINTR " goes dark."
?L23:	EQUAL? GL-PRSA,V?POINT-AT,V?SHINE-AT \FALSE
	FSET? TH-LAMP,FL-LIGHTED \?L29
	EQUAL? GL-PRSO,GL-PRSI \?L31
	ICALL1 RT-CYOU-MSG
	PRINTR "can't point the light at itself."
?L31:	PRINTI "You point "
	ICALL2 RT-THEO-PRINT,TH-LAMP
	PRINTI " at "
	ICALL1 RT-THEI-PRINT
	PRINTR ", but it reveals nothing."
?L29:	ICALL2 RT-CTHEO-PRINT,TH-LAMP
	PRINTR " is not on."

	.FUNCT RT-LAMP-SEALED
	ICALL2 RT-CTHEO-PRINT,TH-LAMP
	PRINTR " is firmly sealed. It can neither be opened nor closed."

	.FUNCT RT-BREAK-LAMP
	FSET? TH-LAMP,FL-BROKEN /?L1
	FSET TH-LAMP,FL-BROKEN
	PRINTI "It sounds as if something in "
	ICALL2 RT-THEO-PRINT,TH-LAMP
	PRINTI " has shattered."
	ICALL2 PRINT-ID,STR?316
	FSET? TH-LAMP,FL-LIGHTED \?L3
	FCLEAR TH-LAMP,FL-LIGHTED
	PRINTI " "
	ICALL2 RT-CTHEO-PRINT,TH-LAMP
	PRINTI " has gone out."
?L3:	CRLF
	RTRUE
?L1:	ICALL2 RT-CTHEO-PRINT,TH-LAMP
	PRINTR " is already broken."

	.FUNCT RT-AC-TH-BLACK-BAG,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's the black medical bag your aunt gave you when you graduated from medical school."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?PUT \FALSE
	ZERO? GL-NOW-PRSI? /FALSE
	EQUAL? GL-PRSO,TH-PADDLE,TH-MACE,TH-ANCHOR /?L5
	EQUAL? GL-PRSO,TH-PACKET-OF-PAPER,TH-SUIT-OF-ARMOUR,TH-OAR-1 /?L5
	EQUAL? GL-PRSO,TH-OAR-2,TH-TORCH,TH-WAX-AX /?L5
	EQUAL? GL-PRSO,TH-LAMP,TH-VIOLIN,TH-WAX-HEAD \FALSE
?L5:	PRINTI "You look at "
	ICALL1 RT-THEO-PRINT
	PRINTI ". You look at the tiny bag. You look at the tiny bag. You look at "
	ICALL1 RT-THEO-PRINT
	PRINTR ". Slowly it dawns on you that it's just not going to work."

	.FUNCT RT-AC-TH-CHARLES-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	FSET TH-WAX-AX,FL-SEEN
	IN? TH-WAX-HEAD,TH-CHARLES-STATUE \?L4
	PRINTI "Charles I is shown kneeling, with his head resting on a chopping block. Above him stands a masked executioner"
	IN? TH-WAX-AX,TH-CHARLES-STATUE \?L6
	PRINTI ", with his axe held high over his head, ready to strike the deathblow"
?L6:	PRINTR "."
?L4:	PRINTR "The statue looks grotesque without the head."

	.FUNCT RT-AC-TH-WILLIAM-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "The statue is of William the Conqueror kneeling on the sand at Pevensey, where he landed before the Battle of Hastings in 1066."

	.FUNCT RT-AC-TH-WALTER-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "The sculpture shows Sir Walter Raleigh spreading his cloak across a mud puddle so Elizabeth could walk across without dirtying her shoes."

	.FUNCT RT-AC-TH-ELIZABETH-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "She is smiling at Sir Walter."

	.FUNCT RT-AC-TH-THOMAS-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "The sculpture shows four knights with swords drawn, advancing on Thomas Becket as he stands before the High Altar of Canterbury Cathedral."

	.FUNCT RT-AC-TH-DRAKE-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "The statue is of Sir Francis Drake finishing his game of bowls before sailing off to defeat the Spanish Armada."

	.FUNCT RT-AC-TH-JOHN-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "King John is depicted signing the Magna Carta in the meadow at Runnymede in June of 1215."

	.FUNCT RT-AC-TH-FAWKES-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTI "The statue depicts Guy Fawkes crouched behind some barrels of gunpowder. He is awaiting the signal to light his torch and set off the trail of gunpowder that will blow up Parliament"
	IN? TH-TORCH,TH-FAWKES-STATUE \?L4
	PRINTI ". The torch he holds looks like a real one"
	JUMP ?L6
?L4:	PRINTI " - but he seems to be missing the torch"
?L6:	PRINTR "."

	.FUNCT RT-AC-TH-NELSON-COLUMN,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTI "The column has"
	PRINT K-NELSON-STATUE-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-BOAT,CONTEXT,NUM
	ASSIGNED? 'CONTEXT /?L63
	SET 'CONTEXT,0
?L63:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTI "It's an incredibly old rowboat that "
	IN? TH-OAR-1,TH-BOAT \?L3
	IN? TH-OAR-2,TH-OAR-LOCK /?L3
	PRINTI "has one empty oarlock and "
?L3:	PRINTI "probably leaks. But it looks as if it might float"
	IN? TH-BOAT,RM-THE-EMBANKMENT /?L6
	IN? TH-BOAT,RM-OUTSIDE-TRAITORS-GATE /?L6
	PRINTI " a little while longer"
?L6:	PRINTI ". The boat's anchor is in the "
	IN? TH-ANCHOR,TH-BOAT \?L9
	PRINTI "boat"
	JUMP ?L11
?L9:	PRINTI "water"
?L11:	PRINTI "."
	CRLF
	RETURN 2
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?PUSH-TO \?L13
	EQUAL? GL-PRSI,LG-WATER \?L13
	ICALL1 RT-LAUNCH-BOAT
	RTRUE
?L13:	EQUAL? GL-PRSA,V?ENTER \?L14
	EQUAL? GL-PRSO,ROOMS,TH-BOAT \?L14
	IN? CH-PLAYER,TH-BOAT /FALSE
	ZERO? GL-PUPPY /?L17
	EQUAL? GL-WINNER,CH-PLAYER \?L17
	MOVE GL-PUPPY,TH-BOAT
	PRINTI "You and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L19
?L17:	ICALL RT-CYOU-MSG,STR?318,STR?317
?L19:	PRINTI "into the boat."
	CRLF
	MOVE CH-PLAYER,TH-BOAT
	ZERO? GL-PUPPY /?L20
	MOVE GL-PUPPY,TH-BOAT
?L20:	FSET TH-BOAT,FL-NODESC
	RTRUE
?L14:	EQUAL? GL-PRSA,V?EXIT \?L24
	EQUAL? GL-PRSO,ROOMS,TH-BOAT \?L24
	IN? CH-PLAYER,TH-BOAT \FALSE
	MOVE CH-PLAYER,GL-PLACE-CUR
	ZERO? GL-PUPPY /?L27
	MOVE GL-PUPPY,GL-PLACE-CUR
?L27:	FCLEAR TH-BOAT,FL-NODESC
	SET 'NUM,TH-BOAT-AUX1
	LOC TH-OPAL >STACK
	ZERO? STACK /?L30
	IN? TH-BOAT,RM-THE-EMBANKMENT \?L30
	ZERO? NUM \?L30
	PRINTI "As"
	ZERO? GL-PUPPY /?L32
	EQUAL? GL-WINNER,CH-PLAYER \?L32
	MOVE GL-PUPPY,GL-PLACE-CUR
	PRINTI " you and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L34
?L32:	ICALL RT-YOU-MSG,STR?318,STR?317
?L34:	PRINTI "out of the boat, a man storms up to you and says, ""What in bloody 'ell are you doing with my boat?"" Without waiting for a reply he "
	ICALL2 PRINT-ID,STR?319
	IN? TH-OAR-2,TH-BOAT /?L37
	IN? TH-OAR-2,RM-THE-EMBANKMENT /?L37
	CALL RT-META-IN?,TH-OAR-2,CH-PLAYER >STACK
	ZERO? STACK \?L37
	CALL RT-META-IN?,TH-OAR-2,GL-PUPPY >STACK
	ZERO? STACK /?L35
?L37:	PRINTI "grabs the oar, "
?L35:	MOVE TH-BOAT,RM-OUTSIDE-TRAITORS-GATE
	MOVE TH-ANCHOR,LG-WATER
	REMOVE TH-OAR-1
	REMOVE TH-OAR-2
	SET 'TH-BOAT-AUX1,1
	PRINTR "jumps into the boat and rows off, muttering to himself that he'll have to find a safer place to keep it."
?L30:	FSET? TH-GARNET,FL-TOUCHED \?L39
	IN? TH-BOAT,RM-THE-EMBANKMENT \?L39
	EQUAL? NUM,1 \?L39
	PRINTI "As"
	ZERO? GL-PUPPY /?L40
	EQUAL? GL-WINNER,CH-PLAYER \?L40
	MOVE GL-PUPPY,GL-PLACE-CUR
	PRINTI " you and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L42
?L40:	ICALL RT-YOU-MSG,STR?318,STR?317
?L42:	PRINTI "out of the boat, its red-faced owner runs up and yells, ""You again?!!"" He gives you a swift kick in the rear"
	ICALL2 PRINT-ID,STR?320
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L43
	PRINTI ", then clutches his foot in agony as it bounces off your suit of armour"
?L43:	PRINTI "."
	CRLF
	CRLF
	PRINTI "The man jumps into the boat"
	IN? TH-PADDLE,TH-BOAT \?L46
	PRINTI " and paddles away, cursing under his breath."
	CRLF
	JUMP ?L48
?L46:	PRINTI ", launches it, and suddenly realizes he has no way to steer it. The last you see of him, he is drifting down the Thames, screaming and shaking his fist at you."
	CRLF
	ICALL2 PRINT-ID,STR?321
?L48:	REMOVE TH-BOAT
	SET 'TH-BOAT-AUX1,2
	RTRUE
?L39:	IN? TH-ANCHOR,TH-BOAT \?L49
	PRINTI "As"
	ZERO? GL-PUPPY /?L50
	EQUAL? GL-WINNER,CH-PLAYER \?L50
	MOVE GL-PUPPY,GL-PLACE-CUR
	PRINTI " you and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L52
?L50:	ICALL RT-YOU-MSG,STR?318,STR?317
?L52:	PRINTI "out of the boat it slides out from under your foot and drifts down the river."
	CRLF
	REMOVE TH-BOAT
	RTRUE
?L49:	ZERO? GL-PUPPY /?L54
	EQUAL? GL-WINNER,CH-PLAYER \?L54
	MOVE GL-PUPPY,GL-PLACE-CUR
	PRINTI "You and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L56
?L54:	ICALL RT-CYOU-MSG,STR?318,STR?317
?L56:	PRINTR "out of the boat."
?L24:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	EQUAL? GL-PRSO,TH-BOAT \FALSE
	REMOVE TH-BOAT
	PRINTI "Bad idea. The bullet blows a hole in the boat, which promptly sinks."
	CRLF
	ICALL2 PRINT-ID,STR?322
	IN? CH-PLAYER,TH-BOAT \TRUE
	CRLF
	PRINTI "Unable to swim, you cling to a piece of driftwood for several hours, wondering what kind of idiot would shoot a boat out from under himself."
	CRLF
	CRLF
	PRINTI "After a while, a Scotland Yard launch pulls alongside to rescue you. Lestrade leans over the side and offers his assistance. You decide you're better off in the water and politely decline."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?323
	ICALL1 RT-QSR
	RTRUE

	.FUNCT RT-AC-TH-OAR-1,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The oar is hopelessy jammed into the oarlock."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?TAKE \?L4
	ICALL RT-CYOU-MSG,STR?325,STR?324
	PRINTR "to extract the oar from the oarlock, but it seems to be jammed."
?L4:	EQUAL? GL-PRSA,V?RELEASE \FALSE
	ICALL RT-CYOU-MSG,STR?327,STR?326
	PRINTR "with the oar for a minute or two with no success... it really is jammed in there."

	.FUNCT RT-AC-TH-OAR-LOCK
	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	ZERO? GL-NOW-PRSI? /FALSE
	EQUAL? GL-PRSO,TH-OAR-2 /FALSE
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT RT-AC-TH-CLAPPER,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	IN? TH-SAPPHIRE,TH-CLAPPER \FALSE
	PRINTR "The clapper hangs from the centre of the bell. There is a beautiful blue sapphire glued to the end of it."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \?L7
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?328 >STACK
	RSTACK
?L7:	CALL2 RT-IMPOSSIBLE-PUT-IN-ON-MSG,TH-CLAPPER >STACK
	ZERO? STACK \TRUE
	EQUAL? GL-PRSA,V?TOUCH,V?TOUCH-TO,V?TOUCH-TO-SWP \FALSE
	EQUAL? TH-BELL-AUX2,K-BELL-TOWARDS /FALSE
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSO
	PRINTR "within reach."

	.FUNCT RT-AC-TH-COTTON-BALLS,CONTEXT,VAL
	ASSIGNED? 'CONTEXT /?L37
	SET 'CONTEXT,0
?L37:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-COTTON-BALLS,FL-WORN \?L3
	PRINTR "You can't see them because they're in your ears."
?L3:	PRINTR "They're soft and fluffy."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	SET 'GL-P-IT-OBJECT,GL-PRSO
	EQUAL? GL-PRSA,V?WEAR /?L10
	EQUAL? GL-PRSA,V?PUT \?L8
	EQUAL? GL-PRSI,TH-EARS \?L8
?L10:	FSET? GL-PRSO,FL-WORN \?L11
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-IS-ARE-MSG
	PRINTI "already in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L11:	FSET? TH-STETHOSCOPE,FL-WORN \?L13
	ICALL2 RT-CTHEO-PRINT,TH-STETHOSCOPE
	PRINTR " is in the way."
?L13:	SET 'GL-LISTEN-OBJ,0
	FSET GL-PRSO,FL-WORN
	MOVE GL-PRSO,CH-PLAYER
	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	PRINTI " in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTI "."
	CRLF
	GETP GL-PRSO,P?VALUE >VAL
	ZERO? VAL /TRUE
	ICALL2 RT-UPDATE-SCORE,VAL
	PUTP GL-PRSO,P?VALUE,0
	RTRUE
?L8:	EQUAL? GL-PRSA,V?TAKE \?L20
	EQUAL? GL-PRSI,TH-EARS /?L19
?L20:	EQUAL? GL-PRSA,V?TAKE-OFF,V?TAKE \?L18
	FSET? GL-PRSO,FL-WORN \?L18
?L19:	FSET? GL-PRSO,FL-WORN /?L21
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	PRINTI "in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L21:	FSET? TH-STETHOSCOPE,FL-WORN \?L24
	ICALL RT-PERFORM,V?TAKE-OFF,TH-STETHOSCOPE
?L24:	SET 'GL-LISTEN-OBJ,0
	FCLEAR GL-PRSO,FL-WORN
	ICALL RT-CYOU-MSG,STR?228,STR?227
	ICALL1 RT-THEO-PRINT
	PRINTI " out of "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTI "."
	CRLF
	EQUAL? GL-WINNER,CH-PLAYER /TRUE
	MOVE GL-PRSO,GL-WINNER
	RTRUE
?L18:	EQUAL? GL-PRSA,V?DROP,V?THROW,V?THROW-OVER \?L30
	FSET? GL-PRSO,FL-WORN \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " while"
	ICALL RT-YOU-MSG,STR?110,STR?109
	PRINTR "wearing them."
?L30:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-BELL,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The huge bell hangs over the hollow shaft of the tower."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \?L4
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?329 >STACK
	RSTACK
?L4:	CALL2 RT-IMPOSSIBLE-PUT-IN-ON-MSG,TH-BELL >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT RT-AC-TH-STETHOSCOPE,CONTEXT,VAL
	ASSIGNED? 'CONTEXT /?L37
	SET 'CONTEXT,0
?L37:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-STETHOSCOPE,FL-WORN \?L3
	PRINTR "The stethoscope is hanging from your ears."
?L3:	PRINTR "It looks just like any other late-Victorian-era stethoscope."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?WEAR /?L10
	EQUAL? GL-PRSA,V?PUT \?L8
	EQUAL? GL-PRSI,TH-EARS \?L8
?L10:	FSET? TH-STETHOSCOPE,FL-WORN \?L11
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-IS-ARE-MSG
	PRINTI "already in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L11:	SET 'GL-LISTEN-OBJ,0
	FSET TH-STETHOSCOPE,FL-WORN
	MOVE TH-STETHOSCOPE,CH-PLAYER
	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	PRINTI " in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTI "."
	CRLF
	GETP TH-STETHOSCOPE,P?VALUE >VAL
	ZERO? VAL /TRUE
	ICALL2 RT-UPDATE-SCORE,VAL
	PUTP TH-STETHOSCOPE,P?VALUE,0
	RTRUE
?L8:	EQUAL? GL-PRSA,V?TAKE \?L19
	EQUAL? GL-PRSI,TH-EARS /?L18
?L19:	EQUAL? GL-PRSA,V?TAKE-OFF,V?TAKE \?L17
	FSET? TH-STETHOSCOPE,FL-WORN \?L17
?L18:	FSET? TH-STETHOSCOPE,FL-WORN /?L20
	ICALL1 RT-CTHEO-PRINT
	ICALL1 RT-ISNT-ARENT-MSG
	PRINTI "in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L20:	SET 'GL-LISTEN-OBJ,0
	FCLEAR TH-STETHOSCOPE,FL-WORN
	ICALL RT-CYOU-MSG,STR?228,STR?227
	ICALL1 RT-THEO-PRINT
	PRINTI " out of "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTI "."
	CRLF
	EQUAL? GL-WINNER,CH-PLAYER /TRUE
	MOVE GL-PRSO,GL-WINNER
	RTRUE
?L17:	EQUAL? GL-PRSA,V?DROP,V?THROW,V?THROW-OVER \?L26
	FSET? TH-STETHOSCOPE,FL-WORN \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " while"
	ICALL RT-YOU-MSG,STR?110,STR?109
	PRINTR "wearing it."
?L26:	EQUAL? GL-PRSA,V?PUT-ON \FALSE
	FSET? GL-PRSI,FL-PERSON \FALSE
	FSET? TH-STETHOSCOPE,FL-WORN \FALSE
	CALL RT-PERFORM,V?LISTEN,GL-PRSI,GL-PRSO >STACK
	RSTACK

	.FUNCT RT-AC-TH-WATSONS-HAT,CONTEXT
	ASSIGNED? 'CONTEXT /?L38
	SET 'CONTEXT,0
?L38:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-WATSONS-HAT,FL-WORN \?L3
	PRINTR "You can't look at your hat while it's on the top of your head."
?L3:	PRINTR "It's a rather large hat with plenty of room inside it for your rather large head."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \?L39
	EQUAL? GL-PRSA,V?PUT-ON \?L11
	EQUAL? GL-PRSI,TH-HEAD /?L10
?L11:	EQUAL? GL-PRSA,V?WEAR \?L8
?L10:	FSET? TH-WATSONS-HAT,FL-WORN \?L12
	PRINTI "You are already wearing "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L12:	CALL2 RT-DONT-HAVE-MSG,GL-PRSO >STACK
	ZERO? STACK \TRUE
	FCLEAR TH-WATSONS-HAT,FL-OPENED
	FSET TH-WATSONS-HAT,FL-WORN
	PRINTI "You put on "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L8:	EQUAL? GL-PRSA,V?TAKE \?L19
	EQUAL? GL-PRSI,TH-HEAD /?L17
	FSET? TH-WATSONS-HAT,FL-WORN \?L19
	EQUAL? GL-PRSI,0,CH-PLAYER,CH-ME /?L17
?L19:	EQUAL? GL-PRSA,V?TAKE-OFF \?L16
?L17:	FSET? TH-WATSONS-HAT,FL-WORN \?L20
	FSET TH-WATSONS-HAT,FL-OPENED
	FCLEAR TH-WATSONS-HAT,FL-WORN
	PRINTI "You take off "
	ICALL1 RT-THEO-PRINT
	CALL2 RT-VISIBLE?,CH-AKBAR >STACK
	ZERO? STACK /?L22
	PRINTI ". Disconcerted by your sacrilegious action, Akbar averts his gaze"
?L22:	FIRST? TH-WATSONS-HAT >STACK \?L25
	PRINTI ". Inside you see "
	ICALL2 RT-PRINT-CONTENTS-2,TH-WATSONS-HAT
?L25:	PRINTR "."
?L20:	PRINTI "You are not wearing "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L16:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?LOOK-UNDER \?L29
	FSET? TH-WATSONS-HAT,FL-WORN \?L29
	PRINTI "You can't see inside "
	ICALL2 RT-THEO-PRINT,TH-WATSONS-HAT
	PRINTI " while it's on "
	ICALL2 RT-THEO-PRINT,TH-HEAD
	PRINTR "."
?L29:	EQUAL? GL-PRSA,V?REACH-IN,V?SEARCH,V?PUT /?L31
	EQUAL? GL-PRSA,V?PUT-ON \FALSE
?L31:	FSET? TH-WATSONS-HAT,FL-WORN \FALSE
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?199,GL-PRSO
	PRINTR " first."
?L39:	EQUAL? GL-PRSA,V?PUT,V?PUT-UNDER \FALSE
	FSET? TH-WATSONS-HAT,FL-WORN \FALSE
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?199,GL-PRSI
	PRINTR " first."

	.FUNCT RT-AC-TH-ELIZAS-FLOWERS,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTI "In "
	ICALL2 RT-THEO-PRINT,TH-ELIZAS-FLOWERS
	PRINTR " you see a carnation."
?L1:	ZERO? GL-NOW-PRSI? /FALSE
	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	CALL2 RT-CANT-PUT-IN-ON-MSG,TH-ELIZAS-FLOWERS >STACK
	RSTACK

	.FUNCT RT-AC-TH-CARNATION
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?WEAR \?L3
	EQUAL? GL-WINNER,CH-PLAYER \?L5
	IN? TH-CARNATION,TH-LAPEL \?L7
	ICALL1 RT-CTHEO-PRINT
	PRINTI " is already in "
	ICALL2 RT-THEO-PRINT,TH-LAPEL
	PRINTR "."
?L7:	MOVE TH-CARNATION,TH-LAPEL
	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	PRINTI " in "
	ICALL2 RT-THEO-PRINT,TH-LAPEL
	PRINTR "."
?L5:	ICALL2 RT-CTHEO-PRINT,GL-WINNER
	PRINTI " say"
	ICALL2 RT-S-NOS-MSG,GL-WINNER
	PRINTR ", ""No thanks."""
?L3:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?330
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-EMERALD,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	GETP TH-EMERALD,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?SCRATCH \?L1
	CALL RT-HANDLE-SCRATCH,TH-EMERALD,CONTEXT >STACK
	RSTACK
?L1:	EQUAL? CONTEXT,K-M-SDESC \?L4
	PRINTI "emerald"
	RTRUE
?L4:	EQUAL? CONTEXT,K-M-DESCFCN,0 \FALSE
	CALL2 RT-EXAMINE-GEM,TH-EMERALD >STACK
	RSTACK

	.FUNCT RT-AC-TH-SAPPHIRE,CONTEXT,GRABS,WHO
	ASSIGNED? 'CONTEXT /?L46
	SET 'CONTEXT,0
?L46:	GETP TH-SAPPHIRE,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?SCRATCH \?L1
	CALL RT-HANDLE-SCRATCH,TH-SAPPHIRE,CONTEXT >STACK
	RSTACK
?L1:	EQUAL? CONTEXT,K-M-SDESC \?L4
	PRINTI "sapphire"
	RTRUE
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \?L6
	CALL2 RT-EXAMINE-GEM,TH-SAPPHIRE >STACK
	ZERO? STACK /TRUE
	RTRUE
?L6:	ZERO? CONTEXT \FALSE
	SET 'GRABS,TH-SAPPHIRE-AUX1
	ZERO? GL-NOW-PRSI? \?L47
	IN? TH-SAPPHIRE,TH-CLAPPER \?L12
	EQUAL? GL-PRSA,V?TAKE \?L14
	GRTR? GRABS,0 \?L43
	EQUAL? TH-BELL-AUX2,K-BELL-TOWARDS \?L18
	DEC 'GRABS
	SET 'TH-SAPPHIRE-AUX1,GRABS
	ZERO? GRABS \?L20
	ICALL RT-CYOU-MSG,STR?332,STR?331
	ICALL1 RT-THEO-PRINT
	PRINTI " from "
	ICALL2 RT-THEO-PRINT,TH-CLAPPER
	PRINTI "."
	CRLF
	MOVE TH-SAPPHIRE,CH-PLAYER
	FCLEAR TH-SAPPHIRE,FL-NODESC
	FSET TH-SAPPHIRE,FL-SEEN
	FSET TH-SAPPHIRE,FL-TOUCHED
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L22
	CRLF
	PRINTI "Holmes beams at you and says, ""Good show, old fellow."""
	CRLF
?L22:	GETP TH-SAPPHIRE,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-SAPPHIRE,P?VALUE,0
	RTRUE
?L20:	ICALL RT-CYOU-MSG,STR?334,STR?333
	PRINTI "at "
	ICALL1 RT-THEO-PRINT
	PRINTR ", but you can't quite grab it before it swings out of reach again."
?L18:	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSO
	PRINTR "within reach."
?L14:	EQUAL? GL-PRSA,V?HIT \?L28
	EQUAL? TH-BELL-AUX2,K-BELL-TOWARDS /?L31
	EQUAL? GL-PRSI,TH-OAR-2 \?L29
?L31:	ICALL RT-CYOU-MSG,STR?336,STR?335
	ICALL1 RT-THEO-PRINT
	PRINTI " into the shaft. A long time later you hear "
	ICALL1 RT-THEO-PRINT
	PRINTI " shatter."
	CRLF
	ICALL2 PRINT-ID,STR?337
	FCLEAR GL-PRSO,FL-WORN
	REMOVE GL-PRSO
	RTRUE
?L29:	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSO
	PRINTR "within reach."
?L28:	EQUAL? GL-PRSA,V?TOUCH,V?TOUCH-TO,V?TOUCH-TO-SWP \?L43
	EQUAL? TH-BELL-AUX2,K-BELL-TOWARDS /FALSE
	ICALL1 RT-CTHEO-PRINT
	ICALL2 RT-IS-ARE-MSG,GL-PRSO
	PRINTR "within reach."
?L12:	ZERO? GL-NOW-PRSI? /?L43
?L47:	IN? TH-SAPPHIRE,TH-CLAPPER \?L43
	EQUAL? GL-PRSA,V?THROW \?L43
	EQUAL? GL-PRSO,CH-TRAINED-PIGEON \?L41
	ICALL1 RT-PIGEON-PANIC
	SET 'CH-TRAINED-PIGEON-AUX1,0
	RTRUE
?L41:	ICALL RT-CYOU-MSG,STR?339,STR?338
	ICALL1 RT-THEI-PRINT
	PRINTI " with "
	ICALL1 RT-THEO-PRINT
	PRINTI ", and they both disappear into the shaft. A long time later you hear "
	ICALL1 RT-THEI-PRINT
	PRINTI " shatter."
	CRLF
	ICALL2 PRINT-ID,STR?340
	REMOVE GL-PRSO
	REMOVE GL-PRSI
	RTRUE
?L43:	CALL2 RT-EXAMINE-GEM,TH-SAPPHIRE >STACK
	RSTACK

	.FUNCT RT-AC-TH-OPAL,CONTEXT
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	GETP TH-OPAL,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?SCRATCH \?L1
	CALL RT-HANDLE-SCRATCH,TH-OPAL,CONTEXT >STACK
	RSTACK
?L1:	EQUAL? CONTEXT,K-M-SDESC \?L3
	PRINTI "opal"
	RTRUE
?L3:	EQUAL? CONTEXT,K-M-DESCFCN,0 \FALSE
	CALL2 RT-EXAMINE-GEM,TH-OPAL >STACK
	RSTACK

	.FUNCT RT-AC-TH-RUBY,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	GETP TH-RUBY,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?SCRATCH \?L1
	CALL RT-HANDLE-SCRATCH,TH-RUBY,CONTEXT >STACK
	RSTACK
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L4
	ICALL2 RT-EXAMINE-GEM,TH-RUBY
	RTRUE
?L4:	EQUAL? CONTEXT,K-M-SDESC \?L6
	PRINTI "ruby"
	RTRUE
?L6:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?TAKE \?L11
	IN? TH-RUBY,TH-NELSON-STATUE \?L9
	PRINTR "You can't reach the ruby."
?L9:	IN? TH-RUBY,CH-SHERMAN \?L11
	ICALL2 PRINT-ID,STR?341
	ICALL RT-IMPOLITE-MSG,STR?256,STR?255
	RTRUE
?L11:	CALL2 RT-EXAMINE-GEM,TH-RUBY >STACK
	RSTACK

	.FUNCT RT-AC-TH-TOPAZ,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	GETP TH-TOPAZ,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?SCRATCH \?L1
	CALL RT-HANDLE-SCRATCH,TH-TOPAZ,CONTEXT >STACK
	RSTACK
?L1:	EQUAL? CONTEXT,K-M-SDESC \?L4
	PRINTI "topaz"
	RTRUE
?L4:	EQUAL? CONTEXT,K-M-DESCFCN,0 \FALSE
	CALL2 RT-EXAMINE-GEM,TH-TOPAZ >STACK
	RSTACK

	.FUNCT RT-AC-TH-CRAYON,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "It looks just like any other Victorian-era crayon."

	.FUNCT RT-AC-TH-WATSONS-COAT,CONTEXT
	ASSIGNED? 'CONTEXT /?L17
	SET 'CONTEXT,0
?L17:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's a wool greatcoat."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \?L18
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L5
	CALL RT-PERFORM,V?LOOK-INSIDE,TH-POCKET >STACK
	RSTACK
?L5:	EQUAL? GL-PRSA,V?EMPTY,V?EMPTY-INTO \?L7
	PRINTI "[from "
	ICALL2 RT-THEO-PRINT,TH-POCKET
	PRINTI "]"
	CRLF
	CALL RT-PERFORM,GL-PRSA,TH-POCKET,GL-PRSO >STACK
	RSTACK
?L7:	EQUAL? GL-PRSA,V?WEAR,V?TAKE-OFF \FALSE
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \FALSE
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?199,TH-SUIT-OF-ARMOUR
	PRINTR " first."
?L18:	EQUAL? GL-PRSA,V?TAKE \?L11
	PRINTI "[from "
	ICALL2 RT-THEO-PRINT,TH-POCKET
	PRINTI "]"
	CRLF
	CALL RT-PERFORM,V?TAKE,GL-PRSO,TH-POCKET >STACK
	RSTACK
?L11:	EQUAL? GL-PRSA,V?PUT \?L13
	PRINTI "[in "
	ICALL2 RT-THEO-PRINT,TH-POCKET
	PRINTI "]"
	CRLF
	CALL RT-PERFORM,V?PUT,GL-PRSO,TH-POCKET >STACK
	RSTACK
?L13:	EQUAL? GL-PRSA,V?EMPTY,V?EMPTY-INTO \FALSE
	PRINTI "[in "
	ICALL2 RT-THEO-PRINT,TH-POCKET
	PRINTI "]"
	CRLF
	CALL RT-PERFORM,GL-PRSA,GL-PRSO,TH-POCKET >STACK
	RSTACK

	.FUNCT RT-AC-TH-LAPEL
	ZERO? GL-NOW-PRSI? /FALSE
	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	EQUAL? GL-PRSO,TH-CARNATION /FALSE
	CALL2 RT-CANT-PUT-IN-ON-MSG,TH-LAPEL >STACK
	RSTACK

	.FUNCT RT-AC-TH-CLUMP-OF-MOSS,CONTEXT,WHO
	ASSIGNED? 'CONTEXT /?L34
	SET 'CONTEXT,0
?L34:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The clump of moss is a slightly different colour than the other lichen that surrounds it."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?LOOK \?L4
	ICALL2 RT-AC-TH-CLUMP-OF-MOSS,K-M-DESCFCN
	RTRUE
?L4:	CALL1 RT-THAMES-TIDE >STACK
	ZERO? STACK \?L5
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	PRINTI "As soon as"
	ICALL RT-YOU-MSG,STR?343,STR?342
	ICALL2 RT-THEO-PRINT,TH-CLUMP-OF-MOSS
	PRINTI ", it crumbles. "
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "left holding a beautiful opal."
	CRLF
	ICALL2 PRINT-ID,STR?344
	MOVE TH-OPAL,GL-WINNER
	FSET TH-OPAL,FL-SEEN
	FSET TH-OPAL,FL-TOUCHED
	FCLEAR TH-OPAL,FL-NODESC
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L8
	CRLF
	PRINTI "Holmes claps you on the shoulder and says, ""Capital, Watson. Capital!"""
	CRLF
?L8:	GETP TH-OPAL,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-OPAL,P?VALUE,0
	REMOVE TH-CLUMP-OF-MOSS
	RTRUE
?L5:	EQUAL? GL-PRSA,V?TAKE \?L12
	CALL1 RT-THAMES-TIDE >STACK
	EQUAL? STACK,2 \?L13
	PRINTI "The clump is well beyond "
	ICALL1 RT-YOUR-MSG
	PRINTR "grasp."
?L13:	ICALL1 RT-CYOU-MSG
	PRINTR "cannot quite reach it."
?L12:	EQUAL? GL-PRSA,V?HIT,V?TOUCH,V?TOUCH-TO /?L17
	EQUAL? GL-PRSA,V?CUT \?L16
?L17:	EQUAL? GL-PRSA,V?HIT,V?TOUCH \?L21
	EQUAL? GL-PRSI,TH-OAR-2 /?L20
?L21:	EQUAL? GL-PRSA,V?TOUCH-TO \?L18
	EQUAL? GL-PRSO,TH-OAR-2 \?L18
?L20:	ICALL RT-CYOU-MSG,STR?336,STR?335
	ICALL2 RT-THEO-PRINT,TH-CLUMP-OF-MOSS
	PRINTI " into the water. It dissolves upon impact and reveals a beautiful opal, which slowly sinks into the murky depths."
	CRLF
	REMOVE TH-CLUMP-OF-MOSS
	RTRUE
?L18:	ICALL RT-CYOU-MSG,STR?325,STR?324
	PRINTI "to hit the moss"
	EQUAL? GL-PRSA,V?TOUCH-TO \?L23
	PRINTI " with "
	ICALL1 RT-THEO-PRINT
	JUMP ?L25
?L23:	ZERO? GL-PRSI /?L25
	PRINTI " with "
	ICALL1 RT-THEI-PRINT
?L25:	PRINTI " but"
	ICALL RT-YOU-MSG,STR?110,STR?109
	PRINTR "not able to reach it."
?L16:	EQUAL? GL-PRSA,V?THROW \?L27
	EQUAL? GL-PRSO,CH-TRAINED-PIGEON /FALSE
	CALL1 RT-IDROP-MSG >STACK
	ZERO? STACK /TRUE
	PRINTI "Good throw! "
	ICALL1 RT-CTHEO-PRINT
	PRINTI " hit"
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTI " the clump, knock"
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTI " it loose, and everything falls into the water. "
	ICALL1 RT-CTHEO-PRINT
	PRINTI " sink"
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTI " immediately. The moss, however, dissolves upon impact and reveals a beautiful opal, which slowly follows "
	ICALL1 RT-THEO-PRINT
	PRINTI " into the murky depths."
	CRLF
	REMOVE TH-CLUMP-OF-MOSS
	REMOVE GL-PRSO
	FCLEAR GL-PRSO,FL-WORN
	RTRUE
?L27:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINTI "The bullet dislodges the clump and knocks it into the water. The moss dissolves upon impact and reveals a beautiful opal, which slowly sinks into the murky depths."
	CRLF
	ICALL2 PRINT-ID,STR?345
	REMOVE TH-CLUMP-OF-MOSS
	RTRUE

	.FUNCT RT-AC-TH-BLIGH-BOAT,CONTEXT
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	PRINTR "The boat is a true-to-life replica of the rowboat that Captain Bligh sailed to Pitcairn Island after the mutiny on the Bounty."

	.FUNCT RT-AC-TH-ANCHOR,CONTEXT
	ASSIGNED? 'CONTEXT /?L28
	SET 'CONTEXT,0
?L28:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	IN? TH-ANCHOR,TH-BOAT \?L3
	PRINTR "It's slimy and green and covered with river crud. Yuck!"
?L3:	PRINTR "It's in the water."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \?L7
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?346 >STACK
	RSTACK
?L7:	IN? CH-PLAYER,TH-BOAT /?L8
	PRINT K-MUST-BE-IN-BOAT-MSG
	PRINTR "do that."
?L8:	EQUAL? GL-PRSA,V?TAKE \?L9
	IN? TH-ANCHOR,TH-BOAT \?L10
	PRINTR "Oomph! It's too heavy to carry."
?L10:	MOVE TH-ANCHOR,TH-BOAT
	CALL1 RT-SAY-RAISE-ANCHOR >STACK
	RSTACK
?L9:	EQUAL? GL-PRSA,V?RAISE,V?HAUL,V?WEIGH /?L14
	EQUAL? GL-PRSA,V?PULL \?L13
?L14:	IN? TH-ANCHOR,LG-WATER \?L15
	MOVE TH-ANCHOR,TH-BOAT
	CALL1 RT-SAY-RAISE-ANCHOR >STACK
	RSTACK
?L15:	PRINT K-ANCHOR-ALREADY-OUT-MSG
	CRLF
	RTRUE
?L13:	EQUAL? GL-PRSA,V?LOWER,V?DROP \?L18
	IN? TH-ANCHOR,LG-WATER \?L19
	PRINTR "The anchor is already in the water."
?L19:	MOVE TH-ANCHOR,LG-WATER
	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	CALL1 RT-SAY-LOWER-ANCHOR >STACK
	RSTACK
?L18:	EQUAL? GL-PRSA,V?THROW,V?PUT \FALSE
	EQUAL? GL-PRSI,LG-WATER \?L23
	MOVE TH-ANCHOR,LG-WATER
	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	CALL1 RT-SAY-LOWER-ANCHOR >STACK
	RSTACK
?L23:	EQUAL? GL-PRSI,TH-BOAT \?L25
	MOVE TH-ANCHOR,TH-BOAT
	CALL1 RT-SAY-RAISE-ANCHOR >STACK
	RSTACK
?L25:	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-NELSON-STATUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	ICALL2 RT-CTHEO-PRINT,TH-NELSON-STATUE
	PRINTI " is perched high above you, on top of the column."
	FSET? TH-NELSON-STATUE,FL-OPENED \?L3
	IN? TH-RUBY,TH-NELSON-STATUE \?L3
	PRINTI " "
	PRINT K-GLINT-MSG
?L3:	CRLF
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	CALL2 RT-IMPOSSIBLE-PUT-IN-ON-MSG,TH-NELSON-STATUE >STACK
	ZERO? STACK \TRUE
	EQUAL? GL-PRSA,V?LOOK-INSIDE \?L8
	ICALL1 RT-CYOU-MSG
	PRINTR "can't see inside the statue."
?L8:	EQUAL? GL-PRSA,V?REACH-IN,V?SEARCH \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTR "can't reach the statue."

	.FUNCT RT-AC-TH-CROWN-JEWELS,CONTEXT
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "Despite its adventures, the Regalia doesn't look any the worse for wear."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	SET 'GL-P-IT-OBJECT,TH-CROWN-JEWELS
	RFALSE

	.FUNCT RT-AC-TH-ETHERIUM-AMPOULE,CONTEXT
	ASSIGNED? 'CONTEXT /?L54
	SET 'CONTEXT,0
?L54:	EQUAL? CONTEXT,K-M-SDESC \?L1
	FSET? TH-ETHERIUM-AMPOULE,FL-BROKEN \?L3
	PRINTI "broken ampoule"
	RTRUE
?L3:	PRINTI "ampoule of etherium"
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	FSET? TH-ETHERIUM-AMPOULE,FL-BROKEN \?L8
	CALL1 RT-AC-TH-BROKEN-AMPOULE >STACK
	RSTACK
?L8:	EQUAL? GL-PRSA,V?MUNG,V?OPEN \?L10
	ZERO? GL-NOW-PRSI? \?L46
	IN? TH-ETHERIUM-AMPOULE,GL-WINNER /?L11
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?294,GL-PRSO
	PRINTI " to do that."
	CRLF
	RETURN 2
?L11:	FSET? GL-PLACE-CUR,FL-NO-ETHERIUM \?L14
	CALL1 RT-WHO-SAYS? >STACK
	EQUAL? STACK,CH-HOLMES \?L16
	PRINTI "Holmes stops you. ""Do try to be discreet, old boy. My research is supposed to be kept secret."""
	CRLF
	ICALL2 PRINT-ID,STR?347
	RETURN 2
?L16:	PRINTI "The etherium renders everyone quite unconscious. Unfortunately, word of the unusual phenomenon soon leaks out, the existence of the secret chemical is exposed, and you are arrested for violating the Official Secrets Act.

Because he thinks you are a traitor, even Lestrade refuses to visit you in prison. His absence is the only bright spot of your twenty-year incarceration."
	CRLF
	ICALL2 PRINT-ID,STR?348
	ICALL1 RT-QSR
	RETURN 2
?L14:	EQUAL? GL-PLACE-CUR,RM-LAIR /?L19
	CALL1 RT-WHO-SAYS? >STACK
	EQUAL? STACK,CH-HOLMES \?L19
	EQUAL? GL-PLACE-CUR,RM-BAR-OF-GOLD,RM-ENTRY-HALL,RM-HOLMES-STUDY /?L19
	EQUAL? GL-PLACE-CUR,RM-EVANGELIST-CHAPEL /?L19
	CALL2 RT-FIND-FLAME,GL-PLACE-CUR >STACK
	ZERO? STACK \?L19
	PRINTI "Holmes stops you just in time. ""This is neither the time nor the place for experimentation."""
	CRLF
	ICALL2 PRINT-ID,STR?349
	RTRUE
?L19:	ICALL2 CLEAR-ALL-FLAGS,TH-ETHERIUM-AMPOULE
	FSET TH-ETHERIUM-AMPOULE,FL-TAKEABLE
	FSET TH-ETHERIUM-AMPOULE,FL-READABLE
	FSET TH-ETHERIUM-AMPOULE,FL-BROKEN
	GETPT TH-ETHERIUM-AMPOULE,P?ADJECTIVE >STACK
	PUT STACK,0,W?BROKEN
	PRINTI "You break open the ampoule."
	EQUAL? GL-PLACE-CUR,RM-BAR-OF-GOLD \?L21
	PRINTI " The etherium fumes mix with the heavy air of the opium den. No one seems to notice."
	CRLF
	ICALL2 PRINT-ID,STR?350
	RTRUE
?L21:	FSET? GL-PLACE-CUR,FL-INDOORS \?L23
	CALL2 RT-FIND-FLAME,GL-PLACE-CUR >STACK
	ZERO? STACK \?L26
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL,RM-HOLMES-STUDY,RM-EVANGELIST-CHAPEL \?L24
?L26:	PRINTI " As soon as the volatile etherium comes in contact with the flame"
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \?L27
	PRINTI " of the gas light"
	JUMP ?L30
?L27:	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \?L29
	PRINTI " of the fireplace"
	JUMP ?L30
?L29:	EQUAL? GL-PLACE-CUR,RM-EVANGELIST-CHAPEL \?L30
	PRINTI " of the candles"
?L30:	PRINTI ", it explodes."
	CRLF
	CRLF
	PRINTI "B  O  O  M  !!!"
	CRLF
	CRLF
	PRINTI "You awaken several days later in the hospital. Inspector Lestrade is there with flowers for your bedside table. He is full of news about how he plans to solve the case. Upon hearing this, you lapse back into a coma from which you have no particular desire to emerge."
	CRLF
	ICALL2 PRINT-ID,STR?351
	ICALL1 RT-QSR
	RTRUE
?L24:	PRINTI " The etherium is released into the room."
	FSET? TH-BREATH,FL-LOCKED /?L33
	FSET CH-PLAYER,FL-ASLEEP
	PRINTI " Suddenly, everything starts to spin. You pass out and fall to the ground. Sometime later you awaken and stumble back to your feet."
	CRLF
	ICALL2 PRINT-ID,STR?352
	ICALL RT-CLOCK-JMP,6,0,0
	EQUAL? GL-PLACE-CUR,RM-LAIR \?L38
	ICALL1 RT-DOES-MORIARTY-WIN
	JUMP ?L38
?L33:	CALL2 RT-ETHERIUM-EFFECT,1 >STACK
	ZERO? STACK /?L39
	PRINTI " You see everyone"
	CALL2 RT-VISIBLE?,CH-HOLMES >STACK
	ZERO? STACK /?L41
	PRINTI " but Holmes"
?L41:	PRINTI " pass out."
?L39:	CRLF
?L38:	MOVE TH-ETHERIUM-GAS,GL-PLACE-CUR
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,6,0,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-WAKE-UP,STACK
	RTRUE
?L23:	PRINTR " The etherium fumes dissipate quickly."
?L10:	ZERO? GL-NOW-PRSI? \?L46
	EQUAL? GL-PRSA,V?SHOOT /?L55
	EQUAL? GL-PRSA,V?BURN-WITH \?L46
	ZERO? GL-PRSI /?L48
	FSET? GL-PRSI,FL-BURNABLE \?L46
	FSET? GL-PRSI,FL-LIGHTED \?L46
?L48:	EQUAL? GL-PRSA,V?SHOOT \?L49
?L55:	PRINTI "Couldn't resist it, could you?"
?L49:	CRLF
	CRLF
	PRINTI "B  O  O  M  !!!"
	CRLF
	CRLF
	PRINTI "Your nerves - already fragile from the Afghan campaign - snap like a dry twig. You collapse into a babbling pile of jello, and white-coated attendants take you away to a nice sunlit room where Lestrade visits on alternate Tuesdays."
	CRLF
	ICALL2 PRINT-ID,STR?353
	CALL1 RT-QSR >STACK
	RSTACK
?L46:	EQUAL? GL-PRSA,V?READ,V?EXAMINE,V?LOOK-ON \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	PRINTR "The label on the ampoule reads, ""Etherium. Extremely volatile. Do not open in the presence of fire."""

	.FUNCT RT-AC-TH-BROKEN-AMPOULE
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL1 RT-CTHEO-PRINT
	PRINT K-SHATTER-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-ETHERIUM-GAS,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTI "Etherium is a colourless gas, which"
	ICALL1 RT-YOU-MSG
	PRINTR "cannot see."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SMELL \?L4
	IN? TH-ETHERIUM-GAS,GL-PLACE-CUR \?L5
	FSET? TH-BREATH,FL-LOCKED /?L5
	CALL1 RT-SMELL-ETHERIUM? >STACK
	RSTACK
?L5:	ICALL1 RT-CYOU-MSG
	PRINTR "cannot smell it."
?L4:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-LAB-EQUIPMENT,CONTEXT
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The equipment is a jumble of test tubes, beakers, and pipettes."
?L1:	ZERO? CONTEXT \FALSE
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	ICALL RT-CYOU-MSG,STR?355,STR?354
	PRINTI "towards the equipment, but then"
	ICALL RT-YOU-MSG,STR?357,STR?356,1
	PRINTI "Holmes's oft-repeated admonition to leave undisturbed his various experiments, and"
	ICALL RT-YOU-MSG,STR?359,STR?358,1
	ICALL1 RT-YOUR-MSG
	PRINTR "hand."

	.FUNCT RT-AC-TH-ROPE,CONTEXT,T1,T2
	ASSIGNED? 'CONTEXT /?L39
	SET 'CONTEXT,0
?L39:	SET 'T1,TH-ROPE-AUX1
	SET 'T2,TH-ROPE-AUX2
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	EQUAL? T1,-1 /FALSE
	ICALL2 RT-CTHEO-PRINT,TH-ROPE
	PRINTI " is securely bound to "
	ICALL2 RT-THEO-PRINT,T1
	EQUAL? T2,-1 /?L6
	PRINTI " and "
	ICALL2 RT-THEO-PRINT,T2
?L6:	PRINTR "."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?TAKE \?L11
	EQUAL? T1,-1 /?L11
	ICALL2 RT-CTHEO-PRINT,TH-ROPE
	PRINTI " is securely bound to "
	ICALL2 RT-THEO-PRINT,T1
	EQUAL? T2,-1 /?L13
	PRINTI " and "
	ICALL2 RT-THEO-PRINT,T2
?L13:	PRINTR "."
?L11:	EQUAL? GL-PRSA,V?CUT \?L18
	EQUAL? GL-PRSI,TH-KNIFE /?L17
?L18:	EQUAL? GL-PRSA,V?UNTIE \FALSE
?L17:	EQUAL? T1,-1 /?L19
	EQUAL? T2,-1 \?L21
	ICALL RT-PERFORM,V?UNTIE,T1
	RTRUE
?L21:	ICALL RT-CYOU-MSG,STR?361,STR?360
	EQUAL? GL-PRSA,V?UNTIE \?L24
	ICALL RT-CYOU-MSG,STR?275,STR?274
	JUMP ?L26
?L24:	ICALL RT-CYOU-MSG,STR?363,STR?362
?L26:	ICALL2 RT-THEO-PRINT,T1
	EQUAL? T2,-1 /?L27
	PRINTI " and "
	ICALL2 RT-THEO-PRINT,T2
?L27:	PRINTI ", and"
	ICALL RT-YOU-MSG,STR?110,STR?109
	PRINTI "left holding the rope."
	CRLF
	EQUAL? GL-PLACE-CUR,RM-LAIR \?L30
	EQUAL? CH-MORIARTY,T1,T2 \?L30
	FSET? CH-MORIARTY,FL-ASLEEP /?L30
	CRLF
	CRLF
	PRINTI "Bad move. As soon as he is free, Moriarty unlocks his desk and pulls out a pistol. ""Thank you for releasing me, gentlemen,"" he says, waving the gun at you. ""Very sporting of you."" He glances at his pocketwatch. ""We shouldn't have too long to wait."" Minutes later you hear newsboys running through the streets shouting about the resignation of the Prime Minister."
	CRLF
	ICALL2 PRINT-ID,STR?364
	ICALL1 RT-QSR
?L30:	SET 'TH-ROPE-AUX1,-1
	FCLEAR T1,FL-LOCKED
	EQUAL? T2,-1 /?L33
	SET 'TH-ROPE-AUX2,-1
	FCLEAR T2,FL-LOCKED
?L33:	MOVE TH-ROPE,GL-WINNER
	RTRUE
?L19:	ICALL1 RT-CTHEO-PRINT
	PRINTR "isn't tied to anyone."

	.FUNCT RT-AC-TH-LIQUID,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's a clear, colourless liquid."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \?L4
	PRINTR "Sorry, you missed."
?L4:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L5
	CALL2 RT-HOLMES-HITS,TH-LIQUID >STACK
	RSTACK
?L5:	EQUAL? GL-PRSA,V?SMELL \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	CALL2 RT-HOLMES-HITS,TH-LIQUID >STACK
	RSTACK

	.FUNCT RT-AC-TH-SYRINGE
	EQUAL? GL-PRSA,V?SHOOT \?L1
	PRINT K-ANNIE-OAKELEY-MSG
	CRLF
	RTRUE
?L1:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	CALL2 RT-HOLMES-HITS,TH-SYRINGE >STACK
	RSTACK

	.FUNCT RT-AC-TH-MOROCCO-CASE
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	FSET? CH-HOLMES,FL-ASLEEP \FALSE
	ICALL2 RT-HOLMES-HITS,TH-MOROCCO-CASE
	RTRUE

	.FUNCT RT-AC-TH-DEAD-PIGEON
	EQUAL? GL-PRSA,V?DROP,V?RELEASE,V?THROW \FALSE
	EQUAL? GL-PRSO,TH-DEAD-PIGEON \FALSE
	PRINTI "Thud."
	CRLF
	ICALL2 PRINT-ID,STR?365
	MOVE TH-DEAD-PIGEON,GL-PLACE-CUR
	RTRUE

	.FUNCT RT-AC-TH-PIGEONS,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The pigeons strut around the square as if they own it."
?L1:	EQUAL? CONTEXT,K-M-WINNER \?L3
	ICALL2 RT-CTHEO-PRINT,TH-PIGEONS
	PRINTR " coo in response."
?L3:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?TAKE \?L5
	EQUAL? GL-PRSO,TH-PIGEONS \?L5
	ICALL2 RT-CTHEO-PRINT,TH-PIGEONS
	PRINTR " scurry out of reach."
?L5:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	EQUAL? GL-PRSO,TH-PIGEONS \FALSE
	ICALL2 PRINT-ID,STR?366
	ICALL RT-SHOOT-BIRDS,TH-PIGEONS,STR?367
	RTRUE

	.FUNCT RT-SHOOT-BIRDS,THING,STR
	ICALL2 RT-CTHEO-PRINT,THING
	PRINTI " all fly up into the air at the sound of the gunshot. Fortunately, none of them was hit. They soon land and resume "
	PRINT STR
	PRINTR "."

	.FUNCT RT-AC-TH-RED-GLASS,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's just a worthless bauble."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \?L4
	ICALL1 RT-CTHEO-PRINT
	PRINT K-SHATTER-MSG
	CRLF
	CALL2 PRINT-ID,STR?368 >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?TAKE \FALSE
	IN? TH-RUBY,CH-SHERMAN \FALSE
	ICALL2 PRINT-ID,STR?369
	ICALL RT-IMPOLITE-MSG,STR?256,STR?255
	RTRUE

	.FUNCT RT-AC-TH-BED,WHO
	EQUAL? GL-PRSA,V?ENTER \?L1
	PRINT K-NO-RESTING-MSG
	CRLF
	RTRUE
?L1:	EQUAL? GL-PRSA,V?LOOK-UNDER \FALSE
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L4
	PRINTR "Holmes gives you a swift kick in the rear and says, ""Watson! There are much more important matters afoot."""
?L4:	EQUAL? WHO,CH-WIGGINS \?L6
	PRINTR "Wiggins says, ""Would you get yer bleedin' arse in gear."""
?L6:	PRINTR "Looking for monsters?"

	.FUNCT RT-AC-TH-MATCHBOOK
	ZERO? GL-NOW-PRSI? \?L17
	EQUAL? GL-PRSA,V?READ,V?EXAMINE,V?LOOK-ON \?L3
	CRLF
	PRINTI "Tired of your dull, boring job? Tired of the whole Victorian era? Become a detective! Apply now to the LESTRADE school of sleuthing. In just three short days, Inspector G. Lestrade will teach you everything he knows of the art of detection. Here are just some of the things you'll learn."
	CRLF
	CRLF
	PRINTI "*** Fifteen new and exciting ways to"
	ICALL1 RT-WRAP-PRINT
	PRINTI "say ""'Ullo! Wot's this?"""
	CRLF
	PRINTI "*** Modern obfuscatory locution"
	ICALL1 RT-WRAP-PRINT
	PRINTI "eschewel techniques."
	CRLF
	PRINTI "*** How to insult private detectives."
	CRLF
	CRLF
	PRINTR "Included in your tuition is an official Scotland Yard notebook, and a brand new bobby pin. Just send twenty-five pounds to the LESTRADE, that's L-E-S-T-R-A-D-E school of sleuthing. Act now, and the Inspector will tell you how he knows that people are guilty simply by looking at them."
?L3:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	FSET? GL-PRSI,FL-LIGHTED \?L9
	FSET? GL-PRSI,FL-BURNABLE /?L8
?L9:	EQUAL? GL-PRSI,TH-PIPE \?L6
	FSET? TH-TOBACCO,FL-LIGHTED \?L6
?L8:	ICALL2 RT-CTHEO-PRINT,TH-MATCHBOOK
	PRINTI " catches fire."
	CRLF
	ICALL2 PRINT-ID,STR?370
	FSET TH-MATCHBOOK,FL-LIGHTED
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	CALL RT-ALARM-SET-REL,RT-I-MATCHBOOK-OUT,STACK >STACK
	RSTACK
?L6:	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSI
	PRINTR "burning."
?L17:	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	EQUAL? GL-PRSO,TH-MATCH /FALSE
	CALL2 RT-CANT-PUT-IN-ON-MSG,TH-MATCHBOOK >STACK
	RSTACK

	.FUNCT RT-AC-TH-PICTURES,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	ASSIGNED? 'CLASS /?L8
	SET 'CLASS,0
?L8:	EQUAL? CONTEXT,K-M-SDESC \?L1
	IXCALL PRINT-SDESC,STR?371,CLASS,0,1
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L3
	PRINTR "They look just like some of your relatives."
?L3:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?LOOK-BEHIND \FALSE
	PRINTR "Thorough, aren't you? There's nothing there."

	.FUNCT RT-AC-TH-CLUE-BOOK,CONTEXT
	ASSIGNED? 'CONTEXT /?L21
	SET 'CONTEXT,0
?L21:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It looks like a very old book."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?READ,V?EXAMINE \?L5
	FSET? TH-CLUE-BOOK,FL-OPENED \?L7
	ICALL1 RT-READ-CLUE-BOOK
	RTRUE
?L7:	PRINTR "The title is, ""Secret Writing and Invisible Inks."""
?L5:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L10
	FSET? TH-CLUE-BOOK,FL-OPENED \?L11
	PRINTR "The pages are yellowed with age."
?L11:	ICALL1 RT-CYOU-MSG
	ICALL2 RT-WOULD-HAVE-TO-MSG,STR?372
	CRLF
	RTRUE
?L10:	EQUAL? GL-PRSA,V?OPEN \?L14
	FSET? TH-CLUE-BOOK,FL-OPENED \?L15
	PRINTR "The book is already open."
?L15:	FSET TH-CLUE-BOOK,FL-OPENED
	PRINTR "The book falls open to the introduction."
?L14:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH \FALSE
	PRINTI "Perfect example of a typically repressive Victorian mentality."
	CRLF
	CALL2 PRINT-ID,STR?373 >STACK
	RSTACK

	.FUNCT RT-AC-TH-BOOK-PAGE,CONTEXT
	ASSIGNED? 'CONTEXT /?L13
	SET 'CONTEXT,0
?L13:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It has writing on it."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?READ,V?EXAMINE \?L4
	FSET? TH-CLUE-BOOK,FL-OPENED \?L5
	ICALL1 RT-READ-CLUE-BOOK
	RTRUE
?L5:	ICALL1 RT-CYOU-MSG
	ICALL2 RT-WOULD-HAVE-TO-MSG,STR?108
	PRINTR "the book first."
?L4:	EQUAL? GL-PRSA,V?FLIP,V?TURN \FALSE
	FSET? TH-CLUE-BOOK,FL-OPENED \?L9
	PRINTR "A quick review of the remainder of the book reveals nothing interesting."
?L9:	ICALL1 RT-CYOU-MSG
	ICALL2 RT-WOULD-HAVE-TO-MSG,STR?108
	PRINTR "the book first."

	.FUNCT RT-READ-CLUE-BOOK
	PRINTI "A few underlined sentences catch your eye."
	CRLF
	CRLF
	PRINTI """Invisible writing has a long and honorable history. It is used primarily when it is felt that a code or cipher may be too easily broken."""
	CRLF
	CRLF
	PRINTR """Most invisible inks are somewhat sticky to the touch, and virtually all of them become visible when exposed to moderate heat."""

	.FUNCT RT-AC-TH-BANK-OF-CANDLES
	ZERO? GL-NOW-PRSI? \FALSE
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	PRINTR "After a moment's reflection you decide to leave undisturbed the offerings that others have left behind."

	.FUNCT RT-AC-TH-PRAMS
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK \?L3
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \FALSE
?L3:	PRINTI "The nannies move the prams beyond your reach and glare at you menacingly."
	CRLF
	ICALL2 PRINT-ID,STR?374
	RTRUE

	.FUNCT RT-AC-TH-PARK-FLOWERS,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "You see daisies, petunias, roses, peonies, marigolds, and a host of golden daffodils."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?TAKE \?L4
	PRINTI "Please don't pick the flowers."
	CRLF
	ICALL2 PRINT-ID,STR?375
	RTRUE
?L4:	EQUAL? GL-PRSA,V?EAT \?L5
	PRINTI "Please don't eat the daisies."
	CRLF
	CALL2 PRINT-ID,STR?376 >STACK
	RSTACK
?L5:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?377
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-ARCH,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	ASSIGNED? 'CLASS /?L8
	SET 'CLASS,0
?L8:	EQUAL? CONTEXT,K-M-SDESC \?L1
	IXCALL PRINT-SDESC,STR?378,CLASS,0,0
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L3
	PRINTR "It's a large triumphal arch, surmounted by a bronze chariot."
?L3:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?379 >STACK
	RSTACK

	.FUNCT RT-AC-TH-SHAFT
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-INSIDE,V?LOOK-DOWN /?L3
	EQUAL? GL-PRSA,V?SEARCH \?L1
?L3:	PRINTR "It's a long way down."
?L1:	EQUAL? GL-PRSA,V?ENTER,V?LEAP \?L4
	PRINT K-SUICIDE-MSG
	CRLF
	ICALL2 PRINT-ID,STR?380
	RTRUE
?L4:	EQUAL? GL-PRSA,V?PUT \FALSE
	ZERO? GL-NOW-PRSI? /FALSE
	EQUAL? GL-PRSO,CH-TRAINED-PIGEON /FALSE
	REMOVE GL-PRSO
	FCLEAR GL-PRSO,FL-WORN
	ICALL1 RT-CTHEO-PRINT
	PRINTI " disappear"
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTI " into the shaft. A long time later you hear a faint ""thud."""
	CRLF
	CALL2 PRINT-ID,STR?381 >STACK
	RSTACK

	.FUNCT RT-AC-TH-FIREPLACE,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L19
	SET 'CONTEXT,0
?L19:	ASSIGNED? 'CLASS /?L20
	SET 'CLASS,0
?L20:	EQUAL? CONTEXT,K-M-SDESC \?L1
	XCALL PRINT-SDESC,STR?382,CLASS,0,0 >STACK
	RSTACK
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-INSIDE,V?SEARCH \?L4
	PRINTR "In the fireplace is a roaring fire that would surely consume anything you put into it."
?L4:	EQUAL? GL-PRSA,V?ENTER,V?LEAP \?L5
	PRINT K-SUICIDE-MSG
	CRLF
	ICALL2 PRINT-ID,STR?383
	RTRUE
?L5:	EQUAL? GL-PRSA,V?PUT \?L6
	EQUAL? GL-PRSI,PSEUDO-OBJECT \?L6
	FSET? GL-PRSO,FL-BODYPART \?L7
	PRINT K-HOT-MSG
	CRLF
	RTRUE
?L7:	IN? GL-PRSO,GLOBAL-OBJECTS \?L9
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L9:	EQUAL? GL-PRSO,TH-ETHERIUM-AMPOULE \?L10
	FSET? GL-PRSO,FL-BROKEN /?L10
	ICALL RT-PERFORM,V?MUNG,GL-PRSO
	RTRUE
?L10:	CALL RT-META-IN?,TH-ETHERIUM-AMPOULE,GL-PRSO >STACK
	ZERO? STACK /?L11
	FSET? TH-ETHERIUM-AMPOULE,FL-BROKEN /?L11
	ICALL1 RT-CTHEO-PRINT
	PRINTI " disappear"
	ICALL2 PRINT-ID,STR?384
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTI " into the fire, which soon reaches the etherium."
	ICALL RT-PERFORM,V?BURN-WITH,TH-ETHERIUM-AMPOULE
	RTRUE
?L11:	REMOVE GL-PRSO
	FCLEAR GL-PRSO,FL-WORN
	ICALL1 RT-CTHEO-PRINT
	PRINTI " disappear"
	ICALL2 RT-S-NOS-MSG,GL-PRSO
	PRINTI " into the fire and"
	ICALL2 RT-IS-ARE-MSG,GL-PRSO
	PRINTI "immediately consumed."
	CRLF
	ICALL2 PRINT-ID,STR?385
	EQUAL? GL-PRSO,CH-TRAINED-PIGEON \TRUE
	ICALL2 PRINT-ID,STR?386
	ICALL1 RT-KILL-PIGEON
	RTRUE
?L6:	EQUAL? GL-PRSA,V?REACH-IN \?L16
	PRINT K-HOT-MSG
	CRLF
	RTRUE
?L16:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-GAS-LIGHT,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	ASSIGNED? 'CLASS /?L8
	SET 'CLASS,0
?L8:	EQUAL? CONTEXT,K-M-SDESC \?L1
	XCALL PRINT-SDESC,STR?387,CLASS,0,0,0 >STACK
	RSTACK
?L1:	ZERO? CONTEXT \FALSE
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L4
	PRINTR "The gas light is out of reach."
?L4:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?388
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-CHARIOT,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	ASSIGNED? 'CLASS /?L8
	SET 'CLASS,0
?L8:	EQUAL? CONTEXT,K-M-SDESC \?L1
	XCALL PRINT-SDESC,STR?389,CLASS,0,0 >STACK
	RSTACK
?L1:	ZERO? CONTEXT \FALSE
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L4
	PRINTR "The chariot is out of reach."
?L4:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-ANNIE-OAKELEY-MSG
	CRLF
	CALL2 PRINT-ID,STR?390 >STACK
	RSTACK

	.FUNCT RT-AC-TH-JEWEL-CASE,CONTEXT
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The case is bent and twisted where the thief attacked it with the mace."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?LOOK-THRU \FALSE
	EQUAL? GL-PRSI,TH-MAGNIFYING-GLASS \FALSE
	PRINTR "It's been wiped clean."

	.FUNCT RT-AC-TH-ELIZAS-MOUTH,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? GL-PRSA,V?SHOOT \?L1
	ZERO? GL-NOW-PRSI? \?L1
	PUTP CH-ELIZA-DOOLITTLE,P?OBJ-NOUN,W?GIRL
	PUTP CH-ELIZA-DOOLITTLE,P?OBJ-ADJ,0
	ICALL RT-PERFORM,V?SHOOT,CH-ELIZA-DOOLITTLE
	RTRUE
?L1:	EQUAL? GL-PRSA,V?PUT \FALSE
	ZERO? GL-NOW-PRSI? /FALSE
	FSET? TH-ELIZAS-MOUTH,FL-OPENED /?L5
	ICALL1 RT-CTHEI-PRINT
	PRINTR " is not open."
?L5:	EQUAL? GL-PRSO,TH-ORANGE-PILL,TH-YELLOW-PILL \?L6
	CALL2 RT-CURE-ELIZA,GL-PRSO >STACK
	RSTACK
?L6:	FSET? GL-PRSO,FL-FOOD /?L7
	PRINTI "It's hard to imagine that "
	ICALL1 RT-A-PRINT
	PRINTI " would do your patient much good."
	CRLF
	ICALL2 PRINT-ID,STR?391
	RTRUE
?L7:	CALL RT-ROOM-IN-ON-MSG?,GL-PRSO,GL-PRSI >STACK
	ZERO? STACK \TRUE
	RFALSE

	.FUNCT RT-AC-TH-RUBBINGS,CONTEXT
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "They are brass rubbings made from various inscriptions around the abbey."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?READ \FALSE
	ICALL2 RT-AC-TH-RUBBINGS,K-M-DESCFCN
	RTRUE

	.FUNCT RT-AC-TH-SOFA
	EQUAL? GL-PRSA,V?ENTER \FALSE
	PRINT K-NO-RESTING-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-MARQUEES,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	ASSIGNED? 'CLASS /?L7
	SET 'CLASS,0
?L7:	EQUAL? CONTEXT,K-M-SDESC \?L1
	IXCALL PRINT-SDESC,STR?392,CLASS,0,1
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN /?L4
	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?READ,V?LOOK-INSIDE,V?LOOK-ON \FALSE
?L4:	GET GL-QUOTES,K-SIGN-MARQUEES >GL-WINDOW
	ICALL2 RT-WINDOW,GL-WINDOW
	SET 'GL-WINDOW,0
	RTRUE

	.FUNCT RT-AC-TH-SUPPORTS,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	ASSIGNED? 'CLASS /?L7
	SET 'CLASS,0
?L7:	EQUAL? CONTEXT,K-M-SDESC \?L1
	XCALL PRINT-SDESC,STR?393,CLASS,0,1 >STACK
	RSTACK
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?394 >STACK
	RSTACK

	.FUNCT RT-AC-TH-ASH,CONTEXT
	ASSIGNED? 'CONTEXT /?L9
	SET 'CONTEXT,0
?L9:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It is dark, almost black, in colour, and quite flakey."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?BLOW-INTO,V?SHOOT \?L4
	REMOVE TH-ASH
	ICALL2 RT-CTHEO-PRINT,TH-ASH
	PRINTI " scatters and disappears."
	CRLF
	CALL2 PRINT-ID,STR?395 >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?HAUL \?L5
	PRINTR "Good idea. Let's get the flake out of here."
?L5:	EQUAL? GL-PRSA,V?KISS \?L6
	PRINT K-PROFANITY-MSG
	CRLF
	RTRUE
?L6:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	REMOVE TH-ASH
	PRINTI "As soon as"
	ICALL RT-YOU-MSG,STR?325,STR?324
	PRINTR "to touch the ash, it crumbles and disappears."

	.FUNCT RT-AC-TH-CIGARETTE
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-ANNIE-OAKELEY-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-TURBAN
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK \?L3
	EQUAL? GL-PRSA,V?LOOK-UNDER,V?LOOK-INSIDE \?L1
?L3:	FSET? CH-AKBAR,FL-ASLEEP \?L4
	PRINTR "That's stooping pretty low."
?L4:	PRINTI "The native of India pulls away from you and says, ""As you must know,"
	FSET? TH-WATSONS-HAT,FL-WORN \?L7
	PRINTI " honourable sir,"
?L7:	PRINTR " a man's head should never be uncovered. It is an affront to God."""
?L1:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL RT-PERFORM,V?SHOOT,CH-AKBAR
	RTRUE

	.FUNCT RT-AC-TH-ANCHOR-CHAIN
	EQUAL? GL-PRSA,V?SHOOT \?L1
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?396 >STACK
	RSTACK
?L1:	IN? CH-PLAYER,TH-BOAT /?L3
	PRINT K-MUST-BE-IN-BOAT-MSG
	PRINTR "do that."
?L3:	EQUAL? GL-PRSA,V?TAKE \?L4
	IN? TH-ANCHOR,TH-BOAT \?L5
	PRINTR "Oomph! It's too heavy to carry."
?L5:	MOVE TH-ANCHOR,TH-BOAT
	CALL1 RT-SAY-RAISE-ANCHOR >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?RAISE,V?HAUL,V?WEIGH /?L9
	EQUAL? GL-PRSA,V?PULL \FALSE
?L9:	IN? TH-ANCHOR,LG-WATER \?L10
	MOVE TH-ANCHOR,TH-BOAT
	CALL1 RT-SAY-RAISE-ANCHOR >STACK
	RSTACK
?L10:	PRINT K-ANCHOR-ALREADY-OUT-MSG
	CRLF
	RTRUE

	.FUNCT RT-SAY-LOWER-ANCHOR
	ICALL RT-CYOU-MSG,STR?398,STR?397
	PRINTR "the anchor into the water."

	.FUNCT RT-SAY-RAISE-ANCHOR
	ICALL RT-CYOU-MSG,STR?400,STR?399
	PRINTI "the anchor and "
	EQUAL? GL-WINNER,CH-PLAYER \?L1
	PRINTI "drop"
	JUMP ?L3
?L1:	PRINTI "drops"
?L3:	PRINTR " it into the boat."

	.FUNCT RT-AC-TH-WAX-OBJECT-1,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	ASSIGNED? 'CLASS /?L8
	SET 'CLASS,0
?L8:	EQUAL? CONTEXT,K-M-SDESC \?L1
	IXCALL PRINT-SDESC,STR?401,CLASS,1,0
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L3
	PRINTI "You see nothing unusual about"
	ICALL RT-CLAUSE-PRINT,K-P-NC1,K-P-NC1L
	PRINTR "."
?L3:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?402
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-LIBRARY-OBJ,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	ASSIGNED? 'CLASS /?L9
	SET 'CLASS,0
?L9:	EQUAL? CONTEXT,K-M-SDESC \?L1
	IXCALL PRINT-SDESC,STR?403,CLASS,0,1
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L3
	PRINTI "You see nothing unusual about"
	ICALL RT-CLAUSE-PRINT,K-P-NC1,K-P-NC1L
	PRINTR "."
?L3:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?LOOK-OUTSIDE,V?LOOK-THRU-SWP /?L6
	EQUAL? GL-PRSA,V?LOOK-UNDER,V?LOOK-BEHIND,V?LOOK-ON /?L6
	EQUAL? GL-PRSA,V?LOOK-THRU,V?SEARCH,V?READ \FALSE
?L6:	PRINTI "You see nothing "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
	PRINTR "."

	.FUNCT RT-AC-TH-RAILING
	EQUAL? GL-PRSA,V?CLIMB-OVER \?L1
	PRINT K-SUICIDE-MSG
	CRLF
	ICALL2 PRINT-ID,STR?404
	RTRUE
?L1:	EQUAL? GL-PRSA,V?CLIMB-ON \FALSE
	PRINTI "It's much too dangerous. Besides, it wouldn't bring you any closer to the clapper."
	CRLF
	ICALL2 PRINT-ID,STR?405
	RTRUE

	.FUNCT RT-AC-TH-OPIUM-GAS,CONTEXT
	ASSIGNED? 'CONTEXT /?L9
	SET 'CONTEXT,0
?L9:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The fumes hang thick in the air."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SMELL \?L4
	PRINT K-DIZZY-MSG
	CRLF
	CALL2 PRINT-ID,STR?406 >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?BUY,V?BUY-FROM,V?ASK-FOR /?L6
	EQUAL? GL-WINNER,CH-DENKEEPER \?L5
	EQUAL? GL-PRSA,V?ASK-FOR,V?GIVE \?L5
?L6:	PRINTR "The proprietor eyes you for a moment and says, ""A gent the likes of you doesn't buy what I 'ave to sell, mate. What is it you really want?"""
?L5:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-PRODUCE,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L16
	SET 'CONTEXT,0
?L16:	ASSIGNED? 'CLASS /?L17
	SET 'CLASS,0
?L17:	EQUAL? CONTEXT,K-M-SDESC \?L1
	IXCALL PRINT-SDESC,STR?407,CLASS,0,1
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L3
	PRINTR "All the produce looks good. But the giant peas look especially delicious."
?L3:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?SMELL \?L5
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L6
	PRINTR "The produce smells country fresh."
?L6:	PRINTR "The produce smells like it's been there a while."
?L5:	EQUAL? GL-PRSA,V?BUY,V?BUY-FROM \?L9
	GET GL-P-NAMW,0 >STACK
	EQUAL? STACK,W?FRUIT,W?FRUITS \?L10
	PRINTI "You"
	JUMP ?L12
?L10:	PRINTI "Although the giant peas look tempting, you"
?L12:	PRINTR " decide to conserve your capital for more important purchases."
?L9:	EQUAL? GL-PRSA,V?TAKE,V?STEAL \?L13
	PRINT K-THEFT-MSG
	CRLF
	ICALL2 PRINT-ID,STR?408
	RTRUE
?L13:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?409
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-TRINKETS,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "They're mostly just baubles. He's obviously charging way too much for them."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?BUY,V?BUY-FROM \?L4
	IN? TH-TELESCOPE,CH-VENDOR \?L5
	PRINTR "The vendor says, ""I've got a loverly telescope you might be interested in, guv'nor."""
?L5:	PRINTR "You glance at the rest of the vendor's wares and decide you can live without them."
?L4:	EQUAL? GL-PRSA,V?TAKE,V?STEAL \FALSE
	PRINT K-THEFT-MSG
	CRLF
	ICALL2 PRINT-ID,STR?410
	RTRUE

	.FUNCT RT-AC-TH-GUARDS-KEYS,CONTEXT
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	ICALL1 RT-CYOU-MSG
	PRINTR "can't see them. They're in the guard's pocket."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?LISTEN \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINTR " is idly jangling some keys in his pocket."

	.FUNCT RT-AC-TH-NELSON-EYE,CONTEXT
	ASSIGNED? 'CONTEXT /?L14
	SET 'CONTEXT,0
?L14:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-NELSON-STATUE,FL-OPENED \FALSE
	IN? TH-RUBY,TH-NELSON-STATUE \FALSE
	PRINTI " "
	PRINT K-GLINT-MSG
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L7
	ICALL2 RT-CTHEO-PRINT,TH-NELSON-EYE
	PRINTR " is too high."
?L7:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L8
	CALL2 RT-AC-TH-NELSON-EYE,K-M-DESCFCN >STACK
	ZERO? STACK \FALSE
	PRINTR "It is too high up to get a good look."
?L8:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-ANNIE-OAKELEY-MSG
	CRLF
	CALL2 PRINT-ID,STR?411 >STACK
	RSTACK

	.FUNCT RT-AC-TH-PANELLING,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	ASSIGNED? 'CLASS /?L5
	SET 'CLASS,0
?L5:	EQUAL? CONTEXT,K-M-SDESC \FALSE
	XCALL PRINT-SDESC,STR?412,CLASS,0,1 >STACK
	RSTACK

	.FUNCT RT-AC-TH-INSTRUMENTS,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L4
	SET 'CONTEXT,0
?L4:	ASSIGNED? 'CLASS /?L5
	SET 'CLASS,0
?L5:	EQUAL? CONTEXT,K-M-SDESC \FALSE
	XCALL PRINT-SDESC,STR?413,CLASS,0,1 >STACK
	RSTACK

	.FUNCT RT-AC-TH-PLAYER-BODY
	GET GL-P-NAMW,0 >STACK
	EQUAL? STACK,W?NOSE \FALSE
	EQUAL? GL-PRSA,V?TAKE \?L4
	EQUAL? GL-P-PRSA-WORD,W?HOLD /?L3
?L4:	EQUAL? GL-PRSA,V?STEAL \FALSE
	EQUAL? GL-P-PRSA-WORD,W?PINCH \FALSE
?L3:	ICALL RT-PERFORM,V?TAKE,TH-BREATH
	RTRUE

	.FUNCT RT-IDENTIFY-FLOOR?,WD,OBJ,NAM
	ASSIGNED? 'OBJ /?L18
	SET 'OBJ,0
?L18:	GETP TH-FLOOR-ETC,P?OBJ-NOUN >NAM
	EQUAL? OBJ,0,TH-FLOOR-ETC \FALSE
	EQUAL? WD,W?FLOOR \?L4
	EQUAL? NAM,W?FLOOR /TRUE
	RFALSE
?L4:	EQUAL? WD,W?CEILING \?L8
	EQUAL? NAM,W?CEILING /TRUE
	RFALSE
?L8:	EQUAL? WD,W?SKY \?L11
	EQUAL? NAM,W?SKY,W?CLOUD,W?CLOUDS /TRUE
	EQUAL? NAM,W?FOG /TRUE
	RFALSE
?L11:	EQUAL? WD,W?GROUND \FALSE
	EQUAL? NAM,W?SURFACE,W?GROUND /TRUE
	RFALSE

	.FUNCT TELL-THE-FLOOR
	PRINTI "the floor"
	RTRUE

	.FUNCT TELL-THE-GROUND
	PRINTI "the ground"
	RTRUE

	.FUNCT RT-AC-TH-FLOOR-ETC,CONTEXT,INDOORS?,UP?,OBJ,NXT,NAM,THING,TOD
	ASSIGNED? 'CONTEXT /?L68
	SET 'CONTEXT,0
?L68:	SET 'INDOORS?,0
	SET 'UP?,0
	SET 'THING,TH-FLOOR-ETC
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	GETP TH-FLOOR-ETC,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?CEILING \FALSE
	EQUAL? GL-PLACE-CUR,RM-HENRY-VII-CHAPEL \FALSE
	PRINT K-BREATH-TAKING-MSG
	CRLF
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-SDESC \?L6
	GETP THING,P?OBJ-NOUN >STACK
	PRINTB STACK
	RTRUE
?L6:	ZERO? CONTEXT \FALSE
	GETP THING,P?OBJ-NOUN >NAM
	EQUAL? NAM,W?FLOOR,W?CEILING \?L8
	SET 'INDOORS?,1
?L8:	CALL2 RT-IDENTIFY-FLOOR?,W?CEILING >STACK
	ZERO? STACK \?L12
	CALL2 RT-IDENTIFY-FLOOR?,W?SKY >STACK
	ZERO? STACK /?L10
?L12:	SET 'UP?,1
?L10:	FSET? GL-PLACE-CUR,FL-INDOORS /?L16
	PUSH 1
	JUMP ?L17
?L16:	PUSH 0
?L17:	EQUAL? INDOORS?,STACK \?L14
	ICALL2 RT-CANT-SEE-ANY-MSG,THING
	RETURN 2
?L14:	ZERO? GL-NOW-PRSI? /?L18
	EQUAL? GL-PRSA,V?PUT-ON,V?PUT,V?THROW /?L21
	EQUAL? GL-PRSA,V?THROW-OVER,V?EMPTY-INTO \FALSE
?L21:	ZERO? UP? \?L22
	CALL RT-PERFORM,V?DROP,GL-PRSO >STACK
	RSTACK
?L22:	PRINTI "Despite your best efforts, "
	ICALL1 RT-THEO-PRINT
	PRINTR " just won't stay up."
?L18:	ZERO? UP? \?L26
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?CROSS \?L27
	CALL1 V-WALK-AROUND >STACK
	RSTACK
?L27:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON,V?SEARCH \FALSE
	FSET? THING,FL-HAS-DESCFCN \?L30
	GETP THING,P?ACTION >STACK
	CALL2 STACK,K-M-DESCFCN >STACK
	ZERO? STACK \TRUE
?L30:	ICALL2 RT-REMOVE-ALL,TH-X-OBJECT
	FIRST? GL-PLACE-CUR >OBJ /?L69
	JUMP ?L35
?L33:	ZERO? OBJ /?L35
?L69:	NEXT? OBJ >NXT /?L38
?L38:	FSET? OBJ,FL-NODESC /?L41
	FSET? OBJ,FL-ALIVE \?L42
	FSET? OBJ,FL-ASLEEP \?L41
?L42:	FSET? OBJ,FL-TAKEABLE /?L39
	FSET? OBJ,FL-TRYTAKE /?L39
?L41:	MOVE OBJ,TH-X-OBJECT
?L39:	SET 'OBJ,NXT
	JUMP ?L33
?L35:	FIRST? GL-PLACE-CUR >STACK \?L45
	ICALL RT-CYOU-MSG,STR?155,STR?154
	ICALL2 RT-PRINT-CONTENTS-2,GL-PLACE-CUR
	JUMP ?L47
?L45:	PRINTI "There is nothing very "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
?L47:	PRINTI " on "
	ICALL2 RT-THEO-PRINT,THING
	PRINTI "."
	CRLF
	CALL RT-MOVE-ALL,TH-X-OBJECT,GL-PLACE-CUR >STACK
	RSTACK
?L26:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-INSIDE,V?SEARCH \?L50
	EQUAL? GL-PLACE-CUR,RM-HENRY-VII-CHAPEL \?L52
	ICALL2 RT-CTHEO-PRINT,THING
	PRINTR " is breathtakingly beautiful."
?L52:	FSET? GL-PLACE-CUR,FL-INDOORS \?L54
	ICALL2 RT-CTHEO-PRINT,THING
	PRINTR " is high above you."
?L54:	ICALL2 RT-CTHEO-PRINT,THING
	CALL1 RT-TIME-OF-DAY >TOD
	ZERO? TOD \?L56
	PRINTR " is dark and foggy."
?L56:	EQUAL? TOD,1 \?L58
	PRINTR " is foggy, but at least there's enough light to see."
?L58:	EQUAL? TOD,2 \?L59
	PRINTR " is pretty light."
?L59:	EQUAL? TOD,3 \FALSE
	PRINTR " is getting darker."
?L50:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	FSET? GL-PLACE-CUR,FL-INDOORS /FALSE
	PRINTI "The bullet disappears into the air."
	CRLF
	CALL2 PRINT-ID,STR?414 >STACK
	RSTACK

	.FUNCT RT-AC-TH-WALL,CONTEXT,OBJ,NAM,ADJ
	ASSIGNED? 'CONTEXT /?L77
	SET 'CONTEXT,0
?L77:	SET 'OBJ,TH-WALL
	GETP OBJ,P?OBJ-NOUN >NAM
	GETP OBJ,P?OBJ-ADJ >ADJ
	EQUAL? CONTEXT,K-M-SDESC \?L1
	GETP OBJ,P?OBJ-ADJ >STACK
	ZERO? STACK /?L3
	PRINTB OBJ
	PRINTI " "
?L3:	GETP OBJ,P?OBJ-NOUN >STACK
	PRINTB STACK
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? NAM,W?WALLS \?L8
	FSET? GL-PLACE-CUR,FL-INDOORS \?L10
	EQUAL? GL-PRSA,V?SHOOT \?L12
	PUTP OBJ,P?OBJ-NOUN,W?WALL
	PUTP OBJ,P?OBJ-ADJ,W?SOUTH
	RFALSE
?L12:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \FALSE
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \FALSE
	PRINTI "The walls are covered with pictures."
	RTRUE
?L10:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \?L19
	EQUAL? GL-PLACE-CUR,RM-INSIDE-TRAITORS-GATE \FALSE
	PRINTI "There are some ravens perched on the wall."
	RTRUE
?L19:	EQUAL? GL-PLACE-CUR,RM-TOTTENHAM-COURT-RD,RM-OXFORD-ST,RM-VICTORIA-SQUARE /FALSE
	EQUAL? GL-PLACE-CUR,RM-VICTORIA-STREET,RM-PARLIAMENT-SQUARE,RM-QUEENS-GARDENS /FALSE
	EQUAL? GL-PLACE-CUR,RM-BUCKINGHAM-PALACE,RM-DRAWBRIDGE,RM-BYWARD-TOWER /FALSE
	EQUAL? GL-PLACE-CUR,RM-OUTER-WARD,RM-TOWER-GREEN,RM-OUTSIDE-TRAITORS-GATE /FALSE
	PRINT K-NOT-SEE-HERE-MSG
	CRLF
	RTRUE
?L8:	EQUAL? ADJ,W?NORTH \?L26
	EQUAL? GL-PLACE-CUR,RM-MARYLEBONE-RD,RM-GREAT-RUSSELL-ST,RM-THREADNEEDLE-ST /?L27
	EQUAL? GL-PLACE-CUR,RM-MONUMENT,RM-OUTSIDE-TRAITORS-GATE \?L26
?L27:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \FALSE
	EQUAL? GL-PLACE-CUR,RM-GREAT-RUSSELL-ST,RM-THREADNEEDLE-ST,RM-MONUMENT \FALSE
	PRINT K-SIGN-HERE-MSG
	RTRUE
?L26:	EQUAL? ADJ,W?EAST \?L34
	EQUAL? GL-PLACE-CUR,RM-BROAD-SANCTUARY,RM-WHITEHALL \?L34
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \FALSE
	EQUAL? GL-PLACE-CUR,RM-BROAD-SANCTUARY \FALSE
	PRINT K-SIGN-HERE-MSG
	RTRUE
?L34:	EQUAL? ADJ,W?WEST \?L41
	EQUAL? GL-PLACE-CUR,RM-221B-BAKER-ST,RM-TRAFALGAR-SQUARE,RM-PINCHIN-LANE /?L42
	EQUAL? GL-PLACE-CUR,RM-SWAN-LANE \?L41
?L42:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \FALSE
	EQUAL? GL-PLACE-CUR,RM-SWAN-LANE \FALSE
	PRINT K-SIGN-HERE-MSG
	RTRUE
?L41:	ZERO? ADJ \?L56
	RANDOM 4 >ADJ
	EQUAL? ADJ,1 \?L52
	SET 'ADJ,W?NORTH
	JUMP ?L56
?L52:	EQUAL? ADJ,2 \?L54
	SET 'ADJ,W?SOUTH
	JUMP ?L56
?L54:	EQUAL? ADJ,3 \?L55
	SET 'ADJ,W?EAST
	JUMP ?L56
?L55:	SET 'ADJ,W?WEST
?L56:	FSET? GL-PLACE-CUR,FL-INDOORS \?L58
	EQUAL? ADJ,W?NORTH \?L60
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \FALSE
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \FALSE
	PRINTI "There is a large fireplace set into the north wall."
	RTRUE
?L60:	EQUAL? ADJ,W?SOUTH \FALSE
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \FALSE
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \FALSE
	PRINTR "There is a patriotic ""V.R."" spelled out in bullet marks on the south wall."
?L58:	PRINT K-NOT-SEE-HERE-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-CROWDS,CONTEXT
	ASSIGNED? 'CONTEXT /?L29
	SET 'CONTEXT,0
?L29:	FSET? GL-PLACE-CUR,FL-INDOORS \?L4
	EQUAL? GL-PLACE-CUR,RM-BRITISH-MUSEUM \?L3
?L4:	FSET? GL-PLACE-CUR,FL-NO-CROWDS \?L1
?L3:	PRINTR "At last you've found some respite from the crowds."
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L6
	EQUAL? GL-PLACE-CUR,RM-FLEET-STREET \?L8
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L10
	PRINTR "They're all inside, hard at work."
?L10:	PRINTR "They hurry past you, intent on getting to their offices."
?L8:	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L13
	PRINTR "There are no crowds here. They're all asleep."
?L13:	EQUAL? GL-PLACE-CUR,RM-TOTTENHAM-COURT-RD,RM-OXFORD-ST \?L14
	PRINTI "The shoppers don't appear happy that the shops are closed."
	RTRUE
?L14:	EQUAL? GL-PLACE-CUR,RM-TRAFALGAR-SQUARE \?L15
	PRINTR "The people are happily feeding the pigeons."
?L15:	EQUAL? GL-PLACE-CUR,RM-GROSVENOR-PLACE \?L16
	PRINTR "The people are anxiously consulting their sight-seeing maps."
?L16:	EQUAL? GL-PLACE-CUR,RM-THE-STRAND \?L17
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L18
	PRINTR "The theatre goers are happily discussing the evening's entertainment."
?L18:	PRINTR "The crowds are trying to select a show to attend this evening."
?L17:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,2 \?L22
	PRINTR "They surge around you, excited about the sight-seeing they have planned for today."
?L22:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L24
	PRINTR "They nearly trample you in their eagerness to get back to their hotels before darkness falls."
?L24:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1 \TRUE
	PRINTR "They surge around you, intent on their sight-seeing."
?L6:	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \FALSE
	PRINTR "There are no tourists here. They're all asleep."

	.FUNCT RT-AC-CH-HANSOM-CABBIE,CONTEXT
	ASSIGNED? 'CONTEXT /?L17
	SET 'CONTEXT,0
?L17:	EQUAL? CONTEXT,K-M-WINNER \?L1
	EQUAL? GL-PRSA,V?WAIT \?L3
	SET 'GL-WHERE-TO-PROMPT?,0
	SET 'GL-WHERE-TO-ORPH?,0
	PRINTI """Right-o."""
	CRLF
	SET 'TH-HANSOM-CAB-AUX2,1
	ICALL2 RT-ALARM-CLR,RT-I-HANSOM-LEAVE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,30,0 >STACK
	CALL RT-ALARM-SET-REL,RT-I-HANSOM-LEAVE,STACK >STACK
	RSTACK
?L3:	EQUAL? GL-PRSA,V?DRIVE,V?WALK-TO \?L5
	CALL1 RT-CF-TH-HANSOM-CAB >STACK
	RSTACK
?L5:	EQUAL? GL-PRSA,V?HELLO,V?GOODBYE,V?THANK \?L6
	SET 'GL-WINNER,CH-PLAYER
	CALL RT-PERFORM,GL-PRSA,CH-HANSOM-CABBIE >STACK
	RSTACK
?L6:	PRINTR """Sorry, guv. All I does is drives a cab."""
?L1:	EQUAL? GL-PRSA,V?PAY \?L10
	ZERO? GL-NOW-PRSI? /?L9
?L10:	EQUAL? GL-PRSA,V?GIVE \?L8
	ZERO? GL-NOW-PRSI? /?L8
	FSET? GL-PRSO,FL-MONEY \?L8
?L9:	PRINTI """No thanks, guv'nor. It'll go on Mr 'Olmes's monthly account."""
	CRLF
	CALL2 PRINT-ID,STR?415 >STACK
	RSTACK
?L8:	EQUAL? GL-PRSA,V?TELL \?L11
	ZERO? GL-NOW-PRSI? \?L11
	ZERO? GL-P-CONT \FALSE
?L11:	EQUAL? GL-PRSA,V?HELLO \?L12
	PRINTR """'Ello."""
?L12:	EQUAL? GL-PRSA,V?GOODBYE \?L13
	PRINTR """Ta ta."""
?L13:	EQUAL? GL-PRSA,V?THANK \?L14
	PRINTR """Anytime, mate."""
?L14:	CALL1 RT-TALK-VERB? >STACK
	ZERO? STACK /FALSE
	PRINTR """Sorry, sir. No time to chat."""

	.FUNCT RT-AC-CH-GROWLER-CABBIE,CONTEXT
	ASSIGNED? 'CONTEXT /?L13
	SET 'CONTEXT,0
?L13:	EQUAL? CONTEXT,K-M-WINNER \?L1
	EQUAL? GL-PRSA,V?WAIT \?L3
	SET 'GL-WHERE-TO-PROMPT?,0
	SET 'GL-WHERE-TO-ORPH?,0
	ICALL2 RT-CTHEO-PRINT,CH-GROWLER-CABBIE
	PRINTR " says brightly, ""Okay."""
?L3:	EQUAL? GL-PRSA,V?DRIVE,V?WALK-TO \?L5
	CALL1 RT-CF-TH-GROWLER-CAB >STACK
	RSTACK
?L5:	ICALL2 RT-CTHEO-PRINT,CH-GROWLER-CABBIE
	PRINTR " says brightly, ""Hello,"" and looks at you expectantly."
?L1:	EQUAL? GL-PRSA,V?PAY \?L9
	ZERO? GL-NOW-PRSI? /?L8
?L9:	EQUAL? GL-PRSA,V?GIVE \?L7
	ZERO? GL-NOW-PRSI? /?L7
	FSET? GL-PRSO,FL-MONEY \?L7
?L8:	ICALL2 RT-CTHEO-PRINT,CH-GROWLER-CABBIE
	PRINTI " says brightly, ""No thanks. I'm not in it for the money. I just like to meet new people."""
	CRLF
	CALL2 PRINT-ID,STR?416 >STACK
	RSTACK
?L7:	EQUAL? GL-PRSA,V?TELL \?L10
	ZERO? GL-NOW-PRSI? \?L10
	ZERO? GL-P-CONT \FALSE
?L10:	CALL1 RT-TALK-VERB? >STACK
	ZERO? STACK /FALSE
	ICALL2 RT-CTHEO-PRINT,CH-GROWLER-CABBIE
	PRINTR " says brightly, ""Hello,"" and looks at you expectantly."

	.FUNCT RT-GET-ROOM-ID,HERE,TBL
	INTBL? HERE,CAB-ROOM-IDS,CAB-ROOM-IDS-LEN,1 >TBL \FALSE
	LESS? CAB-ROOM-IDS,0 \?L3
	SUB TBL,CAB-ROOM-IDS >STACK
	INC 'STACK
	RSTACK
?L3:	SUB CAB-ROOM-IDS,TBL >STACK
	INC 'STACK
	RSTACK

	.FUNCT RT-CAB-DIST,HERE,THERE,NUM1,NUM2,PTR,TMP
	SET 'PTR,0
	CALL2 RT-GET-ROOM-ID,HERE >NUM1
	CALL2 RT-GET-ROOM-ID,THERE >NUM2
	EQUAL? HERE,THERE /FALSE
	EQUAL? NUM1,NUM2 /FALSE
	LESS? NUM1,NUM2 \?L5
	SET 'TMP,NUM1
	SET 'NUM1,NUM2
	SET 'NUM2,TMP
?L5:	SUB NUM1,2 >NUM1
?L8:	LESS? NUM1,1 /?L9
	ADD PTR,NUM1 >PTR
	DEC 'NUM1
	JUMP ?L8
?L9:	SUB NUM2,1 >STACK
	ADD PTR,STACK >PTR
	GETB GL-CAB-DIST-TBL,PTR >STACK
	RSTACK

	.FUNCT RT-I-CAB-ARRIVE,CAB,PLACE,NUM,SCORE,AUX1
	SET 'CAB,0
	SET 'PLACE,0
	SET 'NUM,TH-CAB-WHISTLE-AUX1
	SET 'PLACE,TH-CAB-WHISTLE-AUX2
	SET 'TH-CAB-WHISTLE-AUX1,0
	SET 'TH-CAB-WHISTLE-AUX2,0
	EQUAL? GL-PLACE-CUR,PLACE \FALSE
	EQUAL? GL-PRSA,V?WALK /FALSE
	EQUAL? NUM,1 \?L3
	SET 'CAB,TH-GROWLER-CAB
	SET 'SCORE,0
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,5,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-GROWLER-LEAVE,STACK
	ICALL2 RT-REMOVE-ALL,TH-GROWLER-CAB
	MOVE CH-GROWLER-CABBIE,TH-GROWLER-CAB
	FSET CH-GROWLER-CABBIE,FL-SEEN
	JUMP ?L6
?L3:	EQUAL? NUM,2 \FALSE
	SET 'CAB,TH-HANSOM-CAB
	SET 'SCORE,5
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,5,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-HANSOM-LEAVE,STACK
	ICALL2 RT-REMOVE-ALL,TH-HANSOM-CAB
	MOVE CH-HANSOM-CABBIE,TH-HANSOM-CAB
	FSET CH-HANSOM-CABBIE,FL-SEEN
?L6:	ZERO? SOUND-QUEUED? \?L7
	SET 'CAB-RAMP,2
	ICALL1 RT-S-CAB-ARRIVES
?L7:	CRLF
	PRINTI "A "
	ICALL2 DPRINT,CAB
	PRINTI " pulls up beside you."
	CRLF
	MOVE CAB,GL-PLACE-CUR
	EQUAL? CAB,TH-HANSOM-CAB \?L10
	SET 'AUX1,TH-HANSOM-CAB-AUX1
	JUMP ?L12
?L10:	SET 'AUX1,TH-GROWLER-CAB-AUX1
?L12:	ZERO? AUX1 \TRUE
	EQUAL? CAB,TH-HANSOM-CAB \?L15
	SET 'TH-HANSOM-CAB-AUX1,1
	JUMP ?L17
?L15:	SET 'TH-GROWLER-CAB-AUX1,1
?L17:	ZERO? SCORE /TRUE
	ICALL2 RT-UPDATE-SCORE,SCORE
	RTRUE

	.FUNCT RT-I-HANSOM-LEAVE
	EQUAL? GL-PLACE-CUR,RM-VICTORIA-SQUARE /?L1
	CALL2 RT-VISIBLE?,TH-HANSOM-CAB >STACK
	ZERO? STACK /?L3
	ICALL1 RT-S-CAB-LEAVES
	ICALL2 RT-CTHEO-PRINT,TH-HANSOM-CAB
	PRINTI " drives off."
	CRLF
?L3:	MOVE TH-HANSOM-CAB,RM-VICTORIA-SQUARE
	ICALL2 RT-REMOVE-ALL,TH-HANSOM-CAB
	MOVE CH-HANSOM-CABBIE,TH-HANSOM-CAB
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
?L1:	SET 'TH-HANSOM-CAB-AUX2,0
	RFALSE

	.FUNCT RT-I-HANSOM-TO?
	IN? CH-PLAYER,TH-HANSOM-CAB \FALSE
	PRINTI """Where to mister?"""
	CRLF
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	CALL RT-ALARM-SET-REL,RT-I-HANSOM-TO?,STACK >STACK
	RSTACK

	.FUNCT RT-I-GROWLER-LEAVE
	EQUAL? GL-PLACE-CUR,RM-OXFORD-ST /FALSE
	CALL2 RT-VISIBLE?,TH-GROWLER-CAB >STACK
	ZERO? STACK /?L3
	ICALL1 RT-S-CAB-LEAVES
	ICALL2 RT-CTHEO-PRINT,TH-GROWLER-CAB
	PRINTI " drives off."
	CRLF
?L3:	MOVE TH-GROWLER-CAB,RM-OXFORD-ST
	ICALL2 RT-REMOVE-ALL,TH-GROWLER-CAB
	MOVE CH-GROWLER-CABBIE,TH-GROWLER-CAB
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
	RFALSE

	.FUNCT RT-I-GROWLER-TO?
	IN? CH-PLAYER,TH-GROWLER-CAB \FALSE
	CRLF
	PRINTI "Suddenly the cabbie - who seems to have a low threshold of boredom - pipes up and says, ""I know where we can go!"""
	CRLF
	CRLF
	PRINT K-WILD-RIDE-MSG
	CRLF
	ICALL1 RT-MOVE-GROWLER
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,5,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-GROWLER-TO?,STACK
	CRLF
	CALL1 RT-DESC-ALL >STACK
	RSTACK

	.FUNCT RT-MOVE-HANSOM,ROOM,MIN
	ASSIGNED? 'ROOM /?L14
	SET 'ROOM,0
?L14:	EQUAL? GL-PLACE-CUR,ROOM \?L1
	PRINTR """We're already here, guv."""
?L1:	ZERO? ROOM /FALSE
	SET 'GL-WHERE-TO-PROMPT?,0
	SET 'GL-WHERE-TO-ORPH?,0
	CALL RT-CAB-DIST,GL-PLACE-CUR,ROOM >STACK
	MUL STACK,K-HANSOM-TIME >MIN
	PRINTI """Right-o."""
	CRLF
	CRLF
	MOVE TH-HANSOM-CAB,ROOM
	SET 'GL-PLACE-PRV,GL-PLACE-CUR
	SET 'GL-PLACE-CUR,ROOM
	IN? CH-PLAYER,TH-HANSOM-CAB \?L4
	SET 'GL-PUPPY-MSG?,0
	EQUAL? ROOM,RM-COVENT-GARDEN \?L6
	SET 'LOOPING?,S-CROWD
	SET 'LOOP-VOL,8
	JUMP ?L8
?L6:	SET 'LOOPING?,0
?L8:	IXCALL SOUNDS,S-HORSE,S-START,4,6
	PRINTI "The cab speeds through the streets, "
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L9
	PRINTI "deftly weaving in and out of the jubilee traffic and "
?L9:	PRINTI "whizzing past famous landmarks. Only a few minutes later, you arrive at your destination."
	CRLF
	CRLF
	ICALL1 RT-DESC-ALL
	JUMP ?L12
?L4:	ICALL1 RT-S-CAB-LEAVES
	PRINTI "The cab drives off."
	CRLF
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,30,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-HANSOM-LEAVE,STACK
?L12:	ICALL2 RT-ALARM-CLR,RT-I-HANSOM-LEAVE
	ICALL RT-CLOCK-JMP,0,MIN,0
	RTRUE

	.FUNCT RT-MOVE-GROWLER,ROOM,NUM,MIN
	RANDOM 37 >NUM
	EQUAL? NUM,1 \?L1
	SET 'ROOM,RM-AUDLEY-ST
	JUMP ?L38
?L1:	EQUAL? NUM,2 \?L3
	SET 'ROOM,RM-221B-BAKER-ST
	JUMP ?L38
?L3:	EQUAL? NUM,3 \?L4
	SET 'ROOM,RM-BIRDCAGE-WALK
	JUMP ?L38
?L4:	EQUAL? NUM,5 \?L5
	SET 'ROOM,RM-BROAD-SANCTUARY
	JUMP ?L38
?L5:	EQUAL? NUM,6 \?L6
	SET 'ROOM,RM-BUCKINGHAM-PALACE-RD
	JUMP ?L38
?L6:	EQUAL? NUM,7 \?L7
	SET 'ROOM,RM-CHEAPSIDE
	JUMP ?L38
?L7:	EQUAL? NUM,8 \?L8
	SET 'ROOM,RM-COVENT-GARDEN
	JUMP ?L38
?L8:	EQUAL? NUM,9 \?L9
	SET 'ROOM,RM-THE-EMBANKMENT
	JUMP ?L38
?L9:	EQUAL? NUM,10 \?L10
	SET 'ROOM,RM-FLEET-STREET
	JUMP ?L38
?L10:	EQUAL? NUM,11 \?L11
	SET 'ROOM,RM-GREAT-RUSSELL-ST
	JUMP ?L38
?L11:	EQUAL? NUM,12 \?L12
	SET 'ROOM,RM-GROSVENOR-PLACE
	JUMP ?L38
?L12:	EQUAL? NUM,13 \?L13
	SET 'ROOM,RM-HYDE-PARK-CORNER
	JUMP ?L38
?L13:	EQUAL? NUM,14 \?L14
	SET 'ROOM,RM-KENSINGTON-GARDENS
	JUMP ?L38
?L14:	EQUAL? NUM,15 \?L15
	SET 'ROOM,RM-KING-WILLIAM-ST
	JUMP ?L38
?L15:	EQUAL? NUM,16 \?L16
	SET 'ROOM,RM-LONDON-BRIDGE
	JUMP ?L38
?L16:	EQUAL? NUM,17 \?L17
	SET 'ROOM,RM-LOWER-THAMES-ST
	JUMP ?L38
?L17:	EQUAL? NUM,18 \?L18
	SET 'ROOM,RM-THE-MALL
	JUMP ?L38
?L18:	EQUAL? NUM,19 \?L19
	SET 'ROOM,RM-MARYLEBONE-RD
	JUMP ?L38
?L19:	EQUAL? NUM,20 \?L20
	SET 'ROOM,RM-MONUMENT
	JUMP ?L38
?L20:	EQUAL? NUM,21 \?L21
	SET 'ROOM,RM-NEW-OXFORD-ST
	JUMP ?L38
?L21:	EQUAL? NUM,22 \?L22
	SET 'ROOM,RM-OXFORD-ST
	JUMP ?L38
?L22:	EQUAL? NUM,23 \?L23
	SET 'ROOM,RM-ORCHARD-ST
	JUMP ?L38
?L23:	EQUAL? NUM,24 \?L24
	SET 'ROOM,RM-PARLIAMENT-SQUARE
	JUMP ?L38
?L24:	EQUAL? NUM,25 \?L25
	SET 'ROOM,RM-PINCHIN-LANE
	JUMP ?L38
?L25:	EQUAL? NUM,26 \?L26
	SET 'ROOM,RM-QUEENS-GARDENS
	JUMP ?L38
?L26:	EQUAL? NUM,27 \?L27
	SET 'ROOM,RM-ST-GILES-CIRCUS
	JUMP ?L38
?L27:	EQUAL? NUM,28 \?L28
	SET 'ROOM,RM-THE-STRAND
	JUMP ?L38
?L28:	EQUAL? NUM,29 \?L29
	SET 'ROOM,RM-THREADNEEDLE-ST
	JUMP ?L38
?L29:	EQUAL? NUM,30 \?L30
	SET 'ROOM,RM-TOTTENHAM-COURT-RD
	JUMP ?L38
?L30:	EQUAL? NUM,31 \?L31
	SET 'ROOM,RM-TOWER-ENTRANCE
	JUMP ?L38
?L31:	EQUAL? NUM,32 \?L32
	SET 'ROOM,RM-TRAFALGAR-SQUARE
	JUMP ?L38
?L32:	EQUAL? NUM,33 \?L33
	SET 'ROOM,RM-UPPER-THAMES-ST
	JUMP ?L38
?L33:	EQUAL? NUM,34 \?L34
	SET 'ROOM,RM-VICTORIA-STREET
	JUMP ?L38
?L34:	EQUAL? NUM,35 \?L35
	SET 'ROOM,RM-VICTORIA-SQUARE
	JUMP ?L38
?L35:	EQUAL? NUM,36 \?L36
	SET 'ROOM,RM-WHITEHALL
	JUMP ?L38
?L36:	EQUAL? NUM,37 \?L37
	SET 'ROOM,RM-YORK-PLACE
	JUMP ?L38
?L37:	PRINTI "This is odd..."
	CRLF
	CRLF
	SET 'ROOM,RM-KENSINGTON-GARDENS
?L38:	CALL RT-CAB-DIST,GL-PLACE-CUR,ROOM >STACK
	MUL STACK,K-GROWLER-TIME >MIN
	EQUAL? ROOM,RM-COVENT-GARDEN \?L39
	SET 'LOOPING?,S-CROWD
	SET 'LOOP-VOL,8
	JUMP ?L41
?L39:	SET 'LOOPING?,0
?L41:	IXCALL SOUNDS,S-HORSE,S-START,4,6
	MOVE TH-GROWLER-CAB,ROOM
	SET 'GL-PLACE-PRV,GL-PLACE-CUR
	SET 'GL-PLACE-CUR,ROOM
	SET 'GL-PUPPY-MSG?,0
	CALL RT-CLOCK-JMP,0,MIN,0 >STACK
	RSTACK

	.FUNCT RT-CF-TH-HANSOM-CAB,CONTEXT,WRD,ADJ
	ASSIGNED? 'CONTEXT /?L68
	SET 'CONTEXT,0
?L68:	IN? CH-PLAYER,TH-HANSOM-CAB \?L1
	SET 'GL-WHERE-TO-PROMPT?,1
	SET 'GL-WHERE-TO-ORPH?,1
?L1:	EQUAL? GL-PRSA,V?WALK \?L8
	EQUAL? GL-P-WALK-DIR,P?OUT \?L4
	CALL RT-PERFORM,V?EXIT,TH-HANSOM-CAB >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?WALK \?L8
	EQUAL? GL-WINNER,CH-PLAYER /?L7
?L8:	EQUAL? GL-PRSA,V?ENTER \?L6
	EQUAL? GL-PRSO,TH-HANSOM-CAB /?L6
?L7:	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?417,TH-HANSOM-CAB
	PRINTR " first."
?L6:	EQUAL? GL-PRSA,V?DRIVE,V?WALK-TO \?L9
	GET GL-P-NAMW,0 >WRD
	GET GL-P-ADJW,0 >ADJ
	EQUAL? GL-PRSO,RM-AUDLEY-ST \?L10
	CALL2 RT-MOVE-HANSOM,RM-AUDLEY-ST >STACK
	RSTACK
?L10:	EQUAL? GL-PRSO,RM-221B-BAKER-ST,RM-ENTRY-HALL \?L12
	CALL2 RT-MOVE-HANSOM,RM-221B-BAKER-ST >STACK
	RSTACK
?L12:	EQUAL? GL-PRSO,RM-BIRDCAGE-WALK \?L13
	CALL2 RT-MOVE-HANSOM,RM-BIRDCAGE-WALK >STACK
	RSTACK
?L13:	EQUAL? GL-PRSO,RM-BROAD-SANCTUARY,LG-TOMBS-ABBEY \?L14
	CALL2 RT-MOVE-HANSOM,RM-BROAD-SANCTUARY >STACK
	RSTACK
?L14:	EQUAL? GL-PRSO,RM-BUCKINGHAM-PALACE-RD \?L15
	CALL2 RT-MOVE-HANSOM,RM-BUCKINGHAM-PALACE-RD >STACK
	RSTACK
?L15:	EQUAL? GL-PRSO,RM-CHEAPSIDE \?L16
	CALL2 RT-MOVE-HANSOM,RM-CHEAPSIDE >STACK
	RSTACK
?L16:	EQUAL? GL-PRSO,RM-COVENT-GARDEN \?L17
	CALL2 RT-MOVE-HANSOM,RM-COVENT-GARDEN >STACK
	RSTACK
?L17:	EQUAL? GL-PRSO,RM-THE-EMBANKMENT,LG-WATER \?L18
	CALL2 RT-MOVE-HANSOM,RM-THE-EMBANKMENT >STACK
	RSTACK
?L18:	EQUAL? GL-PRSO,RM-FLEET-STREET \?L19
	CALL2 RT-MOVE-HANSOM,RM-FLEET-STREET >STACK
	RSTACK
?L19:	EQUAL? GL-PRSO,RM-GREAT-RUSSELL-ST,RM-BRITISH-MUSEUM \?L20
	CALL2 RT-MOVE-HANSOM,RM-GREAT-RUSSELL-ST >STACK
	RSTACK
?L20:	EQUAL? GL-PRSO,RM-GROSVENOR-PLACE \?L21
	CALL2 RT-MOVE-HANSOM,RM-GROSVENOR-PLACE >STACK
	RSTACK
?L21:	EQUAL? GL-PRSO,RM-HYDE-PARK-CORNER \?L22
	CALL2 RT-MOVE-HANSOM,RM-HYDE-PARK-CORNER >STACK
	RSTACK
?L22:	EQUAL? GL-PRSO,RM-KENSINGTON-GARDENS \?L23
	CALL2 RT-MOVE-HANSOM,RM-KENSINGTON-GARDENS >STACK
	RSTACK
?L23:	EQUAL? GL-PRSO,RM-KING-WILLIAM-ST \?L24
	CALL2 RT-MOVE-HANSOM,RM-KING-WILLIAM-ST >STACK
	RSTACK
?L24:	EQUAL? GL-PRSO,RM-LONDON-BRIDGE \?L25
	CALL2 RT-MOVE-HANSOM,RM-LONDON-BRIDGE >STACK
	RSTACK
?L25:	EQUAL? GL-PRSO,RM-LOWER-THAMES-ST,RM-BAR-OF-GOLD,RM-SWAN-LANE \?L26
	CALL2 RT-MOVE-HANSOM,RM-LOWER-THAMES-ST >STACK
	RSTACK
?L26:	EQUAL? GL-PRSO,RM-THE-MALL \?L27
	CALL2 RT-MOVE-HANSOM,RM-THE-MALL >STACK
	RSTACK
?L27:	EQUAL? GL-PRSO,RM-MARYLEBONE-RD,RM-MADAME-TUSSAUDS \?L28
	CALL2 RT-MOVE-HANSOM,RM-MARYLEBONE-RD >STACK
	RSTACK
?L28:	EQUAL? WRD,W?MONUMENT \?L31
	ZERO? ADJ /?L30
?L31:	EQUAL? GL-PRSO,RM-MONUMENT \?L29
?L30:	CALL2 RT-MOVE-HANSOM,RM-MONUMENT >STACK
	RSTACK
?L29:	EQUAL? GL-PRSO,RM-NEW-OXFORD-ST \?L32
	CALL2 RT-MOVE-HANSOM,RM-NEW-OXFORD-ST >STACK
	RSTACK
?L32:	EQUAL? WRD,W?STREET,W?ST \?L35
	EQUAL? ADJ,W?OXFORD /?L34
?L35:	EQUAL? GL-PRSO,RM-OXFORD-ST \?L33
?L34:	CALL2 RT-MOVE-HANSOM,RM-OXFORD-ST >STACK
	RSTACK
?L33:	EQUAL? GL-PRSO,RM-ORCHARD-ST \?L36
	CALL2 RT-MOVE-HANSOM,RM-ORCHARD-ST >STACK
	RSTACK
?L36:	EQUAL? GL-PRSO,RM-PARLIAMENT-SQUARE,RM-PARLIAMENT,TH-BELL \?L37
	CALL2 RT-MOVE-HANSOM,RM-PARLIAMENT-SQUARE >STACK
	RSTACK
?L37:	EQUAL? GL-PRSO,RM-PINCHIN-LANE,RM-SHERMANS-HOUSE \?L38
	CALL2 RT-MOVE-HANSOM,RM-PINCHIN-LANE >STACK
	RSTACK
?L38:	EQUAL? GL-PRSO,RM-QUEENS-GARDENS,RM-BUCKINGHAM-PALACE \?L39
	CALL2 RT-MOVE-HANSOM,RM-QUEENS-GARDENS >STACK
	RSTACK
?L39:	EQUAL? GL-PRSO,RM-ST-GILES-CIRCUS \?L40
	CALL2 RT-MOVE-HANSOM,RM-ST-GILES-CIRCUS >STACK
	RSTACK
?L40:	EQUAL? GL-PRSO,RM-THE-STRAND \?L41
	CALL2 RT-MOVE-HANSOM,RM-THE-STRAND >STACK
	RSTACK
?L41:	EQUAL? GL-PRSO,RM-THREADNEEDLE-ST,RM-BANK-OF-ENGLAND \?L42
	CALL2 RT-MOVE-HANSOM,RM-THREADNEEDLE-ST >STACK
	RSTACK
?L42:	EQUAL? GL-PRSO,RM-TOTTENHAM-COURT-RD \?L43
	CALL2 RT-MOVE-HANSOM,RM-TOTTENHAM-COURT-RD >STACK
	RSTACK
?L43:	EQUAL? WRD,W?TOWER /?L45
	EQUAL? GL-PRSO,RM-TOWER-ENTRANCE,LG-TOWER,RM-DRAWBRIDGE \?L44
?L45:	CALL2 RT-MOVE-HANSOM,RM-TOWER-ENTRANCE >STACK
	RSTACK
?L44:	EQUAL? GL-PRSO,RM-TRAFALGAR-SQUARE,RM-DIOGENES-CLUB \?L46
	CALL2 RT-MOVE-HANSOM,RM-TRAFALGAR-SQUARE >STACK
	RSTACK
?L46:	EQUAL? GL-PRSO,RM-UPPER-THAMES-ST \?L47
	CALL2 RT-MOVE-HANSOM,RM-UPPER-THAMES-ST >STACK
	RSTACK
?L47:	EQUAL? GL-PRSO,RM-VICTORIA-STREET \?L48
	CALL2 RT-MOVE-HANSOM,RM-VICTORIA-STREET >STACK
	RSTACK
?L48:	EQUAL? GL-PRSO,RM-VICTORIA-SQUARE \?L49
	CALL2 RT-MOVE-HANSOM,RM-VICTORIA-SQUARE >STACK
	RSTACK
?L49:	EQUAL? GL-PRSO,RM-WHITEHALL,RM-SCOTLAND-YARD \?L50
	CALL2 RT-MOVE-HANSOM,RM-WHITEHALL >STACK
	RSTACK
?L50:	EQUAL? GL-PRSO,RM-YORK-PLACE \FALSE
	CALL2 RT-MOVE-HANSOM,RM-YORK-PLACE >STACK
	RSTACK
?L9:	EQUAL? GL-PRSA,V?STAND,V?STAND-ON,V?LEAP \?L53
	PRINT K-ENOUGH-ROOM-MSG
	CRLF
	RTRUE
?L53:	EQUAL? GL-PRSA,V?SIT \?L54
	PRINTR "You're already seated."
?L54:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	EQUAL? GL-PRSO,0,ROOMS /?L59
	IN? GL-PRSO,GLOBAL-OBJECTS /?L59
	CALL RT-META-IN?,GL-PRSO,TH-HANSOM-CAB >STACK
	ZERO? STACK \?L59
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot reach "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L59:	EQUAL? GL-PRSI,0,ROOMS /FALSE
	IN? GL-PRSI,GLOBAL-OBJECTS /FALSE
	FSET? GL-PRSI,FL-PERSON \?L64
	IN? GL-PRSI,GL-PLACE-CUR /FALSE
?L64:	CALL RT-META-IN?,GL-PRSI,TH-HANSOM-CAB >STACK
	ZERO? STACK \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot reach "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT RT-CF-TH-GROWLER-CAB,CONTEXT
	ASSIGNED? 'CONTEXT /?L27
	SET 'CONTEXT,0
?L27:	IN? CH-PLAYER,TH-GROWLER-CAB \?L1
	SET 'GL-WHERE-TO-PROMPT?,1
	SET 'GL-WHERE-TO-ORPH?,1
?L1:	EQUAL? GL-PRSA,V?WALK \?L8
	EQUAL? GL-P-WALK-DIR,P?OUT \?L4
	CALL RT-PERFORM,V?EXIT,TH-GROWLER-CAB >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?WALK \?L8
	EQUAL? GL-WINNER,CH-PLAYER /?L7
?L8:	EQUAL? GL-PRSA,V?ENTER \?L6
	EQUAL? GL-PRSO,TH-GROWLER-CAB /?L6
?L7:	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?417,TH-GROWLER-CAB
	PRINTR " first."
?L6:	EQUAL? GL-PRSA,V?DRIVE,V?WALK-TO \?L9
	PRINTI """Oh good! I've never been THERE before."""
	CRLF
	CRLF
	SET 'GL-WHERE-TO-PROMPT?,0
	SET 'GL-WHERE-TO-ORPH?,0
	ICALL2 RT-ALARM-CLR,RT-I-GROWLER-TO?
	ICALL2 RT-ALARM-CLR,RT-I-GROWLER-LEAVE
	ICALL1 RT-MOVE-GROWLER
	IN? CH-PLAYER,TH-GROWLER-CAB \?L10
	SET 'GL-PUPPY-MSG?,0
	PRINT K-WILD-RIDE-MSG
	CRLF
	CRLF
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,5,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-GROWLER-TO?,STACK
	ICALL1 RT-DESC-ALL
	RTRUE
?L10:	PRINTI "The cab drives off."
	CRLF
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,30,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-GROWLER-LEAVE,STACK
	RTRUE
?L9:	EQUAL? GL-PRSA,V?STAND,V?STAND-ON,V?LEAP \?L13
	PRINT K-ENOUGH-ROOM-MSG
	CRLF
	RTRUE
?L13:	EQUAL? GL-PRSA,V?SIT \?L14
	PRINTR "You're already seated."
?L14:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	EQUAL? GL-PRSO,0,ROOMS /?L19
	IN? GL-PRSO,GLOBAL-OBJECTS /?L19
	CALL RT-META-IN?,GL-PRSO,TH-GROWLER-CAB >STACK
	ZERO? STACK \?L19
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot reach "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L19:	EQUAL? GL-PRSI,0,ROOMS /FALSE
	IN? GL-PRSI,GLOBAL-OBJECTS /FALSE
	CALL RT-META-IN?,GL-PRSI,TH-GROWLER-CAB >STACK
	ZERO? STACK \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot reach "
	ICALL1 RT-THEI-PRINT
	PRINTR "."

	.FUNCT RT-BLOW-WHISTLE,WHO,WHO2,L
	LOC TH-GROWLER-CAB >STACK
	LOC TH-HANSOM-CAB >STACK
	EQUAL? GL-PLACE-CUR,STACK,STACK \?L1
	PRINT K-CAB-HERE-MSG
	CRLF
	RTRUE
?L1:	PRINTI "Tweeeeeeeeee!"
	CRLF
	FSET? GL-PLACE-CUR,FL-INDOORS \?L4
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \?L6
	FSET? CH-HOLMES,FL-ASLEEP \?L6
	PRINT K-HOLMES-DISTRACTION-MSG
	CRLF
	RTRUE
?L6:	CALL1 RT-ANYONE-HERE? >WHO
	ZERO? WHO /TRUE
	LOC WHO >L
	REMOVE WHO
	CALL1 RT-ANYONE-HERE? >WHO2
	ZERO? WHO2 /?L11
	PRINTI "Everyone holds their hands to their "
	JUMP ?L13
?L11:	ICALL2 RT-CTHEO-PRINT,WHO
	PRINTI " hold"
	ICALL2 RT-S-NOS-MSG,WHO
	PRINTI " "
	ICALL2 RT-YOUR-MSG,WHO
	PRINTI "hands to "
	ICALL2 RT-YOUR-MSG,WHO
?L13:	MOVE WHO,L
	PRINTI "ears and glare"
	ICALL2 PRINT-ID,STR?418
	ICALL2 RT-S-NOS-MSG,WHO
	PRINTR " at you."
?L4:	EQUAL? GL-PLACE-CUR,RM-TOWER-GREEN,RM-OUTER-WARD,RM-BYWARD-TOWER /TRUE
	EQUAL? GL-PLACE-CUR,RM-INSIDE-TRAITORS-GATE,RM-OUTSIDE-TRAITORS-GATE,RM-DRAWBRIDGE /TRUE
	EQUAL? GL-PLACE-CUR,RM-THAMES-ONE,RM-THAMES-TWO,RM-THAMES-THREE /TRUE
	EQUAL? GL-PLACE-CUR,RM-THAMES-FOUR,RM-THAMES-FIVE,RM-SWAN-LANE /TRUE
	INC 'TH-CAB-WHISTLE-AUX1
	SET 'TH-CAB-WHISTLE-AUX2,GL-PLACE-CUR
	CALL2 RT-ALARM-SET?,RT-I-CAB-ARRIVE >STACK
	ZERO? STACK \TRUE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-CAB-ARRIVE,STACK
	RTRUE

	.FUNCT RT-AC-TH-HANSOM-CAB,CONTEXT
	ASSIGNED? 'CONTEXT /?L26
	SET 'CONTEXT,0
?L26:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It is a small cab with two wheels and room for only two persons, drawn by a single horse."
?L1:	EQUAL? GL-PRSA,V?ENTER \?L3
	EQUAL? GL-PRSO,ROOMS,TH-HANSOM-CAB \?L3
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L4
	PRINT K-HEAVY-ARMOUR-MSG
	CRLF
	RTRUE
?L4:	IN? GL-WINNER,TH-HANSOM-CAB /FALSE
	MOVE GL-WINNER,TH-HANSOM-CAB
	ZERO? GL-PUPPY /?L7
	EQUAL? GL-WINNER,CH-PLAYER \?L7
	MOVE GL-PUPPY,TH-HANSOM-CAB
	PRINTI "You and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L9
?L7:	ICALL RT-CYOU-MSG,STR?318,STR?317
?L9:	FSET TH-HANSOM-CAB,FL-NODESC
	ICALL2 RT-ALARM-CLR,RT-I-HANSOM-LEAVE
	SET 'TH-HANSOM-CAB-AUX2,0
	SET 'GL-WHERE-TO-PROMPT?,1
	SET 'GL-WHERE-TO-ORPH?,1
	PRINTR "into the cab."
?L3:	EQUAL? GL-PRSA,V?EXIT \?L11
	EQUAL? GL-PRSO,ROOMS,TH-HANSOM-CAB \?L11
	IN? CH-PLAYER,TH-HANSOM-CAB \FALSE
	MOVE GL-WINNER,GL-PLACE-CUR
	ZERO? GL-PUPPY /?L14
	EQUAL? GL-WINNER,CH-PLAYER \?L14
	MOVE GL-PUPPY,GL-PLACE-CUR
	PRINTI "You and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L16
?L14:	ICALL RT-CYOU-MSG,STR?318,STR?317
?L16:	PRINTI "out of the cab."
	FCLEAR TH-HANSOM-CAB,FL-NODESC
	ZERO? TH-HANSOM-CAB-AUX2 \?L17
	IN? CH-PLAYER,TH-HANSOM-CAB /?L17
	ZERO? GL-PUPPY /?L19
	IN? GL-PUPPY,TH-HANSOM-CAB /?L17
?L19:	EQUAL? GL-PLACE-CUR,RM-VICTORIA-SQUARE /?L17
	PRINTI " After"
	ICALL RT-YOU-MSG,STR?318,STR?317
	PRINTI "out, it drives off."
	ICALL1 RT-S-CAB-LEAVES
	MOVE TH-HANSOM-CAB,RM-VICTORIA-SQUARE
	ICALL2 RT-REMOVE-ALL,TH-HANSOM-CAB
	MOVE CH-HANSOM-CABBIE,TH-HANSOM-CAB
	ICALL2 RT-ALARM-CLR,RT-I-HANSOM-LEAVE
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
?L17:	SET 'GL-WHERE-TO-PROMPT?,0
	SET 'GL-WHERE-TO-ORPH?,0
	CRLF
	RTRUE
?L11:	EQUAL? GL-PRSA,V?LOOK-ON \?L22
	PRINTR "There is a cab driver sitting on the hansom."
?L22:	EQUAL? GL-PRSA,V?TAKE,V?PUSH-TO \?L23
	ZERO? GL-NOW-PRSI? \?L23
	PRINT K-TAKE-CAB-MSG
	CRLF
	RETURN 2
?L23:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?419
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-GROWLER-CAB,CONTEXT
	ASSIGNED? 'CONTEXT /?L26
	SET 'CONTEXT,0
?L26:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It is a large cab with four wheels and room for four persons, drawn by a single horse."
?L1:	EQUAL? GL-PRSA,V?ENTER \?L3
	EQUAL? GL-PRSO,ROOMS,TH-GROWLER-CAB \?L3
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L4
	PRINT K-HEAVY-ARMOUR-MSG
	CRLF
	RTRUE
?L4:	IN? GL-WINNER,TH-GROWLER-CAB /FALSE
	MOVE GL-WINNER,TH-GROWLER-CAB
	ZERO? GL-PUPPY /?L7
	EQUAL? GL-WINNER,CH-PLAYER \?L7
	MOVE GL-PUPPY,TH-GROWLER-CAB
	PRINTI "You and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L9
?L7:	ICALL RT-CYOU-MSG,STR?318,STR?317
?L9:	FSET TH-GROWLER-CAB,FL-NODESC
	ICALL2 RT-ALARM-CLR,RT-I-GROWLER-LEAVE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,5,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-GROWLER-TO?,STACK
	SET 'GL-WHERE-TO-PROMPT?,1
	SET 'GL-WHERE-TO-ORPH?,1
	PRINTR "into the cab."
?L3:	EQUAL? GL-PRSA,V?EXIT \?L11
	EQUAL? GL-PRSO,ROOMS,TH-GROWLER-CAB \?L11
	IN? CH-PLAYER,TH-GROWLER-CAB \FALSE
	MOVE GL-WINNER,GL-PLACE-CUR
	ZERO? GL-PUPPY /?L14
	EQUAL? GL-WINNER,CH-PLAYER \?L14
	MOVE GL-PUPPY,GL-PLACE-CUR
	PRINTI "You and "
	ICALL2 RT-THEO-PRINT,GL-PUPPY
	PRINTI " get "
	JUMP ?L16
?L14:	ICALL RT-CYOU-MSG,STR?318,STR?317
?L16:	PRINTI "out of the cab."
	FCLEAR TH-GROWLER-CAB,FL-NODESC
	IN? CH-PLAYER,TH-GROWLER-CAB /?L17
	ZERO? GL-PUPPY /?L19
	IN? GL-PUPPY,TH-GROWLER-CAB /?L17
?L19:	EQUAL? GL-PLACE-CUR,RM-OXFORD-ST /?L17
	PRINTI " After"
	ICALL RT-YOU-MSG,STR?318,STR?317
	PRINTI "out, it drives off."
	ICALL1 RT-S-CAB-LEAVES
	MOVE TH-GROWLER-CAB,RM-OXFORD-ST
	ICALL2 RT-REMOVE-ALL,TH-GROWLER-CAB
	MOVE CH-GROWLER-CABBIE,TH-GROWLER-CAB
	ICALL2 RT-ALARM-CLR,RT-I-GROWLER-LEAVE
	ICALL2 RT-ALARM-CLR,RT-I-GROWLER-TO?
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
?L17:	SET 'GL-WHERE-TO-PROMPT?,0
	SET 'GL-WHERE-TO-ORPH?,0
	CRLF
	RTRUE
?L11:	EQUAL? GL-PRSA,V?LOOK-ON \?L22
	PRINTR "There is a cab driver sitting on the growler."
?L22:	EQUAL? GL-PRSA,V?TAKE,V?PUSH-TO \?L23
	ZERO? GL-NOW-PRSI? \?L23
	PRINT K-TAKE-CAB-MSG
	CRLF
	RETURN 2
?L23:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?420
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-CAB-WHISTLE
	EQUAL? GL-PRSA,V?BLOW-INTO \?L1
	ZERO? GL-NOW-PRSI? \?L1
	CALL1 RT-BLOW-WHISTLE >STACK
	RSTACK
?L1:	EQUAL? GL-PRSA,V?CALL \?L3
	ZERO? GL-NOW-PRSI? /?L3
	EQUAL? GL-PRSO,TH-HANSOM-CAB \?L4
	ICALL1 RT-BLOW-WHISTLE
	CALL2 RT-ALARM-SET?,RT-I-CAB-ARRIVE >STACK
	ZERO? STACK /TRUE
	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,0,2,0
	ICALL1 RT-BLOW-WHISTLE
	RTRUE
?L4:	EQUAL? GL-PRSO,TH-GROWLER-CAB \?L9
	ICALL1 RT-BLOW-WHISTLE
	CALL2 RT-ALARM-SET?,RT-I-CAB-ARRIVE >STACK
	ZERO? STACK /TRUE
	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,0,2,0
	RTRUE
?L9:	GET GL-P-NAMW,0 >STACK
	EQUAL? STACK,W?CAB \?L13
	CALL1 RT-BLOW-WHISTLE >STACK
	RSTACK
?L13:	ICALL1 RT-CYOU-MSG
	PRINTI "can't "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-A-PRINT
	PRINTI " with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L3:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?421
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-EX-RM-EXIT-BYWARD-TOWER
	EQUAL? GL-PRSO,P?EAST,P?IN \?L1
	ZERO? ALLOW-IN-TOWER /?L3
	PRINTI "The guard nods as you pass."
	CRLF
	RETURN RM-OUTER-WARD
?L3:	PRINTI "The guard steps into your path and says, ""I am sorry but you cannot go in unless you can tell me the password."""
	CRLF
	RFALSE
?L1:	EQUAL? GL-PRSO,P?WEST,P?OUT \FALSE
	EQUAL? GL-PLACE-PRV,RM-DRAWBRIDGE \?L7
	RETURN RM-DRAWBRIDGE
?L7:	PRINTI "The guard blocks your path and says, ""I am sorry, but I am under strict orders not to allow anyone to leave the Tower."""
	CRLF
	RFALSE

	.FUNCT RT-AC-CH-TOWER-GUARD,CONTEXT
	ASSIGNED? 'CONTEXT /?L10
	SET 'CONTEXT,0
?L10:	EQUAL? CONTEXT,K-M-WINNER \?L1
	EQUAL? GL-PRSA,V?BOLEYN,V?CLEVES,V?HOWARD /FALSE
	EQUAL? GL-PRSA,V?PARR,V?ARAGON,V?SEYMOUR /FALSE
	EQUAL? GL-PRSA,V?PASSWORD /FALSE
	PRINTR "The guard stares at you impassively."
?L1:	ZERO? GL-NOW-PRSI? /FALSE
	RFALSE

	.FUNCT RT-AC-TH-MALMSEY
	ZERO? GL-NOW-PRSI? \FALSE
	SET 'GL-P-IT-OBJECT,TH-MALMSEY
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?DRINK,V?DRINK-FROM,V?EAT /?L9
	EQUAL? GL-PRSA,V?DRINK \?L7
?L9:	PRINT K-TIPSY-MSG
	CRLF
	CALL2 PRINT-ID,STR?422 >STACK
	RSTACK
?L7:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-BULLET-MSG
	ICALL2 PRINT-ID,STR?423
	CALL1 RT-EMPTY-BUTT-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-MALMSEY-POOL
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?DRINK,V?DRINK-FROM,V?EAT /?L6
	EQUAL? GL-PRSA,V?TASTE \?L4
?L6:	PRINTI "You get down on all fours and lap up some of the wine. Yuch!"
	CRLF
	CALL2 PRINT-ID,STR?424 >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?425
	CALL1 RT-WHY-SHOOT-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-BUTT-OF-MALMSEY,CONTEXT
	ASSIGNED? 'CONTEXT /?L26
	SET 'CONTEXT,0
?L26:	EQUAL? CONTEXT,K-M-SDESC \?L1
	FSET? TH-BUTT-OF-MALMSEY,FL-BROKEN \?L3
	PRINTI "empty "
?L3:	PRINTI "butt of malmsey"
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L9
	FSET? TH-BUTT-OF-MALMSEY,FL-BROKEN /FALSE
	PRINTR "It's an old wooden keg that's brimming over with malmsey and covered with stains where the wine has spilled down the sides and leaked through the bung."
?L9:	FSET? TH-BUTT-OF-MALMSEY,FL-BROKEN \?L11
	CALL1 RT-AC-TH-EMPTY-BUTT-OF-MALMSEY >STACK
	RSTACK
?L11:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?DRINK \?L15
	PRINT K-TIPSY-MSG
	CRLF
	CALL2 PRINT-ID,STR?426 >STACK
	RSTACK
?L15:	EQUAL? GL-PRSA,V?DRINK-FROM \?L17
	PRINTR "You take a sip. It tastes like Malmsey."
?L17:	EQUAL? GL-PRSA,V?FLIP,V?PUSH,V?TIP /?L19
	EQUAL? GL-PRSA,V?PUSH-TO,V?LOOSEN \?L18
?L19:	ICALL1 RT-CTHEO-PRINT
	PRINTI " is much too heavy to move."
	CRLF
	EQUAL? GL-PRSA,V?FLIP,V?TIP /?L20
	PUSH 0
	JUMP ?L21
?L20:	PUSH 1
?L21:	CALL PRINT-ID,STR?427,STACK >STACK
	RSTACK
?L18:	EQUAL? GL-PRSA,V?SHOOT \?L22
	PRINT K-BULLET-MSG
	ICALL2 PRINT-ID,STR?428
	CALL1 RT-EMPTY-BUTT-MSG >STACK
	RSTACK
?L22:	EQUAL? GL-PRSA,V?REACH-IN \FALSE
	ICALL RT-CYOU-MSG,STR?430,STR?429
	PRINTI "an arm down into the malmsey, but"
	ICALL2 PRINT-ID,STR?431
	ICALL RT-YOU-MSG,STR?433,STR?432,1
	PRINTR "up empty."

	.FUNCT RT-AC-TH-EMPTY-BUTT-OF-MALMSEY
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?DRINK,V?DRINK-FROM \?L4
	PRINTR "Too bad. All gone."
?L4:	EQUAL? GL-PRSA,V?FLIP \FALSE
	PRINTI "That would"
	CALL1 RT-WASTE-OF-TIME-MSG >STACK
	RSTACK

	.FUNCT RT-EMPTY-BUTT-MSG
	REMOVE TH-MALMSEY
	MOVE TH-GARNET,TH-BUTT-OF-MALMSEY
	MOVE TH-MALMSEY-POOL,RM-BOWYER-TOWER
	FSET TH-BUTT-OF-MALMSEY,FL-BROKEN
	MOVE TH-BUNG,RM-BOWYER-TOWER
	PRINTI " flies across the room and lands in the corner. "
	ICALL2 RT-CTHEO-PRINT,TH-MALMSEY
	PRINTR " streams out of the butt and across the floor. Soon the keg is completely empty, and there's wine all over the floor."

	.FUNCT RT-AC-TH-BUNG
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?TAKE,V?PULL,V?LOOSEN /?L6
	EQUAL? GL-PRSA,V?UNPLUG,V?RELEASE \?L4
?L6:	IN? TH-BUNG,TH-BUTT-OF-MALMSEY \FALSE
	PRINTR "You can't. It's jammed in too tight."
?L4:	EQUAL? GL-PRSA,V?PUT \?L10
	EQUAL? GL-PRSI,TH-BUTT-OF-MALMSEY \FALSE
	FSET? GL-PRSI,FL-BROKEN \FALSE
	PRINTR "Don't you think it's pretty pointless to try to stopper up an empty keg?"
?L10:	EQUAL? GL-PRSA,V?HIT \?L14
	IN? TH-BUNG,TH-BUTT-OF-MALMSEY \FALSE
	EQUAL? GL-PRSI,TH-HANDS \?L17
	PRINTR "Your hands aren't nearly strong enough to remove the stopper by themselves."
?L17:	EQUAL? GL-PRSI,TH-MACE \FALSE
	ICALL2 RT-CTHEO-PRINT,TH-BUNG
	CALL1 RT-EMPTY-BUTT-MSG >STACK
	RSTACK
?L14:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	IN? TH-BUNG,TH-BUTT-OF-MALMSEY \FALSE
	PRINT K-BULLET-MSG
	ICALL2 PRINT-ID,STR?434
	CALL1 RT-EMPTY-BUTT-MSG >STACK
	RSTACK

	.FUNCT RT-AC-TH-GARNET,CONTEXT
	ASSIGNED? 'CONTEXT /?L18
	SET 'CONTEXT,0
?L18:	GETP TH-GARNET,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?SCRATCH \?L1
	CALL RT-HANDLE-SCRATCH,TH-GARNET,CONTEXT >STACK
	RSTACK
?L1:	EQUAL? CONTEXT,K-M-SDESC \?L4
	PRINTI "garnet"
	RTRUE
?L4:	EQUAL? CONTEXT,K-M-DESCFCN \?L6
	ICALL2 RT-EXAMINE-GEM,TH-GARNET
	RTRUE
?L6:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	CALL2 RT-EXAMINE-GEM,TH-GARNET >STACK
	ZERO? STACK \TRUE
	EQUAL? GL-PRSA,V?TAKE \FALSE
	IN? TH-GARNET,TH-BUTT-OF-MALMSEY \FALSE
	PRINTR "You can't. Your shoulders are too broad, and your arms are too short for you to reach to the bottom of the butt."

	.FUNCT RT-AC-TH-MACE,CONTEXT
	ASSIGNED? 'CONTEXT /?L16
	SET 'CONTEXT,0
?L16:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It's a huge, medieval mace that some medieval knight probably used for knocking other knights off horses."
?L1:	ZERO? GL-NOW-PRSI? /?L17
	EQUAL? GL-PRSO,CH-WIGGINS \?L4
	FSET? GL-PRSO,FL-ASLEEP \?L6
	PRINTI "If he could, Wiggins would dance nimbly out of harm's way and cry ""'Ere! Steady on, mate!"" Assault and battery on your friends is probably not the way to go."
	CRLF
	ICALL2 PRINT-ID,STR?435
	RTRUE
?L6:	PRINTR "Wiggins dances nimbly out of harm's way and cries, ""'Ere! Steady on, mate!"""
?L4:	EQUAL? GL-PRSO,TH-SUIT-OF-ARMOUR \FALSE
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN /FALSE
	PRINTR "Did you really think beating up on an empty suit of armour was going to get you anywhere?"
?L17:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?436 >STACK
	RSTACK

	.FUNCT RT-AC-TH-PORTCULLIS-CHAIN,CONTEXT
	ASSIGNED? 'CONTEXT /?L17
	SET 'CONTEXT,0
?L17:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The chain is hanging just within reach."
?L1:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?PULL,V?LOWER,V?LOOSEN /?L7
	EQUAL? GL-PRSA,V?PUSH-TO \?L5
?L7:	FSET? LG-PORTCULLIS-DOOR,FL-OPENED \?L8
	PRINTR "The gate is already up."
?L8:	FSET? TH-SUIT-OF-ARMOUR,FL-WORN /?L11
	PRINTR "You pull on the chain but the portcullis doesn't budge."
?L11:	FSET LG-PORTCULLIS-DOOR,FL-OPENED
	FSET LG-PORTCULLIS-DOOR,FL-LOCKED
	ICALL2 SOUNDS,S-ARMOR
	PRINTI "You grab the chain and lift your feet off the ground. The portcullis' ancient mechanism creaks, but then it rises up and locks into place. When you release the chain, the massive gate remains open."
	CRLF
	ICALL2 RT-UPDATE-SCORE,1
	RTRUE
?L5:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-SUIT-OF-ARMOUR,CONTEXT
	ASSIGNED? 'CONTEXT /?L36
	SET 'CONTEXT,0
?L36:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The suit of armour was made for Henry VIII."
?L1:	ZERO? GL-NOW-PRSI? /?L37
	EQUAL? GL-PRSA,V?PUT \?L4
	PRINTI "That would"
	CALL1 RT-WASTE-OF-TIME-MSG >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?TAKE \FALSE
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \FALSE
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?199,TH-SUIT-OF-ARMOUR
	PRINTR " first."
?L37:	EQUAL? GL-PRSA,V?TAKE \?L9
	EQUAL? GL-WINNER,CH-WIGGINS \?L11
	PRINTI """"
?L11:	PRINTI "Ooof! It's too heavy to carry."
	EQUAL? GL-WINNER,CH-WIGGINS \?L14
	PRINTI """"
?L14:	CRLF
	RTRUE
?L9:	EQUAL? GL-PRSA,V?WEAR \?L17
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN /?L18
	MOVE TH-SUIT-OF-ARMOUR,CH-PLAYER
	FSET TH-SUIT-OF-ARMOUR,FL-WORN
	ICALL2 SOUNDS,S-ARMOR
	PRINTI "You put on the suit of armour."
	CRLF
	CALL2 PRINT-ID,STR?437 >STACK
	RSTACK
?L18:	PRINTR "You're already wearing it."
?L17:	EQUAL? GL-PRSA,V?TAKE-OFF,V?EXIT \?L21
	FSET? TH-SUIT-OF-ARMOUR,FL-WORN \?L22
	MOVE TH-SUIT-OF-ARMOUR,GL-PLACE-CUR
	FCLEAR TH-SUIT-OF-ARMOUR,FL-WORN
	ICALL2 SOUNDS,S-ARMOR
	PRINTI "You take off the suit of armour and leave it "
	EQUAL? GL-PLACE-CUR,RM-THAMES-ONE,RM-THAMES-TWO,RM-THAMES-THREE /?L26
	EQUAL? GL-PLACE-CUR,RM-THAMES-FOUR,RM-THAMES-FIVE \?L24
?L26:	MOVE TH-SUIT-OF-ARMOUR,TH-BOAT
	PRINTI "in the boat"
	JUMP ?L30
?L24:	PRINTI "on "
	FSET? GL-PLACE-CUR,FL-INDOORS \?L28
	ICALL1 TELL-THE-FLOOR
	JUMP ?L30
?L28:	ICALL1 TELL-THE-GROUND
?L30:	PRINTR "."
?L22:	EQUAL? GL-P-PRSA-WORD,W?LEAVE /FALSE
	PRINTR "You're not wearing it."
?L21:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?438 >STACK
	RSTACK

	.FUNCT RT-AC-LG-PORTCULLIS-DOOR
	ZERO? GL-NOW-PRSI? \?L40
	EQUAL? GL-PRSA,V?RAISE,V?OPEN,V?LOOSEN \?L3
	FSET? LG-PORTCULLIS-DOOR,FL-OPENED \?L5
	PRINTR "The gate is already up."
?L5:	PRINTR "Oomph. The portcullis is too heavy to lift."
?L3:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L8
	PRINTI "You look through the gate."
	CRLF
	EQUAL? GL-PLACE-CUR,RM-INSIDE-TRAITORS-GATE \?L9
	CALL2 RT-DESCRIBE-PLACE-CONTENTS,RM-OUTSIDE-TRAITORS-GATE >STACK
	RSTACK
?L9:	EQUAL? GL-PLACE-CUR,RM-OUTSIDE-TRAITORS-GATE \FALSE
	CALL2 RT-DESCRIBE-PLACE-CONTENTS,RM-INSIDE-TRAITORS-GATE >STACK
	RSTACK
?L8:	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \?L13
	EQUAL? GL-PLACE-CUR,RM-INSIDE-TRAITORS-GATE \?L14
	CALL2 RT-DO-WALK,P?SOUTH >STACK
	RSTACK
?L14:	EQUAL? GL-PLACE-CUR,RM-OUTSIDE-TRAITORS-GATE \FALSE
	CALL2 RT-DO-WALK,P?NORTH >STACK
	RSTACK
?L13:	EQUAL? GL-PRSA,V?CLOSE,V?LOWER \?L18
	FSET? LG-PORTCULLIS-DOOR,FL-OPENED \FALSE
	PRINTR "It's jammed open."
?L18:	EQUAL? GL-PRSA,V?SHOOT \?L22
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?439 >STACK
	RSTACK
?L22:	EQUAL? GL-PRSA,V?REACH-IN \FALSE
	FSET? LG-PORTCULLIS-DOOR,FL-OPENED \?L24
	PRINTI "Why don't you just walk through the gate? "
	ICALL2 RT-CTHEO-PRINT,LG-PORTCULLIS-DOOR
	PRINTR " is open."
?L24:	ICALL RT-CYOU-MSG,STR?355,STR?354
	PRINTI "through "
	ICALL1 RT-THEO-PRINT
	PRINTR ", but can't touch anything on the other side."
?L40:	EQUAL? GL-PRSA,V?THROW \?L29
	EQUAL? GL-P-PRSA-WORD,W?PUT \?L29
	EQUAL? GL-PRSO,TH-HANDS,TH-FEET \?L29
	FSET? LG-PORTCULLIS-DOOR,FL-OPENED \?L31
	PRINTI "Why don't you just walk through the gate? "
	ICALL2 RT-CTHEO-PRINT,LG-PORTCULLIS-DOOR
	PRINTR " is open."
?L31:	ICALL RT-CYOU-MSG,STR?203,STR?202
	ICALL1 RT-THEO-PRINT
	PRINTI " through "
	ICALL1 RT-THEI-PRINT
	PRINTR ", but can't reach anything on the other side."
?L29:	EQUAL? GL-PRSA,V?THROW,V?PUT \FALSE
	FSET? LG-PORTCULLIS-DOOR,FL-OPENED \FALSE
	PRINTI "Why bother? "
	ICALL2 RT-CTHEO-PRINT,LG-PORTCULLIS-DOOR
	PRINTR " is open."

	.FUNCT RT-AC-CH-VENDOR,CONTEXT,NUM
	ASSIGNED? 'CONTEXT /?L31
	SET 'CONTEXT,0
?L31:	SET 'NUM,CH-VENDOR-AUX1
	EQUAL? CONTEXT,K-M-WINNER \?L1
	EQUAL? GL-PRSA,V?TAKE \?L1
	CALL RT-META-IN?,GL-PRSO,CH-PLAYER >STACK
	ZERO? STACK /?L1
	SET 'GL-WINNER,CH-PLAYER
	ICALL RT-PERFORM,V?GIVE,GL-PRSO,CH-VENDOR
	SET 'GL-WINNER,CH-VENDOR
	RTRUE
?L1:	EQUAL? GL-PRSA,V?HAGGLE \?L3
	ZERO? GL-NOW-PRSI? \?L3
	ICALL2 RT-THIS-IS-IT,TH-TELESCOPE
	IN? TH-TELESCOPE,CH-VENDOR /?L4
	PRINTR """Sorry, guv. No refunds."""
?L4:	ZERO? NUM \?L6
	PRINTI """Alright, guv. For you I'll come down to me special Jubilee price of Nineteen and six. 'Ow about it?"""
	CRLF
	SET 'CH-VENDOR-AUX1,1
	RETURN CH-VENDOR-AUX1
?L6:	EQUAL? NUM,1 \?L7
	PRINTI """It'll break me poor wife's 'eart, me comin' 'ome wif so little. But times is 'ard. Nineteen shillings. Not a farthing less."""
	CRLF
	SET 'CH-VENDOR-AUX1,2
	RETURN CH-VENDOR-AUX1
?L7:	EQUAL? NUM,2 \FALSE
	PRINTR """Sorry, guv. Nineteen shillings is me price."""
?L3:	CALL2 RT-TELL-ABOUT?,CH-VENDOR >STACK
	ZERO? STACK /?L10
	EQUAL? GL-PRSI,TH-TELESCOPE \?L11
	IN? TH-TELESCOPE,CH-VENDOR /?L13
	PRINTR """Sorry, guv. No refunds."""
?L13:	ZERO? NUM \?L15
	PRINTR """It's me top-of-the-line model. I can let you 'ave it for one pound."""
?L15:	EQUAL? NUM,1 \?L16
	PRINTR """Seeing as 'ow it's you, I'll let it go for nineteen and six."""
?L16:	EQUAL? NUM,2 \FALSE
	PRINTR """Nineteen shillings is as low as I can go."""
?L11:	IN? TH-TELESCOPE,CH-VENDOR \?L20
	EQUAL? GL-PRSI,TH-TRINKETS \?L22
	PRINTR """I've got quite a nice telescope 'ere that I can let you 'ave for only a quid."""
?L22:	PRINTR "He ignores your question and waves trinkets over his head, asking if you wish to buy anything."
?L20:	PRINTR "He ignores your question and looks about for new customers."
?L10:	EQUAL? GL-PRSA,V?GIVE \FALSE
	EQUAL? GL-PRSO,TH-TELESCOPE \FALSE
	PRINTR """Sorry, mate. No refunds."""

	.FUNCT RT-AC-TH-POUND-NOTE,CONTEXT,NUM
	ASSIGNED? 'CONTEXT /?L15
	SET 'CONTEXT,0
?L15:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "Why, haven't you ever seen a pound note before?"
?L1:	EQUAL? GL-PRSA,V?BUY \?L5
	EQUAL? GL-PRSO,TH-TELESCOPE /?L4
?L5:	EQUAL? GL-PRSA,V?GIVE \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSI,CH-VENDOR \FALSE
?L4:	ICALL RT-CYOU-MSG,STR?248,STR?247
	ICALL2 RT-THEO-PRINT,TH-POUND-NOTE
	PRINTI " to "
	ICALL2 RT-THEO-PRINT,CH-VENDOR
	PRINTI "."
	SET 'NUM,CH-VENDOR-AUX1
	ZERO? NUM \?L6
	PRINT K-GOOD-HEALTH-MSG
	JUMP ?L9
?L6:	EQUAL? NUM,1 \?L8
	PRINTI " He smirks, gives"
	ICALL1 RT-YOU-MSG
	PRINTI "sixpence change,"
	MOVE TH-SIXPENCE,GL-WINNER
	FSET TH-SIXPENCE,FL-SEEN
	FSET TH-SIXPENCE,FL-TOUCHED
	JUMP ?L9
?L8:	EQUAL? NUM,2 \?L9
	PRINTI " He gives"
	ICALL1 RT-YOU-MSG
	PRINTI "a shilling for change,"
	MOVE TH-SHILLING,GL-WINNER
	FSET TH-SHILLING,FL-SEEN
	FSET TH-SHILLING,FL-TOUCHED
?L9:	PRINTI " and hands"
	ICALL1 RT-YOU-MSG
	ICALL2 RT-THEO-PRINT,TH-TELESCOPE
	PRINTI "."
	CRLF
	MOVE TH-TELESCOPE,GL-WINNER
	REMOVE TH-POUND-NOTE
	FSET TH-TELESCOPE,FL-SEEN
	FSET TH-TELESCOPE,FL-TOUCHED
	FCLEAR TH-TELESCOPE,FL-NODESC
	EQUAL? NUM,2 \?L11
	GETP TH-TELESCOPE,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
?L11:	PUTP TH-TELESCOPE,P?VALUE,0
	RTRUE

	.FUNCT RT-AC-TH-TELESCOPE,CONTEXT,NUM
	ASSIGNED? 'CONTEXT /?L44
	SET 'CONTEXT,0
?L44:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTI "The telescope looks surprisingly good"
	IN? TH-TELESCOPE,CH-VENDOR \?L3
	PRINTI ". But it's not worth a whole pound"
	JUMP ?L5
?L3:	PRINTI ", considering it's just a trinket"
?L5:	PRINTR "."
?L1:	SET 'GL-P-IT-OBJECT,TH-TELESCOPE
	ZERO? GL-NOW-PRSI? /?L7
	EQUAL? GL-PRSA,V?LOOK-THRU \FALSE
	IN? GL-PRSI,CH-PLAYER /?L11
	ICALL RT-YOUD-HAVE-TO-MSG,STR?294,GL-PRSI
	RTRUE
?L11:	CALL2 RT-GOT?,GL-PRSO >STACK
	ZERO? STACK \?L14
	EQUAL? GL-PRSO,CH-PLAYER,CH-ME,TH-HANDS /?L14
	EQUAL? GL-PRSO,TH-FEET,TH-POCKET /?L14
	CALL RT-IDENTIFY-FLOOR?,W?GROUND,GL-PRSO >STACK
	ZERO? STACK /?L13
?L14:	ICALL1 RT-CTHEI-PRINT
	PRINTR " will not focus that closely."
?L13:	EQUAL? GL-LASTFOC,GL-PRSO /?L15
	SET 'GL-LASTFOC,GL-PRSO
	PRINTI "You focus the telescope on "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
	CRLF
?L15:	EQUAL? GL-PRSO,TH-NELSON-STATUE,TH-NELSON-EYE \?L17
	IN? TH-RUBY,TH-NELSON-STATUE \?L17
	PRINTI "You can see a ruby in Nelson's blind eye."
	CRLF
	FSET TH-NELSON-STATUE,FL-OPENED
	RTRUE
?L17:	FSET? GL-PRSO,FL-PLURAL \?L19
	FSET? GL-PRSO,FL-COLLECTIVE /?L19
	PRINTI "They appear"
	JUMP ?L22
?L19:	FSET? GL-PRSO,FL-PERSON \?L21
	FSET? GL-PRSO,FL-FEMALE \?L20
	PRINTI "She appears"
	JUMP ?L22
?L20:	FSET? GL-PRSO,FL-PERSON \?L21
	FSET? GL-PRSO,FL-FEMALE /?L21
	PRINTI "He appears"
	JUMP ?L22
?L21:	PRINTI "It appears"
?L22:	PRINTR " much closer now."
?L7:	EQUAL? GL-PRSA,V?LOOK-INSIDE \?L24
	PRINTR "Everything appears much closer."
?L24:	EQUAL? GL-PRSA,V?ADJUST,V?PLAY \?L25
	PRINTR "You fiddle aimlessly with the controls."
?L25:	EQUAL? GL-PRSA,V?TAKE,V?STEAL \?L26
	IN? TH-TELESCOPE,CH-VENDOR \?L26
	PRINT K-THEFT-MSG
	CRLF
	RTRUE
?L26:	EQUAL? GL-PRSA,V?BUY,V?BUY-FROM \FALSE
	IN? TH-TELESCOPE,CH-VENDOR \FALSE
	EQUAL? GL-PRSI,TH-POUND-NOTE /?L30
	EQUAL? GL-PRSI,0,CH-VENDOR \?L28
	CALL RT-META-IN?,TH-POUND-NOTE,GL-WINNER >STACK
	ZERO? STACK /?L28
?L30:	ICALL RT-CYOU-MSG,STR?248,STR?247
	ICALL2 RT-THEO-PRINT,TH-POUND-NOTE
	PRINTI " to "
	ICALL2 RT-THEO-PRINT,CH-VENDOR
	PRINTI "."
	SET 'NUM,CH-VENDOR-AUX1
	ZERO? NUM \?L31
	PRINT K-GOOD-HEALTH-MSG
	JUMP ?L34
?L31:	EQUAL? NUM,1 \?L33
	PRINTI " He smirks, gives"
	ICALL1 RT-YOU-MSG
	PRINTI "sixpence change,"
	MOVE TH-SIXPENCE,GL-WINNER
	FSET TH-SIXPENCE,FL-SEEN
	FSET TH-SIXPENCE,FL-TOUCHED
	JUMP ?L34
?L33:	EQUAL? NUM,2 \?L34
	PRINTI " He gives"
	ICALL1 RT-YOU-MSG
	PRINTI "a shilling for change,"
	MOVE TH-SHILLING,GL-WINNER
	FSET TH-SHILLING,FL-SEEN
	FSET TH-SHILLING,FL-TOUCHED
?L34:	PRINTI " and hands"
	ICALL1 RT-YOU-MSG
	ICALL2 RT-THEO-PRINT,TH-TELESCOPE
	PRINTI "."
	CRLF
	ICALL2 PRINT-ID,STR?440
	MOVE TH-TELESCOPE,GL-WINNER
	REMOVE TH-POUND-NOTE
	FSET TH-TELESCOPE,FL-SEEN
	FSET TH-TELESCOPE,FL-TOUCHED
	FCLEAR TH-TELESCOPE,FL-NODESC
	EQUAL? NUM,2 \?L36
	GETP TH-TELESCOPE,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
?L36:	PUTP TH-TELESCOPE,P?VALUE,0
	RTRUE
?L28:	ICALL1 RT-CYOU-MSG
	PRINTI "can't buy "
	ICALL1 RT-THEO-PRINT
	PRINTI " with"
	ZERO? GL-PRSI /?L40
	PRINTI " "
	ICALL1 RT-THEI-PRINT
	JUMP ?L42
?L40:	PRINTI "out any money"
?L42:	PRINTR "."

	.FUNCT RT-AC-TH-SIXPENCE
	RFALSE

	.FUNCT RT-AC-TH-BLUE-PILL-BOTTLE,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?READ,V?EXAMINE,V?LOOK-ON \?L3
	PRINTR "The label on the bottle reads: ""Digitalis leaf. For tachycardia and other accelerated arrhythmias."""
?L3:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	REMOVE TH-BLUE-PILL-BOTTLE
	ICALL1 RT-CTHEO-PRINT
	PRINT K-SHATTER-MSG
	CRLF
	CALL2 PRINT-ID,STR?441 >STACK
	RSTACK

	.FUNCT RT-AC-TH-BROWN-PILL-BOTTLE,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?READ,V?EXAMINE,V?LOOK-ON \?L3
	PRINTR "The label on the bottle reads: ""Belladonna. For bradycardia and other decelerated arrhythmias."""
?L3:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	REMOVE TH-BROWN-PILL-BOTTLE
	ICALL1 RT-CTHEO-PRINT
	PRINT K-SHATTER-MSG
	CRLF
	CALL2 PRINT-ID,STR?442 >STACK
	RSTACK

	.FUNCT RT-AC-TH-ORANGE-PILL,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?EAT \?L3
	EQUAL? GL-WINNER,CH-PLAYER \?L3
	PRINTI "You swallow the pill. For a few moments everything seems to move much slower."
	CRLF
	REMOVE GL-PRSO
	RTRUE
?L3:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	REMOVE TH-ORANGE-PILL
	ICALL1 RT-CTHEO-PRINT
	PRINT K-SHATTER-MSG
	CRLF
	CALL2 PRINT-ID,STR?443 >STACK
	RSTACK

	.FUNCT RT-AC-TH-YELLOW-PILL,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?EAT \?L3
	EQUAL? GL-WINNER,CH-PLAYER \?L3
	PRINTI "You swallow the pill. For a few moments everything seems to move much faster."
	CRLF
	REMOVE GL-PRSO
	RTRUE
?L3:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	REMOVE TH-YELLOW-PILL
	ICALL1 RT-CTHEO-PRINT
	PRINT K-SHATTER-MSG
	CRLF
	CALL2 PRINT-ID,STR?444 >STACK
	RSTACK

	.FUNCT RT-AC-CH-ELIZA-DOOLITTLE,CONTEXT
	ASSIGNED? 'CONTEXT /?L40
	SET 'CONTEXT,0
?L40:	GETP CH-ELIZA-DOOLITTLE,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?HEART,W?HEARTBEAT \?L1
	EQUAL? CONTEXT,K-M-SDESC \?L3
	PRINTI "girl's heart"
	RTRUE
?L3:	EQUAL? CONTEXT,K-M-DESCFCN \?L5
	PRINTR "You don't have X-ray vision."
?L5:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?LISTEN \?L7
	ICALL1 RT-LISTEN-ELIZA
	RTRUE
?L7:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	EQUAL? GL-PRSA,V?HIT,V?KICK,V?KISS /?L11
	EQUAL? GL-PRSA,V?RIP,V?ROB,V?SMELL /?L11
	EQUAL? GL-PRSA,V?STEAL /?L13
	PUSH 0
	JUMP ?L9
?L13:	PUSH 1
	JUMP ?L9
?L11:	PUSH 1
?L9:	ICALL PRINT-ID,STR?445,STACK
	EQUAL? GL-PRSA,V?BURN,V?CUT,V?DETONATE /?L17
	EQUAL? GL-PRSA,V?EAT,V?KILL,V?SHOOT /?L18
	PUSH 0
	JUMP ?L15
?L18:	PUSH 1
	JUMP ?L15
?L17:	PUSH 1
?L15:	ICALL PRINT-ID,STR?446,STACK
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-SDESC \?L21
	PRINTI "girl"
	RTRUE
?L21:	EQUAL? CONTEXT,K-M-DESCFCN \?L22
	ICALL2 RT-THIS-IS-IT,CH-ELIZA-DOOLITTLE
	PRINTR "The flower girl is lying on the ground in a dead faint. She is very beautiful, but her clothes indicate that she must be poor."
?L22:	EQUAL? CONTEXT,K-M-WINNER \?L23
	ICALL2 RT-CTHEO-PRINT,CH-ELIZA-DOOLITTLE
	PRINTR " is unconscious. She cannot do anything."
?L23:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?LISTEN \?L27
	ZERO? GL-NOW-PRSI? /?L26
?L27:	EQUAL? GL-PRSA,V?USE-ON,V?TOUCH-TO \?L28
	EQUAL? GL-PRSO,TH-STETHOSCOPE \?L28
	ZERO? GL-NOW-PRSI? \?L26
?L28:	EQUAL? GL-PRSA,V?DIAGNOSE \?L29
	ZERO? GL-NOW-PRSI? /?L26
?L29:	EQUAL? GL-PRSA,V?LOOK-THRU \?L25
	EQUAL? GL-P-PRSA-WORD,W?EXAMINE \?L25
	ZERO? GL-NOW-PRSI? \?L25
	EQUAL? GL-PRSI,TH-STETHOSCOPE \?L25
?L26:	CALL1 RT-LISTEN-ELIZA >STACK
	RSTACK
?L25:	EQUAL? GL-PRSA,V?GIVE,V?FEED \?L30
	CALL2 RT-CURE-ELIZA,GL-PRSO >STACK
	RSTACK
?L30:	EQUAL? GL-PRSA,V?TAKE,V?RAISE,V?MOVE \?L31
	EQUAL? GL-PRSO,TH-ELIZAS-FLOWERS \?L32
	PRINT K-OUTRAGED-CROWD-MSG
	CRLF
	ICALL2 PRINT-ID,STR?447
	RTRUE
?L32:	EQUAL? GL-PRSO,CH-ELIZA-DOOLITTLE \FALSE
	PRINTR "The girl is too sick to be moved."
?L31:	EQUAL? GL-PRSA,V?RESCUE \?L36
	PRINTR "A noble thought, worthy of someone who has taken the Hippocratic oath."
?L36:	EQUAL? GL-PRSA,V?ALARM \?L37
	PRINTR "Your medical expertise tells you she's not just asleep. It's more serious than that."
?L37:	EQUAL? GL-PRSA,V?SEARCH \FALSE
	PRINT K-OUTRAGED-CROWD-MSG
	CRLF
	ICALL2 PRINT-ID,STR?448
	RTRUE

	.FUNCT RT-LISTEN-ELIZA
	FSET? TH-COTTON-BALLS,FL-WORN \?L1
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot hear a thing with "
	ICALL2 RT-THEO-PRINT,TH-COTTON-BALLS
	PRINTI " in "
	ICALL2 RT-THEO-PRINT,TH-EARS
	PRINTR "."
?L1:	FSET? TH-STETHOSCOPE,FL-WORN \?L3
	LOC CH-ELIZA-DOOLITTLE >STACK
	LOC CH-PLAYER >STACK
	EQUAL? STACK,STACK /?L4
	PRINTR "You can't reach the girl from where you are."
?L4:	ZERO? CH-ELIZA-DOOLITTLE-AUX1 \?L11
	RANDOM 100 >STACK
	LESS? 50,STACK /?L9
	SET 'CH-ELIZA-DOOLITTLE-AUX1,1
	JUMP ?L11
?L9:	SET 'CH-ELIZA-DOOLITTLE-AUX1,2
?L11:	EQUAL? CH-ELIZA-DOOLITTLE-AUX1,1 \?L13
	IXCALL SOUNDS,S-HEART3,S-START,6,10
	PRINTR "Her heartbeat is incredibly fast."
?L13:	EQUAL? CH-ELIZA-DOOLITTLE-AUX1,2 \FALSE
	IXCALL SOUNDS,S-HEART1,S-START,6,6
	PRINTR "Her heartbeat is incredibly slow."
?L3:	EQUAL? GL-PRSO,TH-STETHOSCOPE /?L18
	EQUAL? GL-PRSI,TH-STETHOSCOPE \?L17
?L18:	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not wearing "
	ICALL2 RT-THEO-PRINT,TH-STETHOSCOPE
	PRINTR "."
?L17:	PRINTR "The city noises are too loud for you to make an accurate diagnosis."

	.FUNCT RT-CURE-ELIZA,CURE
	EQUAL? CURE,TH-ORANGE-PILL \?L1
	REMOVE TH-ORANGE-PILL
	EQUAL? CH-ELIZA-DOOLITTLE-AUX1,1 \?L3
	SET 'CH-ELIZA-DOOLITTLE-AUX1,3
	JUMP ?L5
?L3:	SET 'CH-ELIZA-DOOLITTLE-AUX1,4
?L5:	PRINTI "You give her "
	ICALL2 RT-THEO-PRINT,CURE
	PRINTI "."
	CRLF
	CRLF
	JUMP ?L10
?L1:	EQUAL? CURE,TH-YELLOW-PILL \?L6
	REMOVE TH-YELLOW-PILL
	EQUAL? CH-ELIZA-DOOLITTLE-AUX1,2 \?L7
	SET 'CH-ELIZA-DOOLITTLE-AUX1,3
	JUMP ?L9
?L7:	SET 'CH-ELIZA-DOOLITTLE-AUX1,4
?L9:	PRINTI "You give her "
	ICALL2 RT-THEO-PRINT,CURE
	PRINTI "."
	CRLF
	CRLF
	JUMP ?L10
?L6:	PRINTR "That would not do her much good."
?L10:	EQUAL? CH-ELIZA-DOOLITTLE-AUX1,3 \?L11
	MOVE TH-CARNATION,TH-LAPEL
	REMOVE CH-ELIZA-DOOLITTLE
	FCLEAR CH-ELIZA-DOOLITTLE,FL-ASLEEP
	PRINTI "Nothing happens for a moment, but then her eyelids flutter briefly and she opens her eyes."
	CRLF
	CRLF
	PRINTI "The crowd breaks into applause, and they help her to her feet. When she is standing, she smiles at you shyly and puts a lovely carnation in your lapel as a gesture of thanks."
	CRLF
	CRLF
	PRINTI "Just then, a distinguished-looking gentleman appears on the scene, takes her by the arm, and says, ""Come, Eliza. We mustn't be late for the ball."""
	CRLF
	CRLF
	PRINTI "He escorts her away, but as she leaves, she glances back at you once more with a grateful expression in her lovely eyes."
	CRLF
	ICALL2 PRINT-ID,STR?449
	GETP TH-CARNATION,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-CARNATION,P?VALUE,0
	RTRUE
?L11:	EQUAL? CH-ELIZA-DOOLITTLE-AUX1,4 \FALSE
	FCLEAR CH-ELIZA-DOOLITTLE,FL-ALIVE
	PRINTI "Nothing happens for a moment, but then suddenly her body goes limp. It must have been the wrong pill."
	CRLF
	CRLF
	PRINTI "By this time, the large crowd has gathered the attention of the police. Inspector Lestrade pushes his way through the crowd, sees the dead girl, and says, ""I'm sorry, Doctor Watson. I know you must have tried to save her. I'm afraid you'll have to come along with me to fill out the death certificate."""
	CRLF
	CRLF
	PRINTI "Unfortunately, by the time you finish filling out the forms associated with the girl's death, the news of theft of the Crown Jewels leaks to the press, and all is lost."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?450
	CALL1 RT-QSR >STACK
	RSTACK

	.FUNCT BURN-OUT-MATCH
	FCLEAR TH-MATCH,FL-BURNABLE
	ICALL2 CLEAR-ALL-FLAGS,TH-MATCH
	FSET TH-MATCH,FL-TAKEABLE
	FSET TH-MATCH,FL-BROKEN
	RTRUE

	.FUNCT RT-AC-TH-MATCH,CONTEXT
	ASSIGNED? 'CONTEXT /?L30
	SET 'CONTEXT,0
?L30:	EQUAL? CONTEXT,K-M-SDESC \?L1
	FSET? TH-MATCH,FL-BROKEN \?L3
	PRINTI "burnt match"
	RTRUE
?L3:	PRINTI "match"
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L6
	FSET? TH-MATCH,FL-BROKEN /FALSE
	FSET? TH-MATCH,FL-LIGHTED \FALSE
	ICALL2 RT-CTHEO-PRINT,TH-MATCH
	PRINTR " is burning."
?L6:	ZERO? CONTEXT \FALSE
	FSET? TH-MATCH,FL-BROKEN \?L12
	EQUAL? GL-PRSA,V?LAMP-OFF,V?LIGHT,V?STRIKE /?L15
	EQUAL? GL-PRSA,V?BURN-WITH,V?LIGHT-WITH \FALSE
?L15:	PRINTR "The match is already burned out."
?L12:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH,V?STRIKE /?L18
	EQUAL? GL-PRSA,V?LIGHT \?L17
?L18:	EQUAL? GL-PRSO,TH-MATCH \?L17
	FSET? TH-MATCH,FL-LIGHTED \?L19
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is already lit."
?L19:	FSET? TH-MATCH,FL-BURNABLE /?L21
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is burned out."
?L21:	EQUAL? GL-PRSI,TH-HANDS,0 /?L23
	FSET? GL-PRSI,FL-LIGHTED \FALSE
	FSET? GL-PRSI,FL-BURNABLE \FALSE
?L23:	FSET TH-MATCH,FL-LIGHTED
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,2,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-MATCH-OUT,STACK
	MOVE TH-MATCH,GL-WINNER
	ICALL1 RT-CTHEO-PRINT
	PRINTR " flares to life."
?L17:	EQUAL? GL-PRSA,V?LAMP-OFF \FALSE
	FSET? TH-MATCH,FL-LIGHTED /?L26
	ICALL1 RT-CTHEO-PRINT
	PRINTR " isn't lit."
?L26:	FCLEAR TH-MATCH,FL-LIGHTED
	ICALL1 BURN-OUT-MATCH
	ICALL2 RT-ALARM-CLR,RT-I-MATCH-OUT
	ICALL RT-CYOU-MSG,STR?452,STR?451
	PRINTR "out the match."

	.FUNCT CLEAR-ALL-FLAGS,OBJ
	FCLEAR OBJ,FL-ALIVE
	FCLEAR OBJ,FL-ASLEEP
	FCLEAR OBJ,FL-BODYPART
	FCLEAR OBJ,FL-BROKEN
	FCLEAR OBJ,FL-BURNABLE
	FCLEAR OBJ,FL-BUYABLE
	FCLEAR OBJ,FL-BYHAND
	FCLEAR OBJ,FL-CLOTHING
	FCLEAR OBJ,FL-COLLECTIVE
	FCLEAR OBJ,FL-CONTAINER
	FCLEAR OBJ,FL-DOOR
	FCLEAR OBJ,FL-FEMALE
	FCLEAR OBJ,FL-FOOD
	FCLEAR OBJ,FL-HOLMES-TOLD
	FCLEAR OBJ,FL-INDOORS
	FCLEAR OBJ,FL-KEY
	FCLEAR OBJ,FL-KNIFE
	FCLEAR OBJ,FL-LAMP
	FCLEAR OBJ,FL-LIGHTED
	FCLEAR OBJ,FL-LOCATION
	FCLEAR OBJ,FL-LOCKED
	FCLEAR OBJ,FL-MONEY
	FCLEAR OBJ,FL-NO-CROWDS
	FCLEAR OBJ,FL-NO-ETHERIUM
	FCLEAR OBJ,FL-NOALL
	FCLEAR OBJ,FL-NOARTC
	FCLEAR OBJ,FL-NODESC
	FCLEAR OBJ,FL-OPENABLE
	FCLEAR OBJ,FL-OPENED
	FCLEAR OBJ,FL-PERSON
	FCLEAR OBJ,FL-PLURAL
	FCLEAR OBJ,FL-READABLE
	FCLEAR OBJ,FL-SEEN
	FCLEAR OBJ,FL-SURFACE
	FCLEAR OBJ,FL-TAKEABLE
	FCLEAR OBJ,FL-TOOL
	FCLEAR OBJ,FL-TOUCHED
	FCLEAR OBJ,FL-TRANSPARENT
	FCLEAR OBJ,FL-TRYTAKE
	FCLEAR OBJ,FL-VEHICLE
	FCLEAR OBJ,FL-VOWEL
	FCLEAR OBJ,FL-WEAPON
	FCLEAR OBJ,FL-WORN
	FCLEAR OBJ,FL-YOUR
	RTRUE

	.FUNCT RT-AC-TH-TORCH,CONTEXT,WHO
	ASSIGNED? 'CONTEXT /?L31
	SET 'CONTEXT,0
?L31:	EQUAL? CONTEXT,K-M-SDESC \?L1
	FSET? TH-TORCH,FL-BROKEN \?L3
	PRINTI "burnt torch"
	RTRUE
?L3:	PRINTI "torch"
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L6
	FSET? TH-TORCH,FL-BROKEN /FALSE
	FSET? TH-TORCH,FL-LIGHTED \FALSE
	ICALL2 RT-CTHEO-PRINT,TH-TORCH
	PRINTR " is burning."
?L6:	FSET? TH-TORCH,FL-BROKEN /FALSE
	EQUAL? GL-PRSA,V?MELT,V?HEAT,V?LIGHT-WITH /?L13
	EQUAL? GL-PRSA,V?BURN-WITH \?L12
?L13:	EQUAL? GL-PRSI,TH-TORCH \?L12
	FSET? TH-TORCH,FL-LIGHTED /?L14
	ICALL2 RT-CTHEO-PRINT,TH-TORCH
	PRINTR " is not lit."
?L14:	EQUAL? GL-PRSO,TH-TORCH \?L16
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is already lit."
?L16:	EQUAL? GL-PRSO,TH-WAX-HEAD \?L17
	ICALL1 RT-CTHEO-PRINT
	PRINTI " melts into a pool of wax on the floor. You see a gem glittering in the wax."
	CRLF
	ICALL2 PRINT-ID,STR?453
	MOVE TH-WAX-HEAD,GL-PLACE-CUR
	MOVE TH-EMERALD,TH-WAX-HEAD
	ICALL2 CLEAR-ALL-FLAGS,TH-WAX-HEAD
	FSET TH-WAX-HEAD,FL-OPENED
	FSET TH-WAX-HEAD,FL-TRANSPARENT
	FSET TH-WAX-HEAD,FL-CONTAINER
	FSET TH-WAX-HEAD,FL-BROKEN
	ICALL2 SET-MASS-TO-ONE,TH-WAX-HEAD
	GETPT TH-WAX-HEAD,P?SYNONYM >STACK
	PUT STACK,0,W?POOL
	GETPT TH-WAX-HEAD,P?ADJECTIVE >STACK
	PUT STACK,0,W?POOL
	CALL2 RT-THIS-IS-IT,TH-EMERALD >STACK
	RSTACK
?L17:	EQUAL? GL-PRSO,TH-WAX-AX \?L18
	ICALL1 RT-CTHEO-PRINT
	PRINTI " melts into a pool of wax on the floor."
	CRLF
	ICALL2 PRINT-ID,STR?454
	MOVE TH-WAX-AX,GL-PLACE-CUR
	ICALL2 CLEAR-ALL-FLAGS,TH-WAX-AX
	FSET TH-WAX-AX,FL-OPENED
	FSET TH-WAX-AX,FL-TRANSPARENT
	FSET TH-WAX-AX,FL-CONTAINER
	FSET TH-WAX-AX,FL-BROKEN
	ICALL2 SET-SIZE-TO-ONE,TH-WAX-AX
	ICALL2 SET-CAPACITY-TO-ONE,TH-WAX-AX
	ICALL2 SET-MASS-TO-ONE,TH-WAX-AX
	GETPT TH-WAX-AX,P?SYNONYM >STACK
	PUT STACK,0,W?AX
	GETPT TH-WAX-AX,P?ADJECTIVE >STACK
	PUT STACK,0,W?MELTED
	RTRUE
?L18:	FSET? GL-PRSO,FL-BURNABLE /FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L12:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH \FALSE
	EQUAL? GL-PRSO,TH-TORCH \FALSE
	EQUAL? GL-PRSI,TH-TOBACCO,TH-PIPE \?L22
	FSET? TH-TOBACCO,FL-LIGHTED \?L22
	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-DONT-DOESNT-MSG,GL-PRSI
	PRINTI "put out enough heat to light "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L22:	FSET? GL-PRSI,FL-BURNABLE /?L24
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot light "
	ICALL1 RT-THEO-PRINT
	PRINTI " with "
	ICALL1 RT-THEI-PRINT
	PRINTI "."
	CRLF
	CALL1 IS-OBJ-PROP-ANIMAL-PRSI? >STACK
	CALL PRINT-ID,STR?455,STACK >STACK
	RSTACK
?L24:	FSET? GL-PRSI,FL-LIGHTED /?L25
	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSI
	PRINTI "burning."
	CRLF
	CALL1 IS-OBJ-PROP-ANIMAL-PRSI? >STACK
	CALL PRINT-ID,STR?456,STACK >STACK
	RSTACK
?L25:	ICALL1 RT-CTHEO-PRINT
	PRINTI " catches fire quickly."
	CRLF
	CALL1 IS-OBJ-PROP-ANIMAL-PRSI? >STACK
	ICALL PRINT-ID,STR?457,STACK
	FSET TH-TORCH,FL-LIGHTED
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,1,0,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-TORCH-OUT,STACK
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L27
	CRLF
	PRINTI "Holmes looks at you and says, ""An ingenious solution, Watson. My compliments, old chap."""
	CRLF
?L27:	CALL2 RT-UPDATE-SCORE,4 >STACK
	RSTACK

	.FUNCT RT-LIGHT-PIPE,FIRE
	FSET? FIRE,FL-BURNABLE /?L1
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot light "
	ICALL1 RT-THEO-PRINT
	PRINTI " with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L1:	FSET? FIRE,FL-LIGHTED /?L3
	ICALL2 RT-CTHEO-PRINT,FIRE
	PRINTR " is not burning."
?L3:	FSET? TH-TOBACCO,FL-LIGHTED \?L4
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is already lit."
?L4:	IN? TH-TOBACCO,TH-PIPE \FALSE
	FSET TH-TOBACCO,FL-LIGHTED
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,15,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-PIPE-OUT,STACK
	PRINTI "After a few puffs, "
	ICALL1 RT-THEO-PRINT
	PRINTR " fires right up."

	.FUNCT RT-AC-TH-TOBACCO,CONTEXT,I
	ASSIGNED? 'CONTEXT /?L26
	SET 'CONTEXT,0
?L26:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-TOBACCO,FL-LIGHTED \?L3
	ICALL2 RT-CTHEO-PRINT,TH-TOBACCO
	PRINTR " is burning."
?L3:	PRINTR "It's Holmes's favorite brand of shag tobacco."
?L1:	ZERO? GL-NOW-PRSI? \?L6
	SET 'GL-P-IT-OBJECT,TH-TOBACCO
?L6:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH \?L8
	EQUAL? GL-PRSO,TH-TOBACCO \?L8
	EQUAL? GL-PRSI,0,TH-HANDS \?L10
	SET 'I,TH-MATCH
	JUMP ?L12
?L10:	SET 'I,GL-PRSI
?L12:	IN? I,GL-WINNER /?L13
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL2 RT-A-PRINT,I
	PRINTR "."
?L13:	IN? TH-PIPE,GL-WINNER /?L15
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL2 RT-THEO-PRINT,TH-PIPE
	PRINTR "."
?L15:	FSET? TH-TOBACCO,FL-LIGHTED \?L16
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is already lit."
?L16:	CALL2 RT-LIGHT-PIPE,I >STACK
	ZERO? STACK \TRUE
	ICALL1 RT-CTHEO-PRINT
	PRINTI " "
	PRINT K-SMOULDERS-MSG
	CRLF
	RTRUE
?L8:	EQUAL? GL-PRSA,V?TAKE,V?TOUCH \?L19
	FSET? TH-TOBACCO,FL-LIGHTED \?L19
	PRINTI "Yeeeeouch! That's hot!"
	CRLF
	CALL2 PRINT-ID,STR?458 >STACK
	RSTACK
?L19:	EQUAL? GL-PRSA,V?SMOKE \?L20
	FSET? TH-TOBACCO,FL-LIGHTED \?L21
	PRINT K-BRAND-MSG
	CRLF
	CALL2 PRINT-ID,STR?459 >STACK
	RSTACK
?L21:	ICALL1 RT-CTHEO-PRINT
	PRINTR " is not lit."
?L20:	EQUAL? GL-PRSA,V?SMELL \FALSE
	PRINTR "The shag has a strong, but pleasant smell."

	.FUNCT RT-AC-TH-PIPE,CONTEXT,I,DEST
	ASSIGNED? 'CONTEXT /?L53
	SET 'CONTEXT,0
?L53:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-TOBACCO,FL-LIGHTED \?L3
	IN? TH-TOBACCO,TH-PIPE \?L3
	PRINTI "Smoke gently wafts from "
	ICALL2 RT-THEO-PRINT,TH-PIPE
	PRINTR "."
?L3:	PRINTR "It is an old and oily black clay pipe, the companion of Holmes's deepest meditations."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \?L54
	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH \?L8
	EQUAL? GL-PRSI,0,TH-HANDS \?L10
	SET 'I,TH-MATCH
	JUMP ?L12
?L10:	SET 'I,GL-PRSI
?L12:	IN? I,GL-WINNER /?L13
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL2 RT-A-PRINT,I
	PRINTR "."
?L13:	IN? TH-PIPE,GL-WINNER /?L15
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL2 RT-THEO-PRINT,TH-PIPE
	PRINTR "."
?L15:	FSET? TH-TOBACCO,FL-LIGHTED \?L16
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is already lit."
?L16:	CALL2 RT-LIGHT-PIPE,I >STACK
	ZERO? STACK \TRUE
	PRINTR "There is nothing in the pipe to light."
?L8:	EQUAL? GL-PRSA,V?PUT \?L19
	EQUAL? GL-PRSI,TH-PLAYER-BODY \?L19
	GET GL-P-NAMW,1 >STACK
	EQUAL? STACK,W?MOUTH \?L19
	CALL RT-PERFORM,V?SMOKE,TH-PIPE >STACK
	RSTACK
?L19:	EQUAL? GL-PRSA,V?SMOKE \?L20
	FSET? TH-TOBACCO,FL-LIGHTED \?L21
	PRINT K-BRAND-MSG
	CRLF
	CALL2 PRINT-ID,STR?460 >STACK
	RSTACK
?L21:	ICALL1 RT-CTHEO-PRINT
	PRINTR " is not lit."
?L20:	EQUAL? GL-PRSA,V?EMPTY-INTO,V?POUR \FALSE
	IN? TH-TOBACCO,TH-PIPE \FALSE
	FSET? TH-TOBACCO,FL-LIGHTED \FALSE
	EQUAL? GL-PRSA,V?POUR \?L25
	FCLEAR TH-TOBACCO,FL-LIGHTED
	MOVE TH-TOBACCO,GL-PLACE-CUR
	ICALL2 RT-CTHEO-PRINT,TH-TOBACCO
	PRINTI " falls "
	EQUAL? GL-PLACE-CUR,RM-THAMES-ONE,RM-THAMES-TWO,RM-THAMES-THREE /?L29
	EQUAL? GL-PLACE-CUR,RM-THAMES-FOUR,RM-THAMES-FIVE \?L27
?L29:	REMOVE TH-TOBACCO
	PRINTR "into the water."
?L27:	PRINTI "to "
	FSET? GL-PLACE-CUR,FL-INDOORS \?L31
	ICALL1 TELL-THE-FLOOR
	JUMP ?L33
?L31:	ICALL1 TELL-THE-GROUND
?L33:	PRINTI ", "
	PRINT K-SMOULDERS-MSG
	CRLF
	RTRUE
?L25:	EQUAL? GL-PRSA,V?EMPTY-INTO \FALSE
	CALL RT-ROOM-IN-ON-MSG?,TH-TOBACCO,GL-PRSI >STACK
	ZERO? STACK \TRUE
	CALL RT-CHECK-MOVE-MSG?,TH-TOBACCO,GL-PRSI >STACK
	ZERO? STACK \TRUE
	FCLEAR TH-TOBACCO,FL-LIGHTED
	MOVE TH-TOBACCO,GL-PRSI
	ICALL2 RT-CTHEO-PRINT,TH-TOBACCO
	PRINTI " falls "
	FSET? GL-PRSI,FL-CONTAINER \?L39
	PRINTI "into"
	JUMP ?L41
?L39:	PRINTI "onto"
?L41:	PRINTI " "
	ICALL1 RT-THEI-PRINT
	PRINTI ", "
	PRINT K-SMOULDERS-MSG
	CRLF
	RTRUE
?L54:	EQUAL? GL-PRSA,V?PUT \?L45
	EQUAL? GL-PRSO,TH-TOBACCO /?L45
	PRINTI "Putting "
	ICALL1 RT-THEO-PRINT
	PRINTI " in "
	ICALL1 RT-THEI-PRINT
	PRINTI " would"
	CALL1 RT-WASTE-OF-TIME-MSG >STACK
	RSTACK
?L45:	EQUAL? GL-PRSA,V?POUR-FROM \FALSE
	EQUAL? GL-PRSO,TH-TOBACCO \FALSE
	IN? TH-TOBACCO,TH-PIPE \FALSE
	FSET? TH-TOBACCO,FL-LIGHTED \FALSE
	FCLEAR TH-TOBACCO,FL-LIGHTED
	MOVE TH-TOBACCO,GL-PLACE-CUR
	ICALL1 RT-CTHEO-PRINT
	PRINTI " falls to "
	FSET? GL-PLACE-CUR,FL-INDOORS \?L48
	ICALL1 TELL-THE-FLOOR
	ICALL2 PRINT-ID,STR?461
	JUMP ?L50
?L48:	ICALL1 TELL-THE-GROUND
?L50:	PRINTI ", "
	PRINT K-SMOULDERS-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-MAIL,CONTEXT
	ASSIGNED? 'CONTEXT /?L26
	SET 'CONTEXT,0
?L26:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-MAIL,FL-LIGHTED \FALSE
	ICALL2 RT-CTHEO-PRINT,TH-MAIL
	PRINTR " is burning."
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \?L7
	SET 'GL-P-IT-OBJECT,TH-MAIL
?L7:	EQUAL? GL-PRSA,V?READ,V?EXAMINE,V?LOOK-ON /?L11
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?OPEN,V?SEARCH /?L11
	EQUAL? GL-PRSA,V?OPEN-WITH \?L9
?L11:	PRINTI "You should not read other people's mail."
	CRLF
	CALL2 PRINT-ID,STR?462 >STACK
	RSTACK
?L9:	EQUAL? GL-PRSA,V?CLOSE \?L12
	PRINTR "The mail hasn't been opened."
?L12:	EQUAL? GL-PRSA,V?TAKE \?L13
	ZERO? KNIFE-COLD? /?L13
	SET 'KNIFE-COLD?,0
	MOVE TH-KNIFE,GL-WINNER
	PRINTI "[Taking the knife first]"
	ZERO? GL-P-MULT? /?L14
	PRINTI " "
	RFALSE
?L14:	CRLF
	RFALSE
?L13:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	FSET? TH-MAIL,FL-LIGHTED \?L18
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is already lit."
?L18:	FSET? GL-PRSI,FL-BURNABLE /?L20
	EQUAL? GL-PRSI,TH-PIPE \FALSE
?L20:	FSET? GL-PRSI,FL-LIGHTED \?L23
	FSET? GL-PRSI,FL-BURNABLE /?L22
?L23:	EQUAL? GL-PRSI,TH-PIPE \?L21
	FSET? TH-TOBACCO,FL-LIGHTED \?L21
?L22:	ICALL2 RT-CTHEO-PRINT,TH-MAIL
	PRINTI " lights up."
	CRLF
	ICALL2 PRINT-ID,STR?463
	FSET TH-MAIL,FL-LIGHTED
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,3,0 >STACK
	CALL RT-ALARM-SET-REL,RT-I-MAIL-OUT,STACK >STACK
	RSTACK
?L21:	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSI
	PRINTR "burning."

	.FUNCT RT-AC-TH-NEWSPAPER,CONTEXT
	ASSIGNED? 'CONTEXT /?L38
	SET 'CONTEXT,0
?L38:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-NEWSPAPER,FL-LIGHTED \?L3
	ICALL2 RT-CTHEO-PRINT,TH-NEWSPAPER
	PRINTR " is burning."
?L3:	PRINTR "It's the newspaper that came in your game package."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?READ,V?READ-TO,V?SHOW /?L7
	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH,V?GIVE /?L7
	EQUAL? GL-PRSA,V?TELL-ABOUT \FALSE
?L7:	IN? TH-NEWSPAPER,CH-PLAYER /?L8
	PRINTR "The newspaper will not leap into your hand by itself."
?L8:	EQUAL? GL-PRSA,V?READ \?L9
	CALL1 RT-READ-NEWSPAPER >STACK
	RSTACK
?L9:	EQUAL? GL-PRSA,V?READ-TO,V?SHOW,V?GIVE \?L12
	ZERO? GL-NOW-PRSI? /?L11
?L12:	EQUAL? GL-PRSA,V?TELL-ABOUT \?L10
	ZERO? GL-NOW-PRSI? /?L10
?L11:	FSET? GL-PRSI,FL-PERSON \FALSE
	FSET? TH-NEWSPAPER,FL-ASLEEP /?L16
	FSET? TH-NEWSPAPER,FL-OPENED \?L15
?L16:	ICALL1 RT-READ-NEWSPAPER
	CRLF
?L15:	EQUAL? GL-PRSA,V?READ-TO,V?SHOW,V?GIVE \?L21
	EQUAL? GL-PRSI,CH-HOLMES /?L20
?L21:	EQUAL? GL-PRSA,V?TELL-ABOUT \?L18
	EQUAL? GL-PRSO,CH-HOLMES \?L18
?L20:	FSET? CH-HOLMES,FL-ASLEEP \FALSE
	ICALL1 RT-WAKE-UP-HOLMES
	EQUAL? GL-PRSA,V?GIVE \TRUE
	MOVE TH-NEWSPAPER,CH-HOLMES
	RTRUE
?L18:	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-DONT-DOESNT-MSG,GL-PRSI
	PRINTR "seem to be interested."
?L10:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH \FALSE
	ZERO? GL-NOW-PRSI? \FALSE
	FSET? TH-NEWSPAPER,FL-LIGHTED \?L30
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is already lit."
?L30:	FSET? GL-PRSI,FL-BURNABLE /?L32
	EQUAL? GL-PRSI,TH-PIPE \FALSE
?L32:	FSET? GL-PRSI,FL-LIGHTED \?L35
	FSET? GL-PRSI,FL-BURNABLE /?L34
?L35:	EQUAL? GL-PRSI,TH-PIPE \?L33
	FSET? TH-TOBACCO,FL-LIGHTED \?L33
?L34:	ICALL2 RT-CTHEO-PRINT,TH-NEWSPAPER
	PRINTI " lights up."
	CRLF
	ICALL2 PRINT-ID,STR?464
	FSET TH-NEWSPAPER,FL-LIGHTED
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,3,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-NEWSPAPER-OUT,STACK
	RTRUE
?L33:	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSI
	PRINTR "burning."

	.FUNCT RT-AC-TH-WESTMINSTER-CLUE,CONTEXT
	ASSIGNED? 'CONTEXT /?L26
	SET 'CONTEXT,0
?L26:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	FSET? TH-MAIL,FL-LIGHTED \FALSE
	ICALL2 RT-CTHEO-PRINT,TH-MAIL
	PRINTR " is burning."
?L1:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?READ,V?EXAMINE \?L7
	IN? TH-WESTMINSTER-CLUE,CH-PLAYER /?L8
	PRINTR "The paper will not leap into your hand by itself."
?L8:	GETP TH-WESTMINSTER-CLUE,P?FLIPPED >STACK
	ZERO? STACK \?L10
	ICALL1 RT-INDENT-PRINT
	PRINTI "Mortality, behold and fear!"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "What a change of flesh is here!"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Think how many royal bones"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Sleep within this heap of stones:"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Here they lie, had realms and lands,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Who now want strength"
	ICALL1 RT-WRAP-PRINT
	PRINTI "to stir their hands."
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-ASTERISK-MSG
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "For two-score years I reigned alone,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "A virgin queen on England's throne."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "My navy caused Armada's shame,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "And with me died the Tudor name."
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-ASTERISK-MSG
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "The apple sorely tempted Eve,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "And Tell another aimed to cleave."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "But when one fell, it showed to me,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "The mighty pull of gravity."
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-ASTERISK-MSG
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "My father, it was said, would die,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Beneath the Holy City's sky."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Jerusalem his body claimed,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "And it is after him I'm named."
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-ASTERISK-MSG
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-ASTERISK-MSG
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "O stately Holmes of England,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "In Baker Street abide."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "For even you must surely fail,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTR "To save your country's pride."
?L10:	PRINTR "This side appears to be blank."
?L7:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH \?L12
	ZERO? GL-NOW-PRSI? \?L12
	FSET? TH-WESTMINSTER-CLUE,FL-LIGHTED \?L13
	ICALL1 RT-CTHEO-PRINT
	PRINTR " is already lit."
?L13:	FSET? GL-PRSI,FL-BURNABLE /?L15
	EQUAL? GL-PRSI,TH-PIPE \FALSE
?L15:	FSET? GL-PRSI,FL-LIGHTED \?L18
	FSET? GL-PRSI,FL-BURNABLE /?L17
?L18:	EQUAL? GL-PRSI,TH-PIPE \?L16
	FSET? TH-TOBACCO,FL-LIGHTED \?L16
?L17:	ICALL2 RT-CTHEO-PRINT,TH-WESTMINSTER-CLUE
	PRINTI " lights up."
	CRLF
	ICALL2 PRINT-ID,STR?465
	FSET TH-WESTMINSTER-CLUE,FL-LIGHTED
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,3,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-CLUE-OUT,STACK
	RTRUE
?L16:	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSI
	PRINTR "burning."
?L12:	EQUAL? GL-PRSA,V?FLIP \?L20
	IN? TH-WESTMINSTER-CLUE,GL-WINNER /?L21
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL2 RT-THEO-PRINT,TH-WESTMINSTER-CLUE
	PRINTR "."
?L21:	GETP TH-WESTMINSTER-CLUE,P?FLIPPED >STACK
	SUB 1,STACK >STACK
	PUTP TH-WESTMINSTER-CLUE,P?FLIPPED,STACK
	ICALL RT-CYOU-MSG,STR?467,STR?466
	ICALL2 RT-THEO-PRINT,TH-WESTMINSTER-CLUE
	PRINTR " over."
?L20:	EQUAL? GL-PRSA,V?LOOK-THRU \FALSE
	EQUAL? GL-PRSI,TH-MAGNIFYING-GLASS \FALSE
	PRINTR "It's been wiped clean."

	.FUNCT RT-AC-TH-WAX-HEAD,CONTEXT
	ASSIGNED? 'CONTEXT /?L30
	SET 'CONTEXT,0
?L30:	EQUAL? CONTEXT,K-M-SDESC \?L1
	FSET? TH-WAX-HEAD,FL-BROKEN \?L3
	PRINTI "wax pool"
	RTRUE
?L3:	PRINTI "wax head"
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \?L6
	FSET? TH-WAX-HEAD,FL-BROKEN \FALSE
	FIRST? TH-WAX-HEAD >STACK /FALSE
	PRINTI "Looks like any other "
	ICALL2 DPRINT,TH-WAX-HEAD
	PRINTR "."
?L6:	FSET? TH-WAX-HEAD,FL-BROKEN /FALSE
	IN? TH-WAX-HEAD,TH-CHARLES-STATUE \?L12
	EQUAL? GL-PRSA,V?TAKE,V?UNSCREW-FROM \?L14
	MOVE TH-WAX-HEAD,GL-WINNER
	FSET TH-WAX-HEAD,FL-SEEN
	FCLEAR TH-WAX-HEAD,FL-NODESC
	FCLEAR TH-WAX-HEAD,FL-NOALL
	ZERO? GL-P-MULT? /?L16
	PRINTR "Taken."
?L16:	ICALL RT-CYOU-MSG,STR?228,STR?227
	ICALL2 RT-THEO-PRINT,TH-WAX-HEAD
	PRINTR "."
?L14:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	FSET TH-WAX-HEAD,FL-SEEN
	ICALL2 RT-CTHEO-PRINT,TH-WAX-HEAD
	PRINTI " wobbles slightly."
	BAND CH-HOLMES-AUX1,K-HOLMES-HEAD? >STACK
	ZERO? STACK \?L20
	PRINTI " "
	ICALL2 RT-THEO-PRINT,CH-HOLMES
	PRINTI " says, ""Even when he was alive, he didn't have his head screwed on right."""
	BOR CH-HOLMES-AUX1,K-HOLMES-HEAD? >CH-HOLMES-AUX1
?L20:	CRLF
	RTRUE
?L12:	EQUAL? GL-PRSA,V?MELT,V?HEAT \?L24
	ZERO? GL-NOW-PRSI? \?L24
	FSET? GL-PRSI,FL-BURNABLE \?L26
	FSET? GL-PRSI,FL-LIGHTED /?L25
?L26:	EQUAL? GL-PRSI,TH-PIPE \?L24
	FSET? TH-TOBACCO,FL-LIGHTED \?L24
?L25:	ICALL1 RT-CTHEO-PRINT
	PRINTI " softens, but "
	ICALL1 RT-THEI-PRINT
	PRINTR " does not put out enough heat to melt it."
?L24:	EQUAL? GL-PRSA,V?MUNG,V?KILL,V?OPEN \FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "can't break into the head."
	CRLF
	CALL2 PRINT-ID,STR?468 >STACK
	RSTACK

	.FUNCT DESC-WAX-AX,CONTEXT
	ASSIGNED? 'CONTEXT /?L12
	SET 'CONTEXT,0
?L12:	EQUAL? CONTEXT,K-M-SDESC \?L1
	FSET? TH-WAX-AX,FL-BROKEN \?L3
	PRINTI "melted axe"
	RTRUE
?L3:	PRINTI "axe"
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	FSET? TH-WAX-AX,FL-BROKEN \FALSE
	FIRST? TH-WAX-AX >STACK /FALSE
	PRINTI "Looks like any other "
	ICALL2 DPRINT,TH-WAX-AX
	PRINTR "."

	.FUNCT RT-GUARD-TAKE-ITEM,OBJ1,OBJ2,OBJ3,STR
	ASSIGNED? 'OBJ2 /?L5
	SET 'OBJ2,0
?L5:	ASSIGNED? 'OBJ3 /?L6
	SET 'OBJ3,0
?L6:	ICALL2 RT-CTHEO-PRINT,CH-TUSSAUDS-GUARD
	PRINTI " says, ""I'm sorry, but "
	ICALL2 RT-THEO-PRINT,OBJ1
	ZERO? OBJ2 /?L3
	ZERO? OBJ3 /?L1
	PRINTI ", "
	ICALL2 RT-THEO-PRINT,OBJ2
	PRINTI " and "
	ICALL2 RT-THEO-PRINT,OBJ3
	PRINTI " are"
	SET 'STR,STR?469
	JUMP ?L4
?L1:	ZERO? OBJ2 /?L3
	PRINTI " and "
	ICALL2 RT-THEO-PRINT,OBJ2
	PRINTI " are"
	SET 'STR,STR?469
	JUMP ?L4
?L3:	PRINTI " is"
	SET 'STR,STR?470
?L4:	PRINTI " not to be removed."" He takes "
	PRINT STR
	PRINTI " and returns "
	PRINT STR
	PRINTI " to the proper place."
	CRLF
	CRLF
	CALL2 PRINT-ID,STR?471 >STACK
	RSTACK

	.FUNCT RT-GUARD-STOP-ENTRANCE,OBJ,WHO
	ASSIGNED? 'OBJ /?L7
	SET 'OBJ,0
?L7:	CALL1 RT-WHO-SAYS? >WHO
	IXCALL SOUNDS,S-BARK,S-START,8,4
	ICALL2 RT-CTHEO-PRINT,CH-MATCH-SNIFFING-DOG
	PRINTI " barks loudly and "
	ICALL2 RT-THEO-PRINT,CH-TUSSAUDS-GUARD
	PRINTI " says, ""Seeing as how it's you, "
	EQUAL? WHO,CH-HOLMES \?L1
	PRINTI "Mr Holmes"
	JUMP ?L3
?L1:	PRINTI "Doctor Watson"
?L3:	PRINTI ", I don't mind letting you in. But as you know we are very afraid of fire here, so we have trained this dog to detect matches or open flames. I'm afraid I can't allow you"
	EQUAL? WHO,CH-HOLMES,CH-WIGGINS \?L4
	PRINTI " or your companion"
?L4:	PRINTI " to enter until "
	ICALL2 RT-THEO-PRINT,OBJ
	PRINTR " has been discarded."""

	.FUNCT RT-EX-RM-EXIT-TUSSAUDS,IN1,IN2,IN3,TORCH
	EQUAL? GL-PRSO,P?SOUTH,P?OUT \FALSE
	EQUAL? GL-PLACE-CUR,RM-MADAME-TUSSAUDS \FALSE
	CALL RT-META-IN?,TH-TORCH,GL-WINNER >STACK
	ZERO? STACK \?L5
	CALL RT-META-IN?,TH-TORCH,GL-PUPPY >STACK
	ZERO? STACK /?L3
?L5:	SET 'TORCH,TH-TORCH
	SET 'IN1,TORCH
	JUMP ?L4
?L3:	SET 'IN1,0
?L4:	CALL RT-META-IN?,TH-WAX-HEAD,GL-WINNER >IN2
	ZERO? IN2 \?L7
	CALL RT-META-IN?,TH-WAX-HEAD,GL-PUPPY >IN2
?L7:	CALL RT-META-IN?,TH-WAX-AX,GL-WINNER >IN3
	ZERO? IN3 \?L9
	CALL RT-META-IN?,TH-WAX-AX,GL-PUPPY >IN3
?L9:	ZERO? IN1 /?L14
	ZERO? IN2 /?L11
	ZERO? IN3 /?L11
	ICALL RT-GUARD-TAKE-ITEM,TH-TORCH,TH-WAX-HEAD,TH-WAX-AX
	JUMP ?L18
?L11:	ZERO? IN1 /?L14
	ZERO? IN2 /?L13
	ICALL RT-GUARD-TAKE-ITEM,TH-TORCH,TH-WAX-HEAD
	JUMP ?L18
?L13:	ZERO? IN1 /?L14
	ZERO? IN3 /?L14
	ICALL RT-GUARD-TAKE-ITEM,TH-TORCH,TH-WAX-AX
	JUMP ?L18
?L14:	ZERO? IN2 /?L15
	ZERO? IN3 /?L15
	ICALL RT-GUARD-TAKE-ITEM,TH-WAX-HEAD,TH-WAX-AX
	JUMP ?L18
?L15:	ZERO? IN1 /?L16
	ICALL2 RT-GUARD-TAKE-ITEM,TH-TORCH
	JUMP ?L18
?L16:	ZERO? IN2 /?L17
	ICALL2 RT-GUARD-TAKE-ITEM,TH-WAX-HEAD
	JUMP ?L18
?L17:	ZERO? IN3 /?L18
	ICALL2 RT-GUARD-TAKE-ITEM,TH-WAX-AX
?L18:	ZERO? IN1 /?L22
	MOVE TORCH,TH-FAWKES-STATUE
	FSET TORCH,FL-NODESC
	FSET? TORCH,FL-LIGHTED \?L22
	ICALL2 RT-ALARM-CLR,RT-I-TORCH-OUT
	ICALL1 RT-I-TORCH-OUT
	FSET TH-TORCH,FL-NODESC
?L22:	ZERO? IN2 /?L26
	MOVE TH-WAX-HEAD,TH-CHARLES-STATUE
	FSET TH-WAX-HEAD,FL-NODESC
?L26:	ZERO? IN3 /?L29
	MOVE TH-WAX-AX,TH-CHARLES-STATUE
	FSET TH-WAX-AX,FL-NODESC
?L29:	RETURN RM-MARYLEBONE-RD

	.FUNCT RT-EX-RM-MATCH-SNIFFING-DOG,OBJ,FLAME?,FIRST,LAMP?,MATCH?
	SET 'FLAME?,0
	SET 'FIRST,1
	EQUAL? GL-PRSO,P?NORTH,P?IN \FALSE
	EQUAL? GL-PLACE-CUR,RM-MARYLEBONE-RD \FALSE
?L3:	FIRST? GL-WINNER >OBJ \?L7
?L8:	FSET? OBJ,FL-BURNABLE \?L10
	FSET? OBJ,FL-LIGHTED \?L10
	EQUAL? OBJ,TH-TOBACCO /?L10
	SET 'FLAME?,OBJ
	JUMP ?L7
?L10:	NEXT? OBJ >OBJ /?L8
?L7:	ZERO? FLAME? \?L4
	ZERO? FIRST /?L4
	ZERO? GL-PUPPY /?L4
	FIRST? GL-PUPPY >OBJ /?L15
?L15:	SET 'FIRST,0
	JUMP ?L3
?L4:	CALL RT-META-IN?,TH-MATCH,CH-PLAYER >STACK
	ZERO? STACK \?L21
	CALL RT-META-IN?,TH-MATCH,GL-PUPPY >STACK
	ZERO? STACK \?L21
	SET 'MATCH?,0
	JUMP ?L27
?L21:	FSET? TH-MATCH,FL-BURNABLE /?L24
	SET 'MATCH?,0
	JUMP ?L23
?L24:	SET 'MATCH?,1
	JUMP ?L27
?L23:	FSET? TH-MATCH,FL-LIGHTED /?L26
	SET 'MATCH?,0
	JUMP ?L27
?L26:	SET 'MATCH?,1
?L27:	ZERO? MATCH? \?L19
	CALL RT-META-IN?,TH-LAMP,CH-PLAYER >LAMP?
	ZERO? LAMP? \?L19
	CALL RT-META-IN?,TH-LAMP,GL-PUPPY >LAMP?
	ZERO? LAMP? \?L19
	ZERO? FLAME? /?L17
?L19:	ZERO? FLAME? /?L30
	SET 'OBJ,FLAME?
	JUMP ?L31
?L30:	ZERO? LAMP? /?L32
	SET 'OBJ,TH-LAMP
	JUMP ?L31
?L32:	ZERO? MATCH? /?L33
	SET 'OBJ,TH-MATCH
	JUMP ?L31
?L33:	SET 'OBJ,0
?L31:	ICALL2 RT-GUARD-STOP-ENTRANCE,OBJ
	RFALSE
?L17:	FSET? TH-WAX-HEAD,FL-BROKEN /?L38
	FSET? TH-WAX-AX,FL-BROKEN \?L36
?L38:	PRINTI "The guard blocks your path and says, ""Oh no you don't, laddie. When I let you in earlier you made a proper mess of my museum. I won't let you do that again."" After you promise to pay for the damage and plead with him for a few moments, he finally steps aside."
	CRLF
	CRLF
?L36:	RETURN RM-MADAME-TUSSAUDS

	.FUNCT RT-PUT-OUT,THING
	FSET? THING,FL-BURNABLE \FALSE
	FSET? THING,FL-LIGHTED \FALSE
	EQUAL? THING,TH-MATCH \?L4
	ICALL2 RT-ALARM-CLR,RT-I-MATCH-OUT
	CALL1 RT-I-MATCH-OUT >STACK
	RSTACK
?L4:	EQUAL? THING,TH-PIPE \?L5
	ICALL2 RT-ALARM-CLR,RT-I-PIPE-OUT
	CALL1 RT-I-PIPE-OUT >STACK
	RSTACK
?L5:	EQUAL? THING,TH-TORCH \?L6
	ICALL2 RT-ALARM-CLR,RT-I-TORCH-OUT
	CALL1 RT-I-TORCH-OUT >STACK
	RSTACK
?L6:	EQUAL? THING,TH-NEWSPAPER \?L7
	ICALL2 RT-ALARM-CLR,RT-I-NEWSPAPER-OUT
	CALL1 RT-I-NEWSPAPER-OUT >STACK
	RSTACK
?L7:	EQUAL? THING,TH-WESTMINSTER-CLUE \?L8
	ICALL2 RT-ALARM-CLR,RT-I-CLUE-OUT
	CALL1 RT-I-CLUE-OUT >STACK
	RSTACK
?L8:	EQUAL? THING,TH-MAIL \?L9
	ICALL2 RT-ALARM-CLR,RT-I-MAIL-OUT
	CALL1 RT-I-MAIL-OUT >STACK
	RSTACK
?L9:	EQUAL? THING,TH-MATCHBOOK \?L10
	ICALL2 RT-ALARM-CLR,RT-I-MATCHBOOK-OUT
	CALL1 RT-I-MATCHBOOK-OUT >STACK
	RSTACK
?L10:	REMOVE THING
	FCLEAR THING,FL-WORN
	FCLEAR THING,FL-LIGHTED
	FCLEAR THING,FL-BURNABLE
	ICALL2 RT-CTHEO-PRINT,THING
	PRINTI " burn"
	ICALL2 RT-S-NOS-MSG,THING
	PRINTR " up and disappears."

	.FUNCT RT-I-MATCH-OUT,RESULT
	SET 'RESULT,0
	CALL2 RT-VISIBLE?,TH-MATCH >STACK
	ZERO? STACK /?L1
	CRLF
	ICALL2 RT-CTHEO-PRINT,TH-MATCH
	PRINTI " flickers and dies."
	CRLF
	SET 'RESULT,1
?L1:	FCLEAR TH-MATCH,FL-LIGHTED
	ICALL1 BURN-MATCH-OUT
	RETURN RESULT

	.FUNCT BURN-MATCH-OUT
	FCLEAR TH-MATCH,FL-BURNABLE
	FSET TH-MATCH,FL-BROKEN
	GETPT TH-MATCH,P?ADJECTIVE >STACK
	PUT STACK,0,W?BURNT
	RTRUE

	.FUNCT RT-I-PIPE-OUT,RESULT
	SET 'RESULT,0
	CALL2 RT-VISIBLE?,TH-TOBACCO >STACK
	ZERO? STACK /?L1
	CRLF
	ICALL2 RT-CTHEO-PRINT,TH-PIPE
	PRINTI " has gone out."
	CRLF
?L1:	FCLEAR TH-TOBACCO,FL-LIGHTED
	FCLEAR TH-TOBACCO,FL-BURNABLE
	REMOVE TH-TOBACCO
	RETURN RESULT

	.FUNCT RT-I-TORCH-OUT,RESULT
	SET 'RESULT,0
	CALL2 RT-VISIBLE?,TH-TORCH >STACK
	ZERO? STACK /?L1
	CRLF
	ICALL2 RT-CTHEO-PRINT,TH-TORCH
	PRINTI " sputters and dies."
	CRLF
	SET 'RESULT,1
?L1:	ICALL2 CLEAR-ALL-FLAGS,TH-TORCH
	GETPT TH-TORCH,P?ADJECTIVE >STACK
	PUT STACK,0,W?BURNT
	FSET TH-TORCH,FL-TAKEABLE
	FSET TH-TORCH,FL-BROKEN
	RETURN RESULT

	.FUNCT RT-I-NEWSPAPER-OUT,RESULT
	SET 'RESULT,0
	CALL2 RT-VISIBLE?,TH-NEWSPAPER >STACK
	ZERO? STACK /?L1
	CRLF
	ICALL2 RT-CTHEO-PRINT,TH-NEWSPAPER
	PRINTI " disappears into a cloud of fine ash, which itself disappears."
	CRLF
	SET 'RESULT,1
?L1:	FCLEAR TH-NEWSPAPER,FL-LIGHTED
	FCLEAR TH-NEWSPAPER,FL-BURNABLE
	REMOVE TH-NEWSPAPER
	RETURN RESULT

	.FUNCT RT-I-CLUE-OUT,RESULT
	SET 'RESULT,0
	CALL2 RT-VISIBLE?,TH-WESTMINSTER-CLUE >STACK
	ZERO? STACK /?L1
	CRLF
	ICALL2 RT-CTHEO-PRINT,TH-WESTMINSTER-CLUE
	PRINTI " disappears in a puff of oily black smoke."
	CRLF
	SET 'RESULT,1
?L1:	FCLEAR TH-WESTMINSTER-CLUE,FL-LIGHTED
	FCLEAR TH-WESTMINSTER-CLUE,FL-BURNABLE
	REMOVE TH-WESTMINSTER-CLUE
	RETURN RESULT

	.FUNCT RT-I-MAIL-OUT,RESULT
	SET 'RESULT,0
	CALL2 RT-VISIBLE?,TH-MAIL >STACK
	ZERO? STACK /?L1
	CRLF
	ICALL2 RT-CTHEO-PRINT,TH-MAIL
	PRINTI " disappears in a flash of light."
	CRLF
	SET 'RESULT,1
?L1:	FCLEAR TH-MAIL,FL-LIGHTED
	FCLEAR TH-MAIL,FL-BURNABLE
	REMOVE TH-MAIL
	RETURN RESULT

	.FUNCT RT-I-MATCHBOOK-OUT,RESULT
	SET 'RESULT,0
	CALL2 RT-VISIBLE?,TH-MATCHBOOK >STACK
	ZERO? STACK /?L1
	CRLF
	ICALL2 RT-CTHEO-PRINT,TH-MATCHBOOK
	PRINTI " burns up and disappears."
	CRLF
	SET 'RESULT,1
?L1:	FCLEAR TH-MATCHBOOK,FL-LIGHTED
	FCLEAR TH-MATCHBOOK,FL-BURNABLE
	REMOVE TH-MATCHBOOK
	RETURN RESULT

	.FUNCT PRE-LIGHT-WITH
	EQUAL? GL-PRSO,TH-MATCH,TH-TOBACCO /FALSE
	IN? GL-PRSO,GL-WINNER /FALSE
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?294,GL-PRSO
	PRINTI " to light "
	ICALL2 RT-SAY-HIM-HER-THEM-IT-MSG,GL-PRSO
	PRINTR "."

	.FUNCT RT-GN-WAX,TBL,LEN
	ASSIGNED? 'LEN /?L1
	SET 'LEN,0
?L1:	PUTP PSEUDO-OBJECT,P?ACTION,RT-DF-LG-WAX-STATUES
	SET 'LAST-PSEUDO-LOC,GL-PLACE-CUR
	RETURN PSEUDO-OBJECT

	.FUNCT RT-KIDNAP
	MOVE CH-HOLMES,RM-LAIR
	MOVE TH-ROPE,CH-HOLMES
	FSET CH-HOLMES,FL-LOCKED
	SET 'TH-ROPE-AUX1,CH-HOLMES
	BAND MYCROFT-STATE,-2 >MYCROFT-STATE
	SET 'GL-PUPPY,0
	CRLF
	PRINTI "Suddenly, someone grabs you from behind, pins your arms to your sides, and covers up your head. You struggle fiercely to get loose, but to no avail. Then you hear a voice shout, ""Let him go, we've got the other one."""
	CRLF
	CRLF
	PRINTI "The person holding you knocks you on the head and flings you to the ground. You lose consciousness for a few moments, and when you awake, you are alone."
	CRLF
	CRLF
	PRINTI "Sherlock Holmes has been kidnapped."
	CRLF
	ICALL2 PRINT-ID,STR?472
	RTRUE

	.FUNCT RT-WIGGINS-HELP-MSG
	ICALL2 RT-CTHEO-PRINT,CH-WIGGINS
	PRINTI " says, ""I saw it all, guv'nor. But it was over before I could lift a finger. Mr 'Olmes was a friend to me, 'e was. And I'd do anyfing to 'elp you get 'im back."""
	CRLF
	SET 'GL-PUPPY,CH-WIGGINS
	FCLEAR CH-WIGGINS,FL-NODESC
	FCLEAR CH-WIGGINS,FL-BROKEN
	SET 'GL-PUPPY-MSG?,0
	RETURN GL-PUPPY-MSG?

	.FUNCT RT-STEAL-KEY
	ZERO? BOX-KEY-COLD? \?L1
	SET 'BOX-KEY-COLD?,1
	MOVE TH-BOX-KEY,CH-PLAYER
	ICALL2 RT-CTHEO-PRINT,CH-WIGGINS
	PRINTI " casually strolls past the guard and says, ""Cor blimey. That bird isn't 'alf built, is she?"" While the guard's attention is diverted, Wiggins's hand flashes in and out of his pocket. Then just as casually as before, he strolls back to you, slips something into your hand, and whispers, ""Sorry I couldn't get everything, guv. I 'ope this is enough."""
	CRLF
	ICALL2 PRINT-ID,STR?473
	GETP TH-BOX-KEY,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-BOX-KEY,P?VALUE,0
	RTRUE
?L1:	PRINTI """Sorry, guv. 'E'll never go for it twice."""
	CRLF
	ICALL2 PRINT-ID,STR?474
	RTRUE

	.FUNCT RT-AC-TH-INTNUM,CONTEXT
	ASSIGNED? 'CONTEXT /?L9
	SET 'CONTEXT,0
?L9:	EQUAL? GL-PRSA,V?WAIT-FOR,V?WAIT,V?VERIFY /FALSE
	EQUAL? GL-PRSA,V?SHOOT \?L3
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	EQUAL? GL-PLACE-CUR,RM-BANK-VAULT /FALSE
	EQUAL? GL-P-NUMBER,-1 \?L5
	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTR "not see that here."
?L5:	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTR "not need to use a number here."

	.FUNCT RT-AC-TH-RING,CONTEXT
	ASSIGNED? 'CONTEXT /?L8
	SET 'CONTEXT,0
?L8:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?WEAR \FALSE
	PRINTR "It's the wrong size."

	.FUNCT RT-AC-TH-BOX-KEY,CONTEXT
	ASSIGNED? 'CONTEXT /?L30
	SET 'CONTEXT,0
?L30:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	IN? TH-BOX-KEY,TH-GUARDS-POCKET /?L5
	IN? TH-BOX-KEY,CH-BANK-GUARD \?L3
?L5:	ICALL1 RT-CYOU-MSG
	PRINTR "can't see it. The guard has it."
?L3:	ICALL2 RT-CTHEO-PRINT,TH-BOX-KEY
	PRINTR " has the word ""Master"" written on it."
?L1:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?TURN \?L9
	IN? TH-BOX-KEY,TH-BOX-LOCK \FALSE
	EQUAL? TH-BOX-KEY-AUX1,K-GEM-BOX-NUM \?L13
	FSET? TH-SAFETY-DEPOSIT-BOX,FL-OPENED \?L15
	PRINTR "The box is already open."
?L15:	SET 'TH-SAFETY-DEPOSIT-BOX-AUX1,TH-BOX-KEY-AUX1
	ICALL RT-CYOU-MSG,STR?108,STR?243
	PRINTI "the box with the key."
	FIRST? TH-SAFETY-DEPOSIT-BOX >STACK \?L18
	PRINTI " Inside you see "
	ICALL2 RT-PRINT-CONTENTS-2,TH-SAFETY-DEPOSIT-BOX
	PRINTI "."
?L18:	FSET TH-SAFETY-DEPOSIT-BOX,FL-OPENED
	FCLEAR TH-SAFETY-DEPOSIT-BOX,FL-LOCKED
	CRLF
	RTRUE
?L13:	ICALL RT-CYOU-MSG,STR?108,STR?243
	PRINT K-NOTHING-INSIDE-MSG
	ICALL RT-YOU-MSG,STR?476,STR?475
	PRINTR "it back up again."
?L9:	EQUAL? GL-PRSA,V?READ \FALSE
	IN? TH-BOX-KEY,TH-GUARDS-POCKET /?L26
	IN? TH-BOX-KEY,CH-BANK-GUARD \?L24
?L26:	ICALL1 RT-CYOU-MSG
	PRINTR "can't see it. The guard has it."
?L24:	PRINTR "It says, Master."""

	.FUNCT RT-AC-TH-BOX-LOCK,CONTEXT,NUM
	ASSIGNED? 'CONTEXT /?L27
	SET 'CONTEXT,0
?L27:	EQUAL? GL-P-NUMBER,-1 \?L1
	ZERO? TH-BOX-LOCK-AUX1 \?L8
	PRINT K-SPECIFY-MSG
	PRINTR "lock by number."
?L1:	LESS? GL-P-NUMBER,1 /?L7
	GRTR? GL-P-NUMBER,999 \?L6
?L7:	PRINTI "There is no lock number "
	PRINTN GL-P-NUMBER
	PRINTR "."
?L6:	SET 'TH-BOX-LOCK-AUX1,GL-P-NUMBER
?L8:	SET 'NUM,TH-BOX-LOCK-AUX1
	ZERO? GL-NOW-PRSI? /?L28
	EQUAL? GL-PRSA,V?PUT \?L11
	EQUAL? GL-PRSO,TH-BOX-KEY \?L13
	MOVE TH-BOX-KEY,TH-BOX-LOCK
	SET 'TH-BOX-KEY-AUX1,TH-BOX-LOCK-AUX1
	PRINTR "The key fits nicely."
?L13:	CALL1 RT-CANT-PUT-IN-ON-MSG >STACK
	RSTACK
?L11:	EQUAL? GL-PRSA,V?TAKE \FALSE
	EQUAL? GL-PRSO,TH-BOX-KEY \FALSE
	IN? TH-BOX-KEY,TH-BOX-LOCK \FALSE
	MOVE TH-BOX-KEY,GL-WINNER
	SET 'TH-BOX-KEY-AUX1,0
	PRINTR "The key comes out smoothly."
?L28:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?477 >STACK
	RSTACK

	.FUNCT RT-AC-TH-SAFETY-DEPOSIT-BOX,CONTEXT,NUM
	ASSIGNED? 'CONTEXT /?L57
	SET 'CONTEXT,0
?L57:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	SET 'NUM,TH-SAFETY-DEPOSIT-BOX-AUX1
	PRINTR "It looks the same as all the other boxes."
?L1:	EQUAL? GL-P-NUMBER,-1 \?L3
	ZERO? TH-SAFETY-DEPOSIT-BOX-AUX1 \?L4
	PRINT K-SPECIFY-MSG
	PRINTR "box by number."
?L4:	FSET? TH-SAFETY-DEPOSIT-BOX,FL-OPENED \?L10
	SET 'TH-SAFETY-DEPOSIT-BOX-AUX1,600
	JUMP ?L10
?L3:	LESS? GL-P-NUMBER,1 /?L9
	GRTR? GL-P-NUMBER,999 \?L8
?L9:	PRINTI "There is no box number "
	PRINTN GL-P-NUMBER
	PRINTR "."
?L8:	SET 'TH-SAFETY-DEPOSIT-BOX-AUX1,GL-P-NUMBER
?L10:	SET 'NUM,TH-SAFETY-DEPOSIT-BOX-AUX1
	ZERO? GL-NOW-PRSI? /?L58
	EQUAL? GL-PRSA,V?TAKE,V?PUT,V?FILL /?L15
	EQUAL? GL-PRSA,V?EMPTY-INTO,V?POUR-FROM \FALSE
?L15:	EQUAL? NUM,K-GEM-BOX-NUM \?L18
	FSET? TH-SAFETY-DEPOSIT-BOX,FL-OPENED /FALSE
?L18:	ICALL1 RT-CTHEI-PRINT
	PRINTR " is closed."
?L58:	EQUAL? GL-PRSA,V?UNLOCK,V?OPEN,V?OPEN-WITH \?L22
	EQUAL? GL-PRSI,0,TH-BOX-KEY /?L24
	ICALL1 RT-CYOU-MSG
	PRINTI "can't "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL1 RT-THEO-PRINT
	PRINTI " with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L24:	IN? TH-BOX-KEY,GL-WINNER /?L26
	EQUAL? NUM,TH-BOX-KEY-AUX1 /?L26
	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTR "not have the key."
?L26:	EQUAL? NUM,K-GEM-BOX-NUM \?L27
	FSET? TH-SAFETY-DEPOSIT-BOX,FL-OPENED \?L28
	PRINTR "It is already open."
?L28:	ICALL RT-CYOU-MSG,STR?108,STR?243
	PRINTI "the box with the key."
	ICALL2 PRINT-ID,STR?478
	FIRST? TH-SAFETY-DEPOSIT-BOX >STACK \?L31
	PRINTI " Inside you see "
	ICALL2 RT-PRINT-CONTENTS-2,TH-SAFETY-DEPOSIT-BOX
	PRINTI "."
?L31:	FSET TH-SAFETY-DEPOSIT-BOX,FL-OPENED
	FCLEAR TH-SAFETY-DEPOSIT-BOX,FL-LOCKED
	CRLF
	RTRUE
?L27:	ICALL RT-CYOU-MSG,STR?108,STR?243
	PRINT K-NOTHING-INSIDE-MSG
	ICALL RT-YOU-MSG,STR?476,STR?475
	PRINTR "it back up again."
?L22:	EQUAL? GL-PRSA,V?LOCK,V?CLOSE \?L35
	EQUAL? NUM,K-GEM-BOX-NUM \?L36
	IN? TH-BOX-KEY,GL-WINNER /?L38
	EQUAL? NUM,TH-BOX-KEY-AUX1 /?L38
	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTR "not have the key."
?L38:	FSET? TH-SAFETY-DEPOSIT-BOX,FL-OPENED /?L40
	PRINT K-CLOSED-AND-LOCKED-MSG
	CRLF
	RTRUE
?L40:	ICALL RT-CYOU-MSG,STR?480,STR?479
	PRINTI "the box with the key."
	FCLEAR TH-SAFETY-DEPOSIT-BOX,FL-OPENED
	FSET TH-SAFETY-DEPOSIT-BOX,FL-LOCKED
	CRLF
	RTRUE
?L36:	PRINT K-CLOSED-AND-LOCKED-MSG
	CRLF
	RTRUE
?L35:	EQUAL? GL-PRSA,V?READ \?L43
	PRINTN TH-SAFETY-DEPOSIT-BOX-AUX1
	CRLF
	RTRUE
?L43:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L44
	EQUAL? NUM,K-GEM-BOX-NUM \?L47
	FSET? TH-SAFETY-DEPOSIT-BOX,FL-OPENED /?L45
?L47:	ICALL1 RT-CTHEO-PRINT
	PRINTR " is closed."
?L45:	PRINTI "Inside "
	ICALL1 RT-THEO-PRINT
	ICALL RT-YOU-MSG,STR?155,STR?154
	ICALL2 RT-PRINT-CONTENTS-2,TH-SAFETY-DEPOSIT-BOX
	PRINTR "."
?L44:	EQUAL? GL-PRSA,V?EMPTY,V?REACH-IN \?L49
	EQUAL? NUM,K-GEM-BOX-NUM \?L52
	FSET? TH-SAFETY-DEPOSIT-BOX,FL-OPENED /FALSE
?L52:	ICALL1 RT-CTHEO-PRINT
	PRINTR " is closed."
?L49:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?481 >STACK
	RSTACK

	.FUNCT RT-AC-TH-DIAL,CONTEXT,LOCK?,WHO,PTS
	ASSIGNED? 'CONTEXT /?L43
	SET 'CONTEXT,0
?L43:	SET 'LOCK?,0
	ZERO? CONTEXT \FALSE
	ZERO? TH-DIAL-AUX1 \?L3
	SET 'TH-DIAL-AUX1,TH-RIGHT
?L3:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?TUNE-TO \?L8
	EQUAL? GL-PRSI,0,TH-LEFT,TH-RIGHT /?L8
	ICALL1 RT-CYOU-MSG
	PRINTI "can't "
	PRINTB GL-P-PRSA-WORD
	PRINTI " "
	ICALL2 RT-THEO-PRINT,TH-DIAL
	PRINTI " to "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L8:	EQUAL? GL-PRSA,V?TUNE-TO,V?SPIN,V?TURN \?L10
	EQUAL? GL-PRSI,0,TH-LEFT,TH-RIGHT /?L13
	EQUAL? GL-PRSI,TH-HANDS \?L11
?L13:	FSET? TH-STETHOSCOPE,FL-WORN /?L14
	SET 'LOCK?,1
	PRINTI "The dial turns smoothly."
	CRLF
	JUMP ?L20
?L14:	EQUAL? GL-LISTEN-OBJ,TH-DIAL,LG-BANK-VAULT-DOOR,RM-BANK-VAULT /?L16
	SET 'LOCK?,1
	PRINTI "The dial turns quietly."
	CRLF
	JUMP ?L20
?L16:	FSET? TH-COTTON-BALLS,FL-WORN \?L17
	SET 'LOCK?,1
	PRINTI "The dial turns with a series of muffled clicks."
	CRLF
	JUMP ?L20
?L17:	FSET? LG-BANK-VAULT-DOOR,FL-OPENED \?L18
	SET 'LOCK?,2
	PRINTI "Clunk."
	CRLF
	JUMP ?L20
?L18:	EQUAL? TH-DIAL-AUX1,GL-PRSI /?L19
	SET 'LOCK?,1
	PRINTI "Clunk."
	CRLF
	JUMP ?L20
?L19:	INC 'TH-DIAL-AUX2
?L20:	EQUAL? LOCK?,1 /?L45
	EQUAL? TH-DIAL-AUX2,1 \?L23
	SET 'TH-DIAL-AUX1,TH-RIGHT
	PRINTI "Whirr."
	CRLF
	JUMP ?L35
?L23:	EQUAL? TH-DIAL-AUX2,2 \?L24
	SET 'TH-DIAL-AUX1,TH-LEFT
	PRINTI "Click."
	CRLF
	JUMP ?L35
?L24:	EQUAL? TH-DIAL-AUX2,3 \?L25
	SET 'TH-DIAL-AUX1,TH-RIGHT
	PRINTI "Click."
	CRLF
	JUMP ?L35
?L25:	EQUAL? TH-DIAL-AUX2,4 \?L26
	SET 'TH-DIAL-AUX1,TH-RIGHT
	PRINTI "Whirr."
	CRLF
	JUMP ?L35
?L26:	EQUAL? TH-DIAL-AUX2,5 \?L35
	SET 'LOCK?,2
	PRINTI "Click. Kerchunk. The vault door swings open."
	CRLF
	ICALL2 PRINT-ID,STR?482
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L28
	CRLF
	PRINTI "Holmes says, ""Splendid, Watson. The net is drawing ever tighter around our quarry."""
	CRLF
?L28:	GETP LG-BANK-VAULT-DOOR,P?VALUE >PTS
	ZERO? PTS /?L35
	ICALL2 RT-UPDATE-SCORE,PTS
	PUTP LG-BANK-VAULT-DOOR,P?VALUE,0
	JUMP ?L35
?L11:	ICALL1 RT-IMPOSSIBLE-MSG
?L35:	EQUAL? LOCK?,1 \?L36
?L45:	SET 'TH-DIAL-AUX1,0
	SET 'TH-DIAL-AUX2,0
	RTRUE
?L36:	EQUAL? LOCK?,2 \TRUE
	SET 'TH-DIAL-AUX1,-1
	SET 'TH-DIAL-AUX2,-1
	FCLEAR LG-BANK-VAULT-DOOR,FL-LOCKED
	FSET LG-BANK-VAULT-DOOR,FL-OPENED
	RTRUE
?L10:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-TH-BOXES,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "There are rows and rows of safety deposit boxes, all alike, numbered from 1 to 999."
?L1:	EQUAL? GL-PRSA,V?UNLOCK,V?LOCK,V?OPEN /?L4
	EQUAL? GL-PRSA,V?CLOSE,V?READ \?L3
?L4:	PRINT K-SPECIFY-MSG
	PRINTI "box by number."
	CRLF
	RETURN 2
?L3:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?483 >STACK
	RSTACK

	.FUNCT RT-AC-TH-GUARDS-POCKET
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?EXAMINE,V?SEARCH \?L1
	ICALL1 RT-CYOU-MSG
	PRINTR "can't see inside the guard's pocket."
?L1:	EQUAL? GL-PRSA,V?PUT \?L3
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE
?L3:	EQUAL? GL-PRSA,V?TAKE,V?EMPTY,V?REACH-IN /?L5
	EQUAL? GL-PRSA,V?STEAL \FALSE
?L5:	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINTI " slaps the offending hand away and says, ""Keep your hands to yourself, mate."""
	CRLF
	ICALL2 PRINT-ID,STR?484
	RTRUE

	.FUNCT RT-AC-CH-BANK-GUARD,CONTEXT,GEMCNT,OBJ
	ASSIGNED? 'CONTEXT /?L60
	SET 'CONTEXT,0
?L60:	ICALL2 RT-THIS-IS-IT,CH-BANK-GUARD
	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINTR " is lounging against the wall, idly jangling some keys in his pocket and waiting for girls to walk by."
?L1:	CALL2 RT-TELL-ABOUT?,CH-BANK-GUARD >STACK
	ZERO? STACK /?L3
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L4
	SET 'OBJ,GL-PRSO
	JUMP ?L6
?L4:	SET 'OBJ,GL-PRSI
?L6:	PRINT K-GUARD-IGNORES-MSG
	CRLF
	RTRUE
?L3:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L7
	RETURN 2
?L7:	EQUAL? CONTEXT,K-M-WINNER \?L8
	EQUAL? GL-PRSA,V?GIVE \?L9
	EQUAL? GL-PRSO,TH-BOX-KEY,TH-GUARDS-KEYS \?L11
	PRINT K-SORRY-MATE-MSG
	CRLF
	RTRUE
?L11:	EQUAL? GL-PRSO,TH-OPAL,TH-RUBY,TH-SAPPHIRE /?L14
	EQUAL? GL-PRSO,TH-EMERALD \FALSE
?L14:	PRINT K-ILL-HOLD-IT-MSG
	CRLF
	RTRUE
?L9:	PRINT K-GUARD-IGNORES-MSG
	CRLF
	RTRUE
?L8:	ZERO? GL-NOW-PRSI? /?L61
	EQUAL? GL-PRSA,V?GIVE \?L18
	EQUAL? GL-PRSO,TH-OPAL,TH-RUBY,TH-SAPPHIRE /?L22
	EQUAL? GL-PRSO,TH-EMERALD \?L20
?L22:	MOVE GL-PRSO,CH-BANK-GUARD
	FSET GL-PRSO,FL-NOALL
	SET 'GEMCNT,CH-BANK-GUARD-AUX1
	INC 'GEMCNT
	SET 'CH-BANK-GUARD-AUX1,GEMCNT
	EQUAL? GEMCNT,1 \?L23
	PRINTR """Now this is very nice. But I think I would need more than just one to make letting you in worth my while. I'll hold this for you until you come back."""
?L23:	EQUAL? GEMCNT,2 \?L25
	PRINTR """This is even more beautiful than the other one. But it isn't worth taking the risk for only two of them."""
?L25:	EQUAL? GEMCNT,3 \?L26
	PRINTR """One more and you're in."""
?L26:	EQUAL? GEMCNT,4 \TRUE
	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINTI " looks furtively up and down the street. Then he whispers to you out of the side of his mouth, ""Good enough. Go on in."""
	CRLF
	ICALL2 RT-UPDATE-SCORE,3
	RTRUE
?L20:	EQUAL? GL-PRSO,TH-BOX-KEY \?L29
	MOVE TH-BOX-KEY,TH-GUARDS-POCKET
	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINTI " looks surprised and says, ""Ta, mate. I didn't know I dropped it. I'll have to keep it in a safer place."" He puts the key into one of his inside pockets."
	CRLF
	CALL2 PRINT-ID,STR?485 >STACK
	RSTACK
?L29:	EQUAL? GL-PRSO,TH-RED-GLASS \?L30
	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINTI " looks at it carefully and then hands it back to you, saying, ""For a moment there, I thought this was a ruby. But it's only a piece of glass."""
	CRLF
	CRLF
	PRINT K-MORE-VALUABLE-MSG
	CRLF
	CALL2 PRINT-ID,STR?486 >STACK
	RSTACK
?L30:	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINTI " examines what you are offering and then declines your bribe."
	CRLF
	CRLF
	PRINT K-MORE-VALUABLE-MSG
	CRLF
	RTRUE
?L18:	EQUAL? GL-PRSA,V?TAKE \?L32
	EQUAL? GL-PRSO,TH-OPAL,TH-RUBY,TH-SAPPHIRE /?L35
	EQUAL? GL-PRSO,TH-EMERALD \?L33
?L35:	PRINT K-ILL-HOLD-IT-MSG
	CRLF
	RTRUE
?L33:	EQUAL? GL-PRSO,TH-BOX-KEY,TH-GUARDS-KEYS \?L36
	PRINT K-SORRY-MATE-MSG
	CRLF
	RTRUE
?L36:	EQUAL? GL-PRSO,CH-BANK-GUARD \FALSE
	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINT K-MUST-WEIGH-MSG
	CRLF
	RTRUE
?L32:	EQUAL? GL-PRSA,V?SHOW \FALSE
	EQUAL? GL-PRSO,TH-OPAL,TH-RUBY,TH-SAPPHIRE /?L42
	EQUAL? GL-PRSO,TH-EMERALD,TH-RED-GLASS \?L40
?L42:	PRINTR """My, what a loverly gem!"""
?L40:	EQUAL? GL-PRSO,TH-BOX-KEY \FALSE
	MOVE TH-BOX-KEY,TH-GUARDS-POCKET
	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINTI " looks surprised and says, ""Oh! Thank you. I must have dropped it. I'll be sure to keep it in a safer place."" He takes the key and puts it in one of his inside pockets."
	CRLF
	CALL2 PRINT-ID,STR?487 >STACK
	RSTACK
?L61:	EQUAL? GL-PRSA,V?TAKE \?L47
	ZERO? GL-PRSI \FALSE
	ICALL2 RT-CTHEO-PRINT,CH-BANK-GUARD
	PRINT K-MUST-WEIGH-MSG
	CRLF
	RTRUE
?L47:	EQUAL? GL-PRSA,V?ASK-FOR \FALSE
	EQUAL? GL-PRSI,TH-BOX-KEY,TH-GUARDS-KEYS \?L53
	PRINT K-SORRY-MATE-MSG
	CRLF
	RTRUE
?L53:	EQUAL? GL-PRSI,TH-OPAL,TH-RUBY,TH-SAPPHIRE /?L56
	EQUAL? GL-PRSI,TH-EMERALD \FALSE
?L56:	PRINT K-ILL-HOLD-IT-MSG
	CRLF
	RTRUE

	.FUNCT RT-AC-CH-WIGGINS,CONTEXT,OBJ
	ASSIGNED? 'CONTEXT /?L102
	SET 'CONTEXT,0
?L102:	ICALL2 RT-THIS-IS-IT,CH-WIGGINS
	EQUAL? CONTEXT,K-M-WINNER \?L1
	FSET? GL-WINNER,FL-ASLEEP \?L1
	ICALL2 RT-NO-CONDITION-MSG,GL-WINNER
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-CONT \?L3
	FSET? CH-WIGGINS,FL-ASLEEP \?L3
	PRINTI "It's bad enough that you wasted the etherium; using it to steal from your friends is quite unsporting. "
	ICALL2 PRINT-ID,STR?488
	RTRUE
?L3:	EQUAL? CONTEXT,K-M-DESCFCN \?L4
	FSET? CH-WIGGINS,FL-ASLEEP \?L5
	PRINTR "Wiggins is still suffering from the effects of the etherium gas."
?L5:	FSET? CH-WIGGINS,FL-BROKEN \?L7
	FCLEAR CH-WIGGINS,FL-BROKEN
	FCLEAR CH-WIGGINS,FL-NODESC
	FSET CH-WIGGINS,FL-SEEN
	PRINTI "After staring at his dirty face for a few moments, you suddenly recognize the boy. He is Wiggins, the head of the Baker Street Irregulars, which is Holmes's unofficial army of street urchins who ""go everywhere and do everything."""
	CRLF
?L7:	CALL2 RT-PICK-NEXT,GL-WIGGINS-DESC-TXT >STACK
	PRINT STACK
	IN? CH-WIGGINS,TH-BOAT \?L9
	PRINT K-ENJOYING-RIDE-MSG
	JUMP ?L13
?L9:	IN? CH-WIGGINS,TH-HANSOM-CAB /?L12
	IN? CH-WIGGINS,TH-GROWLER-CAB \?L11
?L12:	PRINT K-FIDGETING-MSG
	JUMP ?L13
?L11:	CALL2 RT-PICK-NEXT,GL-WIGGINS-LOOK-TXT >STACK
	PRINT STACK
?L13:	PRINTI "."
	CRLF
	RETURN 2
?L4:	CALL2 RT-TELL-ABOUT?,CH-WIGGINS >STACK
	ZERO? STACK /?L14
	EQUAL? GL-PRSA,V?WHO,V?WHAT \?L15
	SET 'OBJ,GL-PRSO
	JUMP ?L17
?L15:	SET 'OBJ,GL-PRSI
?L17:	FSET? CH-WIGGINS,FL-ASLEEP \?L18
	CALL2 RT-NO-CONDITION-MSG,CH-WIGGINS >STACK
	RSTACK
?L18:	EQUAL? GL-PRSA,V?WHO \?L20
	EQUAL? OBJ,CH-WIGGINS \?L20
	PRINTR """I'm Wiggins, 'ead o' the Baker Street Irregulars."""
?L20:	EQUAL? OBJ,CH-HOLMES \?L21
	PRINTR """E's a good man, guv'nor. Best as ever was."""
?L21:	PRINTR """Beats me. What do you think?"""
?L14:	CALL1 RT-WHO-WHAT-FAIL? >STACK
	ZERO? STACK /?L23
	RETURN 2
?L23:	EQUAL? CONTEXT,K-M-WINNER \?L24
	EQUAL? GL-PRSA,V?HELLO \?L25
	PRINTR """'Ello."""
?L25:	EQUAL? GL-PRSA,V?GOODBYE \?L27
	PRINTR """Ta ta."""
?L27:	EQUAL? GL-PRSA,V?THANK \?L28
	PRINTR """Anytime, mate."""
?L28:	EQUAL? GL-PRSA,V?WHERE \?L29
	PRINTR """Beats me. What do you think?"""
?L29:	ZERO? CH-WIGGINS-AUX1 \?L30
	ICALL2 RT-CTHEO-PRINT,CH-WIGGINS
	PRINT K-WOUNDED-PRIDE-MSG
	CRLF
	RTRUE
?L30:	EQUAL? GL-PRSA,V?ENTER \?L31
	EQUAL? GL-PRSO,TH-BUTT-OF-MALMSEY \?L34
	FSET? GL-PRSO,FL-BROKEN /?L32
	SET 'WIGGINS-COLD?,1
	PRINTR "Wiggins dutifully climbs into the full butt of malmsey and has a nice bath and gets out again."
?L32:	EQUAL? GL-PRSO,TH-BUTT-OF-MALMSEY \?L34
	IN? TH-GARNET,TH-BUTT-OF-MALMSEY \?L35
	MOVE TH-GARNET,CH-PLAYER
	ICALL2 RT-THIS-IS-IT,TH-GARNET
	SET 'WIGGINS-COLD?,1
	FSET TH-GARNET,FL-SEEN
	FSET TH-GARNET,FL-TOUCHED
	FCLEAR TH-GARNET,FL-NODESC
	PRINTI "Wiggins climbs into the empty butt of malmsey, gets the gem, gets out and gives it to you."
	CRLF
	GETP TH-GARNET,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-GARNET,P?VALUE,0
	RTRUE
?L35:	PRINTR "Wiggins says, ""Once was enough, thank you."""
?L34:	EQUAL? GL-PRSO,TH-HANSOM-CAB,TH-GROWLER-CAB,TH-BOAT \?L38
	IN? CH-HOLMES,RM-LAIR \?L39
	IN? CH-PLAYER,GL-PRSO \?L41
	PRINTI "Wiggins climbs in next to you."
	CRLF
	MOVE CH-WIGGINS,GL-PRSO
	JUMP ?L43
?L41:	PRINT K-AFTER-YOU-MSG
	CRLF
?L43:	SET 'GL-PUPPY,CH-WIGGINS
	FCLEAR CH-WIGGINS,FL-NODESC
	FCLEAR CH-WIGGINS,FL-BROKEN
	RTRUE
?L39:	PRINT K-CANT-LEAVE-MSG
	CRLF
	RTRUE
?L38:	EQUAL? GL-PRSO,LG-WATER \FALSE
	PRINTR """I ain't no bleedin' mermaid. Besides, bathing ain't 'ealthy."""
?L31:	EQUAL? GL-PRSA,V?TAKE,V?STEAL \?L47
	EQUAL? GL-PRSO,TH-GARNET \?L48
	IN? TH-GARNET,TH-BUTT-OF-MALMSEY \?L48
	MOVE TH-GARNET,CH-PLAYER
	ICALL2 RT-THIS-IS-IT,TH-GARNET
	SET 'WIGGINS-COLD?,1
	FSET TH-GARNET,FL-SEEN
	FSET TH-GARNET,FL-TOUCHED
	FCLEAR TH-GARNET,FL-NODESC
	ICALL2 RT-CTHEO-PRINT,CH-WIGGINS
	IN? CH-WIGGINS,TH-BUTT-OF-MALMSEY /?L50
	PRINTI " climbs into the empty butt of malsey,"
?L50:	PRINTI " gets the gem, gets out, and gives it to you."
	CRLF
	ICALL2 PRINT-ID,STR?489
	GETP TH-GARNET,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-GARNET,P?VALUE,0
	RTRUE
?L48:	EQUAL? GL-PRSO,TH-GUARDS-POCKET,TH-BOX-KEY,TH-GUARDS-KEYS /?L54
	EQUAL? GL-PRSI,TH-GUARDS-POCKET,CH-BANK-GUARD \?L53
?L54:	ICALL1 RT-STEAL-KEY
	RTRUE
?L53:	EQUAL? GL-PRSA,V?STEAL \FALSE
	PRINTI """I would if I could, guv. But I don't see 'ow to do it."""
	CRLF
	CALL2 PRINT-ID,STR?490 >STACK
	RSTACK
?L47:	EQUAL? GL-PRSA,V?ROB \?L57
	EQUAL? GL-PRSO,CH-BANK-GUARD \?L57
	CALL1 RT-STEAL-KEY >STACK
	RSTACK
?L57:	EQUAL? GL-PRSA,V?EMPTY,V?REACH-IN,V?SEARCH \?L58
	EQUAL? GL-PRSO,TH-GUARDS-POCKET,CH-BANK-GUARD /?L61
	EQUAL? GL-PRSI,TH-GUARDS-POCKET,CH-BANK-GUARD \?L59
?L61:	ICALL1 RT-STEAL-KEY
	RTRUE
?L59:	PRINTR """I would if I could, guv. But I don't see 'ow to do it."""
?L58:	EQUAL? GL-PRSA,V?FOLLOW \?L63
	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L64
	IN? CH-HOLMES,RM-LAIR \?L66
	PRINTI """After you, guv."""
	CRLF
	SET 'GL-PUPPY,CH-WIGGINS
	FCLEAR CH-WIGGINS,FL-NODESC
	FCLEAR CH-WIGGINS,FL-BROKEN
	RTRUE
?L66:	PRINT K-CANT-LEAVE-MSG
	CRLF
	RTRUE
?L64:	PRINTR """I'm not a bleedin' bloodhound."""
?L63:	EQUAL? GL-PRSA,V?WAIT \?L70
	EQUAL? GL-PUPPY,CH-WIGGINS \?L71
	SET 'GL-PUPPY,0
	PRINTR """Right. I'm glued to this spot."""
?L71:	PRINTR """Whatever you say, guv."""
?L70:	EQUAL? GL-PRSA,V?EXIT \?L74
	PRINT K-AFTER-YOU-MSG
	CRLF
	RTRUE
?L74:	EQUAL? GL-PRSA,V?PULL \?L75
	EQUAL? GL-PRSO,TH-PORTCULLIS-CHAIN \?L75
	PRINTR """I can't reach it, guv."""
?L75:	PRINTR "Wiggins looks at you and scratches his head."
?L24:	ZERO? GL-NOW-PRSI? /?L103
	EQUAL? GL-PRSA,V?GIVE \?L78
	FSET? CH-WIGGINS,FL-ASLEEP \?L80
	ICALL RT-NO-CONDITION-MSG,CH-WIGGINS,STR?491
	RTRUE
?L80:	EQUAL? GL-PRSO,TH-SHILLING \?L82
	MOVE TH-SHILLING,CH-WIGGINS
	FSET TH-SHILLING,FL-NOALL
	SET 'CH-WIGGINS-AUX1,1
	ZERO? GL-P-CONT \?L83
	SET 'WINNER-IS-WIGGINS,1
?L83:	SET 'GL-P-QCONTEXT-TH,CH-WIGGINS
	SET 'GL-P-QCONTEXT-RM,GL-PLACE-CUR
	PRINTI "Wiggins looks at "
	ICALL2 RT-THEO-PRINT,TH-SHILLING
	PRINTI " and then at you. After a few moments he stuffs it deep into the recesses of his clothing and says, ""I'm all yours. Wot's the plan?"""
	CRLF
	ICALL2 PRINT-ID,STR?492
	RTRUE
?L82:	EQUAL? GL-PRSO,TH-EMERALD,TH-SAPPHIRE,TH-RUBY /?L87
	EQUAL? GL-PRSO,TH-OPAL,TH-TOPAZ,TH-GARNET /?L87
	EQUAL? GL-PRSO,TH-POUND-NOTE,TH-SIXPENCE \?L86
?L87:	PRINTI "Wiggins glances at your offer and"
	PRINT K-WOUNDED-PRIDE-MSG
	CRLF
	RTRUE
?L86:	PRINTR "Wiggins looks at the item you have handed him and then returns it to you. Clearly it was not of interest to him."
?L78:	EQUAL? GL-PRSA,V?TAKE \FALSE
	EQUAL? GL-PRSO,TH-SHILLING \FALSE
	FSET? CH-WIGGINS,FL-ASLEEP \?L90
	PRINTI "He must have hidden it very well. "
	ICALL2 PRINT-ID,STR?493
	ICALL1 RT-CYOU-MSG
	PRINTR "can't find it."
?L90:	PRINTI """Sorry, guv'nor. A deal's a deal."""
	CRLF
	CALL2 PRINT-ID,STR?494 >STACK
	RSTACK
?L103:	EQUAL? GL-PRSA,V?SMELL \FALSE
	ZERO? WIGGINS-COLD? /?L97
	PRINT K-EAU-DE-MSG
	CRLF
	RTRUE
?L97:	PRINTR "Yuck. Eau de urchin."

	.FUNCT RT-AC-CH-BUTLER,CONTEXT,WORD-NUM
	ASSIGNED? 'CONTEXT /?L65
	SET 'CONTEXT,0
?L65:	ICALL2 RT-THIS-IS-IT,CH-BUTLER
	EQUAL? CONTEXT,K-M-WINNER \?L1
	FSET? CH-BUTLER,FL-ASLEEP \?L3
	CALL2 RT-NO-CONDITION-MSG,CH-BUTLER >STACK
	RSTACK
?L3:	EQUAL? GL-PRSA,V?TAKE,V?FIND \?L5
	CALL RT-IDENTIFY-EVENT?,W?MYCROFT,GL-PRSO >STACK
	ZERO? STACK /?L5
	SET 'GL-WINNER,CH-PLAYER
	ICALL RT-PERFORM,V?ASK-FOR,CH-BUTLER,TH-EVENT
	RTRUE
?L5:	EQUAL? GL-PRSA,V?HELLO \?L6
	PRINTI """"
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L7
	PRINTI "How do you do?"
	JUMP ?L10
?L7:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2 \?L9
	PRINTI "Good day."
	JUMP ?L10
?L9:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L10
	PRINTI "Good evening."
?L10:	PRINTR """"
?L6:	EQUAL? GL-PRSA,V?GOODBYE \?L12
	PRINTI """"
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L13
	PRINTI "Good night"
	JUMP ?L16
?L13:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2 \?L15
	PRINTI "Good day"
	JUMP ?L16
?L15:	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,3 \?L16
	PRINTI "Good evening"
?L16:	PRINTR "."""
?L12:	EQUAL? GL-PRSA,V?THANK \?L18
	PRINTR """You're quite welcome."""
?L18:	EQUAL? GL-PRSA,V?WHO \?L19
	EQUAL? GL-PRSO,CH-BUTLER \?L19
	PRINTR """I am one of the staff of this fine establishment."""
?L19:	EQUAL? GL-PRSA,V?WHO,V?WHAT,V?WHERE \?L20
	PRINTR """I'm far too discreet to respond."""
?L20:	EQUAL? GL-PRSA,V?YES,V?NO \?L21
	ICALL2 RT-CTHEO-PRINT,CH-BUTLER
	PRINTR " looks at you expectantly."
?L21:	EQUAL? GL-PRSA,V?RESCUE \?L22
	PRINTR """What can I do for you?"""
?L22:	PRINTR """I'm afraid I am unable to do that."""
?L1:	ZERO? GL-NOW-PRSI? \?L66
	EQUAL? GL-PRSA,V?ASK-FOR,V?ASK-ABOUT \FALSE
	FSET? CH-BUTLER,FL-ASLEEP \?L27
	CALL2 RT-NO-CONDITION-MSG,CH-BUTLER >STACK
	RSTACK
?L27:	CALL RT-IDENTIFY-EVENT?,W?MYCROFT,GL-PRSI >STACK
	ZERO? STACK /?L29
	BAND MYCROFT-STATE,MYCROFT-LOCKED >STACK
	ZERO? STACK /?L30
	PRINTR """I am very sorry but Mr Mycroft Holmes is not available at this time. Perhaps you would care to come back later?"""
?L30:	BAND MYCROFT-STATE,MYCROFT-ASLEEP >STACK
	ZERO? STACK /?L32
	BAND MYCROFT-STATE,-3 >MYCROFT-STATE
	PRINTI "The butler listens to you and then leaves. He comes back shortly."
	CRLF
	CRLF
	PRINTR """Mr Mycroft Holmes requires that you offer some token to verify that you are indeed the person you claim to be. Give whatever it is to me and I will take it to him."""
?L32:	PRINTR "The butler listens politely but insists that he can do nothing more for you than to deliver the token to Mr Mycroft Holmes."
?L29:	EQUAL? GL-PRSI,CH-HOLMES \?L34
	PRINTR """I am afraid that I know the younger Mr Holmes only by his somewhat colourful reputation."""
?L34:	EQUAL? GL-PRSI,CH-BUTLER \?L35
	PRINTR """I am well, sir. Thank you for asking."""
?L35:	EQUAL? GL-PRSI,CH-PLAYER,CH-ME \?L36
	PRINTR "He looks down his nose at you and sniffs, ""I don't believe we've been introduced."""
?L36:	EQUAL? GL-PRSI,CH-MEMBERS \?L37
	PRINTR """They seem livelier than usual for this time of year."""
?L37:	EQUAL? GL-PRSI,RM-DIOGENES-CLUB \?L38
	PRINTR "The butler coughs deferentially, ""It is one of the most exclusive clubs in London, sir."" He glances at your clothes. ""Membership is by invitation only."""
?L38:	FSET? GL-PRSI,FL-PERSON \?L39
	FSET? GL-PRSI,FL-PLURAL \?L40
	PRINTR """Unfortunately, I can say nothing about them."""
?L40:	FSET? GL-PRSI,FL-FEMALE \?L42
	PRINTR """I am sorry but I can tell you nothing about her."""
?L42:	PRINTR """Much to my regret I can tell you nothing about him."""
?L39:	PRINTR """I'm afraid I wouldn't know anything about that."""
?L66:	EQUAL? GL-PRSA,V?GIVE \FALSE
	FSET? CH-BUTLER,FL-ASLEEP \?L49
	CALL RT-NO-CONDITION-MSG,CH-BUTLER,STR?491 >STACK
	RSTACK
?L49:	BAND MYCROFT-STATE,MYCROFT-LOCKED >STACK
	ZERO? STACK /?L51
	PRINTR "The butler politely declines to take the gift you have offered."
?L51:	BAND MYCROFT-STATE,MYCROFT-ASLEEP >STACK
	ZERO? STACK /?L52
	PRINTR "The butler refuses to take the item you have offered and asks if you have come to speak with someone here in the club."
?L52:	EQUAL? GL-PRSO,TH-RING \?L53
	BOR MYCROFT-STATE,5 >MYCROFT-STATE
	REMOVE TH-RING
	PRINT K-BUTLER-ACCEPTS-MSG
	CRLF
	CRLF
	PRINTI "After a few moments, Mycroft Holmes appears. He looks very worried."
	CRLF
	CRLF
	PRINTI """Sherlock warned me that you might come,"" he says. ""And the fact that you are here indicates that he is indeed in trouble. I believe that in order to solve this mystery, you are going to have to go to the Tower of London. It will be closed, but you can give the password '"
	RANDOM 6 >WORD-NUM
	SET 'PASSWORD-ID,WORD-NUM
	EQUAL? WORD-NUM,1 \?L54
	PRINTI "Boleyn"
	JUMP ?L60
?L54:	EQUAL? WORD-NUM,2 \?L56
	PRINTI "Cleves"
	JUMP ?L60
?L56:	EQUAL? WORD-NUM,3 \?L57
	PRINTI "Howard"
	JUMP ?L60
?L57:	EQUAL? WORD-NUM,4 \?L58
	PRINTI "Parr"
	JUMP ?L60
?L58:	EQUAL? WORD-NUM,5 \?L59
	PRINTI "Aragon"
	JUMP ?L60
?L59:	EQUAL? WORD-NUM,6 \?L60
	PRINTI "Seymour"
?L60:	PRINTI "' to the guard at the Byward Tower. He will let you in. Good luck."""
	CRLF
	CRLF
	PRINTI "Mycroft pauses before he goes and looks at you meditatively, as if trying to decide if he can put his faith in you to rescue his brother. After a moment he gives his head an unconscious nod, then turns around and disappears back into the club."
	CRLF
	ICALL2 RT-UPDATE-SCORE,1
	RTRUE
?L53:	PRINT K-BUTLER-ACCEPTS-MSG
	CRLF
	CRLF
	PRINTI "The butler soon returns looking concerned."
	CRLF
	CRLF
	PRINTR """I am sorry but Mr Mycroft Holmes says this will not do. Do you have anything else?"""

	.FUNCT RT-AC-LG-BANK-VAULT-DOOR,CONTEXT
	ASSIGNED? 'CONTEXT /?L33
	SET 'CONTEXT,0
?L33:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	EQUAL? GL-PLACE-CUR,RM-BANK-OF-ENGLAND \?L3
	ICALL2 RT-OPEN-CLOSED-MSG,LG-BANK-VAULT-DOOR
	CRLF
	CRLF
	PRINTR "In the middle of the door you see a big shiny dial."
?L3:	ICALL2 RT-OPEN-CLOSED-MSG,LG-BANK-VAULT-DOOR
	CRLF
	CRLF
	PRINTR "The inside of the door is shiny and flat."
?L1:	EQUAL? GL-PRSA,V?OPEN \?L6
	FSET? LG-BANK-VAULT-DOOR,FL-OPENED \?L7
	PRINTR "The vault door is already open."
?L7:	FSET? LG-BANK-VAULT-DOOR,FL-LOCKED \?L9
	PRINTR "The vault door is locked."
?L9:	FSET LG-BANK-VAULT-DOOR,FL-OPENED
	PRINTR "The vault door swings open."
?L6:	EQUAL? GL-PRSA,V?CLOSE \?L11
	FSET? LG-BANK-VAULT-DOOR,FL-OPENED /?L12
	PRINTR "The vault door is already closed."
?L12:	FCLEAR LG-BANK-VAULT-DOOR,FL-OPENED
	FSET LG-BANK-VAULT-DOOR,FL-LOCKED
	SET 'TH-DIAL-AUX1,0
	SET 'TH-DIAL-AUX2,0
	PRINTI "The vault door swings closed and locks"
	IN? CH-PLAYER,RM-BANK-VAULT \?L15
	PRINTI " you in. Whoops!"
	CRLF
	CRLF
	CALL1 RT-QSR >STACK
	RSTACK
?L15:	PRINTR "."
?L11:	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \?L18
	EQUAL? GL-PLACE-CUR,RM-BANK-VAULT \?L19
	CALL2 RT-DO-WALK,P?EAST >STACK
	RSTACK
?L19:	EQUAL? GL-PLACE-CUR,RM-BANK-OF-ENGLAND \FALSE
	CALL2 RT-DO-WALK,P?WEST >STACK
	RSTACK
?L18:	EQUAL? GL-PRSA,V?LOOK-INSIDE \?L23
	FSET? LG-BANK-VAULT-DOOR,FL-OPENED \?L24
	ICALL RT-CYOU-MSG,STR?155,STR?154
	PRINTI "row upon row of "
	ICALL2 DPRINT,TH-BOXES
	PRINTR "."
?L24:	ICALL2 RT-CTHEO-PRINT,LG-BANK-VAULT-DOOR
	PRINTR " is closed."
?L23:	EQUAL? GL-PRSA,V?UNLOCK \?L27
	FSET? LG-BANK-VAULT-DOOR,FL-OPENED \?L28
	ICALL2 RT-CTHEO-PRINT,LG-BANK-VAULT-DOOR
	PRINTR " is already opened."
?L28:	PRINT K-HOW-TO-MSG
	CRLF
	RTRUE
?L27:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	PRINT K-RICOCHET-MSG
	CRLF
	CALL2 PRINT-ID,STR?495 >STACK
	RSTACK

	.FUNCT RT-TOPAZ-MSG
	EQUAL? GL-PRSO,TH-TOPAZ \FALSE
	EQUAL? GL-PUPPY,CH-HOLMES \FALSE
	CRLF
	PRINTI "Holmes plucks you by the sleeve and reaches into the box. ""Observe, Watson."" He pulls out an almost invisible thread and examines it with glittering eyes. ""Muslin,"" he declares, more to himself than to you. ""Of Indian origin, and of the type used almost exclusively in the manufacture of turbans."" He looks at you in triumph. ""Our case is almost complete, Doctor. The Agra gems, the Trichinopoly cigar, and now this strand of muslin."""
	CRLF
	CRLF
	PRINTR "Holmes puts the strand into his pocket and explains. ""Moriarty - for reasons as yet unknown to us - has stolen the Crown Jewels. The Agra gems have somehow passed into his hands by way of this Indian accomplice, and he is using small pieces of it to lure me into a rendezvous with him. It's a dangerous game we play, Watson, but if we are to recover the regalia we have no choice."""

	.FUNCT RT-EXAMINE-GEM,GEM
	EQUAL? GEM,TH-SAPPHIRE \?L1
	IN? TH-SAPPHIRE,TH-CLAPPER \?L1
	PRINTR "The sapphire is hanging from the end of the clapper."
?L1:	LOC GEM >STACK
	EQUAL? STACK,CH-PLAYER \?L3
	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \?L4
	PRINTI "It looks as if there is a scratch on "
	ICALL1 RT-THEO-PRINT
	PRINTR "."
?L4:	EQUAL? GL-PRSA,V?READ \?L6
	PRINTI "All you can see on "
	ICALL1 RT-THEO-PRINT
	PRINTR " is a scratch."
?L6:	EQUAL? GL-PRSA,V?LOOK-THRU \FALSE
	EQUAL? GL-PRSI,TH-MAGNIFYING-GLASS \FALSE
	IN? TH-MAGNIFYING-GLASS,GL-WINNER \?L8
	PRINTI "You see """
	EQUAL? GEM,TH-SAPPHIRE \?L10
	PRINTI "2:00 a.m."
	JUMP ?L16
?L10:	EQUAL? GEM,TH-EMERALD \?L12
	PRINTI "20/6/87"
	JUMP ?L16
?L12:	EQUAL? GEM,TH-OPAL \?L13
	PRINTI "Password: Swordfish"
	JUMP ?L16
?L13:	EQUAL? GEM,TH-RUBY \?L14
	PRINTI "Wear a carnation"
	JUMP ?L16
?L14:	EQUAL? GEM,TH-TOPAZ \?L15
	PRINTI "Bar of Gold"
	JUMP ?L16
?L15:	EQUAL? GEM,TH-GARNET \?L16
	PRINTI "Give me to Akbar"
?L16:	PRINTI """ scratched into the surface of "
	ICALL1 RT-THEO-PRINT
	PRINTI "."
	CRLF
	BAND CH-HOLMES-AUX1,K-HOLMES-GEM? >STACK
	ZERO? STACK \TRUE
	BOR CH-HOLMES-AUX1,K-HOLMES-GEM? >CH-HOLMES-AUX1
	MOVE TH-RING,CH-PLAYER
	FSET TH-RING,FL-SEEN
	FSET TH-RING,FL-TOUCHED
	FCLEAR TH-RING,FL-NODESC
	CRLF
	PRINTI "Holmes"
	ICALL1 RT-HOLMES-SAYS-AGRA-MSG
	GETP TH-RING,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-RING,P?VALUE,0
	RTRUE
?L8:	ICALL RT-YOUD-HAVE-TO-MSG,STR?294,TH-MAGNIFYING-GLASS
	RTRUE
?L3:	EQUAL? GL-PRSA,V?READ \?L24
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?294,GL-PRSO
	PRINTI " to read "
	ICALL2 RT-SAY-HIM-HER-THEM-IT-MSG,GL-PRSO
	PRINTR "."
?L24:	EQUAL? GL-PRSA,V?LOOK-THRU \?L26
	EQUAL? GL-PRSI,TH-MAGNIFYING-GLASS \?L26
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?294,GL-PRSO
	PRINT K-GOOD-LOOK-MSG
	CRLF
	RTRUE
?L26:	EQUAL? GL-PRSA,V?EXAMINE,V?LOOK-ON \FALSE
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?294,GL-PRSO
	PRINT K-GOOD-LOOK-MSG
	CRLF
	RTRUE

	.FUNCT RT-HANDLE-SCRATCH,GEM,CONTEXT
	ASSIGNED? 'CONTEXT /?L35
	SET 'CONTEXT,0
?L35:	EQUAL? CONTEXT,K-M-SDESC \?L1
	PUTP GEM,P?OBJ-NOUN,0
	ICALL2 DPRINT,GEM
	PUTP GEM,P?OBJ-NOUN,W?SCRATCH
	PRINTI "'s scratch"
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN /?L3
?L3:	LOC GEM >STACK
	EQUAL? STACK,CH-PLAYER \?L5
	EQUAL? GL-PRSA,V?EXAMINE \?L7
	PRINTR "It looks like very tiny writing."
?L7:	EQUAL? GL-PRSA,V?READ \?L9
	PRINTR "It is too tiny."
?L9:	EQUAL? GL-PRSA,V?LOOK-THRU \FALSE
	EQUAL? GL-PRSI,TH-MAGNIFYING-GLASS \FALSE
	IN? TH-MAGNIFYING-GLASS,GL-WINNER \?L11
	PRINTI "You see """
	EQUAL? GEM,TH-SAPPHIRE \?L13
	PRINTI "2:00 a.m"
	JUMP ?L19
?L13:	EQUAL? GEM,TH-EMERALD \?L15
	PRINTI "20/6/87"
	JUMP ?L19
?L15:	EQUAL? GEM,TH-OPAL \?L16
	PRINTI "Password: Swordfish"
	JUMP ?L19
?L16:	EQUAL? GEM,TH-RUBY \?L17
	PRINTI "Wear a carnation"
	JUMP ?L19
?L17:	EQUAL? GEM,TH-TOPAZ \?L18
	PRINTI "Bar of Gold"
	JUMP ?L19
?L18:	EQUAL? GEM,TH-GARNET \?L19
	PRINTI "Give me to Akbar"
?L19:	PRINTI "."""
	CRLF
	BAND CH-HOLMES-AUX1,K-HOLMES-GEM? >STACK
	ZERO? STACK \TRUE
	BOR CH-HOLMES-AUX1,K-HOLMES-GEM? >CH-HOLMES-AUX1
	MOVE TH-RING,CH-PLAYER
	FSET TH-RING,FL-SEEN
	FSET TH-RING,FL-TOUCHED
	FCLEAR TH-RING,FL-NODESC
	CRLF
	PRINTI "Holmes"
	ICALL1 RT-HOLMES-SAYS-AGRA-MSG
	GETP TH-RING,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP TH-RING,P?VALUE,0
	RTRUE
?L11:	ICALL RT-YOUD-HAVE-TO-MSG,STR?294,TH-MAGNIFYING-GLASS
	RTRUE
?L5:	EQUAL? GL-PRSA,V?LOOK-THRU \?L30
	EQUAL? GL-PRSI,TH-MAGNIFYING-GLASS /?L29
?L30:	EQUAL? GL-PRSA,V?EXAMINE,V?READ \FALSE
?L29:	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?294,GEM
	EQUAL? GL-PRSA,V?READ \?L31
	PRINTR " to read the scratch."
?L31:	PRINT K-GOOD-LOOK-MSG
	CRLF
	RTRUE

	.FUNCT RT-HOLE?,OBJ,OFF,CNT,NUM,PLACE
	SET 'CNT,0
	SET 'NUM,0
?L1:	MUL NUM,2 >OFF
	GET GL-HOLES,0 >STACK
	EQUAL? NUM,STACK \?L3
	RETURN CNT
?L3:	ADD OFF,1 >STACK
	GET GL-HOLES,STACK >STACK
	EQUAL? OBJ,STACK \?L6
	ADD OFF,2 >STACK
	GET GL-HOLES,STACK >PLACE
	ZERO? PLACE /?L8
	EQUAL? GL-PLACE-CUR,PLACE \?L6
?L8:	INC 'CNT
?L6:	INC 'NUM
	JUMP ?L1

	.FUNCT RT-WASTE-OF-BULLETS-MSG,WHO
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L1
	PRINTR "Holmes glances at you and says, ""Save your ammunition, Watson. More danger may lie ahead."""
?L1:	EQUAL? WHO,CH-WIGGINS \?L3
	PRINTI "Wiggins looks at you impatiently and says, ""'Ow in the name of Dick Whittington is shooting "
	ICALL1 RT-A-PRINT
	PRINTR " going to help Mr 'Olmes?"""
?L3:	PRINTR "That would be a waste of bullets."

	.FUNCT RT-SHOOT-DEAD-MSG,WHO
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L1
	PRINTR "Holmes lifts an eyebrow and says sardonically, ""Is shooting dead people a new trend in medical research, Doctor?"""
?L1:	EQUAL? WHO,CH-WIGGINS \?L3
	PRINTR "Wiggins tugs at your sleeve and whispers nervously, ""Everyone here is already dead... aren't they?"""
?L3:	PRINTR "Have you no decency? Have you no shame? No? Then a bright future awaits you in the legal profession. Apply now to the law school of your choice."

	.FUNCT RT-READ-NEWSPAPER
	PRINTR "It's the newspaper that came in your game package."

	.FUNCT RT-WAKE-UP-HOLMES
	FCLEAR CH-HOLMES,FL-ASLEEP
	FSET LG-PARLOUR-DOOR,FL-OPENED
	REMOVE TH-PHIAL
	REMOVE TH-MOROCCO-CASE
	REMOVE TH-SYRINGE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-PM-HALL,STACK
	ICALL2 RT-ALARM-CLR,RT-I-PM-QUITS
	PRINTI "Holmes "
	EQUAL? TH-NEWSPAPER,GL-PRSO,GL-PRSI \?L1
	PRINTI "glances at the paper and his eye falls on the notice about the Tower of London. He "
?L1:	PRINTI "immediately leaps to his feet and hurls the phial and the case into the fireplace. The phial and the syringe shatter, and the liquid evaporates instantly, but the detective does not even notice. "
	EQUAL? GL-PRSI,CH-PRIME-MINISTER \?L4
	PRINTI """A client?"" he exclaims. ""On government business? Most interesting."""
	JUMP ?L6
?L4:	PRINTI """They've closed the Tower?"" he exclaims. ""Most singular."""
?L6:	CRLF
	ICALL2 RT-UPDATE-SCORE,5
	CRLF
	PRINTI "Holmes strides to the door and calls down to Mrs Hudson to bring up a tray of food. Then he plops back down on the sofa, "
	EQUAL? GL-PRSI,CH-PRIME-MINISTER \?L7
	CALL RT-META-IN?,TH-NEWSPAPER,CH-PLAYER >STACK
	ZERO? STACK \?L7
	CALL2 RT-META-LOC,TH-NEWSPAPER >STACK
	EQUAL? STACK,RM-HOLMES-STUDY \?L7
	PRINTI "glances at the newspaper, and then "
?L7:	PRINTR "makes a steeple of his fingertips and focuses his intense gaze upon you."

	.FUNCT RT-I-PM-HALL
	FSET CH-HUDSON,FL-NODESC
	MOVE CH-PRIME-MINISTER,RM-ENTRY-HALL
	MOVE CH-HUDSON,RM-ENTRY-HALL
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-PM-VESTIBULE,STACK
	EQUAL? GL-PLACE-CUR,RM-VESTIBULE \FALSE
	CRLF
	PRINTR "Mrs Hudson and the visitor emerge from the parlour and appear to be on their way upstairs."

	.FUNCT RT-I-PM-VESTIBULE
	MOVE CH-PRIME-MINISTER,RM-VESTIBULE
	MOVE CH-HUDSON,RM-VESTIBULE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-HUDSON,STACK
	EQUAL? GL-PLACE-CUR,RM-VESTIBULE \?L1
	EQUAL? GL-PLACE-PRV,RM-ENTRY-HALL /?L1
	CRLF
	PRINTR "Mrs Hudson and the visitor arrive at the top of the stairs on their way into Holmes's study."
?L1:	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \FALSE
	EQUAL? GL-PLACE-PRV,RM-VESTIBULE \FALSE
	CRLF
	PRINTR "Mrs Hudson and the visitor passed you on the stairs."

	.FUNCT RT-I-HUDSON,NUM
	MOVE CH-PRIME-MINISTER,RM-HOLMES-STUDY
	REMOVE CH-HUDSON
	FCLEAR CH-HUDSON,FL-NODESC
	SET 'NUM,RM-HOLMES-STUDY-AUX1
	ZERO? NUM \?L5
	EQUAL? GL-PLACE-CUR,RM-VESTIBULE \?L3
	CRLF
	PRINTI "Mrs Hudson ushers the visitor into "
	ICALL2 RT-THEO-PRINT,RM-HOLMES-STUDY
	PRINTI " and goes downstairs."
	CRLF
	JUMP ?L5
?L3:	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \?L5
	CRLF
	PRINTI "You see Mrs Hudson come down the stairway."
	CRLF
?L5:	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY /?L10
	EQUAL? RM-HOLMES-STUDY-AUX1,3 \?L8
?L10:	MOVE TH-WESTMINSTER-CLUE,CH-PLAYER
	FSET TH-WESTMINSTER-CLUE,FL-SEEN
	FSET CH-PRIME-MINISTER,FL-SEEN
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,3,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-PM-LEAVE,STACK
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \?L13
	ZERO? NUM \?L11
	CRLF
	PRINTI "Mrs Hudson appears at the door, accompanied by a worried-looking gentleman."
	CRLF
	CRLF
	PRINTI "Holmes jumps up and ushers the gentleman to the armchair, dismissing Mrs Hudson at the same time. ""Watson,"" he says, ""I am sure you recognize our distinguished visitor. "
	JUMP ?L14
?L11:	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \?L13
	EQUAL? NUM,1,2 \?L13
	CRLF
	PRINTI "Holmes has seated his visitor and is exchanging pleasantries with him. As you walk in Holmes looks up and says, ""Ah, here you are Watson. Now we can get down to business."" He turns to the gentleman seated in the armchair and says, """
	JUMP ?L14
?L13:	CRLF
	PRINTI "Holmes appears and says, ""Come with me, Watson. We have an important visitor."" He takes you by the arm and ushers you back to his study. Once inside, he gestures to the guest seated in the armchair and says, """
	MOVE CH-PLAYER,RM-HOLMES-STUDY
	SET 'GL-PLACE-PRV,GL-PLACE-CUR
	SET 'GL-PLACE-CUR,RM-HOLMES-STUDY
?L14:	PRINTI "I presume, sir, that you have come about the Jewels."""
	CRLF
	CRLF
	PRINTI "The visitor half rises from his chair in protest and sputters, ""But...but, how...?"""
	CRLF
	CRLF
	PRINTI "Holmes calms him with a glance. ""Come, sir. What else could it be? The Tower is suddenly closed, and within hours I receive a call from the highest official of Her Majesty's government. A simple deduction. Now then, tell me about the theft."""
	CRLF
	CRLF
	PRINTI "The visitor settles back into his chair and says, ""We know very little. Only that the Crown Jewels were stolen from the Tower sometime Thursday night. The theft was discovered Friday morning, and we immediately closed and searched the Tower. All we found was this verse which was left behind in the empty jewel case."""
	CRLF
	CRLF
	PRINTI "The visitor removes a folded piece of paper from his pocket and gives it to Holmes, who glances at it and passes it on to you."
	CRLF
	ICALL2 RT-THIS-IS-IT,TH-WESTMINSTER-CLUE
	ICALL2 RT-THIS-IS-IT,CH-PRIME-MINISTER
	RTRUE
?L8:	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-HUDSON,STACK
	ADD NUM,1 >RM-HOLMES-STUDY-AUX1
	ZERO? NUM \TRUE
	CRLF
	PRINTR "You hear Holmes call you to come back into his study..."

	.FUNCT RT-I-PM-LEAVE
	FCLEAR LG-HOLMES-BEDROOM-DOOR,FL-LOCKED
	FSET LG-HOLMES-BEDROOM-DOOR,FL-OPENED
	REMOVE CH-PRIME-MINISTER
	MOVE CH-HOLMES,RM-221B-BAKER-ST
	LOC CH-PLAYER >STACK
	EQUAL? STACK,RM-HOLMES-STUDY \?L1
	CRLF
	PRINTI "The visitor looks at his pocket watch and stands up. ""Thank you, gentlemen. I must go now. Remember, this calamity can only be hidden from the public until Monday morning at nine o'clock. If the Regalia is not at Buckingham Palace in time for the Coronation Day festivities, then all is lost."""
	CRLF
	CRLF
	PRINTI "The gentleman leaves, and Holmes unlocks the door to the bedroom, goes in, and reappears moments later wearing his Inverness cape and deerstalker hat."
	CRLF
	CRLF
	PRINTR """Come when you're ready, Watson. I'll wait for you outside."""
?L1:	EQUAL? GL-PLACE-CUR,RM-221B-BAKER-ST \?L3
	CRLF
	PRINTR "You see Holmes and the visitor emerge from the house. They confer briefly, shake hands, and then the Minister walks off into the fog."
?L3:	CRLF
	PRINTR "Holmes and the visitor brush past you as they leave the house. Holmes says to you, ""Come when you're ready, Watson. I'll wait for you outside."""

	.FUNCT RT-I-PM-QUITS
	CRLF
	EQUAL? GL-PLACE-CUR,RM-221B-BAKER-ST \?L1
	PRINTI "You see "
	ICALL2 RT-THEO-PRINT,LG-BAKER-ST-DOOR
	PRINTI " open, and a dejected-looking man comes out. He slowly walks away into the fog."
	CRLF
	CRLF
	JUMP ?L4
?L1:	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY,RM-VESTIBULE \?L3
	PRINTI "From downstairs you hear the sound of a door closing. You go down and open "
	ICALL2 RT-THEO-PRINT,LG-BAKER-ST-DOOR
	PRINTI " in time to see a dejected-looking man disappearing into the fog."
	CRLF
	CRLF
	JUMP ?L4
?L3:	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \?L4
	PRINTI "Suddenly "
	ICALL2 RT-THEO-PRINT,LG-PARLOUR-DOOR
	PRINTI " opens and a dejected-looking man appears. ""Thank you for trying, Mrs Hudson, but without Sherlock Holmes, there is no hope."" He opens "
	ICALL2 RT-THEO-PRINT,LG-BAKER-ST-DOOR
	PRINTI " and disappears into the fog."
	CRLF
	CRLF
?L4:	PRINTI "Moments later you see newsboys running through the streets shouting, ""Crown Jewels stolen! Prime Minister resigns in disgrace!"""
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?496
	CALL1 RT-QSR >STACK
	RSTACK

	.FUNCT RT-GET-PIGEON,OBJ,WHO
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-TIRED \?L1
	PRINTI """He's too young to fly too often."
	SET 'OBJ,CH-TRAINED-PIGEON-AUX3
	IN? OBJ,CH-SHERMAN \?L3
	PRINTI " He did come back with "
	ICALL2 RT-A-PRINT,OBJ
	PRINTI ", however,"" he says, giving it to you."
	CRLF
	MOVE OBJ,CH-PLAYER
	ICALL2 RT-THIS-IS-IT,OBJ
	FSET OBJ,FL-SEEN
	FSET OBJ,FL-TOUCHED
	FCLEAR OBJ,FL-NODESC
	GETP OBJ,P?VALUE >STACK
	ZERO? STACK /FALSE
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L7
	CRLF
	PRINT K-BRAVO-MSG
	CRLF
?L7:	GETP OBJ,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP OBJ,P?VALUE,0
	RTRUE
?L3:	PRINTR " Come back next week."""
?L1:	IN? CH-TRAINED-PIGEON,CH-SHERMAN \?L12
	PRINTI "Sherman hands you the bird. ""Take good care of him, now. I've grown fond of him."""
	CRLF
	MOVE CH-TRAINED-PIGEON,CH-PLAYER
	FSET CH-TRAINED-PIGEON,FL-SEEN
	FSET CH-TRAINED-PIGEON,FL-TOUCHED
	FCLEAR CH-TRAINED-PIGEON,FL-NODESC
	GETP CH-TRAINED-PIGEON,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP CH-TRAINED-PIGEON,P?VALUE,0
	RTRUE
?L12:	PRINTR """I've already given him to you."""

	.FUNCT RT-PIGEON-INTEREST,ATT-BIT
	EQUAL? ATT-BIT,K-PIGEON-GET-RUBY \?L1
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-SHOWN-RUBY /?L1
	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	PRINTR " doesn't seem to see the object to which you are referring."
?L1:	BOR CH-TRAINED-PIGEON-AUX1,ATT-BIT >CH-TRAINED-PIGEON-AUX1
	ICALL2 RT-AC-CH-TRAINED-PIGEON,K-M-DESCFCN
	ICALL2 RT-ALARM-CLR,RT-I-PIGEON-LOSE-INTEREST
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,3,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-PIGEON-LOSE-INTEREST,STACK
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-SHOWN-RUBY \FALSE
	BTST CH-TRAINED-PIGEON-AUX1,K-PIGEON-GET-RUBY \FALSE
	CALL2 RT-ALARM-SET?,RT-I-PIGEON-IMPATIENT >STACK
	ZERO? STACK /?L6
	ICALL2 RT-ALARM-CLR,RT-I-PIGEON-IMPATIENT
?L6:	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	CALL RT-ALARM-SET-REL,RT-I-PIGEON-IMPATIENT,STACK >STACK
	RSTACK

	.FUNCT RT-KILL-PIGEON
	FCLEAR CH-TRAINED-PIGEON,FL-ALIVE
	SET 'CH-TRAINED-PIGEON-AUX2,0
	LOC CH-TRAINED-PIGEON >STACK
	ZERO? STACK /?L1
	LOC CH-TRAINED-PIGEON >STACK
	MOVE TH-DEAD-PIGEON,STACK
	REMOVE CH-TRAINED-PIGEON
?L1:	ICALL2 RT-ALARM-CLR,RT-I-PIGEON-LOSE-INTEREST
	ICALL2 RT-ALARM-CLR,RT-I-PIGEON-IMPATIENT
	EQUAL? GL-PLACE-CUR,RM-SHERMANS-HOUSE \?L4
	CALL2 RT-SHERMAN-RAGE,0 >STACK
	RSTACK
?L4:	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,30,0 >STACK
	CALL RT-ALARM-SET-REL,RT-I-SHERMANS-REVENGE,STACK >STACK
	RSTACK

	.FUNCT RT-PIGEON-OBJ,P-OBJ,WHO
	MOVE P-OBJ,CH-PLAYER
	ICALL2 RT-THIS-IS-IT,P-OBJ
	FSET P-OBJ,FL-SEEN
	FSET P-OBJ,FL-TOUCHED
	FCLEAR P-OBJ,FL-NODESC
	GETP P-OBJ,P?VALUE >STACK
	ZERO? STACK /TRUE
	CALL1 RT-WHO-SAYS? >WHO
	EQUAL? WHO,CH-HOLMES \?L3
	CRLF
	PRINT K-BRAVO-MSG
	CRLF
?L3:	GETP P-OBJ,P?VALUE >STACK
	ICALL2 RT-UPDATE-SCORE,STACK
	PUTP P-OBJ,P?VALUE,0
	RTRUE

	.FUNCT RT-SHERMAN-RAGE,WALK
	CRLF
	ZERO? WALK /?L1
	PRINTI "As you walk into the shop, "
?L1:	PRINTI "Sherman sees you and flies into a rage. ""Animal hater!"" he cries. ""You killed my bird! How could you do such a thing?"""
	CRLF
	CRLF
	PRINTI "With a strength you didn't know he possessed, Sherman wrestles you into one of the larger cages that line the walls of his shop."
	CRLF
	CRLF
	PRINTI "Over the next few days, no customers buy you. But then on Monday morning Inspector Lestrade comes in looking for a pet for his wife. ""Did you you hear about the Crown Jewels?"" he asks. ""I'm looking into it personally and I don't mind telling you I've a few theories of my own. By the way, isn't it a little cramped in there?"""
	CRLF
	CRLF
	PRINTI "Lestrade leaves and you decide that with him handling the case, you'd just as soon stay in the cage."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?497
	CALL1 RT-QSR >STACK
	RSTACK

	.FUNCT RT-I-PIGEON-LOSE-INTEREST
	SET 'CH-TRAINED-PIGEON-AUX1,0
	CALL2 RT-VISIBLE?,CH-TRAINED-PIGEON >STACK
	ZERO? STACK /FALSE
	CRLF
	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	PRINTR " seems to lose interest."

	.FUNCT RT-I-PIGEON-IMPATIENT
	CALL2 RT-VISIBLE?,CH-TRAINED-PIGEON >STACK
	ZERO? STACK /FALSE
	CRLF
	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	PRINTR " looks at you as if waiting for you to let him go."

	.FUNCT RT-I-PIGEON-CIRCLE,CIRCLE,L
	SET 'CIRCLE,CH-TRAINED-PIGEON-AUX2
	LOC CH-TRAINED-PIGEON >L
	EQUAL? GL-WINNER,CH-PLAYER \?L4
	EQUAL? GL-PRSA,V?WALK /?L3
?L4:	EQUAL? CIRCLE,3 \?L1
?L3:	MOVE CH-TRAINED-PIGEON,CH-SHERMAN
	SET 'CH-TRAINED-PIGEON-AUX1,K-PIGEON-TIRED
	SET 'CH-TRAINED-PIGEON-AUX2,0
	MOVE CH-TRAINED-PIGEON-AUX3,CH-SHERMAN
	EQUAL? L,GL-PLACE-CUR \FALSE
	EQUAL? GL-WINNER,CH-PLAYER \?L7
	EQUAL? GL-PRSA,V?WALK /FALSE
?L7:	CRLF
	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	PRINTR " circles above you for the last time, and flies out of sight."
?L1:	EQUAL? CIRCLE,1,2 \FALSE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-PIGEON-CIRCLE,STACK
	ADD CIRCLE,1 >CH-TRAINED-PIGEON-AUX2
	EQUAL? L,GL-PLACE-CUR \FALSE
	CRLF
	ICALL2 RT-CTHEO-PRINT,CH-TRAINED-PIGEON
	PRINTR " circles above you."

	.FUNCT RT-I-SHERMANS-REVENGE
	FSET? GL-PLACE-CUR,FL-INDOORS \?L1
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-SHERMANS-REVENGE,STACK
	RFALSE
?L1:	CRLF
	PRINTI "Suddenly, you see Sherman the animal trainer running towards you. He is accompanied by a constable. Sherman is beside himself with rage. ""There they are, constable. They killed my bird. Arrest them."" The constable takes both you and Sherlock into custody, and although everything is eventually straightened out, it takes far too long for you to have enough time left to solve the mystery."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?498
	CALL1 RT-QSR >STACK
	RSTACK

	.FUNCT RT-IMPOLITE-MSG,STR1,STR2
	PRINTI "It isn't polite to "
	PRINT STR1
	PRINTI " without "
	PRINT STR2
	PRINTR "."

	.FUNCT RT-I-BIGBEN,HRS,MIN,SEC,YRS,MON,DAY,RET
	SET 'RET,0
	FSET? CH-PLAYER,FL-ASLEEP /FALSE
	ZERO? GL-WAIT-BELL /?L4
	EQUAL? GL-PRSA,V?WAIT-FOR,V?WAIT \?L6
	SET 'RET,1
	JUMP ?L13
?L4:	EQUAL? GL-PRSA,V?WAIT-FOR,V?WAIT \?L6
	EQUAL? GL-PLACE-CUR,RM-CLOCK-TOWER /?L6
	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,1,0,0
	ICALL1 RT-CLOCK-INC
	GETB GL-TEMP-TIME,K-DAY >STACK
	GETB GL-TEMP-TIME,K-SEC >STACK
	GETB GL-TEMP-TIME,K-MIN >STACK
	GETB GL-TEMP-TIME,K-HRS >STACK
	XCALL RT-CLOCK-CMP,STACK,STACK,STACK,STACK >STACK
	EQUAL? STACK,1 \?L7
	ZERO? GL-WAIT-BELL \?L9
	CRLF
	PRINTI "While you wait, you hear Big Ben strike each hour."
	CRLF
?L9:	SET 'RET,1
?L7:	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,-1,0,0
	ICALL1 RT-CLOCK-INC
	SET 'GL-WAIT-BELL,1
	JUMP ?L13
?L6:	SET 'GL-WAIT-BELL,0
?L13:	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,1,0,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-BIGBEN,STACK
	ZERO? RET \FALSE
	GETB GL-TIME,K-HRS >HRS
	EQUAL? GL-PLACE-CUR,RM-CLOCK-TOWER /?L17
	CRLF
	PRINTI "In the distance, you hear Big Ben strike the hour."
	CRLF
	ZERO? SOUND-QUEUED? \FALSE
	GRTR? HRS,12 \?L21
	SUB HRS,12 >TH-BELL-AUX1
	JUMP ?L23
?L21:	SET 'TH-BELL-AUX1,HRS
?L23:	XCALL SOUNDS,S-FARBEN,S-START,3,TH-BELL-AUX1 >STACK
	RSTACK
?L17:	GRTR? HRS,12 \?L26
	SUB HRS,12 >TH-BELL-AUX1
	JUMP ?L28
?L26:	SET 'TH-BELL-AUX1,HRS
?L28:	CALL1 RT-I-SWING-BELL >STACK
	RSTACK

	.FUNCT RT-I-SWING-BELL,OBJ,NUM,POS,WHO
	SET 'NUM,TH-BELL-AUX1
	SET 'POS,TH-BELL-AUX2
	EQUAL? GL-PLACE-CUR,RM-CLOCK-TOWER /?L1
	ICALL1 RT-RELIEF
	SET 'HEARD-SWING?,0
	SET 'TH-BELL-AUX1,0
	SET 'TH-BELL-AUX2,K-BELL-AWAY
	ICALL1 RT-ZERO-SECONDS
	RFALSE
?L1:	GRTR? NUM,0 \?L4
	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,0,0,2
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,0,2 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-SWING-BELL,STACK
?L4:	ZERO? HEARD-SWING? \?L7
	ICALL SOUNDS,S-CLOCK,S-INIT
?L7:	CRLF
	PRINTI "The bell swings "
	EQUAL? POS,K-BELL-AWAY \?L10
	SET 'TH-BELL-AUX2,K-BELL-TOWARDS
	PRINTI "towards you, "
	FSET? TH-COTTON-BALLS,FL-WORN \?L12
	PRINTI "ringing loudly, but the cotton protects your ears"
	CALL1 RT-WHO-SAYS? >WHO
	ZERO? WHO /?L16
	ZERO? HEARD-SWING? \?L16
	PRINTI ". "
	ICALL2 RT-CTHEO-PRINT,WHO
	PRINTI " claps his hands to his ears in an attempt to protect them"
	FIRST? WHO >STACK \?L16
	ICALL RT-MOVE-ALL,WHO,RM-CLOCK-TOWER
	PRINTI ", dropping everything he was carrying in the process"
?L16:	PRINTI ". The clapper swings up within reach."
	CRLF
	ICALL SOUNDS,S-CLOCK,S-START,6
	SET 'HEARD-SWING?,1
	JUMP ?L20
?L12:	PRINTI "ringing unbearably loud. BONG!"
	ICALL2 PRINT-ID,STR?499
	ICALL2 SOUNDS,S-CLOCK
	ZERO? HEARD-SWING? \?L21
	FSET? TH-HANDS,FL-LOCKED /?L21
	SET 'HEARD-SWING?,1
	CALL1 RT-WHO-SAYS? >WHO
	FSET TH-HANDS,FL-LOCKED
	ICALL RT-MOVE-ALL-BUT-WORN,CH-PLAYER,RM-CLOCK-TOWER
	PRINTI " You "
	ZERO? WHO /?L23
	ICALL RT-MOVE-ALL,WHO,RM-CLOCK-TOWER
	PRINTI "and "
	ICALL2 DPRINT,WHO
	PRINTI " "
?L23:	PRINTI "clap your hands to your ears in an attempt to protect them, dropping everything you are carrying in the process."
?L21:	CRLF
?L20:	SUB NUM,1 >TH-BELL-AUX1
	RETURN TH-BELL-AUX1
?L10:	SET 'TH-BELL-AUX2,K-BELL-AWAY
	PRINTI "away from you"
	ZERO? NUM \?L28
	PRINTI ", finishing the ringing of the hour."
	CRLF
	ICALL1 RT-RELIEF
	CALL1 RT-ZERO-SECONDS >STACK
	RSTACK
?L28:	PRINTR "."

	.FUNCT RT-RELIEF
	SET 'HEARD-SWING?,0
	FSET? TH-HANDS,FL-LOCKED \FALSE
	FCLEAR TH-HANDS,FL-LOCKED
	PRINTR "You breath a sigh of relief as you take your hands away from your ears."

	.FUNCT RT-ZERO-SECONDS,SEC
	GETB GL-TIME,K-SEC >SEC
	ZERO? SEC /FALSE
	SUB 60,SEC >STACK
	IXCALL RT-DO-CLOCK-SET,GL-TIME-UPDT-INC,0,0,STACK
	ICALL1 RT-CLOCK-INC
	CALL RT-COPY-TIME,GL-TIME,GL-TEMP-TIME >STACK
	RSTACK

	.FUNCT RT-I-EXHALE
	FSET? TH-BREATH,FL-LOCKED \FALSE
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,1,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-INHALE,STACK
	CRLF
	PRINTR "You can't hold your breath much longer..."

	.FUNCT RT-I-INHALE
	FSET? TH-BREATH,FL-LOCKED \FALSE
	CRLF
	PRINTI "Your lungs scream for air. You take a deep breath."
	CRLF
	ICALL2 PRINT-ID,STR?500
	FCLEAR TH-BREATH,FL-LOCKED
	SET 'RUN-SMELL-ETHERIUM?,1
	RTRUE

	.FUNCT RT-I-TAKE-WATSONS-STUFF
	FSET? CH-AKBAR,FL-ASLEEP /FALSE
	CRLF
	PRINTI "Akbar"
	FSET? TH-WATSONS-HAT,FL-WORN \?L3
	PRINTI " apologizes to you,"
?L3:	PRINTI " removes everything from your hands, and then hits you over the head. The last thing you see before losing consciousness is the look of defeat on Holmes's face."
	CRLF
	CRLF
	PRINTI "You awake sometime later to find yourself bound hand and foot. Moriarty is standing over you with a newspaper in his hand."
	CRLF
	CRLF
	PRINT K-FOUGHT-WELL-MSG
	CRLF
	CRLF
	PRINTI "Moriarty takes the Crown Jewels and departs, leaving you to ponder your defeat and the inevitable demise of the British Empire."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?501
	ICALL1 RT-QSR
	RFALSE

	.FUNCT RT-I-OUT-OF-TIME
	CRLF
	FSET? GL-PLACE-CUR,FL-INDOORS \?L1
	PRINTI "Outside you hear"
	JUMP ?L3
?L1:	PRINTI "You see"
?L3:	PRINTI " the paper boy run through the streets shouting out, ""Crown Jewels stolen... the end is near."""
	CRLF
	CRLF
	EQUAL? GL-PLACE-CUR,RM-LAIR \?L4
	ICALL2 DPRINT,CH-MORIARTY
	FSET? CH-MORIARTY,FL-ASLEEP \?L6
	FCLEAR CH-MORIARTY,FL-ASLEEP
	PRINTI " awakens from his stupor and"
?L6:	PRINTI " says, "
	PRINT K-FOUGHT-WELL-MSG
	CRLF
	CRLF
?L4:	CALL1 RT-QSR >STACK
	RSTACK

	.FUNCT RT-ETHERIUM-EFFECT,ASLEEP?,OBJ,TOP,CNT
	ASSIGNED? 'OBJ /?L27
	SET 'OBJ,0
?L27:	ASSIGNED? 'TOP /?L28
	SET 'TOP,1
?L28:	SET 'CNT,0
	ZERO? OBJ \?L6
	SET 'OBJ,GL-PLACE-CUR
	ZERO? OBJ \?L6
	RETURN CNT
?L6:	FSET? OBJ,FL-ALIVE \?L8
	EQUAL? OBJ,CH-PLAYER \?L9
	FSET? TH-BREATH,FL-LOCKED /?L8
?L9:	ZERO? ASLEEP? /?L10
	EQUAL? OBJ,CH-HOLMES \?L14
	FSET? TH-BREATH,FL-LOCKED /?L20
?L14:	FSET OBJ,FL-ASLEEP
	INC 'CNT
	EQUAL? GL-PUPPY,OBJ \?L20
	SET 'GL-FORMER-PUPPY,OBJ
	SET 'GL-PUPPY,0
	JUMP ?L20
?L10:	FCLEAR OBJ,FL-ASLEEP
	INC 'CNT
	JUMP ?L20
?L8:	FIRST? OBJ >STACK \?L20
	FIRST? OBJ >STACK /?L21
?L21:	CALL RT-ETHERIUM-EFFECT,ASLEEP?,STACK,0 >STACK
	ADD CNT,STACK >CNT
?L20:	ZERO? TOP \?L5
	NEXT? OBJ >OBJ /?L6
?L5:	RETURN CNT

	.FUNCT RT-I-WAKE-UP,OBJ
	LOC TH-ETHERIUM-GAS >STACK
	ICALL RT-ETHERIUM-EFFECT,0,STACK
	REMOVE TH-ETHERIUM-GAS
	RTRUE

	.FUNCT RT-SMELL-ETHERIUM?
	LOC TH-ETHERIUM-GAS >STACK
	EQUAL? GL-PLACE-CUR,STACK \FALSE
	FSET? TH-BREATH,FL-LOCKED /?L3
	REMOVE TH-ETHERIUM-GAS
	CRLF
	PRINTI "The etherium knocks you out."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?502
	FSET CH-PLAYER,FL-ASLEEP
	EQUAL? GL-PLACE-CUR,RM-LAIR \?L5
	ICALL2 RT-ALARM-CLR,RT-I-WAKE-UP
	ICALL1 RT-DOES-MORIARTY-WIN
	RTRUE
?L5:	CALL2 RT-ALARM-SET?,RT-I-WAKE-UP >STACK
	ZERO? STACK /?L8
	COPYT GL-TIME-PARM,GL-TIME,K-A-TWDTH
	ICALL2 RT-ALARM-CHK,0
	SET 'GL-CLOCK-WAIT,1
	PRINT K-WAKE-UP-MSG
	CRLF
	JUMP ?L10
?L8:	ICALL RT-CLOCK-JMP,6,0,0
	PRINT K-WAKE-UP-MSG
	CRLF
?L10:	ZERO? GL-FORMER-PUPPY /TRUE
	IN? GL-FORMER-PUPPY,GL-PLACE-CUR \TRUE
	ZERO? GL-PUPPY \TRUE
	FCLEAR GL-FORMER-PUPPY,FL-ASLEEP
	SET 'GL-PUPPY,GL-FORMER-PUPPY
	SET 'GL-FORMER-PUPPY,0
	RTRUE
?L3:	EQUAL? GL-PUPPY,0,CH-HOLMES /TRUE
	CALL RT-ETHERIUM-EFFECT,1,GL-PUPPY >STACK
	ZERO? STACK /TRUE
	ICALL2 RT-CTHEO-PRINT,GL-FORMER-PUPPY
	PRINTR " passes out."

	.FUNCT RT-FIND-FLAME,OBJ,TOP,FST
	ASSIGNED? 'OBJ /?L18
	SET 'OBJ,0
?L18:	ASSIGNED? 'TOP /?L19
	SET 'TOP,1
?L19:	ZERO? OBJ \?L6
	SET 'OBJ,GL-PLACE-CUR
	ZERO? OBJ /FALSE
?L6:	FSET? OBJ,FL-BURNABLE \?L8
	FSET? OBJ,FL-LIGHTED /TRUE
?L8:	FIRST? OBJ >FST \?L11
	CALL RT-FIND-FLAME,FST,0 >STACK
	ZERO? STACK \TRUE
?L11:	ZERO? TOP \FALSE
	NEXT? OBJ >OBJ /?L6
	RFALSE

	.FUNCT RT-DOES-MORIARTY-WIN
	FSET? CH-MORIARTY,FL-LOCKED \?L1
	FSET? CH-AKBAR,FL-LOCKED \?L1
	IXCALL RT-DO-CLOCK-SET,GL-TIME,6,0,0,20
	ICALL2 RT-ALARM-CLR,RT-I-OUT-OF-TIME
	ICALL2 RT-ALARM-CHK,0
	SET 'GL-CLOCK-WAIT,1
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,9,0,0,20 >STACK
	ICALL RT-ALARM-SET-ABS,RT-I-OUT-OF-TIME,STACK
	PRINTI "You awaken slowly and stumble to your feet. Moriarty and Akbar have already recovered, and they are struggling fiercely to free themselves. It seems as if you were unconscious for quite a while, but it's hard to tell. You probably don't have a lot of time."
	CRLF
	FCLEAR CH-PLAYER,FL-ASLEEP
	FCLEAR CH-HOLMES,FL-ASLEEP
	FCLEAR CH-AKBAR,FL-ASLEEP
	FCLEAR CH-MORIARTY,FL-ASLEEP
	RTRUE
?L1:	PRINTI "Unfortunately, Moriarty and Akbar recovered before you did. You find yourself bound securely to Holmes."
	CRLF
	CRLF
	PRINTI "Moriarty looks at you and says, "
	PRINT K-FOUGHT-WELL-MSG
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?503
	CALL1 RT-QSR >STACK
	RSTACK

	.FUNCT RT-PROCESS-PASSWORD
	EQUAL? GL-PLACE-CUR,RM-BAR-OF-GOLD \?L1
	ICALL2 RT-CTHEO-PRINT,CH-DENKEEPER
	IN? TH-CARNATION,TH-LAPEL \?L3
	FSET? CH-AKBAR,FL-SEEN /?L3
	XCALL RT-CLOCK-CMP,2,0,0,20 >STACK
	EQUAL? STACK,-1,0 \?L3
	FSET CH-AKBAR,FL-SEEN
	MOVE CH-AKBAR,RM-BAR-OF-GOLD
	PRINTI " disappears into a back room and reappears moments later, accompanied by a tall, silent man who has dark skin and wears a white turban."
	CRLF
	CRLF
	PRINTI "The Indian glances at your "
	FSET? TH-WATSONS-HAT,FL-WORN /?L5
	PRINTI "uncovered "
?L5:	PRINTI "head and then intones, ""I am Akbar"
	FSET? TH-WATSONS-HAT,FL-WORN \?L8
	PRINTI ", honourable sir"
?L8:	PRINTR ". What is it that you wish?"""
?L3:	PRINTR " says, ""Not now, mate. Can't you see I'm busy?"""
?L1:	EQUAL? GL-PLACE-CUR,RM-BYWARD-TOWER \?L12
	ICALL2 RT-CTHEO-PRINT,CH-TOWER-GUARD
	PRINTR " pauses and looks at you strangely. Then he says, ""An interesting guess. But wrong."""
?L12:	PRINTR "Thatsa no swordfish. Thatsa duck."

	.FUNCT V-SWORDFISH
	CALL1 RT-PROCESS-PASSWORD >STACK
	RSTACK

	.FUNCT RT-ROPE-MSG
	PRINTI "As"
	ICALL RT-YOU-MSG,STR?355,STR?354
	PRINTI "for "
	ICALL2 RT-THEO-PRINT,TH-ROPE
	PRINTI ", Akbar"
	FSET? TH-WATSONS-HAT,FL-WORN \?L1
	PRINTI " says, ""Pardon me, honourable sir,"" and"
?L1:	PRINTI " hits you over the head."
	CRLF
	CRLF
	PRINTI "When you regain consciousness, you find that your hands and feet are bound. Outside you hear the paper boy run through the streets shouting out ""Crown Jewels stolen! Prime Minister resigns in disgrace!"""
	CRLF
	CALL1 RT-QSR >STACK
	RSTACK

	.FUNCT RT-INSCRIPTION-APPEARS-MSG
	PRINTR "After a few moments, the tomb's inscription comes through onto the piece of paper."

	.FUNCT RT-PROCESS-TOMB,TOMB-NUMBER
	EQUAL? GL-PRSA,V?READ \?L1
	CALL2 RT-READ-INSCRIPTION,TOMB-NUMBER >STACK
	RSTACK
?L1:	EQUAL? GL-PRSA,V?TRANSLATE \?L3
	PRINTR "Unfortunately, what little Latin you remember from your school days is limited to medical matters."
?L3:	EQUAL? GL-PRSA,V?RUB-WITH \?L4
	PRINTR "Rubbing the paper with the crayon would probably yield better results."
?L4:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L5
	ICALL1 RT-CYOU-MSG
	ICALL RT-WOULD-HAVE-TO-MSG,STR?108,TH-IT
	PRINTR " first."
?L5:	EQUAL? GL-PRSA,V?OPEN \?L6
	PRINTR "Getting just a little bit morbid, aren't we?"
?L6:	EQUAL? GL-PRSA,V?TOUCH \?L7
	EQUAL? TOMB-NUMBER,1,2,3 \?L8
	PRINTR "It feels a little sticky."
?L8:	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTI "not feel anything "
	CALL2 RT-PICK-NEXT,GL-BORING-TXT >STACK
	PRINT STACK
	PRINTR "."
?L7:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?504
	CALL1 RT-SHOOT-DEAD-MSG >STACK
	RSTACK

	.FUNCT RT-READ-INSCRIPTION,NUM
	PRINTI "The inscription"
	EQUAL? 2,NUM \?L1
	PRINTI " reads, ""ISAACVS NEWTON  Eques Auratus"
	JUMP ?L16
?L1:	EQUAL? 1,NUM \?L3
	PRINTI " reads, ""REGNO CONSORTES & VRNA HIC OBDOR MIMVS ELIZABETHA ET MARIA SORORES IN SPE RESVRRECTIONIS"
	JUMP ?L16
?L3:	EQUAL? 7,NUM \?L4
	PRINTI " is a long one, but in the middle of it you see the name ""GALFRIDVS CHAVCER"
	JUMP ?L16
?L4:	EQUAL? 9,NUM \?L5
	PRINTI "s are written in Latin, but you can make out the names ""Edward V"" and ""Richard, Duke of York"
	JUMP ?L16
?L5:	PRINTI " is written in Latin, but you can make out the name """
	EQUAL? 3,NUM \?L7
	PRINTI "Henry V"
	JUMP ?L16
?L7:	EQUAL? 4,NUM \?L9
	PRINTI "Edward the Confessor"
	JUMP ?L16
?L9:	EQUAL? 5,NUM \?L10
	PRINTI "Alexander Pope"
	JUMP ?L16
?L10:	EQUAL? 6,NUM \?L11
	PRINTI "Charles Dickens"
	JUMP ?L16
?L11:	EQUAL? 8,NUM \?L12
	PRINTI "Anne of Cleves"
	JUMP ?L16
?L12:	EQUAL? 10,NUM \?L13
	PRINTI "Mary, Queen of Scots"
	JUMP ?L16
?L13:	EQUAL? 11,NUM \?L14
	PRINTI "Henry VII"
	JUMP ?L16
?L14:	EQUAL? 12,NUM \?L15
	PRINTI "Pitt"
	JUMP ?L16
?L15:	EQUAL? 13,NUM \?L16
	PRINTI "Francis Vere"
?L16:	PRINTR "."""

	.FUNCT RT-READ-PAPER,PAPER-NAME,WRITING,PHEAT
	ZERO? WRITING \?L1
	PRINTR "The paper appears to be blank."
?L1:	GETP PAPER-NAME,P?FLIPPED >STACK
	ZERO? STACK \?L4
	ICALL2 RT-READ-INSCRIPTION,WRITING
	RTRUE
?L4:	ZERO? PHEAT \?L7
	PRINTR "This side appears to be blank."
?L7:	EQUAL? 1,PHEAT \?L9
	PRINTR "You see a faint discolouration."
?L9:	EQUAL? 2,PHEAT \TRUE
	EQUAL? 1,WRITING \?L11
	ICALL1 RT-INDENT-PRINT
	PRINTI "Hickory Dickory Dock."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Your enemy is the clock."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "When it strikes nine,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "The victory's mine."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Hickory Dickory Dock."
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-ASTERISK-MSG
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Here comes a candle to light you to bed."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Here comes a chopper"
	ICALL1 RT-WRAP-PRINT
	PRINTI "to chop off your head."
	CRLF
	FSET PAPER-NAME,FL-LOCKED
	BOR TH-PACKET-OF-PAPER-AUX1,1 >TH-PACKET-OF-PAPER-AUX1
	JUMP ?L14
?L11:	EQUAL? 2,WRITING \?L13
	ICALL1 RT-INDENT-PRINT
	PRINTI "London Bridge is falling down."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "All that's under it will drown."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "With it falls Victoria's reign."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Britannia ne'er to rule again."
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-ASTERISK-MSG
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "When a number you require,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "And you're banking all thereon."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Subtract the conquest from the fire,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Half a league, half a league."
	ICALL1 RT-WRAP-PRINT
	PRINTI "Half a league on."
	CRLF
	FSET PAPER-NAME,FL-LOCKED
	BOR TH-PACKET-OF-PAPER-AUX1,2 >TH-PACKET-OF-PAPER-AUX1
	JUMP ?L14
?L13:	EQUAL? 3,WRITING \?L14
	ICALL1 RT-INDENT-PRINT
	PRINT K-TWINKLE-MSG
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Fought at sea, midst masts and spars."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Now above the world so high,"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Looking down with watchful eye."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-TWINKLE-MSG
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "England's hero, prince of tars."
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINT K-ASTERISK-MSG
	CRLF
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Pussycat, pussycat,"
	ICALL1 RT-WRAP-PRINT
	PRINTI "where have you been?"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "I've been to the Tower"
	ICALL1 RT-WRAP-PRINT
	PRINTI "to look at the Queen."
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "Pussycat, pussycat,"
	ICALL1 RT-WRAP-PRINT
	PRINTI "what did you there?"
	CRLF
	ICALL1 RT-INDENT-PRINT
	PRINTI "I left something for you."
	ICALL1 RT-WRAP-PRINT
	PRINTI "Go back, if you dare."
	CRLF
	FSET PAPER-NAME,FL-LOCKED
	BOR TH-PACKET-OF-PAPER-AUX1,4 >TH-PACKET-OF-PAPER-AUX1
?L14:	FSET? TH-PACKET-OF-PAPER,FL-ASLEEP /?L16
	FSET TH-PACKET-OF-PAPER,FL-ASLEEP
	ICALL2 RT-UPDATE-SCORE,5
	RTRUE
?L16:	EQUAL? TH-PACKET-OF-PAPER-AUX1,7 \TRUE
	CALL1 RT-WHO-SAYS? >STACK
	EQUAL? STACK,CH-HOLMES \TRUE
	SET 'TH-PACKET-OF-PAPER-AUX1,15
	CRLF
	PRINTR "Holmes leans forward with an excited expression upon his hawk-like features and says, ""There is only one man in all London clever enough to plan this, Watson - Professor Moriarty. See how boldly he hides clues in public places, knowing all the while that they will remain hidden from the casual eye. Onward, Doctor. Let us solve these riddles and see what the good Professor has in mind for us."""

	.FUNCT RT-PROCESS-PAPER,PAPER-NAME,WRITING,PHEAT
	GETP PAPER-NAME,P?INSCRIPTION >WRITING
	GETP PAPER-NAME,P?HEATED >PHEAT
	EQUAL? GL-PRSA,V?TAKE \?L1
	LOC PAPER-NAME >STACK
	EQUAL? STACK,TH-ELIZABETH-TOMB,TH-NEWTON-TOMB,TH-HENRY-V-TOMB \FALSE
	EQUAL? WRITING,1,2,3 \FALSE
	PRINTI "You pick at the paper for a few seconds, but it seems to be stuck to the inscription. After a few seconds you manage to peel it off."
	CRLF
	MOVE PAPER-NAME,CH-PLAYER
	RTRUE
?L1:	EQUAL? GL-PRSA,V?RAISE \?L8
	EQUAL? GL-PRSO,PAPER-NAME \?L8
	CALL2 RT-VISIBLE?,LG-SHAFT-OF-LIGHT >STACK
	ZERO? STACK \?L10
?L8:	EQUAL? GL-PRSA,V?PUT \?L9
	EQUAL? GL-PRSO,PAPER-NAME \?L9
	EQUAL? GL-PRSI,LG-SHAFT-OF-LIGHT /?L10
?L9:	EQUAL? GL-PRSA,V?TOUCH-TO \?L6
	EQUAL? GL-PRSI,LG-SHAFT-OF-LIGHT /?L10
	EQUAL? GL-PRSI,TH-LAMP \?L6
	FSET? TH-LAMP,FL-LIGHTED \?L6
?L10:	EQUAL? PHEAT,1 \?L11
	ICALL RT-CYOU-MSG,STR?155,STR?154
	PRINTI "a discolouration"
	GETP PAPER-NAME,P?FLIPPED >STACK
	ZERO? STACK \?L21
	PRINTI " which appears to be on the back"
	JUMP ?L21
?L11:	EQUAL? PHEAT,2 \?L16
	PRINTI "There seems to be some writing"
	GETP PAPER-NAME,P?FLIPPED >STACK
	ZERO? STACK \?L21
	PRINTI " on the back"
	JUMP ?L21
?L16:	EQUAL? WRITING,1,2,3 \?L20
	ICALL RT-CYOU-MSG,STR?155,STR?154
	PRINTI "a faint discolouration"
	JUMP ?L21
?L20:	ICALL RT-CYOU-MSG,STR?155,STR?154
	PRINTI "a watermark"
?L21:	PRINTR "."
?L6:	EQUAL? GL-PRSA,V?HEAT,V?HOLD-OVER,V?LIGHT-WITH /?L23
	EQUAL? GL-PRSA,V?BURN-WITH,V?TOUCH-TO \?L22
?L23:	IN? PAPER-NAME,GL-WINNER /?L24
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL2 RT-THEO-PRINT,PAPER-NAME
	PRINTR "."
?L24:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH,V?TOUCH-TO /?L34
	EQUAL? GL-PRSI,TH-BANK-OF-CANDLES \?L26
	PRINTI "The paper is heated by the bank of candles"
	GETP PAPER-NAME,P?HEATED >STACK
	EQUAL? STACK,2 \?L27
	EQUAL? WRITING,1,2,3 \?L29
	PRINTI ", but nothing more appears"
	JUMP ?L29
?L27:	EQUAL? WRITING,1,2,3 \?L29
	PUTP PAPER-NAME,P?HEATED,2
	PRINTI ". Something seems to be gradually appearing on "
	GETP PAPER-NAME,P?FLIPPED >STACK
	ZERO? STACK \?L30
	PRINTI "the back of "
?L30:	ICALL2 RT-THEO-PRINT,PAPER-NAME
?L29:	PRINTR "."
?L26:	EQUAL? GL-PRSA,V?LIGHT-WITH,V?BURN-WITH,V?TOUCH-TO /?L34
	EQUAL? GL-PRSI,TH-PIPE,TH-TOBACCO,TH-MATCH \?L34
	EQUAL? GL-PRSI,TH-PIPE,TH-TOBACCO \?L38
	FSET? TH-TOBACCO,FL-LIGHTED /?L37
?L38:	EQUAL? GL-PRSI,TH-MATCH \?L35
	FSET? TH-MATCH,FL-LIGHTED \?L35
?L37:	PRINTI "The paper is warmed by "
	ICALL1 RT-THEI-PRINT
	PRINTI "."
	CRLF
	EQUAL? WRITING,1,2,3 \TRUE
	ZERO? PHEAT \TRUE
	PUTP PAPER-NAME,P?HEATED,1
	RTRUE
?L35:	ICALL1 RT-CTHEI-PRINT
	ICALL2 RT-ISNT-ARENT-MSG,GL-PRSI
	PRINTR "lit."
?L34:	FSET? GL-PRSI,FL-BURNABLE \?L45
	FSET? GL-PRSI,FL-LIGHTED /?L44
?L45:	EQUAL? GL-PRSI,TH-PIPE \?L46
	FSET? TH-TOBACCO,FL-LIGHTED /?L44
?L46:	EQUAL? GL-PRSI,PSEUDO-OBJECT \FALSE
	GETP GL-PRSI,P?ACTION >STACK
	EQUAL? STACK,RT-AC-TH-FIREPLACE \FALSE
?L44:	PRINTI "The paper catches fire quickly."
	EQUAL? WRITING,1,2,3 \?L47
	FSET? PAPER-NAME,FL-LOCKED /?L47
	PRINTI " As it burns, you catch a glimpse of writing you could swear hadn't been there before."
?L47:	CRLF
	CRLF
	ICALL2 RT-CTHEO-PRINT,PAPER-NAME
	PRINTI " vanishes in a poof of smoke."
	CRLF
	ICALL2 PRINT-ID,STR?505
	REMOVE PAPER-NAME
	RTRUE
?L22:	EQUAL? GL-PRSA,V?READ,V?EXAMINE \?L51
	IN? PAPER-NAME,TH-PACKET-OF-PAPER \?L52
	ICALL1 RT-CYOU-MSG
	PRINTR "cannot do that while it is in the pacquet of paper."
?L52:	GET GL-P-OFW,0 >STACK
	EQUAL? STACK,W?BACK \?L55
	ICALL RT-PERFORM,V?FLIP,GL-PRSO
	RTRUE
?L55:	ICALL RT-READ-PAPER,PAPER-NAME,WRITING,PHEAT
	RTRUE
?L51:	EQUAL? GL-PRSA,V?FLIP \?L58
	IN? PAPER-NAME,GL-WINNER /?L59
	ICALL RT-CYOU-MSG,STR?110,STR?109
	PRINTI "not holding "
	ICALL2 RT-THEO-PRINT,PAPER-NAME
	PRINTR "."
?L59:	ZERO? WRITING \?L61
	ICALL2 RT-CTHEO-PRINT,PAPER-NAME
	PRINTR " seems to be blank on both sides."
?L61:	ICALL RT-CYOU-MSG,STR?467,STR?466
	ICALL2 RT-THEO-PRINT,PAPER-NAME
	PRINTI " over."
	CRLF
	CRLF
	GETP PAPER-NAME,P?FLIPPED >STACK
	SUB 1,STACK >STACK
	PUTP PAPER-NAME,P?FLIPPED,STACK
	ICALL RT-READ-PAPER,PAPER-NAME,WRITING,PHEAT
	RTRUE
?L58:	EQUAL? GL-PRSA,V?RUB-WITH \?L63
	EQUAL? GL-PRSO,PAPER-NAME \FALSE
	EQUAL? GL-PRSI,TH-CRAYON /?L66
	PRINTI "Rubbing the paper with "
	ICALL1 RT-THEI-PRINT
	PRINTR " doesn't do anything."
?L66:	ZERO? WRITING /?L67
	PRINTR "You don't really want to do that. You would mess up your inscription."
?L67:	FIRST? PAPER-NAME >STACK \?L68
	ICALL1 RT-CYOU-MSG
	PRINTI "cannot do a rubbing while there is something on "
	ICALL2 RT-THEO-PRINT,PAPER-NAME
	PRINTR "."
?L68:	IN? PAPER-NAME,TH-ELIZABETH-TOMB \?L69
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,1
	RTRUE
?L69:	IN? PAPER-NAME,TH-NEWTON-TOMB \?L70
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,2
	RTRUE
?L70:	IN? PAPER-NAME,TH-HENRY-V-TOMB \?L71
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,3
	RTRUE
?L71:	IN? PAPER-NAME,TH-EDWARD-TOMB \?L72
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,4
	RTRUE
?L72:	IN? PAPER-NAME,TH-POPE-TOMB \?L73
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,5
	RTRUE
?L73:	IN? PAPER-NAME,TH-DICKENS-TOMB \?L74
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,6
	RTRUE
?L74:	IN? PAPER-NAME,TH-CHAUCER-TOMB \?L75
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,7
	RTRUE
?L75:	IN? PAPER-NAME,TH-ANNE-OF-CLEVES-TOMB \?L76
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,8
	RTRUE
?L76:	IN? PAPER-NAME,TH-LITTLE-PRINCES-TOMB \?L77
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,9
	RTRUE
?L77:	IN? PAPER-NAME,TH-MARY-QUEEN-OF-SCOTS-TOMB \?L78
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,10
	RTRUE
?L78:	IN? PAPER-NAME,TH-HENRY-VII-TOMB \?L79
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,11
	RTRUE
?L79:	IN? PAPER-NAME,TH-PITT-TOMB \?L80
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,12
	RTRUE
?L80:	IN? PAPER-NAME,TH-VERE-TOMB \?L81
	ICALL1 RT-INSCRIPTION-APPEARS-MSG
	PUTP PAPER-NAME,P?INSCRIPTION,13
	RTRUE
?L81:	PRINTI "Rubbing "
	ICALL2 RT-THEO-PRINT,PAPER-NAME
	PRINTI " while it is"
	LOC PAPER-NAME >STACK
	LOC STACK >STACK
	EQUAL? STACK,ROOMS \?L83
	PRINTI " on "
	LOC PAPER-NAME >STACK
	FSET? STACK,FL-INDOORS \?L85
	ICALL1 TELL-THE-FLOOR
	JUMP ?L88
?L85:	ICALL1 TELL-THE-GROUND
	JUMP ?L88
?L83:	LOC PAPER-NAME >STACK
	ICALL2 RT-IN-ON-MSG,STACK
	LOC PAPER-NAME >STACK
	ICALL2 RT-THEO-PRINT,STACK
?L88:	PRINTI " would"
	ICALL1 RT-WASTE-OF-TIME-MSG
	RTRUE
?L63:	EQUAL? GL-PRSA,V?LOOK-THRU \?L89
	EQUAL? GL-PRSI,TH-MAGNIFYING-GLASS \?L89
	PRINTI "All"
	ICALL RT-YOU-MSG,STR?155,STR?154
	PRINTR "is a faint watermark."
?L89:	EQUAL? GL-PRSA,V?TAKE \FALSE
	FIRST? PAPER-NAME >STACK \FALSE
	ICALL1 RT-CYOU-MSG
	ICALL2 RT-WOULD-HAVE-TO-MSG,STR?228
	FIRST? PAPER-NAME >STACK /?L91
?L91:	ICALL2 RT-THEO-PRINT,STACK
	PRINTI " off of "
	ICALL2 RT-THEO-PRINT,PAPER-NAME
	PRINTR " first."

	.FUNCT RT-PAPER-WARMING,PAPER-NAME
	IN? PAPER-NAME,CH-PLAYER \FALSE
	GETP PAPER-NAME,P?INSCRIPTION >STACK
	EQUAL? STACK,1,2,3 \FALSE
	GETP PAPER-NAME,P?HEATED >STACK
	ZERO? STACK \FALSE
	PUTP PAPER-NAME,P?HEATED,1
	RFALSE

	.FUNCT RT-I-FLASH-WESTMINSTER-LIGHTS
	ZERO? PLAYER-IN-ABBEY /FALSE
	CRLF
	PRINTR "The lights flicker off and on, and you remember that the Abbey closes at six o'clock."

	.FUNCT RT-I-WESTMINSTER-LIGHTS-ON
	FSET RM-NAVE,FL-LIGHTED
	FSET RM-SOUTH-AISLE,FL-LIGHTED
	FSET RM-JERICHO-PARLOUR,FL-LIGHTED
	FSET RM-JERUSALEM-CHAMBER,FL-LIGHTED
	FSET RM-NORTH-CLOISTER,FL-LIGHTED
	FSET RM-NORTH-TRANSEPT,FL-LIGHTED
	FSET RM-SOUTH-TRANSEPT,FL-LIGHTED
	FSET RM-EVANGELIST-CHAPEL,FL-LIGHTED
	FSET RM-NORTH-AMBULATORY,FL-LIGHTED
	FSET RM-SANCTUARY,FL-LIGHTED
	FSET RM-SOUTH-AMBULATORY,FL-LIGHTED
	FSET RM-POETS-CORNER,FL-LIGHTED
	FSET RM-NORTH-CHAPEL-AISLE,FL-LIGHTED
	FSET RM-HENRY-VII-CHAPEL,FL-LIGHTED
	FSET RM-SOUTH-CHAPEL-AISLE,FL-LIGHTED
	FSET RM-CONFESSOR-CHAPEL,FL-LIGHTED
	FSET RM-INNOCENTS-CORNER,FL-LIGHTED
	ZERO? PLAYER-IN-ABBEY /FALSE
	CRLF
	PRINTR "The lights come on."

	.FUNCT RT-I-WESTMINSTER-LIGHTS-OFF
	FCLEAR RM-NAVE,FL-LIGHTED
	FCLEAR RM-SOUTH-AISLE,FL-LIGHTED
	FCLEAR RM-JERICHO-PARLOUR,FL-LIGHTED
	FCLEAR RM-JERUSALEM-CHAMBER,FL-LIGHTED
	FCLEAR RM-NORTH-CLOISTER,FL-LIGHTED
	FCLEAR RM-NORTH-TRANSEPT,FL-LIGHTED
	FCLEAR RM-SOUTH-TRANSEPT,FL-LIGHTED
	FCLEAR RM-EVANGELIST-CHAPEL,FL-LIGHTED
	FCLEAR RM-NORTH-AMBULATORY,FL-LIGHTED
	FCLEAR RM-SANCTUARY,FL-LIGHTED
	FCLEAR RM-SOUTH-AMBULATORY,FL-LIGHTED
	FCLEAR RM-POETS-CORNER,FL-LIGHTED
	FCLEAR RM-NORTH-CHAPEL-AISLE,FL-LIGHTED
	FCLEAR RM-HENRY-VII-CHAPEL,FL-LIGHTED
	FCLEAR RM-SOUTH-CHAPEL-AISLE,FL-LIGHTED
	FCLEAR RM-CONFESSOR-CHAPEL,FL-LIGHTED
	FCLEAR RM-INNOCENTS-CORNER,FL-LIGHTED
	ZERO? PLAYER-IN-ABBEY /FALSE
	CRLF
	PRINTR "The lights go out."

	.FUNCT RT-I-LOCKED-IN-END-GAME
	ZERO? PLAYER-IN-ABBEY /FALSE
	CRLF
	PRINTI "In the distance you hear the huge door of the Abbey clang shut. You run to the Nave, only to discover that you have been locked in. After spending a spooky night in the Abbey, you emerge in the morning to discover that the theft of the Crown Jewels has been discovered."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?506
	CALL1 RT-QSR >STACK
	RSTACK

	.FUNCT RT-I-OPEN-WESTMINSTER-DOOR
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,11,0,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-CLOSE-WESTMINSTER-DOOR,STACK
	FSET LG-WESTMINSTER-DOOR,FL-OPENED
	EQUAL? GL-PLACE-CUR,RM-BROAD-SANCTUARY \?L1
	CRLF
	PRINTR "A verger appears, unlocks the huge door, and pushes it open."
?L1:	EQUAL? GL-PLACE-CUR,RM-NAVE \FALSE
	CRLF
	PRINTR "Suddenly you hear the west door opening. The sunlight streaming in the door blinds you after your night-long vigil. A verger enters, gives you a strange look, and disappears into the South Aisle."

	.FUNCT RT-I-CLOSE-WESTMINSTER-DOOR
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,13,0,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-OPEN-WESTMINSTER-DOOR,STACK
	FCLEAR LG-WESTMINSTER-DOOR,FL-OPENED
	EQUAL? GL-PLACE-CUR,RM-BROAD-SANCTUARY \?L1
	CRLF
	PRINTR "The verger says goodnight and closes the door."
?L1:	EQUAL? GL-PLACE-CUR,RM-NAVE \FALSE
	SET 'PLAYER-IN-ABBEY,0
	CRLF
	PRINTI "A verger comes up to you and coughs deferentially. ""I'm sorry sir, but it's six o'clock and I have to close up now."" He escorts you to the door and closes it behind you as you exit."
	CRLF
	CRLF
	CALL2 RT-GOTO,RM-BROAD-SANCTUARY >STACK
	RSTACK

	.FUNCT RT-CF-TH-BOAT,CONTEXT
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	EQUAL? GL-PRSA,V?WALK \?L3
	EQUAL? GL-P-WALK-DIR,P?OUT \?L1
	CALL RT-PERFORM,V?EXIT,TH-BOAT >STACK
	RSTACK
?L1:	EQUAL? GL-PRSA,V?WALK \?L3
	EQUAL? GL-P-WALK-DIR,P?NORTH \?L3
	EQUAL? GL-PLACE-CUR,RM-THE-EMBANKMENT,RM-OUTSIDE-TRAITORS-GATE \?L3
	PRINT K-GET-OUT-FIRST-MSG
	CRLF
	RTRUE
?L3:	EQUAL? GL-PRSA,V?ENTER \FALSE
	EQUAL? GL-PRSO,TH-BOAT /FALSE
	PRINT K-GET-OUT-FIRST-MSG
	CRLF
	RTRUE

	.FUNCT RT-PROCESS-BOAT-ON-THAMES,UP?,WRD
	IN? TH-ANCHOR,TH-BOAT \?L1
	CALL2 RT-ALARM-SET?,RT-I-MOVE-DOWNSTREAM >STACK
	ZERO? STACK \?L1
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,0,0,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-MOVE-DOWNSTREAM,STACK
?L1:	EQUAL? GL-PRSA,V?EXIT,V?SWIM \?L7
	EQUAL? GL-PRSO,ROOMS,TH-BOAT /?L6
?L7:	EQUAL? GL-PRSA,V?LEAP,V?CLIMB-DOWN,V?ENTER \?L4
	EQUAL? GL-PRSO,LG-WATER \?L4
?L6:	ICALL RT-CYOU-MSG,STR?508,STR?507
	PRINTI "out of the boat, and then suddenly remember that you can't swim. Unable to climb back in, you cling to the boat for hours, until you are rescued by a Scotland Yard launch. Naturally, Lestrade is aboard, and as he bundles you off to the hospital to recover from the dread disease you caught while floating in the river, he tells you that he - personally - will take on the case."
	CRLF
	CRLF
	PRINTI "Somehow this doesn't make you feel any better."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?509
	CALL1 RT-QSR >STACK
	RSTACK
?L4:	EQUAL? GL-PRSA,V?ROW,V?PADDLE,V?PADDLE-WITH \?L8
	EQUAL? GL-PRSO,0,ROOMS,TH-BOAT \?L12
	ZERO? GL-PRSI /?L11
?L12:	EQUAL? GL-PRSA,V?PADDLE-WITH \?L9
	ZERO? GL-PRSI \?L9
?L11:	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	PRINTI "[Please specify a direction to "
	PRINTB GL-P-PRSA-WORD
	PRINTR ".]"
?L9:	EQUAL? GL-PRSO,LG-UP-DOWN-STREAM /?L19
	EQUAL? GL-PRSO,TH-INTDIR \?L15
	EQUAL? GL-P-DIRECTION,P?WEST,P?EAST /?L14
?L15:	EQUAL? GL-PRSO,TH-BOAT \?L13
	EQUAL? GL-PRSI,TH-INTDIR \?L13
?L14:	EQUAL? GL-PRSO,LG-UP-DOWN-STREAM /?L19
	SET 'UP?,0
	JUMP ?L21
?L19:	GETP GL-PRSO,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?UPSTREAM /?L20
	SET 'UP?,0
	JUMP ?L21
?L20:	SET 'UP?,1
?L21:	ZERO? UP? \?L23
	EQUAL? GL-P-DIRECTION,P?WEST /?L22
	SET 'UP?,0
	JUMP ?L23
?L22:	SET 'UP?,1
?L23:	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	IN? TH-ANCHOR,TH-BOAT /?L24
	ICALL1 RT-CYOU-MSG
	PRINTI "can "
	PRINTB GL-P-PRSA-WORD
	PRINTR " like blue blazes, but the anchor is restraining the boat."
?L24:	EQUAL? GL-PRSA,V?ROW \?L26
	IN? TH-OAR-2,TH-OAR-LOCK /?L26
	IN? TH-OAR-1,TH-BOAT \?L27
	ICALL RT-CYOU-MSG,STR?511,STR?510
	PRINTR "hard on the oar. The boat spins round and round. Wheeeee!"
?L27:	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTR "not have any oars."
?L26:	EQUAL? GL-PRSA,V?PADDLE-WITH \?L30
	EQUAL? GL-PRSI,TH-PADDLE /?L30
	EQUAL? GL-PRSI,TH-VIOLIN /FALSE
	ICALL1 RT-CYOU-MSG
	PRINTI "can't paddle with "
	ICALL1 RT-THEI-PRINT
	PRINTR "."
?L30:	EQUAL? GL-PRSA,V?PADDLE,V?PADDLE-WITH \?L34
	IN? TH-PADDLE,GL-WINNER /?L34
	ICALL RT-CYOU-MSG,STR?138,STR?137
	PRINTI "not have "
	ICALL2 RT-A-PRINT,TH-PADDLE
	PRINTR "."
?L34:	ZERO? UP? /?L35
	ICALL1 RT-MOVE-UPSTREAM
	RTRUE
?L35:	ICALL1 RT-I-MOVE-DOWNSTREAM
	RTRUE
?L13:	EQUAL? GL-PRSO,TH-INTDIR /?L38
	EQUAL? GL-PRSI,TH-INTDIR \?L37
?L38:	EQUAL? GL-P-DIRECTION,P?NORTH \?L37
	ICALL1 RT-LAND-BOAT
	RTRUE
?L37:	EQUAL? GL-PRSO,TH-INTDIR /?L40
	EQUAL? GL-PRSI,TH-INTDIR \?L39
?L40:	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	PRINTR "There doesn't seem to be anything in that direction."
?L39:	ICALL2 RT-ALARM-CLR,RT-I-MOVE-DOWNSTREAM
	PRINTI "I don't recognize the direction you are asking me to "
	PRINTB GL-P-PRSA-WORD
	PRINTR "."
?L8:	EQUAL? GL-PRSA,V?STAND,V?STAND-ON \?L42
	PRINTI "It isn't safe to stand in a boat."
	CRLF
	ICALL2 PRINT-ID,STR?512
	RTRUE
?L42:	EQUAL? GL-PRSA,V?SIT \?L43
	PRINTR "You're already seated."
?L43:	EQUAL? GL-PRSA,V?LEAP \?L44
	PRINTI "It isn't safe to jump around in a boat."
	CRLF
	ICALL2 PRINT-ID,STR?513
	RTRUE
?L44:	EQUAL? TH-FLOOR-ETC,GL-PRSO,GL-PRSI \FALSE
	CALL2 RT-IDENTIFY-FLOOR?,W?FLOOR >STACK
	ZERO? STACK \?L46
	CALL2 RT-IDENTIFY-FLOOR?,W?GROUND >STACK
	ZERO? STACK /FALSE
?L46:	PRINTI "There is no "
	ICALL2 DPRINT,TH-FLOOR-ETC
	PRINTR " in the middle of a river."

	.FUNCT RT-I-MOVE-DOWNSTREAM,?TMP
	EQUAL? GL-WINNER,CH-PLAYER \?L3
	EQUAL? GL-PRSA,V?ROW \?L1
	ICALL RT-CYOU-MSG,STR?515,STR?514
	JUMP ?L4
?L1:	EQUAL? GL-WINNER,CH-PLAYER \?L3
	EQUAL? GL-PRSA,V?PADDLE,V?PADDLE-WITH \?L3
	ICALL RT-CYOU-MSG,STR?517,STR?516
	JUMP ?L4
?L3:	CRLF
	PRINTI "The boat drifts "
?L4:	PRINTI "down the river"
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
	LOC TH-BOAT >?TMP
	EQUAL? ?TMP,RM-THAMES-ONE,RM-THAMES-TWO,RM-THAMES-THREE /?L7
	EQUAL? ?TMP,RM-THAMES-FOUR \?L5
?L7:	PRINTI ". "
?L5:	IN? TH-BOAT,RM-THAMES-ONE \?L9
	MOVE TH-BOAT,RM-THAMES-TWO
	ZERO? GL-NOW-LIT? /?L26
	PRINTI "Downstream you see the London Bridge."
	JUMP ?L26
?L9:	IN? TH-BOAT,RM-THAMES-TWO \?L14
	MOVE TH-BOAT,RM-THAMES-THREE
	ZERO? GL-NOW-LIT? /?L26
	PRINTI "You pass under the London Bridge."
	JUMP ?L26
?L14:	IN? TH-BOAT,RM-THAMES-THREE \?L18
	MOVE TH-BOAT,RM-THAMES-FOUR
	ZERO? GL-NOW-LIT? /?L26
	PRINTI "To the north you see the Traitors Gate."
	JUMP ?L26
?L18:	IN? TH-BOAT,RM-THAMES-FOUR \?L22
	MOVE TH-BOAT,RM-THAMES-FIVE
	ZERO? GL-NOW-LIT? /?L26
	PRINTI "Downstream you see the open seas... the strong currents would surely leave you stranded in your small boat if you were to drift further."
	JUMP ?L26
?L22:	IN? TH-BOAT,RM-THAMES-FIVE \?L26
	PRINTI ", and you drift out to sea."
	CRLF
	CRLF
	PRINTI "After drifting for several days, a passing ship rescues you. By coincidence, another passenger happens to be Lestrade, who has resigned in the wake of the Crown Jewel scandal and is retiring to the island of Pago Pago. After some reflection, you decide to join him."
	CRLF
	CRLF
	ICALL2 PRINT-ID,STR?518
	ICALL1 RT-QSR
?L26:	LOC TH-BOAT >GL-PLACE-CUR
	CRLF
	RTRUE

	.FUNCT RT-MOVE-UPSTREAM
	PRINTI "Fighting against the current, you "
	PRINTB GL-P-PRSA-WORD
	PRINTI " upstream. "
	CALL1 RT-IS-LIT? >GL-NOW-LIT?
	IN? TH-BOAT,RM-THAMES-ONE \?L1
	CRLF
	CRLF
	PRINTI "As you proceed you find yourself among the flotilla of warships that have come for the celebration of the Jubilee. You quickly decide that it's too dangerous here so you turn back and head downstream."
	JUMP ?L12
?L1:	IN? TH-BOAT,RM-THAMES-TWO \?L3
	ZERO? GL-NOW-LIT? /?L4
	PRINTI "To the north you see the Embankment."
?L4:	MOVE TH-BOAT,RM-THAMES-ONE
	JUMP ?L12
?L3:	IN? TH-BOAT,RM-THAMES-THREE \?L7
	MOVE TH-BOAT,RM-THAMES-TWO
	JUMP ?L12
?L7:	IN? TH-BOAT,RM-THAMES-FOUR \?L8
	ZERO? GL-NOW-LIT? /?L9
	PRINTI "You pass under the London Bridge."
?L9:	MOVE TH-BOAT,RM-THAMES-THREE
	JUMP ?L12
?L8:	IN? TH-BOAT,RM-THAMES-FIVE \?L12
	ZERO? GL-NOW-LIT? /?L13
	PRINTI "Upstream, you see the London Bridge, to the north you see the Traitors Gate."
?L13:	MOVE TH-BOAT,RM-THAMES-FOUR
?L12:	CRLF
	LOC TH-BOAT >GL-PLACE-CUR
	RTRUE

	.FUNCT RT-THAMES-TIDE
	XCALL RT-CLOCK-CMP,8,32,0,18 >STACK
	EQUAL? STACK,1 /TRUE
	XCALL RT-CLOCK-CMP,8,48,0,18 >STACK
	EQUAL? STACK,1 /FALSE
	XCALL RT-CLOCK-CMP,14,35,0,18 >STACK
	EQUAL? STACK,1 \?L4
	RETURN 3
?L4:	XCALL RT-CLOCK-CMP,14,51,0,18 >STACK
	EQUAL? STACK,1 \?L5
	RETURN 2
?L5:	XCALL RT-CLOCK-CMP,20,38,0,18 >STACK
	EQUAL? STACK,1 /TRUE
	XCALL RT-CLOCK-CMP,20,54,0,18 >STACK
	EQUAL? STACK,1 /FALSE
	XCALL RT-CLOCK-CMP,2,41,0,19 >STACK
	EQUAL? STACK,1 \?L8
	RETURN 3
?L8:	XCALL RT-CLOCK-CMP,2,57,0,19 >STACK
	EQUAL? STACK,1 \?L9
	RETURN 2
?L9:	XCALL RT-CLOCK-CMP,8,44,0,19 >STACK
	EQUAL? STACK,1 /TRUE
	XCALL RT-CLOCK-CMP,9,0,0,19 >STACK
	EQUAL? STACK,1 /FALSE
	XCALL RT-CLOCK-CMP,14,47,0,19 >STACK
	EQUAL? STACK,1 \?L12
	RETURN 3
?L12:	XCALL RT-CLOCK-CMP,15,3,0,19 >STACK
	EQUAL? STACK,1 \?L13
	RETURN 2
?L13:	XCALL RT-CLOCK-CMP,20,50,0,19 >STACK
	EQUAL? STACK,1 /TRUE
	XCALL RT-CLOCK-CMP,21,6,0,19 >STACK
	EQUAL? STACK,1 /FALSE
	XCALL RT-CLOCK-CMP,2,53,0,20 >STACK
	EQUAL? STACK,1 \?L16
	RETURN 3
?L16:	XCALL RT-CLOCK-CMP,3,9,0,20 >STACK
	EQUAL? STACK,1 \?L17
	RETURN 2
?L17:	XCALL RT-CLOCK-CMP,8,56,0,20 >STACK
	EQUAL? STACK,1 /TRUE
	XCALL RT-CLOCK-CMP,9,12,0,20 >STACK
	EQUAL? STACK,1 /FALSE
	RETURN 3

	.FUNCT RT-TOWER-PASSWORD,WORD-NUM,PASSWORD
	SET 'PASSWORD,PASSWORD-ID
	ZERO? PASSWORD /?L3
	EQUAL? GL-PLACE-CUR,RM-BYWARD-TOWER /?L1
?L3:	PRINTR "Wasn't she one of the six wives of Henry VIII?"
?L1:	EQUAL? GL-PLACE-PRV,RM-OUTER-WARD \?L4
	PRINTR """I am sorry, but I have strict orders to allow absolutely no one to leave the Tower, whether or not he knows the password. The Prime Minister himself could not get out of here before Monday morning."
?L4:	EQUAL? WORD-NUM,PASSWORD /?L5
	PRINTR """I am sorry but that password is no longer valid."""
?L5:	PRINTI "The guard steps aside as you walk in."
	CRLF
	CRLF
	ICALL2 RT-GOTO,RM-OUTER-WARD
	ICALL2 RT-UPDATE-SCORE,3
	SET 'PASSWORD-ID,9
	SET 'ALLOW-IN-TOWER,1
	RTRUE

	.FUNCT V-BOLEYN
	CALL2 RT-TOWER-PASSWORD,1 >STACK
	RSTACK

	.FUNCT V-CLEVES
	CALL2 RT-TOWER-PASSWORD,2 >STACK
	RSTACK

	.FUNCT V-HOWARD
	CALL2 RT-TOWER-PASSWORD,3 >STACK
	RSTACK

	.FUNCT V-PARR
	CALL2 RT-TOWER-PASSWORD,4 >STACK
	RSTACK

	.FUNCT V-ARAGON
	CALL2 RT-TOWER-PASSWORD,5 >STACK
	RSTACK

	.FUNCT V-SEYMOUR
	CALL2 RT-TOWER-PASSWORD,6 >STACK
	RSTACK

	.FUNCT RT-I-OPEN-MUSEUM-DOOR
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,10,0,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-CLOSE-MUSEUM-DOOR,STACK
	FSET LG-BRITISH-MUSEUM-DOOR,FL-OPENED
	EQUAL? GL-PLACE-CUR,RM-GREAT-RUSSELL-ST \FALSE
	CRLF
	PRINTR "A guard opens the door and then disappears inside the museum."

	.FUNCT RT-I-CLOSE-MUSEUM-DOOR
	XCALL RT-DO-CLOCK-SET,GL-TIME-PARM,14,0,0 >STACK
	ICALL RT-ALARM-SET-REL,RT-I-OPEN-MUSEUM-DOOR,STACK
	FCLEAR LG-BRITISH-MUSEUM-DOOR,FL-OPENED
	EQUAL? GL-PLACE-CUR,RM-GREAT-RUSSELL-ST \?L1
	CRLF
	PRINTR "The guard says goodnight and closes the door."
?L1:	EQUAL? GL-PLACE-CUR,RM-MANUSCRIPT-ROOM \?L3
	IN? CH-LIBRARIAN,RM-MANUSCRIPT-ROOM \?L3
	CRLF
	PRINTI "The librarian looks at his pocket-watch and exclaims, ""Goodness! It's closing time already! I really have enjoyed this chat, but I'm afraid you'll have to let me go. Why don't I see you out?"""
	CRLF
	CRLF
	PRINTI "He escorts you to the front door, discoursing all the while on the evolution of the use of mud by the Hittites. He waves goodbye as he closes the door behind you."
	CRLF
	CRLF
	FSET CH-LIBRARIAN,FL-ASLEEP
	ICALL2 RT-GOTO,RM-GREAT-RUSSELL-ST
	FCLEAR CH-LIBRARIAN,FL-ASLEEP
	RTRUE
?L3:	EQUAL? GL-PLACE-CUR,RM-MANUSCRIPT-ROOM,RM-BRITISH-MUSEUM \FALSE
	CRLF
	PRINTI "A guard comes up to you and says, ""I'm sorry sir, its closing time. I have to lock up now."" He escorts you to the front door, and then closes it behind you as you leave."
	CRLF
	CRLF
	CALL2 RT-GOTO,RM-GREAT-RUSSELL-ST >STACK
	RSTACK

	.FUNCT RT-INDENT-PRINT
	LESS? GL-ALLSCREEN,75 /FALSE
	PRINTI "     "
	RTRUE

	.FUNCT RT-WRAP-PRINT
	LESS? GL-ALLSCREEN,75 \?L1
	CRLF
	PRINTI "    "
	RTRUE
?L1:	PRINTI " "
	RTRUE

	.FUNCT RT-AC-LG-BAKER-ST-DOOR
	EQUAL? GL-PRSA,V?KNOCK \?L1
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \?L3
	PRINTR "You are already inside."
?L3:	FSET? LG-BAKER-ST-DOOR,FL-OPENED \?L5
	PRINTR "The door is already open."
?L5:	FSET? CH-HUDSON,FL-ASLEEP \?L6
	PRINTR "There is no answer."
?L6:	FSET? LG-BAKER-ST-DOOR,FL-LOCKED /?L7
	FSET LG-BAKER-ST-DOOR,FL-OPENED
	MOVE CH-HUDSON,RM-ENTRY-HALL
	ICALL2 RT-THIS-IS-IT,CH-HUDSON
	PRINTR "Mrs Hudson appears and says, ""Please come in Dr Watson."" She steps back into the hall to allow room for you to pass."
?L7:	FCLEAR LG-BAKER-ST-DOOR,FL-LOCKED
	SET 'GL-PLACE-CUR,RM-ENTRY-HALL
	MOVE CH-HUDSON,GL-PLACE-CUR
	MOVE CH-PLAYER,GL-PLACE-CUR
	ICALL2 RT-THIS-IS-IT,CH-HUDSON
	PRINTI "You hear a bolt sliding back and the door opens to reveal a worried Mrs Hudson."
	CRLF
	CRLF
	PRINTI """Oh Doctor Watson, I'm so glad to see you. It's Mr Holmes, sir. Three days have come and gone since he's been out of his rooms. He won't eat and I know he hasn't slept. Now there's a visitor who says he's here about some important government business. I tried to send him away, but he insisted on waiting in the parlour. That's when I sent for you. Thank God you've come."""
	CRLF
	ICALL RT-EXEC-RM-DESCFCN,RM-ENTRY-HALL,K-M-DESC-1
	CRLF
	RTRUE
?L1:	EQUAL? GL-PRSA,V?KICK,V?HIT,V?MUNG \?L9
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL /FALSE
	FSET? LG-BAKER-ST-DOOR,FL-OPENED /FALSE
	PRINTI "Mrs Hudson pokes her head out the door and says, ""I'm not opening the door until you knock like a proper gentleman."" She slams the door in your face."
	CRLF
	CALL2 PRINT-ID,STR?519 >STACK
	RSTACK
?L9:	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \FALSE
	EQUAL? GL-PLACE-CUR,RM-221B-BAKER-ST \?L15
	CALL2 RT-DO-WALK,P?WEST >STACK
	RSTACK
?L15:	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \FALSE
	CALL2 RT-DO-WALK,P?EAST >STACK
	RSTACK

	.FUNCT RT-AC-LG-PARLOUR-DOOR
	EQUAL? GL-PRSA,V?OPEN \?L1
	FSET? CH-HOLMES,FL-ASLEEP \FALSE
	ICALL2 RT-CTHEO-PRINT,CH-HUDSON
	PRINT K-HUDSON-WORRIED-MSG
	CRLF
	RTRUE
?L1:	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \FALSE
	EQUAL? GL-PLACE-CUR,RM-PARLOUR \?L7
	CALL2 RT-DO-WALK,P?SOUTH >STACK
	RSTACK
?L7:	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \FALSE
	CALL2 RT-DO-WALK,P?NORTH >STACK
	RSTACK

	.FUNCT RT-AC-LG-HOLMES-STUDY-DOOR
	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \FALSE
	EQUAL? GL-PLACE-CUR,RM-VESTIBULE \?L3
	CALL2 RT-DO-WALK,P?NORTH >STACK
	RSTACK
?L3:	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \FALSE
	CALL2 RT-DO-WALK,P?SOUTH >STACK
	RSTACK

	.FUNCT RT-AC-LG-HOLMES-BEDROOM-DOOR
	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \FALSE
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY \?L3
	CALL2 RT-DO-WALK,P?WEST >STACK
	RSTACK
?L3:	EQUAL? GL-PLACE-CUR,RM-HOLMES-BEDROOM \FALSE
	CALL2 RT-DO-WALK,P?EAST >STACK
	RSTACK

	.FUNCT RT-AC-LG-BAR-OF-GOLD-DOOR
	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \FALSE
	EQUAL? GL-PLACE-CUR,RM-BAR-OF-GOLD \?L3
	CALL2 RT-DO-WALK,P?EAST >STACK
	RSTACK
?L3:	EQUAL? GL-PLACE-CUR,RM-SWAN-LANE \FALSE
	CALL2 RT-DO-WALK,P?WEST >STACK
	RSTACK

	.FUNCT RT-AC-LG-LAIR-DOOR
	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?ENTER,V?THROUGH,V?OPEN /?L5
	EQUAL? GL-PRSA,V?CLOSE,V?UNLOCK,V?LOCK \?L3
?L5:	FSET? CH-AKBAR,FL-LOCKED /?L3
	FSET? CH-AKBAR,FL-ASLEEP /?L3
	PRINTI "Akbar"
	FSET? TH-WATSONS-HAT,FL-WORN \?L6
	PRINTI " says, ""Forgive me, sir,"" and"
?L6:	PRINTR " stops you as you move toward the door."
?L3:	EQUAL? GL-PRSA,V?OPEN \?L9
	FSET? CH-HOLMES,FL-LOCKED \?L9
	PRINTR "Holmes calls out, ""Watson! I'm still tied up!"" You pause and look back, torn by indecision."
?L9:	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \?L10
	EQUAL? GL-PLACE-CUR,RM-LAIR \FALSE
	CALL2 RT-DO-WALK,P?OUT >STACK
	RSTACK
?L10:	EQUAL? GL-PRSA,V?UNLOCK \?L14
	EQUAL? GL-PRSI,TH-LAIR-KEY \?L14
	FSET? LG-LAIR-DOOR,FL-LOCKED \?L14
	FCLEAR LG-LAIR-DOOR,FL-LOCKED
	ICALL RT-CYOU-MSG,STR?521,STR?520
	ICALL2 RT-THEO-PRINT,LG-LAIR-DOOR
	PRINTR "."
?L14:	EQUAL? GL-PRSA,V?LOCK \FALSE
	EQUAL? GL-PRSI,TH-LAIR-KEY \FALSE
	FSET? LG-LAIR-DOOR,FL-OPENED /FALSE
	FSET? LG-LAIR-DOOR,FL-LOCKED /FALSE
	FSET LG-LAIR-DOOR,FL-LOCKED
	ICALL RT-CYOU-MSG,STR?476,STR?475
	ICALL2 RT-THEO-PRINT,LG-LAIR-DOOR
	PRINTR "."

	.FUNCT RT-AC-LG-JERICHO-PARLOUR-DOOR
	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \FALSE
	EQUAL? GL-PLACE-CUR,RM-SOUTH-AISLE \?L3
	CALL2 RT-DO-WALK,P?SOUTH >STACK
	RSTACK
?L3:	EQUAL? GL-PLACE-CUR,RM-JERICHO-PARLOUR \FALSE
	CALL2 RT-DO-WALK,P?NORTH >STACK
	RSTACK

	.FUNCT RT-AC-LG-SHOPS,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The shops are closed for the Jubilee."
?L1:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \FALSE
	PRINTR "The shops are all closed for the Jubilee."

	.FUNCT RT-AC-LG-WATER,CONTEXT,CLASS,CAP?
	ASSIGNED? 'CONTEXT /?L33
	SET 'CONTEXT,0
?L33:	ASSIGNED? 'CLASS /?L34
	SET 'CLASS,0
?L34:	ASSIGNED? 'CAP? /?L35
	SET 'CAP?,0
?L35:	EQUAL? CONTEXT,K-M-SDESC \?L1
	EQUAL? CLASS,K-DESC-A \?L3
	PUSH 1
	JUMP ?L5
?L3:	PUSH 0
?L5:	IXCALL PRINT-SDESC,STR?522,CLASS,STACK,0
	RTRUE
?L1:	ZERO? CONTEXT \FALSE
	ZERO? GL-NOW-PRSI? \?L36
	EQUAL? GL-PRSA,V?ENTER,V?LEAP \?L8
	EQUAL? GL-WINNER,CH-PLAYER \?L10
	PRINTI "You may not remember this, but you can't swim."
	CRLF
	CALL2 PRINT-ID,STR?523 >STACK
	RSTACK
?L10:	PRINTR "That's not very polite."
?L8:	EQUAL? GL-PRSA,V?DRINK \?L13
	PRINT K-YUCK-MSG
	CRLF
	CALL2 PRINT-ID,STR?524 >STACK
	RSTACK
?L13:	EQUAL? GL-PRSA,V?EXAMINE \?L14
	PRINTR "The water is black, oily, slimy, dirty, and otherwise unwholesome-looking."
?L14:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH \?L15
	PRINTR "The water is so black and oily that you can't see a thing."
?L15:	EQUAL? GL-PRSA,V?REACH-IN,V?SEARCH \?L16
	PRINTI "Slimy things brush up against your hand, so you quickly pull it back."
	CRLF
	CALL2 PRINT-ID,STR?525 >STACK
	RSTACK
?L16:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?526
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK
?L36:	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	FSET? GL-PRSO,FL-BODYPART /?L24
	EQUAL? GL-PRSO,CH-ME,CH-PLAYER \?L22
?L24:	PRINT K-YUCK-MSG
	CRLF
	CALL2 PRINT-ID,STR?527 >STACK
	RSTACK
?L22:	EQUAL? GL-PRSO,TH-ANCHOR,PSEUDO-OBJECT /?L28
	LOC GL-PRSO >STACK
	EQUAL? STACK,GLOBAL-OBJECTS,LOCAL-GLOBALS \?L26
?L28:	ICALL RT-PERFORM,V?DROP,GL-PRSO
	RTRUE
?L26:	EQUAL? GL-PRSO,CH-TRAINED-PIGEON \?L29
	REMOVE GL-PRSO
	ICALL1 RT-KILL-PIGEON
	PRINTI "The pigeon struggles briefly, its feathers too wet to fly, then sinks below the water."
	ICALL2 PRINT-ID,STR?528
	RTRUE
?L29:	REMOVE GL-PRSO
	FCLEAR GL-PRSO,FL-WORN
	PRINTI "Plop."
	CRLF
	CALL1 IS-OBJECT-OR-PROPERTY? >STACK
	ICALL PRINT-ID,STR?529,STACK
	CALL1 IS-YOUR-PROPERTY? >STACK
	ICALL PRINT-ID,STR?530,STACK
	RTRUE

	.FUNCT RT-AC-LG-UP-DOWN-STREAM,CONTEXT
	ASSIGNED? 'CONTEXT /?L5
	SET 'CONTEXT,0
?L5:	EQUAL? CONTEXT,K-M-SDESC \?L1
	GETP LG-UP-DOWN-STREAM,P?OBJ-NOUN >STACK
	PRINTB STACK
	RTRUE
?L1:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?531
	ICALL1 RT-IMPOSSIBLE-MSG
	RTRUE

	.FUNCT RT-AC-LG-BRITISH-MUSEUM-DOOR
	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \FALSE
	EQUAL? GL-PLACE-CUR,RM-GREAT-RUSSELL-ST \?L3
	CALL2 RT-DO-WALK,P?NORTH >STACK
	RSTACK
?L3:	EQUAL? GL-PLACE-CUR,RM-BRITISH-MUSEUM \FALSE
	CALL2 RT-DO-WALK,P?SOUTH >STACK
	RSTACK

	.FUNCT RT-AC-LG-WESTMINSTER-DOOR
	EQUAL? GL-PRSA,V?ENTER,V?THROUGH \FALSE
	EQUAL? GL-PLACE-CUR,RM-BROAD-SANCTUARY \?L3
	CALL2 RT-DO-WALK,P?EAST >STACK
	RSTACK
?L3:	EQUAL? GL-PLACE-CUR,RM-NAVE \FALSE
	CALL2 RT-DO-WALK,P?WEST >STACK
	RSTACK

	.FUNCT RT-AC-LG-PLAQUES,CONTEXT
	ASSIGNED? 'CONTEXT /?L24
	SET 'CONTEXT,0
?L24:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "It looks mighty like a plaque."
?L1:	EQUAL? GL-PRSA,V?TAKE \?L3
	PRINTI "The plaque is firmly attached to the "
	ICALL2 PRINT-ID,STR?532
	EQUAL? GL-PLACE-CUR,RM-MANUSCRIPT-ROOM \?L4
	PRINTI "desk"
	JUMP ?L6
?L4:	PRINTI "wall"
?L6:	PRINTR ". You can't remove it."
?L3:	EQUAL? GL-PRSA,V?READ,V?EXAMINE \?L7
	EQUAL? GL-PLACE-CUR,RM-BROAD-SANCTUARY \?L8
	GET GL-QUOTES,K-SIGN-ABBEY >GL-WINDOW
	JUMP ?L21
?L8:	EQUAL? GL-PLACE-CUR,RM-MANUSCRIPT-ROOM \?L10
	GET GL-QUOTES,K-SIGN-QUIET >GL-WINDOW
	JUMP ?L21
?L10:	EQUAL? GL-PLACE-CUR,RM-MADAME-TUSSAUDS \?L11
	GET GL-QUOTES,K-SIGN-HORRORS >GL-WINDOW
	JUMP ?L21
?L11:	EQUAL? GL-PLACE-CUR,RM-GREAT-RUSSELL-ST \?L12
	GET GL-QUOTES,K-SIGN-MUSEUM >GL-WINDOW
	JUMP ?L21
?L12:	EQUAL? GL-PLACE-CUR,RM-MONUMENT \?L13
	GET GL-QUOTES,K-SIGN-MONUMENT >GL-WINDOW
	JUMP ?L21
?L13:	EQUAL? GL-PLACE-CUR,RM-THE-BLACK-MUSEUM \?L14
	GET GL-QUOTES,K-SIGN-BLIGH >GL-WINDOW
	JUMP ?L21
?L14:	EQUAL? GL-PLACE-CUR,RM-THREADNEEDLE-ST \?L15
	GET GL-QUOTES,K-SIGN-BANK >GL-WINDOW
	JUMP ?L21
?L15:	EQUAL? GL-PLACE-CUR,RM-TOWER-ENTRANCE \?L16
	GET GL-QUOTES,K-SIGN-TOWER >GL-WINDOW
	JUMP ?L21
?L16:	EQUAL? GL-PLACE-CUR,RM-TRAFALGAR-SQUARE \?L17
	GET GL-QUOTES,K-SIGN-NELSON >GL-WINDOW
	JUMP ?L21
?L17:	EQUAL? GL-PLACE-CUR,RM-VICTORIA-STREET \?L18
	GET GL-QUOTES,K-SIGN-LOITER >GL-WINDOW
	JUMP ?L21
?L18:	EQUAL? GL-PLACE-CUR,RM-SWAN-LANE \?L19
	GET GL-QUOTES,K-SIGN-GOLDBAR >GL-WINDOW
	JUMP ?L21
?L19:	EQUAL? GL-PLACE-CUR,RM-JERUSALEM-CHAMBER \?L20
	GET GL-QUOTES,K-SIGN-HENRY >GL-WINDOW
	JUMP ?L21
?L20:	GET GL-QUOTES,K-SIGN-BLANK >GL-WINDOW
?L21:	ICALL2 RT-WINDOW,GL-WINDOW
	SET 'GL-WINDOW,0
	RTRUE
?L7:	EQUAL? GL-PRSA,V?PUT,V?PUT-ON \FALSE
	ZERO? GL-NOW-PRSI? /FALSE
	PRINTI "Putting anything on "
	ICALL2 RT-THEO-PRINT,LG-PLAQUES
	PRINTI " would"
	CALL1 RT-WASTE-OF-TIME-MSG >STACK
	RSTACK

	.FUNCT RT-DF-LG-WAX-STATUES,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L9
	SET 'CONTEXT,0
?L9:	ASSIGNED? 'CLASS /?L10
	SET 'CLASS,0
?L10:	EQUAL? CONTEXT,K-M-SDESC \?L1
	IXCALL PRINT-SDESC,STR?533,CLASS,0,1
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	EQUAL? GL-PLACE-CUR,RM-MADAME-TUSSAUDS \?L4
	PRINTR "The statues are of King John, Sir Francis Drake, Sir Walter Raleigh, and William the Conqueror."
?L4:	EQUAL? GL-PLACE-CUR,RM-CHAMBER-OF-HORRORS \FALSE
	PRINTR "The statues are of Guy Fawkes, Charles I, and Saint Thomas Becket."

	.FUNCT RT-AC-LG-WINDOW,CONTEXT
	ASSIGNED? 'CONTEXT /?L33
	SET 'CONTEXT,0
?L33:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	EQUAL? GL-PLACE-CUR,RM-221B-BAKER-ST \?L3
	PRINTR "It is a bow window, far above your head."
?L3:	EQUAL? GL-PLACE-CUR,RM-SOUTH-TRANSEPT \?L5
	PRINTI "It is the largest rose window in all England"
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L6
	PRINT K-BRIGHTENS-UP-MSG
?L6:	PRINTR "."
?L5:	EQUAL? GL-PLACE-CUR,RM-NORTH-TRANSEPT \FALSE
	PRINTI "It is set high in the north wall of the Abbey"
	CALL1 RT-TIME-OF-DAY >STACK
	EQUAL? STACK,1,2,3 \?L10
	PRINT K-BRIGHTENS-UP-MSG
?L10:	PRINTR "."
?L1:	EQUAL? GL-PRSA,V?SHOOT \?L14
	ZERO? GL-NOW-PRSI? \?L14
	ICALL2 PRINT-ID,STR?534
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK
?L14:	IN? GL-WINNER,RM-SOUTH-TRANSEPT /?L16
	IN? GL-WINNER,RM-NORTH-TRANSEPT \?L15
?L16:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?SEARCH,V?LOOK-OUTSIDE \?L17
	PRINTR "You cannot see through the stained-glass window."
?L17:	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /FALSE
	ICALL2 RT-CTHEO-PRINT,LG-WINDOW
	PRINTR " is too high."
?L15:	IN? GL-WINNER,RM-221B-BAKER-ST \?L21
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L22
	ICALL2 RT-CTHEO-PRINT,LG-WINDOW
	PRINTR " is too high."
?L22:	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?LOOK-OUTSIDE,V?SEARCH \FALSE
	ICALL2 RT-CTHEO-PRINT,LG-WINDOW
	PRINTR " is too high to see in."
?L21:	IN? GL-WINNER,RM-HOLMES-STUDY \FALSE
	EQUAL? GL-PRSA,V?LOOK-INSIDE,V?LOOK-OUTSIDE,V?SEARCH \?L27
	PRINTI "You look down into Baker Street."
	CRLF
	CALL2 RT-DESCRIBE-PLACE-CONTENTS,RM-221B-BAKER-ST >STACK
	RSTACK
?L27:	EQUAL? GL-PRSA,V?MUNG \?L29
	ICALL2 RT-CTHEO-PRINT,LG-WINDOW
	PRINTI " is made of reinforced glass. It can't be broken."
	CRLF
	CALL2 PRINT-ID,STR?535 >STACK
	RSTACK
?L29:	EQUAL? GL-PRSA,V?OPEN \FALSE
	ICALL2 RT-CTHEO-PRINT,LG-WINDOW
	PRINTR " is jammed shut. It can't be opened."

	.FUNCT RT-AC-LG-TOMBS-ABBEY,CONTEXT
	ASSIGNED? 'CONTEXT /?L32
	SET 'CONTEXT,0
?L32:	GETP LG-TOMBS-ABBEY,P?OBJ-NOUN >STACK
	EQUAL? STACK,W?ABBEY \?L1
	EQUAL? CONTEXT,K-M-SDESC \?L3
	PRINTI "Abbey"
	RTRUE
?L3:	ZERO? CONTEXT \FALSE
	EQUAL? GL-PRSA,V?ENTER \?L6
	EQUAL? GL-PLACE-CUR,RM-NAVE \?L7
	CALL1 RT-ALREADY-IN-ROOM-MSG >STACK
	RSTACK
?L7:	EQUAL? GL-PLACE-CUR,RM-BROAD-SANCTUARY \FALSE
	CALL2 RT-DO-WALK,P?EAST >STACK
	RSTACK
?L6:	EQUAL? GL-PRSA,V?EXIT \?L11
	EQUAL? GL-PLACE-CUR,RM-NAVE \?L12
	CALL2 RT-DO-WALK,P?WEST >STACK
	RSTACK
?L12:	CALL1 RT-NOT-IN-ROOM-MSG >STACK
	RSTACK
?L11:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?536
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK
?L1:	EQUAL? CONTEXT,K-M-SDESC \?L18
	PRINTI "tombs"
	RTRUE
?L18:	FSET? GL-PLACE-CUR,FL-INDOORS \?L21
	EQUAL? GL-PLACE-CUR,RM-JERICHO-PARLOUR,RM-JERUSALEM-CHAMBER,RM-NORTH-CLOISTER \?L20
?L21:	ICALL2 RT-CANT-SEE-ANY-MSG,LG-TOMBS-ABBEY
	RTRUE
?L20:	EQUAL? CONTEXT,K-M-DESCFCN \?L22
	EQUAL? GL-PLACE-CUR,RM-SOUTH-AMBULATORY,RM-NORTH-AMBULATORY \?L23
	PRINTR "There are so many of them! None stands out in particular."
?L23:	EQUAL? GL-PLACE-CUR,RM-CONFESSOR-CHAPEL \?L25
	PRINTR "Two of them are especially interesting. One is the tomb of Edward the Confessor. The other is of Henry V."
?L25:	PRINTR "One tomb in particular catches your eye."
?L22:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?537
	CALL1 RT-SHOOT-DEAD-MSG >STACK
	RSTACK

	.FUNCT RT-AC-LG-STREETLIGHT
	CALL1 RT-TOUCH-VERB? >STACK
	ZERO? STACK /?L1
	ICALL2 RT-CTHEO-PRINT,LG-STREETLIGHT
	PRINTR " is too high."
?L1:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK

	.FUNCT RT-AC-LG-STAIRWAY
	EQUAL? GL-PRSA,V?CLIMB-UP \?L1
	CALL2 RT-DO-WALK,P?UP >STACK
	RSTACK
?L1:	EQUAL? GL-PRSA,V?CLIMB-DOWN \FALSE
	CALL2 RT-DO-WALK,P?DOWN >STACK
	RSTACK

	.FUNCT RT-AC-LG-SHAFT-OF-LIGHT,CONTEXT
	ASSIGNED? 'CONTEXT /?L20
	SET 'CONTEXT,0
?L20:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "Well, it's not really a shaft of light. It's more like a diffused murkiness. But any light that penetrates an English church from the outside counts as a shaft."
?L1:	ZERO? GL-NOW-PRSI? \?L21
	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?538
	CALL1 RT-WASTE-OF-BULLETS-MSG >STACK
	RSTACK
?L21:	EQUAL? GL-PRSA,V?PUT \FALSE
	EQUAL? GL-PRSO,TH-MAGNIFYING-GLASS \?L10
	CALL1 RT-WHO-SAYS? >STACK
	EQUAL? STACK,CH-HOLMES \?L12
	PRINTR """Your Afghan experience is showing, Watson. The hot sun there would surely produce rays capable, when focused, of producing a flame. Alas, our English sun is too weak to produce such an effect."""
?L12:	PRINTR "The rays from England's sun are too weak to focus."
?L10:	EQUAL? GL-PRSO,TH-GREEN-PAPER,TH-WHITE-PAPER,TH-BLUE-PAPER /FALSE
	EQUAL? GL-PRSO,TH-ORANGE-PAPER,TH-YELLOW-PAPER,TH-BROWN-PAPER /FALSE
	PRINTI "Putting "
	ICALL1 RT-THEO-PRINT
	PRINTI " in "
	ICALL1 RT-THEI-PRINT
	CALL1 RT-WASTE-OF-TIME-MSG >STACK
	RSTACK

	.FUNCT RT-AC-LG-RAVENS,CONTEXT
	ASSIGNED? 'CONTEXT /?L11
	SET 'CONTEXT,0
?L11:	EQUAL? CONTEXT,K-M-DESCFCN \?L1
	PRINTR "The ravens stare at you with baleful eyes."
?L1:	EQUAL? CONTEXT,K-M-WINNER \?L3
	ICALL2 RT-CTHEO-PRINT,LG-RAVENS
	PRINTR " caw raucously in response."
?L3:	ZERO? GL-NOW-PRSI? \FALSE
	EQUAL? GL-PRSA,V?TAKE \?L5
	ICALL2 RT-CTHEO-PRINT,LG-RAVENS
	PRINTR " fly out of reach."
?L5:	EQUAL? GL-PRSA,V?SHOOT \?L7
	ICALL2 PRINT-ID,STR?539
	ICALL RT-SHOOT-BIRDS,LG-RAVENS,STR?540
	RTRUE
?L7:	EQUAL? GL-PRSA,V?LISTEN \FALSE
	PRINTR "None of the ravens is quothing ""Nevermore."""

	.FUNCT RT-DF-LG-BOATS,CONTEXT
	ASSIGNED? 'CONTEXT /?L7
	SET 'CONTEXT,0
?L7:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	CALL1 RT-TIME-OF-DAY >STACK
	ZERO? STACK \?L4
	ICALL2 RT-CTHEO-PRINT,LG-BOATS
	PRINTR " are shrouded in fog."
?L4:	ICALL2 RT-CTHEO-PRINT,LG-BOATS
	PRINTR " bob merrily on the river."

	.FUNCT RT-AC-LG-HOLMES-HOUSE
	EQUAL? GL-PRSA,V?ENTER \?L1
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL,RM-PARLOUR,RM-VESTIBULE /?L5
	EQUAL? GL-PLACE-CUR,RM-HOLMES-STUDY,RM-HOLMES-BEDROOM \?L3
?L5:	ICALL1 RT-ALREADY-IN-ROOM-MSG
	RTRUE
?L3:	EQUAL? GL-PLACE-CUR,RM-221B-BAKER-ST \FALSE
	ICALL2 RT-DO-WALK,P?WEST
	RTRUE
?L1:	EQUAL? GL-PRSA,V?EXIT \FALSE
	EQUAL? GL-PLACE-CUR,RM-ENTRY-HALL \?L9
	ICALL2 RT-DO-WALK,P?EAST
	RTRUE
?L9:	EQUAL? GL-PLACE-CUR,RM-PARLOUR,RM-VESTIBULE,RM-HOLMES-STUDY /?L12
	EQUAL? GL-PLACE-CUR,RM-HOLMES-BEDROOM \?L11
?L12:	PRINT K-SPECIFY-DIR-MSG
	CRLF
	RTRUE
?L11:	ICALL1 RT-NOT-IN-ROOM-MSG
	RTRUE

	.FUNCT RT-AC-LG-PEDESTAL,CONTEXT,CLASS
	ASSIGNED? 'CONTEXT /?L6
	SET 'CONTEXT,0
?L6:	ASSIGNED? 'CLASS /?L7
	SET 'CLASS,0
?L7:	EQUAL? CONTEXT,K-M-SDESC \?L1
	IXCALL PRINT-SDESC,STR?541,CLASS,0,0
	RTRUE
?L1:	EQUAL? CONTEXT,K-M-DESCFCN \FALSE
	EQUAL? GL-PLACE-CUR,RM-TRAFALGAR-SQUARE \FALSE
	PRINTR "On the pedestal you see a bronze relief."

	.FUNCT RT-AC-LG-TOWER
	EQUAL? GL-PRSA,V?ENTER \?L1
	EQUAL? GL-PLACE-CUR,RM-BYWARD-TOWER,RM-BLOODY-TOWER,RM-WAKEFIELD-TOWER /?L5
	EQUAL? GL-PLACE-CUR,RM-JEWEL-ROOM,RM-DUNGEON,RM-TORTURE-ROOM /?L5
	EQUAL? GL-PLACE-CUR,RM-WHITE-TOWER,RM-BOWYER-TOWER \?L3
?L5:	CALL1 RT-ALREADY-IN-ROOM-MSG >STACK
	RSTACK
?L3:	EQUAL? GL-PLACE-CUR,RM-OUTER-WARD,RM-TOWER-GREEN \?L6
	PRINT K-SPECIFY-DIR-MSG
	CRLF
	RTRUE
?L6:	EQUAL? GL-PLACE-CUR,RM-OUTSIDE-TRAITORS-GATE \?L7
	CALL2 RT-DO-WALK,P?NORTH >STACK
	RSTACK
?L7:	EQUAL? GL-PLACE-CUR,RM-DRAWBRIDGE,RM-TOWER-ENTRANCE \FALSE
	CALL2 RT-DO-WALK,P?EAST >STACK
	RSTACK
?L1:	EQUAL? GL-PRSA,V?EXIT \?L10
	EQUAL? GL-PLACE-CUR,RM-BLOODY-TOWER,RM-WAKEFIELD-TOWER,RM-WHITE-TOWER /?L13
	EQUAL? GL-PLACE-CUR,RM-BOWYER-TOWER,RM-BYWARD-TOWER \?L11
?L13:	CALL2 RT-DO-WALK,P?OUT >STACK
	RSTACK
?L11:	EQUAL? GL-PLACE-CUR,RM-DUNGEON,RM-TORTURE-ROOM \?L14
	CALL2 RT-DO-WALK,P?UP >STACK
	RSTACK
?L14:	EQUAL? GL-PLACE-CUR,RM-JEWEL-ROOM \?L15
	CALL2 RT-DO-WALK,P?DOWN >STACK
	RSTACK
?L15:	EQUAL? GL-PLACE-CUR,RM-INSIDE-TRAITORS-GATE \?L16
	CALL2 RT-DO-WALK,P?SOUTH >STACK
	RSTACK
?L16:	EQUAL? GL-PLACE-CUR,RM-OUTER-WARD,RM-TOWER-GREEN \?L17
	PRINT K-SPECIFY-DIR-MSG
	CRLF
	RTRUE
?L17:	CALL1 RT-NOT-IN-ROOM-MSG >STACK
	RSTACK
?L10:	EQUAL? GL-PRSA,V?SHOOT \FALSE
	ICALL2 PRINT-ID,STR?542
	CALL1 RT-IMPOSSIBLE-MSG >STACK
	RSTACK

	.INSERT "./sherlock/sherlock_str"
	.END
